$#PATCH NUMBER 1 FOR TSSMCP.XII CONTAINS 29 CARDS                            &&&
%   T S - M C P  M A R K    X I I . 1 2                    02/15/71     00001000
            L=Q+1,H=L+1,J=H+1,R=J+1,DL=R+1;                             05841400
$VOID 05842301                                                          05842299
    SLEEP([TOGLE],USERDISKMASK); USERDISKREADY~ FALSE;                  05842310
$VOID 05842321                                                          05842311
$INCLUDE 05842401, IF SHAREDISK;                                        05842390
    FIXARRAY(U,R,AVS); DISKWAIT(-R,-AVS,USERDISKBOTTOM);                05842400
    FIXARRAY(UT,R,30); USERDISKSPECIALCASE(I~1,R,UT,NS); GO TO A;       05844110
G: FORGETSPACE(R); UNLOCK(USERDISKBOTTOM); USERDISKREADY~TRUE;          05846380
    DISKWAIT(-F,-30,B~DIRECTORYTOP+1);                                  06057600
         DISKWAIT(-F,30,B); FH[SYS]~0;                                  06057750
    DISKWAIT(F,-30,B);                                                  06057770
$VOID                                                                   22051000
              LOCKDIRECTORY;                                            22051250
              UNLOCKDIRECTORY;                                          22052350
$VOID                                                                   22052500
                   FORGETUSERDISK(H[I]+RL,-(ABS(BRL-RL)));              37516000
                   FORGETUSERDISK(A[NT4-1]+RL,                          37542000
                                  -(ABS((NT2-9)|BRL-NT4|RL)));          37542010
         AVS~P(DDD[NEUP.NEUF],DUP).NUMENT+P(XCH).STARTWRD+AVDIFFMIN;    44241330
         AVS~(AVS~IF AVS >AVSMAX THEN AVSMAX ELSE IF AVS LSS AVSMIN     44241335
         THEN AVSMIN ELSE AVS)+30-(IF (AVS~AVS MOD 30)!0 THEN AVS ELSE  44241336
         30);                                                           44241337
         DISKWAIT(-A,60,USERDISKBOTTOM);                                44241380
$VOID 44241397                                                          44241385
$VOID                                                                   44242002
              ACTDATE~WEEKDAY~0;                                        44242900
                   P(CLOCK&NT4[8:38:10],MKS,NT4,DIB 0,LOD,BLOB,COC);    48056000
         P(0,STF,PRT[P1MIX,8],STS,MKS,NT4,DIB 0,LOD,XCH,COC);           48145000
$#PATCH NUMBER 2 FOR TSSMCP.XII CONTAINS 4 CARDS                             &&&
         INTEGER LINK;                                                  14351100
         LABEL RETURNEM,AHEAD;                                          14351150
                                  GO AHEAD;                             14396200
    AHEAD:                                                              14407500
$#PATCH NUMBER 3 FOR TSSMCP.XII CONTAINS 1 CARDS                             &&&
                (HEADER INX 0)&FIB[5][30:13:3];                         38508500
$#PATCH NUMBER 4 FOR TSSMCP.XII CONTAINS 37 CARDS                            &&&
              CLOSEXCLUSIVE,ZER,UNSYS,SYS,                              18207000
$INCLUDE 18210101, IF SHAREDISK;                                        18210099
         LABEL ONE,TOG1,TOG2,STOG;                                      18210100
$INCLUDE 18314001, IF SHAREDISK;                                        18310999
$OMIT 18314201, IF SHAREDISK;                                           18314099
              FH[9].[9:5]:=P(DUP).[9:5]+1;                              18314100
              FH[9].[1:1]:=1;                                           18314200
$INCLUDE 18321001, IF SHAREDISK;                                        18319999
$OMIT 18321101, IF SHAREDISK;                                           18321099
         FH[4].[16:5]:=P(DUP).[16:5]+1;                                 18321100
$INCLUDE 18327001, IF SHAREDISK;                                        18325999
$OMIT 18327101, IF SHAREDISK;                                           18327099
              FH[9].[5:1]:=1;                                           18327100
$INCLUDE 18336001, IF SHAREDISK;                                        18334999
$OMIT 18336101, IF SHAREDISK;                                           18336099
              FH[9].[9:5]:=P(DUP).[9:5]+1;                              18336100
$INCLUDE 18357001, IF SHAREDISK;                                        18350999
$OMIT 18357301, IF SHAREDISK;                                           18357099
         IF (I:=FH[9].[9:5]-1)=0 THEN                                   18357100
         FH[9].[1:1]:=0;                                                18357200
         FH[9].[9:5]:=I;                                                18357300
$INCLUDE 18361001, IF SHAREDISK;                                        18359999
$OMIT 18361101, IF SHAREDISK;                                           18361099
         FH[4].[16:5]:=P(DUP).[16:5]-1;                                 18361100
$INCLUDE 18365001, IF SHAREDISK;                                        18363999
$OMIT 18365101, IF SHAREDISK;                                           18365099
         FH[9].[5:1]:=0;                                                18365100
$INCLUDE 18369001, IF SHAREDISK;                                        18367999
$OMIT 18369101, IF SHAREDISK;                                           18369099
         FH[9].[9:5]:=P(DUP).[9:5]-1;                                   18369100
$INCLUDE 18392001, IF SHAREDISK;                                        18390999
$OMIT 18392101, IF SHAREDISK;                                           18392099
              FH[4].[12:1]:=1;                                          18392100
$INCLUDE 18399001, IF SHAREDISK;                                        18397999
$OMIT 18399101, IF SHAREDISK;                                           18399099
         FH[4].[12:1]:=0;                                               18399100
$INCLUDE 18410001, IF SHAREDISK;                                        18403999
$# PATCH NUMBER  5 FOR TSSMCP.XII CONTAINS 9 CARDS                           &&&
$INCLUDE 03180201, IF TWXONLY;                                          03180199
                   OOP:=DCWRITE(B,LL,NUM);                              03180200
                   OOP:=DCWRITE(B,LL,NUM-(D!TWX));                      03180295
    IF LINEDISC[D:=IF (T:=LOGLINE.[40:8]) LEQ LMAX THEN T               03296800
    ELSE STATABLE[T].LEENKER] = SCHED THEN                              03296900
         IF NOT(PAPERTAPE[T] OR P(LINETABLE[D],DUP).LINEDIS!MULTI AND   03297800
         BEGIN SEQARRAY[L]:=NABS(T)&1[4:47:1];                          03487300
              M[C:=GETAREA(0)]:=R&SELECT[5:43:5]&L[10:40:8];            03487400
                         I:=M[H] - J + 1;                               03666600
$#PATCH NUMBER 6 FOR TSSMCP.XII CONTAINS 1 CARDS                             &&&
                   @ 001220000713147,  COMMENT ZIP;%                    00273000
$#PATCH NUMBER 7 FOR TSSMCP.XII CONTAINS 6 CARDS                             &&&
              "8INVALD","8 FILE ","4NAME..", %77                        02345750
         IF (A.[1:5]!0 OR B.[1:5]!0) THEN                               14559300
         BEGIN                                                          14559400
             TERMINATE(P1MIX); TERMINALMESSAGE(77);                     14559500
             GO TO BOMBOUT;                                             14559600
         END;                                                           14559700
$#PATCH NUMBER 8 FOR TSSMCP.XII CONTAINS 1 CARDS                             &&&
         IF ABS(SPOWORD) = STA AND STA NEQ 0 THEN  %BACK UP SPO         03635305
$#PATCH NUMBER 9 FOR TSSMCP.XII CONTAINS 2 CARDS                             &&&
    BEGIN Q:=UT[H:=K-C+1].DSIZE;                                        05974400
         FOR H:=H STEP 1 UNTIL K DO                                     05974600
$#PATCH NUMBER 10 FOR TSSMCP.XII CONTAINS 7 CARDS                            &&&
             ,C35,C36,C37,C40,C41 %                                     19505300
                   INIT,SLOW,C34,C35,C36,C37,SLOW,SLOW,C40,C41;         19508100
C40:: IF R5.[15:15]=0 THEN                                              19532960
      BEGIN M[R5]:=NOT 0; GO TO INITIATE; END ELSE                      19532962
      FORK(P(.DKBUSINESS),R5,0,128,0); SLEEP([M[R5]],1);                19532966
      GO RETURN;                                                        19532968
C41:: IOREQUEST(R7,R6,FLAG(R5)); GO INITIATE;                           19532970
$#PATCH NUMBER 11 FOR TSSMCP.XII CONTAINS 50 CARDS                           &&&
         TMID=FID+1,                                                    05950900
         A=TMID+1,                                                      05951000
    BOOLEAN RDT=HD+1;                                                   05951700
    INTEGER C=RDT+1,D=C+1,I=D+1,J=I+1,R=J+1,S=R+1,                      05951800
            LA=S+1,SA1=NT2,                                             05951900
    REAL E=LA+1;                                                        05952200
    INTEGER SLEEPER=AVS+1;                                              05952500
    P(0,0,0,0,BUFF,DUP); BUFF:=P.[15:15]-1; P(0,0,B LSS 0);             05953200
    P(0,0,0,0,0,0,0,0,0);                                               05956200
    IF RDT THEN                                                         05956250
    BEGIN P(B); A:=M[BUFF INX 0]; N:=M[BUFF INX 1]; END ELSE            05956300
    BEGIN                                                               05956350
    END;                                                                05958500
X:  IF A GEQ L:=(H:=UT[T].DEND)-(Q:=UT[T].DSIZE) THEN                   05962600
    IF (LA:=(A+N)) LEQ H THEN GO AZ%AREA AVAILABLE                      05962700
    ELSE IF LA LEQ SA1:=(UT[T+1].DEND-UT[T+1].DSIZE) THEN               05962800
    N:=LA-A:=H ELSE N:=SA1-A:=H ELSE IF (LA:=A+N) GTR L THEN            05962900
    N:=L-A ELSE RDT:=RDT OR @100000;                                    05963000
    GO INUSE;                                                           05963100
Y:  TMID:=IF RDT THEN "DKTEST " ELSE "BADISK ";                         05963800
    STREAM(TMID,FID,N,MID,B,BUFF);                                      05964000
    BEGIN DS:=LIT "."; SI:=LOC TMID; SI:=SI+1; DS:=7 CHR;               05964200
         DS:=LIT "/"; SI:=SI+1; DS:=7 CHR;                              05964400
         DS:=13 LIT " NOT CREATED("; SI:=SI+8; SKIP SB;                 05964500
         IF SB THEN ELSE                                                05964600
         BEGIN SI:=LOC N; DS:=7 DEC; N:=DI; DI:=DI-7; DS:=7 FILL;       05964800
              DI:=N; DS:=5 LIT " SEGS"; SI:=SI+1;                       05964900
         END; DS:=11 LIT " IN USE BY "; DS:=7 CHR; DS:=LIT"/";          05965000
         SI:=SI+1; DS:=7 CHR;                                           05965200
         DS:=2 LIT")~";                                                 05965400
    END;                                                                05965600
$ VOID 05966001                                                         05965800
              IF(E EQV @114)=NOT 0 THEN                                 05967800
              BEGIN MID:="SYSTEM "; B:=FID; GO Z; END;                  05967900
                        IF A GEQ C THEN IF A LSS                        05968800
                        SA1:=(C+D:=UT[30|I+8]) THEN                     05968900
                        BEGIN MID:=E&((LA LEQ SA1) AND                  05969000
                             (RDT.[18:15]))[1:47:1];                    05969100
                             IF A+N GTR SA1 THEN N~SA1-A;               05969150
                             B:=UT[451+2|I];                            05969200
AZ: IF A NEQ L AND LA NEQ H THEN                                        05970800
         UT[T+1]:=H&(H-LA)[TODSIZE];                                    05972800
    IF A=L AND LA=H THEN                                                05973400
    MID:=IF RDT THEN "DKTEST " ELSE "BADISK ";                          05975400
$OMIT 05979401, IF SHAREDISK;                                           05979399
EXIT: IF RDT THEN M[SLEEPER INX 0]:=1 ELSE SPOUT(BUFF);                 05979400
$INCLUDE 05979451, IF SHAREDISK;                                        05979449
EXIT: IF RDT THEN M[SLEEPER INX 0]:=3 ELSE SPOUT(BUFF);                 05979450
    BUFF:=0; KILL([BUFF] INX NOT 1);                                    05979500
                        12                                              44203100
$#PATCH NUMBER 12 FOR TSSMCP.XII CONTAINS 7   CARDS                          &&&
 PROCEDURE COMMUNICATE;  FORWARD;                                       00478000
 PROCEDURE LIBRARYLOAD; FORWARD;                                        00479000
 PROCEDURE LIBRARYDUMP;  FORWARD;                                       00480000
     WU:  NT1:=P(..WHATSIT);                                            16166700
         FORK(NT1,KTR&(MIX|(MIX!63))[9:42:6],0,128,1);                  16166800
         GO EXIT;                                                       16166900
$VOID 18992001                                                          18991000
$#PATCH NUMBER 13 FOR TSSMCP.XII      CONTAINS 6 CARDS         C
%   T S - M C P  M A R K    X I I . 4 9                    04/15/71     00001000
         T~P(DUP,LOD,RFB);T~T&SPACE(T.[8:10])[CTC];                     19530520
         DISKWAIT(-T.[CF],T.[8:10],T.[FF]+MCPBASE);                     19530540
    ALPHA~(*P(..LIBRARYLOAD)).[CF];                                     28198500
    ALPHA~(*P(..LIBRARYDUMP)).[CF];                                     28539500
                   49                                                   44203100
$#PATCH NUMBER 14 FOR TSSMCP.XII     CONTAINS  3  CARDS        C
         ELSE IF JAR[P1MIX,2] < 0 THEN IF PRT[P1MIX,11].[FF] = 0 THEN   42551090
              PRT[P1MIX,11]~1 ELSE PRT[P1MIX,PRT[P1MIX,11].[FF]]~1      42551100
         ELSE                                                           42551110
$#PATCH NUMBER 15 FOR TSSMCP.XII      CONTAINS  2 CARDS        C
                        PRT[P1MIX,@23]:=1;                              13097100
                   IF NOT (SVPBT OR PRT[P1MIX,@23]) THEN                13135200
$#PATCH NUMBER 16 FOR TSSMCP.XII      CONTAINS  2 CARDS        C
            IF NOT PRTROW[P1MIX].[7:1] THEN                             38573000
            IF FIB[14].[CF]=FIB[14].[FF]                                38573100
$#PATCH NUMBER 17 FOR TSSMCP.XII      CONTAINS  2 CARDS        C
 COUT:   M[KTR-4].[9:6]:=0;                                             16185000
         CCARD(KTR&25[3:43:5]);                                         16185100
$#PATCH NUMBER 18 FOR TSSMCP.XII      CONTAINS 3 CARDS         C
     IF CODE!3 THEN                                                     08103450
    BEGIN                                                               08103460
    END;                                                                08103650
$#PATCH NUMBER  19 FOR TSSMCP.XII      CONTAINS  6 CARDS       C
              "8INVALI","8D BLOC","8K EXIT", % 82                       02345770
                   I:=AIT[0]+1;                                         42488000
                   IF (BCNTR:=PRT[P1MIX,CURBLKCNTR]) LEQ 0 THEN         42488100
                   BEGIN TERMINATE(P1MIX);                              42488200
                        TERMINALMESSAGE(82);                            42488300
                   END;                                                 42488400
$#PATCH NUMBER 20 FOR TSSMCP.XII      CONTAINS  1 CARDS        C
              LINETABLE[I]:=A[4]&1[2:47:1];                             05729025
$#PATCH NUMBER 21 FOR TSSMCP.XII     CONTAINS  1 CARDS         C
                             M[I+4]:=T.[6:7];                           04140500
$#PATCH NUMBER 22 FOR TSSMCP.XII     CONTAINS  3 CARDS         C
                   IF H1=0 THEN                                         08419100
              BEGIN STREAM(A:=TINU[U],B:=B:=SPACE(5));                  08424000
                   SPOUT(B);                                            08428000
$#PATCH NUMBER 23 FOR TSSMCP.XII     CONTAINS  1  CARDS        C
                   STREAM(A~PRNTABLE[U].[30:18],TL);                    02434424
$#PATCH NUMBER  24  FOR TSSMCP.XII      CONTAINS  1 CARDS      C
              IF NUM GTR 200 THEN NUM:=200;  %PRESENT MAX OUTPUT        03134130
$#PATCH NUMBER 25 FOR TSSMCP.XII     CONTAINS  10 WORDS         C
              PRT[P1MIX,9]:=5;  %SET FOR GETSPACE                       02328500
              "8OUT OF","4 MEM..", %80                                  02345760
                   IF PRT[P1MIX,9] = 5 THEN  %EOJ DONT EXPAND           24327000
                   BEGIN MIX:=0; BELOW:=TRUE; GO TO AGAIN;              24328000
                   END;  %SPACE IS GOT BELOW FENCE IF EOJ               24329000
                   IF COUNT[MIX] = CHUNKMAX THEN                        24330000
                   IF (BELOW:=BELOW+2) GTR 5 THEN                       24331000
                   BEGIN                                                24332000
                        TERMINATE(MIX&80[CTF]);                         24333000
                   END ELSE GO TO SLEAP;                                24350000
$#PATCH NUMBER 26 FOR TSSMCP.XII      CONTAINS  2 CARD         C
              ACTDATE:=WEEKDAY:=0;                                      44241150
$VOID                                                                   44242002
$#PATCH NUMBER  28 FOR TSSMCP.XII      CONTAINS 44  CARDS      I
                   DSZE~IF P(M[P(DUP)+1],TOP) THEN P ELSE P.[8:10],     02222200
                   TOG~(N=7), Q~[B[N]], A);                             02223000
      IF I=(-7) THEN BEGIN  R4~R5;  R5~R6;  END;                        19155100
            FIRST~(((56|UL+OF)|512|ABS(COBOL)+2)|64+12)|64+10;          37225000
            IF COBOL>0 AND (FIB[13].[22:1] OR TYPE=10) THEN             38024100
                          &P(FLAG(FIB[19-ABS(3|COBOL)]),XCH)[CTC];      38044000
      IF COBOL<0 THEN   % ADJUST UPPER BOUND FOR COBOL 68               38049200
         BEGIN  MASK ~ (IF IO AND NOT FIB[13].[22:1]                    38049300
                   THEN HEADER[7]                                       38049400
                   ELSE  (((HEADER[9] | HEADER[1]) DIV                  38049500
                            HEADER[0].[42:6]) | HEADER[0].[30:12]) - 1);38049600
         IF FIB[3]=0 OR FIB[3]>MASK THEN FIB[3]~MASK; %LESSOR OF 2 EVILS38049700
         END;                                                           38049800
           IF COBOL<1 THEN     % ALGOL OR COBOL 68                      38052000
              FOR MASK ~ 0 STEP 1 UNTIL NBUFS-1 DO                      38053000
              IF COBOL THEN M[M[ALPHA+MASK] INX NOT 2] ~ NOT 0          38053500
                        ELSE M[ALPHA+MASK]~P(DUP,LOD)&1[27:47:1];       38054000
              BEGIN  IF COBOL>0 THEN                                    38062000
                        IF NOT (FIB7=0 OR FIB[13].[22:1]) THEN          38062500
                        BEGIN  FIB7 ~ FIB7 - 1;                         38063000
                               OPTIONAL ~ NBUFS - 1;                    38063500
                        END ELSE  OPTIONAL ~ NBUFS - 2                  38064000
                        ELSE BEGIN      % COBOL 68                      38064200
                             OPTIONAL ~ NBUFS - 1;                      38064400
                             IF DIREC THEN FIB7 ~ FIB[7] ~ FIB[3];      38064600
                             END;                                       38065000
               FORMS~((HEADER[0].[30:12]|T1)&DIREC[1:47:1])+FIB7,       38076000
                   IF COBOL<0 THEN M[M[ALPHA] INX NOT 2] ~              38082400
                      (IF FORMS}0 THEN FORMS DIV FIB[11] ELSE NOT 0);   38082500
             IF COBOL } 0 THEN          % NOT COBOL 68                  38092900
            BEGIN IF COBOL > 0 THEN              % COBOL61              38391200
                  BEGIN ACCESS ~ 4;                                     38391300
                  IF FIB[13].[10:9] = 2 THEN     % SEEK IN PROCESS      38391400
                     BEGIN COOLOFF; FIB[13].[10:9] ~ 1;  END            38391500
                  END ELSE IF FIB[17]<BLEN THEN ACCESS~4;  % COBOL68    38391600
      STATE~FIB[5];  UNLABELED~FIB[4].[2:1];                            39090000
      COBOL~(FIB[13] AND 1)&([FIB].[8:10]=22)[1:47:1];  % COBOL 60 & 68 39091100
FILLBUFFERS(FIB[16],FIB[19-3|ABS(COBOL)],NBUFS-ABS(COBOL),NBUFS);%%%%%% 39146000
IF COBOL THEN FIB[16]~(*P(DUP))&M[ALPHA][CTC]; %%%%%%%%%%%%%%%%%%%%%%%% 39147000
            IF COBOL>0 OR FIB[4].[7:1] THEN M[FIB INX NOT 1].[3:6] ~ 6  39304000
      COBOL~(FIB[13] AND 1)&([FIB].[8:10]=22)[1:47:1];  % COBOL 60 & 68 41051000
         ELSE IF JAR[P1MIX,2] < 0 THEN IF PRT[P1MIX,11].[FF] = 0 THEN   42551090
              PRT[P1MIX,11]~1 ELSE PRT[P1MIX,PRT[P1MIX,11].[FF]]~1      42551100
         ELSE                                                           42551110
$#PATCH NUMBER 29 FOR TSSMCP.XII      CONTAINS  3  CARDS       C
         REAL OBJINFO=+12;                                              14351310
          DISKWAIT(-(X1:=SPACE(30)),-30,0);                             42600850
          COUNTARRAY[28]:=DATE;                                         42600900
$#PATCH NUMBER  30  FOR TSSMCP.XII      CONTAINS  2 CARDS      C
$INCLUDE 20568061,IF B6500LOAD;                                         20568059
         LIBNO~GETESPDISK;CMM[19].[CF]~LIBNO;                           20569800
$#PATCH NUMBER  31 FOR TSSMCP.XII      CONTAINS 2 CARDS        C
$VOID                                                                   38014800
            FIB[5].[45:1]~0;                                            38045100
$#PATCH NUMBER 32  FOR TSSMCP.XII      CONTAINS  1 CARDS       C
         IF (A~GETUSERDISK((N~RESERVEDISKSIZE)&1[2:47:1]))=0 THEN       05954800
$#PATCH NUMBER 33 FOR TSSMCP.XII      CONTAINS  1 CARDS        C
              STREAM(S~S~SPACE(4));                                     07429100
$#PATCH NUMBER 34 FOR TSSMCP.XII      CONTAINS 1 CARDS         C
                   IF (R~M[T INX 10]~PETUSERDISK((S~(M[T INX 8]~        39509260
$#PATCH NUMBER 35  FOR TSSMCP.XII      CONTAINS  4 CARDS       C
               BEGIN PG:=HDR[9] AND @37;                            %RH 08099510
                    INFO:=0; WHILE (INFO:=INFO+1) LEQ PG DO IF      %RH 08099520
                    HDR[INFO+9]!0 THEN INFOTEMP:=INFOTEMP+1;        %RH 08099530
                    INFO:=(INFOTEMP|HDR[8])&4[1:43:5]; INFOTEMP:=0; %RH 08099540
$#PATCH NUMBER 36 FOR  TSSMCP.XII      CONTAINS  12 CARDS      C
         IF P2MIX=0 THEN GO TO COMINIT;                                 48019500
$INCLUDE 48081001, IF STATISTICS;                                       48079999
              PBUSY~0;                                                  48081000
              DO DO P(INI) UNTIL (P(RRR) OR RRRMECH)!READY%             48082000
                   UNTIL STATUSBIT;%                                    48083000
              TOGLE~TOGLE AND NOT STATUSMASK;                           48084000
              FORK(P(.STATUS),0,-1,128,0);                              48084100
              GO TO NOTHINGTODO;                                        48084200
 P2FAKE:                TOGLE~TOGLE OR HP2MASK;                         48085000
$VOID                                                                   48088000
$VOID                                                                   48089000
$VOID 48094001                                                          48089099
$#PATCH NUMBER  37  FOR TSSMCP.XII      CONTAINS  3  CARDS     I
              RNALL=OPTION.[15:1]#,                                     00416660
              "RNAL","L000", %15                                        00454930
              OR H[4].[4:2]!SYSNO AND NOT RNALL                         07437900
$#PATCH NUMBER 38 FOR  TSSMCP.XII      CONTAINS  6 CARDS       C
                   BEGIN                                                05660400
                   A[2]:=A[2]&T[5:18:15];% DSK ADRS OF HEADER (SM)      05660410
                   DISKWAIT(-T.[CF],30,M[T INX 10]); % SEGMENT ZERO (SM)05660420
                   A[4]:=M[T INX 2]; % ACCESS DATE (SM)                 05660430
                   FORGETSPACE(T); % (SM)                               05660440
                   END ELSE BEGIN % (SM)                                05660450
$#PATCH NUMBER 39 FOR TSSMCP.XII      CONTAINS  1 CARDS        I
              :29: DO UNTIL FALSE;             % 35 - SPECIAL INTERRUPT 46011700
$#PATCH NUMBER  40  FOR TSSMCP.XII     CONTAINS  8 CARDS       I
         DS:=4 LIT" XII"; SI:=LOC A;                                    15503000
         IF SC GEQ " " THEN;                                            15503100
         8(IF TOGGLE THEN IF SC="0" THEN SI:=SI+1 ELSE DS:=CHR ELSE     15503200
           DS:=CHR);                                                    15503300
              DS:=3 LIT"XII";                                           44204600
              SI:=LOC S; IF SC GEQ " " THEN;                            44205000
              8(IF TOGGLE THEN IF SC="0" THEN SI:=SI+1 ELSE DS:=CHR     44205050
                ELSE DS:=CHR);                                          44205100
$#PATCH NUMBER  41 FOR TSSMCP.XII      CONTAINS  2 CARDS       C
      BEGIN BLEN:=10;                                                   38256000
            FIB[18]:=(*P(DUP))&BLEN[CTC]&BLEN[CTF]&BLEN[3:33:15];       38256500
$#PATCH NUMBER 42 FOR  TSSMCP.XII      CONTAINS  5  CARDS      I
$OMIT 19212001, IF SHAREDISK;                                           19211999
                  A4[6]:=M[T+4].[16:5]+M[T+9].[9:5];                    19212000
$INCLUDE 19212061, IF SHAREDISK;                                        19212049
                  A4[6]:=0&(I:=M[T+4].[16:20]+M[T+9].[9:20])[43:28:5] & 19212050
                    I[38:33:5]&I[33:38:5]&I[28:43:5];                   19212060
$# PATCH NUMBER 43 FOR TSSMCP.XII      CONTAINS  165  CARDS    I
        IF LUN{22 AND LUN}20 OR (LUN{18 AND                             02278000
        (P(M[TOPIO].[3:5],DUP)=22 OR P(XCH)=10))                        02278100
                   IF M[TOPIO].[3:5]=22 THEN                            02285100
                        PBCOUNT~PBCOUNT+(((NB[J] EQV "PBD    ")=NOT 0   06058760
                             OR (NB[J] EQV "PUD    ")=NOT 0)            06058770
DEFINE PRINTWAIT(PRINTWAIT1)=PRINTORPUNCHWAIT(PRINTWAIT1,0)#;           08254000
BOOLEAN PROCEDURE PRINTORPUNCHWAIT(Q,PNCH);VALUE Q,PNCH;REAL Q,PNCH;    08255000
         BEGIN IF PNCH THEN IF LABELTABLE[V~22]!0 THEN V~0 ELSE ELSE    08257500
              IF LABELTABLE[V~20]!0 THEN                                08257600
              IF (((MULTITABLE[I] EQV "PBTMCP ")=NOT 0 AND V!22) OR     08261500
                  ((MULTITABLE[I] EQV "PUTMCP ")=NOT 0 AND V=22)) THEN  08261600
                        IF(((D[Q] EQV"PBD    ")=NOT 0) AND (V!22)) OR   08269500
                          (((D[Q] EQV"PUD    ")=NOT 0) AND (V=22)) THEN 08269550
                   PRINTORPUNCHWAIT~TRUE;                               08277100
               IF MULTITABLE[U]!"PBTMCP " AND MULTITABLE[U]!"PUTMCP "   08293500
               THEN                                                     08293600
               BEGIN; STREAM(BUFF);                                     08294000
               DS~29 LIT "NOT PRINT/PUNCH BACK-UP TAPE~";               08294100
               IF PRINTORPUNCHWAIT(-U,MULTITABLE[U]="PUTMCP ") THEN     08295500
               GO F ELSE GO T ELSE GO S                                 08295600
                IF(I~DIRECTORYSEARCH("PBD    ",U&1[CTC],5))=0 THEN      08296400
                IF(I~DIRECTORYSEARCH("PUD    ",U&1[CTC],5))=0 THEN GO S 08296500
                 ELSE I.[3:1]~1;                                        08296550
              FORGETSPACE(I);IF PRINTORPUNCHWAIT(U.[6:24],I.[3:1]) THEN 08297000
                   IF I:=HEADER[5].[3:1] THEN HEADER[5].[3:1]:=0;       08709100
                   ENTERUSERFILE(IF I THEN "PUD    " ELSE "PBD    ",    08712000
                                 HEADER[6],HEADER INX 0-1);             08712100
                   HEADER[5].[3:1]:=I; %SET PUNCH BK UP TOG             08712200
 NAME              INREC;DEFINE CONS="PBD    "#;DEFINE PUNS="PUD    "#; 13003000
        P(DIRECTORYSEARCH(-(IF V!22 THEN CONS ELSE PUNS),               13006820
          CURRPBNAME,13),DEL);                                          13006830
        P(DIRECTORYSEARCH(-(IF V!22 THEN CONS ELSE PUNS),               13006840
          CURRPBNAME,7),DEL);                                           13006850
    END;                                                                13006860
                        SI~LOC U; SI~SI+7; IF SC!"C" THEN DS~CHR ELSE   13007300
                        BEGIN DI~DI-2; DS~3LIT"CPA"; END;               13007325
     BEGIN IF V=22 THEN GO WHY; LOC:=SPACE(15);                         13044020
                   IF (HEADER:=DIRECTORYSEARCH(IF V!22 THEN CONS        13062000
                       ELSE PUNS,CURRPBNAME,3))=0                       13062100
                             FORGETSPACE(DIRECTORYSEARCH(IF V!22        13098125
                             THEN CONS ELSE PUNS,CURRPBNAME,13));       13098130
                        BEGIN IF V!22 THEN                              13098300
                        IF (HEADER:=DIRECTORYSEARCH(IF V!22 THEN        13112000
                            CONS ELSE PUNS,U,3))=0 THEN GO QUIT;        13112050
 QUIT:             IF V!22 THEN P(WAITIO(@4000100000,0,V),DEL);         13132000
                   PBCOUNT~PBCOUNT+((((A EQV"PBD    ")=NOT 0) OR        14599900
                           ((A EQV"PUD    ")=NOT 0)) AND (B.[CF]=1));   14599910
    OUR: STREAM(A~"LP":B~"MT",C~"DK",D~"CP",KTR);                       16111000
              SI~SI-2; DI~DI+6; IF 2 SC=DC THEN TALLY~5;                16117200
         PBCOUNT~PBCOUNT-((((A EQV"PBD    ")=NOT 0) OR                  18442000
                ((A EQV"PUD    ")=NOT 0)) AND (B.[CF]=1));              18443000
         IF (TYPE~SCAN)=PERIO THEN BEGIN TPNO~0; GO EXIT END;           20461000
         IF TYPE=BACK THEN                                              20461100
         TPNO~20 ELSE                                                   20461200
         BEGIN TPNO~21; IF SCAN!BACK THEN GO ERROR END;                 20461300
         IF SCAN=PERIO THEN GO ERROR;                                   20461400
         IF (TYPE~SCAN)=PERIO THEN                                      20461500
              TPNO~TPNO+4 ELSE                                          20461600
         IF TYPE=DISK THEN                                              20461700
              TPNO~TPNO+2 ELSE                                          20461800
         IF TYPE!TAPE THEN GO ERROR;                                    20461900
              IF TYPE!PERIO THEN GO NEXT ELSE GO EXIT;                  20461950
              PBCOUNT~PBCOUNT-((((CMM[0] EQV "PBD    ")=NOT 0) OR       20579720
                   ((CMM[0] EQV "PUD    ")=NOT 0)) AND (CMM[1].[CF]=1)) 20579730
                   +((((CMM[2] EQV "PBD    ")=NOT 0) OR                 20579740
                   ((CMM[2] EQV "PUD    ")=NOT 0)) AND (CMM[3].[CF]=1));20579750
                   IF (MULTITABLE[U]="PBTMCP " OR                       22188000
                       MULTITABLE[U]="PUTMCP ") AND                     22188100
                        STREAM(A~TINU[U],PN~MULTITABLE[U]="PUTMCP ",    22191000
                               AREA);                                   22191100
                                       PN(DS~3 LIT"#CP"; JUMP OUT TO L);22192100
                                       DS~3 LIT"#LP"; L:                22192200
                                       DS~12 LIT" BACK-UP ON ";         22193000
         PUNCH: STARTIO(U); IF UNIT[U].[15:3]=0 THEN                    22213500
              IF PRINTWAIT(-U) THEN GO TO COMMON; GO TO SCRATCH;        22213600
$VOID                                                                   22217000
BEGIN INTEGER GOTL,GOTT,GOTB,GOTP,GOTC;                                 37003000
      DEFINE PNTOG=(TYPE=0 OR TYPE GEQ 20)#;                            37007100
      REAL SUBROUTINE PUNCH;%                                           37019100
      BEGIN IF LABELTABLE[22]=0 THEN BEGIN U~22;P(1) END ELSE P(0);     37019200
            PUNCH~GOTC~P;                                               37019300
      END PUNCH;                                                        37019400
      BEGIN IF NOT(GOTL OR GOTB OR GOTC) THEN%                          37021000
      BEGIN IF NOT(GOTL OR GOTC) THEN                                   37039000
      IF TYPE>1 AND TYPE!4 AND TYPE!6 AND TYPE<15 THEN GO SOMEWHERE;    37046020
 ROUND:  IF TYPE=1 OR TYPE=4 OR (TYPE>16 AND TYPE<19) THEN              37046040
         IF TYPE=0 OR (TYPE>20 AND TYPE) THEN                           37046070
         IF PUNCH THEN BEGIN KIND~6; GO X END;                          37046075
         IF TYPE=4 OR TYPE=6 OR TYPE=16 OR TYPE=18 OR                   37046080
         (TYPE GEQ 20 AND NOT TYPE.[46:1]) THEN                         37046090
         BEGIN T1~0; T2~IF TYPE GEQ 20 THEN "PUTMCP " ELSE "PBTMCP ";   37046100
               T3~@122212342546447;                                     37046110
                             A~REEL,B~DATE,C~CYCLE,D~0,PN~TYPE GEQ 20,  37046192
                             T~T1-2);                                   37046194
                             PN(D~DI; DI~DI-6; DS~2LIT"UT"; DI~D);      37046205
                             PN(D~DI; DI~DI-14; DS~2LIT"UT"; DI~D);     37046212
      IF (TYPE GEQ 15 AND TYPE LEQ 18) OR TYPE GEQ 22 THEN              37046360
              M[T1+5]~MID&(TYPE GEQ 22)[3:47:1]; % PNCH BK UP TOG       37046630
 W3:     FILEMESS("#.. ..."&(IF TYPE=6 OR TYPE=20 THEN "   " ELSE       37046680
                  (IF PNTOG THEN "CP" ELSE "LP"))[12:36:12]             37046690
                  &(IF TYPE<2 THEN "   " ELSE IF TYPE GEQ 20 THEN       37046700
                  "PUT" ELSE "PBT")[30:30:18],                          37046710
                  (IF TYPE<2 THEN "RQD    " ELSE " MT RQD"),MID,FID,    37046720
         COMPLEXSLEEP(((IF (TYPE!6 AND TYPE!20) THEN IF PNTOG THEN      37046760
                  PUNCH ELSE PRINTER ELSE 0) OR REPLY[P1MIX]            37046770
                  >0 OR(IF TYPE>1 THEN BKUPTAPE OR MAGTAPE ELSE 0) OR   37046780
         IF NOT(GOTB OR GOTT OR GOTL OR GOTC) THEN                      37046820
              IF PNTOG THEN BEGIN U~REPLY[P1MIX].[FF]; GO CP END;       37046855
         IF GOTB THEN GO THERE ELSE IF GOTT THEN GO CLAIMT ELSE         37046940
         IF GOTC THEN KIND~6 ELSE KIND~1;                               37046950
CP:   TYPE~IF U=1 THEN 21 ELSE IF U=3 THEN 20 ELSE                      37058000
           IF U=5 THEN 0 ELSE 22; REPLY[P1MIX]~0; GO ROUND;             37059000
$VOID 37069001                                                          37060000
                   FILEMESS(P(OPNMESS OR OPENK,(IF TYPE GEQ 20 OR       38242000
                   TYPE=0 THEN "PUD...." ELSE "PBD....")&M[U+6]         38242100
      BEGIN TYPE~IF (TYPE!0 AND TYPE<20) THEN 15 ELSE 22;               38265000
      BEGIN TYPE~IF (TYPE!0 AND TYPE<20) THEN 6 ELSE 20;                38285000
            BEGIN IF TYPE GEQ 20 THEN                                   38325100
            BEGIN M[M[ALPHA-2] INX 4]:=FLAG(NABS(JAR[P1MIX,0]));        38325200
                  M[M[ALPHA-2] INX 5]:=FLAG(JAR[P1MIX,1]&17[1:43:5]);   38325300
                  STREAM(A:=[M[M[ALPHA-2] INX 6]]);                     38325400
                  BEGIN DS:=15 LIT" PUNCH BACK-UP "; DS:=LIT"%";        38325500
                        2(DS:=8 LIT"%%%%%%%%");                         38325600
                  END;                                                  38325700
            END ELSE                                                    38325800
                  M[M[ALPHA-2] INX 3]:=T1;                              38330000
            END;                                                        38330100
                  M[M[ALPHA-2] INX 1]:=MFID;                            38331000
      LABEL EOF,PBD,PUD;%                                               38548000
      REAL TYPE=+30;                                                    38562100
         BEGIN M[ALPHA].[FF]~@60020; IF TYPE<20 THEN CKBKUP;            38583000
      BEGIN IF TYPE<20 THEN CKBKUP;                                     38591100
            M[ALPHA]~(*P(DUP))&2[18:45:3]&M[ALPHA-2][8:8:10];           38592000
            IF I:=TYPE>20 THEN M[T+5].[3:1]:=0;                         38607100
            ENTERUSERFILE(IF I THEN P(PUD) ELSE P(PBD),R~M[T+6],T-1);   38608000
            IF PRINTORPUNCHWAIT(R.[6:24],I) THEN                        38609500
                 T~DIRECTORYSEARCH(IF I THEN P(PUD) ELSE P(PBD),        38610500
                   R&1[CTC],5);                                         38610600
            FILEMESS((IF I THEN P(PUD) ELSE P(PBD))&R[24:6:24],         38618000
                    " REL:  ",MID,FID,0,0,0);                           38619000
            FOR T:=1 STEP 1 UNTIL R.[CF] DO                             38620000
            FORGETSPACE(DIRECTORYSEARCH(IF I THEN P(PUD) ELSE P(PBD),   38621000
                        R&T[CTC],14));                                  38621100
            STREAM(PN:=TYPE GEQ 20,D:=0,I);                             38626000
            BEGIN                                                       38626100
                 DS:=24LIT" LABEL  0PBTMCP 0BACK-UP";                   38626200
                 PN(D:=DI; DI:=DI-14; DS:=2LIT"UT"; DI:=D);             38626300
                 20(DS:=2LIT"  ");                                      38626400
            END;                                                        38626500
$VOID                                                                   38627000
     I:=IF AUTOPRINT THEN NOT PRINTORPUNCHWAIT(-U,TYPE GEQ 20)          38639000
        AND 1 ELSE 1;                                                   38639100
PUD:::   "PUD    ";                                                     38644500
                  &TINU[IF (KIND=7 OR KIND=12) THEN IF TYPE<20          39034000
                        THEN 20 ELSE 22 ELSE                            39034050
      IF TYPE=19 THEN TYPE:=14 ELSE IF TYPE>25 THEN GO TO DCN;          39092050
      IF (TYPE=0 AND NOT IO) OR TYPE GEQ 20 THEN                        39092080
      BEGIN IF USEPBD THEN TYPE~22; GO LOOKOUT END;                     39092090
                                            PBCOUNT~PBCOUNT+((((DDD[478 40309100
                                            -2|I]EQV"PBD    ")=NOT 0)   40309150
                                            OR((DDD[478-2|I]EQV"PUD    "40309200
                                            )=NOT 0))AND(DDD[479-2|I].  40309250
                                            [CF]=1));                   40309300
      REAL TYPE;                                                        41017300
BKUP: TYPE:=FPB[FNUM+3].[43:5]; BACKCLOSE(0);                           41144000
$#PATCH NUMBER 44 FOR TSSMCP.XII      CONTAINS  5 CARDS        I
$VOID                                                                   06056900
              IF P1MIX=0 THEN                                           06378200
              BEGIN CLICK~CLOCK+P(RTR)+1800;%WAIT 30 SECS.              06378210
                    SLEEP(0,0);                                         06378220
              END ELSE                                                  06378230
$#PATCH NUMBER 45 FOR TSSMCP.XII      CONTAINS 24 CARDS        I
              FAST      = 94#,                                          20247900
              "FAST   ",94,                                             20286400
              IF CN>NEUP.NEUF THEN GO TO INCSC;                         20568611
              ELSE IF CN=SLOW THEN CMM[19]~P(DUP,LOD) OR M ELSE         20568630
              IF CN=FAST THEN CMM[19]~-CMM[19] ELSE GO TO INCSC;        20568640
         LIBNO~ABS(CMM[19]);                                            20572000
          EXT,OK,WY,                                                    28010100
    COMMON ~ IF COMMON.[9:6]!0 THEN -COMMON.[9:6] OR M ELSE             28201200
             IF COMMON.[1:1] THEN 1 OR M ELSE                           28201300
             IF COMMON.[2:1] THEN 2 OR M ELSE 0;                        28201400
OK:                IF (H[9+W]~PETUSERDISK(-H[8],COMMON))<1 THEN         28310000
                   BEGIN                                                28311000
$ VOID 28311200                                                         28311100
WY:                     LBMESS(-X[J],X[J+1],".#NO US","ER DISK"," ",    28311200
                               0,TINU[U]);                              28311300
                        REPLY[P1MIX] ~ -@04101220;                      28311400
                        COMPLEXSLEEP(REPLY[P1MIX]}0 OR DSED             28311500
                                     OR PRT[P1MIX,@25]=5);              28311600
                        IF NOT WHYSLEEP(@4101220) THEN GO TO WY;        28311700
                        IF REPLY[P1MIX]=4 THEN GO TO OK;                28311800
                        IF DSED THEN ABORT;                             28311900
                        IF  REPLY[P1MIX]=8 THEN                         28311910
                        BEGIN COMMON ~ COMMON AND NOT M; GO TO OK; END; 28311920
                        PRT[P1MIX,@25] ~ 0;                             28311930
$#PATCH NUMBER 46 FOR TSSMCP.XII      CONTAINS 14 CARDS        I
              REAL LUN,TM,REEL,T;                                       02661000
              STREAM(A~PRNTABLE[LUN].[30:18],T~[T],L~LBL+6);            02664000
              BEGIN DI~DI+5; SI~LOC A; DS~5DEC; SI~SI-8; DI~T;          02664100
                    DS~8DEC; DI~DI-7; DS~6FILL;               END;      02665000
                   FILEMESS(" OUT"&TINU[LUN][6:30:18],T,M[LBL+1],       02668500
         STREAM (S~PRNTABLE[U].[18:30],T~[T]);                          28091100
         BEGIN SI~LOC S; DS~8DEC; DI~DI-7; DS~6FILL; END;               28091200
         IF OPNMESS THEN FILEMESS(" IN "&TINU[U][6:30:18],T,0,MID,1,0,0)28092000
                       IF U GEQ 16 THEN T2 ~0 ELSE                      38118010
                        STREAM(S~PRNTABLE[U].[30:18],D~[T2]);%          38118100
                        BEGIN SI ~ LOC S; DS ~ 8 DEC;         %         38118200
                              DI ~ DI-7; DS ~ 6 FILL;         %         38118300
                        END;                                  %         38118400
                           &TINU[U][6:30:18],T2,MFID,FID,REEL,%         38120000
$#PATCH NUMBER 47 FOR TSSMCP.XII      CONTAINS  5 CARDS        I
            IF DIREC AND NOT FIB[16].[22:1] THEN                        38180000
              FOR CNTCTL~DIREC STEP 1 UNTIL 2 DO% DIREC = 0 OR 1    %DB 38198010
              P(WAITIO(@4740000005&(NOT DIREC)[22:47:1],@377,U),DEL);%DB38198020
                  IF NOT REW THEN                                       38752000
                       IF NOT UNLABELED THEN                            38754100
$#PATCH NUMBER 48 FOR TSSMCP.XII     CONTAINS 104 CARDS        I
              TWXOUT(MESSAGEHOLDER INX 1,230,1 OR M,ABS(SPOWORD));      02119200
              DS:=LIT"""; DS:=8 LIT " LOST!-*";                         02778000
         TWXOUT(A,37,-0,V.[FF]);                                        02783000
                   TWXOUT([T].[CF],8,1&3[1:46:2],LL);                   03203500
              BEGIN DS:=LIT"!"; DS:=LIT MARK; END;                      03298700
              TWXOUT(X+1,2,-0,LOGLINE);                                 03298800
              DS:=15 LIT"CONTINUE TYPING";                              03315400
              TWXOUT(A2+1,15,1,LOGLINE);                                03315600
         TWXOUT(0,0,1,STA)                                              03554800
$VOID 03555101                                                          03555000
              TWXOUT(B,63,0&3[1:46:2],I);                               03595620
              DS:=11 LIT"PLEASE WAIT";                                  03620500
              TWXOUT(K+1,12,1,STA);                                     03620700
              TWXOUT([T].[CF],6,-0,LOGLINE);                            05150000
              TWXOUT(B,60,1&3[1:46:2],I);                               05743000
              DS:=29 LIT"-*!PLEASE CALL BACK LATER!-*$";                05768500
              TWXOUT(T,29,-0,LINE);                                     05769000
         BEGIN REAL C,T,W,LAS;                                          06503000
              LAS:=TYPE.[2:1];                                          06504500
                        IF SC="~" THEN GO TO E;                         06520500
                   STREAM(Q:=0,C,ADR,T:LAS,G:=C,W,N:=IF NUM GTR 63 THEN 06527000
                          CI:=CI+LAS; GO TO L2;                         06537500
                   L2:    N:=CI; CI:=W;                                 06540000
                   STREAM(Q:=0,C,ADR,T:LAS,G:=0,W,N:=IF NUM GTR 63 THEN 06544000
                             CI:=CI+LAS; GO TO L2;                      06550500
                      L2:    N:=CI; CI:=W;                              06556000
              IF TYPE.[1:1] THEN                                        06563000
              BEGIN STREAM(T);                                          06563200
                   DS:=LIT LEFTARROW;                                   06563400
              END ELSE                                                  06563600
         STREAM(Y:=Q:=0,ADR:=N:=ADR,D:=B:);                             06590800
         NUM:=NUM - ADR.[30:3]&(ADR-N)[30:33:15];                       06592700
         BEGIN STREAM(D:=Q:=B,X:=(NUM!X):LAS:=(NOT TYPE).[2:1],ADR);    06593200
                     X(SI:=ADR;                                         06593320
                       IF SC=LEFTARROW THEN                             06593340
                       BEGIN CI:=CI+LAS; GO TO L;                       06593360
                             TALLY:=0; X:=TALLY;                        06593380
                       END ELSE                                         06593400
                       DS:=LIT"!");                                     06593420
                     D:=DI;                                             06593440
              STREAM(DISC:=8,ADR,D,Z,X,Y:=Q:LAS:=(NOT TYPE).[2:1],N,N1, 06594200
                     A:=@1660140206557501,B:=@2072350304000000,         06594250
                     C:=0,C1:=0,C2:=0,C3:=0);                           06594300
                     IF SC="~" THEN                                     06598400
                     BEGIN CI:=CI+LAS; JUMP OUT TO LA;                  06598420
                           X(DS:=LIT MARK; SI:=SI+1; JUMP OUT TO L);    06598440
                           GO TO CM;                                    06598460
                    END;                                                06598480
           CM:       Y(DS:=LIT"!"; TALLY:=0; Y:=TALLY);                 06599100
              STREAM(DISC:=8,ADR,D,Z,Y:LAS:=TYPE.[2:1],N,N1,X,          06600800
                   CR:=TYPE.[FF]-1,LF:=TYPE.[CF]-(P(DUP)!0),            06600850
                   RLF:=(TYPE=0),Q);                                    06600900
                 N(IF SC = LEFTARROW THEN                               06601100
                   BEGIN                                                06601200
                        LAS(Z:=DI; DISC:=TALLY; JUMP OUT 2 TO L3);      06601300
                        DS:=LIT MARK; SI:=SI+1;                         06601400
                        GO SETZ;                                        06601450
                   END ELSE                                             06601500
                   BEGIN IF SC="!" THEN DS:=LIT"!";                     06601600
                        IF SC=" " THEN DS:=CHR ELSE                     06601650
                        BEGIN DS:=CHR;                                  06601700
                   SETZ:     Z:=DI;                                     06601750
                        END;                                            06601800
                   END);                                                06601850
      STREAM(Y:=0,ADR:=N:=ADR,D:=B:);                                   06610700
      NUM:=NUM - ADR.[30:3]&(ADR-N)[30:33:15];                          06612100
      STREAM(D:=Q:=B,X:=(NUM!0):LAS:=(NOT TYPE).[2:1],ADR);             06612400
             X(SI:=ADR;                                                 06612520
               IF SC=LEFTARROW THEN                                     06612540
               BEGIN CI:=CI+LAS; GO TO L;                               06612560
                     TALLY:=0; X:=TALLY;                                06612580
               END ELSE                                                 06612600
               DS:=LIT"!");                                             06612620
             D:=DI;                                                     06612640
       STREAM(DISC:=8,ADR,D,Z,X:LAS:=(NOT TYPE).[2:1],N,N1,C1:=0,C3:=0);06613400
             IF SC = LEFTARROW THEN                                     06614300
             BEGIN CI:=CI+LAS; JUMP OUT TO LA;                          06614320
                   X(DS:=LIT MARK); GO TO L0;                           06614340
             END;                                                       06614360
        STREAM(DISC:=8,ADR,D,Z,Y:LAS:=TYPE.[2:1],N,N1,X,CR:=TYPE.[FF]-1,06617000
              BEGIN                                                     06617400
                   LAS(Z:=DI; DISC:=TALLY; JUMP OUT 2 TO L3);           06617500
                   SI:=SI+1; DS:=LIT MARK;                              06617550
                   GO TO SETZ;                                          06617600
              END ELSE                                                  06617650
              BEGIN IF SC="!" THEN DS:=LIT"!";                          06617700
                   IF SC=" " THEN DS:=CHR ELSE                          06617750
                   BEGIN DS:=CHR;                                       06617800
              SETZ:     Z:=DI;                                          06617850
                   END;                                                 06617900
              END);                                                     06617950
                        DS:=3 LIT"!-*";                                 09134000
              DS:=17 LIT " AS ALTERNATE SPO";                           13271000
         TWXOUT(BUFF,37,1,LAST);                                        13274000
              BEGIN DS:=LIT"!"; DS:=LIT MARK END;                       16027300
              TWXOUT(MIX,2,-0,ABS(SPOWORD));                            16027320
         IF FALSE THEN                                                  19554800
    CM11:IF NOT DAT[P1MIX].NDSABLE THEN R5:=R5 OR MEMORY;               19554900
         TWXOUT(A7.[CF],R6,R5,LOGLINE);                                 19555000
         TWXOUT(T,8,0&1[CTF]&1[2:47:1],R6);                             19559200
$VOID 20088191                                                          20088170
              IF IOD LSS 32 THEN TWXOUT(0,0,1,LOGLINE);                 20088200
         BEGIN TWXOUT(T,100,1 OR M,ABS(SPOWORD));                       20607550
                        TWXOUT([S].[CF],8,1&3[1:46:2],N);               21103500
$#PATCH NO 49 FOR TSSMCP.XII CONTAINS 2586 CARDS.
$INCLUDE 00003751, IF DCP;                                              00003099
 ARRAY DCPARRAY[*];                   % QUEUES FOR DCP-MCP INTERFACE    00003100
 REAL DCPARR = DCPARRAY;              % DCP EXPECTS THIS TO BE AT @202  00003150
 DEFINE  REQUESTQ  = DCPARRAY[0]#,    % MCP TO DCP REQUESTS             00003200
         RESULTQ   = DCPARRAY[1]#,    % RESULTS FROM THE DCP            00003250
         DCPSPACEQ = DCPARRAY[2]#,    % QUEUE OF AREAS FOR DCP USE      00003300
         SPACEQ    = DCPARRAY[5]#,                                      00003350
         MYREQUEST = DCPARRAY[7]#;    % USED TO BUILD REQUEST QUEUE     00003400
 DEFINE  INITIATEDCP  = P(SCI)#,                                        00003450
         SETATTENTION = P(SAN)#,                                        00003500
         HALTDCP      = P(SAN,SCS)#,                                    00003550
         STAMAX       = 20#,                                            00003600
         LMAX         = STAMAX#,                                        00003650
         REMOTE       = DCPTOG#,                                        00003700
         DCPDSK       = (DIRECTORYTOP-5)#;                              00003750
$OMIT 00004801, IF DCP;                                                 00004499
$OMIT 00008001, IF DCP;                                                 00007999
$INCLUDE 00008003, IF DCP;                                              00008001
LABEL GOGOGO,NORMALERROR,P2BUSY,TIMER,EXTERNAL,WAKEUP,                  00008002
$INCLUDE 00081421, IF DCP;                                              00081419
       ,DCPTOG         = TOGLE.[31:1]# % ON WHEN DCP IS RUNNING         00081420
       ,DCPLOAD        = TOGLE.[30:1]#, DCPLOADMASK   = @400000#        00081430
$OMIT 00272001, IF DCP;                                                 00271999
$INCLUDE 00272501, IF DCP;                                              00272499
                   @401210000242347,  COMMENT DCP;%                     00272500
$OMIT 00298181, IF DCP;                                                 00297099
    DIRECTLINE     = [2:1]#,    % DIRECT CONNECT FLAG (ALSO SCHEDBUSY)  00297160
$OMIT 00298441, IF DCP;                                                 00298359
$INCLUDE 00298455, IF DCP;                                              00298449
    DISCIT         = [10:1]#,    % IF ON, DISCONNECT WHEN OUTPUT IS FINI00298450
    NAKSTA[NAKSTA1]= STATABLE[NAKSTA1].[11:1]#,  % STA IS BUFFERED      00298452
    DIRECTLINE     = [12:1]#,    % DIRECT CONNECTION FLAG               00298454
$OMIT 00298641, IF DCP;                                                 00298579
$INCLUDE 00298663, IF DCP;                                              00298645
    OUTPUTANKING   = [18:1]#,    % ON IF STUFF IN TANKS                 00298646
    ERRORS         = [19:1]#,    % DCPERR IS FORKED FOR THIS STATION    00298648
%                    [20:1]      % MARKS A SCHEDULE STATION             00298650
    REINITIALIZED  = [21:1]#,    % RESTARTING AFTER NAK (ALSO SCHEDBUSY)00298652
%                    [22:1]#,    % USED FOR INITIALIZATION AND RECALLSTA00298654
%                    [23:1]#,    % NOT USED                             00298656
%                    [24:8]      % LINE NUMBER                          00298658
%                    [32:8]      % DCP-S STATION NUMBER                 00298660
%                    [40:8]      % LINK FOR MULTI-STA LINES & SCHED STAS00298662
    ENDOFSTATABLE  = #;                                                 00298670
$OMIT 00299301, IF DCP;                                                 00298679
$INCLUDE 00301901, IF DCP;                                              00301499
DEFINE QDCP(QDCP1,QDCP2,QDCP3)=                                         00301500
    BEGIN M[(QDCP3:=GETAREA(0))+1]:=0&STATABLE[QDCP2][24:24:16]         00301600
                                    &QDCP1[1:41:7];                     00301700
         DCPQ(QDCP3);                                                   00301800
   END#;                                                                00301900
$OMIT 00302001, IF DCP;                                                 00301999
$OMIT 00319401, IF DCP;                                                 00319199
         SCH[SCH1]      = (SCH1[4].[3:3]=SCHED)#,                       00319200
         SCHEDBUSY[SCHEDBUSY1]=LINETABLE[SCHEDBUSY1].[2:1]#,            00319250
         SCHEDLINE[SCHEDLINE1]=(LINEDISC[SCHEDLINE1]=SCHED)#,           00319300
         TANKNDIAL      = 27:42:6 #,                                    00319350
         INTERROGATEMASK= @0400004000000000#,                           00319400
$VOID                                                                   00320500
$INCLUDE 00324451, IF DCP;                                              00324099
         SEQARRAY       = TNAOG#,      % USED FOR SCHEDULE LINES        00324100
         SCH[SCH1]      = (SCH1[0].[20:1])#,                            00324120
         SCHEDLINE[SCHEDLINE1]=(STATABLE[SCHEDLINE1].[20:1])#,          00324150
         SCHEDBUSY[SCHEDBUSY1]=STATABLE[SCHEDBUSY1].[21:1]#,            00324200
         SCHEND[SCHEND1]= TNAOG[SCHEND1].[2:1]#,                        00324250
         DCPCELL        = M[15]#,                                       00324300
         TANKNDIAL      = 19:41:7 #,                                    00324350
         TEXTLENGTH     = [40:8]#,                                      00324400
         QMASK          = @40000000#,                                   00324450
$OMIT 00327566, IF DCP;                                                 00327534
    TANKL           = [14:5]#,   % NEXT SEG TO DETANK                   00327545
    TANKN           = [27:6]#,                                          00327565
$INCLUDE 00327596, IF DCP;                                              00327569
    DCPMESSAGES     = [12:2]#,    % NUMBER OF PIECES PASSED TO DCP      00327570
%                     [13:5]      % NOT USED                            00327575
    NEXTPIECE       = [18:1]#,    % NEXT 112 CHAR PIECE TO DETANK       00327580
    TANKN           = [19:7]#,    % NUMBER OF SEGMENTS ON DISK          00327585
      SOUSE         =  19:7 #,    %                                     00327590
    TANKL           = [26:7]#,    % RELATIVE ADDRESS OF OLDEST SEG      00327595
 REAL TANKADDRESS;      % BASE ADDRESS FOR OUTPUT TANKS                 00327900
$INCLUDE 00328996, IF DCP;                                              00328299
 REAL LINETABLE;        % TRANSLATES LINE/STA INTO INTERNAL STA NUM     00328300
 DEFINE                 % CLASSES FOR REQUESTS AND RESULTS              00328350
    NULL                      = 0#,                                     00328355
    SETCLUSTERMASK            = 1#,                                     00328360
    ENTERCONTROLMODE          = 2#,                                     00328365
    ADAPTERWRITE              = 3#,                                     00328370
    ACTIVEINTERROGATE         = 4#,                                     00328375
    PASSIVEINTERROGATE        = 5#,                                     00328380
    ENTERNORMALMODE           = 6#,                                     00328385
    REINITIALIZEDOUTPUT       = 7#,                                     00328390
    REINITIALIZEDINPUT        = 8#,                                     00328395
    REINITIALIZEDENABLEDINPUT = 9#,                                     00328400
    OUTPUT                    = 10#,                                    00328405
    INPUT                     = 11#,                                    00328410
    ENABLEINPUT               = 12#,                                    00328415
    RESETSTATIONCHARACTERS    = 13#,                                    00328420
    SETADAPTERTYPE            = 14#,                                    00328425
    INTERROGATESTATUS         = 15#,                                    00328430
    SETSTATIONREADY           = 16#,                                    00328435
    SETTRANSMISSIONNUMBER     = 17#,                                    00328440
    SETSTATIONCHARACTERS      = 18#,                                    00328445
    SETSEQUENCEMODE           = 19#,                                    00328450
    ABORTED                   = 20#,                                    00328455
    ENABLEDINPUT              = 21#,                                    00328460
    LOOKFORRING               = 22#,                                    00328465
    BREAKREQUEST              = 23#,                                    00328470
    DISCONNECT                = 24#,                                    00328475
    SETSTATIONTYPE            = 25#,                                    00328480
    SETSTATIONADDRESS         = 26#,                                    00328485
    RECALLSTATION             = 27#,                                    00328490
    ANSWER                    = 28#,                                    00328495
                        % RESULTS                                       00328550
    IGNORED                   = 0#,                                     00328555
    CLASSINVALID              = 1#,                                     00328560
    KEYINVALID                = 2#,                                     00328565
    LINEINVALID               = 3#,                                     00328570
    STATIONINVALID            = 4#,                                     00328575
    FUNCTIONUNDEFINED         = 5#,                                     00328580
    CLUSTERMASKINVALID        = 6#,                                     00328585
    VARIANTINVALID            = 7#,                                     00328590
    TEXTINVALID               = 8#,                                     00328595
    TRANSMITABORTED           = 9#,                                     00328600
    RECEIVEABORTED            = 10#,                                    00328605
    LOGICABORTED              = 11#,                                    00328610
    DISCONNECTABORTED         = 12#,                                    00328615
    SWITCHABORTED             = 13#,                                    00328620
    ADAPTORFAULT              = 14#,                                    00328625
    STATUSERROR               = 15#,                                    00328630
    MESSAGERROR               = 16#,                                    00328635
    TEXTREINITIALIZED         = 17#,                                    00328640
    OKRESULT                  = 18#,                                    00328645
    REQUESTCONTINUED          = 19#,                                    00328650
    INCOMPLETEREQUEST         = 20#,                                    00328655
    STATUSPRESENT             = 21#,                                    00328660
                        % STATUS FLAGS                                  00328705
    CONNECTED                 = [24:1]#,                                00328710
    LINEBUSY                  = [25:1]#,                                00328715
    LINESUSPENDED             = [26:1]#,                                00328720
    LINESWITCHING             = [27:1]#,                                00328725
    CONTROL                   = [28:1]#,                                00328730
    LINERINGING               = [29:1]#,                                00328735
                        % ERROR FLAGS                                   00328750
    TIMEOUTFLAG               = [47:1]#,                                00328755
    STOPBIT                   = [46:1]#,                                00328760
    BYTEOVERFLOW              = [45:1]#,                                00328765
    BREAKINPUT                = [44:1]#,                                00328770
    DISCON                    = [43:1]#,                                00328775
    BROKEN                    = [42:1]#,                                00328780
    PARITYFLAG                = [41:1]#,                                00328785
    BCCCHECK                  = [40:1]#,                                00328790
    ADDRESSFLAG               = [39:1]#,                                00328795
    TRANSMISSIONUMBERERROR    = [38:1]#,                                00328800
    FORMATERROR               = [37:1]#,                                00328805
    NAK                       = [36:1]#,                                00328810
    SPECIALCHARACTER          = [35:1]#,                                00328815
    WRU                       = [34:1]#,                                00328820
    SEQUENCENUMBEROVERFLOW    = [33:1]#,                                00328825
    TOBEACKNOWLEDGED          = [32:1]#,                                00328830
    NAKONSELECT               = [31:1]#,                                00328835
    ENDOFBUFFER               = [30:1]#,                                00328840
    CARRIERLOST               = [29:1]#,                                00328845
    LASTDEF                   = #;                                      00328995
 ARRAY TNAOG[*];        % TRANSMISSION NUMBERS AND OTHER GOODIES        00329000
$INCLUDE 00329701, IF DCP;                                              00329049
 DEFINE                                                                 00329050
%                    [1:1]       % NOT USED                             00329100
%                    [2:1]       % TANK HALF FOR NAK POINTER            00329150
%                    [3:7]       % CHARACTER COUNT FOR NAK POINTER      00329200
%                    [10:1]      % PIECE DCP IS WORKING ON              00329250
    DCPSEG         = [11:7]#,    % SEGMENT CONTAINING DCP-S PIECE       00329300
    DETANK         = [18:7]#,    % SEGMENT TO DETANK NEXT               00329400
%                    [25:8]      % NUM OF CHARS NOT GIVEN TO HARRY      00329500
%                    [33:15]     % HEAD OF INPUT QUEUE OR LOCKLINE QUEUE00329600
$VOID                                                                   00329699
    ENDOFTNAOG     = #;                                                 00329700
$OMIT 00330901, IF TWXONLY OR DCP;                                      00329799
$OMIT 00413001, IF DCP;                                                 00412999
$OMIT 00429101, IF DCP;                                                 00429099
$INCLUDE 00450501, IF DCP;                                              00450499
              "NOT ","USED",                                            00450500
$OMIT 00451001, IF DCP;                                                 00450999
$ INCLUDE 00500501, IF DCP;                                             00499999
PROCEDURE INITIALIZEDCP; FORWARD;                                       00500000
PROCEDURE DCPHANDLER; FORWARD;                                          00500100
PROCEDURE NEWLINE(R); VALUE R; REAL R; FORWARD;                         00500200
PROCEDURE DCPERR(T);  VALUE T; REAL T; FORWARD;                         00500300
PROCEDURE DCPFILECHANGER(BUFF); VALUE BUFF; REAL BUFF; FORWARD;         00500400
$INCLUDE 01163071, IF DCP;                                              01163049
  SAVE PROCEDURE DCPQ(ADDR);  VALUE ADDR; REAL ADDR; FORWARD;           01163050
  PROCEDURE DCWRITE(ADR,STA,NUM,FLAGS);                                 01163060
    VALUE ADR,STA,NUM,FLAGS;  REAL ADR,STA,NUM,FLAGS;  FORWARD;         01163070
$OMIT 01163411, IF DCP;                                                 01163099
  PROCEDURE BLASTREAD(LINE,C); VALUE LINE,C; REAL LINE,C; FORWARD;      01163410
$VOID                                                                   01164400
$OMIT 01250001, IF DCP;                                                 01165999
$OMIT 02786001, IF DCP;                                                 02739999
 DEFINE BIGUNMIN = 4#;                                                  03001100
              IF (BIGUNS:=BIGUNS-1) LSS BIGUNMIN THEN                   03038000
 PROCEDURE LOGOUT; FORWARD;                                             03070000
$OMIT 03080301, IF DCP;                                                 03070999
 REAL PROCEDURE INPUTSCAN(MODE,SOURCE,DEST,NUM,FLAGS);                  03071000
      VALUE      NUM,FLAGS;                                             03072000
      REAL       MODE,SOURCE,DEST,NUM,FLAGS;                            03073000
         FORWARD;                                                       03074000
 REAL PROCEDURE OUTRAN980(ADR,NUM,TYPE,LCC,B);                          03075000
      VALUE     ADR,NUM,TYPE,LCC;                                       03076000
      REAL      ADR,NUM,TYPE,LCC,B;                                     03077000
$INCLUDE 03080801, IF DCP;                                              03080399
 REAL PROCEDURE OUTRAN(ADR,NUM,TYPE,B);                                 03080400
      VALUE ADR,NUM,TYPE;                                               03080500
      REAL  ADR,NUM,TYPE,B;                                             03080600
         FORWARD;                                                       03080700
 PROCEDURE GIVEAWAY(A,N);  VALUE A,N;  REAL A,N;  FORWARD;              03080800
$VOID                                                                   03127090
$OMIT 03127201, IF DCP;                                                 03127098
$OMIT 03127101, IF TWXONLY;                                             03127099
              LABEL BYEBYE;                                             03127100
              REAL OOP;                                                 03127200
$INCLUDE 03127501, IF DCP;                                              03127499
              LABEL WRITEIT,AGAIN;                                      03127500
              REAL A,B,L,N,T,C,D;                                       03128000
              M[A]:=0;                                                  03131500
              IF SCHEDLINE[LL] THEN                                     03134150
              L:=T.TANKL+D;                                             03141000
$VOID                                                                   03141090
$OMIT 03142001, IF DCP OR TWXONLY;                                      03141099
$OMIT 03148141, IF TWXONLY OR DCP;                                      03148139
%   AT THIS POINT DATA-COMM DROPPINGS COHERE TO FORM A MIGHTY EXTRUSION 03150000
$INCLUDE 03162501, IF DCP;                                              03150499
              IF (NUM:=OUTRAN(ADR,NUM,TYPE,B)).[2:1] THEN               03150500
                STATABLE[LL].DISCIT:=1;                                 03151000
%                                                                       03151010
%   DISCIT MEANS THAT THE STATION WILL BE LOGGED OFF AS SOON AS         03151020
%   THERE IS NO MORE OUTPUT.                                            03151030
%                                                                       03151040
%   OUTPUT IS WRITTEN DIRECTLY IF FEWER THAN 2 OUTPUT REQUESTS          03151050
%   ARE QUEUED TO THE DCP, OTHERWISE IT IS TANKED. ALL OUTPUT           03151060
%   TO NAKABLE STATIONS IS TANKED FOR POSSIBLE RETRY. OUTPUT            03151070
%   FROM CANDE OR THE MCP IS WRITTEN 1 MESSAGE/SEGMENT. OUTPUT          03151080
%   FROM OBJECT JOBS IS PACKED INTO AN ARRAY GOTTEN BY SELECTRUN,       03151090
%   232 CHARACTERS PER SEGMENT.                                         03151100
%                                                                       03151110
              IF NOT TANKING THEN                                       03151500
              BEGIN IF T.DCPMESSAGES LEQ 1 THEN                         03152000
                   IF NOT STATABLE[LL].ERRORS THEN                      03152100
                   BEGIN IF NOT AREARDY THEN SLEEP([TOGLE],AREARDYMASK);03152500
                        DCWRITE(B,LL,NUM,1);                            03153000
                        IF NAKSTA[LL] THEN ELSE GO EXIT;                03153500
                        TNAOG[LL]:=(*P(DUP))&(P(DUP).DETANK+1)[18:41:7];03153600
                        GO WRITEIT;                                     03153800
                   END;                                                 03154000
                   TANKING:=TRUE;                                       03154100
              END;                                                      03154200
              IF A=0 OR STATABLE[LL].SWAPPED THEN                       03154500
    WRITEIT:  BEGIN M[A:=B-1]:=NUM;                                     03155000
                   RITE;                                                03155500
              END ELSE                                                  03156000
              BEGIN                                                     03157000
                   C:=IF 232-(D:=M[A]) GTR NUM THEN NUM ELSE 232-D;     03157200
                   T:=B;                                                03157300
    AGAIN:         STREAM(T: N1:=D.[45:3], N3:=C,                       03157500
                          N2:=P(DUP).[40:2], DEST:=A+1+D.[39:6]);       03158000
                   BEGIN DI:=DI+N1; SI:=T;                              03158500
                        N2(DS:=32 CHR; DS:=32 CHR);                     03159000
                        DS:=N3 CHR;                                     03159500
                        T:=SI;                                          03159600
                   END;                                                 03160000
                   T:=P;                                                03160100
                   M[A]:=(*P(DUP))&(D:=D+C)[CTC];                       03160200
                   IF D=232 THEN                                        03160500
                   BEGIN RITE;                                          03161000
                        IF (C:=NUM-C) GTR 0 THEN                        03161500
                        BEGIN D:=0;                                     03161600
                             GO AGAIN;                                  03161700
                        END;                                            03161800
                   END;                                                 03162000
              END;                                                      03162500
$VOID                                                                   03169990
$OMIT 03195901, IF DCP;                                                 03169998
$OMIT 03170701, IF TWXONLY;                                             03169999
$INCLUDE 03196501, IF DCP;                                              03196499
              TANKS[LL]:=NABS(*P(DUP))&(P(DUP).[SOUSE]+N)[19:41:7];     03196500
$OMIT 03197001, IF DCP;                                                 03196999
$OMIT 03202801, IF DCP;                                                 03202599
              IF (LL:=LL.[40:8]) LEQ LMAX THEN                          03202600
              IF LL=0 OR SCHEDLINE[LL] THEN P(XIT);                     03202700
$OMIT 03202801, IF TWXONLY;                                             03202799
              IF STATABLE[LL].STATIONTYPE=TWX THEN                      03202800
$INCLUDE 03203001, IF DCP;                                              03202899
              IF (LL:=LL.[40:8])=0 OR SCHEDLINE[LL] THEN P(XIT);        03202900
              IF NOT NAKSTA[LL] THEN                                    03203000
$VOID 03203051                                                          03203010
$VOID                                                                   03207590
$OMIT 03207601, IF TWXONLY OR DCP;                                      03207599
                   DISKWAIT(T.[CF],30,GLOMSIZE|LL+((T.TANKL+T.TANKN)    03208000
                        AND NOT GLOMSIZE)+TANKADDRESS);                 03209000
$OMIT 03210101, IF DCP;                                                 03210099
              TANKS[LL]:=NABS(*P(DUP))&(P(DUP).[SOUSE]+T)[TANKNDIAL];   03212000
$OMIT 03241901, IF DCP;                                                 03216999
VALUE LINE;  REAL LINE;                                                 03246050
BEGIN REAL RCW=+0;                                                      03246100
    REAL MIX,T,I,STA,S;                                                 03246120
    ARRAY A[*];                                                         03246140
$VOID                                                                   03246150
    LABEL EXIT,BSB,NRDONE;                                              03246160
$INCLUDE 03247041, IF DCP;                                              03246179
    REAL LSTAT,J=A;                                                     03246180
    LABEL DD,AGAIN;                                                     03246200
    DEFINE LSTATUS[LSTATUS1] = LSTAT.[45:3]#,                           03246220
           BROKEN            = 2#,                                      03246240
           DISCON            = 6#;                                      03246260
%                                                                       03246280
    SUBROUTINE SETUPREQUEST;                                            03246300
    BEGIN IF T!0 THEN DCPQ(T);                                          03246320
         M[T:=GETAREA(0)]:=0&1[5:47:1];                                 03246340
    END;                                                                03246360
%                                                                       03246370
%   THE PARAMETER LINE IS USED BY QUITTER AS FOLLOWS:                   03246372
%     1:1 = 0 THEN 40:8 IS THE STATION NUMBER AND 33:7 IS THE           03246374
%             TYPE AS FOLLOWS: 2 = BROKEN, 3 = WRU,                     03246376
%             6 = NORMAL LOG-OFF, 14 = LOGOFF OF INVALID STA.           03246378
%     1:1 = 1 THEN 24:8 IS THE NUMBER OF A LINE TO BE DISCONNECTED.     03246380
%             QUITTER LOOPS LOGGING OFF ALL STATIONS ON THE LINE.       03246382
%   TO LOG OFF A STATION, WE DO A RECALLSTATION, QUEUE AN EVENT         03246384
%   TO CANDE, THEN MARK THE TANK WITH A BYE. AFTER THE RECALL IS        03246386
%   COMPLETE (BIT 22:1 OF STATABLE IS TURNED ON), WE DELINK THE         03246388
%   STATION FROM STATABLE AND RESET IT FOR THE NEXT USER.               03246390
%                                                                       03246392
    IF LINE LSS 0 THEN                % DISCONNECT ALL STATIONS.        03246400
    BEGIN STREAM(S:=(LINETABLE+LINE.[24:6])&LINE[30:30:2], D:=[STA]);   03246420
         BEGIN SI:=S; DI:=DI+6; DS:=2 CHR END;                          03246440
$VOID                                                                   03246450
         IF STA=0 THEN                                                  03246460
         BEGIN SETUPREQUEST;                                            03246480
              M[T+1]:=0&DISCONNECT[1:41:7]&LINE[24:24:8];               03246490
              SETUPREQUEST;                                             03246500
              M[T+1]:=0&LOOKFORRING[1:41:7]&LINE[24:24:8];              03246520
              DCPQ(T);                                                  03246540
              GO TO EXIT;                                               03246560
         END;                                                           03246580
         LSTAT:=DISCON;                                                 03246590
    END ELSE                                                            03246600
    BEGIN LSTAT:=LINE.[33:7];                                           03246620
         STA:=LINE.[40:8];                                              03246640
    END;                                                                03246660
AGAIN:                                                                  03246680
    IF (S:=STATABLE[STA]).[17:1] THEN GO TO EXIT;                       03246700
    STATABLE[STA]:=S&1[17:47:1];                                        03246720
    IF LSTAT=DISCON THEN                                                03246740
$VOID                                                                   03246750
    BEGIN IF S.ERRORS THEN SLEEP([STATABLE[STA]],0&1[19:47:1]);         03246760
         M[(T:=GETAREA(0))+1]:=0&S[24:24:16]&RECALLSTATION[1:41:7];     03246780
         DCPQ(T);                                                       03246800
    END;                                                                03246820
    IF CANDYINX!0 AND (STA!ABS(SPOWORD) OR LSTAT=DISCON) THEN           03246840
    BEGIN M[T:=GETAREA(0)]:=0&(STA&LSTAT[37:45:3])[CTF];                03246860
         QUEVENT(T,CANDYINX);                                           03246880
         IF LSTAT=DISCON THEN                                           03246900
         BEGIN M[T:=GETAREA(0)]:=0&STA[10:40:8];                        03246920
              M[T+1]:=3;                                                03246940
              M[T+2]:=0&1[35:47:1];                                     03246960
              STREAM(T:=T+3); DS:=3 LIT"BYE";                           03246980
              GIVEAWAY(T,4);                                            03247000
    END  END;                                                           03247020
    MIX:=STATABLE[STA].MIXNR;                                           03247040
$OMIT 03253801, IF DCP;                                                 03247049
              IF TANKFUL[STA] OR (I:=INPUTANK[STA]).INPUTREADY THEN     03254400
                   IF NOT I.[1:1] THEN SLEEP([INPUTANK[STA]],-0);       03255000
$OMIT 03257101, IF DCP;                                                 03255599
$INCLUDE 03257181, IF DCP;                                              03257119
                        ;                                               03257120
                        M[T+1]:=1;  M[T+2]:=0&1[35:47:1];               03257140
                        STREAM(T:=T+3); DS:=LIT MARK;                   03257160
                        GIVEAWAY(T,4);                                  03257180
    IF STA=ABS(SPOWORD) AND LSTATUS[LINE]=BROKEN THEN                   03257720
    BEGIN                                                               03257740
$INCLUDE 03257761, IF DCP;                                              03257759
         STATABLE[STA].OUTPUTANKING:=1;                                 03257760
         GO TO BSB;                                                     03257780
    END;                                                                03257800
$INCLUDE 03260601, IF DCP;                                              03260599
    TNAOG[STA]:=(*P(DUP))&0[1:1:24];                                    03260600
$OMIT 03261755, IF TWXONLY OR DCP;                                      03260695
$OMIT 03262051, IF DCP;                                                 03261894
$INCLUDE 03262561, IF DCP;                                              03262519
         M[(I:=GETAREA(0))+1]:=0&1[23:47:1]&SETSTATIONREADY[1:41:7]     03262520
              &STATABLE[STA][24:24:16];                                 03262540
         DCPQ(I);                                                       03262560
         QUITN[STA]:=0;                                                 03262580
$OMIT 03263701, IF DCP;                                                 03263699
$INCLUDE 03263801, IF DCP;                                              03263799
         A[0]:=A[1]:=0;                                                 03263800
$VOID                                                                   03263995
         FORGETAREA(1,A.[CF]-1);                                        03264000
$OMIT 03264601, IF DCP;                                                 03264148
$OMIT 03264151, IF TWXONLY;                                             03264149
         IF LINEDISC[LINE]=MULTI THEN SEQARRAY[STA].[3:1]:=1;           03264150
$INCLUDE 03265381, IF DCP;                                              03264699
         IF LSTAT=DISCON THEN                                           03264700
         IF NOT STATABLE[STA].[22:1] THEN                               03264720
           SLEEP([STATABLE[STA]],0&1[22:47:1]);                         03264740
$VOID                                                                   03264750
         STREAM(STA,S~S.[40:8]: D~(LINETABLE+S.[24:6])&S[30:30:2]);     03264760
         BEGIN SI:=LOC STA; SI:=SI+6; TALLY:=1;                         03264780
              IF 2 SC=DC THEN                                           03264800
              BEGIN SI:=LOC S; SI:=SI+6; TALLY:=0;                      03264820
                   DI:=DI-2; DS:=2 CHR;                                 03264840
              END;                                                      03264860
              STA:=TALLY;                                               03264880
              SI:=D; DI:=LOC S;                                         03264900
              DI:=DI+6; DS:=2 CHR;                                      03264920
         END;                                                           03264940
         IF MIX:=((I:=P)=0) THEN P(DEL) ELSE                            03264960
         IF P THEN                                                      03264980
         BEGIN WHILE (J:=STATABLE[I].[40:8])!STA AND J!0 DO I:=J;       03265000
              IF J!0 THEN STATABLE[I].[40:8]:=S;                        03265020
         END;                                                           03265040
$VOID 03265051                                                          03265045
         IF LSTAT=DISCON THEN                                           03265060
         BEGIN I:=(T:=0)&S[24:24:16];                                   03265080
              IF MIX THEN                                               03265100
              BEGIN SETUPREQUEST;                                       03265120
                   M[T+1]:=I&DISCONNECT[1:41:7];                        03265140
                   SETUPREQUEST;                                        03265160
                   M[T+1]:=I&LOOKFORRING[1:41:7];                       03265180
              END;                                                      03265200
              SETUPREQUEST;                                             03265220
              M[T+1]:=I&RESETSTATIONCHARACTERS[1:41:7];                 03265240
              SETUPREQUEST;                                             03265260
              M[T+1]:=I&ENABLEINPUT[1:41:7]&1[23:47:1];                 03265280
              DCPQ(T);                                                  03265300
         END;                                                           03265320
         IF (MIX:=S.MIXNR)!0 AND CANDYINX!MIX THEN                      03265340
$VOID                                                                   03265350
           SLEEP([STATABLE[STA]],@20000000000);    % DISCONNECTING      03265360
         STATABLE[STA]:=0;                                              03265380
         IF STA=ABS(SPOWORD) THEN SPOSET(NABS(0),STA);                  03265400
    END;                                                                03265450
NRDONE:                                                                 03265500
$OMIT 03265751, IF DCP;                                                 03265549
    LINETABLE[LINE]:=(*P(DUP))&(                                        03265550
$OMIT 03265601, IF TWXONLY;                                             03265599
      IF P(DUP).LINEDIS=CONTENTION THEN WAITINGENQ ELSE                 03265600
      IDL)[21:43:5];                                                    03265650
    ENTEREADYQ(STA);    % XMIT NEW DATA, START A POLL FOR MULTIPOINT    03265700
    QUITN[STA]:=0;                                                      03265750
EXIT:                                                                   03265800
$INCLUDE 03265901, IF DCP;                                              03265849
    IF LINE LSS 0 THEN                                                  03265850
    IF (STA:=S.[40:8])!0 THEN GO AGAIN;                                 03265900
    KILL([RCW] INX NOT 2);                                              03265950
$OMIT 03291001, IF DCP;                                                 03266999
    REAL N=-6,D,T,X,A1,A2,A3,SORC,N1,N2;                                03292800
$OMIT 03292901, IF DCP;                                                 03292899
    REAL MODE,FLAGS;                                                    03292900
$OMIT 03294701, IF DCP;                                                 03294599
            OR (MODE AND NOT M[A1].[2:1]) THEN   % SEG IS EMPTY         03294700
$INCLUDE 03294901, IF DCP;                                              03294799
         IF (A2:=M[A1]).[FF] LEQ (A3:=SORC-A1)                          03294800
            OR (A2.MESSEND AND NOT A2.[2:1]) THEN     % SEG IS EMPTY    03294900
$OMIT 03295601, IF TWXONLY OR DCP;                                      03295599
$INCLUDE 03295801, IF TWXONLY OR DCP;                                   03295799
$INCLUDE 03296701, IF DCP;                                              03296699
    IF SCHEDLINE[T:=LOGLINE.[40:8]] THEN                                03296700
$OMIT 03296901, IF DCP;                                                 03296799
$INCLUDE 03297701, IF DCP;                                              03297699
         IF NOT PAPERTAPE[T] THEN                                       03297700
$OMIT 03298201, IF DCP;                                                 03297798
$INCLUDE 03301301, IF DCP;                                              03301299
    SORC:=(A1:=SPACE(30))+X.[2:8];                                      03301300
$OMIT 03302201, IF DCP;                                                 03301399
$INCLUDE 03306601, IF DCP;                                              03302999
    X:=IF (N1:=M[SORC].[CF]) GTR N2 THEN N2 ELSE N1;                    03303000
    IF SORC=A1 THEN                                                     03303200
    IF (A3:=M[A1].[10:8]) ! 0 THEN                                      03303400
    IF (D:=P(D.[30:3]&D[30:33:15]-A3,DUP).[30:15]&P(XCH)[30:45:3]).[CF] 03303600
       LSS A.[CF] THEN D:=A.[CF];                                       03303800
%                                                                       03304000
    STREAM(L:=X.[37:6]:N:=X.[43:5],U:=(DAT[P1MIX] AND M[A1]).[7:1],     03304200
           SORC:=SORC+1,D:=A2:=D);                                      03304400
    BEGIN SI:=SORC;                                                     03304600
         L(DS:=32 CHR); DS:=N CHR;                                      03304800
         U(DS:=LIT"~");                                                 03305000
         L:=DI;                                                         03305200
    END;                                                                03305400
    SORC:=SORC+(N1+15).[40:5];                                          03305600
    N1:=(D:=P).[30:3]&D[30:33:15]-A2.[30:3]&A2[30:33:15];               03305800
    UPDATEINPUTANK;                                                     03306000
    IF NOT M[A1].MESSEND THEN                                           03306200
    IF (N2:=N2-N1) GTR 0 THEN                                           03306400
    BEGIN SORC:=A1;                                                     03306600
$OMIT 03309401, IF DCP;                                                 03306999
$OMIT 03310601, IF TWXONLY OR DCP;                                      03310599
$INCLUDE 03312101, IF DCP;                                              03311799
              IF M[A1].[2:1] THEN SORC:=A1+(M[A1].[CF]+15).[40:5];      03311800
              UPDATEINPUTANK;                                           03312000
         END;                                                           03312100
$OMIT 03313801, IF DCP;                                                 03312199
$OMIT 03316001, IF DCP;                                                 03314798
$INCLUDE 03316601, IF DCP;                                              03316199
    BEGIN M[(A2:=GETAREA(0))+1] := 0&ENABLEINPUT[1:41:7]&1[23:47:1]     03316200
              &STATABLE[T][24:24:16];                                   03316400
         DCPQ(A2);                                                      03316600
         INPUTANK[T].SLOWDOWN:=0;                                       03316800
    END;                                                                03317000
    FORGETSPACE(A1);                                                    03317200
$OMIT 03317401, IF DCP;                                                 03317399
    FORGETSPACE(A2);                                                    03317400
END COMM13;                                                             03317600
%                                                                       03333950
       LABEL LOOPEND;                                                   03380200
$INCLUDE 03385011, IF DCP;                                              03385004
                   U:=0;                                                03385005
                   WHILE (U:=STATABLE[U].[40:8])!0 DO                   03385010
$OMIT 03385026, IF DCP;                                                 03385014
                   FOR U:=1 STEP 1 UNTIL STAMAX DO                      03385015
                   IF SCHEDLINE[U] THEN                                 03385020
                   BEGIN IF STATABLE[U].DIALEDUP THEN                   03385025
                        IF SEQARRAY[U] LSS 0 THEN                       03385030
                        BEGIN SEQARRAY[U]:=ABS(*P(DUP));                03385040
                             FORK(P(.SCHEDIO),(-U),0,128,0);            03385050
                             GO TO LOOPEND;                             03385060
                        END;                                            03385070
$OMIT 03385081, IF DCP;                                                 03385079
                   END ELSE GO TO LOOPEND;                              03385080
    LOOPEND:                                                            03385090
$OMIT 03502001, IF DCP;                                                 03416999
$OMIT 03555901, IF DCP;                                                 03549999
        BEGIN REAL I,J,L,V,B;                                           03575000
              REAL RCW=+0;                                              03576000
              ARRAY A=B[*];                                             03577000
$INCLUDE 03588501, IF DCP;                                              03577999
              REAL C;                                                   03578000
              LABEL EXIT;                                               03578250
%                                                                       03578500
%   M[K+1].[CF] IS THE STATION NUMBER. IF 0, IT MEANS THAT ALL          03578550
%   INTERNAL STATION NUMBERS ARE ACTIVE SO WE INFORM THE USER AND,      03578600
%   IF HE IS THE ONLY ONE ON THE LINE, DISCONNECT HIM.                  03578650
%                                                                       03578700
              L:=M[K+2];                                                03578750
              IF (I:=M[K+1].[CF])=0 THEN                                03579000
              BEGIN                                                     03579250
                   M[B:=GETAREA(1)]:=0&5[3:45:3];                       03579500
                   M[B+1]:=0&OUTPUT[1:41:7]&L[24:24:16]                 03579750
                     &44[40:40:8];                                      03580000
                   STREAM(D:=B+3);                                      03580250
                   BEGIN DS:=18 LIT"!-!*SYSTEM FULL - ";                03580500
                        DS:=26 LIT"PLEASE CALL BACK LATER!-!*";         03580750
                   END;                                                 03581000
                   DCPQ(B);                                             03581250
                   CLICK:=CLOCK+P(RTR)+240;      % WAIT FOR MESSAGE     03581500
                   SLEEP(0,0);                   % THEN CHECK LINE TABLE03581750
                   STREAM(N:=L.[30:2]:D:=LINETABLE+L.[24:6]);           03582000
                   BEGIN SI:=D; SI:=SI+N; SI:=SI+N;                     03582250
                        DI:=LOC N; DI:=DI+6; DS:=2 CHR;                 03582500
                   END;                                                 03582750
                   IF (V:=P)=0 THEN         % NO OTHER STATIONS, DISCNCT03583000
                   BEGIN M[B:=GETAREA(0)]:=0&1[5:47:1];                 03583250
                        M[B+1]:=0&L[24:24:16]&DISCONNECT[1:41:7];       03583500
                        DCPQ(B);                                        03583750
                        M[B:=GETAREA(0)]:=0&1[5:47:1];                  03584000
                        M[B+1]:=0&L[24:24:16]&LOOKFORRING[1:41:7];      03584250
                        DCPQ(B);                                        03584500
                   END;                                                 03584750
                   GO TO EXIT;                                          03585000
              END;                                                      03585500
              B:=SPACE(30);                                             03586000
              DISKWAIT(-B,30,TNAOG[0]+(V:=(J:=L.[24:8]+1) DIV 30));     03586500
              V:=M[B+J-30|V];                                           03587000
              FORGETSPACE(B);                                           03587500
              STATABLE[I]:=(*P(DUP))&V[11:21:2];                        03588000
              B:=GETAREA(1)+1;                                          03588500
$OMIT 03595621, IF DCP;                                                 03588899
$INCLUDE 03595666, IF DCP;                                              03595664
                   M[V+2]:=0;     % ALL STAS LOOK LIKE TWX WITH DCP     03595665
$OMIT 03595671, IF DCP;                                                 03595669
              END ELSE                                                  03595690
$INCLUDE 03595701, IF DCP;                                              03595699
              IF L.[1:7]!INPUT AND L.[1:7]!ENABLEDINPUT THEN            03595700
              BEGIN STREAM(B);                                          03595750
                   DS:=27 LIT"CANDE IS DOWN...PLEASE WAIT";             03595800
                   TWXOUT(B,27,1,I);                                    03595900
              END;                                                      03596000
$OMIT 03596301, IF DCP;                                                 03596299
$INCLUDE 03596351, IF DCP;                                              03596349
              A[0]:=STATABLE[I];                                        03596350
$INCLUDE 03597001, IF DCP;                                              03596999
    EXIT:                                                               03597000
$OMIT 03691001, IF DCP;                                                 03607999
                   STATABLE[STA].OUTPUTANKING:=(T.TANKN ! 0) OR         03676500
$INCLUDE 03691501, IF DCP;                                              03691499
  PROCEDURE GIVEAWAY(A,N);  VALUE A,N;  REAL A,N;                       03691500
$INCLUDE 03697501, IF DCP;                                              03697499
         M[A].[4:4]:=N;                                                 03697500
$OMIT 03999501, IF DCP;                                                 03709999
$OMIT 04129101, IF DCP;                                                 04129049
              IF SCHEDLINE[T:=LOGLINE.[40:8]] THEN GO INFORMONLY;       05049100
$OMIT 05050001, IF DCP;                                                 05049999
              STREAM(X:=IF A[3] THEN " OFF " ELSE " ON  ", T, N:=[A[1]],05060000
$INCLUDE 05060601, IF DCP;                                              05060499
                   L:=STATABLE[T].[24:8], S:=STATABLE[T].[32:8],        05060500
                   J:=SCHEDLINE[T], ON:=A[3]-1,                         05060600
                   B);                                                  05061000
                        SI:=LOC X; SI:=SI+3; DS:=5 CHR;                 05063000
                        DS:=3 DEC;                                      05064000
$INCLUDE 05071701, IF DCP;                                              05071099
                        CI:=CI+ON; GO TO EXIT;                          05071100
                        J(DS:=6 LIT" SCHED"; JUMP OUT TO EXIT);         05071150
                        SI:=LOC L; X:=DI; DI:=LOC N;                    05071200
                        DS:=3 DEC; DS:=3 DEC; DS:=LIT"A";               05071250
                        SI:=LOC N; DI:=X; DS:=LIT" ";                   05071300
                   LL:  IF SC="0" THEN                                  05071350
                        BEGIN SI:=SI+1;                                 05071400
                             IF SC!"0" THEN DS:=2 CHR ELSE              05071450
                             BEGIN SI:=SI+1; DS:=CHR END                05071500
                        END ELSE DS:=3 CHR;                             05071550
                        IF SC GEQ "0" THEN                              05071600
                        BEGIN DS:=LIT"/"; GO TO LL END;                 05071650
                   EXIT:                                                05071700
                        DS:=LIT"~";                                     05071750
              IF SCHEDLINE[T] THEN                                      05073100
$INCLUDE 05148001, IF DCP;                                              05146999
 L8:          IF INPUTANK[I:=LOGLINE.[40:8]].[FF]!0 THEN                05147000
                COMPLEXSLEEP(INPUTANK[I].[FF]=0);                       05147200
              INPUTANK[I].[FF]:=J:=GETSPACE(65,0,1)+2;                  05147400
              M[J-1]:=IOMASK;                                           05147600
              M[J]:=0&(J+2)[CTF];                                       05147800
              M[J+2]:=0&(NOT 0)[CTF];                                   05148000
$OMIT 05150001, IF DCP;                                                 05148999
         BEGIN IF SCHEDLINE[J] THEN ELSE GO TO RETURN;                  05187000
         END UNTIL (J:=J+1) GEQ STAMAX;                                 05211000
              BEGIN A[2]:=                                              05660200
$INCLUDE 05660221, IF DCP;                                              05660219
                        NABS                     %DCP FLAG TO CANDE     05660220
                        (M[T+10]);                                      05660240
                   FORGETSPACE(T);                                      05660260
              END ELSE GO TO NOFILE;                                    05660280
$OMIT 05676001, IF DCP;                                                 05671999
$VOID 05676001                                                          05672000
                   IF SCH(A) THEN                                       05680950
$OMIT 05684001, IF DCP;                                                 05683999
$INCLUDE 05684101, IF DCP;                                              05684099
                        M[T+1]:=A[1]; M[T+2]:=0;                        05684100
$INCLUDE 05707501, IF DCP;                                              05707499
              IF (T:=DIRECTORYSEARCH("SYSDCP "                          05707500
$OMIT 05708001, IF DCP;                                                 05707999
              IF (T:=DIRECTORYSEARCH("SYSDCP"                           05708000
$OMIT 05770501, IF DCP;                                                 05719999
           IF SCH(A) THEN                                               05729010
    LABEL STRM;                                                         05850310
$INCLUDE 05850391, IF DCP;                                              05850319
    LABEL FIND1,FIND2,RDY;                                              05850320
    ARRAY A=H1[*];                                                      05850330
    SUBROUTINE SYSDISKER;                                               05850340
    BEGIN A:=IOQUE&SPACE(10)[CTC];                                      05850350
         SYSDISKIO(3,-LL,A);                                            05850360
         A[0]:=IF TYPE THEN 0 ELSE STATABLE[LL];                        05850370
         A[1]:=A[2]:=A[3]:=0;                                           05850375
         SYSDISKIO(0,-LL,A);                                            05850380
         FORGETSPACE(A);                                                05850385
    END;                                                                05850390
$OMIT 05857191, IF DCP;                                                 05857149
         IF NOT SCHEDLINE[LL] THEN                                      05857150
    ERROR:    BEGIN NT1:=" INVALI"; NT2:="D~     "; GO TO STRM END;     05857160
         SCHEDBUSY[LL]:=TYPE;                                           05857170
         NT1:=IF TYPE THEN " SAVED~" ELSE " READY~";                    05857180
         NT2:=0;                                                        05857190
$INCLUDE 05857471, IF DCP;                                              05857199
         IF TYPE THEN                  % SV                             05857200
         IF SCHEDLINE[LL] THEN              % SV IS ALLOWED.            05857210
         IF STATABLE[LL].DIALEDUP THEN      % STATION IS IN USE SO      05857220
         BEGIN SCHEDBUSY[LL]:=1;            % MARK IT SAVED.            05857230
              NT1:=" SAVED~"; NT2:=0;                                   05857240
         END ELSE                           % STA IS NOT IN USE SO      05857250
         BEGIN H1:=0;                       % REMOVE IT.                05857260
              DO H1:=STATABLE[NT3:=H1].[40:8] UNTIL H1=LL;              05857270
              STATABLE[NT3]:=(*P(DUP))&STATABLE[LL][40:40:8];           05857280
              STATABLE[LL]:=0;                                          05857290
              SYSDISKER;                                                05857300
              NT1:=" RETURN"; NT2:="ED~    ";                           05857310
         END ELSE GO TO ERROR                                           05857320
         ELSE                          % RY                             05857330
         IF SCHEDLINE[LL] THEN              % ALREADY SCHED SO JUST     05857340
         BEGIN SCHEDBUSY[LL]:=0;            % UN-SV IT.                 05857350
              GO TO RDY;                                                05857360
         END ELSE                                                       05857370
         BEGIN IF STATABLE[LL]!0 THEN       % STA ALREADY ACTIVE        05857380
              BEGIN                                                     05857390
    ERROR:         NT1:=" INVALI"; NT2:="D~     ";                      05857400
                   GO TO STRM;                                          05857410
              END;                                                      05857420
              STATABLE[LL]:=STATABLE[0].[CF]&17[16:43:5];               05857430
              STATABLE[0].[CF]:=LL;                                     05857440
              SYSDISKER;                                                05857450
    RDY:      NT1:=" READY~"; NT2:=0;                                   05857460
         END;                                                           05857470
    STRM:                                                               05857500
         STREAM(LL,NT1,NT2,MS:=MS:=SPACE(5));                           05857550
$OMIT 05857601, IF DCP;                                                 05857599
$INCLUDE 05857651, IF DCP;                                              05857649
         BEGIN DS:=9 LIT" STATION "; SI:=LOC LL; DS:=3 DEC;             05857650
              2(SI:=SI+1; DS:=7 CHR); DI:=DI-17; DS:=2 FILL;            05857700
$OMIT 05869901, IF DCP;                                                 05869899
$INCLUDE 05869951, IF DCP;                                              05869949
    STRT::    IF (LL:=STATABLE[LL].[40:8])=0 THEN GO TO EXITR;          05869950
              IF SCHEDBUSY[LL] THEN GO TO STRT;                         05870100
              A[0].DIALEDUP:=1; A[1]:=N1; A[2]:=T1; A[3]:=1;            05882600
$INCLUDE 05884271, IF DCP;                                              05884209
              IF SCHEDBUSY[LL] THEN                                     05884210
              BEGIN A[40]:=0;                                           05884220
                   T:=0;                                                05884230
                   DO T:=STATABLE[NT1:=T].[40:8] UNTIL T=LL;            05884240
                   STATABLE[NT1]:=(*P(DUP))&STATABLE[LL][40:40:8];      05884250
                   STATABLE[LL]:=0;                                     05884260
              END ELSE                                                  05884270
$INCLUDE 05895451, IF DCP;                                              05895449
    RDSTRT::  IF (LL:=STATABLE[LL].[40:8])=0 THEN GO TO EXIT;           05895450
$OMIT 05895501, IF DCP;                                                 05895499
    RDSTRT::  IF NOT SCHEDLINE[LL:=LL+1] THEN GO TO EXIT;               05895500
                   IF NR GEQ MR+2 THEN                                  05896800
              BEGIN T:=@1437000000000000;                               05897612
              END ELSE NUM:=ABS(NUM);                                   05897616
$INCLUDE 05898051, IF DCP;                                              05898049
                   STREAM(SS:=[A[DELTA]]:DD:=(ADR+2)&7[CTF]);           05898050
$OMIT 05898101, IF DCP;                                                 05898099
                        BEGIN DI:=DD; DI:=DI+1;                         05898400
$OMIT 05898451, IF DCP;                                                 05898449
                             DS:=CHR;                                   05898450
$INCLUDE 05898901, IF DCP;                                              05898819
                        SS:=DI;                                         05898820
                   END;                                                 05898840
                   M[ADR+1]:=P(XCH,DUP).[30:3]&(P(XCH)-ADR-3)[30:33:15];05898860
                   M[ADR+2]:=0;                                         05898880
                   GIVEAWAY(ADR,4);                                     05898900
$OMIT 05899001, IF DCP;                                                 05898949
                   END;                                                 05898950
              BEGIN STREAM(NN:=IF (T:=NUM GTR 9) THEN 9 ELSE NUM,       05899300
                     T:=IF T THEN NUM-9 ELSE 0, SS:=(A INX DELTA),      05899400
                     ADR:=ADR.[CF]);                                    05899500
                   BEGIN SI:=SS; DS:=NN WDS; T(DS:=8 LIT" ") END;       05899600
$OMIT 06619501, IF DCP;                                                 06499999
              "DC",% CHANGE CODE OR NIF FILE FOR DCP                    08168380
         STREAM(DATE:=IF (NMG:=DT.[1:1]) THEN DT ELSE DATE,R:=[Y]);     08320000
              IF NOT NMG THEN SPOUTIT(B,DATEK);                         08340000
$INCLUDE 08420601, IF DCP;                                              08420499
         IF U=30 THEN                                                   08420500
         IF DCPTOG THEN U:=32 ELSE FORK(P(.INITIALIZEDCP),0,0,0,1) ELSE 08420600
                   STREAM(S~0:K~MULTITABLE[U],T,                        08472000
$INCLUDE 08472501, IF DCP;                                              08472499
                        B~U=30,                                         08472500
                        R~RDCTABLE[U].[14:10],D~RDCTABLE[U].[24:17],    08473000
                        C~RDCTABLE[U].[41:7],A);                        08473500
                   BEGIN SI ~ LOC K;                                    08474000
$INCLUDE 08475301, IF DCP;                                              08475099
                        SI ~ SI+7;                                      08475100
                        IF SC ! "1" THEN                                08475200
                      BEGIN                                             08475300
                        DS ~ 2 DEC;                                     08478000
$INCLUDE 08478201, IF DCP;                                              08478199
                      END;                                              08478200
                        DS ~ LIT"~";                                    08478300
                   END;                                                 08478600
$INCLUDE 08578901, IF DCP;                                              08578599
              IF U=30 THEN                                              08578600
              BEGIN HALTDCP;  DCPTOG:=0;                                08578700
                   STREAM(T); DS:=11 LIT"DCP HALTED~";                  08578800
              END ELSE                                                  08578900
$OMIT 08657801, IF DCP;                                                 08657399
$INCLUDE 09312501, IF DCP;                                              09311999
         TYPE:=BUFH;                                                    09312000
         STREAM(R:=0, BUFH: A:=A INX 3);                                09312500
$OMIT 09313001, IF DCP;                                                 09312999
$INCLUDE 09321201, IF DCP;                                              09321099
         M[A+1]:=BUFH.[30:3]&BUFH[30:33:15]-TYPE.[30:3]&TYPE[30:33:15]; 09321100
         M[A+2]:=0;                                                     09321200
$INCLUDE 09326501, IF DCP;                                              09326499
    GIVEAWAY(A,4);                                                      09326500
$OMIT 09328001, IF DCP;                                                 09326999
    REAL I,MX,LM,BUFF,LINE,S,T,PRTM,ELTM,Q,Z;                           09802000
    LABEL NOONE,OK,EXIT,SPUUTIT,EGRESS,MIXUP;                           09803000
         I:=LINE;                                                       09830500
         IF NOT SCHEDLINE[LINE] THEN                                    09831000
         IF NOT STATABLE[LINE].DIALEDUP THEN                            09831500
         IF INF[1] LEQ 0 THEN GO TO NOONE ELSE                          09836500
         IF I LEQ STATIONMAX THEN                                       09841400
         IF STATABLE[I].DIALEDUP THEN                                   09841500
         IF INF[1] GTR 0 THEN GO TO OK ELSE GO TO NOONE ELSE            09842000
         IF SCHEDLINE[I] THEN                                           09842500
NOONE:        INF[1]:="NOBODY ";                                        09843500
OK:           IF GETBUFF THEN                                           09844000
              S:=SCHEDLINE[I];                                          09847060
                   STREAM(X:=Q=0, S, U:=INF[1], I,                      09849000
$INCLUDE 09849501, IF DCP;                                              09849499
                     L:=STATABLE[I].[24:8], ST:=STATABLE[I].[32:8],     09849500
                     Q, Z, M:=MX, N:=PRTM, O:=ELTM, B:=BUFF);           09850000
$INCLUDE 09854401, IF DCP;                                              09854099
                   DS:=2 LIT"-(";                                       09854100
                   S(DS:=5 LIT"SCHED"; JUMP OUT TO LL);                 09854120
                   U:=DI; DI:=LOC I;                                    09854140
                   DS:=3 DEC; DS:=3 DEC; DS:=LIT"A";                    09854160
                   SI:=LOC I; DI:=U;                                    09854180
              LL2: IF SC="0" THEN                                       09854200
                   BEGIN SI:=SI+1;                                      09854220
                        IF SC!"0" THEN DS:=2 CHR ELSE                   09854240
                        BEGIN SI:=SI+1; DS:=CHR END                     09854260
                   END ELSE DS:=3 CHR;                                  09854280
                   IF SC GEQ "0" THEN BEGIN DS:=LIT"/"; GO TO LL2 END;  09854300
              LL:  DS:=LIT")"; SI:=LOC Q;                               09854400
$OMIT 09854501, IF DCP;                                                 09854499
                   S(DS:=8 LIT"-(SCHED)");                              09854500
$INCLUDE 09958201, IF DCP;                                              09958099
         REAL STA,Y,Z;                                                  09958100
         LABEL AHEAD;                                                   09958200
         STREAM(LINE:=0, X:=0,                                          09959000
$INCLUDE 09959101, IF DCP;                                              09959099
                STA:=0, Y:=0,                                           09959100
                KTR:);                                                  09959200
         BEGIN SI:=KTR; DI:=LOC LINE;                                   09960000
              SI:=SI+1;                                                 09964000
$INCLUDE 09969501, IF DCP;                                              09969099
              IF SC="/" THEN                                            09969100
              BEGIN SI:=SI+1; DI:=LOC STA;                              09969200
                   TALLY:=1; Y:=TALLY;                                  09969300
                   GO TO L;                                             09969400
              END;                                                      09969500
              IF SC="$" THEN                                            09969600
              BEGIN SI:=SI+1; TALLY:=2; X:=TALLY; END;                  09969700
$INCLUDE 09972201, IF DCP;                                              09972199
         Y:=P;  STA:=P;                                                 09972200
         X:=P; LINE:=P;                                                 09972500
$INCLUDE 09973001, IF DCP;                                              09972999
         IF Y THEN GO AHEAD;                                            09973000
$VOID                                                                   09973099
         IF LINE!0 AND LINE LEQ LMAX THEN                               09973100
$INCLUDE 09973201, IF DCP;                                              09973199
AHEAD:                                                                  09973200
              IF SCHEDLINE[LINE] THEN                                   09975100
              BEGIN IF (X=2) THEN SCHEDBUSY[LINE]:=1;                   09975110
                   BEGIN SI:=LOC LINE; DS:=9 LIT" STATION "; DS:=3 DEC; 09975140
                        LINE:=DI; DI:=DI-3; DS:=2 FILL; DI:=LINE;       09975145
$OMIT 09976001, IF DCP;                                                 09975999
$INCLUDE 09976501, IF DCP;                                              09976399
              STREAM(X:=IF Y THEN 1 ELSE STATABLE[LINE].DIALEDUP:       09976400
                   LINE,STA,Y,BUFF);                                    09976500
$INCLUDE 09977501, IF DCP;                                              09977499
                   DS:=9 LIT" STATION ";                                09977500
$OMIT 09978001, IF DCP;                                                 09977999
                   DS:=6 LIT" LINE ";                                   09978000
                   DS:=3 DEC; BUFF:=DI; DI:=DI-3; DS:=2 FILL; DI:=BUFF; 09978300
$INCLUDE 09978601, IF DCP;                                              09978499
                   Y(DS:=LIT"/"; DS:=3 DEC;                             09978500
                     BUFF:=DI; DI:=DI-3; DS:=2 FILL; DI:=BUFF);         09978600
$OMIT 09982901, IF DCP;                                                 09982199
$INCLUDE 09983651, IF DCP;                                              09982999
                   Z:=(IF Y THEN 0&LINE[24:40:8]&STA[32:40:8] ELSE      09983000
                        0&STATABLE[LINE][24:24:16])&1[23:47:1];         09983050
                   M[STA:=GETAREA(0)]:=0&1[5:47:1];                     09983100
                   M[STA+1]:=Z&SETSTATIONREADY[1:41:7];                 09983150
                   DCPQ(STA);                                           09983200
                   IF X=2 AND NOT Y THEN                                09983250
                   BEGIN STREAM(X:=X:=SPACE(5));                        09983300
                        DS:=29 LIT"-*!PLEASE CALL BACK LATER!-*$";      09983350
                        TWXOUT(X,29,-0,LINE);                           09983400
                        FORGETSPACE(X);                                 09983450
                   END ELSE                                             09983500
                   BEGIN M[STA:=GETAREA(0)]:=0&1[5:47:1];               09983550
                        M[STA+1]:=Z&ENABLEINPUT[1:41:7];                09983600
                        DCPQ(STA);                                      09983650
              END  END;                                                 09983700
              SPOUT(BUFF);                                              09983900
              DS:=8 LIT "STATION "; SI:= LOC L;                         13267000
              L(SI:= LOC L; DS:= 8 LIT "STATION "; DS:= 2 DEC;          13279000
$OMIT 13286491, IF TWXONLY OR DCP;                                      13286454
$OMIT 13286821, IF TWXONLY OR DCP;                                      13286809
                   STATABLE[I]:=(*P(DUP))&(CANDEMIX[I]+@240)[1:39:9]    14344250
$INCLUDE 14344321, IF DCP;                                              14344259
                        &0[14:47:1]&1[16:47:1];                         14344260
                   T:=INPUTANK[I];                                      14344280
                   INPUTANK[I]:=NABS(0);                                14344300
                   IF (T:=T.[FF]) GTR 256 THEN                          14344320
$OMIT 14344501, IF DCP;                                                 14344349
                     &0[14:47:1]&1[16:47:1]                             14344350
                     &(NOT (T:=INPUTANK[I]))[13:35:1];                  14344400
                   INPUTANK[I]:=NABS(P(DUP,LOD,0,XCH))&P[35:35:1];      14344450
                   IF (T:=T.[FF]-2) GTR 0 THEN DO                       14344500
                   BEGIN IF (M[T] AND IOMASK)=0 THEN                    14344550
$OMIT 14344801, IF DCP;                                                 14344799
$INCLUDE 14344851, IF DCP;                                              14344849
                   END;                                                 14344850
$VOID 14367029                                                          14367026
$OMIT 14367033, IF DCP;                                                 14367031
$VOID                                                                   14367033
    REAL BF,I,LINE;                                                     15107500
    LABEL NOONE,EXIT,EDD,GOTIT,OK;                                      15108500
         IF (INF[0]:=STATABLE[ABS(LINE)]).DIALEDUP THEN                 15111100
         IF INF[1] GTR 0 THEN GO TO OK ELSE GO TO NOONE ELSE            15111200
         IF SCH(INF) THEN                                               15111300
              BEGIN                                                     15111400
    NOONE:    INF[1]:="NOBODY ";                                        15111500
    OK:       P(DEL,1);                                                 15111600
              STREAM(S:=SCHEDLINE[ABS(LINE)], U:=INF[1], L:=ABS(LINE),  15113500
$INCLUDE 15113601, IF DCP;                                              15113599
                LN:=INF[0].[24:8], ST:=INF[0].[32:8],                   15113600
                BF);                                                    15113700
                   U:=DI; DS:=3 DEC;                                    15115100
$INCLUDE 15115501, IF DCP;                                              15115199
                   DS:=2 LIT"-(";                                       15115200
                   S(DS:=5 LIT"SCHED"; JUMP OUT TO LL);                 15115300
                   S:=DI; DI:=LOC L;                                    15115320
                   DS:=3 DEC; DS:=3 DEC; DS:=LIT"A";                    15115340
                   SI:=LOC L; DI:=S;                                    15115360
              LL2: IF SC="0" THEN                                       15115380
                   BEGIN SI:=SI+1;                                      15115400
                        IF SC!"0" THEN DS:=2 CHR ELSE                   15115420
                        BEGIN SI:=SI+1; DS:=CHR END                     15115440
                   END ELSE DS:=3 CHR;                                  15115460
                   IF SC GEQ "0" THEN BEGIN DS:=LIT"/"; GO TO LL2 END;  15115480
              LL:  DS:=2 LIT")~";                                       15115500
$OMIT 15115701, IF DCP;                                                 15115599
                   S(DS:=8 LIT"-(SCHED)");                              15115600
                   DS:=LIT"~";                                          15115700
                   DI:=U; DS:=2 FILL;                                   15116000
$VOID                                                                   15119000
                   X:=MIX, Y:=LINE,                                     15123500
$INCLUDE 15123601, IF DCP;                                              15123599
                   L:=(I:=STATABLE[ABS(LINE)]).[24:8], ST:=I.[32:8],    15123600
                   S:=SCHEDLINE[ABS(LINE)], Z:=LINE GTR 0, BF);         15123700
              Z(DS:=4 LIT" ON "; X:=DI; DS:=3 DEC;                      15126500
$OMIT 15126601, IF DCP;                                                 15126599
                   S(DS:=8 LIT"-(SCHED)"); DS:=LIT"~";                  15126600
$INCLUDE 15127001, IF DCP;                                              15126699
                   DS:=2 LIT"-(";                                       15126700
                   S(DS:=5 LIT"SCHED"; JUMP OUT TO LL);                 15126800
                   X:=DI; DI:=LOC Y;                                    15126820
                   DS:=3 DEC; DS:=3 DEC; DS:=LIT"A";                    15126840
                   SI:=LOC Y; DI:=X;                                    15126860
              LL2: IF SC="0" THEN                                       15126880
                   BEGIN SI:=SI+1;                                      15126900
                        IF SC!"0" THEN DS:=2 CHR ELSE                   15126920
                        BEGIN SI:=SI+1; DS:=CHR END                     15126940
                   END ELSE DS:=3 CHR;                                  15126960
                   IF SC GEQ "0" THEN BEGIN DS:=LIT"/"; GO TO LL2 END;  15126980
              LL:  DS:=2 LIT")~";                                       15127000
                   DI:=X; DS:=2 FILL);                                  15127100
    FOR LINE:=0 STEP 1 UNTIL STATIONMAX DO                              15147000
    SYSDISKIO(1,STATIONMAX+1,INF);                                      15147600
$OMIT 15505201, IF DCP;                                                 15504999
$INCLUDE 15505301, IF DCP;                                              15505299
         DS:=5 LIT" DCP,";                                              15505300
$INCLUDE 15515001, IF DUMP OR DEBUGGING;                                15514999
         DS:=5 LIT"DUMP,";                                              15515000
$VOID 15531001                                                          15525000
         LABEL SY,SI,DC;                                                16010250
                           ,WI,SY,SI,XD,DC                              16020100
$VOID 16020301                                                          16020200
$OMIT 16090946, IF TWXONLY OR DCP;                                      16090919
$INCLUDE 16090951, IF DCP;                                              16090949
              IF NAKSTA[I] THEN TNAOG[I]:=(*P(DUP))&0[1:1:24];          16090950
         END;                                                           16090955
         GO TO FORGET;                                                  16090960
$INCLUDE 16107201, IF DCP;                                              16107099
    DC:  DCPFILECHANGER(KTR);                                           16107100
          GO TO EXIT;                                                   16107200
$OMIT 16107301, IF DCP;                                                 16107299
    DC:  GO TO ERROR;                                                   16107300
    CM14:IF SCHEDLINE[R6:=R6.[40:8]] THEN GO TO RETURN;                 19559000
$OMIT 19559221, IF DCP;                                                 19559049
$INCLUDE 19559381, IF DCP;                                              19559299
         M[(T:=GETAREA(0))+1]:=0&SETSEQUENCEMODE[1:41:7]&1[23:47:1]&    19559300
                               STATABLE[R6][24:24:16];                  19559320
         STREAM(A:=R5.[21:27],B:=R5.[2:19],T:=T+3);                     19559340
         BEGIN SI:=LOC A; DS:=8 DEC; DS:=8 DEC; END;                    19559360
         DCPQ(T);                                                       19559380
$OMIT 19566001, IF DCP;                                                 19564999
$INCLUDE 19566601, IF DCP;                                              19566099
    CM17:M[T:=GETAREA(0)]:=0&R8[5:1:1];                                 19566100
         M[T+1]:=R7&(IF R8.[1:1] THEN R8 ELSE STATABLE[R8])[24:24:16];  19566200
         M[T+3]:=R6;                                                    19566300
         M[T+4]:=R5;                                                    19566400
         DCPQ(T);                                                       19566500
         GO TO RETURN;                                                  19566600
              SCHEDLINE[LOGLINE.[40:8] MOD (LMAX+1)] THEN               20078020
$OMIT 21103101, IF DCP;                                                 21103049
$INCLUDE 21103111, IF DCP;                                              21103109
         IF NOT (STATABLE[N.[40:8]]:=(*P(DUP))&2[2:46:2]).[11:1] THEN   21103110
              SYSDISKIO(1,0,A);                                         22037500
              FOR I:=1 STEP 1 UNTIL STATIONMAX DO                       22038000
                IF SCH(A) THEN                                          22039100
                      IF NOT SCHEDBUSY[I] THEN S:=S+1;                  22039400
                   BEGIN IF (JJ:=STATABLE[I]).ACTIVITY THEN             22040500
                             W:=TRUE ELSE                               22041000
$INCLUDE 22042001, IF DCP;                                              22041199
                        IF JJ.DISCIT THEN                               22041200
                        IF A[2]+7200 LSS CLOCK THEN                     22041400
                        BEGIN STATABLE[I]:=JJ&0[15:15:2];               22041600
                             FORK(P(.QUITTER),I&6[33:41:7],-2,96,0);    22041800
                        END ELSE ELSE                                   22042000
                        BEGIN IF (J:=JJ.MIXNR) ! CANDEMIX[I] THEN       22044000
$OMIT 22047101, IF DCP;                                                 22047049
                             IF JJ.STATIONTYPE=TWX THEN                 22047050
$OMIT 22049311, IF DCP;                                                 22049309
                        BEGIN A[2]:=CLOCK;                              22049800
                             SYSDISKIO(0,I,A);                          22049900
                        END;                                            22049950
              SYSDISKIO(1,STAMAX+1,A);                                  22050250
$OMIT 22050381, IF DCP OR TWXONLY;                                      22050304
$INCLUDE 33614001, IF DCP;                                              32999999
PROCEDURE DCWRITE(ADR,STA,NUM,FLAGS);                                   33000000
VALUE ADR,STA,NUM,FLAGS;                                                33000500
REAL  ADR,STA,NUM,FLAGS;                                                33001000
BEGIN                                                                   33001500
    REAL CLASS,S,X,Y,Z;                                                 33002000
    BOOLEAN Q;                                                          33002500
    LABEL START;                                                        33003000
%                                                                       33003100
%   DCWRITE IS USED TO GENERATE OUTPUT REQUESTS. THE PAPRAMETERS ARE:   33003150
%     ADR     ADDRESS OF STUFF TO BE OUTPUT                             33003200
%     STA     STATION NUMBER                                            33003250
%     NUM     NUMBER OF CHARACTERS                                      33003300
%     FLAGS   IF 47:1=1 THIS OUTPUT IS THE LAST OF A SEG OF TANK        33003350
%   IF NUM IS GREATER THAN 136 (17|8), TWO REQUESTS ARE GENERATED.      33003400
%   IF THE REINITIALIZED BIT IS ON, DCWRITE SCANS FORWARD TO THE SPOT   33003450
%   POINTED TO BY THE NAK POINTER.                                      33003500
%                                                                       33003550
    IF (S:=STATABLE[STA]).[1:1] THEN P(XIT);     % PAPERTAPE            33004000
    IF S.REINITIALIZED THEN                                             33004500
    BEGIN STATABLE[STA]:=S&0[21:21:1];                                  33005000
         CLASS:=REINITIALIZEDOUTPUT;                                    33005500
         IF (X:=TNAOG[STA].[3:7])!0 THEN                                33006000
         STREAM(NM:=NUM:=NUM-X, N1:=NUM.[40:2], N:=X.[45:3],            33006500
              S:=ADR+X.[40:5], ADR);                                    33007000
         BEGIN SI:=S; SI:=SI+N;                                         33007500
              N1(DS:=32 CHR; DS:=32 CHR);                               33008000
              DS:=NM CHR;                                               33008500
         END;                                                           33009000
    END ELSE                                                            33009500
START:   CLASS:=OUTPUT;                                                 33010000
    X:=IF (Q:=NUM LEQ 136) THEN NUM ELSE 128;                           33010500
    M[(Z:=GETAREA(1+(X GTR 56)))+1]:=X;                                 33011000
    MOVE((X+7) DIV 8,ADR,Z+3);                                          33011500
    ADR:=ADR+16;                                                        33012000
    IF Q THEN M[Z]:=(*P(DUP))&FLAGS[4:47:1];                            33012500
    M[Z+1]:=(*P(DUP))&CLASS[1:41:7]&S[24:24:16];                        33013000
    TANKS[STA]:=(*P(DUP))&(P(DUP).DCPMESSAGES+1)[12:46:2];              33013500
    DCPQ(Z);                                                            33014000
    IF NOT Q THEN                                                       33014500
    BEGIN NUM:=NUM-128;                                                 33015000
         GO TO START;                                                   33015500
    END;                                                                33016000
END OF DCWRITE;                                                         33016500
REAL PROCEDURE OUTRAN(ADR,NUM,TYPE,B);                                  33017000
VALUE ADR,NUM,TYPE;                                                     33017500
REAL  ADR,NUM,TYPE,B;                                                   33018000
BEGIN                                                                   33018500
    REAL T,Q,MODE,ASCII,X,NOTEQ;                                        33019000
%                                                                       33019100
%   OUTRAN PERFORMS THE TASKS OF SCANNING OUT BLANKS, INSERTING         33019150
%   ! BEFORE CONTROL CHARACTERS AND INSERTING CARRIAGE RETURNS AND      33019200
%   LINE FEEDS. IT WORKS FOR SICASCII OR BCL.                           33019250
%                                                                       33019300
    T:=B:=SPACE(30)+1;                                                  33019500
    IF (ASCII:=TYPE.[1:1]) THEN MODE:=1 ELSE MODE:=T;                   33020000
    X:=TYPE.[2:1];                                                      33020500
    DO BEGIN                                                            33021000
         IF ASCII THEN                                                  33021500
         STREAM(Q:=0,ADR,N:=IF NUM GTR 63 THEN 63 ELSE NUM,MODE,NOTEQ:  33022000
                X,T);                                                   33022500
         BEGIN SI:=ADR;                                                 33023000
            N(IF SC="!" THEN                                            33023500
              BEGIN SI:=SI+1;                                           33024000
                   NOTEQ(TALLY:=0; JUMP OUT TO GOTOTEST);               33024500
                   IF SC="!" THEN                                       33025000
                   BEGIN TALLY:=1;                                      33025500
  GOTOTEST:             NOTEQ:=TALLY;                                   33026000
                        MODE(JUMP OUT TO L); SI:=SI-1; GO DSIT;         33026500
                   END;                                                 33027000
                   MODE(TALLY:=0; JUMP OUT TO LL); TALLY:=1;            33027500
        LL:        MODE:=TALLY; GO TO L;                                33028000
              END;                                                      33028500
              X(IF SC="~" THEN                                          33029000
                   BEGIN TALLY:=1; Q:=TALLY; JUMP OUT 2 TO EXIT END);   33029500
              MODE(IF SC="$" THEN                                       33030000
                   BEGIN TALLY:=3; Q:=TALLY; JUMP OUT 2 TO EXIT END;    33030500
                   DS:=LIT"!");                                         33031000
      DSIT:   DS:=CHR;                                                  33031500
         L: );                                                          33032000
      EXIT: ADR:=SI; N:=DI;                                             33032500
         END                                                            33033000
        ELSE                                                            33033500
         STREAM(Q:=0,ADR,N:=IF NUM GTR 63 THEN 63 ELSE NUM,MODE,X:T);   33034000
         BEGIN SI:=ADR;                                                 33034500
            N(IF SC=" " THEN DS:=CHR ELSE                               33035000
              BEGIN                                                     33035500
                 X(IF SC="~" THEN                                       33036000
                   BEGIN MODE:=DI;                                      33036500
                        TALLY:=1; Q:=TALLY;                             33037000
                        JUMP OUT 2 TO EXIT;                             33037500
                   END);                                                33038000
                   IF SC="!" THEN DS:=LIT"!";                           33038500
                   DS:=CHR;                                             33039000
                   MODE:=DI;                                            33039500
              END);                                                     33040000
    EXIT:    ADR:=SI; N:=DI;                                            33040500
         END;                                                           33041000
         NOTEQ:=P; MODE:=P; T:=P; ADR:=P;                               33041500
    END UNTIL (Q:=P) OR (NUM:=NUM-63) LEQ 0;                            33042000
    IF NOT ASCII THEN                                                   33042500
    BEGIN T:=MODE;                                                      33043000
         IF (TYPE.[18:30]!@100000)THEN                                  33043500
         BEGIN                                                          33044000
              STREAM(CR:=TYPE.[FF]-1:LF:=TYPE,T);                       33044500
              BEGIN                                                     33045000
                   CR(DS:=2 LIT"!-");                                   33045500
                   LF(DS:=2 LIT"!*");                                   33046000
                   CR:=DI;                                              33046500
              END;                                                      33047000
              T:=P;                                                     33047500
    END  END;                                                           33048000
    OUTRAN:=T.[30:3]&(T-B)[30:33:15]&Q[2:46:1];                         33048500
END OUTRAN FOR DCP;                                                     33049000
PROCEDURE PAPERTAPEIO(STA,H,MI);                                        33049500
VALUE STA,H,MI;                                                         33050000
REAL  STA,H,MI;                                                         33050500
BEGIN                                                                   33051000
    REAL T,T1,N,Q,X;                                                    33051500
%                                                                       33051600
%   PAPERTAPE INPUT IS PACKED WITH MORE THAN ONE MESSAGE TO A           33051620
%   SEGMENT, SUBJECT TO THE RESTRICTION THAT, IF A MESSAGE ENDS         33051640
%   IN A SEGMENT, ALL OTHER MESSAGES PACKED INTO THAT SEGMENT           33051660
%   MUST ALSO END WITHIN IT. THE ASSUMPTION IS MADE THAT, IF HARRY      33051680
%   PASSES AN INCOMPLETE MESSAGE, HE PASSES ENOUGH CHARACTERS TO        33051700
%   GUARANTEE THAT THE PREVIOUS SEGMENT IS SHOVED OUT TO DISK.          33051720
%   THE PAPRAMETERS ARE:                                                33051740
%     STA   STATION NUMBER                                              33051760
%     H     ADDRESS OF HARRYS BUFFER                                    33051780
%     MI    THIRD WORD OF HEADER (USED FOR SPECIAL CHARACTER FLAG)      33051800
%   PAPERTAPE IS PACKED INTO AN ARRAY WHOSE ADDRESS IS KEPT IN          33051820
%   INPUTANK[STA].[FF]. THE ARRAY CONTAINS:                             33051840
%     WORD    CONTENTS                                                  33051860
%     -1      I/O COMPLETE MASK                                         33051880
%     0       [FF]  ADDRESS OF WHICH BUFFER WE ARE USING                33051900
%             [CF]  NUMBER OF SEGMENTS IN CURRENT MESSAGE               33051920
%     1       RESERVED FOR DISKIO                                       33051940
%     2-31    FIRST BUFFER                                              33051960
%     32      RESERVED FOR DISKIO FOR SECOND BUFFER                     33051970
%     33-62   SECOND BUFFER                                             33051980
%   THE FIRST WORD OF THE BUFFER, AND THEREFORE OF A SEGMENT ON         33052000
%   DISK, (ALSO OF M[H]), IS USED AS FOLLOWS:                           33052020
%     [CF]   NUMBER OF CHARS IN FIRST MESSAGE IN THIS SEGMENT           33052040
%     [FF]   NUMBER OF WORDS USED IN SEGMENT                            33052060
%     [5:1]  END OF MESSAGE OR RECORD FLAG                              33052080
%     [2:1]  PAPERTAPE FLAG                                             33052100
%   IF THERE ARE MULTIPLE MESSAGES IN A SEGMENT, EACH MESSAGE IS        33052120
%   PRECEDED BY A WORD CONTAINING THE NUMBER OF CHARACTERS              33052140
%   IN THAT MESSAGE.                                                    33052160
%   JOBS READING A PAPERTAPE ARE SWAPPED IN ONLY AT THE END OF THE      33052180
%   TAPE OR WHEN THE INPUT TANK IS HALF FULL.                           33052200
%                                                                       33052220
    SUBROUTINE SWAPITIN;                                                33052500
    BEGIN                                                               33053000
         IF X.INPUTREADY THEN                                           33053500
         BEGIN BRINGBACK(STATABLE[STA].MIXNR);                          33054000
              X.INPUTREADY:=0;                                          33054500
         END;                                                           33055000
    END;                                                                33055500
%                                                                       33056000
    SUBROUTINE PAPERTAPEDISKIO;                                         33056500
    BEGIN                                                               33057000
         IF (M[T-1] AND IOMASK)=0 THEN SLEEP([M[T-1]],IOMASK);          33057500
         DISKIO(M[T-1],T1-1,30,PROGTANK+CLUMPSIZE|STA+                  33058000
               ((X.INPUTL+X.INPUTN+M[T].[CF]) AND NOT CLUMPSIZE));      33058500
$INCLUDE 33058601, IF STATISTICS;                                       33058599
         COUNTUP(16,1);                                                 33058600
         IF M[T1].MESSEND THEN                                          33059000
         BEGIN IF (X:=X&(X.INPUTN+M[T].[CF]+1)[40:40:8]).[40:8] GTR     33059500
              CLUMPSIZE/2 THEN SWAPITIN;                                33060000
              M[T].[CF]:=0;                                             33060500
         END ELSE M[T]:=(*P(DUP))+1;                                    33061000
    END;                                                                33061500
%                                                                       33062000
    X:=INPUTANK[STA]:=ABS(*P(DUP));                                     33062500
    IF (Q:=M[T1:=M[T:=X.[FF]].[FF]].[FF])+(N:=M[H].[FF]) GTR 28 THEN    33063000
    BEGIN IF Q!@77777 THEN             % NOT FIRST INPUT FROM TAPE      33063500
         BEGIN PAPERTAPEDISKIO;                                         33064000
              M[T].[FF]:=T1:=IF T1 GTR T+2 THEN T+2 ELSE T+33;          33064500
         END;                                                           33065000
         M[T1]:=M[H]&1[2:47:1];                                         33065500
         Q:=0;                                                          33066000
    END ELSE                                                            33066500
    BEGIN M[T1+Q]:=M[H].[CF];                                           33067000
         M[T1]:=(*P(DUP))&(P(DUP).[FF]+N)[CTF];                         33067500
    END;                                                                33068000
    STREAM(N,H:=H+1,D:=T1+Q+1);                                         33068500
    BEGIN SI:=H; DS:=N WDS END;                                         33069000
%                                                                       33069500
%   THE SPECIAL CHARACTER IS USED TO SIGNAL THE END OF THE TAPE. WE     33069600
%   PASS A QUESTION MARK TO CANDE, WRITE OUT THE LAST BUFFER, TURN      33069700
%   OF PAPERTAPE AND SWAP THE JOB IN.                                   33069800
%                                                                       33069900
    IF MI.SPECIALCHARACTER THEN                                         33070000
    BEGIN IF NOT M[T1].MESSEND THEN                                     33070500
         BEGIN M[T1].MESSEND:=1;                                        33071000
              STATABLE[STA].OWHTHROWOUT:=1;                             33071500
         END;                                                           33072000
         IF DAT[STATABLE[STA].MIXNR].NDSABLE THEN                       33072500
         BEGIN M[T1+Q]:=1;                                              33073000
              N:=N-2;                                                   33073500
              STREAM(D:=T1+Q+1); DS:=LIT MARK;                          33074000
         END;                                                           33074500
         IF (M[T1]:=(*P(DUP))&(P(DUP).[FF]-N)[CTF]).[FF] ! 0 THEN       33075000
           PAPERTAPEDISKIO;                                             33075500
         X.[FF]:=0;                                                     33076000
         PAPERTAPE[STA]:=0;                                             33076500
         SWAPITIN;                                                      33077000
         IF (M[T-1] AND IOMASK)=0 THEN SLEEP([M[T-1]],IOMASK);          33077500
         FORGETSPACE(T);                                                33078000
    END ELSE                                                            33078500
    IF (Q:=X.INPUTN+M[T].[CF]) GTR CLUMPSIZE|.9 THEN                    33079000
    IF NOT X.SLOWDOWN THEN                                              33079500
    BEGIN QDCP(ENABLEINPUT,STA,Q);                                      33080000
         X.SLOWDOWN:=1;                                                 33080500
    END ELSE                                                            33081000
    IF Q GTR CLUMPSIZE-1 THEN TERMINATE(STATABLE[STA].MIXNR&75[CTF]);   33081500
%                                                                       33082000
    INPUTANK[STA]:=NABS(X);                                             33082500
END OF HANDLING INPUT FROM PAPER TAPE;                                  33083000
PROCEDURE OLDWIERDHAROLD;                                               33083500
%   OLD WIERD HAROLD DOES MANY STRANGE AND WONDROUS THINGS              33083600
%   SOME OF THEM USEFUL                                                 33083700
BEGIN                                                                   33084000
    REAL STA,H,I,J,SOURCE,MI,MI2,NUM,TEMP,X;                            33084500
    REAL S=SOURCE,T=TEMP;                                               33085000
    LABEL START,RESTART,AROUND,AGAIN,EOM,FIXLASTSEG,DELINKIT,UPX,       33085500
          PASSITTOCANDE,DELL,GETANOTHER,UPPTRS;                         33086000
    DEFINE DELETE   = [4:1]#,                                           33086500
           SIZEND   = [7:1]#,                                           33087000
           CELINE   = STATABLE[STA].CANDEFLAG#;                         33087500
    SUBROUTINE UPQ;                                                     33088000
    BEGIN                                                               33088500
         WORKERINQ.[CF]:=MI;                                            33089000
         FORGETAREA(MI.[2:2],I);                                        33089500
         SOURCE:=(I:=WORKERINQ.[CF])+3;                                 33090000
     END;                                                               33090500
%                                                                       33090600
%   HARRY FIRST EMPTIES THE WORKERINQ, THEN TAKES AN ITEM OUT OF THE    33090620
%   DETANKING QUEUE, THEN CHECKS THE WORKERINQ. HE CONTINUES TO         33090640
%   DO THIS UNTIL BOTH QUEUES ARE EMPTY.                                33090660
%                                                                       33090680
%   INPUT BUFFERS ARE QUEUED WITH 4:4 OF THE FIRST WORD USED TO FLAG    33090700
%   THE FOLLOWING THINGS:                                               33090720
%     4:1   DELETE HAS OCCURRED                                         33090740
%     5:1   END OF MESSAGE                                              33090760
%     6:1   END OF RECORD                                               33090780
%     7:1   224 CHARACTERS HAVE BEEN RECEIVED WITHOUT AN EOR OR EOM.    33090800
%   THE OWHTHROWOUT BIT IS USED TO SCAN PAST INPUT WITHOUT PROCESSING   33090820
%   IT, UNTIL AN EOR OR EOM IS REACHED. IT IS USED IF A RECORD          33090840
%   OVER 224 CHARACTERS LONG IS INPUT TO CANDE.                         33090860
%                                                                       33090880
    H:=SPACE(32);                                                       33091000
RESTART::                                                               33091500
    SOURCE:=(I:=WORKERINQ.[CF])+3;                                      33092000
START:                                                                  33092500
    IF I!0 THEN                                                         33093000
    BEGIN                                                               33093500
         IF STATABLE[STA:=(MI:=M[I]).LINENR].OWHTHROWOUT THEN           33094000
         BEGIN STATABLE[STA].OWHTHROWOUT:=(MI.[4:5] AND @26)=0;         33094500
              IF MI.DELETE THEN GO TO DELL;                             33095000
              UPQ;                                                      33095500
              IF MI.MESSEND THEN                                        33096000
              IF (TEMP:=INPUTANK[STA].[FF]) ! 0 THEN GO TO EOM;         33096500
              GO START;                                                 33097000
         END;                                                           33097500
         NUM:=0;                                                        33098000
         IF STA=0 THEN MI2:=0 ELSE                                      33098500
         BEGIN                                                          33099000
              M[H]:=0&(MI2:=M[I+2])[10:16:8];    % SAVE BACKSP FOR OBJOB33099500
              IF MI.DELETE THEN                                         33100000
DELL:         BEGIN X:=INPUTANK[STA].[FF];                              33100500
                   IF CELINE THEN                                       33101000
                        WHILE (TEMP:=X)!0 DO                            33101500
                        BEGIN X:=M[TEMP].[FF];                          33102000
                             FORGETSPACE(TEMP-2);                       33102500
                        END                                             33103000
                   ELSE                                                 33103500
                   IF PAPERTAPE[STA] THEN                               33104000
                   BEGIN IF NOT M[TEMP:=(M[X]:=(*P(DUP))&0[CTC]).[FF]]  33104500
                        .MESSEND THEN M[TEMP]:=0;                       33105000
                        GO AROUND;                                      33105500
                   END;                                                 33106000
                   INPUTANK[STA].[FF]:=0;                               33106500
AROUND:            UPQ;                                                 33107000
                   GO TO START;                                         33107500
              END;                                                      33108000
         END;                                                           33108500
         J:=H+1;                                                        33109000
AGAIN:                                                                  33109500
         STREAM(N:=(TEMP:=M[I+1].[40:8]).[40:3]:N1:=TEMP.[43:5],        33110000
                SOURCE,J);                                              33110500
         BEGIN SI:=SOURCE;                                              33111000
              N(DS:=32 CHR); DS:=N1 CHR;                                33111500
              N:=DI;                                                    33112000
         END;                                                           33112500
         J:=P;                                                          33113000
         NUM:=NUM+TEMP;                                                 33113500
         UPQ;                                                           33114000
         IF MI.[4:4]=0 THEN                                             33114500
         BEGIN MI:=M[I];                                                33115000
              IF (TEMP:=(MI2:=M[I+2]).[16:8]) ! 0 THEN     % BACKSPACE  33115500
              BEGIN IF (NUM:=NUM-TEMP) LSS 0 THEN NUM:=0;               33116000
                   J:=(H+1+NUM.[40:5])&NUM[30:45:3];                    33116500
              END;                                                      33117000
              GO AGAIN;                                                 33117500
         END;                                                           33118000
%                                                                       33118100
%   INPUT TO CANDE WHICH ENDS WITH AN EOR IS QUEUED IN ARRAYS           33118200
%   FORMATTED LIKE LASTSEG. THE ARRAYS ARE LINKED FROM INPUTANK{STA].[FF33118300
%   THROUGH THE FF OF THE FIRST WORD OF EACH ARRAY. WHEN AN             33118400
%   EOM IS RECEIVED, THE WHOLE THING IS LINKED INTO THE QUEUE OF        33118500
%   INPUT FOR CANDE.                                                    33118600
%                                                                       33118700
         IF CELINE OR (MI2.SPECIALCHARACTER AND NOT PAPERTAPE[STA]) THEN33119000
         BEGIN IF MI.SIZEND THEN                                        33119500
              BEGIN STATABLE[STA].OWHTHROWOUT:=1;                       33120000
                   NUM:=223;                                            33120500
                   J:=(H+29)&7[30:45:3];                                33121000
              END;                                                      33121500
              STREAM(J); DS:=LIT"~";                                    33122000
              IF ABS(SPOWORD) = STA THEN    %BACK UP SPO                33122500
              IF STA!0 THEN                                             33123000
              BEGIN M[H-1]:=0;                                          33123500
                   IF KEYBOARDCOUNTER = 0 THEN                          33124000
                   FORK(P(.KEYIN),1&(H+1)[CTF],0,192,0) ELSE            33124500
                   IF (X:=KEYBOARDCOUNTER.[FF]) NEQ 0 THEN              33125000
                   BEGIN IF (J:=M[X-2].[CF]) NEQ 0 THEN                 33125500
                        IF M[(X:=J)-2] NEQ 0 THEN GO TO START;          33126000
                        M[X-2]:=H+1;                                    33126500
                   END ELSE KEYBOARDCOUNTER:=KEYBOARDCOUNTER&(H+1)[CTF];33127000
                   KEYBOARDCOUNTER:=KEYBOARDCOUNTER&1[17:47:1];         33127500
                   H:=SPACE(32);                                        33128000
                   GO TO START;                                         33128500
              END;                                                      33129000
              X:=((NUM:=NUM+1)+7) DIV 8;                                33129500
              IF NOT MI.MESSEND THEN    % NOT ETX, MUST BE AN EOR       33130000
              BEGIN                    % SAVE IT IN CASE OF DELETE      33130500
                   P(LASTSEG,LASTOFFSET);        % MAKE LASTSEG POINT   33131000
                                                 % TP CURRENT BUFFER.   33131250
                   IF (TEMP:=INPUTANK[STA].[FF])=0 THEN                 33131500
                   BEGIN LASTSEG:=[INPUTANK[STA]]&32[10:40:8];          33132000
                        GO GETANOTHER;                                  33132500
                   END ELSE GO FIXLASTSEG;                              33133000
              END ELSE            % GOT ETX                             33133500
              IF (TEMP:=INPUTANK[STA].[FF])!0 THEN    %STUFF TO LINK IN 33134000
EOM:          BEGIN IF CANDEINPUTREADY THEN                             33134500
                   BEGIN IF (M[IOADR] AND IOMASK)=0 THEN                33135000
                        SLEEP([M[IOADR]],IOMASK);                       33135500
                        MOVE(30,TEMP,FIRSTSEG);                         33136000
                        FORGETSPACE(TEMP-2);                            33136500
                        TEMP:=FIRSTSEG.[CF];                            33137000
                        FIRSTOFFSET:=1;                                 33137500
                   END ELSE LASTSEG[0].[FF]:=TEMP;                      33138000
                   INPUTANK[STA].[FF]:=0;                               33138500
FIXLASTSEG:        DO LASTSEG.[CF]:=TEMP UNTIL (TEMP:=M[TEMP].[FF])=0;  33139000
                   IF NUM=0 THEN GO PASSITTOCANDE;                      33139500
                   IF (LASTOFFSET:=LASTSEG[0].[40:8]+1)+X GTR 29 THEN   33140000
                   GO GETANOTHER;                                       33140500
              END ELSE                                                  33141000
              IF X+LASTOFFSET GTR 29 THEN       % NO ROOM IN THIS SEG   33141500
              BEGIN IF CANDEINPUTREADY THEN     % REUSE FIRSTSEG        33142000
                   BEGIN IF (M[IOADR] AND IOMASK) = 0 THEN              33142500
                        SLEEP([M[IOADR]],IOMASK);                       33143000
                        FIRSTOFFSET:=1;                                 33143500
                   END ELSE                         % GET A NEW ONE     33144000
                   BEGIN                                                33144500
GETANOTHER:             LASTSEG[0].[FF] := (TEMP:=SPACE(32))+2;         33145000
                        M[TEMP] := IOMASK;                              33145500
                        LASTSEG.[CF]:=TEMP+2;                           33146000
                   END;                                                 33146500
                   LASTSEG[0]:=0&1[17:47:1];                            33147000
                   LASTOFFSET := 1;                                     33147500
              END;                                                      33148000
              STREAM(MA:=H+1,X,D:=[LASTSEG[LASTOFFSET+1]]);             33148500
              BEGIN SI:=MA; DS:=X WDS END;                              33149000
              LASTSEG[LASTOFFSET]:=NUM&MI2[1:35:1]&STA[10:40:8];        33149500
              LASTOFFSET.[CF]:=(LASTSEG[0]:=(*P(DUP))&(LASTOFFSET+X)    33150000
                                [CTC])+1;                               33150500
              IF NOT MI.MESSEND THEN          % RESTORE LASTSEG         33151000
              BEGIN                                                     33151500
                   LASTOFFSET:=P;                                       33152000
                   LASTSEG:=P;                                          33152500
                   GO TO START;                                         33153000
              END;                                                      33153500
PASSITTOCANDE:                                                          33154000
              IF CANDEINPUTREADY THEN                                   33154500
              BEGIN FORK(P(.NOTIFYCANDE),CANDYINX,0,0,1);               33155000
                   CANDEINPUTREADY:=FALSE;                              33155500
                   GO TO START;                                         33156000
              END;                                                      33156500
              IF CANDYINX=0 THEN                                        33157000
              BEGIN STREAM(H); DS:=27 LIT"CANDE IS DOWN...PLEASE WAIT"; 33157500
                   TWXOUT(H,27,1,STA);                                  33158000
                   GO TO START;                                         33158500
              END ELSE GO TO START;                                     33159000
         END STATION ATTACHED TO CANDE;                                 33159500
%                                                                       33159600
%   FOR OBJECT JOB INPUT, INPUTANK[STA].[FF] IS USED TO KEEP THE        33159620
%   NUMBER OF SEGMENTS WRITTEN TO DISK AS PART OF THE CURRENT           33159640
%   MESSAGE. M[H] (I.E. THE FIRST WORD OF A SEGMENT) CONTAINS:          33159660
%     [2:1]   PAPERTAPE FLAG                                            33159680
%     [5:1]   END OF RECORD FLAG                                        33159700
%     [10:8]  BACKSPACE COUNTER                                         33159720
%     [CF]    NUMBER OF CHARACTERS IN SEGMENT                           33159740
%   A MESSAGE MAY EXTEND FOR SEVERAL SEGMENTS, BUT A SEGMENT CAN        33159760
%   CONTAIN NO MORE THAN ONE MESSAGE.                                   33159780
%                                                                       33159800
         M[H]:=(*P(DUP))&NUM[CTC]&(NUM+15)[28:40:5]&((MI.[4:4] AND 6)!0)33160000
              [5:47:1];                                                 33160500
         IF PAPERTAPE[STA] THEN PAPERTAPEIO(STA,H,MI2) ELSE             33161000
         BEGIN                                                          33161500
              X:=INPUTANK[STA]:=ABS(*P(DUP));                           33162000
              DISKIO(M[(H+31)],H-1,(NUM+7) DIV 8+1,PROGTANK+            33162500
                     CLUMPSIZE|STA+((X.INPUTN+X.[FF]+X.INPUTL) AND      33163000
                     NOT CLUMPSIZE));                                   33163500
$INCLUDE 33163601, IF STATISTICS;                                       33163599
              COUNTUP(16,1);                                            33163600
              IF MI.MESSEND THEN                                        33164000
              BEGIN X:=X&(X.[FF]+X.[40:8]+1)[40:40:8]&0[CTF];           33164500
                   IF INPUTANK[STA].INPUTREADY THEN                     33165000
                   BEGIN BRINGBACK(STATABLE[STA].MIXNR);                33165500
                        X.INPUTREADY:=0;                                33166000
              END  END                                                  33166500
              ELSE X.[FF]:=X.[FF]+1;                                    33167000
              IF X.INPUTN GEQ .9|CLUMPSIZE THEN                         33167500
              IF NOT X.SLOWDOWN THEN                                    33168000
              BEGIN M[(TEMP:=GETAREA(0))+1]:=0&ENABLEINPUT[1:41:7]      33168500
                        &STATABLE[STA][24:24:16];                       33169000
                   DCPQ(TEMP);                                          33169500
                   X.SLOWDOWN:=1;                                       33170000
              END ELSE                                                  33170500
              IF X.INPUTN=CLUMPSIZE-1 THEN                              33171000
              TERMINATE(STATABLE[STA].MIXNR&75[CTF]);                   33171500
              INPUTANK[STA]:=NABS(X);  % UPDATE AND UNLOCK INPUTANK     33172000
              SLEEP([M[H+31]],IOMASK);                                  33172500
         END;                                                           33173000
         GO TO START;                                                   33173500
%                                                                       33174000
  END OF INPUT HANDLING;    % IF WORKERINQ IS EMPTY WE FALL THROUGH     33174500
%                                                                       33174550
%   AFTER ALL INPUT IS DONE, HARRY DETANKS OUTPUT. FIRST HE READS       33174600
%   IN THE NEXT SEGMENT FOR A STATION (OR USES THE CORE TANK            33174620
%   IF THERE IS NONE ON DISK) AND UPS THE DETANKING POINTERS.           33174640
%   THE POINTERS KEPT ARE:                                              33174660
%     TANKS[STA].[19:7]   NUMBER OF SEGS IN USE                         33174680
%     TANKS[STA].[26:7]   OLDEST SEGMENT IN TANK                        33174700
%   FOR NON NAKABLE STATIONS, THIS IS ALL THAT IS REQUIRED,             33174720
%   SINCE NOTHING HAS TO BE SAVED. FOR NAKABLE STATIONS, THE            33174740
%   OLDEST SEGMENT IS A POINTER FOR A RETRY. THE ADDITIONAL             33174760
%   POINTERS ARE:                                                       33174780
%     TNAOG[STA]                                                        33174800
%       2:8      CHARACTER POINTER FOR RETRY                            33174820
%       10:8     POINTER TO WHERE THE DCP IS (USED TO UPDATE OLDEST     33174840
%                SEGMENT AFTER A SUCCESSFUL I/O)                        33174860
%       18:7     SEGMENT NEXT TO BE DETANKED.                           33174880
%   HARRY DETANKS HALF A SEGMENT AT A TIME, USING TANKS[STA].           33174900
%   NEXTPIECE AS A FLAG FOR WHICH HALF TO USE. IN THE CODE BELOW,       33174920
%   THE VARIABLE S PASSES TO DCWRITE WHETHER OR NOT THE SEGMENT         33174940
%   WAS EXHAUSTED.                                                      33174960
%                                                                       33174980
     IF (STA:=HEADOUT) ! 0 THEN                                         33175000
     BEGIN                                                              33175500
         IF NOT TANKS[STA].[1:1] THEN SLEEP([TANKS[STA]],-0);           33176000
         T:=TANKS[STA]:=ABS(*P(DUP));                                   33176500
         X:=T.TANKL;                                                    33177000
         IF (MI:=NAKSTA[STA]) THEN X:=X+(I:=TNAOG[STA].DETANK) AND      33177500
           NOT GLOMSIZE                                                 33178000
         ELSE I:=0;                                                     33178500
         IF T.[SOUSE] LEQ I THEN                                        33179000
         BEGIN STATABLE[STA].OUTPUTANKING:=0;                           33179500
              IF T.[CF]!0 AND M[T]!0 THEN                               33180000
              BEGIN NUM:=M[J:=T.[CF]].[CF];                             33180500
                   S:=1;                                                33181000
                   IF MI THEN                                           33181500
                   BEGIN DISKWAIT(J,30,GLOMSIZE|STA+TANKADDRESS+X);     33182000
$INCLUDE 33182101, IF STATISTICS;                                       33182099
                        COUNTUP(16,1);                                  33182100
                        TNAOG[STA].DETANK:=I+1;                         33182500
                        T:=T&(T.[SOUSE]+1)[18:40:8];                    33183000
                   END;                                                 33183500
                   M[J]:=0;                                             33184000
              END ELSE GO DELINKIT                                      33184500
         END ELSE                                                       33185000
         BEGIN DISKWAIT(-H,30,TANKADDRESS+GLOMSIZE|STA+X);              33185500
$INCLUDE 33185601, IF STATISTICS;                                       33185599
              COUNTUP(16,1);                                            33185600
              J:=H+16|(S:=T.NEXTPIECE);                                 33186000
              NUM:=M[H].[CF];                                           33186500
              IF S THEN                                                 33187000
              BEGIN NUM:=NUM-128;                                       33187500
                   GO UPPTRS;                                           33188000
              END ELSE                                                  33188500
              IF NUM GTR 136 THEN NUM:=128 ELSE                         33189000
              BEGIN S:=1;                                               33189500
    UPPTRS:        IF MI THEN                                           33190000
                   BEGIN TNAOG[STA].DETANK:=I+1;                        33190500
                        I:=T.TANKN-I-1;                                 33191000
                   END ELSE                                             33191500
                   T:=T&((X+1) AND NOT GLOMSIZE)[26:41:7]&(I:=T.TANKN-1)33192000
                     [19:41:7];                                         33192500
                   STATABLE[STA]:=(MI2:=(*P(DUP)))&(I GTR 0 OR (M[T]!0  33193000
                     AND T.[CF]!0 AND NOT MI2.SWAPPED))[18:47:1];       33193500
              END;                                                      33194000
              T:=T&(NOT S)[18:47:1];                                    33194500
         END;                                                           33195000
         DCWRITE(J+1,STA,NUM,S);                                        33195500
DELINKIT:                                                               33196000
         IF T.[10:2] ! 0 THEN                                           33196500
         IF GLOMSIZE/5 GEQ T.[SOUSE] THEN                               33197000
         BEGIN                                                          33197500
              IF T.[10:1] THEN                                          33198000
              BEGIN M[(X:=GETAREA(0))+1]:=0;                            33198500
                   M[X]:=0&STA[CTF]&10[18:41:7];                        33199000
                   QUEVENT(X,CANDEMIX[STA]);                            33199500
              END;                                                      33200000
              IF T.[11:1] THEN BRINGBACK(STATABLE[STA].MIXNR);          33200500
              T:=T&0[10:10:2];                                          33201000
         END;                                                           33201500
         HEADOUT:=TANKS[STA].[2:8];                                     33202000
         IF STA=TAILOUT THEN TAILOUT:=0;                                33202500
         TANKS[STA]:=(*P(DUP))&P(NABS(T),XCH)[12:12:2]&0[2:40:8];       33203000
         GO TO RESTART;                                                 33203500
    END;                                                                33204000
    FORGETSPACE(H);                                                     33204500
    WORKING:=FALSE;                                                     33205000
    GO TO NOTHINGTODO;                                                  33205500
END OLDWEIRDHAROLD SURE IS SKINNY;                                      33206000
PROCEDURE DCPERR(T);                                                    33206500
VALUE T;  REAL T;                                                       33207000
BEGIN REAL RCW=+0;                                                      33207500
    REAL   CLASS,STA,STAS,R,T1,T2;                                      33208000
    REAL   I,J,K,L,N;                                                   33208500
    BOOLEAN DISCONNECTED;                                               33209000
    LABEL  FOUND,UNLOAD,RETRY,QRETRY,QUEIT,OK,SETNOTREADY,SETREADY,     33209500
           TESTSPO,TELLUSER,FORGETIT,EXIT;                              33210000
    LABEL L1,L2;                                                        33210500
    LABEL MESS1;                                                        33211000
    DEFINE OKMASK       = @77606727#,                                   33211500
           STATUSOKMASK = @26000000#,                                   33212000
           SPREAD       = 16(DS:=3 RESET; 3(IF SB THEN DS:=SET ELSE     33212500
                          DS:=RESET; SKIP SB))#;                        33213000
%                                                                       33213300
%   DCPERR HANDLES VARIOUS SPECIAL CASES, ACCORDING TO T                33213400
%     T = 0 => FAULT                                                    33213500
%         1 => DCP IS HALTED                                            33213600
%         ANY OTHER VALUE IS THE ADDRESS OF A RESULT WITH AN ERROR      33213700
%                                                                       33213800
    SUBROUTINE FORKIT;                                                  33214000
    BEGIN DISCONNECTED:=TRUE;                                           33214500
         FORK(P(.QUITTER),R,-2,96,0);                                   33215000
    END;                                                                33215500
%                                                                       33216000
    SUBROUTINE LINEDISC;                                                33216500
    BEGIN IF T1.[24:8] LEQ LINETABLE.[18:8] THEN                        33217000
         IF STAS THEN                                                   33217500
         BEGIN R:=-T1;                                                  33218000
              FORKIT;                                                   33218500
         END ELSE                                                       33219000
         BEGIN M[(NT1:=GETAREA(0))+1]:=0&DISCONNECT[1:41:7]&            33219500
                 T1[24:24:8];                                           33220000
              DCPQ(NT1);                                                33220500
              M[(NT1:=GETAREA(0))+1]:=0&LOOKFORRING[1:41:7]&            33221000
                 T1[24:24:8];                                           33221500
              DCPQ(NT1);                                                33222000
         END;                                                           33222500
    END;                                                                33223000
%                                                                       33223500
    SUBROUTINE DISCIT;                                                  33224000
    BEGIN IF STA!0 THEN                                                 33224500
         BEGIN STATABLE[STA].[15:2]:=0;                                 33225000
              R:=STA&6[38:45:3]&(R=STATIONINVALID)[37:47:1];            33225500
              FORKIT;                                                   33226000
         END;                                                           33226500
    END;                                                                33227500
%                                                                       33228000
    SUBROUTINE QUEER;                                                   33228500
    BEGIN M[R:=GETAREA(0)]:=0&(M[T].[5:1] OR STA=0)[5:47:1];            33229000
         M[R+1]:=0&CLASS[1:41:7]&T1[24:24:16]&N[23:47:1];               33229500
         DCPQ(R);                                                       33230000
    END;                                                                33230500
%                                                                       33231000
    SUBROUTINE SPOIT;                                                   33231500
    BEGIN STREAM(I, J, STA, L:=T1.[24:8], S:=T1.[32:8], R:=T2.[8:8],    33232000
                 S1:=(STA=0), S2:=(T2.[1:7] GEQ OKRESULT), T:=T+1,      33232500
                 FILLIT:=0, D:=I:=SPACE(15));                           33233000
         BEGIN FILLIT:=CI; GO TO L1;                                    33233500
              DS:=3 DEC; I:=DI; DI:=DI-3; DS:=2 FILL; DI:=I; CI:=J;     33234000
         L1:  SI:=LOC I;                                                33234500
              SI:=SI+1; DS:=LIT" "; DS:=7 CHR;                          33235000
              SI:=SI+1; DS:=LIT" "; DS:=7 CHR;                          33235500
              S1(DS:=7 LIT", LINE "; SI:=SI+8;                          33236000
                 J:=CI; CI:=FILLIT; SI:=SI+8;                           33236500
                 JUMP OUT TO L2);                                       33237000
              DS:=6 LIT", STA "; J:=CI; CI:=FILLIT;                     33237500
              DS:=2 LIT"-("; J:=CI; CI:=FILLIT;                         33238000
              DS:=LIT"/"; J:=CI; CI:=FILLIT;                            33238500
              DS:=LIT")";                                               33239000
         L2:  DS:=8 LIT", RETRY "; J:=CI; CI:=FILLIT;                   33239500
              S2(DS:=3 LIT" OK");                                       33240000
              DS:=2 LIT"--"; SI:=T;                                     33240500
              2(SPREAD; DS:=2 LIT"  ");                                 33241000
              DS:=LIT"~";                                               33241500
         END;                                                           33242000
         SPOUT(I);                                                      33242500
    END;                                                                33243000
%                                                                       33243500
    IF T=0 THEN                                                         33244000
    BEGIN STREAM(F:=[DCPARRAY[3]],R:=R:=SPACE(10));                     33244500
         BEGIN SI:=F;                                                   33245000
              DS:=14 LIT"**DCP FAULT - ";                               33245500
              2(SPREAD; DS:=2 LIT"  ";);                                33246000
              DS:=LIT"~";                                               33246500
         END;                                                           33247000
         SPOUT(R);                                                      33247500
    END ELSE                                                            33248000
    IF T=1 THEN                                                         33248500
    BEGIN FOR T:=0 STEP 1 UNTIL 7 DO                                    33249000
         IF T!3 AND T!4 THEN                                            33249500
         IF (I:=DCPARRAY[T]).[CF]!0 THEN                                33250000
         IF NOT M[I].[1:1] THEN                                         33250500
           WHILE NOT (R:=I).[24:1] DO FORGETAREA((I:=M[R]).[2:2],R);    33251000
         GO TO NOTHINGTODO;                                             33251500
    END ELSE                                                            33252000
    BEGIN T2:=M[T+2];                                                   33252500
         IF (T1:=M[T+1]).[24:8] LEQ LINETABLE.[18:8] THEN               33253000
         BEGIN STREAM(D:=(LINETABLE+T1.[24:6])&T1[30:30:2]:);           33253500
              BEGIN SI:=D; DI:=LOC D; D:=TALLY;                         33254000
                   DI:=DI+6; DS:=2 CHR;                                 33254500
              END;                                                      33255000
              IF STAS:=((STA:=P)!0) THEN                                33255500
              DO IF (STATABLE[STA] EQV T1).[32:8] = @377 THEN GO FOUND  33256000
                UNTIL (STA:=STATABLE[STA].[40:8])=0;                    33256500
         END;                                                           33257000
%                                                                       33257100
%     STAS = 0 MEANS THAT THERE ARE NO STATIONS ACTIVE ON THE LINE.     33257120
%     STA IS THE INTERNAL STATION NUMBER (IF ANY) OF THE STATION.       33257140
%                                                                       33257160
%   FOR ABORTS, AN ENTERNORMALMODE IS DONE, AND, EXCEPT FOR             33257180
%   SWITCHABORTS AND DISCONNECTABORTS, THE USER AND/OR THE SPO IS       33257200
%   NOTIFIED.                                                           33257220
%   STATUS ERRORS ARE EITHER RETRIED  OR A MESSAGE IS SPOUTED,          33257240
%   DEPENDING ON THE NATURE OF THE ERROR.                               33257260
%   MESSAGERRORS CALL FOR A SETSTATIONREADY, AND A MESSAGE TO THE       33257280
%   USER AND/OR THE SPO, DEPENDING ON THE ERROR.                        33257300
%   FOR ALL OTHER ERRORS, A MESSAGE IS SPOUTED AT THE SPO, BUT          33257320
%   NOTHING ELSE IS DONE.                                               33257340
%                                                                       33257360
%   BITS 6:2 OF THE HEADER OF A REQUEST ARE ERROR FLAGS, AS FOLLOWS:    33257380
%     =2   THIS IS A MESSAGE SENT TO A USER TO INFORM HIM OF AN ERROR.  33257400
%          IF THIS DOESNT GO, HE IS LOGGED OFF.                         33257420
%     =1   FIRST RETRY OF A STATUS ERROR.                               33257440
%     =3   SECOND RETRY OF A STATUS ERROR. THIS IS ALL YOU GET.         33257460
%                                                                       33257480
FOUND:                                                                  33257500
         IF (R:=M[T].[6:2])!0 THEN                                      33258000
         IF R=2 THEN                                                    33258500
         IF (T2 AND OKMASK)!0 THEN                                      33259000
UNLOAD:  IF T1.[1:7]!DISCONNECT THEN                                    33259500
         IF STA!0 THEN                                                  33260000
         BEGIN DISCIT;                                                  33260500
              GO TO TESTSPO;                                            33261000
         END ELSE                                                       33261500
         IF STAS THEN GO TO SETNOTREADY ELSE                            33262000
         BEGIN CLASS:=DISCONNECT;                                       33262500
              GO QUEIT;                                                 33263000
         END ELSE GO TESTSPO                                            33263500
         ELSE ELSE                    % R!2, IMPLIES THIS IS A RETRY    33264000
         IF R=3 THEN                                                    33264500
         BEGIN I:="STATUS "; J:="ERROR  ";                              33265000
              GO TO UNLOAD;                                             33265500
         END ELSE GO RETRY;                                             33266000
%                                                                       33266500
         IF (R:=T2.[1:7])=IGNORED THEN GO FORGETIT;                     33267000
         IF R LEQ ADAPTORFAULT THEN                                     33267500
         BEGIN P(R-1); ::P(.MESS1,+,LOD); I:=P;                         33268000
              IF R LEQ TEXTINVALID THEN                                 33268500
              BEGIN J:="INVALID";                                       33269000
                   IF R=LINEINVALID THEN LINEDISC;                      33269500
                   IF R=STATIONINVALID THEN DISCIT;                     33270000
                   GO TO TESTSPO;                                       33270500
              END;                                                      33271000
              IF R=ADAPTORFAULT THEN                                    33271500
              BEGIN J:="FAULT  ";                                       33272000
                   GO TO TESTSPO;                                       33272500
              END;                                                      33273000
              J:="ABORT  ";                                             33273500
              CLASS:=ENTERNORMALMODE;                                   33274000
              IF R=SWITCHABORTED THEN                                   33274500
              IF NOT T2.CONNECTED THEN I:=0;                            33275000
              IF R=DISCONNECTABORTED THEN LINEDISC;                     33275500
              IF R=LOGICABORTED THEN                                    33276000
              BEGIN K:="NDL    ";                                       33276500
                   L:="ERROR  ";                                        33277000
              END;                                                      33277500
              GO QUEIT;                                                 33278000
MESS1:::      "CLASS  ",  "KEY    ",  "LINE   ",                        33278500
              "STATION",  "FUNCTN ",  "CLSTMSK",                        33279000
              "VARIANT",  "TEXT   ",                                    33279500
              "TRNSMIT",  "RECEIVE",  "LOGIC  ",                        33280000
              0,          "SWITCH ",                                    33280500
              "ADAPTOR";                                                33281000
         END;                                                           33281500
         IF R=TEXTREINITIALIZED THEN                                    33282000
         BEGIN M[T+1]:=T1&REINITIALIZEDOUTPUT[1:41:7];                  33282500
              GO TO QRETRY;                                             33283000
         END;                                                           33283500
         IF R=STATUSERROR THEN                                          33284000
         BEGIN IF (R:=T1.[1:7]) = ENTERNORMALMODE OR (R=DISCONNECT AND  33284500
                NOT T2.CONNECTED) THEN GO FORGETIT;                     33285000
              IF R=OUTPUT OR R=INPUT OR R=ENABLEDINPUT THEN             33285500
              BEGIN IF T2.CONNECTED THEN                                33286000
                   IF R!OUTPUT THEN                                     33286500
                   BEGIN K:="SYSTEM ";  L:="ERROR  ";                   33287000
                        GO TELLUSER;                                    33287500
                   END ELSE GO RETRY;                                   33288000
                   LINEDISC;                                            33288500
                   GO FORGETIT;                                         33289000
              END;                                                      33289500
              IF R LEQ REINITIALIZEDENABLEDINPUT AND                    33290000
                R GEQ REINITIALIZEDOUTPUT THEN                          33290500
              BEGIN IF T2.LINESUSPENDED THEN                            33291000
                   IF (T2 AND STATUSOKMASK)=0 THEN                      33291500
                   BEGIN I:="STATUS "; J:="ERROR  ";                    33292000
                        SPOIT;                                          33292500
                   END;                                                 33293000
                   M[T+1].[1:7]:=R+3;                                   33293500
              END;                                                      33294000
              IF R=RECALLSTATION THEN                                   33294500
              BEGIN CLASS:=SETSTATIONREADY;                             33295000
                   QUEER;                                               33295500
              END;                                                      33296000
RETRY:        CLICK:=CLOCK+P(RTR)+64+640|(M[T].[7:1]);                  33296500
              SLEEP(0,0);                                               33297000
              M[T]:=(*P(DUP))&(IF P(DUP).[7:1] THEN 3 ELSE 1)[6:46:2];  33297500
QRETRY:       DCPQ(T);                                                  33298000
              GO TO EXIT;                                               33298500
         END;                                                           33299000
         IF R GEQ OKRESULT THEN GO TO OK;                               33299500
         IF (T2 AND OKMASK)=1 THEN          % TIMEOUT                   33300000
           IF T1.[1:7]=OUTPUT THEN DISCIT ELSE ELSE                     33300500
         IF T2.BYTEOVERFLOW THEN K:="DCP    " ELSE                      33301000
         IF T2.TRANSMISSIONUMBERERROR AND (T2 AND OKMASK)=0 THEN        33301500
         BEGIN L:=1; GO TO L1;                                          33302000
         END ELSE                                                       33302500
         IF T2.ENDOFBUFFER THEN                                         33303000
         BEGIN                                                          33303500
L1:           STREAM(L,K:=(K:=GETAREA(1))+3);                           33304000
              BEGIN DS:=4 LIT"!-!*";                                    33304500
                   CI:=CI+L; GO TO L1;                                  33305000
                   DS:=25 LIT"TRANSMISSION NUMBER ERROR";               33305500
                   GO TO L2;                                            33306000
            L1:    DS:=29 LIT"DECLARED BUFFER SIZE EXCEEDED";           33306500
            L2:    DS:=23 LIT" - DATA MAY BE LOST!-!*";                 33307000
              END;                                                      33307500
              M[K+1]:=IF L THEN 52 ELSE 56;                             33308000
              GO SETREADY;                                              33308500
         END ELSE                                                       33309000
OK:      IF T2.PARITYFLAG THEN I:="PARITY " ELSE                        33309500
         IF T2.BCCCHECK THEN I:="BCC    " ELSE                          33310000
         IF T2.CARRIERLOST THEN                                         33310500
         BEGIN I:="CARRIER";                                            33311000
              J:="LOST   ";                                             33311500
              GO TO L2;                                                 33312000
         END ELSE                                                       33312500
         IF T2.ADDRESSFLAG THEN I:="ADDRESS" ELSE                       33313000
         IF T2.FORMATERROR THEN I:="FORMAT " ELSE                       33313500
         IF T1.[1:7] GEQ OKRESULT THEN GO FORGETIT;                     33314000
         J:="ERROR  ";                                                  33314500
L2:      IF R LSS OKRESULT THEN                                         33315000
         BEGIN K:=I;  L:=J;                                             33315500
SETREADY:     N:=1;                                                     33316000
SETNOTREADY:  CLASS:=SETSTATIONREADY;                                   33316500
QUEIT:        IF CLASS!0 THEN QUEER;                                    33317000
         END;                                                           33317500
TESTSPO:                                                                33318000
         IF I!0 THEN SPOIT;                                             33318500
         IF K!0 THEN                                                    33319000
         BEGIN                                                          33319500
TELLUSER:     IF L GTR 8 THEN                                           33320000
              BEGIN STREAM(K,L,D:=(K:=GETAREA(1))+3);                   33320500
                   BEGIN DS:=4 LIT"!-!*";                               33321000
                        SI:=LOC K; SI:=SI+1; DS:=7 CHR;                 33321500
                        SI:=SI+1; DS:=7 CHR;                            33322000
                        DS:=23 LIT" - DATA MAY BE LOST!-!*";            33322500
                   END;                                                 33323000
                   M[K+1]:=41;                                          33323500
              END;                                                      33324000
              M[K+1]:=(*P(DUP))&OUTPUT[1:41:7]&T1[24:24:16];            33324500
              M[K]:=0&22[3:43:5];                                       33325000
              DCPQ(K);                                                  33325500
         END;                                                           33326000
FORGETIT:                                                               33326500
         IF STA!0 THEN                                                  33327000
         IF T1.[1:7]=RECALLSTATION THEN STATABLE[STA].[22:1]:=1 ELSE    33327500
         BEGIN IF NOT DISCONNECTED THEN                                 33328000
              IF STATABLE[STA].OUTPUTANKING THEN                        33328500
              IF TANKS[STA].DCPMESSAGES LSS 2 THEN                      33329000
              IF TANKS[STA].[2:8]=0 AND STA!TAILOUT THEN                33329500
              BEGIN TANKLINE[TAILOUT]:=STA;                             33330000
                   TAILOUT:=STA;                                        33330500
                   STARTWORKING;                                        33331000
         END  END;                                                      33331500
         FORGETAREA(M[T].[2:2],T);                                      33332000
    END;                                                                33332500
EXIT:                                                                   33333000
    IF STA!0 THEN STATABLE[STA].ERRORS:=0;                              33333500
    KILL([RCW] INX NOT 2);                                              33334000
END;                                                                    33334500
PROCEDURE NEWLINE(R);                                                   33335000
VALUE R;  REAL R;                                                       33335500
%                                                                       33335600
%   NEWLINE SETS ALL STATIONS ON THE LINE READY, ENABLES INPUT,         33335650
%   AND ASKS FOR USERCODE. THE RESULTANT INPUT WILL ACTIVATE THE        33335700
%   STATIONS.  IF WE EVER DO DIAL-UP POLL LINES, THIS PROCEDURE WILL    33335750
%   HANDLE FINDING THE PROPER ADDRESSES.                                33335800
%                                                                       33335850
BEGIN REAL A,I,J,L,X;                                                   33336000
    DISKWAIT(-(A:=SPACE(30)),30,TNAOG[0]+(X:=((L:=R.[24:8])+1) DIV 30));33336500
    X:=M[A+L+1-30|X].[CF]-1;                                            33337000
    FORGETSPACE(A);                                                     33337500
    FOR I:=0 STEP 1 UNTIL X DO                                          33338000
    BEGIN R:=R&I[32:40:8]&1[23:47:1];                                   33338500
         M[A:=GETAREA(0)]:=0&1[5:47:1];                                 33339000
         M[A+1]:=R&SETSTATIONREADY[1:41:7];                             33339500
         DCPQ(A);                                                       33340000
         M[A:=GETAREA(0)]:=0&1[5:47:1];                                 33340500
         M[A+1]:=R&ENABLEINPUT[1:41:7];                                 33341000
         DCPQ(A);                                                       33341500
         STREAM(J:=0: L, I, D:=(A:=GETAREA(2))+3);                      33342000
         BEGIN DS:=34 LIT"!-!*B5700 TIME SHARING WITH DCP - ";          33342500
              SI:=LOC L; D:=DI; DI:=LOC J;                              33343000
              DS:=3 DEC; DS:=3 DEC; DS:=LIT"A";                         33343500
              SI:=LOC J; DI:=D;                                         33344000
         LL:  IF SC="0" THEN                                            33344500
              BEGIN SI:=SI+1; TALLY:=TALLY+1;                           33345000
                   IF SC!"0" THEN DS:=2 CHR ELSE                        33345500
                   BEGIN SI:=SI+1; TALLY:=TALLY+1; DS:=CHR END          33346000
              END ELSE DS:=3 CHR;                                       33346500
              IF SC GEQ "0" THEN                                        33347000
              BEGIN DS:=LIT"/"; GO TO LL END;                           33347500
              J:=TALLY;                                                 33348000
              DS:=30 LIT"!-!*ENTER USER CODE, PLEASE - ";               33348500
         END;                                                           33349000
         J:=71-P;                                                       33349500
         M[A]:=0&9[2:44:4];                                             33350000
         M[A+1]:=R&OUTPUT[1:41:7]&J[40:40:8];                           33350500
         DCPQ(A);                                                       33351000
         CLICK:=CLOCK+P(RTR)+120|(BIGUNS LEQ BIGUNMIN+1);               33351500
         SLEEP(0,0);                                                    33352000
    END;                                                                33352500
    KILL([R] INX NOT 1);                                                33353000
END;                                                                    33353500
SAVE PROCEDURE UPREQUESTQ;                                              33354000
BEGIN                                                                   33354500
    IF (REQUESTQ AND NOT MYREQUEST).[24:1] THEN                         33355000
    BEGIN REQUESTQ:=MYREQUEST;                                          33355500
         MYREQUEST:=QMASK&[MYREQUEST][9:33:15];                         33356000
         SETATTENTION;                                                  33356500
    END;                                                                33357000
END;                                                                    33357500
SAVE PROCEDURE DCPQ(ADDR);                                              33358000
VALUE ADDR;  REAL ADDR;                                                 33358500
BEGIN                                                                   33359000
    IF DCPTOG THEN                                                      33359500
    BEGIN M[M[MYREQUEST.[9:15]]:=(*P(DUP))&ADDR[24:24:24]].[24:1]:=1;   33360000
         MYREQUEST.[9:15]:=ADDR;                                        33360500
         M[ADDR+2]:=0;                                                  33361000
         UPREQUESTQ;                                                    33361500
    END ELSE FORGETAREA(M[ADDR].[2:2],ADDR);                            33362000
END;                                                                    33362500
SAVE PROCEDURE DCPINTERRUPT;                                            33363000
BEGIN                                                                   33363500
    REAL A,B,I;                                                         33364000
    SUBROUTINE QAREAS;                                                  33364500
         FOR I:=0 STEP 1 UNTIL 4 DO                                     33365000
         IF BIGUNS!0 THEN M[B].[CF]:=B:=GETAREA(1);                     33365500
%                                                                       33366000
%   IF THE DCP IS OUT OF SPACE, WE GET IT SOME. OTHERWISE, IT IS        33366100
%   ASSUMED TO BE A FAULT.                                              33366200
%                                                                       33366300
    IF DCPTOG THEN                                                      33366500
    IF SPACEQ.[24:1] THEN                                               33367000
    BEGIN A:=B:=GETAREA(1);                                             33367500
         QAREAS;                                                        33368000
         IF LMAX GEQ 30 THEN                                            33368500
         IF BIGUNS LEQ BIGUNMIN+2 THEN QAREAS;                          33369000
         M[B].[24:1]:=1;                                                33369500
         SPACEQ:=A;                                                     33370000
    END ELSE                                                            33370500
    BEGIN FORK(P(.DCPERR),0,-2,0,1);                                    33371000
         DCPTOG:=0;                                                     33371500
    END;                                                                33372000
    GO TO EXTERNAL;                                                     33372500
END;                                                                    33373000
PROCEDURE DCPHANDLER;                                                   33373500
BEGIN REAL STA,CLASS,LINE,TN,FIRSTSTA;                                  33374000
    REAL I=NT3,J=NT4,T=NT5;                                             33374500
    REAL HEADER1,HEADER2,HEADER3,R,RESULT;                              33375000
%   THIS PROCEDURE PROCESSES THE RESULT QUEUE.                          33375250
    LABEL NEWSTA,HITHERE,FOUND,WHOARTHOU,AROUND,DELINK,FORKIT,          33375500
          TESTFERERRS,CHECKFLAGS,ERROR,FORG,ERREX;                      33376000
     DEFINE OKMASK       = @77606727#;                                  33376500
%                                                                       33377000
    SUBROUTINE DELINKIT;                                                33377500
    BEGIN                                                               33378000
         FORK(P(.QUITTER),I,-2,96,0);                                   33378500
    END;                                                                33379000
%                                                                       33379500
    SUBROUTINE TESTFOROUTPUT;                                           33380000
    BEGIN                                                               33380500
              IF STATABLE[STA].[18:2] = 2 THEN                          33381000
              IF (T:=TANKS[STA]).DCPMESSAGES LSS 2 THEN                 33381500
              IF T.[2:8]=0 THEN                                         33382000
              IF TAILOUT!STA THEN                                       33382500
              BEGIN TANKLINE[TAILOUT]:=STA;                             33383000
                   TAILOUT:=STA;                                        33383500
                   STARTWORKING;                                        33384000
              END;                                                      33384500
    END;                                                                33385000
%                                                                       33385500
    SUBROUTINE GIVEITUP;                                                33386000
    BEGIN                                                               33386500
         GIVEAWAY(TN.[CF],NT1);                                         33387000
         TN:=TN&0[25:25:23];                                            33387500
    END;                                                                33388000
%                                                                       33388500
    SUBROUTINE FORKHELLO;                                               33389000
    BEGIN                                                               33389500
         M[(T:=GETAREA(0))+1]:=STA;                                     33390000
         M[T+2]:=HEADER2;                                               33390500
         FORK(P(.HELLO),T,-2,128,1);                                    33391000
    END;                                                                33391500
%                                                                       33391600
%   THE STEPS TAKEN WITH A RESULT ARE:                                  33391650
%   1. CHECK FOR SPECIAL CASES FOR WHICH THERE IS NO INTERNAL           33391700
%      STATION NUMBER AND JUST LOOK FOR ERROR CONDIT. THE               33391750
%      5:1 BIT OF WORD ZERO IMPLIES THERE IS NO STATION NUMBER FOR      33391800
%      THIS REQUEST.                                                    33391850
%   2. FIND THE STATION NUMBER. ACTIVE STATIONS FOR A LINE ARE LINKED   33391900
%      THROUGH THE 40:8 FIELD OF STATBLE. THE HEAD OF THE LINKS IS IN   33391950
%      LINETABLE.                                                       33392000
%   3. IF IT IS A NEW STATION, FIND AN AVAILABLE SLOT, GIVE IT TO HIM   33392050
%      AND FORK HELLO.                                                  33392100
%                                                                       33392150
  DO BEGIN                                 % LOOP WHILE DCPTOG          33392500
    WHILE NOT RESULTQ.[24:1] DO   %SOMETHING IS IN THE QUEUE            33393000
    BEGIN UPREQUESTQ;                                                   33393500
         HEADER1:=M[R:=RESULTQ.[CF]];                                   33394000
         HEADER2:=M[R+1];                                               33394500
         HEADER3:=M[R+2];                                               33395000
%                                                                       33395500
         STA:=0;                                                        33396000
         RESULT:=HEADER3.[1:7];                                         33396500
         IF (CLASS:=HEADER2.[1:7])=NULL OR CLASS=DISCONNECT OR          33397000
            CLASS=LOOKFORRING OR HEADER1.[5:1] THEN GO TESTFERERRS;     33397500
         IF CLASS=ANSWER THEN                                           33398000
         BEGIN FORK(P(.NEWLINE),HEADER2,-2,128,1);                      33398500
              GO TO FORG;                                               33399000
         END;                                                           33399500
         IF RESULT=STATUSPRESENT THEN                                   33400000
         BEGIN IF NOT HEADER3.CONNECTED THEN                            33400500
              BEGIN I:=HEADER2&16[1:43:5];                              33401000
                   GO FORKIT;                                           33401500
              END ELSE                                                  33402000
              GO TO FORG;                                               33402500
         END;                                                           33403000
%                                                                       33403500
         STREAM(N:=HEADER2.[30:2]:D:=LINETABLE+HEADER2.[24:6]);         33404000
         BEGIN SI:=D; SI:=SI+N; SI:=SI+N;                               33404500
              DI:=LOC N; DI:=DI+6; DS:=2 CHR;                           33405000
         END;                                                           33405500
         IF (FIRSTSTA:=STA:=P)=0 THEN GO TO NEWSTA;                     33406000
         J:=HEADER2.[32:8];                                             33406500
         DO IF STATABLE[STA].[32:8]=J THEN GO TO FOUND                  33407000
         UNTIL (STA:=STATABLE[I:=STA].[40:8])=0;                        33407500
NEWSTA:  IF RESULT LEQ MESSAGERROR THEN                                 33408000
         IF NOT (RESULT=MESSAGERROR AND HEADER3.WRU) THEN GO TO ERROR;  33408500
         FOR STA:=1 STEP 1 UNTIL STAMAX DO                              33409000
         IF STATABLE[STA]=0 THEN GO TO HITHERE;                         33409500
         STA:=0;                                                        33409600
         IF RESULT!REQUESTCONTINUED THEN FORKHELLO;                     33410000
         GO TO FORG;                                                    33410500
HITHERE:                                                                33411000
         STATABLE[STA]:=0&3[15:46:2]&(CANDYINX+160)[2:40:8]&            33411500
           HEADER2[24:24:16]&FIRSTSTA[40:40:8];                         33412000
         STREAM(STA:=FIRSTSTA:=STA,D:=(LINETABLE+HEADER2.[24:6])        33412500
                &HEADER2[30:30:2]);                                     33413000
         BEGIN SI:=LOC STA; SI:=SI+6;                                   33413500
              DS:=2 CHR;                                                33414000
         END;                                                           33414500
         FORKHELLO;                                                     33415000
FOUND:                                                                  33415500
         P([STATABLE[STA]],IOR);                                        33416000
         TN:=TNAOG[STA];                                                33416500
%                                                                       33416600
%   INPUT IS QUEUED IN TNOAG[STA].[CF]. THE 25:8 FIELD IS USED FOR      33416700
%   KEEPING THE NUMBER OF CHARACTERS QUEUED. WE PASS TO HARRY IF THIS   33416800
%   EXCEEDS 224 OR AFTER EOR OR EOM. RESULTS LEQ TEXTREINITIALIZED      33416900
%   REQUIRE THAT ALL THAT WE HAVE BE DELETED. IF AN OKRESULT HAS        33417000
%   ERROR BITS, WE COPY THE HEADER AND FORK DCPERR.                     33417100
%                                                                       33417200
         IF CLASS=ENABLEDINPUT OR CLASS=REINITIALIZEDENABLEDINPUT THEN  33417500
         BEGIN                                                          33418000
              IF RESULT LEQ TEXTREINITIALIZED THEN                      33418500
              BEGIN I:=TN;                                              33419000
                   WHILE (J:=I.[CF])!0 DO FORGETAREA((I:=M[J]).[2:2],J);33419500
                   M[I:=GETAREA(0)]:=0&STA[10:40:8];                    33420000
                   GIVEAWAY(I,8);                                       33420500
                   TNAOG[STA]:=TN&0[25:25:23];                          33421000
                   IF RESULT=TEXTREINITIALIZED THEN                     33421500
                   BEGIN M[R+1]:=0&REINITIALIZEDENABLEDINPUT[1:41:7]&   33422000
                          HEADER2[24:24:16];                            33422500
                        DCPQ(R);                                        33423000
                        GO TO ERREX;                                    33423500
                   END;                                                 33424000
                   IF HEADER3.WRU THEN                                  33424500
                   BEGIN P(3);                                          33425000
                        GO TO DELINK;                                   33425500
                   END;                                                 33426000
                   IF RESULT=IGNORED THEN GO CHECKFLAGS ELSE GO ERROR;  33426500
              END;                                                      33427000
              IF (NT2:=TN.[25:8]+HEADER2.TEXTLENGTH) GTR 232 THEN       33427500
              BEGIN NT1:=1;                                             33428000
                   GIVEITUP;                                            33428500
                   NT2:=HEADER2.TEXTLENGTH;                             33429000
              END;                                                      33429500
              IF (I:=TN.[CF])=0 THEN J:=0 ELSE                          33430000
              BEGIN M[I].[CF]:=R;                                       33430500
                   J:=0&I[CTF];                                         33431000
              END;                                                      33431500
              M[R]:=(*P(DUP))&STA[10:40:8]&J[18:18:30];                 33432000
              TN:=TN&R[CTC]&NT2[25:40:8];                               33432500
              IF RESULT ! REQUESTCONTINUED THEN                         33433000
              BEGIN IF RESULT=OKRESULT THEN                             33433500
                   BEGIN TESTFOROUTPUT;                                 33434000
                        P(4);                                           33434500
                   END ELSE P(2);                                       33435000
                   NT1:=P;                                              33435500
                   GIVEITUP;                                            33436000
                   IF HEADER3.WRU THEN                                  33436500
                   BEGIN I:=STA&3[33:41:7];                             33437000
                        DELINKIT;                                       33437500
                   END;                                                 33438000
                   IF (HEADER3 AND OKMASK) ! 0 THEN                     33438500
                   BEGIN T:=GETAREA(1);                                 33439000
                        MOVE(10,R,T);                                   33439500
                        R:=T;                                           33440000
                        TNAOG[STA]:=TN;                                 33440500
                        GO TO ERROR;                                    33441000
              END  END;                                                 33441500
              TNAOG[STA]:=TN;                                           33442000
              GO TO ERREX;                                              33442500
         END;                                                           33443000
%                                                                       33443100
%   FOR OUTPUT, WE FIRST UPDATE THE POINTERS ACCORDING TO THE RESULT.   33443150
%   THEN IF STATABLE[STA].DISCIT IS ON, AND THER IS NO MORE OUTPUT,     33443200
%   WE LOG OFF THE USER. THIS IS DONE BY SENDING A DISABLE INPUT        33443250
%   AND THEN FORKING QUITTER TO DO ALL THE DIRTY WORK.                  33443300
%                                                                       33443350
         IF CLASS=OUTPUT OR CLASS=REINITIALIZEDOUTPUT THEN              33443500
         BEGIN                                                          33444000
              IF NAKSTA[STA] THEN                                       33444500
              BEGIN                                                     33445000
                   T:=TANKS[STA];                                       33445500
                   IF RESULT=TEXTREINITIALIZED THEN                     33446000
                   BEGIN STATABLE[STA]:=(*P(DUP))&1[18:47:1]&1[21:47:1];33446500
                        TANKS[STA]:=T&TN[18:2:1];                       33447000
                        P(TN&0[11:11:14]&P(DUP)[10:2:1]);               33447500
                   END ELSE                                             33448000
                   IF RESULT=REQUESTCONTINUED THEN                      33448500
                        IF HEADER1.[4:1] THEN                           33449000
                        P(ABS(TN)&(P(DUP).DCPSEG+1)[10:40:8]) ELSE      33449500
                        P(TN&1[10:47:1])                                33450000
                   ELSE                                                 33450500
                   BEGIN IF T GEQ 0 THEN SLEEP([TANKS[STA]],-0);        33451000
                        TANKS[STA]:=(*P(DUP))&((P(DUP).TANKL+           33451500
                          (I:=(TN:=TNAOG[STA]).DCPSEG+HEADER1.[4:1]))   33452000
                          AND NOT GLOMSIZE)[26:41:7]&(P(DUP).TANKN-I)   33452500
                          [TANKNDIAL];                                  33453000
                        P(TN&0[10:10:8]&(P(DUP).DETANK-I)[18:41:7]);    33453500
                        IF RESULT=INCOMPLETEREQUEST THEN                33454000
                        BEGIN P(P&HEADER1[2:4:1] OR 0&HEADER2[2:40:8],  33454500
                             [TNAOG[STA]],STD);                         33455000
                             GO AROUND;                                 33455500
                        END;                                            33456000
                        P(ABS(P)&(NOT HEADER1)[2:4:1]&P(DUP)[10:2:1]    33456500
                          &0[3:3:7]);                                   33457000
                   END;                                                 33457500
                   P([TNAOG[STA]],STD);                                 33458000
              END;                                                      33458500
              TANKS[STA]:=(*P(DUP))&(I:=P(DUP).DCPMESSAGES-1)[12:46:2]; 33459000
AROUND:       IF RESULT LEQ MESSAGERROR THEN                            33459500
              BEGIN IF HEADER3.BROKEN THEN                              33460000
                   BEGIN STATABLE[STA].DISCIT:=0;                       33460500
                        P(2); GO DELINK;                                33461000
                   END ELSE IF RESULT=IGNORED THEN ELSE GO ERROR;       33461500
              END;                                                      33462000
              IF I=0 THEN                                               33462500
              IF STATABLE[STA].DISCIT THEN                              33463000
              BEGIN M[(I:=GETAREA(0))+1]:=0&HEADER2[24:24:16]&          33463500
                     ENABLEINPUT[1:41:7];                               33464000
                   DCPQ(I);                                             33464500
                   STATABLE[STA]:=(*P(DUP))&0[15:15:2];                 33465000
                   P(6);                                                33465500
DELINK:            I:=STA&P(XCH)[33:41:7];                              33466000
FORKIT:            DELINKIT;                                            33466500
                   GO TO FORG;                                          33467000
              END;                                                      33467500
              TESTFOROUTPUT;                                            33468000
              GO CHECKFLAGS;                                            33468500
         END;                                                           33469000
TESTFERERRS:                                                            33469500
         IF CLASS=RECALLSTATION THEN STATABLE[STA].[22:1]:=1;           33470000
         IF RESULT LSS OKRESULT THEN GO TO ERROR;                       33470500
CHECKFLAGS:                                                             33471000
         IF (HEADER3 AND OKMASK)!0 THEN                                 33471500
         BEGIN                                                          33472000
              IF RESULT!STATUSPRESENT THEN ELSE GO TO FORG;             33472500
ERROR:        FORK(P(.DCPERR),R,0,0,1);                                 33473000
              IF STA!0 THEN STATABLE[STA].ERRORS:=1;                    33473500
         END ELSE                                                       33474000
FORG:         FORGETAREA(HEADER1.[2:2],R);                              33474500
ERREX:   RESULTQ:=HEADER1;                                              33475000
    END WHILE LOOP;                                                     33475500
    SETATTENTION;                                                       33476000
%                                                                       33476500
    CLICK:=CLOCK+P(RTR)+128;                                            33477000
    COMPLEXSLEEP(NOT RESULTQ.[24:1]);                                   33477500
  END UNTIL NOT DCPTOG;                                                 33478000
  DCPERR(1);                                                            33478500
END;                                                                    33479000
PROCEDURE DCPFILECHANGER(BUFF);                                         33479500
VALUE BUFF; REAL BUFF;                                                  33480000
BEGIN REAL X,X1,X2,X3,X4,X5,X6;                                         33480500
%                                                                       33480900
%   THIS PROCEDURE CHANGES THE DCP CODE FILE. THE NAME IS KEPT          33481000
%   IN DISK SEGMENT 995.                                                33481100
%                                                                       33481200
    STREAM(A:=1:BUFF,X:=[X]);                                           33481500
    BEGIN SI:=BUFF;                                                     33482000
    L:   IF SC = " " THEN BEGIN SI:=SI+1;  GO TO L END;                 33482500
         IF SC = "~" THEN DS:=16 LIT "0CODE   0DCP    " ELSE            33483000
         BEGIN   DS:=16 LIT "0       ";  DI:=X;  DI:=DI+1;              33483500
              7(IF SC = "/" THEN JUMP OUT ELSE DS:=CHR);                33484000
              IF SC = "/" THEN SI:=SI+1 ELSE                            33484500
              BEGIN A:=TALLY;   GO TO OT END;                           33485000
              DI:=X;   DI:=DI+9;                                        33485500
              7(IF SC = "~" THEN JUMP OUT ELSE DS:=CHR);                33486000
         END;                                                           33486500
    OT:                                                                 33487000
    END OF STREAM;                                                      33487500
    BUFF:=BUFF.[15:15]-1;                                               33488000
    IF P THEN                                                           33488500
    BEGIN                                                               33489000
         DISKWAIT(-(X3:=SPACE(30)),-30,DCPDSK);                         33489500
         IF (X4:=DIRECTORYSEARCH(X,X1,17)) = 0 THEN                     33490000
              STREAM(X:=[X],BUFF);                                      33490500
              BEGIN   SI:=X;   SI:=SI+1;                                33491000
                      DS:=9 LIT "#NO FILE ";   DS:=7 CHR;               33491500
                      DS:=1 LIT "/";   SI:=SI+1;   DS:=7 CHR;           33492000
                      DS:=1 LIT "~";                                    33492500
              END                                                       33493000
         ELSE                                                           33493500
         BEGIN X6:=M[X4+4].[16:20]+M[X4+9].[9:20];                      33494000
              FORGETSPACE(X4);                                          33494500
              IF X6!0 THEN                                              33495000
              BEGIN                                                     33495500
                   STREAM(X:=[X],BUFF);                                 33496000
                   BEGIN   SI:=X;   SI:=SI+1;                           33496500
                           DS:= 22 LIT "#DCP FILE NOT CHANGED ";        33497000
                           DS:=7 CHR;   DS:=1 LIT "/";   SI:=SI+1;      33497500
                           DS:=7 CHR;   DS:=8 LIT " IN USE~";           33498000
                   END;                                                 33498500
                   P(DIRECTORYSEARCH(-X,X1,16),DEL);                    33499000
              END ELSE                                                  33499500
              BEGIN STREAM(X5:=(X5:=X3+3|SYSNO)+1:); % TEMP UNTIL GET   33500000
                   BEGIN SI:=X5; TALLY:=1;           % COLD-COOL START  33500500
                        IF SC!"0" THEN TALLY:=0 ELSE % TO FIX DCPDSK    33501000
                        BEGIN SI:=SI+8;                                 33501500
                             IF SC!"0" THEN TALLY:=0;                   33502000
                        END;                                            33502500
                        X5:=TALLY;                                      33503000
                   END;                                                 33503500
                   IF P THEN                                            33504000
                     P(DIRECTORYSEARCH(-M[X5+1],M[X5+2],16),DEL);       33504500
                   M[X5+1]:=X;                                          33505000
                   M[X5+2]:=X1;                                         33505500
                   M[X5]:=X4;                                           33506000
                   STREAM(X:=[X],BUFF);                                 33506500
                   BEGIN   SI:=X;   SI:=SI+1;                           33507000
                           DS:=22 LIT "NEXT DCP FILE WILL BE ";         33507500
                           DS:=7 CHR;   SI:=SI+1;   DS:=1 LIT "/";      33508000
                           DS:=7 CHR;   DS:=1 LIT "~";                  33508500
                   END;                                                 33509000
              END;                                                      33509500
         END;                                                           33510000
         DISKWAIT(X3,-30,DCPDSK);                                       33510500
         FORGETSPACE(X3);                                               33511000
    END;                                                                33511500
    SPOUT(BUFF);                                                        33512000
END OF CHANGING DCP CODE FILE;                                          33512500
PROCEDURE INITIALIZEDCP;                                                33513000
BEGIN REAL RCW=+0,X,X1,X2,X3,X4,X5,X6,X7,B,C,I,L,R;                     33513500
    ARRAY A[*];                                                         33514000
    BOOLEAN NOGO=X7;                                                    33514500
    LABEL L2,L3,XOUT,SPOUTER,INTERR,CHECKIT,EXIT;                       33515000
    DEFINE DCPMASK = @3760000000000000#;                                33515500
%                                                                       33516000
    SUBROUTINE BUILDSQ;                                                 33516500
    BEGIN                                                               33517000
         FOR I:=0 STEP 1 UNTIL 4 DO M[X1].[CF]:=X1:=GETAREA(1);         33517500
         M[X1].[24:1]:=1;                                               33518000
    END;                                                                33518500
%                                                                       33518600
%   THE STEPS TAKEN TO INTIALIZE ARE:                                   33518650
%     1. MAKE SURE THAT THE TANKS ARE OK.                               33518700
%     2. INITIALIZE THE DCP IF IT IS NOT RUNNING.                       33518750
%     3. INITIALIZE THE LINES AND STATIONS.                             33518800
%     4. CLEAN UP STATABLE.                                             33518850
%                                                                       33519000
    X2:=SPACE(10);                                                      33519500
    NOGO:=(SYSDISKADR=0);                                               33520000
    IF PROGTANK=0 THEN NOGO:=NOGO OR                                    33520500
    (PROGTANK:=GETUSERDISK((STAMAX+1)|CLUMPSIZE OR MEMORY))=0;          33521000
    IF TANKADDRESS=0 THEN NOGO:=NOGO OR                                 33521500
    (TANKADDRESS:=GETUSERDISK((STAMAX+1)|GLOMSIZE OR MEMORY))=0;        33522000
    IF BASEDISKADR=0 THEN NOGO:=NOGO OR                                 33522500
    (BASEDISKADR:=GETUSERDISK(-TANKCHUNKSIZE OR MEMORY))=0;             33523000
    IF NOGO THEN                                                        33523500
    BEGIN STREAM(X2);                                                   33524000
         DS:=33 LIT"-*NO USER DISK FOR DATACOM TANKS~";                 33524500
         GO TO SPOUTER;                                                 33525000
    END;                                                                33525500
%                                                                       33526000
    DISKWAIT(-(B:=SPACE(30)),30,DCPDSK);                                33526500
    MULTITABLE[30]:=M[B+3|SYSNO+1];                                     33527000
    LABELTABLE[30]:=-M[B+3|SYSNO+2];                                    33527500
    IF DCPTOG THEN FORGETSPACE(X2) ELSE                                 33528000
    BEGIN                                                               33528500
%                                                                       33528600
%   THE DCP BOOTSTRAP LOADER IS LOADED INTO X3. THE CODE IS READ IN     33528650
%   300 WORD BLOCKS INTO X6. THE DCP USES 1:7 OF @202 FOR               33528700
%   COMMUNICATION AS FOLLOWS:                                           33528750
%     =1  LOAD NEXT BLOCK INTO X6.                                      33528800
%     =3  FAULT OCCURRED.                                               33528850
%     =7  LOAD COMPLETED.                                               33528900
%                                                                       33528950
         DISKWAIT(-B,30,M[B+SYSNO|3].[18:15]);                          33529000
         DISKWAIT(-(X3:=SPACE(60)),60,M[X:=B+10]+10);                   33529500
         P(M[3]);                                                       33530000
         M[3]:=FLAG(@0400003244000031&X3[8:33:8]&X3[32:41:7]);          33530500
         M[4]:=@2000020013600000;                                       33531000
         I:=11;                                                         33531500
         X4:=(X5:=(TNAOG[0]:=M[X])+14)+M[B+8]-14;                       33532000
         X6:=SPACE(300);                                                33532500
L2:                                                                     33533000
         DISKWAIT(-X6,300,X5);                                          33533500
L3:      IF I=11 THEN                                                   33534000
         BEGIN IF NOT DCPLOAD THEN SLEEP([TOGLE],DCPLOADMASK);          33534500
              DCPLOAD:=0;                                               33535000
              HALTDCP;                                                  33535500
              CLICK:=CLOCK+P(RTR)+1;                                    33536000
              SLEEP(0,0);                                               33536500
              A:=DCPARRAY;                                              33537000
              DCPARR:=(DCPARRAY INX 0)&X6[9:33:15];                     33537500
              INITIATEDCP;                                              33538000
         END ELSE BEGIN DCPARR.[1:7]:=0; SETATTENTION END;              33538500
         CLICK:=CLOCK+P(RTR)+120;                                       33539000
         SLEEP([DCPARR],DCPMASK);                                       33539500
%                                                                       33540000
         IF I=11 THEN P(3,STD);                                         33540500
         IF NOGO:=((X1:=DCPARR.[1:7]) = 0) THEN                         33541000
         BEGIN STREAM(X2); DS:=16 LIT"-*DCP NOT READY~";                33541500
              GO TO XOUT;                                               33542000
         END;                                                           33542500
         IF NOGO:=(X1=3) THEN                                           33543000
         BEGIN STREAM(X2); DS:=18 LIT"DCP FAULT ON LOAD~";              33543500
              GO TO XOUT;                                               33544000
         END;                                                           33544500
%                                                                       33545000
         IF X1=1 THEN                                                   33545500
         BEGIN I:=I+5;                                                  33546000
              IF (X5:=X5+10) GTR X4 THEN                                33546500
              BEGIN DISKWAIT(-X6,X1:=30|(X4-X5+10),X5-10);              33547000
                   IF I-5+X1/60 LSS M[B+7] THEN                         33547500
                   BEGIN DISKWAIT(-(X6+X1),300-X1,M[X:=X+1]);           33548000
                        X4:=M[X]+M[B+8];                                33548500
                        X5:=M[X]+10-X1/30;                              33549000
                        GO TO L3;                                       33549500
                   END ELSE GO TO L3;                                   33550000
              END ELSE                                                  33550500
              IF X5=X4 THEN X4:=(X5:=M[X:=X+1])+M[B+8];                 33551000
              GO TO L2;                                                 33551500
         END;                                                           33552000
%                                                                       33552500
         DCPTOG:=1;                                                     33553000
         STREAM(X2); DS:=16 LIT"DCP INITIALIZED~";                      33553500
XOUT:                                                                   33554000
         DCPARRAY:=A;                                                   33554500
         DCPLOAD:=1;                                                    33555000
         FORGETSPACE(X6);                                               33555500
         FORGETSPACE(X3);                                               33556000
SPOUTER:                                                                33556500
         SPOUT(X2);                                                     33557000
         IF NOGO THEN                                                   33557500
         BEGIN FORGETSPACE(B);                                          33558000
              MULTITABLE[30]:=@114;                                     33558500
              LABELTABLE[30]:=0;                                        33559000
              GO TO EXIT;                                               33559500
         END;                                                           33560000
    END;                                                                33560500
    MYREQUEST:=(RESULTQ:=REQUESTQ:=QMASK)&[MYREQUEST][9:33:15];         33561000
    X1:=DCPSPACEQ:=GETAREA(1); BUILDSQ;                                 33561500
%                                                                       33561600
%   INITIALIZE THE QUEUES AND LINETABLE. LINETABLE IS ADJUSTED TO FIT   33561700
%   THE DECLARED NUMBER OF LINES.                                       33561800
%                                                                       33561900
    X1:=SPACEQ:=GETAREA(1); BUILDSQ;                                    33562000
    A:=IOQUE&B[CTC];                                                    33562500
    DISKWAIT(-B,30,TNAOG[0]);                                           33563000
    IF (X:=A[0]) GTR 256 THEN X:=256;                                   33563500
    IF (X1:=(X+3).[40:6]) LEQ ((X2:=M[X3:=LINETABLE-2].[CF] -           33564000
      LINETABLE.[CF]) - DELTA) THEN                                     33564500
    BEGIN X2:=(LINETABLE:=M[X3].[CF]-X1)-2;                             33565000
         M[M[X2]:=M[X3]&X3[CTF]].[FF]:=X2;                              33565500
         M[X3].[CF]:=X2;                                                33566000
         FORGETSPACE(X3+2);                                             33566500
    END ELSE                                                            33567000
    IF X1 GTR X2 THEN                                                   33567500
    BEGIN FORGETSPACE(LINETABLE);                                       33568000
         LINETABLE:=GETSPACE(X1,0,1)+2;                                 33568500
         MOVE(X1,LINETABLE-1,LINETABLE);                                33569000
    END;                                                                33569500
    LINETABLE:=LINETABLE&(X:=X-1)[18:40:8];                             33570000
%                                                                       33570100
%   LINE INTIALIZATION PROCEDES BY                                      33570150
%   1. INTERROGATE EACH LINE.                                           33570200
%   2. AS THE INTERROGATES RETURN IF                                    33570250
%      A. THE LINE IS CONNECTED, READY THE STATIONS AND ASK FOR THE     33570300
%         USERCODE,                                                     33570350
%      B. THE LINE IS DISCONNECTED, QUEUE A LOOKFORRING.                33570400
%   FOR CONNECTED LINES WE SEARCH STATABLE TO LINK UP THE STATIONS      33570450
%   BELONGING TO THAT LINE.                                             33570500
%                                                                       33570550
    L:=-1;                                                              33571000
    C:=0&1[24:47:1]&[C][9:33:15];      % Q OF RESULTS SAVED FOR HANDLER 33571500
INTERR:                                                                 33572000
    IF  BIGUNS LEQ BIGUNMIN+1 OR L=X THEN                               33572500
      COMPLEXSLEEP(NOT RESULTQ.[24:1]) ELSE                             33573000
    BEGIN M[(X2:=GETAREA(0))+1]:=0&INTERROGATESTATUS[1:41:7]&           33573500
             (L:=L+1)[24:40:8];                                         33574000
          DCPQ(X2);                                                     33574500
CHECKIT:                                                                33575000
         IF RESULTQ.[24:1] THEN GO  TO INTERR;                          33575500
    END;                                                                33576000
%                                                                       33576500
    RESULTQ:=M[R:=RESULTQ.[CF]];                                        33577000
    IF (X2:=(I:=M[R+1]).[1:7]) ! INTERROGATESTATUS AND                  33577500
      X2 ! ENTERNORMALMODE THEN                                         33578000
    IF X2=SETSTATIONREADY OR X2=ENABLEINPUT OR M[R].[5:1] THEN          33578500
    BEGIN FORGETAREA(M[R].[2:2],R);                                     33579000
         GO CHECKIT;                                                    33579500
    END ELSE                                                            33580000
    IF M[R+2].CONTROL THEN                                              33580500
    BEGIN M[R+1]:=(*P(DUP))&P(0,XCH)[24:24:16]&ENTERNORMALMODE[1:41:7]; 33581000
         DCPQ(R);                                                       33581500
         GO CHECKIT;                                                    33582000
    END ELSE                                                            33582500
    BEGIN M[M[C.[9:15]]:=(*P(DUP))&R[24:24:24]].[24:1]:=1;              33583000
         C.[9:15]:=R;                                                   33583500
         GO CHECKIT;                                                    33584000
    END;                                                                33584500
%                                                                       33585000
    I:=I.[24:8];                                                        33585500
    IF M[R+2].CONNECTED THEN                                            33586000
    BEGIN X1:=A[X6:=(I+1) MOD 30];                                      33586500
         X2:=0;                                                         33587000
         FOR X4:=1 STEP 1 UNTIL STAMAX DO                               33587500
         IF (X5:=STATABLE[X4]).DIALEDUP AND NOT X5.[20:1] THEN          33588000
         IF X5.[24:8]=I THEN                                            33588500
         IF X5.[32:8] LSS X1.[CF] THEN                                  33589000
         BEGIN STATABLE[X4]:=0&X5[24:24:16]&3[15:46:2]&X1[11:21:2]      33589500
              &X2[40:40:8]&(CANDYINX+32)[4:42:6];                       33590000
              X2:=X4;                                                   33590500
         END;                                                           33591000
         IF X2!0 THEN                                                   33591500
         STREAM(X2,D:=(LINETABLE+I.[40:6])&I[30:46:2]);                 33592000
         BEGIN SI:=LOC X2; SI:=SI+6;                                    33592500
              DS:=2 CHR;                                                33593000
         END;                                                           33593500
         FOR X4:=0 STEP 1 UNTIL M[R+2].[16:8] DO                        33594000
         BEGIN M[X3:=GETAREA(0)]:=0&1[5:47:1];                          33594500
              M[X3+1]:=X5:=0&1[23:47:1]&I[24:40:8]&X4[32:40:8]&         33595000
                SETSTATIONREADY[1:41:7];                                33595500
              DCPQ(X3);                                                 33596000
              M[X3:=GETAREA(0)]:=0&1[5:47:1];                           33596500
              M[X3+1]:=X5&ENABLEINPUT[1:41:7];                          33597000
              DCPQ(X3);                                                 33597500
              STREAM(D:=(X3:=GETAREA(1))+3);                            33598000
              BEGIN DS:=28 LIT"!-!*P!*L!*O!*P!*RESTARTING..";           33598500
                   DS:=28 LIT"!-!*ENTER USER CODE, PLEASE-";            33599000
              END;                                                      33599500
              M[X3]:=0&5[3:45:3];                                       33600000
              M[X3+1]:=56&X5[24:24:16]&OUTPUT[1:41:7];                  33600500
              DCPQ(X3);                                                 33601000
         END;                                                           33601500
    END ELSE                                                            33602000
    BEGIN M[X3:=GETAREA(0)]:=0&1[5:47:1];                               33602500
         M[X3+1]:=0&I[24:40:8]&LOOKFORRING[1:41:7];                     33603000
         DCPQ(X3);                                                      33603500
    END;                                                                33604000
    FORGETAREA(M[R].[2:2],R);                                           33604500
    IF I!X THEN                                                         33605000
    BEGIN IF X6=29 THEN DISKWAIT(-B,30,TNAOG[0]+1+I DIV 30);            33605500
         GO CHECKIT;                                                    33606000
    END;                                                                33606500
%                                                                       33607000
    IF NOT RESULTQ.[24:1] THEN M[C.[9:15]].[24:24]:=RESULTQ;            33607500
    RESULTQ:=C;                                                         33608000
    FORK(P(.DCPHANDLER),0,-3,9,WORKERSTACK.[FF]);                       33608500
%                                                                       33608600
%   CLEAN UP ANY STATIONS WHICH WERE ACTIVE WHEN THE DCP STOPPED        33608700
%   (OR BEFORE THE H/L) BUT ARE NOT ACTIVE NOW. BIT 22:1 IS TURNED      33608800
%   ON BY CREATELOG AND OFF WHEN AN ACTIVE STATION IS FOUND             33608900
%   IN THE CODE ABOVE.                                                  33609000
%                                                                       33609100
    FOR I:=1 STEP 1 UNTIL STAMAX DO                                     33609500
    IF (X:=STATABLE[I]).[22:1] AND X.DIALEDUP THEN                      33610000
    BEGIN SYSDISKIO(3,-I,A);                                            33610500
         STATABLE[I]:=A[0]:=A[1]:=0;                                    33611000
         SYSDISKIO(0,-I,A);                                             33611500
    END;                                                                33612000
    FORGETSPACE(A);                                                     33612500
EXIT:                                                                   33613000
    KILL([RCW] INX NOT 2);                                              33613500
END OF DCP INITIALIZATION;                                              33614000
$INCLUDE 39508151, IF DCP;                                              39508149
              LABEL AROUND,EXIT;                                        39508150
$OMIT 39508501, IF DCP;                                                 39508199
              SUBROUTINE BUILDHEAD;                                     39508520
              BEGIN M[T]:=0;                                            39508540
                   MOVE(29,T,T+1);                                      39508560
                   M[T+2]:=MCP;                                         39508580
                   M[T+4].[9:1]:=1;                                     39508600
                   M[T+5]:=M[T+6]:=@14;                                 39508620
                   M[T+9]:=1;                                           39508640
                   STREAM(DATE,X:=T+3);                                 39508660
                   BEGIN SI:=LOC DATE; DS:=8 OCT;                       39508680
                        DI:=X; DS:=2 LIT"+#";                           39508700
                        SI:=X; SI:=SI+5; DS:=3 CHR;                     39508720
                   END;                                                 39508740
                   M[T+10]:=PETUSERDISK((M[T+8]:=I)&1[2:47:1],1);       39508760
              END;                                                      39508780
                   S:=(I:=300) OR MEMORY;                               39509250
                   BUILDHEAD;                                           39509260
                   IF (R:=M[T+10])=0 THEN                               39509265
$VOID 39509801                                                          39509350
$OMIT 39553001, IF DCP;                                                 39530999
$INCLUDE 39580001, IF DCP;                                              39553999
              IF (T:=DIRECTORYSEARCH("SYSDCP "                          39554000
$INCLUDE 39554501, IF SHAREDISK;                                        39554499
                   &(SYSNO+17)[42:42:6]                                 39554500
                   ,"DISK   ",5))=0 THEN T:=SPACE(30) ELSE              39555000
              IF M[T INX 7]=STAMAX THEN                                 39555500
              BEGIN SYSDISKADR:=M[T INX 10];                            39556000
                   SYSDISK:=M[T];                                       39556500
                   GO AROUND;                                           39557000
              END                                                       39557500
              ELSE P(DIRECTORYSEARCH(-"SYSDCP "                         39558000
$INCLUDE 39558501, IF SHAREDISK;                                        39558499
                   &(SYSNO+17)[42:42:6]                                 39558500
                   ,"DISK   ",6),DEL);                                  39559000
              I:=(STAMAX+6) DIV 7 + 1;                                  39559500
              BUILDHEAD;                                                39560000
              IF (SYSDISKADR:=M[T+10])=0 THEN                           39560500
              BEGIN STREAM(T);                                          39561000
                   DS:=31 LIT"-*NO USER DISK FOR SYSTEM/DISK~";         39561500
                   SPOUT(T);                                            39562000
                   GO TO EXIT;                                          39562500
              END;                                                      39563000
              M[T]:=SYSDISK:=@0000400036000701;                         39563500
              M[T+7]:=STAMAX;                                           39564000
              K:=SPACE(J:=30|I);                                        39564500
              MOVE(J,K-1,K);                                            39565000
              DISKWAIT(K,J,SYSDISKADR);                                 39565500
              FORGETSPACE(K);                                           39566000
              ENTERUSERFILE("SYSDCP "                                   39566500
$INCLUDE 39567001, IF SHAREDISK;                                        39566999
                   &(SYSNO+17)[42:42:6]                                 39567000
                   ,"DISK   ",T-1);                                     39567500
    AROUND:   FORGETSPACE(T);                                           39568000
              TOGLE:=TOGLE OR SYSDISKMASK;                              39568500
              T1:=IOQUE&SPACE(10)[CTC];                                 39569000
              SYSDISKIO(1,0,T1);                                        39569500
              SPOWORD:=T1[3];                                           39570000
              K:=0;                                                     39570500
%                                                                       39570600
%   USE SYSDCP TO REBUILD STATABLE AS IT WAS BEFORE THE H/L.            39570700
%                                                                       39570800
              FOR I:=1 STEP 1 UNTIL STAMAX DO                           39571000
              BEGIN INPUTANK[I]:=TANKS[I]:=-0;                          39571500
                   SYSDISKIO(1,I,T1);                                   39572000
                   IF T1[0]=0 THEN T:=0 ELSE                            39572500
                   IF (T:=0&T1[0][15:15:25]&1[22:47:1]).[20:1] THEN     39573000
                   IF T.DIALEDUP AND T1[2].[6:24]="FILE" THEN           39573500
                   BEGIN T:=T&70[16:41:7]&K[40:40:8];                   39574000
                        K:=I;                                           39574500
                   END ELSE                                             39575000
                   BEGIN T1[0]:=T1[1]:=T1[2]:=0;                        39575500
                        SYSDISKIO(0,I,T1);                              39576000
                        T:=0;                                           39576500
                   END;                                                 39577000
                   STATABLE[I]:=T;                                      39577500
              END;                                                      39578000
              STATABLE[0]:=(*P(DUP))&K[CTC]&1[4:47:1];                  39578500
              SYSDISKIO(1,STAMAX+1,T1);                                 39579000
              FORGETSPACE(T1);                                          39579500
    EXIT:                                                               39580000
         END;                                                           39580500
              J:=220 + 20|(BIGUNMIN + LMAX DIV 2);                      44040500
$OMIT 44090001, IF DCP;                                                 44089999
$INCLUDE 44151371, IF DCP;                                              44151349
                   +80            % DCP HANDLER-S STACK                 44151350
                   + 8            % DCPARRAY                            44151360
                   +4|STAMAX+4    % STATABLE, TANKS, INPUTANK, TNAOG    44151370
                   +90            % WORKERSTACK                         44151500
$INCLUDE 44164441, IF DCP;                                              44164299
              I:=8; T:=P(.DCPARRAY); FIX;                               44164300
              I:=STAMAX+1;                                              44164400
              T:=P(.STATABLE); FIX;                                     44164410
              T:=P(.TNAOG); FIX;                                        44164420
              T:=P(.TANKS); FIX;                                        44164430
              T:=P(.INPUTANK); FIX;                                     44164440
              WORKERSTACK:=J; J:=J+90;                                  44179100
$INCLUDE 44179151, IF DCP;                                              44179149
              WORKERSTACK.[FF]:=J;  J:=J+80;                            44179150
$OMIT 44193036, IF DCP;                                                 44193029
$INCLUDE 44193038, IF DCP;                                              44193036
              I:=P(.DCPHANDLER); FIXEX;                                 44193037
              FOR I:=WORKERSTACK.[CF] STEP 1 UNTIL WORKERSTACK.[CF]+89  44200700
$INCLUDE 44200801, IF DCP;                                              44200799
                   +80                                                  44200800
                DO M[I]:=@2525252525252525;                             44200900
$INCLUDE 44201166, IF DCP;                                              44201164
              LINETABLE:=SPACE(C:=64)&256[18:40:8];                     44201165
$OMIT 44201171, IF DCP;                                                 44201169
              TOGLE:=TOGLE OR SHEETMASK OR STATUSMASK OR DCPLOADMASK;   44415000
$INCLUDE 44417091, IF DCP;                                              44417089
              IF DCPTOG THEN FORK(P(.INITIALIZEDCP),1,0,128,1);         44417090
$OMIT 44417101, IF DCP;                                                 44417099
$OMIT 46009001, IF DCP;                                                 46008999
$INCLUDE 46009501, IF DCP;                                              46009499
              :26: DCPINTERRUPT;               % 32 - DCP INTERRUPT     46009500
$OMIT 46011001, IF DCP;                                                 46010999
$INCLUDE 46011501, IF DCP;                                              46011499
              :28: GO TO EXTERNAL;             % 34 INQUIRY             46011500
 TIMER::                                                                48000000
$INCLUDE 48000101, IF DCP;                                              48000099
              SETATTENTION;                                             48000100
              IF (CLOCK:=CLOCK+64).[37:5] = 0 OR                        48000200
$INCLUDE 48059501, IF DCP;                                              48059499
WAKEUP:                                                                 48059500
              DO DO BEGIN P(INI);                                       48082000
$INCLUDE 48086001, IF DCP;                                              48082999
                        IF DCPTOG THEN                                  48083000
                        BEGIN IF RESULTQ.[24:1] THEN ELSE GO WAKEUP;    48084000
$VOID 48084201                                                          48084100
                             UPREQUESTQ;                                48085000
                        END;                                            48086000
                   END UNTIL (P(RRR) OR RRRMECH)!READY                  48087000
              UNTIL STATUSBIT;                                          48088000
              TOGLE:=TOGLE AND NOT STATUSMASK;                          48089000
              FORK(P(.STATUS),0,-1,128,0);                              48090000
              GO TO NOTHINGTODO;                                        48091000
P2FAKE:       TOGLE:=TOGLE OR HP2MASK;                                  48092000
              P(HP2,INI);                                               48093000
PROCSWIT:     P(16);                                                    48094000
$OMIT 48127001, IF DCP;                                                 48125499
$#PATCH NUMBER  50 FOR TSSMCP.XII CONTAINS  3 CARDS        C                 $$$
%   T S - M C P  M A R K    X I I . 5 9                    05/15/71     00001000
           BEGIN STATABLE[T:=I]:=0&1[4:47:1]&1[16:47:1];                05729020
         "59"                                                           44203100
$#PATCH NUMBER  51 FOR TSSMCP.XII CONTAINS  1 CARDS        C                 $$$
              UNITCODE[R+9]:=-0;                                        07409300
$#PATCH NUMBER  52  FOR TSSMCP.XII  CONTAINS  2 CARDS      C                 $$$
                                 IF UNITNO = 31 THEN                    20374310
                                 BEGIN I~PERIO; GO TO TYPE1 END;        20374320
$#PATCH NUMBER 53  FOR  TSSMCP.XII CONTAINS 2 CARDS        C                 $$$
         DCPDSK       = (DIRECTORYTOP-6)#;                              00003750
              IF DCPTOG THEN SETATTENTION;                              48000100
$#PATCH NUMBER  54 FOR TSSMCP.XII  CONTAINS  2 CARDS       C                 $$$
         LABELTABLE[HN1]:=P(DUP,LOD,SSP);   % MARK IT NOT IN USE        16186500
         HN1:=0;                                                        16186550
$#PATCH NUMBER  55 FOR TSSMCP.XII  CONTAINS  2 CARDS       C                 $$$
                             SI:=SI+7; DI:=DI+7; DS:=CHR;               06579000
                             DI:=DI-2; SI:=SI-1;                        06579500
$#PATCH NUMBER  56 FOR TSSMCP.XII  CONTAINS 22 CARDS       C                 $$$
    STREAM(L:=X.[37:6]: N:=X.[43:5], U:=DAT[P1MIX].NDSABLE AND X LSS 80,03304200
$VOID                                                                   03309900
$VOID                                                                   05146999
 L8:                                                                    05147000
$INCLUDE 05148001, IF DCP;                                              05147099
              IF INPUTANK[I:=LOGLINE.[40:8]].[FF]!0 THEN                05147100
$VOID                                                                   05148999
              T:="!OK!-*1";                                             05149000
              TWXOUT([T].[CF],8,-0,LOGLINE);                            05150000
PROCEDURE PAPERTAPEIO(STA,H,MI,MI2);                                    33049500
VALUE STA,H,MI,MI2;                                                     33050000
REAL  STA,H,MI,MI2;                                                     33050500
%   MUST ALSO END WITHIN IT.                                            33051680
$VOID 33051721                                                          33051700
%     MI    FIRST WORD OF HEADER (USED FOR EOM AND 224 CHARACTER FLAGS) 33051800
%     MI2   THIRD WORD OF HEADER (USED FOR SPECIAL CHARACTER FLAG)      33051810
         IF MI.MESSEND THEN            % UPDATE INPUTANK                33059000
    IF (Q:=M[T1:=M[T:=X.[FF]].[FF]].[FF]) + (N:=M[H].[FF]) GTR 28 OR    33063000
      MI.[7:1] OR (M[T1] AND NOT M[H]).[5:1] THEN                       33063100
    IF MI2.SPECIALCHARACTER THEN                                        33070000
         MI.MESSEND:=1;               % MAKE SURE INPUTANK IS UPDATED   33074600
         IF PAPERTAPE[STA] THEN PAPERTAPEIO(STA,H,MI,MI2) ELSE          33161000
$#PATCH NUMBER  57 FOR TSSMCP.XII  CONTAINS  7 CARDS       C                 $$$
$ INCLUDE 09701601, IF STATISTICS;                                      09701599
LABEL STATS;                                                            09701600
$ INCLUDE 09708201, IF STATISTICS;                                      09708099
         ELSE IF (B EQV P(STATS))= T THEN%                              09708100
              P((A EQV P(SYS))=T)                                       09708200
$ INCLUDE 09720801, IF STATISTICS;                                      09720799
    STATS:::  "STATS  ";%                                               09720800
$#PATCH NUMBER  58 FOR TSSMCP.XII  CONTAINS  7 CARDS       I                 $$$
         REAL T, COB68;                                                 15066000
         COB68 ~ (FIB ~ *(FLOC)).[8:10] = 22;                           15073000
         IF NOT COB68 THEN                                              15080900
         IF NOT COB68 THEN                                              15102900
      BEGIN IF COBOL { 0 THEN          % ALGOL OR COBOL68               39145200
      FILLBUFFERS(FIB[16],FIB[19-3|ABS(COBOL)],NBUFS-(COBOL>0),NBUFS);  39146000
      IF COBOL>0 THEN FIB[16]~(*P(DUP))&M[ALPHA][CTC];                  39147000
$#PATCH NUMBER  59 FOR TSSMCP.XII  CONTAINS  3 CARDS       C                 $$$
$VOID                                                                   09004300
                   L[32]:=NABS(*P(DUP));                                09019750
              L[32]:=NABS(*P(DUP));                                     09027500
$#PATCH NUMBER 60 FOR  TSSMCP.XII CONTAINS  3 CARDS        I                 &&&
%   T S - M C P  M A R K    X I I . 75                     06/15/71     00001000
         IF (A.[1:5]!0 OR B.[1:5]!0 OR A=@114 OR A=@14) THEN            14559300
         "75"                                                           44203100
$#PATCH NUMBER 61 FOR  TSSMCP.XII CONTAINS  3 CARDS        I                 &&&
                   IF SC="~" THEN BEGIN MIX:=SI; GO TO XXIT; END;       16033500
              IF P(.KTR,~,.MIX,SND) GTR @777 THEN                       16044000
              BEGIN KEYIN:=TRUE; GO TO FORGET; END;                     16044500
$#PATCH NUMBER 62 FOR  TSSMCP.XII CONTAINS  1 CARDS        I                 &&&
                   M[T+4]~-0&SYSNO[4:46:2]&1[2:47:1];                   28299000
$#PATCH NUMBER 64 FOR  TSSMCP.XII CONTAINS  7 CARDS        C                 &&&
                   BEGIN IF NOT M[L].[33:1] THEN%NOT TYPE 13 INT        02211000
                         BEGIN S~ADR; %SEGNO IN RCW                     02211010
                         END ELSE S~-1;                                 02212100
         END UNTIL (IF S!0 THEN  IF S=(-1) THEN 0 ELSE                  02216500
                                (B[0]<S OR NOT B[S].PBIT)               02216510
                   ELSE ADR>FENCE OR                                    02216600
                   (P(M[T-2].[3:12],DUP)!@700 AND P(XCH)!@1500));       02216610
$#PATCH NUMBER 65 FOR  TSSMCP.XII CONTAINS  8 CARDS        C                 &&&
 IF NOT C AND (X1:=NEUP.[FF]-NEUP.[CF]-1) GEQ 0 THEN                    40262300
 IF NT1 GEQ 10 THEN NT1:=NEUP.[CF]+NT1-10;                              40324190
 VR[NT1+1]:=0&(SU[X].FORTYMILLDISK+1)[TOSPEED]&RL[TONUMENT]&            40324200
FOR NT1:=NEUP.[CF]-1 STEP -1 UNTIL 0 DO                                 40334065
IF (NT1:=NT2-3) - (X2:=NEUP.[CF]) GEQ 0 THEN                            40334077
FOR NT1:=NT1 STEP -1 UNTIL X2 DO                                        40334079
    IF NT1 THEN VR[NT2+NT1 DIV 2].[8:20]:=SOCK[NT1-X2+30]               40334081
    ELSE VR[NT2+NT1 DIV 2].[28:20]:=SOCK[NT1-X2+30];                    40334083
$#PATCH NUMBER 66 FOR  TSSMCP.XII CONTAINS 13 CARDS        C                 &&&
BOOLEAN PROCEDURE SYSTEMFILE(A,B);VALUE A,B; REAL A,B; FORWARD;         00463300
$ VOID                                                                  20382167
         OR ((CMM[0] EQV "PBD    ")=NOT 0)                              20511186
         OR SYSTEMFILE(CMM[0],CMM[1]) THEN GO TO ERROR;                 20511188
         IF CN NEQ 0 THEN T:=IF SYSTEMFILE(CMM[2],CMM[3]) THEN -1 ELSE  20574700
           BEGIN CN:=1; CMM[2]:=CMM[0]; CMM[3]:=CMM[1] END;             20580610
         T:=IF SYSTEMFILE(CMM[2],CMM[3]) THEN -1                        20580625
                   ELSE DIRECTORYSEARCH(CMM[2],CMM[3],5);               20580626
              IF T GTR 0 THEN                                           20580630
              IF T LSS 0 THEN                                           20580716
              LBMESS(-CMM[2],CMM[3],"NOT ",IF TOG THEN                  20580717
                     "SET " ELSE "RESET ","(SYSTEM",                    20580718
                     " FILE)",0) ELSE                                   20580719
$#PATCH NUMBER 67 FOR  TSSMCP.XII CONTAINS 1  CARDS        C                 &&&
OK:                IF (H[9+W]~PETUSERDISK(-H[8] OR M,COMMON))<1 THEN    28310000
$#PATCH NUMBER 68 FOR  TSSMCP.XII CONTAINS 1  CARDS        C                 &&&
$OMIT 04004501, IF DCP;                                                 04004498
$#PATCH NUMBER 69 FOR  TSSMCP.XII CONTAINS 3  CARDS        C                 &&&
 %       D[20].[8:10]=NUMBER OF LAST LOG FILE                           44008350
 %            .[18:30]=NUMBER OF ENTRIES IN LOG (UPDATED BY NSECOND)    44008360
 %       D[21]=SCHEDWRD                                                 44008370
$#PATCH NUMBER 70 FOR  TSSMCP.XII CONTAINS 1  CARDS        C                 &&&
 DEFINE SELECTION = FORK(P(.SELECTRUN),0,-1,196,0)#,                    00426700
$#PATCH NUMBER 71 FOR  TSSMCP.XII CONTAINS 10 CARDS        C                 &&&
         IF R.[30:1] THEN                                               03838600
$OMIT 03839305, IF TWXONLY;                                             03838695
         IF D=MULTI THEN                                                03838700
         IF STATABLE[ST].DIALEDUP THEN GO TO DISCONN ELSE               03838800
         BEGIN STATABLE[ST].[CF]:=0;                                    03838900
              L:=SEQARRAY[ST]:=(*P(DUP))&1[3:47:1];                     03839000
              SEQARRAY[S1]:=(*P(DUP))&L[40:32:8];                       03839100
              GO TO ENQNAK;                                             03839200
         END ELSE                                                       03839300
         GO TO DISCONN;                                                 03839400
$#PATCH NUMBER 72 FOR  TSSMCP.XII CONTAINS 2  CARDS        C                 &&&
                   IF (Y~M[LINK~T])>0 OR Y.[CF]=LOC                     24057100
                   OR M[Y].[FF]!LINK THEN                               24057150
$#PATCH NUMBER 73 FOR  TSSMCP.XII CONTAINS 2  CARDS        C                 &&&
                   H:   4(40(IF SC="~" THEN JUMP OUT 2 TO HH;           15032000
                        DS~CHR)); HH:                                   15033000
$#PATCH NUMBER 74 FOR  TSSMCP.XII CONTAINS 13 CARDS        C                 &&&
              "8TANK O","6VRFLOW",0,         %67                        02345710
              "8PARITY","6 ERROR",           %70                        02345720
              "8INVALD","8 FILE ","4NAME..", %75                        02345740
              "8INVALD","8 BLOCK","5 EXIT.", %78                        02345750
              "8OUT OF","4 MEM..",           %81                        02345760
$VOID                                                                   02345770
         IF J.INPUTN=CLUMPSIZE-1 THEN TERMINATE(STATAB.MIXNR&67[CTF]);  03621200
                TERMINATE(P1MIX&67[CTF]);                               05902900
              TERMINATE(P1MIX); TERMINALMESSAGE(75);                    14559500
                        TERMINATE(MIX&81[CTF]);                         24333000
    IF Q GTR CLUMPSIZE-1 THEN TERMINATE(STATABLE[STA].MIXNR&67[CTF]);   33081500
             TERMINATE(STATABLE[STA].MIXNR&67[CTF]);                    33171500
                        TERMINALMESSAGE(78);                            42488300
$#PATCH NUMBER 75 FOR TSSMCP.XII CONTAINS  2 CARDS         C                 &&&
      IF (BLEN:=RLEN) LSS 17 THEN BLEN:=17;                             39235100
      FIB[18]:=(*P(DUP))&BLEN[3:33:15]&BLEN[CTF];                       39235250
$#PATCH NUMBER  76 FOR TSSMCP.XII CONTAINS  37 CARDS       C                 &&&
%   T S - M C P  M A R K    X I I I . 0                    07/15/71     00001000
 DEFINE CANTEXPAND[CANTEXPAND1]=SQ[CANTEXPAND1].[7:1]#;                 00933500
         COMMENT MAY BE DUE TO COUNT=CHUNKMAX OR MISSING MEMORY MODS;   00933600
                   IF CANTEXPAND[P1MIX] THEN GO TO Y;                   15172810
    DS~4 LIT"XIII";     SI:= LOC A ;                               %021-15503000
         IF NOT CANTEXPAND[MIX] THEN                                    21215350
                        CANTEXPAND[J]|@10000000000;                     21256120
         IF S GEQ 4095 THEN BEGIN N:=N-1; GO TO L END;                  21274100
         CANTEXPAND[P1MIX]:=(N=CHUNKMAX);                               21276050
         LABEL L,L1,SOL;                                                21317000
         BEGIN J:=LC[MIX];                                              21340500
              IF (I:=SC[MIX])=0 THEN                                    21341000
              IF TOTAL[J+1] LSS 63 THEN                                 21341500
              ELSE GO TO SOL                                            21342500
                   IF J!CHUNKMAX THEN                                   21343500
                   IF TOTAL[I-1] GTR TOTAL[J+1] THEN GO TO L;           21344000
                   IF TOTAL[I-1] = 63 THEN                              21344500
    SOL:           BEGIN CANTEXPAND[MIX]:=1; I:=0; GO TO L1 END;        21345000
              IF COUNT[MIX] GEQ CHUNKMAX-1 THEN CANTEXPAND[MIX]:=1;     21347500
    L1:       EXPAND[MIX]:=I;                                           21348000
                   IF CANTEXPAND[MIX] THEN                              24330000
    FOR I:=0 STEP 1 UNTIL 7 DO                                          44102000
    BEGIN M[4096|I]:=1; DO UNTIL (T:=COREND)!16;                        44102500
         MEMASK:=2|MEMASK+T;                                            44103000
    END;                                                                44103500
    IF FENCE.[CF]!FENCE OR FENCE LSS 8192 THEN FENCE:=16384;            44104000
    I:=FENCE DIV 4096;                                                  44105000
    WHILE (TWO(7-I) AND MEMASK)!0 AND I LSS 8 DO FENCE:=(I:=I+1)|4096;  44106000
    CHUNKMAX:=(@100000-FENCE) DIV CHUNKZIZE;                            44107000
    J:=(A:=FENCE:=@100000-CHUNKMAX|CHUNKZIZE) DIV 4096 -1;              44108000
              DISKWAIT(-(A:=SPACE(30)),-30,DIRECTORYTOP-SYSNO);         44191005
              I:=(T:=M[A+19].[CF]) DIV 4096;                            44191010
              WHILE (TWO(7-I) AND MEMASK)!0 AND I!8 DO T:=(I:=I+1)|4096;44191015
              IF T!FENCE AND T!0 THEN                                   44191020
                  "0"                                                   44203100
              DS:=4 LIT"XIII";                                          44204600
                   CT[I]:=(NOT 0).[36:12];   % ACTIVE[I]:=TOTAL[I]:=63; 44241130
$#PATCH NUMBER  77 FOR TSSMCP.XII CONTAINS  2  CARDS       C                 &&&
                   IF PRNTABLE[UNIT].[1:1] AND                          13135000
                   NOT(SVPBT OR PRT[P1MIX,@23]) THEN                    13135200
$#PATCH NUMBER  78 FOR TSSMCP.XII CONTAINS  2  CARDS       C                 &&&
CCC: DO T~SCAN UNTIL T>IDENT AND T{RESETV;                              20594450
       DO T~SCAN UNTIL T>IDENT AND T{RESETV;                            20605900
$#PATCH NUMBER  79 FOR TSSMCP.XII CONTAINS  2  CARDS       I                 &&&
              GO TO ENDF;                                               20608060
$VOID 20608091                                                          20608065
$#PATCH NUMBER  80 FOR TSSMCP.XII CONTAINS 26  CARDS       C                 &&&
COMMENT                                                                 00419600
         THE RELATIONSHIP BETWEEN MODULUS AND DIRMOD IS:                00419610
         DIRMOD := MODULUS | MODULUS, WHERE MODULUS IS A LOW            00419620
         ODD PRIME. (THE RECOMMENDED VALUE OF MODULUS IS 13).           00419630
         FOR SYSTEMS WITH FEWER THAN 6 MEMORY MODS, MODULUS MUST BE     00419640
         SET TO A SMALLER VALUE SO THAT DIRECTORYBUILDER WILL           00419650
         NOT GET A NO-MEM, MAKING IT IMPOSSIBLE TO HALT/LOAD.           00419660
         IT IS SUGGESTED THAT MODULUS BE SET TO 11, DIRMOD TO 121       00419670
         FOR A SYSTEM WITH FEWER THAN 6 MODS. IT MAY BE NECESSARY       00419680
         TO SET IT SMALLER, DEPENDING ON THE DISK CONFIGURATION         00419690
         AND THE NUMBER OF MODS;                                        00419700
    LABEL TRYNEXTMOD,RESTARTCYCLE;                                      44027000
    SUBROUTINE FIXFENCE;                                                44082100
         BEGIN I:=T DIV 4096;               % POINT IT TO AN ON-LINE MOD44082200
              WHILE (TWO(7-I) AND MEMASK)!0 AND I LSS 8 DO              44082300
    TRYNEXTMOD:    T:=(I:=I+1)|4096;                                    44082400
              IF T-4096|I ! 0 THEN                                      44082500
              IF (TWO(8-I) AND MEMASK)=0 THEN ELSE GO TRYNEXTMOD;       44082600
    %         THIS INSURES THERE IS ROOM FOR TABLES IMMEDIATELY BELOW   44082700
    %         THE FENCE. (KILL ASSUMES IT HAS A STACKQ STACK IF S>PRT.) 44082800
         END;                                                           44082900
    T:=FENCE;                                                           44105000
    FIXFENCE;                                                           44105500
    FENCE:=T;                                                           44106000
              T:=M[A+19].[CF];                                          44191010
              FIXFENCE;                                                 44191015
$#PATCH NUMBER  81 FOR TSSMCP.XII CONTAINS  3  CARDS       I                 &&&
      IF LIBMSG THEN                                                    07350100
EXIT: SPOUT(I)                                                          07351000
      ELSE FORGETSPACE(I);                                              07351100
$#PATCH NUMBER  82 FOR TSSMCP.XII CONTAINS  2  CARDS       I                 &&&
              FOR I~20 STEP 1 UNTIL 21 DO                               44417110
               P(WAITIO(@4000100000,@777,I),DEL);                       44417120
$#PATCH NUMBER  83 FOR TSSMCP.XII CONTAINS  5  CARDS       I                 &&&
              "8EXCESS","8 IO TI","2ME....", % 83                       02345770
                   IF IOTIME[P1MIX]>0 THEN                              48031310
                   BEGIN                                                48031320
                   TERMINATE(P1MIX&83[CTF]); GO GOGOGO                  48031330
                   END ELSE                                             48031340
$#PATCH NUMBER  84 FOR TSSMCP.XII CONTAINS  2  CARDS       C                 &&&
$INCLUDE 15520401, IF B6500LOAD;                                        15520300
          DS~10 LIT "B6500LOAD,";                                       15520400
$#PATCH NUMBER  85 FOR TSSMCP.XII CONTAINS 13  CARDS       I                 &&&
BEGIN REAL I,J;                                                         37303000
$VOID 37308001                                                          37307000
BEGIN                                                                   37313000
      STREAM(S~[TINU[U]],M~MULTITABLE[U],F~LABELTABLE[U],               37314000
             N~PRNTABLE[U].[30:18],D~J~GETSPACE(10,2,0)+2);             37314100
                  DS~6 LIT " RW/L ";                                    37316000
                  SI~LOC M;SI~SI+1;DS~7 CHR;DS~LIT" ";                  37316100
                  SI~SI+1; DS~7 CHR; DS~LIT"(";                         37316200
                  DS~5 DEC; DS~2 LIT ")~";                              37316300
         SPOUT(J);                                                      37318000
      LABELTABLE[U]~@214;                                               37318100
      MULTITABLE[U]~RDCTABLE[U]~0;                                      37319010
      IF U<16 THEN PRNTABLE[U]~0 ;                                      37319020
$#PATCH NUMBER  86  FOR  TSSMCP.XII  CONTAINS  23 CARDS    I                 &&&
      DEFINE TECH=STATE.[46:2]#,             OPENIO=FIB[13].[22:1]#,    38385400
             WRITBACK=FIB[13].[23:1]#,       LASTIO=FIB[13].[46:1]#,    38385500
             WRITEAFTEREOF=FIB[13].[44:2]#,  INPUT=STATE.[43:1]#;       38385600
      P(RCW,MSCW,STF);       RCW ~ RCW & P(XCH)[CTC];                   38387000
      HEADER ~ FIB[14];      ACCESS ~ FIB[4].[27:3];                    38388000
      IF COBOL THEN                                                     38389000
      BEGIN  IF COBOL > 0 THEN                   % COBOL 61             38389100
             BEGIN IF WRITBACK AND TECH=0 AND LASTIO AND                38389200
                      (OPENIO OR NOT(INPUT))   THEN                     38389300
                       IF ACCESS=1 AND WRITEAFTEREOF!0 THEN             38389400
                       BEGIN  FIB[7] ~ *P(DUP) - 1;                     38389500
                              HEADER[7] ~ *P(DUP) - 1;                  38389600
                       END ELSE WRITEAFTEREOF ~ 0;                      38389700
                   IF TECH=0 THEN IF WRITEAFTEREOF=2 THEN               38389800
                        BEGIN  FIB[7] ~ *P(DUP) + 1;                    38389900
                               HEADER[7] ~ *P(DUP) + 1;                 38390000
                        END ELSE IF WRITEAFTEREOF=1 THEN                38390100
                        BEGIN  FIB[7] ~ *P(DUP) - 1;                    38390200
                               HEADER[7] ~ *P(DUP) - 1;                 38390300
                        END;                                            38390400
                   WRITEAFTEREOF ~ 0;                                   38390500
             END;                                                       38391000
             IF ACCESS=1 THEN                    % IF RANDOM            38391100
$#PATCH NUMBER  87  FOR  TSSMCP.XII  CONTAINS  16 CARDS    C                 &&&
DEFINE USERCODE[USERCODE1]=UV[USERCODE1,4]#;                            04098600
REAL MCP;                                                               04098700
    IF (USERCODE[P1MIX] EQV MCP) ! NOT 0 THEN                           04105550
$VOID                                                                   05606100
$VOID                                                                   06179100
         IF(FH[2] EQV 0)=NOT 0 OR (ABS(USERID) EQV ABS(FH[2]))=NOT 0    06463910
         BEGIN IF (SH:=DIRECTORYSEARCH(ABS(FH[5]),FH[6],20))=0 %        06463970
         FALSE THEN GO AROUND; %                                        08117140
STREAM(DATE,J~5);BEGIN SI~LOC DATE;DS~8OCT END;FH[3].[12:18]~JUNK;      18451500
$VOID                                                                   20511186
         IF CN!0 THEN T:=IF SYSTEMFILE(CMM[2],CMM[3]) THEN -1 ELSE      20574700
              (USERID EQV ABS(M[T+2])) NEQ NOT 0 THEN %                 20575700
              (USERID EQV ABS(M[T+2])) NEQ NOT 0 THEN %                 20578400
      IF (USERID EQV MCP) = NOT 0 OR (USERID EQV ABS(M[T+2])) %         20580645
             IF (USERCODE[P1MIX] EQV ABS(M[T+2])) NEQ NOT 0 THEN %      28272000
             IF (USERCODE[P1MIX] EQV ABS(M[T+2])) NEQ NOT 0 THEN %      28583000
$#PATCH NUMBER  88  FOR  TSSMCP.XII  CONTAINS   6 CARDS    C                 &&&
              "3TS",%33 SCHED TS                                        08524900
      IF TYPE>20 THEN GO TS;IF TYPE>18 THEN GO XSES;GO PS;              08883000
    IF SID NEQ 63 THEN BEGIN IF S[3].[8:10] NEQ SID THEN GO TS1 END ELSE08885500
      IF SID NEQ 63 THEN BEGIN TYPE:=34;GO EXIT END;                    08901500
      IF SID NEQ 63 THEN TYPE:=34 ELSE%                                 08904050
                           ,DP,BK,TS                                    16013100
$#PATCH NUMBER  89  FOR  TSSMCP.XII  CONTAINS  12 CARDS    I                 &&&
     IF INTSIZE=0 THEN                                                  20100190
     IF  ((S[1] EQV "DISK   ")=NOT 0) AND                               20100200
         (((S[0] EQV "PRNPBT ")=NOT 0) OR                               20100202
         ((S[0] EQV "LDCNTRL")=NOT 0) OR                                20100204
         ((S[0] EQV "LIBMAIN")=NOT 0)) THEN ELSE                        20100206
     BEGIN                                                              20100210
         NT3~SPACE(4);                                                  20100220
         STREAM(NT3);                                                   20100230
         DS~24LIT"##NO INTRINSICS FILE...~";                            20100240
         SPOUT(NT3);                                                    20100250
         SLEEP([INTSIZE],@1777);                                        20100300
     END;                                                               20100310
$#PATCH NUMBER  90  FOR  TSSMCP.XII  CONTAINS   4 CARDS    I                 &&&
              REAL MESS,GM,GM1;%GM,GM1 MUST FOLLOW MESS.                24306000
              BEGIN;STREAM(MIX,SIZE,N~[MESS]);                          24317000
                    BEGIN SI~LOC MIX;DS~2 DEC;DS~9LIT" NO MEM ";        24318000
                          DS~5DEC;DS~5LIT" WDS~";                       24319000
$#PATCH NUMBER  91  FOR  TSSMCP.XII  CONTAINS   3 CARDS    I                 &&&
              "PRIORIT", 52, %OF "PROCESS" THRU "SAVE".                 20266500
$VOID 20360001                                                          20359000
          BEGIN                                                         20361000
$#PATCH NUMBER  92  FOR  TSSMCP.XII  CONTAINS   8 CARDS    C                 &&&
              IF TANKFUL[STA] OR INPUTANK[STA].INPUTREADY THEN          03254400
                   IF NOT INPUTANK[STA].[1:1] THEN                      03255000
                     SLEEP([INPUTANK[STA]],-0);                         03255050
$INCLUDE 03260501, IF DCP;                                              03260499
    TNAOG[STA]:=(*P(DUP))&0[1:1:24];                                    03260500
$VOID                                                                   03260599
    IF T!0 AND NOT (STATABLE[STA].SWAPPED) THEN M[T]:=0;                03260600
                   INPUTANK[I]:=NABS(P(DUP,LOD,0,XCH)&P[35:35:1]);      14344450
$#PATCH NUMBER  93  FOR  TSSMCP.XII  CONTAINS  12 CARDS    C                 &&&
                   IF E.[43:1] THEN % (SHM)                             04321000
                      BEGIN % (SHM)                                     04321100
                      IF TYPE=0 THEN GO TO READER; % READ CHECK (SHM)   04321200
                      IF TYPE=1 THEN GO TO PRINTER; % PRINT CHECK (SHM) 04321300
                      IF TYPE=6 THEN GO TO PUNCH; % PUNCH CHECK (SHM)   04321400
                      END;                                              04321500
$ VOID 04326210                                                         04326100
                   IF E.[45:1] THEN GO TO NOTREADYMESS; % (SHM)         04369100
              SPOUT(KEY); % (SHM)                                       04423000
              IF E.[45:1] THEN GO TO NOTREADYMESS; % NOT READY (SHM)    04423100
              TINU[U].[18:12]:=P(DUP).[18:12]+1;% (SHM)                 04423200
              F:=0; GO TO CLEAR; % (SHM)                                04423300
$#PATCH NUMBER  94  FOR  TSSMCP.XII  CONTAINS  10 CARDS    C                 &&&
              SEE,LOCKSYS,RSET,DONTWAIT,NOFILE;                         18208000
         IF DSED THEN GO TO NOFILE ELSE                                 18257000
NOFILE:       TEMP:=0;                                                  18266000
    BEGIN                                                               28442500
         IF DUMPING THEN J:=J-2 ELSE                                    28443000
         BEGIN X[J]:=@14;                                               28443500
              J:=-2;                                                    28444000
         END;                                                           28444500
    U:=-1;                                                              28554500
    IF DSED THEN ABORT;                                                 28555500
$#PATCH NUMBER  95  FOR  TSSMCP.XII  CONTAINS  32 CARDS    C                 &&&
              %39(USED BY DCMCP)                                        00411000
$VOID                                                                   00412999
              %37(USED BY DCMCP)                                        00413000
              %36(USED BY DCMCP)                                        00414000
              RNALL=OPTION.[17:1]#,                                     00416640
              %16(USED BY DCMCP)                                        00416650
              %15(USED BY DCMCP)                                        00416660
              %14(USED BY DCMCP)                                        00416670
              HALTSET=OPTION.[13:1]#,                                   00416680
$OMIT 00416691, IF DCP;                                                 00416689
              REMOTE=OPTION.[12:1]#,                                    00416690
              CANDYMESS=OPTION.[11:1]#,                                 00416700
              BATCHTOG=OPTION.[10:1]#,                                  00416710
              BACKGROUND=(NOT OPTION.[9:1])#,                           00416720
              "NOT ",  "USED",  %39%                                    00449000
$VOID 00451000                                                          00450499
              "NOT ",  "USED",  %37%                                    00451000
              "NOT ",  "USED",  %36%                                    00452000
$VOID                                                                   00452200
              "RNAL",  "L000",  %17%                                    00454910
              "NOT ",  "USED",  %16%                                    00454920
              "NOT ",  "USED",  %15%                                    00454930
              "NOT ",  "USED",  %14%                                    00454940
              "HALT",  "0000",  %13%                                    00454950
$INCLUDE 00454961, IF DCP;                                              00454959
              "NOT ",  "USED",  %12%                                    00454960
$OMIT 00454971, IF DCP;                                                 00454969
              "REMO",  "TE00",  %12%                                    00454970
             "CEME",  "SS00",  %11%                                     00454980
             "BATC",  "HZIP",  %10%                                     00454990
             "NOBA",  "TCH0",  %9%                                      00455000
             "OPTN",  "0000",  %0%                                      00455990
$#PATCH NUMBER  96  FOR  TSSMCP.XII  CONTAINS  18 CARDS    C                 &&&
         IF NB[J].[2:2]!SYSNO THEN NB[J]:=P(DUP,LOD,SSN) ELSE           06059220
         IF NB[J] GEQ FENCE THEN BRINGBACK(NB[J].[10:8]) ELSE           06059230
              M[NB[J].[FF]]:=1;                                         06059240
              HOLDLIST[Y]:=LOC.[FF]&[TOG][CTF]&SYSNO[2:46:2]            18017000
         IF HOLDLIST[T].[10:8]=P1MIX THEN                               18053500
         IF (SZ:=SZ-1) ! T THEN                                         18054000
         HOLDER.[FF]:=Y:=SZ;                                            18059000
         IF ((I:=FH[9].[9:20]-T) AND T|31)=0 THEN                       18352000
              LOCKDIRECTORY;                                            22051100
              IF (J:=HOLDER.[FF])!0 THEN    % HOLD LIST IS NOT EMPTY    22051200
              BEGIN                                                     22051250
                   BEGIN IF (JJ:=A[I]).[FF] GEQ FENCE THEN              22051800
                             BRINGBACK(JJ.[10:8]) ELSE M[JJ.[FF]]:=1;   22051900
              END;                                                      22052350
              UNLOCKDIRECTORY;                                          22052400
              IF CLOCK.[35:7]=0 THEN                                    22053660
$VOID 22053711                                                          22053700
    HOLDER:=DIRECTORYTOP-6-(HOLDMAX+29) DIV 30;                         44101100
$#PATCH NUMBER  97  FOR  TSSMCP.XII  CONTAINS  27 CARDS    I                 &&&
 BOOLEAN PROCEDURE CONQUER(C,N,L,S,G);                                  15168000
 VALUE C,N,L,S,G;                                                       15168100
 INTEGER G;                                                             15169100
         Y:    IF G THEN IF(L~ABS(L))|N>512 THEN GO TO X;               15173200
                   BEGIN IF NOT G THEN P(0,RTN);                        15175000
              X:   IF NOT N THEN                                        15175900
                             BEGIN G~CONQUER(C,N~N DIV 2,L,N INX S,1);  15176000
                                   G~CONQUER(S INX N,N,L,S,1);          15177000
                                   P(1,RTN);                            15177800
              CONQUER~1;                                                15187500
    LABEL C21A;                                                         19006250
$VOID                                                                   19130000
      IF NOT CONQUER(0,R5-1,R6,1 INX A,J) THEN                          19131100
      BEGIN FORGETSPACE(A);                                             19131110
C21A: STREAM(P1MIX,T~R5|R6,A~I~SPACE(7));                               19131120
      BEGIN DS~LIT "#"; SI~LOC P1MIX;                                   19131130
            DS~2 DEC; DS~ 13 LIT " NO SORT MEM:";                       19131140
            DS~5 DEC; DS~9 LIT " WDS RQD~";                             19131150
      END;                                                              19131160
      SPOUT(I);                                                         19131170
      REPLY[P1MIX]~-@30412;                                             19131180
      COMPLEXSLEEP(REPLY[P1MIX]>0 OR TERMSET(P1MIX));                   19131190
      IF TERMSET(P1MIX) THEN GO TO INITIATE;                            19131200
      IF NOT WHYSLEEP(@30412) THEN GO TO C21A;                          19131210
      J~REPLY[P1MIX].[CF]=3;                                            19131220
      GO TO C21;                                                        19131230
      END;                                                              19131240
$#PATCH NUMBER  98  FOR  TSSMCP.XII  CONTAINS  35 CARDS    I                 &&&
              "MC", %MAKE A COMPILER                                    08168390
         LABEL WI,CM,SWITCHIT,BK,MC;                                    16010300
                          ,MC                                           16020110
MC:      NAMEID(HN1,KTR);                                               16149500
         NAMEID(HN2,KTR);                                               16149510
         NAMEID(HN2,KTR);                                               16149520
         IF(A:=DIRECTORYSEARCH(HN1,HN2,4)) NEQ 0 THEN                   16149540
         BEGIN IF(TOG~DIRECTORYSEARCH(HN1,"DISK   ",5))!0 THEN          16149550
               BEGIN FORGETSPACE(TOG); FORGETSPACE(A);                  16149560
                     LBMESS(-HN1,HN2,"NOT ","MC-ED","(DUP ","FILE)",0); 16149570
               END ELSE                                                 16149580
               BEGIN M[A INX 4]:=(*P(DUP))&2[1:46:2]&1[8:47:1];         16149590
                     ENTERUSERFILE(-HN1,"DISK   ",A INX 0-1);           16149600
                     A:=A&DIRECTORYFREE[18:32:15];                      16149610
                     FORGETSPACE(DIRECTORYSEARCH(HN1,HN2,8));           16149620
                     HEADERUNLOCK(HN1,"DISK   ",A);                     16149640
                      LBMESS(HN1,HN2,"MC-ED:",HN1,"/DISK C","OMPILER",0)16149650
               ;END                                                     16149660
         END ELSE LBMESS(-HN1,HN2,"NOT ","MC-ED","(NOT ON"," DISK)",0); 16149670
         GO TO EXIT;                                                    16149680
%    .[8:1]       USED TO MARK SPECIAL COMPILERS                        18104100
         TSPOL          =63#,                                           20235050
         COBOL68        =65#,                                           20235080
         "TSPOL  ",          63,                                        20270050
         "COBOL68",          65,                                        20270080
               IF (CN~SCAN)=PERIO THEN BEGIN CCCOMPILE~1; GO EXIT END;  20585350
               IF CN<ALGOL OR CN>COBOL THEN                             20585355
                IF(T:=DIRECTORYSEARCH(ACCUM[0],"DISK   ",5))!0 THEN     20585360
                BEGIN IF NOT M[T+4].[8:1] THEN                          20585365
                      BEGIN LBMESS(-ACCUM[0],"DISK   ",                 20585370
                            "NOT A ","COMPILE","R",0,0);                20585375
                      FORGETSPACE(T); CCCOMPILE~1; GO EXIT;             20585380
                      END; FORGETSPACE(T);                              20585385
                END;                                                    20585390
         DIRECT ~ [M[P(..RESWDS,LOD,1,INX)]]&151[8:38:10];              20601700
$#PATCH NUMBER  99  FOR  TSSMCP.XII  CONTAINS  10 CARDS    I                 &&&
              H[4]:=H[6]:=0;                                            07179200
              A:=M[I+6].[CF];                                           07278000
              L2:=M[I+6].[CF];                                          07312000
                   IF (FIRSTDECK:=L2)=0 THEN LASTDECK:=0;               07314100
              IF (V:=M[J+6].[CF])=0 THEN GO TO REMOVE;                  07318000
              M[J+6].[CF]:=L2;                                          07321000
                               IF (N:=M[D+6].[CF])!0 THEN GO TRYIT ELSE 07371820
         NEXT:IF (A:=H[6].[CF])!0 THEN GO TO L;                         07451000
         H[4]:=0&15[12:44:4];                                           07550000
            M[I+6].[CF]:=T1;                                            07565000
$#PATCH NUMBER 100  FOR  TSSMCP.XII  CONTAINS   1 CARDS    I                 &&&
      IF R5.[FF]=@77777 THEN BEGIN M[R5]:=MOD3IOS;GO INITIATE;END ELSE  19532964
$#PATCH NUMBER 101  FOR  TSSMCP.XII  CONTAINS   2 CARDS    C                 &&&
                   M[T INX 4].[9:39]:=B[4]&1[11:47:1]; % (SHM)          05087500
              M[T INX 4].[36:6]:=A[5].[32:6]; % FILE TYPE (SHM)         05087710
$#PATCH NUMBER 102  FOR  TSSMCP.XII  CONTAINS   1 CARDS    C                 &&&
    C37: NEXT1[P1MIX] := R5; % SHM                                      19532800
