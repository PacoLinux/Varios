%....................MONDAY, 5/11/70....................                00000010
%   T S - M C P  M A R K    X I I I . 0                    07/15/71     00001000
%                                                                       00002000
BEGIN                                                                   00003000
$INCLUDE 00003751, IF DCP;                                              00003099
 ARRAY DCPARRAY[*];                   % QUEUES FOR DCP-MCP INTERFACE    00003100
 REAL DCPARR = DCPARRAY;              % DCP EXPECTS THIS TO BE AT @202  00003150
 DEFINE  REQUESTQ  = DCPARRAY[0]#,    % MCP TO DCP REQUESTS             00003200
         RESULTQ   = DCPARRAY[1]#,    % RESULTS FROM THE DCP            00003250
         DCPSPACEQ = DCPARRAY[2]#,    % QUEUE OF AREAS FOR DCP USE      00003300
         SPACEQ    = DCPARRAY[5]#,                                      00003350
         MYREQUEST = DCPARRAY[7]#;    % USED TO BUILD REQUEST QUEUE     00003400
 DEFINE  INITIATEDCP  = P(SCI)#,                                        00003450
         SETATTENTION = P(SAN)#,                                        00003500
         HALTDCP      = P(SAN,SCS)#,                                    00003550
         STAMAX       = 20#,                                            00003600
         LMAX         = STAMAX#,                                        00003650
         REMOTE       = DCPTOG#,                                        00003700
         DCPDSK       = (DIRECTORYTOP-6)#;                              00003750
 DEFINE MIXMAX=29#;                                                 %R1300004000
$OMIT 00004801, IF DCP;                                                 00004499
 DEFINE MAXLMAX=48#;                                                %R1300004500
 REAL LMAX;                                                         %R1300004600
$OMIT 00004701, IF TWXONLY;                                             00004699
 REAL STAMAX;                                                           00004700
$INCLUDE 00004801, IF TWXONLY;                                          00004799
 DEFINE STAMAX=LMAX#;                                                   00004800
 DEFINE  FREG=5#;%REMEMBER TO CHANGE THIS DAMN THING IF MORE BED STUFF  00005000
%VOID                                                                   00005100
DEFINE ESAD=[1:15]#, UNUM=[16:5]#,BYBY(BYBY1,BYBY2)=BEGIN STREAM(PUNTER)00005200
      ; DS~BYBY2 LIT BYBY1; PUNT([PUNTER[0]]) END # ;                   00005202
 DEFINE RESERVEDISKSIZE=2000#;                                          00005300
 DEFINE TRACESIZE=30#;%                                                 00006000
 REAL JUNK=5;%                                                          00007000
$OMIT 00008001, IF DCP;                                                 00007999
 LABEL GOGOGO,NORMALERROR,P2BUSY,TIMER,EXTERNAL,INQUEST,                00008000
$INCLUDE 00008003, IF DCP;                                              00008001
LABEL GOGOGO,NORMALERROR,P2BUSY,TIMER,EXTERNAL,WAKEUP,                  00008002
       PROCSWIT,P2FAKE,KEYBOARDREQUEST,RETURN,COMINIT,MEMORYPARITY  %WF 00009000
       ;                                                                00010000
 DEFINE MARK = "?"#;                                                    00011000
 DEFINE LEFTARROW="~"#;                                              %DS00011500
 DEFINE SHEETMAX=9#;                                                    00012000
DEFINE GETUSERDISK(GETUSERDISK1)=PETUSERDISK(GETUSERDISK1,EUSN)#;%******00012001
    INTEGER RRRMECH=@201;%                                              00013000
 SAVE REAL PROCEDURE GETSPACE(SIZE,TYPE,SAVEF);                         00014000
                       VALUE SIZE,TYPE,SAVEF;%                          00015000
                       INTEGER SIZE,TYPE;%                              00016000
                       BOOLEAN SAVEF;            FORWARD;%              00017000
SAVE REAL PROCEDURE WAITIO(IOD,MASK,U);%                                00018000
                    VALUE IOD,MASK,U; REAL IOD,MASK,U; FORWARD;%        00019000
SAVE PROCEDURE SLEEP(ADDRESS,MASK);%                                    00020000
     VALUE ADDRESS,MASK; NAME ADDRESS; ARRAY MASK[*]; FORWARD;%         00021000
 LABEL   SLATESTARTER;                                                  00022000
 REAL LOGLINE;                                                          00023000
 REAL LOGLINE2;                                                         00023500
REAL NT1=@160,NT2=@161,NT3=@162,NT4=@163,NT5=@164,NT6=@165,NT7=@166;    00024000
COMMENT NT1 THRU NT7 ARE USED BY THE MCP FOR TEMPORARY STORAGE.         00024010
        ALL PROCESSES THAT USE THESE VARIABLES ASSUME THAT IF CONTROL   00024020
        IS LOST, THEIR CONTENT MAY HAVE BEEN CHANGED BY THE TIME        00024030
        THAT CONTROL IS REGAINED.                                       00024040
END COMMENT;                                                            00024050
REAL MCPBASE;                                                           00024100
COMMENT MCPBASE CONTAINS THE DISK ADDRESS (OCTAL) OF THE BEGINNING      00024200
        OF THE MCP THAT IS CURRENTLY IN USE. THIS ADDRESS IS PASSED TO  00024210
        THE MCP BY THE LOADER ROUTINE AT EACH HALT/LOAD IN M[0].[18:30].00024220
        WHEN THE ESPBIT ROUTINE IS CALCULATING THE DISK ADDRESS         00024230
        OF AN MCP SEGMENT, IT ADDS MCPBASE TO THE ADDRESS THAT          00024240
        IS CONTAINED IN THE PRT CELL FOR THAT SEGMENT.                  00024250
END COMMENT;                                                            00024260
 SAVE PROCEDURE MCPIN(S); VALUE S; REAL S;FORWARD;                      00024500
SAVE PROCEDURE ESPBIT; COMMENT PRESENCE BIT ROUTINE FOR ESP SEGMENTS;%  00025000
         BEGIN REAL PRTLOC,SYLLABLE;                                    00026000
              REAL RCW=+0;                                              00029000
                                                                        00030000
              PRTLOC~(RCW INX 0)&RCW[30:10:2];%                         00031000
              STREAM(RSLT~[SYLLABLE],CL~PRTLOC);%                       00032000
                   BEGIN SI~CL; SI~SI-2; DI~RSLT; DI~DI+6; DS~2 CHR END;00033000
              PRTLOC ~ IF SYLLABLE THEN NT4%                            00034000
                                ELSE SYLLABLE.[36:10];%                 00035000
         MCPIN(PRTLOC);                                                 00036000
                   POLISH(0,RDF,0,XCH,FCX,STS);%                        00054000
              GO TO POLISH(MEMORY[PRTLOC]);%                            00055000
         END ESPBIT;%                                                   00056000
LABEL NOTHINGTODO,INITIATE,START,STACKOVERFLOW,IOBUSY;                  00057000
LABEL FINDIT;                                                           00057100
REAL    RESULT1=12 ,RESULT2=13 ,RESULT3=14 ,RESULT4=15 ;%               00058000
                                                                        00059000
DEFINE SIZE=[8:10]#,              FILEBIT=[1:1]#,OWNBIT=[2:1]#,%        00060000
     DIMENSIONS=[3:5]#,BLKCNTR=[8:10]#,MOM=[18:15]#,CURBLKCNTR=16#,%    00061000
       AITNDX=6#,PBIT=[2:1]#;%                                          00062000
 DEFINE  FF=18:15#,%                                                    00063000
         MSFF = [16:1]#,                                                00063100
         CF=33:15#,%                                                    00064000
         CTF=18:33:15#,%                                                00065000
         FTF=18:18:15#,%                                                00066000
         CTC=33:33:15#,%                                                00067000
         FTC=33:18:15#,                                              %PB00067100
         DELTA=11#;%                                                    00068000
 REAL CLICK;                                                            00069000
 REAL TOGLE;                                                            00080000
 DEFINE HP2TOG        = TOGLE.[47:1]#, HP2MASK       =   @1#            00080100
       ,STATUSBIT     = TOGLE.[46:1]#, STATUSMASK    =   @2#            00080200
       ,SHEETFREE     = TOGLE.[45:1]#, SHEETMASK     =   @4#            00080300
       ,STACKUSE      = TOGLE.[44:1]#, STACKMASK     =  @10#            00080400
       ,AREARDY       = TOGLE.[43:1]#, AREARDYMASK   = @20#             00080500
       ,USERDISKREADY= TOGLE.[42:1]#, USERDISKMASK=  @40#               00080600
       ,HOLDFREE      = TOGLE.[41:1]#, HOLDMASK      = @100#            00080700
       ,NSECONDREADY  = TOGLE.[40:1]#, NSECONDMASK   = @200#            00080800
       ,SYSDISKTOG    = TOGLE.[39:1]#, SYSDISKMASK   = @400#            00080900
       ,NEEDSELECT    = TOGLE.[38:1]#                                   00080950
       ,KEYBOARDREADY = TOGLE.[37:1]#, KEYBOARDMASK  =@2000#            00081000
       ,NOBACKTALK    = TOGLE.[36:1]#, NOBACKTALKMASK=@4000#            00081100
       ,INTFREE       = TOGLE.[34:1]#, FREEMASK     =@20000#            00081300
       ,WORKING       = TOGLE.[33:1]#                                   00081400
      ,CANDEINPUTREADY= TOGLE.[32:1]#  % WONT WORK FOR MULTIPLE C&ES    00081410
$INCLUDE 00081421, IF DCP;                                              00081419
       ,DCPTOG         = TOGLE.[31:1]# % ON WHEN DCP IS RUNNING         00081420
       ,DCPLOAD        = TOGLE.[30:1]#, DCPLOADMASK   = @400000#        00081430
      ,MCPFREE=TOGLE.[24:1]#, MCPMASK=@40000000#                        00081670
              % USED TO PROTECT DISK SEGMENT ZERO                       00081675
       ,SCRATCHDIRECTORYREADY = TOGLE.[23:1]#,                          00081680
                           SCRATCHDIRECTORYMASK = @100000000#           00081690
              % USED TO PROTECT THE SCRATCHDIRECTORY                    00081695
      ,FINDINGADDRESS=TOGLE.[22:1]#                                     00081700
              % SET TRUE WHENEVER THE INDEPENDENT RUNNING ROUTINE       00081705
              % "FINDFREEADDRESS" IS STARTED SO THAT ONLY ONE COPY      00081706
              % WILL BE RUN AT ONE TIME.                                00081707
       ,CDFREE=TOGLE.[21:1]#,CDMASK=@400000000#                         00081710
              % SET TRUE WHEN CONTROL DECK QUEUE IS FREE                00081711
$INCLUDE 00081981, IF STATISTICS;                                       00081979
              ,PBUSY = TOGLE.[4:1]#                                     00081980
       ;                                                                00081999
     STREAM PROCEDURE MOVE(N)"WORDS FROM"(HERE)"TO"(THERE);%            00082000
                      VALUE N,HERE,THERE;%                              00083000
       COMMENT     WILL MOVE 0 TO 4095 WORDS;%                          00084000
              BEGIN LOCAL NDIV64;%                                      00085000
                    SI~LOC N; DI~LOC NDIV64; SI~SI+6; DI~DI+7; DS~1 CHR;00086000
                    SI~HERE; DI~THERE;%                                 00087000
                    NDIV64(DS~32 WDS; DS~32 WDS); DS~N WDS;%            00088000
              END MOVE;%                                                00089000
 PROCEDURE STOPM; FORWARD;                                              00089100
 LABEL DIFFCOM;                                                         00089200
 SAVE PROCEDURE FORGETSPACE(LOC);%                                      00090000
                      VALUE LOC;%                                       00091000
                      REAL LOC;%                                        00092000
FORWARD;%                                                               00093000
 DEFINE WAITSTORE(WAITSTORE1)=                                          00093100
              IF NOT MEM[WAITSTORE1,0].[17:1] THEN                      00093200
                   SLEEP([MEM[WAITSTORE1,0]],0&1[17:47:1])#;            00093300
 DEFINE STOREDY[STOREDY1]=MEM[STOREDY1,0].[17:1]#;                      00093400
REAL DATE=@167;                                                         00111000
         COMMENT DATE CONTAINS TODAYS DATE;%                            00112000
REAL CLOCK=@170;                                                        00113000
REAL XCLOCK=@171;                                                       00114000
         COMMENT CLOCK CONTAINS THE NUMBER OF TIME INTERVAL INTERRUPTS% 00115000
              PROCESSED SINCE HALT-LOAD IN 9-41;%                       00116000
REAL READY=@172;                                                        00121000
         COMMENT READY CONTAINS THE CONTENTS OF THE READY REGISTER ON%  00122000
              THE LAST READ;%                                           00123000
                                                                        00124000
         COMMENT STATUSBIT IS FALSE IF THE STATUS ROUTINE IS RUNNING AND00125000
              TRUE OTHERWISE.  THIS PREVENTS TWO COPIES OF STATUS FROM% 00126000
              RUNNING TOGETHER;%                                        00127000
    ARRAY PRT[*,*];%                                                    00128000
         COMMENT PRT[I,*] CONTAINS A DATA DESCRIPTOR WITH PROPER SIZE%  00129000
              FIELD POINTING AT PRT FOR JOB WITH MIX INDEX = I;%        00130000
 ARRAY PRTROW=PRT[*];                                      %  MIXMAX+1% 00131000
         COMMENT PRTROW IS DOPE VECTORS FOR PRT;%                       00132000
         ARRAY  JAR[*,*];%                                              00133000
%   JAR HOLDS INFO OF JOBS IN PROCESS%                                  00134000
 ARRAY INTRNSC[*];  REAL INTSIZE;%  RE-ENTRANT INTRINSICS ON USER DISK  00135000
 DEFINE INTABLE[INTABLE1,INTABLE2]=UV3[INTABLE1,12,INTABLE2]#,          00135100
        INTABLEROW[INTABLEROW1]=UV[INTABLEROW1,12]#;                    00135200
 ARRAY SHEET[*];                                           %  5%        00136000
%   TOGGLES FOR INTEGERLOCKING THE CLOSET & SHEET%                      00137000
 ARRAY JARROW=JAR[*];                                      %  MIXMAX+1% 00138000
 DEFINE PRYOR[PRYOR1]=UV[PRYOR1,5]#;                            COMMENT 00150200
 ARRAY PRYOR[*];                                           %  MIXMAX+1  00150300
                                                                        00151000
         COMMENT STACKUSE IS TRUE IF THE INDEPEDENT STACK IS NOT IN USE,00152000
              OTHERWISE FALSE;%                                         00153000
    BOOLEAN NOPROCESSTOG;%                                              00154000
         COMMENT   NOPROCESSTOG IS TRUE IF NORMAL STATE PROCESSING IS%  00155000
              ALLOWED, OTHERWISE IT IS FALSE.  IT IS USED BY OVERLAY AND00156000
              OTHERS TO PREVENT CONFUSION;%                             00157000
 COMMENT FPBD[I] = FILE BLOCK DATA DESCRIPTOR FOR JOB WITH MIX=I;       00158100
 DEFINE FPBD[FPBD1]=UV[FPBD1,7]#;                                       00158190
 COMMENT SEGD[I] = SEGMENT DICTIONARY NAME DESCRIPTOR FOR MIX=I;        00158200
 DEFINE SEGD[SEGD1]=UV[SEGD1,8]#;                                       00158300
 COMMENT SINFO[I].[CF] = BOTTOM OF STACK (B-WORD)                       00158400
                 .[FF] = ESTIMATED CORE REQUIRMENTS                     00158500
                 .[1:17]=CLOCK AT BOJ;                                  00158600
 DEFINE SINFO[SINFO1]=UV[SINFO1,9]#;                                    00158700
                                                                        00158800
 ARRAY ISTACK[*];                                                       00159000
         COMMENT THE INDEPENDENT STACK;%                                00160000
 DEFINE PROCTIME[PROCTIME1]=UV[PROCTIME1,13]#;                  COMMENT 00160900
 ARRAY PROCTIME[*];                                        %  MIXMAX+1% 00161000
         COMMENT PROCTIME[I] CONTAINS PROCESSOR TIME FOR JOB WITH%      00162000
              MIX INDEX = I;%                                           00163000
 DEFINE IOTIME[IOTIME1]=UV[IOTIME1,11]#;                        COMMENT 00163900
 ARRAY IOTIME[*];                                          %  MIXMAX+1% 00164000
         COMMENT IOTIME[I] CONTAINS I-O TIME FOR JOB WITH MIX INDEX =I; 00165000
DEFINE EUIOHOLDER=DIRECTORYTOP-5#,EUTAPER=.98#,DISKAVAILTABLEMAX=130#;  00165500
INTEGER NEUP;  ARRAY EUIO[*];  ARRAY PEUIO[*] ;                         00166000
REAL EUSN;%***************************TEMPORARY*************************00166001
$INCLUDE 00166004,IF SHAREDISK ;                                        00166002
INTEGER AVS ;                                                           00166003
$OMIT 00166007,IF SHAREDISK ;                                           00166005
ARRAY AVTABLE[*] ;                                                      00166006
       COMMENT NEUP.[CF] CONTAINS THE NUMBER OF EUS ON DKA.             00166010
              NEUP.NEUF CONTAINS THE TOTAL NUMBER OF EUS ON THE SYSTEM. 00166025
              EUIO AND PEUIO CONTAIN THE I-O TIME USED BY A GIVEN EU.   00166030
              THIS INFORMATION IS USED BY GETUSERDISK IN AN ATTEMPT TO  00166040
              MINIMIZE  EU CONFLICT;                                    00166050
 ARRAY CHANIO[*];                                                   %R5900169000
 ARRAY CHANNEL[*];                                         %  5%        00170000
         COMMENT CHANNEL[I] CONTAINS LOGICAL UNIT OF LAST DESCRIPTOR%   00171000
              SENT OUT ON CHANNEL I;%                                   00172000
 ARRAY FINALQUE[*];                                        %  32%       00173000
 ARRAY LOCATQUE[*];                                        %  32%       00174000
         COMMENT IOQUE,FINALQUE, AND LOCATQUE TOGETHER WITH UNIT FORM%  00175000
              THE I-O QUEUE.  AN I-O REQUEST FOR LOGICAL UNIT U REQUIRES00176000
              THREE WORDS OF SPACE IN THE I-O QUEUE.  IF THE REQUEST%   00177000
              OCCUPIES POSITION S IN THE I-O QUEUE, THEN IOQUE[S] )%    00178000
              I-O DESCRIPTOR FOR THIS REQUEST, FINAL[S] = I-O DESCRIPTOR00179000
              SKELETON TO BE USED AT I-O COMPLETE TIME TO REBUILD%      00180000
              I-O DESCRIPTOR, LOCATQUE[S] = LOCATION OF I-O DESCRIPTOR% 00181000
              AT TIME OF REQUEST.  LOCATQUE[S] CONTAINS SOME ADDITIONAL 00182000
              INFORMATION.  IN PARTICULAR:%                             00183000
                    0- 2 = 5%                                           00184000
                    3- 7 = MIX INDEX OF REQUESTER%                      00185000
                       8 = USED BY SHARED DISK MCP                  %GEH00185100
                       9 = SUPPRESS ERROR MESSAGES ON THIS I/O      %GEH00185500
                      10 = REPORT I/O COMPLETE IN EVENT QUE             00186000
                      11 = ERROR RECOVERY IN PROCESS ON THIS I-O        00186100
                   12-17 = LOGICAL UNIT NUMBER%                         00187000
                   18-32 = INDEX OF NEXT REQUEST TO BE DONE ON THIS UNIT00188000
                           OR @77777 IF NO NEXT REQUEST%                00189000
                   33-47 = ORIGINAL LOCATION OF I-O DESCRIPTOR.%        00190000
              UNIT[U] CONTAINS INFORMATION ABOUT LOGICAL UNIT U.%       00191000
                    1- 4 = TYPE OF I/O DEVISE%                          00192000
                    5-12 = ERROR FIELD OF LAST I/O DONE ON THIS UNIT%   00193000
                      13 = UNIT NOT READY BIT%                          00194000
                      14 = ERROR BIT (ON IF ERROR)%                     00195000
                      15 = WAIT BIT (ON IF UNIT IS WAITING FOR A CHANNEL00196000
                   16-17 = PROCESS BITS (USUALLY BOTH ON IF UNIT IS IN% 00197000
                             PROCESS OR BOTH OFF.  WITH PRINTERS THE%   00198000
                             I-O FINISH SETS OFF 16 AND THE PRINTER%    00199000
                             FINISH SETS OFF 17)%                       00200000
                   18-32 = INDEX OF FIRST I-O REQUEST FOR WHICH SERVICE 00201000
                             IS NOT COMPLETE%                           00202000
                   33-47 = INDEX OF LAST UNSERVICED I-O REQUEST.%       00203000
              THE SPACES NOT USED IN THE I-O QUEUE ARE LINKED TOGETHER% 00204000
              THROUGH IOQUE.  THE FIRST AVAILABLE IS IN IOQUEAVAIL;%    00205000
    REAL IOQUEAVAIL;%                                                   00206000
         COMMENT SEE ABOVE COMMENT;%                                    00207000
 ARRAY IOQUE[*];                                           %  32%       00208000
    ARRAY UNIT[32] ~%                                                   00209000
              @0400007777777777, COMMENT MTA =  0;%                     00210000
              @0400007777777777, COMMENT MTB =  1;%                     00211000
              @0400007777777777, COMMENT MTC =  2;%                     00212000
              @0400007777777777, COMMENT MTD =  3;%                     00213000
              @0400007777777777, COMMENT MED =  4;%                     00214000
              @0400007777777777, COMMENT MEF =  5;%                     00215000
              @0400007777777777, COMMENT MEH =  6;%                     00216000
              @0400007777777777, COMMENT MEJ =  7;%                     00217000
              @0400007777777777, COMMENT MEK =  8;%                     00218000
              @0400007777777777, COMMENT MEL =  9;%                     00219000
              @0400007777777777, COMMENT MEM = 10;%                     00220000
              @0400007777777777, COMMENT MEN = 11;%                     00221000
              @0400007777777777, COMMENT MEP = 12;%                     00222000
              @0400007777777777, COMMENT MER = 13;%                     00223000
              @0400007777777777, COMMENT MES = 14;%                     00224000
              @0400007777777777, COMMENT MET = 15;%                     00225000
              @0600007777777777, COMMENT DRA = 16;%                     00226000
              @0600007777777777, COMMENT DRB = 17;%                     00227000
              @1000007777777777, COMMENT DKA = 18;%                     00228000
              @1000007777777777, COMMENT DKB = 19;%                     00229000
              @0200007777777777, COMMENT LPA = 20;%                     00230000
              @0200007777777777, COMMENT LPB = 21;%                     00231000
              @1400007777777777, COMMENT CPA = 22;%                     00232000
              @0000007777777777, COMMENT CRA = 23;%                     00233000
              @0000007777777777, COMMENT CRB = 24;%                     00234000
              @1200007777777777, COMMENT SPO = 25;%                     00235000
              @2000007777777777, COMMENT PPA = 26;%                     00236000
              @2200007777777777, COMMENT PRA = 27;%                     00237000
              @2200007777777777, COMMENT PRB = 28;%                     00238000
              @2000007777777777, COMMENT PPB = 29;%                     00239000
              @2400007777777777, COMMENT DCA = 30;%                     00240000
              @3600007777777777; COMMENT     = 31;%                     00241000
$ OMIT 00241701, IF SHAREDISK;                                          00241600
ARRAY TINU[37] :=                                                       00241700
$ INCLUDE 00241901, IF SHAREDISK;                                       00241800
ARRAY TINU[41] :=                                                       00241900
                   @ 020010040446321,  COMMENT MTA;                     00242000
                   @ 060020040446322,  COMMENT MTB;%                    00243000
                   @ 120040040446323,  COMMENT MTC;%                    00244000
                   @ 160110040446324,  COMMENT MTD;%                    00245000
                   @ 220120040446325,  COMMENT MTE;%                    00246000
                   @ 260140040446326,  COMMENT MTF;%                    00247000
                   @ 320210040446330,  COMMENT MTH;%                    00248000
                   @ 360220040446341,  COMMENT MTJ;%                    00249000
                   @ 420240040446342,  COMMENT MTK;%                    00250000
                   @ 460310040446343,  COMMENT MTL;%                    00251000
                   @ 520320040446344,  COMMENT MTM;%                    00252000
                   @ 560340040446345,  COMMENT MTN;%                    00253000
                   @ 620410040446347,  COMMENT MTP;%                    00254000
                   @ 660420040446351,  COMMENT MTR;%                    00255000
                   @ 720440040446362,  COMMENT MTS;%                    00256000
                   @ 760510040446363,  COMMENT MTT;%                    00257000
                   @ 100520040245121,  COMMENT DRA;%                    00258000
                   @ 200540040245122,  COMMENT DRB;%                    00259000
                   @ 140610040244221,  COMMENT DKA;%                    00260000
                   @ 300620040244222,  COMMENT DKB;%                    00261000
                   @ 540640000434721,  COMMENT LPA;%                    00262000
                   @ 640710000434722,  COMMENT LPB;%                    00263000
                   @ 240720000234721,  COMMENT CPA;%                    00264000
                   @ 240740040235121,  COMMENT CRA;%                    00265000
                   @ 341010040235122,  COMMENT CRB;%                    00266000
                   @ 741020000624746,  COMMENT SPO;%                    00267000
                   @ 441040000474721,  COMMENT PPA;%                    00268000
                   @ 441110000475121,  COMMENT PRA;%                    00269000
                   @ 501120000475122, COMMENT PRB;%                     00270000
                   @ 501140000474722, COMMENT PPB;%                     00271000
$OMIT 00272001, IF DCP;                                                 00271999
                   @ 401210000242321,  COMMENT DCA;%                    00272000
$INCLUDE 00272501, IF DCP;                                              00272499
                   @401210000242347,  COMMENT DCP;%                     00272500
                   @ 001220000713147,  COMMENT ZIP;%                    00273000
                   @ 001240000232421,  COMMENT CDA;%                    00274000
                   @ 001310000232422,  COMMENT CDB;%                    00275000
                   @ 001320000232423,  COMMENT CDC;%                    00276000
                   @ 001340000232424,  COMMENT CDD;                     00277000
%                                                                       00277100
$ INCLUDE 00277995, IF SHAREDISK;                                       00277987
                   @ 000000000627021,  COMMENT SYA;                     00277988
                   @ 000000000627022,  COMMENT SYB;                     00277990
                   @ 000000000627023,  COMMENT SYC;                     00277992
                   @ 000000000627024,  COMMENT SYD;                     00277994
                   @ 000000000446367;  COMMENT MTX, ALL SCRATCH TAPES;  00277998
 ARRAY WAITQUE[*];                                         %  8%        00278000
    REAL NEXTWAIT,FIRSTWAIT;%                                           00279000
         COMMENT WAITQUE IS A QUEUE OF UNITS FOR WHICH THERE ARE%       00280000
              REQUESTS BUT NO CHANNEL IS AVAILABLE.  NEXTWAIT AND%      00281000
              FIRSTWAIT ARE POINTERS AT THE WAITQUE.  NEXTWAIT IS THE%  00282000
              NEXT AVAILABLE SLOT IN WAITQUE AND FIRSTWAIT POINTS AT%   00283000
              NEXT UNIT TO BE USED WHEN A CHANNEL IS AVAILABLE;%        00284000
 ARRAY LABELTABLE[*];                                      %  32%       00285000
 ARRAY MULTITABLE[*];                                      %  32%       00286000
 ARRAY RDCTABLE[*];                                        %  32%       00287000
 ARRAY PRNTABLE[*];%                                                    00288000
 ARRAY REPLY[*];%                                                       00289000
COMMENT LABELTABLE, MULTITABLE, AND RDCTABLE CONTAIN LABEL INFORMATION% 00290000
        BY LOGICAL UNIT NUMBER AS FOLLOWS:%                             00291000
        LABELTABLE[I] CONTAINS THE FILE ID FOR LOGICAL UNIT I.%         00292000
        MULTITABLE[I] CONTAINS THE CORRESPONDING MULTI-FILE ID.%        00293000
        RDCTABLE[I] CONTAINS THE CORRESPONDING REEL NUMBER (IN [14:10]),00294000
        CREATION DATE (IN [24:17]), AND CYCLE (IN [41:7]);%             00295000
$ INCLUDE 00296501, IF SHAREDISK;                                       00295999
DEFINE LQMAX=20#; % SIZE OF THE LQUE ARRAY                              00296000
ARRAY LQUE[*];                                                          00296100
REAL LQAVAIL;                                                           00296200
COMMENT LQUE CONTAINS ONE ENTRY FOR EACH IO THAT IS WAITING FOR         00296300
        A LOCKED DISK SEGMENT.                                          00296310
                                                                        00296315
        LQUE[N].[8:40] CONTAINS THE DISK ADDRESS (BCD)                  00296320
        LQUE[N].[1:7] CONTAINS AN INDEX INTO THE IOQUE.                 00296330
        LQAVAIL IS AN INDEX POINTING TO THE FIRST EMPTY WORD IN LQUE.   00296340
                                                                        00296345
        WHEN A LOCKED SEGMENT RESULT DESCRIPTOR IS ENCOUNTERED,         00296350
        THE IOQUE ENTRY FOR THAT IO IS DISCONNECTED FROM THE            00296360
        UNIT TABLE AND AN ENTRY IS MADE FOR IT IN LQUE. WHEN THE        00296370
        REQUESTED ADDRESS IS UNLOCKED, THE PROCEDURE FINDFREEADDRESS    00296380
        REMOVES THE ENTRY FROM LQUE AND RECONNECTS IT TO THE UNIT TABLE.00296390
END COMMENT;                                                            00296400
REAL OPTION;%                                                           00297000
 REAL SYSDISK,SYSDISKADR;                                               00297050
$OMIT 00298181, IF DCP;                                                 00297099
 ARRAY LINETABLE[*];    % LMAX LONG - USED TO KEEP INFO ABOUT LINES     00297100
 DEFINE                                                                 00297120
    LOCKED[LOCKED1]=LINETABLE[LOCKED1].[1:1]#,  % LOCK BIT FOR DCWAIT   00297140
    DIRECTLINE     = [2:1]#,    % DIRECT CONNECT FLAG (ALSO SCHEDBUSY)  00297160
    LINEDISC[LINEDISC1]=LINETABLE[LINEDISC1].[3:3]#,                    00297180
    LINEDIS        = [3:3]#,    % THE LINE DISCIPLINES ARE:             00297200
      TTY          = 0#,                                                00297220
      CONTENTION   = 1#,                                                00297240
      MULTIPOINT   = 2#,          MULTI = MULTIPOINT#,                  00297260
      SCHED        = 7#,                                                00297280
    BUFSIZE        = [6:2]#,    % BUFFER SIZE - 0=28, 1=56, 2=112       00297300
    PINGPING       = [8:1]#,    % ON IF BUFFERS ARE PINGPING            00297320
%                    [9:4]      % TERMINAL UNIT                         00297340
%                    [13:1]     % GROUPMARK FLAG                        00297360
%                    [14:4]     % BUFFER NUMBER                         00297380
%                    [18:2]     % ADAPTER TYPE 0=980, 1=SAS             00297400
    THROWAWAY[THROWAWAY1]=LINETABLE[THROWAWAY1].[20:1]#,                00297420
%                    [26:7]     % NOT USED                              00297440
    LONGCARRIAGE[LONGCARRIAGE1]=LINETABLE[LONGCARRIAGE1].[32:1]#,       00297460
                                % SUPPRESSES LINE FOLDING FOR TWX       00297480
%                    [33:15]    % HEAD OF INPUT Q - ADDRESS FOR RD IF LC00297500
    LSTATUS[LSTATUS1]=LINETABLE[LSTATUS1].[21:5]#,                      00297520
                                % THE STATUSES ARE:                     00297540
      WRB          = 0#,        % WRITING STATUSES                      00297560
      POLLING      = 1#,                                                00297580
      SELECT         = 2#,                                              00297600
      ACKING       = 3#,                                                00297620
      NAKING       = 4#,                                                00297640
      ACKINGENQ    = 5#,                                                00297660
      NAKINGENQ    = 6#,                                                00297680
      WRBUSY       = 7#,                                                00297700
      IDL          = 8#,        % IDLE STATI                            00297720
      IDLPOLLING   = 9#,                                                00297740
      WAITING      = 10#,                                               00297760
      WAITINGENQ   = 11#,                                               00297780
%       NOTUSED      12                                                 00297800
%       NOTUSED      13                                                 00297820
%       NOTUSED      14                                                 00297840
%       NOTUSED      15                                                 00297860
      NORMAL       = 16#,       % READING STATI                         00297880
      FIRSTIME     = 17#,                                               00297900
      SELECTANS    = 18#,                                               00297920
      ENQREAD      = 19#,                                               00297940
      BROKEN       = 20#,                                               00297960
      POLLTIMEOUT  = 21#,                                               00297980
      TIMEDOUT     = 22#,                                               00298000
      EOTREAD      = 23#,                                               00298020
      RRA          = 24#,                                               00298040
      MSGANSWER    = 25#,                                               00298060
%       NOTUSED      26                                                 00298080
%       NOTUSED      27                                                 00298100
%       NOTUSED      28                                                 00298120
%       NOTUSED      29                                                 00298140
%       NOTUSED      30                                                 00298160
      DISCON       = 31#;       % END OF LINETABLE DEFINES              00298180
 ARRAY STATABLE[*];     % STATIONMAX LONG - KEEPS INFO ABOUT STATIONS   00298200
 DEFINE                                                                 00298220
    PAPERTAPE[PAPERTAPE1]=STATABLE[PAPERTAPE1].[1:1]#,                  00298240
    ACTIVITY       = [2:1]#,    % SET ON SWAP OR DCIO, RESET BY NSECOND 00298260
    SWAPPED        = [3:1]#,    % ON WHENEVER ATTACHED JOB IS SWAPPED OU00298280
    CANDEFLAG      = [4:1]#,    % ON MEANS INPUT GOES TO CANDE          00298300
    MIXNR          = [5:5]#,    % MIX NUMBER OF JOB TO WHICH LINE       00298320
      MIXFLAG      = [4:6]#,    %   IS ATTACHED                         00298340
$OMIT 00298441, IF DCP;                                                 00298359
    STATIONTYPE    = [10:3]#,   % THE STATION TYPES ARE:                00298360
      TWX          = 0#,                                                00298380
      CONRAC       = 1#,                                                00298400
      TC500        = 2#,                                                00298420
      BIDS         = 3#,                                                00298440
$INCLUDE 00298455, IF DCP;                                              00298449
    DISCIT         = [10:1]#,    % IF ON, DISCONNECT WHEN OUTPUT IS FINI00298450
    NAKSTA[NAKSTA1]= STATABLE[NAKSTA1].[11:1]#,  % STA IS BUFFERED      00298452
    DIRECTLINE     = [12:1]#,    % DIRECT CONNECTION FLAG               00298454
    OWHTHROWOUT    = [13:1]#,   % HARRY IS DISCARDING INPUT ON THIS LINE00298460
    BREAK[BREAK1]  = STATABLE[BREAK1].[14:1]#,  % BREAK HAS OCCURRED    00298480
    DIALEDUP       = [15:1]#,   % ON IF STATION IS ALIVE                00298500
    DISCONNECTING[DISCONNECTING1]=STATABLE[DISCONNECTING1].[16:1]=0#,   00298520
%                               % OFF IF QUITTER OR JOB IS STILL RUNNING00298540
    QUITN[QUITN1]  = STATABLE[QUITN1].[17:1]#,  % INTERLOCK FOR QUITTER 00298560
$OMIT 00298641, IF DCP;                                                 00298579
%                    [18:4]     % NOT USED                              00298580
%                    [22:1]     % TEXT BIT FOR PREVIOUS OUTPUT BUFFER   00298582
%                    [23:1]     % TEXT BIT FOR CURRENT OUTPUT BUFFER    00298584
    OUTPUTANKING   = [24:1]#,                                           00298590
    LEENKER         = [25:8]#,   % READY QUEUE LINK IF STA LEQ LINEMAX  00298600
                                % LINE NUMBER IF STA GEQ LINEMAX        00298620
%                    [33:15]    % HEAD OF OUTPUT QUEUE                  00298640
$INCLUDE 00298663, IF DCP;                                              00298645
    OUTPUTANKING   = [18:1]#,    % ON IF STUFF IN TANKS                 00298646
    ERRORS         = [19:1]#,    % DCPERR IS FORKED FOR THIS STATION    00298648
%                    [20:1]      % MARKS A SCHEDULE STATION             00298650
    REINITIALIZED  = [21:1]#,    % RESTARTING AFTER NAK (ALSO SCHEDBUSY)00298652
%                    [22:1]#,    % USED FOR INITIALIZATION AND RECALLSTA00298654
%                    [23:1]#,    % NOT USED                             00298656
%                    [24:8]      % LINE NUMBER                          00298658
%                    [32:8]      % DCP-S STATION NUMBER                 00298660
%                    [40:8]      % LINK FOR MULTI-STA LINES & SCHED STAS00298662
    ENDOFSTATABLE  = #;                                                 00298670
$OMIT 00299301, IF DCP;                                                 00298679
 ARRAY SEQARRAY[*];     % STATIONMAX LONG - CONTENTS DEPEND ON LINEDISC 00298680
%                       % TWX                                           00298700
%                     [1:1]      % FLAG FOR SEQUENCING                  00298720
%                     [2:19]     % INCREMENT                            00298740
%                     [21:27]    % CURRENT SEQUENCE NUMBER              00298760
 DEFINE                                                                 00298780
                        % MULTIPOINT OR CONTENTION                      00298800
    SELECTED        = [1:1]#,    % SELECTED OR ENQ-ED                   00298820
    TANKOK[TANKOK1] = SEQARRAY[TANKOK1].[2:1]#,  % ON IF FULL INPUTANK  00298860
%                     [3:1]      % STATION IS NOT IN POLLING LIST       00298880
%                     [4:2]      % TIME OUT COUNT                       00298900
    NAKMAX          = [6:3]#,    % MAXIMUM NUMBER OF NAK-S BEFORE ABORT 00298920
    NAKCNT          = [9:3]#,    % NUMBER OF NAK-S ON CURRENT IO        00298940
%                     [12:12]    % ADDRESS CHARACTERS                   00298960
%                     [24:1]     % ! BEFORE FIRST CHARACTER             00298980
%                     [25:1]     % ! BEFORE SECOND CHARACTER            00299000
%                     [26:6]     % INDEX TO TNAOG                       00299020
                        % MULTIPOINT ONLY                               00299040
    LINELINK        = [32:8]#,   % CIRCULAR LINK TO ALL STATIONS ON LINE00299060
%                     [40:8]     % STATION IN READY QUEUE (MASTER ONLY) 00299080
%                                                                       00299100
%                       % SCHEDULE LINES                                00299120
%                     [1:1]      % ON IF CE IS READY FOR INPUT FROM LINE00299140
    SCHEND[SCHEND1] = SEQARRAY[SCHEND1].[2:1]#, % SCHEDULE TERMINATING  00299160
%                     [33:15]    % ADDRESS OF 80 WORD BUFFER ARRAY      00299180
    ENDOFSEQARRAY   = #;                                                00299200
  REAL LLNR; %KEEPS LOGICAL LINE NR OF AN IO WHILE IT IS ACTUALLY DONE. 00299300
  REAL BASEDISKADR; % BASE ADDRESS OF C&E"S CURRENT TANK CHUNK          00299400
  REAL WORKERSTACK;%ADDRESS OF OLDWIERDHAROLDS STACK,GOTTEN @ INITIALIZE00299500
  REAL WORKERINQ;                                                       00299600
  REAL DISKADR,LASTOFFSET,FIRSTOFFSET;                                  00299700
      % MUST BE ARRAY FOR MULTIPLE C&E"S.                               00299800
$ INCLUDE 00299861, IF SAVERESULTS OR DEBUGGING;                        00299849
  DEFINE STORAWAY = RESULTHOLDER[LASTRESULT := (LASTRESULT+1) AND       00299850
                                 (RESLTMAX-1)]#;                        00299860
  DEFINE WORKER = OLDWIERDHAROLD#;                                      00299900
  ARRAY LASTSEG[*],FIRSTSEG[*];                                         00300000
     % THESE ARRAYS ARE THE BUFFER SEGMENT NOW BEING FILLED FOR C&E,    00300100
     % AND THE BUFFER NEXT TO BE PASSED TO C&E. THEY MAY POINT TO THE   00300200
     % SAME AREA IN CORE OR NOT.                                        00300400
     % BOTH MUST BE 2-D FOR MULTIPLE C&E"S.                             00300500
  DEFINE STARTWORKING =                                                 00300600
         IF NOT WORKING THEN                                            00300700
         BEGIN WORKING := TRUE;                                         00300800
              FORK(P(.WORKER),0,-2,0,WORKERSTACK);                      00300900
         END #;                                                         00301000
  DEFINE MAKESTATUS(MAKESTATUS1,MAKESTATUS2) =                          00301100
                   DCREQUEST[MAKESTATUS1].[3:7] := MAKESTATUS2 #;       00301200
$INCLUDE 00301901, IF DCP;                                              00301499
DEFINE QDCP(QDCP1,QDCP2,QDCP3)=                                         00301500
    BEGIN M[(QDCP3:=GETAREA(0))+1]:=0&STATABLE[QDCP2][24:24:16]         00301600
                                    &QDCP1[1:41:7];                     00301700
         DCPQ(QDCP3);                                                   00301800
   END#;                                                                00301900
$OMIT 00302001, IF DCP;                                                 00301999
  INTEGER INTRGATCTR;                                                   00302000
 ARRAY TRANSACTION[*];                                     %  32%       00304000
 DEFINE ETRLNG = 5#;    % LENGTH OF ENTRY IN FILE BLOCK%                00305000
SAVE REAL PROCEDURE TWO(N); VALUE N; INTEGER N;                         00306000
              BEGIN REAL T=+1;                                          00307000
                   STREAM(N:=N:=47-N,T:=[T]);                           00308000
                   BEGIN SKIP N DB; DS:=SET; END;                       00308500
              END TWO;%                                                 00309000
    REAL SYLLABLE;%                                                     00310000
$ INCLUDE 00310191, IF SHAREDISK;                                       00310099
REAL SYSNO,SYSMAX;                                                      00310100
COMMENT SYSNO CONTAINS THE HARDWARE SYSTEM NUMBER.                      00310110
        SYSMAX CONTAINS THE MAXIMUM NUMBER OF SYSTEMS THAT CAN          00310120
        BE CONNECTED TOGETHER IN THIS CONFIGURATION.                    00310130
        BOTH OF THESE PARAMETERS ARE PASSED TO THE MCP BY THE           00310140
        MCP LOADER AT HALT/LOAD TIME:                                   00310150
             SYSNO IN M[0].[16:2] AND                                   00310160
             SYSMAX IN M[0].[14:2]                                      00310170
END COMMENT;                                                            00310180
$ OMIT 00310201, IF SHAREDISK;                                          00310199
DEFINE SYSNO=0#, SYSMAX=1#;                                             00310200
         COMMENT ANALYSIS PLACES THE SYLLABLE THAT CAUSED THE INTERRUPT 00311000
              IN SYLLABLE.  THIS IS USED BY PRESENCE BIT, FLAG BIT, AND 00312000
              VARIOUS ERRORS;%                                          00313000
PROCEDURE FORGETUSERDISK(A,L);VALUE A,L;REAL A,L;FORWARD;%              00316000
REAL PROCEDURE PETUSERDISK(N,T);VALUE N,T;REAL N,T;FORWARD ;            00316100
$ INCLUDE 00317001, IF DEBUGGING;                                       00316999
PROCEDURE DT;FORWARD;                                                   00317000
 ARRAY PUNTER[*];                                                       00318000
REAL SCHEDWRD;                                                          00318100
PROCEDURE SCHEDIO(NUM,TYPE,ADR);                                        00318110
    VALUE NUM,TYPE,ADR;                                                 00318120
    REAL NUM, TYPE, ADR;               FORWARD;                         00318130
PROCEDURE SCHEDIDLE(ADR); VALUE ADR; REAL ADR;   FORWARD;               00318140
$ INCLUDE 00319001, IF SAVERESULTS OR DEBUGGING;                        00318899
  INTEGER LASTRESULT;                                                   00318900
  ARRAY RESULTHOLDER[*]; % HOLDS LAST DC RESULT DESCRIPTORS% RESLTMAX   00319000
  DEFINE                                                                00319100
         SCHEDNUM       =SCHEDWRD.[CF]#,                                00319140
         FRSTSCHED      =SCHEDWRD.[FF]#,                                00319150
         LSTSCHED       =SCHEDWRD.[3:15]#,                              00319160
         SCHEDTOG       =(NOT(SCHEDWRD.[1:1]))#,                        00319170
         TYPEINFO       =10#,  %C&E FILE TYPE FOR SCHEDULE OUTPUT FILE  00319180
$OMIT 00319401, IF DCP;                                                 00319199
         SCH[SCH1]      = (SCH1[4].[3:3]=SCHED)#,                       00319200
         SCHEDBUSY[SCHEDBUSY1]=LINETABLE[SCHEDBUSY1].[2:1]#,            00319250
         SCHEDLINE[SCHEDLINE1]=(LINEDISC[SCHEDLINE1]=SCHED)#,           00319300
         TANKNDIAL      = 27:42:6 #,                                    00319350
         INTERROGATEMASK= @0400004000000000#,                           00319400
         CONNECT(CONNECT1)=STATABLE[CONNECT1]:=(*P(DUP))&1[15:47:1]     00319500
                        &(CANDEMIX[CONNECT1]+32)[4:42:6]#,              00319600
         FIOADR         = (FIRSTSEG.[CF] - 2)#,                         00320000
         IOADR          = (LASTSEG.[CF] - 2)#,                          00320600
         LINENR         = [10:8]#,                                      00320950
         LINKER         = [10:8]#,                                      00321000
         LINEMAX        = LMAX#,                                        00321050
         MESSEND        = [5:1]#,                                       00321100
         NDSABLE        = [7:1]#,                                       00321300
         OFFSET         = [3:6]#,                                       00321400
$ INCLUDE 00322001, IF SAVERESULTS OR DEBUGGING;                        00321999
         RESLTMAX = 128#, %     MUST BE POWER OF 2                      00322000
         ROWNR          = [10:8]#,                                      00322300
         STATIONMAX     = STAMAX#,                                      00323000
         SYSDISKRL      = SYSDISK.[1:14]#,                              00324000
         SYSDISKRPB     = SYSDISK.[30:12]#,                             00324050
$INCLUDE 00324451, IF DCP;                                              00324099
         SEQARRAY       = TNAOG#,      % USED FOR SCHEDULE LINES        00324100
         SCH[SCH1]      = (SCH1[0].[20:1])#,                            00324120
         SCHEDLINE[SCHEDLINE1]=(STATABLE[SCHEDLINE1].[20:1])#,          00324150
         SCHEDBUSY[SCHEDBUSY1]=STATABLE[SCHEDBUSY1].[21:1]#,            00324200
         SCHEND[SCHEND1]= TNAOG[SCHEND1].[2:1]#,                        00324250
         DCPCELL        = M[15]#,                                       00324300
         TANKNDIAL      = 19:41:7 #,                                    00324350
         TEXTLENGTH     = [40:8]#,                                      00324400
         QMASK          = @40000000#,                                   00324450
         TAILOUT        = TANKS[0].[CF]#,                               00324500
         HEADOUT        = TANKS[0].[2:8]#,                              00324670
         TANKCHUNKSIZE  = 256#;                                         00324700
 ARRAY INPUTANK[*];     % STATIONMAX LONG - KEEPS TRACK OF INPUT TANKS  00326000
 DEFINE                                                                 00326100
%                     [1:1]      % LOCK BIT                             00326200
%                     [2:8]      % NEXT CHARACTER TO BE DETANKED        00326300
    INPUTL          = [10:8]#,   % OLDEST SEGMENT IN TANK               00326400
%                     [18:15]    % HEAD OF QUEUE OF 30 WORD AREAS       00326500
    INPUTREADY      = [33:1]#,   % ON IF JOB SWAPPED TO WAIT FOR INPUT  00326600
    SLOWDOWN        = [34:1]#,   % ON IF TANKS ARE ALMOST FULL          00326700
    FIRSTBUF        = [35:1]#,   % ETX IN PREVIOUS INPUT BUFFER         00326800
%                     [36:1]     % NOT USED                             00326900
%                     [38:2]     % MODE BITS FOR COMM13                 00327000
    INPUTN          = [40:8]#,   % NUMBER OF SEGMENTS IN TANK           00327100
%                                                                       00327200
    CLUMPSIZE       = 32#;       % EACH LINE HAS 1 CLUMP OF DISK FOR INP00327300
 REAL PROGTANK;         % BASE ADDRESS FOR INPUT TANKS                  00327400
 ARRAY TANKS[*];        % STATINMAX LONG - HANDLES OUTPUT TANKS         00327500
 DEFINE                                                                 00327510
%                     [1:1]      % TANK INTERLOCK BIT                   00327515
    TANKLINE[TANKLINE1]=TANKS[TANKLINE1].[2:8]#, % DETANKING QUEUE      00327520
%                     [10:1]     % CANDE SHUT-UP FLAG                   00327525
    TANKFUL[TANKFUL1]=TANKS[TANKFUL1].[11:1]#,   % TANK FULL BIT        00327530
$OMIT 00327566, IF DCP;                                                 00327534
%                     [12:1]     % SOH BIT ON=SOH OFF=ETX               00327535
%                     [13:1]     % LAST MSG NAKKED WHEN ON              00327540
    TANKL           = [14:5]#,   % NEXT SEG TO DETANK                   00327545
%                     [19:5]     % NEXT WORD OF SEG                     00327550
%                     [24:3]     % NEXT CHAR OF WORD                    00327555
    SOUSE           =  27:6 #,   % NO OF SEGS IN USE                    00327560
    TANKN           = [27:6]#,                                          00327565
$INCLUDE 00327596, IF DCP;                                              00327569
    DCPMESSAGES     = [12:2]#,    % NUMBER OF PIECES PASSED TO DCP      00327570
%                     [13:5]      % NOT USED                            00327575
    NEXTPIECE       = [18:1]#,    % NEXT 112 CHAR PIECE TO DETANK       00327580
    TANKN           = [19:7]#,    % NUMBER OF SEGMENTS ON DISK          00327585
      SOUSE         =  19:7 #,    %                                     00327590
    TANKL           = [26:7]#,    % RELATIVE ADDRESS OF OLDEST SEG      00327595
    TANKA[TANKA1]=TANKS[TANKA1].[33:15]#,        % CORE ADDRESS OF TANK 00327600
%                                                                       00327700
    GLOMSIZE       = 32#;                                               00327800
 REAL TANKADDRESS;      % BASE ADDRESS FOR OUTPUT TANKS                 00327900
$INCLUDE 00328996, IF DCP;                                              00328299
 REAL LINETABLE;        % TRANSLATES LINE/STA INTO INTERNAL STA NUM     00328300
 DEFINE                 % CLASSES FOR REQUESTS AND RESULTS              00328350
    NULL                      = 0#,                                     00328355
    SETCLUSTERMASK            = 1#,                                     00328360
    ENTERCONTROLMODE          = 2#,                                     00328365
    ADAPTERWRITE              = 3#,                                     00328370
    ACTIVEINTERROGATE         = 4#,                                     00328375
    PASSIVEINTERROGATE        = 5#,                                     00328380
    ENTERNORMALMODE           = 6#,                                     00328385
    REINITIALIZEDOUTPUT       = 7#,                                     00328390
    REINITIALIZEDINPUT        = 8#,                                     00328395
    REINITIALIZEDENABLEDINPUT = 9#,                                     00328400
    OUTPUT                    = 10#,                                    00328405
    INPUT                     = 11#,                                    00328410
    ENABLEINPUT               = 12#,                                    00328415
    RESETSTATIONCHARACTERS    = 13#,                                    00328420
    SETADAPTERTYPE            = 14#,                                    00328425
    INTERROGATESTATUS         = 15#,                                    00328430
    SETSTATIONREADY           = 16#,                                    00328435
    SETTRANSMISSIONNUMBER     = 17#,                                    00328440
    SETSTATIONCHARACTERS      = 18#,                                    00328445
    SETSEQUENCEMODE           = 19#,                                    00328450
    ABORTED                   = 20#,                                    00328455
    ENABLEDINPUT              = 21#,                                    00328460
    LOOKFORRING               = 22#,                                    00328465
    BREAKREQUEST              = 23#,                                    00328470
    DISCONNECT                = 24#,                                    00328475
    SETSTATIONTYPE            = 25#,                                    00328480
    SETSTATIONADDRESS         = 26#,                                    00328485
    RECALLSTATION             = 27#,                                    00328490
    ANSWER                    = 28#,                                    00328495
                        % RESULTS                                       00328550
    IGNORED                   = 0#,                                     00328555
    CLASSINVALID              = 1#,                                     00328560
    KEYINVALID                = 2#,                                     00328565
    LINEINVALID               = 3#,                                     00328570
    STATIONINVALID            = 4#,                                     00328575
    FUNCTIONUNDEFINED         = 5#,                                     00328580
    CLUSTERMASKINVALID        = 6#,                                     00328585
    VARIANTINVALID            = 7#,                                     00328590
    TEXTINVALID               = 8#,                                     00328595
    TRANSMITABORTED           = 9#,                                     00328600
    RECEIVEABORTED            = 10#,                                    00328605
    LOGICABORTED              = 11#,                                    00328610
    DISCONNECTABORTED         = 12#,                                    00328615
    SWITCHABORTED             = 13#,                                    00328620
    ADAPTORFAULT              = 14#,                                    00328625
    STATUSERROR               = 15#,                                    00328630
    MESSAGERROR               = 16#,                                    00328635
    TEXTREINITIALIZED         = 17#,                                    00328640
    OKRESULT                  = 18#,                                    00328645
    REQUESTCONTINUED          = 19#,                                    00328650
    INCOMPLETEREQUEST         = 20#,                                    00328655
    STATUSPRESENT             = 21#,                                    00328660
                        % STATUS FLAGS                                  00328705
    CONNECTED                 = [24:1]#,                                00328710
    LINEBUSY                  = [25:1]#,                                00328715
    LINESUSPENDED             = [26:1]#,                                00328720
    LINESWITCHING             = [27:1]#,                                00328725
    CONTROL                   = [28:1]#,                                00328730
    LINERINGING               = [29:1]#,                                00328735
                        % ERROR FLAGS                                   00328750
    TIMEOUTFLAG               = [47:1]#,                                00328755
    STOPBIT                   = [46:1]#,                                00328760
    BYTEOVERFLOW              = [45:1]#,                                00328765
    BREAKINPUT                = [44:1]#,                                00328770
    DISCON                    = [43:1]#,                                00328775
    BROKEN                    = [42:1]#,                                00328780
    PARITYFLAG                = [41:1]#,                                00328785
    BCCCHECK                  = [40:1]#,                                00328790
    ADDRESSFLAG               = [39:1]#,                                00328795
    TRANSMISSIONUMBERERROR    = [38:1]#,                                00328800
    FORMATERROR               = [37:1]#,                                00328805
    NAK                       = [36:1]#,                                00328810
    SPECIALCHARACTER          = [35:1]#,                                00328815
    WRU                       = [34:1]#,                                00328820
    SEQUENCENUMBEROVERFLOW    = [33:1]#,                                00328825
    TOBEACKNOWLEDGED          = [32:1]#,                                00328830
    NAKONSELECT               = [31:1]#,                                00328835
    ENDOFBUFFER               = [30:1]#,                                00328840
    CARRIERLOST               = [29:1]#,                                00328845
    LASTDEF                   = #;                                      00328995
 ARRAY TNAOG[*];        % TRANSMISSION NUMBERS AND OTHER GOODIES        00329000
$INCLUDE 00329701, IF DCP;                                              00329049
 DEFINE                                                                 00329050
%                    [1:1]       % NOT USED                             00329100
%                    [2:1]       % TANK HALF FOR NAK POINTER            00329150
%                    [3:7]       % CHARACTER COUNT FOR NAK POINTER      00329200
%                    [10:1]      % PIECE DCP IS WORKING ON              00329250
    DCPSEG         = [11:7]#,    % SEGMENT CONTAINING DCP-S PIECE       00329300
    DETANK         = [18:7]#,    % SEGMENT TO DETANK NEXT               00329400
%                    [25:8]      % NUM OF CHARS NOT GIVEN TO HARRY      00329500
%                    [33:15]     % HEAD OF INPUT QUEUE OR LOCKLINE QUEUE00329600
$VOID                                                                   00329699
    ENDOFTNAOG     = #;                                                 00329700
$OMIT 00330901, IF TWXONLY OR DCP;                                      00329799
%                       % USE DEPENDS ON STATION TYPE                   00329800
%                       % TC500                                         00329900
%                     [1:27]     % NOT USED                             00330000
%                     [28:10]    % INPUT TRANSMISSION NUMBER            00330100
%                     [38:10]    % OUTPUT TRANSMISSION NUMBER           00330200
%                       % PAGED SCREEN DEVICES                          00330300
%                     [1:13]     % NOT USED                             00330400
%                     [14:6]     % NUMBER OF LINES PER PAGE             00330500
%                     [20:8]     % NUMBER OF CHARACTERS PER LINE        00330600
%                     [28:8]     % NUM OF CHARS SENT ON CURRENT LINE    00330700
%                     [36:6]     % NUM OF LINES ON PREVIOUS PAGE        00330800
%                     [42:6]     % NUM OF LINES ON CURRENT PAGE         00330900
$ INCLUDE 00332001, IF DEBUGGING;                                       00330999
    REAL  DTCALL = DT;%                                                 00331000
 DEFINE DDT = P(DTCALL,DEL,ZP1)#;                                       00332000
 DEFINE DALOC[DALOC1,DALOC2]=UV3[DALOC1,10,DALOC2]#;                    00333000
 DEFINE DALOCROW[DALOCROW1]=UV [DALOCROW1,10]#;                         00334000
                                                                        00335000
 ARRAY   DRUMTABLE[*];                                                  00335100
 DEFINE  DRUMCTR = DRUMTABLE[0]#;                                       00335200
 REAL OLAYMASK;%   FOR LOCKING OUT GETMOREOLAYDISK BY MIX INDEX         00336000
PROCEDURE USERDISKSPECIALCASE(Q,R,U,J);VALUE Q,J;REAL Q,R,J;            00336100
          ARRAY U[*]; FORWARD ;                                         00336110
                                                                        00363000
PROCEDURE FORGETESPDISK(SEG);VALUE SEG;REAL SEG;FORWARD;                00364000
 SAVE INTEGER PROCEDURE DISKSPACE(NWORDS,P1MIX);%                       00365000
                        VALUE NWORDS,P1MIX;%                            00366000
                        INTEGER NWORDS,P1MIX;%                          00367000
              FORWARD;%                                                 00368000
 PROCEDURE STATUS;%                                                     00369000
         FORWARD;%                                                      00370000
 PROCEDURE INTERRUPT(TYPE); VALUE TYPE; REAL TYPE; FORWARD;             00370500
REAL PROCEDURE FINDOUTPUT(MID,FID,TYPE,FORMS,REEL,CDATE,CYCLE,KIND);%   00371000
            VALUE MID,FID,TYPE,FORMS,REEL,CDATE,CYCLE,KIND;%            00372000
            REAL  MID,FID,TYPE,FORMS,REEL,CDATE,CYCLE,KIND; FORWARD;%   00373000
REAL PROCEDURE FINDINPUT(MID,FID,REEL,CDATE,CYCLE,COBOL,UL,OF,MODE,FN); 00374000
            VALUE MID,FID,REEL,CDATE,CYCLE,COBOL,UL,OF,MODE,FN;%        00375000
            REAL  MID,FID,REEL,CDATE,CYCLE,COBOL,UL,OF,MODE,FN; FORWARD;00376000
PROCEDURE STARTIMING(FN,U); VALUE FN,U; REAL FN,U; FORWARD;%            00377000
    PROCEDURE SPOUTIT(M,T); VALUE M,T; REAL M,T; FORWARD;               00378000
 PROCEDURE FILEOPEN(X,A); VALUE X,A; INTEGER X,A; FORWARD;          %R9000379000
 SAVE PROCEDURE SAVEOPEN(A); VALUE A; REAL A;                       %R9000379100
         BEGIN FILEOPEN(2,A) END;                                   %R9000379200
PROCEDURE SETNOTINUSE(U,RWL); VALUE U,RWL; REAL U,RWL; FORWARD;         00380000
                                                                        00381000
DEFINE STOPTIMING=STARTIMING#;                                          00382000
PROCEDURE FILEMESS(I,K,M,F,R,D,C); VALUE I,K,M,F,R,D,C;%                00383000
                                   REAL  I,K,M,F,R,D,C; FORWARD;%       00384000
PROCEDURE FILLBUFFERS(CURRENT,FINAL,NF,NR); VALUE CURRENT,FINAL,NF,NR;% 00385000
            REAL CURRENT,FINAL,NF,NR; FORWARD;%                         00386000
DEFINE GETBUFFERS=FILLBUFFERS#;                                         00387000
                                                                        00388000
 PROCEDURE REALFILECLOSE(A); VALUE A; REAL A; FORWARD;              %R9000389000
 SAVE PROCEDURE FILECLOSE(A); VALUE A; REAL A;                      %R9000389100
          BEGIN REALFILECLOSE(A) END;                               %R9000389200
REAL PROCEDURE DISKADDRESS(MID,FID,A,H,IO);                             00390000
    VALUE MID,FID,A,H,IO;                                               00390100
    REAL MID,FID,A,IO; ARRAY H[*];                                      00390200
    FORWARD;                                                            00391000
PROCEDURE BLASTQ(U); VALUE U; REAL U; FORWARD;%                         00392000
REAL PROCEDURE FILEHEADER(MID,FID,NROWS,SIZE,BLEN,RLEN,S);%             00393000
                  VALUE   MID,FID,NROWS,SIZE,BLEN,RLEN,S;%              00394000
                  REAL    MID,FID;%                                     00395000
                  INTEGER         NROWS,SIZE,BLEN,RLEN,S; FORWARD;%     00396000
PROCEDURE PURGEIT(U); VALUE U; INTEGER U; FORWARD;%                     00397000
 REAL ESPTAB,ESPCOUNT;                                                  00399000
REAL DIRDSK=@177;                                                       00400500
REAL ESPDISKBOTTOM; % LOWEST ADDRESS OF ESPDISK                         00401000
REAL ESPDISKTOP; % HIGHEST ADDRESS OF ESPDISK                           00401100
 REAL  MESSAGEHOLDER;%                                                  00402000
    DEFINE USEDRA = OPTION.[47:1]#,%                                    00403000
         USEDRB = OPTION.[46:1]#,%                                      00404000
         BOJMESS     =OPTION.[45:1]#,%                                  00405000
         EOJMESS     =OPTION.[44:1]#,%                                  00406000
         OPNMESS     =OPTION.[43:1]#,%                                  00407000
         TERMGO    =OPTION.[42:1]#,%                                    00408000
              GIVEDATE = OPTION.[41:1]#,%                               00409000
              GIVETIME = OPTION.[40:1]#,%                               00410000
              %39(USED BY DCMCP)                                        00411000
         AUTOPRINT = OPTION.[38:1]#,%                                   00412000
              %37(USED BY DCMCP)                                        00413000
              %36(USED BY DCMCP)                                        00414000
              COPNMESS=OPTION.[35:1]#,%                                 00415000
              CLOSEMESS=OPTION.[34:1]#,%                                00416000
              RETMSG=OPTION.[32:1]#,                                    00416100
              LIBMSG=OPTION.[31:1]#,                                    00416200
              SCHEDMSG=OPTION.[30:1]#,                                  00416300
              SECMSG=OPTION.[29:1]#,                                    00416400
              DSKTOG=OPTION.[28:1]#,                                    00416500
      RELTOG=OPTION.[27:1]#,                                            00416520
              PBDREL=OPTION.[26:1]#,                                    00416550
              CHECK = OPTION.[25:1]#,                                   00416560
              DISKMSG = OPTION.[24:1]#,                                 00416570
              DKLOG = OPTION.[23:1]#,                                   00416580
              LIBERR=OPTION.[22:1]#,                                    00416590
              USEPBD=OPTION.[21:1]#,%                                %DS00416600
              SVPBT =OPTION.[20:1]#,%                                   00416610
              RSTOG=OPTION.[19:1]#,                                     00416620
              AUTOUNLD=OPTION.[18:1]#,                                  00416630
              RNALL=OPTION.[17:1]#,                                     00416640
              %16(USED BY DCMCP)                                        00416650
              %15(USED BY DCMCP)                                        00416660
              %14(USED BY DCMCP)                                        00416670
              HALTSET=OPTION.[13:1]#,                                   00416680
$OMIT 00416691, IF DCP;                                                 00416689
              REMOTE=OPTION.[12:1]#,                                    00416690
              CANDYMESS=OPTION.[11:1]#,                                 00416700
              BATCHTOG=OPTION.[10:1]#,                                  00416710
              BACKGROUND=(NOT OPTION.[9:1])#,                           00416720
         MOD3IOS=OPTION.[2:1]#,                                         00416990
         XXXXXX= OPTION.[0:0]#;%                                        00417000
REAL USERDISKBOTTOM;                                                    00418000
    % DISK ADDRESS OF USER DISK AVAILABLE TABLE                         00418010
REAL DIRECTORYTOP;                                                      00418050
    % DISK ADDRESS OF DIRECTORYTOP SEGMENT--STORED IN M[1]              00418060
    % BY MCP LOADER                                                     00418070
DEFINE HOLDMAX=30#; % MAXIMUM NUMBER OF ENTRIES IN HOLDLIST             00418200
$ INCLUDE 00418901, IF SHAREDISK;                                       00418799
COMMENT HOLDER, NEXTSLOT, AND BYPASS ARE KEPT IN THE FIRST THREE        00418800
        WORDS OF THE DISK SEGMENT LOCATED AT DIRECTORYTOP+".            00418805
        THEY ARE READ DIRECTLY INTO THE PRT WHEN THE DIRECTORY          00418810
        IS LOCKED AND WRITTEN BACK WHEN THE DIRECTORY IS UNLOCKED.      00418815
END COMMENT;                                                            00418820
REAL KLUDGE; % RESERVES SPACE FOR DISK ADDRESS                          00418900
COMMENT THE HOLDLIST CONTAINS A ONE WORD ENTRY FOR EACH PROCESS         00418910
        THAT IS WAITING TO USE A FILE THAT IS ALREADY IN USE.           00418915
             HOLDLIST[I].[FF]=THE CORE ADDRESS OF THE WORD THAT THE     00418920
                  WAITING PROCESS IS SLEEPING ON.                       00418925
             HOLDLIST[I].[CF]=THE DISK ADDRESS OF THE FILE HEADER       00418930
                  THAT IS BEING WAITED FOR.                             00418935
             HOLDLIST[I].[2:2]=THE SYSTEM NUMBER (SYSNO) OF THE SYSTEM  00418940
                  THAT MADE THE ENTRY (SHAREDISK ONLY).                 00418945
             HOLDLIST[I].[1:1] IS SET BY A SYSTEM TO NOTIFY ANOTHER     00418950
                 SYSTEM TO AWAKEN THE PROCESS THAT MADE THE ENTRY.      00418955
                 THE NSECOND ROUTINE EXAMINES THE HOLDLIST IN           00418960
                 ORDER TO CHECK FOR THIS CONDITION (SHAREDISK ONLY).    00418965
        DIRECTORYSEARCH, NSECOND, AND CLEANOUT ARE THE PROCEDURES       00418970
        THAT MANIPULATE THE HOLDLIST.                                   00418975
END COMMENT;                                                            00418980
REAL HOLDER; % HOLDER.[CF]=DISK ADDRESS OF HOLDLIST                     00419000
                 % HOLDER.[FF]=NUMBER OF ENTRIES IN HOLDLIST            00419005
REAL NEXTSLOT; % NEXT AVAILABLE SPACE IN DIRECTORY                      00419010
REAL BYPASS;                                                            00419020
REAL DISKBOTTOM; % LOWEST ADDRESS OF USER DISK                          00419050
DEFINE SCRAMBLE(SCRAMBLE1,SCRAMBLE2)=(-2|                           %10400419100
    ((SCRAMBLE1.[6:18]+SCRAMBLE1.[24:24]) MOD MODULUS | MODULUS +   %10400419200
     (SCRAMBLE2.[6:18]+SCRAMBLE2.[24:24]) MOD MODULUS)+             %10400419300
    DISKBOTTOM)#,                                                   %10400419400
  MODULUS=13#, DIRMOD=169#;                                         %10400419500
COMMENT                                                                 00419600
         THE RELATIONSHIP BETWEEN MODULUS AND DIRMOD IS:                00419610
         DIRMOD := MODULUS | MODULUS, WHERE MODULUS IS A LOW            00419620
         ODD PRIME. (THE RECOMMENDED VALUE OF MODULUS IS 13).           00419630
         FOR SYSTEMS WITH FEWER THAN 6 MEMORY MODS, MODULUS MUST BE     00419640
         SET TO A SMALLER VALUE SO THAT DIRECTORYBUILDER WILL           00419650
         NOT GET A NO-MEM, MAKING IT IMPOSSIBLE TO HALT/LOAD.           00419660
         IT IS SUGGESTED THAT MODULUS BE SET TO 11, DIRMOD TO 121       00419670
         FOR A SYSTEM WITH FEWER THAN 6 MODS. IT MAY BE NECESSARY       00419680
         TO SET IT SMALLER, DEPENDING ON THE DISK CONFIGURATION         00419690
         AND THE NUMBER OF MODS;                                        00419700
ARRAY USERDISK[*];%%%%%%%%%KLUDGE%%%%%%%%%%%%%%%%%%                     00419900
$ INCLUDE 00421001, IF DEBUGGING;                                       00419999
ARRAY DBARRAY[*];                                                       00420000
    REAL DBADR;%                                                        00421000
DEFINE LOCKDIRECTORY=BEGIN SLEEP([DIRECTORYFREE],1);DIRECTORYFREE:=0;   00421100
$ INCLUDE 00421201, IF SHAREDISK;                                       00421199
         DISKWAIT(-POLISH(.HOLDER),-3,DIRECTORYTOP+2);                  00421200
    END#,                                                               00421300
    UNLOCKDIRECTORY=BEGIN                                               00421400
$ INCLUDE 00421501, IF SHAREDISK;                                       00421499
         DISKWAIT(POLISH(.HOLDER),-3,DIRECTORYTOP+2);                   00421500
         DIRECTORYFREE:=1 END#;                                         00421600
    REAL DIRECTORYFREE;%                                                00422000
                                                                        00423000
    REAL IOMASK;%                                                       00424000
 REAL SAVEWORD;%                                                        00425000
REAL CORE;           %USED FOR SELECTION PURPOSES                       00426000
    COMMENT                                                             00426100
       CORE.[4:14] = MULTIPROCESSING FACTOR (|100)                      00426200
       CORE.[18:15] = SUM OF CORE ESTIMATES FOR ALL JOBS                00426300
                           NOW ACTIVE IN THE MIX (DIV 64)               00426400
       CORE.[33:15] = AMOUNT OF CORE MEMORY INITIALLY AVAILABLE FOR     00426500
                           PROCESSING NORMAL STATE JOBS (DIV 64);       00426600
 DEFINE SELECTION = FORK(P(.SELECTRUN),0,-1,196,0)#,                    00426700
         FREECARD(FREECARD1)=FORK(P(.CONTROLCARD),FREECARD1,-1,192,0)#, 00426790
         CCARD(CCARD1)=FORK(@100000|LOGLINE OR P(.CONTROLCARD),         00426800
                     CCARD1,-1,192,0)#;                                 00426810
PROCEDURE SELECTRUN(F); VALUE F; REAL F; FORWARD;                       00426900
PROCEDURE CONTROLCARD(A);VALUE A;REAL A; FORWARD;%                      00427000
REAL  PROCEDURE  DIRECTORYSEARCH(A,B,C);VALUE A,B,C;%                   00428000
              REAL  A,B,C; FORWARD;%                                    00429000
$OMIT 00429101, IF DCP;                                                 00429099
PROCEDURE NEXTDCIO;FORWARD;                                             00429100
 DEFINE HEADERUNLOCK=HU#,                                               00430000
        HU(HU1,HU2,HU3)=                                                00430100
         P(MKS,HU3,HU1,HU2,9,DIRECTORYSEARC,DEL)#;                      00430200
REAL DIRECTORYSEARC=DIRECTORYSEARCH;                                    00430225
   %%HEADERUNLOCK CAN BE USED TO WRITE IN THE DIRECTORY A CHANGED       00430250
   %%  HEADER, TURN OFF THE INTERLOCK BIT AND DO THE FORGETSPACE        00430275
   %%  IT MAY BE CALLED ONLY AFTER A DIRECTORYSEARCH(A,B,4)             00430300
   %% THE PARAMETERS PASSED MUST BE (A,B,DS);                           00430400
   %%  WHERE A,B ARE THE SAME AS PASSED TO THE DIRECTORYSEARCH          00430500
   %%   AND DS IS THE RESULT OF THAT DIRECTORYSEARCH                    00430600
 PROCEDURE ARTN(A,N); VALUE A,N; ARRAY A[*]; INTEGER N; FORWARD;%       00431000
 SAVE PROCEDURE DISKWAIT(CORE,SIZE,DISK);                               00431100
         VALUE CORE,SIZE,DISK;                                          00431200
         REAL CORE,SIZE,DISK;                                           00431300
         FORWARD;                                                       00431400
 PROCEDURE MAKEPRESENT(A); VALUE A; REAL A; FORWARD;                    00431500
 SAVE PROCEDURE DISKIO(L,C,S,D); VALUE C,S,D; REAL L; INTEGER C,S,D;%   00432000
         FORWARD;%                                                      00433000
 ARRAY OPTER[*];%                                                       00435000
 PROCEDURE OPSET;%                                                      00436000
         BEGIN REAL N;%                                                 00437000
              LABEL L,S;%                                               00438000
              GO TO S; P(.L);%                                          00439000
         L:::%                                                          00440000
              "DRA0", "0000",   %47%                                    00441000
              "DRB0", "0000",   %46%                                    00442000
              "BOJ0", "0000",   %45%                                    00443000
              "EOJ0", "0000",   %44%                                    00444000
              "OPEN", "0000",   %43%                                    00445000
              "TERM",  "NATE",  %42%                                    00446000
              "DATE",  "0000",  %41%                                    00447000
              "TIME",  "0000",  %40%                                    00448000
              "NOT ",  "USED",  %39%                                    00449000
              "AUTO",  "PRNT",  %38%                                    00450000
              "NOT ",  "USED",  %37%                                    00451000
              "NOT ",  "USED",  %36%                                    00452000
              "CMPL",  "FILE",  %35%                                    00453000
              "CLOS",  "E000",  %34%                                    00454000
              "ERRO",   "RMSG",   %33%                                  00454100
              "RET0","0000",%32                                         00454200
              "LIBM","SG00",%31                                         00454300
              "SCHE","DMSG",%30                                         00454400
              "SECM","SG00",%29                                         00454500
              "DSKT","OG00",%28                                         00454600
      "RELT","OG00",%27                                                 00454700
              "PBDR","EL00",%26                                         00454750
              "CHEC",  "K000",  %25%                                    00454760
              "DISK",  "MSG0",  %24%                                    00454770
              "DISK",  "LOG0",  %23%                                    00454850
              "LIBE", "RR00", %22                                       00454860
              "PBDO", "NLY0", %21                                    %DS00454870
              "SAVE", "PBT0", %20                                       00454880
             "RSMS","G000", %19                                         00454890
             "AUTO","UNLD", %18                                         00454900
              "RNAL",  "L000",  %17%                                    00454910
              "NOT ",  "USED",  %16%                                    00454920
              "NOT ",  "USED",  %15%                                    00454930
              "NOT ",  "USED",  %14%                                    00454940
              "HALT",  "0000",  %13%                                    00454950
$INCLUDE 00454961, IF DCP;                                              00454959
              "NOT ",  "USED",  %12%                                    00454960
$OMIT 00454971, IF DCP;                                                 00454969
              "REMO",  "TE00",  %12%                                    00454970
             "CEME",  "SS00",  %11%                                     00454980
             "BATC",  "HZIP",  %10%                                     00454990
             "NOBA",  "TCH0",  %9%                                      00455000
             "OPTN",  "0000",  %0%                                      00455990
              "~000",  "0000";  %STP%                                   00456000
        S:    N := P(.OPSET,LOD).[8:9]-6 AND @77;                       00457000
              OPTER ~ [M[GETSPACE(N,0,0)+2]]&N[8:38:10];%               00458000
              STREAM(S:=P(.OPSET,LOD) INX 1,N,OPTER);                   00459000
                   BEGIN SI ~ S;%                                       00460000
                        N(2(SI := SI+4; DS := 4 CHR));                  00461000
                   END;%                                                00462000
         END;%                                                          00463000
 PROCEDURE TERMINATE(MIX); VALUE MIX; REAL MIX; FORWARD;                00463100
 SAVE PROCEDURE TERMINALMESSAGE(N); VALUE N; REAL N; FORWARD;           00463200
BOOLEAN PROCEDURE SYSTEMFILE(A,B);VALUE A,B; REAL A,B; FORWARD;         00463300
 PROCEDURE COM5;   FORWARD;%                                            00469000
$INCLUDE 00471901, IF STATISTICS;                                       00469099
PROCEDURE FILLSYSTAT; FORWARD;                                          00469100
PROCEDURE SAVESTATISTICS; FORWARD;                                      00469200
DEFINE UVSIZE=33#;                                                      00469300
DEFINE SWAPS[SWAPS1]=UV[SWAPS1,19]#,                                %R6300469400
       SWAPOUTS[SWAPOUTS1]=UV[SWAPOUTS1,20]#,                       %R6300469500
 CODEPBITS[CODEPBITS1]=UV[CODEPBITS1,21]#,                    %R63      00469600
       DATAPBITS[DATAPBITS1]=UV[DATAPBITS1,22]#,                    %R6300469700
       DATAOLAYS[DATAOLAYS1]=UV[DATAOLAYS1,24]#,                        00469800
       CODEOLAYS[CODEOLAYS1]=UV[CODEOLAYS1,23]#,                    %R6300469900
       CORETIME[CORETIME1]=UV[CORETIME1,25]#,                           00470000
       TIMING[TIMING1]=UV[TIMING1,26]#,                                 00470100
       MORECPBITS[MORECPBITS1]=UV[MORECPBITS1,27]#,                     00470200
       READYQUETIME[READYQUETIME1]=UV[READYQUETIME1,28]#,               00470300
       QUETIMING[QUETIMING1]=UV[QUETIMING1,29]#,                        00470400
       INITIALRQTIME[INITIALRQTIME1]=UV[INITIALRQTIME1,30]#;            00470500
DEFINE MOREDPBITS[MOREDPBITS1]=UV[MOREDPBITS1,31]#,                     00470510
       OLAYUSED[OLAYUSED1]=UV[OLAYUSED1,32]#;                           00470520
       COMMENT  THE ABOVE ENTRIES IN UV ARE USED PURELY FOR         %R6300470600
                STATISTICS GATHERING AND ANALYZING;                 %R6300470700
 DEFINE COUNTUP(COUNTUP1,COUNTUP2)=BEGIN COUNTUPBY(COUNTUP1,1);         00470800
       COUNTUPBY((COUNTUP1)+30,COUNTUP2) END#,                          00470900
       COUNTUPBY(COUNTUPBY1,COUNTUPBY2)=COUNTARRAY[COUNTUPBY1]:=        00471000
          *P(DUP)+(COUNTUPBY2)#;                                        00471100
 ARRAY COUNTARRAY[*];                                                   00471200
REAL MCPTOP;                                                            00471300
REAL SYSTATBASE;                                                        00471400
ARRAY SWAPDELAY[*];                                                     00471600
ARRAY DISKWAITIME[*];                                                   00471700
REAL JOBNUM;                                                            00471800
REAL INTERVAL;                                                          00471900
 PROCEDURE ASR;    FORWARD;%                                            00474000
 PROCEDURE COM11;  FORWARD;%                                            00475000
 PROCEDURE COM13;  FORWARD;%                                            00477000
 PROCEDURE COMMUNICATE;  FORWARD;                                       00478000
 PROCEDURE LIBRARYLOAD; FORWARD;                                        00479000
 PROCEDURE LIBRARYDUMP;  FORWARD;                                       00480000
 PROCEDURE COM19;  FORWARD;%                                            00483000
 PROCEDURE COM23; FORWARD;%                                             00487000
PROCEDURE INTRINSICTABLEBUILDER(FH);                                    00489000
     VALUE FH; REAL FH; FORWARD;                                        00490000
$ INCLUDE 00500501, IF DCP;                                             00499999
PROCEDURE INITIALIZEDCP; FORWARD;                                       00500000
PROCEDURE DCPHANDLER; FORWARD;                                          00500100
PROCEDURE NEWLINE(R); VALUE R; REAL R; FORWARD;                         00500200
PROCEDURE DCPERR(T);  VALUE T; REAL T; FORWARD;                         00500300
PROCEDURE DCPFILECHANGER(BUFF); VALUE BUFF; REAL BUFF; FORWARD;         00500400
 SAVE PROCEDURE PUNT(I); VALUE I; ARRAY I[*];                           00650000
         BEGIN LABEL L;                                                 00651000
              REAL Q;                                                   00651100
              Q ~ (IF HALTSET THEN [PUNTER[3]] ELSE I).[CF]-2;          00651200
              PUNTER[0]~P(0,RDF);                                       00652000
              STREAM(I,Q);                                              00653000
                   BEGIN DS~16 LIT "*** SHOULD H/L: ";                  00654000
                        SI~I;                                           00655000
                        63(IF SC!"~" THEN DS ~CHR); DS~LIT"~";          00656000
                   END;                                                 00657000
              IF HALTSET THEN                                           00658000
         L:   GO TO L;                                                  00659000
              P(WAITIO(Q,0,25));                                        00660000
              GO TO NOTHINGTODO;                                        00661000
         END;                                                           00662000
 REAL CANDYINX;                                                         00750000
 DEFINE CANDEMIX[CANDEMIX1]=CANDYINX#;                                  00751000
 ARRAY MEMROW[30];                                                      00752000
 ARRAY MEM=MEMROW[*,*];                                                 00753000
 DEFINE  DSW       = 3#,                                                00754000
         BOJW      = 4#,                                                00755000
         IGNORE    = 5#,                                                00756000
         REMOVED   = 6#,                                                00757000
         CHANGED   = 7#,                                                00758000
         SECURED   = 8#,                                                00759000
         ZIPER     = 9#,                                                00760000
         NOTIN     =10#,                                                00761000
         NOTX      =11#,                                                00762000
         WWWW      =99#;                                                00799000
$ INCLUDE 00802001, IF DEBUGGING;                                       00799999
REAL PAUSEVALUE=127;                                                    00800000
SAVE PROCEDURE PAUSE(R); VALUE R; REAL R;                               00801000
BEGIN IF R}PAUSEVALUE THEN P(R,ZP1,DEL); END;                           00802000
$ INCLUDE 00824001, IF CHECKLINK OR DEBUGGING;                          00802999
 SAVE PROCEDURE CHECKLINKS(MIX,LOC); VALUE MIX,LOC; REAL MIX,LOC;       00803000
    BEGIN REAL B,S,F,L,MS,T,C;                                          00804000
         P(M[1]);                                                       00804100
         IF CHECK THEN                                                  00804500
         BEGIN                                                          00804600
         B~M[S~MS~[MEM[MIX,0]].[CF]].[FF];                              00805000
         WHILE (F~(L~M[S]).[CF])!MS DO                                  00806000
         BEGIN IF P(.L,LOD).[FF] NEQ B THEN                             00807000
                   BEGIN C~1; DO UNTIL FALSE END;                       00808000
              IF F{S THEN                                               00809000
                   BEGIN C~2; DO UNTIL FALSE END;                       00810000
              IF S=LOC THEN LOC~-1;                                     00810500
              B~S; S~F;                                                 00811000
         END;                                                           00812000
         IF S=LOC THEN LOC:=-1;                                         00812500
         C~3;                                                           00813000
         DO UNTIL -1=LOC;                                               00813500
         B~M[(S~MS~S+1)+1];                                             00814000
         WHILE (F~(L~M[S]).[CF])!MS DO                                  00815000
         BEGIN IF M[S+1]!B THEN                                         00816000
                   BEGIN C~4; DO UNTIL FALSE END;                       00817000
              IF S!MS THEN                                              00817100
              BEGIN                                                     00817200
              IF (T~M[S-1])}0 THEN                                      00818000
                   BEGIN C~5; DO UNTIL FALSE END;                       00819000
              IF T.[CF]-S-1!L.[FF] THEN                                 00820000
                   BEGIN C~6; DO UNTIL FALSE END;                       00821000
              END;                                                      00821100
              B~S; S~F;                                                 00822000
         END;                                                           00823000
         END;                                                           00823500
    END;                                                                00824000
 COMMENT  CONTENTS OF UV ARRAY:                                         00850000
          0 = ELAPSEDLIMIT                                              00851000
          1 = PROCLIMIT                                                 00852000
          2 = IOCOUNT                                                   00853000
          3 = TOPSK                                                     00854000
          4 = USERCODE                                                  00855000
          5 = PRYOR                                                     00856000
          6 = FS                                                        00857000
          7 = FPBD                                                      00858000
          8 = SEGD                                                      00859000
          9 = SINFO                                                     00860000
         10 = DALOC                                                     00861000
         11 = IOTIME                                                    00862000
         12 = INTABLE                                                   00863000
         13 = PROCTIME                                                  00864000
         14 = EVENT                                                     00865000
 ;                                                                      00889000
$OMIT 00893001, IF STATISTICS;                                          00892999
 DEFINE UVSIZE=19#;                                                 %R3800893000
 ARRAY UVROW[*];                                                        00894000
 ARRAY UV=UVROW[*,*];                                                   00895000
 ARRAY UV3=UV[*,*,*];                                                   00895100
 ARRAY CT[*];                                                           00896000
 ARRAY SQ[*];                                                           00897000
 ARRAY DAT[*];                                                          00898000
 ARRAY LOGARRAY[*];                                                     00898100
 DEFINE STASUS[STASUS1]=SQ[STASUS1].[18:6]#;                    COMMENT 00899900
 ARRAY STASUS[*]; COMMENT STASUS[I] GIVES STATUS WITH RESPECT TO SWAP   00900000
                   SYSTEM OF JOB WITH MIX=I;                            00901000
 COMMENT POSSIBLE STATES FOR STASUS;                                    00902000
 DEFINE  TIMEND    =  0#,                                               00903000
         WAITSWAP  =  1#,                                               00904000
         BOJSTATE  =  2#,                                               00905000
         SATISFY   =  3#,                                               00906000
         EOJSTATE  =  4#,                                               00907000
         FORCESWAP =  5#,                                               00908000
         TRANSIT   =  6#,                                               00909000
                                                                        00910000
         WAITSTATE =  8#,                                               00911000
         READYSTATE=  9#,                                               00912000
         RDYRPT    = 10#,                                               00913000
         READYBOJ  = 11#,                                               00914000
         STABLE    = 56#,                                               00915000
         RUNNING   = 16#,                                               00919000
         SELECTING = 32#;                                               00920000
 REAL READYEND,FORCEND,RDYRPTEND,SWAPEND;                               00921000
              COMMENT READYEND, SWAPEND, AND RDYRPTEND POINT TO LAST    00921500
                   ITEM IN THEIR RESPECTIVE QUEUES;                     00922000
 DEFINE LINK[LINK1]=SQ[LINK1].[42:6]#;                          COMMENT 00922900
 ARRAY LINK[*]; COMMENT  LINK CONTAINS LINKS FOR READY AND SWAP QUEUES. 00923000
                   LINK[I] IS MIX OF NEXT JOB IN QUEUE FOLLOWING JOB    00924000
                   WITH MIX=I.  LINK[0]=HEAD OF READY QUEUE, LINK[31]=  00925000
                   HEAD OF SWAP QUEUE;                                  00926000
 DEFINE SC[SC1]=SQ[SC1].[36:6]#;                                COMMENT 00926900
 ARRAY SC[*]; COMMENT  SC[I] IS FIRST CHUNK NUMBER FOR JOB WITH MIX=I;  00927000
 DEFINE LC[LC1]=SQ[LC1].[30:6]#;                                COMMENT 00929900
 ARRAY LC[*]; COMMENT  LC[I] IS LAST CHUNK NUMBER FOR JOB WITH MIX=I;   00930000
 DEFINE COUNT[COUNT1]=SQ[COUNT1].[24:6]#;                       COMMENT 00930900
 ARRAY COUNT[*]; COMMENT COUNT[I]=(NUMBER OF CHUNKS "POSSESSED" (OR     00931000
                   ASSIGNED) TO JOB WITH MIX=I)-1.  THIS POSSESSION IS  00932000
                   TO BE UNDERSTOOD DYNAMICALLY;                        00933000
 DEFINE SLN[SLN1]=SQ[SLN1].[15:3]#;                                     00933100
         COMMENT SLN[I] IS SLICE NUMBER FOR JOB WITH MIX=I;             00933200
 DEFINE NLS[NLS1]=SQ[NLS1].[8:4]#;                                      00933210
 DEFINE EXPAND[EXPAND1]=SQ[EXPAND1].[13:2]#;                            00933300
         COMMENT EXPAND CONTAINS INFORMATION TO ALLOW AREAS TO EXPAND;  00933400
 DEFINE CANTEXPAND[CANTEXPAND1]=SQ[CANTEXPAND1].[7:1]#;                 00933500
         COMMENT MAY BE DUE TO COUNT=CHUNKMAX OR MISSING MEMORY MODS;   00933600
 DEFINE TOTAL[TOTAL1]=CT[TOTAL1].[42:6]#;                       COMMENT 00933900
 ARRAY TOTAL[*]; COMMENT  TOTAL[I] IS TOTAL NUMBER OF JOBS USING THE    00934000
                   I TH CHUNK;                                          00935000
 DEFINE ACTIVE[ACTIVE1]=CT[ACTIVE1].[36:6]#;                    COMMENT 00935900
 ARRAY ACTIVE[*];COMMENT  ACTIVE[I] IS NUMBER OF JOBS READY TO RUN      00936000
                   USING THE I TH CHUNK;                                00937000
 DEFINE POSSESS[POSSESS1]=CT[POSSESS1].[30:6]#;                 COMMENT 00937900
 ARRAY POSSESS[*];COMMENT POSSESS[I] IS MIX INDEX OF JOB WHICH POSSESSES00938000
                   THE I TH CHUNK;                                      00939000
 REAL CHUNKMAX;   COMMENT CHUNKMAX IS MAXIMUM ALLOWABLE CHUNK NUMBER;   00940000
 DEFINE CHUNKZIZE=1024#;  COMMENT CHUNKSIZE IS LENGTH OF ONE CHUNK;     00941000
 DEFINE DISKSTORE[DISKSTORE1]=DAT[DISKSTORE1].[ 8:25]#;         COMMENT 00941900
 ARRAY DISKSTORE[*];    COMMENT  DISKSTORE[I]   IS ADDRESS ON DISK OF   00942000
                             SWAP AREA FOR JOB WITH MIX=I;              00943000
 DEFINE ACTLEN[ACTLEN1]=DAT[ACTLEN1].[33:15]#;                  COMMENT 00943900
 ARRAY ACTLEN[*];  COMMENT ACTLEN[I] IS ACTUAL LENGTH OF STUFF SWAPPED  00944000
                        FOR JOB WITH MIX=I;                             00945000
 DEFINE ELAPSEDLIMIT[ELAPSEDLIMIT1]=UV[ELAPSEDLIMIT1,0]#;       COMMENT 00945900
 ARRAY ELAPSEDLIMIT[*]; COMMENT  ELAPSEDLIMIT[I] IS ELAPSED TIME LIMIT  00946000
                             BEFORE JOB WITH MIX=I WILL BE SWAPPED;     00947000
 DEFINE PROCLIMIT[PROCLIMIT1]=UV[PROCLIMIT1,1]#;                COMMENT 00947900
 ARRAY PROCLIMIT[*];    COMMENT PROCLIMIT[I] IS PROCESSOR TIME LIMIT    00948000
                             BEFORE JOB WITH MIX=I WILL BE SWAPPED;     00949000
 DEFINE IOCOUNT[IOCOUNT1]=UV[IOCOUNT1,2]#;                      COMMENT 00949900
 ARRAY IOCOUNT[*]; COMMENT IOCOUNT[I] IS NUMBER OF IO OPERATIONS IN     00950000
                        PROGRESS FOR JOB WITH MIX=I;                    00951000
              COMMENT MEM[I,*] IS AN ARRAY WHICH POINTS TO MEMORY       00954000
                   SYSTEM VARIABLES (AVAIL,LEFTOFF,ETC) FOR JOB WITH    00955000
                   MIX=I;                                               00956000
 DEFINE BATCHED[BATCHED1]=CT[BATCHED1].[1:1]#,                          00956200
  BATCHJOB[BATCHJOB1]=UVROW[BATCHJOB1].[7:1]#;                          00956300
 DEFINE  MLINK1    = 0#,                                                00957000
         LEFTLIT   = 1#,                                                00958000
         AVAIL     = 2#,                                                00959000
         ADDRESSES = 3#;                                                00960000
 REAL FENCE;  COMMENT SPACE ALLOCATED BELOW THE FENCE IS NOT SUBJECT    00961000
                   TO SWAPPING, WHILE THAT ABOVE THE FENCE IS SUBJECT   00962000
                   TO SWAPPING;                                         00963000
 $ VOID                                                             %R5900963100
 DEFINE TOPSK[TOPSK1]=UV[TOPSK1,3]#;                            COMMENT 00963900
 ARRAY TOPSK[*]; COMMENT  TOPSK[I] CONTAINS TOP OF STACK VALUE FOR      00964000
                   JOB WITH MIX=I WHICH HAS BEEN SWAPPED OUT;           00965000
 DEFINE NEXT1[NEXT11]=UV[NEXT11,16]#,                               %R2300968000
        NEXT2[NEXT21]=UV[NEXT21,17]#;                               %R2300969000
        COMMENT CONTAINS NAME OF NEXT JOB FOR CANDE TO RUN;         %R2300970000
 DEFINE OLAYCTR[OLAYCTR1]=UV[OLAYCTR1,18]#,                         %R3800971000
                  COMMENT COUNTS OVERLAYS FOR AUTO-EXPAND;          %R3800972000
        UPOLAY(UPOLAY1)=CORE.[4:14]/400|16000|UPOLAY1#,             %R3800973000
        DOWNOLAY(DOWNOLAY1)=*P(DUP)-DOWNOLAY1|80-20000#;            %R3800974000
 SAVE PROCEDURE SWAP(STATE,B); VALUE STATE,B; REAL STATE,B; FORWARD;    00990000
PROCEDURE COMMUNICATE;FORWARD;                                          00990500
PROCEDURE SHORTCOMMUNICATES;FORWARD;                                    00990501
 PROCEDURE INITIALSWAP(N); VALUE N; REAL N; FORWARD;                    00991000
 PROCEDURE BRINGBACK(MIX); VALUE MIX; REAL MIX; FORWARD;                00992000
 PROCEDURE REENTER(STUFF); VALUE STUFF; REAL STUFF;  FORWARD;           00992100
 PROCEDURE SWAPPER;  FORWARD;                                           00992200
 BOOLEAN PROCEDURE OUTWAIT(B); BOOLEAN B; FORWARD;                      00993000
 SAVE REAL PROCEDURE GETAREA(N);  VALUE N;  REAL N;  FORWARD;           00994000
SAVE PROCEDURE FORGETAREA(N,A); VALUE N,A; REAL N,A; FORWARD;           00994500
 SAVE INTEGER PROCEDURE SPACE(N);                                       00995000
 VALUE N;  INTEGER N;                                                   00996000
         BEGIN SPACE ~ GETSPACE(N,0,0)+2;  END;                         00997000
$INCLUDE 00998999, IF DFX;                                          %DFX00998000
 ARRAY EUQ[10] ~                                                    %DFX00998010
        @777777777777777,                                           %DFX00998020
        @777777777777777,                                           %DFX00998030
        @777777777777777,                                           %DFX00998040
        @777777777777777,                                           %DFX00998050
        @777777777777777,                                           %DFX00998060
        @777777777777777,                                           %DFX00998070
        @777777777777777,                                           %DFX00998080
        @777777777777777,                                           %DFX00998090
        @777777777777777,                                           %DFX00998100
        @777777777777777;                                           %DFX00998110
    COMMENT EUQ IS USED WITH THE REST OF THE IO QUEUE STRUCTURE FOR %DFX00998120
         HANDLING AN EXCHANGE IN THE DISK-FILE SUBSYSTEM. IN THIS   %DFX00998130
         CASE, DISK IO REQUESTS ARE HANDLED SPECIALLY. AFTER FINDING%DFX00998140
         AN IOQ SLOT, THE EU NUMBER IS RETRIEVED FROM THE DISK      %DFX00998150
         ADDRESS WORD AND USED AS AN INDEX INTO EUQ, WHICH INDICATES%DFX00998160
         THE QUEUEING STATUS OF THE EU.                             %DFX00998170
    %%%%%     EUQ[N] CONTAINS THE FOLLOWING FOR EU #N:    %%%%%     %DFX00998180
         [33:15] = TAIL OF QUEUE (IOQ INDEX) FOR THIS EU, IF WAITING%DFX00998190
                 = LU OF CONTROL CURRENTLY HANDLING EU N.           %DFX00998200
         [18:15] = HEAD OF QUEUE (IOQ INDEX).                       %DFX00998210
         [ 3:15] = NEXT EU WAITING FOR A CU (EUQ INDEX).            %DFX00998220
         [ 1: 1] = TRUE IFF THIS EU IS IN OPERATION;                %DFX00998230
 REAL EUW;    COMMENT EUW QUEUES UP EUS WAITING FOR CUS:            %DFX00998240
         [33:15] = TAIL OF WAITING-EU QUEUE (EUQ INDEX)             %DFX00998250
         [18:15] = HEAD "     "    "    "     "    "   ;            %DFX00998260
 INTEGER DISKOUNT;      COMMENT NUMBER OF READY CUS;                %DFX00998270
 ARRAY   FORKQUE[*];                                                    01000000
    COMMENT THE FORKQUE IS A QUEUE OF REQUESTS TO RUN INDEPENDENT       01001000
              PROCESSES.  ENTRIES ARE PUT IN THE QUEUE BY FORK, AND     01002000
              ARE INITIATED BY THE CONTROL SECTION OF THE MCP NEAR      01003000
              THE LABELS NOTHINGTODO AND SLATESTARTER.  THE FORMAT      01004000
              OF THE FORKQUE IS:                                        01005000
                                                                        01006000
              FORKQUE:    @500777 ||||| |||||                           01007000
                   THE F FIELD CONTAINS THE ADDRESS OF THE              01008000
                        FIRST WORD OF THE LAST REQUEST IN THE QUEUE.    01009000
                   THE C FIELD CONTAINS THE ADDRESS OF THE              01010000
                        FIRST WORD OF THE FIRST REQUEST IN THE QUEUE.   01011000
              WHEN THERE ARE NO CURRENT REQUESTS, BOTH OF THESE         01012000
              FIELDS POINT AT THE FORKQUE.                              01013000
              THE FORMAT OF A FORKQUE ENTRY IS:                         01014000
                                                                        01015000
              WORD1:   @000PPP BBBBB FFFFF                              01016000
                   PPP   IS PRIORITY +64 -- USED IN LINKING IN NEW      01017000
                             ENTRIES WITH A LINK-LIST-LOOKUP.  IT       01018000
                             ALSO DEFINES THE INITIAL PRIORITY FOR      01019000
                             THE NEW PROCESS.                           01020000
                   BBBBB IS THE LINK BACK TO THE PRECEDING ENTRY.       01021000
                   FFFFF IS THE LINK FORWARD TO THE NEXT ENTRY.         01022000
              WORD 2:   ADDRESS OF DESCRIPTOR OF ROUTINE TO BE RUN.     01023000
              WORD 3:   A PARAMETER TO THIS ROUTINE.                    01024000
              WORD 4:   SIZE OF STACK NEEDED.  ZERO IF STACK            01025000
                          ALREADY OBTAINED, OR WILL USE ISTACK.         01026000
              WORD 5:   ADDRESS OF STACK, IF ALREADY OBTAINED.          01027000
                        =0  =>   STACK SPACE NEEDED                     01027100
                        =1  =>   USE STACKQ TO GET SPACE IF AVAILABLE   01027200
                                  (IN PARAMETER TO FORK ONLY)           01027300
         END FORKQUE COMMENT;                                           01028000
                                                                        01029000
 REAL    BED;                                                           01030000
 ARRAY   BED1[*];                                                       01031000
    COMMENT THE BED IS A LINKED LIST OF CONTROL LINES THAT ARE          01032000
              AWAITING SOMETHING.  BED POINTS TO THE FIRST ENTRY,       01033000
              AND BED1 POINTS TO THE LAST ENTRY IN THE LIST.            01034000
              (NOTE:  BED1 MUST BE THE NEXT PRT CELL AFTER BED.)        01035000
              THE LINKS ARE STRUCTURED SO THAT THEY MAY BE              01036000
              MANIPULATED AS ARRAYS.  CONSIDERED AS AN ARRAY:           01037000
                                                                        01038000
              WORD 0  CONTAINS THE LINK FORWARD TO THE NEXT ENTRY.      01039000
              WORD 1  CONTAINS THE LINK BACK TO THIS ENTRY.             01040000
              WORD 2  CONTAINS THE MIX INDEX ASSOCIATED WITH THIS ENTRY 01041000
              WORD 3  CONTAINS THE TIME OUT VALUE                       01042000
              WORD 4  CONTAINS A LOGICAL LINE NUMBER (FOR DATACOM)      01043000
                        WHICH IS ASSOCIATED WITH THE ENTRY.             01044000
              WORD 5  CONTAINS THE F-REGISTER SETTING OF THE            01045000
                        SLEEP ROUTINE (WHICH MADE THE ENTRY).           01046000
                                                                        01047000
              BED AND ALL FORWARD LINKS LOOK LIKE @100777PPPPP|||||     01048000
                   WHERE PPPPP IS THE PRIORITY+64 FOR THIS ENTRY        01048100
                   AND THE BACK LINK LOOKS LIKE @500777||||||||||.      01049000
         END BED COMMENT;                                               01050000
                                                                        01051000
 REAL    PRIORTY;                                                       01055000
    COMMENT PRIORTY IS THE PRIORITY ASSOCIATED WITH THE "JOB"           01056000
              CURRENTLY BEING RUN ON PROCESSOR 1.  IN THE SENSE         01057000
              USED HERE, A "JOB" IS EITHER A USER PROGRAM OR AN         01058000
              INDEPENDENT LINE OF CONTROL WITHIN THE MCP;               01059000
                                                                        01060000
 REAL P1MIX;                                                            01061000
 REAL P2MIX;                                                            01061500
    COMMENT P1MIX IS THE MIX INDEX ASSOCIATED WITH THE "JOB"            01062000
              RUNNING ON PROCESSOR 1.  P1MIX=0 MEANS THAT AN MCP        01063000
              ROUTINE IS CURRENTLY RUNNING.                             01064000
              P2MIX, SIMILARLY IS THE MIX INDEX ASSOCIATED WITH THE     01065000
              JOB RUNNING ON PROCESSOR 2.  PROCESSOR 2 -- WHICH CAN     01066000
              ONLY OPERATE IN NORMAL STATE -- IS IDLE IF P2MIX=0,       01067000
              AND IS NOT PRESENT (OR SICK) IF P2MIX=-1;                 01068000
 REAL STACKQ;                                                           01069000
       DEFINE STANDARDSTACK =128#; % TO INCREASE FOR INDEP RUNNERS  %R5601069100
 SAVE PROCEDURE FORK(ROUTINE, PARAMETER, PRIORITY, SIZE, LOCATION);     01070000
 VALUE   ROUTINE, PARAMETER, PRIORITY, SIZE, LOCATION;                  01071000
 REAL    ROUTINE, PRIORITY, SIZE;                                       01072000
 ARRAY   PARAMETER[*], LOCATION[*];                                     01073000
    BEGIN COMMENT FORK QUEUES A REQUEST TO INITIATE AN INDEPENDENT      01074000
              PROCESS IN THE LIST OF REQUESTS POINTED TO BY FORKQUE.    01075000
              REQUESTS ARE ORDERED ACCORDING TO PRIORITY, AND ARE       01076000
              FIRST-IN, FIRST-OUT AMONG EQUAL-PRIORITY REQUESTS.        01077000
              SEE ALSO COMMENT AT FORKQUE DECLARATION;                  01078000
         REAL      T, FRONTLINK, BACKLINK;                              01079000
              IF LOCATION=1 THEN                                        01079100
              IF (LOCATION~STACKQ)=0 THEN                               01079200
                   SIZE~STANDARDSTACK ELSE STACKQ~M[STACKQ];            01079300
              T ~ GETAREA(0);                                           01080000
              BACKLINK ~ P(FORKQUE, 0&(PRIORITY+65)[9:39:9], LLL,       01081000
                             0, INX, .FRONTLINK, ~).[FF];               01082000
              M[T] ~ FRONTLINK&BACKLINK[CTF]&(PRIORITY+64)[9:39:9];     01083000
              M[FRONTLINK].[FF] ~ T;   M[BACKLINK].[CF] ~ T;            01084000
              M[T+1] ~ ROUTINE;        M[T+2] ~ PARAMETER;              01085000
              M[T+3] ~ SIZE;           M[T+4] ~ LOCATION.[CF];          01086000
    END INDEPENDENT RUNNER QUEUEING;                                    01087000
                                                                        01088000
 SAVE PROCEDURE KILL(STACK);                                            01089000
 VALUE   STACK;                                                         01090000
 ARRAY   STACK[*];                                                      01091000
    BEGIN COMMENT KILL RETURNS THE STACK FOR A COMPLETED INDEPENDENT    01092000
              PROCESS, AND REMOVES IT FROM THE SYSTEM;                  01093000
         REAL S=NT3;                                                    01093100
         P(64,STS);                                                     01094000
         IF (S~STACK.[CF])<PRT.[CF] THEN                                01095000
              FORGETSPACE(S)                                            01095100
         ELSE BEGIN M[S-1]~STACKQ; STACKQ~S-1 END;                      01095200
         GO TO NOTHINGTODO;                                             01096000
    END INDEPENDENT RUNNER TERMINATION;                                 01097000
                                                                        01098000
 SAVE PROCEDURE SLEEP(ADDRESS, MASK);                                   01099000
 VALUE   ADDRESS, MASK;                                                 01100000
 NAME    ADDRESS;                                                       01101000
 ARRAY   MASK[*];                                                       01102000
    BEGIN COMMENT SLEEP MAKES AN ENTRY IN THE BED.  IT IS USED TO WAIT  01103000
              FOR AN EXOGENOUS EVENT TO OCCUR -- AN I-O OPERATION       01104000
              TO FINISH, OR A TOGGLE TO BE RELEASED, FOR EXAMPLE.  IT   01105000
              CAN ALSO BE USED TO CLEAR INTERRUPTS (SLEEP(1,1)) OR TO   01106000
              SUSPEND A PROCESS FOREVER (SLEEP(0,0)).  THROUGH CALLS    01107000
              ON COMPLEXSLEEP, IT IS POSSIBLE TO WAIT FOR ONE OR MORE   01108000
              OF A VARIETY OF CONDITIONS TO BE SATISFIED;               01109000
         REAL      LINK;                                                01110000
         ARRAY     BACK = +2[*],                                        01111000
                   BAC  = +2[*,*];                                      01112000
              P(BED,(PRIORTY+65)&P(@7777777700000,XCH)[CTF],LLL,XCH,DEL,01113000
                   1,XCH,INX,LOD);                                      01113100
              P(P1MIX,CLICK,LOGLINE);                                   01114000
              P(0,RDF);                                                 01115000
              LINK ~ BACK[0]&(PRIORTY+64)[CTF];                         01116000
              BAC[0,1] ~ FLAG(BACK[0] ~ (*P(DUP))&[LINK][CTC]);         01117000
              CLICK ~ @777777777777;                                    01118000
              PROCTIME[P1MIX] ~ *P(DUP)+CLOCK+P(RTR);                   01119000
              GO TO NOTHINGTODO;                                        01120000
    END WAIT FOR EXTERNAL CONDITION;                                    01121000
                                                                        01122000
 SAVE PROCEDURE COMPLEXSLEEP(CODE);                                     01123000
 REAL    CODE;                                                          01124000
         BEGIN SLEEP(1,*P(.CODE)) END;                                  01125000
                                                                        01126000
 SAVE PROCEDURE RUN(MIX);                                               01127000
 VALUE   MIX;                                                           01128000
 REAL    MIX;                                                           01129000
    BEGIN COMMENT RUN IS THE BUSINESS END OF SAVEMIX.  IT RESTARTS      01130000
              THE JOB WHICH SAVEMIX SAVED;                              01131000
         PRIORTY ~ PRYOR[P1MIX ~ MIX];                                  01132000
         PROCTIME[P1MIX] ~ *P(DUP)-CLOCK-P(RTR);                        01133000
         TOGLE ~ TOGLE OR STACKMASK;                                    01134000
         GO TO EXTERNAL;                                                01135000
    END REINITIATING SAVED JOB;                                         01136000
                                                                        01137000
 SAVE PROCEDURE SAVEMIX(MIX,LOGLINE);                                   01138000
 VALUE   MIX, LOGLINE;                                                  01139000
 REAL    MIX,LOGLINE;                                                   01140000
    BEGIN COMMENT SAVEMIX IS USED TO KEEP A NORMAL STATE JOB IN THE     01141000
              WORKS.  IT IS CALLED BY SELECTION TO INITIATE A NORMAL-   01142000
              STATE JOB FOR THE FIRST TIME, AND IS USED BY HALT AND     01143000
              THE P2BUSY SOFTWARE TO HANDLE THE PROBLEMS OF STOPPING    01144000
              PROCESSOR 2, AND NON-EXISTENT PROCESSOR 2;                01145000
         FORK(@100000|LOGLINE OR P(.RUN),MIX,-2,0,0);                   01146000
         PROCTIME[MIX] ~ *P(DUP)+CLOCK+P(RTR);                          01147000
    END MIX INDEX SAVER;                                                01148000
                                                                        01149000
 SAVE PROCEDURE HALT;                                                   01150000
    BEGIN COMMENT IF ANYONE IS RUNNING ON PROCESSOR 2, HALT WILL        01151000
              STOP HIM.  HALT ALSO ALLOWS FOR THE POSSIBILITY OF        01152000
              A NON-ACKNOWLEDGED PROCESSOR 2 INTERRUPT BEING FOUND,     01153000
              AND PERFORMS THE ESSENTIAL OPERATIONS IF NONE WAS;        01154000
         NOPROCESSTOG ~ NOPROCESSTOG+1;                                 01155000
         IF P2MIX>0 THEN                                                01156000
         BEGIN P(HP2);                                                  01157000
              P(PRIORTY);  PRIORTY ~ -5;                                01158000
              SLEEP(1,1);  PRIORTY ~ POLISH;                            01159000
              IF P2MIX>0 THEN                                           01160000
              BEGIN SAVEMIX(P2MIX,LOGLINE2);  P2MIX ~ 0;                01161000
                   TOGLE ~ TOGLE AND NOT HP2MASK;                       01162000
    END  END  END STOPPING SECOND PROCESSOR;                            01163000
$INCLUDE 01163071, IF DCP;                                              01163049
  SAVE PROCEDURE DCPQ(ADDR);  VALUE ADDR; REAL ADDR; FORWARD;           01163050
  PROCEDURE DCWRITE(ADR,STA,NUM,FLAGS);                                 01163060
    VALUE ADR,STA,NUM,FLAGS;  REAL ADR,STA,NUM,FLAGS;  FORWARD;         01163070
$OMIT 01163411, IF DCP;                                                 01163099
SAVE PROCEDURE ENTERLINEQ(ADR,LINE,PRIRTY);                             01163100
  VALUE ADR,LINE,PRIRTY; REAL ADR,LINE,PRIRTY;             FORWARD;     01163200
REAL PROCEDURE DCWRITE(ADR,LINE,SIZE);                                  01163300
   VALUE ADR,LINE,SIZE; REAL ADR,LINE,SIZE;                FORWARD;     01163400
  PROCEDURE BLASTREAD(LINE,C); VALUE LINE,C; REAL LINE,C; FORWARD;      01163410
  SAVE PROCEDURE IOREQUEST(FINAL,IODESC,LOCATION);                      01163500
       VALUE FINAL,IODESC,LOCATION;                                     01163600
       ARRAY FINAL,LOCATION[*];  REAL IODESC;              FORWARD;     01163700
PROCEDURE NOTIFYCANDE(MIX); VALUE MIX; REAL MIX; FORWARD;               01164200
  PROCEDURE SYSDISKIO(IO,L,A); VALUE IO,L,A; ARRAY A[*];REAL IO,L;  %R6001164300
    FORWARD;                                                        %R6001164301
  SAVE PROCEDURE NEWIO;                                    FORWARD;     01164500
$OMIT 01250001, IF DCP;                                                 01165999
SAVE PROCEDURE INITIATEDCIO(IODESC);                                    01166000
  VALUE IODESC;                                                         01167000
  REAL IODESC;                                                          01168000
  BEGIN                                                                 01169000
$ INCLUDE 01169501, IF SAVERESULTS OR DEBUGGING;                        01169499
STORAWAY ~ IODESC;                                                      01169500
         CHANNEL[P(TIO)] ~ 30; %                                        01170000
         CHANIO[P(TIO)]:=CLOCK+P(RTR);                              %R5901170100
         P([IODESC],IIO);                                               01171000
         UNIT[30].[16:2] ~ 3;                                           01172000
  END INITIATEDCIO;                                                     01173000
SAVE PROCEDURE INTERROGATOR;                                            01174000
       BEGIN                                                            01175000
         P(P1MIX);                                                      01176000
         P1MIX ~ 0;                                                     01177000
   IF UNIT [30].[FF]=@77777 AND REMOTE THEN                         %R6601178000
         BEGIN                                                          01179000
               LLNR ~ 0;                                                01180000
               IOREQUEST(0,INTERROGATEMASK,0&30[12:42:6]);              01181000
         END ELSE                                                       01182000
         BEGIN                                                          01183000
               INTRGATCTR ~ INTRGATCTR + 1;                             01184000
         END;                                                           01187000
         P1MIX ~ P; %                                                   01188000
       END INTERROGATOR;                                                01189000
PROCEDURE NEXTDCIO;                                                     01190000
    %IF AN INTERROGATE IS TO BE DONE IT IS HANDLED FIRST;ELSE CHECK FOR 01191000
     %READY QUEUE ENTRIES WAITING FOR DTTU AVAILABILITY. (DCREQUEST[0]  01192000
     % CONTAINS HEAD OF READY QUEUE IN CF) ALSO IF THERE IS NO SLOT IN  01193000
     % IOQUE FOR DC STUFF WILL GET ONE AND WAIT FOR A CHANNEL AS NECES- 01194000
     % SARY. CHANNEL AVAILABILITY IS GOTTEN BY OUTERBLOCK CODE WHEN THE 01195000
     % 1ST INTERROGATE IS DONE;IT MAY BE GOTTEN HERE ALSO WHEN A NEW IO 01196000
     % IS PLACED IN THE READYQUE.  IOQUE SPACE IS GIVEN BACK BY IOFINISH01197000
     % WHENEVER THERE IS NOTHING ELSE TO SEND TO DC.                    01198000
BEGIN                                                                   01199000
         LABEL DOIT;                                                    01199600
         REAL IOD,V,S;                                                  01200000
         P(P1MIX);                                                      01200100
         P1MIX ~ 0;                                                     01200200
         IF UNIT[30].[15:3] < 3 THEN                                    01201000
         IF INTRGATCTR > 0 THEN                                         01202000
         BEGIN %                                                        01203000
               INTRGATCTR ~ INTRGATCTR - 1;                             01204000
               LLNR ~ 0;                                                01205000
               IOD:=INTERROGATEMASK;                                %R8601206000
                GO TO DOIT;                                             01206500
         END ELSE                                                       01207000
         IF (LLNR~(S~STATABLE[0]).[CF])!0 THEN                          01208000
         BEGIN                                                          01208500
              STATABLE[0]~S&(S~STATABLE[LLNR])[40:25:8];                01209000
              STATABLE[LLNR]~S&0[25:40:8];                              01209500
              S:=LINETABLE[LLNR];                                       01210000
$OMIT 01211005, IF TWXONLY;                                             01210495
              IF S.[21:5]=POLLING THEN %IF POLLING, KILL WITH ACT INT.  01210500
              IOD:=INTERROGATEMASK&S[9:9:9] ELSE                        01211000
              BEGIN                                                     01211500
                   IOD:=((V:=STATABLE[                                  01212000
$OMIT 01213005, IF TWXONLY;                                             01212995
                   IF S.[3:3]=MULTI THEN SEQARRAY[LLNR].[40:8] ELSE     01213000
                   LLNR]) INX @0400000000000001)&S[9:9:9]               01214000
                   &(V:=M[V])[18:5:1]&V[24:6:1];                        01215000
                   IF V.[5:2]=0 THEN LINETABLE[LLNR]:=S&V[21:5:5];      01215500
              END;                                                      01216000
DOIT:                                                                   01216500
              IF (S~UNIT[30].[FF]) GTR  1023 THEN                       01217000
              IOREQUEST(0,IOD,0&30[12:42:6])                            01217500
              ELSE INITIATEDCIO(IOQUE[S]~IOD);                          01218000
         END;                                                           01218500
         P1MIX ~ POLISH;                                                01221500
  END NEXTDCIO;                                                         01222000
SAVE PROCEDURE ENTEREADYQ(T);                                           01223000
VALUE T; REAL T;                                                        01223500
BEGIN                                                                   01224000
    REAL LINE,U,S,X,V;                                                  01224500
    LABEL ENDIT,BELOW;                                                  01225000
    IF (S:=LINETABLE[LINE:=IF T GTR LMAX THEN                           01225500
        STATABLE[T].LEENKER ELSE T]).[21:2]=1 THEN                      01226000
    BEGIN                                                               01226500
$OMIT 01244505, IF TWXONLY;                                             01226995
         IF S.LINEDIS = MULTI THEN                                      01227000
         IF STATABLE[T:=SEQARRAY[LINE].[40:8]].[CF]=0 THEN              01227500
         IF S.[21:5] ! WAITING THEN %STATION NOT WAITING TO DO MORE I/O 01228000
         BEGIN                                                          01228500
              U:=T;                                                     01229000
              WHILE (T:=SEQARRAY[T].LINELINK)!U DO                      01229500
              IF STATABLE[T].[CF]!0 THEN %ANOTHER STAT.ON LINE HAS I/O. 01230000
              BEGIN                                                     01230500
                   SEQARRAY[LINE].[40:8]:=T;                            01231000
                   GO TO BELOW;                                         01231500
              END;                                                      01232000
              X:=(V:=GETAREA(S.BUFSIZE))+1;                             01232500
              P(1); %INITIALIZE TEST FOR ACTIVE STATIONS                01233000
              DO IF (U:=SEQARRAY[U]).[2:2]=0 THEN                       01233500
              BEGIN                                                     01234000
                   P(DEL,0); %INDICATE ACTIVE STATION ON LINE.          01234500
                   STREAM(X:U,S:=S:=U.[24:1],W:=U.[25:1],V:=P(DUP)!S);  01235000
                   BEGIN                                                01235500
                        DI:=X;                                          01236000
                        DS:=LIT "$";S(DS:=LIT "!");                     01236500
                        SI:=LOC U;SI:=SI+2;                             01237000
                        DS:=CHR;W(DS:=LIT "!");                         01237500
                        DS:=CHR;V(DS:=LIT "!");                         01238000
                        DS:=2 LIT "P%";X:=DI; %SAVE DI FOR MOR STATIONS 01238500
                        DS:=2 LIT "!~";                                 01239000
                   END;                                                 01239500
                   X:=P;                                                01240000
              END UNTIL (U:=U.LINELINK)=T;                              01240500
              IF P THEN %NO ACTIVE STATIONS, DONT DO POLL               01241000
              BEGIN                                                     01241500
                   FORGETAREA(M[V].[2:2],V);                            01242000
                   GO TO ENDIT;                                         01242500
              END;                                                      01243000
              M[V]:=(*P(DUP))&POLLING[5:43:5]&(U:=STATABLE[T])[CTC];    01243500
              STATABLE[T]:=U&V[CTC]; %LINK POLL INTO LINE QUEUE         01244000
         END ELSE GO TO ENDIT;                                          01244500
         IF STATABLE[T].[CF] ! 0 THEN                                   01245000
BELOW:   IF (U:=STATABLE[0]).[CF]!0 THEN %PUT LINE INTO READY QUEUE     01245500
         BEGIN                                                          01246000
              STATABLE[0]:=U&LINE[CTF];                                 01246500
              STATABLE[U.[FF]].LEENKER:=LINE;                           01247000
         END ELSE STATABLE[0]:=U&LINE[CTC]&LINE[CTF] ELSE GO TO ENDIT;  01247500
         LINETABLE[LINE]:=(*P(DUP))&(P(DUP).[21:5]=IDLPOLLING)[21:43:5];01248000
    END;                                                                01248500
ENDIT:                                                                  01249000
    NEXTDCIO;                                                           01249500
END ENTEREADYQ;                                                         01250000
PROCEDURE USASITAPE(AREA,TYPE,FROM,U,DIR);               %RHR           01250100
         VALUE AREA,FROM,U,DIR; REAL AREA,TYPE,FROM,U,DIR;              01250200
BEGIN REAL PTN,Y;                                                       01250300
      ARRAY ULAB[*];                                                    01250400
      LABEL EXIT,ERROR,VOL,BAD,WAIT,TIP,ETIP;                           01250500
    SUBROUTINE LABELSPACE;                                              01250600
         BEGIN ULAB:=[M[SPACE(11)]]&10[8:38:10];                        01250700
               MOVE(10,ULAB.[CF]-1,ULAB.[CF]);                          01250800
         END LABELSPACE;                                                01250900
    SUBROUTINE VOL1FILL;                                                01251000
         BEGIN STREAM(AREA,ULAB);                                       01251100
               BEGIN DS:=8 LIT " LABEL  "; DI:=DI+1; SI:=AREA;          01251200
                     SI:=SI+11; DS:=7 CHR; DI:=DI+37; %MID              01251300
                     SI:=AREA; SI:=SI+5; DS:=5 CHR; %PHYSICAL TAPE NO.  01251400
               END;                                                     01251500
         END VOL1FILL;                                                  01251600
    SUBROUTINE HDR1CHK;                                                 01251700
         BEGIN STREAM(Y:=0:AREA,X:=0);                                  01251800
               BEGIN DI:=LOC X; DS:=4 LIT "HDR1";                       01251900
                     SI:=AREA; DI:=LOC X;                               01252000
                     IF 4 SC=DC THEN TALLY:=1;                          01252100
                     Y:=TALLY;                                          01252200
               END;                                                     01252300
               Y:=P;                                                    01252350
         END HDR1CHK;                                                   01252400
    SUBROUTINE HDR1FILL;                                                01252500
         BEGIN STREAM(AREA,ULAB);                                       01252600
               BEGIN SI:=AREA; SI:=SI+4;                                01252700
                     DI:=DI+17; DS:=7 CHR; %FID                         01252800
                     SI:=SI+17; DS:=3 CHR; %REEL                        01252900
                     SI:=SI+11; DS:=5 CHR; %C-DATE                      01253000
                     SI:=SI-8; DS:=2 CHR; %CYCLE                        01253100
                     SI:=SI+7; DS:=5 CHR; %P-DATE                       01253200
                     DI:=DI+1; SI:=SI+2;                                01253300
                     DS:=5 CHR; %BLOCK COUNT                            01253400
                     DS:=7 CHR; %RECORD COUNT                           01253500
               END;                                                     01253600
         END HDR1FILL;                                                  01253700
    SUBROUTINE HARDFILL;                                                01253800
         BEGIN PTN:=PRNTABLE[U].[30:18];                                01253900
               STREAM(PTN,AREA,ULAB);                                   01254000
               BEGIN SI:=LOC PTN; DI:=DI+53;                            01254100
                     DS:=5 DEC; DI:=ULAB; %PHYSICAL TAPE NO.            01254200
                     DS:=8 LIT " LABEL  ";                              01254300
               END;                                                     01254600
               ULAB[1]:=MULTITABLE[U];                                  01254650
         END HARDFILL;                                                  01254700
    LABELSPACE;                                                         01254800
    IF FROM=1 THEN                                                      01254900
         BEGIN VOL1FILL;                                                01255000
               P(WAITIO(@140000005,@377,U),DEL);                        01255100
               P(WAITIO(AREA INX @120540000000,@377,U),DEL);            01255200
               HDR1CHK;                                                 01255300
               IF Y THEN HDR1FILL ELSE GO TO ERROR;                     01255400
               P(WAITIO(@340000005,@55,U),DEL);                         01255450
               P(WAITIO(@340000005,@55,U),DEL);                         01255500
               GO TO WAIT;                                              01255600
         END;                                                           01255700
    IF FROM =2 THEN                                                     01255800
         BEGIN IF TYPE=1 THEN                                           01255900
              BEGIN VOL1FILL;                                           01256000
    VOL:            P(WAITIO(AREA INX @120540000000,@377,U),DEL);       01256100
                    HDR1CHK;                                            01256200
                    IF Y THEN HDR1FILL ELSE GO TO ERROR;                01256300
                    P(WAITIO(@340000005,@377,U),DEL);                   01256400
                    GO TO WAIT;                                         01256500
              END;                                                      01256600
               IF TYPE=2 THEN                                           01256700
              BEGIN HDR1FILL;                                           01256800
                    HARDFILL;                                           01256900
                    GO TO EXIT;                                         01257000
              END;                                                      01257100
         END;                                                           01257200
    IF FROM=3 OR FROM=4 THEN                                            01257300
         BEGIN IF TYPE=1 THEN                                           01257400
              BEGIN VOL1FILL;                                           01257500
                    GO TO VOL;                                          01257600
              END;                                                      01257700
              IF TYPE=2 OR TYPE=4 THEN                                  01257800
              BEGIN HDR1FILL;                                           01257900
                    HARDFILL;                                           01258000
                    GO TO EXIT;                                         01258100
              END;                                                      01258200
              IF TYPE=3 OR TYPE=5 THEN                                  01258300
              BEGIN IF DIR=0 THEN                                       01258400
                   BEGIN P(WAITIO(@340000005,@377,U),DEL);              01258500
                         P(WAITIO(@340000005,@377,U),DEL);              01258600
                         P(WAITIO(AREA INX @120540000000,@377,U),DEL);  01258700
                   END ELSE                                             01258800
                         P(WAITIO(AREA INX @120740000000,@377,U),DEL);  01258900
                   HDR1CHK;                                             01259000
                   IF Y THEN HDR1FILL ELSE GO TO ERROR;                 01259100
                   HARDFILL;                                            01259200
                   GO TO WAIT;                                          01259300
              END;                                                      01259400
              IF TYPE=6 THEN                                            01259500
                   BEGIN HDR1FILL;                                      01259600
                         HARDFILL;                                      01259700
                         STREAM(ULAB);                                  01259800
                         BEGIN DI:=ULAB; DI:=DI+39;                     01259900
                               DS:=1 LIT "1";                           01260000
                         END;                                           01260100
                         GO TO EXIT;                                    01260200
                   END;                                                 01260300
         END;                                                           01260400
    WAIT:     PTN:=0;                                                   01260425
    TIP:      IF((TWO(U) AND P(RRR)) !0) THEN                           01260450
              GO TO EXIT ELSE SLEEP([CLOCK], NOT CLOCK);                01260455
              PTN:=PTN+1;                                               01260460
              IF(PTN>120)THEN GO TO EXIT ELSE GO TO TIP;                01260465
    ERROR:    P(WAITIO(@4200000000,@377,U),DEL);                        01260500
              STREAM(T:=TINU[U],ULAB);                                  01260600
                   BEGIN SI:=LOC T; SI:=SI+5;                           01260700
                         DS:=LIT "#"; DS:=3 CHR;                        01260800
                         DS:=22 LIT " INVALID USASI,  RW/L~";           01260900
                    END;                                                01261000
              SPOUTIT(ULAB,1); LABELTABLE[U]~@314;                      01261100
              TYPE~0; PTN~0;                                            01261150
    ETIP:     IF((TWO(U) AND P(RRR)) !0) THEN                           01261160
              GO TO BAD ELSE SLEEP([CLOCK], NOT CLOCK);                 01261170
              PTN~PTN+1;                                                01261180
              IF(PTN>120) THEN GO TO BAD ELSE GO TO ETIP;               01261200
    EXIT:     MOVE(10,ULAB.[CF],AREA.[CF]);                             01261300
              FORGETSPACE(ULAB.[CF]);                                   01261400
    BAD:                                                                01261450
END USASITAPE;                                  %RHR                    01261500
 REAL SCHEDULEIDS;                                                      02015000
 PROCEDURE REPORTBACK(WHY,P1,P2);                                       02016000
         VALUE WHY,P1,P2;                                               02017000
         REAL WHY,P1,P2;                                                02018000
         FORWARD;                                                       02019000
 PROCEDURE MAKELOG(M,T); VALUE M,T; REAL M,T; FORWARD;                  02020000
REAL KEYBOARDCOUNTER;                                                   02020500
 REAL PROCEDURE KEYIN(B); VALUE B; BOOLEAN B;  FORWARD;%                02021000
 BOOLEAN PROCEDURE WHYSLEEP(MASK); VALUE MASK; REAL MASK; FORWARD;%     02022000
 LABEL   P1PROCESS;                                                     02023000
 LABEL   P2PROCESS;                                                     02023100
 REAL ONEOHONE = @101,ONEOHTWO = @102;%                                 02024000
 SAVE PROCEDURE IOERR(U); VALUE U; REAL U; FORWARD;%                    02052000
 REAL NUMESS;                                                           02052100
REAL PBCOUNT;                                                           02052200
    SAVE BOOLEAN PROCEDURE OLAY(LOC,MIXX);                              02052500
    VALUE LOC,MIXX;  REAL LOC,MIXX;  FORWARD;                           02052600
PROCEDURE SEEKNAM(A,B,C,D,E,N); VALUE A,B;REAL A,B,C,D,E,N; FORWARD;    02052700
PROCEDURE UNHOOQUE(MIX);%                                               02053000
              VALUE MIX;%                                               02054000
              INTEGER MIX;%                                             02055000
    BEGIN%                                                              02056000
         REAL U,S,SN,T,X,I,PROCE;%                                      02057000
         LABEL DOLP;%                                                   02058000
              FOR U~0 STEP 1 UNTIL 31 DO%                               02059000
                   BEGIN%                                               02060000
                        IF(S~UNIT[U].[FF])!@77777 THEN                  02061000
                        BEGIN%                                          02062000
                             WHILE (SN~LOCATQUE[S].[FF])!@77777 DO%     02063000
                             BEGIN IF (T~NFLAG(LOCATQUE[SN])).[3:5] =%  02064000
                                       MIX THEN%                        02065000
                                  IF LOCATQUE[SN].[11:1] THEN S~SN ELSE 02065100
                                  BEGIN%                                02066000
                                       LOCATQUE[S]~LOCATQUE[S]&T[FTF];% 02067000
                                       IF UNIT[U].[CF] = SN THEN        02067100
                                          UNIT[U].[CF]~S;               02067200
                                       IOQUE[SN] ~ IOQUEAVAIL;%         02068000
                                       IOQUEAVAIL ~ SN+1;%              02069000
                                  END                          ELSE%    02070000
                                  S~SN;%                                02071000
                             END%                                       02072000
                        END%                                            02073000
                   END;%                                                02074000
    DOLP:     FOR U~0 STEP 1 UNTIL 31 DO%                               02075000
                   BEGIN%                                               02076000
                        IF (S~(T~UNIT[U]).[FF])!@77777 THEN             02077000
                        BEGIN%                                          02078000
                             IF LOCATQUE[S].[3:5]=MIX THEN%             02079000
                             BEGIN%                                     02080000
                             IF (X:=T.[13:5])=0 OR X=16 OR X=31 THEN%R5602081000
                                  BEGIN%                                02082000
                                       UNIT[U]~T&(LOCATQUE[S])[FTF];%   02083000
                                       IOQUE[S]~IOQUEAVAIL;%            02084000
                                       IOQUEAVAIL~S+1;%                 02085000
                                  END                      ELSE%        02086000
                                  IF X=4 THEN%                          02087000
                                  BEGIN%                                02088000
                                       IF LOCATQUE[S].[FF]=@77777 THEN% 02089000
                                       BEGIN%                           02090000
                                            I~FIRSTWAIT;%               02091000
                                            WHILE WAITQUE[I]!U%         02092000
                                            DO I ~ I+1 AND 31;%         02093000
                                            WAITQUE[I]~%                02094000
                                            WAITQUE[NEXTWAIT~NEXTWAIT%  02095000
                                                 +31 AND 31];%          02096000
                                            UNIT[U]~T&@77777[13:28:20]; 02097000
                                            IOQUE[S]~IOQUEAVAIL;%       02098000
                                            IOQUEAVAIL~S+1;%            02099000
                                  END       END             ELSE%       02100000
                                  PROCE~((U!23 AND U!24) OR X=3)        02101000
                                         AND X!25 OR PROCE;             02101100
                             END%                                       02102000
                        END%                                            02103000
                   END       ;%                                         02104000
              IF PROCE THEN%                                            02105000
                   BEGIN%                                               02106000
                        SLEEP(1,1);PROCE~0;GO TO DOLP%                  02107000
                   END;%                                                02108000
    END UNHOOQUE;%                                                      02109000
 DEFINE PSF = 3:4#;                                                     02110000
 DEFINE TERMSET(TERMSET1)=PRTROW[TERMSET1].[PSF]=1#;                    02110100
 DEFINE NOTERMSET(NOTERMSET1)=PRTROW[NOTERMSET1].[PSF]!1#;              02110200
REAL PROCEDURE GETESPDISK;FORWARD;%                                     02111000
 REAL CCTOG,READERA,READERB;                                            02112000
SAVE PROCEDURE STARTIO(U);VALUE U;REAL U;FORWARD;%                      02113000
REAL SPOWORD;                                                           02113100
PROCEDURE TWXOUT(A,B,C,D); VALUE A,B,C,D; REAL A,B,C,D; FORWARD;        02113200
 PROCEDURE MESSAGEWRITER;                                               02114000
         BEGIN REAL RCW=+0;%                                            02115000
         REAL T;                                                        02116000
              LABEL L;%                                                 02117000
                                                                        02118000
                                                                        02119000
         L:                                                             02119010
         IF REMOTE AND SPOWORD!0 THEN                                   02119015
              BEGIN                                                     02119020
              TWXOUT(MESSAGEHOLDER INX 1,230,1 OR M,ABS(SPOWORD));      02119200
              END;                                                      02119300
         IF SPOWORD}0 THEN                                              02119400
              BEGIN                                                     02119500
              P(WAITIO(MESSAGEHOLDER INX 1,0,25));                      02120000
              P(DEL);%                                                  02121000
              END ;                                                     02121010
                NUMESS ~ NUMESS-1;%                                     02122000
              T ~ M[MESSAGEHOLDER].[18:15];                             02123000
                   FORGETSPACE(MESSAGEHOLDER INX 1);                    02124500
              IF T ! 0 THEN%                                            02125000
                   BEGIN MESSAGEHOLDER.[33:15] ~ T;%                    02126000
                        GO TO L%                                        02127000
                   END;%                                                02128000
              MESSAGEHOLDER ~ 0;%                                       02129000
              KILL([RCW] INX NOT 2);                                    02130000
         END;%                                                          02131000
 DEFINE SPOUT(SPOUT1)=SPOUTIT(SPOUT1,1)#;                               02132000
 PROCEDURE SPOUTIT(MESSAGE,TYPE);                                       02132100
         VALUE MESSAGE,TYPE;                                            02132200
         REAL  MESSAGE,TYPE;                                            02132300
         BEGIN REAL MKSCW=-3;                                           02133000
         REAL S,T,MIX;                                                  02133010
         MESSAGE:=P(.MESSAGE,LOD).[33:15]-1;                            02133500
         STREAM(A:=0:B:=MESSAGE+1);              % CHECK FOR ~ IN       02133600
         BEGIN SI:=B; IF SC!"~" THEN TALLY:=1;   % FIRST POSITION       02133700
              A:=TALLY;                                                 02133800
         END;                                                           02133900
         IF P THEN MAKELOG(MESSAGE,TYPE);                               02134000
         IF TYPE THEN                                                   02134010
         BEGIN                                                          02134020
              MIX := M[MESSAGE-1].[9:6];                                02134030
              IF MESSAGE>FENCE THEN                                     02134100
              BEGIN S~M[MESSAGE-1].[CF]-MESSAGE;                        02134200
                   T~GETSPACE(S-1,64,0)+1;                              02134300
                   MOVE(S,MESSAGE,T);                                   02134400
                   FORGETSPACE(MESSAGE+1);                              02134500
                   MESSAGE~T;                                           02134600
              END;                                                      02134700
              IF MESSAGEHOLDER = 0 THEN%                                02135000
                   BEGIN MESSAGEHOLDER ~ MESSAGE;%                      02136000
                        FORK(P(.MESSAGEWRITER),0,0,90,1);               02137000
                   END%                                                 02138000
              ELSE M[MESSAGEHOLDER.[18:15]].[18:15] ~ MESSAGE;          02139000
              M[MESSAGE] := 0&MIX[4:43:5];                              02140000
              MESSAGEHOLDER.[18:15] ~ MESSAGE;%                         02141000
              M[MESSAGE-1].[9:6] ~ 0;%                                  02142000
              IF P(MKSCW.[33:15],DUP)  = 0 THEN%                        02143000
              BEGIN        ;                                            02143050
              STREAM(N~0:X~MESSAGE+1);                                  02144500
                   BEGIN SI ~ X;%                                       02145000
              L:        IF SC ! "~" THEN%                               02146000
                             BEGIN IF SC= " " THEN%                     02147000
                                  B:   BEGIN SI ~ SI+1;%                02148000
                                            IF SC = " " THEN GO TO B;%  02149000
                                            IF SC = ALPHA THEN%         02150000
                                                 BEGIN SI ~ SI-1;%      02151000
                                                      DS ~ CHR;%        02152000
                                                                        02153000
                                                 END ELSE GO TO L;%     02154000
                                       END;%                            02155000
                                  IF SC = @14 THEN%                     02156000
                                       BEGIN DS ~ CHR;%                 02157000
                                       Q:   IF SC = @14 THEN%           02158000
                                                 BEGIN SI ~ SI+1;%      02159000
                                                                        02160000
                                                      GO TO Q;%         02161000
                                                 END;%                  02162000
                                            GO TO L;%                   02163000
                                       END;%                            02164000
                                  N(IF SC = "}" THEN                    02164100
                                       BEGIN                            02164200
                                       SI ~ SI+1;                       02164300
                                       JUMP OUT TO L;                   02164400
                                       END;);                           02164500
                                  DS ~ CHR;%                            02165000
                                                                        02166000
                                  GO TO L;%                             02167000
                             END;%                                      02168000
                        DS ~ CHR;%                                      02169000
                                                                        02170000
                        N ~ DI;                                         02171000
                   END;%                                                02172000
              END;                                                      02174000
              IF (NUMESS ~ NUMESS+1) > 0 THEN%                          02175000
                   SLEEP([NUMESS],-0);%                                 02176000
         END ELSE FORGETSPACE(MESSAGE INX 1);                           02176900
         END;%                                                          02177000
 PROCEDURE ENDOFDECK(R); VALUE R; REAL R; FORWARD;                      02177100
 PROCEDURE TERMINALMESSAGES; FORWARD;%                                  02178000
 REAL TERMINALCLOCK;                                                    02179000
 PROCEDURE TERMINATE(MIX); VALUE MIX; REAL MIX;%                        02180000
         BEGIN IF PRTROW[MIX]!0 THEN                                    02181000
              BEGIN                                                     02182000
              IF NOTERMSET(MIX) THEN                                    02183000
                   BEGIN TERMINALCLOCK ~ CLOCK+P(RTR);%                 02184000
                        PRTROW[MIX].[FF]~MIX.[FF];                      02185000
                   END;%                                                02186000
              PRTROW[MIX].[PSF]~1;                                      02186100
              BRINGBACK(MIX.[CF]);                                      02186200
              END;                                                      02186300
         END;%                                                          02187000
 REAL PROCEDURE PLACEFINDER(S,A,L);                                     02187100
              VALUE S,A;                                                02187200
              REAL S,A,L;                                               02187300
              FORWARD;                                                  02187400
ARRAY CIDROW[*],CIDTABLE=CIDROW[*,*];                                   02187500
 PROCEDURE STOPCANDY; FORWARD;                                          02187600
 PROCEDURE TERMINALMESSAGA(N); VALUE N; REAL N;                         02188000
         BEGIN LABEL FOUND;%                                            02189000
              REAL A,T,S,ADR;%                                          02190000
              NAME B;%                                                  02191000
              REAL MSTART;                                              02191100
    REAL MIXER,TOPIO,LUN,L;%                                            02192000
              INTEGER I=S; LABEL QZ;%                                   02193000
    LABEL STT;%                                                         02194000
    SUBROUTINE SLAPITOFF;%                                              02195000
         IF LUN } 32 THEN ENDOFDECK(LUN-32) ELSE                        02195100
         BEGIN SLEEP([TOGLE],STATUSMASK);                               02196000
              READY ~ NOT (I ~ TWO(LUN)) AND READY;%                    02197000
              RRRMECH ~ NOT I AND RRRMECH OR I AND SAVEWORD;%           02198000
              LABELTABLE[LUN] ~ @114;%                                  02199000
              MULTITABLE[LUN] ~ RDCTABLE[LUN] ~ 0;%                     02200000
         END;%                                                          02201000
    LABEL LB,LBI;%                                                      02202000
              REPLY[P1MIX]~INTABLEROW[P1MIX]~0;                         02203000
              TERMINALCLOCK ~ 0;%                                       02204000
              PRTROW[P1MIX].[PSF]~1;                                    02205000
              PRIORTY~PRYOR[P1MIX]~-1;                                  02205100
              MSTART~MEM[P1MIX,MLINK1].[CF];                            02205200
              IF N!35 THEN                                              02205290
              IF JAR[P1MIX,0]="CANDE  " AND JAR[P1MIX,1]="TSHARER" THEN 02205300
                   STOPCANDY;                                           02205400
              A ~ IF N < 0 THEN ABS(N) ELSE SPACE(10);%                 02206000
              B ~ PRT[P1MIX,4];%                                        02207000
              IF P(M[L~PRT[P1MIX,8].[CF]],TOP,XCH,DEL)THEN           %TR02208000
               S~ADR~0 ELSE                                          %TR02209000
           DO BEGIN IF P(M[L],TOP,XCH,0,INX,.ADR,~) THEN% OVERLAID RCWTR02210000
                   BEGIN IF NOT M[L].[33:1] THEN%NOT TYPE 13 INT        02211000
                         BEGIN S~ADR; %SEGNO IN RCW                     02211010
                     T~0;ADR~M[M[L].MOM].[CF]; % AND THE MSCW        %TR02212000
                         END ELSE S~-1;                                 02212100
                   END ELSE % ITS PRESENT: WEVE GOT TO WORK          %TR02213000
                   BEGIN T:=IF ADR>FENCE THEN MSTART ELSE 0;            02214000
                         WHILE(S~M[T].[CF])<ADR DO T~S;%MEM LINKS    %TR02215000
                         S~IF M[T].[3:6]=1 THEN M[T+1].[CF] ELSE 0;  %TR02216000
         T~T+2;    END;                                              %TR02216100
                   IF PRT[P1MIX,8].[CF]!L OR M[L-1].MSFF%STACK IS MARKED02216200
                   THEN DO L~M[L].MOM UNTIL NOT M[L].MSFF;%GET LAST MSCW02216300
                   L~M[L].MOM;%POINT L TO NEXT RCW,JUST IN CASE.     %TR02216400
         END UNTIL (IF S!0 THEN  IF S=(-1) THEN 0 ELSE                  02216500
                                (B[0]<S OR NOT B[S].PBIT)               02216510
                   ELSE ADR>FENCE OR                                    02216600
                   (P(M[T-2].[3:12],DUP)!@700 AND P(XCH)!@1500));       02216610
      FOUND:  ADR ~ ADR-T;%                                             02217000
              T~PLACEFINDER(S,ADR,S);                                   02217100
              TERMINALMESSAGES;%                                        02218000
              B ~ [M[ P(.TERMINALMESSAGES,LOD)]];%                      02219000
              IF N < 0 THEN N ~ 0;%                                     02220000
              STREAM(Z~N!0,X~T,T~0,J~[JAR[P1MIX,0]],                    02221000
                   P1MIX,INDX~PRT[P1MIX,8] INX NOT 2 INX 0,             02222000
                   DSZE~IF P(M[P(DUP)+1],TOP) THEN P ELSE P.[8:10],     02222200
                   TOG~(N=7), Q~[B[N]], A);                             02223000
                   BEGIN CI ~ CI+Z; GO TO L1;%                          02224000
                        DS ~ LIT "-"; A ~ DI;%                          02225000
              L:        DI ~ LOC T; DI ~ DI+7;%                         02226000
                        SI ~ Q; SI ~ SI+1;%                             02227000
                        IF SC = 8 THEN%                                 02228000
                             BEGIN DS ~ LIT "6"; SI ~ SI+1; END%        02229000
                        ELSE DS ~ CHR;%                                 02230000
                        DI ~ A; DS ~ T CHR; A ~ DI;%                    02231000
                        Q ~ SI; SI ~ SI-T; SI ~ SI-1;%                  02232000
                        IF SC = 8 THEN GO TO L;%                        02233000
                        DS:=LIT":"; GO TO L2;                           02234000
              L1:       SI ~ A;%                                        02235000
                        IF SC ! "~" THEN%                               02236000
                             BEGIN SI ~ SI+1; A ~ SI;%                  02237000
                                  GO TO L1;%                            02238000
                             END;%                                      02239000
                        DI ~ A;%                                        02240000
              L2:%                                                      02241000
                        SI ~ J; SI ~ SI+1; DS ~ 7 CHR; DS ~ LIT "/";%   02242000
                        SI ~ SI+1; DS ~ 7 CHR; DS ~ LIT "=";%           02243000
                   SI~LOC P1MIX; DS~2DEC; A~DI;                         02244000
                   DI~DI-2; DS~FILL; DI~A;                              02244500
                        SI~X; DS~ 18 CHR; A~DI;                         02245000
                        TOG(DI~A;  DS~2 LIT ", ";  A~DI;  SI~INDX;      02251010
                             SKIP SB;  IF SB THEN BEGIN DI~INDX;        02251020
                             SKIP DB;  DS~RESET;  DI~A;  TOG~TALLY;     02251030
                             DS~12 LIT "EFF INX IS -";  END;            02251040
                             A~DI;  SI~INDX;  DI~LOC Q;  DS~8 DEC;      02251050
                             SI~LOC Q;  7(IF SC>"0" THEN JUMP OUT;      02251060
                                  TALLY~TALLY+1;  SI~SI+1);  DI~A;      02251070
                             T~TALLY;  DS~8 CHR;  DI~DI-T;              02251080
                             T(DS~LIT " ");  DI~DI-T;  A~DI);           02251090
                        TOG(SI~LOC DSZE;  DI~LOC Q;  DS~4 DEC;          02251100
                             DI~A;  DS~5 LIT " GEQ ";  SI~LOC Q;        02251110
                             TALLY~0;  3(IF SC>"0" THEN JUMP OUT;       02251120
                                  TALLY~TALLY+1;  SI~SI+1);             02251130
                        T~TALLY;  DS~4 CHR;  DI~DI-T;                   02251140
                             T(DS~LIT " ");  DI~DI-T;  A~DI);           02251150
                        DI ~ A; DS ~ LIT "~";%                          02252000
                   END;%                                                02253000
              IF S}0 THEN S~S&ADR[CTF];                                 02253100
               IF LOGLINE.[33:7] NEQ 0 THEN                             02253150
               BEGIN BREAK[LOGLINE.[40:8]]:=0;                          02253200
                    REPORTBACK(DSW,S&N[8:38:10],A);                     02253300
               END;                                                     02253400
              S~A;                                                      02254000
              FORGETSPACE(T);                                           02254100
         STREAM(B:=S,A:=A:=SPACE(17));                                  02255000
              BEGIN 17(DS~8 LIT"#"); SI~B;DI~A;DI~DI+8;DS~2 LIT" ";%    02255100
                   10(8(IF SC!"~" THEN DS~CHR ELSE JUMP OUT 2 TO L1));  02255200
                   L1: DS~2 LIT" ";%                                    02255500
              END;%                                                     02256000
              SPOUT(S);                                                 02256500
              IF NOT TERMGO THEN BEGIN HALT;%                           02257000
                   COMPLEXSLEEP(-100=NUMESS);%                          02258000
                   DO UNTIL KEYIN(0)=1;                                 02258100
                   NOPROCESSTOG ~ NOPROCESSTOG-1; END;%                 02258200
              JAR[P1MIX,1] ~-JAR[P1MIX,1];%                             02259000
              IF (LOGARRAY[31] AND IOMASK)=0 THEN                       02259100
                   SLEEP([LOGARRAY[31]], IOMASK);                       02259200
              UNHOOQUE(P1MIX);%                                         02260000
              MIXER~ @300+P1MIX;%                                       02261000
         STT: T:=M[MSTART];                                             02262000
              WHILE (L~T.[CF])!MSTART DO                                02263000
                   IF (T~M[L]).[3:12]=MIXER AND T>0%                    02264000
                        THEN%                                           02265000
    BEGIN LUN ~ (TOPIO ~ NFLAG(M[L+2])).[12:6];                         02266000
         IF LUN }32 THEN                                                02266100
              BEGIN                                                     02266200
                   FILECLOSE(TOPIO INX 0);                              02266300
                   GO TO STT;                                           02266400
              END;                                                      02266500
         IF UNIT[LUN].[13:5] = @20                                      02267000
              THEN BEGIN%                                               02268000
         QZ:%                                                           02269000
                   SLAPITOFF;                                           02270000
                   FORGETSPACE(L INX 2);%                               02271000
                   GO TO STT;%                                          02272000
                   END ELSE                                             02273000
         BEGIN T ~ 0;                                                   02274000
              NT2~M[M[TOPIO INX NOT 2] INX 13].[1:9]-1;%                02275000
              FOR NT1 ~ 0 STEP 1 UNTIL NT2 DO%                          02276000
                   M[TOPIO INX NT1] ~ *P(DUP) OR IOMASK;%               02277000
        IF LUN{22 AND LUN}20 OR (LUN{18 AND                             02278000
        (P(M[TOPIO].[3:5],DUP)=22 OR P(XCH)=10))                        02278100
              THEN                                                      02278500
         BEGIN IF LUN { 18 THEN % UNIT IS BACKUP                        02279000
              BEGIN S~17;%                                              02280000
                   STREAM(A,D~L+4);                                     02281000
                   BEGIN SI~A; DS~17 WDS END;%                          02282000
                   NT4~M[TOPIO INX NOT 2] INX 0;%                       02283000
                   NT1~M[NT4+14];%                                      02284000
                   NT2~NT1.[FF]; NT1~NT1.[CF];%                         02285000
                   IF M[TOPIO].[3:5]=22 THEN                            02285100
                   IF NT1=NT2-72 THEN%                                  02286000
                   BEGIN NT1~M[NT4+5].[FF];%                            02287000
                        M[NT4+5].[FF]~NT1+1;%                           02287100
                        M[NT2+17]~ @1540004002000000 &NT1[CTC];%        02287110
                        M[NT4+14].[FF]~NT2-18;%                         02287120
                   END ELSE%                                            02287130
                        IF M[NT2+35].[27:6]=0 THEN M[NT2+35].[28:1]~1;  02287140
                   M[M[TOPIO INX NOT 2] INX 17] ~ -1;%                  02287200
                   M[TOPIO]~FLAG((M[M[TOPIO INX NOT 2] INX 16])%        02287210
                        &0[20:47:1]&S[8:38:10]);%                       02287220
              END ELSE %                                                02287230
              BEGIN T~(A INX @540000000000000) &(LUN!22)[32:47:1]%      02287240
                        &17[8:38:10];%                                  02287250
          IF LUN!22 THEN %IF PUNCH FILE, IGNORE                         02287254
                   IF WAITIO(@4002000000,@357,LUN).[45:1] THEN GO QZ;   02287255
                   T~WAITIO(T,@357,LUN);%                               02287260
                   IF T.[45:1] THEN GO TO QZ;%                          02287270
              END;                                                      02287280
         END ELSE%                                                      02290000
              IF LUN=23 OR LUN=24 THEN%                                 02291000
              BEGIN ADR~L+4;%                                           02292000
                   LB:  IF(T~UNIT[LUN]).[13:5]=25 THEN%                 02293000
              BEGIN ADR~T.[CF];                                         02294000
                   STREAM (A~"END":ADR); BEGIN SI ~ ADR;%               02295000
         L:SI ~ SI +1; IF SC = " " THEN GO TO L;%                       02296000
              DI ~ LOC A; DI ~ DI+5; IF 3 SC ! DC THEN TALLY ~ 1; A ~%  02297000
       TALLY END;  IF P THEN BEGIN%                                     02298000
                                                                        02299000
                                                                        02300000
                                            UNIT[LUN]~@7777777777%      02301000
                             END                                        02302000
              ELSE BEGIN M[TOPIO]~M[TOPIO]OR@2004000000; T~0;%          02303000
              M[M[TOPIO]]~"END.   "&@14[1:43:5]; END;%                  02304000
              END;                                                      02305000
                        IF T!0 THEN%                                    02306000
                             BEGIN%                                     02307000
                             LBI:T~WAITIO(@40000000+ADR,@367,LUN);%     02308000
              IF T.[45:1] THEN GO TO QZ;%                               02309000
                                  IF T.[42:1] THEN GO TO LB ELSE%       02310000
                                       GO TO LBI%                       02311000
              END            END;%                                      02312000
               IF T=0 THEN                                              02313000
                   IF (M[M[TOPIO INX NOT 2] INX 5].[42:1])              02313500
                       THEN FORGETSPACE(L INX 2)                        02313600
                       ELSE FILECLOSE(TOPIO INX 0);                     02314000
              GO TO STT                                                 02315000
    END; END;                                                           02316000
              FORGETSPACE(A);%                                          02317000
              T:=M[MSTART];                                             02318000
              MIXER:=@400+P1MIX;                                        02318050
              WHILE (L~T.[CF])!MSTART DO                                02319000
                   IF(T~M[L]).[3:12]=MIXER AND T>0 THEN%                02320000
                        IF M[M[L+4].[CF]+5].[41:1] THEN FILECLOSE(L+7); 02321000
              T:=M[MSTART];                                             02322000
              MIXER:=@600+P1MIX;                                        02322050
              WHILE (L~T.[CF])!MSTART DO                                02323000
                   IF(T~M[L]).[3:12]=MIXER AND T>0 THEN%                02324000
                   IF M[L+7].[41:1] THEN FILECLOSE(M[L+1] INX 3);%      02325000
              FOR LUN ~ 0 STEP 1 UNTIL 31 DO%                           02326000
                   IF RDCTABLE[LUN].[8:6] = P1MIX THEN%                 02327000
                        SLAPITOFF;%                                     02328000
              PRT[P1MIX,9]:=5;  %SET FOR GETSPACE                       02328500
              P(.COM5); GO TO DIFFCOM;                                  02329000
         END;%                                                          02330000
 SAVE PROCEDURE TERMINALMESSAGE(N); VALUE N; REAL N;                    02330100
         BEGIN NT1 ~ N;                                                 02330200
              P(0,STF);                                                 02330300
              TERMINALMESSAGA(NT1);                                     02330400
         END;                                                           02330500
 PROCEDURE TERMINALMESSAGES;%                                           02331000
         BEGIN LABEL L;%                                                02332000
              P(0,XIT,.L,DEL);%                                         02333000
         L::: "8STACK ", "6OVRFLW",    % 1%                             02334000
              "8OPRTR ", "5DS-ED0",    % 3%                             02335000
              "8FLAG B", "2IT0000",    % 5%                             02336000
              "8INVALD", "6 INDEX",    % 7%                             02337000
              "8EXPON ", "6OVRFLW",    % 9%                             02338000
              "8INTGR ", "6OVRFLW",    %11%                             02339000
              "8DIV BY", "5 ZERO0",   %13%                              02340000
              "8EXCESS", "5 TIME0",    %15%                             02341000
              "8INVALD", "6 ADRSS",    %17%                             02342000
              "8UNEXP ", "6IO ERR",   %19%                              02343000
              "8MISSIN" , "8G DISK", "5 FILE0", 0,  %21                 02344000
              "8FILE U","8NOPENE","1D00000",                     %25%   02345000
              "8INVALI","5D EOJ0",                               %28    02345100
              "8INVALI", "5D PRL0",    %30%                             02345200
              "8MEMORY","8 PARIT","1Y00000",                    %32 %WF 02345300
              "8OPRTR ", "5ES-ED.",    %35%                             02345400
              "8INVALD", "8 ARRAY", "8 SIZE ", "3IDN...",  %37          02345500
              "8INVALD", "8 INPUT", "6 DATUM",             %41          02345600
              "8TYPE M", "8ISMATC", "8H READ", "4STMT..",  %44          02345610
              "8OUT OF", "5 DATA.",                        %48          02345620
              "8NON-CO", "8NFORMA", "8L ARRA", "2YS....",  %50          02345630
              "8NON-SQ", "8UARE M", "5ATRIX.",             %54          02345640
              "8NEARLY", "8 SINGU", "8LAR MA", "4TRIX..",  %57          02345650
              "8USER D", "4S-ED..",                        %61          02345660
              "8INVALD", "8 DYNAM", "8IC DIA", "1L.....",  %63          02345670
              "8TANK O","6VRFLOW",0,         %67                        02345710
              "8PARITY","6 ERROR",           %70                        02345720
              "8DIMENS","8ION SI","6ZE ERR", % 72                       02345730
              "8INVALD","8 FILE ","4NAME..", %75                        02345740
              "8INVALD","8 BLOCK","5 EXIT.", %78                        02345750
              "8OUT OF","4 MEM..",           %81                        02345760
              "8EXCESS","8 IO TI","2ME....", % 83                       02345770
              0;%                                                       02346000
         END;%                                                          02347000
 REAL STREAM PROCEDURE UNITIN(TINU,WHAT); VALUE WHAT;%                  02348000
         BEGIN%                                                         02349000
              SI ~ WHAT;%                                               02350000
         L:   IF SC = " " THEN%                                         02351000
                   BEGIN SI ~ SI+1; GO TO L END;%                       02352000
              DI ~ TINU;%                                               02353000
$ OMIT 02354001, IF SHAREDISK;                                          02353999
              37(DI ~ DI+5;                                             02354000
$ INCLUDE 02354101, IF SHAREDISK;                                       02354099
              41(DI:=DI+5;                                              02354100
                   IF 3 SC = DC THEN JUMP OUT;%                         02355000
                   TALLY ~ TALLY+1;%                                    02356000
                   SI ~ SI-3;);%                                        02357000
              UNITIN ~ TALLY;%                                          02358000
         END;%                                                          02359000
                                                                        02378000
 PROCEDURE ENTERUSERFILE(A,B,L); VALUE A,B,L; REAL A,B,L; FORWARD;%     02379000
 INTEGER PROCEDURE CALCULATEPURGE(PURGE);%                              02380000
         VALUE PURGE; REAL PURGE;%                                      02381000
         BEGIN REAL Y,D;%                                               02382000
              REAL J;%                                                  02383000
              REAL C=+1;;%                                              02384000
              STREAM(A~[DATE],B~[Y]);%                                  02385000
                   BEGIN SI~A; SI~SI+3; DS ~ 2 OCT; DS ~ 3 OCT END;%    02386000
              J ~ (D ~ ( Y+3) DIV 4|1461+(Y+3) MOD 4 | 365 +D+PURGE-%   02387000
                   1) DIV 1461;%                                        02388000
              IF (Y ~ (D ~ D MOD 1461) DIV 365) = 4 THEN%               02389000
                   BEGIN Y ~ 3; D ~ 365 END ELSE D ~ D MOD 365;%        02390000
              CALCULATEPURGE ~ (4|J+Y-3)|1000+D+1;%                     02391000
              STREAM(C~[C]); BEGIN SI~C; DS ~ 8 DEC END;%               02392000
         END;%                                                          02393000
PROCEDURE CHANGEDATE(BUFF); VALUE BUFF; REAL BUFF; FORWARD;             02393100
DEFINE MIDNIGHT=BEGIN IF XCLOCK+P(RTR)}5184000 THEN                     02393200
                      BEGIN XCLOCK~XCLOCK-5184000;                      02393250
 DATE:=CALCULATEPURGE(1);  CHANGEDATE(SPACE(10));  END END#;            02393300
REAL PROCEDURE TAPELABEL(M,F,R,C,P); VALUE M,F,R,C,P;                %AI02393400
    REAL M,F,R,C,P; FORWARD;                                         %AI02393500
$ INCLUDE 02434001, IF DUMP OR DEBUGGING;                               02393999
 PROCEDURE PRINTCORE(X); VALUE X; REAL X;                           %10302394000
         BEGIN REAL B,S,N,I,K; ARRAY T[*];%                             02395000
              LABEL L1,L2;                                           %AI02395050
              REAL U,MS;                                            %10302395100
              LABEL NW,PR,SK;                                           02395150
              DO UNTIL ( U ~                                            02395200
              IF LABELTABLE[20] = 0 THEN 20 ELSE                        02395300
              IF LABELTABLE[21] = 0 THEN 21 ELSE                        02395400
              IF P(RRR).[27:1] THEN 20 ELSE                             02395500
              IF P(RRR).[26:1] THEN 21 ELSE 0) ! 0;                     02395600
                                                                        02396000
              S ~ 0;                                                    02396100
              HALT;                                                     02396110
              WAITSTORE(0);                                             02396120
              STOREDY[0]~0;                                             02396130
              WHILE (S ~ M[S]).[33:15] ! 0 DO                           02396200
                   IF M[S].[1:17] = @1000 THEN                          02396300
                             B ~ OLAY(S.[33:15],0);                     02396400
              STOREDY[0]~1;                                             02396500
$ INCLUDE 02397001, IF DEBUGGING;                                       02396599
              B~(DBARRAY INX 2)&15[8:38:10];                            02397000
$OMIT 02397501, IF DEBUGGING;                                           02397499
              B:=SPACE(30)&15[8:38:10];                                 02397500
         L1:  IF P(WAITIO(@4000100000,4,U)).[45:1] THEN GO TO L1;    %AI02397800
              IF X GTR MIXMAX OR X LSS 0 THEN X:=0;                 %10302398000
              MS:=S:=MEMROW[X].[CF];                                %10302398100
              IF STASUS[X]=RUNNING OR S=0 THEN                      %10302398200
%                                                                       02398500
              DO BEGIN N:=IF (T:=M[S]) GTR 0 AND T.[CF] NEQ MS      %10302399000
                              THEN                                  %10302399100
                        NOT S INX T INX 1 ELSE 3;%                      02400000
                   IF (S AND @7777) = @7777 AND (T AND @7777) = 0 THEN% 02401000
                        N ~ 1;%                                         02402000
         NW:       STREAM(N~IF N>6 THEN 6 ELSE N,S,B);%                 02403000
                        BEGIN 60(DS ~ 2 LIT " ");%                      02404000
                             DI ~ B; SI ~ LOC S; SKIP 33 SB;%           02405000
                             5(DS~3RESET; 3(IF SB THEN%                 02406000
                                  DS ~ SET ELSE DS ~ RESET; SKIP SB));% 02407000
                             DS ~ LIT " ";%                             02408000
                             SI ~ S;%                                   02409000
                             N(DS ~ LIT " "; 2(DS~LIT" "; 8(DS~3RESET;% 02410000
                             3(IF SB THEN DS~SET ELSE DS ~ RESET;%      02411000
                             SKIP SB))));%                              02412000
                        END;%                                           02413000
                   K ~ 1;%                                              02414000
         PR:       I ~ WAITIO(B&((N>6)+1)[27:46:2],@64,U);              02415000
                   IF I.[42:1] THEN%                                    02416000
                        I ~ WAITIO(@4000100000,4,U);                    02417000
                   IF I.[45:1] THEN GO TO PR;%                          02418000
         SK:       S ~ S+6; N ~ N-6;%                                   02419000
                   IF N } 6 THEN%                                       02420000
                        BEGIN; STREAM(A~S-6:S);%                        02421000
                             BEGIN SI ~ A; IF 48 SC = DC THEN TALLY ~ 1;02422000
                                  A ~ TALLY;%                           02423000
                             END;%                                      02424000
                             IF P THEN%                                 02425000
                                  BEGIN IF K THEN BEGIN;%               02426000
                                       STREAM(B); 60(DS~2LIT"*");%      02427000
                                       K ~ 0;%                          02428000
                                       GO TO PR;%                       02429000
                                  END ELSE GO TO SK; END;END;%          02430000
                   IF N > 0 THEN GO TO NW;%                             02431000
                   S ~ T.[33:15];%                                      02432000
              END UNTIL S=MS;                                       %10302433000
              NOPROCESSTOG ~ NOPROCESSTOG-1;                            02433100
         L2:  IF P(WAITIO(@4000100000,4,U)).[45:1] THEN GO TO L2;    %AI02433500
         END;%                                                          02434000
     REAL MEMOD;                                                     %AI02434050
$ INCLUDE 02434781, IF DEBUGGING OR DUMP;                               02434099
PROCEDURE DUMPCORE(BUFF);                                            %AI02434100
         VALUE BUFF; REAL BUFF;                                      %AI02434110
         BEGIN REAL B,S,N,TM,TA,U,D;                                 %AI02434120
              INTEGER I;                                             %AI02434125
              ARRAY TP[*]; ARRAY TL[*];                              %AI02434130
              LABEL X,L1;                                            %AI02434135
              BOOLEAN SUBROUTINE CHKMOD;                             %AI02434140
              BEGIN;                                                 %AI02434142
                   STREAM(N:MM~MEMOD);                               %AI02434144
                   BEGIN SI~LOC MM; SKIP 40 SB; SKIP N SB;              02434146
                        IF SB THEN TALLY~1; N~TALLY;                 %AI02434148
                   END;                                              %AI02434150
              CHKMOD ~ P;                                            %AI02434155
              END;                                                   %AI02434160
                   FOR U:=0 STEP 1 UNTIL 15 DO                       %AI02434170
                   IF (MULTITABLE[U]="MEMORY ") AND                  %AI02434180
                      (LABELTABLE[U].[5:25]="1DUMP")THEN GO TO L1;   %AI02434190
                   FOR U~0 STEP 1 UNTIL 15 DO IF LABELTABLE[U]=0     %AI02434200
                        AND PRNTABLE[U].[1:1] THEN GO TO L1;         %AI02434210
                   BUFF:=BUFF.[15:15]-1;                             %AI02434215
                   STREAM(BUFF);                                     %AI02434220
                        DS:=17LIT"#NO MEMDUMP TAPE~";                %AI02434230
                   GO TO X;                                          %AI02434240
         L1:       MULTITABLE[U]:="MEMORY ";                         %AI02434250
                   LABELTABLE[U].[1:29]:=@1024644447;                %AI02434260
                   STREAM(A:="001",B:=[LABELTABLE[U]]);              %AI02434270
                   BEGIN SI := LOC A; SI := SI + 5;                  %AI02434280
                         DI:=DI+5; DS:=3ADD;                         %AI02434290
                   END;                                              %AI02434300
                   RRRMECH := TWO(U) OR RRRMECH;                     %AI02434310
                   B:=GETSPACE(20,0,0)+2;                            %AI02434320
                   STREAM(BUFF,B);                                   %AI02434330
                   BEGIN                                             %AI02434340
                        DS:=8LIT" "; SI:=B; DS:=19WDS;               %AI02434350
                        SI:=BUFF; DI:=B;                             %AI02434360
                        20(8(IF SC!"~" THEN DS~CHR ELSE JUMP OUT 2   %AI02434370
                             TO L));     L:                          %AI02434380
                   END;                                              %AI02434390
                   LABELTABLE[U].[1:5]:=@20;                         %AI02434400
                   TL:=[M[TAPELABEL("MEMORY ",LABELTABLE[U].[6:42],  %AI02434410
                        1,1,10)]]&10[8:38:10];                       %AI02434420
                   STREAM(A~PRNTABLE[U].[30:18],TL);                    02434424
                        BEGIN SI~LOC A; DI~DI+53; DS~5 DEC END;      %AI02434426
                   TP:=[M[TA:=GETSPACE(513,0,0)+2]]&513[8:38:10];    %AI02434430
                   TM:=0&@1737[1:37:11];                             %AI02434440
                   P(WAITIO(TL&@05000[CTF],0,U),DEL);                %AI02434450
                   P(WAITIO([TM],@40,U),DEL);                        %AI02434460
                   S:=0;                                             %AI02434470
                   HALT; WAITSTORE(0);                               %AI02434480
                   STOREDY[0]~0;                                     %AI02434490
                   WHILE (S:=M[S]).[33:15] NEQ 0 DO                  %AI02434500
                        IF M[S].[1:17]=@1000 THEN                    %AI02434510
                             D:=OLAY(S.[33:15],0);                   %AI02434520
                   STOREDY[0]~1;                                     %AI02434530
                   S:=0;                                             %AI02434540
                   DO BEGIN                                          %AI02434550
                        N:=S.[33:3];                                 %AI02434560
                        IF CHKMOD        THEN S := -S                %AI02434570
                                         ELSE MOVE(512,S,TA+1);      %AI02434580
                        TP[0] := S;                                  %AI02434590
                        P(WAITIO(TP&@05000[CTF],0,U),DEL);           %AI02434600
                        IF S LSS 0 THEN S := 3584 - S;               %AI02434610
                      END UNTIL (S:=S+512).[18:15];                  %AI02434620
                   P(WAITIO(B&20[8:38:10]&5[21:45:3],0,U),DEL);      %AI02434630
                   P(WAITIO([TM],@40,U),DEL);                        %AI02434640
                   P(WAITIO(TL&@05000[CTF],0,U),DEL);                %AI02434650
                   FORGETSPACE(TP);                                  %AI02434660
                   FORGETSPACE(TL);                                  %AI02434670
                   FORGETSPACE(B);                                   %AI02434680
                   LABELTABLE[U].[1:5]~@01;                          %AI02434690
                   BUFF:=BUFF.[15:15]-1;                             %AI02434695
                   STREAM(U~TINU[U],L~LABELTABLE[U],BUFF);           %AI02434700
                   BEGIN                                             %AI02434710
                        SI:=LOC U; SI := SI + 5;                     %AI02434720
                        DS:=1LIT" "; DS:=3CHR;                       %AI02434730
                        SI~LOC L; SI~SI+1; DS~ 1 LIT " "; DS~7 CHR;  %AI02434735
                        DS:=7LIT" DP-ED~";                           %AI02434740
                   END;                                              %AI02434750
                   NOPROCESSTOG:=NOPROCESSTOG-1;                     %AI02434760
         X:        SPOUT(BUFF);                                      %AI02434770
         END DUMPCORE;                                               %AI02434780
 PROCEDURE DISKERROR(PARM); VALUE PARM; REAL PARM;%                     02523000
         BEGIN REAL    U,A;%                                            02524000
              REAL RCW=+0;                                              02524100
             U:=M[PARM].[CF];                                       %GEH02525000
              A := SPACE(10);                                           02526000
              STREAM(X:=TINU[U], IO:=IF M[PARM+1].[24:1] THEN "R" ELSE  02527000
                     "W", PARM:=PARM+1, MX:=M[PARM].[FF], A);       %GEH02528000
                   BEGIN SI ~ LOC X; SI ~ SI+5; DS ~ 3 CHR;%            02530000
                        SI:=PARM; DS:=5 LIT" IOD=";                 %GEH02531000
                        16(DS:=3 RESET; 3(IF SB THEN DS:=SET ELSE   %GEH02532000
                           DS:=RESET; SKIP SB));                    %GEH02532500
                        DS:=4 LIT";DA="; DS:=8 CHR;                 %GEH02533000
                        DS:=4 LIT";RD=";                            %GEH02533500
                        16(DS:=3 RESET; 3(IF SB THEN DS:=SET ELSE   %GEH02534000
                           DS:=RESET; SKIP SB));                    %GEH02534500
                        DS:=6 LIT";RTRY="; DS:=DEC;                 %GEH02535000
                        DS:=5 LIT";MIX="; SI:=LOC MX; DS:=2 DEC;    %GEH02535500
                        DS:=LIT LEFTARROW;                          %GEH02536000
                        DI:=DI-3; DS:=FILL;                         %GEH02536500
                   END;%                                                02537000
              FORGETAREA(0,PARM);                                   %GEH02537500
          SPOUTIT (A,35); % DKA                                     %R6402538000
          KILL([RCW] INX NOT 2);                                        02539000
         END;%                                                          02540000
 PROCEDURE NAMEID(A,KTR);%                                              02603000
    REAL A,KTR;%                                                        02604000
    BEGIN;%                                                             02605000
         STREAM(A~[A]:KTR);%                                            02606000
         BEGIN DI ~ A; DS ~ 8 LIT "0       ";%                          02607000
              DI ~ DI-7; SI ~ KTR;%                                     02608000
         L:   IF SC = " " THEN%                                         02609000
                   BEGIN SI ~ SI+1; GO TO L END;%                       02610000
              IF SC = """ THEN%                                         02611000
                   BEGIN SI ~ SI+1;%                                    02612000
                        7(IF SC = "~" THEN JUMP OUT TO EXIT;%           02613000
                             DS ~ CHR;%                                 02614000
                             IF SC = """ THEN JUMP OUT TO LQ;);%        02615000
         LQ:            SI ~ SI+1;%                                     02616000
                        GO TO EXIT;%                                    02617000
                   END;%                                                02618000
              IF SC = ALPHA THEN%                                       02619000
                   BEGIN 7(DS ~ CHR;%                                   02620000
                        IF SC = ALPHA THEN GO TO LA;%                   02621000
                        JUMP OUT TO EXIT;%                              02622000
         LA:            );%                                             02623000
         LE: IF SC = ALPHA THEN  %                                      02623500
                   BEGIN SI~SI+1; GO TO LE; END;  %                     02623501
                        GO TO EXIT;%                                    02624000
                   END;%                                                02625000
              IF SC = "~" THEN%                                         02626000
                   BEGIN DS ~ CHR; SI ~ SI-1; GO TO EXIT END;%          02627000
              IF SC = "=" THEN%                                         02628000
                    BEGIN DS~2 LIT"~~"; SI~SI+1; GO TO EXIT END;        02629000
              DS ~ CHR;%                                                02630000
         EXIT:A ~ SI;%                                                  02631000
         END;%                                                          02632000
         KTR ~ P(XCH);%                                                 02633000
    END;%                                                               02634000
REAL PROCEDURE TAPELABEL(MULFID,FID,REELNO,CYCLE,PURGE);%               02635000
              VALUE MULFID,FID,REELNO,CYCLE,PURGE;%                     02636000
              REAL MULFID,FID,REELNO,CYCLE,PURGE;%                      02637000
    BEGIN     REAL LBL;%                                                02638000
              LBL := SPACE(10);                                         02639000
              STREAM(%                                                  02640000
               DATE, MULFID,FID,REELNO,CYCLE,PU~CALCULATEPURGE(PURGE),% 02641000
                     LBL);%                                             02642000
                   BEGIN%                                               02643000
                        DS~8 LIT" LABEL  ";%                            02644000
                        SI~LOC MULFID;%                                 02645000
                        DS~WDS;%                                        02646000
                        DS~WDS;%                                        02647000
                        DS~3 DEC;%                                      02648000
                        SI ~ LOC DATE; SI ~ SI+3;%                      02649000
                        DS ~ 5 CHR;%                                    02650000
                        SI~LOC CYCLE;%                                  02651000
                        DS~ 2 DEC;%                                     02652000
                        SI~LOC PU; SI~SI+3;%                            02653000
                        DS~5 CHR; DS~1 LIT"0";%                         02654000
                        5(DS~8 LIT"00000000")%                          02655000
                   END;%                                                02656000
              TAPELABEL~LBL;%                                           02657000
    END;%                                                               02658000
REAL PROCEDURE LABELASCRATCH(LBL); VALUE LBL;REAL LBL;%                 02659000
         BEGIN%                                                         02660000
              REAL LUN,TM,REEL,T;                                       02661000
              LBL ~  P(.LBL,LOD).[33:15];%                              02662000
              STREAM(L~LBL+3,R~[REEL]);                                 02662100
              BEGIN SI~L; DS~3 OCT END;                                 02662200
              LUN~FINDOUTPUT(M[LBL+1],M[LBL+2],2,0,REEL,0,0,TM);        02663000
              IF LUN}0 THEN                                             02663100
              BEGIN;                                                    02663200
              STREAM(A~PRNTABLE[LUN].[30:18],T~[T],L~LBL+6);            02664000
              BEGIN DI~DI+5; SI~LOC A; DS~5DEC; SI~SI-8; DI~T;          02664100
                    DS~8DEC; DI~DI-7; DS~6FILL;               END;      02665000
              RDCTABLE[LUN].[8:6]~P1MIX;                                02665100
              MULTITABLE[LUN]~M[LBL+1];                                 02665150
              RRRMECH~TWO(LUN) OR RRRMECH;                              02665200
              P(WAITIO(LBL OR @120500000000,0,LUN),DEL);%               02666000
              TM~0&"}~"[1:37:11];%                                      02667000
              P(WAITIO([TM],0,LUN),DEL);%                               02668000
              IF OPNMESS THEN                                           02668100
                   FILEMESS(" OUT"&TINU[LUN][6:30:18],T,M[LBL+1],       02668500
                        M[LBL+2],REEL,0,0);                             02668600
              END;                                                      02668800
              LABELASCRATCH~LUN%                                        02669000
         END LABELASCRATCH;%                                            02670000
PROCEDURE NSECOND;FORWARD;%                                             02692000
BOOLEAN PROCEDURE SYSTEMFILE(A,B); VALUE A,B;REAL A,B; FORWARD;         02692500
 DEFINE  CHECKSTACKSPACE=IF P(PRT[P1MIX,*] INX 0)-P(0,RDS) LSS          02693000
              63&(CANDYINX NEQ P1MIX)[41:47:1]                          02693500
              THEN BEGIN P(64,STS);  GO TO STACKOVERFLOW;  END#;    %WF 02694000
 REAL PROCEDURE PUTORTAKE(MIX,WHERE,IO,WHAT);                           02700000
         VALUE MIX,WHERE,IO,WHAT;                                       02701000
         REAL MIX,WHERE,IO,WHAT;                                        02702000
         COMMENT THIS ROUTINE IS USED TO GET OR RETURN ONE OR MORE      02702100
                   WORDS FROM A (PERHAPS) SWAPPED AREA.  THIS           02702200
                   ROUTINE IS SMART ENOUGH TO NOT DO DISK ACCESSES      02702300
                   UNLESS IT NEEDS TO, TOO.  IF ONE WORD IS GOTTEN,     02702400
                   IT IS RETURNED AS THE VALUE.  IF MORE THAN ONE       02702500
                   WORD IS GOTTEN, THE VALUE RETURNED IS A POINTER      02702600
                   TO THE AREA CONTAINING THE WORDS.  THE ROUTINE       02702700
                   DOES GETSPACE/FORGETSPACE ACTION ON MULTIPLE-WORD    02702800
                   AREAS.  OF COURSE INPUT VERSUS OUTPUT DECIDES;       02702900
    BEGIN INTEGER  S,COUNT,SIZE;                                        02703000
         REAL      DA,T,NORTH;                                          02704000
         IF (STASUS[MIX] AND STABLE) = 0 THEN                           02704100
              BEGIN IF IO.[2:1] THEN CLICK:=CLOCK+P(RTR)+180;           02704120
                   SLEEP([SQ[MIX]],0&STABLE[18:42:6]);                  02704140
                   IF (STASUS[MIX] AND STABLE)=0 THEN P(0,NOT,RTN);     02704160
              END;                                                      02704180
              SQ[MIX]~-*P(DUP);                                         02704200
              COUNT ~ ABS(IO)+(IO=0);                                   02704300
              IO ~ IO>0;                                                02704400
              IF  NORTH~(S~[WHERE].[CF])}FENCE AND((T~STASUS[MIX])=     02705000
              READYSTATE OR T=RDYRPT OR T=WAITSTATE)                    02706000
              THEN BEGIN T := SPACE(SIZE := 30|((COUNT+58)DIV 30));     02707000
                        DA~DISKSTORE[MIX]+(S~-([MEM[MIX,MLINK1]]        02708000
                           INX 1)+S) DIV 30;                            02709000
                        S~S MOD 30;                                     02710000
                        DISKWAIT(-T,SIZE,DA);                           02711000
                        WHERE~[M[T+S]];                                 02712000
                   END;                                                 02713000
              IF COUNT=1 THEN                                           02714000
              BEGIN PUTORTAKE~NFLAG(WHERE);                             02714100
                   IF NOT IO THEN M[[WHERE]] ~ WHAT;                    02714200
              END ELSE BEGIN                                            02714300
                   IF IO THEN WHAT := SPACE(COUNT);                     02715000
                   P([WHERE],WHAT);                                     02715100
                   IF NOT IO THEN P(XCH);                               02715200
                   STREAM(S~P,D~P:SIZE~COUNT);                          02716000
                   BEGIN SI~S;  DI~D;  DS~SIZE WDS;  END;               02716100
                   P(DEL,DEL);                                          02716200
                   PUTORTAKE~WHAT;                                      02716300
              END;                                                      02717000
              IF NORTH THEN                                             02718000
              BEGIN IF NOT IO THEN DISKWAIT(T,SIZE,DA);                 02719000
                   FORGETSPACE(T);                                      02719100
              END;                                                      02719200
              IF NOT IO THEN IF COUNT!1 THEN FORGETSPACE(WHAT);         02720000
              SQ[MIX]~-*P(DUP);                                         02720100
         END;                                                           02721000
 PROCEDURE DIRECTORYFULL(LOST); VALUE LOST; BOOLEAN LOST;               02722000
         BEGIN REAL T;                                                  02723000
              ;STREAM(LOST,P1MIX,T:=T:=SPACE(10));                      02724000
                   BEGIN DS~34 LIT "*** SHOULD H/L: DISK DIRCTRY FULL=";02725000
                        SI~LOC P1MIX; DS~2 DEC;                         02726000
                        P1MIX~DI; DI~DI-2; DS~FILL; DI~P1MIX;           02727000
                   LOST(DI~DI-3;DS~17 LIT",SOME FILES LOST=");          02728000
                        DS~LIT "~";                                     02729000
                   END;                                                 02730000
              SPOUT(T);                                                 02731000
              T:=SPACE(30);                                         %R7102731100
              M[T+28]~@114;                                             02732000
              IF LOST THEN DISKWAIT(T,30,BYPASS.[FF]);              %R7102733000
              FORGETSPACE(T);                                           02734000
              IF [MEM[P1MIX,0]].[CF]}FENCE THEN                         02735000
                   SWAP(WAITSWAP,1)                                     02736000
              ELSE SLEEP(0,0);                                          02737000
         END;                                                           02738000
$OMIT 02786001, IF DCP;                                                 02739999
    PROCEDURE DCERR(R);                                                 02740000
    VALUE R; REAL R;                                                    02741000
    BEGIN REAL RCW=+0;                                                  02742000
         LABEL E0,E1,E2,E3,NEXT,FOUND,ENDIT;                            02742500
         REAL A,B,C;                                                    02743000
         SWITCH ERR:=E0,E1,E2,E3;                                       02743500
         A:=SPACE(8);                                                   02744000
         STREAM(R:=R&0[4:4:4]:Y:=R.[9:4],Z:=R.[14:4],A);                02745000
         BEGIN SI:=LOC R;                                               02746000
              DS:=14 LIT"#DCA ERR - RD=";                               02747000
              16(DS:=3 RESET; 3(IF SB THEN DS:=SET ELSE DS:=RESET;      02748000
                 SKIP 1 SB)); SI:=LOC Y;                                02749000
              DS:=8LIT",TU/BUF="; DS:=2DEC;DS:=LIT"/";DS:=2DEC;     %R9502749100
              R:=DI;                                                    02750000
         END; C:=P;                                                     02751000
         GO TO ERR[B:=R.[4:4]];                                         02751100
E0:      STREAM(R:=C);                                                  02751200
         DS:=15 LIT "-BAD TU/BU NUM~";                                  02751300
         GO TO NEXT;                                                    02751400
E1:      STREAM(R:=C);                                                  02751500
         DS:=14 LIT "-BAD RES DESC~";                                   02751600
         GO TO NEXT;                                                    02751700
E2:      STREAM(R:=C);                                                  02751800
         DS:=15 LIT "-BAD INPUT ADR~";                                  02751900
         GO TO NEXT;                                                    02752000
E3:      STREAM(R:=C);                                                  02752100
         DS:=19 LIT "-READ BOUNCED BACK~";                              02752200
NEXT:                                                                   02752300
         SPOUTIT(A,35);                                                 02752400
         A:=R.[9:9];                                                    02753000
         IF B!0 THEN                                                    02754000
         FOR B:=1 STEP 1 UNTIL LMAX DO                                  02755000
         IF A=LINETABLE[B].[9:9] THEN GO FOUND;                         02756000
         GO ENDIT;                                                      02757000
FOUND:   BLASTREAD(B,1);                                                02758000
         IF LINEDISC[B]=MULTI THEN ENTEREADYQ(B);                       02758500
ENDIT:   KILL([RCW] INX NOT 2);                                         02759000
    END OF FUNNY DC RESULT DESCRIPTOR HANDLING;                         02760000
    PROCEDURE DCBUSY(V);                                                02761000
    VALUE V;                                                            02762000
    REAL V;                                                             02763000
    BEGIN                                                               02764000
         REAL RCW=+0;                                                   02765000
         REAL A;                                                        02766000
         A:=SPACE(5);                                                   02767000
         IF V.[CF] = 0 THEN                                             02768000
         BEGIN                                                          02769000
         STREAM(A); DS:=29 LIT"-*!PREVIOUS INPUT(S) LOST!-*~";          02770000
         END                                                            02771000
         ELSE                                                           02772000
         BEGIN                                                          02773000
         STREAM(V:=V.[CF]+1,A);                                         02774000
         BEGIN SI:=V;                                                   02775000
              DS:=17 LIT"-*!LINE STARTING "; DS:=LIT""";                02776000
              DS:=10 CHR;                                               02777000
              DS:=LIT"""; DS:=8 LIT " LOST!-*";                         02778000
         END;                                                           02779000
         FORGETAREA(M[V].[2:2],V);                                      02780000
         END;                                                           02781000
         TWXOUT(A,37,-0,V.[FF]);                                        02783000
         FORGETSPACE(A);                                                02784000
         KILL([RCW] INX NOT 2);                                         02785000
    END BUSY INTERRUPT HANDLER;                                         02786000
 ARRAY SPACER[*];                                                       03000000
 REAL BIGUNS;                                                           03001000
 DEFINE BIGUNMIN = 4#;                                                  03001100
 PROCEDURE MOREAREAS;                                                   03002000
         BEGIN REAL I,J;                                                03003000
              REAL RCW=+0;                                              03003100
              I~(J~GETSPACE(162,5,0)+1)+3 AND NOT 3;                    03004000
                                                                        03005000
              MOVE(162,J,J+1);                                          03006000
              J~I+159;                                                  03007000
              FOR I~I STEP 20 UNTIL J DO                                03008000
                   FORGETAREA(2,I);                                     03009000
                                                                        03010000
              AREARDY~TRUE;                                             03011000
                                                                        03012000
              KILL([RCW] INX NOT 2);                                    03013000
         END;                                                           03014000
 SAVE PROCEDURE FORGETAREA(N,T); VALUE N,T; REAL N,T;                   03015000
         BEGIN REAL R,S;                                                03016000
$ INCLUDE 03016011, IF CHECKLINK OR DEBUGGING;                          03016009
    REAL SP,MS,ME;                                                      03016010
              T~P(.T,LOD).[CF];                                         03016500
DO UNTIL T!0;                                                           03016600
              WHILE N!2 AND (S~M[R~(IF N THEN 10&T[1:46:1] ELSE         03017000
                   5&T[1:47:1]) +T]).[1:3]=N+4 DO                       03018000
              BEGIN M[S.[FF]].[CF]~S;                                   03019000
                   M[S].[FF]~S.[FF];                                    03021000
                   IF T>R THEN T~R;                                     03022000
                   N~N+1;                                               03023000
              END;                                                      03024000
              IF N=2 THEN BIGUNS~BIGUNS+1;                              03025000
              M[S~M[R~P(M[SPACER[N]],0&T[CTF],LLL,DEL).[FF]].[FF]]      03026000
                   .[CF]~T;                                             03026100
              M[M[T]~-R&S[CTF]&N[2:46:2]].[FF]~T;                       03027000
$ INCLUDE 03027141, IF CHECKLINK OR DEBUGGING;                          03027004
    IF CHECK THEN                                                       03027005
    FOR N:=0 STEP 1 UNTIL 2 DO                                          03027010
    BEGIN T:=R:=SPACER[N].[CF];                                         03027020
         SP:=S:=[SPACER[N]].[CF];                                       03027030
         MS:=M[0].[CF];                                                 03027040
         ME:=PRT.[CF];                                                  03027050
         DO BEGIN                                                       03027060
              IF M[R].[FF]!S THEN DO UNTIL FALSE;                       03027070
              IF R!SP THEN                                              03027080
              IF M[R].[2:2]!N OR M[R] GEQ 0 THEN DO UNTIL FALSE;        03027090
              S:=R;                                                     03027100
              IF (R:=M[R].[CF]) LEQ MS OR (R GEQ ME AND R!SP) THEN      03027110
                DO UNTIL FALSE;                                         03027120
         END UNTIL R=T;                                                 03027130
    END;                                                                03027140
         END;                                                           03028000
 SAVE REAL PROCEDURE GETAREA(N); VALUE N; REAL N;                       03029000
         BEGIN REAL T,I;                                                03030000
              I~N;                                                      03031000
              WHILE (T~SPACER[I]).[CF]=[SPACER[I]].[CF] DO              03032000
                   I~I+1;                                               03033000
              DO UNTIL I{2;                                             03033100
              M[(SPACER[I]:=T&M[T:=T.[FF]][FTF]).[FF]]              %R7703034000
                .[CF]:=[SPACER[I]];% USE LIL AREAS FRM END          %R7703035000
              M[T]:=0&N[2:46:2];%                                   %R7703036000
              IF I=2 THEN                                               03037000
              IF (BIGUNS:=BIGUNS-1) LSS BIGUNMIN THEN                   03038000
              IF AREARDY THEN                                           03039000
              BEGIN AREARDY~FALSE;                                      03040000
                   FORK(P(.MOREAREAS),0,-4,0,1);                        03041000
              END;                                                      03042000
              WHILE I!N DO                                              03043000
                   FORGETAREA(I~I-1,(IF I THEN 10 ELSE 5)+T);           03044000
              GETAREA~T;                                                03045000
         END;                                                           03046000
 DEFINE EVENT[EVENT1]=UV[EVENT1,14]#;                                   03047000
 SAVE PROCEDURE QUEVENT(T,MIX);                                         03048000
         VALUE T,MIX; REAL T,MIX;                                       03049000
         BEGIN M[EVENT[MIX].[FF]].[CF]~T;                               03050000
              EVENT[MIX].[FF]~T;                                        03051000
              M[T].[CF]~0;                                              03051100
         END;                                                           03052000
 PROCEDURE COMM1;  % DISK I/O COMMUNICATE                               03053000
         BEGIN REAL DA=-5,SZ=-6,F=-7,IO=-9,RES=-10;                     03054000
              ARRAY A=-8[*];                                            03055000
              REAL S,T;                                                 03056000
         M[T ~ GETAREA(0)].[FF] ~ RES;                                  03056500
         IF IO THEN                                                     03057000
         BEGIN IF NOT A.[2:1] THEN MAKEPRESENT([IO] INX 1);             03057100
              M[T+2] ~ M[S ~ M[A.[FF]].[CF]-2]&P(S, XCH)[2:2:1];        03057200
              M[T+3]~M[S+1]; P([M[S]],IOR); S~-(A INX F);               03057300
         END ELSE BEGIN S~GETSPACE(SZ,0,0)+2;                           03058000
              MOVE(SZ,A,S); M[T+2] ~ NABS(S);                           03058100
         END;                                                           03058200
         T:=[M[T+1]];                                                   03058500
         DISKIO(T,NOT 0 INX S,SZ&1[2:47:1],DA);                         03058600
              GO TO RETURN                                              03059000
         END;                                                           03060000
 PROCEDURE COMM2;  %  COMMAND LANGUAGE WAIT COMMUNICATE                 03061000
         BEGIN ARRAY A=-6[*];                                           03062000
              NAME CLK=-7,WT=-8;                                        03062100
              REAL T,S;                                                 03062200
              LABEL X;                                                  03062300
              S~A.[FF];                                                 03062400
              IF (T~A.[CF])!0 THEN                                      03063000
              BEGIN M[S].[CF]~0;                                        03063500
                   FORGETAREA(M[T].[2:2],T);                            03064000
              END;                                                      03064500
              WHILE EVENT[P1MIX].[CF]=0 DO                              03065000
              BEGIN IF NOT WT[0] THEN GO TO X;                          03065500
                   CLICK~CLOCK+P(RTR)+256;                              03065600
                   SLEEP([EVENT[P1MIX]],(NOT 0).[CF]);                  03066000
                   IF TERMSET(P1MIX) THEN GO TO RETURN;                 03066200
              END;                                                      03066500
              IF (T~(S~*(M[S]~(A&(T~EVENT[P1MIX])[CTC]) OR M))&T[FTF]). 03067000
                   [CF]=0 THEN T.[FF]~[EVENT[P1MIX]];                   03067100
              EVENT[P1MIX]~T;                                           03067200
              LOGLINE~S.[FF];                                           03067300
              WT[0]~1;                                                  03067400
         X:   CLK[0]~PROCTIME[P1MIX]+CLOCK+P(RTR);                      03067500
              GO TO RETURN                                              03068000
         END;                                                           03069000
 PROCEDURE LOGOUT; FORWARD;                                             03070000
$OMIT 03080301, IF DCP;                                                 03070999
 REAL PROCEDURE INPUTSCAN(MODE,SOURCE,DEST,NUM,FLAGS);                  03071000
      VALUE      NUM,FLAGS;                                             03072000
      REAL       MODE,SOURCE,DEST,NUM,FLAGS;                            03073000
         FORWARD;                                                       03074000
 REAL PROCEDURE OUTRAN980(ADR,NUM,TYPE,LCC,B);                          03075000
      VALUE     ADR,NUM,TYPE,LCC;                                       03076000
      REAL      ADR,NUM,TYPE,LCC,B;                                     03077000
         FORWARD;                                                       03078000
 PROCEDURE GIVEAWAY(A); VALUE A; REAL A; FORWARD;                       03079000
$OMIT  03080301,  IF TWXONLY;                                           03079990
 REAL PROCEDURE OUTRANBIDS(ADR,NUM,TYPE,B,C);                           03080000
     VALUE ADR,NUM,TYPE;  REAL ADR,NUM,TYPE,B,C;  FORWARD;              03080100
 REAL PROCEDURE OUTRANTC(ADR,NUM,TYPE,B,C);                             03080200
     VALUE ADR,NUM,TYPE;  REAL ADR,NUM,TYPE,B,C;  FORWARD;              03080300
$INCLUDE 03080801, IF DCP;                                              03080399
 REAL PROCEDURE OUTRAN(ADR,NUM,TYPE,B);                                 03080400
      VALUE ADR,NUM,TYPE;                                               03080500
      REAL  ADR,NUM,TYPE,B;                                             03080600
         FORWARD;                                                       03080700
 PROCEDURE GIVEAWAY(A,N);  VALUE A,N;  REAL A,N;  FORWARD;              03080800
 PROCEDURE MAKEPRESENT(A); VALUE A; REAL A; FORWARD;                    03099000
 PROCEDURE COMM9;                                                       03100000
         BEGIN REAL I=-5;                                               03101000
              REAL L=-7;                                                03102000
              REAL ARRAY A=-6[*];                                       03103000
              LOGLINE~L;                                                03104000
              I~GETSPACE((L~A.[8:10])+4,64,0)+4;                        03105000
              IF NOT A.[2:1] THEN MAKEPRESENT([L] INX 1);               03106000
              MOVE(L,A,I);                                              03107000
              CCARD(I&26[3:43:5]);                                      03108000
              GO TO RETURN;                                             03109000
         END;                                                           03110000
 PROCEDURE REPORTBACK(WHY,P1,P2);                                       03111000
         VALUE WHY,P1,P2;                                               03112000
         REAL WHY,P1,P2;                                                03113000
         BEGIN REAL T;                                                  03114000
              IF LOGLINE.[33:7]!0 THEN                                  03115000
              BEGIN M[T~GETAREA((P2>0)|2)].[FF]~LOGLINE;                03116000
                   M[T+1]~WHY;                                          03117000
                   M[T+2]~XCLOCK+P(RTR);                                03118000
                   M[T+3]~P1;                                           03119000
                   IF P2>0 THEN MOVE(10,P2,T+4) ELSE M[T+4]~P2;         03120000
                   QUEVENT(T,CANDEMIX[LOGLINE.[40:8]]);                 03121000
              END;                                                      03122000
         END;                                                           03123000
PROCEDURE OLDWIERDHAROLD; FORWARD;                                      03123900
PROCEDURE TWXOUT(ADR,NUM,TYPE,LL);                                      03124000
         VALUE ADR,NUM,TYPE,LL;                                         03125000
         REAL ADR,NUM,TYPE,LL;                                          03126000
         BEGIN LABEL START,EXIT;                                        03127000
$OMIT 03127201, IF DCP;                                                 03127098
$OMIT 03127101, IF TWXONLY;                                             03127099
              LABEL BYEBYE;                                             03127100
              REAL OOP;                                                 03127200
$INCLUDE 03127501, IF DCP;                                              03127499
              LABEL WRITEIT,AGAIN;                                      03127500
              REAL A,B,L,N,T,C,D;                                       03128000
         DEFINE TANKING=STATABLE[LL].OUTPUTANKING#;                     03128100
    SUBROUTINE RITE;                                                    03129000
         BEGIN DISKWAIT(A,30,GLOMSIZE|LL+((L+N) AND NOT GLOMSIZE)       03130000
                   +TANKADDRESS);                                       03131000
              N:=N+1;                                                   03131100
$INCLUDE 03131201, IF STATISTICS;                                       03131199
         COUNTUP(16,1);                                                 03131200
              M[A]:=0;                                                  03131500
         END;                                                           03132000
              IF (LL:=LL AND (-255)) LEQ 0 THEN                         03133200
              BEGIN B~SPACE(NUM.[39:6]+2);                              03133300
                   STREAM(N1~NUM.[36:6],N2~NUM,ADR,B);                  03133400
                   BEGIN SI~ADR; N1(DS~32 CHR; DS~32 CHR);              03133500
                        DS~N2 CHR; DS~LIT "~";                          03133600
                   END;                                                 03133700
                   SPOUT(B);                                            03133800
                   P(XIT);                                              03133900
              END;                                                      03134000
    START:    IF TERMSET(P1MIX) AND LL!ABS(SPOWORD) THEN GO TO RETURN;  03134100
              IF BREAK[LL] OR DISCONNECTING[LL] OR                      03134110
                NOT STATABLE[LL].DIALEDUP THEN P(XIT);                  03134120
              IF NUM GTR 200 THEN NUM:=200;  %PRESENT MAX OUTPUT        03134130
              IF LL LEQ LMAX THEN                                       03134140
              IF SCHEDLINE[LL] THEN                                     03134150
              BEGIN IF STATABLE[LL].DIALEDUP THEN                       03134200
                   SCHEDIO(NUM,TYPE,(ADR&LL[CTF]));                     03134250
                   P(XIT);                                              03134300
              END;                                                      03134400
              IF NOT REMOTE THEN P(XIT);                                03134500
              IF NOT(TANKS[LL]).[1:1] THEN                              03135000
                    SLEEP([TANKS[LL]],-0);                              03136000
              T:=TANKS[LL]:=ABS(*P(DUP));                               03136300
              A~T.[CF];                                                 03137000
              D:=T.[SOUSE];                                             03140000
              L:=T.TANKL+D;                                             03141000
$OMIT 03142001, IF DCP OR TWXONLY;                                      03141099
              IF STATABLE[LL].STATIONTYPE NEQ TWX THEN                  03141100
                 BEGIN D:=T.[14:5]-TNAOG[SEQARRAY[LL].[26:6]].[1:5];    03141200
                       D:=(IF D < 0 THEN GLOMSIZE ELSE 0)+D+T.[SOUSE]+N;03141300
                 END;                                                   03142000
              IF D+9 GEQ GLOMSIZE THEN                                  03142100
              BEGIN IF D+6 GEQ GLOMSIZE THEN                            03142200
                   IF NOT T.[10:1] THEN                                 03143000
                   BEGIN M[(B~GETAREA(0))+1]~10;                        03143100
                        M[B]~0&10[18:41:7]&LL[25:40:8];                 03143200
                        T:=TANKS[LL]:=T&1[10:47:1];                     03143300
                        QUEVENT(B,CANDEMIX[LINE]);                      03143400
                   END;                                                 03143500
                   IF P(0,RDS)>FENCE THEN                               03143600
                        BEGIN TANKS[LL]:=NABS(T)&1[11:47:1];            03144000
                             SWAP(WAITSWAP,1);                          03145000
                             GO TO START;                               03146000
                        END;                                            03147000
              IF D GEQ GLOMSIZE THEN                                    03148000
              BEGIN CLICK:=CLOCK+1023;  TANKS[LL]:=NABS(*P(DUP));       03148100
                   SLEEP([TANKS[LL]],0&(NOT T)[14:14:5]);               03148110
                   IF TANKS[LL].[14:19]=T.[14:19] THEN                  03148120
                   BEGIN  TANKS[LL]:=NABS(*P(DUP))&0[19:19:14];         03148130
$OMIT 03148141, IF TWXONLY OR DCP;                                      03148139
                          STATABLE[LL]:=(*P(DUP))&0[23:23:1];           03148140
                        P(XIT);                                         03148150
                   END;                                                 03148160
                   GO TO START;                                         03148200
              END;                                                      03148300
              END;                                                      03149000
%   AT THIS POINT DATA-COMM DROPPINGS COHERE TO FORM A MIGHTY EXTRUSION 03150000
$INCLUDE 03162501, IF DCP;                                              03150499
              IF (NUM:=OUTRAN(ADR,NUM,TYPE,B)).[2:1] THEN               03150500
                STATABLE[LL].DISCIT:=1;                                 03151000
%                                                                       03151010
%   DISCIT MEANS THAT THE STATION WILL BE LOGGED OFF AS SOON AS         03151020
%   THERE IS NO MORE OUTPUT.                                            03151030
%                                                                       03151040
%   OUTPUT IS WRITTEN DIRECTLY IF FEWER THAN 2 OUTPUT REQUESTS          03151050
%   ARE QUEUED TO THE DCP, OTHERWISE IT IS TANKED. ALL OUTPUT           03151060
%   TO NAKABLE STATIONS IS TANKED FOR POSSIBLE RETRY. OUTPUT            03151070
%   FROM CANDE OR THE MCP IS WRITTEN 1 MESSAGE/SEGMENT. OUTPUT          03151080
%   FROM OBJECT JOBS IS PACKED INTO AN ARRAY GOTTEN BY SELECTRUN,       03151090
%   232 CHARACTERS PER SEGMENT.                                         03151100
%                                                                       03151110
              IF NOT TANKING THEN                                       03151500
              BEGIN IF T.DCPMESSAGES LEQ 1 THEN                         03152000
                   IF NOT STATABLE[LL].ERRORS THEN                      03152100
                   BEGIN IF NOT AREARDY THEN SLEEP([TOGLE],AREARDYMASK);03152500
                        DCWRITE(B,LL,NUM,1);                            03153000
                        IF NAKSTA[LL] THEN ELSE GO EXIT;                03153500
                        TNAOG[LL]:=(*P(DUP))&(P(DUP).DETANK+1)[18:41:7];03153600
                        GO WRITEIT;                                     03153800
                   END;                                                 03154000
                   TANKING:=TRUE;                                       03154100
              END;                                                      03154200
              IF A=0 OR STATABLE[LL].SWAPPED THEN                       03154500
    WRITEIT:  BEGIN M[A:=B-1]:=NUM;                                     03155000
                   RITE;                                                03155500
              END ELSE                                                  03156000
              BEGIN                                                     03157000
                   C:=IF 232-(D:=M[A]) GTR NUM THEN NUM ELSE 232-D;     03157200
                   T:=B;                                                03157300
    AGAIN:         STREAM(T: N1:=D.[45:3], N3:=C,                       03157500
                          N2:=P(DUP).[40:2], DEST:=A+1+D.[39:6]);       03158000
                   BEGIN DI:=DI+N1; SI:=T;                              03158500
                        N2(DS:=32 CHR; DS:=32 CHR);                     03159000
                        DS:=N3 CHR;                                     03159500
                        T:=SI;                                          03159600
                   END;                                                 03160000
                   T:=P;                                                03160100
                   M[A]:=(*P(DUP))&(D:=D+C)[CTC];                       03160200
                   IF D=232 THEN                                        03160500
                   BEGIN RITE;                                          03161000
                        IF (C:=NUM-C) GTR 0 THEN                        03161500
                        BEGIN D:=0;                                     03161600
                             GO AGAIN;                                  03161700
                        END;                                            03161800
                   END;                                                 03162000
              END;                                                      03162500
$OMIT 03195901, IF DCP;                                                 03169998
$OMIT 03170701, IF TWXONLY;                                             03169999
              IF(D:=STATABLE[LL].STATIONTYPE) = TC500 THEN              03170000
                IF(NUM:=OUTRANTC(ADR,NUM,TYPE,B,C)) LSS 2 THEN          03170100
                  GO BYEBYE                                             03170200
              ELSE ELSE                                                 03170300
              IF D NEQ TWX THEN                                         03170400
                IF(NUM:=OUTRANBIDS(ADR,NUM,TYPE,B,C)) LSS 2 THEN        03170500
                   GO BYEBYE                                            03170600
              ELSE ELSE                                                 03170700
              NUM:=OUTRAN980(ADR,NUM,TYPE,LONGCARRIAGE[LL],B);          03170800
              IF NOT TANKING THEN                                       03178000
              IF (STATABLE[LL].[CF]=0                                   03179000
$OMIT  03179101,  IF TWXONLY;                                           03179090
                 AND D=TWX) OR (D!TWX AND NOT(SEQARRAY[LL].SELECTED)    03179100
              ) THEN                                                    03179900
              BEGIN IF NOT AREARDY THEN                                 03180000
                        SLEEP([TOGLE],AREARDYMASK);                     03180100
$INCLUDE 03180201, IF TWXONLY;                                          03180199
                   OOP:=DCWRITE(B,LL,NUM);                              03180200
$OMIT  03180301,  IF TWXONLY;                                           03180290
                   OOP:=DCWRITE(B,LL,NUM-(D!TWX));                      03180295
                   IF D=TWX THEN GO TO EXIT ELSE C.[47:1]:=1;           03180300
$INCLUDE  03180351, IF TWXONLY;                                         03180340
                   GO TO EXIT;                                          03180350
              END;                                                      03180400
              TANKING:=NOT(OOP);                                        03181000
              IF A=0 OR STATABLE[LL].SWAPPED THEN                       03182000
              BEGIN M[A~B-1]~NUM-1; RITE END ELSE                       03183000
              BEGIN IF (T:=M[A].[CF])+NUM GTR 232 THEN                  03184000
                   BEGIN                                                03185000
$OMIT  03185101,  IF TWXONLY;                                           03185090
                         M[A]:=ABS(*P(DUP));                            03185100
                         RITE;                                          03185500
                        T~M[A]~0;                                       03186000
                   END;                                                 03187000
                   STREAM(N1:=T.[45:3],B,N3:=NUM,N2:=P(DUP).[40:2],     03188000
$OMIT  03188401,  IF TWXONLY;                                           03188390
                          X:=D:=(M[A].[1:1] AND C.[2:1]),               03188400
                          A:=T.[39:6]+A+1);                             03188500
                        BEGIN DI:=DI+N1;  SI:=B;                        03189000
$OMIT  03190001,  IF TWXONLY;                                           03189090
                              X(SI:=SI+1; DI:=DI-1);                    03190000
                              N2(DS:=32 CHR; DS:=32 CHR);               03191000
                              DS:=N3 CHR;                               03192000
                        END STREAM;                                     03193000
$INCLUDE  03193501,  IF TWXONLY;                                        03193490
                   M[A]:=T+NUM-1;                                       03193500
$OMIT  03194501,  IF TWXONLY;                                           03193990
                   M[A]:=T+NUM-1-D-D;                                   03194000
                   IF C OR (C.[45:1] AND M[A].[CF] NEQ 0)  THEN         03194100
                   BEGIN RITE;                                          03194200
                        M[A]:=0;                                        03194400
                   END ELSE M[A]:=(*P(DUP))&C[1:1:1];                   03194500
              END;                                                      03195000
$OMIT  03195901,  IF TWXONLY;                                           03195090
    BYEBYE:   IF C.[45:1] THEN   %WE R GION DISCONECT U                 03195100
              BEGIN   IF A=0 OR STATABLE[LL].SWAPPED THEN A:=B-1;       03195150
                   STATABLE[LL].[16:1]:=0;                              03195200
                   STREAM(A:=A+1); DS:=2 LIT LEFTARROW;                 03195300
                   M[A]:=1;   RITE;                                     03195400
                   TANKING:=TRUE;                                       03195500
                   IF STATABLE[LL].STATIONTYPE THEN                     03195600
                      TNAOG[SEQARRAY[LL].[26:6]]:=(*P(DUP))&1[42:42:6]; 03195700
              END;                                                      03195900
    EXIT:     FORGETSPACE(B-1);                                         03196000
$INCLUDE 03196501, IF DCP;                                              03196499
              TANKS[LL]:=NABS(*P(DUP))&(P(DUP).[SOUSE]+N)[19:41:7];     03196500
$OMIT 03197001, IF DCP;                                                 03196999
              TANKS[LL]:=NABS(*P(DUP))&(P(DUP).[SOUSE]+N-OOP)[27:42:6]; 03197000
         END TWXOUT;                                                    03198000
 PROCEDURE CLEARTANK(LL,MCP);                                           03200000
         VALUE LL,MCP; REAL LL,MCP;                                     03201000
         BEGIN REAL T;                                                  03202000
$OMIT 03202801, IF DCP;                                                 03202599
              IF (LL:=LL.[40:8]) LEQ LMAX THEN                          03202600
              IF LL=0 OR SCHEDLINE[LL] THEN P(XIT);                     03202700
$OMIT 03202801, IF TWXONLY;                                             03202799
              IF STATABLE[LL].STATIONTYPE=TWX THEN                      03202800
$INCLUDE 03203001, IF DCP;                                              03202899
              IF (LL:=LL.[40:8])=0 OR SCHEDLINE[LL] THEN P(XIT);        03202900
              IF NOT NAKSTA[LL] THEN                                    03203000
              IF MCP THEN                                               03203100
              IF TANKS[LL].[SOUSE] = 0 THEN                             03203200
              BEGIN T:=TWO(CLOCK.[40:2]|6)|"~";                         03203300
                   TWXOUT([T].[CF],8,1&3[1:46:2],LL);                   03203500
              END;                                                      03203600
              IF NOT TANKS[LL].[1:1] THEN                               03203900
                   SLEEP([TANKS[LL]],-0);                               03204000
              T:=TANKS[LL]:=ABS(*P(DUP));                               03205000
              IF T.[CF]!0 THEN                                          03206000
              IF M[T]!0 THEN                                            03207000
              BEGIN                                                     03207500
$OMIT 03207601, IF TWXONLY OR DCP;                                      03207599
                   M[T]:=ABS(*P(DUP));                                  03207600
                   DISKWAIT(T.[CF],30,GLOMSIZE|LL+((T.TANKL+T.TANKN)    03208000
                        AND NOT GLOMSIZE)+TANKADDRESS);                 03209000
$INCLUDE 03209101, IF STATISTICS;                                       03209099
              COUNTUP(16,1);                                            03209100
                   M[T]:=0;                                             03210000
$OMIT 03210101, IF DCP;                                                 03210099
                   STATABLE[LL].OUTPUTANKING:=1;                        03210100
                   T:=1;                                                03210200
              END ELSE T:=0;                                            03211000
              TANKS[LL]:=NABS(*P(DUP))&(P(DUP).[SOUSE]+T)[TANKNDIAL];   03212000
         END;                                                           03213000
$OMIT 03241901, IF DCP;                                                 03216999
REAL PROCEDURE DCWRITE(ADR,LINE,SIZE);                                  03217000
  VALUE ADR, LINE, SIZE;                                                03217100
  REAL  ADR, LINE, SIZE;                                                03217200
  BEGIN                                                                 03217300
    REAL BUF=NT1,NR=NT2,A=NT3,D=NT4,DISC=NT5,CCNT=NT6,LTIN=NT7,LBUF,ABC;03217400
$OMIT  03217601,  IF TWXONLY;                                           03217490
    REAL STYP,T,TN,PM,PC,LM,LC,TEXTMD,LFC,NFC=NT7,S=PM;                 03217500
    LABEL LINKEMIN,GNC,PNC,DOTC,POP,POL,SEND;                           03217600
    LABEL IGNOREOUTPUT,GETANUTHERBUF;                                   03217700
    IF PAPERTAPE[LINE] OR                                               03217800
        NOT STATABLE[LINE].DIALEDUP THEN GO IGNOREOUTPUT;               03217820
    BUF:=((LTIN:=LINETABLE[IF LINE GTR LMAX THEN STATABLE[LINE].LEENKER 03217900
          ELSE LINE]).[6:3] + 1).[45:2];                                03218000
    IF SIZE=1 THEN BUF:=0;                                              03218100
    BUF:=BUF&((P(DUP) OR P(DUP).[46:1]) | 28 + 28)[CTF];                03218200
$OMIT  03218701,  IF TWXONLY;                                           03218290
    IF (STYP:=STATABLE[LINE].STATIONTYPE) NEQ TWX THEN                  03218300
      BEGIN                                                             03218400
      TN:=TNAOG[(T:=TANKS[LINE]&(S:=SEQARRAY[LINE])[42:26:6]).[42:6]];  03218500
      CCNT:=T.[19:8];                                                   03218600
      END ELSE                                                          03218700
    CCNT:=0;    DISC:=1;                                                03218800
    DO                                                                  03218900
    BEGIN                                                               03219000
 GETANUTHERBUF:    IF DISC GTR 2 THEN BUF:=0&28[CTF];                   03219050
      D:=(A:=GETAREA(BUF.[CF]))+1;                                      03219100
      IF(NR:=ABC:=BUF.[FF]) GTR SIZE THEN NR:=SIZE;                     03219200
$OMIT  03219401,  IF TWXONLY;                                           03219290
      IF STYP = TWX THEN   %SPITWX IT OUT                               03219300
        BEGIN;                                                          03219400
          STREAM(A1:=ADR:X:=NR,NR:=P(DUP).[41:1],                       03219500
                 BUNGIT:=(NR LSS ABC),D);                               03219550
           BEGIN  SI:=A1;  NR(DS:=32 CHR; DS:=32 CHR);                  03219600
                  DS:=X CHR;    A1:=SI;                                 03219700
                  BUNGIT(DS:=LIT LEFTARROW);                            03219750
           END STREAM;                                                  03219800
          ADR:=P;                                                       03219900
$OMIT  03239901,  IF TWXONLY;                                           03219949
          GO LINKEMIN;                                                  03219950
        END ELSE NR:=0;                                                 03220000
          IF DISC=7 THEN GO POP;                                        03220100
          IF SIZE = 1 THEN                                              03220200
            BEGIN;                                                      03220300
              STREAM(DISC:=0:ADR,HBIT:=T.[12:1],                        03220400
                     EOTBIT:=(P(DUP)=0) AND (DISC LSS 29),D);           03220450
               BEGIN  SI:=ADR;  IF SC=LEFTARROW THEN                    03220500
                      SI:=SI+1;  IF SC=LEFTARROW THEN                   03220600
                      BEGIN TALLY:=28;                                  03220700
                           EOTBIT(DS:=LIT "$"; TALLY:=29);              03220750
                           HBIT(DS:=LIT "#"; TALLY:=5);                 03220800
                           DS:=LIT LEFTARROW;                           03220900
                      END;                                              03221000
                      DISC:=TALLY;                                      03221100
               END STREAM;                                              03221200
            IF(DISC:=P) GTR 0 THEN                                      03221300
               BEGIN T.[12:1]:=FALSE;                                   03221350
                     GO LINKEMIN;                                       03221400
            END END;                                                    03221500
          IF DISC = 3 THEN                                              03221600
            BEGIN;                                                      03221700
              STREAM(D);                                                03221800
                    DS:=2 LIT "#~";                                     03222000
              DISC:=2;                                                  03222100
              GO LINKEMIN;                                              03222200
            END;                                                        03222300
          IF NOT T.[12:1] THEN    %TIME TOO                             03222400
            BEGIN;                %GET A-HEAD                           03222500
              STREAM(TN:=TN.[38:10],BOP:=(TEXTMD:=                      03222600
                        (TN.[28:8] OR TN.[42:6])=0):                    03222620
                     STAD:=S,C1:=P(DUP).[24:1],C2:=S.[25:1],            03222700
                     C3:=(P(DUP)!S.[24:1]),                             03222750
                     MFH:=(LTIN.LINEDIS=MULTI),                         03222800
                     EOL:=(TN.[28:8]+1=TN.[20:8]),                      03222850
                     ERAS:=T.[13:1] AND NOT TEXTMD,                     03222900
                     TC:=(STYP=TC500),                                  03223000
                     TXT:=TEXTMD:=(STATABLE[LINE].[23:1]),D,            03223200
                     SEL:=(LM:=GETAREA(0))+1);                          03223250
               BEGIN                                                    03223300
                 MFH(SI:=LOC STAD;  SI:=SI+2;                           03223400
                    DS:=LIT "$"; C1(DS:=LIT "!"); DS:=CHR;              03223500
                    C2(DS:=LIT "!"); DS:=CHR; C3(DS:=LIT "!");          03223600
                    DS:=LIT "Q");          % SELECT MULTI               03223700
                    DS:=2 LIT "%~";  DI:=D;        % OR CONTENTION      03223800
                 MFH(SI:=LOC STAD; SI:=SI+2;                            03223900
                     DS:=LIT "}"; C1(DS:=LIT "!"); DS:=CHR;             03224000
                     C2(DS:=LIT "!"); DS:=CHR;                          03224100
                     C3(TC(JUMP OUT 2 TO ITN); DS:=LIT "!");            03224200
 ITN:                TC(SI:=LOC TN; DS:=3 DEC;                          03224300
                        IF TOGGLE THEN TALLY:=0 ELSE TALLY:=1;          03224400
                        TN:=TALLY; DS:=LIT "!"));                       03224500
                 DS:=LIT """;                                           03224600
                 TC(JUMP OUT TO PYLON);                                 03224800
                 ERAS(DS:=3 LIT "1  ");                                 03224900
                 BOP(DS:=LIT"-"; JUMP OUT TO NEWPG);                    03225000
                 DS:=3 LIT "(  ";                                       03225050
                 EOL(DS:=3 LIT "3  ");                                  03225060
 NEWPG:          TXT(DS:=LIT "!");                                      03225100
 PYLON:          BOP:=DI;                                               03225200
               END HEADING STREAM;                                      03225300
                D:=P;  PM:=P;                                           03225400
              IF STYP=TC500 THEN %UP TRANSMISSION NUMBER                03225500
                TNAOG[T.[42:6]]:=(*P(DUP))&(IF PM THEN 1 ELSE           03225600
                                  P(DUP).[38:10]+1)[38:38:10];          03225700
              T:=T&2[12:46:2];                                          03225800
              M[LM]:=(*P(DUP))&LINE[10:40:8]&2[5:43:5];                 03225900
              ABC:=ABC-(D.[30:3]&(D-A-1)[30:33:15]);                    03226000
              LBUF:=LM&LM[CTF];                                         03226100
            END;                          %HEADINGOUT FOR RETAILNG      03226200
           IF STYP NEQ TC500 THEN   %BID FOR CONRAC                     03226300
             BEGIN                                                      03226400
               NR:=0;                                                   03226450
               IF(PM:=TN.[14:6])=0 THEN GO DOTC; %MAX LINES/PAGE        03226500
               IF(LM:=TN.[20:8])=0 THEN GO DOTC; %MAX CHAR/LINE         03226600
               IF(PC:=TN.[42:6]) GEQ PM THEN GO POP; %LINES/PAGE        03226700
               IF(LC:=TN.[28:8]) GEQ LM THEN GO POL; %CHAR/LINE         03226800
               IF DISCONNECTING[LINE] THEN PC:=1;                       03227000
 GNC:          IF CCNT + NR GEQ SIZE THEN GO SEND;                      03227100
               IF TEXTMD THEN                                           03227200
               BEGIN                                                    03227300
                 STREAM(NC:=0,A1:=ADR,                                  03227400
                        MC:=(IF LM-LC LEQ ABC-NR THEN LM-LC ELSE ABC-NR)03227500
                             -1,                                        03227550
                        MW:=P(DUP).[41:1] | 2,FCT:=LFC,D1:=D:);         03227600
                 BEGIN  DI:=D1;  SI:=A1;                                03227650
                        FCT(IF SC="!" THEN JUMP OUT TO LASTC);          03227700
                        TALLY:=0; FCT:=TALLY;                           03227800
                        MW(32(IF SC="!" THEN                            03227900
                           BEGIN MC:=TALLY; TALLY:=0; MW:=TALLY;        03228000
                                 JUMP OUT 2 TO LASTC;                   03228100
                           END ELSE DS:=CHR; TALLY:=TALLY+1));          03228200
                        MC(IF SC="!" THEN JUMP OUT ELSE                 03228300
                           DS:=CHR; TALLY:=TALLY+1);                    03228400
                        MC:=TALLY;                                      03228500
 LASTC:                 D1:=DI;  DI:=LOC NC;  DI:=DI+7;                 03228550
                        DS:=CHR;  A1:=SI;                               03228600
                 END STREAM;                                            03228650
                 D:=P;  IF(LFC:=P) THEN P(DEL,DEL)                      03228700
                    ELSE NR:=P(32,|,+,DUP,LC,+,.LC,STD,NR,+);           03228750
               END ELSE                                                 03228800
               STREAM(NC:=0,A1:=ADR:);                                  03228900
                BEGIN  SI:=A1;  DI:=LOC NC;                             03229000
                       DI:=DI+7;  DS:=CHR;  A1:=SI;                     03229100
                END STREAM;                                             03229200
               ADR:=P;                                                  03229300
               IF (NFC:=P) = 31 THEN GO SEND;   %GROUP MARK             03229400
               IF TEXTMD THEN                                           03229500
                 BEGIN                                                  03229600
                   IF NFC=60 THEN TEXTMD:=FALSE;  %CHANGE MODE          03229700
                   GO PNC;                                              03229800
                 END ELSE                                               03229900
               IF(NFC=43 OR NFC=44) THEN    %LF OR CRLF                 03230000
                  IF DISCONNECTING[LINE]  THEN                          03230100
                     BEGIN IF NFC=43 THEN NFC:=48; GO PNC END           03230200
                    ELSE BEGIN IF NFC=44 THEN LC:=0;                    03230700
                               PC:=PC+1;                                03230800
                         END                                            03230900
                 ELSE IF NFC=60 THEN TEXTMD:=TRUE %CHANGE MODE          03231000
                 ELSE IF(NFC=4 OR NFC=58)THEN LC:=PC:=0 %HOMER          03231100
                 ELSE IF NFC=29 THEN LC:=LC-1   %BACKSPACE              03231200
                 ELSE IF NFC=3 THEN PC:=PC-1    %REV LF                 03231300
                 ELSE IF NFC=2 THEN LC:=LC+1;   %NON DES SPACE          03231400
 PNC:            STREAM(NC:=NFC:D);                                     03231500
                  BEGIN  SI:=LOC NC;  SI:=SI+7;                         03231600
                         DS:=CHR;  NC:=DI;                              03231700
                  END STREAM;                                           03231800
                 D:=P;                                                  03231900
                 IF NFC=60 THEN LC:=LC+LFC                              03232000
                         ELSE LC:=LC+TEXTMD;                            03232100
                 NR:=NR+1;                                              03232200
                 IF LC GEQ LM OR PC GEQ PM THEN                         03232300
                   BEGIN  %THERE IS A LINE FULLOFIT                     03232400
                   IF DISCONNECTING[LINE] THEN PC:=1;                   03232500
                     IF(PC:=PC+1)                                       03232600
                            GEQ PM THEN   %ND A PAGE                    03232700
                       BEGIN PC:=PM;      %FULLSOFIT                    03232800
                         IF NR=ABC THEN GO LINKEMIN                     03232900
                             ELSE                                       03233000
 POP:                       BEGIN;  %STUFF A BUFF IE.(ETXIT)            03233100
                           STREAM(F1:=(ABC-NR GEQ (TEXTMD+5)):          03233200
                                  F2:=TEXTMD,                           03233300
                                  F4:=(PC GEQ PM),D);                   03233400
                            BEGIN  TALLY:=7;                            03233450
                                   F1( F2(DS:=LIT "!");                 03233500
                                       F4(DS:=3 LIT "4  ";              03233600
                                          JUMP OUT TO NEWPG);           03233700
                                       DS:=3 LIT "1  ";                 03233800
 NEWPG:                                DS:=LIT "#"; TALLY:=2);          03233900
                                   DS:=LIT LEFTARROW; F1:=TALLY;        03234000
                            END STREAM;                                 03234100
                           IF(DISC:=P)=2 THEN     %STUFFED AND BUFFED   03234200
                            IF LC GEQ LM THEN                           03234300
                           BEGIN; STREAM(A1:=ADR,FRY:=TEXTMD:);         03234400
                            BEGIN SI:=A1; TALLY:=1;                     03234500
                              IF SC=LEFTARROW THEN                      03234600
 FIRE:                        BEGIN A1:=TALLY; TALLY:=0; FRY:=TALLY END;03234700
                               FRY(IF SC="!" THEN                       03234800
                               BEGIN SI:=SI+1; TALLY:=2;                03234900
                                 IF SC=LEFTARROW THEN JUMP OUT TO FIRE  03235000
                                 ELSE                                   03235100
 PAN:                            IF SC="!" THEN                         03235200
                                 BEGIN TALLY:=1; FRY(TALLY:=0);         03235300
                                       FRY:=TALLY; SI:=SI+1;            03235400
                                       GO TO PAN;                       03235500
                                 END   ELSE TALLY:=1;                   03235600
                               END ELSE BEGIN TALLY:=0; FRY:=TALLY END; 03235700
                               A1:=TALLY; TALLY:=1;                     03235800
                               FRY(TALLY:=0);                           03235900
                               FRY:=TALLY);                             03236000
                            END STREAM;                                 03236100
                            TEXTMD:=P;                                  03236200
                            CCNT:=CCNT+P;                               03236300
                           END ELSE IF(SIZE-NR-CCNT) LEQ 3 THEN         03236400
                                    CCNT:=SIZE-NR;                      03236500
                           GO LINKEMIN;                                 03236800
                       END END ELSE  %PAGE NOT FULL                     03236900
 POL:                  LC:=LC-LM;                                       03237200
                   END;                                                 03237300
                 LFC:=(IF LFC THEN 0 ELSE (NFC=60));                    03237400
                 IF NR LSS ABC THEN GO GNC                              03237500
                   ELSE IF CCNT+NR GEQ SIZE AND NFC=60 THEN             03237600
                          DISC:=7;    GO LINKEMIN;                      03237650
 SEND:           CCNT:=SIZE-NR;                                         03237700
                 IF T.[SOUSE] GTR 1 THEN                                03237800
                     BEGIN; STREAM(D); DS:=LIT LEFTARROW;               03237900
                    END ELSE                                            03238000
                     GO POP;                                            03238100
             END ELSE    %TC500                                         03238300
 DOTC:       BEGIN IF(NR:=ABC) GTR SIZE-CCNT THEN NR:=SIZE-CCNT;        03238400
             STREAM(DISC:=1,A1:=ADR:                                    03238500
                    X:=NR,NR:=P(DUP).[41:1],                            03238600
                    LASTB:=((CCNT+NR) GEQ SIZE),                        03238700
                    BUNGIT:=(ABC-1 GTR NR),                             03238750
                    CRAMIT:=(ABC GTR NR),D);                            03238800
              BEGIN SI:=A1;                                             03238850
                    NR(DS:=32 CHR; DS:=32 CHR);                         03238900
                    DS:=X CHR;                                          03239000
                    LASTB(TALLY:=3;                                     03239100
                          CRAMIT(DS:=LIT "#";                           03239200
                          BUNGIT(DS:=LIT LEFTARROW); TALLY:=2);         03239300
                          DISC:=TALLY);                                 03239400
                    A1:=SI;                                             03239450
              END STREAM;                                               03239500
             ADR:=P;  DISC:=P;                                          03239600
             END TC500;                                                 03239700
 LINKEMIN::                                                             03239900
      M[A]:=(*P(DUP))&LINE[10:40:8]&LBUF[CTF];                          03240000
      IF LBUF NEQ 0 THEN M[LBUF]:=(*P(DUP))&A[CTC]                      03240100
        ELSE LBUF.[FF]:=A;                                              03240200
      CCNT:=CCNT+NR;                                                    03240250
      LBUF.[CF]:=A;                                                     03240300
$OMIT  03240401,  IF TWXONLY;                                           03240335
      IF STYP THEN                                                      03240340
        TN:=TN&LC[28:40:8]&PC[42:42:6];                                 03240360
      IF DISC GEQ 12 THEN M[LBUF]:=(*P(DUP))&DISC[7:43:3];              03240380
      IF(DISC GEQ 3 AND DISC) THEN GO GETANUTHERBUF;                    03240400
    END UNTIL CCNT GEQ SIZE OR DISC GTR 1;                              03240600
    M[LBUF]:=(*P(DUP))&DISC[4:47:1];                                    03240650
$OMIT  03241601,  IF TWXONLY;                                           03240690
    IF STYP NEQ TWX THEN                                                03240700
    BEGIN                                                               03240800
      IF CCNT LSS SIZE THEN                                             03240900
        T:=T&CCNT[19:40:8]                                              03241000
        ELSE                                                            03241100
        T:=T&(T.[SOUSE]-(P(DUP)!0))[19:34:14]&                          03241200
           (T.[14:5]+1)[14:43:5];                                       03241300
       IF M[LBUF.[FF]].[5:5]=2 THEN SEQARRAY[LINE]:=NABS(*P(DUP));      03241350
      TANKS[LINE]:=(*P(DUP))&T[13:13:20]&                               03241400
                   DISC[12:47:1];                                       03241500
      IF STYP THEN                                                      03241530
         BEGIN TNAOG[T.[42:6]]:=(*P(DUP))&LC[28:40:8]&PC[42:42:6];      03241540
               STATABLE[LINE]:=(*P(DUP))&TEXTMD[23:47:1];               03241550
         END;                                                           03241560
    END;                                                                03241600
    ENTERLINEQ(LBUF.[FF],LINE,0);                                       03241700
 IGNOREOUTPUT:                                                          03241800
$INCLUDE  03241841,  IF TWXONLY;                                        03241830
    DCWRITE:=0;                                                         03241840
$OMIT  03241871,  IF TWXONLY;                                           03241860
    DCWRITE:=TANKS[LINE].[19:14]=0 AND STYP!TWX;                        03241870
END DCWRITING;                                                          03241900
PROCEDURE SPOSET(TYPE,BUFH); VALUE TYPE,BUFH; REAL TYPE,BUFH; FORWARD;  03245900
PROCEDURE QUITTER(LINE);                                                03246000
VALUE LINE;  REAL LINE;                                                 03246050
BEGIN REAL RCW=+0;                                                      03246100
    REAL MIX,T,I,STA,S;                                                 03246120
    ARRAY A[*];                                                         03246140
    LABEL EXIT,BSB,NRDONE;                                              03246160
$INCLUDE 03247041, IF DCP;                                              03246179
    REAL LSTAT,J=A;                                                     03246180
    LABEL DD,AGAIN;                                                     03246200
    DEFINE LSTATUS[LSTATUS1] = LSTAT.[45:3]#,                           03246220
           BROKEN            = 2#,                                      03246240
           DISCON            = 6#;                                      03246260
%                                                                       03246280
    SUBROUTINE SETUPREQUEST;                                            03246300
    BEGIN IF T!0 THEN DCPQ(T);                                          03246320
         M[T:=GETAREA(0)]:=0&1[5:47:1];                                 03246340
    END;                                                                03246360
%                                                                       03246370
%   THE PARAMETER LINE IS USED BY QUITTER AS FOLLOWS:                   03246372
%     1:1 = 0 THEN 40:8 IS THE STATION NUMBER AND 33:7 IS THE           03246374
%             TYPE AS FOLLOWS: 2 = BROKEN, 3 = WRU,                     03246376
%             6 = NORMAL LOG-OFF, 14 = LOGOFF OF INVALID STA.           03246378
%     1:1 = 1 THEN 24:8 IS THE NUMBER OF A LINE TO BE DISCONNECTED.     03246380
%             QUITTER LOOPS LOGGING OFF ALL STATIONS ON THE LINE.       03246382
%   TO LOG OFF A STATION, WE DO A RECALLSTATION, QUEUE AN EVENT         03246384
%   TO CANDE, THEN MARK THE TANK WITH A BYE. AFTER THE RECALL IS        03246386
%   COMPLETE (BIT 22:1 OF STATABLE IS TURNED ON), WE DELINK THE         03246388
%   STATION FROM STATABLE AND RESET IT FOR THE NEXT USER.               03246390
%                                                                       03246392
    IF LINE LSS 0 THEN                % DISCONNECT ALL STATIONS.        03246400
    BEGIN STREAM(S:=(LINETABLE+LINE.[24:6])&LINE[30:30:2], D:=[STA]);   03246420
         BEGIN SI:=S; DI:=DI+6; DS:=2 CHR END;                          03246440
$VOID                                                                   03246450
         IF STA=0 THEN                                                  03246460
         BEGIN SETUPREQUEST;                                            03246480
              M[T+1]:=0&DISCONNECT[1:41:7]&LINE[24:24:8];               03246490
              SETUPREQUEST;                                             03246500
              M[T+1]:=0&LOOKFORRING[1:41:7]&LINE[24:24:8];              03246520
              DCPQ(T);                                                  03246540
              GO TO EXIT;                                               03246560
         END;                                                           03246580
         LSTAT:=DISCON;                                                 03246590
    END ELSE                                                            03246600
    BEGIN LSTAT:=LINE.[33:7];                                           03246620
         STA:=LINE.[40:8];                                              03246640
    END;                                                                03246660
AGAIN:                                                                  03246680
    IF (S:=STATABLE[STA]).[17:1] THEN GO TO EXIT;                       03246700
    STATABLE[STA]:=S&1[17:47:1];                                        03246720
    IF LSTAT=DISCON THEN                                                03246740
$VOID                                                                   03246750
    BEGIN IF S.ERRORS THEN SLEEP([STATABLE[STA]],0&1[19:47:1]);         03246760
         M[(T:=GETAREA(0))+1]:=0&S[24:24:16]&RECALLSTATION[1:41:7];     03246780
         DCPQ(T);                                                       03246800
    END;                                                                03246820
    IF CANDYINX!0 AND (STA!ABS(SPOWORD) OR LSTAT=DISCON) THEN           03246840
    BEGIN M[T:=GETAREA(0)]:=0&(STA&LSTAT[37:45:3])[CTF];                03246860
         QUEVENT(T,CANDYINX);                                           03246880
         IF LSTAT=DISCON THEN                                           03246900
         BEGIN M[T:=GETAREA(0)]:=0&STA[10:40:8];                        03246920
              M[T+1]:=3;                                                03246940
              M[T+2]:=0&1[35:47:1];                                     03246960
              STREAM(T:=T+3); DS:=3 LIT"BYE";                           03246980
              GIVEAWAY(T,4);                                            03247000
    END  END;                                                           03247020
    MIX:=STATABLE[STA].MIXNR;                                           03247040
$OMIT 03253801, IF DCP;                                                 03247049
    STA~LINE.[FF];                                                      03247050
    LINE~LINE.[CF];                                                     03247200
    IF (S~STATABLE[STA]).[17:1] THEN GO TO EXIT;                        03247350
    %SET QUITN - QUITTER INTERLOCK                                      03247500
    S~S&1[17:47:1];                                                     03247650
    IF (I~S.[CF])!0 THEN                                                03247800
    BEGIN %THROWAWAY THE LINE QUEUE                                     03247950
         DO FORGETAREA((T~M[I]).[2:2],I)                                03248100
         UNTIL (I~T.[CF])=0;                                            03248250
         S~S&0[CTC];                                                    03248400
    END;                                                                03248550
    IF (I:=LINETABLE[LINE]).[CF] ! 0 THEN                               03248700
    BEGIN %THROWAWAY INPUT QUEUE                                        03248850
         LINETABLE[LINE]:=I&0[CTC];                                     03249000
         DO FORGETAREA((T:=M[I]).[2:2],I)                               03249150
         UNTIL (I:=T.[FF])=0;                                           03249300
    END;                                                                03249450
    M[T:=GETAREA(0)]:=(*P(DUP))&STA[10:40:8]&1[4:47:1];                 03249500
    GIVEAWAY(T); %QUEUE INPUTANK DELETE                                 03249550
    IF (I:=LINETABLE[LINE]).[21:5] = DISCON THEN                        03249600
    IF CANDEMIX[STA] = 0 THEN ELSE                                      03249750
    BEGIN                                                               03249900
         M[T~GETAREA(0)]~(*P(DUP))&STA[10:40:8]&3[5:46:2];              03250050
         STREAM(                                                        03250200
$OMIT 03250355, IF TWXONLY;                                             03250345
         A:=I.LINEDIS!TWX,                                              03250350
         T:=T+1);                                                       03250500
         BEGIN %QUEUE A BYE TO CANDE                                    03250650
$OMIT 03250805, IF TWXONLY;                                             03250795
              A(DS:=LIT""";DS:=LIT"!");                                 03250800
              DS:=3 LIT "BYE";                                          03250950
$OMIT 03251105, IF TWXONLY;                                             03251095
              A(DS:=2 LIT "!#");                                        03251100
              DS:=LIT "~";                                              03251250
         END;                                                           03251400
         GIVEAWAY(T);                                                   03251550
    END ELSE                                                            03251700
$OMIT 03251855, IF TWXONLY;                                             03251845
    IF (I:=I.LINEDIS) ! MULTI THEN                                      03251850
    BEGIN                                                               03252000
         S:=S&(T:=GETAREA(0))[CTC];                                     03252150
$OMIT 03252455, IF TWXONLY;                                             03252295
         IF I = TWX THEN                                                03252300
         BEGIN %SEND OUT CARR. RET AND LINE FEED                        03252450
              STREAM(T:=T+1); DS:=4 LIT "{<!~";                         03252600
              M[T].[4:1]:=STA ! ABS(SPOWORD);                           03252750
$OMIT 03253505, IF TWXONLY;                                             03252895
         END ELSE                                                       03252900
         BEGIN  % CONTENTION SEND OUT EOT                               03253050
              STREAM(T:=T+1); DS:=2 LIT "$~";                           03253200
              M[T].[5:5]:=POLLING;                                      03253350
         END;                                                           03253500
    END;                                                                03253650
    MIX~(STATABLE[STA]~S).MIXNR;                                        03253800
    IF DAT[MIX].NDSABLE OR (T:=LSTATUS[LINE]=BROKEN) THEN               03253950
    BEGIN                                                               03254100
         IF CANDEMIX[STA]!MIX AND MIX!0 THEN                            03254250
         BEGIN BREAK[STA]:=1;                                           03254300
              IF TANKFUL[STA] OR INPUTANK[STA].INPUTREADY THEN          03254400
              BRINGBACK(MIX);                                           03254550
              IF T THEN                                                 03254700
              BEGIN                                                     03254850
                   IF NOT INPUTANK[STA].[1:1] THEN                      03255000
                     SLEEP([INPUTANK[STA]],-0);                         03255050
                   INPUTANK[STA]:=(*P(DUP))&0[10:40:8]&0[40:40:8];      03255150
              END ELSE                                                  03255200
              IF PAPERTAPE[STA] THEN    % QUEUE QUEST MARK              03255300
              BEGIN M[T:=GETAREA(0)]:=(*P(DUP))&STA[10:40:8]            03255450
$OMIT 03257101, IF DCP;                                                 03255599
                   &1[5:47:1];                                          03255600
                   STREAM(                                              03255750
$OMIT 03255905, IF TWXONLY;                                             03255895
                   A:=LINEDISC[LINE]!TWX,                               03255900
                   T:=T+1);                                             03256050
                   BEGIN                                                03256200
$OMIT 03256355, IF TWXONLY;                                             03256345
                        A(DS:=LIT""";DS:=LIT"!");                       03256350
                        DS:=LIT MARK;                                   03256500
$OMIT 03256655, IF TWXONLY;                                             03256645
                        A(DS:=2 LIT "!#");                              03256650
                        DS:=LIT "~";                                    03256800
                   END;                                                 03256950
                   GIVEAWAY(T);                                         03257100
$INCLUDE 03257181, IF DCP;                                              03257119
                        ;                                               03257120
                        M[T+1]:=1;  M[T+2]:=0&1[35:47:1];               03257140
                        STREAM(T:=T+3); DS:=LIT MARK;                   03257160
                        GIVEAWAY(T,4);                                  03257180
              END;                                                      03257250
         END                                                            03257400
    END ELSE                                                            03257550
    TERMINATE(MIX & 61[CTF]);                                           03257700
    IF STA=ABS(SPOWORD) AND LSTATUS[LINE]=BROKEN THEN                   03257720
    BEGIN                                                               03257740
$INCLUDE 03257761, IF DCP;                                              03257759
         STATABLE[STA].OUTPUTANKING:=1;                                 03257760
         GO TO BSB;                                                     03257780
    END;                                                                03257800
    IF STATABLE[STA].OUTPUTANKING  THEN                                 03257850
    BEGIN                                                               03258000
         WHILE NOT TANKS[STA].[1:1] DO                                  03258150
         SLEEP([TANKS[STA]],-0);                                        03258300
         STATABLE[STA].OUTPUTANKING := 0;                               03258450
         IF TANKS[STA].[2:8] NEQ 0 OR TAILOUT = STA THEN                03258600
         BEGIN                                                          03258750
              T ~ 0;                                                    03258900
              DO  I:=T UNTIL (T:=TANKS[T].[2:8])=STA;                   03259050
              TANKS[I].[2:8]:=TANKS[STA].[2:8];                         03259200
              IF STA=TAILOUT THEN TAILOUT:=I;                           03259350
         END;                                                           03259500
         IF TANKS[STA].[10:1]  THEN                                     03259650
         BEGIN M[(I~GETAREA(0))+1]~0;                                   03259800
              M[I]:=0&STA[CTF]&10[18:41:7];                             03259950
              QUEVENT(I,CANDEMIX[STA]);                                 03260100
         END;                                                           03260250
    END;                                                                03260400
$INCLUDE 03260501, IF DCP;                                              03260499
    TNAOG[STA]:=(*P(DUP))&0[1:1:24];                                    03260500
    T:=TANKS[STA]:=P(DUP,LOD,0,SSN,INX);                                03260550
    IF T!0 AND NOT (STATABLE[STA].SWAPPED) THEN M[T]:=0;                03260600
$OMIT 03261755, IF TWXONLY OR DCP;                                      03260695
    IF STATABLE[STA].STATIONTYPE = TC500 THEN                           03260700
    TNAOG[SEQARRAY[STA].[26:6]]:=(*P(DUP))&0[1:1:13]                    03260850
    ELSE IF(STATABLE[STA].STATIONTYPE = CONRAC OR                       03261000
    STATABLE[STA].STATIONTYPE = BIDS)  THEN                             03261150
    BEGIN                                                               03261300
         TNAOG[SEQARRAY[STA].[26:6]]:=(*P(DUP))&P(0,XCH)[14:14:14];     03261450
         STATABLE[STA]:=(*P(DUP))&0[22:46:2];                           03261600
    END;                                                                03261750
BSB:                                                                    03261800
$OMIT 03262051, IF DCP;                                                 03261894
$OMIT 03261905, IF TWXONLY;                                             03261895
    IF LINEDISC[LINE]!TWX THEN SEQARRAY[STA].[1:1]:=0 ELSE              03261900
    IF LSTATUS[LINE]!BROKEN THEN SEQARRAY[STA]:=0;                      03262050
    IF LSTATUS[LINE] ! DISCON THEN                                      03262200
    BEGIN                                                               03262350
         STATABLE[STA]:=(*P(DUP))&1[16:47:1]; %DISCONNECTING            03262500
$INCLUDE 03262561, IF DCP;                                              03262519
         M[(I:=GETAREA(0))+1]:=0&1[23:47:1]&SETSTATIONREADY[1:41:7]     03262520
              &STATABLE[STA][24:24:16];                                 03262540
         DCPQ(I);                                                       03262560
         QUITN[STA]:=0;                                                 03262580
         IF ABS(SPOWORD) = STA THEN GO TO NRDONE;                       03262600
         M[T:=GETAREA(0)]:=(*P(DUP))&(STA&                              03262650
         ((LSTATUS[LINE]=BROKEN)+1)[36:46:2])[CTF];                     03262800
         QUEVENT(T,CANDEMIX[LINE]);                                     03262950
    END ELSE                                                            03263100
    BEGIN                                                               03263250
         A ~ [M[GETAREA(1)+1]]&SYSDISKRL[8:38:10]; %<9 WORDS LONG       03263400
         SYSDISKIO(3,-STA,A);                                           03263550
$OMIT 03263701, IF DCP;                                                 03263699
         A[0].DIALEDUP~A[1]~0;                                          03263700
$INCLUDE 03263801, IF DCP;                                              03263799
         A[0]:=A[1]:=0;                                                 03263800
         SYSDISKIO(0,-STA,A);                                           03263850
         FORGETAREA(1,A.[CF]-1);                                        03264000
$OMIT 03264601, IF DCP;                                                 03264148
$OMIT 03264151, IF TWXONLY;                                             03264149
         IF LINEDISC[LINE]=MULTI THEN SEQARRAY[STA].[3:1]:=1;           03264150
         STATABLE[STA]:=(*P(DUP))&0[14:47:1]&                           03264300
         % RESET BREAK AND DISCONNECTING                                03264450
         ((MIX:=P(DUP).MIXNR)=0 OR MIX=CANDYINX)[16:47:1];              03264600
$INCLUDE 03265381, IF DCP;                                              03264699
         IF LSTAT=DISCON THEN                                           03264700
         IF NOT STATABLE[STA].[22:1] THEN                               03264720
           SLEEP([STATABLE[STA]],0&1[22:47:1]);                         03264740
$VOID                                                                   03264750
         STREAM(STA,S~S.[40:8]: D~(LINETABLE+S.[24:6])&S[30:30:2]);     03264760
         BEGIN SI:=LOC STA; SI:=SI+6; TALLY:=1;                         03264780
              IF 2 SC=DC THEN                                           03264800
              BEGIN SI:=LOC S; SI:=SI+6; TALLY:=0;                      03264820
                   DI:=DI-2; DS:=2 CHR;                                 03264840
              END;                                                      03264860
              STA:=TALLY;                                               03264880
              SI:=D; DI:=LOC S;                                         03264900
              DI:=DI+6; DS:=2 CHR;                                      03264920
         END;                                                           03264940
         IF MIX:=((I:=P)=0) THEN P(DEL) ELSE                            03264960
         IF P THEN                                                      03264980
         BEGIN WHILE (J:=STATABLE[I].[40:8])!STA AND J!0 DO I:=J;       03265000
              IF J!0 THEN STATABLE[I].[40:8]:=S;                        03265020
         END;                                                           03265040
$VOID 03265051                                                          03265045
         IF LSTAT=DISCON THEN                                           03265060
         BEGIN I:=(T:=0)&S[24:24:16];                                   03265080
              IF MIX THEN                                               03265100
              BEGIN SETUPREQUEST;                                       03265120
                   M[T+1]:=I&DISCONNECT[1:41:7];                        03265140
                   SETUPREQUEST;                                        03265160
                   M[T+1]:=I&LOOKFORRING[1:41:7];                       03265180
              END;                                                      03265200
              SETUPREQUEST;                                             03265220
              M[T+1]:=I&RESETSTATIONCHARACTERS[1:41:7];                 03265240
              SETUPREQUEST;                                             03265260
              M[T+1]:=I&ENABLEINPUT[1:41:7]&1[23:47:1];                 03265280
              DCPQ(T);                                                  03265300
         END;                                                           03265320
         IF (MIX:=S.MIXNR)!0 AND CANDYINX!MIX THEN                      03265340
$VOID                                                                   03265350
           SLEEP([STATABLE[STA]],@20000000000);    % DISCONNECTING      03265360
         STATABLE[STA]:=0;                                              03265380
         IF STA=ABS(SPOWORD) THEN SPOSET(NABS(0),STA);                  03265400
    END;                                                                03265450
NRDONE:                                                                 03265500
$OMIT 03265751, IF DCP;                                                 03265549
    LINETABLE[LINE]:=(*P(DUP))&(                                        03265550
$OMIT 03265601, IF TWXONLY;                                             03265599
      IF P(DUP).LINEDIS=CONTENTION THEN WAITINGENQ ELSE                 03265600
      IDL)[21:43:5];                                                    03265650
    ENTEREADYQ(STA);    % XMIT NEW DATA, START A POLL FOR MULTIPOINT    03265700
    QUITN[STA]:=0;                                                      03265750
EXIT:                                                                   03265800
$INCLUDE 03265901, IF DCP;                                              03265849
    IF LINE LSS 0 THEN                                                  03265850
    IF (STA:=S.[40:8])!0 THEN GO AGAIN;                                 03265900
    KILL([RCW] INX NOT 2);                                              03265950
END QUITTER;                                                            03266000
$OMIT 03291001, IF DCP;                                                 03266999
PROCEDURE DCWAIT(ADR,LINE,R,MASK,CLCK);                                 03267000
VALUE ADR,LINE,MASK,CLCK;                                               03267200
REAL ADR,LINE,MASK,CLCK;                                                03267400
REAL R;                                                                 03267600
BEGIN REAL A,B;                                                         03267800
    LABEL TRYAGAIN;                                                     03268000
    IF LINE GTR LMAX THEN P(XIT);                                       03268200
    IF NOT LOCKED[LINE] THEN              % HAVE TO LOCK LINE           03268400
    BEGIN                                                               03268600
TRYAGAIN: IF NOT LINETABLE[LINE].[21:2]=1 THEN                          03268800
         BEGIN CLICK:=CLOCK+P(RTR)+320;     % WAIT FOR IDL              03269000
              COMPLEXSLEEP(LINETABLE[LINE].[21:2]=1);                   03269200
              IF LOCKED[LINE] THEN                                      03269400
              BEGIN COMPLEXSLEEP(NOT LOCKED[LINE]);                     03269600
                   GO TRYAGAIN;                                         03269800
         END  END;                                                      03270000
         LOCKED[LINE]:=1;                                               03270200
$OMIT 03270401, IF TWXONLY;                                             03270399
         IF LINEDISC[LINE]!TTY THEN SEQARRAY[LINE].SELECTED:=1;         03270400
         IF (B:=STATABLE[LINE]).[CF]!0 THEN   % THROW AWAY OUTPUT QUEUE 03270600
         BEGIN STATABLE[LINE]:=B&0[CTC];                                03270800
              DO FORGETAREA((A:=M[B]).[2:2],B) UNTIL (B:=A.[CF])=0;     03271000
         END;                                                           03271100
         M[B:=GETAREA(0)]:=(*P(DUP))&1[4:47:1]&LINE[10:40:8];           03271200
         GIVEAWAY(B); %QUEUE INPUT DELETE TO OLDWIERDHAROLD             03271300
         IF (B:=LINETABLE[LINE]).[CF]!0 THEN  % THROW AWAY INPUT QUEUE  03271400
         BEGIN LINETABLE[LINE]:=B&0[CTC];                               03271600
              DO FORGETAREA((A:=M[B]).[2:2],B) UNTIL (B:=A.[FF])=0;     03271800
    END  END;                                                           03272000
%                                                                       03272200
    R:=0;                                                               03272400
    LSTATUS[LINE]:=IDL;                                                 03272600
    LINETABLE[LINE].[CF]:=P(.R,LOD);                                    03272800
    ENTERLINEQ(ADR,LINE,0);                                             03273000
    CLICK:=CLOCK+P(RTR)+60;  % SET 1 SECOND I/O MAX                     03273100
    SLEEP(P(.R,LOD),-0);                                                03273200
    IF MASK THEN                            % WAIT FOR INTERRUPT        03273400
    IF R.[CF]!ADR+1 OR M[ADR].[5:1] THEN    %UNLESS I/O BOUNCED OR      03273600
    IF R.[CF] ! 0 THEN                      %IT IS ALREADY BACK         03273800
    BEGIN R:=0;                                                         03274000
         IF CLCK!0 THEN CLICK:=CLOCK+P(RTR)+CLCK;                       03274200
         SLEEP(P(.R,LOD),-0);                                           03274400
    END;                                                                03274600
%                                                                       03274800
    IF MASK.[1:1] THEN                      % UNLOCK THE LINE           03275000
    BEGIN % RESET LOCKED, LSTATUS, INPUT QUEUE                          03275200
$INCLUDE 03275401, IF TWXONLY;                                          03275399
         LINETABLE[LINE]:=ABS(*P(DUP))&0[CTC]&IDL[21:43:5];             03275400
$OMIT 03276001, IF TWXONLY;                                             03275599
         IF (LINETABLE[LINE]:=ABS(*P(DUP))&0[CTC]&(IF P(DUP).LINEDIS    03275600
             =CONTENTION THEN WAITINGENQ ELSE IDL)[21:43:5])            03275800
             .LINEDIS!TWX THEN SEQARRAY[LINE].[1:4]:=0;                 03276000
    END;                                                                03276200
    STATABLE[LINE].[CF]:=0;                                             03276400
END;                                                                    03276600
REAL PROCEDURE INPUTSCAN(MODE,SOURCE,DEST,NUM,FLAGS);                   03276800
VALUE NUM,FLAGS;                                                        03277000
REAL MODE,SOURCE,DEST,NUM,FLAGS;                                        03277200
BEGIN INTEGER I,J,N;                                                    03277400
    REAL U;                                                             03277600
    REAL DATA=U+1,NOTEQ=DATA+1,ASCII=NOTEQ+1,BS=DATA;                   03277800
    REAL INPTSC=+1;                                                     03278000
    LABEL AUT;                                                          03278200
%                                                                       03278400
    INPUTSCAN:=DEST;                                                    03278600
    J:=NUM MOD 63;                                                      03278800
$OMIT 03279201, IF TWXONLY;                                             03278999
    IF FLAGS.[33:3]!TWX THEN                                            03279000
    P(MODE,P(DUP).[34:1],P(XCH).[33:1],FLAGS.[47:1]-1) ELSE             03279200
    P(FLAGS.[FF]);                                                      03279400
    U:=FLAGS.[46:1];                                                    03279600
    FOR I:=NUM DIV 63 STEP -1 UNTIL 0 DO                                03279800
    BEGIN                                                               03280000
         IF (N:=IF I=0 THEN J ELSE 63) = 0 THEN GO AUT;                 03280200
$OMIT 03280401, IF TWXONLY;                                             03280399
         IF FLAGS.[33:3]=TWX THEN                                       03280400
         STREAM(SOURCE, DEST, MODE:=4: N, BS, U);                       03280600
         BEGIN SI:=SOURCE; DI:=DEST;                                    03280800
            N(IF SC = "{" THEN                                          03281000
              BEGIN DEST:=DI; DI:=LOC BS;                               03281200
                   SOURCE:=SI; SI:=LOC DEST;                            03281400
                   IF 8 SC=DC THEN DI:=DEST ELSE                        03281600
                   BEGIN DI:=DEST; DI:=DI-1 END;                        03281800
                   SI:=SOURCE; SI:=SI+1;                                03282000
              END ELSE                                                  03282200
              IF SC = "~" THEN                                          03282400
              BEGIN SI:=SI+1; U(DS:=LIT"~");                            03282600
                   TALLY:=1; MODE:=TALLY;                               03282800
                   JUMP OUT TO EXIT;                                    03283000
              END ELSE DS:=CHR);                                        03283200
    EXIT:   DEST:=DI; SOURCE:=SI;                                       03283400
$OMIT 03289001, IF TWXONLY;                                             03283599
         END                                                            03283600
         ELSE                                                           03283800
         BEGIN                                                          03284000
              STREAM(SOURCE, DEST, MODE:=4, DATA, NOTEQ: ASCII, U, N);  03284200
              BEGIN SI:=SOURCE; DI:=DEST;                               03284400
                 N(NOTEQ(TALLY:=0; NOTEQ:=TALLY;                        03284600
                        IF SC="!" THEN JUMP OUT TO DSIT;                03284800
                         DATA(JUMP OUT TO L1); TALLY:=1;                03285000
                    L1:  DATA:=TALLY; JUMP OUT TO L2);                  03285200
                   IF SC = "!"THEN                                      03285400
                   BEGIN TALLY:=1; NOTEQ:=TALLY; SI:=SI+1;              03285600
                        ASCII(DS:=LIT"!"); GO TO L;                     03285800
                   END;                                                 03286000
             L2:   DATA(JUMP OUT TO DSIT);                              03286200
                   IF SC = "#" THEN TALLY := 1 ELSE                     03286400
                   IF SC = "~" THEN TALLY := 1 ELSE                     03286600
                   BEGIN ASCII(JUMP OUT TO DSIT);                       03286800
                        IF SC!"-" THEN BEGIN SI:=SI+1; GO TO L END      03287000
                        ELSE TALLY:=2;                                  03287200
                   END;                                                 03287400
                   JUMP OUT TO SETALLY;                                 03287600
           DSIT:   DS:=CHR;                                             03287800
            L:  );  GO TO L3;                                           03288000
      SETALLY:  SI:=SI+1;  MODE:=TALLY;  U(DS:=LIT"~");                 03288200
           L3:  SOURCE:=SI; DEST:=DI;                                   03288400
              END;                                                      03288600
              NOTEQ:=P;                                                 03288800
              P(DATA:=P,P&P[34:47:1]&NOTEQ[33:47:1]);                   03289000
         END;                                                           03289200
         P([MODE],STD);                                                 03289400
         P([DEST],STD);                                                 03289600
         P([SOURCE],STD);                                               03289800
         IF MODE.[45:1] THEN ELSE GO AUT;                               03290000
    END;                                                                03290200
AUT:                                                                    03290400
    INPUTSCAN:=(DEST.[30:3]&DEST[30:33:15]) - (INPTSC.[30:3]&           03290600
                INPTSC[30:33:15]);                                      03290800
END;                                                                    03291000
PROCEDURE COMM13;                                                       03292000
BEGIN                   % INPUT TO NORMAL STATE JOBS ABOVE THE FENCE    03292200
    ARRAY A=-5[*];                                                      03292600
    REAL N=-6,D,T,X,A1,A2,A3,SORC,N1,N2;                                03292800
$OMIT 03292901, IF DCP;                                                 03292899
    REAL MODE,FLAGS;                                                    03292900
    LABEL START,NEXTSEG,READIT,EXIT;                                    03293000
    DEFINE COUNTEND  = [45:1]#;                                         03293200
%                                                                       03293400
%   INPUTANKS IS NOT LOCKED - DONT LOSE CONTROL WHILE UPDATING IT       03293600
%                                                                       03293800
    SUBROUTINE UPDATEINPUTANK;                                          03294000
    BEGIN                                                               03294200
         WHILE NOT (X:=INPUTANK[T]).[1:1] DO SLEEP([INPUTANK[T]],-0);   03294400
$OMIT 03294701, IF DCP;                                                 03294599
         IF M[A1].[FF] LEQ (A3:=SORC.[30:3]&(SORC-A1-1)[30:33:15])      03294600
            OR (MODE AND NOT M[A1].[2:1]) THEN   % SEG IS EMPTY         03294700
$INCLUDE 03294901, IF DCP;                                              03294799
         IF (A2:=M[A1]).[FF] LEQ (A3:=SORC-A1)                          03294800
            OR (A2.MESSEND AND NOT A2.[2:1]) THEN     % SEG IS EMPTY    03294900
         X:=X&0[2:2:8]&(X.INPUTN-1)[40:40:8]&((X.INPUTL+1)              03295000
            AND NOT CLUMPSIZE)[10:40:8]                                 03295200
         ELSE X:=X&A3[2:40:8];                                          03295400
$OMIT 03295601, IF TWXONLY OR DCP;                                      03295599
         INPUTANK[T]:=X&MODE[38:33:2];                                  03295600
$INCLUDE 03295801, IF TWXONLY OR DCP;                                   03295799
         INPUTANK[T]:=X;                                                03295800
    END;                                                                03296000
%                                                                       03296200
START:                                                                  03296400
    IF TERMSET(P1MIX) THEN GO TO RETURN;                                03296600
$INCLUDE 03296701, IF DCP;                                              03296699
    IF SCHEDLINE[T:=LOGLINE.[40:8]] THEN                                03296700
$OMIT 03296901, IF DCP;                                                 03296799
    IF LINEDISC[D:=IF (T:=LOGLINE.[40:8]) LEQ LMAX THEN T               03296800
    ELSE STATABLE[T].LEENKER] = SCHED THEN                              03296900
    BEGIN SCHEDIO(N,0,(-0&T[CTF]&(A)[CTC])); P(XIT); END;               03297000
    IF (X:=INPUTANK[T]).INPUTN = 0 THEN     % NOTHING IN TANK           03297200
    BEGIN BREAK[T]:=0;                                                  03297400
         IF N GTR 0 THEN               % SEND OUT QM IF NOT PT OR READIN03297600
$INCLUDE 03297701, IF DCP;                                              03297699
         IF NOT PAPERTAPE[T] THEN                                       03297700
$OMIT 03298201, IF DCP;                                                 03297798
$OMIT 03298001, IF TWXONLY;                                             03297799
         IF NOT(PAPERTAPE[T] OR P(LINETABLE[D],DUP).LINEDIS!MULTI AND   03297800
           P(XCH).[21:1]) THEN                                          03298000
$INCLUDE 03298201, IF TWXONLY;                                          03298199
         IF NOT (PAPERTAPE[T] OR LINETABLE[T].[21:1]) THEN              03298200
         BEGIN                                                          03298400
              STREAM(X:=(X:=GETAREA(0))+1);                             03298600
              BEGIN DS:=LIT"!"; DS:=LIT MARK; END;                      03298700
              TWXOUT(X+1,2,-0,LOGLINE);                                 03298800
              FORGETAREA(0,X);                                          03299000
              IF INPUTANK[T].INPUTN!0 THEN GO TO START;                 03299200
         END;                                                           03299400
         INPUTANK[T].INPUTREADY:=1;                                     03299600
         SWAP(WAITSWAP,1);                                              03299800
         GO TO START;                                                   03300000
    END;                                                                03300200
%                                                                       03300400
    N2:=(N:=ABS(N))|8;                                                  03300600
    D:=A.[CF];                                                          03300800
    STREAM(N:=N-1,A);                               % BLANK OUT BUFFER  03301000
    BEGIN DS:=8 LIT" "; SI:=A; DS:=N WDS; END;                          03301200
$INCLUDE 03301301, IF DCP;                                              03301299
    SORC:=(A1:=SPACE(30))+X.[2:8];                                      03301300
$OMIT 03302201, IF DCP;                                                 03301399
    SORC:=((A1:=SPACE(30))+X.[2:5])&X[30:7:3]+1;                        03301400
    A3:=A2:=SPACE(30);                                                  03301600
$OMIT 03302001, IF TWXONLY;                                             03301799
    FLAGS:=1&STATABLE[T][33:10:3]&DAT[P1MIX][46:7:1]&A2[CTF];           03301800
    MODE:=0&X[33:38:2];                                                 03302000
$INCLUDE 03302201, IF TWXONLY;                                          03302199
    FLAGS:=1&DAT[P1MIX][46:7:1]&A2[CTF];                                03302200
NEXTSEG:                                                                03302400
$INCLUDE 03302601, IF STATISTICS;                                       03302599
         COUNTUP(16,1);                                                 03302600
    DISKWAIT(-A1,30,PROGTANK+CLUMPSIZE|T+X.INPUTL);                     03302800
$INCLUDE 03306601, IF DCP;                                              03302999
    X:=IF (N1:=M[SORC].[CF]) GTR N2 THEN N2 ELSE N1;                    03303000
    IF SORC=A1 THEN                                                     03303200
    IF (A3:=M[A1].[10:8]) ! 0 THEN                                      03303400
    IF (D:=P(D.[30:3]&D[30:33:15]-A3,DUP).[30:15]&P(XCH)[30:45:3]).[CF] 03303600
       LSS A.[CF] THEN D:=A.[CF];                                       03303800
%                                                                       03304000
    STREAM(L:=X.[37:6]: N:=X.[43:5], U:=DAT[P1MIX].NDSABLE AND X LSS 80,03304200
           SORC:=SORC+1,D:=A2:=D);                                      03304400
    BEGIN SI:=SORC;                                                     03304600
         L(DS:=32 CHR); DS:=N CHR;                                      03304800
         U(DS:=LIT"~");                                                 03305000
         L:=DI;                                                         03305200
    END;                                                                03305400
    SORC:=SORC+(N1+15).[40:5];                                          03305600
    N1:=(D:=P).[30:3]&D[30:33:15]-A2.[30:3]&A2[30:33:15];               03305800
    UPDATEINPUTANK;                                                     03306000
    IF NOT M[A1].MESSEND THEN                                           03306200
    IF (N2:=N2-N1) GTR 0 THEN                                           03306400
    BEGIN SORC:=A1;                                                     03306600
$OMIT 03309401, IF DCP;                                                 03306999
    N1:=INPUTSCAN(MODE,SORC,A3,(M[A1].[FF]-X.[2:8]),FLAGS);             03307000
    X:=IF N1 GTR N2 THEN N2 ELSE N1;                                    03307200
    STREAM(M:=X.[37:6]:N:=X.[43:5],A2,D);        % MOVE DATA INTO       03307400
    BEGIN SI:=A2;                                % PROGRAM BUFFER       03307600
         M(DS:=32 CHR); DS:=N CHR;                                      03307800
         M:=DI;                                                         03308000
    END;                                                                03308200
    D:=P;                                   % SAVE WHERE WE ARE IN      03308400
    UPDATEINPUTANK;                         % CASE WE NEED MORE         03308600
    IF MODE.COUNTEND THEN                   % SCAN STOPPED BY COUNT     03308800
    IF (N2:=N2-N1) GTR 0 THEN               % MORE INPUT REQUIRED       03309000
    BEGIN SORC:=A1+1;                                                   03309200
         A3:=A2;                                                        03309400
         GO TO NEXTSEG;                                                 03309600
    END ELSE                                                            03309800
    BEGIN                              % SCAN TO END OF MESSAGE         03310000
READIT:  DISKWAIT(-A1,30,PROGTANK+CLUMPSIZE|T+X.INPUTL);                03310200
$INCLUDE 03310401, IF STATISTICS;                                       03310399
         COUNTUP(16,1);                                                 03310400
$OMIT 03310601, IF TWXONLY OR DCP;                                      03310599
         IF STATABLE[T].STATIONTYPE=TWX THEN                            03310600
         BEGIN SORC:=A1+100;                % FORCES UPDATEINPUTANK TO  03310800
              IF NOT M[A1].MESSEND THEN     % GO TO THE NEXT SEGMENT    03311000
              BEGIN UPDATEINPUTANK;                                     03311200
                   GO READIT;               % NO END HERE - TRY NEXT    03311400
              END;                          % WE DO HAVE AN END         03311600
$INCLUDE 03312101, IF DCP;                                              03311799
              IF M[A1].[2:1] THEN SORC:=A1+(M[A1].[CF]+15).[40:5];      03311800
              UPDATEINPUTANK;                                           03312000
         END;                                                           03312100
$OMIT 03313801, IF DCP;                                                 03312199
              IF NOT M[A1].[2:1] THEN       % IF NOT PAPERTAPE SET      03312200
              BEGIN UPDATEINPUTANK;         % POINTERS TO NEXT SEGMENT  03312400
                   GO TO EXIT;              % ELSE SCAN FOR ~           03312600
         END  END;                                                      03312800
         SORC:=A1+1;                        % RESET PARAMETERS TO       03313000
         A3:=A2;                            % SCAN FOR CR OR ~          03313200
         N1:=INPUTSCAN(MODE,SORC,A3,M[A1].[FF],FLAGS);                  03313400
         UPDATEINPUTANK;                                                03313600
         IF MODE.COUNTEND THEN GO READIT;   % TRY AGAIN                 03313800
    END OF HANDLING COUNTEND;                                           03314000
EXIT:                                                                   03314200
    IF X.SLOWDOWN THEN                                                  03314400
    IF X.INPUTN LSS .5|CLUMPSIZE THEN                                   03314600
$OMIT 03316001, IF DCP;                                                 03314798
$OMIT 03315001, IF TWXONLY;                                             03314799
    BEGIN                                                               03314800
         IF STATABLE[T].STATIONTYPE = TWX THEN                          03315000
         BEGIN STREAM(D:=(A2:=GETAREA(0))+1);                           03315200
              DS:=15 LIT"CONTINUE TYPING";                              03315400
              TWXOUT(A2+1,15,1,LOGLINE);                                03315600
              FORGETAREA(0,A2);                                         03315800
$OMIT 03316001, IF TWXONLY;                                             03315999
         END ELSE TANKOK[T]:=0;                                         03316000
$INCLUDE 03316601, IF DCP;                                              03316199
    BEGIN M[(A2:=GETAREA(0))+1] := 0&ENABLEINPUT[1:41:7]&1[23:47:1]     03316200
              &STATABLE[T][24:24:16];                                   03316400
         DCPQ(A2);                                                      03316600
         INPUTANK[T].SLOWDOWN:=0;                                       03316800
    END;                                                                03317000
    FORGETSPACE(A1);                                                    03317200
$OMIT 03317401, IF DCP;                                                 03317399
    FORGETSPACE(A2);                                                    03317400
END COMM13;                                                             03317600
%                                                                       03333950
PROCEDURE COMM5;                                                        03375000
     %DATACOMM INPUT COMMUNICATE FOR C&E.                               03375050
     %FORMAT OF DISK BUFFER WHICH OLDWIERDHAROLD WRITES ON DISK WHEN FUL03375100
     % LASTSEG - 2 = WORD SET BY IOFINISH WHEN DISK WRITE COMPLETE.     03375200
     % LASTSEG - 1 = DISK ADDRESS (DEKIMAL)                             03375300
     % LASTSEG[0]  = INFORMATION WORD WRITTEN ON DISK                   03375400
     %     [3 :15] = RELATIVE DISK ADDRESS WITHIN THIS DISK CHUNK       03375600
     %     [18:15] = LINK TO NEXT BUFFER                                03375700
     %     [40:8]  = NUMBER OF VALID WORDS IN THIS BUFFER SEGMENT       03375900
     % LASTSEG[1] THRU LASTSEG[29] CONTAIN INPUT MESSAGES.              03375950
BEGIN                                                                   03377000
       ARRAY A=-6[*];                                                   03378000
       REAL T,U;                                                        03379000
       ARRAY S = T[*];                                                  03380000
       DEFINE FIOADR=T-2#;%THIS IS DIFFERENT FROM GLOBAL ONE OF SAME NAM03380100
       LABEL LOOPEND;                                                   03380200
         IF (T~FIRSTSEG.[CF]) = LASTSEG.[CF] THEN                       03381000
         BEGIN                                                          03382000
              CANDEINPUTREADY ~ FIRSTOFFSET = LASTOFFSET;               03383000
              IF CANDEINPUTREADY THEN                                   03384000
              BEGIN                                                     03385000
$INCLUDE 03385011, IF DCP;                                              03385004
                   U:=0;                                                03385005
                   WHILE (U:=STATABLE[U].[40:8])!0 DO                   03385010
$OMIT 03385026, IF DCP;                                                 03385014
                   FOR U:=1 STEP 1 UNTIL STAMAX DO                      03385015
                   IF SCHEDLINE[U] THEN                                 03385020
                   BEGIN IF STATABLE[U].DIALEDUP THEN                   03385025
                        IF SEQARRAY[U] LSS 0 THEN                       03385030
                        BEGIN SEQARRAY[U]:=ABS(*P(DUP));                03385040
                             FORK(P(.SCHEDIO),(-U),0,128,0);            03385050
                             GO TO LOOPEND;                             03385060
                        END;                                            03385070
$OMIT 03385081, IF DCP;                                                 03385079
                   END ELSE GO TO LOOPEND;                              03385080
    LOOPEND:                                                            03385090
                   IF(U~A.[CF])=T THEN GO TO RETURN;                    03385100
                   IF U > 1023 THEN FORGETSPACE(U-2);                   03385200
                   M[A.[FF]]~(*P(DUP))&T[CTC] OR M;                     03385300
                   GO TO RETURN;                                        03385400
              END;                                                      03385500
         END;                                                           03385600
         IF T ! (T~A INX 0) THEN                                        03393000
         BEGIN                                                          03394000
              IF A.[2:1] THEN                                           03395000
              BEGIN                                                     03396000
                   IF (M[FIOADR] AND IOMASK) = 0 THEN                   03397000
                   SLEEP([M[FIOADR]],IOMASK);                           03398000
                   FORGETSPACE(T-2);                                    03399000
              END;                                                      03400000
              M[A.[FF]] ~ (A & P(.FIRSTSEG,LOD)[CTC]) OR M;             03401000
         END;                                                           03403000
         FORK(P(.NOTIFYCANDE),P1MIX,0,0,1);                             03414000
         GO TO RETURN;                                                  03415000
  END COMM5;                                                            03416000
$OMIT 03502001, IF DCP;                                                 03416999
PROCEDURE ENTERLINEQ(ADR,LINE,PRIRTY);                                  03417000
  VALUE ADR,LINE,PRIRTY;                                                03418000
  REAL ADR,LINE,PRIRTY;                                                 03419000
  BEGIN                                                                 03420000
       REAL A,B,S;                                                      03421000
       LABEL TOIT;                                                      03422000
       S~STATABLE[LINE];                                                03423000
       A~ADR;                                                           03424000
       IF PRIRTY THEN                                                   03425000
       BEGIN %LINKINFRONT                                               03426000
            WHILE P(M[ADR],DUP).[CF]!0 DO ADR~P;                        03427000
            M[ADR]~P(XCH)&S[CTC];                                       03428000
            GO TOIT;                                                    03429000
       END; %NEXT IS LINK AT END                                        03430000
       IF S.[CF]!0 THEN                                                 03431000
       BEGIN                                                            03432000
            WHILE P(M[S],DUP).[CF]!0 DO S~P;                            03433000
            M[S]~P(XCH)&A[CTC];                                         03434000
       END ELSE                                                         03435000
TOIT:                                                                   03436000
       STATABLE[LINE]~S&A[CTC];                                         03437000
       ENTEREADYQ(LINE);                                                03438000
END ENTERLINEQ;                                                         03439000
$OMIT 03502005, IF TWXONLY;                                             03439995
PROCEDURE NAKQUE;                                                       03440000
BEGIN  % THIS STACK IS 64 WORDS LONG BE CAREFUL                         03441000
    REAL E,I,S,T,V,RCW=+0;  LABEL LOOP;                                 03441500
    WHILE (T:=SEQARRAY[0]).[18:30] ! 0 DO                               03442000
    BEGIN                                                               03442500
         WHILE (I:=T.[FF]) ! 0 DO                                       03443000
         BEGIN  %PLACE ENTRIES IN QUEUE IN WAKEUP TIME ORDER            03443500
              T:=T&M[I][CTF];                                           03444000
              IF STATABLE[V:=M[I+1]].STATIONTYPE=TC500 THEN             03444500
              BEGIN %TC500 NAK RETRANSMIT TIME IS NOW 1/2 SECOND        03445000
                   M[I+2]:=(*P(DUP))+30;                                03445300
                   E:=(TNAOG[SEQARRAY[V].[26:6]]:=(*P(DUP))&(IF         03445400
                   (S:=P(DUP).[38:10])!0 THEN S-1 ELSE 999)[38:38:10]); 03445500
              END ELSE %FOR B9352 NAK RETRANSMIT TIME INCREASES IN      03445600
              BEGIN    %INCREMENTS OF 3 SEC. FOR EACH SUCCESIVE NAK.    03445700
                   M[I+2]:=(*P(DUP))+(E:=(S:=SEQARRAY[V])               03445800
                           .[9:3] + 1)|180;                             03445900
                   IF E!8 THEN SEQARRAY[V]:=S&E[9:45:3];                03446000
                   E:=(TNAOG[S.[26:6]]:=(*P(DUP))&0[28:28:20]);         03446100
              END; %NEXT - RESET TANK TO POINT TO THE NAKKED MESSAGE    03446200
              S:=TANKS[V].[14:5] - E.[1:5];                             03446500
              TANKS[V]:=(*P(DUP))&(P(DUP).[27:6]+S+0&S[42:1:1])         03447000
                        [27:42:6]&E[14:1:13]&0[12:47:1];                03447500
              E:=M[I+2]; S:=[T].[CF]; %INSERT STA IN TIME LIST          03448000
              WHILE (V:=M[S].[CF])!0 AND M[V+2] LSS E DO S:=V;          03448500
              M[I].[CF]:=V; M[S].[CF]:=I;                               03449000
         END; %END PUTTING IN LIST NOW TAKE OUT                         03449500
         S:=CLOCK + P(RTR);                                             03450000
         SEQARRAY[0]:=T;                                                03450500
LOOP:    IF (E:=M[(I:=T.[CF])+2]) LEQ S THEN %IS IT TIME TO TRY AGAIN   03451000
         BEGIN %YES. DELINK IT FROM THE TIMER QUEUE                     03451500
              V:=M[I+1];                                                03452000
              T:=SEQARRAY[0]:=T&M[I][CTC];                              03452500
              FORGETAREA(0,I); %NOW DETANK THE I/O AND TRY AGAIN.       03453000
              IF TANKLINE[V]=0 AND TAILOUT!V THEN                       03453500
              BEGIN                                                     03454000
                   TANKLINE[TAILOUT]:=V;                                03454500
                   TAILOUT:=V;                                          03455000
                   STARTWORKING;                                        03455500
              END;                                                      03455800
              IF T.[CF] ! 0 THEN GO LOOP;                               03455900
         END ELSE %NOW SLEEP EITHER TIME FOR NEXT STA OR 1/2 SEC (MIN)  03456000
         BEGIN CLICK:=IF E GTR (I:=S+30) THEN I ELSE E;                 03456100
               SLEEP(0,0); %WHEN SLEEP IS DONE GO BACK AND PLACE NEWLY  03456200
    END; END; %NAKKED STATIONS IN LIST AND WAKE UP THE ONES THAT CAN BE 03456300
    KILL([RCW] INX NOT 2);                                              03456500
END REMOVING STATIONS FROM NAKQUE;                                      03457000
PROCEDURE DCTIMEOUT(R); VALUE R; REAL R;                                03458000
  BEGIN %THIS STACK IS 64 WORDS LONG BE CAREFUL                         03458200
    LABEL LEAV,LEAV1,ENDIT,TRY;                                         03459000
    REAL L,C,S,T,RCW=+0;                                                03460000
    L:=S:=R.[FF];                                                       03461000
    R:=R.[CF];                                                          03462000
    IF (T:=LINETABLE[L]).LINEDIS= MULTI THEN                            03463000
    BEGIN                                                               03464000
         IF T.[21:5]=POLLTIMEOUT THEN                                   03465000
         BEGIN %FIND WHICH STA TIMED OUT. IF ONLY ONE ON LINE IT DID IT 03466000
              IF SEQARRAY[L].LINELINK=L THEN GO LEAV1;                  03466500
              STREAM(R:=(R+1)&1[32:47:1]:T:=[T]);                       03467000
              BEGIN %LOOK FOR GRPMK IN CHARACTER AFTER EOT.             03468000
                   SI:=R;                                               03469000
                   8(SI:=SI+5;IF SC="%" THEN SI:=SI+2;                  03470000
                   IF SC!"~" THEN R:=SI ELSE JUMP OUT);                 03471000
                   SI:=R;DS:=LIT "0"; %PUT ADDR CHARS IN T (2&3 POSIT)  03472000
                   IF SC="!" THEN %TALLY REFLECTS CASE CHANGE POSIT     03473000
                   BEGIN %CASE CHANGE BEFORE THE FIRST ADDR CHAR        03474000
                        TALLY:=2;SI:=SI+1;                              03475000
                   END;                                                 03475100
                   DS:=CHR;                                             03475200
                   IF SC="!" THEN                                       03475300
                   BEGIN %CASE CHANGE BEFORE THE SECOND ADDR CHAR       03475400
                        SI:=SI+1;TALLY:=TALLY+1;                        03475500
                   END;                                                 03475600
                   DS:=CHR;                                             03475700
                   R:=TALLY;                                            03476000
              END;                                                      03477000
              T:=P&T[34:6:12]; %PLACE IN FORMAT OF SEQARRAY[12:14]      03478000
              DO IF P(SEQARRAY[S],DUP).[12:14]!T THEN                   03479000
              ELSE GO LEAV                                              03480000
              UNTIL (S:=P.LINELINK)=L;                                  03481000
              % CANT FIGURE IT OUT - POLL AGAIN                         03481100
              FORGETAREA(M[R].[2:2],R);                                 03481200
              SEQARRAY[L]:=(*P(DUP))&SEQARRAY[SEQARRAY[L].[40:8]]       03481300
                  [40:32:8];                                            03481500
              LSTATUS[L]:=IDL;                                          03481700
              ENTEREADYQ(L);                                            03481900
              GO ENDIT;                                                 03482000
LEAV:         P(DEL); SEQARRAY[L].[40:8]:=S;                            03483000
         END ELSE S:=SEQARRAY[L].[40:8]; %SELECT OR MESSAGE TIME OUT    03484000
LEAV1:   IF (C:=LINETABLE[L]).[CF] ! 0 THEN                             03484100
         BEGIN LINETABLE[L]:=C&0[CTC]; %THROWAWAY INPUT QUEUE           03484200
              DO FORGETAREA((T:=M[C]).[2:2],C)                          03484300
              UNTIL (C:=T.[CF]) = 0;                                    03484400
         END;                                                           03484500
         IF DISCONNECTING[S] THEN GO TO TRY;                            03484550
         M[C:=GETAREA(0)]:=(*P(DUP))&1[4:47:1]&S[10:40:8];              03484600
         GIVEAWAY(C); %QUEUE A DELETE TO CE IN CASE ANYTHING WAS SENT   03484700
         SEQARRAY[S]:=ABS(*P(DUP))&(T:=P(DUP).[4:2]+1)[4:46:2];         03484800
         %THE NEXT PART ATTEMPTS TO FIND IF THE STA REALLY TIMED OUT    03484850
         IF T LSS 4 THEN                                                03484900
         BEGIN %TRY 3 TIMES TO SEE IF HE HAS GONE AWAY                  03485000
              CLICK:=CLOCK+P(RTR)+30;                                   03485100
              SLEEP(0,0); %WAIT 1/2 SECOND BEFORE DOING ANYTHING        03485200
              M[R]:=(*P(DUP))&1[4:42:6]&0[10:10:38];                    03485300
              STREAM(S:=C:=SEQARRAY[S],T:=T:=C.[24:1],                  03485400
              C:=C:=C.[25:1],L:=T!C,R:=R+1);                            03485500
              BEGIN %COMPOSE A SINGLE POLL TO SEND OUT                  03485600
                   SI:=LOC S;SI:=SI+2;DS:=LIT "$";                      03485700
                   T(DS:=LIT "!");DS:=CHR;                              03485800
                   C(DS:=LIT "!");DS:=CHR;                              03485900
                   L(DS:=LIT "!");DS:=3 LIT "P%~";                      03486000
              END;  %IF THIS POLL GETS A LEGIT RESPONSE THEN FAKE T.O.  03486100
              LSTATUS[L]:=IDL;                                          03486200
              ENTERLINEQ(R,S,1);                                        03486300
              GO TO ENDIT;                                              03486400
         END; %IF THIS TEST FAILS 3 TIMES HE IS DISCONNECTED            03486500
TRY:     SEQARRAY[S].[3:3]:=4;                                          03486600
    END ELSE IF STATABLE[S].[16:1] THEN %IF NOT DISCONNECTING           03487000
    BEGIN BLASTREAD(L,1);                                               03487100
         IF (T:=SEQARRAY[L]).[4:1] THEN SEQARRAY[L]:=T&0[4:47:1] ELSE   03487200
         BEGIN SEQARRAY[L]:=NABS(T)&1[4:47:1];                          03487300
              M[C:=GETAREA(0)]:=R&SELECT[5:43:5]&L[10:40:8];            03487400
              STREAM(C:=C+1,R:=R+1);                                    03487500
              BEGIN DS:=LIT """; DS:=7 LIT "-*!#!#~";                   03487600
                   DI:=C; DS:=2 LIT "%~";                               03487700
              END;                                                      03487800
              M[R]:=(*P(DUP))&0[4:4:44]&L[10:40:8];                     03487900
              ENTERLINEQ(C,L,1);                                        03488000
              GO TO ENDIT;                                              03488100
    END; END;                                                           03488200
    IF (T:=STATABLE[S]).DIALEDUP THEN                                   03488300
    BEGIN                                                               03489000
         IF CANDYINX!0 THEN                                             03490000
         BEGIN                                                          03491000
              M[R]:=(*P(DUP))&0[4:4:44]&                                03492000
              (S&6[33:41:7])[CTF];                                      03493000
              QUEVENT(R,CANDEMIX[S]);                                   03494000
         END ELSE FORGETAREA(M[R].[2:2],R);                             03495000
         STATABLE[S]:=T&0[15:46:2];                                     03496000
         LSTATUS[L]:=DISCON;                                            03497000
         FORK(P(.QUITTER),L&S[CTF],-2,96,0);                            03498000
    END ELSE                                                            03499000
    BEGIN                                                               03499100
         FORGETAREA(M[R].[2:2],R);                                      03499200
         LINETABLE[L]:=(*P(DUP))&(IF (T:=P(DUP).LINEDIS)!CONTENTION     03499300
                   THEN IDL ELSE WAITINGENQ)[21:43:5];                  03499400
         IF T=MULTI AND SEQARRAY[L].[32:8]!L THEN ENTEREADYQ(L);        03499450
    END;                                                                03499500
ENDIT:                                                                  03500000
    KILL([RCW] INX NOT 2);                                              03501000
END DCTIMEOUT;                                                          03502000
PROCEDURE NOTIFYCANDE;                                                  03504000
    BEGIN ARRAY S[*];                                                   03505000
         REAL T=S,RCW=+0;                                               03506000
         IF (DISKADR:=DISKADR+FIRSTSEG[0].[17:1]) GEQ TANKCHUNKSIZE THEN03507000
         BEGIN                                                          03508000
              M[T:=GETAREA(0)]:=(*P(DUP))&5[18:41:7];                   03509000
              M[T+1]:=BASEDISKADR:=GETUSERDISK(-TANKCHUNKSIZE);         03510000
              QUEVENT(T,CANDYINX);                                      03511000
              DISKADR:=0;                                               03512000
         END;                                                           03513000
         IF (M[FIOADR] AND IOMASK)=0 THEN SLEEP([M[FIOADR]],IOMASK);    03514000
         S:=[M[FIOADR]];                                                03515000
         DISKIO(S,FIRSTSEG.[CF]-1,30,BASEDISKADR+DISKADR);              03516000
$INCLUDE 03516101, IF STATISTICS;                                       03516099
         COUNTUP(16,1);                                                 03516100
         M[T:=GETAREA(0)]:=(*P(DUP))&7[18:41:7];                        03517000
         M[T+1]:=FIRSTOFFSET;                                           03518000
         M[T+2]:=FIRSTSEG[0].[40:8]-FIRSTOFFSET+1;                      03519000
         M[T+3]:=DISKADR;                                               03520000
         QUEVENT(T,CANDYINX);                                           03521000
         IF (LASTSEG INX 0) = (FIRSTSEG INX 0) THEN                     03537000
         BEGIN                                                          03538000
              FIRSTOFFSET ~ LASTOFFSET;                                 03542000
         END ELSE                                                       03543000
         BEGIN                                                          03544000
              FIRSTOFFSET ~ 1;                                          03545000
              FIRSTSEG.[CF] ~ FIRSTSEG[0].[FF];                         03546000
         END;                                                           03547000
         KILL([RCW] INX NOT 2);                                         03548000
  END NOTIFYCANDE;                                                      03549000
$OMIT 03555901, IF DCP;                                                 03549999
PROCEDURE PAPERTAPEIO(R,STA,FLAGS,BUFSZ,MI); % HANDLES END OF MESSAGE   03550000
VALUE R,STA,FLAGS,BUFSZ,MI;                                             03550100
REAL  R,STA,FLAGS,BUFSZ,MI;                                             03550200
BEGIN LABEL READIT;                                                     03550300
    DEFINE DELETE = [4:1]#;                                             03550400
    REAL TEMP,J,X;                                                      03550500
    SUBROUTINE PAPERTAPEDISKIO;                                         03550600
    BEGIN                                                               03550700
$INCLUDE 03550711, IF STATISTICS;                                       03550709
         COUNTUP(16,1);                                                 03550710
         DISKIO(M[R-2],R-1,(X+7) DIV 8 + 1,PROGTANK+                    03550800
                CLUMPSIZE|STA+(((X:=J.INPUTN+TEMP.[10:8])+J.INPUTL)     03550900
                AND NOT CLUMPSIZE));                                    03551000
         J:=J&(X+1)[40:40:8];                                           03551100
         IF INPUTANK[STA].INPUTREADY THEN                               03551200
         BEGIN BRINGBACK(STATABLE[STA].MIXNR);                          03551300
              J.INPUTREADY:=0;                                          03551400
         END;                                                           03551500
         M[R-3].[10:8]:=0;                  % RESET DELETE POINTER      03551550
         IF (X:=TEMP.[CF]-2) GTR 0 THEN                                 03551600
         BEGIN M[X-1]:=M[R-3];                                          03551650
              IF (M[X] AND IOMASK)=0 THEN SLEEP([M[X]],IOMASK);         03551700
         END;                                                           03551750
    END;                                                                03551800
%                                                                       03551900
    J:=INPUTANK[STA];                                                   03552000
    TEMP:=M[R];                                                         03552100
    IF MI.DELETE THEN                % DELETE - RESET PTRS TO PREV MESS 03552200
    BEGIN IF (X:=M[R-3])=0 THEN ELSE GO READIT; % WE HAVE A PREV MESS   03552300
         IF TEMP.[CF]!0 THEN                   % TRY THE OTHER AREA     03552400
         IF (X:=M[R-3]:=M[TEMP.[CF]-3])!0 THEN % IF THERE IS ONE.       03552500
READIT:  IF X.[10:8]!TEMP.[10:8] THEN          % ETX IN A PREVOIUS SEG  03552600
$INCLUDE 03552691, IF STATISTICS;                                       03552689
         BEGIN COUNTUP(16,1);                                           03552690
         DISKWAIT(-R,30,PROGTANK+CLUMPSIZE|STA+(J.INPUTN+J.INPUTL+      03552700
                   X.[10:8]) AND NOT CLUMPSIZE);                        03552800
$INCLUDE 03552811, IF STATISTICS;                                       03552809
         END;                                                           03552810
         M[R]:=(*P(DUP))&X[10:10:23];            % REST TO PREVIOUS ~   03552900
         P(XIT);                                                        03553000
    END;                                                                03553100
    INPUTANK[STA]:=NABS(J);                % NOT DELETE - LOCK INPUTANK 03553200
    STREAM(A:=(P(TEMP.[FF]-BUFSZ,DUP).[33:12]+R+1)&P(XCH)[30:45:3] :);  03553300
    BEGIN SI:=A;                          % FIND THE LEFT ARROW         03553400
      L: IF SC!"~" THEN BEGIN SI:=SI+1; GO TO L END;                    03553500
         A:=SI;                                                         03553600
    END;                                                                03553700
    X:=P(DUP).[30:3]&(P(XCH)-R-1)[30:33:15]+1;                          03553800
    M[R-3]:=M[R]:=TEMP&X[CTF];             % SET CHAR COUNT TO ~ AND    03553900
    IF TEMP.[CF]!0 THEN M[TEMP.[CF]-3]:=M[R];   % SAVE FOR DELETE       03554000
    IF FLAGS=4 THEN                  % QUESTION MARK - END OF PAPER TAPE03554100
    BEGIN PAPERTAPEDISKIO;                 % WRITE IT, SWAP AND UP TANK 03554200
         IF X GTR 0 THEN FORGETSPACE(X);   % FORGET THE PREVIOUS BUFFER 03554300
         SLEEP([M[R-2]],IOMASK);           % WAIT FOR CURRENT I/O THEN  03554400
         FORGETSPACE(R-2);                 % FORGET THE BUFFER          03554500
         PAPERTAPE[STA]:=FALSE;                                         03554600
$OMIT 03554701, IF TWXONLY;                                             03554699
         IF STATABLE[STA].STATIONTYPE=TWX THEN                          03554700
         TWXOUT(0,0,1,STA)                                              03554800
    END ELSE                         % NOT END - TEST FOR SWAP IN       03555200
    IF TEMP.[10:8] GEQ CLUMPSIZE DIV 2 THEN                             03555300
    BEGIN PAPERTAPEDISKIO;                 % WRITE IT OUT, SWAP, UP TANK03555400
         J.[FF]:=X+2;                      % REUSE OLD ARRAY            03555500
         M[X+2]:=0&R[CTC]&1[2:47:1];                                    03555600
    END ELSE J.[FF]:=R;                    % RESET TO CURRENT BUFFER    03555700
    INPUTANK[STA]:=NABS(J);                                             03555800
END PAPERTAPEIO;                                                        03555900
     % SENDS OUT STANDARD RESPONSE TO WRU ENQUIRY FOR GIVEN LINE        03572000
PROCEDURE HELLO(K);                                                     03573000
VALUE K; REAL K;                                                        03574000
        BEGIN REAL I,J,L,V,B;                                           03575000
              REAL RCW=+0;                                              03576000
              ARRAY A=B[*];                                             03577000
$INCLUDE 03588501, IF DCP;                                              03577999
              REAL C;                                                   03578000
              LABEL EXIT;                                               03578250
%                                                                       03578500
%   M[K+1].[CF] IS THE STATION NUMBER. IF 0, IT MEANS THAT ALL          03578550
%   INTERNAL STATION NUMBERS ARE ACTIVE SO WE INFORM THE USER AND,      03578600
%   IF HE IS THE ONLY ONE ON THE LINE, DISCONNECT HIM.                  03578650
%                                                                       03578700
              L:=M[K+2];                                                03578750
              IF (I:=M[K+1].[CF])=0 THEN                                03579000
              BEGIN                                                     03579250
                   M[B:=GETAREA(1)]:=0&5[3:45:3];                       03579500
                   M[B+1]:=0&OUTPUT[1:41:7]&L[24:24:16]                 03579750
                     &44[40:40:8];                                      03580000
                   STREAM(D:=B+3);                                      03580250
                   BEGIN DS:=18 LIT"!-!*SYSTEM FULL - ";                03580500
                        DS:=26 LIT"PLEASE CALL BACK LATER!-!*";         03580750
                   END;                                                 03581000
                   DCPQ(B);                                             03581250
                   CLICK:=CLOCK+P(RTR)+240;      % WAIT FOR MESSAGE     03581500
                   SLEEP(0,0);                   % THEN CHECK LINE TABLE03581750
                   STREAM(N:=L.[30:2]:D:=LINETABLE+L.[24:6]);           03582000
                   BEGIN SI:=D; SI:=SI+N; SI:=SI+N;                     03582250
                        DI:=LOC N; DI:=DI+6; DS:=2 CHR;                 03582500
                   END;                                                 03582750
                   IF (V:=P)=0 THEN         % NO OTHER STATIONS, DISCNCT03583000
                   BEGIN M[B:=GETAREA(0)]:=0&1[5:47:1];                 03583250
                        M[B+1]:=0&L[24:24:16]&DISCONNECT[1:41:7];       03583500
                        DCPQ(B);                                        03583750
                        M[B:=GETAREA(0)]:=0&1[5:47:1];                  03584000
                        M[B+1]:=0&L[24:24:16]&LOOKFORRING[1:41:7];      03584250
                        DCPQ(B);                                        03584500
                   END;                                                 03584750
                   GO TO EXIT;                                          03585000
              END;                                                      03585500
              B:=SPACE(30);                                             03586000
              DISKWAIT(-B,30,TNAOG[0]+(V:=(J:=L.[24:8]+1) DIV 30));     03586500
              V:=M[B+J-30|V];                                           03587000
              FORGETSPACE(B);                                           03587500
              STATABLE[I]:=(*P(DUP))&V[11:21:2];                        03588000
              B:=GETAREA(1)+1;                                          03588500
$OMIT 03595621, IF DCP;                                                 03588899
              IF NOT(LINETABLE[J:=M[K+2]].DIRECTLINE) THEN              03589000
              IF (I~M[K]+256) GTR CLOCK+P(RTR) THEN                     03590000
              BEGIN                                                     03591000
                   CLICK~I;                                             03592000
                   SLEEP(0,0);                                          03593000
              END;                                                      03594000
              IF DISCONNECTING[I:=M[K+1]] THEN                          03595000
              SLEEP([STATABLE[I]],@0000020000000000);                   03595500
              %BE SURE WE ARE THRU DISCONNECTING PREVIOUS USER          03595510
              CONNECT(I); %MARK DIALED UP AND ATTACH TO CANDE           03595520
              STREAM(TU~(L:=LINETABLE[J]).[9:4],BU~L.[14:4],            03595530
                    LINE:=I,QQQ:=B:=GETAREA(1)+1);                      03595540
              BEGIN                                                     03595550
                   DS:=24 LIT"-*!B5500 TIME SHARING - ";                03595560
                   SI:=LOC TU; DS:=2 DEC; DS:=LIT"/"; DS:=2 DEC;        03595570
                   DS~10 LIT ", STATION ";DS~2 DEC;                     03595580
                   DS:=4 LIT "!-*~";                                    03595590
              END;                                                      03595600
              TWXOUT(B,63,0&3[1:46:2],I);                               03595620
              % NEXT LET CANDE IN ON WHATS HAPPENING                    03595630
              IF CANDYINX ! 0 THEN                                      03595640
              BEGIN                                                     03595650
                   M[V:=GETAREA(0)]:=(*P(DUP))&(I&1[33:41:7])[CTF];     03595660
$INCLUDE 03595666, IF DCP;                                              03595664
                   M[V+2]:=0;     % ALL STAS LOOK LIKE TWX WITH DCP     03595665
$OMIT 03595671, IF DCP;                                                 03595669
                   M[V+2]:=STATABLE[I].[10:3]; %STATION TYPE            03595670
                   QUEVENT(V,CANDEMIX[I]);                              03595680
              END ELSE                                                  03595690
$INCLUDE 03595701, IF DCP;                                              03595699
              IF L.[1:7]!INPUT AND L.[1:7]!ENABLEDINPUT THEN            03595700
              BEGIN STREAM(B);                                          03595750
                   DS:=27 LIT"CANDE IS DOWN...PLEASE WAIT";             03595800
                   TWXOUT(B,27,1,I);                                    03595900
              END;                                                      03596000
              A := IOQUE&B[CTC]&SYSDISKRL[8:38:10];   % < 9 WORDS LONG  03596100
              SYSDISKIO(3,-I,A);                                        03596200
$OMIT 03596301, IF DCP;                                                 03596299
              A[0].DIALEDUP ~ 1;                                        03596300
$INCLUDE 03596351, IF DCP;                                              03596349
              A[0]:=STATABLE[I];                                        03596350
              SYSDISKIO(0,-I,A);       %UPDATE SYSTEM DISK              03596400
              FORGETAREA(1,A.[CF]-1);                                   03596500
$INCLUDE 03597001, IF DCP;                                              03596999
    EXIT:                                                               03597000
              FORGETAREA(0,K);                                          03598000
              KILL([RCW] INX NOT 2);                                    03598200
  END HELLO;                                                            03599000
$ INCLUDE 03601501, IF SHAREDISK;                                       03599999
PROCEDURE LOCKER(SEGMENT,LOCK);                                         03600000
    VALUE SEGMENT,LOCK; REAL SEGMENT,LOCK;                              03600100
    COMMENT IF LOCK IS TRUE, THEN A READ LOCK OF 0 WORDS IS             03600110
            PERFORMED ON SEGMENT. IF LOCK IS FALSE, AN UNLOCK           03600120
            IS PERFORMED ON SEGMENT;                                    03600130
BEGIN                                                                   03600200
    REAL T;                                                             03600300
    IF LOCK THEN DISKWAIT([T] INX 1,-0,SEGMENT) ELSE                    03600400
    BEGIN;                                                              03600500
         STREAM(SEGMENT,D:=[T]);                                        03600600
         BEGIN SI:=LOC SEGMENT; DS:=8 DEC END;                          03600700
         T:=T OR @2060;                                                 03600800
         P(WAITIO([T] INX @100000000,0,18),DEL);                        03600900
    END;                                                                03601000
END; % LOCKER                                                           03601100
DEFINE LOCK(LOCK1)=LOCKER(LOCK1,1)#;                                    03601200
DEFINE UNLOCK(UNLOCK1)=LOCKER(UNLOCK1,0)#;                              03601300
$OMIT 03691001, IF DCP;                                                 03607999
  PROCEDURE OLDWIERDHAROLD;                                             03608000
     % DOES MANY STRANGE AND WONDEROUS THINGS.                          03609000
      % SOME OF THEM USEFUL.                                            03610000
  BEGIN                                                                 03611000
    REAL RCW = +0;                                                      03612000
    REAL STA;                         % FIRST SO COM5 CAN FIND IT       03612100
    REAL H,I,J,K,R,S,T,T1,STATAB,SOURCE,NUM,FLAGS;                      03613000
$OMIT 03613101, IF TWXONLY;                                             03613099
    BOOLEAN UPQFLAG;                                                    03613100
    REAL MODE=K,BUFSZ=T;                                                03614000
    DEFINE CREND     = [46:1]#,                                         03614100
           DISKDONE  = (H+31)#,                                         03614200
           DELETE    = [4:1]#,                                          03614300
           COUNTEND  = [45:1]#;                                         03614400
    DEFINE PAPERTAPE = (STATAB LSS 0)#;                                 03614500
    LABEL RESTART,START,LOOP,DELL,CE,AGAIN,PT,DELINKIT;                 03615000
$OMIT 03615101, IF TWXONLY;                                             03615099
    LABEL NORMALQ,CR,SCANIT;                                            03615100
    LABEL DISCARD;   %USED TO LEAVE BACKUP SPO CODE                     03615200
    SUBROUTINE UPQ;                                                     03616000
$OMIT 03616801, IF TWXONLY;                                             03616099
    BEGIN IF UPQFLAG THEN                   % SCANNING 30 WORD ARRAYS   03616100
         BEGIN FORGETSPACE(I-2);                                        03616200
              IF (I:=M[I].[CF])=0 THEN      % LAST ARRAY                03616300
              BEGIN UPQFLAG:=0;             % RESET FLAGS AND I         03616400
                   MODE:=1;                  %MAKE SURE WE STOP         03616430
                   GO TO NORMALQ;                                       03616500
              END;                                                      03616600
              BUFSZ:=M[I].[FF];             % NUM OF CHARS IN ARRAY     03616700
         END ELSE                           % DATACOM INPUT BUFFERS     03616800
         BEGIN INPUTANK[STA]:=(*P(DUP))&(M[I].[4:2]!0)[35:47:1];        03616900
              WORKERINQ.[CF]:=M[I].[CF];                                03617000
              FORGETAREA(M[I].[2:2],I);                                 03617100
$INCLUDE 03617301, IF TWXONLY;                                          03617199
              SOURCE:=(I:=WORKERINQ.[CF])+1;                            03617200
          END;                                                          03617300
$OMIT 03618401, IF TWXONLY;                                             03617399
NORMALQ:      I:=WORKERINQ.[CF];                                        03617400
         END;                                                           03617500
         SOURCE:=I+1;                                                   03617600
         T1:=0;                              % SET SOURCE CHARS SCANNED 03617700
    END;                                                                03617800
%                                                                       03617900
    SUBROUTINE SCANINPUT;               % SCANS INPUT FOR CANDE         03618000
    BEGIN                               % T1 IS SOURCE CHARS SCANNED    03618100
         NUM:=NUM+INPUTSCAN(MODE,SOURCE,J,BUFSZ-T1,FLAGS);              03618200
         T1:=SOURCE.[30:3]&(SOURCE.[CF]-I-1)[30:33:15];                 03618300
    END;                                                                03618400
%                                                                       03618500
    SUBROUTINE GETANOTHER;                                              03618600
    BEGIN                              % T1 IS OLD OBJ JOB BUFFER       03618700
         INPUTANK[STA].[FF]:=R:=(IF T1 GTR 0 THEN T1 ELSE SPACE(32))+2; 03618800
         M[R-2]:=IOMASK;                                                03618900
    END;                                                                03619000
%                                                                       03619100
    SUBROUTINE OBJOBDISKER;            % DISKIO FOR INPUT TO JOBS       03619200
    BEGIN                                                               03619300
         J:=INPUTANK[STA]:=ABS(*P(DUP));                                03619400
         DISKIO(M[R-2], R-1, (M[R].[FF]+7) DIV 8+1, PROGTANK+           03619500
               CLUMPSIZE|STA+((K:=J.INPUTN+M[R].[10:8])+J.INPUTL        03619600
               AND NOT CLUMPSIZE));                                     03619700
$INCLUDE 03619711, IF STATISTICS;                                       03619709
         COUNTUP(16,1);                                                 03619710
         IF M[R] LSS 0 THEN J:=J&(K+1)[40:40:8];     % UP INPUTANKS     03619800
         IF (T1:=M[R].[CF]-2) GTR 0 THEN         % WAIT FOR PREVIOUS I/O03619900
         IF (M[T1] AND IOMASK) = 0 THEN SLEEP([M[T1]],IOMASK);          03620000
         IF J.INPUTN GEQ .9|CLUMPSIZE THEN       % TOO FULL, SLOW HIM BY03620100
         IF NOT J.SLOWDOWN THEN                  % MESSAGE IF TWX OR NO 03620200
$OMIT 03620301, IF TWXONLY;                                             03620299
         BEGIN IF STATAB.STATIONTYPE=TWX THEN    % ACK IF NOT TWX       03620300
              BEGIN STREAM(D:=(K:=GETAREA(0))+1);                       03620400
              DS:=11 LIT"PLEASE WAIT";                                  03620500
              TWXOUT(K+1,12,1,STA);                                     03620700
                   FORGETAREA(0,K);                                     03620800
$OMIT 03620901, IF TWXONLY;                                             03620899
              END ELSE TANKOK[STA]:=1;                                  03620900
              J.SLOWDOWN:=1;                                            03621000
         END ELSE                                                       03621100
         IF J.INPUTN=CLUMPSIZE-1 THEN TERMINATE(STATAB.MIXNR&67[CTF]);  03621200
         INPUTANK[STA]:=NABS(J);            % UPDATE AND UNLOCK INPUTANK03621300
   END OF OBJECT JOB INPUT TANK HANDLER;                                03621400
%                                                                       03621500
RESTART::                                                               03621600
    SOURCE:=(I:=WORKERINQ.[CF])+1;     % HEAD OF INPUT QUEUE            03621700
START:                                                                  03621800
    IF I!0 THEN                        % INPUT FROM DATACOM TO PROCESS  03621900
    BEGIN                                                               03622000
         IF (STA:=M[I].LINENR)=0 THEN       % SS OR CX FROM SPO         03622100
         BEGIN STATAB:=0;                                               03622200
              BUFSZ:=152;                                               03622300
              GO TO CE;                                                 03622400
         END;                                                           03622500
         IF (STATAB:=STATABLE[STA]).OWHTHROWOUT THEN                    03622600
         BEGIN                             % RESET ON DELETE OR MESSEND 03622700
              STATABLE[STA]:=STATAB&(M[I].[4:2]=0)[13:47:1];            03622800
              GO TO DELL;                  % IGNORE THIS BUFFER         03622900
         END;                                                           03623000
$OMIT 03623401, IF TWXONLY;                                             03623099
         BUFSZ:=28|(IF P(LINETABLE[IF STA GTR LMAX THEN STATAB.LEENKER  03623100
            ELSE STA].BUFSIZE,DUP)=2 THEN P+2 ELSE P+1);                03623200
         IF NOT (FLAGS:=STATAB.CANDEFLAG OR M[I].[6:1]) OR              03623300
         (K:=STATAB.STATIONTYPE!TWX) THEN ELSE GO TO CE;                03623400
$INCLUDE 03623701, IF TWXONLY;                                          03623499
          BUFSZ:=28|(IF P(LINETABLE[STA].BUFSIZE,DUP)=2 THEN P+2 ELSE   03623500
                     P+1);                                              03623600
          IF STATAB.CANDEFLAG THEN GO TO CE;                            03623700
%                                                                       03623800
%                        OBJECT JOB OR NOT TELETYPE                     03623900
%                                                                       03624000
         T1:=0;                                                         03624100
         IF INPUTANK[STA].FIRSTBUF THEN     % SCAN OUT HEADER AND QM    03624200
$INCLUDE 03624501, IF TWXONLY;                                          03624299
         IF (P(M[SOURCE],TOP,XCH).[1:5] = @14) AND P THEN   % QUEST MARK03624300
         IF PAPERTAPE THEN FLAGS:=4 ELSE GO TO CE;                      03624400
         NUM:=BUFSZ;                                                    03624500
$OMIT 03625901, IF TWXONLY;                                             03624599
         BEGIN STREAM(SOURCE,K:);                                       03624600
              BEGIN SI:=SOURCE;                                         03624700
                   K(28(IF SC=""" THEN BEGIN SI:=SI+1; JUMP OUT END;    03624800
                        SI:=SI+1;);                                     03624900
                     SOURCE:=SI;                                        03625000
                     IF SC!"!" THEN JUMP OUT TO L;                      03625100
                     SI:=SI+1);                                         03625200
                   IF SC=MARK THEN TALLY:=1;                            03625300
                L: K:=TALLY;                                            03625400
              END;                                                      03625500
              IF P THEN FLAGS:=4;          % QM FLAG                    03625600
              NUM:=ABS((SOURCE:=P).[30:3]&(SOURCE-I-1)[30:33:15]-BUFSZ);03625800
         END ELSE NUM:=BUFSZ;                                           03625900
         IF (R:=INPUTANK[STA].[FF])=0 THEN       % GET A NEW BUFFER     03626000
         BEGIN GETANOTHER;                                              03626100
              M[R]:=0&STATAB[2:1:1];             % PAPER TAPE FLAG      03626200
         END;                                                           03626300
LOOP:                                                                   03626400
         IF (S:=M[I]).DELETE THEN                                       03626500
         BEGIN UPQ;                                                     03626600
              IF PAPERTAPE THEN GO TO PT;                               03626700
              DO BEGIN                      % FORGET ALL PIECES OF      03626800
                   SLEEP([M[R-2]],IOMASK);  % CURRENT MESSAGE           03626900
                   FORGETSPACE(R-2);                                    03627000
              END UNTIL (R:=M[R].[CF])=0;                               03627100
              INPUTANK[STA].[FF]:=0;                                    03627200
              GO TO START;                                              03627300
         END;                                                           03627400
         IF M[R].[FF]+NUM GTR 232 THEN           % OUT OF ROOM          03627500
$INCLUDE 03627551, IF TWXONLY;                                          03627549
         BEGIN OBJOBDISKER;                                             03627550
$OMIT 03627601, IF TWXONLY;                                             03627599
         BEGIN IF NOT FLAGS THEN OBJOBDISKER;    % IF OBJ, WRITE IT OUT 03627600
              K:=R;                              % GET A NEW ONE AND    03627700
              GETANOTHER;                        % SET FIRST WORD       03627800
              M[R]:=0&K[CTC]&(M[K].[10:8]+1)[10:40:8]&STATAB[2:1:1];    03627900
         END;                                                           03628000
%                                                                       03628100
         STREAM(N:=NUM DIV 2, SOURCE,                                   03628200
$OMIT 03628301, IF TWXONLY;                                             03628299
                 N1:=NUM AND 1,                                         03628300
                 D:=(R+1+M[R].[18:12])&M[R][30:30:3]);                  03628400
         BEGIN SI:=SOURCE;                                              03628500
               DS:=N CHR; DS:=N CHR;                                    03628600
$OMIT 03628701, IF TWXONLY;                                             03628699
               DS:=N1 CHR;                                              03628700
         END;                                                           03628800
         M[R]:=(*P(DUP))&(P(DUP).[FF]+NUM)[CTF] OR 0&S[4:4:3];          03628900
         UPQ;                                                           03629000
         IF NOT S.MESSEND THEN              % MORE MESSAGE TO COME      03629100
         IF M[I].LINENR=STA AND I!0 THEN    % GO GET NEXT BUFFER        03629200
$INCLUDE 03629301, IF TWXONLY;                                          03629299
         GO TO LOOP ELSE GO START;                                      03629300
$OMIT 03629601, IF TWXONLY;                                             03629399
         BEGIN NUM:=BUFSZ;                                              03629400
              GO TO LOOP;                                               03629500
         END ELSE GO TO START;              % NO MORE FOR THIS STA NOW  03629600
         INPUTANK[STA].[FF]:=0;                                         03629700
         IF PAPERTAPE THEN                  % SPECIAL HANDLING TO PACK  03629800
         BEGIN                              % PAPER TAPE INPUT          03629900
PT:           PAPERTAPEIO(R,STA,FLAGS,BUFSZ,S);                         03630000
              GO TO START;                                              03630100
         END;                                                           03630200
$OMIT 03630401, IF TWXONLY;                                             03630299
         IF FLAGS=0 THEN                    % INPUT GOES TO OBJECT JOB  03630300
         BEGIN                                                          03630400
              M[R]:=NABS(*P(DUP));          % 1:1 CAUSES INPUTANK TO    03630500
              OBJOBDISKER;                  % BE UPDATED                03630600
              IF T1 GTR 0 THEN FORGETSPACE(T1);  % FORGET OLD BUFFER    03630700
              IF J.INPUTREADY THEN               % IF IT IS WAITING     03630800
              BEGIN BRINGBACK(STATAB.MIXNR);     % SWAP IT IN           03630900
                   INPUTANK[STA].INPUTREADY:=0;                         03631000
              END;                                                      03631100
              SLEEP([M[R-2]],IOMASK);            % WAIT FOR LAST I/O    03631200
              FORGETSPACE(R-2);                                         03631300
              GO TO START;                                              03631400
$OMIT 03631501, IF TWXONLY;                                             03631499
         END;                                                           03631500
%                                                                       03631600
%                        INPUT GOES TO CANDE                            03631700
%                                                                       03631800
$OMIT 03632701, IF TWXONLY;                                             03631899
         UPQFLAG:=1;                        % SET TO USE 30 WORD ARRAYS 03631900
         I:=0;                                                          03632000
         DO                                 % RELINK QUEUE IN FORWARD   03632100
         BEGIN J:=M[R].[CF];                % DIRECTION                 03632200
              M[R].[CF]:=I;                                             03632300
              I:=R;                                                     03632400
         END UNTIL (R:=J)=0;                                            03632500
         BUFSZ:=M[I].[FF];                  % NUM OF CHARS IN ARRAY     03632600
         SOURCE:=I+1;                                                   03632700
CE:      IF H=0 THEN H:=SPACE(60);                                      03632800
$INCLUDE 03632901, IF TWXONLY;                                          03632899
         FLAGS:=3&(H+1)[CTF]&M[I][1:6:1];                               03632900
$OMIT 03633201, IF TWXONLY;                                             03632999
         FLAGS:=3&(H+1)[CTF]&M[I][1:6:1]&STATAB[33:10:3];               03633000
         MODE:=T1:=0;                                                   03633100
CR:      IF T1=BUFSZ THEN UPQ;              % CR AT END OF BUFFER       03633200
         NUM:=0;                                                        03633300
         J:=H+1;                                                        03633400
AGAIN:                                                                  03633500
         IF M[I].DELETE THEN                                            03633600
         BEGIN                                                          03633700
DELL:         UPQ; GO TO START;                                         03633800
         END;                                                           03633900
$INCLUDE 03634001, IF TWXONLY;                                          03633999
         NUM:=NUM+INPUTSCAN(MODE,SOURCE,J,BUFSZ,FLAGS);                 03634000
$OMIT 03634101, IF TWXONLY;                                             03634099
         SCANINPUT;                                                     03634100
         IF NUM GEQ 224 THEN                % TOO LONG FOR CANDE        03634200
         BEGIN STREAM(D:=H+29);             % CUT IT DOWN TO HER SIZE   03634300
              BEGIN DI:=DI-1; DS:=LIT"~"; END;                          03634400
              NUM:=224;                                                 03634500
         END ELSE                                                       03634600
$OMIT 03634701, IF TWXONLY;                                             03634699
         IF NOT MODE.CREND THEN             % ETX OR COUNT EXHAUSTED    03634700
         BEGIN UPQ;                                                     03634800
              IF NOT MODE THEN              % COUNT EXHAUSTED           03634900
              IF I!0 THEN                                               03635000
$OMIT 03635101, IF TWXONLY;                                             03635099
              IF M[I].LINENR=STA OR UPQFLAG THEN GO AGAIN;              03635100
$INCLUDE 03635201, IF TWXONLY;                                          03635199
              IF M[I].LINENR = STA THEN GO AGAIN;                       03635200
         END;                                                           03635300
         IF ABS(SPOWORD) = STA AND STA NEQ 0 THEN  %BACK UP SPO         03635305
         BEGIN M[H-1]:=0;                                               03635310
              IF KEYBOARDCOUNTER = 0 THEN                               03635315
              FORK(P(.KEYIN),1&(H+1)[CTF],0,192,0) ELSE                 03635320
              IF (R:=KEYBOARDCOUNTER.[FF]) NEQ 0 THEN                   03635325
              BEGIN IF (J:=M[R-2].[CF]) NEQ 0 THEN                      03635330
                   IF M[(R:=J)-2] NEQ 0 THEN GO TO DISCARD;             03635335
                   M[R-2]:=H+1;                                         03635340
              END ELSE KEYBOARDCOUNTER:=KEYBOARDCOUNTER&(H+1)[CTF];     03635345
              KEYBOARDCOUNTER:=KEYBOARDCOUNTER&1[17:47:1];              03635350
              H:=SPACE(60);                                             03635355
              GO TO DISCARD;                                            03635360
         END;                                                           03635365
%                       WE HAVE SCANNED INPUT STARTING AT H+1           03635400
         IF (P(M[H+1],TOP,XCH).[1:5] = @14) AND P THEN     % QUEST MARK 03635500
           FLAGS:=NABS(FLAGS);                                          03635600
         IF (R:=(NUM+7) DIV 8)+LASTOFFSET GTR 29 THEN      % NO ROOM    03635700
         BEGIN IF CANDEINPUTREADY THEN          % REUSE CURRENT AREA    03635800
              BEGIN IF (M[IOADR] AND IOMASK) = 0 THEN                   03636000
                   SLEEP([M[IOADR]],IOMASK);                            03636500
                   FIRSTOFFSET:=1;                                      03637000
              END ELSE                         % GET A NEW ONE          03637500
              BEGIN                                                     03638000
                   LASTSEG[0].[FF] := (S:=SPACE(32))+2;                 03638500
                   M[S] := IOMASK;                                      03639000
                   LASTSEG.[CF]:=S+2;                                   03639500
              END;                                                      03640000
              LASTSEG[0]:=0&1[17:47:1];                                 03640500
              LASTOFFSET := 1;                                          03641000
         END;                                                           03641500
         STREAM(MA:=H+1,R,N:=[LASTSEG[LASTOFFSET+1]]);                  03642000
         BEGIN SI:=MA; DS:=R WDS END;                                   03642500
         LASTSEG[LASTOFFSET]:=NUM&FLAGS[1:1:1]&STA[10:40:8];            03643000
         LASTOFFSET.[CF]:=(LASTSEG[0]:=(*P(DUP))&(LASTOFFSET+R)[CTC])+1;03643500
         IF CANDEINPUTREADY THEN    % IF CANDE WANTS IT, GIVE IT TO HER 03644000
         BEGIN FORK(P(.NOTIFYCANDE),CANDYINX,0,0,1);                    03644500
                                    % OLDWEIRDHAROLD IS A MOTHER FORKER 03645000
               CANDEINPUTREADY:=FALSE;                                  03645500
         END;                                                           03646000
DISCARD:                                                                03646100
$OMIT 03651501, IF TWXONLY;                                             03646499
         IF MODE.COUNTEND THEN         % INPUT WAS TOO LONG  SOME LEFT  03646500
         IF UPQFLAG THEN                    % QM OR NOT TWX             03647000
         BEGIN                              % SCAN TO ETX OR CR         03647500
SCANIT:       J:=H+1;                                                   03648000
              SCANINPUT;                                                03648500
              IF NOT MODE.CREND THEN                                    03649000
              BEGIN UPQ;                                                03649500
                   IF MODE THEN ELSE GO SCANIT;   % COUNTEND - TRY AGAIN03650000
              END;                                                      03650500
         END ELSE STATABLE[STA].OWHTHROWOUT:=1;   % TWX - DISCARD BUFFS 03651000
         IF MODE.CREND THEN GO TO CR ELSE GO TO START;                  03651500
$INCLUDE 03652501, IF TWXONLY;                                          03651999
         IF MODE.COUNTEND THEN STATABLE[STA].OWHTHROWOUT:=1;            03652000
         GO TO START;                                                   03652500
%                                                                       03653000
    END OF INPUT HANDLING;                                              03653500
%                                                                       03654000
%         WHEN INPUT QUEUE IS EMPTY, DETANK OUTPUT                      03654500
%                                                                       03655000
              IF (STA:=HEADOUT) ! 0 THEN         % OUTPUT TO DETANK     03655500
              BEGIN                                                     03656000
                   IF H=0 THEN H:=SPACE(60);                            03656500
                   IF NOT TANKS[STA].[1:1] THEN                         03657000
                        SLEEP([TANKS[STA]],NABS(0));                    03657500
                   STATAB:=STATABLE[STA];                               03658000
                   T:=TANKS[STA]:=ABS(*P(DUP));                         03658500
                   IF T1:=(T.[SOUSE]=0) THEN %NUTHIN ON DISK            03659000
                   IF T1:=(T.[CF]=0) OR STATAB.SWAPPED                  03659500
                      THEN GO DELINKIT ELSE                             03659600
                   IF T1:=(M[T]=0) THEN GO DELINKIT ELSE                03660000
                   BEGIN                                                03660500
$OMIT  03662501,  IF TWXONLY;                                           03660590
                      IF STATAB.STATIONTYPE NEQ TWX THEN                03660600
                      BEGIN DISKWAIT(T.[CF],30,GLOMSIZE|STA+            03661000
                                     TANKS[STA].[14:5]+TANKADDRESS);    03661500
$INCLUDE 03661511, IF STATISTICS;                                       03661509
                             COUNTUP(16,1);                             03661510
                            T:=TANKS[STA]:=(*P(DUP))&1[19:34:14]; %TANK 03662000
                      END;                                              03662500
                      I:=M[J:=T.[CF]].[CF];    %TAKE IT                 03663000
                      M[J]:=0;                   %FROM CORE             03663500
                   END ELSE      % DRAIN THE DISK                       03664000
                   BEGIN  J:=T.[19:8];                                  03664500
                       DISKWAIT(-H,30,GLOMSIZE|STA+T.[14:5]+            03665000
                                TANKADDRESS);                           03665500
$INCLUDE 03665511, IF STATISTICS;                                       03665509
                       COUNTUP(16,1);                                   03665510
$OMIT  03666501,  IF TWXONLY;                                           03665590
                       IF STATAB.STATIONTYPE = TWX THEN                 03666000
                         BEGIN                                          03666500
                         I:=M[H] - J + 1;                               03666600
                         IF I GTR 56|(R:=1+(LINETABLE[IF STA GTR LMAX   03667000
                                  THEN STATAB.LEENKER ELSE STA].[6:3]   03667500
                                  GTR 2)) THEN                          03668000
                           BEGIN I:=56|R;       %TWX IT OUT             03668500
                                 T:=T&(T.[19:5]+R|7)[19:43:5];          03669000
                           END ELSE            %IN BUFFER SIZE HUNKS    03669500
                               T:=T&0[19:40:8]&(T.[SOUSE]-1)[27:42:6]&  03670000
                                  (T.[14:5]+1)[14:43:5]; %KEEP THE      03670500
                         TANKS[STA]:=(*P(DUP))&T[14:14:19]; %POT        03671000
                         %OWH DETANKS TWX ONLY                          03671500
                         J:=(H+J.[40:5])&J[30:45:3];     %RIGHT         03672000
$OMIT  03674501,  IF TWXONLY;                                           03672490
                         END ELSE        %LET DCWRITE DO IT             03672500
                           BEGIN                                        03673000
                             I:=M[H].[CF]; %DONT HARRY HARRI            03673500
                             J:=(H+J.[40:5])&J[30:45:3];                03674000
                           END;                                         03674500
               END;  %OF TAKIN NOW SOME GIVIN                           03675000
    DELINKIT:                                                           03675500
                   IF NOT T1 THEN R:=DCWRITE(J+1,STA,I);                03676000
                   STATABLE[STA].OUTPUTANKING:=(T.TANKN ! 0) OR         03676500
                     (M[T] NEQ 0 AND (NOT STATABLE[STA].SWAPPED) AND    03677000
                     T.[CF] NEQ 0);                                     03677500
                   %CHECK FOR MOAR:IN COAR OR DISK:TANKS                03678000
                   IF T.[10:2] NEQ 0 THEN  %OPEN THE DOAR FOR MOAR      03678500
                     IF GLOMSIZE/5 GEQ T.[SOUSE]  THEN                  03679000
                      BEGIN  %WHRN TANK STARTS GETTING EMPTY,REFILL OIT 03679500
                         TANKS[STA]:=(*P(DUP))&0[10:46:2];              03680000
                         IF T.[10:1]  THEN                              03680500
                           BEGIN M[(R:=GETAREA(0))+1]:=0;               03681000
                                M[R]:=0&STA[CTF]&10[18:41:7];           03681500
                                QUEVENT(R,CANDEMIX[STA]);               03682000
                           END;                                         03682500
                         IF T.[11:1]  THEN                              03683000
                           IF CANDEMIX[STA] NEQ STATAB.MIXNR            03683500
                             THEN BRINGBACK(STATAB.MIXNR);              03684000
                   END;                                                 03684500
                   HEADOUT:=TANKS[STA].[2:8];                           03685000
                   IF STA = TAILOUT THEN TAILOUT:=0;                    03685500
                   TANKS[STA]:=NABS((*P(DUP))&0[2:40:8]);               03686000
                   GO TO RESTART;                                       03686500
              END OF OUTPUTTER GETTING;                                 03687000
         IF H!0 THEN FORGETSPACE(H);                                    03687500
         WORKING:=FALSE;                                                03688000
         GO TO NOTHINGTODO;                                             03688500
     END  OLDEMACIATEDWIERDHAROLD SURE IS SKINNY;                       03688600
  SAVE PROCEDURE GIVEAWAY(A);                                           03689000
  VALUE A;                                                              03690000
REAL A;                                                                 03691000
$INCLUDE 03691501, IF DCP;                                              03691499
  PROCEDURE GIVEAWAY(A,N);  VALUE A,N;  REAL A,N;                       03691500
     %A IS THE ADDRESS OF THE LAST BUFFER SEGMENT OF A MESSAGE(THE EOM  03692000
     % IS IN THIS BUFFER) TO BE GIVEN TO WORKER.GIVEAWAY LINKS THE      03693000
     % ENTIRE MESSAGE INTO WORKERS QUEUE TO BE GIVEN TO A USER JOB OR   03694000
     % CANDE, FOLLOWING BUFFER CONSOLIDATION.                           03695000
  BEGIN                                                                 03696000
         INTEGER I;                                                     03697000
$INCLUDE 03697501, IF DCP;                                              03697499
         M[A].[4:4]:=N;                                                 03697500
          I:=A;                                                         03698000
         WHILE P(M[A].[FF],DUP) ! 0 DO A := P;                          03699000
         P(DEL);                                                        03700000
         IF WORKERINQ.[CF] = 0 THEN                                     03701000
         WORKERINQ := A & I[CTF]                                        03702000
         ELSE                                                           03703000
         BEGIN                                                          03704000
              M[WORKERINQ.[FF]] := (*P(DUP)) & A[CTC];                  03705000
               WORKERINQ := WORKERINQ & I[CTF];                         03706000
         END;                                                           03707000
         STARTWORKING;                                                  03708000
  END GIVEAWAY;                                                         03709000
$OMIT 03999501, IF DCP;                                                 03709999
PROCEDURE    DCIOFINISH(R);                                             03710000
VALUE R;                                                                03710500
REAL R;                                                                 03711000
BEGIN                                                                   03711500
    REAL T=NT1,S=NT2, S1=NT3, V=NT4, E=NT5, ST=NT6, I=NT7, D, L;        03712000
    LABEL BRAKE,DISCONN,DELINK,JUNKET,BIGJOKE,READRDY,AUT,RDRDYABN,GONE,03712500
$OMIT 03713505, IF TWXONLY;                                             03712995
    MSGACK,EOTIT,ACK,SELECTNAK,ENQRD,MSGANS,NOTHERE,BREAKIT,            03713000
    EOT,POLLBACK,WAITENQ,ENQACK,ENQNAK,COONGRILL,AUS,                   03713500
    FINIS,BREAKER,ERROR,DSIT,ACTINT,WRITERDY,FINISH,FOUND,QUEIT,IQUEIT; 03714000
$INCLUDE 03715005, IF TWXONLY;                                          03714495
    SWITCH READACTION:=READRDY,BIGJOKE,AUT,AUT,AUT,AUT,AUT,AUT,         03714500
    RDRDYABN,AUT;                                                       03715000
$OMIT 03717005, IF TWXONLY;                                             03715495
    SWITCH READACTION:=READRDY,BIGJOKE,MSGANS,ENQRD,BREAKIT,NOTHERE,    03715500
    NOTHERE,EOT,RDRDYABN,MSGANS;                                        03716000
    SWITCH WRITEACTION~WRITERDY,POLLBACK,                               03716500
    BREAKER,BREAKER,POLLBACK,ENQACK,ENQNAK,BREAKER;                     03717000
    DEFINE INTERROGATE = R.[18:1]#,                                     03717500
    READREADY=        R.[24:1]#,                                        03718000
    GROUPMARK =       (NOT R.[25:1])#,                                  03718500
    LINKEM=           25:40:8#,                                         03719000
    PTR=              26:6#,                                            03719500
    RDRDY=            43:1#,                                            03720000
    MSGSTAT=          5:5#,                                             03720500
    WRITEREADY=       R.[27:1]#,                                        03721000
    ABNORMALFLAG=     R.[23:1]#,                                        03721500
    IDLE=             ((R.[23:10] AND @1475)=0)#,                       03722000
    IDLEABNORMAL =    ((R.[23:10] AND @1475)=@1000)#,                   03722500
    NOTREADY =        ((R.[24:9] AND @435)=@24)#,                       03723000
    BUSY=             ((R.[27:6] AND @75)=@20)#,                        03723500
    LAST =            #;                                                03724000
    SUBROUTINE HITHERE;                                                 03724500
    BEGIN                                                               03725000
         M[(V~GETAREA(0))]~CLOCK+P(RTR);                                03725500
         M[V+1]~ST;                                                     03726000
         M[V+2]~S1;                                                     03726500
         FORK(P(.HELLO),V,-6,128,1);                                    03727000
    END;                                                                03727500
    SUBROUTINE FORGETI;                                                 03728000
    BEGIN                                                               03728500
         FORGETAREA(M[I].[2:2],I);                                      03729000
    END;                                                                03729500
    SUBROUTINE SEQUENCE;                                                03730000
    BEGIN                                                               03730500
         IF (E:=SEQARRAY[ST])! 0 THEN                                   03731000
         BEGIN                                                          03731500
              STREAM(E:=E.[21:27],V:=(V:=GETAREA(0))+1);                03732000
              BEGIN                                                     03732500
                   SI~LOC E;DI~DI+16;                                   03733000
                   DS~8 DEC;DS~LIT "~";                                 03733500
                   DI~DI-9;DS~7 FILL;                                   03734000
                   E~DI;DI~V;                                           03734500
                   SI~E;DS~9 CHR;                                       03735000
              END;                                                      03735500
              ENTERLINEQ(V,S1,0);                                       03736000
         END;                                                           03736500
         M[V].[4:1]:=1;                                                 03737000
    END;                                                                03737500
    SUBROUTINE DETANK;                                                  03738000
    BEGIN                                                               03738500
         IF STATABLE[ST].OUTPUTANKING THEN                              03739000
         IF TANKLINE[ST]=0 THEN                                         03739500
         IF TAILOUT!ST THEN                                             03740000
         BEGIN                                                          03740500
              TANKLINE[TAILOUT]~ST;                                     03741000
              TAILOUT~ST;                                               03741500
              STARTWORKING;                                             03742000
    END;  END;                                                          03742500
    %%%%%%%%%%%%%%%%%%%%%%%%%START                                      03743000
    E:=1;  %INITIALIZE ERROR COUNT, ETC                                 03743500
    UNIT[30].[16:2]:=0;                                                 03744000
    IF REMOTE THEN ELSE GO TO FINISH;                                   03745000
    S1~LLNR;                                                            03745500
    IF INTERROGATE THEN                                                 03746000
    IF LLNR=0 THEN %PASSIVE VARIETY                                     03746500
    BEGIN                                                               03747000
         I:=R.[9:9];                                                    03747500
         FOR S1~1 STEP 1 UNTIL LMAX DO                                  03748000
         IF I!LINETABLE[S1].[9:9] THEN ELSE GO FOUND;                   03748500
         E:=0;GO ERROR;                                                 03749000
    END;                                                                03749500
FOUND:                                                                  03750000
    D:=P(LINETABLE[S1],DUP).LINEDIS; L:=P.[21:5];    %LSTATUS           03750500
    T:=STATABLE[ST:=                                                    03751000
$OMIT 03751505, IF TWXONLY;                                             03751495
    IF D=MULTI THEN SEQARRAY[S1].[40:8] ELSE                            03751500
    S1].STATIONTYPE;                                                    03752000
$INCLUDE 03752505, IF SAVERESULTS OR DEBUGGING;                         03752495
    STORAWAY:=R; STORAWAY:=STATABLE[ST]; STORAWAY:=LINETABLE[S1];       03752500
    IF LOCKED[S1] THEN                                                  03753000
    BEGIN                                                               03753500
         M[LINETABLE[S1]]~NABS(R);                                      03754000
         GO TO AUT;                                                     03754500
    END;                                                                03755000
    IF INTERROGATE THEN                                                 03755500
    BEGIN                                                               03756000
         IF LLNR = 0 THEN                                               03756500
         BEGIN% PASSIVE INTEROGATE IN ANSWER TO DC INTERRUPT            03757000
              IF READREADY THEN                                         03757500
              BEGIN                                                     03758000
                   INITIATEDCIO(IOQUE[S]~((@0400000040000000)           03758500
                   OR ((V~GETAREA(LINETABLE[S1].BUFSIZE))+1))           03759000
                   & R[9:9:9]);                                         03759500
                   LLNR~S1;                                             03760000
$OMIT 03761005, IF TWXONLY;                                             03760495
                   IF D=TWX THEN                                        03760500
                   BEGIN                                                03761000
                        IF ABNORMALFLAG THEN                            03761500
                        IF L=WRB THEN                                   03762000
                        BEGIN                                           03762500
BRAKE:                       M[I:=GETAREA(0)]:=(*P(DUP))&               03763000
                             (ST&2[33:41:7])[CTF];                      03763500
                             L~BROKEN;                                  03764000
                             GO DELINK;                                 03764500
                        END ELSE L~RRA ELSE                             03765000
                        L~IF L=IDL THEN FIRSTIME ELSE NORMAL;           03765500
                        IF NOT STATABLE[ST].DIALEDUP THEN HITHERE;      03766000
$OMIT 03773005, IF TWXONLY;                                             03766495
                   END ELSE%CONTENTION OR MULTIPOINT                    03766500
                   BEGIN                                                03767000
                        IF ABNORMALFLAG THEN                            03767500
                        IF NOT (E~LINETABLE[S1]).[20:1] THEN            03768000
                        BEGIN                                           03768500
                             L:=IF L=WRB THEN 57 ELSE L&6[42:45:3];     03769000
                             LINETABLE[S1]:=E&L[20:42:6];               03769500
                             IF L LEQ 49 THEN GO JUNKET ELSE GO FINISH; 03770000
                        END ELSE GO FINISH ELSE                         03770500
                        L:=IF BUSY THEN IF L.[43:3]=0 THEN              03771000
                        L&5[43:45:3] ELSE IF L=IDLPOLLING THEN          03771500
                        POLLTIMEOUT ELSE TIMEDOUT ELSE IF L=WRB         03772000
                        THEN MSGANSWER ELSE L&2[43:46:2];               03772500
                   END;                                                 03773000
                   GO TO FINIS;                                         03773500
              END;                                                      03774000
              IF WRITEREADY THEN                                        03774500
              BEGIN                                                     03775000
                   IF ABNORMALFLAG THEN                                 03775500
                   BEGIN                                                03776000
$OMIT 03778505, IF TWXONLY;                                             03776495
                        IF D=MULTI THEN                                 03776500
                        BEGIN SEQARRAY[ST].[4:2]:=0;                    03777000
                             GO TO IQUEIT;                              03777500
                        END;                                            03778000
                        IF D=TWX THEN                                   03778500
                        IF STATABLE[ST].DIALEDUP THEN                   03779000
                        BEGIN                                           03779500
DSIT:                        M[I~GETAREA(0)]~(*P(DUP))&(ST&3[33:41:7])  03780000
                             [CTF];                                     03780500
                             GO DELINK;                                 03781000
                        END;                                            03781500
                        HITHERE;                                        03782000
                        L:=IDL;                                         03782500
$OMIT 03785005, IF TWXONLY;                                             03782995
                        IF D=CONTENTION THEN                            03783000
                        BEGIN                                           03783500
                             I:=GETAREA(0);                             03784000
                             GO TO EOTIT;                               03784500
                        END ELSE                                        03785000
                        GO TO AUT;                                      03785500
                   END;                                                 03786000
                   L~WAITING;                                           03786500
                   IF STATABLE[ST].[CF]=0 THEN GO AUT ELSE GO QUEIT;    03787000
              END;                                                      03787500
              IF IDLE THEN                                              03788000
$OMIT 03794005, IF TWXONLY;                                             03788495
              IF D=CONTENTION THEN                                      03788500
              BEGIN                                                     03789000
                   IF (V:=SEQARRAY[ST]).[3:1] THEN                      03790000
                   BEGIN                                                03790500
                        SEQARRAY[ST]:=V&0[3:47:1];                      03791000
                        GO TO AUT;                                      03791500
                   END;                                                 03792000
                   L~WAITINGENQ;                                        03792500
                   GO QUEIT;                                            03793500
              END ELSE                                                  03794000
              GO IQUEIT;                                                03794500
              %SEQUENCE OF EVENTS AFTER DISCONNECT:                     03795000
              %1 - NOTIFY C&E OF DISCONNECT                             03795500
              %2 - MARK DISCONNECTED,STOP FURTHER IO FOR THIS LINE      03796000
              %3 - DELETE CORE QUEUES,ENTER MARKER IN C&E TANK          03796500
              %4 - FORK TO QUITTER                                      03797000
              %5 - CALL TERMINATE ON USER JOB (IF NECESSARY)            03797500
              %6 - C&E COMMUNICATES ACK. OF DS,MARKER,LOG-OFF,ETC.      03798000
              %7 - DELETE DISK TANKS,CLEAR TABLES,UPDATE SYSTEMDISK     03798500
              IF IDLEABNORMAL OR NOTREADY THEN                          03799000
              BEGIN                                                     03799500
$OMIT 03800005, IF TWXONLY;                                             03799995
                   IF D=MULTI THEN GO TO GONE;                          03800000
DISCONN::          L~DISCON;                                            03800500
                   STATABLE[ST].[15:2]:=0;                              03801000
                   M[I~GETAREA(0)]~(*P(DUP))&(ST&6[33:41:7])[CTF];      03801500
DELINK::           IF CANDYINX=0 OR (ST=ABS(SPOWORD) AND L!DISCON) THEN 03802000
                   FORGETI ELSE QUEVENT(I,CANDYINX);                    03802500
                   FORK(P(.QUITTER),S1&ST[CTF],-2,96,0);                03803000
                   IF ((E:=STATABLE[S1]).LEENKER!0) OR (P(V:=           03803500
                   STATABLE[0],DUP).[CF]!0 AND P(XCH).[FF]=S1) THEN     03804000
                   BEGIN                                                03804500
                        IF (I~V.[CF])=S1 THEN STATABLE[0]~V&E           03805000
                        [LINKEM] ELSE                                   03805500
                        BEGIN                                           03806000
                             WHILE P(STATABLE[I],DUP).LEENKER!S1 DO     03806500
                             I:=P.LEENKER;                              03807000
                             STATABLE[I]~P(XCH)&E[LINKEM];              03807500
                             IF V.[FF]=S1 THEN                          03808000
                             STATABLE[0]~V&I[CTF];                      03808500
                        END;                                            03809000
                        STATABLE[S1]~E&0[LINKEM];                       03809500
                   END;                                                 03810000
                   GO TO AUT;                                           03810500
              END;                                                      03811000
              IF BUSY THEN                                              03811500
              BEGIN                                                     03812000
                   IF NOT (V:=LINETABLE[S1]).[20:1] THEN                03812500
                   BEGIN                                                03813000
                        IF V.[CF] ! 0 THEN                              03813500
                        BEGIN                                           03814000
                             LINETABLE[S1]:=V&0[CTC];                   03814500
                             DO FORGETAREA((I:=M[V]).[2:2],V)           03815000
                             UNTIL (V:=I.[FF]) = 0;                     03815500
                        END;                                            03816000
                        M[I:=GETAREA(0)]:=(*P(DUP))                     03816500
                        &1[4:47:1]&ST[10:40:8];                         03817000
                        GIVEAWAY(I);                                    03817500
                   END;                                                 03818000
                   FORK(P(.DCBUSY),V&S1[CTF],1,0,1);                    03818500
GONE:              L~WRBUSY;                                            03819000
                   GO TO ACTINT;                                        03819500
              END;                                                      03820000
              % DCBUSY TRIES TO EXPLAIN WHAT HAPPENED TO THE            03820500
              % KLUTZ ON THE OTHER END OR THE LINE.                     03821000
ERROR:        FORK(P(.DCERR),R&E[4:44:4],1,64,0);                       03821500
              GO TO AUT;                                                03822000
         END;                                                           03822500
         %ACTIVE INTERROGATE                                            03823000
         IF NOTREADY THEN GO TO DISCONN;                                03823500
         IF L = RRA THEN                                                03824000
         BEGIN                                                          03824500
              LSTATUS[S1]:=IDL;                                         03825000
              IF PAPERTAPE(S1) THEN NEXTDCIO ELSE                       03825500
              BEGIN                                                     03826000
                   M[(V~GETAREA(0))+1]~@2425435736743700;               03826500
                   ENTERLINEQ(V,S1,1);                                  03827000
                   SEQUENCE;                                            03827500
              END;                                                      03828000
JUNKET:                                                                 03828500
              IF (V~(I~LINETABLE[S1]).[CF])!0 THEN                      03829000
              BEGIN                                                     03829500
                   DO FORGETAREA((E~M[V]).[2:2],V) UNTIL                03830000
                   (V~E.[FF])=0;                                        03830500
                   LINETABLE[S1]~I&0[CTC];                              03831000
              END;                                                      03831500
              M[V:=GETAREA(0)]:=(*P(DUP))&1[4:47:1]&ST[10:40:8];        03832000
              GIVEAWAY(V);                                              03832500
              GO TO FINISH;                                             03833000
         END;                                                           03833500
         IF L = WRBUSY THEN %BUSY INTERRUPT                             03834000
         IF IDLE THEN                         %LOST LEFT ARROW          03834500
         GO IQUEIT ELSE                                                 03835000
         THROWAWAY[S1]~TRUE;                                            03835500
         GO AUT;                                                        03836000
    END;                                                                03836500
    % READ OR WRITE                                                     03837000
    I ~ IOQUE[S].[CF]-1;                                                03837500
    IF R.[CF] = I+1 THEN                                                03838000
    BEGIN  %READ OR WRITE BOUNCED BACK                                  03838500
         IF R.[30:1] THEN                                               03838600
$OMIT 03839305, IF TWXONLY;                                             03838695
         IF D=MULTI THEN                                                03838700
         IF STATABLE[ST].DIALEDUP THEN GO TO DISCONN ELSE               03838800
         BEGIN STATABLE[ST].[CF]:=0;                                    03838900
              L:=SEQARRAY[ST]:=(*P(DUP))&1[3:47:1];                     03839000
              SEQARRAY[S1]:=(*P(DUP))&L[40:32:8];                       03839100
              GO TO ENQNAK;                                             03839200
         END ELSE                                                       03839300
         GO TO DISCONN;                                                 03839400
         IF R.[24:1] THEN                                               03839500
         BEGIN %READ                                                    03840000
              FORGETI;E:=3;GO TO ERROR;                                 03840500
         END;                                                           03841000
         L~SELECT;                                                      03841500
         GO TO AUT;                                                     03842000
    END;                                                                03842500
    IF L.[RDRDY] THEN GO TO READACTION[L.[44:4]] ELSE                   03843000
    BEGIN STATABLE[ST].[CF]:=M[I];                                      03843500
$INCLUDE 03844005, IF TWXONLY;                                          03843995
         GO TO WRITERDY;                                                03844000
$OMIT 03844505, IF TWXONLY;                                             03844495
         GO TO WRITEACTION[L];                                          03844500
    END;                                                                03845000
BIGJOKE::                                                               03845500
    L:=NORMAL;                                                          03846000
    IF LINETABLE[S1].[20:1] THEN GO TO READRDY;                         03846500
$OMIT 03847505, IF TWXONLY;                                             03846995
    IF D=TWX THEN                                                       03847000
    BEGIN                                                               03847500
         IF (P(M[I+1],TOP) AND P(XCH).[1:5]=@37)                        03848000
         THEN SEQARRAY[S1]~0;                                           03848500
$OMIT 03875505, IF TWXONLY;                                             03848995
    END ELSE                                                            03849000
    BEGIN                                                               03849500
         IF D=MULTI THEN                                                03850000
         BEGIN                                                          03850500
              STREAM(I:=I+1:E:=[E]);                                    03851000
              BEGIN                                                     03851500
                   SI~I;SI~SI+1;DS~LIT "0";                             03852000
                   IF SC="!" THEN                                       03852500
                   BEGIN                                                03853000
                        SI~SI+1;TALLY~2;                                03853500
                   END;                                                 03854000
                   DS~CHR;IF SC="!" THEN                                03854500
                   BEGIN                                                03855000
                        SI~SI+1;TALLY~TALLY+1;                          03855500
                   END;                                                 03856000
                   I~TALLY;DS~CHR;                                      03856500
              END;                                                      03857000
              E:=P&E[34:6:12]; ST:=S1;                                  03857500
              DO IF P(SEQARRAY[ST],DUP).[12:14]!E                       03858000
              THEN ELSE GO TO AUS                                       03858500
              UNTIL (ST~P.LINELINK)=S1;                                 03859000
              E:=2;GO TO ERROR;                                         03859500
AUS:          T:=STATABLE[ST].STATIONTYPE;                              03860000
              SEQARRAY[ST]:=P(XCH)&0[4:46:2];                           03861000
              SEQARRAY[S1].[40:8]~ST;                                   03861500
         END ELSE                                                       03862000
         BEGIN %CONTENTION                                              03862500
              STREAM(I:=I+1:);                                          03863000
              BEGIN SI:=I;                                              03863500
                   IF SC ! "$" THEN TALLY:=1;                           03864000
                   I:=TALLY;                                            03864500
              END;                                                      03865000
              IF P THEN ELSE GO TO WAITENQ;                             03865500
         END;                                                           03866000
         IF NOT STATABLE[ST].DIALEDUP THEN HITHERE;                     03866500
         STREAM(I:=I+1:E:=[E]);                                         03867000
         BEGIN SI:=I;                                                   03867500
              10(IF SC ! """ THEN SI:=SI+1 ELSE JUMP OUT);              03868000
              SI:=SI+2;                                                 03868500
              IF SC=MARK THEN                                           03869000
              BEGIN                                                     03869500
                   SI:=SI+1;                                            03870000
                   DS:=8 LIT "BREAKWRU";DI:=DI-8;                       03870500
                   IF 5 SC=DC THEN TALLY:=1 ELSE                        03871000
                   BEGIN                                                03871500
                        SI:=SI-5;                                       03872000
                        IF 3 SC=DC THEN TALLY:=2;                       03872500
                   END;                                                 03873000
              END;                                                      03873500
              I:=TALLY;                                                 03874000
         END;                                                           03874500
         IF (E:=P)!0 THEN LINETABLE[S1]:=(*P(DUP))&E[CTC]&1[20:47:1];   03875000
    END;                                                                03875500
READRDY::                                                               03876000
    M[I].[10:8]~ST;                                                     03876500
    P([STATABLE[ST]],IOR);                                              03877000
    IF GROUPMARK THEN                                                   03877500
    BEGIN                                                               03878000
         IF (E:=(L:=(LINETABLE[S1]:=(*P(DUP))                           03878500
         &IDL[21:43:5])).[20:1]) THEN                                   03879000
         BEGIN                                                          03879500
              FORGETI;LINETABLE[S1]:=L&0[20:47:1];                      03880000
$OMIT 03889505, IF TWXONLY;                                             03880495
              IF D!TWX THEN                                             03880500
              BEGIN                                                     03881000
                   V:=GETAREA(0);                                       03881500
                   IF L.[CF]=0 THEN ELSE GO ACK;                        03882000
                   IF (E~P(SEQARRAY[ST],DUP).NAKCNT+1)                  03882500
                   LSS P(XCH).NAKMAX THEN                               03883000
                   BEGIN                                                03883500
                        M[V+1]~@0537000000000000; %NAK                  03884000
                        M[V].[MSGSTAT]~NAKING;                          03884500
                   END ELSE                                             03885000
                   BEGIN                                                03885500
                        E~0;                                            03886000
                        M[V+1]~@3737000000000000; %DISCONNECT           03886500
                        M[V].[MSGSTAT]~DISCON;                          03887000
                   END;                                                 03887500
                   SEQARRAY[ST].NAKCNT~E;                               03888000
                   ENTERLINEQ(V,ST,1);                                  03888500
                   GO FINISH;                                           03889000
              END ELSE                                                  03889500
              GO TO AUT;                                                03890000
         END; %NEXT IS NO THROWAWAY                                     03890500
         V~GETAREA(0);                                                  03891000
$OMIT 03896505, IF TWXONLY;                                             03891495
         IF D!TWX THEN                                                  03891500
         BEGIN %CONTENTION OR MULTIPOINT                                03892000
ACK:                                                                    03892500
              IF T ! TC500 THEN                                         03893000
              TNAOG[SEQARRAY[ST].[PTR]].[28:20]:=0;                     03893500
              SEQARRAY[ST].NAKCNT~0;                                    03894000
              M[V+1]~@3437000000000000; %ACK                            03894500
              M[V].[MSGSTAT]~ACKING;                                    03895000
              ENTERLINEQ(V,ST,1);                                       03895500
              IF E THEN GO FINISH;                                      03896000
         END ELSE                                                       03896500
         IF PAPERTAPE[S1] THEN                                          03897000
         BEGIN                                                          03897500
              NEXTDCIO;                                                 03898000
              FORGETAREA(0,V);                                          03898500
         END ELSE                                                       03899000
         BEGIN                                                          03899500
              STREAM(V~V+1);                                            03900000
              DS~4LIT"{<!~";                                            03900500
              ENTERLINEQ(V,S1,1);                                       03901000
              SEQARRAY[S1]:=(E:=*P(DUP))&                               03901500
              (E.[21:27]+E.[2:19])[21:21:27];                           03902000
              SEQUENCE;                                                 03902500
         END;                                                           03903000
         M[I]:=(*P(DUP))&1[5:47:1]&(V:=LINETABLE[S1])[CTF];             03903500
         IF V.[CF]!0 THEN M[V].[CF]~I;                                  03904000
         LINETABLE[S1]~V&0[CTC];                                        03904500
         GIVEAWAY(I);                                                   03905000
         GO FINISH;                                                     03905500
    END; %NEXT IS IFAL ENDING-MORE TO COME                              03906000
    IF THROWAWAY[S1] THEN                                               03906500
    BEGIN                                                               03907000
         FORGETI;GO TO AUT;                                             03907500
    END;                                                                03908000
    IF (V~LINETABLE[S1]).[CF]!0 THEN                                    03908500
    BEGIN                                                               03909000
         M[V].[CF]~I;                                                   03909500
         IF (E~M[V].[7:3]+1)=(8 DIV (V.BUFSIZE+1)) THEN                 03910000
         BEGIN                                                          03910500
              M[I]~(*P(DUP))&V[CTF];                                    03911000
              LINETABLE[S1]~V&0[CTC];                                   03911500
              GIVEAWAY(I);                                              03912000
              GO TO AUT;                                                03912500
         END;                                                           03913000
    END                                                                 03913500
    ELSE E~1;                                                           03914000
    M[I]~(*P(DUP))&E[7:45:3]&V[CTF];                                    03914500
    LINETABLE[S1]~V&I[CTC];                                             03915000
AUT::  NEXTDCIO;                                                        03915500
FINIS::  LSTATUS[S1]~L;                                                 03916000
    GO TO FINISH;                                                       03916500
$OMIT 03973505, IF TWXONLY;                                             03916995
ENQRD::                                                                 03917000
    STREAM(V:=I+1:);                                                    03917500
    BEGIN                                                               03918000
         SI:=V;                                                         03918500
         IF SC="$" THEN TALLY:=3 ELSE                                   03919000
         IF SC ! "%" THEN TALLY:=1;                                     03919500
         V:=TALLY;                                                      03920000
    END;                                                                03920500
    IF (V:=P) OR (E:=LINETABLE[S1]).[20:1] THEN                         03921000
    IF V=3 THEN GO TO EOT ELSE                                          03921500
    BEGIN                                                               03922000
         LINETABLE[S1]:=E&0[20:47:1];                                   03922500
         M[I].[5:5]:=POLLING;                                           03923000
         M[I+1]:=@0537000000000000;  %NAK                               03923500
    END ELSE IF NOT TANKOK[ST] THEN                                     03924000
    BEGIN                                                               03924500
         M[I].[5:5]:=ACKINGENQ;                                         03925000
         M[I+1]:=@3437000000000000;  %ACK                               03925500
    END ELSE                                                            03926000
    BEGIN                                                               03926500
EOTIT:                                                                  03927000
         M[I].[5:5]:=POLLING;                                           03927500
         STREAM(I:=I+1);DS:=2 LIT "$~";                                 03928000
    END;                                                                03928500
COONGRILL:                                                              03929000
    LSTATUS[S1]~L~IDL;                                                  03929500
    ENTERLINEQ(I,S1,1);                                                 03930000
    GO FINISH;                                                          03930500
MSGANS::                                                                03931000
    IF (E:=LINETABLE[S1]).[20:1] THEN                                   03931500
    BEGIN                                                               03932000
         LINETABLE[S1]:=E&0[20:47:1];                                   03932500
         IF L THEN GO MSGACK ELSE GO SELECTNAK;                         03933000
    END;                                                                03933500
    IF D=CONTENTION THEN SEQARRAY[ST].[4:1]:=0;                         03933900
    IF (P(M[I+1],TOP) AND P(XCH).[1:5]=@34) THEN                        03934000
    BEGIN %ACKED THE WRITE                                              03934500
         IF L THEN                                                      03935000
         BEGIN %IT WAS A MESSAGE                                        03935500
MSGACK:                                                                 03936000
              E:=(TNAOG[V:=SEQARRAY[ST].[PTR]]:=                        03936500
              (*P(DUP))&TANKS[ST][1:14:13]);                            03937000
              STATABLE[ST]:=(*P(DUP))&P(DUP)[22:23:1];                  03937500
              IF T = TC500 THEN                                         03938000
              BEGIN IF D!MULTI THEN SEQARRAY[ST].[3:1]:=1;              03938500
                   DETANK;                                              03939000
              END ELSE                                                  03939500
               IF ST = ABS(SPOWORD) THEN                                03939600
               BEGIN TNAOG[V]:=E&1[42:42:6];                            03939700
                    DETANK;                                             03939800
               END ELSE                                                 03939900
              IF (TNAOG[V]:=E&E[36:42:6]).[42:6]!E.[14:6] THEN DETANK;  03940000
              SEQARRAY[ST]:=ABS(*P(DUP));                               03940500
              IF D = MULTI THEN GO TO ENQNAK ELSE GO TO EOTIT;          03941000
         END; % ACK TO SELECT IS NEXT                                   03941500
         SEQARRAY[ST].NAKCNT:=0;                                        03942000
         GO ENQNAK;                                                     03942500
    END; %NAKKED IS NEXT                                                03943000
SELECTNAK:                                                              03943500
    STATABLE[ST]:=(V:=*P(DUP))&V[23:22:1]&1[24:47:1]&0[CTC];            03944000
    WHILE (E:=V.[CF])!0 DO FORGETAREA((V:=M[E]).[2:2],E);               03944500
    IF L THEN                                                           03945000
    BEGIN  % NAK TO A MESSAGE                                           03945500
         E:=SEQARRAY[ST].[PTR];                                         03946000
         IF T ! TC500 THEN                                              03946500
         TNAOG[E]:=P(DUP,LOD,DUP)&P[42:36:6]&0[28:40:8];                03947000
         V:=TANKS[ST].[14:5]-TNAOG[E].[1:5];                            03947500
         TANKS[ST]:=(*P(DUP))&(P(DUP).[27:6]+V+0&V[42:1:1])             03948000
         [27:42:6]&TNAOG[E][14:1:13]&1[13:47:1];                        03948500
         DETANK;                                                        03949000
         L:=IDL;                                                        03949500
         GO TO BREAKER;                                                 03950000
    END ELSE                                                            03950500
    BEGIN % NAK TO SELECTED                                             03951000
         SEQARRAY[ST]:=ABS(*P(DUP));                                    03951500
         IF T ! TC500 THEN                                              03952000
         IF DISCONNECTING[ST] THEN                                      03952500
         BEGIN                                                          03953000
              V:=GETAREA(0);                                            03953500
              M[I]:=(*P(DUP))&7[5:43:5]&V[CTC];                         03954000
              STREAM(I:=I+1);DS:=2 LIT"$~";                             03954500
              M[V].[5:5]:=7;                                            03955000
              M[V+1]:=@3700000000000000;                                03955500
              GO COONGRILL;                                             03956000
         END;                                                           03956500
         M[(E:=GETAREA(0))+1]:=ST;                                      03957000
         IF (V:=SEQARRAY[0]).[18:30]=0 THEN                             03957500
         FORK(P(.NAKQUE),0,1,64,0);                                     03958000
         M[E+2]:=CLOCK+P(RTR);                                          03958500
         IF V.[FF]=0 THEN V:=V&E[CTF]                                   03959000
         ELSE M[V.[3:15]].[CF]:=E;                                      03959500
         SEQARRAY[0]:=V&E[3:33:15];                                     03960000
         IF D=MULTI THEN GO ENQNAK ELSE GO EOTIT;                       03960500
    END;                                                                03961000
NOTHERE::  IF D=CONTENTION AND L THEN                                   03962000
    IF T = TC500 THEN                                                   03962500
    BEGIN                                                               03963000
WAITENQ:                                                                03963500
         L:=WAITINGENQ;                                                 03964000
         FORGETI;                                                       03964500
         GO QUEIT;                                                      03965000
    END;                                                                03965500
    FORK(P(.DCTIMEOUT),I&S1[CTF],1,64,0);                               03966000
    GO TO AUT;                                                          03966500
EOT::                                                                   03967000
    IF (E:=LINETABLE[S1]).[CF] ! 0 THEN                                 03967500
    BEGIN                                                               03968000
         LINETABLE[S1]~E&0[CTC];                                        03968500
BREAKIT::                                                               03969000
         FORGETI;                                                       03969500
         IF D=TWX THEN GO AUT;                                          03970000
         IF E THEN GO BRAKE ELSE GO DSIT;                               03970500
    END;                                                                03971000
    DETANK;                                                             03971500
    IF D=CONTENTION THEN                                                03972000
    IF T = TC500 THEN                                                   03972500
    GO EOTIT ELSE GO WAITENQ                                            03973000
    ELSE GO TO ENQNAK;                                                  03973500
RDRDYABN::                                                              03974000
    STREAM(T~I+1:Q~IF P(LINETABLE[S1].BUFSIZE,DUP)                      03974500
    =2 THEN P+2 ELSE P+1);                                              03975000
    BEGIN                                                               03975500
         SI~T;                                                          03976000
         Q(28(IF SC="}" THEN                                            03976500
         BEGIN                                                          03977000
              TALLY~1;                                                  03977500
              JUMP OUT 2 TO LLLL;                                       03978000
         END ELSE                                                       03978500
         IF SC="~" THEN JUMP OUT 2 TO LLLL ELSE                         03979000
         SI~SI+1));                                                     03979500
LLLL:    T~TALLY;                                                       03980000
    END;                                                                03980500
    IF P THEN %RECEIVED EOT OR EXC. PT.                                 03981000
    BEGIN                                                               03981500
         FORGETI;                                                       03982000
ACTINT:  LLNR:=S1;                                                      03982500
         INITIATEDCIO(INTERROGATEMASK&R[9:9:9]);                        03983000
         GO TO FINIS;                                                   03983500
    END ELSE                                                            03984000
    GO TO READRDY;%THERE ARE 14 S IN THE BUFFER                         03984500
WRITERDY::                                                              03985000
    P([STATABLE[ST]],IOR);                                              03985500
    IF M[I].[4:1] THEN DETANK;                                          03986000
BREAKER::                                                               03986500
    FORGETI;                                                            03987000
    GO TO AUT;                                                          03987500
$OMIT 03991505, IF TWXONLY;                                             03987995
POLLBACK::                                                              03988000
    IF D=MULTI AND SEQARRAY[ST].[4:2]=0 THEN L:=IDLPOLLING;             03988500
    GO TO BREAKER;                                                      03989000
ENQACK::                                                                03989500
    L~FIRSTIME;                                                         03990000
    GO TO BREAKER;                                                      03990500
ENQNAK::                                                                03991000
    FORGETI;                                                            03991500
IQUEIT::                                                                03992000
    L~IDL;                                                              03992500
QUEIT::                                                                 03993000
    LSTATUS[S1]~L;                                                      03993500
    ENTEREADYQ(ST);                                                     03994000
FINISH::                                                                03994500
    IF UNIT[30].[15:3] = 0 THEN                                         03995000
    BEGIN                                                               03995500
         UNIT[30].[18:15] ~ NOT 0;                                      03996000
         IOQUE[S] ~ IOQUEAVAIL;                                         03996500
         IOQUEAVAIL ~ S + 1; %RETURN IOQUE SPACE                        03997000
         IF FIRSTWAIT ! NEXTWAIT THEN NEWIO;                            03997500
    END;                                                                03998000
    P(INI);                                                             03998500
    GO TO EXTERNAL;                                                     03999000
END DCIOFINISH980;                                                      03999500
 SAVE PROCEDURE INITIATEIO(IODESC,MIX,U);%                              04000000
         VALUE IODESC,MIX,U;%                                           04001000
         REAL MIX,U;%                                                   04002000
         REAL IODESC;%                                                  04003000
         BEGIN LABEL EXIT;%                                             04004000
              REAL PT=+1;                                           %R5904004100
              P(TIO);                                               %R5904004200
$OMIT 04004501, IF DCP;                                                 04004498
$ INCLUDE 04004501, IF SAVERESULTS OR DEBUGGING;                        04004499
              IF U=30 THEN STORAWAY:=IODESC;                            04004500
              CHANNEL[P(DUP)]~U;                                        04005000
              P([IODESC],IIO);%                                         04006000
              CHANIO[PT]:=CLOCK+P(RTR);                             %R5904007000
              IF U < 16 THEN%                                           04008000
              IF IODESC.[22:1] THEN%                                    04009000
                   BEGIN TRANSACTION[U] ~ IF IODESC.[18:1] THEN 0%      04010000
                             ELSE TRANSACTION[U]-1;%                    04011000
                        GO TO EXIT;%                                    04012000
         END;                                                           04013000
              TRANSACTION[U] ~ *P(DUP)+1;%                              04014000
$INCLUDE 04014095, IF STATISTICS;                                       04014009
         IF (U OR 1)=19 THEN                                            04014010
         BEGIN COUNTUP(0,IODESC.[27:6]);                                04014020
              COUNTUPBY(32,CLOCK+P(RTR)-DISKWAITIME[NT3]);              04014022
              IF MIX NEQ 0 THEN COUNTUPBY(9,1);                         04014025
              MIX:=IODESC.[27:6];                                       04014027
              COUNTUPBY(2,U=18);                                        04014030
              U:=M[IODESC];                                             04014035
              IF U.[6:6]=0 THEN COUNTUPBY(4,1) ELSE                     04014038
              IF U.[6:6]=1 THEN COUNTUPBY(4,16777216) ELSE              04014040
              IF U.[6:6]=2 THEN COUNTUPBY(5,1) ELSE                     04014042
              COUNTUPBY(5,16777216);                                    04014044
              STREAM(U:=[U]); BEGIN SI:=U; DS:=8 OCT END;               04014045
              IF U GEQ MCPBASE AND U LEQ MCPTOP THEN COUNTUP(10,MIX);   04014050
              IF U GEQ ESPDISKBOTTOM AND U LEQ ESPDISKTOP THEN          04014055
              COUNTUP(11,MIX) ELSE IF U GEQ DIRECTORYTOP THEN           04014060
              IF U LSS BYPASS.[CF] THEN                                 04014065
                   COUNTUP(((U-DIRECTORYTOP).[44:4]=3)+25,MIX) ELSE     04014067
              IF U LEQ DISKBOTTOM THEN COUNTUP(12,MIX);                 04014070
              COUNTUPBY(13,IODESC.[CF] LSS FENCE);                      04014080
             IF PT=4 THEN COUNTUPBY(36,16777216) ELSE                   04014082
             IF PT=3 THEN COUNTUPBY(35,16777216) ELSE                   04014084
             COUNTUPBY(34+PT,1);                                        04014086
         END ELSE IF PT=4 THEN COUNTUPBY(59,16777216) ELSE              04014090
         IF PT=3 THEN COUNTUPBY(58,16777216) ELSE                       04014092
         COUNTUPBY(57+PT,1);                                            04014094
    EXIT:END;                                                           04014100
 SAVE PROCEDURE WAITORSWAP(U,A); VALUE U,A; REAL U,A;                   04014200
         BEGIN REAL N;                                                  04014300
              LABEL L;                                                  04014400
              L:                                                        04014500
              BEGIN CLICK~CLOCK+P(RTR)+32;                              04014600
                   SLEEP([M[A]],IOMASK);                                04014700
                   IF (M[A] AND IOMASK)!0 THEN P(XIT);                  04014710
                   IF P1MIX!0 THEN                                      04014800
                   BEGIN                                                04014900
                   IF (NT2~UNIT[U].[13:5])=16 OR NT2=31 THEN            04015000
                   IF [MEM[P1MIX,0]].[CF]}FENCE THEN                    04015100
                        BEGIN REPLY[P1MIX]~-4; SWAP(WAITSWAP,1); END;   04015200
                   IF TERMSET(P1MIX) THEN                           %R7004015290
                   IF (N~N+1)>9 THEN                                    04015300
                   IF U!25 THEN                                         04015310
                   BEGIN                                            %R7004015400
                         UNIT[U]:=(*P(DUP))&LOCATQUE[               %R7004015410
                            N:=P(DUP).[FF]][FTF]&0[13:13:5];        %R7004015420
                         IOQUE[N]:=IOQUEAVAIL;                      %R7004015430
                         IOQUEAVAIL:=N+1;                           %R7004015440
                         M[A]:=(*P(DUP))&1[30:47:1] OR IOMASK;      %R7004015460
                         P(XIT);                                    %R7004015470
                   END;                                             %R7004015480
                   END;                                                 04015500
              END; GO TO L;                                             04015600
         END;                                                           04015700
 SAVE PROCEDURE QUEUEUP(U); VALUE U ; REAL U;%                          04016000
    BEGIN IF U=30 THEN                                                  04016100
         WAITQUE[FIRSTWAIT:=(FIRSTWAIT+31) AND 31]:=U ELSE              04016200
         BEGIN WAITQUE[NEXTWAIT] ~ U;%                                  04017000
              NEXTWAIT ~ NEXTWAIT+1 AND 31;%                            04018000
         END;%                                                          04019000
    END;                                                                04019100
 SAVE PROCEDURE STARTIO(U); VALUE U; REAL U;%                           04020000
    BEGIN REAL T=NT1,R=NT2, S=NT3;%                                     04021000
$INCLUDE 04021101, IF DFX;                                          %DFX04021099
         LABEL BACK;                                                %DFX04021100
              IF (T ~ UNIT[U]).[13:5] = 0 THEN%                         04022000
              IF (S ~ T.[18:15]) < @1777 THEN%                          04023000
$INCLUDE 04023101, IF DFX;                                          %DFX04023099
    BACK:                                                           %DFX04023100
                   BEGIN IF P(TIO) ! 0 THEN%                            04024000
                             BEGIN INITIATEIO(IOQUE[S],LOCATQUE[S].[3:5]04025000
                                       ,U);%                            04026000
                                  P(3);%                                04027000
                             END%                                       04028000
                        ELSE BEGIN QUEUEUP(U);%                         04029000
                                  P(4);%                                04030000
                             END;%                                      04031000
                        P(T&P(XCH)[15:45:3],[UNIT[U]],~);%              04032000
$OMIT    04033001, IF DFX;                                          %DFX04032999
                   END;%                                                04033000
$INCLUDE 04033701, IF DFX;                                          %DFX04033049
                   END ELSE                                         %DFX04033050
              IF (U AND @76)=18 THEN                                %DFX04033100
              IF EUW<@7777700000 THEN                               %DFX04033200
              BEGIN NT4~S~(T~T&EUQ[R~EUW.[FF]][18:18:30]).[FF];     %DFX04033300
                   EUW~ EUW & EUQ[R][18:3:15];                      %DFX04033400
                   EUQ[R]~NABS(U);                                  %DFX04033500
                   IF U=19 THEN DO IOQUE[NT4].[3:5]~12              %DFX04033510
                        UNTIL (NT4~LOCATQUE[NT4].[FF])>1023;        %DFX04033520
                   GO BACK;                                         %DFX04033600
              END;                                                  %DFX04033700
    END;%                                                               04034000
 SAVE PROCEDURE PRINTERFINISH(U); VALUE U; REAL U;%                     04035000
         BEGIN IF NOT UNIT[U].[16:1] THEN UNIT[U].[17:1] ~ 0;%          04036000
              STARTIO(U);%                                              04037000
              GO TO EXTERNAL;%                                          04038000
         END;%                                                          04039000
PROCEDURE LBMESS(FN,SN,A,B,C,D,E);VALUE FN,SN,A,B,C,D,E;                04039500
    REAL FN,SN,A,B,C,D,E; FORWARD;                                      04039600
 SAVE PROCEDURE IOREQUEST(FINAL,IODESC,LOCATION);%                      04040000
         VALUE FINAL,IODESC,LOCATION;%                                  04041000
         ARRAY FINAL,LOCATION[*];%                                      04042000
         REAL IODESC;%                                                  04043000
         BEGIN REAL U=NT1,T=NT2,S=NT3,R=+1;%                            04044000
$INCLUDE 04044201, IF DFX;                                          %DFX04044099
              REAL EU=NT4;                                          %DFX04044100
              LABEL FAKE,DOIT,IN;                                   %DFX04044200
              IF IOQUEAVAIL = 0 THEN%                                   04045000
                   SLEEP([IOQUEAVAIL],1023);%                           04046000
              IOQUEAVAIL ~ IOQUE[S~IOQUEAVAIL-1];%                      04047000
$INCLUDE 04047011, IF STATISTICS;                                       04047009
         DISKWAITIME[S]:=CLOCK+P(RTR);                                  04047010
$INCLUDE 04048651, IF DFX;                                          %DFX04047099
              IF ((U~LOCATION.[12:6]) AND 62) = 18 THEN             %DFX04047100
              BEGIN IF (T~EUQ[EU~M[IODESC].[6:6]])<0 THEN GO FAKE;  %DFX04047200
                   IF DISKOUNT>0 THEN                               %DFX04047300
                   BEGIN U ~ 18; IF P(RRR).[29:1] THEN              %DFX04047400
                   IN:                                              %DFX04047450
                   IF UNIT[U].[FF]>1023 THEN                        %DFX04047500
                   BEGIN DISKOUNT~DISKOUNT-1;                       %DFX04047600
                        EUQ[EU]~NABS(T~U);                          %DFX04047700
    FAKE:               IODESC~IODESC&TINU[U~ABS(T)][3:3:5];        %DFX04047800
                        LOCATION.[12:6]~U;                          %DFX04047900
                        GO DOIT                                     %DFX04048000
                   END; IF U ! U ~ 19 THEN                          %DFX04048050
                        IF P(RRR).[28:1] THEN GO IN; END;           %DFX04048060
                   DISKOUNT~0;                                      %DFX04048100
                   IF T.[FF]>@1777 THEN                             %DFX04048150
                   BEGIN T~S&S[CTF]&@7777700000[3:18:15];           %DFX04048200
                        IF EUW<@7777700000 THEN                     %DFX04048250
                          EUQ[EUW.[CF]].[3:15]~EUW~EUW&EU[CTC] ELSE %DFX04048300
                          EUW~EU & EU [CTF];                        %DFX04048350
                   END ELSE                                         %DFX04048400
                     LOCATQUE[T.[CF]].[FF]~T~T&S[CTC];              %DFX04048450
                   EUQ[EU]~T;                                       %DFX04048500
              END ELSE                                              %DFX04048550
              BEGIN                                                 %DFX04048600
    DOIT:     IF (T~UNIT[U]).[13:5] = 0 THEN                        %DFX04048650
$OMIT    04048801, IF DFX;                                          %DFX04048799
              IF (T ~ UNIT[U ~ LOCATION.[12:6]]).[13:5] = 0 THEN        04048800
                   BEGIN IF P(TIO) ! 0 THEN%                            04049000
                        BEGIN INITIATEIO(IODESC,P1MIX,U);%              04050000
                             P(3);%                                     04051000
                        END ELSE BEGIN QUEUEUP(U);%                     04052000
                             P(4);%                                     04053000
                        END;%                                           04054000
                        T ~ T&P(XCH)[15:45:3]&S[18:33:15];%             04055000
                   END ELSE%                                            04056000
                        IF T.[FF]>1023 THEN                             04057000
                        IF T.[13:5]=@31 THEN                            04057100
                        BEGIN                                           04057200
                             IOQUEAVAIL~S+1;                            04057300
                             P(XIT)                                     04057400
                        END ELSE                                        04057500
                              T.[18:15] ~ S ELSE%                       04058000
                        LOCATQUE[P(T.[33:15],DUP)]~LOCATQUE[R]&%        04059000
                             S[18:33:15];%                              04060000
$INCLUDE 04060201, IF DFX;                                          %DFX04060099
                   UNIT[U]~T&S[CTC];                                %DFX04060100
              END;                                                  %DFX04060200
              LOCATQUE[S] ~ LOCATION&P1MIX[3:43:5] OR @7777700000;%     04061000
$OMIT    04062001, IF DFX;                                          %DFX04061999
              UNIT[U] ~ T&S[33:33:15];%                                 04062000
              IOQUE[S] ~ IODESC;%                                       04063000
              IOCOUNT[P1MIX]~*P(DUP)+(T.[13:5]!16);                     04063100
              FINALQUE[S] ~ FINAL;%                                     04064000
         END;%                                                          04065000
 SAVE PROCEDURE FINISHOFFIO(U); VALUE U; REAL U;%                       04067000
    BEGIN REAL FIN=NT6,V=NT4,T=NT1,IOD=NT3;%                            04068000
              LABEL ON,OFF,C0,C1,C2,C3,C4,C5,C6,C7;%                    04069000
              SWITCH CSW ~ C0,C1,C2,C3,C4,C5,C6,C7;%                    04070000
              IF FIN > 0 THEN%                                          04071000
              IF FIN.[25:1] THEN%                                       04072000
                   BEGIN T ~ FIN.[3:5];%                                04073000
                        FIN ~ FIN&IOD[3:3:5]&0[25:25:1];%               04074000
                        GO TO CSW[T];%                                  04075000
                   END ELSE GO ON ELSE GO ON;%                          04076000
         C0:  GO TO C0;%                                                04077000
         C1:  FIN.[8:10] ~ V;%                                          04078000
              GO TO C2;%                                                04079000
         C3:  FIN.[8:10] ~ V;%                                          04080000
         C4:  FIN ~ NOT V INX 1 INX FIN;%                               04081000
              GO TO C5;%                                                04082000
         C6:  STREAM(A~0:IOD);%                                         04083000
                   BEGIN DI ~ LOC A; SI ~ IOD; SI ~ SI+4; DS~4 OCT END; 04084000
              T ~ P DIV 8-1;%                                           04085000
         OFF: FIN.[8:10] ~ T;%                                          04086000
              GO TO C2;%                                                04087000
         C7:  STREAM(A~0:IOD);%                                         04088000
                   BEGIN DI ~ LOC A; SI ~ IOD; DS ~ 4 OCT END;%         04089000
              T ~ P DIV 8-1;%                                           04090000
              FIN ~ (NOT T INX 1 INX FIN)&T[8:38:10];%                  04091000
              GO TO C5;%                                                04092000
         ON:  IF U < 16 THEN%                                           04093000
              IF IOD.[22:1] THEN%                                       04094000
         C5:       M[IOD INX 1] ~ M[NOT V INX IOD INX 1] ~ V%           04095000
              ELSE%                                                     04096000
         C2:  M[IOD INX NOT 0] ~ V;%                                    04097000
         END;%                                                          04098000
 DEFINE FS[FS1,FS2]=UV3[FS1,6,FS2]#;                                    04098400
 DEFINE FSROW[FSROW1]=UV [FSROW1,6]#;                                   04098500
DEFINE USERCODE[USERCODE1]=UV[USERCODE1,4]#;                            04098600
REAL MCP;                                                               04098700
 PROCEDURE PROGRAMRELEASE;%                                             04099000
         BEGIN NAME T; REAL FSX=JUNK;                                   04100000
              ARRAY R=-4[*];%                                           04101000
              REAL IOD=NT1;%                                            04102000
              ARRAY LOCN[*];%                                           04103000
              REAL S;                                                   04103050
              CHECKSTACKSPACE;%                                     %WF 04103100
    LOCN~M[S~(IF(IOD~NFLAG(M[P(T~[M[PRT[P1MIX,9]]],DUP,PRL)]))          04104000
                                  .[22:1] THEN 2 ELSE NOT 1) INX IOD];  04105000
                    IF IOD.[3:5]= 6 THEN                                04105100
              BEGIN; STREAM(S:=M[PRT[P1MIX,8]] INX P(DUP,0,XCH,DIA 10,  04105200
                        DIB 30,TRB 2),D~@600005);                       04105300
                   BEGIN SI~S; DS~2 CHR END;                            04105400
$INCLUDE 04105411, IF STATISTICS;                                       04105409
                   COUNTUP(27,IOD.[27:6]);                              04105410
           IF JUNK.[36:12]!45 AND RELTOG                                04105500
             OR M[IOD].[3:6] = 0 AND M[IOD]  LSS (DIRDSK | DSKTOG) THEN 04105510
    IF (USERCODE[P1MIX] EQV MCP) ! NOT 0 THEN                           04105550
                   BEGIN TERMINATE(P1MIX); TERMINALMESSAGE(30) END;     04105600
                   IF(FS[P1MIX,(FSX~P(*(NOT 2 INX LOCN),4,COC).[13:11]  04105650
                                    DIV 5).[40:4]]                      04105700
                        AND TWO(IOD.[24:1]&FSX[43:44:4]))!0 THEN        04105750
                   BEGIN T[0]:=T[0]&1[19:47:1]&0[26:40:7];              04105800
                        M[(*((NOT 2)INX LOCN))INX 5 ]:= NABS(*P(DUP));  04105850
                        GO TO RETURN;                                   04105890
                   END;                                                 04105900
                   IF NOT IOD.[24:1] THEN M[S].[11:1]~1;                04105950
              END DISK BUSINESS;                                        04105990
              IOREQUEST(R,IOD,LOCN);%                                   04106000
              T[0]~T[0]&0[26:26:7]&0[19:19:1];                          04107000
              IF (NT1~P(*(NOT 2 INX LOCN),13,COC).[10:9]-1)!0 THEN%     04108000
                   STREAM(NT1,C~T[0],T);                                04109000
                        BEGIN SI ~ T; SI ~ SI+8; DS ~ NT1 WDS;%         04110000
                             SI ~ LOC C; DS ~ WDS;%                     04111000
                        END;%                                           04112000
              GO TO RETURN;%                                            04113000
         END;%                                                          04114000
 SAVE PROCEDURE NEWIO;%                                                 04115000
         BEGIN REAL S=NT3,U=NT4;%                                       04116000
              S ~ UNIT[U~WAITQUE[FIRSTWAIT]].[18:15];%                  04117000
              INITIATEIO(IOQUE[S],LOCATQUE[S].[3:5],U);%                04118000
              FIRSTWAIT ~ FIRSTWAIT+1 AND 31;%                          04119000
              UNIT[U].[13:5] ~ 3;%                                      04120000
         END;%                                                          04121000
 SAVE PROCEDURE IOFINISH(R,U); VALUE U,R; REAL U,R;%                    04122000
    BEGIN BOOLEAN STOP;                                                 04123000
         LABEL NOWAIT,PROC,INCR,TEST,NEW;%                              04124000
$INCLUDE 04124101, IF DFX;                                          %DFX04124099
LABEL DX;                                                           %DFX04124100
         LABEL X,OK,DS,DC,DK,LP,SW;%                                    04125000
         REAL T=NT1,S=NT2,S1=NT3,V=NT4,E=NT5,I=NT7;%                    04126000
         NAME LOCN=E; REAL IOD=S1; REAL FIN=NT6;%                       04127000
         SWITCH TYPE ~ OK,LP,OK,OK,DK,OK,OK,OK,OK,OK,DC;%               04128000
         REAL TIM=+2,DIN=+3;                                            04128100
         P(CHANIO[U]);                                                  04128200
         S~(T~UNIT[U~CHANNEL[  U]]).[FF];                               04129000
$OMIT 04129101, IF DCP;                                                 04129049
         IF R.[3:5] = @20 THEN % DATA COM RESULT DESCRIPTOR             04129050
         DCIOFINISH(R); % USES NT1,NT2,NT3 AS PARAMETERS                04129100
         IF (E ~ R.[26:7])+(V ~ T.[5:8] ) ! 0 THEN%                     04130000
              BEGIN IF(S1 ~ FINALQUE[S]) < 0 THEN%                      04131000
                   IF (E ~ S1.[25:8] AND E) = 0 THEN%                   04132000
$OMIT    04133001, IF DFX;                                          %DFX04132999
                        IF V = 0  THEN GO OK;%                          04133000
$INCLUDE 04133201, IF DFX;                                          %DFX04133099
         IF V=0 THEN IF (U AND 62)!18 THEN GO TO OK ELSE            %DFX04133100
         BEGIN I~IOQUE[S]; GO TO DX END;                            %DFX04133200
                   IF (U AND @774) ! 16 THEN GO TO X;                   04134000
                   IF E = 0 THEN%                                       04135000
                   IF V < 128 THEN GO TO X%                             04136000
                   ELSE BEGIN % RECOVERED MASS STORAGE%                 04137000
                             BEGIN;                                     04138000
                             M[I:=GETAREA(0)]:=U&LOCATQUE[S][28:3:5];   04138500
                             M[I+2]~M[M[I+1]~IOQUE[S]];                 04139000
                             M[I+3]:=R;                             %GEH04140000
                             M[I+4]:=T.[6:7];                           04140500
                             FORK(P(.DISKERROR),I,-2,0,1);              04141000
                             END;                                       04141500
                        T.[5:8] ~ 0;                                    04142000
                        GO TO SW;                                       04142500
                        END;%                                           04143000
                   IF V = 0 THEN%                                       04144000
$ INCLUDE 04144301, IF SHAREDISK;                                       04144099
                   IF R.[25:4]=9 THEN % LOCKED ADDRESS                  04144100
                   BEGIN                                                04144120
                        LQUE[LQAVAIL]:=M[IOQUE[S]]&S[1:41:7];           04144180
                        UNIT[U]:=(*P(DUP))&LOCATQUE[S][FTF]&0[5:35:13]; 04144200
                        LOCATQUE[S].[FF]:=@77777;                       04144220
                        STARTIO(U);                                     04144240
                        IOTIME[LOCATQUE[S].[3:5]]~*P(DUP)+CLOCK+P(RTR); 04144250
                        IF (LQAVAIL:=LQAVAIL+1)>LQMAX THEN              04144260
                             PUNT([PUNTER[27]]);                        04144270
                        GO TO EXTERNAL;                                 04144280
                   END ELSE                                             04144300
                        BEGIN % ORIGINAL ERROR ON MASS STORAGE%         04145000
                             TINU[U].[18:12]:=P(DUP).[18:12]+1;         04146000
                             V:=129;                                    04147000
$ INCLUDE 04147501, IF SHAREDISK;                                       04147399
                             LOCATQUE[S].[8:1]:=M[IOQUE[S]].[42:1];     04147400
                             IF NOT R.[25:1] THEN M[IOQUE[S]].[42:1]:=0;04147500
                        END%                                            04148000
                   ELSE BEGIN % RECURRENT ERROR ON MASS STORAGE%        04149000
                             IF V < 128 THEN GO TO X;%                  04150000
                             IF (V ~ V+1) > 137 THEN%                   04151000
                                  BEGIN V ~ 0; GO TO X END;%            04152000
                        END;%                                           04153000
                   UNIT[U] ~ T&V[5:40:8];%                              04154000
    DS:%                                                                04155000
                   CHANNEL[P(TIO)] ~ U;%                                04156000
                   CHANIO[P(TIO)]:=TIM;                             %R5904156100
                   P([IOQUE[S]],IIO);%                                  04157000
                   GO TO EXTERNAL ;%                                    04158000
    X:             STOP ~ (V!0)|2+1;%                                   04159000
                   T.[5:13] ~ 32|E+8;%                                  04160000
                   GO TO TEST; :: END;%                                 04161000
    SW:: GO TO TYPE[T.[1:4]];%                                          04162000
    LP::%                                                               04163000
              BEGIN IF STOP ~ (T ~ T&0[16:16:1]).[17:1] THEN%           04164000
    TEST:          IF FIRSTWAIT = NEXTWAIT THEN GO TO INCR ELSE%        04165000
                        GO TO NEW ELSE GO TO NOWAIT;%                   04166000
              :: END;%                                                  04167000
    DK:: IF NOT(I~IOQUE[S]).[24:1] THEN%                                04168000
         IF FINALQUE[S].[24:1] THEN%                                    04169000
              BEGIN IOQUE[S] ~ I&1[24:47:1];%                           04170000
                   M[I] ~ M[I INX NOT 0];%                              04171000
                   GO TO DS;%                                           04172000
$OMIT    04173001, IF DFX;                                          %DFX04172999
              :: END;                                                   04173000
$INCLUDE 04173901, IF DFX;                                          %DFX04173004
                          END;                                      %DFX04173005
DX:                                                                 %DFX04173010
              IF LOCATQUE[S].[FF]<1023 THEN GO TO OK;               %DFX04173100
              IF (*P([EUQ[M[I].[6:6]]],DUP))<0 THEN P(ABS(NOT 0),   %DFX04173110
                                        XCH,~) ELSE P(DEL);         %DFX04173120
              IF EUW.[FF]>1023 THEN DISKOUNT~DISKOUNT+1 ELSE        %DFX04173200
        BEGIN EUW~EUW&(I~EUQ[S1~EUW.[FF]])[18:3:15];                %DFX04173500
              EUQ[S1]~NABS(U);                                      %DFX04173600
              LOCATQUE[S1~S]:=P(DUP,LOD)&I[FTF]; T.[CF]:=I;         %DFX04173700
              IF U=19 THEN WHILE(S1:=LOCATQUE[S1].[FF])<1023 DO     %DFX04173800
                        IOQUE[S1].[3:5]:=12;                        %DFX04173850
        END;  GO TO OK;                                             %DFX04173900
    DC::                                                                04174000
                                                                        04176000
    OK:: IF FIRSTWAIT = NEXTWAIT THEN%                                  04177000
    NOWAIT:   BEGIN IF (S1 ~ LOCATQUE[S].[18:15]) < @1777 THEN%         04178000
                      BEGIN%                                            04179000
                        INITIATEIO(IOQUE[S1],LOCATQUE[S1].[3:5],U)%     04180000
                       ;GO TO INCR; ::%                                 04181000
                      END; BEGIN%                                       04182000
    PROC:                    T ~ T&0[16:16:2];%                         04183000
                            ;GO TO INCR; ::%                            04184000
                        END;%                                           04185000
              :: END;%                                                  04186000
              BEGIN%                                                    04187000
    NEW:           NEWIO;%                                              04188000
                   IF STOP THEN GO TO INCR;%                            04189000
                   IF LOCATQUE[S].[18:15] > @1777 THEN GO TO PROC;%     04190000
                   QUEUEUP(U);%                                         04191000
                   T ~ T&4[13:43:5];%                                   04192000
              END;%                                                     04193000
    INCR::%                                                             04194000
         IF (TIM~CLOCK+P(RTR)-TIM) LSS 0 THEN TIM~0;                    04194050
         IF (U OR 1)=19 THEN                                            04194100
         BEGIN                                                          04194200
         IF (DIN~M[IOQUE[S]] .[5:7])GTR 9 THEN                          04194300
         DIN~NEUP.[CF]+(DIN AND @17);                                   04194400
         PEUIO[DIN]~P(DUP,LOD)+TIM;                                     04194500
         END;                                                           04194600
         IOTIME[I:=(S1:=LOCATQUE[S]).[3:5]]:=*P(DUP)+TIM;           %R5904195000
         IF P(.S1,LOD).[10:1] THEN                                      04195100
         BEGIN IF M[FIN:=P(.S1,LOD).[CF]-1].[18:7]=13 THEN          %R1004195200
                   FORGETAREA(0,FIN) ELSE QUEVENT(FIN,I);           %R1004195210
              IF (V ~ M[FIN+2])<0 THEN FORGETSPACE(V) ELSE              04195300
              BEGIN IF V.[2:1] THEN ELSE P([M[V]], PRL);                04195400
                   M[V+1] ~ M[FIN+3];                                   04195500
         END  END  CANDE HANDLER;                                       04195600
         IF E = 0 THEN%                                                 04196000
              BEGIN UNIT[U] ~ T&P(.S1,LOD)[18:18:15];%                  04197000
                   IOCOUNT[I]~*P(DUP)-1;                                04197500
                   IOD ~ IOQUE[S];%                                     04198000
                   IOQUE[S] ~ IOQUEAVAIL;%                              04199000
                   IOQUEAVAIL ~ S+1;%                                   04200000
              END%                                                      04201000
         ELSE BEGIN UNIT[U] ~ T;%                                       04202000
                   IOD ~ IOQUE[S];%                                     04203000
              END;%                                                     04204000
         FIN ~ FINALQUE[S] AND NOT MEMORY;%                             04205000
         IF IOD.[24:1] THEN%                                            04206000
              BEGIN V ~ ABS(IOD.[33:15]-R.[33:15]);%                    04207000
                   IF IOD.[8:10] < V THEN%                              04208000
                   IF IOD.[23:1] THEN%                                  04209000
                        V ~ IOD.[8:10];%                                04210000
                   IF U < 16 THEN%                                      04211000
                   IF IOD.[21:2] = 0 THEN%                              04212000
                        BEGIN; STREAM(A~0:B~M[S1.[33:15]+V-1]);%        04213000
                                  BEGIN SI ~ LOC B;%                    04214000
                                       IF SC = "~" THEN TALLY ~ 1;%     04215000
                                       A ~ TALLY;%                      04216000
                                  END;%                                 04217000
                             V ~ -P+V;%                                 04218000
                        END;%                                           04219000
                                                                        04219100
              FINISHOFFIO(U);%                                          04220000
              END;%                                                     04221000
         IF E ! 0 THEN%                                                 04222000
              BEGIN IF STOP = 1 THEN%                                   04223000
                   FORK(P(.IOERR),R&U[3:43:5]&(LOCATQUE[S]:=(*P(DUP))&  04223100
                        1[11:47:1])[1:9:1],-2,0,0)                      04224000
                   ELSE IF FIN < 0 THEN P(LOCATQUE[S],R,XCH,~);%        04225000
              END%                                                      04226000
         ELSE BEGIN%                                                    04227000
              IF FIN < 0 THEN P(R OR IOMASK,LOCATQUE[S],~)%             04228000
              ELSE                                                      04228100
                   BEGIN                                                04229200
                   LOCN ~ [M[LOCATQUE[S]]];%                            04230000
                   IOD ~ IOD.[33:15];%                                  04231000
                   WHILE LOCN[0].[33:15] ! IOD DO%                      04232000
                        LOCN ~ 1 INX LOCN;%                             04233000
                   LOCN[0] ~ M OR FIN;%                                 04234000
              END  END;%                                                04235000
         IF P1MIX = 0 THEN GO TO NOTHINGTODO;%                          04236000
         IF I = P1MIX THEN GO TO RETURN;%                               04237000
         GO TO INITIATE;%                                               04238000
    END IOCOMPLETE;%                                                    04239000
 SAVE REAL PROCEDURE WAITIO(IOD,MASK,U);%                               04240000
         VALUE MASK,U,IOD;%                                             04241000
         REAL MASK,U,IOD;%                                              04242000
         BEGIN%                                                         04243000
              REAL T;                                                   04243100
              DEFINE OCTADE= DS~3 RESET;3(IF SB THEN DS~SET ELSE        04243200
                   DS~RESET;SKIP SB)#;                                  04243300
              IOD ~ NFLAG(P(.IOD,LOD))&TINU[U][3:3:5];%                 04244000
              MASK ~ NOT MASK;%                                         04245000
                IOREQUEST(NABS(IOD)&MASK[25:40:8],IOD,                  04246000
                   [IOD]&U[12:42:6]);%                                  04247000
              IOD ~ IOD&0[25:25:8]&0[19:19:1];%                         04248000
              WAITORSWAP(U,[IOD].[CF]);                                 04249000
              IF ((WAITIO~IOD.[26:7]) AND MASK AND MASK.[18:15])!0 THEN 04250000
              BEGIN                                                     04251000
                   T~GETSPACE(12,0,0)+2;                                04251100
                   STREAM(IOD~IOD.[26:7],MASK~(NOT MASK).[41:7],        04251200
                        Z~[TINU[U]],T~T);                               04251300
                   BEGIN DS~20 LIT" UNEXP I-O ERROR ON ";SI~Z;          04251400
                        SI~SI+5;DS~3 CHR;DS~8 LIT":RESULT=";            04251500
                        SI~LOC IOD;SI~SI+6;SKIP 3 SB;3(OCTADE);         04251600
                        DS~6 LIT",MASK=" ;SI~SI+6;SKIP 3 SB;            04251700
                        3(OCTADE);DS~2 LIT".~";                         04251800
                   END;                                                 04251900
                   IF P1MIX = 0 THEN PUNT (T);                          04252000
                   IF NOTERMSET(P1MIX) THEN                             04252100
                   BEGIN                                                04252200
                        TERMINATE(P1MIX&19[18:33:15]);                  04252300
                        IF (JAR[P1MIX,0] EQV "LIBMAIN")=NOT 0 AND       04252400
                           (JAR[P1MIX,1] EQV "DISK   ")=NOT 0 THEN      04252500
                        BEGIN                                           04252600
   SPOUTIT(T,35); % UNEXPEOERROR-LIBMAIN                            %R6404252700
                             BLASTQ(U);                                 04252800
                        END ELSE                                        04252900
                        TERMINALMESSAGE(-T);                            04253000
                   END;                                                 04253100
              END;                                                      04253200
         END;                                                           04253300
 REAL PROCEDURE TAPEPARITYRETRY(R,U);%                                  04254000
    VALUE R,U; REAL R,U; FORWARD;%                                      04255000
 PROCEDURE ACTUALIOERR(U,R); VALUE U,R; REAL U,R;%                      04256000
    BEGIN REAL E=+1,%                                                   04257000
              T=E+1,%                                                   04258000
              KEY=T+1,%                                                 04259000
              S=KEY+1,%                                                 04260000
              T1=S+1,%                                                  04261000
                        U1=T1,%                                     %GEH04261500
              T2=T1+1,%                                                 04262000
              T3=T2+1,%                                                 04263000
              MASK=T3+1;%                                               04264000
         NAME LOCN = T3;%                                               04265000
         REAL FIN =NT6; REAL IOD= NT3;%                                 04266000
         LABEL LOCKOUT,MASSRETRY,KILLL,NTRDY,LEAVE,TAPERETRY;%          04267000
              LABEL REWINDING,PAPERPUNCH,PAPER,DATACOM;                 04268000
         LABEL SIX,L3P,DSIT,DONTDSIT,NOTREADYMESS,KILLER,DISKRETRY; %GEH04270000
         LABEL EOF,REALEOF,SEVEN;                                       04270100
         INTEGER I = T1;%                                               04271000
         LABEL L1,L2,START,SPO,PRINTER,TAPE,PUNCH,L3,DISK,DRUM,D19,D17, 04272000
              D22,FIX,CLEAR,READER,NOCODE;%                             04273000
         SWITCH W ~ READER,PRINTER,TAPE,DRUM,DISK,SPO,PUNCH,NOCODE,%    04274000
              PAPERPUNCH,PAPER,DATACOM;%                                04275000
         BOOLEAN F = MASK+1;%                                           04276000
         REAL TYPE = F+1;%                                              04277000
         REAL DISC = TYPE+1;                                        %GEH04277500
         REAL RCW=+0;%                                                  04278000
    SUBROUTINE SPACEA;%                                                 04279000
         BEGIN KEY := SPACE(10) END;                                    04280000
         P(SPACE(128)-2,STS,.ACTUALIOERR,U,R,RCW,0,RDS,0,XCH,CFX,STF,   04281000
              [U],CFX);                                                 04281100
         P(0,0,0,0,0,0,0,0,0,0,0);                                  %GEH04282000
         STACKUSE ~ TRUE;%                                              04283000
         IF DISC := (U.[2:2]!0) THEN                                %GEH04284000
              BEGIN NOPROCESSTOG:=NOPROCESSTOG-1;                   %GEH04285000
$INCLUDE 04287401, IF DFX;                                          %GEH04285099
                   IF U.[2:1] THEN                                  %GEH04285100
                   IF R.[30:1] THEN        % DISK NOT READY         %GEH04285200
                   BEGIN T:=S:=U.[FF];                              %GEH04285300
                        IF NOT (U1:=IF R.[3:5] THEN 18 ELSE 19) THEN    04285400
                             DO IOQUE[T].[3:5] := 6 UNTIL           %GEH04285500
                             (T := LOCATQUE[T].[FF]) = @77777;      %GEH04285600
                        IF (T2:=EUQ[T:=M[IOQUE[S]].[6:6]]) LSS 0 THEN   04285700
                        BEGIN                    % EU IN PROCESS    %GEH04285800
                             LOCATQUE[UNIT[T2]].[FF] := S;          %GEH04285900
                             UNIT[T2].[CF] := U;                    %GEH04286000
                        END ELSE                 % EU NOT IN PROCESS    04286100
                        IF T2.[FF] = @77777 THEN      % EUQ EMPTY   %GEH04286200
                        BEGIN EUQ[T] := ABS((NOT 0)&U[18:18:30]);   %GEH04286300
                             IF EUW.[FF]=@77777 THEN EUW.[FF]:=T ELSE   04286400
                             EUQ[EUW].[3:15]:=T;                    %GEH04286500
                             EUW.[CF]:=T;                           %GEH04286600
                             STARTIO(U1);                           %GEH04286700
                        END ELSE                      % EUQ NOT EMPTY   04286800
                        BEGIN LOCATQUE[T2].[FF] := S;               %GEH04286900
                             EUQ[T].[CF] := U;                      %GEH04287000
                        END;                                        %GEH04287100
                        UNIT[U:=R.[3:5]] := (*P(DUP))&@77777[15:30:18]; 04287200
                        GO TO NOTREADYMESS;                         %GEH04287300
                   END;                                             %GEH04287400
                   LOCATQUE[S:=(T:=U&U[FTC]&0[13:13:2]).[CF]].[FF] :=   04287500
                   NOT 0;                                           %GEH04287600
                   IF (T1:=LOCATQUE[S].[3:5]) ! 0 THEN              %GEH04287700
                   IF FINALQUE[S] GEQ 0 AND (T.[8:1] OR T.[11:1]) THEN  04287800
                   GO DONTDSIT ELSE GO DSIT;                        %GEH04287900
                   IF (T3:=IOQUE[S].[CF] - FENCE) GTR 0 THEN        %GEH04288000
                   BEGIN T1:=POSSESS[T3 DIV CHUNKZIZE];             %10104288100
 DSIT:                  IF NOT (((T3:=JAR[T1,0]) = "CANDE  " AND    %GEH04288200
                        (E:=JAR[T1,1]) = "TSHARER") OR T3.[2:1] OR      04288300
                        (T3 = "LIBMAIN" AND E = "DISK   ")) THEN        04288350
                        BEGIN PRTROW[T1].[FF] :=19;                 %10104288400
                              PRTROW[T1].[PSF]:=1;                  %10104288410
                              F:=1;                                 %10104288420
                        END  TERMINATING T1;                        %10104288430
                   END;                                             %GEH04288500
 DONTDSIT:         U:=R.[3:5];                                          04288600
                   IF NOT LOCATQUE[S].[9:1] THEN                    %GEH04288700
                   BEGIN                                            %GEH04288800
                        M[E:=GETAREA(0)]:=U&T1[CTF];                    04288900
                        M[E+2]:=M[M[E+1]:=IOQUE[S]];                %GEH04289000
                        M[E+3]:=R&TINU[U][3:3:5];                   %GEH04289200
                        M[E+4]:=0;                                  %GEH04289400
                        FORK(P(.DISKERROR),E,-2,0,1);                   04289600
                   END;                                             %GEH04289800
              END ELSE                                              %GEH04290000
 START:  S ~ (T~ UNIT [U]&0[13:13:2]).[18:15];%                         04291000
         TRANSACTION[U] ~ TRANSACTION[U]-1;%                            04292000
         TYPE ~ T.[1:4];%                                               04293000
         MASK ~ IF (T2 ~ FINALQUE[S]) < 0 THEN T2.[25:8] ELSE @377;%    04294000
         IF (E ~ T.[5:8] AND MASK) = 0 THEN%                            04295000
              BEGIN F ~ 1; GO TO FIX END;%                              04296000
         IF E THEN%                                                     04297000
     BEGIN T3~1 & (U=30)[43:47:1];COMMENT D16 BUSY;                     04298000
                   IF U < 16 AND TRANSACTION[U] { 0 THEN%               04299000
                        BEGIN P(0); GO TO REWINDING END;%               04300000
                   IF U!25 THEN                                         04301000
                        BEGIN SPACEA;%                                  04302000
                             STREAM(A~TINU[U],KEY);%                    04303000
                                  BEGIN SI ~ LOC A; SI ~ SI+5;%         04304000
                                       DS ~ 3 CHR;%                     04305000
                                       DS ~ 6 LIT " BUSY~";%            04306000
                                  END;%                                 04307000
 L1:                         SPOUT(KEY);%                               04308000
                        END;%                                           04309000
 L2:               IF DISC THEN GO TO DISKRETRY;                    %GEH04310000
                   DO BEGIN                                         %GEH04310500
                        SLEEP([CLOCK],NOT CLOCK);                   %GEH04311000
                        UNIT[U]:=(*P(DUP))&P(T,XCH)[CTC];           %GEH04311500
                        STARTIO(U);                                 %GEH04312000
                        SLEEP([UNIT[U]],@100000000000);                 04312500
                        TRANSACTION[U] := TRANSACTION[U]-1;         %GEH04313000
                   END UNTIL (UNIT[U].[5:8] AND T3) = 0;            %GEH04314000
                   TRANSACTION[U] ~ TRANSACTION[U]+1;%                  04315000
                   IF (UNIT[U].[5:8] AND MASK) = 0 THEN GO TO CLEAR;%   04316000
                   GO TO START;%                                        04317000
              END;%                                                     04318000
         IF E.[45:1] THEN%                                              04319000
              BEGIN          COMMENT D18 - NOT READY;%                  04320000
                   IF E.[43:1] THEN % (SHM)                             04321000
                      BEGIN % (SHM)                                     04321100
                      IF TYPE=0 THEN GO TO READER; % READ CHECK (SHM)   04321200
                      IF TYPE=1 THEN GO TO PRINTER; % PRINT CHECK (SHM) 04321300
                      IF TYPE=6 THEN GO TO PUNCH; % PUNCH CHECK (SHM)   04321400
                      END;                                              04321500
                   IF U NEQ 25 THEN % NOT SPO.                          04322000
 NOTREADYMESS:  BEGIN SPACEA;                                       %GEH04322500
                   STREAM(A~TINU[U],KEY);%                              04323000
                        BEGIN DS ~ LIT "#"; SI ~ LOC A; SI ~ SI+5;%     04324000
                             DS ~ 3 CHR; DS ~ 11 LIT " NOT READY~";%    04325000
                        END;%                                           04326000
                   P(1);%                                               04327000
 REWINDING:%                                                            04328000
                   READY ~ NOT TWO(U) AND READY;%                       04329000
 NTRDY:            RRRMECH:=NOT TWO(U) AND RRRMECH;                     04330000
                   IF P THEN SPOUT(KEY);                                04331000
                END;                                                    04332000
                   UNIT[U].[5:10] ~ 2;%                                 04333000
                   IF (T1~LOCATQUE[T2~S].[3:5])!0 THEN                  04333100
                   IF NOT DISC THEN                                 %GEH04333150
                   BEGIN                                                04333200
                   DO BEGIN T2~LOCATQUE[T2].[FF];                       04333300
                        IOCOUNT[T1]~*P(DUP)-1;                          04333400
                   END UNTIL T2>1023;                                   04333500
                   END;                                                 04333600
                   GO TO KILLL;%                                        04335000
              END;%                                                     04336000
 D17:    IF E.[46:1] THEN     COMMENT D17 - MEM PARITY;%                04337000
              BEGIN SPACEA;%                                            04338000
                   STREAM(A ~ TINU[U],KEY);%                            04339000
                        BEGIN SI ~ LOC A; SI ~ SI+5; DS ~ 3 CHR;%       04340000
                             DS ~ 13 LIT " I/O MEM PAR~";%              04341000
                        END;%                                           04342000
      L3:  SPOUTIT (KEY,35); % I/O MEMPAR-ACTUALIOERROR             %R6404343000
                   P(@1537);                                            04344000
                   GO TO SIX;%                                          04345000
              END;%                                                     04346000
         IF E.[41:1] AND TYPE ! 2 THEN%                                 04347000
              BEGIN          COMMENT D22 - INVALID ADDRESS;%            04348000
D22:          SPACEA;                                                   04349000
              STREAM(A~TINU[U],KEY);                                    04350000
                        BEGIN SI ~ LOC A; SI ~ SI+5; DS ~ 3 CHR;%       04351000
                             DS ~ 14 LIT " I/O INV ADDR~";%             04352000
                        END;%                                           04353000
                   GO TO L3;%                                           04354000
              END;%                                                     04355000
              GO TO W[TYPE];%                                           04356000
 SPO:    IF E.[43:1] THEN GO TO L2;%                                    04357000
         GO TO D19;%                                                    04358000
 PRINTER:IF E.[42:1] THEN BEGIN%                                        04359000
              IF IOQUE[S].[27:6]=0 THEN GO FIX;                         04359100
                   COMMENT IGNORE EOP IF NO SPACE OR SKIP;              04359200
              IOQUE[S].[18:15] ~ @40001;%                               04360000
              GO TO CLEAR END;%                                         04361000
         IF E.[43:1] THEN%                                              04362000
              BEGIN SPACEA;%                                            04363000
                   STREAM(A~TINU[U],KEY);%                              04364000
                        BEGIN SI ~ LOC A; SI ~ SI+5;%                   04365000
                             DS ~ 3 CHR;%                               04366000
                             DS ~ 13 LIT " PRINT CHECK~";%              04367000
                        END;%                                           04368000
 L3P:              SPOUT(KEY);%                                         04369000
                   IF E.[45:1] THEN GO TO NOTREADYMESS; % (SHM)         04369100
                   P(0);%                                               04370000
                   TINU[U].[18:12] ~ P(DUP).[18:12]+1;%                 04371000
                   GO TO SIX;%                                          04372000
              END;%                                                     04373000
         GO TO D19;%                                                    04374000
 READER:      IF E.[43:1] THEN%                                         04375000
                   BEGIN     COMMENT D20 - READ CHECK ON CARD READER;%  04376000
                        SPACEA;%                                        04377000
                        TINU[U].[18:12] ~ P(DUP).[18:12]+1;%            04378000
                        STREAM(A~TINU[U],KEY);%                         04379000
                             BEGIN DS ~ LIT "#"; SI ~ LOC A; SI ~ SI+5; 04380000
                                  DS ~ 3 CHR; DS~12 LIT " READ CHECK~"; 04381000
                             END;%                                      04382000
                        P(1); GO TO NTRDY;                              04383000
                   END;%                                                04384000
              IF E.[42:1] THEN%                                         04385000
                   BEGIN     COMMENT D21 - END OF FILE CARD READER -%   04386000
                                  TREAT AS NOT READY;%                  04387000
                        UNIT[U].[5:8] ~ 4;%                             04388000
                        R.[25:8] ~ 4;%                                  04389000
                        TRANSACTION[U] ~ TRANSACTION[U]+1;%             04390000
                        GO TO START;%                                   04391000
                   END;%                                                04392000
              COMMENT MUST BE D19 - USUALLY INVALID CHARACTOR;%         04393000
              STREAM(A~0:B~IOQUE[S]);%                                  04394000
                   BEGIN DI ~ A; SI ~ B; DI ~ DI+8;%                    04395000
                        IF SC = @14 THEN A ~ DI;%                       04396000
                        2(40(DI~DI+8; SI~ SI+1;%                        04397000
                             IF SC = @14 THEN JUMP OUT 2 TO L);%        04398000
                             DI ~ DI-8; SI ~ SI-1;);%                   04399000
                        DI ~ A;%                                        04400000
                   L:   A ~ DI;%                                        04401000
                   END;%                                                04402000
              IF (T1 ~ P) = 0 THEN GO TO D19;%                          04403000
              IF T1 ! 1 THEN%                                           04404000
                   BEGIN SPACEA;%                                       04405000
                        STREAM(A~TINU[U],T1,KEY);%                      04406000
                             BEGIN DS ~ LIT "#"; SI ~ LOC A; SI ~ SI+5; 04407000
                                  DS ~ 3 CHR;%                          04408000
                                  DS ~ 16 LIT " INV CHR IN COL ";%      04409000
                                  DS ~ 2 DEC; DS ~ LIT "~";%            04410000
                             END;%                                      04411000
                        P(1); GO TO NTRDY;                              04412000
                   END;%                                                04413000
              T.[CF]~IOQUE[S];                                          04414000
              GO TO REALEOF;                                            04415000
                                                                        04416000
 PUNCH:  IF E.[43:1] THEN%                                              04417000
              BEGIN SPACEA;%                                            04418000
                   STREAM(A~TINU[U],KEY);%                              04419000
                        BEGIN SI ~ LOC A; SI ~ SI+5; DS ~ 3 CHR;%       04420000
                             DS ~ 13 LIT " PUNCH CHECK~";%              04421000
                        END;%                                           04422000
              SPOUT(KEY); % (SHM)                                       04423000
              IF E.[45:1] THEN GO TO NOTREADYMESS; % NOT READY (SHM)    04423100
              TINU[U].[18:12]:=P(DUP).[18:12]+1;% (SHM)                 04423200
              F:=0; GO TO CLEAR; % (SHM)                                04423300
              END;%                                                     04424000
         GO TO D19;%                                                    04425000
PAPERPUNCH:   IF R.[27:1] THEN BEGIN P(@40); GO TO SIX END;             04425100
              GO TO D19;                                                04425200
PAPER:        IF R.[27:2]!0 THEN GO TO EOF;                             04425300
              IF E.[44:1] THEN BEGIN P(@20); GO TO SIX END;             04425400
              GO TO NOCODE;                                             04425500
 D19:         IF E.[44:1] THEN%                                         04426000
                   BEGIN E ~ 1023; GO TO D17 END;%                      04427000
                                                                        04428000
DATACOM:IF(T3~1&E[43:43:1])=@21 THEN GO TO L2;                          04429000
 NOCODE:      BEGIN SPACEA;%                                            04430000
                   STREAM(A~TINU[U],KEY);%                              04431000
                        BEGIN SI ~ LOC A; SI ~ SI+5; DS ~ 3 CHR;%       04432000
                             DS ~ 11 LIT " I/O ERROR~";%                04433000
                        END;%                                           04434000
                   GO TO L3;%                                           04435000
              END;%                                                     04436000
 DRUM:        IF E.[42:1] THEN GO TO LOCKOUT;%                          04437000
              IF IOQUE[S].[2:1] AND E.[44:1] THEN%                      04438000
                   GO TO MASSRETRY ELSE GO TO D19;%                     04439000
 DISK:                                                                  04440000
$ INCLUDE 04440251, IF SHAREDISK;                                       04440019
              IF R.[25:1] THEN                                          04440020
              BEGIN SPACEA;                                             04440040
                   IF R.[29:1] THEN                                     04440050
                   BEGIN; STREAM(KEY);                                  04440060
                       DS:=10 LIT " FPM FULL~";                         04440070
                   END ELSE                                             04440080
                   BEGIN; STREAM(KEY);                                  04440090
                        DS:=15 LIT " FPM NOT READY~";                   04440100
                   END;                                                 04440110
                   SPOUT(KEY);                                          04440120
                   P(16);                                               04440140
                   GO TO SIX;                                           04440160
              END;                                                      04440180
              IF LOCATQUE[S].[8:1] THEN % MUST UNLOCK ADDRESS           04440190
              BEGIN                                                     04440200
                   STREAM(A:=M[IOQUE[S]],D:=[JUNK]);                    04440210
                   BEGIN SI:=LOC A;DS:=8 OCT END;                       04440220
                   UNLOCK(JUNK);                                        04440230
              END;                                                      04440240
              IF E.[44:1] THEN GO TO D19;                               04440900
              IF E.[42:1] THEN%                                         04441000
              BEGIN               % DISK ELECTRONICS UNIT NOT READY %GEH04442000
                   IF NOT LOCATQUE[S].[9:1] THEN                    %GEH04443000
                   BEGIN                                            %GEH04443500
                        SPACEA;%                                        04444000
                       STREAM(A~TINU[U],KEY);%                          04445000
                             BEGIN SI ~ LOC A; SI ~ SI+5; DS ~ 3 CHR;%  04446000
                                  DS ~ 14 LIT " NOT READY EU~";%        04447000
                             END;%                                      04448000
     SPOUTIT(KEY,35);  %DKA NTRY EU                                 %R6404448100
                   END;                                             %GEH04448200
                   T3:=32;                                          %GEH04448300
 DISKRETRY:        IF F THEN BEGIN P(T3); GO TO SIX END;            %GEH04448400
                   T1:=IOQUE[S]&6[3:43:5];            % NOT DS-ED SO    04448500
                   IOQUE[S]:=IOQUEAVAIL;              % TRY AGAIN   %GEH04448600
                   IOQUEAVAIL:=S+1;                                 %GEH04448700
                   IOREQUEST(FINALQUE[S],T1,LOCATQUE[S] &           %GEH04448800
                             @522[3:33:15]);                        %GEH04448900
                   GO TO KILLER;                                    %GEH04449000
              END;                                                  %GEH04450000
              IF IOQUE[S].[24:1] THEN%                                  04451000
 MASSRETRY:%                                                            04452000
                   BEGIN%                                               04453000
                        P(@20);%                                        04458000
                        GO TO SIX;%                                     04459000
                   END;%                                                04460000
 LOCKOUT:     SPACEA;%                                                  04461000
              STREAM(A~TINU[U],KEY);%                                   04462000
                   BEGIN SI~LOC A; SI~SI+5; DS~3CHR;%                   04463000
                        DS ~ 12 LIT " WRITE LOCK~"%                     04464000
                   END;%                                                04465000
              GO TO L3;%                                                04466000
 TAPE:        TRANSACTION[U] ~ TRANSACTION[U]+1;                        04467000
              IF E.[44:1] THEN IF R.[2:1] THEN                          04467500
              BEGIN IF R.[11:1] THEN GO TO D19;                         04468000
                    OPTION~OPTION OR M;% MEANS MOD3IOS~TRUE             04468100
                    IF R.[24:1] THEN                                    04468200
                    BEGIN IF R.[13:1] THEN R.[27:1]~1;                  04468300
                                                                        04468400
                          IF R.[14:1] THEN IF (E AND @367)=0 THEN       04468500
                          IF R.[27:1]=0 THEN GO TO FIX;                 04468510
                    END ELSE                                            04468600
                    BEGIN                                               04468610
                        IF R.[12:1] THEN                                04468620
                        BEGIN SPACEA;                                   04468630
                             STREAM(A~TINU[U],KEY);                     04468635
                             BEGIN SI~LOC A; SI~SI+5; DS~3 CHR;         04468640
                                  DS~ 21 LIT" BLANK TAPE ON WRITE~";    04468645
                             END;                                       04468650
 SPOUTIT(KEY,35); P(16); GO TO SIX;%BLNK TP-ACTIOERROR              %R6404468655
                        END;                                            04468660
                        IF R.[14:1] THEN R.[27:1]~1 ELSE GO FIX;        04468670
                  END;                                                  04468680
              END ELSE GO TO D19;                                       04468700
              IF R.[24:1] THEN%                                         04469000
                   BEGIN IF E.[41:1] THEN GO TO D22;%                   04470000
                        IF R.[27:1] THEN%                               04471000
EOF:                                                                    04471100
                        IF MASK.[42:1] THEN%                            04472000
 REALEOF:                                                               04472500
                             BEGIN F ~ @3100001;%                       04473000
                                  T.[5:8] ~ @40;%                       04474000
                                  GO TO FIX;%                           04475000
                             END%                                       04476000
                        ELSE BEGIN P(@40);%                             04477000
                                  GO TO SIX;%                           04478000
                             END;%                                      04479000
 TAPERETRY: IF (T~TAPEPARITYRETRY(R,U)).[5:8]=32 AND                    04480000
                P1MIX!0 THEN GO TO REALEOF;                             04480050
           P(T.[5:8]);                                                  04480100
                        GO TO SIX;%                                     04481000
                   END;%                                                04482000
              IF E.[41:1] THEN IF E.[43:1] THEN GO TO LOCKOUT%          04483000
                             ELSE GO TO D22;%                           04484000
              IF E.[43:1] THEN GO TO TAPERETRY;%                        04485000
              P(@40);%                                                  04486000
 SIX:         T ~ T&P(XCH)[5:40:8];%                                    04487000
              F ~ 1;%                                                   04488000
 FIX:         E ~ T.[5:8]|F;                                            04489000
              FIN ~ S;                                                  04489100
              IOD ~ IOQUE[S]  ;%                                        04490000
 SEVEN:       IOQUE[S]~IOQUEAVAIL;                                      04491000
              IOQUEAVAIL~S+1;                                           04492000
              IOCOUNT[LOCATQUE[S].[3:5]]~P(DUP,LOD)-1;                  04492500
              T.[FF]~S~LOCATQUE[S].[FF];                                04493000
              IF F=@3100001 THEN IF S!@77777 THEN GO TO SEVEN;          04493100
              S~FIN;                                                    04493200
              IF FALSE THEN%                                            04494000
 LEAVE:       IOD ~ IOQUE[S];%                                          04495000
              FIN ~ FINALQUE[S] AND NOT MEMORY;%                        04496000
              IF IOD.[24:1] THEN%                                       04497000
                   BEGIN NT4 ~ M[IOD INX ( IF IOD.[22:1] THEN 1 ELSE%   04498000
                             NOT 0)];%                                  04499000
                        FINISHOFFIO(U);%                                04500000
                   END;%                                                04501000
              IF ( T1~ FIN) < 0 THEN%                                   04502000
              P(R&E[25:40:8]&IOD[3:3:5]OR IOMASK,LOCATQUE[S],~)%        04503000
         ELSE BEGIN IF E ! 0 THEN%                                      04504000
                   BEGIN P(.T1,PRL);%                                   04505000
                        T1 ~ T1&E[25:40:8];%                            04506000
                   END ELSE P(.T1,IOR);%                                04507000
              LOCN ~ [M[LOCATQUE[S]]];%                                 04508000
              IOD ~ IOD.[33:15];%                                       04509000
              WHILE LOCN[0].[33:15] ! IOD DO%                           04510000
                   LOCN ~ 1 INX LOCN;%                                  04511000
              LOCN[0] ~ P(.T1,LOD);%                                    04512000
              END;%                                                     04513000
              IF NOT DISC THEN                                      %GEH04513500
              BEGIN UNIT[U] := T;                                   %GEH04514000
 CLEAR:            UNIT[U] := (*P(DUP))&F[5:20:13];                 %GEH04514500
                   STARTIO(U);                                      %GEH04515000
              END;                                                  %GEH04516000
 KILLL:%                                                                04517000
              LOCATQUE[S].[11:1]~0;                                     04517100
 KILLER:      KILL([U]);                                            %GEH04519000
 END;%                                                                  04520000
 SAVE PROCEDURE IOERR(U); VALUE U; REAL U;%                             04521000
         BEGIN%                                                         04522000
              REAL X,Y,Z;                                               04522500
              IF ((X:=U.[3:5]) AND @774) = 16 THEN                  %GEH04523000
                   BEGIN IF U GEQ 0 THEN                                04523500
                   BEGIN STREAM(A:=TINU[X],I:=IF U.[24:1] THEN "R"  %GEH04524000
                             ELSE "W",R~(U.[26:7]|P(DUP,DUP,|)|%        04525000
                             @1000000000000).[3:6]+16,K:=[X]);          04526000
                             BEGIN SI ~ LOC A; SI ~ SI+5; DS ~ 3 CHR;%  04527000
                             DS ~ LIT "("; SI ~ SI+7; DS ~ CHR;%        04528000
                             DS ~ 11 LIT ") FAILURE-D"; DS ~ 2 DEC;%    04529000
                             DS ~ LIT "~";%                             04530000
                             END;%                                      04531000
                        NT2:=WAITIO([X],@377,25);                       04532000
                   END;                                                 04532500
                        NT4:=(X:=UNIT[NT2:=U.[3:5]]).[18:15];           04533000
$ INCLUDE 04533601, IF DFX;                                         %GEH04533199
                        IF U.[30:1] THEN              % NOT READY   %GEH04533200
                        EUQ[M[IOQUE[NT4]].[6:6]] := ABS(NOT 0) ELSE %GEH04533400
                        BEGIN                                       %GEH04533600
                        UNIT[NT2]:=NFLAG([M[X]])&LOCATQUE[NT4]          04534000
                             [18:18:15];%                               04535000
                        STARTIO(NT2);%                                  04537000
$ INCLUDE 04537501, IF DFX;                                         %GEH04537499
                        END;                                        %GEH04537500
                        HALT;%                                          04538000
                   END;%                                                04540000
              ACTUALIOERR(X,U);                                     %GEH04543000
         END;%                                                          04544000
$ INCLUDE 04547001, IF DEBUGGING;                                       04544999
         REAL  NSTOP,B,C,ERROR,NSYMBS,LP;%                              04545000
         ARRAY WB[*],RBX[*],TBL[*],STOPS[*];                            04546000
         REAL TYPETOG;%                                                 04547000
 REAL PROCEDURE TAPEPARITYRETRY(R,U);%                                  04548000
    VALUE R,U;%                                                         04549000
    REAL R,U;%                                                          04550000
    BEGIN REAL T1,T2,T3; INTEGER I= T1;%                                04551000
         REAL RESULT,IOD,OIOD,SPACEMASK,SPACEIOD,M,N,W,MODE;%           04552000
         REAL J,K;%                                                     04553000
         REAL ERASEIOD=SPACEMASK;%                                      04554000
    REAL Z,Y,MIX,BSIZE;                                                 04554100
         LABEL XIO,GIVEUP;                                              04554200
         LABEL RP,LX;                                                   04554300
         REAL SIZE,T4,LIMIT;                                            04554500
         LABEL EXIT;%                                                   04555000
    SUBROUTINE DOIONOW;%                                                04556000
    BEGIN FOR Y~1 STEP 1 UNTIL 18 DO                                    04556100
         BEGIN IF R.[24:1]THEN                                          04557000
              BEGIN % WAIT 1/15 SEC BETWEEN READ RETRIES                04557100
                   WHILE T4>CLOCK+P(RTR) DO SLEEP(1,1);                 04557200
                   T4~CLOCK+P(RTR)+4;                                   04557300
              END;                                                      04557400
              IF IOQUEAVAIL=0 THEN SLEEP([IOQUEAVAIL],1023);            04558000
              IOQUEAVAIL ~ IOQUE[T1 ~ IOQUEAVAIL-1];%                   04559000
              IOQUE[T1]~ IOD;%                                          04560000
              IOCOUNT[(LOCATQUE[T1]~LOCATQUE[T2~(T3~UNIT[U]).[18:15]]&  04561000
                   [RESULT][CTC]&T2[CTF]).[3:5]]~*P(DUP)+1;             04562000
              UNIT[U] ~ T3&T1[18:33:15]&64[5:35:13];%                   04563000
              STARTIO(U);%                                              04564000
              FINALQUE[T1] ~ NABS(IOD)&  0 [25:40:8] OR IOMASK;%        04565000
              RESULT ~ 0;%                                              04566000
              SLEEP([UNIT[U]],@100000000000);%                          04567000
              IF RESULT.[29:1] AND RESULT.[2:1] THEN                    04567100
              BEGIN                                                     04567150
                   IF RESULT.[12:1] THEN   %  BLANK TAPE                04567200
                   IF IOD.[24:1] THEN      %  READ                      04567250
                        TRANSACTION[U]~TRANSACTION[U]-1&IOD[1:22:1] ELSE04567300
                   BEGIN;   %   WRITE                                   04567310
                        STREAM(A:=TINU[U],T:=T2:=SPACE(3));             04567320
                        BEGIN SI~LOC A; SI~SI+5; DS~3 CHR;              04567400
                             DS~21 LIT" BLANK TAPE ON WRITE~";          04567500
                        END;                                            04567550
   SPOUTIT(T2,35);% BLNK TAPE-TAPEPARITYRTRY                        %R6404567600
                        MODE~16;                                        04567650
                        GO TO EXIT;                                     04567700
                   END;                                                 04567750
                   IF RESULT.[11:1] THEN   %  MEM PARITY                04567770
                   BEGIN;                                               04567780
                        STREAM(A~TINU[U],T~T2~SPACE(3));                04567790
                        BEGIN SI~LOC A; SI~SI+5; DS~3 CHR;              04567800
                             DS~13 LIT" I/O MEM PAR~";                  04567810
                        END;                                            04567820
      SPOUTIT(T2, 35);%I/O MEM PAR-TAPEPARITYRETRY                  %R6404567830
                        MODE~16;                                        04567840
                        GO TO EXIT;                                     04567850
                   END;                                                 04567860
                   IF RESULT.[13:2]!0 THEN Y~18;                        04567870
              END ELSE GO TO XIO;                                       04567900
         END;%                                                          04568000
         RESULT.[27:1]~1; MODE~32;                                      04568100
XIO: END DOIONOW;                                                       04568200
    SUBROUTINE SPACEBACK;                                               04568300
    BEGIN                                                               04568310
         IF TRANSACTION[U]=1 THEN                                       04568320
         BEGIN                                                          04568330
              IOD:=@4200000000&OIOD[3:3:5];                             04568340
              DOIONOW;                                                  04568350
              I:=TWO(U);                                                04568360
              DO UNTIL (P(RRR) AND I)!0;                                04568370
         END ELSE                                                       04568380
         BEGIN                                                          04568390
              M:=W;                                                     04568400
              IOD:=SPACEIOD;                                            04568410
              J:=0;                                                     04568420
              DO BEGIN                                                  04568430
                   DOIONOW;                                             04568440
                   TRANSACTION[U]:=(*P(DUP))+1;                         04568450
                   J:=J+1;                                              04568460
              END UNTIL ((M:=RESULT.[CF]-SPACEIOD.[CF]+M) LSS 0         04568470
                   OR RESULT.[27:1]) AND J GTR 1;                       04568480
              TRANSACTION[U]:=(*P(DUP))-2;                              04568490
              IOD:=SPACEIOD&0[22:47:1];                                 04568500
              DOIONOW;                                                  04568510
              IF BSIZE=0 THEN BSIZE:=RESULT.[CF]-IOD.[CF] ELSE          04568520
              IF BSIZE!RESULT.[CF]-IOD.[CF] THEN                        04568530
              BEGIN                                                     04568540
                   STREAM(A:=TINU[U],D:=T2:=SPACE(10));                 04568550
                   BEGIN SI:=LOC A;SI:=SI+5;DS:=3 CHR;                  04568560
                        DS:=13 LIT" ERASE ERROR~";                      04568570
                   END;                                                 04568580
                   SPOUT(T2);                                           04568590
                   GO GIVEUP;                                           04568600
              END;                                                      04568610
         END;                                                           04568620
    END; % OF SPACEBACK                                                 04568630
    TINU[U].[18:12] ~ P(DUP).[18:12]+1;%                                04569000
    MIX := LOCATQUE[UNIT[U].[FF]].[3:5];                                04569500
    OIOD ~ NFLAG(IOQUE[UNIT[U].[18:15]]);%                              04570000
      STREAM(A:=TINU[U],REEL:=PRNTABLE[U].[30:18],                  %11504570300
              MFID:=MULTITABLE[U],FID:=IF LABELTABLE[U]=@314        %11504570305
           THEN "UNLABLD" ELSE LABELTABLE[U],                       %11504570307
              RD:=R,MIX:=MIX,T:=T2:=SPACE(10));                     %11504570310
          BEGIN                                                     %11504570320
           SI:=LOC A; SI:=SI+5;DS:=3CHR;                            %11504570330
           DS:=7 LIT " REEL #"; DS:=4 DEC;                          %11504570340
          SI:=SI+1;DS:=LIT";";DS:=7CHR;SI:=SI+1;DS:=LIT"/";DS:=7CHR;%11504570345
          DS:=4 LIT";RD=";                                          %11504570370
         16(DS:=3RESET;3(IF SB THEN DS:=SET ELSE                    %11504570380
            DS:=RESET; SKIP SB));                                   %11504570390
          DS:=5 LIT ";MIX="; DS:=2DEC;                              %11504570400
          DS:=LIT LEFTARROW;                                        %11504570410
         END STREAM;                                                %11504570420
      SPOUTIT(T2,34);                                               %11504570430
    IF R.[24:1] THEN%                                                   04571000
    BEGIN COMMENT READ RETRY;%                                          04572000
         SPACEMASK ~ OIOD.[21:2]|@1111 EQV NOT @0123;%                  04573000
         SPACEIOD ~ OIOD&1[8:38:10]&1[23:47:1];%                        04574000
         FOR M ~ 1 STEP 1 UNTIL 3 DO%                                   04575000
              BEGIN SPACEIOD ~ SPACEIOD&SPACEMASK[21:46:2];%            04576000
                   FOR N ~ 1 STEP 1 UNTIL 5 DO%                         04577000
                        BEGIN IOD ~ SPACEIOD;%                          04578000
                             IF N!1 OR M!1 THEN DOIONOW ELSE            04579000
                             IF NOT(R.[29:1]AND R.[2:1] AND R.[12:1])   04579100
                                THEN DOIONOW;                           04579200
                             IF RESULT.[28:1] THEN%                     04580000
                                  BEGIN MODE ~ 0;%                      04581000
                                       IOD ~ OIOD;%                     04582000
                                  END%                                  04583000
                             ELSE BEGIN MODE ~ 8;%                      04584000
                                       IOD ~ OIOD&SPACEMASK[21:43:2];%  04585000
                                  END;%                                 04586000
                             DOIONOW;%                                  04587000
                             IF NOT RESULT.[28:1] THEN GO TO EXIT;%     04588000
                             IF MOD3IOS THEN IF OIOD.[23:1] THEN        04588010
                             BEGIN Z~IOD~OIOD&SPACEMASK[21:40:2]        04588020
                                    &(OIOD.[33:15]+(OIOD.[8:10]-1)      04588030
       &OIOD[1:22:1])[33:33:15];                                        04588040
                                   DOIONOW; MODE~0;                     04588050
                                   IF RESULT.[28:1] THEN                04588060
                                   BEGIN IOD~OIOD; DOIONOW;             04588070
                                         IF NOT RESULT.[28:1] THEN      04588080
                                            GO TO EXIT;                 04588090
                                         IOD~Z&SPACEMASK[21:46:2];      04588100
                                         DOIONOW; MODE~8;               04588110
                                         IF RESULT.[28:1] THEN          04588120
                                         BEGIN IOD~OIOD&SPACEMASK       04588130
                                                   [21:43:2];           04588140
                             RP:               DOIONOW;                 04588150
                                               IF RESULT.[28:1] THEN    04588160
                                                  GO TO LX;             04588170
                                               GO TO EXIT;              04588180
                                         END;                           04588190
                                   END;                                 04588200
                                   Z~ABS(IOD.[33:15]-RESULT.[33:15]);   04588210
                                   IF IOD.[21:2]=0 THEN                 04588220
                                      Z~Z-(RESULT.[15:3]=0);            04588230
                                   IF IOD.[8:10]<Z THEN                 04588240
                                   BEGIN IOD~OIOD; MODE~0; GO TO RP END;04588250
                                   IF IOD.[22:1] THEN                   04588260
                                   STREAM(Z,Y~Z DIV 64,                 04588270
                                          S~RESULT.[33:15]+1,           04588280
                                          SK~(RESULT.[15:3]+1).[45:3],  04588290
                                          GM~(IF IOD.[21:1] THEN 0      04588300
                                                            ELSE "~"),  04588310
                                          D~OIOD.[33:15]);              04588320
                                   BEGIN SI~S; SI~SI+SK;                04588330
                                         Y(16(DS~32 CHR));              04588340
                                         Z(DS~8 CHR);                   04588350
                                         SK(DS~LIT "0");                04588360
                                         DI~DI-SK; SI~LOC GM;           04588370
                                         SI~SI+7; DS~CHR;               04588380
                                   END ELSE                             04588390
                                   STREAM(Z,Y~Z DIV 64,                 04588400
                                          S~RESULT.[33:15]-1,           04588410
                                          SK~(RESULT.[15:3]+7).[45:3],  04588420
                                          FL~(IF IOD.[21:1] THEN 0      04588430
                                                            ELSE @14),  04588440
                                          FK~(8-RESULT.[15:3]).[45:3],  04588450
                                          D~OIOD.[33:15]);              04588460
                                   BEGIN SI~S; SI~SI+SK; DI~DI+7;       04588470
                                         Y(16(32(DS~CHR; SI~SI-2;       04588480
                                                 DI~DI-2)));            04588490
                                         Z(8(DS~CHR; SI~SI-2; DI~DI-2));04588500
                                         SI~LOC FL; SI~SI+7;            04588510
                                         FK(DS~CHR; SI~SI-1; DI~DI-2);  04588520
                                   END;                                 04588530
                                   IOD~@140000005&OIOD[22:22:1]         04588540
                                                 &OIOD[3:3:5];          04588550
                                   DOIONOW; GO TO EXIT;                 04588560
                   LX:       END;                                       04588570
                        END;%                                           04589000
                   N ~ IF TRANSACTION[U] < 15 THEN%                     04590000
                             TRANSACTION[U] ELSE 15;%                   04591000
                   IOD ~ SPACEIOD&SPACEMASK[21:40:2];%                  04592000
                   FOR W ~ 1 STEP 1 UNTIL N DO%                         04593000
                        BEGIN DOIONOW;%                                 04594000
                             IF RESULT.[27:1] THEN N~0;%                04595000
                        END;%                                           04596000
                   IOD ~ SPACEIOD&SPACEMASK[21:37:2];%                  04597000
                   FOR N ~ 3 STEP 1 UNTIL W DO DOIONOW;%                04598000
                   IOD ~ OIOD;%                                         04599000
                   MODE ~ 0;%                                           04600000
                   DOIONOW;%                                            04601000
                   IF NOT RESULT.[28:1] THEN GO TO EXIT;%               04602000
              END;%                                                     04603000
         MODE ~ 16;%                                                    04604000
    END ELSE BEGIN COMMENT WRITE RETRY;%                                04605000
         LIMIT~@100000;                                                 04605500
         ERASEIOD ~ (SPACEIOD ~ OIOD&0[8:38:10]&7[22:45:3]&[T2]%        04606000
                   [33:33:15])&@112[18:41:7];%                          04607000
         W ~ R.[33:15]-OIOD.[33:15]+2;%                                 04608000
         WHILE TRUE DO                                                  04609000
              BEGIN                                                     04610000
                   SPACEBACK;                                           04611000
                   IF (N:=N+W+128) GTR LIMIT OR                         04627000
                        TERMSET(MIX) THEN GO GIVEUP;                    04627100
                   IOD ~ ERASEIOD&N[9:39:9];%                           04628000
                   FOR J ~ 0 STEP 512 UNTIL N DO%                       04629000
                        BEGIN TRANSACTION[U] ~ TRANSACTION[U]-1;%       04630000
                             DOIONOW;%                                  04631000
                             IOD ~ ERASEIOD&1[8:47:1];%                 04632000
                   IF RESULT.[27:1] THEN                                04633000
                   BEGIN                                                04633100
                        IF NOT R.[27:1] THEN LIMIT~J+3000;              04633200
                        R.[27:1]~1;                                     04633300
                   END;                                                 04633400
                        END;%                                           04634000
                   IOD ~ OIOD;%                                         04635000
                   DOIONOW;%                                            04636000
                   IF RESULT.[27:1] THEN R.[27:1] ~ 1;%                 04637000
                   IF NOT RESULT.[28:1] THEN%                           04638000
                   BEGIN                                                04638100
                        SIZE~RESULT.[CF]-OIOD.[CF];                     04638200
                        SPACEBACK;                                      04638300
                        IOD~SPACEIOD&0[22:47:1];                        04638650
                        DOIONOW;                                        04638700
                        IF NOT(RESULT.[28:1] OR (OIOD.[21:1] AND        04638800
                             (RESULT.[CF]-SPACEIOD.[CF]!SIZE))) THEN    04638900
                        BEGIN                                           04639000
                             MODE~0&R[42:27:1];                         04639100
                             GO TO EXIT;                                04639200
                        END;                                            04640000
                   END;                                                 04641000
              END;%                                                     04642000
GIVEUP:                                                                 04642900
         T2 := SPACE(3);                                                04643000
         STREAM(A~TINU[U],T2);%                                         04644000
              BEGIN SI ~ LOC A; SI ~ SI+5; DS ~ 3 CHR;%                 04645000
                   DS ~ 11 LIT " WR PARITY~";%                          04646000
              END;%                                                     04647000
      SPOUTIT(T2,35);% WR PAR                                       %R6404648000
         MODE ~ 16;%                                                    04649000
     END;%                                                              04650000
 EXIT:   TAPEPARITYRETRY ~ UNIT[U]&MODE[5:40:8];%                       04651000
 END TAPEPARITYRETRY;%                                                  04652000
 REAL PROCEDURE PLACEFINDER(S,A,L);                                     04700000
              VALUE S,A;                                                04701000
              REAL S,A,L;                                               04702000
         BEGIN INTEGER I; ARRAY B[*];                                   04703000
              REAL T,W,E,J,AA;                                          04704000
              LABEL NULL,FOUND,EXIT;                                    04705000
              W~-1;                                                     04706000
              B := [M[T := SPACE(30)]]&30[8:38:10];                     04707000
              IF S=0 THEN                                               04708000
    NULL:     BEGIN;STREAM(T); 9(DS~2 LIT" "); GO TO EXIT; END;         04709000
              DISKWAIT(-T,30,JAR[P1MIX,10]);                            04710000
              IF (AA~B[0].[FF])=0 THEN                                  04711000
              BEGIN;STREAM(S,A,T);                                      04712000
                   BEGIN DS~5 LIT", S =";                               04713000
                        SI~LOC S; DS~4 DEC;                             04714000
                        DS~5 LIT", A =";                                04715000
                        DS~4 DEC;                                       04716000
                        DI~T; DI~DI+5;DS~3 FILL;                        04717000
                        DI~T;DI~DI+14;DS~3 FILL;                        04718000
                   END;                                                 04719000
                   GO TO EXIT;                                          04720000
              END;                                                      04721000
              DISKWAIT(-T,30,I~JAR[P1MIX,AA DIV JAR[P1MIX,8]+10]+       04722000
                   AA MOD JAR[P1MIX,8]+ S DIV 30);                      04723000
              IF (J~B[S MOD 30])<0 THEN GO TO NULL;                     04725000
              AA~I~JAR[P1MIX,J.[CF] DIV JAR[P1MIX,8]+10]+               04726000
                   J.[CF] MOD JAR[P1MIX,8];                             04727000
              I~0; J~J.[FF];                                            04728000
              DO BEGIN S~(I+J).[36:11];                                 04729000
                   IF W!(W~S DIV 30) THEN                               04730000
                        DISKWAIT(-T,30,AA+W);                           04731000
                   IF (E~B[S-W|30].[38:10])=A THEN GO TO FOUND;         04732000
                   IF E<A THEN I~S ELSE J~S;                            04733000
              END UNTIL J-I{1;                                          04734000
              S~I;                                                      04735000
    FOUND:    L~-B[S MOD 30].[10:28];                                   04736000
              STREAM(L~ABS(L),T);                                       04737000
              BEGIN DS~10 LIT ", LINE NO ";                             04738000
                   SI~LOC L; DS~8 DEC;                                  04739000
                   DI~DI-8; DS~7 FILL;                                  04740000
              END;                                                      04741000
    EXIT:PLACEFINDER~T;                                                 04742000
              END PLACEFINDER;                                          04743000
 REAL PROCEDURE SECURITYCHECK(MID,FID,USE,HEAD);                        04790000
         VALUE MID, FID, USE;                                           04791000
         REAL MID,FID,USE,HEAD;                                         04792000
         FORWARD;                                                       04793000
PROCEDURE SHEETDIDDLER(BUFF,TYPE,SID); VALUE BUFF,TYPE,SID;             04798000
     REAL BUFF,TYPE,SID;                                FORWARD;        04799000
PROCEDURE ZIPPER(X,Y); VALUE X,Y; REAL X,Y; FORWARD;                    04800000
PROCEDURE DISKLOG(MID,FID,H); VALUE MID,FID,H; ARRAY H[*];          %11204800100
                              REAL  MID,FID;   FORWARD;             %11204800200
 DEFINE INOUTK = 21#;                                                   04801100
%   SYSTEM/DISK RECORD FORMAT:                                          04803000
%        A[0] = ADAPTER INFO                                            04804000
%        A[1] = USER CODE                                               04805000
%        A[2] = TIME OF LAST ACTIVITY                                   04806000
 REAL INDIAN;                                                           05000000
%   FORMATS FOR PARAMETERS TO INDIAN BOY                                05001000
%        L0 = SEARCH:                                                   05001010
%                  A[1] = FIRST NAME   : A[1] = SECURITY CODE           05001020
%                  A[2] = SECOND NAME  : A[2] = WORD[4] OF HEADER       05001030
%                  A[3] = USER CODE    : A[3] = END OF FILE COUNT       05001040
%                                      : A[4] = ADDRESS OF FIRST RECORD 05001050
%        L1 = MAKE FILE                                                 05001060
%                  A[1] = FIRST NAME   : A[1] = ADDRESS OF FIRST RECORD 05001070
%                  A[2] = SECOND NAME  : A[2] = ADDRESS OF HEADER       05001080
%                  A[3] = FILE TYPE                                     05001081
%                  A[4] = SIZE OF FILE                                  05001082
%        L2 = LOG IN OR OUT                                             05001090
%                  A[1] = USER CODE                                     05001100
%                  A[2] = CHARGE CODE                                   05001110
%                  A[3] = 0 IF ON, 1 IF OFF                             05001120
%                  A[4] = NUMBER OF SIXTIETHS OF SECONDS TILL AUTO BYE  05001130
%        L3 = FILE REMOVE                                               05001140
%                  A[1] = FIRST NAME                                    05001150
%                  A[2] = SECOND NAME                                   05001160
%        L4 = FILE REPLACE                                              05001170
%                  A[1] = FIRST NAME OF OLD FILE                        05001180
%                  A[2] = LAST NAME OF OLD FILE                         05001190
%                  A[3] = FIRST NAME OF NEW FILE                        05001200
%                  A[4] = LAST NAME OF NEW FILE                         05001210
%                  A[5].[38:10]=SAVE FACTOR ( ZERO IF NOT SPECIFIED %SM 05001212
%                  A[5].[32:6]=FILE TYPE CODE ( FROM CANDE ) %SM        05001214
%        L5 = FILE CHANGE                             : IGNORE CODES :  05001220
%                  A[1] = FIRST NAME OF OLD FILE      0 => 1 NOT THERE  05001230
%                  A[2] = LAST NAME OF OLD FILE       1 => 1 IN USE     05001240
%                  A[3] = FIRST NAME OF NEW FILE      2 => 2 THERE      05001250
%                  A[4] = LAST NAME OF NEW FILE       3 => 2 IN USE     05001260
%        L6 = JOB STARTER                                               05001270
%                  A[1] = ADDRESS OF SKELETON ENTRY FOR SCHEDULE        05001280
%        L7 = FILE SECURER                                              05001290
%                  A[1] = FIRST NAME OF FILE (<0 => NOT BY CANDE)       05001300
%                  A[2] = SECOND NAME OF FILE                           05001310
%                  A[3] = NEW CONTENTS OF HEADER[2]                     05001320
%                  A[4] = NEW CONTENTS OF HEADER[5]                     05001330
%                  A[5] = NEW CONTENTS OF HEADER[6]                     05001340
%        L8 = PAPER TAPE STARTER                                        05001350
%                  A[1] = FIRST NAME OF PAPER TAPE FILE                 05001360
%                  A[2] = USER CODE                                     05001370
%        L9 = SCHEDULE I/P FILE REPOSITION                              05001380
%                  A[1] = RECORD # OF WHERE WE WANT TO BE(-1=> EOF)     05001390
%        L10= SCHEDULE I/P REQUEST -- NO PARAMETERS                     05001400
%        L11= SCHEDULE QUERY                                            05001410
%                  A[1] = FIRST NAME : A[1] = 0 => NOT FOUND            05001420
%                                           = 1 => NOT SCHEDULE TASK    05001430
%                                           = 2 => SCHEDULED            05001440
%                                           = 3 => RUNNING              05001450
%                                           = 4 => DONE                 05001460
%                  A[2] = SECOND NAME: A[2] = IP RECORD # LAST READ     05001470
%        L12= SCHEDULE TERMINATE -- SAME PARAMETERS & RETURN AS L11     05001480
 PROCEDURE INDIANBOY;                                                   05002000
         BEGIN ARRAY A[*],B[*],C[*];                                    05003000
              REAL RCW=+0;                                              05003100
              REAL I,T,J;                                               05004000
              LABEL FOG,FORGET,LAST,RETURN,RB1,RB2,CHN,FORFOR,NX1,NX2;  05005000
              LABEL L0,L1,L2,L3,L4,L5,L6,L7,L8;                         05006000
              LABEL INFORMONLY, L9,L10,L11,L12;                         05007000
              SWITCH WHAT := L0 ,L1 ,L2 ,L3 ,L4 ,L5 ,L6 ,L7 ,L8 ,L9     05010000
                            ,L10,L11,L12                                05011000
                          ;                                             05012000
         WHILE INDIAN.[CF]!0 DO                                         05020000
         BEGIN A~IOQUE&INDIAN[CTC];                                     05021000
              LOGLINE ~ A[0].[FF];                                      05021100
              GO TO WHAT[A[0].[8:10]];                                  05022000
 L0:          IF (T~DIRECTORYSEARCH(A[1],A[2],5))!0 THEN                05023000
              BEGIN IF (A[1]~SECURITYCHECK(A[1],A[2],A[3],T))!0 THEN    05024000
                   BEGIN A[2]~M[T INX 4]&T[FTF];                        05025000
                        A[3]~M[T INX 7];                                05026000
                        A[4]~M[T INX 10];                               05027000
                   END;                                                 05028000
                   FORGETSPACE(T);                                      05029000
              END ELSE A[1]~-1;                                         05030000
              GO TO RETURN;                                             05031000
 L1:          B := IOQUE&(SPACE(30))[CTC];                              05032000
              MOVE(30,B.[CF]-1,B);                                      05033000
               B[8]~ABS(I~A[4]);                                        05034000
              P(DIRECTORYSEARCH(-A[1],A[2],7),DEL);                     05034050
              IF I GTR 0 THEN                                           05034100
              IF (B[10]:=GETUSERDISK(I OR MEMORY)) = 0 THEN             05034110
              BEGIN M[A+1]:=0;                       % NO USER DISK     05034120
                   IF A[3] LSS 0 THEN A[0].[18:7] := 25;                05034130
                   GO TO FOG;                         % TELL CANDE      05034140
              END ELSE ELSE I:=0;                                       05034150
              B[7]~I-1;                                                 05034200
              B[9]~1;                                                   05035000
              B[2]~A[2];                                                05036000
              B[4]~0&2[9:46:2]&A[3][36:42:6];                           05037000
              STREAM(DATE,X~[B[3]]);                                    05038000
              BEGIN SI~LOC DATE; DS~ 8 OCT;                             05039000
                   DI~X; DS~2 LIT "+1";                                 05040000
                   SI:=X; SI:=SI+5; DS:=3 CHR; % DATE OF LAST ACCESS %DS05040500
              END;                                                      05041000
              B[0]~@0003600036000101;                                   05042000
               B[1]~(XCLOCK+P(RTR))&B[3][6:30:18];                      05042100
              ENTERUSERFILE(A[1],A[2],B.[CF]-1);                        05045000
               B[1]~B[8];                                               05045050
              A[1]~B[10];                                               05046000
              A[2]~DIRECTORYFREE.[33:14];                               05046100
 FOG:         FORGETSPACE(B);                                           05047000
              GO TO RETURN;                                             05048000
 L2:          B := IOQUE&(SPACE(30))[CTC];                              05049000
              IF SCHEDLINE[T:=LOGLINE.[40:8]] THEN GO INFORMONLY;       05049100
$OMIT 05050001, IF DCP;                                                 05049999
              LONGCARRIAGE[T]:=0;                                       05050000
              SYSDISKIO(3,-LOGLINE,B);                                  05055000
              B[1]~IF A[3] THEN 0 ELSE A[1];                            05056000
              B[2]~CLOCK;                                               05057000
              B[3]~A[4];                                                05057100
              SYSDISKIO(0,-LOGLINE,B);                                  05058000
    INFORMONLY:                                                         05059900
              STREAM(X:=IF A[3] THEN " OFF " ELSE " ON  ", T, N:=[A[1]],05060000
$INCLUDE 05060601, IF DCP;                                              05060499
                   L:=STATABLE[T].[24:8], S:=STATABLE[T].[32:8],        05060500
                   J:=SCHEDLINE[T], ON:=A[3]-1,                         05060600
                   B);                                                  05061000
                   BEGIN DS~LIT " "; SI~N; SI~SI+1; DS~7 CHR;           05062000
                        SI:=LOC X; SI:=SI+3; DS:=5 CHR;                 05063000
                        DS:=3 DEC;                                      05064000
                        B~DI; DI~DI-3; DS~2 FILL; DI~B;                 05065000
                        SI~N; SI~SI+8;                                  05066000
                        IF SC="0" THEN                                  05067000
                        BEGIN DS~LIT "(";                               05068000
                             SI~SI+1; DS~7 CHR;                         05069000
                             DS~LIT")";                                 05070000
                        END;                                            05071000
$INCLUDE 05071701, IF DCP;                                              05071099
                        CI:=CI+ON; GO TO EXIT;                          05071100
                        J(DS:=6 LIT" SCHED"; JUMP OUT TO EXIT);         05071150
                        SI:=LOC L; X:=DI; DI:=LOC N;                    05071200
                        DS:=3 DEC; DS:=3 DEC; DS:=LIT"A";               05071250
                        SI:=LOC N; DI:=X; DS:=LIT" ";                   05071300
                   LL:  IF SC="0" THEN                                  05071350
                        BEGIN SI:=SI+1;                                 05071400
                             IF SC!"0" THEN DS:=2 CHR ELSE              05071450
                             BEGIN SI:=SI+1; DS:=CHR END                05071500
                        END ELSE DS:=3 CHR;                             05071550
                        IF SC GEQ "0" THEN                              05071600
                        BEGIN DS:=LIT"/"; GO TO LL END;                 05071650
                   EXIT:                                                05071700
                        DS:=LIT"~";                                     05071750
                   END;                                                 05072000
              SPOUTIT(B,A[3].[47:1]|2+INOUTK);                          05073000
              IF SCHEDLINE[T] THEN                                      05073100
                 FORK(P(.SCHEDIDLE),(-T),0,160,0);                      05073110
 FORGET:      T~A[0];                                                   05074000
              FORGETAREA(A[0].[2:2],A.[CF]);                            05075000
              GO TO LAST;                                               05076000
 L3:          IF (T:=DIRECTORYSEARCH(-A[1],-A[2],7))=0 THEN GO TO RB1;  05077000
              REPORTBACK(REMOVED,0,0);                                  05079000
              GO TO FORGET;                                             05080000
 L4:          T:=DIRECTORYSEARCH(A[3],-A[4],7);                         05081000
              IF (NOT T)=ABS(NOT 0) THEN                                05083000
    RB2:      BEGIN REPORTBACK(IGNORE,T.[1:1]+2,0); GO TO FORGET END;   05084000
    CHN:      B~IF T=0 THEN 0 ELSE IOQUE&T[CTC];                        05085000
              IF (T:=DIRECTORYSEARCH(A[1],-A[2],4))=0 THEN              05085100
              BEGIN IF B!0 THEN FORGETSPACE(B);                         05086000
    RB1:           REPORTBACK(IGNORE,T.[1:1],-(A[1]));  %            %DS05086100
                   GO TO FORGET;                                        05086200
              END;                                                      05086300
              IF B!0 THEN                                               05087100
              BEGIN M[T INX 2]~B[2];                                    05087200
                   M[T INX 3].[2:10]:=B[3].[2:10]; %SM                  05087250
                   M[T INX 5]~B[5];                                     05087300
                   M[T INX 6]~B[6];                                     05087400
                   M[T INX 4].[9:39]:=B[4]&1[11:47:1]; % (SHM)          05087500
                   FORGETSPACE(B);                                      05087600
              END;                                                      05087700
              M[T INX 4].[36:6]:=A[5].[32:6]; % FILE TYPE (SHM)         05087710
              IF A[5].[38:10] NEQ 0 THEN M[T INX 3].[2:10]:=A[5] %SM    05087800
           ELSE IF M[T INX 3].[2:10] LSS 7 THEN M[T INX 3].[2:10]:=7;%SM05087810
              M[T+4].[1:3]:=0;                                          05087900
              DISKLOG(A[1],A[2],IOQUE&T[CTC]);                          05087950
              ENTERUSERFILE(-A[3],A[4],T.[CF]-1);                       05088000
              FORGETSPACE(T);                                           05088100
              P(DIRECTORYSEARCH(-A[1],A[2],8),DEL);                     05089000
              REPORTBACK(CHANGED,0,0);                                  05091000
              GO TO FORGET;                                             05092000
 L5:          IF (T:=DIRECTORYSEARCH(-A[3],A[4],5))=0 THEN GO TO CHN;   05093000
              GO TO RB2;                                                05095000
 L6:          B~IOQUE&A[1][CTC];                                        05096000
              IF (T:=DIRECTORYSEARCH(B[14],-B[3],3))=0 THEN             05097000
              BEGIN REPORTBACK(NOTIN,T.[1:1],0);                        05098000
    FORFOR:        FORGETSPACE(B);                                      05099000
                   GO TO FORGET;                                        05100000
              END;                                                      05101000
              C~IOQUE&T[CTC];                                           05102000
              IF C[4].[9:2]=2 THEN                                      05103000
    NX1:      BEGIN REPORTBACK(NOTX,0,0);                               05104000
    NX2:           FORGETSPACE(T);                                      05105000
              P(DIRECTORYSEARCH(-B[14],B[3],13),DEL);                   05106000
                   GO TO FORFOR;                                        05107000
              END;                                                      05108000
              IF SECURITYCHECK(B[14],B[3],B[24],T)=0 THEN               05109000
              BEGIN REPORTBACK(SECURED,0,0);                            05110000
                   GO TO NX2;                                           05111000
              END;                                                      05112000
              A[1].[FF]~T;                                              05113000
              T.[CF]~B[7]~SPACE(30);                                    05114000
              DISKWAIT(-T.[CF],30,C[10]);                               05115000
              C~C&T[CTC];                                               05115100
              FOR I~1 STEP 1 UNTIL 6 DO                                 05116000
                   IF (NOT ABS(C[I]&0[CTC]))!NOT 0 THEN I~7;            05117000
              IF NOT I THEN                                             05118000
                   BEGIN FORGETSPACE(A[1].[FF]); GO TO NX1 END;         05119000
              FOR I~15 STEP 1 UNTIL 22 DO                               05120000
                   IF B[I]=0 THEN B[I]~C[I];                            05121000
              B[23]~(CLOCK+P(RTR)) DIV 60;                              05122000
              B[25]~T.[FF];                                             05123000
              B[26]~LOGLINE;                                            05124000
              STREAM(A~0:S~P(.SCHEDULEIDS));                            05125000
              BEGIN SI~S;                                               05126000
                   47(SKIP SB; SKIP DB; TALLY~TALLY+1;                  05127000
                        IF SB THEN BEGIN END ELSE JUMP OUT);            05128000
                   DS~SET; A~TALLY;                                     05129000
              END;                                                      05130000
              I~P;                                                      05131000
              B[3]~0&I[8:38:10];                                        05132000
              FORK(P(.SELECTRUN),A[1],-1,128,0);                        05133000
              GO TO FORGET;                                             05135000
 L7:          IF (T:=DIRECTORYSEARCH(ABS(A[1]),-A[2],4))=0 THEN         05136000
                   IF A[1]<0 THEN GO TO FORGET ELSE GO TO RB1;          05137000
              B~IOQUE&T[CTC];                                           05138000
              I~B[4];                                                   05139000
              IF (B[2]~A[3])<0 THEN I.[36:6]~9;                         05139500
              B[4]:=(I AND NOT MEMORY);                                 05140000
              B[5]~A[4];                                                05141000
              B[6]~A[5];                                                05142000
              DISKWAIT(T.[CF],30,T.[FF]);                               05143000
              IF A[1]<0 THEN GO TO FORFOR;                              05144000
              REPORTBACK(CHANGED,0,0);                                  05145000
              GO TO FORFOR;                                             05146000
 L8:                                                                    05147000
$INCLUDE 05148001, IF DCP;                                              05147099
              IF INPUTANK[I:=LOGLINE.[40:8]].[FF]!0 THEN                05147100
                COMPLEXSLEEP(INPUTANK[I].[FF]=0);                       05147200
              INPUTANK[I].[FF]:=J:=GETSPACE(65,0,1)+2;                  05147400
              M[J-1]:=IOMASK;                                           05147600
              M[J]:=0&(J+2)[CTF];                                       05147800
              M[J+2]:=0&(NOT 0)[CTF];                                   05148000
              T:="!OK!-*1";                                             05149000
              TWXOUT([T].[CF],8,-0,LOGLINE);                            05150000
              STATABLE[LOGLINE.[40:8]]:=NABS(*P(DUP))&0[4:4:1]; % PT&CE 05151000
              GO TO FORGET;                                             05152000
    L9:    %"GO TO RECORD" FOR SCHED FILE.                              05153000
         STATABLE[T:=LOGLINE.[40:8]].DIALEDUP:=0;     %TURN OFF FOR A   05154000
         IF A[1] LSS 0 THEN A[1]:=M[SEQARRAY[T] INX 78];                05155000
         SYSDISKIO(3,-T,B:=(IOQUE&(GETAREA(1)+1)[CTC]));                05156000
         B[3]:=M[SEQARRAY[T] INX 37]&A[1][CTF]; SYSDISKIO(0,-T,B);      05157000
         FORGETAREA(1,B INX NOT 0);                                     05158000
         FORK(P(.SCHEDIDLE),T,0,160,0);                                 05159000
         GO TO FORGET;                                                  05160000
    L10:   %NOTIFY THAT C&E READY FOR SCHEDULE I/P                      05161000
         IF CANDEINPUTREADY AND STATABLE[T:=LOGLINE.[40:8]].DIALEDUP    05162000
              THEN FORK(P(.SCHEDIO),-T,0,125,0)                         05163000
         ELSE SEQARRAY[T]:=NABS(*P(DUP));                               05164000
         GO TO FORGET;                                                  05165000
    L11:  %CHECK STATUS OF SCHEDULED TASK                               05166000
    L12:  %TERMINATE SCHEDULE TASK                                      05167000
              IF (T:=DIRECTORYSEARCH(A[1],A[2],5))=0 THEN               05168000
         BEGIN A[1]:=0; GO TO RETURN; END;                              05169000
         I:=M[T+6]; J:=M[T+4].[36:6]; FORGETSPACE(T);                   05170000
         IF (I OR @77777) NEQ NOT 0 THEN                                05171000
         BEGIN A[1]:=1+((J=TYPEINFO)|3); GO TO RETURN END;              05172000
              T:=DIRECTORYSEARCH((I INX "FILE000"),-"SCHEDUL",4);       05173000
         IF T.[1:30]=0 THEN                                             05174000
         BEGIN A[1]:=4; GO TO RETURN END;                               05175000
         IF NOT(J:=T.[1:1]) THEN                                        05176000
         BEGIN IF A[0].[8:10]=12 THEN %THIS IS A TERMINATE              05177000
              IF NOT(M[T+6].[2:1]) THEN %NOT ALREADY "STOPPED"      %09805178000
              BEGIN M[T+6]:=*P(DUP) OR M;                           %09805179000
                   FORK(P(.SCHEDIDLE),I,0,160,0);                       05180000
              END;                                                      05181000
              HEADERUNLOCK((I INX "FILE000"),"SCHEDUL",T);              05182000
              A[1]:=2; GO TO RETURN;                                    05183000
         END;                                                           05184000
         A[1]:=3; A[2]:=0;                                              05185000
         DO                                                             05186000
         BEGIN IF SCHEDLINE[J] THEN ELSE GO TO RETURN;                  05187000
              IF NOT SCHEND[J] THEN%MAKE SURE NOT BEING TERMINATED      05188000
              IF (C:=[M[SEQARRAY[J]]]&80[8:38:10]).[CF]GTR 511 THEN     05189000
              IF C[70]=I.[CF] THEN                                      05190000
              BEGIN IF NOT(C[32].[1:1]) THEN SLEEP([C[32]],-0);         05191000
                   C[32]:=ABS(*P(DUP));                                 05192000
                   LOCKDIRECTORY;                                       05192100
                   DISKWAIT(-(T:=SPACE(30)),30,C[36]);                  05193000
                   IF (M[T+7]:=C[37]-3) LSS 0 THEN M[T+7]:=0;           05194000
                   DISKWAIT(T,30,C[36]); FORGETSPACE(T);                05195000
                   UNLOCKDIRECTORY;                                     05195100
                   C[32]:=NABS(*P(DUP)); A[2]:=C[77];                   05196000
                   IF A[0].[8:10]=12 THEN %TERMINATE                    05197000
                   BEGIN IF (T:=STATABLE[J].MIXNR) GTR 0 THEN           05198000
                        IF T NEQ CANDYINX THEN                          05199000
                        BEGIN TERMINATE(T&61[CTF]);                     05200000
                             HALT; NOPROCESSTOG:=NOPROCESSTOG-1;        05201000
                        END ELSE SHEETDIDDLER(0,-1,J);                  05202000
                        C[77]:=C[78]; %FORCE EOF ON I/P                 05203000
                        STREAM(T:=T:=SPACE(5));                         05204000
                        DS:=26 LIT"**TASK TERMINATED BY USER~";         05205000
                        SCHEDIO(26,1,T&J[CTF]);                         05206000
                        FORGETSPACE(T);                                 05207000
                   END;                                                 05208000
                   GO TO RETURN;                                        05209000
              END;                                                      05210000
         END UNTIL (J:=J+1) GEQ STAMAX;                                 05211000
         GO TO RETURN;                                                  05212000
 RETURN:      T~A[0];                                                   05400000
              QUEVENT(A.[CF],CANDEMIX[A[0].[25:8]]);                    05401000
 LAST:        INDIAN.[CF]~T;                                            05402000
         END;                                                           05403000
         INDIAN.[FF]~[INDIAN];                                          05404000
         KILL([RCW] INX NOT 2);                                         05405000
         END INDIAN BOY;                                                05406000
 PROCEDURE COMM15;           % INDEPENDENT STARTER FOR CANDE            05407000
         BEGIN ARRAY A[*],B[*];                                         05408000
              REAL RCW=-4;                                              05409000
              REAL I,N;                                                 05410000
              B~IOQUE&RCW[FTC];                                         05411000
              N~[RCW].[CF]-B.[CF]-3;                                    05412000
              A~B&GETAREA(N>4)[CTC];                                    05413000
              A[0]~(*P(DUP))&B[1][CTF]&B[2][8:38:10];                   05414000
              FOR I~1 STEP 1 UNTIL N DO                                 05415000
                   A[I]~B[I+2];                                         05416000
              IF INDIAN.[CF]=0 THEN                                     05417000
                   FORK(P(.INDIANBOY),0,0,0,1);                         05418000
              M[INDIAN.[FF]].[CF]~A;                                    05419000
              INDIAN.[FF]~A;                                            05420000
              GO TO RETURN;                                             05421000
         END;                                                           05422000
 PROCEDURE SYSDISKIO(IO,LINE,A);                                        05423000
         VALUE IO,LINE,A;                                               05424000
         ARRAY A[*];                                                    05425000
         REAL IO,LINE;                                                  05426000
         BEGIN LABEL EXIT,OUT;                                          05427000
              OWN REAL X;                                               05428000
              REAL I,J,T;                                               05429000
              LINE~-255 AND LINE;                                       05430000
              IF SYSDISKADR=0 THEN                                      05431000
                   BEGIN A[1]~0; GO TO EXIT END;                        05432000
              IF LINE{0 AND IO THEN                                     05433000
              BEGIN SLEEP([TOGLE],SYSDISKMASK);                         05434000
                   SYSDISKTOG~0;                                        05435000
                   X~GETSPACE(30,0,0)+2;                                05436000
              END;                                                      05437000
              IF LINE GTR STATIONMAX THEN                               05438000
                   BEGIN A[0]~A[1]~0; GO TO OUT  END;                   05438100
              I~(-(T~ABS(LINE) DIV SYSDISKRPB)|SYSDISKRPB+ABS(LINE))|   05439000
                   SYSDISKRL;                                           05440000
              T~SYSDISKADR+T;                                           05441000
            IF NOT IO AND LINE=0 AND A[0].[1:1] THEN DO UNTIL FALSE;%R6005441100
              IF ABS(J~M[X-1])!T THEN                                   05442000
              BEGIN IF J<0 THEN DISKWAIT(X, 30, ABS(J));                05443000
                   DISKWAIT(-X, 30, T);                                 05444000
$INCLUDE 05444101, IF STATISTICS;                                       05444099
                   IF J LSS 0 THEN COUNTUP(23,1); COUNTUP(23,1);        05444100
                   J~T;                                                 05445000
              END;                                                      05446000
              IF NOT IO THEN J~NABS(J);                                 05447000
              MOVE(SYSDISKRL,X+I,P(A,IF IO THEN P ELSE P(XCH)));        05448000
              M[X-1]~J;                                                 05450000
              IF LINE.[1:1] AND IO < 2 THEN                             05451000
    OUT:      BEGIN IF (J~M[X-1])<0 THEN                                05452000
                        DISKWAIT(X, 30, -J);                            05453000
$INCLUDE 05453101, IF STATISTICS;                                       05453099
                   IF J LSS 0 THEN COUNTUP(23,1);                       05453100
                   SYSDISKTOG~1;                                        05454000
                   FORGETSPACE(X);                                      05455000
                   X~0;                                                 05456000
              END;                                                      05457000
    EXIT:END;                                                           05460000
 PROCEDURE LOGWARN(RC); VALUE RC; REAL RC;                              05461000
        BEGIN REAL T,V;                                                 05462000
              DEFINE IO=LOGARRAY[31]#,                                  05462100
                   DELTA=LOGARRAY[32]#,                                 05462200
                   N=LOGARRAY[33]#,                                     05462300
                   S=LOGARRAY[34]#,                                     05462400
                   R=LOGARRAY[35]#,                                     05462500
                   H=LOGARRAY[36]#;                                     05462600
              IF RC!0 THEN                                              05463000
              BEGIN                                                     05463500
              STREAM(B:=RC=19,M:=5|RC,T:=T:=SPACE(10));                 05464000
              BEGIN DS~5 LIT "#LOG ";                                   05465000
                   SI:=LOC M; DS:=2 DEC; DI:=DI-2; DS:=FILL;            05466000
                   DI~T; DI~DI+7; DS~6 LIT "% FULL";                    05467000
                   B(DS~ 9 LIT "(AUTO LN)");                            05468000
                   DS~LIT"~";                                           05469000
              END;                                                      05470000
              SPOUT(T);                                                 05471000
              END;                                                      05471050
              IF N=19 THEN FORK(P(.LOGOUT),0,0,128,0) ELSE              05471100
              IF R=0 THEN                       % GET A ROW UNDER NO    05471150
              BEGIN                             % USER DISK CONDITIONS  05471200
                   STREAM(T:=T:=SPACE(10));                             05471250
                   DS:=30 LIT"#NO USER DISK FOR NEW LOG ROW~";          05471300
                   SPOUT(T);                                            05471350
                   T:=GETUSERDISK(S&2[1:46:2]);                         05471400
                   IF NOT DELTA.[1:1] THEN SLEEP([DELTA],-0);           05471450
                   DELTA:=-DELTA;                                       05471500
                   R:=T-N;                                              05471550
                   SLEEP([IO],IOMASK);                                  05471600
                   M[V:=SPACE(30)] := NOT 0;                            05471650
                   DISKWAIT(V,1,T);                                     05471700
                   DISKWAIT(-V,30,H);                                   05471750
                   M[V INX RC INX 10]:=T;                               05471800
                   M[V INX 7]:=(M[V INX 9]:=(*P(DUP))+1)|S|3-1;         05471850
                   DISKWAIT(V,30,H);                                    05471900
                   DELTA:=-DELTA;                                       05471950
                   STREAM(T:=T:=SPACE(10));                             05472000
                   DS:=9 LIT"**LOG OK~";                                05472050
                   SPOUT(T);                                            05472100
              END;                                                      05472150
              KILL([RC] INX NOT 1);                                     05472500
         END;                                                           05473000
 COMMENT THE FOLLOWING DEFINES GIVE THE TYPE NUMBER FOR LOGGING;        05499000
         DEFINE                                                         05500000
              SPIN      = 2#,                                           05501000
              BOJK      = 4#,                                           05502000
              EOJK      = 6#,                                           05503000
              PBEOJK    = 8#,                                           05504000
              OPENK     =10#,                                           05505000
              CLOSEK    =12#,                                           05506000
              HALTK     =15#,                                           05507000
              EOJSTATS  =16#,                                           05508000
              FILESTATS =18#,                                           05509000
%             INOUTK    =21#,          ( SEE 04801100 )                 05510000
%                       =22                                             05511000
              CHRGK     =24#,                                           05512000
              DISKLOGGER=26#,                                           05513000
              DATEK     =29#,                                           05514000
              TIMEK     =31#,                                           05515000
                CNTRLCARD =32#,                                         05515100
            HRDWREK = 35#, %TYPE 17,HARDWARE FAIL.MESSAGES          %R6405517000
$INCLUDE 05519001, IF STATISTICS;                                       05518999
              SYSTATS = 39#,                                            05519000
              QXK       =99#;                                           05599000
 PROCEDURE FORMTIME(W,T); VALUE W,T; REAL W,T;                          05607000
         BEGIN INTEGER S,M;                                             05608000
              T~(T+60) DIV 60;                                          05609000
              S~T MOD 60;                                               05610000
              T~T DIV 60;                                               05611000
              M~T MOD 60;                                               05612000
              T~T DIV 60;                                               05613000
              STREAM(T,M,S,W~[W]);                                      05614000
                   BEGIN SI~LOC T;  DS~2 DEC;                           05615000
                        2(DS~LIT ":";  DS~2 DEC);                       05616000
                        DI~W;  DS~7 FILL;                               05617000
                   END;                                                 05618000
         END;                                                           05619000
 PROCEDURE MAKELOG(MESS,TYPE);                                          05620000
         VALUE MESS,TYPE;                                               05621000
         REAL MESS,TYPE;                                                05622000
         BEGIN ARRAY A=LOGARRAY[*];                                     05623000
              DEFINE IO=A[31]#,                                         05624000
                   DELTA=A[32]#,                                        05625000
                   N=A[33]#,                                            05626000
                   S=A[34]#,                                            05627000
                   R=A[35]#,                                            05628000
                   H=A[36]#;                                            05629000
              REAL T;                                                   05630000
              IF (-DELTA).[1:1] THEN SLEEP([DELTA],-0);                 05631000
              DELTA~-DELTA;                                             05631500
              IF (IO AND IOMASK)=0 THEN SLEEP([IO],IOMASK);             05632000
              MOVE(9,MESS INX 1,[A[DELTA+1]]);                          05634000
              A[DELTA]~XCLOCK&P1MIX[2:43:5]&(LOGLINE.[33:7]!0)[7:47:1]& 05636000
                   LOGLINE[8:40:8]&TYPE[16:40:8];                       05637000
              IF (DELTA~DELTA+10)=30 THEN                               05638000
              IF R!0 THEN                                               05638500
              BEGIN T ~ (N~N+1) MOD S = 0;                              05639000
                   IO~0;                                                05639500
$INCLUDE 05639901, IF STATISTICS;                                       05639899
                   COUNTUP(24,1);                                       05639900
                   DISKIO(IO,A.[CF]-1,31-T,R+N-1);                      05640000
                   IF T THEN                                            05641000
                   IF (T:=N DIV S) ! 20 THEN                            05641500
                   BEGIN IF (R:=PETUSERDISK(-S,1)) ! 0 THEN             05642000
                        BEGIN R:=R-N;                                   05642500
                        SLEEP([IO],IOMASK);                             05643000
                        DISKWAIT(A INX 30,1,R+N);     %MARK ROW     %LOG05643500
                        DISKWAIT(-A.[CF],30,H);                         05644000
                        A[(T~N DIV S)+10]~R+N;                          05646000
                        A[7]:=(A[9]:=(*P(DUP))+1)|S|3-1;            %LOG05646500
                        DISKWAIT(A.[CF],30,H);                          05648000
                        END;                                            05648500
                        FORK(P(.LOGWARN),T,-1,128,0);                   05649000
                   END;                                                 05650000
                   DELTA~0;                                             05651000
              END  ELSE DELTA~20;                                       05652000
              DELTA~-DELTA;                                             05653000
         END;                                                           05654000
 PROCEDURE STARTCANDY(ESED,PRIORITY);                                   05655000
         REAL PRIORITY,ESED;                                            05656000
         BEGIN REAL MIX=P1MIX,T;                                        05657000
              REAL I;                                                   05657100
              LABEL NOFILE,EXIT;                                        05657200
    ARRAY     A[*], B[*];                                               05658000
              IF CANDYINX!0 THEN ESED~1 ELSE                            05659000
         BEGIN                                                          05660000
              A := IOQUE&GETAREA(0)[CTC];                               05660050
              IF BASEDISKADR=0 THEN                                     05660100
              BEGIN I:="TANK   "                                        05660110
$ INCLUDE 05660121, IF SHAREDISK;                                       05660119
                   &(SYSNO+17)[30:42:6]                                 05660120
                   ; GO TO NOFILE;                                      05660130
              END;                                                      05660140
              IF (T:=DIRECTORYSEARCH(I:="MESAGE ","CANDE  ",3))!0 THEN  05660150
              BEGIN A[2]:=                                              05660200
$INCLUDE 05660221, IF DCP;                                              05660219
                        NABS                     %DCP FLAG TO CANDE     05660220
                        (M[T+10]);                                      05660240
                   FORGETSPACE(T);                                      05660260
              END ELSE GO TO NOFILE;                                    05660280
              IF (T:=DIRECTORYSEARCH(I:="USERS  ","CANDE  ",3))!0 THEN  05660300
                   BEGIN                                                05660400
                   A[2]:=A[2]&T[5:18:15];% DSK ADRS OF HEADER (SM)      05660410
                   DISKWAIT(-T.[CF],30,M[T INX 10]); % SEGMENT ZERO (SM)05660420
                   A[4]:=M[T INX 2]; % ACCESS DATE (SM)                 05660430
                   FORGETSPACE(T); % (SM)                               05660440
                   END ELSE BEGIN % (SM)                                05660450
    NOFILE:        STREAM(I,T:=T:=SPACE(5));                            05660500
                   BEGIN DS := LIT"#";                                  05660550
                        SI := LOC I;  SI := SI+1;  DS := 7 CHR;         05660600
                        DS := 17 LIT"FILE NOT ON DISK~";                05660700
                   END;                                                 05660800
                   FORGETAREA(0,A.[CF]);                                05660850
                   SPOUT(T);  ESED := 1;  GO TO EXIT;                   05660900
              END;                                                      05660950
              PRIORITY~0;                                               05661000
              EVENT[MIX]~0&[EVENT[MIX]][CTF];                           05662000
              A[0]~(*P(DUP))&5[18:41:7];                                05664000
              A[1]~BASEDISKADR;                                         05665000
              IF (T:=DIRECTORYSEARCH("TANK   "                          05665010
$ INCLUDE 05665016, IF SHAREDISK;                                       05665014
                   &(SYSNO+17)[30:42:6]                                 05665015
                   ,"DISK   ",4))!0 THEN A[3]:=T.[FF]                   05665020
              ELSE BEGIN B := IOQUE&(T := GETSPACE(30,0,0)+2)[CTC];     05665030
                   MOVE(30, T-1, T);  B[0] := @0003600036000101;        05665040
                   STREAM(DATE,T:=T+3);                                 05665050
                   BEGIN SI:=LOC DATE;  DS:=8 OCT;                      05665060
                        DI:=T;  DS:=2 LIT "01";                         05665070
                   END  STREAMING;                                      05665080
                   B[4]:=(0&1[9:47:1]&SYSNO[4:46:2]) OR MEMORY;         05665090
                   B[2] := MCP;  B[9] := 20;                            05665100
                   B[8] := TANKCHUNKSIZE;  B[10] := BASEDISKADR;        05665110
                   ENTERUSERFILE(-"TANK   "                             05665120
$ INCLUDE 05665123,IF SHAREDISK;                                        05665121
                        &(SYSNO+17)[30:42:6]                            05665122
                        ,"DISK   ",T-1);                                05665125
                   A[3] := -(DIRECTORYFREE.[33:14]);                    05665130
              END BUILD NEW TANK FILE;                                  05665140
              DISKWAIT(-T,-30,0);          % PUT ADDRESS OF BYPASS IN   05665200
              M[T+4]:=DISKBOTTOM+2;        % SEGMENT 0 WHERE CANDE CAN  05665300
              DISKWAIT(T,-30,0);           % FIND IT                    05665400
              FORGETSPACE(T);                                           05665500
              QUEVENT(A.[CF],MIX);                                      05666000
$OMIT 05676001, IF DCP;                                                 05671999
              A~A&SPACE(SYSDISKRL)[CTC];                                05677000
              FOR I:=0 STEP 1 UNTIL STATIONMAX+1 DO                     05679000
              BEGIN SYSDISKIO(1,I,A);                                   05680000
                   IF A[0].DIALEDUP THEN                                05680900
                   IF SCH(A) THEN                                       05680950
                   BEGIN STATABLE[I].DIALEDUP:=0;                       05680952
                      SEQARRAY[I].[FF]:=1;                              05680953
                      FORK(P(.SCHEDIDLE),I,0,160,0)                     05680955
                   END ELSE                                             05680960
                   IF A[1] NEQ MCP THEN % TELL CANDE.              % %DS05681000
                   BEGIN T~GETAREA(0);                                  05682000
                        M[T]~0&9[18:41:7]&I[25:40:8];                   05683000
$OMIT 05684001, IF DCP;                                                 05683999
                        M[T+1]:=A[1]; M[T+2]:=STATABLE[I].STATIONTYPE;  05684000
$INCLUDE 05684101, IF DCP;                                              05684099
                        M[T+1]:=A[1]; M[T+2]:=0;                        05684100
                        IF A[1]=0 THEN M[T].[18:7]:=1;             % %DS05684500
                        QUEVENT(T,MIX);                                 05685000
                   END;                                                 05686000
              END;                                                      05687000
              FORGETSPACE(A);                                           05688000
              IF EVENT[0].[CF]!0 THEN                                   05689000
              BEGIN M[EVENT[MIX].[FF]].[CF] ~ EVENT[0];                 05690000
                   EVENT[MIX].[FF]~EVENT[0].[FF];                       05691000
                   EVENT[0]~0&[EVENT[0]][CTF];                          05692000
              END;                                                      05693000
              DAT[CANDYINX:=MIX].NDSABLE := 1;                          05694000
              FOR I:=1 STEP 1 UNTIL STATIONMAX DO                       05695000
              IF STATABLE[I].CANDEFLAG THEN                             05696000
              IF STATABLE[I].MIXNR=0 THEN STATABLE[I].MIXNR:=MIX;       05697000
         END;                                                           05698000
    EXIT:                                                               05698500
         END;                                                           05699000
 PROCEDURE STOPCANDY;                                                   05700000
         BEGIN REAL MIX=P1MIX,T;                                        05701000
        ;STREAM(T ~ T ~ SPACE(10));                                     05701100
         DS ~ 40 LIT "**CANDE ERROR -- PLEASE TAKE DUMP, ETC.~";        05701200
         SPOUT(T);  HALT;  COMPLEXSLEEP(-100=NUMESS);                   05701300
         DO UNTIL KEYIN(0);  NOPROCESSTOG ~ NOPROCESSTOG-1;             05701400
              FOR T:=1 STEP 1 UNTIL STATIONMAX DO                       05702000
              IF STATABLE[T].CANDEFLAG THEN                             05703000
              IF STATABLE[T].MIXNR=MIX THEN STATABLE[T].MIXNR:=0;       05704000
              CANDYINX~LOGLINE~0;                                       05705000
              IF EVENT[MIX].[CF]!0 THEN                                 05706000
                   EVENT[0]~EVENT[MIX];                                 05707000
$INCLUDE 05707501, IF DCP;                                              05707499
              IF (T:=DIRECTORYSEARCH("SYSDCP "                          05707500
$OMIT 05708001, IF DCP;                                                 05707999
              IF (T:=DIRECTORYSEARCH("SYSDCP"                           05708000
$ INCLUDE 05708101, IF SHAREDISK;                                       05708099
                   &(SYSNO+17)[42:42:6]                                 05708100
                   ,"DISK   ",10))!0 THEN FORGETSPACE(T);               05709000
              IF (T:=DIRECTORYSEARCH("TANK   "                          05710000
$ INCLUDE 05710101, IF SHAREDISK;                                       05710099
                   &(SYSNO+17)[30:42:6]                                 05710100
                   ,"DISK   ",14))!0 THEN FORGETSPACE(T);               05711000
              IF (T := DIRECTORYSEARCH("MESAGE ", "CANDE  ", 13))!0     05712000
                THEN FORGETSPACE(T);                                    05713000
              IF (T := DIRECTORYSEARCH("USERS  ", "CANDE  ", 13))!0     05714000
                THEN FORGETSPACE(T);                                    05715000
         END;                                                           05719000
$OMIT 05770501, IF DCP;                                                 05719999
PROCEDURE SPREADTHEWORD;     %UPDATES ADINFO & SENDS H/L  MESSAGE TO    05720000
  BEGIN                      %LINES MARKED DIALUP                       05721000
       LABEL NODISK,SPOUTER,NOSYSDISK;                                  05721100
       REAL I,J,K,L,N,B,T;                                              05722000
       ARRAY A[*];                                                      05723000
$ OMIT 05723051, IF TWXONLY;                                            05723049
       SUBROUTINE SETNAOG; SEQARRAY[I].[26:6]:=N:=N+1;                  05723050
         B:=SPACE(10);                                                  05723100
         N:=-1;                                                         05723150
         IF SYSDISKADR=0 THEN                                           05723200
              BEGIN STREAM(S:=SYSNO+17,B);                              05723300
                    BEGIN DS:=18 LIT"*-NO SYSTEM  DISK~";               05723310
$ INCLUDE 05723321, IF SHAREDISK;                                       05723319
                         SI:=LOC S;SI:=SI+7;DI:=DI-7;DS:=CHR;           05723320
                    END;                                                05723350
              GO TO SPOUTER;                                            05723380
         END;                                                           05723400
         IF NOT P(RRR).[17:1] THEN                                      05723420
              BEGIN; STREAM(B);                                         05723450
                   DS ~ 16 LIT"*-DTC NOT READY~";                       05723500
              GO TO SPOUTER;                                            05723520
         END;                                                           05723540
         IF PROGTANK=0 THEN                                             05723560
          IF (PROGTANK:=GETUSERDISK((STATIONMAX+1)|CLUMPSIZE OR         05723580
              MEMORY)) = 0 THEN GO TO NODISK;                           05723600
         IF TANKADDRESS=0 THEN                                          05723620
         IF (TANKADDRESS:=GETUSERDISK((STATIONMAX+1)|GLOMSIZE OR        05723640
              MEMORY)) = 0 THEN GO TO NODISK;                           05723660
         IF BASEDISKADR=0 THEN                                          05723680
         IF (BASEDISKADR:=GETUSERDISK(-TANKCHUNKSIZE OR MEMORY))=0 THEN 05723700
         BEGIN                                                          05723720
 NODISK:      STREAM(B);                                                05723740
              DS:=33 LIT"*-NO USER DISK FOR DATACOM TANKS~";            05723760
 SPOUTER:     SPOUT(B);                                                 05723800
              GO TO NOSYSDISK;                                          05723900
         END;                                                           05723950
         IOREQUEST(0,INTERROGATEMASK,0&30[12:42:6]);                    05723960
         A ~ [M[GETSPACE(SYSDISKRL,0,0)+2]] & SYSDISKRL[8:38:10];       05724000
         SYSDISKIO(1,0,A);                                              05724100
         SPOWORD:=A[3];                                                 05724400
         STREAM(B);                                                     05725000
         BEGIN                                                          05726000
              DS:=19 LIT "-*!P!*!L!*!O!*!P!*!";                         05726100
              DS:=28 LIT "RESTARTING...PLEASE WAIT!-*~";                05726200
         END;                                                           05726300
         FOR I:=1 STEP 1 UNTIL STATIONMAX DO                            05727000
         BEGIN                                                          05728000
           SYSDISKIO(1,I,A);                                            05729000
           IF SCH(A) THEN                                               05729010
           BEGIN STATABLE[T:=I]:=0&1[4:47:1]&1[16:47:1];                05729020
              LINETABLE[I]:=A[4]&1[2:47:1];                             05729025
              IF A[0].DIALEDUP THEN                                     05729030
              IF A[2].[6:24] NEQ "FILE" THEN                            05729040
              BEGIN A[0].DIALEDUP:=0; SYSDISKIO(0,I,A) END;             05729050
           END                                                          05729060
           ELSE BEGIN                                                   05729070
              TANKS[I].[1:1]:=1;                                        05731100
              INPUTANK[I]:=-@10000;                                     05731200
              STATABLE[I]:=0&A[0][10:10:3]&3[15:46:2]&A[0][25:2:8]      05731300
                           &(CANDEMIX[I]+32)[4:42:6];                   05731400
              IF I LEQ LMAX THEN LINETABLE[I]:=A[4]&IDL[21:43:5];       05731500
$OMIT 05733101, IF TWXONLY;                                             05731599
              IF (J:=STATABLE[I].STATIONTYPE)!TWX THEN                  05731600
              BEGIN                                                     05731700
                   SEQARRAY[I]:=0&A[0][12:34:14]&A[0][6:17:3]           05731800
                                &I[40:40:8];                            05731850
                   IF J THEN     % SCREEN DEVICE                        05731900
                   BEGIN SETNAOG;                                       05732000
                        TNAOG[N]:=IF I=ABS(SPOWORD) THEN 0              05732100
                                  ELSE 0&A[0][14:20:14];                05732150
                   END ELSE                                             05732200
                   IF J=TC500 THEN SETNAOG;                             05732300
                   IF I LEQ LMAX THEN                                   05732400
                   IF LINEDISC[I]=MULTIPOINT THEN                       05732450
                   SEQARRAY[I].LINELINK:=I ELSE ELSE                    05732500
                   IF (J:=A[0].[2:8])!0 THEN                            05732600
                   BEGIN L:=J;                                          05732700
                        DO J:=SEQARRAY[K:=J].LINELINK UNTIL J=L;        05732800
                        SEQARRAY[K].LINELINK:=I;                        05732900
                        SEQARRAY[I].LINELINK:=L;                        05733000
              END  END;                                                 05733100
              A[0].DIALEDUP:=1;                                         05733200
              A[2]~0;                                                   05734100
              SYSDISKIO(0,I,A);                                         05734200
           END;                                                         05734900
         END;                                                           05735000
         SYSDISKIO(1,STATIONMAX+1,A);                                   05736000
         IF UNIT[30].[16:2] ! 0 THEN                                    05736200
         COMPLEXSLEEP(UNIT[30].[16:2]=0);                               05736400
         REMOTE ~ 1;                                                    05737000
$ INCLUDE 05737101, IF SAVERESULTS OR DEBUGGING;                        05737099
         STORAWAY:=NOT FALSE;                                           05737100
         J:=LMAX;  LMAX:=0;                                             05737500
$OMIT 05738001, IF TWXONLY;                                             05737999
         FOR I:=T+1 STEP 1 UNTIL STATIONMAX DO                          05738000
$INCLUDE 05738101, IF TWXONLY;                                          05738099
         FOR I:=T+1 STEP 1 UNTIL J DO                                   05738100
         BEGIN                                                          05740000
$OMIT 05740201, IF TWXONLY;                                             05740099
              IF I LEQ J THEN                                           05740100
              BEGIN                                                     05740200
                   LMAX:=I;                                             05741000
                   BLASTREAD(I,1);                                      05742000
$OMIT 05742101, IF TWXONLY;                                             05742099
              END;                                                      05742100
              TWXOUT(B,60,1&3[1:46:2],I);                               05743000
         END;                                                           05744000
         FORGETSPACE(A);                                                05745000
         FORGETSPACE(B);                                                05746000
    NOSYSDISK::                                                         05746500
  END SPREADTHEWORD;                                                    05747000
 PROCEDURE COMM17;                                                      05750000
         BEGIN REAL T;                                                  05750500
              REAL L=-7,U=-6,C=-5;;                                     05751000
              STREAM(L~L.[40:8],C,U,T~T~SPACE(10));                     05751500
              BEGIN DS:=5 LIT"SHORT"; C(DI:=DI-5; DS:=4 LIT"LONG");     05752000
                   DS:=14 LIT" CARRIAGE FOR ";                          05752100
                   SI~LOC U; SI~SI+1; DS~7 CHR;                         05752500
                   DS~4 LIT " ON ";                                     05753000
                   SI~LOC L; DS~2 DEC;                                  05753500
                   DS:=LIT LEFTARROW;                                   05754000
              END STREAM;                                               05754500
              LONGCARRIAGE[L]:=C;                                       05755000
              LOGLINE ~ L OR 512;                                       05756000
              SPOUTIT(T,CHRGK+1);                                       05756500
              GO TO RETURN;                                             05757000
         END;                                                           05757500
PROCEDURE BLASTREAD(LINE,C);                                            05758000
  VALUE LINE,C;                                                         05758500
  REAL LINE,C;                                                          05759000
  BEGIN                                                                 05759500
     REAL R,T; LABEL EX;                                                05760000
       DEFINE BLAM =C.[47:1]#,                                          05761000
              CLEAR=C.[46:1]#;                                          05761500
         IF LINE GTR LMAX THEN P(XIT);                                  05761900
         T:=SPACE(15);                                                  05762000
         IF BLAM THEN                                                   05762500
         BEGIN                                                          05763000
$OMIT 05763501, IF TWXONLY;                                             05763499
              IF STATABLE[LINE].STATIONTYPE=TWX THEN                    05763500
              BEGIN STREAM(T:=T+1); DS:=3 LIT"{!~";                     05764000
                   M[T]:=0;                                             05764500
                   DCWAIT(T,LINE,R,1,60);                               05764600
                   IF R = 0 THEN %NO RESPONSE - DISCONNECT              05764700
                   BEGIN FORK(P(.QUITTER),LINE&LINE[CTF],-2,96,0);      05764800
                        IF CANDYINX NEQ 0 THEN                          05764850
                        BEGIN M[R:=GETAREA(0)].[FF]:=R&6[33:41:7];      05764860
                             QUEVENT(R,CANDYINX);                       05764870
                        END;                                            05764880
                        LINETABLE[LINE]:=ABS(*P(DUP))&DISCON[21:43:5]   05764900
                                       &0[CTC]; %UNLOCK LINE            05765000
                        STATABLE[LINE].[16:1]:=0; %SET DISCONNECTING    05765100
                        GO TO EX;                                       05765200
                   END;                                                 05765300
$OMIT 05765701, IF TWXONLY;                                             05765499
              END ELSE IF LINEDISC[LINE]=MULTI THEN                     05765500
              BEGIN M[T]:=0&1[5:47:1];                                  05765600
                   DCWAIT(T,LINE,R,1,120);                              05765700
              END;                                                      05765800
              M[T]:=0&1[6:47:1];                                        05766000
$OMIT 05766701, IF TWXONLY;                                             05766099
              DCWAIT(T,LINE,R,IF LINEDISC[LINE]=CONTENTION              05766100
                        THEN 0 ELSE -0,0);                              05766200
              IF LINEDISC[LINE]=CONTENTION THEN                         05766300
              BEGIN STREAM(T:=T+1); DS:=2 LIT "$~";                     05766400
                   M[T]:=0;                                             05766500
                   DCWAIT(T,LINE,R,-1,60);                              05766600
              END;                                                      05766700
$INCLUDE 05766801, IF TWXONLY;                                          05766799
                   DCWAIT(T,LINE,R,-0,0);                               05766800
         END;                                                           05767000
         IF CLEAR OR (R.[30:1] AND SWAPEND!0) THEN                      05767500
         BEGIN STREAM(T);                                               05768000
              DS:=29 LIT"-*!PLEASE CALL BACK LATER!-*$";                05768500
              TWXOUT(T,29,-0,LINE);                                     05769000
         END;                                                           05769500
EX:      FORGETSPACE(T);                                                05770000
    END BLASTREAD;                                                      05770500
DEFINE                                                                  05780000
      MAXSIZ=[1:20]#, TOMAXSIZ=1:28:20#,                                05780010
      SPEED=[21:5]#, TOSPEED=21:43:5#,                                  05780020
      STARTWRD=[26:12]#, TOSTARTWRD=26:36:12#,                          05780030
      NUMENT=[38:10]#, TONUMENT=38:38:10#, NUMENTM=1023#,               05780040
      DSIZE=[2:20]#, TODSIZE=2:28:20#,                                  05780100
      DEND=[22:26]#, TODEND=22:22:26#,                                  05780200
      TOSIZE=8:38:10#, NEUF=[18:15]#,                                   05780300
      EUIOFFSET=4 #, % ONE WORD FOR EACH I/O CHANNEL.                   05780310
      AVDIFFMIN=15#, AVDIFFMAX=50#, % AVDIFFMAX GTR AVDIFFMIN GTR 14.   05780400
      AVTMAX=3900#, % MAX # WORDS ALLOWED FOR AVAILABLE TABLE ON DISK.  05780500
                    % IS REFLECTED IN USERDISKBOTTOM & DISKAVAILTABLEMAX05780505
      AVSMIN=90 #, AVSMAX=300#, % MIN AND MAX # WORDS TO READ IN @ 1 TIM05780600
                                % AVSMAX GTR AVSMIN GTR 85.             05780605
                                % BOTH MUST BE MULTIPLES OF 30.         05780610
      FIXARRAY(FIXARRAY1,FIXARRAY2,FIXARRAY3)=FIXARRAY1~[M[FIXARRAY2~   05780700
      SPACE(FIXARRAY3)]]&FIXARRAY3[TOSIZE]# ;                           05780800
%VOID                                                                   05780900
%VOID                                                                   05781000
%VOID                                                                   05781005
%VOID                                                                   05781010
$INCLUDE 05839301, IF SHAREDISK ;                                       05800000
%                                                                       05800100
% START OF SHAREDISK DISK FILE MAINTAINANCE DECLATATIONS ***************05800200
%                                                                       05800300
DEFINE   SLINK  = [1:17]     #, % = SCRATCH LINK. SCRATCHVECTOR[I].SLINK05800400
       TOSLINK  =  1:31:17   #, % IS DISK ADDRESS OF I-TH SCRATCHSEG,   05800500
                                % AND SCRATCHSEG[0].SLINK OF THE I-TH   05800600
                                % SCRATCHSEG IS DISK ADDRESS OF I+1-TH  05800700
                                % SCRATCHSEG.                           05800800
         SNUM   = [18:5]     #, % = SCRATCH NUMBER. SCRATCHVECTOR[I].   05800900
       TOSNUM   =  18:43:5   #, % SNUM IS NUMBER OF ENTRIES IN I-TH     05801000
                                % SCRATCHSEG, AND SCRATCHSEG[0].SNUM IS 05801100
                                % NUMBER OF ENTRIES IN SCRATCHSEG.      05801200
         SRADDR = [23:25]    #, % = SCRATCH ROW ADDRESS. SCRATCHSEG[J]. 05801300
       TOSRADDR =  23:23:25  #, % SRADDR IS DISK ADDRESS OF A SCRATCHROW05801400
         SHADDR = [23:25]    #, % = SCRATCH HIGH ADDRESS. SCRATCHVECTOR 05801500
       TOSHADDR =  23:23:25  #, % [I].SHADDR IS 1+MAX DISK ADDRESS OF   05801600
                                % THE DISK ADDRESSES IN THE ENTRIES IN  05801700
                                % THE I-TH SCRATCHSEG, I.E. SCRATCHVECT-05801800
                                % OR[I].SHADDR=MAX(SCRATCHSEG[1].SRADDR+05801900
                                % SCRATCHSEG[1].SLENGTH,...,SCRATCHSEG[N05802000
                                % ].SRADDR+SCRATCHSEG[N].SLENGTH).      05802100
         SLENGTH= [3:20]     #, % = SCRATCH LENGTH. SCRATCHSEG[J].      05802200
       TOSLENGTH=  3:28:20   #, % SLENGTH IS # SEGMENTS IN THE SCRATCH  05802300
                                % ROW ADDRESSED BY SCRATCHSEG[J].SRADDR.05802400
         SSIZE  = [18:10]    #, % = SCRATCHVECTOR SIZE. SCRATCHVECTOR[0]05802500
       TOSSIZE  =  18:38:10  #, % .SSIZE IS THE NUMBER OF SCRATCH VECTOR05802600
                                % DOPE ENTRIES.                         05802700
         MIXFL  =  [9:6]     #, % MIX-INDEX FIELD OF 1-ST LINK (IN-USE).05803300
SUPERSCRATCHMAX = 510        #, % MAX SIZE-1 ALLOWED FOR SCRATCHVECTOR. 05803400
     SCRATCHMIN =  19        #, % = LOWER BOUND FOR DELETION CONSOLIDATE05803500
     SCRATCHMAX =  11        #, % = UPPER BOUND FOR ADDITION CONSOLIDATE05803600
    SCRATCHDOWN =  14        #, % THESE THREE DEFINES ARE USED IN DET-  05803700
     SCRATCHOFF =   9        #, % ERMINING WHEN TO ADJUST THE SCRATCH-  05803800
      SCRATCHUP =   5        #, % VECS SIZE TO REFLECT ITS ACTUAL NUMBER05803900
                                % OF ENTRIES. NOTE THAT SCRATCHDOWN MUST05804000
                                % BE GREATER THAN SCRATCHOFF. ALL ARE >005804100
    SCRATCHTYPE =  13        #, % DIALED INTO TYPE-FIELD OF SCRATCHVEC. 05804200
    SCRATCHSAVE =  1         #, % SAVE FACTOR OF SCRATCHVEC.            05804300
SERROR(SERROR1) =  BEGIN N~SERROR1; GO ERROR END #;                     05805500
% * END OF DEFINES * * *.                                               05805900
% SEE START OF MCP FOR SCRATCHDIRECTORYREADY AND SCRATCHDIRECTORYMASK *.05806000
ARRAY SCRATCHVEC[*];                                                    05806200
                                                                        05806300
                                                                        05806400
PROCEDURE SCRATCHSORT(A,N) ;                                            05806500
VALUE N  ;                                                              05806600
REAL N ;                                                                05806700
ARRAY A[*] ;                                                            05806800
    BEGIN     % SCRATCHSORT BINARILY SORTS N ELEMENTS OF A---A[1],      05806900
              % A[2],...,A[N]---IN DESCENDING ORDER                     05807000
              % SORT TIME APPROX N|LN(N)|95 MICROSECONDS.               05807100
              % THE KEY IS .[23:25], WHICH IS EITHER .SHADDR OR .SRADDR.05807200
    INTEGER D ;                                                         05807400
    REAL I,J,Y ;                                                        05807500
    LABEL C1,C2,C3,XT ;                                                 05807600
    % ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 05807700
    IF (D~1)<N THEN WHILE (D~D+D)<N DO;                                 05807800
 C1:                                                                    05808000
    IF (D:=D DIV 2) LEQ 0 THEN GO XT ELSE I:=1 ;                        05808100
 C2:                                                                    05808200
    Y~A[(J~I)+D] ;                                                      05808300
 C3:                                                                    05808400
    IF Y.SHADDR>A[J].SHADDR THEN                                        05808500
         BEGIN                                                          05808600
         A[J+D]~A[J] ;                                                  05808700
         IF (J~J-D) > 0 THEN GO TO C3 ;                                 05808800
         END ;                                                          05808900
    A[J+D]~Y ;                                                          05809000
    IF (I~I+1)+D { N THEN GO TO C2 ELSE GO TO C1 ;                      05809100
 XT:                                                                    05809200
    END OF SCRATCHSORT ;                                                05809300
                                                                        05809400
                                                                        05809500
$ INCLUDE 05811281, IF DEBUGGING;                                       05809599
PROCEDURE SCRATCHDIRECTORYERROR(A,N) ;                                  05809600
VALUE A,N ;                                                             05809700
REAL A,N ;                                                              05809800
    BEGIN                                                               05809900
    % ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 05810000
    STREAM(N:=N,A:=A);                                                  05810100
         BEGIN                                                          05810200
         DS~29 LIT"#MCP SCRATCH DIRECTORY ERROR " ;                     05810300
         SI~LOC N; DS~3 DEC; DS~LIT"~" ;                                05810400
         END ;                                                          05810500
    SPOUT(A) ;                                                          05810600
    COMPLEXSLEEP(-100=NUMESS) ;                                         05810700
%VOID                                                                   05810800
    DDT;                                                                05810900
    DO UNTIL FALSE ;                                                    05811000
    END OF SCRATCHDIRECTORYERROR ;                                      05811100
                                                                        05811150
                                                                        05811160
BOOLEAN PROCEDURE SCRATCHCHECK(I,H,S) ;                                 05811170
VALUE I,S ;                                                             05811180
REAL I,H,S ;                                                            05811190
    BEGIN                                                               05811200
    % ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 05811210
    SCRATCHCHECK~TRUE ;                                                 05811220
    IF S.SLINK!(IF I!H THEN SCRATCHVEC[I+1] ELSE 0).SLINK THEN H~1      05811230
    ELSE IF SCRATCHVEC[I].SNUM!I~S.SNUM THEN H~2                        05811240
    ELSE IF I>29 THEN H~3                                               05811250
    ELSE IF I{0 THEN H~4                                                05811260
    ELSE SCRATCHCHECK~FALSE ;                                           05811270
    END OF SCRATCHCHECK ;                                               05811280
PROCEDURE SCRATCHSPECIALCASE(CN,A,N,CORADDR,SEGADDR,I,H,SCRATCHSEG);    05811340
VALUE CN,A,N,SEGADDR,I,H;                                               05811355
REAL CN,A,N,CORADDR,SEGADDR,I,H;                                        05811360
ARRAY SCRATCHSEG[*] ;                                                   05811370
    BEGIN                                                               05811385
    REAL POT,MAX,L,Q,J,E,F ;                                            05811400
    ARRAY BOTH[*];                                                      05811410
$ INCLUDE 05811416, IF DEBUGGING;                                       05811414
    LABEL START,ERROR ;                                                 05811415
    SUBROUTINE GETNEWSCRATCHVEC ;                                       05811430
         BEGIN                                                          05811445
         P(P1MIX);  P1MIX~0;  L~GETSPACE(A,SCRATCHTYPE,SCRATCHSAVE) ;   05811460
         P1MIX~P;  M[L].MIXFL~0 ;                                       05811475
         MOVE(H+1,SCRATCHVEC,L:=L+2) ;                                  05811490
         FORGETSPACE(SCRATCHVEC) ;                                      05811505
         SCRATCHVEC:=SCRATCHVEC & L[CTC] & A[TOSIZE] ;                  05811520
         END OF GETNEWSCRATCHVEC ;                                      05811535
    % ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 05811540
$ INCLUDE  05811596, IF DEBUGGING;                                      05811549
    GO START ;                                                          05811550
 ERROR:                                                                 05811565
    SCRATCHDIRECTORYERROR(CORADDR,N+100) ;                              05811580
 START:                                                                 05811595
    IF CN=1 THEN                                                        05811805
         BEGIN                                                          05811820
              IF (IF I!1 THEN (L~SCRATCHVEC[I-1].SNUM)<SCRATCHMAX ELSE  05811835
              L~32) OR (IF I!H THEN (Q~SCRATCHVEC[I+1].SNUM)<SCRATCHMAX 05811850
              ELSE Q~32) THEN % THEN INSTEAD OF GETTING A NEW SEG AND   05811865
                   BEGIN % GIVING THE I-TH AND NEW SEG EACH 15 ENTRIES, 05811880
                   IF L>Q THEN % WE CAN SPLIT BETWEEN THE I-TH AND Q-TH 05811895
                        BEGIN  % SEGS THE SUM OF THE ONE NEW ENTRY AND  05811910
                        L~Q ;  % THEIR INDIVIDUAL ENTRIES. WE CAN DO    05811925
                        Q~I+1 ;% THIS BECAUSE THE Q-TH SEG HAS ONLY     05811940
                        END    % L<SCRATCHMAX ENTRIES. THIS OPERATION IS05811955
                   ELSE Q~I-1 ;% DONE TO HELP REDUCE THE NUMBER OF      05811970
                   POT~L+31 ;  % SPARSE SEGMENTS.                       05811985
                   FIXARRAY(BOTH,J,POT) ;                               05812000
                   DISKWAIT(-J,30,MAX~SCRATCHVEC[Q].SLINK) ;            05812015
$ INCLUDE 05812031, IF DEBUGGING;                                       05812016
                   IF SCRATCHCHECK(Q,H,BOTH[0]) THEN SERROR(H+21) ;     05812030
                   MOVE(29,[SCRATCHSEG[1]],[BOTH[L+1]]) ;               05812045
                   BOTH[POT:=POT-1]:=A & N[TOSLENGTH] ;                 05812060
                   SCRATCHSORT(BOTH,POT) ;                              05812075
                   MOVE(H~POT-POT~POT DIV 2,[BOTH[POT+1]],              05812090
                       [SCRATCHSEG[1]]) ;                               05812105
                   A:=MAX;  N:=SEGADDR ;                                05812120
                   IF Q LSS I THEN                                      05812135
                        BEGIN                                           05812150
                        POLISH(SCRATCHSEG[0],BOTH[0],                   05812165
                               [SCRATCHSEG[0]],:=,[BOTH[0]],:=) ;       05812180
                        POLISH(J,CORADDR,.J,~,[CORADDR],~);             05812195
                        POLISH(I,Q,.I,:=,.Q,:=) ;                       05812210
                        POLISH(SEGADDR,MAX,.SEGADDR,:=,.MAX,:=) ;       05812225
                        END ;                                           05812240
                   BOTH[0].SNUM:=POT ;                                  05812255
                   SCRATCHSEG[0].SNUM:=H ;                              05812270
                   DISKWAIT(J,30,A) ;                                   05812285
                   DISKWAIT(CORADDR,30,N) ;                             05812300
                   SCRATCHVEC[I]:=(P(SCRATCHSEG[1],DUP).SRADDR          05812315
                                +P(XCH).SLENGTH) & H[TOSNUM] & SEGADDR  05812330
                                [TOSLINK] ;                             05812345
                   SCRATCHVEC[Q]:=(P(BOTH[1],DUP).SRADDR+P(XCH)         05812360
                                .SLENGTH) & POT[TOSNUM] & MAX[TOSLINK] ;05812375
                   FORGETSPACE(J) ;                                     05812390
                   END                                                  05812405
$ INCLUDE 05812421, IF DEBUGGING;                                       05812406
              ELSE IF H GTR 254 THEN SERROR(49)                         05812420
                   ELSE  % ELSE GET A NEW SEGMENT AND SPLIT THE I-TH    05812435
                        BEGIN % SEGMENTS 29 ENTRIES PLUS THE NEW ENTRY  05812450
                              % BETWEEN THE NEW AND I-TH SEGMENT.       05812465
                        SCRATCHSEG[30]~A & N[TOSLENGTH] ;               05812480
                        SCRATCHSORT(SCRATCHSEG,30) ;                    05812495
                        IF SCRATCHVEC.SIZE<H+2 THEN % THEN WE MUST GET A05812510
                             BEGIN                  % BIGGER SCRATCHVEC.05812525
                             A:=H+2+SCRATCHUP ;                         05812540
                             GETNEWSCRATCHVEC ;                         05812555
                             END ;                                      05812630
                        POT:=I+1 ;                                      05812645
                        FOR J:=H STEP -1 UNTIL POT                      05812660
                        DO SCRATCHVEC[J+1]:=SCRATCHVEC[J] ;             05812675
                        SCRATCHVEC[I+1]:=(P(SCRATCHSEG[1],DUP).SRADDR   05812690
                                        +P(XCH).SLENGTH)                05812705
                                        & 15[TOSNUM]                    05812720
                                        & (L~GETESPDISK)[TOSLINK];      05812735
                        SCRATCHSEG[0].SNUM:=15 ;                        05812750
                        DISKWAIT(CORADDR,30,L) ;                        05812765
                        SCRATCHVEC[I]:=(P(SCRATCHSEG[16],DUP)           05812780
                                      .SRADDR+P(XCH).SLENGTH)           05812795
                                      & 15[TOSNUM] & SEGADDR[TOSLINK] ; 05812810
                        SCRATCHSEG[15]:=0 & L[TOSLINK] & 15[TOSNUM] ;   05812825
                        DISKWAIT(CORADDR+15,16,SEGADDR) ;               05812840
                        SCRATCHVEC[0].SSIZE~H+1 ;                       05812855
                        END ;                                           05812870
         END                                                            05812885
    ELSE                                                                05812900
         BEGIN                                                          05812915
         IF (IF I!1 THEN (L~SCRATCHVEC[I-1].SNUM)>SCRATCHMAX ELSE       05812930
         L~FALSE) OR (IF I!H THEN (Q~SCRATCHVEC[I+1].SNUM)>SCRATCHMAX   05812945
         ELSE Q~FALSE) THEN %THEN, INSTEAD OF FORGETTING SEGMENT, SPLIT 05812960
              BEGIN % CONTENTS OF Q-TH AND I-TH SEGMENT BETWEEN THEM-   05812975
              IF POT:=Q>L THEN BEGIN L~Q; Q~I+1 END ELSE Q~I-1 ; % SELVE05812990
              A~SCRATCHSEG[0] ;                                         05813005
              DISKWAIT(-CORADDR,30,E~SCRATCHVEC[Q].SLINK) ;             05813020
$ INCLUDE 05813036, IF DEBUGGING;                                       05813034
              IF SCRATCHCHECK(Q,H,H:=SCRATCHSEG[0]) THEN SERROR(12+H) ; 05813035
              SCRATCHSORT(SCRATCHSEG,L) ;                               05813050
              F:=L-N:=L DIV 2 ;                                         05813065
              SCRATCHVEC[I]:=(P(SCRATCHSEG[(L:=IF POT THEN N ELSE 0)    05813080
                              + 1],DUP).SRADDR+P(XCH).SLENGTH)          05813095
                              & F[TOSNUM] & SEGADDR[TOSLINK] ;          05813110
              SCRATCHVEC[Q]:=(P(SCRATCHSEG[(POT:=IF POT THEN 0 ELSE F)  05813125
                             +1],DUP).SRADDR+P(XCH).SLENGTH)            05813140
                             & N[TOSNUM] & E[TOSLINK] ;                 05813155
              POLISH(SCRATCHSEG[N],SCRATCHSEG[N-1]) ;                   05813170
              SCRATCHSEG[L]:=A & F[TOSNUM] ;                            05813185
              DISKWAIT(CORADDR+L,F+1,SEGADDR) ;                         05813200
              POLISH([SCRATCHSEG[N-1]],~,[SCRATCHSEG[N]],~) ;           05813215
              SCRATCHSEG[POT]:=H & N[TOSNUM] ;                          05813245
              DISKWAIT(CORADDR+POT,N+1,E) ;                             05813260
              END                                                       05813275
         ELSE       % ELSE THERE IS NO SEG ADJ TO I-TH SEG WITH ENOUGH  05813290
              BEGIN % ENTRIES TO SPLIT, SO WE DELETE THE I-TH SEGMENT.  05813305
              E~SCRATCHSEG[0].SLINK ;                                   05813320
              DISKWAIT(-CORADDR,POT~IF F~I=1 THEN -30 ELSE 30,Q~        05813335
                       SCRATCHVEC[I-1].SLINK) ;                         05813350
$ INCLUDE 05813366, IF DEBUGGING;                                       05813364
              IF F AND SCRATCHSEG[SYSNO].SLINK!SEGADDR THEN SERROR(4) ; 05813365
              SCRATCHSEG[IF F THEN SYSNO ELSE 0].SLINK~E ;              05813380
              DISKWAIT(CORADDR,POT,Q) ;                                 05813395
              FORGETESPDISK(SEGADDR) ;                                  05813410
              IF I!H THEN MOVE(H-I,[SCRATCHVEC[I+1]],[SCRATCHVEC[I]]);  05813425
              SCRATCHVEC[0].SSIZE:=H:=H-1 ;                             05813440
              IF H<(L:=SCRATCHVEC.SIZE)-SCRATCHDOWN THEN %THEN GET A NEW05813455
                   BEGIN % SCRATCHVEC CLOSER IN SIZE TO ACTUAL # ENTRIES05813470
                   A:=L-SCRATCHOFF ;                                    05813485
                   GETNEWSCRATCHVEC ;                                   05813500
                   END ;                                                05813560
              END ;                                                     05813575
         END ;                                                          05813590
    END OF SCRATCHSPECIALCASE ;                                         05813605
                                                                        05813620
                                                                        05813635
PROCEDURE SCRATCHDIRECTORYENTER(A,N);                                   05813700
VALUE A,N;                                                              05813800
REAL A,N;                                                               05813900
    BEGIN                                                               05814000
         INTEGER I;                                                     05814100
    REAL CORADDR,H,L,Q,SEGADDR=Q ;                                      05814200
    ARRAY SCRATCHSEG[*] ;                                               05814300
         LABEL FOUND, SEARCH;                                           05814400
$ INCLUDE 05814451, IF DEBUGGING;                                       05814449
         LABEL ERROR;                                                   05814450
    % ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 05814500
    FIXARRAY(SCRATCHSEG,CORADDR,31);                                    05814700
    SLEEP([TOGLE],SCRATCHDIRECTORYMASK);SCRATCHDIRECTORYREADY~FALSE;    05814800
    Q:=H:=SCRATCHVEC[0].SSIZE ;                                         05814850
         IF SCRATCHVEC[I:=1].SHADDR GTR A THEN GO FOUND ;               05816600
         IF SCRATCHVEC[I~H].SHADDR{A THEN GO FOUND ;                    05816700
         L~2 ; % DO BINARY SEARCH ON I SUCH THAT  1<I<H  AND SUCH THAT  05816800
 SEARCH:       % SCRATCHVEC[I].SHADDR GTR A GEQ SCRATCHVEC[I-1].SHADDR. 05816900
         IF SCRATCHVEC[I:=(L+Q)/2].SHADDR GTR A THEN                    05817000
              IF SCRATCHVEC[I-1].SHADDR GTR A THEN Q:=I-1               05817100
              ELSE GO FOUND                                             05817200
         ELSE IF SCRATCHVEC[I:=I+1].SHADDR LEQ A THEN L:=I+1            05817300
              ELSE GO FOUND ;                                           05817400
         GO SEARCH ;                                                    05817500
$ INCLUDE 05817701, IF DEBUGGING;                                       05817599
 ERROR: % DETECTED MCP AND/OR HARDWARE ERROR VIA BAD CORE/DISK TABLES.  05817600
        SCRATCHDIRECTORYERROR(CORADDR,N+50);                            05817700
 FOUND: % FOUND THE DESIRED INDEX I.                                    05818000
         DISKWAIT(-CORADDR,30,SEGADDR:=SCRATCHVEC[I].SLINK) ;           05818100
$INCLUDE 05818201, IF DEBUGGING;                                        05818199
         IF SCRATCHCHECK(I,H,SCRATCHSEG[0]) THEN SERROR(37+H) ;         05818200
         IF (L:=SCRATCHVEC[I].SNUM) GEQ 29 THEN %MAKE ROOM FOR NEW ENTRY05818300
              SCRATCHSPECIALCASE(1,A,N,CORADDR,SEGADDR,I,H,SCRATCHSEG)  05818400
         ELSE       % ELSE MAKE A NORMAL ENTRY INTO THE I-TH SEGMENT    05825800
              BEGIN % AND WRITE IT BACK OUT TO DISK.                    05825900
              SCRATCHVEC[I]~(IF (H~SCRATCHVEC[I].SRADDR)>A+N THEN H     05826000
                            ELSE A+N) & (L:=L+1)[TOSNUM]                05826100
                            & SEGADDR[TOSLINK] ;                        05826200
              SCRATCHSEG[L]~A & N[TOSLENGTH] ;                          05826300
              SCRATCHSEG[0].SNUM~L ;                                    05826400
              DISKWAIT(CORADDR,30,SEGADDR) ;                            05826500
              END ;                                                     05826600
%VOID                                                                   05826700
    SCRATCHDIRECTORYREADY~TRUE ;                                        05826800
    FORGETSPACE(CORADDR) ;                                              05826900
    END SCRATCHDIRECTORYENTER ;                                         05827000
                                                                        05827100
                                                                        05827200
PROCEDURE SCRATCHDIRECTORYDELETE(A,N);                                  05827300
VALUE A,N;                                                              05827400
REAL A,N;                                                               05827500
    BEGIN                                                               05827600
         INTEGER I;                                                     05827700
    REAL L,H,E,F,Q,MAX,POT,CORADDR,SEGADDR ;                            05827800
    ARRAY SCRATCHSEG[*] ;                                               05827900
         LABEL SEARCH, FOUND;                                           05828000
$ INCLUDE 05828051, IF DEBUGGING;                                       05828049
         LABEL ERROR;                                                   05828050
    % ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 05828100
    FIXARRAY(SCRATCHSEG,CORADDR,30);                                    05828200
    SLEEP([TOGLE],SCRATCHDIRECTORYMASK);SCRATCHDIRECTORYREADY~FALSE;    05828300
    Q:=H:=SCRATCHVEC[0].SSIZE;                                          05828350
$ INCLUDE 05828401, IF DEBUGGING;                                       05828399
    IF SCRATCHVEC[Q].SHADDR LEQ A OR Q=0 THEN SERROR(H=0);              05828400
    IF SCRATCHVEC[I:=1].SHADDR GTR A THEN GO FOUND ;                    05828500
    L:=2 ; % DO BIN SEARCH ON I SO THAT  1 LSS I LEQ H  AND SUCH THAT   05828600
 SEARCH:   % SCRATCHVEC[I].SHADDR GTR A GEQ SCRATCHVEC[I-1].SHADDR.     05828700
    IF SCRATCHVEC[I:=(L+Q)/2].SHADDR GTR A THEN                         05828800
         IF SCRATCHVEC[I-1].SHADDR GTR A THEN Q:=I-1                    05828900
         ELSE GO FOUND                                                  05829000
    ELSE IF SCRATCHVEC[I:=I+1].SHADDR LEQ A THEN L:=I+1                 05829100
         ELSE GO FOUND ;                                                05829200
    GO SEARCH ;                                                         05829300
$ INCLUDE 05829501, IF DEBUGGING;                                       05829399
 ERROR: % DETECTED MCP AND/OR HARDWARE ERROR VIA BAD CORE/DISK TABLES.  05829400
    SCRATCHDIRECTORYERROR(CORADDR,N) ;                                  05829500
 FOUND: % FOUND THE DESIRED INDEX I.                                    05829800
    DISKWAIT(-CORADDR,30,SEGADDR~(POT~SCRATCHVEC[I]).SLINK) ;           05829900
$ INCLUDE 05830001, IF DEBUGGING;                                       05829999
    IF SCRATCHCHECK(I,H,SCRATCHSEG[0]) THEN SERROR(8+H) ;               05830000
    MAX~POT.SHADDR ;                                                    05830100
    Q:=0 ;                                                              05830150
    POLISH(H) ;                                                         05830175
    FOR L~POT~POT.SNUM STEP -1 UNTIL 1 DO % FIND E, THE INDEX OF THE    05830200
         BEGIN % DELETABLE ENTRY,AND ALSO RECORD Q, THE VALUE OF THE    05830300
         IF (H~SCRATCHSEG[L].SRADDR) LEQ A % SECOND MAX.                05830400
              AND (F:=H+SCRATCHSEG[L].SLENGTH) GTR A THEN               05830450
$ INCLUDE 05830501, IF DEBUGGING;                                       05830499
         IF E!0 THEN SERROR(29) ELSE                                    05830500
              E:=L;                                                     05830510
$ INCLUDE 05830551, IF DEBUGGING;                                       05830549
         IF H=0 OR H=F THEN SERROR(30) ;                                05830550
         IF F!MAX AND Q<F THEN Q~F ;                                    05830600
         END ;                                                          05830700
    H:=POLISH ;                                                         05830750
    L:=(F:=SCRATCHSEG[E]).SRADDR+(F:=F.SLENGTH);                        05830800
$ INCLUDE 05830811, IF DEBUGGING;                                       05830809
    IF (E=0) OR (A+N)!L THEN SERROR(2+E=0);                             05830810
    IF F GTR N THEN                                                     05830860
         BEGIN % ONLY DELETE THE END-PART OF AN ENTRY                   05830865
         SCRATCHSEG[E].SLENGTH:=F-N ;                                   05830870
         IF MAX=L THEN SCRATCHVEC[I].SHADDR:=L-N ;                      05830875
         DISKWAIT(CORADDR,30,SEGADDR) ;                                 05830877
         END                                                            05830879
    ELSE % ELSE COMPLETELY DELETE THE ENTRY.                            05830880
    IF POT=1 THEN % THEN ENTRY TO DELETE IS ONLY ENTRY IN SEGMENT.      05830900
         SCRATCHSPECIALCASE(2,A,N,CORADDR,SEGADDR,I,H,SCRATCHSEG)       05831000
    ELSE       % ELSE NORMAL CASE, WHERE AN ENTRY IS DELETED FROM       05836400
         BEGIN % A SEG AND SEG IS WRITTEN BACK OUT TO DISK.             05836500
         SCRATCHSEG[E]~SCRATCHSEG[POT] ;                                05836600
         SCRATCHSEG[0].SNUM~POT-1 ;                                     05836700
         DISKWAIT(CORADDR,30,SEGADDR) ;                                 05836800
         SCRATCHVEC[I]~(IF A+N=MAX THEN Q ELSE MAX) & (POT-1)[TOSNUM]   05836900
                       & SEGADDR[TOSLINK] ;                             05837000
         END ;                                                          05837100
    SCRATCHDIRECTORYREADY~TRUE ;                                        05837300
    FORGETSPACE(CORADDR) ;                                              05837400
    END OF SCRATCHDIRECTORYDELETE ;                                     05837500
                                                                        05837600
                                                                        05837700
PROCEDURE SCRATCHCLEAN(ARY,BC,LINK) ;                                   05837800
VALUE BC ;       % SCRATCHCLEAN SORTS THE SCRATCH DIRECTORY SEGMENT, AS 05837900
REAL BC,LINK ;   % STORED IN ARRAY ARY, AND THEN IT GOES THROUGH THIS   05838000
ARRAY ARY[*] ;   % SORTED ARRAY CONSOLIDATING ADJACENT AREAS AND DOING  05838100
    BEGIN        % FORGETUSERDISKS ON THESE (CONSOLIDATED) AREAS.       05838200
    REAL I,J,K,S,T ;                                                    05838300
    % ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 05838400
    IF (LINK~ARY[0].SLINK)!0 THEN DISKIO(T,-BC,30,LINK) ;               05838500
    SCRATCHSORT(ARY,K:=ARY[0].SNUM) ;                                   05838600
    ARY[K+1]:=I:=J:=1 ;                                                 05838650
    DO   BEGIN                                                          05838700
         WHILE (S~ARY[J]).SLENGTH+S.SRADDR=ARY[J+1].SRADDR DO J~J+1 ;   05838800
         FORGETUSERDISK(I~ARY[I].SRADDR,S.SRADDR+S.SLENGTH-I) ;         05838900
         END                                                            05839000
    UNTIL (I~J~J+1)>K ;                                                 05839100
    IF LINK!0 THEN SLEEP([T],IOMASK) ;                                  05839200
    END OF SCRATCHCLEAN ;                                               05839300
                                                                        05839390
                                                                        05839395
REAL PROCEDURE PETUSERDISK(N,T);  VALUE N,T;  REAL N,T ;                05839400
                                                                        05839500
% N IS THE NUMBER OF SEGMENTS REQUESTED, AND T IS THE EU# OR THE SPEED#.05839600
% GETUSERDISK WILL RETURN -1, 0, OR THE ABSOLUTE DISK SEGMENT ADDRESS OF05839700
% THE RESULTANT AREA. SEE T.[2:1] FOR THE -1, AND N.[2:1] FOR THE 0.    05839800
                                                                        05839900
% T>0 => T IS A PREFERRED SPEED#: T=1,2,3,4,..., OR 31.                 05840000
% T<0 => -T IS A PREFERRED EU#: T=-1,-2,-3,-4,..., OR -20.              05840100
% T=0 => DONT CARE ABOUT SPEED# OR EU#, USE EU WITH LEAST EU I/O.       05840200
% T.[2:1]=1 => IF CANT GET PREFERRED SPEED# OR EU#, RETURN -1.          05840300
% T.[2:1]=0 => IF CANT GET PREFERRED SPEED# OR EU#, TREAT AS T=0 (ABOVE)05840400
% N>0 => MAKE A SCRATCHDIRECTORY ENTRY.                                 05840500
% N<0 => DONT MAKE A SCRATCHDIRECTORY ENTRY.                            05840600
% N=0 => IMMEDIATELY RETURN WITH A 0.                                   05840700
% N.[2:1]=0 => IF CANT FIND ANY USERDISK, AND T.[2:1]=0, NO-USER-DISK.  05840800
% N.[2:1]=1 => IF CANT FIND ANY USERDISK, AND T.[2:1]=0, RETURN 0.      05840900
                                                                        05841000
                                                                        05841100
    BEGIN                                                               05841200
    INTEGER K=+1, % K IS ALSO "GETUSERDISK"; DONT USE K ABOVE LABEL D.  05841300
         Z=K+1,NS=Z+1,I=NS+1,Q=I+1,                                     05841350
$INCLUDE 05841502, IF SHAREDISK ;                                       05841380
            L=Q+1,H=L+1,J=H+1,R=J+1,DL=R+1;                             05841400
    REAL M1=DL+1, M2=M1+1;  ARRAY U=M2+1[*];  DEFINE UT=U # ;           05841500
$OMIT 05841621, IF SHAREDISK ;                                          05841610
            R=Q+1, AVS=R+1, J=AVS+1, L=AVS, H=NT6 ;                     05841615
    REAL M1=NT5, M2=NT4;  ARRAY UT=J+1[*];  DEFINE U=AVTABLE # ;        05841620
    LABEL A,B,C,D,E,F,G,W ;                                             05841650
DEFINE GETUSERDISK=PETUSERDISK#;%***************************************05841700
                                                                        05841800
    % * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 05841900
                                                                        05842000
    IF N=0 THEN GO W ;                                                  05842100
    P(T.[2:1],ABS(N),1,0,0,0,0,0);                                      05842200
$ INCLUDE 05842211, IF SHAREDISK ;                                      05842205
    P(0,D,DUP,0) ;                                                      05842210
A:                                                                      05842250
    SLEEP([TOGLE],USERDISKMASK); USERDISKREADY~ FALSE;                  05842310
$INCLUDE 05842401, IF SHAREDISK;                                        05842390
    FIXARRAY(U,R,AVS); DISKWAIT(-R,-AVS,USERDISKBOTTOM);                05842400
$OMIT 05842411, IF SHAREDISK ;                                          05842405
    M1:=M2:=P(D) ;                                                      05842410
    L:=NEUP.NEUF ;                                                      05842450
    IF T LSS 0 THEN IF U[J:=IF -T GTR L THEN L+1 ELSE -T].MAXSIZ GEQ NS 05842475
                    THEN GO E ELSE IF Z THEN GO C ;                     05842500
B:  IF U[I].MAXSIZ}NS THEN                                              05842700
         BEGIN                                                          05842800
         P(EUIO[(NT1:=I-1)+EUIOFFSET]+PEUIO[NT1],.NT2,SND,DUP) ;        05842900
         IF P LSS M1 THEN BEGIN M1:=NT2; H:=NT1 END ;                   05842930
         IF P LSS M2 THEN IF U[I].SPEED=T THEN BEGIN M2:=NT2;J:=NT1 END;05843000
         END ;                                                          05843100
    IF (I:=I+1) LEQ L THEN GO B ;                                       05843200
    IF P(D)!M1 THEN                                                     05843300
         BEGIN                                                          05843400
         IF M2=M2:=P(D) THEN IF Z AND T NEQ 0 THEN                      05843500
C:            BEGIN GETUSERDISK~-1; GO G END                            05843600
         ELSE J~H ;                                                     05843700
         J:=J+1;  GO E ;                                                05843800
         END ;                                                          05843900
    IF Z THEN GO C ;                                                    05843950
    IF N.[2:1] THEN GO G ;                                              05844000
$INCLUDE 05844073, IF SHAREDISK ;                                       05844050
    UNLOCK(USERDISKBOTTOM);USERDISKSPECIALCASE(I:=1,R,U,NS);            05844070
    IF (Q:=R) THEN GO W;GO A;                                           05844072
$OMIT 05844111, IF SHAREDISK ;                                          05844090
    FIXARRAY(UT,R,30); USERDISKSPECIALCASE(I~1,R,UT,NS); GO TO A;       05844110
D:::@0777777777777777 ;                                                 05844200
$INCLUDE 05844901, IF SHAREDISK ;                                       05844290
E:  IF (K~(I~(M1~U[J]).STARTWRD)+T~M1 AND NUMENTM)>AVS THEN             05844300
         BEGIN                                                          05844400
         IF (L:=(K:=T+I:=(DL:=IF I LSS 30 THEN 0 ELSE IF (U[0] AND      05844500
         NUMENTM) LEQ 30 THEN 30 ELSE 60)+(H:=I) MOD 30) MOD 30) NEQ 0  05844530
         THEN L:=30-L ;                                                 05844540
         IF (L:=K+L) GTR AVS THEN                                       05844570
              BEGIN USERDISKSPECIALCASE(0,R,U,L&DL[CTF]); U~FLAG(P) END;05844600
         IF P(DL!0,DUP) THEN P(UT[DL-1],XCH) ;                          05844650
         DISKWAIT(-(R+DL),L:=L-DL,Z:=USERDISKBOTTOM+H DIV 30) ;         05844700
         IF P THEN UT[DL-1]:=P(XCH) ;                                   05844750
         END ;                                                          05844800
    P(K-1);  NT3:=K:=M1.MAXSIZ;  NT2:=0;                                05844900
$OMIT 05844936, IF SHAREDISK ;                                          05844915
E:  IF (AVS:=(K:=(T:=U[J] AND NUMENTM)+I:=(Z:=U[J].STARTWRD) MOD 30) MOD05844920
       30) NEQ 0 THEN AVS:=30-AVS;  AVS:=AVS+K;  P(M2) ;                05844925
    FIXARRAY(UT,R,AVS);  DISKWAIT(-R,AVS,Z~Z DIV 30+USERDISKBOTTOM) ;   05844930
    M2:=P;  P(K-1);  NT2:=0;  NT3:=K:=U[J].MAXSIZ ;                     05844935
F:  IF (NT1~UT[I].DSIZE)>NT2 THEN IF NT1!K THEN NT2~NT1 ELSE K:=0 ;     05845000
    IF NT1}NS THEN IF NT1<M2 THEN BEGIN M2~NT1; H~I END ;               05845100
    IF P(DUP) GTR I:=I+1 THEN GO F ;                                    05845200
    UT[H].DSIZE~NS~M2-NS ;                                              05845300
    IF M1:=M2=NT3 THEN U[J].MAXSIZ:=IF NT2>NS THEN NT2 ELSE NS ;        05845400
    GETUSERDISK~UT[H].DEND-M2;  I:=P ;                                  05845500
$INCLUDE 05845601, IF SHAREDISK ;                                       05845590
    IF N>0 THEN SCRATCHDIRECTORYENTER(K,N) ;                            05845600
    IF N~NS=0 THEN BEGIN MOVE(I-H,[UT[H+1]],[UT[H]]);U[J].NUMENT~T-1END;05845700
$INCLUDE 05846301, IF SHAREDISK ;                                       05845790
    IF Z GTR 1 THEN                                                     05845800
         BEGIN                                                          05845900
         IF DL NEQ 0 AND (M1 OR N) THEN DISKWAIT(R,DL,USERDISKBOTTOM) ; 05846100
         DISKWAIT(DL+R,L,Z) ;                                           05846110
         END                                                            05846200
    ELSE DISKWAIT(R,AVS,USERDISKBOTTOM) ;                               05846300
$OMIT 05846361, IF SHAREDISK ;                                          05846350
    DISKWAIT(R,AVS,Z) ;                                                 05846360
    IF Q.[FF] THEN                                                      05846361
     BEGIN                                                              05846362
    M[I:=GETAREA(0)]:=(*P(DUP))&LOGLINE[CTF]&16[18:41:7];               05846363
    M[I+1]:=0;                                                          05846364
    QUEVENT(I,CANDYINX);                                                05846365
    END;                                                                05846366
$INCLUDE 05846381, IF SHAREDISK ;                                       05846370
G: FORGETSPACE(R); UNLOCK(USERDISKBOTTOM); USERDISKREADY~TRUE;          05846380
$OMIT 05846396, IF SHAREDISK ;                                          05846385
    FORGETSPACE(R) ;                                                    05846390
G:  USERDISKREADY~TRUE ;                                                05846395
W:  END OF GETUSERDISK ;                                                05846500
                                                                        05846590
                                                                        05846595
PROCEDURE FORGETUSERDISK(A,N);  VALUE A,N;  REAL A,N ;                  05847000
                                                                        05847010
% A IS THE ABSOLUTE DISK SEGMENT ADDRESS OF AN AREA N SEGMENTS LONG     05847020
% WHICH IS TO BE MADE AVAILABLE AGAIN.                                  05847030
% N<0 => MAKE A SCRATCHDIRECTORY DELETION.                              05847040
% N>0 => DONT MAKE A SCRATCHDIRECTORY DELETION.                         05847050
% N=0 => IMMEDIATELY GO AWAY ;                                          05847060
                                                                        05847070
    BEGIN                                                               05847080
$INCLUDE 05847101, IF SHAREDISK ;                                       05847090
    INTEGER DL,F;  ARRAY U[*];  DEFINE UT=U #;                          05847100
$OMIT 05847121, IF SHAREDISK ;                                          05847110
    INTEGER AVS,F=AVS;  ARRAY UT[*];  DEFINE U=AVTABLE #;               05847120
    REAL E;  INTEGER B,C,D,I,J,R,S,H=NT7,K=NT6,L=NT5,G=NT4,T=NT3,Q=JUNK;05847130
    LABEL V,W,X,Y,Z,AZ,BZ,CZ,DZ ;                                       05847140
    SUBROUTINE SETSHIFT ;                                               05847150
         BEGIN                                                          05847160
         S:=P(XCH) ;                                                    05847170
$INCLUDE 05847191, IF SHAREDISK ;                                       05847180
         U[J].STARTWRD:=G:=I+S;  IF B>1 THEN G:=D+S+DL;  D:=30 ;        05847190
$OMIT 05847211, IF SHAREDISK ;                                          05847200
         U[J].STARTWRD:=I+S;  G:=D+S ;                                  05847210
         K:=G+C-1 ;                                                     05847220
         END OF SETSHIFT ;                                              05847230
                                                                        05847240
    % * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 05847250
                                                                        05847260
    IF N=0 OR (J~A DIV 1000000)}NEUP.NEUF OR A<USERDISKBOTTOM+          05847270
       DISKAVAILTABLEMAX THEN GO BZ ;                                   05847271
$ INCLUDE 05847281,IF SHAREDISK;                                        05847279
    FIXARRAY(U,R,AVS);                                                  05847280
    SLEEP([TOGLE],USERDISKMASK);USERDISKREADY:=FALSE;                   05847290
$ INCLUDE 05847301, IF SHAREDISK ;                                      05847299
    DISKWAIT(-R,-AVS,USERDISKBOTTOM);                                   05847300
    IF (D:=U[0].MAXSIZ) NEQ 0 AND N GTR 0 THEN IF (TWO(J) AND D) NEQ 0  05847310
    THEN BEGIN USERDISKSPECIALCASE(3,N,U,A); IF NOT P THEN GO DZ END ;  05847320
    J:=J+1 ;                                                            05847330
V:  D~(I~(E~U[J]).STARTWRD) MOD 30 ;                                    05847340
$INCLUDE 05847461, IF SHAREDISK ;                                       05847350
    IF (S:=K:=(C:=E AND NUMENTM)+L:=I) GEQ (F:=AVS) THEN                05847360
         BEGIN                                                          05847370
         P((DL:=IF I LSS 30 THEN 0 ELSE IF (U[0] AND NUMENTM) LEQ 30    05847380
           THEN 30 ELSE 60)+D,DUP,C,+,DUP,DUP) ;                        05847390
         IF (F:=P-P MOD 30+30) GEQ AVS THEN                             05847400
              BEGIN USERDISKSPECIALCASE(0,R,U,F&DL[CTF]); U~FLAG(P) END;05847410
         IF I+F>AVTMAX+D+DL THEN GO Y ;                                 05847420
         IF P(DL!0,DUP) THEN P(UT[DL-1],XCH) ;                          05847430
         DISKWAIT(-(R+DL),F-DL,B:=USERDISKBOTTOM+I DIV 30) ;            05847440
         IF P THEN UT[DL-1]:=P(XCH);  K:=P;  L:=P ;                     05847450
         END ;                                                          05847460
$ OMIT 05847501, IF SHAREDISK ;                                         05847470
    AVS:=30-(S:=(C:=E AND NUMENTM)+D) MOD 30+S ;                        05847480
    FIXARRAY(UT,R,AVS);  DISKWAIT(-R,AVS,B:=I DIV 30+USERDISKBOTTOM) ;  05847490
    K:=S;  L:=D;  S:=I+C ;                                              05847500
    G~I-(NT2:=(P(U[J-1],DUP) AND NUMENTM)+P(XCH).STARTWRD) ;            05847510
    S~U[J+1].STARTWRD-S;  H~K~K-1;  IF UT[T~L].DEND}A THEN GO X ;       05847520
W:  IF UT[T~(H+L+1)DIV 2].DEND}A THEN IF UT[H~T-1].DEND}A THEN GO W ELSE05847530
    ELSE IF UT[T~T+1].DEND<A THEN BEGIN L~T+1; GO W END ;               05847540
X:  IF (L:=A+ABS(N)) GEQ H:=P(UT[Q:=T],DUP).DEND-P(XCH).DSIZE THEN GO Z;05847550
    IF S=0 THEN                                                         05847560
         BEGIN                                                          05847570
$INCLUDE 05847611, IF SHAREDISK ;                                       05847580
         IF G=0 THEN GO Y;  P((G+1) DIV 2) ;                            05847590
         IF B>1 THEN                                                    05847600
              BEGIN IF D=0 THEN GO Y; IF P(DUP) GTR D THEN P(DEL,D) END;05847610
$OMIT 05847631, IF SHAREDISK ;                                          05847620
         IF G=0 OR D=0 THEN GO Y;  IF P((G+1)DIV 2,DUP)>D THEN P(DEL,D);05847630
         P(SSN);  SETSHIFT;  MOVE(C,[UT[G-S]],[UT[G]]);  T:=Q:=T+S ;    05847640
         END ;                                                          05847650
    FOR H~K STEP -1 UNTIL T DO UT[H+1]~UT[H];  H~ABS(N);  GO AZ ;       05847660
Y: USERDISKSPECIALCASE(2,E,UT,J) ;                                      05847670
$INCLUDE 05847691, IF SHAREDISK ;                                       05847680
    UT:=FLAG(P);  R:=UT.[CF];  B:=0 ;                                   05847690
    GO V ;                                                              05847700
Z:  IF P(UT[Q~Q+1],DUP).DEND-P(XCH).DSIZE{L THEN GO Z ;                 05847710
    IF P(UT[NT1:=Q-1].DEND,DUP) LSS L THEN P(DEL,L) ;                   05847720
    H:=(L:=P)-(IF A LSS H THEN A ELSE H) ;                              05847730
    IF NT1 GTR T THEN MOVE(K-NT1,[UT[Q]],[UT[T+1]]) ;                   05847740
AZ: UT[T]~L&H[TODSIZE];  C~(Q~T-Q+1)+C ;                                05847750
    IF(S~S-Q)>T~IF AVDIFFMAX>T~C DIV 2 THEN AVDIFFMAX ELSE T THEN IF J=105847760
    OR S+G>T+(IF AVDIFFMAX>T~NT2 DIV 2 THEN AVDIFFMAX ELSE T) THEN GO Y 05847770
    ELSE BEGIN                                                          05847780
         IF (NT1:=F-1-K)=0 THEN GO Y ;                                  05847790
         IF P((S+G) DIV 2,DUP)>NT1 THEN P(DEL,NT1);  SETSHIFT ;         05847800
         FOR NT1~K STEP -1 UNTIL G DO UT[NT1]~UT[NT1-S] ;               05847810
         END ;                                                          05847820
    U[J]~(NT1~U[J])&C[TONUMENT]&(IF E~(NT1~NT1.MAXSIZ)<H THEN H ELSE    05847830
         NT1)[TOMAXSIZ] ;                                               05847840
$INCLUDE 05847921, IF SHAREDISK ;                                       05847850
    IF B GTR 1 THEN                                                     05847860
         BEGIN                                                          05847870
         IF DL NEQ 0 AND (E OR Q NEQ 0 OR D=30)                         05847880
         THEN DISKWAIT(R,DL,USERDISKBOTTOM) ;                           05847890
         DISKWAIT(R+DL,F-DL,B) ;                                        05847900
         END                                                            05847910
    ELSE DISKWAIT(R,AVS,USERDISKBOTTOM) ;                               05847920
$OMIT 05847941, IF SHAREDISK ;                                          05847930
    DISKWAIT(R,AVS,B) ;                                                 05847940
$INCLUDE 05847981, IF SHAREDISK ;                                       05847950
    IF N<0 THEN SCRATCHDIRECTORYDELETE(A,-N) ;                          05847960
DZ: FORGETSPACE(R);  USERDISKREADY~TRUE;  UNLOCK(USERDISKBOTTOM) ;      05847980
$OMIT 05848001, IF SHAREDISK ;                                          05847985
    FORGETSPACE(R) ;                                                    05847990
DZ: USERDISKREADY~TRUE ;                                                05848000
BZ: END OF FORGETUSERDISK ;                                             05848010
PROCEDURE KRUNCHER(H); ARRAY H[*]; FORWARD;                         %R5005849900
PROCEDURE SCHEDLOOK(KTR,TYPE); VALUE KTR,TYPE; REAL KTR,TYPE;%          05850000
BEGIN REAL T1,T2,H1,H2,MS,S,BUFF=S,LL=H2;                               05850100
    INTEGER I=NT1, J=NT2;                                               05850200
    LABEL NXT,ENDIT,ESETC,LOOP,LOOPD,ERROR;                             05850300
    LABEL STRM;                                                         05850310
$INCLUDE 05850391, IF DCP;                                              05850319
    LABEL FIND1,FIND2,RDY;                                              05850320
    ARRAY A=H1[*];                                                      05850330
    SUBROUTINE SYSDISKER;                                               05850340
    BEGIN A:=IOQUE&SPACE(10)[CTC];                                      05850350
         SYSDISKIO(3,-LL,A);                                            05850360
         A[0]:=IF TYPE THEN 0 ELSE STATABLE[LL];                        05850370
         A[1]:=A[2]:=A[3]:=0;                                           05850375
         SYSDISKIO(0,-LL,A);                                            05850380
         FORGETSPACE(A);                                                05850385
    END;                                                                05850390
                                                                        05850400
         IF KTR NEQ 0 THEN GO TO ESETC; %ES,XS,SV,RY                    05850500
         IF SCHEDTOG THEN SLEEP([SCHEDWRD],-0);                         05850600
         SCHEDWRD:=ABS(SCHEDWRD);                                       05850700
         IF FRSTSCHED=SCHEDNUM THEN GO ENDIT;                           05850800
         T1:=FRSTSCHED INX "FILE000";                                   05850900
    NXT: IF (H1:=DIRECTORYSEARCH(T1,"SCHEDUL",4))=0 THEN                05851000
         BEGIN T1:=0; GO ENDIT; END;                                    05851100
         IF T2 NEQ 0 THEN                                               05851200
         BEGIN M[H2+29]:=T1; HEADERUNLOCK(T2,"SCHEDUL",H2) END;         05851300
         M[H1+28]:=T2; T2:=T1; H2:=H1; S:=S+1; T1:=M[H2+29];            05851400
         IF TYPE THEN IF T1=0 THEN GO ENDIT ELSE GO NXT;                05851500
         MS:=SPACE(10);                                                 05851600
         I:=M[H2+6] DIV 3600; J:=I MOD 60; I:=I DIV 60;                 05851700
         STREAM(T2,U:=M[H2+2],I,J,T:=(I GTR 0),MS);                 %09805851800
         BEGIN SI:=LOC T2; SI:=SI+5; DS:=6LIT" TASK#"; DS:=3CHR;        05851900
              DS:=LIT":"; SI:=SI+1; DS:=7CHR;                           05852000
              T(DS:=7LIT" AFTER "; DS:=2DEC; DS:=LIT":"; DS:=2DEC);     05852100
              DS:=LIT"~";                                               05852200
         END;                                                           05852300
         SPOUT(MS); IF T1 NEQ 0 THEN GO TO NXT;                         05852400
    ENDIT: IF T2=0 THEN FRSTSCHED:=SCHEDNUM                             05852500
         ELSE                                                           05852600
         BEGIN LSTSCHED:=T2; M[H2+29]:=0;                               05852700
              HEADERUNLOCK(T2,"SCHEDUL",H2);                            05852800
         END;                                                           05852900
         CHANGEDATE(0); SCHEDWRD:=NABS(SCHEDWRD);                       05853000
         IF TYPE LSS 0 AND S GTR 0 THEN                                 05853100
         BEGIN; STREAM(S,T1:=T1:=SPACE(10));                            05853200
              BEGIN DS:=11LIT" THERE ARE"; T1:=DI; SI:=LOC S;           05853300
                   DS:=4 DEC; DS:=15LIT" TASKS ON DISK~";               05853400
                   DI:=T1; DS:=3 FILL;                                  05853500
              END;                                                      05853600
              SPOUT(T1);                                                05853700
         END;                                                           05853800
         IF TYPE=0 THEN     % TS MESSAGE                                05853900
         BEGIN T1:=SPACE(5);                                            05853950
              IF S=0 THEN                                               05854000
              BEGIN STREAM(T1); DS:=20 LIT" NULL TASK SCHEDULE~"; END   05854050
              ELSE STREAM(T1); DS:=7 LIT"END TS~";                      05854100
              SPOUT(T1);                                                05854200
         END;                                                           05854300
    P(XIT);                                                             05854400
    ESETC: BUFF:=KTR;                                                   05854500
    LOOP: ;                                                             05854600
         STREAM(T:=0,LL:=0,KTR:Z:=(TYPE LSS 2),BUFF);                   05854700
         BEGIN SI:=KTR;                                                 05854800
           L1: IF SC=" " THEN BEGIN SI:=SI+1; GO TO L1 END;             05854900
              2(40(IF SC="~" THEN JUMP OUT 2 TO L2; DS:=CHR));          05855000
           L2: DS:=LIT"~"; DI:=LOC LL;  SI:=BUFF;                       05855100
              3(IF SC LSS "0" THEN JUMP OUT;                            05855200
                IF SC GTR "9" THEN JUMP OUT;                            05855300
                TALLY:=TALLY+1; SI:=SI+1);                              05855400
              SI:=BUFF; BUFF:=TALLY;                                    05855500
              Z(DI:=DI+8; DI:=DI-BUFF;DS:=BUFF CHR; JUMP OUT TO L3);    05855600
              DS:=BUFF OCT;                                             05855650
           L3: IF SC=" " THEN BEGIN SI:=SI+1; GO TO L3 END;             05855700
              IF SC="," THEN SI:=SI+1;                                  05855800
              IF SC="~" THEN                                            05855900
              BEGIN TALLY:=1; T:=TALLY END;                             05856000
              KTR:=SI;                                                  05856100
         END;                                                           05856200
         KTR:=P;  LL:=P;  T1:=P;                                        05856300
         IF LL=0 THEN GO TO ERROR;                                      05856400
         IF TYPE LSS 2 THEN %ES OR XS                                   05856500
         BEGIN                                                          05856600
              FORK(P(.SCHEDIDLE),(NOT 0)&LL[CTC]&TYPE[2:32:16],0,160,0);05856700
              GO TO LOOPD;                                              05856800
         END;                                                           05856900
         IF LL GTR LMAX THEN GO TO ERROR;                               05857000
$OMIT 05857191, IF DCP;                                                 05857149
         IF NOT SCHEDLINE[LL] THEN                                      05857150
    ERROR:    BEGIN NT1:=" INVALI"; NT2:="D~     "; GO TO STRM END;     05857160
         SCHEDBUSY[LL]:=TYPE;                                           05857170
         NT1:=IF TYPE THEN " SAVED~" ELSE " READY~";                    05857180
         NT2:=0;                                                        05857190
$INCLUDE 05857471, IF DCP;                                              05857199
         IF TYPE THEN                  % SV                             05857200
         IF SCHEDLINE[LL] THEN              % SV IS ALLOWED.            05857210
         IF STATABLE[LL].DIALEDUP THEN      % STATION IS IN USE SO      05857220
         BEGIN SCHEDBUSY[LL]:=1;            % MARK IT SAVED.            05857230
              NT1:=" SAVED~"; NT2:=0;                                   05857240
         END ELSE                           % STA IS NOT IN USE SO      05857250
         BEGIN H1:=0;                       % REMOVE IT.                05857260
              DO H1:=STATABLE[NT3:=H1].[40:8] UNTIL H1=LL;              05857270
              STATABLE[NT3]:=(*P(DUP))&STATABLE[LL][40:40:8];           05857280
              STATABLE[LL]:=0;                                          05857290
              SYSDISKER;                                                05857300
              NT1:=" RETURN"; NT2:="ED~    ";                           05857310
         END ELSE GO TO ERROR                                           05857320
         ELSE                          % RY                             05857330
         IF SCHEDLINE[LL] THEN              % ALREADY SCHED SO JUST     05857340
         BEGIN SCHEDBUSY[LL]:=0;            % UN-SV IT.                 05857350
              GO TO RDY;                                                05857360
         END ELSE                                                       05857370
         BEGIN IF STATABLE[LL]!0 THEN       % STA ALREADY ACTIVE        05857380
              BEGIN                                                     05857390
    ERROR:         NT1:=" INVALI"; NT2:="D~     ";                      05857400
                   GO TO STRM;                                          05857410
              END;                                                      05857420
              STATABLE[LL]:=STATABLE[0].[CF]&17[16:43:5];               05857430
              STATABLE[0].[CF]:=LL;                                     05857440
              SYSDISKER;                                                05857450
    RDY:      NT1:=" READY~"; NT2:=0;                                   05857460
         END;                                                           05857470
    STRM:                                                               05857500
         STREAM(LL,NT1,NT2,MS:=MS:=SPACE(5));                           05857550
$OMIT 05857601, IF DCP;                                                 05857599
         BEGIN DS:=6LIT" LINE "; SI:=LOC LL; DS:=3 DEC;                 05857600
$INCLUDE 05857651, IF DCP;                                              05857649
         BEGIN DS:=9 LIT" STATION "; SI:=LOC LL; DS:=3 DEC;             05857650
              2(SI:=SI+1; DS:=7 CHR); DI:=DI-17; DS:=2 FILL;            05857700
         END;                                                           05857800
         SPOUT(MS); T2:=T2+1;                                           05857900
    LOOPD: IF NOT T1 THEN GO TO LOOP;                                   05858000
         IF (TYPE=2) AND (T2 GTR 0) THEN                                05858400
         IF SCHEDNUM NEQ FRSTSCHED THEN FORK(P(.SCHEDIDLE),0,0,160,0);  05858500
END SCHEDLOOK;                                                          05858600
PROCEDURE SCHEDIDLE(ADR); VALUE ADR; REAL ADR;                          05858700
BEGIN                                                                   05858800
    REAL RCW=+0;                                                        05858900
    ARRAY A[*];                                                         05859000
    REAL LL,NXTSCHED, T1,T2,T,TIME;                                     05859100
    INTEGER I=NT1;                                                      05859200
    LABEL LINKIT, LUKAGN, LINKED, INIT1, FORGT1, TERMNATE,              05859300
         REMOVIT, EXITR;                                                05859400
    LABEL INIT, STRT, RPT, RSTRT, FORGET, GOTO, EXIT;                   05859500
    REAL N1,N2,SCH,FILE;                                                05859600
    REAL CHARGE; INTEGER AFTER;                                     %09805859610
    DEFINE PT=A[30]#                                                    05859700
         , IO=A[31]#                                                    05859800
       ,DELTA=A[32]#                                                    05859900
           ,N=A[33]#                                                    05860000
           ,S=A[34]#                                                    05860100
           ,R=A[35]#                                                    05860200
           ,H=A[36]#                                                    05860300
          ,NR=A[37]#                                                    05860400
          ,MR=A[38]#                                                    05860500
       ;                                                                05860600
                                                                        05860700
    DEFINE FORGETDISK =                                                 05860800
    BEGIN                                                               05860900
         FOR T1:=(M[T+9]+9) STEP -1 UNTIL 10                            05861000
         DO IF M[T1+T] NEQ 0 THEN FORGETUSERDISK(M[T1+T],M[T+8]);       05861100
    END#;                                                               05861200
    LABEL DLOUT;                                                        05861300
    SUBROUTINE DELINK;                                                  05861400
    BEGIN                                                               05861500
         IF M[T+28]=0 THEN                                              05861600
         BEGIN IF M[T+29]=0 THEN                                        05861700
              BEGIN FRSTSCHED:=SCHEDNUM; CHANGEDATE(0); GO DLOUT END    05861800
              ELSE BEGIN FRSTSCHED:=M[T+29]; CHANGEDATE(0) END          05861900
         END ELSE                                                       05862000
         IF (T2:=DIRECTORYSEARCH(M[T+28],SCH,4)) NEQ 0 THEN             05862100
         BEGIN M[T2+29]:=M[T+29];                                       05862200
              HEADERUNLOCK(M[T+28],SCH,T2);                             05862300
         END;                                                           05862400
         IF M[T+29]=0 THEN BEGIN LSTSCHED:=M[T+28]; CHANGEDATE(0) END   05862500
         ELSE                                                           05862600
         IF (T2:=DIRECTORYSEARCH(M[T+29],SCH,4)) NEQ 0 THEN             05862700
         BEGIN M[T2+28]:=M[T+28];                                       05862800
              HEADERUNLOCK(M[T+29],SCH,T2);                             05862900
         END;                                                           05863000
    DLOUT:                                                              05863100
    END;                                                                05863200
                                                                        05863300
    DEFINE MYSTACK =                                                    05863400
             ([RCW] INX NOT 3).[CF]#;                                   05863500
                                                                        05863600
         LL:=ADR.[CF]; SCH:="SCHEDUL"; FILE:="FILE000";                 05863700
         IF ADR.[1:1] THEN GO TERMNATE;                                 05863800
         IF ADR.[2:1] THEN GO LINKIT;                                   05863900
         IF LL=0 THEN GO TO INIT;                                       05864000
    %  "GO TO RECORD"... MAY BE RESTART ALSO.                           05864100
              SYSDISKIO(1,-LL,A:=(IOQUE&(GETAREA(1)+1)[CTC]));          05864200
              N1:=A[1]; T1:=A[2]; N2:=A[3];                             05864300
              FORGETAREA(1,A INX NOT 0);                                05864310
              NXTSCHED:=-(T1.[CF]);                                     05864400
              IF (T:=SEQARRAY[LL].[CF]) LSS 512 THEN GO TO RSTRT;       05864500
              IF SCHEND[LL] THEN GO EXIT;                               05864510
              A:=[M[T]]&80[8:38:10];                                    05864600
              IF NOT(A[72].[1:1]) THEN SLEEP([A[72]],-0);               05864700
              A[72]:=ABS(*P(DUP));                                      05864800
              IF NOT(A[32].[1:1]) THEN SLEEP([A[32]],-0);               05864900
              A[32]:=ABS(*P(DUP));                                      05865000
              A[37]:=N2.[CF]; A[77]:=N2.[FF];                           05865100
              GO TO GOTO;                                               05865200
    %  LINK IN NEW SCHEDULE TASK                                        05865300
    LINKIT::                                                            05865400
              IF SCHEDTOG THEN SLEEP([SCHEDWRD],-0);                    05865500
              SCHEDWRD:=ABS(SCHEDWRD);                                  05865600
              NXTSCHED:=SCHEDNUM INX FILE;                              05865700
         P(DIRECTORYSEARCH(NXTSCHED,SCH,6),DEL);                        05865800
              IF (T:=DIRECTORYSEARCH(M[ADR+5],M[ADR+2],4))=0 THEN       05866000
              BEGIN T:=ADR; FORGETDISK; FORGETSPACE(T); GO EXITR END;   05866100
              M[T+6]:=(NOT 0)&NXTSCHED[CTC];                            05866200
              HEADERUNLOCK(M[ADR+5],M[ADR+2],T);                        05866300
              IF FRSTSCHED=SCHEDNUM THEN GO TO LINKED;                  05866400
              T1:=LSTSCHED INX FILE;                                    05866500
              IF (TIME:=M[ADR+6])=0 THEN                                05866600
              IF (TIME:=XCLOCK) LSS 1728000 THEN TIME:=5184000;         05866700
    LUKAGN:   IF (N1:=DIRECTORYSEARCH(T1,SCH,4))=0 THEN                 05866800
              BEGIN IF T2 NEQ 0 THEN HEADERUNLOCK(T2,SCH,N2);           05866900
                   SCHEDWRD:=NABS(SCHEDWRD); SCHEDLOOK(0,1);            05867000
                   T2:=0; GO LINKIT;                                    05867100
              END;                                                      05867200
              IF M[N1+6] GTR TIME THEN                                  05867300
              BEGIN IF T2 NEQ 0 THEN HEADERUNLOCK(T2,SCH,N2);           05867400
                   T2:=T1; N2:=N1;                                      05867500
                   IF (T1:=M[N2+28]) NEQ 0 THEN GO LUKAGN;              05867600
              END;                                                      05867700
    LINKED::  M[ADR+28]:=T1; M[ADR+29]:=T2;                             05867800
              ENTERUSERFILE(-NXTSCHED,SCH,ADR.[CF]-1);                  05867900
              T:=SCHEDNUM;                                              05868000
              STREAM(A1:=1, A2:=[T]);                                   05868100
              BEGIN SI:=LOC A1; DS:=8 ADD END;                          05868200
              SCHEDNUM:=IF (T=0) THEN 1 ELSE T;                         05868300
              IF T1 NEQ 0 THEN                                          05868400
              BEGIN M[N1+29]:=NXTSCHED; HEADERUNLOCK(T1,SCH,N1) END     05868500
              ELSE FRSTSCHED:=NXTSCHED;                                 05868600
              IF T2=0 THEN LSTSCHED:=NXTSCHED;                          05868700
              CHANGEDATE(0);                                            05868800
              IF T2 NEQ 0 THEN                                          05868900
              BEGIN M[N2+28]:=NXTSCHED; HEADERUNLOCK(T2,SCH,N2) END;    05869000
              FORGETSPACE(ADR);                                         05869100
              ADR:=0;                                                   05869200
              GO TO INIT1;                                              05869300
    %  END OF LINK IN NEW SCHEDULE TASK                                 05869400
    INIT::    IF SCHEDTOG THEN SLEEP([SCHEDWRD],-0);                    05869500
              SCHEDWRD:=ABS(SCHEDWRD);                                  05869600
    INIT1::   IF (NXTSCHED:=FRSTSCHED)=SCHEDNUM THEN GO EXITR;      %R8905869700
              LL:=0;                                                %R8905869750
              IF (TIME:=XCLOCK) LSS 1728000 THEN TIME:=5184000;         05869800
$OMIT 05869901, IF DCP;                                                 05869899
    STRT::   IF LINEDISC[LL:=LL+1] ! SCHED THEN GO TO EXITR;            05869900
$INCLUDE 05869951, IF DCP;                                              05869949
    STRT::    IF (LL:=STATABLE[LL].[40:8])=0 THEN GO TO EXITR;          05869950
              IF STATABLE[LL].DIALEDUP THEN GO TO STRT;                 05870000
              IF SCHEDBUSY[LL] THEN GO TO STRT;                         05870100
              IF SEQARRAY[LL] NEQ 0 THEN GO TO STRT;                    05870200
              SEQARRAY[LL]:=1;                                          05870300
    RPT:      IF NXTSCHED=0 THEN                                        05870400
              BEGIN SEQARRAY[LL]:=0; GO EXITR END;                      05870500
              T1:=NXTSCHED INX FILE; N1:=N2:=0;                         05870600
    RSTRT::   IF (T:=DIRECTORYSEARCH(T1,SCH,4))=0 THEN                  05870700
              IF NXTSCHED LSS 0 THEN                                    05870800
              BEGIN A:=[M[SPACE(10)]]&10[8:38:10];                      05870900
                   GO TO FORGT1;                                        05871000
              END                                                       05871100
              ELSE                                                      05871200
              BEGIN SEQARRAY[LL]:=0; LL:=0;                             05871300
                   %TRY TO RESTORE QUEUE                                05871400
                   SCHEDWRD:=NABS(SCHEDWRD); SCHEDLOOK(0,1);            05871500
                   GO TO INIT;                                          05871600
              END;                                                      05871700
              IF NXTSCHED GEQ 0 THEN                                    05871800
              BEGIN NXTSCHED:=M[T+29].[CF];                             05871900
                   IF TIME LSS M[T+6] THEN                              05872000
                   BEGIN HEADERUNLOCK(T1,SCH,T);                        05872100
                        SEQARRAY[LL]:=0; GO TO EXITR                    05872200
                   END;                                                 05872300
                   IF M[T+6].[2:1] THEN %ITS BEING TERMINATED       %09805872400
                   BEGIN HEADERUNLOCK(T1,SCH,T); GO TO RPT END;         05872500
                   DELINK;                                              05872600
              END;                                                      05872700
              A:=[M[SPACE(80)]]&80[8:38:10];                            05872800
              A[0]:=0; MOVE(79,A,A INX 1); %ZERO OUT ARRAY              05872900
              DISKWAIT(-(A INX 40),30,M[T INX 10]); %FILL BUFF          05873000
              A[70]:=T1.[CF];    %SCHEDULE NUMBER                       05873100
              A[71]:=IOMASK;                                            05873200
              A[74]:=M[T INX 8];%ROW LENGTH OF IP FILE                  05873300
              A[75]:=M[T INX 10];%ADDRESS OF 1ST ROW                    05873400
              A[76]:=T.[FF];  %ADDRESS OF HEADER                        05873500
              A[77]:=N2.[FF];                                           05873600
              A[78]:=M[T INX 7]+2; %NUMBER OF RECORDS                   05873700
              A[37]:=N2.[CF];                                           05873800
              N1:=M[T INX 2]; %GET USERCODE                             05873900
              N2:=M[T INX 5]; %GET O/P FILE NAME                        05874000
              AFTER:=ABS(M[T INX 6]) DIV 3600; %TIME AFTER IN MIN   %09805874010
              CHARGE:=M[T INX 27]; %CHARGE CODE                     %09805874020
              FORGETSPACE(T);                                           05874100
          IF (T~DIRECTORYSEARCH(N2,N1,2))=0 THEN                        05874200
              BEGIN                                                     05874300
    FORGET:        T:=DIRECTORYSEARCH(T1,SCH,8);                        05874400
                   FORGETDISK; FORGETSPACE(T);                          05874500
                   IF NXTSCHED GEQ 0 THEN                               05874600
                   BEGIN FORGETSPACE(A); GO TO RPT; END;                05874700
    FORGT1:        SYSDISKIO(3,-LL,A);                                  05874800
                   A[0].DIALEDUP:=A[1]:=0;                              05874900
                   SYSDISKIO(0,-LL,A); FORGETSPACE(A);                  05875000
                   GO TO EXIT;                                          05875100
              END;                                                      05875200
              IF NXTSCHED GEQ 0 THEN                                    05875300
              IF M[T+4].[36:6]=TYPEINFO THEN                            05875400
              BEGIN FORGETSPACE(T);                                     05875500
                FORGETSPACE(DIRECTORYSEARCH(N2,N1,12));                 05875600
                   GO TO FORGET                                         05875700
              END ELSE BEGIN                                            05875800
                   DISKWAIT(-T.[CF],30,T.[FF]);                         05875850
                   M[T+4].[36:6]:=TYPEINFO;                             05875900
                   DISKWAIT(T.[CF],30,T.[FF]);                          05876000
                   STREAM(A);                                           05876100
                   BEGIN DS:=21 LIT"YOUR TASK IS RUNNING.";             05876200
                        DS:=51 LIT "    "; DS:=8 LIT"00000001";         05876300
                        20(DS:=8LIT "    ");                            05876400
                   END;                                                 05876500
                   A[32]:=10; A[37]:=1;                                 05876600
              END;                                                      05876700
              A[31]:=IOMASK;                                            05876800
              A[34]:=M[T INX 8];                                        05876900
              A[35]:=M[T INX 10];                                       05877000
              A[36]:=T.[FF];                                            05877100
              A[38]:=A[34]|M[T INX 9].[40:8]|3;   % MAX NUM OF OUPT RECS05877200
              FORGETSPACE(T);                                           05877300
              IF NXTSCHED LSS 0 THEN                                    05877400
              BEGIN                                                     05877500
    GOTO::         IF A[37] GEQ A[38] THEN A[37]:=A[38]-1;              05877600
                   IF (N2:=(A[37]) DIV 3) NEQ A[33] THEN                05877700
                   BEGIN A[37]:=(A[33]:=N2)|3; A[32]:=0;                05877800
                        IF (A[31] AND IOMASK)=0 THEN                    05877900
                             SLEEP([A[31]],IOMASK);                     05878000
                        DISKWAIT(-A.[CF],30,A[36]);                     05878100
                        IF (N2:=A[(I:=N2 DIV A[34])+10])=0 THEN         05878200
                            GO TO FORGET;                               05878300
                        A[35]:=N2-(I|A[34]);                            05878400
                   END;                                                 05878500
                   IF A[77] GEQ A[78] THEN A[77]:=A[78]                 05878600
                   ELSE                                                 05878700
                   BEGIN A[72]:=(I:=(A[77]-1) MOD 3)|10;                05878800
                        IF (N2:=(A[77]-1) DIV 3) NEQ A[73] THEN         05878900
                        BEGIN A[73]:=N2;                                05879000
                             IF (A[71] AND IOMASK)=0 THEN               05879100
                                  SLEEP([A[71]],IOMASK);                05879200
                             DISKWAIT(-(A INX 40),30,A[76]);            05879300
                             IF (N2:=A[(I:=N2 DIV A[74])+50])=0 THEN    05879400
                                  A[77]:=A[78]                          05879500
                             ELSE BEGIN                                 05879600
                                  A[75]:=N2-(I|A[74]);                  05879700
                                  DISKIO(A[71],-(A INX 39),30,N2);      05879800
                             END;                                       05879900
                        END;                                            05880000
                   END;                                                 05880100
                   IF SEQARRAY[LL].[FF]=0 THEN                          05880200
                   BEGIN STATABLE[LL].DIALEDUP:=1;                      05880300
                        A[32]:=NABS(*P(DUP)); A[72]:=NABS(*P(DUP));     05880400
                        IF SEQARRAY[LL] GEQ 0 THEN GO TO EXIT;          05880500
                        SEQARRAY[LL] := ABS(*P(DUP));                   05880600
                        FORK(P(.SCHEDIO), (-LL), 0, 0, MYSTACK);        05880700
                        GO TO NOTHINGTODO;                              05880800
                   END;                                                 05880900
              END;                                                      05881000
              CONNECT(LL);                                              05881100
              SEQARRAY[LL]:=A.[CF];                                     05881200
              T:=GETAREA(0);                                            05881300
              M[T]:=0&9[18:41:7]&LL[25:40:8];                           05881400
              M[T+1]:=N1&1[2:47:1]&NXTSCHED[1:1:1];                     05881500
              QUEVENT(T.[CF],CANDEMIX[LL]);                             05881600
              A[32]:=NABS(*P(DUP)); A[72]:=NABS(*P(DUP));               05881700
              T:=SPACE(30); I:=AFTER MOD 60;                        %09805881800
              STREAM(N1,LL,CHARGE,AFT:=(AFTER DIV 60),I,            %09805881810
                     X:=(NOT CHARGE).[1:1],Y:=(AFTER NEQ 0),T);     %09805881820
              BEGIN DS:=LIT" "; SI:=LOC N1; SI:=SI+1; DS:=7 CHR;        05881900
                   DS:=5LIT" ON "; T:=DI; DS:=3DEC; DS:=2LIT"-S";   %09805882000
                   X(DS:=LIT"("; SI:=SI+1; DS:=7CHR; DS:=LIT")");   %09805882020
                   Y(DS:=LIT"["; SI:=LOC AFT; DS:=2 DEC;            %09805882040
                     DS:=LIT":"; DS:=2 DEC; DS:=LIT"]");            %09805882060
                   DS:=LIT LEFTARROW; DI:=T; DS:=2 FILL;            %09805882100
              END;                                                      05882200
              LOGLINE:=@1000+LL; SPOUTIT(T,INOUTK);                     05882300
              IF NXTSCHED LSS 0 THEN GO TO EXIT;                        05882400
              SYSDISKIO(3,-LL,(A:=A&(GETAREA(1)+1)[CTC]));              05882500
              A[0].DIALEDUP:=1; A[1]:=N1; A[2]:=T1; A[3]:=1;            05882600
              SYSDISKIO(0,-LL,A); FORGETAREA(1,A INX NOT 0);            05882700
              GO TO STRT;                                               05882800
    %  END INITIATE/GOTO                                                05882900
    TERMNATE::  IF ADR.[FF] NEQ 0 THEN GO REMOVIT;                      05883000
    %  TERMINATE A RUNNING TASK                                         05883100
              IF SCHEND[LL] THEN GO EXIT; SCHEND[LL]:=1;                05883200
              A:=[M[SEQARRAY[LL]]]&80[8:38:10];                         05883300
              IF NOT(A[72].[1:1]) THEN SLEEP([A[72]],-0);               05883400
              A[72]:=ABS(*P(DUP));                                      05883500
              IF NOT(A[32].[1:1]) THEN SLEEP([A[32]],-0);               05883600
              A[32]:=ABS(*P(DUP));                                      05883700
              IF DELTA NEQ 0 THEN DISKIO(IO,A.[CF]-1,30,R+N);           05883800
              IF (A[71] AND IOMASK)=0 THEN SLEEP([A[71]],IOMASK);       05883900
              SYSDISKIO(3,-LL,40 INX A);                                05884000
              T1:=A[42]; %SAVE NAME OF SCHEDULE IP                      05884100
              A[40].DIALEDUP:=A[41]:=A[42]:=A[43]:=SEQARRAY[LL]:=0;     05884200
$INCLUDE 05884271, IF DCP;                                              05884209
              IF SCHEDBUSY[LL] THEN                                     05884210
              BEGIN A[40]:=0;                                           05884220
                   T:=0;                                                05884230
                   DO T:=STATABLE[NT1:=T].[40:8] UNTIL T=LL;            05884240
                   STATABLE[NT1]:=(*P(DUP))&STATABLE[LL][40:40:8];      05884250
                   STATABLE[LL]:=0;                                     05884260
              END ELSE                                                  05884270
              STATABLE[LL].DIALEDUP:=0;                                 05884300
              SYSDISKIO(0,-LL,40 INX A);                                05884400
              T:=DIRECTORYSEARCH(T1,SCH,8);%DELETE DIR ENTRY            05884500
              N1:=M[T INX 2]; N2:=M[T INX 5];                           05884600
              FORGETDISK; FORGETSPACE(T);                               05884700
              IF (IO AND IOMASK)=0 THEN SLEEP([IO],IOMASK);             05884800
          FORGETSPACE(DIRECTORYSEARCH(N2,N1,12));                       05884900
              IF (T:=DIRECTORYSEARCH(N2,N1,4)) NEQ 0 THEN               05885000
              BEGIN DISKWAIT(-A.[CF],30,(T1:=M[T INX 10]));             05885100
                   STREAM(A); 9(DS:=8 LIT "  ");                        05885200
                   DISKWAIT(A.[CF],30,T1); T1:=NR-1; FORGETSPACE(A);    05885300
                   A.[CF]:=T; A[7]:=T1; A[5]:=A[6]:=0;                  05885400
                   T1:=A[1]; A[1]:=A[8]; KRUNCHER(A); A[1]:=T1;     %R7405885450
                   HEADERUNLOCK(N2,N1,T);                               05885500
              END ELSE FORGETSPACE(A);                                  05885600
              ADR:=0;                                                   05885700
              IF FRSTSCHED NEQ SCHEDNUM THEN GO TO INIT;                05885800
              GO TO EXIT;                                               05885900
    %  END TERMINATE A RUNNING TASK                                     05886000
    REMOVIT::                                                           05886100
    %  TERMINATE A SCHEDULED TASK                                       05886200
    %    OR LINK IT IN FRONT (XS)                                       05886300
              IF SCHEDTOG THEN SLEEP([SCHEDWRD],-0);                    05886400
              SCHEDWRD:=ABS(SCHEDWRD);                                  05886500
              T1:=ADR INX FILE;                                         05886600
              IF (T:=DIRECTORYSEARCH(T1,-SCH,4)) NEQ 0 THEN             05886700
              BEGIN                                                     05886800
                   IF (N1:=ADR.[16:2])NEQ 3 THEN % ES OR XS KEYIN       05886900
                   BEGIN; STREAM(N1,T1,N2:=N2:=SPACE(10));              05887000
                        BEGIN DS:=6LIT" TASK#"; SI:=LOC T1;             05887100
                             SI:=SI+5; DS:=3 CHR;                       05887200
                             N1(DS:=7LIT" RESET~"; JUMP OUT TO L);      05887300
                             DS:=9LIT" REMOVED~";                       05887400
                   L:   END;                                            05887500
                        SPOUT(N2);                                      05887600
                        IF N1 THEN % XS -- RELINK IT                    05887700
                        BEGIN M[T+6]:=NABS(*P(DUP));                %09805887800
                             IF T1.[CF]=FRSTSCHED THEN                  05887900
                                  HEADERUNLOCK(T1,SCH,T)                05888000
                             ELSE                                       05888100
                             BEGIN DELINK; M[T+28]:=0;                  05888200
                                  M[T+29]:=T2:=FRSTSCHED INX FILE;      05888300
                                  HEADERUNLOCK(T1,SCH,T);               05888400
                                  FRSTSCHED:=T1; CHANGEDATE(0);         05888500
                                  IF (T:=DIRECTORYSEARCH(T2,SCH,4))!0   05888600
                                  THEN BEGIN M[T+28]:=T1;               05888700
                                       HEADERUNLOCK(T2,SCH,T);          05888800
                                  END;                                  05888900
                             END;                                       05889000
                             ADR:=0;                                    05889100
                             GO TO INIT1;                               05889200
                        END;                                            05889300
                   END;                                                 05889400
                   DELINK;                                              05889500
                   IF (N1:=DIRECTORYSEARCH(M[T+5],M[T+2],4))NEQ 0 THEN  05889600
                   BEGIN IF (M[N1+7] OR M[N1+4].[36:6])=0 THEN          05889700
                        BEGIN; STREAM(X:=ADR.[17:1],N2:=N2:=SPACE(10)); 05889800
                             BEGIN DS:=19 LIT"TASK TERMINATED BY ";     05889900
                                  X(DS:=8 LIT"USER    ";JUMP OUT TO L); 05890000
                                  DS:=8 LIT"OPERATOR";                  05890100
                             L:   DS:=53 LIT"    ";                     05890200
                             END;                                       05890300
                             DISKWAIT(N2,10,M[N1+10]);                  05890400
                             FORGETSPACE(N2);                           05890500
                        END;                                            05890600
                        M[N1+4].[36:6]:=TYPEINFO;                       05890700
                        M[N1+5]:=M[N1+6]:=0;                            05890800
                        HEADERUNLOCK(M[T+5],M[T+2],N1);                 05890900
                   END;                                                 05891000
                   FORGETSPACE(DIRECTORYSEARCH(T1,SCH,8));              05891100
                   FORGETDISK; FORGETSPACE(T);                          05891200
              END                                                       05891300
              ELSE IF (N1:=ADR.[16:2])NEQ 3 THEN % ES OR XS KEYIN       05891400
              BEGIN; STREAM(N1,T1,Z:=T.[1:1],N2:=N2:=SPACE(10));        05891500
                   BEGIN DS:=6LIT".TASK#"; SI:=LOC T1;                  05891600
                        SI:=SI+5; DS:=3CHR; DS:=5LIT" NOT ";            05891700
                        N1(DS:=5LIT"RESET"; JUMP OUT TO L);             05891800
                        DS:=7LIT"REMOVED";                              05891900
                   L:   Z(DS:=9LIT"(IN USE)~"; JUMP OUT TO L1);         05892000
                        DS:=14LIT"(NOT ON DISK)~";                      05892100
                   L1:                                                  05892200
                   END;                                                 05892300
                   SPOUT(N2);                                           05892400
              END;                                                      05892500
    %  END TERMINATING OF A SCHEDULED TASK                              05892600
    EXITR:: SCHEDWRD:=NABS(SCHEDWRD);                                   05892700
    EXIT::  KILL([RCW] INX NOT 2);                                      05892800
END SCHEDIDLE;                                                          05892900
PROCEDURE SCHEDIO(NUM,TYPE,ADR); %%IF FORQUED THEN ONLY 1 PARAM.        05893000
VALUE ADR,NUM,TYPE; REAL ADR,NUM,TYPE;                                  05893100
BEGIN                                                                   05893200
    REAL RCW=+0;                                                        05893300
    ARRAY A[*];                                                         05893400
    REAL LL,T;                                                          05893500
    LABEL RDSTRT, FRSTRD, RD, WRITAGN, UNLOCKIT, EXIT;                  05893600
    DEFINE PT=A[30]#                                                    05893700
          ,IO=A[31]#                                                    05893800
       ,DELTA=A[32]#                                                    05893900
           ,N=A[33]#                                                    05894000
           ,S=A[34]#                                                    05894100
           ,R=A[35]#                                                    05894200
           ,H=A[36]#                                                    05894300
          ,NR=A[37]#                                                    05894400
          ,MR=A[38]#                                                    05894500
       ;                                                                05894600
                                                                        05894700
         IF (LL:=ADR.[FF])=0 THEN                                       05894800
         BEGIN LL:=ADR.[CF]; ADR:=0; GO TO FRSTRD END;                  05894900
         IF SCHEND[LL] THEN P(XIT);                                     05895000
         A:=[M[SEQARRAY[LL]]]&80[8:38:10];                              05895100
         IF ADR.[1:1] THEN %INPUT                                       05895200
    % READ                                                              05895300
         BEGIN A:=40 INX A; GO TO RD;                                   05895400
$INCLUDE 05895451, IF DCP;                                              05895449
    RDSTRT::  IF (LL:=STATABLE[LL].[40:8])=0 THEN GO TO EXIT;           05895450
$OMIT 05895501, IF DCP;                                                 05895499
    RDSTRT::  IF NOT SCHEDLINE[LL:=LL+1] THEN GO TO EXIT;               05895500
              IF STATABLE[LL].DIALEDUP THEN                             05895600
              IF SEQARRAY[LL].[1:2]=2 THEN                              05895700
              BEGIN SEQARRAY[LL].[1:1]:=LOGLINE:=0;                     05895800
    FRSTRD::       A:=[M[SEQARRAY[LL] INX 40]]&80[8:38:10];             05895900
                   GO TO RD;                                            05896000
              END;                                                      05896100
              GO TO RDSTRT;                                             05896200
    RD:       IF NOT(DELTA.[1:1]) THEN SLEEP([DELTA],-0);               05896300
              DELTA:=ABS(*P(DUP));                                      05896400
              IF (IO AND IOMASK)=0 THEN SLEEP([IO],IOMASK);             05896500
              IF (NR:=NR+1) GEQ MR THEN %EOF                            05896600
              IF (ADR:=ADR.[CF])=0 THEN %C&E REQUEST                    05896700
                   IF NR GEQ MR+2 THEN                                  05896800
                        A[DELTA]:=@2270253737373737 %BYE.....           05896900
                   ELSE %SEND PLAIN LEFT ARROW FIRST IN CASE            05897000
                        A[DELTA]:=NOT 0 %WE ARE IN SEQ MODE...          05897100
              ELSE BEGIN                                                05897200
                   DELTA:=NABS(*P(DUP));  TERMINATE(P1MIX);             05897300
                   TERMINALMESSAGE(48)                                  05897400
              END;                                                      05897500
              A[DELTA+9]:=(NOT 0);                                      05897600
              IF ADR NEQ 0 THEN %NORMAL STATE PROGRAM                   05897605
              IF NUM GTR 0 THEN %QUESTION MARK REQUIRED                 05897610
              BEGIN T:=@1437000000000000;                               05897612
                   SCHEDIO(2,0&1[CTF],([T]INX(0&LL[CTF])));             05897614
              END ELSE NUM:=ABS(NUM);                                   05897616
              SCHEDIO(72,1,(A INX DELTA)&LL[CTF]); %ENTER IP MSG ON OP  05897700
              IF ADR=0 THEN %C&E REQUEST                                05897800
              BEGIN ADR:=GETAREA(2);                                    05897900
                   M[ADR]:=0&LL[10:40:8]&9[2:44:4];   %SIZE AND MESSEND 05898000
$INCLUDE 05898051, IF DCP;                                              05898049
                   STREAM(SS:=[A[DELTA]]:DD:=(ADR+2)&7[CTF]);           05898050
$OMIT 05898101, IF DCP;                                                 05898099
                   STREAM(SS:=[A[DELTA]],DD:=ADR&7[CTF]);               05898100
                   BEGIN SI:=SS; DI:=DI+1;                              05898200
               L:       IF SC=LEFTARROW THEN                            05898300
                        BEGIN DI:=DD; DI:=DI+1;                         05898400
$OMIT 05898451, IF DCP;                                                 05898449
                             DS:=CHR;                                   05898450
                        END ELSE                                        05898500
                        BEGIN IF SC NEQ " " THEN DD:=DI;                05898600
                             DS:=CHR; GO TO L;                          05898700
                        END;                                            05898800
$INCLUDE 05898901, IF DCP;                                              05898819
                        SS:=DI;                                         05898820
                   END;                                                 05898840
                   M[ADR+1]:=P(XCH,DUP).[30:3]&(P(XCH)-ADR-3)[30:33:15];05898860
                   M[ADR+2]:=0;                                         05898880
                   GIVEAWAY(ADR,4);                                     05898900
$OMIT 05899001, IF DCP;                                                 05898949
                   END;                                                 05898950
                   GIVEAWAY(ADR);                                       05899000
                   ADR:=0;                                              05899100
              END ELSE %NOT C&E REQUEST                                 05899200
              BEGIN STREAM(NN:=IF (T:=NUM GTR 9) THEN 9 ELSE NUM,       05899300
                     T:=IF T THEN NUM-9 ELSE 0, SS:=(A INX DELTA),      05899400
                     ADR:=ADR.[CF]);                                    05899500
                   BEGIN SI:=SS; DS:=NN WDS; T(DS:=8 LIT" ") END;       05899600
              END;                                                      05899700
              IF (DELTA:=DELTA+10)=30 THEN%END OF DISK SEGMENT          05899800
              BEGIN IO:=DELTA:=0;                                       05899900
                   IF (N:=N+1) MOD S = 0 THEN %NEW ROW                  05900000
                   BEGIN DISKWAIT(-A.[CF],30,H);                        05900100
                        R:=A[(N DIV S)+10]-N;                           05900200
                   END;                                                 05900300
                   DISKIO(IO,(1-A.[CF]),30,R+N)                         05900400
              END;                                                      05900500
              DELTA:=NABS(*P(DUP));                                     05900600
              IF ADR=0 THEN GO TO RDSTRT;                               05900700
              P(XIT);                                                   05900800
         END;                                                           05900900
    %  WRITE                                                            05901000
         IF TYPE.[1:1] THEN P(XIT); %DONT WRITE 1/2ASCII                05901100
         IF NOT(DELTA.[1:1]) THEN SLEEP([DELTA],-0);                    05901200
         DELTA:=ABS(*P(DUP));                                           05901300
         TYPE.[FF]:=TYPE.[FF]-1; %SET UP CR CODE                        05901400
    WRITAGN:  IF NR GEQ MR THEN GO UNLOCKIT;     % DONT WRITE IF FULL   05901500
         IF (IO AND IOMASK)=0 THEN SLEEP([IO],IOMASK);                  05901550
         IF (DELTA)=0 THEN                                              05901600
         BEGIN; STREAM(A:=A.[CF]);                                      05901700
              BEGIN DS:=8 LIT" "; SI:=A; DS:=29 WDS END;                05901800
         END;                                                           05901900
         NR:=NR+1; T:=A INX DELTA;                                      05902000
         STREAM(NN:=NR, T1:=T+9);                                       05902100
         BEGIN SI:=LOC NN; DS:=8 DEC; END;                              05902200
         IF NR+10=MR THEN    % CONSIDER THE FILE FULL                   05902300
         BEGIN                                                          05902400
              STREAM(T); DS:=22 LIT"**END OF SCHEDULE TANK";            05902500
              IF A[77] LSS A[78] THEN A[77]:=A[78];  % FORCE EOF ON INPT05902600
              IF P1MIX GTR 0 AND P1MIX!CANDYINX THEN                    05902700
              IF DAT[P1MIX].NDSABLE THEN BREAK[LL]:=1 ELSE              05902800
                TERMINATE(P1MIX&67[CTF]);                               05902900
         END                                                            05903000
         ELSE BEGIN                                                     05903100
              IF NUM GEQ (72-PT) THEN NUM:=72-PT; ADR:=ADR.[CF];        05903200
              IF NOT(TYPE.[FF]) THEN %NO CARRIAGE RETURN                05903208
              STREAM(N1:=NUM.[41:1], N2:=NUM,                           05903210
                     ADR:=ADR INX (NUM.[33:12]&NUM[30:45:3]));          05903212
              BEGIN SI:=ADR; SI:=SI-1;                                  05903214
                   IF SC=" " THEN                                       05903216
                   BEGIN  N2(IF SC NEQ " " THEN JUMP OUT TO L;          05903218
                                SI:=SI-1);                              05903220
                        N1(2(32(IF SC NEQ " " THEN JUMP OUT 3 TO L;     05903222
                                SI:=SI-1)));                            05903224
                   L:   SI:=SI+1; ADR:=SI; DI:=ADR;                     05903226
                        DS:=LIT LEFTARROW;                              05903228
                   END;                                                 05903230
              END;                                                      05903232
              T:=(T+PT.[40:5])&PT[30:45:3];                             05903300
              DO BEGIN;                                                 05903400
                   STREAM(B:=0,N1:=0,ADR,T:N2:=IF NUM GTR 63 THEN 63    05903500
                             ELSE NUM);                                 05903600
                   BEGIN SI:=ADR; DI:=T;                                05903700
                        N2(IF SC=LEFTARROW THEN JUMP OUT TO L1;         05903800
                            IF SC NEQ " " THEN DS:=CHR                  05903900
                            ELSE BEGIN SI:=SI+1; DI:=DI+1 END;          05903905
                            TALLY:=TALLY+1);                            05903910
                        GO TO L2;                                       05904000
              L1:       N1:=TALLY; ADR:=SI; T:=DI; TALLY:=1;            05904100
                        B:=TALLY; GO TO L3;                             05904200
              L2:       N1:=TALLY; ADR:=SI; T:=DI;                      05904300
              L3:  END;                                                 05904400
                   T:=P; ADR:=P; PT:=P(XCH)+PT; NUM:=NUM-63;            05904500
              END UNTIL (NUM LEQ 0) OR P;                               05904600
            IF (TYPE.[CF])=0 THEN                                       05904700
              BEGIN NR:=NR-1; DELTA.[FF]:=@100; END                     05904800
            ELSE IF (DELTA:=DELTA INX 10)=30 THEN                       05904900
            BEGIN IO:=DELTA:=0;                                         05905000
              DISKIO(IO,A.[CF]-1,30,R+N);                               05905100
              IF ((N:=N+1) MOD S)=0 THEN% END OF THE ROW                05905200
              BEGIN R:=GETUSERDISK(-S)-N;                               05905300
                   SLEEP([IO],IOMASK);                                  05905400
                   LOCKDIRECTORY;                                       05905410
                   DISKWAIT(-A.[CF],30,H);                              05905500
                   A[(N DIV S)+10]:=R+N;                                05905600
                   DISKIO(IO,A.[CF]-1,30,H);                            05905700
                   UNLOCKDIRECTORY;                                     05905710
              END;                                                      05905800
            END;                                                        05905900
            NUM:=0;                                                     05906000
            IF TYPE.[FF] THEN PT:=0; %CR                                05906100
            IF (TYPE:=TYPE.[CF]-1) GTR 0 THEN GO TO WRITAGN;            05906200
         END;                                                           05906300
    UNLOCKIT:                                                           05906350
         DELTA:=NABS(*P(DUP));                                          05906400
         P(XIT);                                                        05906500
    EXIT:: KILL([RCW] INX NOT 2);                                       05906600
END SCHEDIO;                                                            05906700
PROCEDURE DKBUSINESS(BUFF); VALUE BUFF; REAL BUFF;                      05950000
BEGIN                                                                   05950200
    REAL RCW=+0,                                                        05950400
         MID=RCW+1,                                                     05950600
         FID=MID+1,                                                     05950800
         TMID=FID+1,                                                    05950900
         A=TMID+1,                                                      05951000
         B=A+1;                                                         05951200
    INTEGER N=B+1;                                                      05951400
    ARRAY HD=N+1[*];                                                    05951600
    BOOLEAN RDT=HD+1;                                                   05951700
    INTEGER C=RDT+1,D=C+1,I=D+1,J=I+1,R=J+1,S=R+1,                      05951800
            LA=S+1,SA1=NT2,                                             05951900
            H=NT7,K=NT6,L=NT5,G=NT4,T=NT3,Q=JUNK;                       05952000
    REAL E=LA+1;                                                        05952200
    ARRAY UT=HD[*]; INTEGER AVS=E+1; DEFINE U=AVTABLE#;                 05952400
    INTEGER SLEEPER=AVS+1;                                              05952500
    LABEL V,W,X,Y,Z,AZ,BZ,CZ,DZ,INUSE,EXIT;                             05952600
% * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     05952800
    P(0,0,0,0,BUFF,DUP); BUFF:=P.[15:15]-1; P(0,0,B LSS 0);             05953200
    IF B.[CF]=0 THEN% MAKE RESERVE/DISK                                 05953400
    BEGIN MID:="RESERVE"; FID:="DISK   ";                               05953600
         IF (A:=DIRECTORYSEARCH(-MID,FID,5))!0 THEN                     05953800
         BEGIN STREAM(BUFF);                                            05954000
              DS:=30LIT" RESERVE/DISK ALREADY PRESENT~";                05954200
              GO TO EXIT;                                               05954400
         END;                                                           05954600
         IF (A~GETUSERDISK((N~RESERVEDISKSIZE)&1[2:47:1]))=0 THEN       05954800
         BEGIN STREAM(BUFF);                                            05955000
              DS:=32LIT"**NO USER DISK FOR RESERVE/DISK~";              05955200
              GO TO EXIT;                                               05955400
         END;                                                           05955600
         GO TO CZ;                                                      05955800
    END;                                                                05956000
$ INCLUDE 05956101, IF SHAREDISK;                                       05956099
    GO TO EXIT;                                                         05956100
$ OMIT 05976001, IF SHAREDISK;                                          05956199
    P(0,0,0,0,0,0,0,0,0);                                               05956200
    IF RDT THEN                                                         05956250
    BEGIN P(B); A:=M[BUFF INX 0]; N:=M[BUFF INX 1]; END ELSE            05956300
    BEGIN                                                               05956350
    STREAM(B,N:=[N],A:=[A]);                                            05956400
    BEGIN SI:=B;                                                        05956600
    L1:  IF SC=" " THEN BEGIN SI:=SI+1; GO TO L1 END;                   05956800
    L2:  IF SC GEQ "0" THEN IF SC LEQ "9" THEN                          05957000
         BEGIN TALLY:=TALLY+1; SI:=SI+1; GO TO L2 END;                  05957200
         B:=TALLY; SI:=SI-B; DS:=B OCT;                                 05957400
    L3:  IF SC LSS "0" THEN IF SC="~" THEN GO TO X ELSE                 05957600
         BEGIN SI:=SI+1; GO TO L3 END;                                  05957800
         DI:=N; TALLY:=0; GO TO L2;                                     05958000
    X:END;                                                              05958200
    IF A=0 THEN GO TO EXIT;                                             05958400
    END;                                                                05958500
    STREAM(A,D:=[FID]);                                                 05958600
    BEGIN SI:=LOC A; DS:=8 DEC; END;                                    05958800
    IF (J:=A DIV 1000000) GEQ NEUP.NEUF OR A LSS DIRECTORYTOP+4 THEN    05959000
V:  BEGIN STREAM(FID,BUFF);                                             05959200
         BEGIN DS:=22LIT" INVALID DISK ADDRESS ";                       05959400
              SI:=LOC FID; DS:=8CHR; DS:=LIT"~";                        05959600
              DI:=DI-9; DS:=7 FILL;                                     05959800
         END;                                                           05960000
         GO TO EXIT;                                                    05960200
    END;                                                                05960400
    IF WAITIO([FID]INX@100000000,@64,18+FID.[5:1]).[42:1] THEN GO TO V; 05960600
    SLEEP([TOGLE],USERDISKMASK); USERDISKREADY:=FALSE;                  05960700
    N:=N+(N=0); J:=J+1;                                                 05960800
BZ: D:=(I:=(E:=U[J]).STARTWRD) MOD 30;                                  05961000
    AVS:=30-(S:=(C:=E AND NUMENTM)+D)MOD 30+S;                          05961200
    FIXARRAY(UT,R,AVS); DISKWAIT(-R,AVS,B:=I DIV 30+USERDISKBOTTOM);    05961400
    K:=S; L:=D; S:=I+C;                                                 05961600
    G:=I-(NT2:=(P(U[J-1],DUP) AND NUMENTM)+P(XCH).STARTWRD);            05961800
    S:=U[J+1].STARTWRD-S; H:=K:=K-1; IF UT[T:=L].DEND GTR A THEN GO X;  05962000
W:  IF UT[T~(H+L+1) DIV 2].DEND > A THEN IF UT[H~T-1].DEND > A THEN GO W05962200
    ELSE ELSE IF UT[T~T+1].DEND { A THEN BEGIN L~T+1; GO W END;         05962400
X:  IF A GEQ L:=(H:=UT[T].DEND)-(Q:=UT[T].DSIZE) THEN                   05962600
    IF (LA:=(A+N)) LEQ H THEN GO AZ%AREA AVAILABLE                      05962700
    ELSE IF LA LEQ SA1:=(UT[T+1].DEND-UT[T+1].DSIZE) THEN               05962800
    N:=LA-A:=H ELSE N:=SA1-A:=H ELSE IF (LA:=A+N) GTR L THEN            05962900
    N:=L-A ELSE RDT:=RDT OR @100000;                                    05963000
    GO INUSE;                                                           05963100
Y:  TMID:=IF RDT THEN "DKTEST " ELSE "BADISK ";                         05963800
    STREAM(TMID,FID,N,MID,B,BUFF);                                      05964000
    BEGIN DS:=LIT "."; SI:=LOC TMID; SI:=SI+1; DS:=7 CHR;               05964200
         DS:=LIT "/"; SI:=SI+1; DS:=7 CHR;                              05964400
         DS:=13 LIT " NOT CREATED("; SI:=SI+8; SKIP SB;                 05964500
         IF SB THEN ELSE                                                05964600
         BEGIN SI:=LOC N; DS:=7 DEC; N:=DI; DI:=DI-7; DS:=7 FILL;       05964800
              DI:=N; DS:=5 LIT " SEGS"; SI:=SI+1;                       05964900
         END; DS:=11 LIT " IN USE BY "; DS:=7 CHR; DS:=LIT"/";          05965000
         SI:=SI+1; DS:=7 CHR;                                           05965200
         DS:=2 LIT")~";                                                 05965400
    END;                                                                05965600
    FORGETSPACE(R);                                                     05966100
    GO TO DZ;                                                           05966200
INUSE: FORGETSPACE(R);                                                  05966400
    FIXARRAY(UT,R,480);                                                 05966600
    LOCKDIRECTORY;                                                      05966800
    FOR J:=DIRECTORYTOP+4 STEP 16 WHILE TRUE DO                         05967000
    BEGIN DISKWAIT(-R,480,J);                                           05967200
         FOR I:=14 STEP -1 UNTIL 0 DO                                   05967400
         BEGIN E:=UT[450+2|I];                                          05967600
              IF(E EQV @114)=NOT 0 THEN                                 05967800
              BEGIN MID:="SYSTEM "; B:=FID; GO Z; END;                  05967900
              IF (E EQV @14) NEQ NOT 0 THEN                             05968000
              BEGIN B:=UT[30|I+9] AND 31;                               05968200
                   FOR K:=1 STEP 1 UNTIL B DO                           05968400
                        IF (C:=UT[30|I+9+K])NEQ 0 THEN                  05968600
                        IF A GEQ C THEN IF A LSS                        05968800
                        SA1:=(C+D:=UT[30|I+8]) THEN                     05968900
                        BEGIN MID:=E&((LA LEQ SA1) AND                  05969000
                             (RDT.[18:15]))[1:47:1];                    05969100
                             IF A+N GTR SA1 THEN N~SA1-A;               05969150
                             B:=UT[451+2|I];                            05969200
                             GO TO Z;                                   05969400
                        END;                                            05969600
              END;                                                      05969800
         END;                                                           05970000
    END;                                                                05970200
Z:  UNLOCKDIRECTORY;                                                    05970400
    GO TO Y;                                                            05970600
AZ: IF A NEQ L AND LA NEQ H THEN                                        05970800
    BEGIN IF S=0 THEN                                                   05971000
         BEGIN IF G=0 OR D=0 THEN                                       05971200
              BEGIN USERDISKSPECIALCASE(2,E,UT,J); GO TO BZ END;        05971400
              S:=IF P((G+1) DIV 2,DUP) > D THEN P(DEL,D) ELSE P;        05971600
              U[J].STARTWRD:=I-S; G:=D-S; K:=G+C-1;                     05971800
              MOVE(C,[UT[D]],[UT[G]]); T:=T-S;                          05972000
         END;                                                           05972200
         FOR G:=K STEP -1 UNTIL T DO UT[G+1]:=UT[G];                    05972400
         UT[T]:=A&(A-L)[TODSIZE];                                       05972600
         UT[T+1]:=H&(H-LA)[TODSIZE];                                    05972800
         C:=C+1;                                                        05973000
    END ELSE                                                            05973200
    IF A=L AND LA=H THEN                                                05973400
    BEGIN C:=C-1; MOVE(K-T,[UT[T+1]],[UT[T]]); K:=K-1 END               05973600
    ELSE UT[T]:=(IF A=L THEN H ELSE A)&(Q-N)[TODSIZE];                  05973800
    U[J].NUMENT:=C;                                                     05974000
    IF Q=U[J].MAXSIZ THEN                                               05974200
    BEGIN Q:=UT[H:=K-C+1].DSIZE;                                        05974400
         FOR H:=H STEP 1 UNTIL K DO                                     05974600
              IF P(UT[H].DSIZE,DUP) GTR Q THEN Q:=P ELSE P(DEL);        05974800
         U[J].MAXSIZ:=Q;                                                05975000
    END;                                                                05975200
    MID:=IF RDT THEN "DKTEST " ELSE "BADISK ";                          05975400
    DISKWAIT(R,AVS,B);                                                  05975600
    FORGETSPACE(R);                                                     05975800
CZ: FIXARRAY(HD,B,30);                                                  05976200
    MOVE(30,HD-1,HD);                                                   05976400
    HD[0]:=@3600036000101;                                              05976600
    STREAM(DATE,H:=HD INX 3);                                           05976800
    BEGIN SI:=LOC DATE; DS:=8OCT; DI:=H; DS:=2LIT"+#";                  05977000
         SI:=H; SI:=SI+5; DS:=3 CHR;                                    05977200
    END;                                                                05977400
    HD[7]:=HD[8]:=N;                                                    05977600
    HD[9]:=1;                                                           05977700
    HD[10]:=A;                                                          05977800
    ENTERUSERFILE(MID,FID,HD.[CF]-1);                                   05978000
    STREAM(MID,FID,N,BUFF);                                             05978200
    BEGIN SI:=LOC MID; DS:=1 LIT " "; SI:=SI+1; DS:=7 CHR;              05978400
         DS:=1 LIT "/"; SI:=SI+1; DS:=7 CHR; DS:=6 LIT " SEGS=";        05978600
         DS:=8 DEC; DS:=9 LIT " CREATED~"; DI:=DI-17; DS:=7 FILL;       05978800
    END;                                                                05979000
    FORGETSPACE(B);                                                     05979200
DZ: USERDISKREADY:=TRUE;                                                05979300
$OMIT 05979401, IF SHAREDISK;                                           05979399
EXIT: IF RDT THEN M[SLEEPER INX 0]:=1 ELSE SPOUT(BUFF);                 05979400
$INCLUDE 05979451, IF SHAREDISK;                                        05979449
EXIT: IF RDT THEN M[SLEEPER INX 0]:=3 ELSE SPOUT(BUFF);                 05979450
    BUFF:=0; KILL([BUFF] INX NOT 1);                                    05979500
END;                                                                    05979600
 SAVE PROCEDURE DISKIO(LOCIOD,CORE,SIZE,DISK);%                         06000000
         VALUE CORE,SIZE,DISK;%                                         06001000
         REAL LOCIOD;%                                                  06002000
         INTEGER CORE,SIZE,DISK;%                                       06003000
         BEGIN REAL IOD=+1;%                                            06004000
REAL RCW =+0;%                                                          06005000
$ INCLUDE 06005701, IF DEBUGGING;                                       06005099
              P(CORE&SIZE[8:38:10]);%                                   06006000
              IF DISK < 0 THEN%                                         06007000
              BEGIN NT1 := 0;                                           06007500
                   P(P(1,XCH,INX)&((((SIZE ~ DISK%                      06008000
                     <(-1000))+1)|1001+DISK)|30)[18:33:15]&CORE[2:1:1]% 06009000
                        &(SIZE+1)[4:46:2])%                             06010000
              END                                                       06010500
              ELSE BEGIN P(P&((ABS(NT1~SIZE)+29) DIV 30+@1000)          06011000
                             [18:33:15]&CORE[24:1:1]&3[5:46:2]);%       06012000
$ INCLUDE 06012501, IF SHAREDISK;                                       06012499
                        DISK.[1:1]:=SIZE.[1:1];                         06012500
                        STREAM(DISK,CORE);%                             06013000
                             BEGIN SI ~ LOC DISK; DS ~ 8 DEC END;%      06014000
                        SIZE ~ 2;%                                      06015000
                   END;%                                                06016000
              IOREQUEST(NABS(IOD)&@377[25:40:8],IOD,[LOCIOD]&%          06017000
                   NT1[10:2:1]&                                         06017500
                   (SIZE+16)[12:42:6]);%                                06018000
              LOCIOD ~ 0;%                                              06019000
         END DISKIO;%                                                   06020000
 PROCEDURE FORGETESPDISK(S); VALUE S; REAL S; FORWARD;                  06020500
 REAL PROCEDURE GETESPDISK;%                                            06021000
         BEGIN REAL T=NT1;                                              06022000
              IF ESPCOUNT=0 THEN                                        06022100
              BEGIN                                                     06022200
                   STREAM(D:=T:=SPACE(2));                              06022300
                        DS:=12 LIT"NO ESPDISK~";                        06022400
                   SPOUT(T);                                            06022500
                   SLEEP([ESPCOUNT],NOT 0);                             06022600
              END;                                                      06022700
              STREAM(T~0,A~ESPTAB:X~0);                                 06023000
              BEGIN SI~A;                                               06024000
              L1:  IF SC=""" THEN BEGIN SI~SI+1; GO TO L1 END;          06025000
                   A~SI; DI~A;                                          06026000
              L2:  IF SB THEN                                           06027000
                   BEGIN TALLY~TALLY+1; SKIP SB; SKIP DB; GO TO L2 END; 06028000
                   T~TALLY; DS~SET;                                     06029000
              END;                                                      06030000
              GETESPDISK:=((P(DUP).[CF]-ESPTAB)|8                       06031000
              +P(XCH).[30:3])|6+P+ESPDISKBOTTOM;                        06032000
              ESPCOUNT:=ESPCOUNT-1;                                     06033000
         END;                                                           06035000
 PROCEDURE FORGETESPDISK(SEGMENT); VALUE SEGMENT; REAL SEGMENT;%        06036000
         BEGIN REAL S,T;                                                06037000
              IF SEGMENT LSS ESPDISKBOTTOM OR                           06037100
                   SEGMENT GTR ESPDISKTOP THEN                          06037200
              BEGIN S ~ FLAG(-"ESPDISK");  T ~ FLAG(-"ERROR.~");        06037300
                   S ~ WAITIO([SEGMENT] INX 2,0,25);                    06037400
                   SLEEP(0,0);                                          06037500
              END;                                                      06037600
              T:=(S:=(T:=SEGMENT-ESPDISKBOTTOM) DIV 6)|6-T;             06037700
              S~S.[30:15]&S[30:45:3]+ESPTAB;                            06038000
              STREAM(T,S); BEGIN SKIP T DB; DS~RESET END;               06038100
              ESPCOUNT~ESPCOUNT+1;                                      06038200
         END;%                                                          06045000
$ INCLUDE 06056001, IF DEBUGGING;                                       06045999
 PROCEDURE DISKBUG;%                                                    06046000
         BEGIN REAL T;%                                                 06047000
              ;STREAM(T~P(.DBADR),DBARRAY);                             06048000
              BEGIN DS := 20 LIT "DISKBUG...  TRY    ~";  DI := DI-4;   06048100
                   SI := LOC T;  SI := SI+6;  SKIP 3 SB;                06048200
                   3(DS := 3 RESET;                                     06048300
                     3(IF SB THEN DS:=SET ELSE DS:=RESET;  SKIP SB));   06048400
              END STREAMING;                                            06048500
              T ~ WAITIO(DBARRAY.[33:15],@377,25);%                     06049000
              DDT;%                                                     06050000
              WHILE DBADR ! 0 DO%                                       06051000
                   BEGIN DISKWAIT(-((DBARRAY INX 1)&DBADR[1:1:1]),      06052000
                                            30, ABS(DBADR));            06052100
                        DDT;%                                           06054000
                   END;%                                                06055000
         END;%                                                          06056000
$ INCLUDE 06056201, IF DFX OR SHAREDISK;                                06056099
 REAL LASTEU; COMMENT USED FOR ALLOCATING DISK FROM DIFFERENT EUS,  %DFX06056100
                IF POSSIBLE;                                        %DFX06056200
$ INCLUDE 06060001, IF SHAREDISK;                                       06057000
COMMENT CLEANOUT PERFORMS THE FOLLOWING TASKS:                          06057020
        1. REMOVES ALL CONTENTION BITS THAT WERE SET BY "SYS".          06057040
        2. UNLOCKS ALL ADDRESSES THAT WERE LOCKED BY "SYS".             06057060
        3. RETURNS ALL OF THE DISKSPACE THAT IS IN THE SCRATCHDIRECTORY 06057080
           OF THE SYSTEM THAT IS BEING CLEARED.                         06057100
        4. REMOVES ALL FILES THAT WERE BEING LOADED BY THE SYSTEM THAT  06057120
           IS BEING CLEARED.                                            06057140
        5. CLOSES ALL FILES THAT THE OFFENDING SYSTEM HAD OPENED.       06057160
        6. REMOVES ALL ENTRIES IN THE HOLDLIST THAT WERE MADE BY THE    06057180
           SYSTEM BEING CLEARED.                                        06057200
        7. WAKES UP ALL PROCESSES IN OTHER SYSTEMS THAT WERE WAITING    06057220
          FOR A FILE THAT WAS IN USE (BY ANY SYSTEM).                   06057240
       CLEANOUT IS CALLED WHEN THE KEYBOARD MESSAGE "CLSYN"             06057260
       IS ENTERED AND WHEN A SYSTEM IS HALT/LOADED AND                  06057280
       THERE ARE OTHER SYSTEMS RUNNING.                                 06057300
END COMMENT;                                                            06057320
PROCEDURE CLEANOUT(SYS);                                                06057340
    VALUE SYS; REAL SYS;                                                06057360
BEGIN                                                                   06057380
    REAL RCW=+0;                                                        06057390
    REAL I,J,K,F,N,B,PB;                                                06057400
    INTEGER T;                                                          06057420
    ARRAY NB[*],FH[*],BP[*];                                            06057440
    LABEL FOURMASK,NINEMASK,FOUND,QUIT;                                 06057460
    T:=@4060&SYS[30:46:2]; % CLEAR ALL CONTENTION BITS                  06057480
    P(WAITIO([T] INX @100000000,0,18),DEL);                             06057500
    T.[37:1]:=1; % UNLOCK ALL ADDRESSES                                 06057520
    P(WAITIO([T] INX @100000000,0,18),DEL);                             06057540
    NB:=[M[N:=SPACE(480)]]&480[8:38:10];                                06057560
    FH:=[M[F:=N+33]]&31[8:38:10];                                       06057580
    DISKWAIT(-F,-30,B~DIRECTORYTOP+1);                                  06057600
    IF (I:=FH[SYS].SLINK) NEQ 0 THEN                                    06057620
         BEGIN %CLEAN OUT SCRATCH DIRECTORY                             06057640
         DISKWAIT(-F,30,I) ;                                            06057660
         FH[1]:=J:=0 ;                                                  06057680
         DO IF J:=NOT J THEN SCRATCHCLEAN(FH,N-1,I)                     06057700
            ELSE SCRATCHCLEAN(NB,F-1,I)                                 06057720
         UNTIL I=0 ;                                                    06057740
         DISKWAIT(-F,30,B); FH[SYS]~0;                                  06057750
         END ;                                                          06057760
    DISKWAIT(F,-30,B);                                                  06057770
    LOCKDIRECTORY;                                                      06057800
    FOR I:=DIRECTORYTOP+4 STEP 16 WHILE TRUE DO                         06057820
    BEGIN                                                               06057840
         DISKWAIT(-N,480,I);                                            06057860
         FOR J:=478 STEP -2 UNTIL 450 DO                                06057880
         IF (NB[J] EQV @114)=NOT 0 THEN GO QUIT ELSE                    06057900
         IF (NB[J] EQV @14) NEQ NOT 0 THEN                              06057920
         BEGIN                                                          06057940
              F:=15|(J-450)+4; % NB[F] POINTS TO HEADER[4]              06057960
              IF NB[F].[1:1] AND NB[F].[4:2]=SYS AND NB[F].[12:4]=0 THEN06057980
              BEGIN   %   FILE MUST BE REMOVED FROM DIRECTORY           06058000
                   T:=SCRAMBLE(NB[J],NB[J+1]);                          06058060
                   BP:=[M[B:=SPACE(60)]]&60[8:38:10];                   06058080
                   DO                                                   06058100
                   BEGIN                                                06058120
                        DISKWAIT(-B,60,T);                              06058140
                        FOR K:=0 STEP 3 UNTIL 57 DO                     06058160
                            IF (BP[K] EQV NB[J])=NOT 0 THEN             06058180
                            IF (BP[K+1] EQV NB[J+1])=NOT 0 THEN         06058200
                        GO TO FOUND;                                    06058220
                   END                                                  06058240
                   UNTIL (T:=BP[2].[FF])=0;                             06058260
                   UNLOCKDIRECTORY;                                     06058280
                   T:="DIRERR~";                                        06058300
                   P(WAITIO([T],0,25),DEL);                             06058320
                   SLEEP(0,0);                                          06058340
FOUND:                                                                  06058360
                   BP[K]:=@14;                                          06058380
                   DISKWAIT(B,60,T);                                    06058400
                   NB[J]:=@14;                                          06058420
                   NB[J+1]:=NEXTSLOT;                                   06058440
                   NEXTSLOT:=BP[K+2];                                   06058460
                   FORGETSPACE(B);                                      06058480
                   IF NB[F].[2:1] THEN % FILE WAS BEING LOADED FROM TAPE06058500
                   FOR K:=F+6+NB[F+5].[43:5] STEP -1 UNTIL F+6 DO       06058520
                        IF NB[K]!0 THEN FORGETUSERDISK(NB[K],NB[K+4]);  06058540
              END ELSE                                                  06058560
              BEGIN % CLOSE ALL OPEN FILES                              06058580
                   IF NB[F].[2:1] THEN                                  06058600
                   IF NB[F].[4:2]=SYS THEN NB[F].[2:2]:=0;              06058620
                   P(SYS); ::P(.FOURMASK,+,LOD,NOT); B:=P;              06058640
                   NB[F]:=P(DUP,LOD) AND B;                             06058660
                   P(SYS); ::P(.NINEMASK,+,LOD,NOT); B:=P;              06058680
                   NB[F+5]:=P(DUP,LOD) AND B;                           06058700
                   IF SYS=SYSNO THEN                                    06058720
                   BEGIN                                                06058740
                        PBCOUNT~PBCOUNT+(((NB[J] EQV "PBD    ")=NOT 0   06058760
                             OR (NB[J] EQV "PUD    ")=NOT 0)            06058770
                             AND NB[J+1].[CF]=1);                       06058780
                        IF (NB[J] EQV "PRNPBT ")=NOT 0 AND              06058800
                             (NB[J+1] EQV "DISK   ")=NOT 0 THEN PB:=1;  06058820
                   END;                                                 06058840
              END;                                                      06058860
         END;                                                           06058880
         DISKWAIT(N,480,I);                                             06058900
    END;                                                                06058920
FOURMASK ::: @400437000000000, @400200760000000,                        06058940
             @400100017400000, @400040000370000;                        06058960
NINEMASK ::: @2107600000000000, @1040174000000000,                      06058980
             @ 400003700000000, @ 200000076000000;                      06059000
QUIT:  DISKWAIT(N,480,I);                                               06059020
    IF (I:=HOLDER.[FF])!0 THEN% REMOVE ALL ENTRIES FOR THIS SYSTEM      06059040
    BEGIN %   AND WAKE UP ALL OTHERS                                    06059060
         DISKWAIT(-N,I,HOLDER.[CF]);                                    06059080
         FOR J:=0 STEP 1 UNTIL I-1 DO                                   06059100
         IF NB[J].[2:2]=SYS THEN                                        06059120
         BEGIN % REMOVE ENTRY FOR SYSTEM BEING CLEARED                  06059140
              MOVE(I-J-1,[NB[J+1]],[NB[J]]);                            06059160
              I:=I-1;                                                   06059180
              J~J-1;                                                    06059190
         END ELSE                                                       06059200
         IF NB[J].[2:2]!SYSNO THEN NB[J]:=P(DUP,LOD,SSN) ELSE           06059220
         IF NB[J] GEQ FENCE THEN BRINGBACK(NB[J].[10:8]) ELSE           06059230
              M[NB[J].[FF]]:=1;                                         06059240
         IF I!0 THEN DISKWAIT(N,I,HOLDER.[CF]);                         06059260
         HOLDER.[FF]:=I;                                                06059280
    END;                                                                06059300
    UNLOCKDIRECTORY;                                                    06059320
    IF SYS=SYSNO THEN                                                   06059340
    BEGIN                                                               06059360
         IF NOT PB THEN AUTOPRINT:=0;                                   06059380
         IF PBCOUNT!0 AND NOT AUTOPRINT THEN                            06059400
         BEGIN                                                          06059420
              STREAM(PBCOUNT,D:=N);                                     06059440
              BEGIN DS:=11 LIT" THERE ARE"; D:=DI; SI:=LOC PBCOUNT;     06059460
                   DS:=4 DEC; DS:=18 LIT" PB FILES ON DISK~";           06059480
                   DI:=D; DS:=3 FILL                                    06059500
              END;                                                      06059520
              SPOUT(N);                                                 06059540
         END ELSE FORGETSPACE(N);                                       06059560
    END ELSE                                                            06059580
    BEGIN                                                               06059600
         DISKWAIT(-N,-30,0);                                            06059620
         NB[I:=13+5|SYS]:=NB[I+1]:=0;                                   06059640
         DISKWAIT(N,-30,0);                                             06059660
         STREAM(S:=SYS+17,N);                                           06059680
         BEGIN DS:=18 LIT"#SYSTEM   CLEARED~"; DI:=DI-10;               06059700
              SI:=LOC S; SI:=SI+7; DS:=CHR;                             06059720
         END;                                                           06059740
         SPOUT(N);                                                      06059760
         KILL([SYS] INX NOT 1);                                         06059780
    END;                                                                06059800
END;  %  OF PROCEDURE CLEANOUT                                          06059820
 SAVE PROCEDURE DISKWAIT(CORE,SIZE,DISK);                               06061500
         VALUE CORE,SIZE,DISK;                                          06062000
         REAL CORE,SIZE,DISK;                                           06063000
         BEGIN REAL T;                                                  06064000
              DISKIO(T, (ABS(CORE)-1)&CORE[1:1:1], SIZE, DISK);         06065000
              SLEEP([T],IOMASK);                                        06066000
         END;                                                           06067000
                                                                        06179000
REAL LOOKQ;                                                             06179200
ARRAY UNITCODE[*];                                                      06179300
 SAVE PROCEDURE INITIALIZE;   FORWARD;                                  06179400
 REAL ACTDATE=INITIALIZE;                                               06179500
 SAVE REAL PROCEDURE COREND;   FORWARD;                                 06179600
 REAL WEEKDAY=COREND;                                                   06179700
PROCEDURE USERDISKSPECIALCASE(Q,R,UT,J) ;                               06350000
VALUE Q,J;  REAL R,J;  INTEGER Q;  ARRAY UT[*] ;                        06350300
    BEGIN                                                               06350600
    REAL BUFF=Q,N=J,Z=UT,E=R ,WEWONTGO=R;                               06351000
$INCLUDE 06351056, IF SHAREDISK ;                                       06351050
    INTEGER NT=J ;                                                      06351053
    REAL NEU=AVS;  DEFINE U=UT #, UA=UT #, NEU1=NEU+J #, NEU2=NEU+NEU#; 06351055
$OMIT 06351106, IF SHAREDISK ;                                          06351100
    REAL NEU,NT;  ARRAY UA[*] ;                                         06351104
    DEFINE U=AVTABLE #,  AVS=B #,  NEU1=J-1 #,  NEU2=NT-1 #;            06351105
    INTEGER NT1,NT3,NT4,B ;                                             06351250
    LABEL L1,L2,L3,UP,PU,BD,WHY,M1,T10 ;                                06351500
    LABEL UNLOADER;                                                     06351600
    SWITCH SW~L1,L2,L3 ;                                                06351800
    IF Q!0 THEN GO SW[Q-1] ;                                            06352000
$INCLUDE 06352601,IF SHAREDISK ;                                        06352490
    IF (B:=J.[CF])>1023 THEN GO BD;  Q:=SPACE(B);  MOVE(J.[FF],R,Q) ;   06352500
    FORGETSPACE(R);  P(((R:=Q)&B[TOSIZE]) OR M,RTN) ;                   06352600
L1: BUFF~R;  Z~0;  USERDISKREADY~TRUE ;                                 06353500
         WEWONTGO := -1;                                                06353600
         IF N LEQ RESERVEDISKSIZE THEN       % CALL OUT THE RESERVES    06353605
         IF (Z:=DIRECTORYSEARCH("RESERVE","DISK   ",6))!0 THEN          06353610
         BEGIN FORGETSPACE(Z);                                          06353615
              WEWONTGO := -0;                                           06353620
              IF N GTR 0 THEN                                           06353625
              IF NOT (LIBMSG AND (LOGLINE.[33:7]=0 OR CANDYMESS)) THEN  06353630
              BEGIN STREAM(Z:=Z:=SPACE(3));                             06353640
                   DS:=23 LIT"**RESERVE DISK REMOVED~";                 06353650
                   SPOUT(Z);                                            06353660
              END;                                                      06353670
              GO TO UNLOADER;                                           06353680
         END OF RESERVE CALL UP;                                        06353690
         IF NOT N.[2:1] THEN                                            06353700
         BEGIN IF P1MIX!0 THEN                                          06354000
    WHY:      STREAM(J:=JARROW[P1MIX],P1MIX,N,BUFF);                    06355000
              BEGIN DS~14 LIT "#NO USER DISK:";                         06356000
                   SI~J;  SI~SI+1;  DS~7 CHR;                           06357000
                   DS~LIT "/";  SI~SI+1;  DS~7 CHR;                     06358000
                   SI~LOC P1MIX;  DS~LIT "=";  DS~2 DEC;                06359000
                   J:=DI; DI:=DI-2; DS:=FILL; DI:=J; DS:=LIT"-";        06359500
                   SI:=LOC N; DS:=8 DEC; DS:=7 LIT" SEGS.~";            06360000
                   DI:=DI-15; DS:=7 FILL;                               06360500
              END ELSE                                                  06361000
              STREAM(N,BUFF);                                           06361500
              BEGIN DS:=20 LIT"#NO USER DISK:MCP - ";                   06362000
                   SI:=LOC N; DS:=8 DEC;                                06362500
                   DS:=6 LIT" SEGS~";                                   06363000
                   DI:=DI-14; DS:=7 FILL;                               06363500
              END;                                                      06364000
              SPOUT(BUFF);                                              06364500
         END ELSE FORGETSPACE(BUFF);                                    06365000
    UNLOADER:                                                           06368000
         IF AUTOUNLD THEN                                               06369000
         BEGIN P(P1MIX); AUTOUNLD:=P1MIX:=0;                            06369500
              STREAM(ACTDATE,Z:=Z:=SPACE(10)+2);                        06370000
              BEGIN DS:=24 LIT"CC UNLOAD EXPIRED TO EXP";               06370500
                   SI~LOC ACTDATE; SI~SI+2; DS~4 CHR;                   06371000
                   DS:=9 LIT" =/=;END.";                                06371500
              END;                                                      06372000
              CCARD(Z&31[3:43:5]);                                      06372500
              P1MIX:=P;                                                 06373000
              IF N GEQ 0 THEN                                           06373500
              BEGIN STREAM(Z:=Z:=SPACE(10));                            06374000
                   DS:=18 LIT"19 AUTOUNLD RESET~";                      06375000
                   SPOUT(Z);                                            06376000
         END  END  AUTOMATIC UNLOADING;                                 06377000
         IF WEWONTGO THEN                                               06377100
         IF NOT N.[2:1] THEN                     % WAIT FOR DISK BUT    06377200
         BEGIN IF WEWONTGO.[1:1] THEN            % FIRST IF CANDE DOESNT06377300
              IF LOGLINE GTR 0 OR P1MIX=0 THEN       % KNOW, TELL HER   06377400
              BEGIN M[Z:=GETAREA(0)]:=(*P(DUP))&LOGLINE[CTF]&           06377500
                     15[18:41:7];                                       06377600
                   M[Z+1] := 0;                                         06377700
                   M[Z+2] := N;                                         06377800
                   QUEVENT(Z,CANDYINX);                                 06377900
                   WEWONTGO := @100001;                                 06378000
              END;                                                      06378100
              IF P1MIX=0 THEN                                           06378200
              BEGIN CLICK~CLOCK+P(RTR)+1800;%WAIT 30 SECS.              06378210
                    SLEEP(0,0);                                         06378220
              END ELSE                                                  06378230
              BEGIN PRTROW[P1MIX].[7:1]:=1;                             06378300
                   IF OUTWAIT(FALSE) THEN                               06378400
                   BEGIN BUFF:=SPACE(10);                               06378500
                        GO TO WHY;                                      06378600
                   END;                                                 06378700
                   PRTROW[P1MIX].[7:1] := 0;                            06378800
              END;                                                      06378900
              WEWONTGO.[CF] := 0;                                       06379000
         END WAITING FOR DISK TO SHOW UP;                               06379100
    P(XIT);                                                             06379200
L2: U[J]:=E; E:=NT4:=NEU:=(NT:=NEUP.NEUF)+2+(NT+1)DIV 2; P(NT); J:=1 ;  06380100
$OMIT 06380141, IF SHAREDISK ;                                          06380120
    NT1:=NT+NT+NT;  FORGETSPACE(UT);  FIXARRAY(UA,NT2,NT1);  E:=NT4:=0 ;06380140
UP: IF (NT4:=NT4 MOD 30) LSS (NT3:=(NT1:=U[J].STARTWRD) MOD 30)         06380150
    THEN NT4:=NT3 ;                                                     06380200
    IF (NT2:=(Q:=U[J] AND NUMENTM)+NT4) GTR 1023                        06380250
    OR ((Q+E+1) DIV 30+1-E DIV 30) GTR 34 THEN                          06380300
BD: BYBY("0DISK IS TOO CHECKERED...PLEASE COMPACT IT~",43) ;            06380350
    DISKWAIT(-((UA[NEU1]:=(UA[NEU2+J]:=SPACE(NT2))+NT4)-NT3),Q+NT3,     06380400
             USERDISKBOTTOM+NT1 DIV 30) ;                               06380450
$ INCLUDE 06380501, IF SHAREDISK ;                                      06380490
    IF J=1 THEN MOVE(NEU,[U[0]],B:=UA[NEU2+1]) ;                        06380500
$ OMIT 06380526, IF SHAREDISK ;                                         06380520
    IF J=1 THEN B:=UA.[CF]+NT+NT-1 ;                                    06380525
    M[B+J]:=U[J]&E[TOSTARTWRD] ;                                        06380550
    IF (NT1:=Q DIV 4) LSS AVDIFFMIN THEN NT1:=AVDIFFMIN ;               06380600
    IF (E:=(NT4:=Q+E)+NT1)>AVTMAX THEN GO BD ;                          06380650
    NT4:=IF E DIV 30!NT4 DIV 30 THEN 0 ELSE E ;                         06380675
    IF P(DUP) GEQ J:=J+1 THEN GO UP;  E:=E-NT1;  J:=1 ;                 06380700
PU: NT2:=(NT3:=P(M[B+J],DUP).STARTWRD)+NT5:=P(XCH) AND NUMENTM ;        06380750
    IF P(DUP)!J THEN IF (NT2-1)DIV 30=(NT4~M[B+J+1].STARTWRD)DIV 30 THEN06380800
    MOVE(NT1~NT2 MOD 30,UA[NEU1]+NT5-NT1,NT1~UA[NEU1+1]-NT4 MOD 30);    06380850
    DISKWAIT(UA[NEU1]-NT1~NT3 MOD 30,NT1+NT5,USERDISKBOTTOM+NT3 DIV 30);06380900
    IF J!1 THEN FORGETSPACE(UA[NEU2+J]) ;                               06380950
    IF P(DUP) GEQ J:=J+1 THEN GO PU ;                                   06381000
$OMIT 06381071, IF SHAREDISK ;                                          06381020
    MOVE(NT,[UA[NT+NT]],[AVTABLE[1]]) ;                                 06381070
$INCLUDE 06381081, IF SHAREDISK ;                                       06381075
    FORGETSPACE(B) ;                                                    06381080
    FORGETSPACE(UA) ;                                                   06381085
$INCLUDE 06381201, IF SHAREDISK ;                                       06381095
    Q:=SPACE(AVS:=(AVS:=IF E LSS AVSMIN THEN AVSMIN ELSE IF E GTR AVSMAX06381100
                  THEN AVSMAX ELSE E)+30-(IF (E:=AVS MOD 30)!0 THEN E   06381150
                  ELSE 30)) ;                                           06381155
    DISKWAIT(-Q,AVS,USERDISKBOTTOM) ;                                   06381200
    P(DEL,Q&AVS[TOSIZE] OR M,RTN) ;                                     06381250
L3: P(U[NEUP.NEUF+2+(Q:=J DIV P(M1)) DIV 2],IF Q THEN P.[8:20] ELSE     06381300
      P.[28:20]) ;                                                      06381310
    IF U[Q+1].SPEED = 2 THEN                                            06381320
         BEGIN % 40-MILL MASK CONSTRUCTION.                             06381330
         Q:=P ;                                                         06381335
         STREAM(S:=0:Q,R:=0) ;                                          06381340
              BEGIN                                                     06381345
              SI:=LOC Q; SKIP 28SB; DI:=LOC S; SKIP 8DB ;               06381350
              5(4(IF SB THEN BEGIN DS:=SET;R:=DI;SKIP 3DB;DS:=SET;DI:=R;06381355
                             END                                        06381360
                  ELSE SKIP DB; SKIP SB) ;                              06381365
                SKIP 4DB) ;                                             06381375
              END STREAM ;                                              06381380
         END ;                                                          06381390
    STREAM(MSK:=0:V:=47-(J:=((Q:=J MOD P(M1))+ABS(R)-1) DIV P(T10)),    06381395
           W:=1+J-Q DIV P(T10));                                        06381400
    BEGIN DI:=LOC MSK; SKIP V DB; DS:=W SET; END;                       06381405
    P(LND,LNG,0,LNG,=,RTN);                                             06381410
M1:::    @3641100; % DECIMAL 1000000.                                   06381450
T10:::   @23420;   % DECIMAL 10000.                                     06381500
    END OF USERDISKSPECIALCASE ;                                        06381550
 PROCEDURE GETMOREOLAYDISK(MIX);%                                       06400000
 VALUE   MIX;%                                                          06401000
 INTEGER MIX;%                                                          06402000
    BEGIN INTEGER  I=+1,%                                               06403000
                   J=+2,%                                               06404000
                   T=+3;%                                               06405000
         ARRAY     A=+4[*];%                                            06406000
         REAL      RCW=+0;%                                             06407000
         LABEL EXIT;%                                                   06408000
         P(0, 0, 0, 0);                                                 06409000
                                                                        06410000
        IF (T:=DALOC[MIX,0].[CF]+1)=127 THEN BEGIN                      06411000
             TERMINATE(MIX & 37[CTF]);                                  06411010
             GO TO EXIT; END;                                           06411030
         IF T=DALOCROW[MIX].[8:10] THEN%                                06412000
         BEGIN WHILE (I := GETSPACE(2|T+1,0&MIX[CTF],3)+2)=2 DO%    %R6806413000
                SLEEP([CLOCK],NOT CLOCK);%                              06414000
              MOVE(T,DALOCROW[MIX],I);%                                 06415000
              A ~ DALOCROW[MIX];%                                       06416000
              DALOCROW[MIX] := [M[I]]&(2|T+1)[8:38:10];%            %R6806417000
              FORGETSPACE(A);%                                          06418000
         END AIT TYPE ACTION;%                                          06419000
         IF (I ~ GETUSERDISK(500 OR MEMORY))=0 THEN GO TO EXIT;%        06420000
         DALOC[MIX,0] ~ (*P(DUP))&(T+1)[CTC];%                          06421000
         DALOC[MIX,T] ~ I;%                                             06422000
         DALOC[MIX,T+1] ~ 0;%                                           06423000
    EXIT: OLAYMASK ~ TWO(MIX) OR OLAYMASK;%                             06424000
         IOCOUNT[MIX] ~ *P(DUP)-1;%                                     06425000
         KILL([MIX] INX NOT 1);                                         06426000
    END GET MORE OVERLAY DISK FOR A GIVEN JOB;%                         06427000
REAL PROCEDURE SECURITYCHECK(MID,FID,USERID,HEADER);                    06460000
VALUE MID,FID,USERID;                                                   06460100
REAL MID,FID,USERID,HEADER;                                             06460200
%   MID       MULTI FILE ID OF FILE TO BE CHECKED                       06460300
%   FID       FILE ID OF FILE TO BE CHECKED                             06460400
%   USERID    USER IDENTIFICATION                                       06460500
%   HEADER                                                              06460600
%        =0   DO DIRECTORYSEARCH AND PASS BACK FILE HEADER              06460700
%        !0   MEMORY LOCATION OF FILE HEADER (DISK ADDRESS OF FILE      06460800
%                  HEADER OF MID/FID IN M[HEADER INX NOT 0]             06460900
%                                                                       06461100
%   RESULT FROM SECURITYCHECK                                           06461200
%        =0   NO LEGITIMATE USER FOUND                                  06461300
%        =2   TERTIARY USER  ( INPUT ONLY)                              06461400
%        =3   SECONDARY USER (INPUT/OUTPUT)                             06461500
%        =7   PRIMARY USER (INPUT/OUTPUT/LIB MAINT.)                    06461600
BEGIN                                                                   06462000
    REAL T2,DKSGROW,CODES,ROWS,ROW,DKADR,ROWSZ,C,USER,TYPE,SH;          06462100
    ARRAY FH[*];                                                        06462110
    LABEL EXYT,NOTFOUND,LOOK,WHY,FORGET;                                06462200
REAL SUBROUTINE DIRSRH;                                                 06463000
    BEGIN                                                               06463100
LOOK:    IF (T2~DIRECTORYSEARCH(MID,FID,HEADER)) LEQ 0 THEN             06463200
WHY:     BEGIN                                                          06463210
              IF T2.[1:1] THEN                                          06463220
              IF T2=0 THEN                                              06463225
              BEGIN P(DEL); TYPE:=-1; GO TO EXYT END ELSE               06463230
                   FILEMESS("#SYSFIL","ERROR  ",MID,FID,0,0,0) ELSE     06463240
                   FILEMESS(IF LOGLINE.[33:7]=0 THEN "#NO FIL" ELSE     06463250
                            -"NO FILE","ON DISK",MID,FID,0,0,0);        06463260
                IF OUTWAIT(FALSE) THEN GO TO WHY ELSE GO TO LOOK        06463300
          END;                                                          06463800
         DIRSRH := T2;                                                  06463810
END DIRSRH;                                                             06463820
         IF HEADER<512 THEN                                             06463830
         FH := [M[DIRSRH]]&30[8:38:10] ELSE                             06463840
         IF (T2~HEADER.[FF])!0 AND (SH~HEADER.[CF])!0 THEN              06463845
              FH~IOQUE&HEADER[CTC] ELSE                                 06463850
         BEGIN IF SH!0 THEN                                             06463852
              STREAM(Q~SH-1,D~[T2]);                                    06463855
                   BEGIN SI~Q; DS~8 OCT END;                            06463860
$ INCLUDE 06463866, IF DEBUGGING;                                       06463864
               IF T2 LEQ DIRECTORYTOP+3 THEN DDT;                       06463865
               FH := [M[SPACE(30)]]&30[8:38:10];                        06463870
               DISKWAIT(-FH.[CF],30,T2);                                06463880
         END;                                                           06463900
         IF(FH[2] EQV 0)=NOT 0 OR (ABS(USERID) EQV ABS(FH[2]))=NOT 0    06463910
              OR (USERID EQV MCP)=NOT 0 THEN TYPE~7 ELSE%               06463920
         IF (FH[5] EQV @14)=NOT 0 THEN%                                 06463930
              IF (FH[6] EQV @14)=NOT 0 THEN TYPE~2 ELSE TYPE~3;%        06463940
         IF TYPE ! 0 THEN GO TO EXYT;                                   06463950
%                                                                       06463955
         IF FH[5].[1:1] THEN                                            06463960
         BEGIN IF (SH:=DIRECTORYSEARCH(ABS(FH[5]),FH[6],20))=0 %        06463970
              THEN BEGIN TYPE:=0; GO TO EXYT END;                       06463980
          DKSGROW := M[SH INX 8];                                       06463990
         CODES:=GETSPACE(30,0,0)+2;ROWS:=(M[SH INX 9]AND 31)-1;         06464000
          FOR ROW:=0 STEP 1 UNTIL ROWS DO                               06464100
          BEGIN IF (DKADR:=M[SH INX 10+ROW])=0 THEN                     06464200
NOTFOUND:       BEGIN TYPE := 0;                                        06464300
FORGET:               FORGETSPACE(CODES); FORGETSPACE(SH);GO TO EXYT;   06464400
                END;                                                    06464500
                ROWSZ := DKADR + DKSGROW;                               06464600
                WHILE DKADR < ROWSZ DO                                  06464700
                BEGIN DISKWAIT(-CODES,30,DKADR);                        06464800
                      FOR C:=0 STEP 1 UNTIL 29 DO                       06465000
                     BEGIN IF((USER:=NFLAG(M[CODES INX C]))EQV @114)=   06465100
                             NOT 0 THEN GO TO NOTFOUND;                 06465200
                             IF (USER EQV @14)! NOT 0 THEN              06465210
                                     IF USER.[3:3]=0 THEN               06465220
                                     BEGIN                              06465230
                             IF (USERID EQV ABS(USER))=NOT 0 THEN       06465300
                             BEGIN TYPE :=                              06465400
                                  IF USER < 0 THEN 2 ELSE 3;            06465500
                                  GO TO FORGET;                         06465600
                           END;                                         06465700
                                     END ELSE                           06465800
                                     BEGIN                              06465805
                                     IF P1MIX ! 0 THEN                  06465810
                                      BEGIN                             06465812
                                      IF LOGLINE.[33:7] NEQ 0 THEN      06465814
                                    USER:=" "&USER[6:12:36]&USER[3:3:3];06465816
                                     IF(ABS(JAR[P1MIX,0])EQV            06465820
                                       USER.[6:42])= NOT 0 THEN         06465830
    IF((IF JAR[P1MIX,0]<0 THEN "DISK   "ELSE JAR[P1MIX,1])EQV           06465840
                                       M[CODES INX C+1].[6:42])= NOT 0  06465850
                                     THEN                               06465860
                                     BEGIN                              06465870
                                       TYPE := USER.[3:3];              06465880
                                                                        06465890
                                       GO TO FORGET;                    06465900
                                     END; C:=C+1;                       06465910
                                      END; % P1MIX NEQ 0                06465912
                                     END;                               06465920
                      END; % 30 USERS                                   06466000
                      DKADR := DKADR + 1;                               06466100
                END; % ROW                                              06466200
          END; % ROWS                                                   06466300
          GO TO NOTFOUND;                                               06466310
    END; % NO SECURITY BLOCK FILE                                       06466400
    TYPE :=0;                                                           06466500
EXYT:                                                                   06466600
    IF HEADER<512 THEN HEADER~FH ELSE ;                                 06466610
         IF FH.[CF]!HEADER.[CF] THEN FORGETSPACE(FH);                   06466620
    SECURITYCHECK :=TYPE;                                               06466700
END SECURITYCHECK;                                                      06466800
 BOOLEAN PROCEDURE OUTWAIT(B); BOOLEAN B;                               06467000
    BEGIN REPLY[P1MIX]~-@1204;                                          06468000
         IF P(0,RDS)>FENCE THEN                                         06469000
              SWAP(WAITSWAP,1) ELSE                                     06470000
              COMPLEXSLEEP((B OR REPLY[P1MIX]>0 OR TERMSET(P1MIX)));    06471000
                                                                        06472000
         IF TERMSET(P1MIX) THEN                                         06473000
         IF (JAR[P1MIX,0] EQV "LIBMAIN")!NOT 0 OR                       06473100
            (JAR[P1MIX,1] EQV "DISK   ")!NOT 0 THEN GO TO INITIATE;     06473200
         IF REPLY[P1MIX]=10 THEN OUTWAIT~NOT WHYSLEEP(@1204);           06474000
         REPLY[P1MIX]~0;                                                06475000
    END OUTWAIT;                                                        06476000
$OMIT 06619501, IF DCP;                                                 06499999
 REAL PROCEDURE OUTRAN980 (ADR,NUM,TYPE,LCC,B);                     %10906500000
      VALUE     ADR,NUM,TYPE,LCC;                                   %10906501000
      REAL      ADR,NUM,TYPE,LCC,B;                                 %10906502000
         BEGIN REAL C,T,W,LAS;                                          06503000
              B~SPACE(30)+1;                                            06504000
              LAS:=TYPE.[2:1];                                          06504500
              IF TYPE.[1:1] THEN                                        06505000
                   BEGIN T~B; C~1 END ELSE T~(C~B)+@677777;             06506000
                   STREAM(W~0:C~0);                                     06508000
                   BEGIN W~CI; GO TO X;                                 06509000
                        W(IF SC="0" THEN BEGIN DS~LIT"<"; GO TO L END;  06510000
                          IF SC="1" THEN BEGIN DS~LIT">"; GO TO L END;  06511000
                          IF SC="-" THEN BEGIN DS~LIT"{"; GO TO L END;  06512000
                          IF SC="$" THEN BEGIN DS~LIT"}"; GO TO L END;  06513000
                          IF SC="*" THEN BEGIN DS~LIT"!"; GO TO L END;  06514000
                          DS~LIT MARK;                                  06515000
                   L:     SI~SI+1; JUMP OUT TO Y);                      06516000
                        IF SC=">" THEN GO TO E;                         06517000
                        IF SC="<" THEN GO TO E;                         06518000
                        IF SC="}" THEN GO TO E;                         06519000
                        IF SC="{" THEN GO TO E;                         06520000
                        IF SC="~" THEN GO TO E;                         06520500
                        IF SC="!" THEN                                  06521000
                   E:   BEGIN DS~LIT MARK; SI~SI+1; CI~C END;           06522000
                        DS~CHR;                                         06523000
                   Y:   CI~C;                                           06523100
                   X:END;                                               06524000
                   W~P;                                                 06525000
              DO BEGIN;                                                 06525100
                   IF TYPE.[1:1] THEN                                   06526000
                   STREAM(Q:=0,C,ADR,T:LAS,G:=C,W,N:=IF NUM GTR 63 THEN 06527000
                             63 ELSE NUM);                              06528000
                   BEGIN SI~ADR; DI~T;                                  06529000
                        N(IF SC=ALPHA THEN IF SC<"0" THEN               06530000
                          BEGIN DS~CHR; GO TO L END;                    06531000
                          IF SC="!" THEN                                06532000
                          BEGIN G(TALLY~0; JUMP OUT TO L1); TALLY~1;    06533000
                   L1:         G~TALLY; SI~SI-1;                        06534000
                               IF SC="!" THEN DS~LIT MARK;              06535000
                               SI~SI+2; GO TO L;                        06536000
                          END;                                          06537000
                          CI:=CI+LAS; GO TO L2;                         06537500
                          IF SC="~" THEN                                06538000
                          BEGIN TALLY~1; Q~TALLY; DS~CHR;               06539000
                              DI~DI-1; JUMP OUT END;                    06539100
                   L2:    N:=CI; CI:=W;                                 06540000
                   L:   ;);                                             06541000
                        ADR~SI; T~DI; TALLY~G; C~TALLY;                 06542000
                   END ELSE                                             06543000
                   STREAM(Q:=0,C,ADR,T:LAS,G:=0,W,N:=IF NUM GTR 63 THEN 06544000
                             63 ELSE NUM);                              06545000
                   BEGIN SI~ADR; DI~C;                                  06546000
                        N(IF SC=" "THEN DS~CHR ELSE                     06547000
                          BEGIN T~DI;                                   06548000
                             IF SC=ALPHA THEN DS~CHR ELSE               06549000
                             BEGIN                                      06550000
                             CI:=CI+LAS; GO TO L2;                      06550500
                             IF SC="~" THEN                             06551000
                             BEGIN DI~DI-1; T~DI;                       06552000
                                  TALLY~1; Q~TALLY;                     06553000
                                  JUMP OUT;                             06554000
                             END;                                       06555000
                      L2:    N:=CI; CI:=W;                              06556000
                          END END);                                     06557000
                        ADR~SI; C~DI;                                   06558000
                   END;                                                 06559000
                   T~P; ADR~P; C~P;                                     06560000
              END UNTIL (NUM~NUM-63){0 OR P;                            06561000
              NUM~P(T-B+1,DUP).[30:3]&P(XCH)[30:33:15]-7;               06562000
              IF LCC THEN LCC:=1+(NUM+8).[40:4];                    %10906562500
              IF TYPE.[1:1] THEN                                        06563000
              BEGIN STREAM(T);                                          06563200
                   DS:=LIT LEFTARROW;                                   06563400
              END ELSE                                                  06563600
              BEGIN; STREAM(T:XC:=LCC,CR:=TYPE.[FF]-1,LF:=TYPE);    %10906564000
                        BEGIN DI:=T; DI:=DI+1;                      %10906565000
                             CR(DS~LIT"{");                             06566000
                             LF(DS~LIT"!");                             06568000
                             XC(DS:=LIT"<"); % LIT IS A LSS CHR.    %10906568100
                             DS~LIT"~";                                 06569000
                             T~DI;                                      06570000
                        END;                                            06571000
                   T~P;                                                 06572000
                   NUM~(C~NUM)+TYPE.[42:6]-TYPE.[32:1]+2;               06573000
                   NUM:=NUM+LCC;                                    %10906573100
                   IF C GTR 72 AND LCC=0 THEN                       %10906574000
                   BEGIN;STREAM(N~(NUM-65).[39:6],K~IF 116>C THEN 24    06575000
                             ELSE 141-C,T);                             06576000
                        BEGIN SI~T; SI~SI-8; DI~DI+8;                   06577000
                             N(DS~WDS; SI~SI-16; DI~DI-16);             06578000
                             SI:=SI+7; DI:=DI+7; DS:=CHR;               06579000
                             DI:=DI-2; SI:=SI-1;                        06579500
                             K(SI~SI-1; DS~CHR; DI~DI-2; SI~SI-1;       06580000
                                  IF SC=" " THEN JUMP OUT);             06581000
                             DI~DI-15; DS~16 LIT "||{!          ||";    06582000
                        END;                                            06583000
                        NUM~NUM+16;                                     06584000
                   END;                                                 06585000
              END;                                                      06586000
              OUTRAN980~NUM;                                            06587000
         END;                                                           06588000
$OMIT  06619501,  IF TWXONLY;                                           06588990
  REAL PROCEDURE OUTRANBIDS(ADR,NUM,TYPE,B,T);                          06590000
    VALUE ADR,NUM,TYPE;                                                 06590100
    REAL ADR,NUM,TYPE,B,T;                                              06590200
    BEGIN REAL D,X,Y,Z,N1,N,Q;                                          06590300
         LABEL ZIT;                                                     06590400
         B:=SPACE(30)+1;                                                06590500
         IF TYPE.[1:1] THEN                                             06590600
         BEGIN;                                                         06590700
         STREAM(Y:=Q:=0,ADR:=N:=ADR,D:=B:);                             06590800
         BEGIN SI:=ADR; DI:=D;                                          06590900
                   IF SC=ALPHA THEN IF SC LSS 0 THEN GO TO B;           06591300
              A:   IF SC="!" THEN                                       06591400
                   BEGIN DS:=CHR;                                       06591500
                        IF SC!"!" THEN                                  06591600
              B:        BEGIN TALLY:=1; Y:=TALLY; GO TO YIT END;        06591700
                        DS:=CHR; GO TO A;                               06591800
                   END;                                                 06591900
         YIT: D:=DI; ADR:=SI;                                           06592400
              END STREAM;                                               06592500
         D:=P; ADR:=P; X:=Y:=P;                                         06592600
         NUM:=NUM - ADR.[30:3]&(ADR-N)[30:33:15];                       06592700
         END ELSE                                                       06593100
         BEGIN STREAM(D:=Q:=B,X:=(NUM!X):LAS:=(NOT TYPE).[2:1],ADR);    06593200
               BEGIN DI:=D;                                             06593300
                     X(SI:=ADR;                                         06593320
                       IF SC=LEFTARROW THEN                             06593340
                       BEGIN CI:=CI+LAS; GO TO L;                       06593360
                             TALLY:=0; X:=TALLY;                        06593380
                       END ELSE                                         06593400
                       DS:=LIT"!");                                     06593420
                     D:=DI;                                             06593440
               END;                                                     06593500
                X:=Y:=P; D:=P;                                          06593600
         END;                                                           06593700
         DO                                                             06593800
         BEGIN N:=IF (N1:=NUM GTR 63) THEN 63 ELSE NUM;                 06593900
              IF TYPE.[1:1] THEN                                        06594000
              BEGIN;                                                    06594100
              STREAM(DISC:=8,ADR,D,Z,X,Y:=Q:LAS:=(NOT TYPE).[2:1],N,N1, 06594200
                     A:=@1660140206557501,B:=@2072350304000000,         06594250
                     C:=0,C1:=0,C2:=0,C3:=0);                           06594300
              BEGIN SI:=ADR; DI:=D;                                     06594400
                   C1:=CI; GO TO NEXT;                                  06594500
                   Y(SI:=SI+1;                                          06594600
                   IF SC="!" THEN SI~SI-1 ELSE                          06594700
                     BEGIN TALLY:=0; Y:=TALLY;                          06594800
                          TALLY:=1; JUMP OUT TO RETURN;                 06594900
                     END);                                              06595000
                   X(TALLY:=0; JUMP OUT TO L1);                         06595100
                   TALLY:=1;                                            06595200
           L1:     DS:=CHR;                                             06595300
           RETURN: X:=TALLY; CI:=C3;                                    06595400
%                                                                       06595500
           NEXT:   C2:=CI; GO TO START;                                 06595600
                   IF SC="-" THEN                                       06595700
                   BEGIN DS:=3 LIT"1  "; DS:=CHR;                       06595800
                         IF SC!"*" THEN DS:=3 LIT "3  "; GO BACK END;   06595850
                   IF SC="*" THEN                                       06595900
                   BEGIN SI:=SI-1;                                      06596000
                      IF SC="-" THEN BEGIN SI:=SI+2; GO BACK END;       06596100
                       SI:=SI+1;  DS:=3 LIT"1  ";  DS:=CHR;             06596200
                     GO BACK;                                           06596300
                   END;                                                 06596400
                   C:=DI; DI:=LOC A;                                    06596500
                   7(IF SC=DC THEN                                      06596600
                       BEGIN DI:=C; SI:=SI-1;                           06596700
                            DS:=CHR; JUMP OUT TO BACK                   06596800
                      END ELSE SI:=SI-1);                               06596900
                   6(IF SC=DC THEN                                      06597000
                      BEGIN DI:=C; SI:=SI-1; DS:=CHR;                   06597100
                          IF SC=" " THEN                                06597200
                          BEGIN SI:=SI+1;                               06597300
                                IF SC NEQ " " THEN DS:=LIT" ";          06597400
                                SI:=SI-1;                               06597500
                          END ELSE DS:=2 LIT"  ";                       06597600
                          JUMP OUT TO BACK;                             06597700
                     END ELSE SI:=SI-1);                                06597800
                   SI:=SI+1; DI:=C;                                     06597900
           BACK:   CI:=C3;                                              06598000
%                                                                       06598100
           START:  N(IF SC="!" THEN                                     06598200
                     BEGIN C3:=CI; CI:=C1; GO TO L END;                 06598300
                     IF SC="~" THEN                                     06598400
                     BEGIN CI:=CI+LAS; JUMP OUT TO LA;                  06598420
                           X(DS:=LIT MARK; SI:=SI+1; JUMP OUT TO L);    06598440
                           GO TO CM;                                    06598460
                    END;                                                06598480
                     X(DS:=CHR; JUMP OUT TO L);                         06598500
                     IF SC=ALPHA THEN IF SC LSS "0" THEN                06598600
                     BEGIN Y(JUMP OUT TO AOK);                          06598700
                         DS~LIT"!"; TALLY~1; Y~TALLY;                   06598800
           AOK:          DS:=CHR; GO TO L;                              06598900
                     END;                                               06599000
           CM:       Y(DS:=LIT"!"; TALLY:=0; Y:=TALLY);                 06599100
                     IF SC="$" THEN BEGIN TALLY:=4; JUMP OUT TO LAR END;06599200
                     IF SC="#" THEN BEGIN TALLY:=1; JUMP OUT TO LAR END;06599300
                     C3:=CI; CI:=C2;                                    06599400
           L:        ;);                                                06599500
                   N1(JUMP OUT TO YIT);                                 06599600
           LA:     SI:=SI-1;                                            06599700
                   X(IF SC!"!" THEN DS~LIT"!" ELSE                      06599800
                    BEGIN DI:=DI-1; TALLY:=0; X:=TALLY END;             06599850
                     JUMP OUT TO LL);                                   06599900
                   Y(DS~LIT"!");                                        06600000
           LL:     TALLY:=0;                                            06600100
           LAR:    DS:=LIT LEFTARROW;  DISC:=TALLY;                     06600200
           YIT:    D:=DI; ADR:=SI; Z := DI;                             06600300
              END;                                                      06600400
              Q:=P;  X:=P;                                              06600500
              END                                                       06600600
              ELSE                                                      06600700
              BEGIN;                                                    06600750
              STREAM(DISC:=8,ADR,D,Z,Y:LAS:=TYPE.[2:1],N,N1,X,          06600800
                   CR:=TYPE.[FF]-1,LF:=TYPE.[CF]-(P(DUP)!0),            06600850
                   RLF:=(TYPE=0),Q);                                    06600900
              BEGIN SI:=ADR; DI:=D; TALLY:=0;                           06601000
                 N(IF SC = LEFTARROW THEN                               06601100
                   BEGIN                                                06601200
                        LAS(Z:=DI; DISC:=TALLY; JUMP OUT 2 TO L3);      06601300
                        DS:=LIT MARK; SI:=SI+1;                         06601400
                        GO SETZ;                                        06601450
                   END ELSE                                             06601500
                   BEGIN IF SC="!" THEN DS:=LIT"!";                     06601600
                        IF SC=" " THEN DS:=CHR ELSE                     06601650
                        BEGIN DS:=CHR;                                  06601700
                   SETZ:     Z:=DI;                                     06601750
                        END;                                            06601800
                   END);                                                06601850
                 N1(JUMP OUT TO YIT);                                   06601900
             L3:   DISC(SI:=LOC Z;  SI:=SI+5;  DI:=LOC Z;               06602000
                        IF 3 SC=DC THEN                                 06602020
                           BEGIN DI:=Q;  X(Y:=TALLY);                   06602040
                                 JUMP OUT TO L2                         06602060
                           END ELSE JUMP OUT);                          06602080
                   DI:=Z;  X(DS:=LIT"!");                               06602100
             L2:   CR(DS:=4 LIT"1  -");                                 06602200
                   LF(DS:=4 LIT"1  *");                                 06602300
                   RLF(DS:=3 LIT"3  ");                                 06602350
                   DS:=LIT LEFTARROW;                                   06602400
                   Z:=DI;                                               06602500
             YIT:  D:=DI; ADR:=SI;                                      06602600
              END;                                                      06602700
              Y:=P;                                                     06602730
              END;                                                      06602760
              Z:=P; D:=P; ADR:=P;                                       06602800
         END                                                            06602900
         UNTIL P([T],SND) NEQ 8 OR (NUM:=NUM-63) LEQ 0;                 06603000
         OUTRANBIDS:=Z.[30:3]&(Z-B)[30:33:15];                          06603100
         T:=T&Y[2:47:1]&(IF TYPE.[1:1] THEN (X OR Q) ELSE NOT (TYPE.[FF]06603200
              = 0 OR TYPE.[CF] ! 0))[1:47:1];                           06603300
    ZIT: END OUTRAN BIDS;                                               06603400
REAL PROCEDURE OUTRANTC(ADR,NUM,TYPE,B,C);                              06610000
    VALUE ADR, NUM, TYPE;                                               06610100
    REAL  ADR, NUM, TYPE, B, C;                                         06610200
  BEGIN  REAL D, X, Y, Z, N1, N, Q;                                     06610300
    B := SPACE(30)+1;                                                   06610400
    IF TYPE.[1:1] THEN                                                  06610500
      BEGIN;                                                            06610600
      STREAM(Y:=0,ADR:=N:=ADR,D:=B:);                                   06610700
      BEGIN  SI:=ADR;    DI:=D;                                         06610800
           A:  IF SC = "!"  THEN                                        06611200
               BEGIN  DS:=CHR;                                          06611300
               IF SC NEQ "!"  THEN                                      06611400
                 BEGIN TALLY:=1; Y:=TALLY; GO TO YIT END;               06611500
                       DS:=CHR;  GO TO A;                               06611600
                 END;                                                   06611700
           YIT:  D:=DI;  ADR:=SI;                                       06611800
      END STREAM;                                                       06611900
      D:=P;  ADR:=P;  X:=Y:=P;                                          06612000
      NUM:=NUM - ADR.[30:3]&(ADR-N)[30:33:15];                          06612100
      END ELSE         %BCL SCAN                                        06612200
      BEGIN;                                                            06612300
      STREAM(D:=Q:=B,X:=(NUM!0):LAS:=(NOT TYPE).[2:1],ADR);             06612400
      BEGIN  DI:=D;                                                     06612500
             X(SI:=ADR;                                                 06612520
               IF SC=LEFTARROW THEN                                     06612540
               BEGIN CI:=CI+LAS; GO TO L;                               06612560
                     TALLY:=0; X:=TALLY;                                06612580
               END ELSE                                                 06612600
               DS:=LIT"!");                                             06612620
             D:=DI;                                                     06612640
      END STREAM;                                                       06612700
      X:=Y:=P;  D:=P;                                                   06612800
      END;                                                              06612900
    DO                                                                  06613000
    BEGIN  N:=IF(N1:=NUM GTR 63) THEN 63 ELSE NUM;                      06613100
       IF TYPE.[1:1]  THEN    %MORE SICASCII                            06613200
       BEGIN;                                                           06613300
       STREAM(DISC:=8,ADR,D,Z,X:LAS:=(NOT TYPE).[2:1],N,N1,C1:=0,C3:=0);06613400
       BEGIN  SI:=ADR;  DI:=D;                                          06613500
             C1:=CI;  GO TO START;                                      06613600
             X(TALLY:=0;  JUMP OUT TO L1);                              06613700
             TALLY:=1;                                                  06613800
        L1:  DS:=CHR;   X:=TALLY;                                       06613900
             CI:=C3;                                                    06614000
        START:   N(IF SC = "!" THEN                                     06614100
             BEGIN C3:=CI; CI:=C1; GO TO L END;                         06614200
             IF SC = LEFTARROW THEN                                     06614300
             BEGIN CI:=CI+LAS; JUMP OUT TO LA;                          06614320
                   X(DS:=LIT MARK); GO TO L0;                           06614340
             END;                                                       06614360
             X(DS:=CHR;  JUMP OUT TO L);                                06614400
             IF SC = ALPHA  THEN                                        06614500
             BEGIN  IF SC="5" THEN GO TO L0;                            06614600
                    IF SC="7" THEN GO TO L0;                            06614700
             END ELSE                                                   06614800
             BEGIN  IF SC="&" THEN GO TO L0;                            06614900
%                   IF SC="{" THEN GO TO L0;                            06615000
                    IF SC="%" THEN GO TO L0;                            06615100
                    IF SC=""" THEN GO TO L0;                            06615200
                    IF SC="}" THEN GO TO L0;                            06615300
                    IF SC="#" THEN BEGIN TALLY:=1; JUMP OUT TO LAR END; 06615400
                    IF SC="$" THEN BEGIN TALLY:=4; JUMP OUT TO LAR END; 06615500
             END;                                                       06615600
             DS:=CHR;  GO TO L;                                         06615700
        L0:  SI:=SI+1;                                                  06615750
        L:   ;);                                                        06615800
                    N1(JUMP OUT TO YIT);                                06615900
        LA:  SI:=SI-1;                                                  06616000
             X(IF SC NEQ "!" THEN DS:=LIT "!"                           06616100
                 ELSE BEGIN DI:=DI-1; TALLY:=0; X:=TALLY END);          06616200
             TALLY:=0;                                                  06616300
        LAR:   DS:=LIT LEFTARROW;  DISC:=TALLY;                         06616400
        YIT:   D:=DI;  ADR:=SI;  Z:=DI;                                 06616500
        END SICASCII STREAM;                                            06616600
        X:=P;                                                           06616700
        END                                                             06616800
        ELSE      %SCAN SOME MORE BCL                                   06616900
         BEGIN;                                                         06616950
        STREAM(DISC:=8,ADR,D,Z,Y:LAS:=TYPE.[2:1],N,N1,X,CR:=TYPE.[FF]-1,06617000
               LF:=TYPE,Q);                                             06617100
        BEGIN   SI:=ADR;  DI:=D;  TALLY:=0;                             06617200
            N(IF SC = LEFTARROW  THEN                                   06617300
              BEGIN                                                     06617400
                   LAS(Z:=DI; DISC:=TALLY; JUMP OUT 2 TO L3);           06617500
                   SI:=SI+1; DS:=LIT MARK;                              06617550
                   GO TO SETZ;                                          06617600
              END ELSE                                                  06617650
              BEGIN IF SC="!" THEN DS:=LIT"!";                          06617700
                   IF SC=" " THEN DS:=CHR ELSE                          06617750
                   BEGIN DS:=CHR;                                       06617800
              SETZ:     Z:=DI;                                          06617850
                   END;                                                 06617900
              END);                                                     06617950
            N1(JUMP OUT TO YIT);                                        06618000
         L3:  DISC(SI:=LOC Z;  SI:=SI+5;  DI:=LOC Z;                    06618100
                   IF 3 SC=DC THEN                                      06618120
                      BEGIN DI:=Q;  X(Y:=TALLY);                        06618140
                            JUMP OUT TO L2                              06618160
                      END ELSE JUMP OUT);                               06618180
              DI:=Z;  X(DS:=LIT "!");                                   06618200
         L2:  CR(DS:=LIT "-");                                          06618300
              LF(DS:=LIT "*");                                          06618400
              DS:= LIT LEFTARROW;                                       06618500
              Z:=DI;                                                    06618600
         YIT: D:=DI;   ADR:=SI;                                         06618700
        END BCL STREAM;                                                 06618800
         Y:=P;                                                          06618830
         END;                                                           06618860
        Z:=P;  D:=P;  ADR:=P;                                           06618900
    END                                                                 06619000
    UNTIL P([C],SND) NEQ 8 OR (NUM:=NUM-63) LEQ 0;                      06619100
    OUTRANTC:=Z.[30:3]&(Z-B)[30:33:15];                                 06619200
    C:=C&Y[2:47:1]&(IF TYPE.[1:1] THEN X ELSE                           06619300
       NOT(TYPE.[FF]=0 OR TYPE.[CF] NEQ 0))[1:47:1];                    06619400
 END OUTRANTC;                                                          06619500
% * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *%JS06845900
DEFINE KLUMP=@174#;% @173 IS RESERVED FOR THE DISK ADDRESS              07000000
COMMENT LASTCDNUM, FIRSTDECK, AND LASTDECK ARE STORED IN THE            07000010
        FIRST THREE WORDS OF THE DISK SEGMENT LOCATED AT DIRECTORYTOP   07000015
        +3. IN A NON SHARED DISK SYSTEM, THEY ARE WRITTEN OUT EACH      07000020
        TIME ONE OF THEM IS CHANGED SO THAT THEY WILL BE PRESERVED      07000025
        IF A HALT/LOAD OCCURS. IN A SHARED DISK SYSTEM, THEY ARE        07000030
        READ INTO THE PRT WITH A READ-LOCK COMMAND EACH TIME THEY ARE   07000035
        USED. THIS PROVIDES CONTROL DECK INTERLOCKING BETWEEN SYSTEMS   07000040
        IN ADDITION TO PASSING THE INFORMATION BETWEEN SYSTEMS.         07000045
END COMMENT;                                                            07000050
INTEGER LASTCDNUM=@174;                                                 07000100
REAL FIRSTDECK=@175;                                                    07000200
REAL LASTDECK=@176;                                                     07000300
DEFINE LOCKCONTROLDECKS=BEGIN SLEEP([TOGLE],CDMASK);CDFREE:=0;          07001000
$ INCLUDE 07001101, IF SHAREDISK;                                       07001099
         DISKWAIT(-KLUMP,-3,DIRECTORYTOP+3);                            07001100
    END#,                                                               07001200
    UNLOCKCONTROLDECKS=BEGIN                                            07001300
$ INCLUDE 07001401, IF SHAREDISK;                                       07001399
         DISKWAIT(KLUMP,-3,DIRECTORYTOP+3);                             07001400
         CDFREE:=1 END#;                                                07001500
PROCEDURE STARTADECK(N); VALUE N; REAL N; FORWARD;                      07002000
PROCEDURE ENTERCONTROLDECK(H); VALUE H; ARRAY H[*]; FORWARD;            07002100
 REAL RUNUMBER;%                                                        07003000
 PROCEDURE COM23;%                                                      07004000
    BEGIN%                                                              07005000
    REAL INBUFF,OUTBUFF,RESERVE,FIRSTCARD,OUTBUFFOLD;%                  07006000
    REAL T,T1,T2,N,L,Q,R,IU,OU,FIRST,S;%                                07007000
    INTEGER A,I;%                                                       07008000
    REAL D;                                                             07008100
    LABEL AGAIN,INL,ERROR,SUPER,BOMB,EXIT;%                             07009000
    ARRAY FPB[*],H[*];%                                                 07010000
    SUBROUTINE STOP;%                                                   07011000
         BEGIN IF S ! 18 THEN%                                          07012000
                   BEGIN READY ~ NOT(Q ~ TWO(S)) AND READY;%            07013000
                        RRRMECH ~ NOT Q AND RRRMECH OR Q AND SAVEWORD;% 07014000
                        LABELTABLE[S] ~ @114;%                          07015000
                        RDCTABLE[S] ~ MULTITABLE[S] ~ 0%                07016000
                   END;%                                                07017000
              FPB[T+1]~ *P(DUP)+CLOCK+P(RTR);%                          07018000
              FPB[T].[24:12] ~ TINU[S].[18:12];%                        07019000
              TINU[S].[18:12]:=0;                                       07020000
         END;%                                                          07021000
    SUBROUTINE FORGETIT;%                                               07022000
         BEGIN T1 ~ H[9]+9;%                                            07023000
              FOR T2 ~ 10 STEP 1 UNTIL T1 DO%                           07024000
                   FORGETUSERDISK(H[T2],-H[8]);                         07025000
         END;%                                                          07026000
    SUBROUTINE BOMBTIME;%                                               07027000
         BEGIN WHILE PRTROW[P1MIX].[PSF]>1 DO                           07028000
                   STOPM;                                               07028100
              IF TERMSET(P1MIX) THEN GO BOMB;                           07028800
         END;                                                           07028900
    BOOLEAN SUBROUTINE ENDCARD;%                                        07029000
         BEGIN IF Q THEN%                                               07030000
                   BEGIN M[INBUFF+9] ~ 0&"."[1:43:5];%                  07031000
                        STREAM(X~"END":INBUFF);%                        07032000
                             BEGIN SI ~ INBUFF;%                        07033000
                             L:   SI ~ SI+1; IF SC = " " THEN GO TO L;% 07034000
                                  DI ~ LOC X; DI ~ DI+5;%               07035000
                                  IF 3 SC = DC THEN TALLY ~ 1;%         07036000
                                  X ~ TALLY;%                           07037000
                             END;%                                      07038000
                   END ELSE P(0);%                                      07039000
              ENDCARD ~ P;%                                             07040000
         END;%                                                          07041000
    REAL SUBROUTINE ADR;%                                               07042000
         BEGIN IF (T2 ~ H[(T1 ~ R DIV 200)+10]) = 0 THEN%               07043000
                   BEGIN H[9] ~ T1+1;%                                  07044000
                        H[T1+10] ~ T2 ~ GETUSERDISK(200);%              07045000
                   END;%                                                07046000
              ADR ~ R MOD 200+T2%                                       07047000
         END;%                                                          07048000
    SUBROUTINE INPUT;%                                                  07049000
         BEGIN%                                                         07050000
              IF IU < 16 THEN%                                          07051000
                   BEGIN IF FIRST THEN%                                 07052000
                                  T ~ WAITIO(@140000000  +  INBUFF,%    07053000
                                       @40,IU);%                        07054000
                        T ~ WAITIO(@120540000000  +  INBUFF,%           07055000
                             @2000000,IU);%                             07056000
                        Q ~ M[INBUFF-1]=9;%                             07057000
                   END%                                                 07058000
              ELSE BEGIN WHILE(Q~WAITIO(@40000000+INBUFF,FIRST|4+       07059000
                             @4000000,IU)).[45:1] DO                    07059100
                        BEGIN SLEEP([TOGLE],STATUSMASK);                07059200
                             RRRMECH~RRRMECH AND NOT Q~TWO(IU);         07059300
                             READY~READY AND NOT Q;                     07059400
                             DO BEGIN CLICK~CLOCK+P(RTR)+64;            07059500
                                  SLEEP([READY],Q);                     07059600
                                  BOMBTIME;                             07059700
                             END UNTIL (READY AND Q)!0;                 07059800
                        END;                                            07060000
                        IF Q ~ Q ! 0 THEN                               07061000
                             UNIT[IU].[5:13]~0;                         07066000
                        T ~ 0;%                                         07067000
                   END;%                                                07068000
         END;%                                                          07069000
              FPB ~ PRT[P1MIX,3];%                                      07070000
 %  SET UP INPUT VARIABLES%                                             07071000
              IU~FINDINPUT("CONTROL","DECK   ",0,0,0,0,0,0,0,0);        07072000
              STARTIMING(0,IU);                                         07073000
              IF OPNMESS THEN FILEMESS(" IN "&TINU[IU][6:30:18],0,      07074000
                   "CONTROL","DECK   ",0,0,0);                          07074100
              RDCTABLE[IU].[8:6] ~ P1MIX;%                              07075000
              IF IU LSS 16 THEN                                         07076000
                   BEGIN FPB[3].[23:1]:=1;  % SET INPUT FLAG FOR LOG    07076010
                        T:=WAITIO(@540000005,0,IU);                     07077000
                   END                                                  07077010
              ELSE IF IU = 23 THEN%                                     07078000
                   BEGIN FORGETSPACE(READERA-2);%                       07079000
                        READERA ~ 0;%                                   07080000
                   END%                                                 07081000
              ELSE IF IU = 24 THEN%                                     07082000
                   BEGIN FORGETSPACE(READERB-2);%                       07083000
                        READERB ~ 0;%                                   07084000
                   END;%                                                07085000
              INBUFF ~ GETSPACE(11,0,1) + 2;                            07086000
              FIRSTCARD ~ GETSPACE(10,0,1)+2;%                          07087000
 %  SET UP OUTPUT VARIABLES%                                            07088000
              IF PRT[P1MIX,@25] THEN%                                   07089000
                   BEGIN OU ~ LABELASCRATCH(T ~%                        07090000
                             TAPELABEL("CONTROL","DECK   ",1,1,100));%  07091000
                        FORGETSPACE(T);%                                07093000
                        FPB[3].[23:1]:=0;   % SET OUTPUT FLAG FOR LOG   07093010
                   END%                                                 07094000
              ELSE BEGIN OUTBUFFOLD ~ OUTBUFF ~ GETSPACE(60,0,1)+2;%    07095000
                        RESERVE ~ GETSPACE(30,0,1)+2;%                  07096000
                        H ~ [M[GETSPACE(30,0,1)+2]]&30[8:38:10];%       07097000
                        OU ~ 18;%                                       07098000
                   END;%                                                07103000
              STARTIMING(5,OU);                                         07104000
 %  BEGIN ONE DECK%                                                     07106000
    AGAIN:    OUTBUFF ~ OUTBUFFOLD;%                                    07107000
              L ~ N ~ 0;%                                               07108000
              FIRST ~ D ~ 1;                                            07109000
              IF OU = 18 THEN%                                          07110000
                   BEGIN H[ 9] ~ 0;%                                    07111000
                        MOVE(20,[H[9]],[H[10]]);                        07112000
                        H[8]~200;                                       07112100
              END;%                                                     07113000
 %  BEGIN ONE CARD%                                                     07114000
    INL:      INPUT;%                                                   07115000
              IF FIRST THEN%                                            07116000
                   BEGIN FIRST ~ FALSE;%                                07117000
                        MOVE(10,INBUFF,FIRSTCARD);%                     07118000
                   END;%                                                07119000
              IF T ! 0 THEN GO TO ERROR;%                               07120000
              BOMBTIME;%                                                07121000
              IF OU < 16 THEN%                                          07122000
                   BEGIN T ~ WAITIO(INBUFF&@5000[18:33:15]&(10-Q)%      07123000
                             [8:38:10],0,OU);%                          07124000
                        IF NOT ENDCARD THEN GO TO INL;%                 07125000
                        M[INBUFF-1] ~ @1737000000000000;%               07126000
                        T ~ WAITIO(INBUFF-1,0,OU);%                     07127000
    SUPER::             STREAM(X~"CONTROL":INBUFF);%                    07128000
                             BEGIN SI ~ INBUFF;%                        07129000
                             E:   IF SC ! "E" THEN%                     07130000
                                       BEGIN SI ~ SI+1; GO TO E END;%   07131000
                                  SI ~ SI+3;%                           07132000
                             L:   IF SC = " " THEN%                     07133000
                                       BEGIN SI ~ SI+1; GO TO L END;%   07134000
                                  DI ~ LOC X; DI ~ DI+1;%               07135000
                                  IF 7 SC = DC THEN X ~ TALLY;%         07136000
                             END;%                                      07137000
                        IF P ! 0 THEN GO TO AGAIN ELSE GO TO EXIT;%     07138000
                   END;%                                                07139000
              IF D = 0 THEN SLEEP([D],NOT 0);                           07139500
              MOVE(10,INBUFF,OUTBUFF);%                                 07140000
              IF Q THEN%                                                07141000
                   BEGIN IF L DIV 6 ! N DIV 6 THEN%                     07142000
                             BEGIN R ~ L DIV 3;%                        07143000
                                  A ~ ADR;%                             07144000
                                  DISKWAIT(-RESERVE,30,A);              07145000
                                  M[I~L MOD 3|10+9+RESERVE] ~ N;%       07147000
                                  DISKWAIT(RESERVE,30,A);               07148000
                             END%                                       07150000
                        ELSE M[I ~(L-N)|10+9+OUTBUFF] ~ N;%             07151000
                        L ~ M[OUTBUFF+9] ~ N;%                          07152000
                   END;%                                                07153000
              IF N = 12000 THEN%                                        07154000
                   BEGIN T := SPACE(14);                                07155000
                        STREAM(FIRSTCARD,T);                            07156000
                             BEGIN DS ~ 32 LIT%                         07157000
                                    "#MORE THAN 12000 CARDS IN       "; 07158000
                                    SI~FIRSTCARD;DS~9WDS;DS~LIT "~";    07159000
                             END;%                                      07160000
                        SPOUT(T); GO TO BOMB;%                          07161000
                   END;%                                                07162000
              IF (N ~ N+1) MOD 6 = 0 THEN%                              07163000
                   BEGIN R ~ N DIV 3-2;%                                07164000
                        A ~ ADR;%                                       07165000
                        OUTBUFF ~ OUTBUFFOLD;%                          07166000
                        DISKIO(D,OUTBUFF-1,60,A);                       07167000
                                                                        07168000
                   END ELSE OUTBUFF ~ OUTBUFF+10;%                      07169000
              IF NOT ENDCARD THEN GO TO INL;%                           07170000
              IF D = 0 THEN SLEEP([D],NOT 0);                           07171000
                                                                        07172000
              OUTBUFF ~ OUTBUFFOLD;%                                    07173000
              R ~ N DIV 6|2;%                                           07174000
              A ~ ADR;%                                                 07175000
              IF N MOD 6 ! 0 THEN                                       07175100
              BEGIN                                                     07175200
              DISKWAIT(OUTBUFF,60,A);                                   07176000
              END;%                                                     07178000
              IF R+2 < 200 THEN                                         07178100
                   BEGIN H[8] ~ R+2;                                    07178200
                        FORGETUSERDISK(A+2,R-198);                      07178300
                   END;                                                 07178400
              H[7]~N-1;                                                 07179000
              H[5]:= -0;                                                07179100
              H[4]:=H[6]:=0;                                            07179200
              ENTERCONTROLDECK(H);                                      07180000
              GO TO SUPER;                                              07181000
    ERROR:    T := SPACE(12);                                           07214000
              STREAM(FIRSTCARD,T);%                                     07215000
                   BEGIN DS ~ 16 LIT "#READ ERROR FOR ";%               07216000
                        SI ~ FIRSTCARD; DS ~ 9 WDS; DS ~ LIT "~";%      07217000
                   END;%                                                07218000
              SPOUT(T);%                                                07219000
              DO BEGIN INPUT;%                                          07220000
                        BOMBTIME;%                                      07221000
              END UNTIL ENDCARD;%                                       07222000
              IF OU < 16 THEN%                                          07223000
                   BEGIN DO BEGIN T ~ WAITIO(@340000005,@60,OU);%       07224000
                                  BOMBTIME;%                            07225000
                        END UNTIL T.[42:1];%                            07226000
                        T ~ WAITIO(@140000005,@60,OU);%                 07227000
                   END%                                                 07228000
              ELSE FORGETIT;%                                           07229000
              GO TO SUPER;%                                             07230000
    BOMB::    FORGETIT;%                                                07231000
    EXIT:     SLEEP([TOGLE],STATUSMASK);                                07232000
              S ~ IU; T ~ 3; STOP;%                                     07233000
              S ~ OU; T ~ 8; STOP;%                                     07234000
              FORGETSPACE(INBUFF);%                                     07235000
              FORGETSPACE(FIRSTCARD);%                                  07236000
              IF OU > 16 THEN%                                          07237000
                   BEGIN FORGETSPACE(H);%                               07238000
                        FORGETSPACE(OUTBUFFOLD);%                       07239000
                        FORGETSPACE(RESERVE);%                          07240000
                   END;%                                                07241000
    END COM23;%                                                         07242000
 PROCEDURE STARTLOADN(KTR); VALUE KTR; REAL KTR;%                       07243000
         BEGIN REAL C,T;;%                                              07244000
              STREAM(K~0:KTR);%                                         07245000
                   BEGIN SI ~ KTR;%                                     07246000
                   L:   IF SC = " " THEN%                               07247000
                             BEGIN SI ~ SI+1; GO TO L END;%             07248000
                        DI ~ LOC K; DI ~ DI+6; DS ~ 2 CHR;%             07249000
                   END;%                                                07250000
              C ~ P;%                                                   07251000
              T ~ KTR.[15:15]-1;%                                       07252000
              IF C ! "MT" AND C ! "DK" THEN%                            07253000
                   SPOUT(T)                                             07254000
              ELSE BEGIN C ~ C = "MT";%                                 07255000
                        T ~ T+2;%                                       07256000
                        STREAM(C,T);%                                   07257000
                             BEGIN DS~19 LIT "CC RUN LDCNTRL/DISK"      07258000
                                  ;DS ~ 18 LIT ";STACK=150;COMMON=";%WF 07259000
                                  SI ~ LOC C; DS ~ DEC;%                07260000
                                  DS~12 LIT ";PRIORITY=0 ";             07260100
                                  DS ~ 6 LIT ";END. ";%                 07261000
                                  8(DS~2 LIT " ");                      07262000
                             END;%                                      07263000
                        CCARD(T&31[3:43:5]);                            07264000
                                                                        07265000
                   END;%                                                07266000
         END;%                                                          07267000
PROCEDURE TABLEOFCONTENTS(B); VALUE B; REAL B;                          07268000
         BEGIN REAL I,T,N,A,TUSTA;                                      07269000
              LABEL L,EXIT,G;%                                          07270000
$ INCLUDE 07271101, IF SHAREDISK;                                       07270099
              REAL SYS;                                                 07270100
              IF (SYS:=UNITIN(TINU,B)-37)>3 OR SYS LSS 0 THEN           07270200
              BEGIN                                                     07270300
                   STREAM(A:="ALL":B);                                  07270400
                   BEGIN  SI:=B;                                        07270500
                        63(IF SC!" " THEN JUMP OUT;SI:=SI+1);           07270600
                        DI:=LOC A;DI:=DI+5;IF 3 SC=DC THEN              07270700
                        TALLY:=5;A:=TALLY;                              07270800
                   END;                                                 07270900
              IF NOT (SYS:=P) THEN SYS:=SYSNO;                          07271000
              END;                                                      07271100
              A:=B.[15:15]-1;                                           07271900
              TUSTA:=M[A-1];                                            07272000
              LOCKCONTROLDECKS;                                         07272500
              A:=FIRSTDECK;                                             07273000
         L:   I:=SPACE(13);                                             07274000
         G:   IF A = 0 THEN GO TO EXIT;%                                07275000
              DISKWAIT(-I,12,A);                                        07276000
              A:=M[I+6].[CF];                                           07278000
$ INCLUDE 07280001, IF SHAREDISK;                                       07279000
              IF SYS LSS 5 THEN                                         07279100
              IF SYS!M[I+4].[4:2] THEN GO TO G;                         07279200
              T:=M[I+4].[4:2]+1;                                        07280000
              N ~ M[I+2];%                                              07281000
                    DISKWAIT(-I-3,9,M[I+10]);                           07282000
              STREAM(N,T,I);                                            07284000
                   BEGIN SI ~ LOC N; SI ~ SI+1;%                        07285000
                        DS ~ 6 LIT " DECK "; DS ~ 5 CHR;%               07286000
$ INCLUDE 07286301, IF SHAREDISK;                                       07286100
                        DS:=6 LIT" (SYS ";SI:=SI+9;DS:=CHR;             07286200
                        DI:=DI-1;SKIP DB;DS:=SET;DS:=LIT")";            07286300
$ OMIT 07286501, IF SHAREDISK;                                          07286400
                        DS:=8 LIT" ";                                   07286500
                        DS ~ 5 LIT " IS: ";%                            07287000
                        DI ~ DI+40; DI ~ DI+32; DS ~ LIT "~";%          07288000
                   END;%                                                07289000
              SPOUT(I);%                                                07290000
              GO TO L;%                                                 07291000
         EXIT:IF N=0 THEN                                               07292000
                   BEGIN;STREAM(I); DS ~ 18 LIT " NO DECKS ON DISK~";%  07293000
                        SPOUT(I);%                                      07294000
                   END ELSE FORGETSPACE(I);%                            07295000
              UNLOCKCONTROLDECKS;                                       07296000
         END;%                                                          07297000
 PROCEDURE REMOVEDECK(N); VALUE N; REAL N;                              07298000
         BEGIN REAL I,T,A,L1,J=I,L2,V;%                                 07299000
              LABEL L,EXIT,REMOVE;%                                     07300000
              LOCKCONTROLDECKS;                                         07301000
              IF (I ~ DIRECTORYSEARCH("DECK   ",N,5)) = 0 THEN%         07303000
                   BEGIN I := SPACE(5);                                 07304000
                        STREAM(N,I);%                                   07305000
                             BEGIN DS ~ 6 LIT " DECK ";%                07306000
                                  SI ~ LOC N; SI ~ SI+1; DS ~ 5 CHR;%   07307000
                                  DS ~ 13 LIT " NOT ON DISK~";%         07308000
                             END;%                                      07309000
                        GO TO EXIT;%                                    07310000
                   END;%                                                07311000
$ INCLUDE 07311311, IF SHAREDISK;                                       07311199
              IF (T:=M[I+4]).[2:1] THEN                                 07311200
              IF T.[4:2]!SYSNO THEN                                     07311210
              BEGIN                                                     07311220
                   STREAM(N,A~T.[4:2]+1,I~I INX 0);                     07311230
                   BEGIN DS:=6 LIT" DECK ";SI:=LOC N;SI:=SI+1;          07311240
                        DS:=5 CHR;DS:=18 LIT" IN USE BY SYSTEM ";       07311250
                        SI:=SI+9;DS:=CHR;DI:=DI-1;SKIP DB;DS:=SET;      07311260
                        DS:=LIT"~";                                     07311270
                   END;                                                 07311280
                   GO TO EXIT;                                          07311300
              END;                                                      07311310
              L2:=M[I+6].[CF];                                          07312000
              IF (A:=FIRSTDECK)=(L1:=I.[FF]) THEN                       07313000
              BEGIN                                                     07314000
                   IF (FIRSTDECK:=L2)=0 THEN LASTDECK:=0;               07314100
                   DISKWAIT(KLUMP,3,DIRECTORYTOP+3);                    07314200
                   GO TO REMOVE;                                        07314300
              END;                                                      07314400
              J ~ I.[33:15];%                                           07315000
         L:                                                             07316000
              DISKWAIT(-J,30,A);                                        07317000
              IF (V:=M[J+6].[CF])=0 THEN GO TO REMOVE;                  07318000
              IF V ! L1 THEN%                                           07319000
                   BEGIN A ~ V; GO TO L END;%                           07320000
              M[J+6].[CF]:=L2;                                          07321000
              DISKWAIT(J,30,A);                                         07322000
              IF L2 = 0 THEN%                                           07324000
              BEGIN                                                     07325000
                   LASTDECK:=A;                                         07326000
                   DISKWAIT(KLUMP,3,DIRECTORYTOP+3);                    07327000
              END;                                                      07328000
         REMOVE:                                                        07331000
               FORGETSPACE(I);                                          07332000
              I:=DIRECTORYSEARCH("DECK   ",N,8).[CF];                   07333000
              T ~ M[I+9];%                                              07343000
              FOR V ~ 1 STEP 1 UNTIL T DO%                              07344000
                   IF M[I+V+9]!0 THEN FORGETUSERDISK(M[I+V+9],M[I+8]);  07345000
              STREAM(N,I);%                                             07346000
                   BEGIN DS ~ 6 LIT " DECK ";%                          07347000
                        SI ~ LOC N; SI ~ SI+1; DS ~ 5 CHR;%             07348000
                        DS ~ 9 LIT " REMOVED~";%                        07349000
                   END;%                                                07350000
      IF LIBMSG THEN                                                    07350100
EXIT: SPOUT(I)                                                          07351000
      ELSE FORGETSPACE(I);                                              07351100
              UNLOCKCONTROLDECKS;                                       07352000
         END;%                                                          07353000
 PROCEDURE DECKREMOVER(B); VALUE B; REAL B;%                            07354000
         BEGIN REAL K,N,F;%                                             07355000
              INTEGER U; LABEL ON,ERR;                                  07355100
              REAL D;                                                   07355200
              LABEL L,TRYIT,GIVEUP;                                     07356000
              K ~ B.[15:15]-1;%                                         07357000
         L:   STREAM(X~12,B:A~0);%                                      07358000
                   BEGIN SI ~ B;%                                       07359000
                   U:   IF SC = " " THEN BEGIN SI~SI+1; GO TO U END;%   07360000
                        IF SC="=" THEN BEGIN DI~LOC X; DI~DI+6; DS~CHR; 07360100
                                             SI~SI-1; B~SI; GO TO E END;07360200
                        IF SC = "#" THEN SI:=SI+1;                      07361000
                   BL:  IF SC=" "  THEN BEGIN SI:=SI+1;GO TO BL; END;   07361500
                        DI:=LOC X; DI:=DI+1; DS:=5 LIT "#0000";         07362000
                        4(IF SC < "0" THEN JUMP OUT TO EN;              07363000
                          IF SC > "9" THEN JUMP OUT TO EN;              07364000
                          SI:=SI+1; TALLY:=TALLY+1);                    07365000
                   EN:  A:=TALLY; SI:=SI-A; DI:=DI-A; DS:=A CHR;        07365500
                   N:   IF SC = " " THEN BEGIN SI~SI+1; GO TO N END;%   07366000
                        DS ~ CHR; B ~ SI;%                              07367000
                   E: END;%                                             07368000
              P(.B,~,.N,~);%                                            07369000
              F~N.[36:6]; N.[36:6]~"~";                                 07370000
              IF F="~" OR F="," OR F="=" THEN                           07371000
                   BEGIN IF F="=" THEN                                  07371100
                         BEGIN IF D=0 THEN D := SPACE(30);              07371200
                               LOCKCONTROLDECKS;                        07371300
                               IF (N:=FIRSTDECK)=0 THEN                 07371400
GIVEUP:                                                                 07371450
                               BEGIN F:="~";                            07371500
                                    UNLOCKCONTROLDECKS;                 07371600
                                    GO ON;                              07371700
                               END;                                     07371750
TRYIT:                         DISKWAIT(-D,30,N);                       07371800
$ INCLUDE 07371851, IF SHAREDISK;                                       07371809
                               IF M[D+4].[4:2]!SYSNO THEN               07371810
                               IF (N:=M[D+6].[CF])!0 THEN GO TRYIT ELSE 07371820
                                    GO GIVEUP;                          07371830
                               N:=M[D+2];                               07371900
                               UNLOCKCONTROLDECKS;                      07371950
                         END;                                           07372000
                         FOR U~0 STEP 1 UNTIL 3 DO                      07372090
                         IF CIDROW[U]!0 THEN                            07372100
                         IF(CIDTABLE[U,2] EQV N)=NOT 0 THEN             07372200
                         IF LABELTABLE[U+32]}0 THEN                     07372300
                         BEGIN                                          07372400
                               ENDOFDECK(U);                            07372500
                               GO ON;                                   07372600
                         END ELSE GO TO ERR;                            07372700
                         REMOVEDECK(N);                                 07372800
              ON:        IF F!"~" THEN GO TO L;                         07372900
                        FORGETSPACE(K);%                                07373000
                   END ELSE                                             07374000
    ERR:           SPOUT(K);                                            07374100
              IF D!0 THEN FORGETSPACE(D);                               07374200
         END;%                                                          07375000
 BOOLEAN PROCEDURE READEMFROMDISK(H,IB);%                               07376000
         VALUE H,IB; ARRAY H[*],IB[*];%                                 07377000
         BEGIN%                                                         07378000
%   H[0] = ADDRESS OF BU+1 (B)%                                         07379000
%   H[1] = ADDRESS OF B2+1%                                             07380000
%   H[2] = DECK NAME%                                                   07381000
%   H[3] = RECORDCOUNT (N)%                                             07382000
%   H[4] = NEXT CONTROL CARD (L)%                                       07383000
%   H[5] = RECORDS USED IN THIS BLOCK | 10 (R)%                         07384000
%   H[7] - H[30] ARE FILE HEADER%                                       07385000
              REAL A,B;%                                                07386000
              DEFINE N=H[3]#,L=H[4]#,R=H[5]#;%                          07387000
              INTEGER I=A;%                                             07388000
              B ~ H[0];%                                                07389000
              IF R = 0 THEN%                                            07390000
              IF (M[B-2] AND IOMASK) = 0 THEN%                          07391000
                   SLEEP([M[B-2]],IOMASK);%                             07392000
              STREAM(B~B+R,IB);%                                        07393000
                   BEGIN SI ~ B; DS ~ 10 WDS END;%                      07394000
              M[IB INX NOT 0] ~ 10;                                     07394500
              IF (READEMFROMDISK ~ N=L) THEN%                           07395000
                   L ~ IB[9];%                                          07396000
              IF (A ~ N ~ *P(DUP)+1) > H[7] THEN%                       07397000
                   BEGIN N~A-1; READEMFROMDISK~1 END                    07398000
              ELSE BEGIN IF (R ~ *P(DUP)+10) = 30 THEN%                 07399000
                             BEGIN IB ~ [M[B-2]];%                      07400000
                                  R ~ 0;                                07400400
                                  A ~ A DIV 3+1;                        07400500
                                  I~H[A DIV H[8]+10]+A MOD H[8];        07401000
                                  DISKIO(IB,1-B,30,I);%                 07402000
                                  H[0] ~ H[1];%                         07403000
                                  H[1] ~ B;%                            07404000
         END;      END;      END;%                                      07405000
 PROCEDURE ENDOFDECK(R); VALUE R; REAL R;                               07406000
         BEGIN ARRAY H[*];%                                             07407000
              REAL B,I;%                                                07408000
              LABEL EXIT;                                               07408500
              IF (H:=CIDROW[R])=0 THEN GO TO EXIT;                      07409000
              LABELTABLE[R+32] ~ @114;                                  07409100
              MULTITABLE[R+32] ~ RDCTABLE[R+32] ~ 0;                    07409200
              UNITCODE[R+9]:=-0;                                        07409300
              REMOVEDECK(H[2]);                                         07410000
              FOR I ~ 0 STEP 1 UNTIL 1 DO%                              07411000
                   BEGIN B ~ H[I];%                                     07412000
                        IF (M[B-2] AND IOMASK) = 0 THEN                 07413000
                             SLEEP([M[B-2]],IOMASK);%                   07414000
                   END;%                                                07415000
              IF H.[18:15] ! 0 THEN                                     07416000
                   FORGETSPACE(H.[18:15]-2);                            07417000
              CIDROW[R] ~ 0;%                                           07418000
              FORGETSPACE(H);%                                          07419000
              IF (RUNUMBER~RUNUMBER+1) GTR 0 THEN STARTADECK(0);        07420000
         EXIT:                                                          07420100
         END;%                                                          07421000
PROCEDURE STARTADECK(N); VALUE N; REAL N;                               07422000
         BEGIN LABEL EXIT,L,POSSIBLE,NEXT;%                             07423000
              REAL I,R,T,A,S;                                           07424000
              ARRAY H[*];%                                              07425000
              LABEL AGAIN,START;                                        07425500
              LOCKCONTROLDECKS;                                         07426000
              IF RUNUMBER LEQ 0 AND N=0 THEN GO TO EXIT;                07426100
         AGAIN:                                                         07427500
              FOR R ~ 0 STEP 1 UNTIL 3 DO%                              07428000
                   IF CIDROW[R] = 0 THEN GO TO POSSIBLE;%               07429000
              STREAM(S~S~SPACE(4));                                     07429100
              DS:=27 LIT" ALL PSEUDO-READERS IN USE~";                  07429200
              SPOUT(S);                                                 07429300
              GO TO EXIT;%                                              07430000
         POSSIBLE:%                                                     07431000
              IF (A:=FIRSTDECK)=0 THEN GO TO EXIT;                      07432000
              H ~ CIDROW[R] ~ [M[S~GETSPACE(94,64,1)+2]]&94[8:38:10];   07433000
              H[2] ~ 0;                                                 07434000
         L:   DISKWAIT(-S,30,A);                                        07435000
              IF N!0 THEN                                               07436000
              BEGIN                                                     07436100
                   IF H[2].[12:24]!N THEN GO TO NEXT;                   07436200
                   IF H[4].[2:1] THEN                                   07436300
                   BEGIN                                                07436400
                        STREAM(A:=[H[2]],                               07436500
$ INCLUDE 07436511, IF SHAREDISK;                                       07436509
                                  N~H[4].[4:2]+17,                      07436510
                                       S);                              07436520
                        BEGIN SI:=A;SI:=SI+1;DS:=6 LIT" DECK ";         07436600
                             DS:=5 CHR;DS:=7LIT" IN USE";               07436700
$ INCLUDE 07436901, IF SHAREDISK;                                       07436799
                             DS:=11 LIT" BY SYSTEM ";SI:=LOC N;         07436800
                             SI~SI+7; DS~CHR;                           07436900
                             DS:=LIT"~";                                07437000
                        END;                                            07437100
                        SPOUT(S);                                       07437200
                        CIDROW[R]:=0;                                   07437300
                        GO TO EXIT;                                     07437400
                   END;                                                 07437500
              END ELSE                                                  07437600
              IF H[4].[2:1]                                             07437800
$ INCLUDE 07437911, IF SHAREDISK;                                       07437899
              OR H[4].[4:2]!SYSNO AND NOT RNALL                         07437900
                   OR (BATCHTOG AND H[4].[7:1])                         07437910
                   THEN GO TO NEXT;                                     07438000
              H[4]:=(*P(DUP))&1[2:47:1]&SYSNO[4:46:2];                  07438100
              DISKWAIT(S,30,A);                                         07438200
              H[0] ~ S+32;%                                             07441000
              H[1] ~ S+64;%                                             07442000
                                                                        07443000
              T ~ [H[30]]; DISKIO(T,1-H[0],30,H[10]);%                  07444000
              IF H[7] LSS 3 THEN H[62]:=IOMASK ELSE                     07445000
              BEGIN T:=[H[62]]; IF H[8]=1 THEN                          07445100
              DISKIO(T,1-H[1],30,H[11]) ELSE                            07445200
              DISKIO(T,1-H[1],30,H[10]+1);                              07445300
              END;                                                      07445400
              T := GETSPACE(13,64,0)+4;                                 07446000
              M[T INX 10] := H[5];                                      07446100
              H[3] := H[4] := H[5] := H[6] := 0;                        07446200
                                                                        07447000
              I ~ READEMFROMDISK(H,[M[T]]&10[8:38:10]);%                07448000
              LABELTABLE[R+32] ~ -@14;                                  07448500
              FREECARD(T&R[3:43:5]);                                    07449000
              IF (RUNUMBER~RUNUMBER-1) LEQ 0 OR N!0 THEN GO TO EXIT;    07450000
              GO TO AGAIN;                                              07450200
         NEXT:IF (A:=H[6].[CF])!0 THEN GO TO L;                         07451000
              IF N!0 THEN                                               07452000
              BEGIN                                                     07452100
                   STREAM(N,S);                                         07452200
                   BEGIN SI:=LOC N;SI:=SI+4;DS:=7 LIT" DECK #";         07452300
                        DS:=4 CHR;DS:=13 LIT" NOT ON DISK~";            07452400
                   END;                                                 07452500
                   SPOUT(S);                                            07452600
              END ELSE FORGETSPACE(S);                                  07452700
              CIDROW[R] ~ 0;%                                           07453000
         EXIT: UNLOCKCONTROLDECKS;                                      07455000
         END;%                                                          07456000
 PROCEDURE RUNTHEDECK(B);VALUE B; REAL B;%                              07457000
         BEGIN REAL I,J;%                                               07458000
              STREAM(S:=0:B,A:=[I]);                                    07461000
                   BEGIN SI ~ B;                                        07461100
              L:        IF SC = " " THEN                                07461200
                             BEGIN SI ~ SI+1; GO TO L END;              07461300
                   IF SC="#" THEN                                       07461310
                   BEGIN L1:SI:=SI+1;IF SC=" " THEN GO TO L1;           07461320
                        DS:=4 LIT"0000";DS:=4 CHR;TALLY:=1;GO TO EX;    07461330
                   END;                                                 07461340
                        DI ~ A; DI ~ DI+7; DS ~ CHR;                    07461400
                   EX: S:=TALLY;                                        07461450
                   END;                                                 07461500
              J:=P;                                                     07461560
              B:=B.[15:15]-1;                                           07461570
              IF J THEN                                                 07461600
              BEGIN                                                     07461700
                   FORGETSPACE(B);                                      07461800
                   STARTADECK(I);                                       07461900
              END ELSE                                                  07462000
              BEGIN                                                     07462100
                   IF I GTR 4 THEN I:=NABS(RUNUMBER) ELSE               07462200
                   BEGIN                                                07462250
                   RUNUMBER:=I;                                         07462300
                   FOR J:=0 STEP 1 UNTIL 3 DO                           07462400
                        RUNUMBER:=RUNUMBER-(CIDROW[J]!0);               07462500
                   END;                                                 07462600
                   STREAM(X1:=1-I.[1:1],X2:=RUNUMBER.[1:1],I:=ABS(I),B);07463000
                   BEGIN CI:=CI+X1; GO L1; DS:=10LIT" WILL USE ";GO L2; 07464000
                         L1: CI:=CI+X2; GO L2; DS:=LIT"-"; L2:          07464100
                        SI:=LOC I;DS:=2 DEC;                            07465000
                        DS ~ 13 LIT " PSEUDO-RDRS~";                    07466000
                   END;%                                                07467000
                   SPOUT(B);                                            07468100
              IF RUNUMBER GTR 0 THEN STARTADECK(0);                     07469000
              END;                                                      07472500
         END;%                                                          07473000
 PROCEDURE EXTERNALEND(B); VALUE B; REAL B;                             07473100
         BEGIN REAL U;  LABEL EXIT;                                     07474000
              U ~ UNITIN(TINU,B);                                       07475000
              B ~ B.[15:15]-1;                                          07476000
              IF U{35 AND U}32 THEN                                     07477000
              IF LABELTABLE[U] } 0 THEN                                 07478000
              IF CIDROW[U-32] ! 0 THEN                                  07478500
                   BEGIN                                                07479000
                        ENDOFDECK(U-32);                                07479100
                        FORGETSPACE(B);                                 07480000
                        GO TO EXIT;                                     07481000
                   END;                                                 07482000
              SPOUT(B);                                                 07483000
         EXIT:END;                                                      07484000
PROCEDURE CHANGEPRIORITY(BUFF,MIX); VALUE BUFF,MIX; REAL BUFF,MIX;      07485000
BEGIN INTEGER PRIORITY; REAL B;                                         07486000
    ARRAY LINKR = NT1[*];                                               07486100
      BUFF ~ ((B~BUFF).[15:15]-1)&M[P(DUP)-1][9:9:9];                   07487000
      STREAM(PRIORITY:B);                                               07488000
      BEGIN SI~B;                                                       07489000
      N:    IF SC="~" THEN GO TO X;                                     07490000
            IF SC<"0" THEN BEGIN SI~SI+1; GO TO N; END; B~SI;           07491000
      K:    IF SC}"0" THEN IF SC{"9" THEN                               07492000
                   BEGIN TALLY~TALLY+1; SI~SI+1; GO TO K END;           07493000
            SI~B; DI~LOC PRIORITY; B~TALLY; DS~B OCT; GO TO Z;          07494000
      X:    DI~LOC PRIORITY; SKIP DB; DS~11 SET;                        07495000
      Z:                                                                07496000
      END STREAM;                                                       07497000
       IF (PRIORITY~P) } 0 THEN                                         07498000
      IF [MEM[MIX,0]].[CF]}FENCE THEN                                   07500000
      IF JAR[MIX,*]!0 THEN                                              07501000
      IF PUTORTAKE(MIX,[PRYOR[MIX]],1,0) } 0 THEN                       07502000
      BEGIN NT1~PUTORTAKE(MIX,[PRYOR[MIX]],0,PRIORITY);                 07503000
            B ~ PUTORTAKE(MIX,[JAR[MIX,2]],1,0);                        07503100
            B.[CF] ~ IF PRIORITY>32767 THEN 32767 ELSE PRIORITY;        07503200
            NT1 ~ PUTORTAKE(MIX,[JAR[MIX,2]],0,B);                      07503500
            STREAM(J~PUTORTAKE(MIX,[JAR[MIX,0]],1,0),                   07504000
                   I~PUTORTAKE(MIX,[JAR[MIX,1]],1,0),                   07504100
                        MIX,PRIORITY,BUFF);                             07504200
            BEGIN DS~10 LIT " PRIORITY=";                               07505000
                  SI~LOC PRIORITY; BUFF~DI; DS~6 DEC; DI~DI-6;          07506000
                  DS~5 FILL; DI~BUFF; DI~DI+6; DS~LIT":";               07507000
                  SI~LOC J;  2(SI~SI+1; DS~7CHR; DS~LIT"/"); DI~DI-1;   07508000
                  DS~LIT"="; SI~LOC MIX; DS~2DEC; DS~LIT"~";            07509000
                  DI~DI-3; DS~FILL;                                     07509500
      END   END;                                                        07510000
      SPOUT(BUFF);                                                      07511000
         IF STASUS[MIX] = RUNNING THEN                                  07511100
         IF MIX=P2MIX THEN PRYOR[P2MIX] ~ PRIORITY ELSE                 07511200
         BEGIN LINKR ~ BED1;                                            07511300
              DO IF NOT (B ~ LINKR[2]=MIX) THEN LINKR ~ LINKR[1]        07511400
                UNTIL B;                                                07511500
              LINKR[0] ~ (*P(DUP)) & (PRIORITY+64)[CTF];                07511600
         END;                                                           07511700
END CHANGEPRIORITY;                                                     07512000
PROCEDURE ENTERCONTROLDECK(H); VALUE H; ARRAY H[*];                     07541000
BEGIN REAL R,S,T,T1,T2;                                                 07542000
      INTEGER I;                                                        07543000
%                                                                       07544000
    LOCKCONTROLDECKS;                                                   07546000
      H[0]~"31";                                                        07548000
      STREAM(DATE,B~[H[3]]);                                            07549000
         BEGIN SI~LOC DATE;DS~8 OCT;DI~DI-8;DS~2 LIT"+7";END;           07549100
         T~"DECK   "&H[4][1:47:1];                                      07549150
         H[4]:=0&15[12:44:4];                                           07550000
         H[1]~(XCLOCK+P(RTR))&H[3][6:30:18];                            07550100
$ INCLUDE 07551001, IF SHAREDISK;                                       07550999
         H[4].[4:2]:=SYSNO;                                             07551000
    S:=LASTCDNUM:=LASTCDNUM MOD 9999+1;                                 07552000
      STREAM(X~@14:S);                                                  07553000
            BEGIN DI~LOC X; DI~DI+1; DS~LIT "#";                        07554000
                  SI~LOC S; DS~4 DEC; DS~LIT "~";                       07555000
            END;                                                        07556000
      S~P; H[2]~S;                                                      07557000
    ENTERUSERFILE(T,S,H.[CF]-1);                                        07558000
      T1~DIRECTORYFREE.[33:14];                                         07559000
    IF FIRSTDECK=0 THEN FIRSTDECK:=T1 ELSE                              07560000
      BEGIN LOCKDIRECTORY;                                              07561000
            I := SPACE(30);                                             07562000
            DISKWAIT(-I,30,LASTDECK);                                   07564000
            M[I+6].[CF]:=T1;                                            07565000
            DISKWAIT(I,30,LASTDECK);                                    07566000
            FORGETSPACE(I);                                             07567000
            UNLOCKDIRECTORY;                                            07568000
      END;                                                              07569000
    LASTDECK:=T1;                                                       07570000
    DISKWAIT(KLUMP,-3,DIRECTORYTOP+3);                                  07571000
    CDFREE~1;                                                           07572000
              IF RUNUMBER GTR 0 THEN STARTADECK(0);                     07573000
END ENTERCONTROLDECK;                                                   07575000
 BOOLEAN PROCEDURE MTXIN(I,U,BUFF);%                                    08000000
         REAL U,BUFF; INTEGER I;%                                       08001000
         BEGIN LABEL EXIT,X;%                                           08002000
              U ~ UNITIN(TINU,BUFF);                                    08003000
              BUFF ~ BUFF.[15:15]-1;                                    08004000
              IF U > 15 THEN%                                           08005000
                   BEGIN;STREAM(BUFF); DS ~ 8 LIT "INV KBD ";%          08006000
                        GO TO EXIT;%                                    08007000
                   END ELSE I ~ TWO(U);                                 08008000
              STREAM(A~TINU[U]:BUFF);%                                  08009000
                   BEGIN SI~LOC A; SI~SI+5; DS~LIT" "; DS~3 CHR;%       08010000
                        DS ~ LIT " "; A ~ DI;%                          08011000
                   END;%                                                08012000
              P([BUFF],~);%                                             08013000
              IF LABELTABLE[U] = @114 OR LABELTABLE[U] = @214 THEN%     08014000
                   BEGIN;STREAM(BUFF); DS ~ 10 LIT "NOT READY~";%       08015000
                        GO TO EXIT%                                     08016000
                   END;%                                                08017000
              IF LABELTABLE[U] < 0 THEN%                                08018000
                   BEGIN;STREAM(BUFF); DS ~ 7 LIT "IN USE~";%           08019000
                   END%                                                 08020000
              ELSE GO TO X;%                                            08021000
         EXIT:MTXIN ~ TRUE;%                                            08022000
         X:END;%                                                        08023000
 PROCEDURE TAPEPURGE(BUFF); VALUE BUFF; REAL BUFF;%                     08024000
         BEGIN LABEL EXIT;%                                             08025000
              REAL I,U;%                                                08026000
              REAL R,T;                                                 08027000
              BOOLEAN TEST;                                             08027100
              REAL WHAT = BUFF;%                                        08028000
              IF MTXIN(I,U,WHAT) THEN GO TO EXIT;%                      08029000
              STREAM(B:=BUFF,T~[T]);                                    08029015
              BEGIN SI:=B; SI:=SI+6;                                    08029020
              IF SC="-" THEN                                            08029025
                 BEGIN SI:=SI+1;                                        08029030
                 5(IF SC="~" THEN JUMP OUT;                             08029035
                   TALLY:=TALLY+1;SI:=SI+1);                            08029040
                 B:=TALLY; SI:=SI-B; DS:=B OCT;                         08029045
                 END;                                                   08029050
              END;                                                      08029055
              LABELTABLE[U] ~ -@14;                                     08029100
              IF WAITIO(@500000000,@120,U) ! 0 THEN%                    08030000
                   BEGIN; STREAM(BUFF); DS ~ 11 LIT "WRITE LOCK~";%     08031000
                        LABELTABLE[U] ~ @114;                           08031100
                        GO TO EXIT;%                                    08032000
                   END;%                                                08033000
              IF T=0 THEN                                               08033980
              BEGIN T:=PRNTABLE[U].[30:18]; TEST:= TRUE END;            08033990
              STREAM(A:=T,BUFF);                                        08034000
                   BEGIN DI ~ DI + 3; DS ~ 8 LIT " LABEL  ";            08035000
                        8(DS~2 LIT "0X");                               08035100
                        24(DS~2 LIT "0"); DS~2 LIT "}~";                08036000
                        DI ~ DI-21; SI ~ LOC A; DS ~ 5 DEC;%            08037000
                   END;%                                                08038000
              RRRMECH ~ I OR RRRMECH;%                                  08039000
                                                                        08040000
              MULTITABLE[U] ~ 0;%                                       08041000
              P(WAITIO(@4200000000,0,U),DEL);%                          08042000
              R ~ WAITIO(BUFF INX @120500000001,@2000000,U) OR%         08043000
                   WAITIO(BUFF INX 10,@2000000,U);%                     08044000
              IF MOD3IOS THEN                                        %AI08044500
                   DO UNTIL P(WAITIO(BUFF INX @340000012,@50,U))=@10 %AI08044600
              ELSE                                                   %AI08044700
              P(WAITIO(@4200000000,0,U),DEL);%                          08045000
              SLEEP([TOGLE],STATUSMASK);                                08046000
              RRRMECH ~ RRRMECH AND NOT I;%                             08047000
              READY ~ READY AND NOT I;%                                 08048000
              IF R = 0 THEN BEGIN%                                      08049000
              LABELTABLE[U] ~ @114;%                                    08050000
         IF  TEST THEN BEGIN STREAM(BUFF);DS:=6LIT"PG-ED~";END          08051000
         ELSE BEGIN STREAM(A:=T,B:=PRNTABLE[U].[30:18],BUFF);           08051010
                    BEGIN DS:=10LIT"PG-ED(PRN=";                        08051020
                    SI:=LOC A; DS:=5 DEC;                               08051030
                    DS:=5LIT",WAS ";                                    08051040
                    SI:=LOC B; DS:=5 DEC;DS:=2LIT")~";                  08051050
                    END;                                                08051060
              END;                                                      08051070
         EXIT:SPOUT(BUFF);                                              08052000
              END ELSE BEGIN%                                           08053000
                   LABELTABLE[U] ~ @214;%                               08054000
                   FORGETSPACE(BUFF);%                                  08055000
              END;%                                                     08056000
         END;%                                                          08057000
 PROCEDURE MIXPRINT(BUFF); VALUE BUFF; REAL BUFF;%                      08058000
         BEGIN REAL C,I,T;                                              08059000
     REAL RCW=+0;                                                   %DS%08059025
              FOR I ~ 1 STEP 1 UNTIL MIXMAX DO%                         08060000
                   IF JAR[I,*] ! 0 THEN%                                08061000
                        BEGIN                                           08062000
                        IF T THEN BUFF.[CF] := SPACE(4);                08062050
                        IF (C:=PUTORTAKE(I,[PRYOR[I]],1&1[2:47:1],0)) ! 08063000
                        NOT 0 THEN STREAM(C,                            08063050
                                    J:=PUTORTAKE(I,[JAR[I,0]],1,0),     08063100
                                    K:=PUTORTAKE(I,[JAR[I,1]],1,0),     08063200
                                    I,BUFF);                            08064000
                                  BEGIN SI~LOC C; DS~6 DEC;             08065000
                                        DI~DI-6; DS~5 FILL;             08065100
                                        DI~BUFF; DI~DI+6; DS~LIT ":";   08065200
                                        SI~LOC J;  2(SI~SI+1;           08066000
                                          DS~7 CHR; DS~LIT"/"); DI~DI-1;08067000
                                       DS ~ LIT "="; SI ~ LOC I;%       08068000
                                       DS~2DEC; DS~LIT"~";              08069000
                                       DI~DI-3; DS~FILL;                08069500
                                  END                                   08070000
                                  ELSE STREAM(I,BUFF);                  08070100
                                  BEGIN DS:=4 LIT"MIX ";                08070200
                                       SI:=LOC I; DS:=2 DEC;            08070300
                                       DS:=9 LIT" IS HUNG~";            08070400
                                       DI:=DI-11; DS:=2 FILL;           08070500
                                  END;                                  08070600
                             SPOUT(BUFF);%                              08071000
                             T ~ 1;%                                    08072000
                        END;%                                           08073000
              IF T THEN                                                 08074000
              BEGIN STREAM(B:=BUFF:=SPACE(4)); DS:=7 LIT"END MX~"; END  08075000
              ELSE STREAM(BUFF); DS:=9 LIT"NULL MIX~";                  08076000
              SPOUT(BUFF);                                              08077000
          KILL([RCW] INX NOT 2);                                    %DS%08077100
         END;%                                                          08078000
 PROCEDURE REWINDANDLOCK(WHAT); VALUE WHAT; REAL WHAT;%                 08079000
         BEGIN REAL BUFF=WHAT,U;%                                       08080000
              INTEGER I;%                                               08081000
              LABEL EXIT;%                                              08082000
              IF MTXIN(I,U,BUFF) THEN GO TO EXIT;%                      08083000
              RRRMECH ~ RRRMECH OR I;%                                  08084000
              LABELTABLE[U] ~ -@14;%                                    08085000
              MULTITABLE[U] ~ 0;%                                       08086000
              P(WAITIO(@4200000000,0,U),DEL);%                          08087000
              SLEEP([TOGLE],STATUSMASK);                                08088000
              RRRMECH ~ RRRMECH AND NOT I;%                             08089000
              READY ~ READY AND NOT I;%                                 08090000
              LABELTABLE[U] ~ @214;%                                    08091000
              STREAM(BUFF); DS ~ 5 LIT "RW/L~";%                        08092000
         EXIT:SPOUT(BUFF);                                              08093000
         END;%                                                          08094000
PROCEDURE GIMEDATE(B,DT); VALUE B,DT; REAL B,DT; FORWARD;           %RH 08094500
PROCEDURE PRINTDIRECTORY(BUFF);                                     %DS%08095000
                    VALUE BUFF; REAL BUFF;                          %DS%08095100
    BEGIN ARRAY HDR[*],NB[*];                                       %10408096000
     REAL CODE, RCW=+0;                                             %DS%08096100
    DEFINE LFT=LEFTARROW#;%%                                        %10408096200
         REAL STA,A,B,C,T,CR,N;                                         08097000
     REAL INFOTYPE,INFO,INFOTEMP;                                   %RH 08097100
     LABEL GETADATE,INFOUT;                                         %RH 08097200
         INTEGER I,J;                                                   08098000
         LABEL GETHDR,IN,OUT,AROUND;                                    08098100
         ARRAY D=NB[*];                                             %10408098200
    REAL USERID,PG;                                                     08098300
     NAME ADDR;                                                         08098400
     INTEGER J1,J2,J3,K1,K2;                                            08098500
     SUBROUTINE FINDWHATINFO;                                       %RH 08099000
          BEGIN                                                     %RH 08099100
               IF INFOTYPE="DATE   " THEN                           %RH 08099200
               BEGIN                                                %RH 08099210
                    INFOTEMP:=HDR[3].[30:18]&1[1:43:5];             %RH 08099220
                    GO GETADATE;                                    %RH 08099230
               END ELSE                                             %RH 08099240
               IF INFOTYPE="LAST   " THEN                           %RH 08099300
               BEGIN                                                %RH 08099310
                    INFOTEMP:=HDR[3].[12:18]&2[1:43:5];             %RH 08099320
                    GO GETADATE;                                    %RH 08099330
               END ELSE                                             %RH 08099340
               IF INFOTYPE="RECS   " THEN                           %RH 08099400
               BEGIN                                                %RH 08099410
                    INFO:=(HDR[7]+1)&3[1:43:5];                     %RH 08099420
                    GO TO INFOUT;                                   %RH 08099430
               END ELSE                                             %RH 08099440
               IF INFOTYPE="SIZE   " THEN                           %RH 08099500
               BEGIN PG:=HDR[9] AND @37;                            %RH 08099510
                    INFO:=0; WHILE (INFO:=INFO+1) LEQ PG DO IF      %RH 08099520
                    HDR[INFO+9]!0 THEN INFOTEMP:=INFOTEMP+1;        %RH 08099530
                    INFO:=(INFOTEMP|HDR[8])&4[1:43:5]; INFOTEMP:=0; %RH 08099540
                    GO TO INFOUT;                                   %RH 08099550
               END;                                                 %RH 08099560
               GO TO INFOUT;                                        %RH 08099570
          GETADATE:                                                 %RH 08099700
               STREAM(A:=INFOTEMP.[30:18],I:=[INFO]);               %RH 08099710
               BEGIN SI:=LOC A;DS:=8 DEC END;                       %RH 08099720
               GIMEDATE([INFO].[CF],-INFO);                         %RH 08099730
               INFO.[1:5]:=INFOTEMP.[1:5];                          %RH 08099740
          INFOUT:                                                   %RH 08099750
               P(DEL);                                              %RH 08099760
               GO TO IN;                                            %RH 08099770
          END;                                                      %RH 08099800
     CODE := BUFF.[9:6];                                            %DS%08099900
         BUFF~(C~BUFF).[15:15]-1;                                       08100000
     NB:=[M[SPACE(60)]]&60[8:38:10];                                    08101300
         NAMEID(A,C);                                                   08102000
         NAMEID(B,C); IF B="/      " THEN NAMEID(B,C);                  08102100
         NAMEID(INFOTYPE,C);                                        %RH 08102200
         C:=0;                                                          08103000
     IF ((A EQV B)=NOT 0) AND((A EQV "~      ")=NOT 0) THEN GO OUT;     08103100
     IF (A EQV "~~     ")=NOT 0 THEN A~"~      ";                       08103200
     IF (B EQV "~~     ")= NOT 0 THEN B~"~      ";                      08103300
     J1:=J3:=0; K1:=K2:=MODULUS-1;                                  %10408103400
     IF CODE!3 THEN                                                     08103450
    BEGIN                                                               08103460
     IF A.[6:6] NEQ LFT THEN J1:=K1:=(A.[6:18]+A.[24:24]) MOD MODULUS;  08103500
     IF B.[6:6] NEQ LFT THEN J3:=K2:=(B.[6:18]+B.[24:24]) MOD MODULUS;  08103600
    END;                                                                08103650
     IF ((INFOTYPE EQV "~      ")! NOT 0 AND CODE=0) THEN CODE:=5;  %RH 08103700
     IF CODE!0 OR (CODE=0 AND STA.[9:9]!0) THEN                     %RH 08103800
     HDR:=IOQUE&SPACE(30)[CTC];                                     %RH 08103900
     FOR J1:=J1 STEP 1 UNTIL K1 DO                                  %10408104000
     FOR J2:=J3 STEP 1 UNTIL K2 DO                                  %10408104100
     BEGIN J:=SCRAMBLE(J1,J2);                                      %10408104200
     DO BEGIN                                                       %10408104300
         BEGIN DISKWAIT(-NB.[CF],60,J);                             %10408105000
              FOR I:=0 STEP 3 UNTIL 57 DO                           %10408107000
% VOID                                                              %10408108000
              IF (T:=NB[I]) NEQ @14 THEN                            %10408109000
              IF CODE=3 THEN COMMENT UD; GO GETHDR ELSE                 08110000
              IF (T EQV A)= NOT 0 OR (A EQV "~      ")= NOT 0 THEN      08111000
              IF(NB[I+1]EQV B)=NOT 0 OR(B EQV"~      ")=NOT 0 THEN      08112000
          IF CODE=0 AND USERID=0 THEN GO TO IN ELSE                     08113000
 GETHDR:      BEGIN T:=HDR.[CF]&NB[I+2][CTF];                       %10408114000
                   DISKWAIT(-T.[CF],30,T.[FF]);                         08115000
                   IF CODE=5 THEN FINDWHATINFO;                     %RH 08115060
               IF CODE=0 THEN IF SECURITYCHECK(NB[I],NB[I+1],USERID,T  )08115100
               !0 THEN GO TO IN ELSE GO TO AROUND;                      08115200
                   IF CODE=1 THEN COMMENT EX;                           08116000
                   BEGIN;                                               08116700
                        STREAM(A~CALCULATEPURGE(-HDR[3].[2:10]),B~[PG]);08116800
                        BEGIN SI~LOC A;DS~8 OCT END;                    08116900
                        IF PG>HDR[3].[12:18]                            08117000
                            THEN GO IN ELSE GO AROUND;                  08117100
                   END;                                                 08117105
                   IF ((NB[I]EQV "DECK   ")=NOT 0) AND                  08117110
                        (((NB[I+1]AND @77000000007777) EQV              08117120
                        @12000000003714)=NOT 0) OR                      08117130
         FALSE THEN GO AROUND; %                                        08117140
                   IF CODE=4 THEN COMMENT SB;                           08117200
                   IF HDR[5]=12 THEN GO AROUND;  N~HDR[6];              08117300
                   IF CODE}2 THEN COMMENT UD,CR,SB;                     08117400
                        IF(NOT(CR:=HDR[IF CODE=4 THEN 5 ELSE 2].[6:42]))08117500
                             =NOT 0 THEN GO AROUND;                     08117600
                   IF CODE=3 THEN COMMENT UD;                           08117700
                        IF(CR EQV A)!NOT 0 AND(A EQV "~      ")!NOT 0   08117800
                             THEN      GO TO AROUND;                    08117900
 IN:               BEGIN C := SPACE(10);                                08118000
                        STREAM(F:=[D[I]],CR,N,X:=(CODE}2 AND CODE<5),   08119000
                               Y:=CODE=4,INF:=CODE=5,INFO,INFNO:=   %RH 08119100
                               INFO.[1:5],C);                       %RH 08119200
                        BEGIN SI:=F; DS:=LIT" "; SI:=SI+1; DS:=7 CHR;   08120000
                             SI:=SI+1; DS:=LIT"/"; DS~7 CHR;            08121000
                            Y(DS:=8 LIT" SECURED";);                    08122000
                            X(DS:=4 LIT" BY "; SI:=LOC CR; SI~SI+1;     08123000
                              DS:=7 CHR);                               08124000
                            Y(DS:=LIT"/"; SI:=SI+1; DS:=7 CHR);         08125000
                            INF(CI:=CI+INFNO;GO ERR;GO INF1;GO INF2;    08125100
                                GO INF3;GO INF4;                    %RH 08125110
                                INF1:                               %RH 08125120
                                DS:=10LIT" CREATED: ";              %RH 08125130
                                DATE: SI:=LOC INFO;                 %RH 08125140
                                SI:=SI+2;DS:=2 CHR;2(DS:=LIT"/";    %RH 08125150
                                DS:=2 CHR);GO INFEND;               %RH 08125160
                                INF2:                               %RH 08125200
                                DS:=11LIT" ACCESSED: ";GO DATE;     %RH 08125210
                                INF3:                               %RH 08125300
                                DS:=10LIT" RECORDS: ";              %RH 08125310
                                DECM:                               %RH 08125320
                                SI:=LOC INFO;DS:=5 DEC;X:=DI;       %RH 08125330
                                DI:=DI-5;DS:=4 FILL;DI:=X;          %RH 08125340
                                GO INFEND;                          %RH 08125350
                                INF4:                               %RH 08125400
                                DS:=11LIT" SEGMENTS: ";GO DECM;     %RH 08125410
                                ERR: INFEND:);                      %RH 08125420
                             DS:=LIT"~";                                08126000
                        END;                                            08127000
                        SPOUT(C);                                       08128000
 AROUND: END; END; END;                                                 08129000
     END UNTIL (J:=NB[2].[FF])=0;                                   %10408129100
     END;                                                           %10408129200
 OUT:    FORGETSPACE(NB);                                               08130000
         IF CODE!0 THEN FORGETSPACE(HDR);                               08130100
         IF C = 0 THEN                                                  08131000
         BEGIN M[BUFF]:=FLAG(NABS("NULL   "));                          08132000
              SPOUT(BUFF);                                              08133000
         END ELSE FORGETSPACE(BUFF);                                    08134000
          KILL([RCW] INX NOT 2);                                    %DS%08134100
    END PRINTDIRECTORY;                                                 08135000
 PROCEDURE INFOMSGS;                                                    08137000
         BEGIN LABEL L;%                                                08138000
              P(XIT,.L,DEL);%                                           08139000
         L::: "PG",     % 1%                                            08140000
              "MX",     % 2%                                            08141000
              "DD",     % 3%                                            08142000
              "RW",     % 4%                                            08143000
              "PD",     % 5%                                            08144000
              "DB",     % 6%                                            08145000
              "DP",     % 7%                                            08146000
              "DT",     % 8%                                            08147000
              "DS",%9%                                                  08148000
              "CE",  % 10    STARTS CANDY                               08149000
             "RS", %11%                                                 08150000
             "EI", %12%                                                 08151000
             "CC", %13%                                                 08152000
              "PB",     %14%                                            08153000
              "RY",%15%                                                 08154000
              "TR",    %16%                                             08155000
              "OL",%17;%                                                08156000
              "LN",  %18%                                               08157000
              "WD",%19%                                                 08158000
              "WT",%20%                                                 08159000
              "LR",%21%      EXECUTE REMOTE LOG ANALYZER                08160000
              "RO",%22%                                                 08161000
              "SO",%23%                                                 08162000
              "TO",%24%                                                 08163000
              "SV",%25%                                                 08164000
              "LD",%26%                                                 08165000
              "CD",%27%                                                 08166000
              "RD",%28%                                                 08167000
              "RN",%29%                                                 08168000
              "ED",%30                                                  08168010
              "CI",%31       CHANGE INTRINSIC FILE ON DISK              08168020
              "TF",%32%      TYPE OUT MULTIPROCESSING FACTOR            08168030
              "SF",%33%      CHANGE MULTIPROCESSING FACTOR              08168040
              "TS",%34%      TYPE OUT SCHEDULE (NAMES IN SHEET)         08168050
              "RR",%35  REMOVE REMOTE SPO INDICATORS FROM STATION       08168060
              "QV",%36  SET OR TYPE "Q VALUE" FOR DCOM R/R TIME-OUT     08168070
              "EX",%37                                                  08168080
              "PI",%38                                                  08168090
              "ES",%39       ELIMINATE SCHEDULE TASK                    08168100
              "XS",%40       RELINK SCHEDULE TASK                       08168110
              "SS",%41       STATION-TO-STATION MESSAGE                 08168120
              "SM",%42       START MIX MESSAGES                         08168130
              "BS",%43       BEGIN SPOPO                                08168140
              "US",%44       RESET SPO                                  08168150
              "SC",%45       TYPE SPO CONSOLES                          08168160
              "BO",%46                                                  08168170
              "CX",%47  CANDE ACCEPT                                    08168180
              "MF",%48       SET UP TO MOVE FENCE AT NEXT H/L           08168190
              "WU",% 49                                                 08168200
              "LF",%50                                                  08168210
              "LC",%51                                                  08168220
              "LS",%52                                                  08168230
              "CM",%53     CHANGE MCP                                   08168240
              "WR",%54       REMOTE-LOG PRESENT                         08168250
              "WM",%55       WHAT MCP                                   08168260
              "CL", %   DS JOB USING UNIT                               08168300
              "QT",%    QT BY UNIT                                      08168310
              "BK", % BREAK FOR SPO                                     08168320
              "MR",%59       RESERVE DISK FOR NO USER DISK              08168330
         "WI", % 60   WHAT INTRINSIC                                    08168340
             "SY", % CREATE NEW STATISTICS FILE                         08168350
             "SI", % SET STATISTICS INTERVAL TIMER                      08168360
              "XD",% CREATE BADISK AREA                                 08168370
              "DC",% CHANGE CODE OR NIF FILE FOR DCP                    08168380
              "MC", %MAKE A COMPILER                                    08168390
              "~~";%                                                    08169000
         END;%                                                          08170000
 PROCEDURE PBIO(A,P); VALUE A; REAL A,P; FORWARD;                    %P 08170100
 PROCEDURE CONTINUITYBIT;%                                              08171000
         BEGIN REAL T,IOD,LINK,U;%                                      08172000
              ARRAY A[*];                                               08172500
              REAL RCW=+0;%                                             08173000
                            ARRAY R=-4[*];  DEFINE FIB=A#;           %P 08173100
              CHECKSTACKSPACE;%                                     %WF 08173200
              U ~(LINK ~ NFLAG(M[(IOD ~ NFLAG(M[T~PRT[P1MIX,9]]) INX%   08174000
                   P(0,LNG,XCH)) INX NOT 0])).[12:6];%                  08175000
              IF U } 32 THEN                                            08175100
                   BEGIN A ~ M[T];                                      08175200
                        IF READEMFROMDISK(CIDROW[U-32],A) THEN          08175300
                             M[T] ~ A&1[27:47:1]&0[2:47:1] ELSE         08175400
                             M[T] ~ R; GO TO RETURN;                    08175500
                   END;                                                 08175600
              M[IOD INX NOT 1]~FLAG(LINK); FIB~M[T-3];               %P 08176000
              M[FIB[14]INX 17]~[M[FIB[5].[FF]]]&IOD[3:3:30]&0[20:20:1]; 08177000
             ;FIB[5]~P(DUP,LOD,0,1,CFX,ADD);                         %P 08177100
              IF FIB[14].[FF]{FIB[14].[CF] THEN  %% BUFFER FULL      %P 08177200
                        PBIO(T,FIB[14])                              %P 08178000
                    ELSE                                             %P 08179000
              BEGIN; STREAM(A~FIB[14].[CF], B~FIB[14].[FF]);         %P 08179600
                     BEGIN SI~A; DS~18 WDS END;                      %P 08179700
                   FIB[14].[FF]~FIB[14].[FF]-18;                     %P 08179800
              END;                                                   %P 08179900
              GO RETURN                                              %P 08180000
         END CONTINUITYBIT;                                          %P 08181000
DEFINE PRINTWAIT(PRINTWAIT1)=PRINTORPUNCHWAIT(PRINTWAIT1,0)#;           08254000
BOOLEAN PROCEDURE PRINTORPUNCHWAIT(Q,PNCH);VALUE Q,PNCH;REAL Q,PNCH;    08255000
     BEGIN INTEGER U,V,I,J,S;                                           08255500
         NAME D;                                                        08256000
         LABEL FOUND,QUIT;                                              08256500
          IF(S~DIRECTORYSEARCH("PRNPBT ","DISK   ",5))=0 THEN GO QUIT;  08256600
         IF Q}(-15) THEN  %%% PB GIVEN: LOOK FOR LP.                    08257000
         BEGIN IF PNCH THEN IF LABELTABLE[V~22]!0 THEN V~0 ELSE ELSE    08257500
              IF LABELTABLE[V~20]!0 THEN                                08257600
              IF LABELTABLE[V~21]!0 THEN V~0;                           08258000
              IF V!0 THEN IF Q>0 THEN STREAM(Q~[Q],U~[U]);              08258500
              BEGIN SI~Q; DS~8 OCT END ELSE                             08259000
              LABELTABLE[U~ABS(Q) OR @40000].[1:5]~16;                  08259500
         END ELSE                                                       08260000
         BEGIN V~ABS(Q);                                                08260500
              FOR I~0 STEP 1 UNTIL 15 DO                                08261000
              IF (((MULTITABLE[I] EQV "PBTMCP ")=NOT 0 AND V!22) OR     08261500
                  ((MULTITABLE[I] EQV "PUTMCP ")=NOT 0 AND V=22)) THEN  08261600
              IF ((LABELTABLE[I] EQV @222212342546447)=NOT 0) OR        08262000
                 ((LABELTABLE[I] EQV @122212342546447)=NOT 0) AND       08262500
                 AUTOPRINT THEN                                         08263000
              BEGIN LABELTABLE[U~I].[1:5]~@20;                          08263500
                   RRRMECH~TWO(U) OR RRRMECH;                           08264000
                                                                        08264500
                   I~16; U~U+@40000                                     08265000
              END SEARCHING FOR TAPE;                                   08266000
              IF U=0 AND AUTOPRINT AND PBCOUNT!0 THEN                   08267000
              BEGIN D := [M[SPACE(61)]];                                08267500
                   LOCKDIRECTORY;                                       08268000
                   FOR J~DIRECTORYTOP+19 STEP 16 WHILE TRUE DO          08268500
                   BEGIN DISKWAIT(-D.[CF],30,J);                        08269000
                        FOR Q~28 STEP -2 UNTIL 0 DO                     08269100
                        IF(D[Q] EQV@114)=NOT 0 THEN                     08269200
                        BEGIN UNLOCKDIRECTORY;                          08269300
                             FORGETSPACE(D); PBCOUNT:=0;                08269310
                             GO QUIT;                                   08269320
                        END ELSE                                        08269400
                        IF(((D[Q] EQV"PBD    ")=NOT 0) AND (V!22)) OR   08269500
                          (((D[Q] EQV"PUD    ")=NOT 0) AND (V=22)) THEN 08269550
                        IF D[Q+1].[CF]=1 THEN                           08269600
                        BEGIN DISKWAIT(-(D INX 31),30,J-(30-Q) DIV 2);  08269700
                             IF D[35].[1:3]!0 OR D[35].[16:20]!0        08269900
                                  OR D[35].[6:1]                        08269940
                                  OR D[40].[1:28]!0 THEN ELSE           08269950
                             BEGIN D[35].[6:1]:=1;PBCOUNT:=PBCOUNT-1;   08270000
                                  DISKWAIT(D INX 31,30,J-(30-Q) DIV 2); 08270100
                                  STREAM(D~D[Q+1],U~[U]);               08270200
                                  BEGIN SI~LOC D; DS~5 OCT END;         08270300
                                  GO FOUND;                             08270400
                   END; END; END;                                       08270500
    FOUND:        UNLOCKDIRECTORY; FORGETSPACE(D);                      08270600
              END SEARCHING FOR DISK;                                   08270700
         END; IF U!0 AND V!0 THEN                                       08270800
         BEGIN LABELTABLE[V]~@2147513145632551;                         08270850
              I ~ GETSPACE(15,64,0)+4;                                  08270900
                    STREAM(A~U&V[18:33:15],I);%                         08271000
                        BEGIN DS~19 LIT "CC RUN PRNPBT/DISK;";          08272000
                             DS ~ 7 LIT "COMMON="; SI ~ LOC A;%         08273000
                             DS~6 DEC;                                  08274000
                        DS~27LIT";STACK=150;PRIORITY=0;END. ";%     %WF 08275000
                             7(DS~2 LIT " ");                           08275100
                        END;%                                           08276000
                   FREECARD(I&31[3:43:5]);                              08277000
                   PRINTORPUNCHWAIT~TRUE;                               08277100
                   END ELSE                                             08278000
                                                                        08279000
    QUIT: IF V!0 THEN LABELTABLE[V]~0;                                  08280000
         IF S!0 THEN FORGETSPACE(S);                                    08280100
         END PRINTWAIT;%                                                08281000
    PROCEDURE PRINTBACKUP(BUFF); VALUE BUFF; REAL BUFF;              %P 08282000
    BEGIN REAL U,I;  REAL B=BUFF;                                    %P 08283000
          LABEL S,T,F;                                                  08284000
          STREAM(N~0:B~BUFF);                                        %P 08285000
          BEGIN SI~B; DI~LOC N;                                      %P 08286000
          L:  IF SC=" " THEN BEGIN SI~SI+1; GO TO L END;             %P 08287000
              IF SC<"0" THEN BEGIN DS~5 LIT"+0000"; DS~3 CHR END ELSE%P 08288000
              BEGIN        ; N~SI;                                   %P 08289000
                   4(IF SC<"0" THEN JUMP OUT; TALLY~TALLY+1; SI~SI+1);  08289500
                   SI~N; B~TALLY; DS~B OCT; SI~SI-B; DI~DI-3; DI~DI-B;  08290000
                   DS~B CHR;                                         %P 08290500
          END;END;                                                   %P 08291000
          IF (U~P)<0 THEN                                            %P 08291500
          BEGIN IF NOT MTXIN(I,U,B   ) THEN                             08292000
                                                                        08293000
               IF MULTITABLE[U]!"PBTMCP " AND MULTITABLE[U]!"PUTMCP "   08293500
               THEN                                                     08293600
               BEGIN; STREAM(BUFF);                                     08294000
               DS~29 LIT "NOT PRINT/PUNCH BACK-UP TAPE~";               08294100
    S:             SPOUT(BUFF)                                       %P 08294500
               END ELSE                                               %P08295000
               IF PRINTORPUNCHWAIT(-U,MULTITABLE[U]="PUTMCP ") THEN     08295500
               GO F ELSE GO T ELSE GO S                                 08295600
          END ELSE  BEGIN BUFF~BUFF.[15:15]-1;                       %P 08296000
                IF(I~DIRECTORYSEARCH("PBD    ",U&1[CTC],5))=0 THEN      08296400
                IF(I~DIRECTORYSEARCH("PUD    ",U&1[CTC],5))=0 THEN GO S 08296500
                 ELSE I.[3:1]~1;                                        08296550
                   IF PBCOUNT<1 THEN PBCOUNT~1;                         08296600
              FORGETSPACE(I);IF PRINTORPUNCHWAIT(U.[6:24],I.[3:1]) THEN 08297000
 F:                FORGETSPACE(BUFF) ELSE                               08297200
 T:           BEGIN M[BUFF]~FLAG(-"NULL   "); GO TO S END               08297500
    END;  END PRINTBACKUP KEYBOARD MESSAGE HANDLER;                  %P 08298000
 PROCEDURE TIMEOUT (B); VALUE B; REAL B;%                               08305000
         BEGIN INTEGER M,H,C;%                                          08306000
              C ~XCLOCK/3600;%                                          08307000
              M ~ C MOD 60;%                                            08308000
              H ~ C DIV 60;%                                            08309000
              STREAM(H,M,B);%                                           08310000
                   BEGIN DS ~ 9 LIT " TIME IS ";%                       08311000
                        SI ~ LOC H; DS ~ 2 DEC; DS ~ 2 DEC;%            08312000
                        DS ~ LIT "~"%                                   08313000
                   END;%                                                08314000
              IF SWAPEND!0 THEN CHANGEDATE(0);                          08315000
              SPOUTIT(B,TIMEK);                                         08315100
         END;%                                                          08316000
PROCEDURE GIMEDATE(B,DT); VALUE B,DT; REAL B,DT;                        08317000
    %% PARAMETER USE IS:                                                08317100
       %% B=OUTPUT AREA FOR MESSAGE OR DATE                             08317200
       %%DT=0 RECONVERT ACTDATE,WEEKDAY THEN SPOUT TIME MSG             08317300
       %% DT>0 SPOUT TIME MSG ONLY                                      08317400
       %% DT<0 CONVERT MMDDYY USING DT (ACTDATE,WEEKDAY NOT CHANGED)    08317500
         BEGIN  REAL M,D,Y,NCV,NMG;                                     08318000
              REAL SUBROUTINE DAY;                                      08318100
              BEGIN;STREAM(M:X~0,Y~0,Z~0);                              08318200
                    BEGIN DI~LOC X; DS~24 LIT"000~0%1.1Y2G2V3D3T4A4 5>";08318300
                          SI~LOC X; SI~SI+M; SI~SI+M;                   08318400
                          DI~LOC M; DI~DI+6; DS~2 CHR;                  08318500
                    END;                                                08318600
                    DAY~P;                                              08318700
              END DAY;                                                  08318800
              LABEL DAYS;                                               08318900
              LABEL ON;;%                                               08319000
              IF NOT (NCV~(DT>0))  THEN   % NOT PRINT ONLY              08319700
              BEGIN                                                     08319900
         STREAM(DATE:=IF (NMG:=DT.[1:1]) THEN DT ELSE DATE,R:=[Y]);     08320000
                   BEGIN SI ~ LOC DATE; SI ~ SI+3;%                     08321000
                        DS~2 OCT; DI~DI-16; DS~3 OCT;                   08322000
                   END;%                                                08323000
              IF Y MOD 4 = 0 AND Y ! 0 THEN%                            08324000
                   BEGIN IF D = 60 THEN%                                08325000
                                 BEGIN M~2; GO ON END;                  08326000
                        IF D > 60 THEN D ~D-1;%                         08327000
                   END;%                                                08328000
              FOR M~1 STEP 1 UNTIL 11 DO                                08329000
                   IF DAY}D THEN GO ON;                                 08330000
         ON:  M~M-1;                                                    08331000
              D~D-DAY;                                                  08332000
              IF M<2 THEN P(Y-1,M+11) ELSE P(Y,M-1);                    08332100
              P(26,|,2,-,10,IDV,D,+,XCH,P(DUP).[36:10],+,+,7,RDV,5,ISN);08332200
              :: P(.DAYS,+,LOD);                                        08332300
              M~M+1;                                                    08332400
              END ELSE P(WEEKDAY);                                      08332500
              STREAM(M~[M],NMG,NCV,MDY~[ACTDATE],B,DW~[WEEKDAY]);       08333000
                   BEGIN  NMG(JUMP OUT TO NOMSG);                       08334000
                        SI~LOC M; SI~SI-16;                             08334100
                        NCV(SI~SI+2; JUMP OUT TO NOCNV);                08334300
                        DS~WDS; SI~SI-6;                                08334500
    NOCNV:              DI~B; DS~9 LIT" DATE IS "; DS~6 CHR;            08334700
                        DS~5 LIT"DAY, "; B~DI; NCV(JUMP OUT TO NULCV);  08334900
    NOMSG:              SI~M; NMG(DI~B; JUMP OUT TO NULMS);             08335000
                        DI~MDY;                                         08335200
    NULMS:              DS~4 DEC; DS~2 DEC; DS~2 DEC;                   08335400
                        NMG(JUMP OUT TO OXIT);  DI~B;                   08335600
    NULCV:              SI~MDY; SI~SI+2;                                08335800
                        DS~2 CHR; 2(DS~LIT "/"; DS~2 CHR);              08336000
                        DS ~ LIT "~"; SI ~B;%                           08337000
                        3(DI ~ B; DS ~ FILL; SI ~ SI+3; B ~SI);%        08338000
    OXIT:          END;                                                 08339000
                                                                        08339100
              IF NOT NMG THEN SPOUTIT(B,DATEK);                         08340000
              P(XIT);                                                   08340100
    DAYS:::   "   MON","  TUES","WEDNES"," THURS","   FRI"," SATUR",    08340200
              "   SUN";                                                 08340300
         END;%                                                          08341000
PROCEDURE DISKLOG(MID,FID,H); VALUE MID,FID,H;REAL MID,FID;ARRAY H[*];  08341100
BEGIN                                                                   08341120
    INTEGER HRS,MIN,SEC,SIX;  %  DO NOT CHANGE ORDER                    08341140
    REAL SEG,T,DT;                                                      08341160
    FOR T~10 STEP 1 UNTIL (H[9]+9) DO                                   08341200
    IF H[T]!0 THEN SEG~SEG+H[8];                                        08341220
    SIX~(T~H[1].[25:23]) MOD 60;                                        08341280
    SEC~(T DIV 60) MOD 60;                                              08341300
    MIN~(T DIV 3600) MOD 60;                                            08341320
    HRS~T DIV 216000;                                                   08341340
    T~GETSPACE(10,0,0)+2;                                               08341360
    STREAM(A~H[1].[6:18],D~[DT]);                                       08341380
    BEGIN SI~LOC A; DS~8 DEC END;                                       08341400
    GIMEDATE([DT].[CF],-DT);                                            08341420
    STREAM(DT,TIME~[HRS],FN~[MID],USER~[H[2]],SEG~[SEG],T);             08341440
    BEGIN DS~LIT " "; SI~FN; SI~SI+1;                                   08341460
         DS~7 CHR; DS~LIT "/"; SI~SI+1; DS~7 CHR; DS~LIT "/";           08341480
         SI~USER; SI~SI+1; DS~7 CHR; DS~LIT "="; SI~SEG;                08341500
         DS~8 DEC; SEG~DI; DI~DI-8; DS~7 FILL; DI~SEG;                  08341520
         DS~15 LIT " SEGS--CREATED "; SI~LOC DT;                        08341530
         SI~SI+2; DS~2 CHR; 2(DS~LIT "/"; DS~2 CHR);                    08341540
         DS~4 LIT" AT "; SI~TIME; DS~2 DEC; DS~LIT":";                  08341560
         DS~2 DEC; DS~LIT":"; DS~2 DEC; DS~LIT":"; DS~2 DEC; DS~LIT"~"; 08341580
    END;                                                                08341600
    IF MID.[6:12] GTR 9 AND  % NOT 01SLLL, MAYBE 1SLLL -            %11208341610
      (MID.[6:6] GTR 9 OR MID.[6:6] =0) THEN% NAME OR 0NAME.        %11208341612
       SPOUTIT(T,DISKLOGGER+DKLOG) ELSE FORGETSPACE(T);             %11208341620
    H[1]:=XCLOCK+P(RTR);                                            %11208341622
    STREAM(D:=[DATE],H:=[H[1]],T:=0);                               %11208341624
    BEGIN SI:=D; DI:=LOC T; DS:=8 OCT; SI:=LOC T;                   %11208341626
          SI:=SI+5;  DI:=H; DI:=DI+1;  DS:=3 CHR;                   %11208341628
    END  STREAM;                                                    %11208341630
END;                                                                    08341640
DEFINE DATEOUT(DATEOUT1)=GIMEDATE(DATEOUT1,0)#; %CHANGE DATE & SPOUT IT 08342000
 PROCEDURE SETDATE(BUFF); VALUE BUFF; REAL BUFF;%                       08343000
         BEGIN REAL DY,MN,YR; INTEGER D=DY; REAL B,T=MN;                08344000
               REAL SUBROUTINE C;                                       08344100
              BEGIN;STREAM(C~0:B~[B]);                                  08344200
                   BEGIN%                                               08345000
                        SI ~ B; SI ~ SI+5; SI ~ SC;%                    08346000
                   L:   IF SC < "0" THEN%                               08347000
                             BEGIN IF SC = "~" THEN GO TO X;%           08348000
                                  SI ~ SI+1; GO TO L;%                  08349000
                             END;%                                      08350000
                   K:   IF SC } "0" THEN%                               08351000
                             BEGIN TALLY ~ TALLY+1;%                    08352000
                                  SI ~ SI+1; GO TO K END;%              08353000
                        DI ~ B; B ~ SI; SI ~ LOC B; DS ~ WDS;%          08354000
                        SI ~ B; B ~ TALLY; DI ~ LOC C;%                 08355000
                        SI ~ SI-B; DS ~ B OCT;%                         08356000
                   X:END;%                                              08357000
                    C~P;                                                08358000
              END C;                                                    08358100
              B ~ BUFF;%                                                08359000
              MN~C; DY~C; YR~C;                                         08360000
              BUFF ~ BUFF.[15:15]-1;%                                   08361000
              IF MN > 0 AND MN { 12 AND%                                08362000
                   DY > 0 AND DY { 31 AND%                              08363000
                   YR > 0 THEN%                                         08364000
              BEGIN;STREAM(M~MN-1:X~0,Y~0,Z~0);                         08365000
                    BEGIN DI~LOC X; DS~24 LIT"000~0%1.1Y2G2V3D3T4A4 5>";08365100
                          SI~LOC X; SI~SI+M; SI~SI+M;                   08365200
                          DI~LOC M; DI~DI+6; DS~2 CHR;                  08365300
                    END;                                                08365400
              DY~P+DY;                                                  08366000
              IF YR MOD 4 = 0 AND MN > 2 AND(YR MOD 100 ! 0 OR%         08367000
                        YR MOD 400 = 0) THEN%                           08368000
                   DY ~ DY+1;%                                          08369000
              D ~ YR MOD 100 | 1000+DY;%                                08370000
              STREAM(D,A~[DATE]);%                                      08371000
                   BEGIN SI ~ LOC D; DS ~ 8 DEC END;%                   08372000
              CHANGEDATE(BUFF);%                                        08373000
              END ELSE SPOUT(BUFF);                                     08374000
         END;%                                                          08375000
 PROCEDURE CHANGEDATE(BUFF); VALUE BUFF; REAL BUFF;%                    08376000
         BEGIN REAL B;                                                  08377000
              SLEEP([TOGLE],HOLDMASK);                                  08378000
              HOLDFREE ~ 0;%                                            08379000
              B := SPACE(30);                                           08380000
              DISKWAIT(-B,-30,DIRECTORYTOP);                            08381000
              M[B]~OPTION;                                              08382000
              M[B+1] ~ DATE;%                                           08383000
              M[B+18]:=XCLOCK;                                          08383100
              M[B+20].[18:30]:=LOGARRAY[33];                            08383200
             M[B+21]:=SCHEDWRD;                                         08383210
              DISKWAIT(B,-30,DIRECTORYTOP);                             08384000
              IF BUFF!0 THEN                                            08384100
              DATEOUT (BUFF);%                                          08385000
              FORGETSPACE(B);%                                          08387000
              HOLDFREE ~ 1;%                                            08388000
         END;%                                                          08389000
 PROCEDURE SETIME(BUFF); VALUE BUFF; REAL BUFF;%                        08390000
         BEGIN REAL B=BUFF,T;%                                          08391000
              REAL I,R;%                                                08392000
              LABEL EXIT;%                                              08393000
              REAL CLOCK=XCLOCK;%                                       08394000
              INTEGER CLCK=CLOCK;;%                                     08395000
              T ~ -1;%                                                  08396000
              STREAM(B,T~[T]);%                                         08397000
                   BEGIN SI ~ B;%                                       08398000
                   L:   IF SC = " " THEN%                               08399000
                             BEGIN SI ~ SI+1; GO TO L END;%             08400000
                        IF SC < "0" THEN GO TO X;%                      08401000
                   K:     IF SC } "0" THEN%                             08402000
                             BEGIN SI ~ SI+1; TALLY ~ TALLY+1;%         08403000
                                       GO TO K END;%                    08404000
                        B ~ TALLY; SI ~ SI-B; DS ~ B OCT;%              08405000
                   X:%                                                  08406000
                   END;%                                                08407000
              BUFF ~ BUFF.[15:15]-1;%                                   08408000
              IF T } 0 AND T DIV 100 < 24 AND T MOD 100 < 60 THEN%      08409000
                   BEGIN CLCK ~ (T DIV 100 | 60 + T MOD 100)|3600;%     08410000
                        CLOCK ~ (CLOCK OR @77)+1;%                      08411000
                        TIMEOUT (BUFF);%                                08412000
                        GO TO EXIT;%                                    08413000
                   END;%                                                08414000
              SPOUT(BUFF);                                              08415000
         EXIT:%                                                         08416000
         END;%                                                          08417000
 REAL PROCEDURE FORMESS(BUFF,H1); VALUE BUFF,H1; REAL BUFF,H1;          08418000
    BEGIN REAL B,H,U;                                                   08418500
         INTEGER I;                                                     08418700
         LABEL AGAIN,EXIT,AWAY;                                         08419000
                   IF H1=0 THEN                                         08419100
                   BEGIN STREAM(U:=0,B:=BUFF:);                         08419150
                        BEGIN SI:=B;                                    08419200
                          L: IF SC=" " THEN                             08419250
                             BEGIN SI:=SI+1; GO TO L END;               08419300
                             B:=SI;                                     08419320
                             IF SC GEQ "0" THEN                         08419350
                             IF SC LEQ "9" THEN TALLY:=1;               08419400
                             U:=TALLY;                                  08419450
                        END;                                            08419500
                        BUFF:=P;                                        08419520
                        IF P THEN                                       08419550
                        BEGIN SCHEDLOOK(BUFF,2);                        08419600
                             GO AWAY;                                   08419650
                        END;                                            08419700
                   END;                                                 08419750
AGAIN:   U:=FORMESS:=UNITIN(TINU,BUFF);                                 08420000
$INCLUDE 08420601, IF DCP;                                              08420499
         IF U=30 THEN                                                   08420500
         IF DCPTOG THEN U:=32 ELSE FORK(P(.INITIALIZEDCP),0,0,0,1) ELSE 08420600
         IF U{31 THEN BEGIN SLEEP([TOGLE],STATUSMASK);                  08421000
              IF LABELTABLE[U] < 0 THEN%                                08422000
              BEGIN STREAM(A:=TINU[U],B:=B:=SPACE(5));                  08424000
                        BEGIN SI ~ LOC A; SI ~ SI + 5; DS ~ 3 CHR;%     08425000
                        DS ~ 8 LIT" IN USE~";%                          08426000
                   END;%                                                08427000
                   SPOUT(B);                                            08428000
                   GO TO EXIT; END;%                                    08429000
                   LABELTABLE[U]:=@114&H1[1:47:1];                      08430000
                   MULTITABLE[U] ~ 0;%                                  08431000
                   I ~ TWO(U);%                                         08432000
                   IF H1 THEN B:=NOT 0 ELSE                             08433000
                   BEGIN B:=NOT I;  H:=I:=0;                            08434000
                        IF U=23 THEN H:=P(.READERA);                %R7608434100
                        IF U=24 THEN H:=P(.READERB);                %R7608434200
                        IF  H NEQ 0 THEN                            %R7608434300
                        BEGIN UNITCODE[U-23]:=-0;                   %R7608434310
                           IF (*H).[CF] NEQ 0 THEN                      08434400
                           BEGIN                                    %R7608434500
                                FORGETSPACE(*H-2);                  %R7608434600
                                M[H]:=0;                            %R7608434700
                           END;                                     %R7608434800
                        END;                                        %R7608434900
                   END;                                                 08434910
                   READY ~ READY AND B OR I;%                           08435000
                   RRRMECH ~ RRRMECH AND B OR I;%                       08436000
              SAVEWORD ~ SAVEWORD AND B OR I;%                          08437000
              END;                                                      08437050
EXIT:    IF NOT H1 THEN                                                 08437100
         BEGIN IF U GTR 31 THEN                                         08437150
              BEGIN STREAM(BUFF,B:=B:=SPACE(5));                        08437200
                   BEGIN DS:=10 LIT"INV KBD RY";                        08437250
                        SI:=BUFF; DS:=3 CHR;                            08437300
                        DS:=LIT"~";                                     08437350
                   END;                                                 08437400
                   SPOUT(B);                                            08437450
              END;                                                      08437500
              STREAM(OK:=0,BUFF:);                                      08437550
              BEGIN SI:=BUFF;                                           08437600
                   3(IF SC=" " THEN JUMP OUT;                           08437650
                     IF SC="," THEN JUMP OUT;                           08437700
                     IF SC="~" THEN JUMP OUT TO L3;                     08437750
                     SI:=SI+1);                                         08437800
              L1:  IF SC=" " THEN                                       08437850
              L2:  BEGIN SI:=SI+1; GO TO L1 END;                        08437900
                   IF SC="," THEN GO TO L2;                             08437950
                   BUFF:=SI;                                            08438000
                   IF SC!"~" THEN TALLY:=1;                             08438050
              L3:  OK:=TALLY;                                           08438100
              END;                                                      08438150
              BUFF:=P;                                                  08438200
              IF P THEN GO AGAIN;                                       08438250
AWAY:         FORMESS:=-1;                                              08438300
         END;                                                           08438350
    END;                                                                08438500
 PROCEDURE OUTPUTLABEL(B); VALUE B; REAL B;%                            08439000
    BEGIN REAL BU=B,U,T,A;%                                             08440000
         REAL G,Q;%                                                     08441000
                    REAL TEMP;                                          08441050
         BOOLEAN SCRTOG;                                                08441100
         REAL BLURB,MIX;                                                08441200
         LABEL EXIT;%                                                   08442000
         SUBROUTINE DOIT;%                                              08443000
              BEGIN; STREAM(A~TINU[U]:B);%                              08444000
                  BEGIN SI ~ LOC A; SI ~ SI+5; DS ~ LIT" ";%            08445000
                        DS ~ 3 CHR; DS ~ LIT " "; A ~ DI END;%          08446000
                   A ~ P; T ~ LABELTABLE[U];%                           08447000
                    IF U LSS 16 THEN TEMP:=PRNTABLE[U].[30:18];         08447100
                    IF T=0 THEN                                         08448000
                    STREAM(B:=TEMP,V:=(U LSS 16),A);                    08448050
                    BEGIN SI:=LOC V;SI:=SI+7;                           08448100
                    IF SC NEQ "0" THEN BEGIN SI:=LOC B;DS:=5DEC END;    08448110
                                          DS:=9LIT" SCRATCH~" END       08448150
                   ELSE IF T = @114 OR T = @214 THEN%                   08449000
                             STREAM(A); DS ~ 10 LIT "NOT READY~"%       08450000
                    ELSE IF T=@314 THEN                                 08451000
                    STREAM(B:=TEMP,V:=(U LSS 16),A);                    08451100
                    BEGIN SI:=LOC V; SI:=SI+7;                          08451200
                    IF SC NEQ "0" THEN BEGIN SI:=LOC B;DS:=5DEC END;    08451210
                          DS:=11 LIT " UNLABELED~";                     08452000
                    END                                                 08452100
                   ELSE BEGIN;%                                         08453000
                    STREAM(K:=IF T LSS 0 THEN "IN USE " ELSE "LABELED": 08454000
                           B:=TEMP,V:=(U LSS 16),A);                    08454100
                    BEGIN SI:=LOC V; SI:=SI+7;                          08455000
                    IF SC NEQ "0" THEN BEGIN SI:=LOC B; DS:=5DEC ;      08455005
                                           DS:=LIT " " END;             08455010
                                 SI:=LOC K; SI:=SI+1;                   08455100
                             DS ~ 7 CHR; DS ~ LIT " ";%                 08456000
                             K ~ DI;%                                   08457000
                        END;%                                           08458000
                   A ~ P;%                                              08459000
                   IF (NT1 ~ RDCTABLE[U].[8:6]) ! 0 THEN%               08460000
                   IF JARROW[NT1] ! 0 THEN%                             08461000
                        BEGIN BLURB~PUTORTAKE(MIX~NT1,                  08462000
                                       [JAR[MIX,0]],10,0);  NT1~MIX;    08462100
                             STREAM(J~BLURB:NT1,A);                     08462200
                             BEGIN DS ~ 3 LIT "BY "; SI ~ J;%           08463000
                                  SI ~ SI+1; DS ~ 7 CHR;%               08464000
                                  DS ~ LIT "/"; SI ~ SI+1;%             08465000
                                  DS ~ 7 CHR; DS ~ LIT "=";%            08466000
                                  SI~LOC NT1; DS~2DEC;                  08467000
                                  DS ~ LIT ":"; J ~ DI;%                08468000
                                  DI~DI-3; DS~FILL;                     08468500
                             END;%                                      08469000
                             A ~ P;%                                    08470000
                             FORGETSPACE(BLURB);                        08470100
                        END;%                                           08471000
                   STREAM(S~0:K~MULTITABLE[U],T,                        08472000
$INCLUDE 08472501, IF DCP;                                              08472499
                        B~U=30,                                         08472500
                        R~RDCTABLE[U].[14:10],D~RDCTABLE[U].[24:17],    08473000
                        C~RDCTABLE[U].[41:7],A);                        08473500
                   BEGIN SI ~ LOC K;                                    08474000
                        2(SI ~ SI+1; DS ~ 7 CHR; DS ~ LIT " ");%        08475000
$INCLUDE 08475301, IF DCP;                                              08475099
                        SI ~ SI+7;                                      08475100
                        IF SC ! "1" THEN                                08475200
                      BEGIN                                             08475300
                        DS ~ 3 DEC; DS ~ LIT " ";%                      08476000
                        DS ~ 5 DEC; DS ~ LIT " ";%                      08477000
                        DS ~ 2 DEC;                                     08478000
$INCLUDE 08478201, IF DCP;                                              08478199
                      END;                                              08478200
                        DS ~ LIT"~";                                    08478300
                        S~DI;                                           08478500
                   END;                                                 08478600
                   A~P;                                                 08478700
                   IF U}32 THEN IF CIDROW[U   -32]!0 THEN               08478800
                        STREAM(DK~CIDTABLE[U   -32,2],A);               08478900
                             BEGIN                                      08479000
                             DI~DI-1;                                   08479100
                             DS~6 LIT ",DECK ";                         08479200
                             SI~LOC DK; SI~SI+1;                        08479300
                             DS~7 CHR;                                  08479400
                             END;                                       08479500
                        END;                                            08479600
                   SPOUT(B);                                            08480000
                   B ~ 0;%                                              08481000
              END;%                                                     08482000
                                                                        08482050
         IF (U ~ UNITIN(TINU,BU)) { 35 THEN                             08483000
              BEGIN B ~ B.[15:15]-1;%                                   08484000
                   DOIT;%                                               08485000
                   GO TO EXIT;%                                         08486000
              END;%                                                     08487000
$ OMIT 08487101, IF SHAREDISK;                                          08487099
         SCRTOG ~ U=36;                                                 08487100
$ INCLUDE 08487201, IF SHAREDISK;                                       08487199
         SCRTOG:=(U=40);                                                08487200
         STREAM(A~0:B);%                                                08488000
              BEGIN SI ~ B;%                                            08489000
              L:   IF SC = " " THEN%                                    08490000
                        BEGIN SI ~ SI+1; GO TO L END;%                  08491000
                   DI ~ LOC A; DI ~ DI+6; DS ~ 2 CHR;%                  08492000
              END;%                                                     08493000
         Q ~ P; B ~ B.[15:15]-1;%                                       08494000
         FOR U ~ 0 STEP 1 UNTIL 35 DO                                   08495000
              IF TINU[U].[30:12] = Q THEN%                              08496000
              IF (G ~ LABELTABLE[U])!0 AND G!@114 AND G!@214            08497000
                   AND NOT SCRTOG OR G=0 AND SCRTOG THEN                08497100
                   BEGIN IF B=0 THEN B := SPACE(10);                    08498000
                        DOIT;%                                          08499000
                   END;%                                                08500000
         IF B ! 0 THEN%                                                 08501000
              BEGIN;STREAM(Q,B);%                                       08502000
                        BEGIN DS ~ 6 LIT " NULL ";%                     08503000
                             SI ~ LOC Q; SI ~ SI+6; DS ~ 2 CHR;%        08504000
                             DS ~ 7 LIT " TABLE~";%                     08505000
                        END;%                                           08506000
                   SPOUT(B);                                            08507000
              END;%                                                     08508000
    EXIT: END;%                                                         08509000
 PROCEDURE MIXMSGS;                                                     08510000
         BEGIN LABEL L; P(XIT,.L,DEL);%                                 08511000
    L:::      "2DS", %  1                                               08512000
              "1IL", %  2                                               08513000
              "1OU", %  3                                               08514000
              "1OK", %  4                                               08515000
              "1FM", %  5                                               08516000
              "1AX", %  6                                               08517000
              "1FR", %  7                                               08518000
              "1OF", %  8                                               08519000
              "2TI", %  9                                               08520000
              "1WY", % 10                                               08521000
              "1RM", % 11                                               08522000
              "1UL", % 12                                               08523000
              "2ST", % 13                                               08523100
              "2IN", % 14                                               08523200
              "2OT", % 15                                               08523300
              "2QT", % 16                                               08523400
              "2PR", % 17                                               08523500
              "3PS", % 18                                               08523600
              "3XS", % 19                                               08523700
              "3ES", % 20                                               08523800
              "2SM", % 21                                               08523900
              "2HR", % 22                                               08524000
              "2CT", % 23    CHANGE TIME LIMITS OF A JOB IN THE MIX %WF 08524100
              "2XT", % 24    EXTEND TIME LIMITS OF A JOB IN THE MIX %WF 08524200
              "2TL", % 25    TYPE I-O AND PROCESSOR TIME LIMITS     %WF 08524300
              "2SS", % 26    TYPE SS MESSAGE TO USERS OF <MIX>          08524400
              "2WU", % 27    TYPE USER IDS OF REMOTES ASSIGNED TO <MIX> 08524500
              "2WA", % 28    TYPE STA #S OF STAS ASSIGNED TO <MIX>      08524600
              "2DP", % 29                                           %10308524700
               "3BK", %BREAK FOR SPO                                    08524800
              "3TS",%33 SCHED TS                                        08524900
              "0~~"; % END-OF-TABLE MARKER                              08524980
         END;                                                           08524990
 PROCEDURE TIMEUSED(B,X); VALUE B,X; REAL B,X;%                         08525000
         BEGIN INTEGER H,M,S,Q,T;                                       08526000
                                                                        08526500
              T ~ PUTORTAKE(X,[JAR[X,3]],1,0)                           08527000
                   + PUTORTAKE(X,[PROCTIME[X]],1,0);                    08527100
              IF X=P2MIX THEN T ~ T+CLOCK+P(RTR);%                  %WF 08528000
              FORMTIME([M],T);                                          08529000
              T~((CLOCK+P(RTR))/60)-PUTORTAKE(X,                        08533100
                   [UV[X,9]],1,0).[1:17];                               08533150
              FORMTIME([Q],T|60);                                       08533200
              STREAM(J~PUTORTAKE(X,[JAR[X,0]],1,0),                     08534000
                     K~PUTORTAKE(X,[JAR[X,1]],1,0),X,H~[H],B);          08534100
                   BEGIN DS ~ 10 LIT " TIME FOR ";%                     08535000
                        SI~LOC J;  2(SI~SI+1;  DS~7 CHR;  DS~LIT "/");  08536000
                        DI~DI-1;  DS~LIT "=";  DS~2 DEC;                08537000
                                                                        08538000
                        X~DI; DI~DI-2; DS~FILL; DI~X;                   08538500
                        DS ~ 3 LIT " IS";%                              08539000
                        SI~H;  SI~SI+8;  DS~8 CHR;                      08540000
                                                                        08540100
                        DS ~ 3 LIT " IN";                               08540200
                        SI~SI+8;  DS~8 CHR;                             08540300
                        DS~LIT"~";                                      08541000
                   END;%                                                08542000
                                                                    %WF 08543000
              SPOUT(B);                                                 08544000
         END;%                                                          08545000
 REAL PROCEDURE ANVIL(IL,Z); VALUE IL,Z; REAL IL,Z;%                    08546000
         BEGIN REAL B=Z,U=+1;%                                          08547000
              IF (U ~ UNITIN(TINU,B)) { 35 THEN                         08548000
              BEGIN%                                                    08549000
              IF LABELTABLE[U] = @114 OR LABELTABLE[U] = @214 THEN%     08550000
                   BEGIN;STREAM(A~TINU[U],X~Z.[15:15]-1);%              08551000
                             BEGIN SI ~ LOC A; SI ~ SI+5;%              08552000
                                  DS ~ 3 CHR; DS ~ 11 LIT " NOT READY~";08553000
                             END;%                                      08554000
                        U~36;                                           08555000
                   END;%                                                08556000
              IF LABELTABLE[U] < 0 THEN%                                08557000
                   BEGIN;STREAM(A~TINU[U],X~Z.[15:15]-1);%              08558000
                             BEGIN SI ~ LOC A; SI ~ SI+5;%              08559000
                                  DS ~ 3 CHR; DS ~ 8 LIT " IN USE~";%   08560000
                             END;%                                      08561000
                        U~36;                                           08562000
                   END;%                                                08563000
              IF U { 35 THEN                                            08564000
                   LABELTABLE[U] ~ -(IF IL THEN *P(DUP) ELSE @314);%    08565000
         END  END;%                                                     08566000
 PROCEDURE SAVETHEUNIT(B); VALUE B; REAL B;%                            08575000
         BEGIN REAL A=B,T,U,I;                                          08576000
              LABEL AGAIN,EXIT;                                         08576100
                                                                        08576150
              STREAM(U:=0,B:);                                          08576200
              BEGIN SI:=B;                                              08576250
                L: IF SC=" " THEN BEGIN SI:=SI+1; GO TO L END;          08576300
                   B:=SI;                                               08576320
                   IF SC GEQ "0" THEN                                   08576350
                   IF SC LEQ "9" THEN TALLY:=1;                         08576400
                   U:=TALLY;                                            08576450
              END;                                                      08576500
              B:=P;                                                     08576520
              IF P THEN BEGIN SCHEDLOOK(B,3); GO TO EXIT END;           08576550
AGAIN:        T:=SPACE(10);                                             08577000
              IF (U:=UNITIN(TINU,A)) GTR 31 THEN                        08578000
              STREAM(A,T);                                              08578100
              BEGIN DS:=10 LIT"INV KBD SV";                             08578200
                   SI:=A; DS:=3 CHR;                                    08578300
                   DS:=LIT"~";                                          08578400
              END ELSE                                                  08578500
$INCLUDE 08578901, IF DCP;                                              08578599
              IF U=30 THEN                                              08578600
              BEGIN HALTDCP;  DCPTOG:=0;                                08578700
                   STREAM(T); DS:=11 LIT"DCP HALTED~";                  08578800
              END ELSE                                                  08578900
                   BEGIN I ~ TWO(U);%                                   08579000
                        SLEEP([TOGLE],STATUSMASK);                      08580000
                        IF LABELTABLE[U] } 0 THEN%                      08581000
                             BEGIN LABELTABLE[U] ~ @114;%               08582000
                                  MULTITABLE[U]~RDCTABLE[U]~0;          08582100
                                  RRRMECH ~ RRRMECH OR I;%              08583000
                                  READY ~ READY OR I;%                  08584000
                                  I ~ "      ";%                        08585000
                             END%                                       08586000
                        ELSE BEGIN SAVEWORD ~ SAVEWORD OR I;%           08587000
                                  I ~ " TO BE";%                        08588000
                             END;%                                      08589000
                        STREAM(A~TINU[U],I,T);%                         08590000
                             BEGIN DS ~ LIT " ";%                       08591000
                                  SI ~ LOC A; SI ~ SI+5; DS ~ 3 CHR;%   08592000
                                  SI ~ SI+2; DS ~ 6 CHR;%               08593000
                                  DS ~ 7 LIT " SAVED~";%                08594000
                             END;%                                      08595000
                   END;%                                                08596000
              SPOUT(T);                                                 08597000
              STREAM(OK:=0,A:);                                         08597050
              BEGIN SI:=A;                                              08597100
                   3(IF SC=" " THEN JUMP OUT;                           08597150
                     IF SC="," THEN JUMP OUT;                           08597200
                     IF SC="~" THEN JUMP OUT TO L3;                     08597250
                     SI:=SI+1);                                         08597300
              L1:  IF SC=" " THEN                                       08597350
              L2:  BEGIN SI:=SI+1; GO TO L1 END;                        08597400
                   IF SC="," THEN GO TO L2;                             08597450
                   A:=SI;                                               08597500
                   IF SC!"~" THEN TALLY:=1;                             08597550
              L3:  OK:=TALLY;                                           08597600
              END;                                                      08597650
              A:=P;                                                     08597700
              IF P THEN GO AGAIN;                                       08597750
    EXIT:                                                               08597900
         END;%                                                          08598000
 BOOLEAN PROCEDURE WHYSLEEP(MASK); VALUE MASK; REAL MASK;%              08599000
         BEGIN REAL A;%                                                 08600000
              IF REPLY[P1MIX] = 10 THEN%                                08601000
              BEGIN%                                                    08602000
              A := SPACE(4);                                            08603000
              MIXMSGS;                                                  08604000
              STREAM(B~*P(.MIXMSGS),MASK,T~0,S~0,A);                    08605000
                   BEGIN SI ~ LOC MASK; T ~ SI;%                        08606000
                        8(SI ~ T;%                                      08607000
                             IF SC = 10 THEN%                           08608000
                                  BEGIN DI ~ A; DS ~ 3 LIT " DS";%      08609000
                                       A ~ DI; SI ~ SI+1; T ~ SI;%      08610000
                                  END ELSE%                             08611000
                             IF SC ! 0 THEN%                            08612000
                                  BEGIN DI ~ LOC S; DI ~ DI+7; DS ~ CHR;08613000
                                       DI ~ A; DS ~ LIT " "; T ~ SI;%   08614000
                                       SI ~ B; S(SI ~ SI+8); SI ~ SI+6; 08615000
                                       DS ~ 2 CHR; A ~ DI;%             08616000
                                  END%                                  08617000
                             ELSE BEGIN SI ~ SI+1; T ~ SI END;);%       08618000
                        DI ~ A; DS ~ LIT "~";%                          08619000
                   END;%                                                08620000
              SPOUT(A);%                                                08621000
              END ELSE WHYSLEEP ~ TRUE;%                                08622000
         END;%                                                          08623000
PROCEDURE CHANGEOPTION(BUFF,RS);%                                       08624000
         VALUE BUFF,RS;REAL BUFF,RS;%                                   08625000
BEGIN    REAL B,T,OP,BUS,MASK;%                                         08626000
         SLEEP([TOGLE],HOLDMASK);                                       08627000
         HOLDFREE ~ 0;%                                                 08628000
              BUS := BUFF.[15:15]-1;  B := SPACE(30);                   08629000
         DISKWAIT(-B,30,DIRECTORYTOP-SYSNO);                            08630000
         OPSET;%                                                        08631000
    STREAM(BUFF,T~0,OPTER,R~[OP]);%                                     08632000
         BEGIN%                                                         08633000
              SI ~ BUFF; 63(IF SC=" " THEN SI ~ SI+1  ELSE JUMP OUT%    08634000
                                  TO L);L:%                             08635000
              63(IF SC!" " THEN SI~SI+1);  16(IF SC=" " THEN SI~SI+1);% 08636000
              DI~LOC T;%                                                08637000
              8(IF SC=" " THEN JUMP OUT TO L1 ELSE%                     08638000
                IF SC="~" THEN JUMP OUT TO L1 ELSE%                     08639000
                IF SC}"0" THEN JUMP OUT TO L1 ELSE%                     08640000
                DS~1 CHR);L1:%                                          08641000
              TALLY~0;BUFF~SI;SI~OPTER;%                                08642000
              46(DI:=LOC T; IF 8 SC!DC THEN                             08643000
                   BEGIN IF SC="~" THEN%                                08644000
                                  BEGIN TALLY~48;JUMP OUT TO L3 END%    08645000
                                  ELSE TALLY~TALLY+1%                   08646000
                   END ELSE JUMP OUT TO L2);TALLY~48;GO TO L3;L2:%      08647000
              IF SC="~" THEN%                                           08648000
                   BEGIN%                                               08649000
                        SI~BUFF;63(IF SC<"0" THEN SI~SI+1 ELSE JUMP OUT 08650000
                                  TO L4);L4:DI~LOC T;SI~SI+1;%          08651000
                        IF SC<"0" THEN BEGIN SI~SI-1; DS~1 OCT END ELSE 08652000
                                       BEGIN SI~SI-1;DS~2 OCT END;%     08653000
                        TALLY~47;T(TALLY~TALLY+63);%                    08654000
              END;%                                                     08655000
              L3:T~TALLY;SI~LOC T;DI~R;DS~WDS;%                         08656000
         END;%                                                          08657000
         IF(OP=9)AND NOT RS THEN                                        08657100
         IF(NT1~DIRECTORYSEARCH("PRNPBT ","DISK   ",5))!0 THEN          08657200
              FORGETSPACE(NT1) ELSE RS~TRUE;                            08657300
$OMIT 08657801, IF DCP;                                                 08657399
              IF (OP=10)AND NOT RS THEN                                 08657400
              BEGIN REMOTE ~ FALSE;                                     08657500
                   SPREADTHEWORD;                                       08657600
                   RS ~ NOT REMOTE;                                     08657700
              END;                                                      08657800
              IF OP LSS 46 THEN                                         08658000
                   BEGIN;STREAM(A ~ IF RS THEN " RESET" ELSE "   SET",% 08659000
                        O~OPTER INX OP,OP ~ 47-OP,BUS);%                08660000
                        BEGIN DS ~ LIT " "; SI ~ LOC OP; DS ~ 2 DEC;%   08661000
                             DS ~ LIT " "; SI ~ O;%                     08662000
                             8(IF SC=0 THEN JUMP OUT TO L; DS~CHR);%    08663000
                   L:        SI ~ LOC A; SI ~ SI+2; DS ~ 6 CHR;%        08664000
                             DS ~ LIT"~";%                              08665000
                        END;%                                           08666000
                        MASK~TWO(OP);%                                  08667000
                   END;%                                                08668000
              SPOUT(BUS);                                               08669000
%                                                                       08670000
         M[B]~OPTION~IF RS THEN OPTION AND NOT MASK ELSE OPTION OR MASK;08671000
%                                                                       08672000
         DISKWAIT(B,-30,DIRECTORYTOP-SYSNO);                            08673000
         FORGETSPACE(OPTER);%                                           08674000
         FORGETSPACE(B);%                                               08676000
         HOLDFREE ~ 1;%                                                 08677000
    END;%                                                               08678000
 PROCEDURE TYPOP;  BEGIN                                                08679000
    REAL VASE,N;                                                        08680000
    REAL SUBROUTINE SETT;                                               08681000
    BEGIN;STREAM(SETT~0:OPTER~[OPTER],N,NBS~47-N,                       08681100
                 IND~(OPTION AND TWO(N))=0,VASE); BEGIN                 08681200
              SI~LOC NBS;DI~VASE;DS~2 DEC;DS~2 LIT" ";%                 08682000
              SI~OPTER;N(SI~SI+8);IF SC="~" THEN GO TO EXIT;%           08683000
              8(IF SC<"0" THEN DS~CHR ELSE DS~1 LIT" ");DS~2 LIT" ";%   08684000
              IND(DS~3 LIT"NOT");%                                      08685000
              DS~5 LIT" SET~";%                                         08686000
              DI~LOC SETT;DI~DI+7;DS~1 LIT"7";%                         08687000
              EXIT:                         END;%                       08688000
          SETT~P;                                                       08689000
    END SETT;                                                           08689100
         OPSET;%                                                        08690000
         FOR N:=0 STEP 1 UNTIL 46 DO                                    08691000
              BEGIN VASE := SPACE(3);                                   08692000
              IF SETT=0 THEN N:=47 ELSE SPOUT(VASE);                    08693000
                                                                        08694000
              END;FORGETSPACE(VASE);%                                   08695000
         FORGETSPACE(OPTER);%                                           08696000
                   END;%                                                08697000
 PROCEDURE PBIO(ALPHA,POINTER); VALUE ALPHA; REAL ALPHA,POINTER;     %P 08700000
% ALPHA IS ADDRESS OF TOP I/O DESCRIPTOR. <0 MEANS READ              %P 08701000
% POINTER IS FIB[14]                                                 %P 08702000
    BEGIN NAME HEADER;                                               %P 08703000
         REAL T=-2,IOD;  INTEGER I=IOD;                              %P 08704000
         POINTER.[FF]~POINTER INX  72;                               %P 08705000
         IF (HEADER~POINTER.[3:15])!0 THEN    %%%%PB ON DISK  %%%%%  %P 08706000
         BEGIN                                                          08707000
              HEADER := [M[(*HEADER)]];                                 08707500
              IF HEADER[7] GEQ 6000 THEN% GET NEW FILE                  08708000
              BEGIN                                                     08708500
                   HEADER[1] := HEADER[3];                              08709000
                   IF I:=HEADER[5].[3:1] THEN HEADER[5].[3:1]:=0;       08709100
                   STREAM(DATE, D:=[HEADER[3]]);                        08709500
                   BEGIN                                                08710000
                        SI:=LOC DATE; DS:=8 OCT;DI:=DI-8;               08710500
                        DS:=2 LIT"+2";SI:=D;SI:=SI+5;DS:=3 CHR;         08711000
                   END;                                                 08711500
                   HEADER[1].[6:18] := HEADER[3].[30:18];               08711700
                   ENTERUSERFILE(IF I THEN "PUD    " ELSE "PBD    ",    08712000
                                 HEADER[6],HEADER INX 0-1);             08712100
                   HEADER[5].[3:1]:=I; %SET PUNCH BK UP TOG             08712200
                   HEADER[7] := 0;                                      08712500
                   HEADER[3] := XCLOCK + P(RTR);                        08713000
                   STREAM(ONE:=1,D:=[HEADER[6]]);                       08713100
                   BEGIN SI~LOC ONE; DS~8 ADD; DI~DI+16;                08714000
                        21(DS~8 LIT"0");                                08714100
                   END;                                                 08714200
              END;                                                      08714500
                        IF HEADER[7] MOD 300 =0 THEN %% GET NEW ROW  %P 08715000
                        HEADER[9 +HEADER[9]~*P(DUP)+1]~GETUSERDISK(900);08716000
                      STREAM(A~I~HEADER[HEADER[9]+ 9]+(HEADER[7]MOD 300)08717000
                                       |3,D~POINTER.[CF]-1);         %P 08718000
                        BEGIN SI~LOC A; DS~8 DEC END;                %P 08720000
                        HEADER[7]~(*P(DUP))+1;                       %P 08721000
         IOD~@141320100377777;                                       %P 08722000
                   END ELSE  %% ON TAPE %%                           %P 08723000
         IOD~@21320500000000&M[POINTER INX NOT 1][3:14:4];           %P 08724000
         IOREQUEST(M[ALPHA],POINTER INX IOD&ALPHA[24:1:1],           %P 08726000
                             M[POINTER INX NOT 1]);                  %P 08727000
         M[T]~IOD INX M[T]&0[26:26:7]&0[19:19:1] AND NOT M;          %P 08728000
    END PBIO;                                                        %P 08729000
 PROCEDURE TIMERELAXER(KTR,TYPE,MIX);%                                  08730000
 VALUE                 KTR,TYPE,MIX;%                                   08731000
 REAL                  KTR,TYPE,MIX;%                                   08732000
    BEGIN INTEGER BUFF,PRT,IOT,T,P1,I1;%                                08733000
         LABEL SPIT;%                                                   08734000
         ARRAY V[*];                                                    08734100
         BUFF ~ KTR.[15:15]-1;%                                         08735000
              V ~ [M[PUTORTAKE(MIX,[JAR[MIX,0]],10,0)]]&10[8:38:10];    08735100
         IF TYPE!25 THEN BEGIN;%                                        08736000
              STREAM(IOT~0,PRT~0,CODE~0: KTR);%                         08737000
              BEGIN SI~KTR;  IF SC=" " THEN BEGIN L1:  SI~SI+1;%        08738000
                   IF SC=" " THEN GO L1 END;  IF SC="*" THEN GO L5;%    08739000
                   IF SC="," THEN GO L2;  IF SC<"0" THEN GO EXIT;%      08740000
                   KTR~SI;  L3:  TALLY~TALLY+1;  SI~SI+1;               08741000
                   IF SC}"0" THEN GO L3;  SI~KTR;  CODE~TALLY;          08742000
                   DI~LOC PRT;  DS~CODE OCT;  TALLY~0;%                 08743000
              L5:  IF SC=" " THEN BEGIN L4:  SI~SI+1;%                  08744000
                   IF SC=" " THEN GO L4 END;  IF SC="," THEN GO L2;%    08745000
                   IF SC="~" THEN TALLY~1;  GO EXIT;%                   08746000
              L2:  SI~SI+1;  IF SC=" " THEN BEGIN L6:  SI~SI+1;%        08747000
                   IF SC=" " THEN GO L6 END ; KTR~SI;%                  08748000
                   IF SC="*" THEN BEGIN TALLY~1;  GO EXIT END;%         08749000
                   IF SC<"0" THEN GO EXIT;  L7:  TALLY~TALLY+1;%        08750000
                   SI~SI+1;  IF SC}"0" THEN GO L7;  DI~ LOC IOT;%       08751000
                   SI~KTR;  CODE~TALLY;  DS~CODE OCT;  TALLY~1;%        08752000
              EXIT:  CODE~TALLY;%                                       08753000
              END STREAM;%                                              08754000
              IF NOT P THEN GO SPIT;%                                   08755000
              PRT ~ P|3600;  IOT ~ P|3600;%                             08756000
              IF TYPE=24 THEN BEGIN%                                    08757000
                   IF PRT!0 THEN BEGIN%                                 08758000
                        NT1 ~ PUTORTAKE(MIX,[PROCTIME[MIX]],0,          08759000
                               PUTORTAKE(MIX,[PROCTIME[MIX]],1,0)-PRT); 08759100
                        V[3] ~ *P(DUP)+PRT;                             08760000
                   END;%                                                08761000
                   IF IOT!0 THEN BEGIN%                                 08762000
                        V[4] ~ *P(DUP)+IOT;                             08764000
              END END ELSE BEGIN%                                       08765000
                   IF PRT!0 THEN BEGIN%                                 08766000
                        NT1 ~ PUTORTAKE(MIX,[PROCTIME[MIX]],0,V[3]+     08767000
                               PUTORTAKE(MIX,[PROCTIME[MIX]],1,0)-PRT); 08767100
                        V[3] ~ PRT;                                     08768000
                   END;%                                                08769000
                   IF IOT!0 THEN BEGIN%                                 08770000
                        V[4] ~ IOT;                                     08772000
              END END;                                                  08773000
              STREAM(TEST~0:X~[V[0]],MIX,Z~PRT!0,I~IOT!0,%              08774000
                        K:=TYPE=24,T:=T:=SPACE(10));                    08775000
              BEGIN DS~LIT " ";  Z(DS~4 LIT "PRT ";  TALLY~1;%          08776000
                   I(DS~4 LIT"AND "));  I(DS~4 LIT "IOT ";  TALLY~1);%  08777000
                   DS~8 LIT "ESTIMATE"; Z(I(DS~LIT "S"));%              08778000
                   DS~8LIT" CHANGED";  K(DI~DI-7; DS~8LIT"EXTENDED");%  08779000
                   DS~5LIT" FOR";  SI~X;  SI~SI+1;  DS~7CHR;  SI~SI+1;% 08780000
                   DS~LIT"/";  DS~7CHR;  DS~LIT"=";  SI~LOC Z;%         08781000
                   SI~SI-8; DS~2DEC; DS~LIT"~"; TEST~TALLY;             08782000
                   DI~DI-3; DS~FILL;                                    08782500
              END STREAM;%                                              08783000
              IF P THEN SPOUT(T) ELSE FORGETSPACE(T);                   08784000
         END;                                                           08785000
         IOT ~ PRT ~ -0;%                                               08786000
         IF P(V[3],DUP)=@377777777777 THEN P(DEL) ELSE                  08787000
         P1 ~ (PRT ~ P DIV 3600)-60|(PRT ~ PRT DIV 60);%                08788000
         IF P(V[4],DUP)=@377777777777 THEN P(DEL) ELSE                  08789000
         I1 ~ (IOT ~ P DIV 3600)-60|(IOT ~ IOT DIV 60);%                08790000
         STREAM(X~[V[0]],MIX,PRT,P1,IOT,I1,BUFF);                       08791000
         BEGIN DS~17LIT" TIME LIMITS FOR";  SI~X;  SI~SI+1;  DS~7CHR;%  08792000
              DS~LIT"/"; SI~SI+1; DS~7CHR; DS~LIT"="; SI~LOC MIX;       08793000
              DS~2DEC; MIX~DI; DI~DI-2; DS~FILL; DI~MIX;                08793500
              DS~10LIT" ARE: PRT="; IF SC="+" THEN                      08794000
              BEGIN  SI~SI+16;  DS~8LIT"NO LIMIT" END ELSE BEGIN%       08795000
              DS~8DEC;  DS~LIT":";  DS~2DEC;  BUFF~DI;  DI~DI-11;%      08795500
              DS~7FILL;  DI~BUFF END;  DS~6LIT"; IOT=";  IF SC="+" THEN 08796000
              DS~10LIT"NO LIMIT.~" ELSE BEGIN DS~8DEC;  DS~LIT":";%     08796500
              DS~2DEC;  DS~2LIT".~";  DI~DI-13;  DS~7FILL END;          08797000
         END STREAM;%                                                   08797500
    SPIT:%                                                              08798000
         T ~ PUTORTAKE(MIX,[JAR[MIX,0]],-10,V INX 0);                   08798100
         SPOUT(BUFF);                                                   08798500
    END TIMERELAXER;                                                    08799000
PROCEDURE CHANGEFACTOR(BUFF,TF); VALUE BUFF,TF; REAL BUFF; BOOLEAN TF;  08800000
BEGIN REAL FACTOR,B,T; INTEGER TEMP=T;                                  08801000
      LABEL TYPEOUT,EXIT;                                               08802000
      BUFF ~ ((B~BUFF).[15:15]-1)&M[P(DUP)-1][9:9:9];                   08802500
      IF TF THEN GO TYPEOUT;                                            08803000
      STREAM(ANS~0:B);                                                  08804000
        BEGIN SI~B; DI~LOC B; DS~8LIT"00000000"; DI~DI-2;               08805000
        L:    IF SC = " " THEN BEGIN SI~SI+1; GO TO L END;              08806000
              IF SC < "0" THEN GO TO L1;                                08807000
              IF SC > "9" THEN GO TO L1;                                08808000
              SI~SI+1;                                                  08809000
              IF SC < "0" THEN GO TO ONECHR;                            08810000
              IF SC { "9"                                               08810500
                THEN         BEGIN SI~SI-1; DI~DI-2; DS~2 CHR; END      08811000
                ELSE ONECHR: BEGIN SI~SI-1; DI~DI-1; DS~1 CHR; END;     08812000
              IF SC = "." THEN GO TO L2 ELSE GO TO L3;                  08813000
        L1:   IF SC ! "." THEN GO TO ERROR;                             08814000
        L2:   SI~SI+1;                                                  08815000
              IF SC < "0" THEN GO TO ERROR;                             08816000
              IF SC > "9" THEN GO TO ERROR;                             08817000
              DS~CHR;                                                   08818000
              IF SC } "0" THEN IF SC { "9" THEN DS~CHR;                 08819000
        L3:   IF SC = " " THEN GO CONVERT;                              08820000
              IF SC = "~" THEN GO CONVERT;                              08821000
        ERROR:DI~LOC ANS; SKIP 1 DB; DS~ 10 SET; GO TO EXITS;           08822000
        CONVERT: SI~LOC B; SI~SI+4; DI~LOC ANS; DS~4 OCT;               08823000
        EXITS:                                                          08824000
        END STREAM;                                                     08825000
      P(.FACTOR,~);                                                     08826000
      IF FACTOR < 0 THEN GO TO EXIT;                                    08828000
      CORE.[4:14] ~ FACTOR;                                             08829000
      SLEEP([TOGLE],HOLDMASK); HOLDFREE~0;                              08830000
      B := SPACE(30);                                                   08831000
      DISKWAIT(-B,-30,DIRECTORYTOP-SYSNO);                              08832000
      M[B+9] ~ CORE;                                   % CHANGE FACTOR  08833000
      DISKWAIT(B,-30,DIRECTORYTOP-SYSNO);                               08834000
      FORGETSPACE(B);                                                   08835000
      HOLDFREE ~ 1;                                    % UNLOCK HOLDFREE08836000
      SELECTION;                                                        08836500
TYPEOUT:                                                                08837000
      STREAM(I~(FACTOR~CORE.[4:14]) DIV 100, FR~(TEMP~FACTOR MOD 100),  08838000
             MX~(TEMP~CORE.[CF]|64|FACTOR/100), US~CORE.[FF]|64, BUFF); 08839000
        BEGIN DS~9 LIT"FACTOR = ";                                      08840000
              SI~LOC I; DS~2 DEC; I~DI; DI~DI-2; DS~FILL; DI~I;         08841000
                        DS~LIT"."; DS~2 DEC;                            08842000
              DS~13 LIT", MAX CORE = "; DS~7 DEC;                       08843000
                        I~DI; DI~DI-7; DS~6 FILL; DI~I;                 08844000
              DS~ 8 LIT", USING "; DS~7 DEC; DS~LIT"~";                 08845000
                        DI~DI-8; DS~6 FILL;                             08846000
        END STREAM;                                                     08847000
EXIT: SPOUT(BUFF);                                                      08848000
                                                                        08848500
END CHANGEFACTOR;                                                       08849000
PROCEDURE SHEETDIDDLER(BUFF,TYPE,SID); VALUE BUFF,TYPE,SID;             08850000
                                       REAL  BUFF,TYPE,SID;             08850100
COMMENT TYPE = 18: PS -- CHANGE PRIORITY OF JOB IN SCHEDULE             08850200
             = 19: XS -- EXECUTE JOB IN SCHEDULE (FORCE SELECTION)      08850300
             = 20: ES -- ELIMINATE JOB FROM SCHEDULE (FORCE SELECTION,  08850400
                                                      THEN "DS")        08850500
             = 34: TS -- TYPE OUT SCHEDULE;                             08850600
BEGIN REAL IOD,T,PRIORITY;                                              08851000
      INTEGER LEVEL,NEXTLINK,THISLINK,LASTLINK;                         08852000
      INTEGER ES,EM,EH; DEFINE ET = EH#;                                08852500
      BOOLEAN LASTPASSED,ATLEASTONE;                                    08853000
      ARRAY S[*],DLNK[*];                                               08854000
LABEL CONTINUE,C1,READIN,GNX,TS,TS1,TS2,XSES,PS,PS1,PS2,EXIT;           08855000
LABEL ESLL;                                                             08856000
                                                                        08857500
      SUBROUTINE GETNEXT; % READS IN NEXT JOB SHEET ENTRY               08858000
      BEGIN                                                             08859000
      CONTINUE: LASTLINK ~ THISLINK;                                    08860000
                IF (THISLINK~NEXTLINK) ! 0 THEN GO TO READIN;           08860500
      C1:       IF (LEVEL~LEVEL+1)>SHEETMAX THEN                        08861000
                  BEGIN LASTPASSED ~ TRUE; GO TO GNX END;               08862000
                LASTLINK ~ NEXTLINK ~ 0;                                08863000
                IF (THISLINK~SHEET[LEVEL].[CF]) = 0 THEN GO TO C1;      08864000
      READIN:   DISKWAIT(-S.[CF],30,THISLINK);                          08865000
                NEXTLINK ~ S[29];                                       08867000
                IF S[0].[36:6]=@14 THEN GO CONTINUE;%PASS LM ENTRY      08868000
      GNX:                                                              08869000
      END GETNEXT;                                                      08870000
                                                                        08871000
      SLEEP([TOGLE],SHEETMASK); SHEETFREE~FALSE;                        08880000
      S ~ [M[GETSPACE(31,2,0)+2]]&30[8:38:10];                          08881000
      LEVEL ~ -1; LASTPASSED ~ FALSE;                                   08882000
      IF TYPE LSS 0 THEN GO ESLL;%ES A JOB ON LOGICAL LINE = SID        08882100
      BUFF ~ ((T~BUFF).[15:15]-1)&M[P(DUP)-1][9:9:9];                   08882500
      IF TYPE>20 THEN GO TS;IF TYPE>18 THEN GO XSES;GO PS;              08883000
TS:   ATLEASTONE ~ FALSE;                                               08884000
TS1:  GETNEXT; IF LASTPASSED THEN GO TO TS2;                            08885000
    IF SID NEQ 63 THEN BEGIN IF S[3].[8:10] NEQ SID THEN GO TS1 END ELSE08885500
      IF ATLEASTONE THEN BUFF.[CF] := SPACE(10);                        08886000
      ET ~ ((CLOCK+P(RTR))/60)-S[23].[31:17];                           08886300
      ES ~ ET MOD 60; ET ~ ET DIV 60; EM ~ ET MOD 60; EH ~ ET DIV 60;   08886600
      STREAM(C~LEVEL,J~S[*],ID~S[3].[8:10],EH,EM,ES,A~S[20]|64,BUFF);   08887000
        BEGIN SI~LOC C; DS~6 DEC; DI~DI-6; DS~5 FILL; DI~BUFF; DI~DI+6; 08888000
              DS~LIT":"; SI~J; SI~SI+1; DS~7 CHR; DS~LIT"/"; SI~SI+1;   08889000
              DS~7 CHR; DS~LIT"="; SI~LOC ID; DS~2 DEC;                 08890000
              DS~7 LIT" IN FOR"; SI~LOC EH;                             08891000
              3(DS ~ LIT":"; DS~2 DEC); ES~DI; DI~DI-9; DS~8 FILL;      08892000
              DI~ES; DS~8 LIT", NEEDS ";                                08893000
              SI~LOC A; DS~5 DEC; DS~LIT"~"; DI~DI-6; DS~4 FILL;        08899000
        END STREAM;                                                     08900000
      SPOUT(BUFF);                                                      08901000
      IF SID NEQ 63 THEN BEGIN TYPE:=34;GO EXIT END;                    08901500
      ATLEASTONE~TRUE;                                                  08902000
      GO TO TS1;                                                        08903000
TS2:  IF ATLEASTONE THEN GO TO EXIT;                                    08904000
      IF SID NEQ 63 THEN TYPE:=34 ELSE%                                 08904050
      STREAM(BUFF);  DS ~ 15 LIT " NULL SCHEDULE~";%                %WF 08905000
      SPOUT(BUFF); GO TO EXIT;                                          08906000
                                                                        08907000
ESLL: GETNEXT;                                                          08907500
      IF LASTPASSED THEN GO TO EXIT;                                    08908000
      IF S[26].[40:8] NEQ SID THEN GO TO ESLL;                          08908500
      S[2].[1:2]:=3; DISKWAIT(S.[CF],30,THISLINK); GO TO EXIT;          08909000
                                                                        08909500
XSES: GETNEXT;                                                          08910000
      IF LASTPASSED THEN BEGIN SPOUT(BUFF); GO TO EXIT END;             08911000
      IF S[3].[8:10]!SID THEN GO TO XSES;                               08912000
      S[2].[1:2] ~ TYPE-17; % TURN ON 1:1 FOR XS, ALSO 2:1 FOR ES       08913000
      DISKWAIT(S.[CF],30,THISLINK);                                     08915000
      FORGETSPACE(BUFF); GO TO EXIT;                                    08915100
                                                                        08915500
PS:   STREAM(PRIORITY:T);                                               08916000
      BEGIN SI~T;                                                       08917000
      N:    IF SC="~" THEN GO TO X;                                     08918000
            IF SC<"0" THEN BEGIN SI~SI+1; GO TO N; END; T~SI;           08919000
      K:    IF SC}"0" THEN IF SC{"9" THEN                               08920000
                   BEGIN TALLY~TALLY+1; SI~SI+1; GO TO K END;           08921000
            SI~T; DI~LOC PRIORITY; T~TALLY; DS~T OCT; GO TO Z;          08922000
      X:    DI~LOC PRIORITY; SKIP DB; DS~11 SET;                        08923000
      Z:                                                                08924000
      END STREAM;                                                       08925000
      IF (PRIORITY~P)<0 THEN BEGIN SPOUT(BUFF); GO TO EXIT END;         08926000
PS1:  GETNEXT; IF LASTPASSED THEN BEGIN SPOUT(BUFF); GO TO EXIT END;    08927000
      IF S[3].[8:10]!SID THEN GO TO PS1;                                08928000
% DELINK AND RELINK THIS SHEET ENTRY                                    08929000
      DLNK ~ [M[GETSPACE(31,2,0)+2]]&30[8:38:10];                       08930000
      IF NEXTLINK = 0 THEN SHEET[LEVEL].[FF] ~ LASTLINK;                08931000
      IF LASTLINK = 0 THEN BEGIN SHEET[LEVEL].[CF]~ NEXTLINK;GO PS2 END;08932000
      DISKWAIT(-DLNK.[CF],30,LASTLINK);                                 08933000
      DLNK[29] ~ NEXTLINK;                                              08934000
      DISKWAIT(DLNK.[CF],30,LASTLINK);                                  08935000
PS2:  S[2].[CF] ~ IF (S[18]~PRIORITY) > 32767 THEN 32767 ELSE PRIORITY; 08936000
      LEVEL ~ IF PRIORITY>SHEETMAX THEN SHEETMAX ELSE PRIORITY;         08937000
      IF SHEET[LEVEL].[CF] ! 0 THEN                                     08938000
      BEGIN DISKWAIT(-DLNK.[CF],30,SHEET[LEVEL].[FF]);                  08939000
            DLNK[29] ~ THISLINK;                                        08940000
            DISKWAIT(DLNK.[CF],30,SHEET[LEVEL].[FF]);                   08941000
      END ELSE SHEET[LEVEL] ~ THISLINK;                                 08944000
      SHEET[LEVEL].[FF] ~ THISLINK;                                     08944500
      S[29] ~ 0; S[3] ~ ABS(S[3]); % TO GET SELECTION TO PRINT MESSAGE; 08945000
      DISKWAIT(S.[CF],30,THISLINK);                                     08946000
      FORGETSPACE(DLNK); FORGETSPACE(BUFF);                             08947000
                                                                        08948000
EXIT: SHEETFREE ~ TRUE;                                                 08997000
      FORGETSPACE(S);                                                   08998000
      IF TYPE!34 THEN BEGIN KEYBOARDCOUNTER ~ KEYBOARDCOUNTER-1;        08998200
                            SELECTION;                                  08998400
                            KEYBOARDCOUNTER ~ KEYBOARDCOUNTER+1;        08998600
    END ELSE SCHEDLOOK(0,0);%TYPE OUT SCHEDULED TASKS                   08998800
END SHEETDIDDLER;                                                       08999000
 PROCEDURE LOGOUT;                                                      09000000
         BEGIN ARRAY L=LOGARRAY[*];                                     09001000
              REAL DT,BH,RCW=+0;                                        09002000
              INTEGER AH,DA,N;                                          09003000
              LABEL START,EXIT;                                         09004000
              SUBROUTINE UNLOCK;                                        09004100
              BEGIN HOLDFREE:=TRUE;                                     09004200
                   SPOUT(AH);                                           09004400
                   FORGETSPACE(DT);                                     09004500
                   FORGETSPACE(BH);                                     09004600
              END;                                                      09004700
    START:                                                              09005000
               DT := SPACE(30);                                         09006000
              IF L[33]=0 THEN                                           09008000
              BEGIN;STREAM(DT); DS~9 LIT "NULL LOG~";                   09009000
                   SPOUT(DT);                                           09010000
                   GO TO EXIT                                           09011000
              END;                                                      09012000
              SLEEP([TOGLE],HOLDMASK); HOLDFREE:=0;                     09012100
              DISKWAIT(-DT,-30,DIRECTORYTOP-SYSNO);                     09012200
              AH:=M[DT+20].[8:10];                                      09013000
              DO                                                        09013600
              BEGIN AH:=(AH+1) MOD 1000;                                09013700
                   STREAM(AH, N:=[N]);                                  09013800
                   BEGIN SI:=LOC AH; DS:=8 DEC END;                     09013900
                   N:=N&ACTDATE[6:12:24];                               09014000
              END                                                       09014100
              UNTIL AH=999 OR DIRECTORYSEARCH(-N,"LOG    "              09014200
$INCLUDE 09014301, IF SHAREDISK;                                        09014299
                   &(SYSNO+17)[24:42:6]                                 09014300
                   ,5)=0;                                               09014400
              M[DT+20]:=0&AH[8:38:10];                                  09014500
              SLEEP([L[32]],-0); L[32]~ABS(*P(DUP));                    09015000
              SLEEP([L[31]],IOMASK);                                    09016000
              AH := SPACE(30);                                          09017000
              MOVE(30,AH-1,AH);                                         09018000
              BH := SPACE(30);                                      %LOG09019000
              IF DA=0 THEN                                              09019100
              IF (M[AH+10]:=PETUSERDISK(-L[34],1))=0 THEN               09019200
              BEGIN STREAM(N,AH);                                       09019300
                   BEGIN DS:=18 LIT"#NO USER DISK FOR ";                09019400
                        SI:=LOC N; SI:=SI+1; DS:=7 CHR;                 09019500
                        DS:=5 LIT"/LOG~";                               09019600
                   END;                                                 09019700
                   L[32]:=NABS(*P(DUP));                                09019750
                   UNLOCK;                                              09019800
                   DA:=GETUSERDISK(L[34]&2[1:46:2]);                    09019900
                   GO TO START;                                         09020000
              END ELSE ELSE M[AH+10]:=DA;                               09020100
              M[BH] := NOT 0;                                           09020200
              DISKWAIT(BH,1,M[AH+10]);                                  09020300
              DISKWAIT(-BH,30,L[36]);                                   09021000
              MOVE(10,BH,AH);                                           09022000
              M[BH+4]:=0&1[9:47:1];                                     09024900
              STREAM(A:=[DATE],B:=BH+3,C:=0);                           09025000
              BEGIN                                                     09025100
                     SI:=A; DI:=LOC C; DS:=8 OCT; SI:=LOC C;            09025200
                     SI:=SI+5; DI:=B; DI:=DI+5; DS:=3 CHR;              09025300
               END;                                                     09025400
              L[35]~M[AH+10];                                           09026000
              L[33]:=0;                                                 09027000
              L[32]:=NABS(*P(DUP));                                     09027500
              ENTERUSERFILE(-N,"LOG    "                                09028000
$ INCLUDE 09028051, IF SHAREDISK;                                       09028049
                   &(SYSNO+17)[24:42:6]                                 09028050
                   ,BH-1);                                              09028100
              M[AH+7] := M[AH+8]|3 - (M[AH+9] := 1);                %LOG09028200
              DISKWAIT(AH,30,L[36]);                                    09029000
              STREAM(N,                                                 09030000
$ INCLUDE 09030101, IF SHAREDISK;                                       09030099
                   S:=SYSNO+17,                                         09030100
                   AH);                                                 09030200
              BEGIN DS~21LIT "**** NEW LOG FILE IS ";                   09031000
                   SI~LOC N; SI~SI+1; DS~7 CHR;                         09032000
                   DS:=6 LIT"/LOG ~";                                   09033000
$ INCLUDE 09033101, IF SHAREDISK;                                       09033099
                   DI:=DI-2;SI:=LOC S;SI:=SI+7;DS:=CHR;                 09033100
              END;                                                      09034000
              DISKWAIT(DT,-30,DIRECTORYTOP-SYSNO);                      09036000
              UNLOCK;                                                   09037000
              TIMEOUT(SPACE(10));                                       09037100
              GIMEDATE(SPACE(10),1);                                    09037200
    EXIT:                                                               09038000
              KILL([RCW] INX NOT 2);                                    09039000
         END;                                                           09040000
PROCEDURE LOGDISK;                                                      09050000
BEGIN      REAL FID,MID,C,N;   REAL RCW=+0;                             09051000
    LABEL SEEK;                                                         09052000
    C~0;                                                                09052500
SEEK:                                                                   09053000
    SEEKNAM(-1,-1,C,MID,FID,N);                                         09054000
    IF C!0 THEN                                                         09055000
    BEGIN                                                               09056000
         IF NOT SYSTEMFILE(MID,FID) THEN                                09056500
         IF (MID:=DIRECTORYSEARCH(MID,FID,15))!0 THEN FORGETSPACE(MID); 09057000
         GO SEEK;                                                       09058000
    END;                                                                09059000
    STREAM(N~N~GETSPACE(10,0,0)+2);                                     09060000
         DS~29 LIT"#DISK FILE LOGGING COMPLETED~";                      09061000
    SPOUT(N);                                                           09062000
    KILL([RCW] INX NOT 2);                                              09063000
END;                                                                    09064000
PROCEDURE LINEMESSAGES(BUFH);   VALUE BUFH;   REAL BUFH;                09100000
    BEGIN                                                               09101000
    REAL LINE,CHRS,I,BF,UZER;                                           09102000
    LABEL ERROR,EXIT,CLEANUP;                                           09103000
    ARRAY INF[*];                                                       09104000
    BOOLEAN COLAPSE;                                                    09105000
                                                                        09106000
          REAL RCW=+0;                                              %DS%09106100
                                                                        09107000
    REAL SUBROUTINE SHOVEITOUT;                                         09108000
         BEGIN                                                          09109000
         IF P(STATABLE[LINE].DIALEDUP,DUP) THEN                         09110000
              BEGIN                                                     09111000
              IF COLAPSE THEN                                           09112000
                   BEGIN                                                09113000
                   COLAPSE~ FALSE;                                      09114000
                   STREAM(S~ BUFH: BF);                                 09115000
                        BEGIN                                           09116000
                        SI~ S;                                          09117000
                        DS:=8 LIT"-*!ATTN:";                            09118000
X:                      IF SC!"~" THEN                                  09119000
                             BEGIN                                      09120000
                             IF SC=" " THEN                             09121000
                             BEGIN                                      09122000
                             DS:=CHR;                                   09123000
                        BB:  IF SC = " " THEN                           09124000
                                  BEGIN SI:=SI+1; GO BB; END;           09125000
                             END;                                       09128000
                             IF SC = "!" THEN                           09129000
                             BEGIN DS:=LIT MARK; SI:=SI+1; END ELSE     09129500
                             DS~ CHR;                                   09130000
                             GO X;                                      09131000
                             END;                                       09132000
                                                                        09133000
                        DS:=3 LIT"!-*";                                 09134000
                        S~ DI;                                          09135000
                        END;                                            09136000
                   CHRS~ ((CHRS~ P).[33:15]-BF)|8+CHRS.[30:3];          09137000
                   END;                                                 09138000
              TWXOUT(BF,CHRS,-1,LINE);                                  09140000
              END;                                                      09141000
         SHOVEITOUT~ P;                                                 09141500
         END;                                                           09142000
    BF~ BUFH.[15:15]-1;                                                 09142300
    COLAPSE~ TRUE;                                                      09142600
    STREAM(RESULT~ -1,S~ 0: B~ BUFH, A~ "ALL");                         09143000
         BEGIN                                                          09144000
         SI~ B;                                                         09145000
DD:      IF SC=" " THEN BEGIN SI~ SI+1;  GO DD END;                     09146000
         S~ SI;  DI~LOC A;                                              09147000
         IF SC<"0" THEN                                                 09148000
              BEGIN                                                     09149000
              DI~ DI+5;                                                 09150000
              IF 3 SC=DC THEN                                           09151000
                   BEGIN                                                09151100
                   IF SC=ALPHA THEN GO U;                               09151200
                   RESULT~ TALLY                                        09152000
                   END                                                  09152100
              ELSE                                                      09153000
              U:   BEGIN                                                09154000
                   DI~ LOC RESULT;  DS~ 8 LIT "+       ";               09155000
                   SI~ S;  DI~ LOC RESULT; DI~ DI+1;                    09156000
                   7(IF SC=ALPHA THEN DS~CHR ELSE JUMP OUT);            09157000
                   END                                                  09158000
              END                                                       09159000
         ELSE                                                           09160000
              BEGIN                                                     09161000
              IF SC>9 THEN GO EXI;                                      09162000
              SI~ SI+1;  DI~ LOC RESULT;                                09163000
              IF SC<0 THEN GO ONE;                                      09164000
              IF SC>9 THEN GO ONE;                                      09165000
              SI~ S;    DS~ 2 OCT;     GO SUC;                          09166000
ONE:          SI~ S;    DS~ 1 OCT;                                      09167000
SUC:          END;                                                      09168000
EXI:     S~ SI;                                                         09171000
         END;                                                           09172000
         BUFH~ P;                                                       09173000
         IF (LINE~P)=(-1) THEN GO ERROR;                                09174000
         IF LINE<0 THEN                                                 09175000
              BEGIN     % USERID WAS GIVEN                              09176000
              INF~ [M[GETSPACE(SYSDISKRL,0,0)+2]]&SYSDISKRL[8:38:10];   09177000
              UZER~ ABS(LINE);   I~0;                                   09178000
              FOR LINE:= 0 STEP 1 UNTIL STATIONMAX DO                   09179000
                   BEGIN                                                09180000
                   SYSDISKIO(1,LINE,INF);                               09181000
                   IF (UZER EQV INF[1])=NOT 0 THEN                      09182000
                        BEGIN                                           09183000
                        I~ I+SHOVEITOUT;                                09184000
                        END                                             09186000
                   END;                                                 09187000
              SYSDISKIO(1,STATIONMAX+1,INF);                            09187500
              FORGETSPACE(INF);                                         09188000
              IF I=0 THEN                                               09188500
                   BEGIN                                                09189000
                   LINE~ NABS(UZER);                                    09189300
                   GO ERROR;                                            09189500
                   END                                                  09190000
              ELSE                                                      09190500
                   GO CLEANUP;                                          09191000
              END;                                                      09192000
         IF LINE GTR STATIONMAX THEN GO ERROR;                          09193000
         IF LINE>0 THEN           % LINE WAS GIVEN                      09194000
              IF SHOVEITOUT THEN GO CLEANUP ELSE                        09195000
              BEGIN;                                                    09196000
              STREAM(L~LINE,T~1+(LINE>9),BF);                           09197000
                   BEGIN                                                09198000
                   DS~ 5 LIT "LINE ";                                   09199000
                   SI~ LOC L;  DS~ T DEC;                               09200000
                   DS~ 15 LIT " NOT DIALED-UP~";                        09201000
                   END;                                                 09202000
              SPOUT(BF);                                                09203000
              GO EXIT;                                                  09204000
              END;                                                      09205000
         I~ 0;                    % SS ALL                              09206000
         FOR LINE := 1 STEP 1 UNTIL STATIONMAX DO                       09207000
              I~ I+ SHOVEITOUT;                                         09208000
         IF I=0 THEN                                                    09209000
              BEGIN;                                                    09210000
              STREAM(BF); DS~ 19 LIT "NO LINES DIALED-UP~";             09211000
              SPOUT(BF);                                                09212000
              GO EXIT;                                                  09213000
              END;                                                      09214000
CLEANUP: FORGETSPACE(BF);                                               09215000
         GO EXIT;                                                       09216000
ERROR:   IF LINE>0 THEN                                                 09217000
              STREAM(L~ LINE,BF);                                       09218000
                   BEGIN                                                09219000
                   DS~ 5 LIT "LINE ";                                   09220000
                   SI~ LOC L; DS~ 2 DEC;                                09221000
                   DS~ 15 LIT " NOT AVAILABLE~";                        09222000
                   END                                                  09223000
         ELSE                                                           09224000
              IF LINE<(-1) THEN                                         09225000
                   STREAM(L~ LINE,BF);                                  09226000
                   BEGIN                                                09227000
                   SI~ LOC L;  SI~ SI+1;                                09228000
                   DS~ 7 CHR;                                           09229000
                   DS~ 15 LIT " NOT DIALED-UP~";                        09230000
                   END;                                                 09231000
         SPOUT(BF);                                                     09232000
EXIT:                                                                   09233000
          KILL([RCW] INX NOT 2);                                    %DS%09233950
    END;                                                                09234000
PROCEDURE CALLCANDE(BUFH,TYPE);  VALUE BUFH,TYPE;  REAL BUFH,TYPE;      09300000
    BEGIN                                                               09301000
    REAL BUFF,A,L,F;                                                    09302000
    BUFF~ BUFH.[15:15]-1;                                               09303000
     IF TYPE=0 THEN P(BUFH) ELSE                                        09303500
    STREAM(BUFH:T~ TYPE);                                               09304000
         BEGIN                                                          09305000
         DI~ BUFH;  DI~ DI-3;  BUFH~ DI;  SI~ LOC T;  SI~ SI+6;         09306000
              DS~ 2 CHR;  DS~ LIT " ";                                  09307000
         END;                                                           09308000
    BUFH~ P;                                                            09309000
    DO BEGIN                                                            09310000
         A~ GETAREA(2);                                                 09311000
$INCLUDE 09312501, IF DCP;                                              09311999
         TYPE:=BUFH;                                                    09312000
         STREAM(R:=0, BUFH: A:=A INX 3);                                09312500
$OMIT 09313001, IF DCP;                                                 09312999
         STREAM(R~0,BUFH:A~ A INX 1);                                   09313000
              BEGIN                                                     09314000
              SI~ BUFH;                                                 09315000
              2(56(IF SC!"~" THEN DS~ CHR ELSE                          09316000
                   BEGIN DS~ LIT "~";  TALLY~ 1;  R~ TALLY;             09317000
                      JUMP OUT 2 TO E END));                            09318000
              E:   BUFH~ SI;                                            09319000
              END;                                                      09320000
         BUFH~ P;  F~ P;                                                09321000
$INCLUDE 09321201, IF DCP;                                              09321099
         M[A+1]:=BUFH.[30:3]&BUFH[30:33:15]-TYPE.[30:3]&TYPE[30:33:15]; 09321100
         M[A+2]:=0;                                                     09321200
         IF L!0 THEN                                                    09322000
              BEGIN                                                     09323000
              M[A]~ P(DUP,LOD) & L [CTF];                               09324000
              M[L]~ P(DUP,LOD) & A [CTC];                               09325000
              END;                                                      09325500
         L:=A;                                                          09325600
    END UNTIL F;                                                        09326000
$INCLUDE 09326501, IF DCP;                                              09326499
    GIVEAWAY(A,4);                                                      09326500
$OMIT 09328001, IF DCP;                                                 09326999
    M[A].MESSEND:=1;                                                    09327000
    GIVEAWAY(A);                                                        09328000
    FORGETSPACE(BUFF);                                                  09329000
    END CALLCANDE;                                                      09330000
         PROCEDURE INTRINSICTABLEBUILDER(FH);%                          09500000
         VALUE FH;  REAL FH;                                            09501000
         BEGIN REAL DISKADDR, LOC, T, IOD;%                             09502000
              DISKWAIT(-(LOC~SPACE(30)),30,                             09503000
                        DISKADDR ~ M[FH INX 10]);%                      09504000
              T~M[LOC]+1;                                               09506000
              INTRNSC := [M[SPACE(T)]]&T[8:38:10];                      09507000
              IF T>30 THEN BEGIN%                                       09508000
                   DISKWAIT(-INTRNSC.[CF],T,DISKADDR);                  09509000
              END ELSE MOVE(T,LOC,INTRNSC);                             09511000
              M[INTRNSC INX NOT 0]:=0;                              %R7809511100
              NT1 ~ 1;%                                                 09512000
              DO INTRNSC[NT1] ~ NABS((P(*P(DUP), DUP).[8:10]+INTSIZE)%  09513000
                   &(P(XCH) INX 0 + DISKADDR)[6:21:27])%                09514000
                UNTIL (NT1~NT1+1)=T;%                                   09515000
              DISKADDR ~ 0&1[4:47:1];                                   09515100
              INTRNSC[2] := *P(DUP) OR DISKADDR;                        09515200
              FOR T:=17 STEP 1 UNTIL 20 DO                              09515300
                INTRNSC[T] := *P(DUP) OR DISKADDR;                      09515400
              FORGETSPACE(LOC);                                         09516000
              INTSIZE ~ (INTRNSC[0]+3) DIV 4;%                          09517000
    END OF INTRINSIC TABLE BUILDER;%                                    09519000
BOOLEAN PROCEDURE SYSTEMFILE(A,B); VALUE A,B; REAL A,B; FORWARD;        09550000
 PROCEDURE CHANGEINTRINSICFILE(BUFF);  VALUE BUFF;  REAL BUFF;%         09600000
BEGIN                                                                   09601000
    REAL A,B,I,J,K,L,FH,T,IT;                                           09602000
    LABEL EXIT,WITHOUT,NG;                                              09602200
    BOOLEAN SUBROUTINE NULLMIX;%                                        09603000
    BEGIN POLISH(1);%                                                   09604000
         IF INTSIZE!0 THEN BEGIN INTSIZE ~ 0;%                          09605000
              FOR I~1 STEP 1 UNTIL MIXMAX DO%                           09606000
              IF JARROW[I]!0 THEN%                                      09607000
              IF (JARROW[I] INX 0)}FENCE THEN GO NG ELSE                09607100
              IF ((JAR[I,1] EQV "DISK   ")!NOT 0) OR%                   09608000
                (((JAR[I,0] EQV "LDCNTRL")!NOT 0) AND%                  09609000
                 ((JAR[I,0] EQV "PRNPBT ")!NOT 0)) THEN%                09610000
         NG:  BEGIN P(DEL,0);  I~MIXMAX END;                            09611000
              IF NOT P(DUP) THEN INTSIZE ~ (INTRNSC[0]+3) DIV 4;%       09612000
         END;%                                                          09613000
         NULLMIX ~ POLISH;%                                             09614000
    END NULLMIX;%                                                       09615000
    SUBROUTINE FORGETEM;%                                               09616000
    BEGIN WAITSTORE(0); STOREDY[0]~0;                                   09617000
         WHILE (K ~ M[L]).[CF]!0 DO%                                    09618000
         BEGIN IF K>0 THEN%                                             09619000
              IF K.[3:12]=@700 THEN%                                    09620000
                FORGETSPACE(L+2);%                                      09621000
              L ~ K.[CF];%                                              09622000
         END;%                                                          09623000
         STOREDY[0]~1;                                                  09624000
              FORGETSPACE(INTRNSC INX 0); INTRNSC~0                     09624100
    END FORGETEM;%                                                      09625000
    DEFINE ERROR = GO TO EXIT#;%                                        09626000
                                                                        09627000
                                                                        09629000
         SLEEP([TOGLE], FREEMASK);  INTFREE ~ FALSE;%                   09630000
         T ~ BUFF;%                                                     09631000
         NAMEID(A,T);  NAMEID(B,T);  NAMEID(B,T);%                      09632000
         IF (FH:=DIRECTORYSEARCH(A,B,17))=0 THEN ERROR;                 09633000
         IF NOT NULLMIX THEN                                            09634000
              COMPLEXSLEEP(NULLMIX);                                    09634200
         IF INTRNSC!0 THEN FORGETEM;                                    09636000
$ OMIT 09638001, IF SHAREDISK;                                          09636999
         IF MCPFREE!0 THEN SLEEP([TOGLE],MCPMASK);                      09637000
         MCPFREE:=0;                                                    09638000
         T:=SPACE(30);                                                  09639000
         DISKWAIT(-T,-30,0);                                            09640000
         I:=T+13+5|SYSNO;                                               09641000
         IF (IT:=DIRECTORYSEARCH(M[I],M[I+1],16))!0 THEN                09642000
         FORGETSPACE(IT);                                               09643000
         M[I]:=A;                                                       09644000
         M[I+1]:=B;                                                     09645000
         DISKWAIT(T,-30,0);                                             09646000
$ OMIT 09647001, IF SHAREDISK;                                          09646999
         MCPFREE:=1;                                                    09647000
         FORGETSPACE(T);                                                09648000
%                                                                       09650000
         INTRINSICTABLEBUILDER(FH);                                     09657000
         FORGETSPACE(FH);                                               09658000
         STREAM(A, B, NT1 ~ BUFF.[15:15]-1);%                           09670000
         BEGIN DS ~ 24 LIT " NEW INTRINSIC FILE IS: ";%                 09671000
              SI ~ LOC A;  SI ~ SI+1;  DS ~ 7 CHR;  SI ~ SI+1;%         09672000
              DS ~LIT "/";  DS ~ 7 CHR;  DS ~ 2 LIT ".~";%              09673000
         END STREAMING AROUND;%                                         09674000
    EXIT:  SPOUT(BUFF.[15:15]-1);%                                      09676000
         INTFREE ~ TRUE;%                                               09677000
         BUFF ~ 0;  KILL([BUFF] INX NOT 1);                             09678000
    END CHANGING INTRINSIC FILES ON USER DISK WITH MANY PRECAUTIONS;%   09679000
PROCEDURE CHANGEMCP(BUFF); VALUE BUFF; REAL BUFF;                       09679100
BEGIN                                                                   09679200
    REAL RCW=+0,A=RCW+1,B=A+1,T=B+1,Z=T+1,BASE=Z+1;                     09679300
    LABEL EXIT;                                                         09679400
    P(0,0,0,0,0);                                                       09679600
    T:=BUFF;                                                            09679800
    NAMEID(A,T); NAMEID(B,T); NAMEID(B,T);                              09679900
$ OMIT 09680101, IF SHAREDISK;                                          09679999
    IF MCPFREE!0 THEN SLEEP([TOGLE],MCPMASK);                           09680000
    MCPFREE:=0;                                                         09680100
    Z:=SPACE(30);                                                       09680200
    DISKWAIT(-Z,-30,0);                                                 09680300
    BASE:=Z+10+5|SYSNO;                                                 09680400
    IF (A EQV M[BASE])!NOT 0 OR                                         09680500
       (B EQV M[BASE+1])!NOT 0 THEN                                     09680600
    BEGIN                                                               09680700
         IF (T:=DIRECTORYSEARCH(A,B,17))=0 THEN                         09680800
         BEGIN;                                                         09680900
              STREAM(A:=[A],T:=BUFF.[15:15]-1);                         09681000
              BEGIN DS:=13 LIT"#NO MCP FILE ";SI:=A;SI:=SI+1;           09681100
                   DS:=7 CHR;DS:=LIT"/";SI:=SI+1;DS:=7 CHR;             09681200
              DS~LIT"~";                                                09681250
              END;                                                      09681300
              GO TO EXIT;                                               09681400
         END;                                                           09681500
         IF M[BASE+2]-2!MCPBASE THEN                                    09681600
         FORGETSPACE(DIRECTORYSEARCH(M[BASE],M[BASE+1],16));            09681650
         M[BASE]:=A;                                                    09681700
         M[BASE+1]:=B;                                                  09681800
         M[BASE+2]:=M[T+10];                                            09681900
    END;                                                                09682100
    STREAM(A:=[A],T:=BUFF.[15:15]-1);                                   09682200
    BEGIN DS:=18 LIT " NEXT MCP WILL BE ";SI:=A;SI:=SI+1;               09682300
         DS:=7 CHR;DS:=LIT"/";SI:=SI+1;DS:=7 CHR;                       09682400
         DS~LIT"~";                                                     09682450
    END;                                                                09682500
EXIT:                                                                   09682600
    DISKWAIT(Z,-30,0);                                                  09682610
$ INCLUDE 09682621, IF NOT SHAREDISK;                                   09682619
    MCPFREE:=TRUE;                                                      09682620
    FORGETSPACE(Z);                                                     09682700
    SPOUT(BUFF.[15:15]-1);                                              09682800
    BUFF:=0;                                                            09683000
    KILL([RCW] INX NOT 2);                                              09683050
END CHANGING OF THE MCP;                                                09683100
    BOOLEAN PROCEDURE SYSTEMFILE(A,B);  VALUE A,B;  REAL A,B;%          09700000
    BEGIN LABEL DISK,LOG,TRUTH,DIR,SYS,REM,DECK,MASK,TEST;              09701000
         LABEL DMP,LIB;                                                 09701500
         LABEL SCHED;                                                   09701510
$ INCLUDE 09701601, IF STATISTICS;                                      09701599
LABEL STATS;                                                            09701600
         DEFINE T=P(TRUTH)#;%                                           09702000
         IF (B EQV P(DISK))=T THEN%                                     09703000
              P(((A EQV P(DIR))=T) OR                                   09704000
              ((A EQV P(DMP))=T) OR ((A EQV P(LIB))=T) OR               09704500
                   ((A EQV P(LOG))=T))                                  09704550
         ELSE IF (B EQV P(LOG))=T THEN%                                 09705000
              P(((A EQV P(SYS))=T) OR ((A EQV P(REM))=T))%              09706000
         ELSE IF (A EQV P(DECK))=T THEN%                                09707000
              P(((B AND P(MASK)) EQV P(TEST))=T)%                       09708000
$ INCLUDE 09708201, IF STATISTICS;                                      09708099
         ELSE IF (B EQV P(STATS))= T THEN%                              09708100
              P((A EQV P(SYS))=T)                                       09708200
         ELSE P((B EQV P(SCHED))=T);                                    09709000
         P(RTN);%                                                       09710000
    DISK :::  "DISK   ";%                                               09711000
    LOG  :::  "LOG    ";%                                               09712000
    TRUTH:::  @3777777777777777;%                                       09713000
    DIR  :::  "DIRCTRY";%                                               09715000
    SYS  :::  "SYSTEM ";%                                               09716000
    REM  :::  "REMOTE ";%                                               09717000
    DECK :::  "DECK   ";%                                               09718000
    MASK :::  @77000000007777;%                                         09719000
    TEST :::  @12000000003714;%                                         09720000
    DMP  :::  "DMPAREA";%                                               09720500
    LIB  :::  "LIBMAIN";                                                09720600
    SCHED:::   "SCHEDUL";%                                              09720700
$ INCLUDE 09720801, IF STATISTICS;                                      09720799
    STATS:::  "STATS  ";%                                               09720800
    END;%                                                               09721000
PROCEDURE WHATSGOINGON(BUFH); VALUE BUFH; REAL BUFH;                %DS%09800000
    BEGIN                                                               09801000
    REAL I,MX,LM,BUFF,LINE,S,T,PRTM,ELTM,Q,Z;                           09802000
    LABEL NOONE,OK,EXIT,SPUUTIT,EGRESS,MIXUP;                           09803000
    ARRAY INF[*],MIXER[*];                                              09804000
    BOOLEAN GETBUFF;                                                    09805000
     REAL MIX, RCW=+0;                                              %DS%09805100
     MIX := BUFH.[9:6];                                             %DS%09805200
    LM:=STATIONMAX+1;  BUFF:=BUFH.[15:15]-1;                            09806000
    STREAM(L~-1:B~BUFH);                                                09807000
         BEGIN                                                          09808000
         SI~ B;  DI~LOC L;                                              09809000
    DD:  IF SC=" " THEN BEGIN SI~ SI+1; GO DD END;  B~ SI;              09810000
         IF SC}"0" THEN IF SC{"9" THEN                                  09811000
              BEGIN                                                     09812000
              SI~ SI+1;                                                 09813000
              IF SC}"0" THEN IF SC{"9" THEN                             09814000
                   BEGIN                                                09815000
                   SI~ B;  DS~ 2 OCT;                                   09816000
                   GO EG;                                               09817000
                   END;                                                 09818000
              SI~ B;  DS~ OCT;                                          09819000
              END;                                                      09820000
EG:      END;                                                           09821000
    IF (LINE:=P)=0 OR LINE GTR STATIONMAX THEN                          09822000
         GO EXIT;                                                       09823000
    INF~ [M[GETSPACE(SYSDISKRL,0,0)+2]]&SYSDISKRL[8:38:10];             09824000
    MIXER~ [M[GETSPACE(MIXMAX+1,0,0)+2]]&(MIXMAX+1)[8:38:10];           09825000
     IF (I~ MIX)!0 THEN GO MIXUP;                                       09825100
    MIXER[0]~ 1;                                                        09826000
    MOVE(MIXMAX,MIXER,MIXER INX 1);                                     09827000
    IF LINE>0 THEN                                                      09828000
         BEGIN                                                          09829000
         SYSDISKIO(1,-LINE,INF);                                        09830000
         I:=LINE;                                                       09830500
         IF NOT SCHEDLINE[LINE] THEN                                    09831000
         IF NOT STATABLE[LINE].DIALEDUP THEN                            09831500
              BEGIN                                                     09832000
              GETBUFF~ TRUE;                                            09833000
              STREAM(BUFF); DS~8 LIT " NULL  ~";                        09834000
              SPOUT(BUFF);                                              09835000
              GO EGRESS;                                                09835500
              END;                                                      09836000
         IF INF[1] LEQ 0 THEN GO TO NOONE ELSE                          09836500
         GO SPUUTIT;                                                    09837000
         END;                                                           09838000
    FOR I~ 0 STEP 1 UNTIL LM DO                                         09839000
         BEGIN                                                          09840000
         SYSDISKIO(1,I,INF);                                            09841000
         IF I LEQ STATIONMAX THEN                                       09841400
         IF STATABLE[I].DIALEDUP THEN                                   09841500
         IF INF[1] GTR 0 THEN GO TO OK ELSE GO TO NOONE ELSE            09842000
         IF SCHEDLINE[I] THEN                                           09842500
              BEGIN                                                     09843000
NOONE:        INF[1]:="NOBODY ";                                        09843500
OK:           IF GETBUFF THEN                                           09844000
                   BUFF~ GETSPACE(10,0,0)+2                             09845000
              ELSE                                                      09846000
SPUUTIT:           GETBUFF~ TRUE;                                       09847000
              Q:=1;                                                     09847050
              S:=SCHEDLINE[I];                                          09847060
              IF (MX:=STATABLE[I].MIXNR) GTR 0 THEN                     09847100
              IF MX!CANDYINX THEN                                       09847110
                   IF (T:=PUTORTAKE(MX,[JAR[MX,3]],1&1[2:47:1],0))=NOT 009847200
                   THEN Q:=0 ELSE                                       09847210
                   BEGIN                                                09847220
                   T:=T+PUTORTAKE(MX,[PROCTIME[MX]],1,0);               09847230
                   Q:=PUTORTAKE(MX,[JAR[MX,0]],1,0);                    09847240
                   Z:=PUTORTAKE(MX,[JAR[MX,1]],1,0);                    09847250
                   IF MX=P2MIX THEN T~ T+CLOCK+P(RTR);                  09847300
                   FORMTIME([PRTM],T);                                  09847350
                   T~ ((CLOCK+P(RTR))/60)-PUTORTAKE(MX,[UV[MX,9]],1,0)  09847400
                        .[1:17];                                        09847450
                   FORMTIME([ELTM],T|60);                               09847500
                   END ELSE MX~0;                                       09847550
                   STREAM(X:=Q=0, S, U:=INF[1], I,                      09849000
$INCLUDE 09849501, IF DCP;                                              09849499
                     L:=STATABLE[I].[24:8], ST:=STATABLE[I].[32:8],     09849500
                     Q, Z, M:=MX, N:=PRTM, O:=ELTM, B:=BUFF);           09850000
                   BEGIN                                                09851000
                   SI~LOC U; SI~SI+1; DS~LIT " ";                       09852000
                   DS~7 CHR; DS~4 LIT" ON "; U~DI;                      09853000
                   DS~ 2 DEC;  B~ DI;  DI~ U; DS~ FILL;  DI~ B;         09854000
$INCLUDE 09854401, IF DCP;                                              09854099
                   DS:=2 LIT"-(";                                       09854100
                   S(DS:=5 LIT"SCHED"; JUMP OUT TO LL);                 09854120
                   U:=DI; DI:=LOC I;                                    09854140
                   DS:=3 DEC; DS:=3 DEC; DS:=LIT"A";                    09854160
                   SI:=LOC I; DI:=U;                                    09854180
              LL2: IF SC="0" THEN                                       09854200
                   BEGIN SI:=SI+1;                                      09854220
                        IF SC!"0" THEN DS:=2 CHR ELSE                   09854240
                        BEGIN SI:=SI+1; DS:=CHR END                     09854260
                   END ELSE DS:=3 CHR;                                  09854280
                   IF SC GEQ "0" THEN BEGIN DS:=LIT"/"; GO TO LL2 END;  09854300
              LL:  DS:=LIT")"; SI:=LOC Q;                               09854400
$OMIT 09854501, IF DCP;                                                 09854499
                   S(DS:=8 LIT"-(SCHED)");                              09854500
                   M(DS~ 7 LIT " USING ";                               09855000
                   X(DS:=15 LIT"HUNG JOB: MIX ="; SI:=LOC M; DS:=2 DEC; 09855100
                    U:=DI; DI:=DI-2; DS:=2 FILL; DI:=U;                 09855200
                    JUMP OUT 2 TO EXIT);                                09855300
                   SI~ SI+1;  DS~ 7 CHR;   DS~ LIT "/";                 09856000
                   SI~ SI+1;  DS~ 7 CHR;   DS~ LIT "=";                 09857000
                   DS~2 DEC; U~DI; DI~DI-2; DS~FILL; DI~U;              09857500
                   DS~5 LIT " PST="; DS~8 CHR;                          09858000
                   DS~ 4 LIT " IN ";  DS~ 8 CHR;  JUMP OUT);            09858100
         EXIT:     DS:=LIT"~";                                          09859000
                   END;                                                 09860000
              SPOUT(BUFF);                                              09861000
              IF REPLY[MX]<0 THEN                                       09861100
              IF Q!0 THEN                                               09861150
                   BEGIN                                                09861200
                   REPLY[MX]~ 10;                                       09861300
                   BRINGBACK(MX);                                       09861350
                   CLICK:=CLOCK+P(RTR)+240;                             09861360
                   SLEEP([REPLY[MIX]],-0);                              09861370
                   END;                                                 09861400
              IF LINE>0 THEN GO EGRESS;                                 09862000
              MIXER[MX]~ 0;                                             09863000
              END;                                                      09864000
         END;                                                           09865000
    FOR I~ 1 STEP 1 UNTIL MIXMAX DO                                     09866000
         IF MIXER[I]!0 THEN                                             09867000
              IF JAR[I,*]!0 THEN                                        09868000
MIXUP:             BEGIN                                                09869000
                   Q:=0;                                                09869500
                   IF GETBUFF THEN                                      09870000
                        BUFF~ GETSPACE(10,0,0)+2                        09871000
                   ELSE                                                 09872000
                        GETBUFF~ TRUE;                                  09873000
                   IF (T:=PUTORTAKE(I,[JAR[I,3]],1&1[2:47:1],0))=NOT 0  09873100
                   THEN STREAM(I,BUFF);                                 09873110
                   BEGIN DS:=4 LIT"MIX ";                               09873120
                        SI:=LOC I; DS:=2 DEC;                           09873130
                        DS:=9 LIT" IS HUNG~";                           09873140
                        DI:=DI-11; DS:=2 FILL;                          09873150
                   END ELSE                                             09873160
                   BEGIN T:=T+PUTORTAKE(I,[PROCTIME[I]],1,0);           09873200
                   IF I=P2MIX THEN T~ T+CLOCK+P(RTR);                   09873300
                   FORMTIME([PRTM],T);                                  09873400
                   T~ ((CLOCK+P(RTR))/60)-PUTORTAKE(I,[UV[I,9]],1,0)    09873500
                        .[1:17];                                        09873600
                   FORMTIME([ELTM],T|60);                               09873700
                   Q:=1;                                                09873800
                   STREAM(U~ PUTORTAKE(I,[USERCODE[I]],1,0),            09874000
                        Q~PUTORTAKE(I,[JAR[I,0]],1,0),                  09875000
                        Z~ PUTORTAKE(I,[JAR[I,1]],1,0), M~ I,           09876000
                        N~ PRTM, O~ ELTM, B~ BUFF);                     09876100
                        BEGIN                                           09877000
                        SI~LOC U; SI~SI+1; DS~LIT " "; DS~7 CHR;        09878000
                        DS~ 7 LIT " USING ";                            09879000
                        SI~ SI+1;  DS~ 7 CHR;  DS~ LIT "/";             09880000
                        SI~ SI+1;  DS~ 7 CHR;  DS~ LIT "=";             09881000
                        DS~ 2 DEC;  DS~ 5 LIT " PST=";  DS~ 8 CHR;      09882000
                        DS~ 4 LIT " IN ";  DS~ 8 CHR;  DS~ LIT "~";     09882100
                        END;                                            09883000
                   END;                                                 09883500
                   SPOUT(BUFF);                                         09884000
                   IF REPLY[I]<0 THEN                                   09884100
                   IF Q THEN                                            09884150
                        BEGIN                                           09884200
                        REPLY[I]~ 10;                                   09884300
                        BRINGBACK(I);                                   09884400
                        CLICK:=CLOCK+P(RTR)+240;                        09884410
                        SLEEP([REPLY[MIX]],-0);                         09884420
                        END;                                            09884500
                   IF MIX!0 THEN GO EGRESS;                             09884600
                   END;                                                 09885000
EGRESS:                                                                 09886000
    FORGETSPACE(MIXER);                                                 09887000
    FORGETSPACE(INF);                                                   09888000
    IF GETBUFF THEN                                                     09889000
         BEGIN STREAM(B:=BUFF:=SPACE(5)); DS := 7 LIT"END SM~"; END     09890000
         ELSE STREAM(BUFF); DS := 8 LIT"NOTHING~";                      09891000
 EXIT:   SPOUT(BUFF);                                                   09892000
          KILL([RCW] INX NOT 2);                                    %DS%09893100
    END;                                                                09894000
 PROCEDURE FENCEMOVER(B, BUFF);                                         09900000
 VALUE   B, BUFF;                                                       09901000
 REAL    B, BUFF;                                                       09902000
 BEGIN LABEL  EXIT;                                                     09903000
    INTEGER   T, A;                                                     09904000
         ;STREAM(T:=0: B);                                              09905000
         BEGIN SI:=B;  IF SC=" " THEN BEGIN                             09906000
              L:   SI:=SI+1;  IF SC=" " THEN GO TO L END;               09907000
              IF SC}"0" THEN IF SC{"9" THEN                             09908000
              BEGIN B:=SI;  SI:=SI+1;  TALLY:=1;                        09909000
                   7(IF SC<"0" THEN JUMP OUT;  IF SC>"9" THEN JUMP OUT; 09910000
                     SI:=SI+1;  TALLY:=TALLY+1);                        09911000
                   SI:=B;  B:=TALLY;  DI:=LOC T;  DS:=B OCT;            09912000
         END  END  STREAMING;                                           09913000
         T := POLISH;                                                   09914000
         T := @100000-(((P(DUP)-T)DIV CHUNKZIZE)|CHUNKZIZE);            09915000
         IF T<@20000 OR T>@70000 THEN                                   09916000
         BEGIN SPOUT(BUFF-1);  GO TO EXIT END;                          09917000
         SLEEP([TOGLE], HOLDMASK);  HOLDFREE := FALSE;                  09918000
         DISKWAIT(-(A:=SPACE(30)),-30,DIRECTORYTOP-SYSNO);              09919000
         M[A+19]:=T;                                                    09920000
         DISKWAIT(A,-30,DIRECTORYTOP-SYSNO);                            09920100
         TOGLE := TOGLE OR HOLDMASK;                                    09921000
         STREAM(T,A);                                                   09922000
         BEGIN DS:=22 LIT " FENCE TO BE MOVED TO ";                     09923000
              A:=DI;  SI:=LOC T;  DS:=8 DEC;                            09924000
              DS:=LIT "~";  DI:=A;  DS:=7 FILL;                         09925000
         END  STREAMING;                                                09926000
         SPOUT(A);  FORGETSPACE(BUFF-1);                                09927000
    EXIT:  END FENCEMOVER;                                              09928000
  PROCEDURE LINECLEAR(KTR);                                             09955000
     VALUE KTR; REAL KTR;                                               09956000
     BEGIN LABEL START;                                                 09957000
         REAL BUFF,LINE,X;                                              09958000
$INCLUDE 09958201, IF DCP;                                              09958099
         REAL STA,Y,Z;                                                  09958100
         LABEL AHEAD;                                                   09958200
  START: ;                                                              09958500
         STREAM(LINE:=0, X:=0,                                          09959000
$INCLUDE 09959101, IF DCP;                                              09959099
                STA:=0, Y:=0,                                           09959100
                KTR:);                                                  09959200
         BEGIN SI:=KTR; DI:=LOC LINE;                                   09960000
           L: IF SC="~" THEN GO TO EXIT;                                09961000
              IF SC<"0" THEN BEGIN SI~SI+1; GO TO L END;                09962000
              IF SC>"9" THEN BEGIN SI~SI+1; GO TO L END;                09963000
              SI:=SI+1;                                                 09964000
              IF SC<"0" THEN GO TO ONE;                                 09965000
              IF SC{"9" THEN                                            09966000
              BEGIN SI~SI-1; DS~2 OCT END                               09967000
              ELSE BEGIN                                                09968000
           ONE:    SI~SI-1; DS~1 OCT END;                               09969000
$INCLUDE 09969501, IF DCP;                                              09969099
              IF SC="/" THEN                                            09969100
              BEGIN SI:=SI+1; DI:=LOC STA;                              09969200
                   TALLY:=1; Y:=TALLY;                                  09969300
                   GO TO L;                                             09969400
              END;                                                      09969500
              IF SC="$" THEN                                            09969600
              BEGIN SI:=SI+1; TALLY:=2; X:=TALLY; END;                  09969700
              KTR~SI;                                                   09970000
        EXIT: END STREAM;                                               09971000
         KTR~P;                                                         09972000
$INCLUDE 09972201, IF DCP;                                              09972199
         Y:=P;  STA:=P;                                                 09972200
         X:=P; LINE:=P;                                                 09972500
$INCLUDE 09973001, IF DCP;                                              09972999
         IF Y THEN GO AHEAD;                                            09973000
         IF LINE!0 AND LINE LEQ LMAX THEN                               09973100
$INCLUDE 09973201, IF DCP;                                              09973199
AHEAD:                                                                  09973200
         BEGIN                                                          09974000
              BUFF~SPACE(5);                                            09975000
              IF SCHEDLINE[LINE] THEN                                   09975100
              BEGIN IF (X=2) THEN SCHEDBUSY[LINE]:=1;                   09975110
                   IF SCHEND[LINE] THEN X:=0                            09975115
                   ELSE IF (X:=SEQARRAY[LINE].[CF])GTR 511 THEN         09975120
                   BEGIN SLEEP([M[X+32]],-0); M[X+32]:=ABS(*P(DUP)) END;09975125
                   STREAM(Y:=(X GTR 511),LINE,BUFF);                    09975130
                   BEGIN SI:=LOC LINE; DS:=9 LIT" STATION "; DS:=3 DEC; 09975140
                        LINE:=DI; DI:=DI-3; DS:=2 FILL; DI:=LINE;       09975145
                        Y(DS:=7LIT" CLEAR~"; JUMP OUT TO LL);           09975150
                        DS:=6LIT" IDLE~";                               09975160
              LL:   END;                                                09975170
                   SPOUT(BUFF);                                         09975180
                   IF X LEQ 511 THEN GO TO START;                       09975185
                   IF (NT1:=STATABLE[LINE].MIXNR) GTR 0 THEN            09975190
                   IF NT1 NEQ CANDYINX THEN                             09975200
                   BEGIN TERMINATE(NT1&3[CTF]);                         09975210
                        HALT; NOPROCESSTOG:=NOPROCESSTOG-1;             09975220
                   END ELSE SHEETDIDDLER(0,-1,LINE);                    09975230
                   M[X+77]:=M[X+78];                                    09975240
                   STREAM(BUFF:=BUFF:=SPACE(5));                        09975250
                   DS:=30LIT"**TASK TERMINATED BY OPERATOR~";           09975260
                   M[X+32]:=NABS(*P(DUP));                              09975270
                   SCHEDIO(30,1,BUFF&LINE[CTF]);                        09975280
                   FORGETSPACE(BUFF);                                   09975290
                   GO TO START;                                         09975300
              END;                                                      09975310
$OMIT 09976001, IF DCP;                                                 09975999
              STREAM(X:=(LINETABLE[LINE]!0):LINE,BUFF);                 09976000
$INCLUDE 09976501, IF DCP;                                              09976399
              STREAM(X:=IF Y THEN 1 ELSE STATABLE[LINE].DIALEDUP:       09976400
                   LINE,STA,Y,BUFF);                                    09976500
              BEGIN SI~LOC LINE;                                        09977000
$INCLUDE 09977501, IF DCP;                                              09977499
                   DS:=9 LIT" STATION ";                                09977500
$OMIT 09978001, IF DCP;                                                 09977999
                   DS:=6 LIT" LINE ";                                   09978000
                   DS:=3 DEC; BUFF:=DI; DI:=DI-3; DS:=2 FILL; DI:=BUFF; 09978300
$INCLUDE 09978601, IF DCP;                                              09978499
                   Y(DS:=LIT"/"; DS:=3 DEC;                             09978500
                     BUFF:=DI; DI:=DI-3; DS:=2 FILL; DI:=BUFF);         09978600
                   X(DS:=7 LIT" CLEAR~"; JUMP OUT TO EXIT);             09979000
                   DS:=13 LIT" NONEXISTANT~";                           09980000
      EXIT:   END;                                                      09981000
              IF P THEN                                                 09982000
              BEGIN                                                     09982100
$OMIT 09982901, IF DCP;                                                 09982199
                   BLASTREAD(LINE,X+1);                                 09982200
                   IF LINEDISC[LINE]=MULTI THEN ENTEREADYQ(LINE);       09982300
                   IF STATABLE[LINE].OUTPUTANKING THEN                  09982400
                   IF TANKLINE[LINE]=0 AND TAILOUT!LINE THEN            09982500
                   BEGIN                                                09982600
                        TANKLINE[TAILOUT]:=LINE;                        09982700
                        TAILOUT:=LINE;                                  09982800
                        STARTWORKING;                                   09982900
$INCLUDE 09983651, IF DCP;                                              09982999
                   Z:=(IF Y THEN 0&LINE[24:40:8]&STA[32:40:8] ELSE      09983000
                        0&STATABLE[LINE][24:24:16])&1[23:47:1];         09983050
                   M[STA:=GETAREA(0)]:=0&1[5:47:1];                     09983100
                   M[STA+1]:=Z&SETSTATIONREADY[1:41:7];                 09983150
                   DCPQ(STA);                                           09983200
                   IF X=2 AND NOT Y THEN                                09983250
                   BEGIN STREAM(X:=X:=SPACE(5));                        09983300
                        DS:=29 LIT"-*!PLEASE CALL BACK LATER!-*$";      09983350
                        TWXOUT(X,29,-0,LINE);                           09983400
                        FORGETSPACE(X);                                 09983450
                   END ELSE                                             09983500
                   BEGIN M[STA:=GETAREA(0)]:=0&1[5:47:1];               09983550
                        M[STA+1]:=Z&ENABLEINPUT[1:41:7];                09983600
                        DCPQ(STA);                                      09983650
              END  END;                                                 09983700
              SPOUT(BUFF);                                              09983900
              GO TO START;                                              09984000
         END;                                                           09985000
    END LINE CLEARING;                                                  09986000
$ INCLUDE 12157001, IF DEBUGGING;                                       09999999
COMMENT  GNC RETURNS  CHARACTER AT B AND BUMPS B BY ONE ;%              10000000
REAL STREAM PROCEDURE GNC(B);%                                          10001000
         BEGIN LOCAL T;  SI ~ B; DI~ LOC T; DS~ WDS;%                   10002000
         SI ~ T; SI~SI+1; DI~LOC GNC ; DI~DI+7; DS~CHR ; SI~SI-1;%      10003000
         DI~ B ; T~ SI ; SI~ LOC T ; DS ~ WDS;%                         10004000
         END       GNC ;%                                               10005000
COMMENT  TAN  TEST  C  FOR ALPHA  AND  RETURNS RESULT;%                 10006000
BOOLEAN  STREAM PROCEDURE  TAN(C) ; VALUE C ;%                          10007000
         BEGIN%                                                         10008000
         SI~LOC C;  SI~SI+7;  IF SC=ALPHA THEN TALLY~1;%                10009000
         TAN~ TALLY;%                                                   10010000
         END       TEST ALPHAMERIC ;%                                   10011000
 REAL PROCEDURE EXP;                                                    10012000
         BEGIN%                                                         10013000
         REAL   X,T,I,P;%                                               10014000
         LABEL  G,BOOBOO;%                                              10015000
         T ~ 0;    X ~ "+";%                                            10016000
         IF C= "+" OR C = "-"  THEN%                                    10017000
              BEGIN  X~C; T~ LP;  C ~ GNC(B); END;%                     10018000
         DO   BEGIN%                                                    10019000
              P ~ 0;%                                                   10020000
         IF C="+" OR C="-" THEN C~GNC(B);%                              10021000
              IF C= "*" THEN  BEGIN P~LP;C~GNC(B) END%                  10022000
         ELSE IF C = "/" THEN BEGIN P ~ M[LP].[18:15]; C ~ GNC(B) END%  10023000
         ELSE IF C = "=" THEN BEGIN P ~ M[LP].[33:15]; C ~ GNC(B) END%  10024000
         ELSE IF  C{ 7 THEN DO P~P|8 + C UNTIL (C~ GNC(B))>7%           10025000
         ELSE IF  C= "." THEN%                                          10026000
                   BEGIN C~GNC(B); DO P~P|10+C UNTIL (C~GNC(B))>9 END%  10027000
         ELSE IF TAN(C) THEN%                                           10028000
                   BEGIN   DO P~ P|64+C UNTIL NOT (TAN(C~GNC(B)));%     10029000
                        FOR I~ 0 STEP 2 UNTIL NSYMBS DO%                10030000
                        IF TBL[I].[6:42] = P THEN%                      10031000
                        BEGIN  P~TBL[I+1] ;  GO TO G  END;%             10032000
                        ERROR ~ "NO SYMB" ; GO TO BOOBOO ;%             10033000
                   END%                                                 10034000
         ELSE IF  C= "[" THEN%                                          10035000
                   BEGIN  C ~ GNC(B);%                                  10036000
                        P~ EXP ; IF ERROR ! 0 THEN GO BOOBOO ;%         10037000
                        P ~ POLISH([MEMORY[P]],LOD,0,INX) ;%            10038000
                        IF C! "]" THEN%                                 10039000
                        BEGIN ERROR~ "NO BRKT";%                        10040000
    BOOBOO:             DO UNTIL (C~GNC(B))="~" END ELSE C~GNC(B);%     10041000
                   END;%                                                10042000
    G:   T~ T + (IF X="+" THEN P ELSE -P);%                             10043000
         END UNTIL (( X ~C)!"+" AND C ! "-" ) ;%                        10044000
         EXP ~ T;%                                                      10045000
         END    EXP ;%                                                  10046000
         STREAM PROCEDURE FRMT1(Q,T,M,WB);  VALUE Q,T,M;%               10047000
              BEGIN%                                                    10048000
              SI~ LOC T;  SKIP SB; DI~WB; DI~DI+1;%                     10049000
              IF SB THEN%                                               10050000
                   BEGIN%                                               10051000
                   SI ~ SI+0;%                                          10052000
                   7(IF SC ="0" THEN SI~SI+1 ELSE DS~CHR) ;%            10053000
                   END%                                                 10054000
              ELSE%                                                     10055000
                   BEGIN%                                               10056000
                   SI~SI+4;  SKIP 3 SB;%                                10057000
                   5(DS~3RESET;3(IF SB THEN DS~SET ELSE DS~RESET;%      10058000
                        SKIP SB))  END;%                                10059000
                   DS ~ LIT "=";%                                       10060000
              SI~LOC Q; SI~SI+7;%                                       10061000
              IF SC!"O"  THEN  BEGIN%                                   10062000
                   IF SC ="D"  THEN BEGIN%                              10063000
                   SI~ LOC M; DS~ 8 DEC END  ELSE  BEGIN%               10064000
                   SI~ LOC M;  DS~ 8 CHR END;  DS~LIT"~" END%           10065000
              ELSE BEGIN%                                               10066000
                   SI ~ LOC M;%                                         10067000
                   IF SB THEN%                                          10068000
                        BEGIN%                                          10069000
                        DS ~ 3 RESET;3(IF SB THEN DS~SET ELSE DS~RESET; 10070000
                        SKIP SB);%                                      10071000
                        3(5(DS~3 RESET;3(IF SB THEN DS~SET ELSE%        10072000
                        DS~RESET ; SKIP SB));%                          10073000
                        DS ~ LIT " ") ;%                                10074000
                        END%                                            10075000
                   ELSE%                                                10076000
                        2(8(DS~3 RESET;3(IF SB THEN DS~SET ELSE DS~RESET10077000
                        ; SKIP SB)); DS~ LIT " ");%                     10078000
              DI~ DI-1; DS ~ LIT"~";%                                   10079000
                   END%                                                 10080000
              END ;%                                                    10081000
PROCEDURE DT;                                                           10082000
         BEGIN%                                                         10083000
         REAL  CL,LITC,I,T,N;%                                          10084000
         LABEL LA,LB,FOUND,BANG,EXIT;%                                  10085000
         DEFINE READSPO = DO UNTIL WAITIO(1 INX RBX INX @40000000,@377, 10086000
                   25) = 0 #;%                                          10087000
         DEFINE  WRITESPO = DO UNTIL WAITIO(WB INX 0,@377,25) = 0 #;%   10088000
         REAL RCW=+0;%                                                  10089000
         POLISH(0,RDS,5,-,0,XCH,CFX,STF);%                              10090000
         HALT;%                                                         12000000
         SLEEP([TOGLE],KEYBOARDMASK); KEYBOARDREADY~FALSE;              12001000
         STREAM(C~(RCW INX 0)&RCW[30:10:2]:WB);%                        12002000
              BEGIN%                                                    12003000
              DI~ WB;  DS~ LIT"""; DS~6 LIT"C:L = ";%                   12004000
              SI~ C;  SI~SI-2;  C~SI;%                                  12005000
              SI~ LOC C;  SI~SI+5;  SKIP 3 SB;%                         12006000
              5(DS~ 3 RESET;3(IF SB THEN DS~SET ELSE DS~RESET;SKIP SB)) 12007000
              ;  DS~LIT":" ; SI~LOC C;  SI~SI+5;%                       12008000
              DS~4RESET;2(IF SB THEN DS~SET ELSE DS~RESET; SKIP SB);%   12009000
              DS~LIT"~";%                                               12010000
              END;%                                                     12011000
         POLISH(.CL,~);%                                                12012000
         TBL[35]~M[RCW.[18:15]].[18:15];%                               12013000
         WRITESPO;%                                                     12014000
         LITC~0;%                                                       12015000
         FOR I~1 STEP 1 UNTIL NSTOP DO%                                 12016000
         IF STOPS[I].[30:18] = CL THEN LITC~ STOPS[I].[18:10];%         12017000
  LA:    READSPO     ;%                                                 12018000
              NOBACKTALK~FALSE;%                                        12019000
         ERROR~0;%                                                      12020000
         B ~ RBX INX 1;                                                 12021000
         STREAM(Q~B);%                                                  12022000
              BEGIN%                                                    12023000
              SI~Q;  DI~Q;  DI~DI+1;%                                   12024000
         L:   IF SC!"~" THEN%                                           12025000
                   BEGIN%                                               12026000
                   IF SC=@14 THEN SI~SI+1 ELSE%                         12027000
                   IF SC= " "  THEN SI~SI+1  ELSE DS~CHR;%              12028000
                   GO L;%                                               12029000
                   END;%                                                12030000
              DS~ CHR;%                                                 12031000
              END;%                                                     12032000
         C~GNC(B);%                                                     12033000
         IF C="~"  THEN GO TO LA;%                                      12034000
         IF C="}"  THEN BEGIN TYPETOG~GNC(B); C~GNC(B) END;%            12035000
         IF C="$"  THEN%                                                12036000
              BEGIN%                                                    12037000
              C~GNC(B);%                                                12038000
              T~EXP;  IF ERROR ! 0 THEN GO LB;%                         12039000
              STREAM( L~0:T,S~POLISH(.DT,4,|,2,+),V~0);%                12040000
                   BEGIN%                                               12041000
                   SI~T;%                                               12042000
              Q:   SI~SI+0;  L~SI;  SI~SI+1;  SKIP  4 SB;%              12043000
                   IF SB THEN GO Q;  SKIP SB;%                          12044000
                   IF SB THEN GO Q;%                                    12045000
                   SI~SI+0; SI~SI-2;%                                   12046000
                   DI~ LOC L;  DI~DI +3;%                               12047000
                   DS~ 2 CHR;  DI~  L;%                                 12048000
                   SI~  LOC S;  SI~SI+6;  DS~ 2 CHR;%                   12049000
                   END;%                                                12050000
              POLISH([STOPS[NSTOP~NSTOP+1]],~);%                        12051000
              STREAM( CL~STOPS[NSTOP],WB);%                             12052000
                   BEGIN%                                               12053000
                   DI~ WB;  DI~DI+1;  SI~LOC CL;%                       12054000
                   SI~ SI+5;  SKIP  3 SB;%                              12055000
                   5( DS~ 3 RESET; 3(IF SB THEN DS~SET ELSE DS~ RESET%  12056000
                        ;SKIP SB));%                                    12057000
                   DS~ LIT":";  SI~ LOC CL; SI~SI+5;%                   12058000
                   DS~ 4 RESET;%                                        12059000
                   2( IF SB THEN DS~SET ELSE DS~RESET; SKIP SB;) ;%     12060000
                   DS~LIT"~";%                                          12061000
                   END;%                                                12062000
              WRITESPO;%                                                12063000
              GO TO LA;%                                                12064000
              END;%                                                     12065000
         IF C="@"  THEN%                                                12066000
         BEGIN%                                                         12067000
              C~GNC(B);%                                                12068000
              T~EXP;  IF ERROR!0 THEN GO TO LB;%                        12069000
IF C=":"THEN T~T&(C~GNC(B))[30:46:2];%                                  12070000
              FOR I~1 STEP 1 UNTIL NSTOP DO%                            12071000
              IF STOPS[I].[30:18] = T THEN GO FOUND;%                   12072000
              ERROR~ "NO STOP";  GO TO LB;%                             12073000
  FOUND:%                                                               12074000
              STREAM ( L~STOPS[I],V~0);%                                12075000
                   BEGIN   DI~L;SI ~ LOC L; SI~SI+3; DS ~ 2 CHR END;%   12076000
              GO TO LA;%                                                12077000
              END;%                                                     12078000
         IF  C = "%" THEN%                                              12079000
              BEGIN%                                                    12080000
              C ~ GNC(B);%                                              12081000
              FOR I ~ 0 STEP 2 UNTIL NSYMBS DO%                         12082000
              IF TBL[I].[1:5] = C THEN BEGIN%                           12083000
              FRMT1(TYPETOG,-TBL[I],MEMORY[TBL[I+1]],WB);%              12084000
                   WRITESPO;%                                           12085000
              IF NOBACKTALK THEN GO TO LA;%                             12086000
                   END;%                                                12087000
              GO TO LA;%                                                12088000
              END;%                                                     12089000
         IF C= ";" THEN GO EXIT;%                                       12090000
         T~ EXP ;  IF ERROR ! 0 THEN GO LB;%                            12091000
         IF  C = ";" THEN%                                              12092000
              BEGIN%                                                    12093000
              C~GNC(B);%                                                12094000
              N~EXP-1;  IF ERROR !0  THEN  GO LB  ELSE  GO BANG;%       12095000
              END;%                                                     12096000
         N ~ 0;%                                                        12097000
         IF C= ":" THEN%                                                12098000
              BEGIN%                                                    12099000
              CL~0;  I~0;%                                              12100000
              IF (C~GNC(B)) {9 THEN CL~C;%                              12101000
              DO I ~ I | 64 + C UNTIL NOT(TAN(C~GNC(B)));%              12102000
         NSYMBS~NSYMBS+2;%                                              12103000
              TBL[NSYMBS] ~I&CL[1:43:5];  TBL[NSYMBS+1] ~ T;%           12104000
              GO BANG;%                                                 12105000
              END;%                                                     12106000
         IF C= "=" THEN%                                                12107000
              BEGIN ;%                                                  12108000
              IF (C~GNC(B)){9 THEN BEGIN;%                              12109000
              STREAM( I~0:%                                             12110000
                        WB~ B,L~0,K~0);%                                12111000
                   BEGIN%                                               12112000
                   SI ~ WB;%                                            12113000
                   16(IF SC}"0" THEN BEGIN TALLY~TALLY+1;SI~SI+1 END%   12114000
                        ELSE JUMP OUT TO Z );Z:%                        12115000
                   L ~ TALLY; TALLY ~ 16;%                              12116000
                   L( TALLY~TALLY + 63); K~TALLY;DI~%                   12117000
                                              LOC  I ; K(SKIP 3 DB);%   12118000
                   SI ~ WB;%                                            12119000
                   L(SKIP 3 SB;3(IF SB THEN DS~SET ELSE DS~RESET;%      12120000
                        SKIP SB ));%                                    12121000
                   END;%                                                12122000
              POLISH( [MEMORY[T]],~);%                                  12123000
              END ELSE%                                                 12124000
              IF  C="."  THEN%                                          12125000
                   BEGIN  I~0;  WHILE (C~GNC(B)){9  DO  I~I|10+C;%      12126000
                        MEMORY[T]~I;%                                   12127000
         END  ELSE BEGIN I~0; DO I~I|64+C UNTIL NOT (TAN(C~GNC(B)));%   12128000
                        MEMORY[T]~I  END;%                              12129000
              GO BANG ;%                                                12130000
              END;%                                                     12131000
         IF C !"~" THEN%                                                12132000
              BEGIN ERROR ~"ILL EXP"; GO LB END;%                       12133000
  BANG:%                                                                12134000
         FOR I ~ 0 STEP 1 UNTIL N DO%                                   12135000
              BEGIN%                                                    12136000
              FRMT1(TYPETOG,LP~T+I,POLISH([MEMORY[LP]],LOD),WB);%       12137000
              WRITESPO;%                                                12138000
              IF NOBACKTALK  THEN  GO TO LA;%                           12139000
              END;%                                                     12140000
         GO TO LA;%                                                     12141000
  LB:    STREAM (ERROR,WB,RBX);%                                        12142000
         BEGIN%                                                         12143000
              SI ~ RBX; DI ~ WB; DI ~ DI+1;                             12144000
                   SI~SI+9;%                                            12145000
          L:  IF SC ! "~" THEN BEGIN DS~ CHR; GO TO L END;%             12146000
              DS ~6LIT"ERROR "; SI~LOC ERROR; SI~SI+1;%                 12147000
              DS ~ 7 CHR ; DS ~ LIT "~";%                               12148000
         END;%                                                          12149000
         WRITESPO ;%                                                    12150000
         GO TO LA;%                                                     12151000
   EXIT:%                                                               12152000
         M[WB] ~ NOT 0;      WRITESPO;%                                 12153000
         KEYBOARDREADY~TRUE;%                                           12154000
         NOPROCESSTOG~NOPROCESSTOG-1;%                                  12155000
         POLISH(LITC,RTN);%                                             12156000
         END;%                                                          12157000
 PROCEDURE         COM19; %%% PRINT A BACKUP TAPE OR DISK %%%        %P 13000000
              BEGIN                                                  %P 13001000
 ARRAY             FPB[*],LOGINFO[*],JR[*],HEADER[*];                   13002000
 NAME              INREC;DEFINE CONS="PBD    "#;DEFINE PUNS="PUD    "#; 13003000
 INTEGER           CURROW,SEGNR,RECOUNT=SEGNR,V;                     %P 13004000
 REAL              U=-4,CURRPBNAME=U,B,T,IOD=T,UNIT,ENDFLAG,LOC;        13005000
 LABEL             EF,RD,MAINLOOP,QUIT,SLEAP,WHY;                       13006000
SUBROUTINE REMOVEIT;                                                    13006800
    BEGIN                                                               13006810
        P(DIRECTORYSEARCH(-(IF V!22 THEN CONS ELSE PUNS),               13006820
          CURRPBNAME,13),DEL);                                          13006830
        P(DIRECTORYSEARCH(-(IF V!22 THEN CONS ELSE PUNS),               13006840
          CURRPBNAME,7),DEL);                                           13006850
    END;                                                                13006860
 BOOLEAN           SIGNEDON,FORMTOG;                                 %P 13007000
 SUBROUTINE        FM;   %% BUILD AND SPOUT FORMS MESSAGE      %%       13007050
              BEGIN                                                     13007100
                   SIGNEDON := SPACE(10);                               13007150
                   STREAM(U~V-3,INREC,MX~P1MIX,SIGNEDON);    %RHR       13007200
                   BEGIN DS~10 LIT"#FM RQD LP";              %RHR       13007250
                        SI~LOC U; SI~SI+7; IF SC!"C" THEN DS~CHR ELSE   13007300
                        BEGIN DI~DI-2; DS~3LIT"CPA"; END;               13007325
                        DS~5 LIT" FOR "; SI~INREC;           %RHR       13007350
                        SI~SI+1; DS~7 CHR; DS~LIT"/";        %RHR       13007400
                        SI~SI+1; DS~7 CHR; DS~4 LIT" OF ";   %RHR       13007425
                        SI~SI+1; DS~7 CHR; DS~LIT"/";        %RHR       13007450
                        SI~SI+1; DS~7 CHR; DS~LIT"=";        %RHR       13007475
                        SI~LOC MX; DS~2 DEC; DS~ LIT"~";     %RHR       13007500
              END; SPOUT(SIGNEDON); REPLY[P1MIX]~-@5041220;   %RHR      13007550
              END  FM SUBROUTIN;                                        13007600
 SUBROUTINE        BADFM;       %BUILD AND SPOUT BAD FM MESSAGE   %     13007630
              BEGIN                                          %RHR       13007660
                   SIGNEDON~GETSPACE(10,0,0)+2;              %RHR       13007690
                   STREAM(A~TINU[U],MX~P1MIX,SIGNEDON);      %RHR       13007720
                   BEGIN DS~19 LIT"INVALID INPUT UNIT ";     %RHR       13007750
                        SI~LOC MX; DS~2 DEC;DS~2 LIT"FM";               13007780
                        SI~LOC A; SI~SI+5; DS~3 CHR;         %RHR       13007840
                        DS~LIT "~"; DI~DI-8; DS~FILL;        %RHR       13007870
                   END;  SPOUT(SIGNEDON);                    %RHR       13007900
              END BADFM SUBROUTIN;                           %RHR       13007930
 SUBROUTINE        SIGNIN;  %% START LOG FOR CHARGEABLE PRINT FILE % %P 13008000
              BEGIN                                                  %P 13009000
                   LOGINFO~[M[GETSPACE(31,0,1)+2]]&31[8:38:10];      %P 13010000
                   IF INREC[13] OR FORMTOG THEN FM;                     13010100
                   LOGINFO[12]~-(PROCTIME[P1MIX]+CLOCK+P(RTR));      %P 13012000
                   LOGINFO[13]~ IOTIME[P1MIX];                       %P 13013000
                                                                        13014000
                                                                        13015000
                                                                        13016000
                                                                        13017000
                                                                        13018000
                   LOGINFO[24]~-CLOCK-P(RTR);                           13019000
                   STREAM(S~[INREC[2]],D~[LOGINFO[2]]);                 13020000
                   BEGIN SI~S;  DS~8 WDS END;  IF SIGNEDON!0 THEN       13021000
    SLEAP:    BEGIN COMPLEXSLEEP((REPLY[P1MIX]}0 OR TERMSET(P1MIX)      13021100
                                                  OR PRT[P1MIX,@25]=5));13021200
                   IF NOT WHYSLEEP(@5041220) THEN             %RHR      13021300
                   BEGIN FM; GO TO SLEAP END;                           13021400
                   IF REPLY[P1MIX].[CF]=5 THEN                %RHR      13021410
                   IF (U~REPLY[P1MIX].[FF])!20 AND U!21 THEN            13021420
                   BEGIN BADFM; LABELTABLE[U]~@114;          %RHR       13021423
                        READY~READY AND (U~NOT TWO(U));      %RHR       13021426
                        RRRMECH~RRRMECH AND U;               %RHR       13021429
                        SAVEWORD~SAVEWORD AND U; FM; GO SLEAP           13021432
                   END ELSE IF U!V THEN                      %RHR       13021435
                   BEGIN LABELTABLE[U]~LABELTABLE[V];LABELTABLE[V]~0;   13021440
                        RDCTABLE[U]~RDCTABLE[V]; RDCTABLE[V]~0;         13021450
                        MULTITABLE[U]~MULTITABLE[V];MULTITABLE[V]~0;    13021460
                        FPB[8].[36:6]~(V~U)+1;                          13021470
                   END;                                       %RHR      13021480
              END; FORMTOG~INREC[13];                                   13021500
                   SIGNEDON~TRUE;                                    %P 13022000
              END SIGNIN;                                            %P 13025000
 SUBROUTINE        SIGNOUT; %% FINISH LOG AND ORDER IT ENTERED %     %P 13026000
              BEGIN                                                  %P 13027000
                   LOGINFO[12]~*P(DUP)+PROCTIME[P1MIX]+CLOCK+P(RTR); %P 13028000
                   LOGINFO[13]~IOTIME[P1MIX]-(IOTIME[P1MIX]~LOGINFO[13])13029000
         ;                                                              13030000
                   PROCTIME[P1MIX]~*P(DUP)-LOGINFO[12];              %P 13031000
                   P(XCH,[LOGINFO[18]],STD);                            13033000
                   TINU[UNIT].[18:12]~0;  TINU[V].[18:12]~0;            13034000
                                                                        13035000
                  FORMTIME([LOGINFO[21]],LOGINFO[12]);                  13036000
                   FORMTIME([LOGINFO[23]],LOGINFO[13]);                 13037000
                   FORMTIME([LOGINFO[19]],XCLOCK+P(RTR));               13038000
                   STREAM(F:=0,B:=[LOGINFO[18]],A:=*P(DUP)!0,           13039000
                         N:=[LOGINFO[0]]);                              13039005
                   BEGIN F:=DI;SI:=F;SI:=SI+17;DS:=15 CHR;SI:=SI-20;    13039010
                         DI:=DI+9;DS:=3 CHR;DI:=DI-15;SI:=F;DS:=12 CHR; 13039020
                         DI:=F;DS:=12LIT" PRNPBT FOR ";DI:=DI+7;        13039100
                        DS:=LIT "/";  DI:=DI+7;  DS:=6 LIT ", PST=";    13039200
                                                                        13039300
                        SI ~ B;  SI ~ SI+24;  DS ~ 8 CHR;  SI ~ SI+8;   13039400
                        DS ~ 6 LIT ", IOT=";  DS ~ 8 CHR;  N ~ DI;      13039500
                        DS ~ 11 LIT "; EOJ   AT ";  SI ~ B;  SI ~ SI+8; 13039600
                        DS ~ 5 CHR;  DS ~ LIT "~";                      13039700
                        A(DI ~ N;  DI ~ DI+2;  DS ~ 5 LIT "DS-ED");     13039800
                   END STREAM;                                          13039900
                   SPOUTIT(LOGINFO,EOJMESS OR PBEOJK);                  13040000
                                                                        13041000
                   LOGINFO~SIGNEDON~RECOUNT~0;                       %P 13043000
              END SIGNOUT;                                           %P 13044000
 SUBROUTINE PARERR;%PARITY ERROR MSSGS                                  13044010
     BEGIN IF V=22 THEN GO WHY; LOC:=SPACE(15);                         13044020
           STREAM(A:=UNIT,LOC);                                         13044030
           BEGIN 22(DS:=2 LIT ">>");SI:=LOC A;SI:=SI+7;                 13044040
                 IF SC="B" THEN DS:=6 LIT " DISK " ELSE                 13044050
                 DS:=6 LIT " TAPE ";                                    13044060
                 DS:=26 LIT "PARITY ON PRINTER BACK UP ";               13044070
                 22(DS:=2 LIT ">>");                                    13044080
           END STREAM;                                                  13044090
           P(WAITIO(LOC&16[CTF],0,V),DEL);                              13044100
           FORGETSPACE(LOC);                                            13044110
 WHY:      FILEMESS("#PARITY","ERROR  ","       ","       ",0,0,0);     13044120
           REPLY[P1MIX]:=-@41220;                                       13044130
           COMPLEXSLEEP(REPLY[P1MIX] GEQ 0 OR TERMSET(P1MIX)            13044140
                        OR PRT[P1MIX,@25]=5);                           13044150
           IF NOT WHYSLEEP(@41220) THEN GO TO WHY;                      13044160
     END PARERR;                                                        13044170
 SUBROUTINE        GET; %%% READ & DEBLOCK %%                        %P 13045000
              BEGIN ENDFLAG~0;                                       %P 13046000
                   IF INREC[17   ].[20:1] THEN                       %P 13047000
              BEGIN                                                  %P 13048000
                   ENDFLAG~2; INREC.[CF]~B; INREC[17].[20:1]~0;      %P 13049000
                   IF UNIT=18 THEN REMOVEIT;                            13049500
              END  ELSE                                              %P 13050000
                   IF (INREC~[INREC[NOT 17]]).[CF]<B.[CF] THEN       %P 13051000
                   IF UNIT=18 THEN                                   %P 13052000
              BEGIN COMMENT DISK;                                    %P 13053000
                   IF (SEGNR        )}HEADER[8] THEN %END OF ROW%%   %P 13054000
              BEGIN                                                  %P 13055000
                   SEGNR~0;                                          %P 13056000
                   IF (CURROW~CURROW+1)<(HEADER[9]+10) THEN GO RD;   %P 13057000
                   FORGETSPACE(HEADER INX 0);                        %P 13058000
                   CURROW~10;                                        %P 13059000
                   REMOVEIT;                                            13060000
                   STREAM(A~1, C~[CURRPBNAME]);                         13061000
                   BEGIN SI~LOC A;  DI~C;  DS~8 ADD;  END;              13061100
                   IF (HEADER:=DIRECTORYSEARCH(IF V!22 THEN CONS        13062000
                       ELSE PUNS,CURRPBNAME,3))=0                       13062100
                             THEN GO TO EF;                             13063000
                   HEADER~[M[( HEADER)]]&30[8:38:10];                %P 13064000
                   GO TO RD                                          %P 13065000
              END;                                                   %P 13066000
                   IF SEGNR>HEADER[7]|3 THEN                         %P 13067000
              BEGIN                                                  %P 13068000
                   REMOVEIT;                                            13069000
 EF:               ENDFLAG~TRUE;                                     %P 13070000
              END  ELSE                                              %P 13071000
              BEGIN                                                  %P 13072000
 RD:         IOD~0;DISKWAIT(-B-1,90,HEADER[CURROW]+SEGNR);              13073000
                   INREC.[CF]~B INX 73;    SEGNR~SEGNR+3;            %P 13074000
                   IF IOD.[28:1] THEN PARERR;                           13075100
              END                                                    %P 13076000
              END  DISK PORTION ELSE                                 %P 13077000
              BEGIN                                                  %P 13078000
                   IF (ENDFLAG:=WAITIO(B,@2000040,UNIT)).[43:1] THEN    13078100
                   PARERR;                                              13078150
                   IF ENDFLAG.[42:1] THEN ENDFLAG:=TRUE ELSE            13078160
              IF (T~M[B INX NOT 0])= 90 THEN                            13078200
              BEGIN INREC~[M[B INX 72]];                                13078300
                   ENDFLAG~INREC[17].[CF] ! RECOUNT;                    13078400
              END ELSE IF NOT(ENDFLAG~((T AND @7775)!16)) THEN          13078500
              BEGIN INREC~[M[B INX 1]];                                 13078600
                   INREC[17]~M[B]&0[20:20:7];                           13078700
              END;                                                      13078800
              END TAPE ELSE ENDFLAG~(INREC[17].[CF] !RECOUNT)           13082000
                 AND(UNIT!18);                                          13082100
                   RECOUNT~(UNIT!18) INX RECOUNT;                       13082500
              END  GET SUBROUTINE;                                   %P 13083000
 REAL SUBROUTINE   DSED;  %% CHECKS TERMIX & THINGS LIKE THAT %%     %P 13084000
%                            ALSO TAKES CARE OF QT ACTION               13084005
         BEGIN                                                          13085000
                   WHILE PRTROW[P1MIX].[PSF]>1 DO                       13086000
                        STOPM;                                          13086100
                   IF TERMSET(P1MIX) THEN                               13087000
              BEGIN                                                  %P 13088000
                   IF UNIT = 18 THEN % IF DISK                          13089000
                   BEGIN                                                13090000
                        FORGETSPACE(HEADER.[CF]);                       13091000
                        REMOVEIT;                                       13092000
                   END;                                                 13093000
                   P(2);                      % 2 = DS-ED               13093050
                   SIGNOUT;                                             13093100
              END ELSE % CHECK TO SEE IF QT GIVEN                       13094000
              BEGIN                                                     13094100
                   IF PRT[P1MIX,@25] = 5 THEN % CELL SET TO 5 IN KEYIN  13095000
                   BEGIN % SKIP THIS FILE     % IN RESPONSE TO QT MESS  13096000
                        PRT[P1MIX,@25] ~ 0;                             13097000
                        PRT[P1MIX,@23]:=1;                              13097100
                        IF UNIT = 18 THEN     % IF BACKUP DISK NO NEED  13098000
                        BEGIN                 % TO SPACE TO NEXT FILE   13098100
                             FORGETSPACE(DIRECTORYSEARCH(IF V!22        13098125
                             THEN CONS ELSE PUNS,CURRPBNAME,13));       13098130
                             P(DEL);          % DELETE RETURN LITERAL   13098150
                             GO TO QUIT;      % AND BRANCH OUT          13098200
                        END ELSE                                        13098250
                        BEGIN IF V!22 THEN                              13098300
                         P(WAITIO((@4000100000),0,V),DEL);%NXTPG        13098310
                             DO GET UNTIL (ENDFLAG!0) OR TERMSET(       13098320
                               P1MIX); % SKIP TO NEXT LOGICAL FILE      13098330
                        END;                                            13098340
                        IF SIGNEDON THEN                                13098350
                        BEGIN                                           13098400
                             P(0);                                      13098450
                             SIGNOUT;                                   13098500
              END; END; END;                                            13098550
              DSED ~ TERMSET(P1MIX) OR ENDFLAG;                         13099000
         END DSED SUBROUTINE;                                           13100000
 %%% START OF CODE       %%%                                         %P 13101000
              IF U=0 THEN GO TO INITIATE;                               13101100
                   FPB~PRT[P1MIX,3];                                 %P 13102000
                   INREC~[M[B~GETSPACE(91,0,1)+2&@132[8:38:10]]];    %P 13103000
                   JR~JARROW[P1MIX];                                 %P 13104000
                   FPB[8].[36:6]~(V~U.[FF])+1;                       %P 13105000
                   IF LABELTABLE[V].[1:5]=@21 THEN RDCTABLE[V    ].[8:6]13106000
                        ~P1MIX;                                         13106100
                   IF(U~U.[CF])<@37777 THEN %% ON DISK               %P 13107000
              BEGIN                                                  %P 13108000
                   UNIT~18;                                          %P 13109000
                   STREAM(U,D~[U]);                                  %P 13110000
                   BEGIN          SI~LOC U; DS~5 DEC; DS~3LIT"001" END; 13111000
                        IF (HEADER:=DIRECTORYSEARCH(IF V!22 THEN        13112000
                            CONS ELSE PUNS,U,3))=0 THEN GO QUIT;        13112050
                        HEADER:=[M[HEADER]]&30[8:38:10];                13112100
                   CURROW:=10;                                          13113000
              END  ELSE                                              %P 13115000
              BEGIN                                                  %P 13116000
                   RDCTABLE[UNIT~(U AND 63)].[8:6]~P1MIX;            %P 13117000
                   B.[18:9]~@54;   RRRMECH~RRRMECH OR TWO(UNIT);     %P 13117500
                   T~WAITIO(@4200000000,0,UNIT.[42:6]);              %P 13117600
                   T~WAITIO(B,0,UNIT) OR WAITIO(B,@40,UNIT);         %P 13118000
              END  ; INREC[17]~0;                                       13120000
                   FPB[3].[36:6]~UNIT+1;                             %P 13121000
                   FPB[4]~FPB[9]~-CLOCK-P(RTR);                      %P 13122000
                   IF UNIT!18 THEN                                      13122100
                   BEGIN GET; IF INREC[17].[CF]!RECOUNT THEN            13122200
                        BEGIN RECOUNT~INREC[17] INX 1; ENDFLAG~0        13122300
                   END; END ELSE                                        13122400
 MAINLOOP:         IF DSED THEN GO QUIT ELSE GET;                    %P 13123000
                   IF ENDFLAG!0 THEN                                 %P 13124000
                   BEGIN                                                13125000
                        IF SIGNEDON THEN                                13125200
                        BEGIN P(0);                                     13125400
                             SIGNOUT;                                   13125600
                        END;                                            13125800
                        IF UNIT = 18 THEN GO TO QUIT;                   13126000
                        IF ENDFLAG THEN GO TO QUIT;                     13126200
                        GO TO MAINLOOP;                                 13126400
                   END;                                                 13127000
                   IF (T ~ INREC[17]).[1:11] = 0 THEN SIGNIN            13128000
                   ELSE % PRINT A LINE                                  13128100
                   P(WAITIO(INREC[17]&(INREC)[CTC]&8[21:42:6],0,V),DEL);13129000
                   GO MAINLOOP;                                      %P 13130000
 QUIT:             IF V!22 THEN P(WAITIO(@4000100000,0,V),DEL);         13132000
                   IF SIGNEDON THEN BEGIN P(2); SIGNOUT END;            13132100
                   SLEEP([TOGLE],STATUSMASK);                        %P 13133000
                   IF UNIT=18 THEN PBCOUNT~PBCOUNT+1 ELSE               13134000
      BEGIN        T~WAITIO(@4200000000,0,UNIT);                     %P 13134500
                   IF PRNTABLE[UNIT].[1:1] AND                          13135000
                   NOT(SVPBT OR PRT[P1MIX,@23]) THEN                    13135200
                   FORK(P(.PURGEIT),UNIT,-2,128,0) ELSE                 13135500
              BEGIN                                                  %P 13136000
                   LABELTABLE[UNIT]~@114;                            %P 13138000
                   MULTITABLE[UNIT]~RDCTABLE[UNIT]~0;                %P 13139000
                   SLEEP([TOGLE],STATUSMASK);                           13139100
                   READY~READY AND NOT T~TWO(UNIT);                  %P 13140000
                   RRRMECH~NOT T AND RRRMECH OR T AND SAVEWORD;      %P 13141000
      END;    END; IF RDCTABLE[V].[8:6]=P1MIX THEN                   %P 13142000
              BEGIN                                                  %P 13143000
                   RDCTABLE[V]~0;                                    %P 13144000
                   IF LABELTABLE[V].[5:1] THEN                          13145000
                        LABELTABLE[V]~64|FORMTOG+@114;                  13145100
              END; FPB[4]~FPB[9]~*P(DUP)+CLOCK+P(RTR);               %P 13146000
                   IF UNIT ! 18 THEN FPB[3].[23:1]:=1;                  13146010
                   IF FORMTOG THEN SAVEWORD~SAVEWORD OR T~TWO(V) ELSE   13146900
                   READY~READY AND NOT T~TWO(V);                     %P 13147000
                   RRRMECH~T AND SAVEWORD OR NOT T AND RRRMECH;      %P 13148000
                   GO INITIATE;                                         13148100
              END  OF PRINTING BACKUPS;                              %P 13149000
PROCEDURE SPOSET(TYPE,BUFH);                                            13200000
VALUE TYPE,BUFH;   REAL TYPE,BUFH;                                      13201000
    BEGIN                                                               13202000
    REAL LINE,LAST,BUFF,UZER;                                           13203000
    LABEL EXIT,OKED,CARRYON;                                            13204000
    ARRAY INF[*];                                                       13205000
    BOOLEAN OK;                                                         13206000
    BUFF~ BUFH.[15:15]-1;                                               13207000
    INF~ [M[SPACE(SYSDISKRL)]]&SYSDISKRL[8:38:10];                      13207100
    IF NOT REMOTE THEN GO EXIT;                                         13208000
    IF TYPE.[1:1] THEN       %THIS ALLOWS QUITTER TO RESET A SPO        13208100
    BEGIN LINE:=BUFH;                                                   13208200
         BUFF:=SPACE(10);                                               13208300
         GO TO CARRYON;                                                 13208400
    END;                                                                13208500
    STREAM(L~-1:B~BUFH,A~"SPO");                                        13209000
         BEGIN                                                          13210000
         DI~ LOC A;  DI~ DI+5;                                          13211000
         SI~ B;                                                         13212000
    DD:  IF SC=" " THEN BEGIN SI~ SI+1; GO DD END;  B~ SI;              13213000
         IF SC<"0" THEN                                                 13214000
              BEGIN                                                     13215000
              IF 3 SC=DC THEN                                           13216000
                   L~ TALLY;                                            13217000
              GO EGRESS;                                                13218000
              END;                                                      13219000
         IF SC>"9" THEN GO EGRESS;                                      13220000
         SI~ SI+1;  DI~ LOC L;                                          13221000
         IF SC{"9" THEN IF SC}"0" THEN                                  13222000
              BEGIN                                                     13223000
              SI~ B;  DS~ 2 OCT;                                        13224000
              END                                                       13225000
         ELSE                                                           13226000
              BEGIN                                                     13227000
              SI~ B;  DS~ OCT;                                          13228000
              END;                                                      13229000
EGRESS:  END STREAM;                                                    13230000
    IF (LINE~ P)<0 THEN GO EXIT;                                        13231000
CARRYON:                                                                13231500
    LAST~ ABS(SPOWORD);                                                 13232000
    IF LINE=0 THEN      %SWITCH THE SPO                                 13234000
         BEGIN                                                          13235000
         IF LAST=0 THEN GO EXIT;                                        13236000
         SPOWORD.[1:1]~ NOT TYPE;                                       13237000
         SYSDISKIO(3,-0,INF);                                           13238000
         INF[3]~ SPOWORD;                                               13239000
         SYSDISKIO(0,-0,INF);                                           13240000
         GO OKED;                                                       13241000
         END;                                                           13242000
    IF LINE GTR STATIONMAX THEN GO EXIT;                                13243000
    SYSDISKIO(1,-LINE,INF);                                             13244000
    UZER~ INF[1];                                                       13244300
    SYSDISKIO(3,-0,INF);                                                13244350
    IF TYPE THEN                                                        13245000
         IF NOT STATABLE[LINE].DIALEDUP THEN                            13246000
              OK~ FALSE                                                 13247000
         ELSE                                                           13248000
              BEGIN                                                     13249000
              IF OK~ (UZER=0) THEN                                      13250000
                   BEGIN                                                13250100
                   SPOWORD.[40:8]~ LINE;                                13251000
                   INF[3]~ SPOWORD;                                     13252000
                   END                                                  13252100
              END                                                       13253000
    ELSE                                                                13254000
         IF LAST=LINE THEN                                              13255000
              OK~ NOT(SPOWORD~ INF[3]~ 0)                               13256000
         ELSE                                                           13257000
              OK~ FALSE;                                                13258000
    SYSDISKIO(0,-0,INF);                                                13259000
    IF OK AND TYPE AND (LAST!0) THEN                                    13260000
         BEGIN;                                                         13261000
         STREAM(L~ LINE,T~ LAST,B~ BUFF);                               13265000
              BEGIN                                                     13266000
              DS:=8 LIT "STATION "; SI:= LOC L;                         13267000
              DS~ 2 DEC;  B~ DI;  DI~ DI-2;  DS~ FILL;  DI~ B;          13268000
              DS~ 11 LIT " REPLACING "; DS~ 2 DEC;  B~ DI;              13269000
              DI~ DI-2;  DS~ FILL;  DI~ B;                              13270000
              DS:=17 LIT " AS ALTERNATE SPO";                           13271000
              END;                                                      13272000
         TWXOUT(BUFF,37,1,LAST);                                        13274000
         END                                                            13275000
     ELSE IF OK THEN                                                    13276000
OKED:    STREAM(L~ LINE,S~ TYPE.[47:1],B~ BUFF);                        13277000
              BEGIN                                                     13278000
              L(SI:= LOC L; DS:= 8 LIT "STATION "; DS:= 2 DEC;          13279000
                   B~ DI;  DI~ DI-2;  DS~ FILL; DI~ B;  JUMP OUT TO D); 13280000
              DS~ 3 LIT "SPO";                                          13281000
         D:   S(DS~ 4 LIT " SET";  JUMP OUT TO D1);                     13282000
              DS~ 6 LIT " RESET";                                       13283000
         D1:  DS~ 8 LIT " AS SPO~";                                     13284000
              END;                                                      13285000
EXIT:    SPOUT(BUFF);                                                   13286000
    IF OK AND (LINE!0) THEN                                             13286100
         BEGIN                                                          13286150
         IF TYPE THEN                                                   13286200
              BEGIN                                                     13286250
              SYSDISKIO(3,-LINE,INF);                                   13286300
              INF[3]~ (NOT 0).[12:36];                                  13286350
              INF[1]~ MCP;                                              13286400
              SYSDISKIO(0,-LINE,INF);                                   13286450
$OMIT 13286491, IF TWXONLY OR DCP;                                      13286454
              IF  STATABLE[LINE].STATIONTYPE THEN %SCREEN DEVICE        13286455
              BEGIN TNAOG[SEQARRAY[LINE].[26:6]].[14:34]:=0;            13286460
                   IF STATABLE[LINE].OUTPUTANKING THEN                  13286465
                   IF TANKLINE[LINE] = 0 AND TAILOUT !  LINE  THEN      13286470
                   BEGIN TANKLINE[TAILOUT]:=LINE;                       13286475
                        TAILOUT:=LINE;                                  13286480
                        STARTWORKING;                                   13286485
              END; END;                                                 13286490
              LINE~ LAST;                                               13286500
              END;                                                      13286550
         IF LINE!0 THEN                                                 13286600
              BEGIN                                                     13286650
              SYSDISKIO(3,-LINE,INF);                                   13286700
              INF[3]~ INF[1]~ 0;                                        13286750
              SYSDISKIO(0,-LINE,INF);                                   13286800
$OMIT 13286821, IF TWXONLY OR DCP;                                      13286809
              IF STATABLE[LINE].STATIONTYPE THEN %SCREEN DEVICE         13286810
              TNAOG[SEQARRAY[LINE].[26:6]]:=(*P(DUP))&INF[0][14:20:14]; 13286820
              END;                                                      13286850
         END;                                                           13286900
    FORGETSPACE(INF);                                                   13287000
    END SETSPO;                                                         13288000
REAL PROCEDURE ANALYSIS;%                                               14000000
         BEGIN%                                                         14001000
         REAL ICW,IRCW,INCW,CL,T1,C,T2=SYLLABLE ;%                      14002000
         LABEL GETOUT;%                                                 14003000
COMMENT  ANALYSIS  EXAMINS THE SYLLABLE WHICH CAUSED THE INTURRUPT AND% 14004000
              FROM  THE RELATIVE ADDRESS OF THE SYLLABLE (INCLUDING%    14005000
              VARIENT OPERATOR CONSIDERATIONS) COMPUTES THE LOCATION,C, 14006000
              OF A COPY OF THE DESCRIPTOR ON THE TOP OF THE STACK.%     14007000
              THE PREVIOUS TWO SYLLABLES ARE FETCHED BY THE STREAM%     14008000
              STATEMENT GETSYLLABLES WHICH ALSO ADJUSTS THE C-L REGIST- 14009000
              ERS PROPERLY.%                                            14010000
              FINALLY THE STACK IS ADJUSTED AS FOLLOWS:%                14011000
                   DECREASE  S BY 1,IF OPDC OR DESC%                    14012000
                   XCH A AND B REGISTERS,IF COC OR CDC%                 14013000
                   OTHERWISE LEAVE THE SAME.                           ;14014000
         CHECKSTACKSPACE;%                                          %WF 14014100
         INCW ~ PRT[P1MIX,8];%                                          14015000
         POLISH(.INCW,IOR);%                                            14016000
         IRCW ~ * INCW ;%                                               14017000
         ICW ~ *( (NOT 0) INX INCW);%                                   14018000
         CL ~ (IRCW INX 0) & IRCW[30:10:2];%                            14019000
         STREAM             (T1~0,T2~0,CL:X~0);%                        14020000
              BEGIN%                                                    14021000
              SI~CL; SI~SI-2 ;  CL ~ SI; DI ~ LOC T2; DI~DI+6;%         14022000
              DS ~ 2 CHR;  SI ~ SI-3;%                                  14023000
              IF SC = "/" THEN%                                         14024000
                   BEGIN%                                               14025000
                   SI~SI-1; IF SC ="0" THEN%                            14026000
                   BEGIN TALLY~1; T1~TALLY ;CL ~ SI  END;%              14027000
                   END;%                                                14028000
              END  GETSYLLABLE ;%                                       14029000
         POLISH(.CL,~,.T2,~,.T1,~);%                                    14030000
         IF INCW.[32:1] THEN%                                           14031000
              BEGIN COMMENT  P-BIT IN CHARACTER MODE ;%                 14032000
              IF T2 = @4441 THEN%                                       14033000
              BEGIN COMMENT ENTER CHARACTER MODE;%                      14034000
                        P(M[(IRCW ~ *(NOT 0 INX INCW ~ PRT[P1MIX,8] ~%  14035000
                             (NOT 1 INX INCW)&0[32:1:1])).[18:15]]&%    14036000
                             1[16:47:1]&0[18:18:15],(NOT 0)INX INCW,~); 14037000
                        C ~ INCW INX 0 -2;%                             14038000
                   END ELSE BEGIN%                                      14039000
              IF MEMORY[ C ~ IRCW.[18:15]-T2.[36:6]].[1:3] = 4%         14040000
              THEN%                                                     14041000
              BEGIN%                                                    14042000
              IF T2.[42:6]= @53 THEN BEGIN%                             14043000
COMMENT  CONTROL WORD MEANS CHARACTER MODE RELEASE;%                    14044000
              T1~PRT[P1MIX,9]~M[(*((NOT 1)INX INCW)).[18:15]].[33:15];% 14045000
              POLISH(M[T1],0,0);%                                       14046000
         IF M[T1].[20:1] THEN CONTINUITYBIT;%                           14047000
              PROGRAMRELEASE;%                                          14048000
              END%                                                      14049000
              END;%                                                     14050000
              IF T2 = 0 THEN GO TO GETOUT;%                             14051000
                   END%                                                 14052000
              END%                                                      14053000
              ELSE%                                                     14054000
         BEGIN%                                                         14055000
         IF T2.[46:1] THEN%                                             14056000
              BEGIN%                                                    14057000
              C ~ ICW.[33:15];%                                         14058000
              POLISH(ICW, (NOT 1)INX INCW, ~,IRCW,%                     14059000
              PRT[P1MIX,8]~INCW ~ (NOT 0)INX INCW ,~);%                 14060000
              END    OPDC  DESC  PART%                                  14061000
         ELSE%                                                          14062000
              BEGIN%                                                    14063000
              C ~ INCW INX 0 -2;%                                       14064000
              IF (NT1 ~ T2 AND @77) = @41 THEN%                         14065000
              BEGIN   C ~C-1 ;%                                         14066000
              POLISH(MEMORY[C],MEMORY[C+1],[MEMORY[C]], ~ ,[MEMORY[C+1] 14067000
                     ],~);%                                             14068000
              END COC CDC PART%                                         14069000
              ELSE IF NT1 = @31 THEN%                                   14070000
                   BEGIN COMMENT THIS IS A BRANCH;%                     14071000
         GETOUT:        CL ~ P([PRT[P1MIX,1]],DUP,T2,XCH,~) INX @600000;14072000
                   END BRANCH PART%                                     14073000
              ELSE IF NT1 = @35 THEN GO TO GETOUT; COMMENT RETURN;%     14074000
              END  ALL SYLLABLES BUT OPDC DESC ;%                       14075000
         END  WORD MODE INTURRUPT ;%                                    14076000
         POLISH(IRCW & CL[33:33:15]&CL[10:30:2],INCW,~) ;%              14077000
         ANALYSIS ~ C ;%                                                14078000
         END   ANALYSIS OF P BIT ;%                                     14079000
COMMENT            THE SEGMENT DICTIONARY IS CONSTRUCTED BY THE%        14125000
                        COMPILERS AND EACH ENTRY HAS THE FORMAT:%       14126000
                   [ 1: 1]  = 1 FOR TYPE 2 SEGMENTS, =0 OTHERWISE.%     14127000
                   [ 2: 1]  = 1 FOR INTRINSICS , = 0 OTHERWISE.%        14128000
                   [ 8:10]  = LINK TO PRT FOR 1ST DESCRIPTOR FOR%       14129000
                             THIS SEGMENT.%                             14130000
                   [18:15]  = SEGMENT SIZE (</024) FOR ABSENT%          14131000
                             SEGMENTS .%                                14132000
                             = CORE ADDRESS OF PRESENT SEGMENTS.%       14133000
                             =  1  FOR NEVER-PRESENT INTRINSICS.%       14134000
                   [33:15]  = DISK ADDRESS  OF SEGMENT.%                14135000
                             = INTRINSIC-NUMBER FOR INTRINSICS.%        14136000
                   THE  PRT FOR PROGRAM SEGMENTS IS CONSTRUCTED BY THE% 14137000
                        COMPILERS IN THE FORMAT :%                      14138000
                   [ 0:5]    = PROGRAM DESCRIPTOR BITS.%                14139000
                   [ 6:1]    = STOPPER BIT WHICH DEFINES THE [ 7:11]%   14140000
                             FIELD.%                                    14141000
                   [ 7:11]   = LINK TO NEXT DESCRIPTOR THAT BELONGS TO% 14142000
                             THIS SEGMENT, IF STOPPER FALSE.%           14143000
                             = SEGMENT NUMBER, IF STOPPER TRUE.%        14144000
                   [18:15]   = F-REGISTER FIELD USED AT RUN TIME IN%    14145000
                             LABEL AND ACCIDENTIAL DESCRIPTORS.%        14146000
                             = SEGMENT NUMBER FOR WORD MODE AND%        14147000
                             CHARACTER MODE DESCRIPTORS.%               14148000
                   [33:15]   = CORE ADDRESS FOR PRESENT SEGMENTS.%      14149000
                             = RELATIVE ADDRESS FOR ABSENT SEGMENTS,%   14150000
                             I.E. RELATIVE TO BEGINNING OF SEGMENT.%    14151000
                   EACH PRT  (R+4) CONTAINS A DESCRIPTOR WHICH POINTS%  14152000
                        TO THE SEGMENT DICTIONARY.%                     14153000
         ;%                                                             14154000
PROCEDURE MAKEPRESENT(C); VALUE C; REAL C;%                             14155000
         BEGIN%                                                         14156000
         REAL MIXX=P1MIX;                                               14156500
         REAL SAVEBIT, MINE;%                                           14157000
         REAL P1MIX;  REAL YECCHH=-2;%                                  14157500
         REAL   D,MOTHER,MOM,LOC,SIZE;%                                 14158000
         INTEGER DISKADDR = SAVEBIT;%                                   14159000
    BOOLEAN   REENTRANT;                                                14159100
         DEFINE LINK= [ 7:11]#,STOPPER=[ 6: 1]#,PROGRAMDESC=[5:1]#;%    14160000
         DEFINE NOTOPEN =[25:1] #;%                                     14161000
         ARRAY NAME  DD ;%                                              14162000
         ARRAY PRTR[*]  ;%                                              14163000
         REAL SEGNO=MOTHER, X=MOM,IOD ;%                                14164000
         REAL SPACE;%   SPACE FOR SEGMENT NUMBERS  (INTRINSICS) BY MIX  14164100
         LABEL WRAP,AROUND,TESTREADY;%                                  14165000
         LABEL OPEN,CLOSE;%                                             14166000
         LABEL CODEIN;                                                  14166100
         DEFINE  REVERSE =[22:1]#,READY  =[19:1]#,PRESENT  =[2:1]#;%    14167000
COMMENT MAKEPRESENT HAS THE FOLLOWING ACTIONS,DEPENDING ON THE TYPE%    14168000
              OF DESCRIPTOR CAUSING PRESENCE BIT :%                     14169000
              DATA DESCRIPTOR :%                                        14170000
                   IF MOTHER ABSENT THEN GET CORE SPACE AND SET%        14171000
                        MOTHER PRESENT WITH PROPER CORE ADDRESS%        14172000
                        THEN IF INITIAL ACCESS,ZERO THE SPACE ELSE%     14173000
                        READ IN FROM DISK AND RETURN DISK SPACE%        14174000
                        THEN SET 1ST MEMORY LINK TO SAVE OR NOT SAVE%   14175000
                        AND SET 2ND LINK TO ADDRESS OF MOTHER%          14176000
                   IN ANY EVENT, SET COPY PRESENT WITH CORRECT CORE%    14177000
                        ADDRESS.%                                       14178000
              IO  DESCRIPTOR:%                                          14179000
              PROGRAM DESCRIPTOR:%                                      14180000
              ;%                                                        14181000
    SUBROUTINE RUNAROUND;%                                              14182000
    BEGIN WHILE NOT (PRTR[X] ~ ((LOC+2) INX PRTR[X])%                   14183000
         OR MEMORY).STOPPER DO X ~ PRTR[X].LINK;%                       14184000
    END RUNAROUND;%                                                     14185000
         IF (P1MIX ~ YECCHH.[CF])=0 THEN P1MIX ~ MIXX;                  14185500
    IF (D ~ M[C]).[1:1] THEN%                                           14186000
    IF D.[6:2]=1 THEN%TYPE 13 INTRINSIC                                 14186110
    BEGIN X~[INTRNSC[(NFLAG(D)) INX 0]];                                14186120
          SIZE~X INX 0; DISKADDR~X.[6:27];                              14186130
    MINE~(NFLAG(D) INX 0)&SIZE[8:38:10]&1[4:47:1]&1[2:47:1];            14186140
          LOC~GETSPACE(SIZE,13,0);                                      14186150
          M[LOC]~(*P(DUP))&P1MIX[9:42:6]&0[2:47:1];                     14186160
          GO TO CODEIN;                                                 14186170
    END ELSE                                                            14186180
    BEGIN PRTR ~ PRT[P1MIX,*];  LOC ~ NFLAG(D)&0[5:5:1];                14187000
         DO IF LOC.PROGRAMDESC THEN SEGNO ~ LOC.[18:15]%                14188000
              ELSE IF LOC.STOPPER THEN SEGNO ~ LOC.LINK%                14189000
              ELSE LOC ~ NFLAG(PRTR[LOC.LINK])%                         14190000
         UNTIL SEGNO!0;%                                                14191000
         DD ~ SEGNO INX PRTR[4];%                                       14192000
         IF DD[0].[3:1] THEN COMPLEXSLEEP((NOT DD[0].[3:1]));%          14193000
         IF (SIZE ~ (MINE ~ DD[0]).[18:15]){1023 THEN%                  14194000
         BEGIN DD[0].[3:1] ~ 1;%                                        14195000
              DD[0].[4:1]:=1;                                       %R3814195100
              IF MINE<0 THEN%                                           14196000
                IF PRTR[X ~ MINE.[8:10]].[2:1] THEN GO AROUND;%         14197000
              IF MINE.[2:1] THEN%                                       14198000
              BEGIN X ~ [INTRNSC[MINE INX 0]];%                         14198100
                   IF REENTRANT ~ X.[4:1] OR MEM[P1MIX,0]<FENCE THEN    14198200
                   BEGIN IF X>0 THEN SLEEP([X], -0);                    14198300
                        IF (X INX 0)>1023 THEN                          14198400
                        BEGIN LOC ~ (SIZE ~ X INX 0)-2;                 14198500
                             DD[0].[FF] ~ SIZE;  GO AROUND;             14198600
                        END ELSE P(ABS(X), [X], ~);                     14198700
                   END;                                                 14199000
                   SIZE ~ X INX 0;  DISKADDR ~ X.[6:27];                14200000
              END ELSE IF JAR[P1MIX,10]=0 THEN%                         14201000
                DISKADDR ~ DALOC[P1MIX,MINE.[33:6]+P(DUP)-1]%           14202000
                                       +MINE.[39:9]                     14202100
              ELSE DISKADDR ~ JAR[P1MIX,((MINE INX 0) DIV%              14203000
                (X ~ JAR[P1MIX,8]))+10]+(MINE INX 0) MOD X;%            14204000
              LOC ~ GETSPACE(SIZE, 1+(MINE<0)+70|REENTRANT, 0);         14205000
CODEIN:                                                                 14205010
$INCLUDE 14205101, IF STATISTICS;                                       14205099
              COUNTUP((LOC GTR FENCE)+19,(SIZE+29) DIV 30);             14205100
              DISKIO(IOD, -LOC-1, SIZE, DISKADDR);  X ~ MINE.[8:10];%   14206000
              IF MINE.[4:1] THEN                                    %R3814206100
                   OLAYCTR[P1MIX]:=DOWNOLAY(SIZE);                  %R3814206200
$INCLUDE 14206301, IF STATISTICS;                                       14206299
              CODEPBITS[P1MIX]:=*P(DUP)+1;                          %R6314206300
               IF D.[6:2]=1 THEN                                        14206310
               BEGIN SLEEP([IOD],IOMASK);                               14206320
               M[C].[CF]~LOC+2; M[C].[2:1]~1;                           14206330
               M[LOC+1]~        0&MINE[8:38:10]&SIZE[CTF];              14206340
               P(XIT);                                                  14206350
               END;                                                     14206360
              IF MINE>0 THEN BEGIN RUNAROUND;%                          14207000
$INCLUDE 14207201, IF STATISTICS;                                       14207099
                   IF MINE.[5:1] THEN MORECPBITS[P1MIX]:=*P(DUP)+1      14207100
                   ELSE DD[0].[5:1]:=1;                                 14207200
                   M[C] ~ ((LOC+2) INX D) OR MEMORY;%                   14208000
                   SLEEP([IOD], IOMASK);%                               14209000
                   IF REENTRANT THEN                                    14209100
                     INTRNSC[MINE.[CF]] ~ -(*P(DUP))&(LOC+2)[CTC] ELSE  14209200
                   IF (X ~ PRTR[4].[18:6])!0 THEN%                      14210000
                     M[LOC] ~ (*P(DUP))&X[9:42:6];%                     14211000
                   M[LOC+1] ~ SEGNO&SIZE[CTF];%                         14212000
              IF MINE.[2:1] THEN M[LOC+1] ~ (*P(DUP))&MINE[8:38:10];%   14212100
                   DD[0].[18:15] ~ LOC+2;%                              14213000
              END PROGRAM CODE SEGMENTS%                                14214000
              ELSE BEGIN SLEEP([IOD], IOMASK);%                         14215000
                   M[C] ~ PRTR[X] ~ M OR ((LOC+2)%                      14216000
                        &(M[LOC+1] ~ [PRTR[X]] INX 0)[18:33:15]%        14217000
                        &SIZE[8:38:10]);%                               14218000
$INCLUDE 14218301, IF STATISTICS;                                       14218099
                   DATAPBITS[P1MIX]:=*P(DUP)+1;                     %R6314218100
                   IF MINE.[6:1] THEN MOREDPBITS[P1MIX]:=*P(DUP)+1      14218200
                   ELSE DD[0].[6:1]:=1;                                 14218300
              END TYPE TWO DATA SEGMENTS;%                              14219000
              M[LOC].[2:1] ~ 0;%                                        14220000
         END ABSENT SEGMENTS%                                           14221000
         ELSE BEGIN LOC ~ SIZE-2;%                                      14222000
              REENTRANT ~ DD[0].[2:1];                                  14222100
    AROUND:   IF DD[0]>0 THEN%                                          14223000
                IF NOT PRTR[X ~ DD[0].[8:10]].[2:1] THEN RUNAROUND;%    14224000
              M[C] ~ IF DD[0]>0 THEN ((SIZE INX D) OR M)%               14225000
                   ELSE PRTR[DD[0].[8:10]];%                            14226000
         END;%                                                          14227000
         IF REENTRANT THEN                                              14227100
         BEGIN SIZE ~ (DD[0] INX 0)-1;%                                 14227200
              STREAM(SEGNO, T ~ SIZE AND 3,%                            14227300
                        I ~ [INTABLE[P1MIX,SIZE DIV 4]]);%              14227400
              BEGIN DI ~ DI+T;  DI ~ DI+T;  SI ~ LOC T;%                14227500
                   SI ~ SI-2;  DS ~ 2 CHR;  END;%                       14227600
         END;%                                                          14227700
         DD[0].[3:1] ~ 0;     P(XIT);%                                  14228000
    END;%                                                               14229000
         IF  D.[3:5] ! 0 THEN%                                          14230000
              BEGIN%                                                    14231000
COMMENT I/O DESCRIPTOR;%                                                14232000
              IF JAR[P1MIX,2] < 0 THEN                                  14233000
                   BEGIN TERMINATE(P1MIX);                              14233100
                        TERMINALMESSAGE(25);                            14233200
                   END;                                                 14233300
TESTREADY:    MOM:=M[LOC~D INX (IF D.REVERSE THEN 2 ELSE NOT 1)].[CF];  14234000
              IF (M[MOM] AND IOMASK)=0 THEN                             14235000
                   WAITORSWAP(M[LOC].[12:6],MOM);                       14236000
              IF TERMSET(P1MIX) THEN GO TO INITIATE;                    14237000
              IF MEMORY[MOM].PRESENT THEN%                              14238000
                        MEMORY[C]~MEMORY[MOM]%                          14239000
              ELSE%                                                     14240000
              BEGIN%                                                    14241000
              IF MEMORY[MOM].NOTOPEN THEN%                              14242000
OPEN:%                                                                  14243000
                 BEGIN SAVEOPEN(MOM); GO TO TESTREADY END           %R9014244000
              ELSE BEGIN%                                               14245000
COMMENT READY AND NOT PRESENT INDICATES REEL-SWITCH OR TERMINATE;%      14246000
                   PRTR~M[MOM-3];%                                      14247000
                   LOC~PRTR[15].[25:5];%                                14248000
                   SIZE~PRTR[4].[8:4];%                                 14249000
                   IF M[MOM].[27:1] THEN%                               14250000
                   IF M[MOM].[24:1] THEN%                               14251000
                   BEGIN IF SIZE=2 AND NOT PRTR[4].[2:1]%               14252000
                            AND NOT M[MOM].[22:1] THEN%                 14253000
                         BEGIN BLASTQ(LOC);%                            14254000
                               P(WAITIO(M[MOM-2],0,LOC),DEL);%          14255000
                               P(WAITIO(@1000000340000005,0,LOC),DEL);% 14256000
                               IF M[M[MOM-2] INX 4].[42:6]=1 THEN%      14257000
                   CLOSE:      BEGIN LOC~PRTR[13].[28:10];%             14258000
                                     FILECLOSE(MOM&@12[18:33:15]);%     14259000
                                     PRTR[13].[28:10]~LOC+1;%           14260000
                                     GO TO OPEN;%                       14261000
                               END;%                                    14262000
                         END;%                                          14263000
                   END ELSE%                                            14264000
                   BEGIN IF SIZE=2 OR SIZE=7 OR SIZE=8 THEN%            14265000
                         BEGIN IF NOT PRTR[4].[2:1] THEN%               14266000
                                  M[M[MOM-2] INX 4].[42:6]~1;%          14267000
                               GO TO CLOSE;%                            14268000
                         END;%                                          14269000
                   END;%                                                14270000
                   P(MOM,M[MOM].[27:1]+1,0,0);%                         14271000
                   COM11;%                                              14272000
                   END;%                                                14273000
              END;%                                                     14274000
              END%                                                      14275000
         ELSE%                                                          14276000
              BEGIN%                                                    14277000
COMMENT  DATA DESCRIPTOR;%                                              14278000
         IF   (MOTHER~MEMORY[MOM ~ D.[18:15]]).[2:1] THEN GO WRAP;%     14279000
         SAVEBIT ~ MOTHER.[CF]=1;                                       14280000
         MEMORY[MOM] ~ MOTHER&((LOC ~GETSPACE(SIZE~MOTHER.[8:10],2,%    14281000
                   SAVEBIT     ))+2)[33:33:15]&1[2:47:1];%              14282000
         IF MOTHER.[CF]{2 THEN                                          14283000
              STREAM(L~LOC+2, S~SIZE-1, T~0, W~(MOTHER.[CF]=2));        14284000
                   BEGIN  SI ~ LOC S;SI~SI+6;DI~LOC T;DI~DI+7;DS~CHR;%  14285000
                   DI~L;  SI~LOC W;  DS~WDS;                            14286000
                   SI~L; T(DS~32 WDS; DS~32 WDS); DS~S WDS;%            14287000
                   END  ZERO SPACE%                                     14288000
         ELSE%                                                          14289000
              BEGIN%                                                    14290000
COMMENT READ ARRAY FROM DISK AND RETURN DISK SPACE;%                    14291000
$INCLUDE 14291101, IF STATISTICS;                                       14291099
         MOREDPBITS[P1MIX]:=*P(DUP)+1;                                  14291100
              DISKWAIT(-LOC-2,MOTHER.[8:10],                            14292000
                DALOC[P1MIX,MOTHER.[33:6]+P(DUP)-1]+MOTHER.[39:9]);     14292100
$INCLUDE 14292201, IF STATISTICS;                                       14292199
              COUNTUP((LOC GTR FENCE)+21,(MOTHER.[8:10]+29) DIV 30);    14292200
               MOM~MOM&MOTHER[CTF];                                     14293000
              OLAYCTR[P1MIX]:=DOWNOLAY(MOTHER.[8:10]);              %R3814294000
              END ;%                                                    14295000
         MEMORY[LOC].[2:1] ~   SAVEBIT;%                                14296000
         MEMORY[LOC+1] ~ MOM ;%                                         14297000
$INCLUDE 14297101, IF STATISTICS;                                       14297099
         DATAPBITS[P1MIX]:=*P(DUP)+1;                               %R6314297100
WRAP:%                                                                  14298000
         MEMORY[C] ~ IF D.[8:10] = 0 THEN P(M[MOM],0,CDC,D,XCH,INX)%    14299000
                    ELSE  MEMORY[MOM];%                                 14300000
              END;%                                                     14301000
         END  MAKEPRESENT ;%                                            14302000
 REAL ADDRS=NT1;%                                                       14342000
 PROCEDURE COM5;%                                                       14343000
    BEGIN%                                                              14344000
         DEFINE HARRYSTA      = M[WORKERSTACK+5]#,    % STA             14344100
                CLEARINPUTANK =                                         14344200
                   STATABLE[I]:=(*P(DUP))&(CANDEMIX[I]+@240)[1:39:9]    14344250
$INCLUDE 14344321, IF DCP;                                              14344259
                        &0[14:47:1]&1[16:47:1];                         14344260
                   T:=INPUTANK[I];                                      14344280
                   INPUTANK[I]:=NABS(0);                                14344300
                   IF (T:=T.[FF]) GTR 256 THEN                          14344320
$OMIT 14344501, IF DCP;                                                 14344349
                     &0[14:47:1]&1[16:47:1]                             14344350
                     &(NOT (T:=INPUTANK[I]))[13:35:1];                  14344400
                   INPUTANK[I]:=NABS(P(DUP,LOD,0,XCH)&P[35:35:1]);      14344450
                   IF (T:=T.[FF]-2) GTR 0 THEN DO                       14344500
                   BEGIN IF (M[T] AND IOMASK)=0 THEN                    14344550
                        SLEEP([M[T]],IOMASK);         % THEN DISCARD    14344600
                        FORGETSPACE(T);               % BUFFERS         14344700
$OMIT 14344801, IF DCP;                                                 14344799
                   END UNTIL (T:=M[T+2].[CF]-2) LSS 0;                  14344800
$INCLUDE 14344851, IF DCP;                                              14344849
                   END;                                                 14344850
                #;                                                      14344900
         REAL RCW=+0,%                                                  14345000
              ERTOG=+2,%                                                14346000
              I    =+3,%                                                14347000
              T    =+4;%                                                14348000
         INTEGER J=I;%                                                  14349000
         ARRAY VECTOR=+5[*],S=+6[*];%                                   14350000
         INTEGER Q=S;                                                   14350100
         REAL MSCW=-1;                                                  14350200
         REAL TYP=+7;                                                   14351000
         INTEGER LINK;                                                  14351100
         LABEL RETURNEM,AHEAD;                                          14351150
         INTEGER MOTHER=+8, NEXTMOM=+9, MOMMIX=+10, CATCH=+11;%         14351200
         ARRAY PRTR=LINK[*];                                        %R2314351300
$INCLUDE 14351311, IF STATISTICS;                                       14351309
         REAL OBJINFO=+12;                                              14351310
         PRIORTY~PRYOR[P1MIX]~-1;                                       14351500
         P(GETSPACE(128,64,0),STS,.COM5,RCW,0,RDS,0,XCH,CFX,STF);       14353000
         P(P&[MSCW][CTF],0,0,0,0,0,0);                                  14354000
         P(0, 0, 0, 0, 0, 0);%                                          14355000
$INCLUDE 14355201, IF STATISTICS;                                       14355099
         P(0);                                                          14355100
              CORETIME[P1MIX]:=(*P(DUP))+CLOCK+P(RTR)-TIMING[P1MIX];    14355200
         UVROW[P1MIX]~(VECTOR~UVROW[P1MIX])&                            14356300
              (GETSPACE(UVSIZE,64,0)+2)[CTC];                           14356400
         MOVE(UVSIZE,VECTOR,UVROW[P1MIX]);                              14356500
         VECTOR ~ JARROW[P1MIX]&(GETSPACE(30,64,0)+2)[CTC];             14357000
         MOVE(30,JARROW[P1MIX],VECTOR);                                 14357100
         FORGETSPACE(JARROW[P1MIX]);                                    14357200
         JARROW[P1MIX] ~ VECTOR;                                        14357300
         ERTOG~0&PRT[P1MIX,@25][1:2:46];                                14357400
         TYP~VECTOR[2].[8:10];                                          14358000
              IF VECTOR[0]<0 THEN%                                      14358100
                   BEGIN CATCH~PRT[P1MIX,@26];                          14358150
                        ERTOG~VECTOR[1]<0 OR ERTOG;                     14358200
                   END;                                                 14358300
              IF VECTOR[2]<0 THEN  %  COBOL                             14360100
              IF VECTOR[1]>0 THEN  % NOT DS-ED                          14360200
              WHILE PRT[P1MIX,16]>0 DO ASR;%CLEAN OUT AIT               14360300
         SLEEP([OLAYMASK],T~TWO(P1MIX));                                14360302
         OLAYMASK~OLAYMASK AND NOT T;                                   14360304
         T ~ DALOC[P1MIX,0].[CF];                                       14360310
         FOR I~1 STEP 2 UNTIL T DO                                      14360320
         BEGIN IF P(DALOC[P1MIX,I], DUP)<0 THEN                         14360322
              BEGIN NT2 := ABS(POLISH DIV 500);                         14360324
                   DALOC[P1MIX,I] := DRUMTABLE[NT2];                    14360326
                   DRUMTABLE[NT2] := -1;  DRUMCTR := *P(DUP)+1;         14360328
              END ELSE P(DEL);                                          14360330
              FORGETUSERDISK(DALOC[P1MIX,I], -500);                     14360332
         END;                                                           14360334
         J~INTABLEROW[P1MIX]~0;                                         14360340
         IF MEMROW[P1MIX].[CF]<FENCE THEN                               14360400
              BEGIN STASUS[P1MIX]~STABLE;                               14360500
              CORE.[FF]~CORE.[FF]-SINFO[P1MIX].[FF];                    14360600
              WAITSTORE(P1MIX);                                         14361000
 $ VOID 14361301                                                    %R8114361100
              WHILE(T~M[I]).[CF] ! 0 DO%                                14362000
                   BEGIN%                                               14363000
                   IF T>0 THEN%                                         14364000
                        IF T.[9:6]=P1MIX THEN%                          14365000
%                                                                   %R8114365100
%                                                                   %R8114365200
                                       FORGETSPACE(I INX 2);        %R8114365300
                        I~ T.[CF]%                                      14366000
                   END;%                                                14367000
              END ELSE                                                  14367010
              BEGIN IF LOGLINE.[33:7]!0 THEN                            14367020
                   BEGIN CLEARTANK(LOGLINE,0);                          14367021
                        TANKS[I:=LOGLINE.[40:8]]:=(*P(DUP))&0[CTC];     14367022
                         IF WORKING THEN          % MAKE SURE HARRY ISNT14367023
                         IF HARRYSTA=I THEN       % DIDDLING OUR LINE   14367024
                         COMPLEXSLEEP(NOT WORKING OR HARRYSTA!I);       14367025
                        CLEARINPUTANK;                                  14367030
$OMIT 14367033, IF DCP;                                                 14367031
                        TANKOK[I]:=0;                                   14367032
                   END;                                                 14367034
                   SWAP(EOJSTATE,0);                                    14367036
                   MEMROW[P1MIX]:=MEMROW[0];                            14367038
                   T~(I~NOT FENCE INX 1) DIV 1890+2;                    14367040
                   FORGETUSERDISK(DISKSTORE[P1MIX],NABS(I DIV 30+T+T+2))14367050
              END;                                                      14367060
                                                                        14367100
         DAT[P1MIX]~0;                                                  14367200
 $ VOID 14370201                                                    %R8114368000
         IF TYP!0 THEN                                                  14371000
$OMIT 14373101, IF STATISTICS;                                          14371999
              FORGETSPACE(DIRECTORYSEARCH(VECTOR[7],IF VECTOR[0]<0      14372000
                   THEN "DISK   " ELSE IF VECTOR[0].[2:1] THEN "CANDE  "14373000
                        ELSE ABS(VECTOR[1]),13));                       14373100
$INCLUDE 14373801, IF STATISTICS;                                       14373199
              BEGIN                                                     14373200
                   NT1:=DIRECTORYSEARCH(VECTOR[7],IF VECTOR[0]          14373300
                        LSS 0 THEN "DISK   " ELSE IF VECTOR[0].[2:1]    14373400
                        THEN "CANDE  " ELSE ABS(VECTOR[1]),13).[CF];    14373500
                   OBJINFO:=M[NT1+3]&M[NT1+4][24:36:6];                 14373600
                   FORGETSPACE(NT1);                                    14373700
              END;                                                      14373800
              IF TYP=1 THEN % COMPILE PART OF COMPILE &GO               14374000
                   BEGIN%                                               14375000
    RETURNEM:           S~[M[GETSPACE(31,0,0)+2]]&31[8:38:10];          14376000
                        DISKWAIT(-S.[CF],30,VECTOR[2].[FF]);            14376100
                        IF ERTOG=0 AND TYP=1 THEN                       14376200
                             BEGIN%                                     14377000
                                  SLEEP([TOGLE],SHEETMASK);             14378000
                                  SHEETFREE~0;%                         14379000
                                  STREAM(A~0:B~P(.SCHEDULEIDS));        14383100
                                  BEGIN SI~B;                           14383200
                                     47(SKIP SB; SKIP DB; TALLY~TALLY+1;14383300
    IF SB THEN BEGIN END                                                14383400
                                              ELSE JUMP OUT);           14383450
                                        DS~SET; A~TALLY;                14383500
                                  END STREAM;                           14383600
                                  T ~ P; S[3] ~ 0&T[8:38:10];           14383700
                                  S[25] ~ CATCH;                        14383740
                                  S[6] := VECTOR[6];                    14383750
                                  DISKWAIT(S.[CF],30,                   14383800
                                                       VECTOR[2].[FF]); 14383900
                                  I ~ IF S[18] > SHEETMAX THEN SHEETMAX 14385000
                                                        ELSE S[18];     14386000
                                  IF SHEET[I].[CF] ! 0 THEN             14387000
                                  BEGIN DISKWAIT(-S.[CF],30,            14388000
                                                       SHEET[I].[FF]);  14389000
                                        S[29] ~ VECTOR[2].[FF];         14391000
                                        DISKWAIT(S.[CF],30,             14392000
                                                       SHEET[I].[FF]);  14392500
                                  END ELSE SHEET[I] ~ VECTOR[2].[FF];   14394000
                                  SHEET[I].[FF] ~ VECTOR[2].[FF];       14395000
                                  SHEETFREE~1 ;FORGETSPACE(S INX 0);%   14396000
                                  NEEDSELECT:=1;                    %R9314396100
                                  GO AHEAD;                             14396200
                             END%                                       14397000
                   ELSE BEGIN%                                          14398000
                             FORGETESPDISK(VECTOR[2].[18:15]);%         14399000
                             LINK ~ S[13];                              14399100
                             WHILE LINK!0 DO                            14399200
                               BEGIN DISKWAIT(-S.[CF],30,LINK);         14399300
                                     FORGETESPDISK(LINK); LINK ~ S[29]; 14399500
                               END;                                     14399600
                             FORGETSPACE(S);                            14399700
                        END                                             14400000
                   END  ELSE%                                           14401000
                        IF TYP=0 THEN                                   14402000
                             BEGIN%                                     14403000
              FOR I~1 STEP 1 UNTIL VECTOR[9] DO%                        14404000
              IF VECTOR[9+I] ! 0 THEN%                                  14405000
              FORGETUSERDISK(VECTOR[9+I],-VECTOR[8]);                   14406000
                             END ELSE                                   14407000
                        IF TYP=4                                        14407100
                           THEN GO TO RETURNEM;                         14407200
              IF (T:=VECTOR[6].[CF]) GEQ ESPDISKBOTTOM AND T LSS        14407300
              ESPDISKTOP THEN FORGETESPDISK(T);                         14407400
    AHEAD:                                                              14407500
              IF JAR[P1MIX,0] < 0 THEN%                                 14408000
              IF ERTOG ! 0 THEN%                                        14409000
                   TYP~3;                                               14410000
              T~UVROW[I~P1MIX].[CF];                                    14411000
              COMMENT SUBTRACT CORE REQUIREMENTS FROM CORE WORD;        14411100
                                                                        14411200
              VECTOR := VECTOR&SPACE(10)[CTC];                          14412110
              MOVE(10,JARROW[P1MIX],VECTOR);                            14412120
              WHILE (NT2~XCLOCK+P(RTR))}5184000 DO MIDNIGHT;            14412200
              MOTHER~IF VECTOR[1]<0 THEN 2 ELSE TYP!3;                  14412300
              NEXTMOM~PROCTIME[I]+VECTOR[3]+CLOCK+P(RTR);               14412400
 $ VOID                                                             %R2314412500
              CATCH~((VECTOR[2]~USERCODE[I])!ABS(VECTOR[1])             14412600
                   AND USERCODE[I]!0)+1;                                14412610
              S := VECTOR&(SPACE(10)-1)[CTC];                           14412800
              MOVE(10,[S[0]],[S[1]]);                                   14412900
              IF (LOGARRAY[31] AND IOMASK)=0 THEN                   %R2714413000
                   SLEEP([LOGARRAY[31]],IOMASK);                    %R2714413010
              S[1] ~ NEXTMOM;                                           14413100
              S[2] ~ VECTOR[4]+IOTIME[I];                               14413200
              S[3] ~ (LC[I]-SC[I])|CHUNKZIZE+CHUNKZIZE;                 14413300
              MAKELOG([S[0]].[CF],EOJSTATS);                            14414000
              IF LOGLINE.[33:7] NEQ 0 THEN                          %R2314414010
              BEGIN PRTR:=IOQUE&GETAREA(2)[CTC];                    %R2314414020
               PRTR[0].[FF]:=LOGLINE;                               %R2314414030
               PRTR[1]:=MOTHER;                                     %R2314414040
               PRTR[2]:=XCLOCK+P(RTR);                              %R2314414050
               MOVE(9,[S[1]],[PRTR[3]]);                            %R2314414060
               PRTR[12]:=ERTOG.[1:46];                              %R2314414070
               PRTR[13]:=VECTOR[0];                                 %R2314414080
               PRTR[14]:=VECTOR[1];                                 %R2314414090
               PRTR[15]:=USERCODE[P1MIX];                           %R2314414100
               PRTR[16]:=NEXT1[P1MIX];                              %R2314414110
               PRTR[17]:=NEXT2[P1MIX];                              %R2314414120
               QUEVENT(PRTR.[CF],CANDYINX);                         %R2314414800
              END ELSE                                              %R2314414810
              IF NEXT1[P1MIX] NEQ 0 THEN                            %R2314414820
                   ZIPPER(NEXT1[P1MIX],NEXT2[P1MIX]);               %R2314414830
$INCLUDE 14414886, IF STATISTICS;                                       14414834
              JOBNUM:=JOBNUM-1;                                         14414835
              S[1]:=CORETIME[P1MIX];                                    14414840
              S[2]:=OLAYUSED[P1MIX];                                    14414845
              S[3]:=READYQUETIME[I]&INITIALRQTIME[I][1:25:23];          14414850
              S[4]:=OBJINFO&SQ[P1MIX][6:24:18];                         14414855
              S[5]:=SWAPS[P1MIX]&SWAPOUTS[P1MIX][1:25:23];              14414860
              S[6]:=CODEPBITS[P1MIX]&DATAPBITS[P1MIX][1:25:23];         14414865
              S[7]:=CODEOLAYS[P1MIX]&DATAOLAYS[P1MIX][1:25:23];         14414870
              S[8]:=JOBNUM;                                             14414875
              S[9]:=MORECPBITS[P1MIX]&MOREDPBITS[P1MIX][1:25:23];       14414880
              MAKELOG([S[0]].[CF],SYSTATS);                             14414885
              FORGETSPACE([S[1]]);                                  %R2314414900
              FORMTIME([VECTOR[4]],NEXTMOM);                            14415000
              LINK:=(NOT VECTOR[0]).[2:1];                          %R2014415810
              IF STASUS[I] NEQ STABLE THEN                          %R4114415850
                 COMPLEXSLEEP(STASUS[P1MIX]=STABLE);                %R4114415860
              STREAM(B~MOTHER,C~CATCH,I,VECTOR);                        14415900
                   BEGIN%                                               14416000
                        DS ~ LIT " "; DI ~ DI+7;%                       14417000
                        C(DS~LIT "/"; DI~DI+7);                         14418000
                        SI~LOC C; SI~SI+7;                              14418100
                        IF SC="1" THEN DS~8 LIT " ";                    14418200
                        DS~LIT"="; SI~LOC I; DS~2 DEC;                  14419000
                        I~DI; DI~DI-2; DS~FILL; DI~I;                   14419100
                        DS~ 5 LIT ",PST=";                              14419200
                        DI~DI+8;                                        14419500
                        CI ~ CI+B;%                                     14420000
                        GO TO E;%                                       14421000
                        GO TO OK;%                                      14422000
                        DS~7 LIT " DS-ED ";                             14423000
                        GO TO X;%                                       14424000
              OK:%                                                      14425000
                        DS~5 LIT " EOJ ";                               14426000
                        GO TO X;%                                       14427000
              E:        DS~11 LIT " SYNTX ERR ";                        14428000
              X:        DS~LIT"~";                                      14429000
                   END;                                                 14429100
              SPOUTIT(VECTOR,(LINK OR CANDYMESS) AND                %R2014430000
                   EOJMESS OR EOJK);                                %R2014430010
              IF (LOGARRAY[31] AND IOMASK)=0 THEN                       14430100
                   SLEEP([LOGARRAY[31]], IOMASK);                       14430200
              FORGETSPACE(JARROW[I]);                                   14431000
              P1MIX~JARROW[I]~PRTROW[I]~0;                              14431100
              IF BATCHJOB[I] OR FSROW[I].[CF] LSS FENCE             %R9314431500
                   OR NEEDSELECT THEN                               %R9314431600
              SELECTION;                                                14432000
              NEEDSELECT:=0;                                        %R9314432500
              FORGETSPACE(T);                                       %R9314432600
              KILL([RCW]);%                                             14434000
    END L5COM;%                                                         14435000
 PROCEDURE ZIPPER(W1,W2); VALUE W1,W2; REAL W1,W2;%                     14531000
         BEGIN REAL T,I;                                                14532000
         T ~ GETSPACE(12,64,0)+4;                                       14533000
                                                                        14534000
         IF (I~USERCODE[P1MIX])=ABS(NOT 0) THEN I~ 0;                   14534500
         STREAM(K~0,A~[W1],C~I,B~T);                                    14535000
         BEGIN  TALLY~12;K~TALLY;SI~LOC K;SI~SI+7;%                     14536000
         DS:=CHR;                                                       14537000
         DS:= 5 LIT "USER="; SI:=LOC C; SI:=SI+1; DS:= 7 CHR;           14537100
         DS:= 8 LIT ";EXECUTE";SI:=A; SI:=SI+1;                         14537200
         DS~LIT" ";DS~7CHR;SI~SI+1;DS~LIT"/";%                          14538000
         DS ~ 7 CHR; DS ~ 6 LIT "; END.";%                              14539000
         DS:=37 LIT " " ;         END;                                  14540000
         I~ IF P1MIX=0 OR USERCODE[P1MIX]=ABS(NOT 0) THEN 31 ELSE 26;   14541000
         FORK(0&LOGLINE[32:1:1]|LOGLINE OR P(.CONTROLCARD),         %R2314541050
              T&I[3:43:5],-1,192,0);                                %R2314541100
         END ZIPPER;%                                                   14542000
PROCEDURE LBMESS(FN,SN,A,B,C,D,E);                                      14542500
    VALUE FN,SN,A,B,C,D,E;                                              14542600
    REAL FN,SN,A,B,C,D,E; FORWARD;                                      14542700
PROCEDURE   ENTERUSERFILE(A,B,L);VALUE  A,B,L; REAL A,B,L;%             14543000
         BEGIN%                                                         14544000
         REAL  I,J,R,T,Z;%                                              14545000
         ARRAY  X[*];%                                                  14546000
         INTEGER S;                                                     14546100
         ARRAY AL[*],AT=T[*];                                           14546200
$ INCLUDE 14546301, IF SHAREDISK;                                       14546299
         BOOLEAN DELETETOG;                                             14546300
         LABEL FOUND,WHY;%                                              14547000
         LABEL FAST;                                                %R9214547900
         LABEL CHECK,DOWN,BOMBOUT;%                                     14548000
    REAL SUBROUTINE THERE;%                                             14549000
         BEGIN%                                                         14550000
         T ~ S;                                                         14551000
         DO BEGIN J~T; DISKWAIT(-R,60,J);                               14552000
              FOR I~0 STEP 3 UNTIL 57 DO BEGIN                          14553000
              IF (X[I]EQV A)=NOT 0 THEN%                                14554000
                   IF T~((X[I+1]EQV B)=NOT 0 )THEN GO DOWN;%            14555000
                                                                        14556000
              IF(X[I]EQV@14)=NOT 0 THEN                                 14557000
              IF Z<0 THEN Z ~ J END END UNTIL(T~X[2].[FF])=0;           14557100
              IF Z<0 THEN Z ~ J;                                        14557200
         DOWN:   THERE~T;%                                              14558000
         END;%                                                          14559000
$ INCLUDE 14559101, IF SHAREDISK;                                       14559099
         DELETETOG:=A.[1:1];                                            14559100
         A:=ABS(A);                                                     14559200
         IF (A.[1:5]!0 OR B.[1:5]!0 OR A=@114 OR A=@14) THEN            14559300
         BEGIN                                                          14559400
              TERMINATE(P1MIX); TERMINALMESSAGE(75);                    14559500
             GO TO BOMBOUT;                                             14559600
         END;                                                           14559700
         LOCKDIRECTORY;                                                 14560000
         X := [M[R := SPACE(60)]]&60[8:38:10];                          14561000
         AL~IOQUE&(L+1)[CTC];                                           14561100
         S:=SCRAMBLE(A,B);                                          %10414562000
% VOID                                                              %10414562500
 CHECK:  Z ~ -S;                                                        14563000
         IF P1MIX !0 THEN%                                              14564000
         IF THERE THEN%                                                 14567000
         BEGIN T:=SPACE(30)&X[I+2][CTF];                            %R9214568000
         DISKWAIT(-T.[CF],30,T.[FF]);                               %R9214569000
         R:=R&((M[T+4].[1:3] OR M[T+4].[12:24] OR M[T+9].[1:28]) = 0)   14569100
              [1:47:1];                                                 14569150
         IF B NEQ USERCODE[P1MIX] OR R GTR 0 THEN                   %R9214569200
         BEGIN UNLOCKDIRECTORY;                                         14569300
              R:=ABS(R);                                            %R9214569400
         IF SECURITYCHECK(A,B,USERCODE[P1MIX],T)!7 THEN                 14570000
              FILEMESS(-"INVALID","USER   ",A,B,0,0,0);                 14571000
         END;                                                       %R9214571100
         IF R LSS 0 THEN                                            %R9214571200
         BEGIN S:=T.[FF];                                           %R9214571300
              AT:=IOQUE&T[CTC];                                     %R9214571400
              DISKLOG(A,B,AT);                                      %R9214571500
              J:=AT[9]+9;                                           %R9214571600
              FOR I:=10 STEP 1 UNTIL J DO                           %R9214571700
              IF AT[I] NEQ 0 THEN                                   %R9214571800
                   FORGETUSERDISK(AT[I],AT[8]);                     %R9214571900
         END ELSE                                                   %R9214572000
              AT:=IOQUE&DIRECTORYSEARCH(A,B,7)[CTC];                %R9214572100
         IF AT.[CF] NEQ 0 THEN                                      %R9214572200
         BEGIN IF AL[4].[36:6]=0 THEN                                   14573000
                   AL[4]~(*P(DUP))&AT[4][36:36:6];                      14574000
              AL[1]:=AT[1];                                         %11214574100
              AL[2]~AT[2];                                              14575000
% VOID -- BY JHA 9/23/69                                            %11614576000
              AL[5]~AT[5];                                              14577000
              AL[6]~AT[6];                                              14578000
              FORGETSPACE(AT);                                          14579000
              IF R LSS 0 THEN GO TO FAST;                           %R9214579100
         END;                                                           14580000
         LOCKDIRECTORY;                                                 14588000
         GO TO CHECK;%                                                  14589000
         END;                                                           14590000
         I ~ J;                                                         14591000
         DO BEGIN J~ABS(Z);                                             14591500
              IF Z!I THEN DISKWAIT(-R,60,J);                            14592000
              FOR I~0 STEP 3 UNTIL 57 DO                                14593000
              IF (X[I] EQV @14)= NOT 0 THEN GO TO FOUND;                14594000
         END UNTIL (Z~X[2].[FF])=0;                                     14595000
         X[2].[FF]~  BYPASS ~ BYPASS-2;                                 14596000
                                                                        14597000
         IF BYPASS.[CF]{BYPASS.[FF] THEN DIRECTORYFULL(0);              14598000
         DISKWAIT(R,60,J);                                              14598100
         FOR I~0 STEP 1 UNTIL 59 DO X[I]~@14;                           14598200
         J ~ BYPASS.[CF];                                               14598300
         I ~ 0;                                                         14598400
    FOUND:%                                                             14599000
                   PBCOUNT~PBCOUNT+((((A EQV"PBD    ")=NOT 0) OR        14599900
                           ((A EQV"PUD    ")=NOT 0)) AND (B.[CF]=1));   14599910
         X[I]~A; X[I+1]~B; X[I+2].[CF]~NEXTSLOT;                        14600000
         DISKWAIT(R,60,J);                                              14600500
         J~(NEXTSLOT-DIRECTORYTOP-3)&0[44:44:4]+DIRECTORYTOP+19;        14601000
         I~ (NEXTSLOT-J)|2+30; S ~ NEXTSLOT;                            14601500
         DISKWAIT(-R,30,J);                                             14602000
         Z ~ (NEXTSLOT~X[I+1])=0;                                       14602500
         X[I]~A; X[I+1]~B;                                              14603000
         IF Z THEN                % GOING TO USE EOF RECORD             14603100
         IF I=0 THEN              % WRITE NEW EOF RECORD BEFORE         14603110
         BEGIN P(X[28],X[29]);    % DESTROYING CURRENT ONE              14603200
              X[28] ~ @114;       % SAVE NAME, REPLACE WITH "END" FLAG. 14603300
              X[29]:=0;                                                 14603310
              NEXTSLOT:=S+30;                                           14603320
              BYPASS.[FF] ~ J+16;                                       14603330
              DISKWAIT(R,30,J+16);                                      14603400
              P([X[29]],~,[X[28]],~);  % RESTORE CLOBBERED NAME         14603600
              IF J+16}BYPASS.[CF] THEN DIRECTORYFULL(0);                14603700
         END ELSE                                                       14603800
         BEGIN X[I-2]:=@114; X[I-1]:=0; NEXTSLOT:=S-1 END;              14604000
 FAST:                                                              %R9214605000
         DISKWAIT(L+1,30,S);                                            14606000
        IF R GTR 0 THEN                                             %R9214606500
         DISKWAIT(R,30,J);                                              14607000
$ INCLUDE 14612001,IF SHAREDISK ;                                       14610000
         IF NOT DELETETOG THEN                                          14610100
         FOR I:=M[L+10]+10 STEP -1 UNTIL 11 DO IF M[L+I]!0  % SHAREDISK 14611000
              THEN SCRATCHDIRECTORYDELETE(M[L+I],M[L+9]) ;% SHAREDISK   14612000
         UNLOCKDIRECTORY;                                               14618000
         DIRECTORYFREE := 2|S+1;                                        14619000
    BOMBOUT:%                                                           14620000
         FORGETSPACE(R);                                                14621000
         END  ENTERUSERFILE ;%                                          14622000
PROCEDURE COM11; COMMENT ALGOL I/O COMMUNICATE;%                        14623000
BEGIN REAL CODE=-4,TANK=-5,ROW=-6;%                                     14624000
         REAL MID=-8,FID=-7;                                            14624050
          REAL STA=-6, RESULT=-7, B, T, F, S, TIMEOUT=-7;               14624100
          NAME PHYL=-5, A;                                              14624200
      ARRAY HEADER=-5[*];%                                              14625000
      ARRAY FINAL=-6[*];%                                               14626000
      LABEL OPEN,PARITY,EOF,EOT,DISKSPACE,DISKLOCK;%                    14627000
      LABEL ARGH,ECH,PURGELOCK,SEEKDC;                                  14627400
      LABEL CLOSE,RDATA,SELERR,SPACE,REFILL;%                           14628000
      LABEL READLABEL;                                                  14629000
      LABEL IOREQ,ROTATE;%                                              14630000
          SWITCH FUNCTION~OPEN,PARITY,EOF,EOT,DISKSPACE,SEEKDC,CLOSE,   14631000
              RDATA,SELERR,SPACE,REFILL,READLABEL,IOREQ,ROTATE          14632000
              ;                                                         14632900
      REAL INFO,LOC,USASI;                                              14633000
      REAL I;%                                                          14634000
       LABEL MESSAGE, BACK;                                             14635000
      ARRAY FPB[*],FIB[*];%                                             14636000
      REAL  TANG=TANK;                                                  14636100
      IF CODE=20 THEN GO TO PURGELOCK;                                  14636900
      GO TO FUNCTION[CODE];%                                            14637000
 $ VOID                                                             %R9014638000
PARITY:     INFO~" PAR"; GO TO MESSAGE;%                                14639000
EOF:        INFO~" EOF"; GO TO MESSAGE;%                                14640000
EOT:        INFO~" EOT";%                                               14641000
MESSAGE:    FPB~PRT[P1MIX,3]; FIB~M[P(.TANK,LOD).[33:15]-3];%           14642000
            IF FIB[5].[1:1] THEN INFO:= -" INV" OR M;                   14642100
            IF FIB[4].[8:4]=14 THEN                                     14642200
              BEGIN TERMINATE(P1MIX); TERMINALMESSAGE(61) END;          14642300
            STREAM(X~INFO,Z~0,F~ IF TANG=0 THEN 0 ELSE                  14643000
                   [FPB[FIB[4].[13:11]]],                               14643100
                   Q~TANG!0,                                            14643200
                   J~JARROW[P1MIX],%                                    14644000
                   D~(CODE~GETSPACE(10,2,0)+2));%                       14645000
                   BEGIN DS ~ LIT "-"; SI~LOC X; SI~SI+5; DS~3 CHR;%    14646000
                        SI~LOC X; IF SC=0 THEN DS~10 LIT " NO LABEL "%  14647000
                                          ELSE IF SC="8" THEN DS~11 LIT 14647100
                                          "WRITE TU 0 "                 14647200
                                     ELSE IF SC=@30 THEN DS:=10 LIT     14647300
                                          "ALID USER "                  14647400
                                          ELSE DS~10 LIT "ECT ERROR ";% 14648000
                        Q(X~DI; SI~F; DI~LOC Z;                         14649000
                        IF 8 SC!DC THEN BEGIN SI~F; SI~SI+1; DI~X;%     14650000
                                              DS~7 CHR; DS~LIT" "; X~DI;14651000
                                       END;%                            14652000
                        DI~X; SI~SI+1; DS~ 7 CHR );                     14653000
                        DS~2 LIT ":~";%                                 14654000
                   END;%                                                14655000
                                                                        14656000
                                                                        14657000
            TERMINATE(P1MIX); TERMINALMESSAGE((-CODE));%                14658000
DISKSPACE:OPEN:CLOSE:                                               %R9014659000
              IF HEADER[4] THEN % FILE IS IN DIRECTORY                  14659100
                   FORGETSPACE(DIRECTORYSEARCH                          14659200
                        (MID,FID,-(HEADER.[CF])&ROW[CTF])) ELSE         14659300
              HEADER[ROW]:=GETUSERDISK(HEADER[8]);                      14659400
SEEKDC::    GO TO INITIATE;                                             14660000
PURGELOCK: SAVEWORD:=SAVEWORD OR TWO(ROW);     ::                       14671000
 $ VOID                                                             %R9014672000
RDATA::       INFO~" RER"; GO TO MESSAGE;                               14673000
SELERR:     INFO~-" SEL"; GO TO MESSAGE;%                               14674000
SPACE:      FIB~M[P(.TANK,LOD).[33:15]-3]; LOC~FIB[15].[25:5];%         14675000
            BLASTQ(LOC);%                                               14676000
            FPB~[MEMORY[5]]&3[23:46:2]&ROW[22:1:1];%                    14677000
            ROW~ABS(ROW);%                                              14678000
            WHILE (ROW~ROW-1)}0 DO INFO~WAITIO(FPB,@40,LOC);%           14679000
                   GO TO INITIATE;     ::                               14680000
REFILL:     FIB~M[(TANK~P(.TANK,LOD).[33:15])-3];%                      14681000
            CODE~FIB[13].[10:9]-1;%                                     14682000
            LOC~FIB[19].[33:15]-FIB[16].[33:15];%                       14683000
            FPB~MEMORY[FIB[16] INX 0+ROW];%                             14684000
            INFO~FPB.[18:15];%                                          14685000
            FOR I~1 STEP 1 UNTIL CODE DO%                               14686000
            BEGIN IOREQUEST(FLAG(FIB[19]&(INFO+LOC)[33:33:15]),%        14687000
                            FIB[16]&INFO[33:33:15],FPB);%               14688000
                  MEMORY[TANK]~MEMORY[TANK]&0[2:2:1]&0[19:19:1]%        14689000
                                  &0[26:26:7]&INFO[33:33:15];%          14690000
                  STREAM(CODE,T~MEMORY[TANK],TANK);%                    14691000
                  BEGIN SI~TANK; SI~SI+8; DS~CODE WDS;%                 14692000
                        SI~LOC T; DS~WDS;%                              14693000
                  END;%                                                 14694000
                  INFO~MEMORY[INFO+ROW].[18:15];%                       14695000
            END;%                                                       14696000
                   GO TO INITIATE;     ::                               14697000
READLABEL:  FIB~M[(TANK~P(.TANK,LOD).[33:15])-3];%                      14698000
            LOC~FIB[15].[25:5];%                                        14699000
            BLASTQ(LOC);%                                               14700000
            P(WAITIO((FIB[5].[44:1]|(M[TANK-2].[8:10]-1) INX M[TANK-2]) 14701000
                      &M[TANK][21:21:4],@37700000,LOC),DEL);            14702000
            STREAM(Y:=0:X:=0,X1:=0,X2:=0,Z:=M[TANK-2]);                 14702025
              BEGIN  DI:=LOC X; DS:=24 LIT "VOL1HDR1HDR2EOF1EOF2EOV1";  14702050
                     DI:=LOC X;                                         14702100
                     6(TALLY:=TALLY+1;                                  14702150
                     SI:=Z;                                             14702200
                     IF 4 SC=DC THEN                                    14702250
                     JUMP OUT TO A);                                    14702300
                     TALLY:=0;                                          14702350
              A:                                                        14702400
                     Y:=TALLY;                                          14702450
              END;                                                      14702500
            IF (USASI:=P)>0 THEN                                        14702550
            USASITAPE(M[TANK-2].[CF],USASI,3,LOC,FIB[5].[44:1]);        14702600
            P(WAITIO([M[5]]&3[23:46:2]&(NOT FIB[5])[22:44:1],           14703000
                     @37700000,LOC),DEL);                               14703100
                   GO TO INITIATE;     ::                               14704000
IOREQ:      FPB~MEMORY[(IF (INFO~NFLAG(MEMORY[P(TANK,DUP,[M],INX,PRL)]))14705000
                       .[22:1] THEN 2 ELSE NOT 1) INX INFO];%           14706000
      IOREQUEST(FINAL,INFO,FPB);%                                       14707000
      MEMORY[TANK]~MEMORY[TANK]&0[26:26:7]&0[19:47:1];%                 14708000
      GO TO INITIATE;%                                                  14709000
::                                                                      14709300
ROTATE:     TANK~P(.TANK,LOD).[33:15];%                                 14710000
      STREAM(T~M[TANK],N~ROW-1,D~TANK);%                                14711000
      BEGIN SI~D; SI~SI+8; DS~N WDS; SI~LOC T; DS~WDS END;%             14712000
IF M[TANK].[3:5]=16 THEN                                                14712100
IF M[TANK].[24:1] THEN                                                  14712200
IF (I~P(M[TANK-3],14,COC))!0 THEN                                       14712300
    BEGIN                                                               14712350
    PHYL ~ TANK INX M;                                                  14712400
    FOR LOC ~ ROW-1 STEP -1 UNTIL 0 DO                                  14712450
         BEGIN                                                          14712500
         IF ( B~M[PHYL[LOC] INX NOT 2])!0 THEN                          14712550
              BEGIN                                                     14712600
              IF (I~I-1) { 0 THEN                                       14712750
                   LOC ~ -1;                                            14712800
              END;                                                      14712850
         END;                                                           14712900
    END;                                                                14712950
      GO TO INITIATE;%                                                  14713000
DISKLOCK:                                                               14713100
END COM11;%                                                             14714000
                                                                        15006000
 PROCEDURE DISPLAY(X); VALUE X; REAL X;%                                15019000
         BEGIN REAL T;                                                  15020000
              STREAM(X:J~JARROW[P1MIX],P1MIX,%                          15021000
                   Y:=T:=SPACE(25));                                    15022000
                   BEGIN DS ~ LIT "#";%                                 15023000
                        2(SI ~ J; SI ~ SI+1; DS ~ 7 CHR; J ~ SI;%       15024000
                   L:        SI ~ SI-1;%                                15025000
                             IF SC = " " THEN%                          15026000
                                  BEGIN DI ~ DI-1; GO TO L END;%        15027000
                             DS ~ LIT "/";);%                           15028000
                        DI ~ DI-1; DS ~ LIT "=";%                       15029000
                   SI~LOC P1MIX; DS~2DEC; P1MIX~DI; DI~DI-2;            15030000
                   DS~FILL; DI~P1MIX; DS~2LIT": ";                      15030500
                        SI ~ X;%                                        15031000
                   H:   4(40(IF SC="~" THEN JUMP OUT 2 TO HH;           15032000
                        DS~CHR)); HH:                                   15033000
                        J ~ DI; DI ~ DI+8; SI ~ J;%                     15034000
                   S:   SI ~ SI-1; IF SC = " " THEN GO TO S;%           15035000
                        SI ~ SI+1; J ~ SI; DI ~ J; DS ~ LIT "~";%       15036000
                        X~DI;                                           15037000
                   END;%                                                15038000
              X~(((X~P).[CF])-T)|8+X.[30:3]-1;                          15039000
              SPOUT(P(X,T));                                            15040000
         END;%                                                          15041000
                                                                        15059000
PROCEDURE  COM13 ;%                                                     15060000
         BEGIN%                                                         15061000
%   COBOL  IO  INTERFACE COMMUNICATE%                                   15062000
         REAL  CODE = -4, REEL = -6 ;%                                  15063000
         NAME  FLOC = -5 ;%                                             15064000
         ARRAY FIB [*];%                                                15065000
         REAL T, COB68;                                                 15066000
         LABEL L4;                                                      15067000
         DEFINE INOUT=FIB[13].[27:1]#,DIREC=FIB[13].[25:1]#,%           15071000
              SORTFILE=FIB[4].[7:1]#,LABELSOMITTED=FIB[4].[2:1]#;%      15072000
         COB68 ~ (FIB ~ *(FLOC)).[8:10] = 22;                           15073000
         IF CODE=4 THEN GO TO L4;                                       15074000
         INOUT~CODE!3;  DIREC~ CODE=2;%                                 15080000
         IF NOT COB68 THEN                                              15080900
         IF FIB[5].[46:2]=3 THEN BEGIN%                                 15081000
         FIB[18].[18:15]~FIB[18].[3:15];%                               15082000
         IF CODE=3 THEN                                                 15082100
         FIB[18].[3:15]~FIB[18].[33:15]+FIB[18].[3:15]; END;%           15083000
         NT1:=FLOC INX 3;                                           %R9015084000
         P(0,STF,PRT[P1MIX,8],STS);                                 %R9015085000
         FILEOPEN(1,NT1);                                           %R9015086000
 $ VOID                                                             %R9015087000
    L4:%                                                                15093000
         CODE ~ IF (CODE~ABS(REEL))=0 THEN 6 ELSE%                      15094000
                   (IF CODE=1 THEN 7 ELSE%                              15095000
              (IF CODE=2 THEN 10 ELSE%                                  15096000
              (IF CODE=4 THEN @22 ELSE                         %KRUNCH  15097000
              (IF CODE=64 THEN @52 ELSE 0))));                 %KRUNCH  15097500
         IF (T~FIB[4].[8:4])!2 AND T!4 AND T!8 THEN CODE~0;%            15098000
         IF T=4 AND  CODE=0 THEN CODE~10  ;%                            15099000
         FILECLOSE(( FLOC INX 3 )& CODE[18:33:15]);%                    15100000
         IF CODE=0 OR CODE=10 OR CODE=@22 THEN FIB[5].[42:1]~1          15101000
              ELSE FIB[5].[40:2]~(CODE=7)|2+1;%                         15102000
         IF NOT COB68 THEN                                              15102900
         IF FIB[5].[46:2]=3 THEN BEGIN%                                 15103000
         FIB[18].[3:15]~FIB[18].[18:15];FIB[18].[18:15]~0 END;%         15104000
         GO TO INITIATE;%                                               15105000
         END  COM13;%                                                   15106000
PROCEDURE WHATSIT(BUFH); VALUE BUFH; REAL BUFH;                     %DS%15106500
    BEGIN                                                               15107000
    REAL BF,I,LINE;                                                     15107500
    ARRAY INF[*];                                                       15108000
     REAL MIX, RCW=+0;                                              %DS%15108100
    LABEL NOONE,EXIT,EDD,GOTIT,OK;                                      15108500
    BOOLEAN GETBUFF;                                                    15109000
    BOOLEAN SUBROUTINE SPOUTLINE;                                       15109500
         BEGIN                                                          15110000
         SYSDISKIO(1,LINE,INF);                                         15110500
         P(0);                                                          15111000
         IF (INF[0]:=STATABLE[ABS(LINE)]).DIALEDUP THEN                 15111100
         IF INF[1] GTR 0 THEN GO TO OK ELSE GO TO NOONE ELSE            15111200
         IF SCH(INF) THEN                                               15111300
              BEGIN                                                     15111400
    NOONE:    INF[1]:="NOBODY ";                                        15111500
    OK:       P(DEL,1);                                                 15111600
              IF GETBUFF THEN                                           15112000
                   BF~ GETSPACE(5,0,0)+2;                               15112500
              GETBUFF~ TRUE;                                            15113000
              STREAM(S:=SCHEDLINE[ABS(LINE)], U:=INF[1], L:=ABS(LINE),  15113500
$INCLUDE 15113601, IF DCP;                                              15113599
                LN:=INF[0].[24:8], ST:=INF[0].[32:8],                   15113600
                BF);                                                    15113700
                   BEGIN                                                15114000
                   SI~LOC U; SI~SI+1; DS~LIT" ";                        15114500
                   DS~7 CHR; DS~4 LIT " ON ";                           15115000
                   U:=DI; DS:=3 DEC;                                    15115100
$INCLUDE 15115501, IF DCP;                                              15115199
                   DS:=2 LIT"-(";                                       15115200
                   S(DS:=5 LIT"SCHED"; JUMP OUT TO LL);                 15115300
                   S:=DI; DI:=LOC L;                                    15115320
                   DS:=3 DEC; DS:=3 DEC; DS:=LIT"A";                    15115340
                   SI:=LOC L; DI:=S;                                    15115360
              LL2: IF SC="0" THEN                                       15115380
                   BEGIN SI:=SI+1;                                      15115400
                        IF SC!"0" THEN DS:=2 CHR ELSE                   15115420
                        BEGIN SI:=SI+1; DS:=CHR END                     15115440
                   END ELSE DS:=3 CHR;                                  15115460
                   IF SC GEQ "0" THEN BEGIN DS:=LIT"/"; GO TO LL2 END;  15115480
              LL:  DS:=2 LIT")~";                                       15115500
$OMIT 15115701, IF DCP;                                                 15115599
                   S(DS:=8 LIT"-(SCHED)");                              15115600
                   DS:=LIT"~";                                          15115700
                   DI:=U; DS:=2 FILL;                                   15116000
                   END;                                                 15116500
              SPOUT(BF);                                                15117000
              END;                                                      15117500
         SPOUTLINE~ P;                                                  15117550
         END;                                                           15118000
    BF~ BUFH.[15:15]-1;                                                 15118500
     MIX := BUFH.[9:6];                                             %DS%15118600
    IF MIX>0 THEN                 %<MIX> WU                             15119500
         BEGIN                                                          15120000
         FOR LINE := 1 STEP 1 UNTIL STATIONMAX DO                       15120500
              IF STATABLE[LINE].MIXNR=MIX THEN                          15121000
                   GO GOTIT;                                            15121500
         LINE~ -1;                                                      15122000
GOTIT:                                                                  15122490
         STREAM(T~PUTORTAKE(MIX,[USERCODE[MIX]],1,0),V~PUTORTAKE(MIX,   15122500
                   [JAR[MIX,0]],1,0),W~PUTORTAKE(MIX,[JAR[MIX,1]],1,0), 15123000
                   X:=MIX, Y:=LINE,                                     15123500
$INCLUDE 15123601, IF DCP;                                              15123599
                   L:=(I:=STATABLE[ABS(LINE)]).[24:8], ST:=I.[32:8],    15123600
                   S:=SCHEDLINE[ABS(LINE)], Z:=LINE GTR 0, BF);         15123700
              BEGIN                                                     15124000
              SI~LOC T; SI~SI+1; DS~LIT " ";                            15124500
              DS~ 7 CHR; DS~ LIT " "; SI~ SI+1; DS~ 7 LIT " USING ";    15125000
              DS~ 7 CHR; DS~ LIT "/"; SI~ SI+1; DS~ 7 CHR; DS~ LIT "="; 15125500
              DS~2 DEC; X~DI; DS~LIT"~"; DI~DI-3; DS~FILL; DI~X;        15126000
              Z(DS:=4 LIT" ON "; X:=DI; DS:=3 DEC;                      15126500
$OMIT 15126601, IF DCP;                                                 15126599
                   S(DS:=8 LIT"-(SCHED)"); DS:=LIT"~";                  15126600
$INCLUDE 15127001, IF DCP;                                              15126699
                   DS:=2 LIT"-(";                                       15126700
                   S(DS:=5 LIT"SCHED"; JUMP OUT TO LL);                 15126800
                   X:=DI; DI:=LOC Y;                                    15126820
                   DS:=3 DEC; DS:=3 DEC; DS:=LIT"A";                    15126840
                   SI:=LOC Y; DI:=X;                                    15126860
              LL2: IF SC="0" THEN                                       15126880
                   BEGIN SI:=SI+1;                                      15126900
                        IF SC!"0" THEN DS:=2 CHR ELSE                   15126920
                        BEGIN SI:=SI+1; DS:=CHR END                     15126940
                   END ELSE DS:=3 CHR;                                  15126960
                   IF SC GEQ "0" THEN BEGIN DS:=LIT"/"; GO TO LL2 END;  15126980
              LL:  DS:=2 LIT")~";                                       15127000
                   DI:=X; DS:=2 FILL);                                  15127100
              END;                                                      15127500
         SPOUT(BF);                                                     15128000
         GO EXIT;                                                       15128500
         END;                                                           15129000
    STREAM(L~0:Z~BUFH);                                                 15129500
         BEGIN                                                          15130000
         SI~ Z;    DI~ LOC L;                                           15130500
    DD:  IF SC=" " THEN BEGIN SI~ SI+1; GO DD END;                      15131000
         IF SC}0 THEN IF SC{9 THEN                                      15131500
              BEGIN                                                     15132000
              Z~ SI; SI~ SI+1;                                          15132500
              IF SC}0 THEN IF SC{9 THEN                                 15133000
                   BEGIN  SI~ Z;  DS~ 2 OCT; GO EGRESS END;             15133500
              SI~ Z;  DS~ OCT;  GO EGRESS;                              15134000
              END;                                                      15134500
         DS~ 8 LIT "+0000001";                                          15135000
EGRESS:  END;                                                           15135500
    IF (LINE:=P) GTR STATIONMAX OR LINE=0 THEN                          15136000
         BEGIN                                                          15136500
         SPOUT(BF);  GO EXIT;                                           15137000
         END;                                                           15137500
                                                                        15138000
    INF~ [M[GETSPACE(SYSDISKRL,0,0)+2]]&SYSDISKRL[8:38:10];             15138500
    IF LINE>0 THEN                %WU <LINE>                            15139000
         BEGIN                                                          15139500
         LINE~ NABS(LINE);                                              15140000
         IF NOT SPOUTLINE THEN                                          15140500
              BEGIN;                                                    15141000
              STREAM(L:=ABS(LINE),C:=INF[0].DIALEDUP,B:=BF);            15141500
                   BEGIN                                                15142000
                   SI~LOC L; DS~LIT" "; DS~3 DEC;                       15142500
                   C(DS~ 15 LIT " NOT DIALED-UP~"; JUMP OUT TO X);      15143000
                   DS~ 12 LIT " NOT IN USE~";                           15143500
              X:   DI~B; DS~3 FILL;                                     15144000
                   END;                                                 15144500
              SPOUT(BF);                                                15145000
              END;                                                      15145500
         GO EDD;                                                        15145550
         END;                                                           15146000
    I~ 0;                         %WU                                   15146500
    FOR LINE:=0 STEP 1 UNTIL STATIONMAX DO                              15147000
         I~ I+SPOUTLINE;                                                15147500
    SYSDISKIO(1,STATIONMAX+1,INF);                                      15147600
    IF I=0 THEN                                                         15148000
         BEGIN;                                                         15148500
         STREAM(BF); DS~9 LIT" NULL WU~";                               15149000
         SPOUT(BF);                                                     15150000
         END;                                                           15150500
EDD:FORGETSPACE(INF);                                                   15151000
EXIT:                                                                   15151500
          KILL([RCW] INX NOT 2);                                    %DS%15151600
    END;                                                                15152000
 BOOLEAN PROCEDURE CONQUER(C,N,L,S,G);                                  15168000
 VALUE C,N,L,S,G;                                                       15168100
         REAL C,N,L; ARRAY S[*];%                                       15169000
 INTEGER G;                                                             15169100
         BEGIN ARRAY B=C[*];%                                           15170000
              REAL T,I=T;%                                              15171000
              LABEL X,Y;                                                15172000
              IF PRT[P1MIX,0]!@2525252525252525 THEN GO STACKOVERFLOW;  15172100
              WHILE L<0 DO                                              15172300
              IF MEMROW[P1MIX].[CF]}FENCE THEN                          15172400
              BEGIN NT1~M[MEM[P1MIX,AVAIL]];                            15172500
                   NT2~0;                                               15172600
                   WHILE (NT1~M[NT1]).[FF]!@77777 DO                    15172700
                        NT2~NT1.[FF]+NT2;                               15172710
                   IF -N|L|1.1<NT2 THEN GO TO Y;                        15172800
                   IF CANTEXPAND[P1MIX] THEN GO TO Y;                   15172810
                   EXPAND[P1MIX]~3;                                     15172900
                   SWAP(FORCESWAP,1);                                   15173000
                   IF TERMSET(P1MIX) THEN P(XIT);                   %10115173050
              END ELSE L~ABS(L);                                        15173100
         Y:    IF G THEN IF(L~ABS(L))|N>512 THEN GO TO X;               15173200
              IF (T ~ GETSPACE(N|L,2,3)) = 0 THEN%                      15174000
                   BEGIN IF NOT G THEN P(0,RTN);                        15175000
              X:   IF NOT N THEN                                        15175900
                             BEGIN G~CONQUER(C,N~N DIV 2,L,N INX S,1);  15176000
                                   G~CONQUER(S INX N,N,L,S,1);          15177000
                                   P(1,RTN);                            15177800
                                  P(XIT);%                              15178000
                             END;%                                      15179000
                        T ~ GETSPACE(L,2,1);%                           15180000
                   END;%                                                15181000
              B ~ [M[T+2]]&L[8:38:10]&C[18:33:15];%                     15182000
              N ~ N-1;%                                                 15183000
              FOR I ~ 0 STEP 1 UNTIL N DO%                              15184000
                   BEGIN S[I]~P(DUP)&P(B,XCH)[CTF];                     15185000
                        B ~ L INX B;%                                   15186000
                   END;%                                                15187000
              CONQUER~1;                                                15187500
         END;%                                                          15188000
 REAL PROCEDURE BATCHSELECT(F,N,B);                                     15200000
         VALUE F,N;                                                     15201000
         REAL F,N,B;                                                    15202000
         BEGIN REAL I,J;                                                15203000
              LABEL L1,L2;                                              15204000
              IF F NEQ 0 THEN                                           15205000
              BEGIN SLEEP([TOGLE],SHEETMASK);                           15206000
                   SHEETFREE:=0;                                        15207000
              END;                                                      15208000
              IF (N:=(64|N-(N NEQ 0)) DIV CHUNKZIZE) GTR                15209000
                   CHUNKMAX THEN N:=CHUNKMAX;                           15210000
              N:=(N=0)+N;                                               15211000
              FOR I:=N STEP 1 UNTIL CHUNKMAX DO                         15212000
              BEGIN FOR J:=0 STEP 1 UNTIL N DO                          15213000
                       IF BATCHED[I-J] THEN GO TO L1;                   15214000
                   B:=-B&(64|N+I)[CTF];                                 15215000
                   GO TO L2;                                            15215100
    L1:       END;                                                      15216000
              BATCHSELECT := TRUE;                                      15216100
              SHEETFREE:=F NEQ 0;                                       15217000
    L2:  END;                                                           15218000
 BOOLEAN PROCEDURE PRTGAMES(BUFF,MIX); VALUE BUFF,MIX; REAL BUFF,MIX;   15400000
    COMMENT PRTGAMES IS THE BUSINESS END OF "IN" OR "OT" MESSAGES;      15401000
         BEGIN REAL NX,INDEX,DATA,T,J;                                  15402000
         LABEL ECH, X;;;                                                15403000
         STREAM(BUFF,F~BUFF<0,D~[DATA],I~[INDEX]);                      15404000
         BEGIN SI~BUFF;                                                 15405000
         L:   IF SC=" " THEN BEGIN SI~SI+1; GO L END;                   15406000
              4(IF SC!" " THEN IF SC!"~" THEN IF SC!"=" THEN            15407000
                BEGIN TALLY~TALLY+1; SI~SI+1 END);                      15408000
              I~TALLY; DI~DI+8; DI~DI-I; SI~SI-I; DS~I CHR;             15409000
              F(                                                        15410000
         M:     IF SC=" " THEN BEGIN SI~SI+1; GO M END;                 15411000
                IF SC!"=" THEN BEGIN E:DI~DI-1;DS~LIT""";JUMP OUT END;  15412000
                SI~SI+1;                                                15413000
         N:     IF SC=" " THEN BEGIN SI~SI+1; GO N END; TALLY~0;        15414000
                8(IF SC}"0" THEN BEGIN TALLY~TALLY+1; SI~SI+1 END       15415000
                  ELSE JUMP OUT); IF SC!" " THEN IF SC!"~" THEN GO E;   15416000
                I~TALLY; DI~D; SI~SI-I; DS~I OCT);                      15417000
         END; IF (INDEX AND NOT @1070707)!0 THEN GO ECH;                15418000
         IF JARROW[MIX]=0 THEN GO ECH;                                  15419000
         IF (NX~INDEX.[45:3]&INDEX[42:39:3]&INDEX[39:33:3]&INDEX[38:29:115420000
                                          ]){20 THEN GO ECH;            15421000
         T:=PUTORTAKE(MIX,[PRT[MIX,10]],1&1[2:47:1],0);                 15421200
         IF T=NOT FALSE THEN GO ECH;                                    15421400
         T:=PUTORTAKE(MIX,[M[T.MOM-3]],1&1[2:47:1],0);                  15421600
         IF T=NOT FALSE OR T.[CF] LSS (PRTROW[MIX] INX NX) THEN GO ECH; 15421800
         IF BUFF LSS 0 THEN                                             15422000
         BEGIN                                                          15422200
              P(M[T:=PUTORTAKE(MIX,[PRT[MIX,NX]],2,0)]);                15422400
              FORGETSPACE(T);                                           15422600
              IF P(TOP,XCH,DEL) THEN P(PUTORTAKE(MIX,[PRT[MIX,NX]],     15422800
              0,DATA),DEL) ELSE GO ECH;                                 15423000
         END ELSE                                                       15424000
              BEGIN STREAM(J:=J:=PUTORTAKE(MIX,[JAR[MIX,0]],2,0),MIX,   15425000
                        INDEX,R:=T:=PUTORTAKE(MIX,[PRT[MIX,NX]],2,0),   15426000
                        D~ DATA~ BUFF.[15:15]-1);                       15427000
                   BEGIN SI~J;  SI~SI+1;  DS~LIT" ";%               %WF 15428000
                        DS~7 CHR;  DS~LIT"/";  SI~SI+1;%            %WF 15428100
                        DS~7CHR; DS~LIT"="; SI~LOC MIX; DS~2DEC;        15429000
                        MIX~DI; DI~DI-2; DS~FILL; DI~MIX;               15429500
                        DS~3LIT":R+"; SI~SI+4; DS~4 CHR; D~DI; DI~DI-4; 15430000
                        DS~3 FILL; DI~D; DS~LIT"="; SI~R;               15431000
                        IF SB THEN % DESCRIPTOR:TYPE OCTAL              15432000
                          16(DS~3 RESET; 3(IF SB THEN DS~SET ELSE DS~   15433000
                                           RESET; SKIP SB)) ELSE        15434000
                          DS~8 DEC;                                     15435000
                        DS~LIT"~"; DI~D; DI~DI+1; DS~7 FILL;            15436000
                   END; SPOUT(DATA);                                    15437000
                   FORGETSPACE(T); FORGETSPACE(J);                      15437500
              END; GO X;                                                15438000
    ECH: PRTGAMES~1;                                                    15439000
    X:   END;                                                           15440000
PROCEDURE SPOUTMCP(BUFF); VALUE BUFF; REAL BUFF;                        15500000
    BEGIN REAL X;                                                       15501000
    DISKWAIT(-(X~SPACE(30)),-30,0);                                     15501100
    STREAM(N~X+10+5|SYSNO,A~M[3],BUFF);                                 15501500
    BEGIN SI~N;SI~SI+1;DS~LIT" ";DS~7 CHR;DS~LIT"/";SI~SI+1;DS~7CHR;    15502000
    DS~4 LIT"XIII";     SI:= LOC A ;                               %021-15503000
         IF SC GEQ " " THEN;                                            15503100
         8(IF TOGGLE THEN IF SC="0" THEN SI:=SI+1 ELSE DS:=CHR ELSE     15503200
           DS:=CHR);                                                    15503300
         DS:= 9 LIT" INCLUDES";                                         15504000
$OMIT 15505201, IF DCP;                                                 15504999
         DS:=12 LIT" B487-S FOR ";                                      15505000
$INCLUDE 15505101, IF TWXONLY;                                          15505099
         DS:=15 LIT"TELETYPES ONLY,";                                   15505100
$OMIT 15505201, IF TWXONLY;                                             15505199
         DS:=11 LIT"EVERYTHING,";                                       15505200
$INCLUDE 15505301, IF DCP;                                              15505299
         DS:=5 LIT" DCP,";                                              15505300
$INCLUDE 15510001, IF DFX;                                          %DFX15509000
         DS ~ 4 LIT "DFX,";                                         %DFX15510000
$INCLUDE 15515001, IF DUMP OR DEBUGGING;                                15514999
         DS:=5 LIT"DUMP,";                                              15515000
$INCLUDE 15516001, IF DEBUGGING;                                        15515999
         DS ~ 11 LIT " DEBUGGING,";                                     15516000
$INCLUDE 15517001, IF CHECKLINK OR DEBUGGING;                           15516999
         DS:=10 LIT"CHECKLINK,";                                        15517000
$INCLUDE 15518001, IF SAVERESULTS OR DEBUGGING;                         15517999
         DS:=12 LIT"SAVERESULTS,";                                      15518000
$ INCLUDE 15519001, IF SHAREDISK;                                       15518999
         DS~10 LIT"SHAREDISK,";                                         15519000
$INCLUDE 15520001, IF STATISTICS;                                       15519999
         DS:=11LIT"STATISTICS,";                                        15520000
$INCLUDE 15520401, IF B6500LOAD;                                        15520300
          DS~10 LIT "B6500LOAD,";                                       15520400
         DI ~ DI-1;                                                     15523000
         DS ~ LIT "~";                                                  15524000
         END;                                                           15531100
    SPOUT(BUFF);                                                        15532000
    FORGETSPACE(X);                                                     15532100
    END SPOUTMCP;                                                       15533000
PROCEDURE WHATINTRNSIC(BUFF); VALUE BUFF; REAL BUFF;                    15534000
    BEGIN                                                               15535000
    REAL SIZE, LOC, DISKADDR,WI;                                        15536000
    LABEL EXIT;                                                         15537000
    IF INTSIZE=0 THEN                                                   15539000
         BEGIN     ;                                                    15540000
         STREAM(BUFF);  DS~14 LIT "NO INTRINSICS~";                     15541000
         GO EXIT;                                                       15542000
         END;                                                           15543000
    COMMENT MAKE WI INTRINSIC PRESENT;                                  15544000
    SIZE~ P(INTRNSC[INTRNSC[0]],DUP) INX 0;                             15545000
    DISKADDR~ P.[6:27];                                                 15546000
    LOC:=SPACE(SIZE);                                                   15547000
    DISKWAIT(-LOC,SIZE,DISKADDR);                                       15548000
    COMMENT BUILD A PROGRAM DESCRIPTOR POINTING TO SEGMENT;             15549000
    WI~ NABS([M[LOC]]&@5[3:45:3]);                                      15550000
    P(MKS,BUFF,WI);                                                     15551000
    SPOUT(BUFF);                                                        15551500
    FORGETSPACE(LOC);                                                   15552000
    DISKWAIT(-(SIZE~SPACE(30)),-30,0);                                  15552100
    STREAM(X~SIZE+13+5|SYSNO,Y~0,BUFF);                                 15552200
    BEGIN                                                               15552300
    SI~BUFF;SI~SI+15;60(IF SC!"~" THEN SI~SI+1 ELSE JUMP OUT);          15552400
    Y~SI;SI~X;DI~Y;DS~3 LIT"  (";SI~SI+1;DS~7 CHR;DS~LIT"/";            15552500
    SI~SI+1;DS~7 CHR;DS~ 2 LIT ")~";                                    15552600
    END;                                                                15552700
    FORGETSPACE(SIZE);                                                  15552800
EXIT:                                                                   15554000
    END WHATINTRNSIC;                                                   15555000
 REAL PROCEDURE KEYIN(B); VALUE B; BOOLEAN B;%                          16000000
    BEGIN REAL RCW=+0;%                                                 16001000
         REAL BUFF = RCW +2;%                                           16002000
         ARRAY BUFA =BUFF [*];                                          16002100
         REAL TYPE=BUFF+1;%                                             16003000
         REAL KTR=TYPE+1;%                                              16004000
    LABEL ERROR,EXIT,PG,MX,DD,RW,PD,DB,DP,DT,   DS,TR,RS,EI;%           16005000
         LABEL START,OL,LN,WD,WT,TIR;                                   16005500
         LABEL CC,PT,TX,RXIT,REX;%                                      16006000
              LABEL FORGET,DSR,ILR,OUR,OKR,FMR,AXR,RY;%                 16007000
              LABEL FR,OF,WY,RM;%                                       16008000
         LABEL PR,INR,OTR,CUTY;                                      %P 16008100
         LABEL SV,LD,CD,RD,RN;                                          16009000
         LABEL TF,SF,TS,PS,XS,ES;                                       16009100
         LABEL EX, COUT;                                                16009200
         LABEL PI,CL;                                                   16009300
                   LABEL ESS, SS,SM,HR,BS,US,SC;%                       16009400
         LABEL PGA;                                                 %WB 16009500
         LABEL CTR,XTR,TLR;%                                        %WF 16009600
         LABEL BO,LF,LC,LS;                                             16009700
         LABEL MF,MR,XD;                                                16009800
         LABEL RYX,SVX,RYW;                                         %JFM16009900
         LABEL RO,TZ,ED,SUSPENDER;                                   %ST16010000
         LABEL RR,QVE,WP,WU;                                            16010100
         LABEL CI,LR,RP,WM;                                             16010200
         LABEL SY,SI,DC;                                                16010250
         LABEL WI,CM,SWITCHIT,BK,MC;                                    16010300
              SWITCH  SR ~ ERROR,DSR,ILR,OUR,OKR,FMR,AXR,FR,OF,         16011000
                           TIR,WY,RM,ILR,SUSPENDER,INR,OTR,CUTY,        16012000
                           PR,PS,XS,ES,SM,HR,CTR,XTR,TLR,SS,WU,WP       16013000
                           ,DP,BK,TS                                    16013100
                   ;                                                    16013990
              SWITCH  S  ~ ERROR,PG,MX,DD,RW,PD,DB,DP,DT,DS,TR,RS,EI,   16014000
                           CC,PT,RY,TX,OL,LN,WD,WT,LR,RO,RO,TZ,SV,      16015000
                           LD,CD,RD,RN,ED,CI,TF,SF,TS,RR,QVE,%          16016000
                                     EX,PI,ESS,ESS,SS,SM,BS,US,SC%      16017000
                           ,BO,WP,MF,WU,LF,LC,LS,CM,RP,WM               16020070
                           ,CL,CL,BK,MR                                 16020090
                           ,WI,SY,SI,XD,DC                              16020100
                          ,MC                                           16020110
                   ;%                                                   16021000
         REAL I=KTR+1,HN1=I+1,HN2=HN1+1;%                               16022000
         REAL A=HN2+1;                                              %WB 16022100
         REAL MASK=A;                                                   16022200
         NAME ADDR=MASK+1;                                              16022300
         REAL MIX=I;%                                                   16023000
         INTEGER INT=I;%                                                16024000
         REAL TOG =ADDR+1;                                              16025000
                                                                        16026000
         P(0,0,0,0,0,0,0,0,0);%                                         16027000
         P(0);                                                          16027100
    IF B = 0 THEN   %WAIT TO GET EXCLUSIVE CONTROL OF KEYIN STACK       16027200
    BEGIN                                                               16027210
         IF KEYBOARDCOUNTER NEQ 0 THEN                                  16027220
         COMPLEXSLEEP(KEYBOARDCOUNTER=0);                               16027240
         KEYBOARDCOUNTER:=KEYBOARDCOUNTER&1[17:47:1];                   16027260
         IF SPOWORD LSS 0 THEN  %GET INPUT FROM BACK UP SPO             16027270
         BEGIN                                                          16027280
              STREAM(MIX:=MIX:=[KTR].[CF]);  %SEND A QUEST MARK         16027290
              BEGIN DS:=LIT"!"; DS:=LIT MARK END;                       16027300
              TWXOUT(MIX,2,-0,ABS(SPOWORD));                            16027320
              IF  KEYBOARDCOUNTER.[FF]=0 THEN %WAIT FOR INPUT           16027330
              SLEEP([KEYBOARDCOUNTER],@7777700000);                     16027340
              B:=0&KEYBOARDCOUNTER[FTF];                                16027370
              KEYBOARDCOUNTER:=KEYBOARDCOUNTER&M[B.[FF]-2][CTF];        16027380
         END ELSE KEYBOARDCOUNTER:=KEYBOARDCOUNTER INX  1;              16027390
    END;                                                                16027400
 START::%                                                               16028000
    IF ABS(B) > 1 THEN                                                  16028050
         BUFF ~ B.[18:15]                                               16028100
    ELSE                                                                16028150
         BEGIN                                                          16028200
         BUFF := SPACE(60)+1;                                           16029000
         P(WAITIO(BUFF&1[24:47:1],0,25),DEL);%                          16030000
         MAKELOG(BUFF-1,SPIN);                                          16030010
         END;                                                           16030050
    M[BUFF-2] ~ 0&B[9:9:9];                                             16030100
              STREAM(MIX~63,BUFF:A~0);                                  16031000
              BEGIN SI~BUFF;DI~BUFF;DI~DI-1;DS~LIT"<";                  16031100
                   8(60(IF SC="~" THEN BEGIN DS~CHR;                    16031200
                   JUMP OUT 2 TO L END; IF SC="<" THEN                  16031300
                   BEGIN DI~DI-1;IF SC!DC THEN DI~DI-1 END              16031400
                   ELSE DS~CHR));                                       16031500
              L:   SI~BUFF; DI~LOC MIX;                                 16032000
              L1:   IF SC = " " THEN BEGIN SI~SI+1; GO TO L1 END;       16033000
                   IF SC="~" THEN BEGIN MIX:=SI; GO TO XXIT; END;       16033500
                    IF SC < "0" THEN GO TO XXIT;                        16034000
                    IF SC > "9" THEN                                    16035000
                         BEGIN SI~SI+1; SKIP DB; DS~SET; GO TO XXIT END;16036000
                    SI~SI+1;                                            16037000
                    IF SC < "0" THEN GO TO ONEDIG;                      16038000
                    IF SC { "9"                                         16039000
                      THEN         BEGIN SI~SI-1; DS~2 OCT; END         16040000
                      ELSE ONEDIG: BEGIN SI~SI-1; DS~1 OCT; END;        16041000
              XXIT: DI~BUFF; DI~DI-8; DS~8 LIT "INV KBD "; BUFF~SI;     16042000
              END STREAM;                                               16043000
              IF P(.KTR,~,.MIX,SND) GTR @777 THEN                       16044000
              BEGIN KEYIN:=TRUE; GO TO FORGET; END;                     16044500
              IF MIX = (-63) THEN GO TO CC;                             16045000
              IF MIX ! 63 THEN BEGIN  MIXMSGS; HN1:=P( .MIXMSGS) END    16046000
                          ELSE BEGIN INFOMSGS; HN1:=P(.INFOMSGS) END;   16047000
              STREAM(T~0,DICT~*HN1 INX 1,W~0:BUFF~KTR);                 16051000
              BEGIN SI ~ BUFF;%                                         16052000
              L:   IF SC = " " THEN BEGIN SI ~ SI+1; GO TO L END;%      16053000
                   IF SC = "~" THEN GO TO E;%                           16054000
                   SI ~ SI+2; T ~ SI;%                                  16055000
                   SI ~ DICT; DI ~ T;%                                  16056000
                   DICT:=TALLY; % DICT:=0                               16056100
              R:   SI:=SI+6; T:=DI; DI:=DICT;                           16057000
                   DI:=DI+8; DICT:=DI; DI:=T; DI:=DI-2;                 16057100
                   IF SC = "~" THEN GO TO E;%                           16058000
                   IF 2 SC ! DC THEN GO TO R;%                          16059000
              Q:   SI:=SI-3; DI:=LOC W; DI:=DI+7; DS:=CHR;              16060000
                   GO TO X;%                                            16061000
              E:   TALLY:=0; DICT:=TALLY; GO TO Q;                      16062000
              X:END;%                                                   16063000
              P(.HN1,~,.TYPE,~,BUFF&P[15:33:15],.KTR,~);                16064000
              IF TYPE = 0 THEN GO TO ERROR;                             16064050
         IF (HN1=1) OR (HN1=2) THEN    % I.E., IF A MIX IS REQD         16064100
              IF MIX > MIXMAX  THEN GO TO ERROR;                        16064150
         MASK:=0;                                                       16064700
         IF HN1=0 THEN GO TO S[TYPE]; % NO MIX NUMBER BEFORE MESSAGE    16065000
         IF HN1=3 THEN GO SWITCHIT;                                     16066000
                                                                        16067000
         IF JAR[MIX,*]=0 THEN GO TO ERROR;                              16067100
         IF HN1=2 THEN GO SWITCHIT; % MIX NUMBER, JOB NOT REQUIRED      16067200
                                       % TO BE WAITING FOR MESSAGE      16067300
                                                                        16067400
% MAKE SURE JOB IS WAITING FOR THIS MESSAGE                             16067500
         HN1 ~ REPLY[MIX];%                                             16068000
    REX: IF HN1}0 THEN IF TYPE!10 THEN GO TO ERROR ELSE%                16069000
              BEGIN M[BUFF-1] ~ FLAG(-58934319539&MIX[6:42:6]);%        16069100
                   M[BUFF]~0&799[1:37:11]; GO TO ERROR END;%            16069200
         IF HN1.[42:6] ! TYPE THEN%                                     16070000
              BEGIN HN1 ~ -HN1.[6:36];%                                 16071000
                   GO TO REX;%                                          16072000
              END;%                                                     16073000
SWITCHIT: GO TO SR[TYPE];%                                              16074000
     BO:RP:HR:                                                          16074900
    ERROR:SPOUT(BUFF-1);                                                16075000
         KEYIN ~ TRUE;%                                                 16076000
         GO TO EXIT;%                                                   16077000
    PG:  STREAM(Y~KTR);                                             %WB 16077100
              BEGIN SI~Y;                                           %WB 16077200
         LA:  IF SC!"~" THEN BEGIN SI~SI+1; DI~DI+1; GO TO LA END   %WB 16077300
                        ELSE DS~ 4LIT"~~~~";                        %WB 16077400
              END;                                                  %WB 16077500
    PGA: STREAM(Y:=0, KTR: A:=A:=SPACE(12)+1);                          16078000
              BEGIN SI~KTR;                                         %WB 16078100
         L:   IF SC=" " THEN BEGIN SI~SI+1; GO TO L END ELSE        %WB 16078200
              IF SC="~" THEN TALLY ~ 1 ELSE                         %WB 16078300
              IF SC="0" THEN TALLY ~ 1 ELSE                         %WB 16078350
              BEGIN DS:= 3 CHR; IF SC="-" THEN                          16078400
                BEGIN DS:=CHR; LL: IF SC=" " THEN                       16078410
                                   BEGIN SI~SI+1; GO TO LL END;         16078415
                5(IF SC GEQ 0 THEN DS:=CHR ELSE JUMP OUT;);             16078420
                END;                                                    16078430
              DS:=LIT "~"; KTR:=SI;                                     16078440
              END;                                                      16078450
              Y~ TALLY;                                             %WB 16078500
              END;                                                  %WB 16078600
         IF P(.KTR,~) THEN BEGIN FORGETSPACE(A-1); GO TO FORGET END;%WB 16078700
         M[A-2] ~ 0&B[9:9:9];                                           16078750
         A~A&A[15:33:15];                                           %WB 16078800
         TAPEPURGE(A); GO TO PGA;                                   %WB 16079000
     MX:  FORK(P(.MIXPRINT),(BUFF-1),0,128,1);                      %DS%16080000
         GO TO EXIT;%                                                   16081000
    PT:  PRINTBACKUP(KTR);%                                             16082000
         GO TO EXIT;%                                                   16083000
    DD:%                                                                16084000
$ INCLUDE 16086002, IF DEBUGGING;                                       16084999
         DDT;%                                                          16085000
         GO TO FORGET;%                                                 16086000
$ OMIT 16086501, IF DEBUGGING;                                          16086001
         GO TO ERROR;%                                                  16086500
    RW:  REWINDANDLOCK(KTR);%                                           16087000
         GO TO EXIT;%                                                   16088000
    LF:  MASK:=3; GO TO PD;                                             16088900
    LC:  MASK:=2; GO TO PD;                                             16088910
    LS:  MASK:=4; GO TO PD;                                             16088920
    EX:  KTR:= -KTR;MASK:=1;                                            16088930
     PD:  FORK(P(.PRINTDIRECTORY),(KTR&MASK[9:42:6]),0,128,1);      %DS%16089000
         GO TO EXIT;%                                                   16090000
    BK:  IF (HN2:= MESSAGEHOLDER.[CF]) NEQ 0 THEN                       16090050
         BEGIN TOG:=HN1;                                                16090090
             IF (HN1:= M[HN2].[FF]) NEQ 0 THEN                          16090100
                 DO BEGIN                                               16090200
                    A:=M[HN1];                                          16090250
                    IF(A.[4:5]=0 AND TOG=0) OR                          16090270
                      (A.[4:5]=MIX AND TOG=3) THEN                      16090280
                           BEGIN                                        16090300
                           M[HN2]:=P(DUP,LOD)&A[18:18:15];              16090350
                           NUMESS:=NUMESS-1;                            16090400
                           FORGETSPACE(HN1+1);                          16090450
                           END                                          16090500
                      ELSE                                              16090550
                           HN2:=HN1;                                    16090650
                       END                                              16090750
                 UNTIL (HN1:=A.[FF])=0;                                 16090800
                 MESSAGEHOLDER.[FF]:=HN2;                               16090850
         END;                                                           16090855
         IF SPOWORD LSS 0 THEN %GO CLEAN OUT TANK                       16090860
         BEGIN IF STATABLE[I:=ABS(SPOWORD)].OUTPUTANKING THEN           16090865
              BEGIN WHILE NOT (HN1:=TANKS[I]).[1:1] DO                  16090870
                   SLEEP([TANKS[I]],-0);                                16090875
                   STATABLE[I].OUTPUTANKING:=0;                         16090880
                   IF HN1.[2:8] ! 0 OR TAILOUT = I THEN                 16090885
                   BEGIN A:=0;                                          16090890
                        DO HN2:=A UNTIL (A:=TANKS[A].[2:8])=I;          16090895
                        TANKS[HN2]:=(*P(DUP))&HN1[2:2:8];               16090900
                        IF I=TAILOUT THEN TAILOUT:=HN2;                 16090905
              END; END;                                                 16090910
              TANKS[I]:=NABS(0);                                        16090915
$OMIT 16090946, IF TWXONLY OR DCP;                                      16090919
              IF STATABLE[I].STATIONTYPE=TC500 THEN                     16090920
              TNAOG[SEQARRAY[I].[26:6]].[1:13]:=0 ELSE                  16090925
              BEGIN TNAOG[SEQARRAY[I].[26:6]]:=(*P(DUP))&               16090930
                                               P(0,XCH)[14:14:14];      16090935
                   STATABLE[I].[22:2]:=0;                               16090940
              END;                                                      16090945
$INCLUDE 16090951, IF DCP;                                              16090949
              IF NAKSTA[I] THEN TNAOG[I]:=(*P(DUP))&0[1:1:24];          16090950
         END;                                                           16090955
         GO TO FORGET;                                                  16090960
    FMR: RY:  IF (HN2:=FORMESS(KTR,HN1!0)) LSS 0 THEN GO TO FORGET;     16091000
         IF HN2 GTR 31 THEN GO TO ERROR ELSE GO TO RXIT;                16092000
    DB:%                                                                16095000
$ INCLUDE 16097002, IF DEBUGGING;                                       16095999
         DISKBUG;%                                                      16096000
         GO TO FORGET;%                                                 16097000
$ OMIT 16097051, IF DEBUGGING;                                          16097001
         GO TO ERROR;                                                   16097050
CUTY: IF (HN1:=PUTORTAKE(MIX,[JAR[MIX,0]],1,0))!"PRNPBT " AND           16097100
         HN1!"LIBMAIN" THEN GO TO ERROR;                                16097105
         IF PUTORTAKE(MIX,[JAR[MIX,1]],1,0)!"DISK   " THEN GO ERROR;    16097110
         REPLY[MIX]~TYPE;                                               16097120
         BRINGBACK(MIX);                                                16097150
         PRT[MIX,@25]~5; GO FORGET;                                     16097200
                                                                        16097500
    LD:  STARTLOADN(KTR);%                                              16098000
         GO TO EXIT;%                                                   16099000
    CD: TABLEOFCONTENTS(KTR);                                           16100000
         GO TO FORGET;%                                                 16101000
    RD:  DECKREMOVER(KTR);%                                             16102000
         GO TO EXIT;%                                                   16103000
    RN:  RUNTHEDECK(KTR);                                               16104000
         GO TO EXIT;%                                                   16105000
    ED:  EXTERNALEND(KTR)     ;                                         16105100
         GO TO EXIT;                                                    16105200
    PR:  CHANGEPRIORITY(KTR,MIX); GO TO EXIT;                           16105300
    OL:  OUTPUTLABEL(KTR);%                                             16106000
         GO TO EXIT;%                                                   16107000
$INCLUDE 16107201, IF DCP;                                              16107099
    DC:  DCPFILECHANGER(KTR);                                           16107100
          GO TO EXIT;                                                   16107200
$OMIT 16107301, IF DCP;                                                 16107299
    DC:  GO TO ERROR;                                                   16107300
    DP:%                                                                16108000
$ INCLUDE 16110201, IF DEBUGGING OR DUMP;                               16108999
         STREAM(A:="LP",KTR:B:="MT");                                %AI16109000
         BEGIN SI := KTR;                                            %AI16109100
         L:    IF SC = " " THEN BEGIN SI:=SI+1; GO TO L END;         %AI16109200
               IF SC = "~" THEN TALLY := 0;                          %AI16109300
               DI := LOC A; DI := DI + 6;                            %AI16109400
               IF 2 SC=DC THEN TALLY := 1;                           %AI16109500
               DI := DI + 22; SI := SI - 2;                          %AI16109600
               IF 2 SC=DC THEN TALLY := 2;                           %AI16109700
               A := TALLY; KTR := SI;                                %AI16109800
         END;                                                        %AI16109900
         IF (A:=P(.KTR,~))=0 THEN GO TO ERROR;                       %AI16110000
                                                                        16110001
         IF A=1 THEN BEGIN PRINTCORE(MIX); GO TO FORGET END;         %AI16110050
         DUMPCORE(KTR&BUFF[15:33:15]);                               %AI16110100
         GO TO EXIT;                                                 %AI16110200
$ OMIT 16110301, IF DUMP OR DEBUGGING;                                  16110299
         GO TO ERROR;                                                   16110300
    MF:  FENCEMOVER(KTR, BUFF);  GO TO EXIT;                            16110500
    OUR: STREAM(A~"LP":B~"MT",C~"DK",D~"CP",KTR);                       16111000
              BEGIN SI ~ KTR;%                                          16112000
              L:   IF SC = " " THEN BEGIN SI ~ SI+1; GO TO L END;%      16113000
              DI ~ LOC A; DI ~ DI+6;%                                   16114000
              IF SC = "~" THEN TALLY ~ 1;%                              16115000
              IF 2 SC = DC THEN TALLY ~ 2; SI ~ SI-2; DI ~ DI+14;%      16116000
              IF 2 SC = DC THEN TALLY ~ 3;%                             16117000
              SI~SI-2; DI~DI+6; IF 2 SC=DC THEN TALLY~4;             %P 16117100
              SI~SI-2; DI~DI+6; IF 2 SC=DC THEN TALLY~5;                16117200
              A ~ TALLY;%                                               16118000
              END;%                                                     16119000
         IF(HN2~P) = 0 THEN GO TO ERROR;%                               16120000
         GO TO RXIT;%                                                   16121000
    MR: XD: IF TYPE=59 THEN KTR.[CF]:=0;                                16121500
         FORK(P(.DKBUSINESS),KTR,0,128,0);                              16121520
         GO TO EXIT;                                                    16121540
    SY:                                                                 16121590
$INCLUDE 16121611, IF STATISTICS;                                       16121599
        FORK(P(.SAVESTATISTICS),0,0,128,0);                             16121600
        GO TO FORGET;                                                   16121610
    SI:                                                                 16121690
$INCLUDE 16121931, IF STATISTICS;                                       16121699
        STREAM(A:=0:KTR);                                               16121700
        BEGIN                                                           16121710
             SI:=KTR; TALLY:=1;                                         16121720
         L1: IF SC=" " THEN BEGIN SI:=SI+1; GO TO L1 END;               16121730
             IF SC="~" THEN GO TO L2;                                   16121740
             IF SC GEQ "0" THEN BEGIN SI:=SI+1;                         16121750
             IF SC GEQ "0" THEN BEGIN                                   16121760
                SI:=SI-1; DI:=LOC A; DS:=2 OCT END                      16121770
             ELSE BEGIN                                                 16121780
                SI:=SI-1; DI:=LOC A; DS:= OCT END; END                  16121785
             ELSE GO TO L2;                                             16121790
             IF SC NEQ "~" THEN BEGIN                                   16121800
         L2: TALLY:=0; A:=TALLY END;                                    16121810
        END;                                                            16121820
        IF (HN1~P)=0 THEN GO TO ERROR;                                  16121830
        INTERVAL:=HN1|3600;                                             16121850
        STREAM(A:=HN1,B:=A:=BUFF-1);                                    16121860
        BEGIN                                                           16121870
             SI:=LOC A; DS:=23LIT"NEW TIMING INTERVAL IS ";             16121880
             DS:=2 DEC; DS:= 9LIT" MINUTES~";                           16121890
        END;                                                            16121900
        SPOUT(A);                                                       16121910
        COUNTARRAY[29]:=XCLOCK;                                         16121920
        GO TO EXIT;                                                     16121930
$OMIT 16121991, IF STATISTICS;                                          16121989
        GO TO ERROR;                                                    16121990
    TIR: TIMEUSED(BUFF-1,MIX);%                                         16122000
         GO TO EXIT;%                                                   16123000
    DT:  SETDATE(KTR);%                                                 16124000
         GO TO EXIT;%                                                   16125000
    TX:  SETIME(KTR);%                                                  16126000
         GO TO EXIT;%                                                   16127000
    SV:  SAVETHEUNIT(KTR);                                              16128000
         GO FORGET;                                                     16129000
    LN:  STREAM(A~0:KTR);                                               16130000
         BEGIN SI~KTR; DI~LOC A; DI~DI+6;                               16130100
              L: IF SC=" " THEN BEGIN SI~SI+1; GO TO L END;             16130110
              DS~2 CHR;                                                 16130120
         END;                                                           16130130
         IF (HN1:=P)="DK" THEN FORK(P(.LOGDISK),0,0,128,0) ELSE         16130200
         IF HN1.[36:6]=@37 THEN FORK(P(.LOGOUT),0,0,128,1) ELSE         16130300
         GO TO ERROR;                                                   16130400
         GO TO FORGET;%                                                 16131000
    LR:  ZIPPER("LOGOUTR","DISK   ");  GO TO FORGET;%                   16131500
    WD:  GIMEDATE(BUFF-1,1);                                            16132000
         GO TO EXIT;%                                                   16133000
    INR: KTR~-KTR;                                                      16133100
    OTR: IF PRTGAMES(KTR,MIX) THEN GO TO ERROR ELSE                     16133200
         IF KTR LSS 0 THEN GO FORGET ELSE GO EXIT;                      16133300
    WT:  TIMEOUT (BUFF-1);%                                             16134000
         GO TO EXIT;%                                                   16135000
    RS:                                                                 16136000
          FORK(P(.LINEMESSAGES),KTR,0,128,1); GO TO EXIT;           %DS%16137000
    BS:US:SPOSET(TYPE=43,KTR);  GO EXIT;                                16138000
SC:      STREAM(SPO~ SPOWORD}0,S~ ABS(SPOWORD),B~ BUFF-1);              16139000
              BEGIN                                                     16140000
              DS~ 18 LIT " SPO CONSOLES ARE:";                          16141000
              SPO(DS~4 LIT "SPO ");                                     16142000
              SI~ LOC S;  DS~ 2 DEC;  DS~ LIT "~";                      16143000
              DI~ DI-3;  DS~ 2 FILL;                                    16144000
              END;                                                      16145000
         GO ERROR;                                                      16146000
MC:      NAMEID(HN1,KTR);                                               16149500
         NAMEID(HN2,KTR);                                               16149510
         NAMEID(HN2,KTR);                                               16149520
         IF(A:=DIRECTORYSEARCH(HN1,HN2,4)) NEQ 0 THEN                   16149540
         BEGIN IF(TOG~DIRECTORYSEARCH(HN1,"DISK   ",5))!0 THEN          16149550
               BEGIN FORGETSPACE(TOG); FORGETSPACE(A);                  16149560
                     LBMESS(-HN1,HN2,"NOT ","MC-ED","(DUP ","FILE)",0); 16149570
               END ELSE                                                 16149580
               BEGIN M[A INX 4]:=(*P(DUP))&2[1:46:2]&1[8:47:1];         16149590
                     ENTERUSERFILE(-HN1,"DISK   ",A INX 0-1);           16149600
                     A:=A&DIRECTORYFREE[18:32:15];                      16149610
                     FORGETSPACE(DIRECTORYSEARCH(HN1,HN2,8));           16149620
                     HEADERUNLOCK(HN1,"DISK   ",A);                     16149640
                      LBMESS(HN1,HN2,"MC-ED:",HN1,"/DISK C","OMPILER",0)16149650
               ;END                                                     16149660
         END ELSE LBMESS(-HN1,HN2,"NOT ","MC-ED","(NOT ON"," DISK)",0); 16149670
         GO TO EXIT;                                                    16149680
EI:M[BUFF-1]~@2531463700000000;                                         16150000
      GO TO ERROR;                                                      16151000
                                                                        16152000
                             DSR: IF JARROW[I]!0 THEN%                  16160000
                                  BEGIN TERMINATE(I&3[18:33:15]);%      16161000
                                            HALT; NOPROCESSTOG ~%       16162000
                                                 NOPROCESSTOG-1;%       16163000
                                            GO TO FORGET;%              16164000
                                  END;%                                 16165000
 DS:     GO TO ERROR;                                                   16166000
    WP:  IF REMOTE THEN BEGIN CALLCANDE(KTR,0);  GO EXIT END;           16166620
    RR:  GO ERROR;                                                      16166630
     WU:  NT1:=P(..WHATSIT);                                            16166700
         FORK(NT1,KTR&(MIX|(MIX!63))[9:42:6],0,128,1);                  16166800
         GO EXIT;                                                       16166900
    QVE:                                                                16167000
         GO TO ERROR;                                                   16167260
    AXR: HN2 ~ BUFF;                                                    16168000
         GO TO RXIT;                                                    16168100
    TR:                                                                 16169000
         STREAM(K:=KTR:=SPACE(7)+2);                                    16169500
                        DS:=35 LIT"CC RUN CANDE/TSHARER;STACK=200;END~";16170000
         GO TO COUT;                                                    16170500
    RO:  CHANGEOPTION(KTR,TYPE=22);                                     16172000
         GO TO EXIT;                                                    16173000
    TZ:  STREAM(A:=0:KTR);   % CHECK IF TYPE OPTION OR FUNNY SS.     %DS16174000
              BEGIN SI := KTR;                                       %DS16174100
                 L: IF SC = " " THEN BEGIN SI:=SI+1; GO TO L END;    %DS16174200
                    IF SC = LEFTARROW THEN % NO MSG INCLUDED.        %DS16174300
                       BEGIN TALLY:=1;  A:=TALLY;  END;              %DS16174400
              END STREAM;                                            %DS16174500
         IF P THEN BEGIN TYPOP; GO TO FORGET; END;                   %DS16174600
         GO TO SS;                                                   %DS16174700
    ILR: IF (HN2 ~ ANVIL(TYPE=2,KTR)) > 35 THEN GO TO ERROR;            16175000
         TYPE ~ 2;%                                                     16176000
         GO TO RXIT;%                                                   16177000
    TF: SF: CHANGEFACTOR(KTR,TYPE=32); GO TO EXIT;                      16177100
    TS: PS: XS: ES: SHEETDIDDLER(KTR,TYPE,MIX); GO TO EXIT;             16177200
WM:SPOUTMCP(BUFF-1); GO EXIT;                                           16177250
    WI:  WHATINTRNSIC(BUFF-1); GO TO EXIT;                              16177260
    PI:: STREAM(BUFF~BUFF~BUFF-1); DS~14 LIT " 3.1415926536~";          16177300
         SPOUT(BUFF); GO TO EXIT;                                       16177400
    ESS: SCHEDLOOK(KTR,TYPE=40); GO EXIT; %ES,XS A TASK                 16177610
    SS:  IF CANDYINX!0 THEN CALLCANDE(KTR,"SS") ELSE                    16177615
          FORK(P(.LINEMESSAGES),KTR,0,128,1); GO EXIT;              %DS%16177620
     SM:  FORK(P(.WHATSGOINGON),(KTR&(INT:=MIX|(MIX NEQ 63))[9:42:6]%DS%16177630
                  ),0,128,1);                                       %DS%16177640
         GO EXIT;                                                       16177670
    CTR: XTR: TLR:  TIMERELAXER(KTR,TYPE,MIX);  GO TO EXIT;%        %WF 16177700
    CI:  IF TYPE=53 THEN KTR ~ -KTR;%  REALLY XI, NOT CI                16177800
         FORK(P(.CHANGEINTRINSICFILE),KTR,-2,128,0);                    16177900
                   GO TO EXIT;                                          16177950
    CM:  FORK(P(.CHANGEMCP),KTR,-2,0,1);                                16177975
         GO TO EXIT;                                                    16177980
    CC:%                                                                16178000
      STREAM(BUFF,A~(KTR~   SPACE(M[BUFF-3].[CF]-BUFF.[CF]+2    )+2));  16179000
              BEGIN         SI~BUFF;%                                   16180000
              IF SC!"~" THEN BEGIN DS ~CHR;%                            16181000
         L:   IF SC!"~" THEN BEGIN IF SC!@14 THEN DS~CHR ELSE SI~SI+1;% 16182000
                GO TO L END END;%                                       16183000
              DS~CHR; END;%                                             16184000
 COUT:   M[KTR-4].[9:6]:=0;                                             16185000
         CCARD(KTR&25[3:43:5]);                                         16185100
              GO TO FORGET;%                                            16186000
    CL:  STREAM(W~0,KTR:);                                              16186020
         BEGIN SI~KTR;                                                  16186030
           L: IF SC=" " THEN BEGIN SI~SI+1; GO TO L END;                16186040
              IF SC}"0" THEN IF SC{"9" THEN TALLY~1;                    16186050
              W~TALLY; KTR~SI;                                          16186060
         END STREAM;                                                    16186070
         KTR~P;                                                         16186080
         IF P THEN BEGIN LINECLEAR(KTR); GO FORGET END;                 16186090
         IF (HN1:=UNITIN(TINU,KTR)) LSS 36 % CHANGE IF MORE PSEUDORDRS  16186100
         THEN IF (MIX~ RDCTABLE[HN1].[8:6])!0 THEN                      16186200
              IF TYPE THEN GO CUTY ELSE GO DSR;                         16186300
$ INCLUDE 16186391, IF SHAREDISK;                                       16186349
         IF HN1 LSS 40 AND HN1 GTR 35 THEN IF NOT TYPE THEN             16186350
         BEGIN                                                          16186360
              IF (HN1:=HN1-36)=SYSNO OR HN1 GEQ SYSMAX THEN GO ERROR;   16186365
              FORK(P(.CLEANOUT),HN1 OR MEMORY,-2,128,0);                16186370
              GO TO FORGET;                                             16186380
         END;                                                           16186390
         IF TYPE OR (HN1>29) THEN GO TO ERROR; %QT OR PSEUDO UNIT       16186400
         LABELTABLE[HN1]:=P(DUP,LOD,SSP);   % MARK IT NOT IN USE        16186500
         HN1:=0;                                                        16186550
         GO TO RY;                                                      16186600
 SUSPENDER: IF-REPLY[  MIX]= @412 OR JARROW[MIX]=0 THEN GO ERROR;    %ST16187000
         IF NOTERMSET(MIX) THEN PRTROW[MIX].[PSF]~2;                    16188000
         GO FORGET;                                                     16189000
  OKR: FR: OF: WY: RM: RXIT:                                         %ST16190000
              REPLY[MIX] ~ TYPE&HN2[18:33:15];%                         16191000
                   BRINGBACK(MIX);                                      16191150
              IF HN2 ! BUFF THEN%                                       16192000
                   BEGIN                                                16192050
    FORGET:STREAM(T:=BUFF-1);DS:=LIT LEFTARROW; SPOUT(BUFF-1);          16193000
                   END;                                                 16193050
    EXIT:%                                                              16194000
         IF ABS(B) LEQ 1 THEN KEYBOARDCOUNTER:=                         16194050
         P((NOT 0) INX KEYBOARDCOUNTER);                                16194100
         IF KEYBOARDCOUNTER&0[17:47:1] GTR 0 THEN                       16194200
         BEGIN                                                          16194300
              IF KEYBOARDCOUNTER.[CF]!0 THEN B:=B&0[CTF] ELSE           16194400
              BEGIN B:=B&KEYBOARDCOUNTER[FTF];                          16194500
                   KEYBOARDCOUNTER:=KEYBOARDCOUNTER&M[B.[FF]-2][CTF];   16194600
              END;                                                      16195000
              GO TO START;                                              16196000
         END;                                                           16196050
         KEYBOARDCOUNTER.[17:1]:=0;                                     16196100
         IF B THEN KILL([B] INX NOT 1);                                 16197000
    END;%                                                               16198000
PROCEDURE LBMESS(FN,SN,A,B,C,D,E);                                      17000000
    VALUE FN,SN,A,B,C,D,E;                                              17001000
    REAL  FN,SN,A,B,C,D,E;                                              17002000
    BEGIN                                                               17003000
         REAL T;                                                        17004000
         IF E=1 THEN REPORTBACK(IGNORE,0,0);                            17005000
         IF LOGLINE.[33:7]=0 OR CANDYMESS THEN                          17006000
      BEGIN  ;                                                          17007000
         STREAM(A~[FN],  T~T~GETSPACE(10,0,0)+2);                       17008000
         BEGIN SI~A;IF SC="+" THEN DS~LIT"." ELSE DS~LIT" ";            17009000
              SI~SI+1;DS~7 CHR;DS~LIT"/";SI~SI+1;                       17010000
              DS:=7 CHR;DS:=LIT" ";16(IF SC="0" THEN SI:=SI+1 ELSE      17011000
              DS:=CHR);IF SC="+" THEN BEGIN SI:=SI+1;DS:=7 CHR;         17012000
              DS:=LIT"/";SI:=SI+1;DS:=7 CHR END ELSE                    17012500
              16(IF SC="0" THEN SI:=SI+1 ELSE DS:=CHR);                 17013000
              SI:=SI+5;IF SC!"0" THEN DS:=3 CHR;DS:=LIT"~";             17014000
         END;                                                           17014500
         SPOUT(T);                                                      17015000
      END;                                                              17016000
    END; % LIBMSG                                                       17017000
 PROCEDURE STOPM;                                                       17900000
    BEGIN INTEGER PROTY; LABEL AROUND; REAL B;                       %ST17901000
         PROTY~PRYOR[P1MIX];                                         %ST17902000
         PRIORTY~PRYOR[P1MIX]~1023;                                     17903000
         IF NOTERMSET(P1MIX) THEN PRTROW[P1MIX].[PSF]~0;                17903500
 AROUND: STREAM(J:=JARROW[P1MIX],P1MIX,B:=B:=SPACE(10));                17904000
         BEGIN DS~13LIT"#OPRTR ST-ED "; SI~J;   SI~SI+1; DS~7 CHR;   %ST17905000
              SI~SI+1; DS~LIT"/"; DS~7 CHR; DS~LIT"=";               %ST17906000
              SI~LOC P1MIX; DS~2DEC; DS~LIT"~"; DI~DI-3; DS~FILL;       17907000
         END; SPOUT(B);                                              %ST17908000
         IF OUTWAIT(FALSE) THEN GO AROUND;                              17909000
         PRIORTY~PRYOR[P1MIX]~PROTY;                                    17910000
 END;                                                                %ST17916000
PROCEDURE FILEHOLD(A,B,TOG,LOC,HOLD);                                   18000000
    VALUE LOC,HOLD;                                                     18001000
    REAL A,B,TOG,LOC,HOLD;                                              18002000
BEGIN                                                                   18003000
    REAL SZ,Y,T;                                                        18004000
    ARRAY HOLDLIST[*];                                                  18005000
    LABEL SLEPE;                                                        18006000
    DEFINE DSED=(TERMSET(P1MIX))#;                                      18007000
    IF HOLD THEN                                                        18008000
    BEGIN                                                               18009000
         IF TOG THEN TOG~TOG+1 ELSE                                     18010000
         BEGIN % MAKE AN ENTRY IN THE HOLDLIST                          18011000
              IF (SZ:=(Y:=HOLDER.[FF])+1) GTR HOLDMAX THEN              18012000
              PUNT([PUNTER[8]]);                                        18013000
              HOLDLIST:=[M[SPACE(SZ)]]&SZ[8:38:10];                     18014000
              IF Y!0 THEN                                               18014100
              DISKWAIT(-(HOLDLIST INX 0),Y,HOLDER.[CF]);                18015000
              HOLDER.[FF]:=SZ;                                          18016000
              HOLDLIST[Y]:=LOC.[FF]&[TOG][CTF]&SYSNO[2:46:2]            18017000
                   &P1MIX[10:40:8];                                     18017100
              DISKWAIT(HOLDLIST INX 0,SZ,HOLDER.[CF]);                  18018000
              FORGETSPACE(HOLDLIST);                                    18019000
              M[LOC+4].[3:1]:=1;                                        18020000
              DISKWAIT(LOC.[CF],30,LOC.[FF]);                           18021000
         END;                                                           18022000
         UNLOCKDIRECTORY;                                               18023000
         IF P1MIX!0 THEN                                                18024000
         BEGIN                                                          18025000
              IF TOG=0 THEN                                             18026000
SLEPE:        FILEMESS("      #",A,B," IN USE",0,0,0);                  18027000
              REPLY[P1MIX]:=-(10+A.[3:1]|646);                          18028000
              IF P(0,RDS)}FENCE THEN SWAP(WAITSWAP,1) ELSE              18029000
              COMPLEXSLEEP(REPLY[P1MIX]}0 OR DSED OR TOG);              18029500
              IF NOT WHYSLEEP(10+A.[3:1]|646) THEN GO SLEPE;            18030000
         END ELSE                                                       18031000
         SLEEP([TOG],1);                                                18032000
         LOCKDIRECTORY;                                                 18033000
         TOG:=TRUE;                                                     18033500
         IF DSED THEN                                                   18034000
         BEGIN                                                          18035000
              FILEHOLD(A,B,TOG,LOC,2);                                  18037000
              IF (JAR[P1MIX,0] EQV "LIBMAIN")!NOT 0 OR                  18038000
                 (JAR[P1MIX,1] EQV "DISK   ")!NOT 0 THEN                18039000
              BEGIN                                                     18040000
                   UNLOCKDIRECTORY;                                     18041000
                   GO TO INITIATE;                                      18042000
              END;                                                      18043000
         END;                                                           18044000
    END ELSE                                                            18045000
    IF (SZ~HOLDER.[FF])!0 THEN                                          18046000
    BEGIN                                                               18047000
         HOLDLIST:=[M[SPACE(SZ)]]&SZ[8:38:10];                          18048000
         DISKWAIT(-(HOLDLIST INX 0),SZ,HOLDER.[CF]);                    18049000
         IF TOG THEN FOR T:=0 STEP 1 UNTIL SZ-1 DO                      18050000
$ INCLUDE 18052001, IF SHAREDISK;                                       18051000
         IF HOLDLIST[T].[2:2]=SYSNO THEN                                18052000
         IF HOLDLIST[T].[FF]=[TOG].[CF] THEN                            18053000
         IF HOLDLIST[T].[10:8]=P1MIX THEN                               18053500
         IF (SZ:=SZ-1) ! T THEN                                         18054000
         BEGIN                                                          18055000
              MOVE(SZ-T,[HOLDLIST[T+1]],[HOLDLIST[T]]);                 18056000
              T:=SZ;                                                    18057000
         END;                                                           18058000
         HOLDER.[FF]:=Y:=SZ;                                            18059000
         IF SZ!0 THEN                                                   18060000
         BEGIN                                                          18061000
              FOR Y~0 STEP 1 UNTIL SZ-1 DO                              18062000
              IF HOLDLIST[Y].[CF]=LOC.[FF] THEN                         18063000
              BEGIN                                                     18064000
$ INCLUDE 18067001, IF SHAREDISK;                                       18065000
                   IF HOLDLIST[Y].[2:2]!SYSNO THEN                      18066000
                        HOLDLIST[Y]:=P(DUP,LOD,SSN) ELSE                18067000
                   IF (T:=HOLDLIST[Y]).[FF] GEQ FENCE THEN              18068000
                     BRINGBACK(T.[10:8]) ELSE M[T.[FF]]:=1;             18068100
                   Y:=SZ;                                               18069000
              END;                                                      18070000
              DISKWAIT(HOLDLIST INX 0,SZ,HOLDER.[CF]);                  18071000
         END;                                                           18072000
         IF SZ=Y THEN                                                   18073000
         BEGIN                                                          18074000
              M[LOC+4].[3:1]:=0;                                        18075000
              IF HOLD=2 THEN DISKWAIT(LOC.[CF],30,LOC.[FF]);            18076000
         END;                                                           18077000
         FORGETSPACE(HOLDLIST);                                         18078000
    END;                                                                18079000
END; % OF FILEHOLDER                                                    18080000
%COMMENT THE DISK FILE HEADER CONTAINS THE FOLLOWING INFORMATION:       18081000
%                                                                       18082000
%H[0].[0:15]      RECORD LENGTH                                         18083000
%    .[15:15]     BLOCK LENGTH                                          18084000
%    .[30:12]     RECORD/BLOCK                                          18085000
%    .[42:6]      SEGMENTS/BLOCK                                        18086000
%H[1].[6:18]      CREATION DATE FOR LOGGING (WHEN ON DISK)              18087000
%    .[25:23]     CREATION TIME FOR LOGGING (WHEN ON DISK)              18088000
%    .[1:47]      NUMBER OF LOGICAL RECORDS PER ROW (WHEN IN CORE)      18089000
%H[2].[0:48]      =0  FREE FILE                                         18090000
%    .[1:1]       =0  SOLE USER, PUBLIC OR PRIVATE FILE                 18091000
%    .[1:1]       =1  SECURITY FILE                                     18092000
%    .[6:42]      PRIMARY USER"S CODE                                   18093000
%H[3].[1:1]       =1  NEW FILE HEADER FORMAT                            18094000
%    .[2:10]      SAVE FACTOR (BINARY)                                  18095000
%    .[12:18]     DATE OF LAST ACCESS (BINARY)                          18096000
%    .[30:18]     CREATION DATE (BINARY)                                18097000
%H[4].[1:1]       =1   FILE IS BEING LOADED OR NAME IS BEING CHANGED    18098000
%    .[2:1]       =1   FILE IS OPENED BY AN EXCLUSIVE USER              18099000
%    .[3:1]       =1   A PROGRAM IS WAITING TO USE THE FILE             18100000
%    .[4:2]       SYSTEM NUMBER OF EXCLUSIVE USER                       18101000
%    .[6:1]       USED BY AUTOPRINT TO MARK A PBD FILE                  18102000
%    .[7:1]       USED TO MARK PSEUDO DECKS THAT WERE CREATED ON        18103000
%                 A TIME-SHARING SYSTEM BY A ZIP WITH FILE-ID           18104000
%    .[8:1]       USED TO MARK SPECIAL COMPILERS                        18104100
%    .[9:2]       =2  FILE IS DATA                                      18105000
%                 =3  FILE IS PROGRAM                                   18106000
%                 =0  DON"T KNOW IF DATA OR PROGRAM                     18107000
%    .[11:1]      FILE ACCESSED BIT                                     18108000
%    .[12:4]      SYSTEM FILE TOGGLES                                   18109000
%    .[16:5]      OPEN COUNT 2 FOR SYSTEM 0 (A)                         18110000
%    .[21:5]      OPEN COUNT 2 FOR SYSTEM 1 (B)                         18111000
%    .[26:5]      OPEN COUNT 2 FOR SYSTEM 2 (C)                         18112000
%    .[31:5]      OPEN COUNT 2 FOR SYSTEM 3 (D)                         18113000
%    .[36:6]      =0 TYPE IS UNKNOWN                                    18114000
%                 =1  BASIC                                             18115000
%                 =2  ALGOL                                             18116000
%                 =3  COBOL                                             18117000
%                 =4  FORTRAN                                           18118000
%                 =5  TSPOL                                             18119000
%                 =6  XALGOL                                            18120000
%                 =7  SEQ                                               18121000
%                 =8  DATA                                              18122000
%                 =9  LOCK                                              18123000
%    .[42:6]      NOT USED                                              18124000
%H[5].[0:48]      =0  SOLE USER FILE                                    18125000
%    .[1:1]       =1 PRIVATE FILE                                       18126000
%                 =12 IF H[6]=12 THEN INFO FILE ELSE PUBLIC FILE        18127000
%H[7]             NUMBER OF LOGICAL RECORDS (EOF POINTER)               18128000
%H[8]             NUMBER OF SEGMENTS PER ROW                            18129000
%H[9].[1:1]       TOGGLE 1 FOR SYSTEM 0 (A)                             18130000
%    .[2:1]       TOGGLE 1 FOR SYSTEM 1 (B)                             18131000
%    .[3:1]       TOGGLE 1 FOR SYSTEM 2 (C)                             18132000
%    .[4:1]       TOGGLE 1 FOR SYSTEM 3 (D)                             18133000
%    .[5:1]       TOGGLE 2 FOR SYSTEM 0 (A)                             18134000
%    .[6:1]       TOGGLE 2 FOR SYSTEM 1 (B)                             18135000
%    .[7:1]       TOGGLE 2 FOR SYSTEM 2 (C)                             18136000
%    .[8:1]       TOGGLE 2 FOR SYSTEM 3 (D)                             18137000
%    .[9:5]       OPEN COUNT 1 FOR SYSTEM 0 (A)                         18138000
%    .[14:5]      OPEN COUNT 1 FOR SYSTEM 1 (B)                         18139000
%    .[19:5]      OPEN COUNT 1 FOR SYSTEM 2 (C)                         18140000
%    .[24:5]      OPEN COUNT 1 FOR SYSTEM 3 (D)                         18141000
%    .[29:14]     NOT USED                                              18142000
%    .[43:5]      MAXIMUM NUMBER OF ROWS                                18143000
%H[10]-H[29]      DISK ADDRESSES OF ROWS (0 IF NOT ASSIGNED)            18144000
%                                                                       18145000
%                                                                       18146000
%THE OPEN COUNTS AND TOGGLES ARE USED IN THE FOLLOWING MANNER:          18147000
%                                                                       18148000
%    TOGGLE 1     TOGGLE 2     OPEN COUNT 1     OPEN COUNT 2            18149000
%      0            0           INPUT ONLY         INPUT                18150000
%      0            1 (OUTPUT)  NOT USED           INPUT                18151000
%      1            0           SHARED             INPUT                18152000
%                                                                       18153000
%END COMMENT;                                                           18154000
    REAL  PROCEDURE  DIRECTORYSEARCH(A,B,OPTN);%                        18155000
         VALUE  A,B,OPTN;  REAL  A,B,OPTN;%                             18156000
%   OPTN= 0   OPENS FOR SHARED USE                                      18157000
%   OPTN= 1   OPENS FOR INPUT                                           18158000
%   OPTN= 2   OPENS FOR OUTPUT                                          18159000
%   OPTN= 3   OPENS FOR WRITELOCK                                       18160000
%   OPTN= 4   OPENS FOR EXCLUSIVE USE                                   18161000
%   OPTN= 5   RETURNS FILE HEADER (UNCHANGED)                           18162000
%   OPTN= 6   REMOVES FILE FROM DISK UNCONDITIONALLY                    18163000
%   OPTN= 7   REMOVES FILE FROM DISK AS SOON AS IT IS NOT IN USE        18164000
%   OPTN= 8   REMOVES FILE HEADER ONLY                                  18165000
%   OPTN= 9   HEADERUNLOCK--WRITES HEADER POINTED TO BY (F-4).[CF]      18166000
%             BACK OUT ON (F-4).[FF], TURNS OFF INTERLOCK & DOES        18167000
%             FORGETSPACE(F-4).                                         18168000
%   OPTN=10   CLOSE SHARED                                              18169000
%   OPTN=11   CLOSE INPUT                                               18170000
%   OPTN=12   CLOSE OUTPUT                                              18171000
%   OPTN=13   CLOSE WRITELOCK                                           18172000
%   OPTN=14   CLOSE EXCLUSIVE                                           18173000
%   OPTN=15   LOGS THE FILE AND RESETS ITS CREATION DATE AND TIME       18174000
%   OPTN=16   MAKES THE FILE NOT A SYSTEM FILE                          18175000
%   OPTN=17   MAKES THE FILE A SYSTEM FILE                              18176000
%   OPTN=18   WILL INTERLOCK SYSTEM FILES                               18177000
%   OPTN=19   RESETS ACCESSD BIT (FH[4].[11:1])                         18178000
%   OPTN=20   SETS ACCESSD BIT                                          18179000
%   OPTN>512  FILECLOSE--ADDRESS OF HEADER IN OPTN.[CF]                 18180000
%                        CLOSE OPTION-10 IS IN OPTN.[FF]                18181000
%   OPTN< 0   RETURNS AN AREA OF USER DISK AND UPDATES CORE COPY        18182000
%             OF FILE HEADER--ADDRESS OF HEADER IS IN OPTN.[CF]--       18183000
%             NUMBER OF THE ROW TO BE FILLED IS IN OPTN.[FF]            18184000
%             IS IN OPTN.[CF]                                           18185000
%   A.[1:1]   DIRECTORYSEARCH WILL FORGET THE MEMORY SPACE              18186000
%             OCCUPIED BY THE FILE HEADER                               18187000
%   A.[2:1]   IS DIALED INTO FH[4].[1:1] WHEN OPTN=4                    18188000
%   A.[3:1]   IF A CONFLICT OCCURS, A "QT" WILL BE ENABLED. IF IT       18189000
%             ENTERED BY THE OPERATOR, THE "QT" WILL CAUSE A            18190000
%             VALUE OF -0 TO BE RETURNED BY DIRECTORYSEARCH.            18191000
%   B.[1:1]   DIRECTORYSEARCH WILL RETURN A VALUE OF -0 IF THE          18192000
%             FILE IS IN USE                                            18193000
%   B.[2:1]   WILL NOT UPDATE DATE OF LAST ACCESS                       18194000
%                                                                       18195000
BEGIN                                                                   18196000
         REAL OLDONE=-4;                                                18197000
         REAL TEMP,I,T,TOG,J,K,N,F,X;                                   18198000
         INTEGER S,I1,I2,I3;                                            18199000
         ARRAY FH[*],NB[*];                                             18200000
         DEFINE DSED=(TERMSET(P1MIX))#;                                 18201000
         LABEL EXT,CHECK,LWS;                                           18202000
         LABEL OPENSHARED,OPENINPUT,OPENOUTPUT,OPENWRITELOCK,           18203000
              OPENEXCLUSIVE,L6,L7,L8,EXIT,LWRITE,FOUND,                 18204000
              THU,CLOSE,LW,BOMB,GETAROW,EX,                             18205000
              CLOSESHARED,CLOSEINPUT,CLOSEOUTPUT,CLOSEWRITELOCK,        18206000
              CLOSEXCLUSIVE,ZER,UNSYS,SYS,                              18207000
              SEE,LOCKSYS,RSET,DONTWAIT,NOFILE;                         18208000
         LABEL LOGIT;                                                   18210000
$INCLUDE 18210101, IF SHAREDISK;                                        18210099
         LABEL ONE,TOG1,TOG2,STOG;                                      18210100
         SWITCH Q~OPENSHARED,OPENINPUT,OPENOUTPUT,OPENWRITELOCK,        18211000
              OPENEXCLUSIVE,EXIT,L6,L7,L8,EXIT,                         18212000
              CLOSESHARED,CLOSEINPUT,                                   18213000
              CLOSEOUTPUT,CLOSEWRITELOCK,CLOSEXCLUSIVE                  18214000
              ,LOGIT                                                    18216000
              ,UNSYS,SYS                                                18219000
              ,LOCKSYS,RSET,RSET                                        18220000
              ;                                                         18221000
    %*************************************************                  18222000
    REAL SUBROUTINE SEARCH;                                             18223000
    BEGIN                                                               18224000
         S:=SCRAMBLE(A,B);                                              18225000
         DO BEGIN DISKWAIT(-N,60,S);                                    18226000
              FOR X ~ 0 STEP 3 UNTIL 57 DO                              18227000
                   IF (NB[X] EQV A.[6:42])=NOT 0 THEN                   18228000
                   IF (NB[X+1] EQV B.[6:42])=NOT 0 THEN GO TO FOUND;    18229000
         END UNTIL (S~NB[2].[FF])=0;                                    18230000
         GO TO EXT;                                                     18231000
    FOUND: I~(K~NB[X+2].[CF]-DIRECTORYTOP-4).[44:4]|2;                  18232000
         J ~(K AND NOT 15)+DIRECTORYTOP+19;                             18233000
         K ~ K+DIRECTORYTOP+4;                                          18234000
    EXT: SEARCH ~ S;                                                    18235000
    END;                                                                18236000
    %*************************************************                  18237000
    SUBROUTINE HEADER;                                                  18238000
    BEGIN                                                               18239000
         DISKWAIT(-F,30,K);                                             18240000
         TEMP:=F&K[CTF]&I[8:38:10];                                     18241000
    END;                                                                18242000
    %*************************************************                  18243000
    SUBROUTINE REMOVER;                                                 18244000
    BEGIN NB[X]~@14;                                                    18245000
         DISKWAIT(N,60,S);                                              18246000
         DISKWAIT(-N,30,J);                                             18247000
         NB[I]~@14; NB[I+1]~NEXTSLOT; NEXTSLOT~K;                       18248000
         DISKWAIT(N,30,J);                                              18249000
    END;                                                                18250000
    %*************************************************                  18251000
    SUBROUTINE HOLD;                                                    18252000
    BEGIN                                                               18253000
         IF B.[1:1] THEN GO DONTWAIT;                                   18254000
         FILEHOLD(A,B,TOG,TEMP,1);                                      18255000
         IF P1MIX!0 THEN                                                18256000
         IF DSED THEN GO TO NOFILE ELSE                                 18257000
    IF(JAR[P1MIX,0] EQV "LIBMAIN")=NOT 0 THEN                           18257100
    IF(JAR[P1MIX,1] EQV "DISK   ")=NOT 0 THEN                           18257200
         IF REPLY[P1MIX]=16 THEN                                        18258000
         BEGIN                                                          18259000
              FILEHOLD(A,B,TOG,TEMP,2);                                 18260000
    DONTWAIT:                                                           18260500
              TEMP:=-0;                                                 18261000
              GO TO EXIT;                                               18262000
         END;                                                           18263000
         IF SEARCH=0 THEN                                               18264000
         BEGIN                                                          18265000
NOFILE:       TEMP:=0;                                                  18266000
              A:=-1;                                                    18267000
              GO TO EXIT;                                               18268000
         END;                                                           18269000
         HEADER;                                                        18270000
    END; % OF HOLD                                                      18271000
    %*************************************************                  18272000
         LOCKDIRECTORY;                                                 18273000
         IF OPTN=9 THEN                                                 18274000
         BEGIN                                                          18275000
              K:=OLDONE.[FF];                                           18276000
              FH:=[M[N:=F:=OLDONE.[CF]]]&30[8:38:10];                   18277000
              GO TO CLOSEXCLUSIVE;                                      18278000
         END;                                                           18279000
         NB:=[M[N:=SPACE(60)]]&60[8:38:10];                             18280000
         IF SEARCH=0 THEN                                               18281000
         BEGIN                                                          18282000
              A:=0;                                                     18283000
              GO TO EXIT;                                               18284000
         END;                                                           18285000
         FH:=[M[F:=SPACE(30)]]&30[8:38:10];                             18286000
         HEADER;                                                        18287000
         IF OPTN<0 THEN GO GETAROW;                                     18288000
         IF OPTN}512 THEN GO TO Q[OPTN.[FF]+10];                        18289000
         IF OPTN LSS 5 OR OPTN=17 OR OPTN=7 THEN                        18290000
    CHECK:                                                              18291000
         BEGIN                                                          18292000
              IF NOT OPTN OR OPTN=7 THEN IF FH[4].[12:4]!0 THEN         18293000
              BEGIN   %   IT IS A SYSTEM FILE                           18294000
                   TEMP:=  -1;                                          18295000
                   GO TO EXIT;                                          18296000
              END;                                                      18297000
    SEE:                                                                18298000
         IF (FH[4].[2:2] AND (NOT TOG OR 2))!0 THEN                     18299000
              BEGIN                                                     18300000
                   HOLD;                                                18301000
                   GO CHECK;                                            18302000
              END;                                                      18303000
         END;                                                           18305000
         GO TO Q[OPTN];                                                 18306000
    OPENSHARED:                                                         18307000
         IF FH[9].[5:4]=0 THEN                                          18308000
         IF FH[9].[1:4]!0 OR FH[9].[9:20]=0 THEN                        18309000
         BEGIN                                                          18310000
$INCLUDE 18314001, IF SHAREDISK;                                        18310999
              P(SYSNO); ::P(.ONE,+,LOD); T~P;                           18311000
              FH[9].[ 9:20]~P(DUP).[ 9:20]+T;                           18312000
              P(SYSNO); ::P(.TOG1,+,LOD); T~P;                          18313000
              FH[9]~P(DUP,LOD) OR T;                                    18314000
$OMIT 18314201, IF SHAREDISK;                                           18314099
              FH[9].[9:5]:=P(DUP).[9:5]+1;                              18314100
              FH[9].[1:1]:=1;                                           18314200
              GO TO LWRITE;                                             18315000
         END;                                                           18316000
         HOLD;                                                          18317000
         GO TO OPENSHARED;                                              18318000
    OPENINPUT:                                                          18319000
$INCLUDE 18321001, IF SHAREDISK;                                        18319999
         P(SYSNO); ::P(.ONE,+,LOD); T~P;                                18320000
         FH[4].[16:20]~P(DUP).[16:20]+T;                                18321000
$OMIT 18321101, IF SHAREDISK;                                           18321099
         FH[4].[16:5]:=P(DUP).[16:5]+1;                                 18321100
         GO TO LWRITE;                                                  18322000
    OPENOUTPUT:                                                         18323000
         IF FH[9].[5:24]=0 THEN                                         18324000
         BEGIN                                                          18325000
$INCLUDE 18327001, IF SHAREDISK;                                        18325999
              P(SYSNO); ::P(.TOG2,+,LOD); T~P;                          18326000
              FH[9]~P(DUP,LOD) OR T;                                    18327000
$OMIT 18327101, IF SHAREDISK;                                           18327099
              FH[9].[5:1]:=1;                                           18327100
              GO TO LWRITE;                                             18328000
         END;                                                           18329000
         HOLD;                                                          18330000
         GO TO OPENOUTPUT;                                              18331000
    OPENWRITELOCK:                                                      18332000
         IF FH[9].[1:8]=0 THEN                                          18333000
         BEGIN                                                          18334000
$INCLUDE 18336001, IF SHAREDISK;                                        18334999
              P(SYSNO); ::P(.ONE,+,LOD); T~P;                           18335000
              FH[9].[9:20]~P(DUP).[9:20]+T;                             18336000
$OMIT 18336101, IF SHAREDISK;                                           18336099
              FH[9].[9:5]:=P(DUP).[9:5]+1;                              18336100
              GO TO LWRITE;                                             18337000
         END;                                                           18338000
         HOLD;                                                          18339000
         GO TO OPENWRITELOCK;                                           18340000
    OPENEXCLUSIVE:                                                      18341000
         IF FH[9].[9:20]=0 THEN                                         18342000
         IF FH[4].[16:20]=0 THEN                                        18343000
         BEGIN                                                          18344000
              FH[4]:=(P(DUP,LOD))&SYSNO[4:46:2]&1[2:47:1]&A[1:2:1];     18345000
              GO TO LWRITE;                                             18346000
         END;                                                           18347000
         HOLD;                                                          18348000
         GO TO OPENEXCLUSIVE;                                           18349000
    CLOSESHARED:                                                        18350000
$INCLUDE 18357001, IF SHAREDISK;                                        18350999
         P(SYSNO); ::P(.ONE,+,LOD); T~P;                                18351000
         IF ((I:=FH[9].[9:20]-T) AND T|31)=0 THEN                       18352000
         BEGIN                                                          18353000
              P(SYSNO); ::P(.TOG1,+,LOD,NOT); T~P;                      18354000
              FH[9]~P(DUP,LOD) AND T;                                   18355000
         END;                                                           18356000
         FH[9].[9:20]~I;                                                18357000
$OMIT 18357301, IF SHAREDISK;                                           18357099
         IF (I:=FH[9].[9:5]-1)=0 THEN                                   18357100
         FH[9].[1:1]:=0;                                                18357200
         FH[9].[9:5]:=I;                                                18357300
         GO TO CLOSE;                                                   18358000
    CLOSEINPUT:                                                         18359000
$INCLUDE 18361001, IF SHAREDISK;                                        18359999
         P(SYSNO); ::P(.ONE,+,LOD); T~P;                                18360000
         FH[4].[16:20]~P(DUP).[16:20]-T;                                18361000
$OMIT 18361101, IF SHAREDISK;                                           18361099
         FH[4].[16:5]:=P(DUP).[16:5]-1;                                 18361100
         GO TO LW;                                                      18362000
    CLOSEOUTPUT:                                                        18363000
$INCLUDE 18365001, IF SHAREDISK;                                        18363999
         P(SYSNO); ::P(.TOG2,+,LOD,NOT); T~P;                           18364000
         FH[9]~P(DUP,LOD) AND T;                                        18365000
$OMIT 18365101, IF SHAREDISK;                                           18365099
         FH[9].[5:1]:=0;                                                18365100
         GO TO CLOSE;                                                   18366000
    CLOSEWRITELOCK:                                                     18367000
$INCLUDE 18369001, IF SHAREDISK;                                        18367999
         P(SYSNO); ::P(.ONE,+,LOD); T~P;                                18368000
         FH[9].[9:20]~P(DUP).[9:20]-T;                                  18369000
$OMIT 18369101, IF SHAREDISK;                                           18369099
         FH[9].[9:5]:=P(DUP).[9:5]-1;                                   18369100
         GO TO LW;                                                      18370000
    CLOSEXCLUSIVE:                                                      18371000
         FH[4].[1:2]~0;                                                 18372000
    GO TO CLOSE;                                                        18373000
    SYS:                                                                18388000
         IF FH[9].[1:8]=0 THEN                                          18389000
         BEGIN                                                          18390000
$INCLUDE 18392001, IF SHAREDISK;                                        18390999
              P(SYSNO); ::P(.STOG,+,LOD); T:=P;                         18391000
              FH[4]:=P(DUP,LOD) OR T;                                   18392000
$OMIT 18392101, IF SHAREDISK;                                           18392099
              FH[4].[12:1]:=1;                                          18392100
              GO TO LWRITE;                                             18393000
         END;                                                           18394000
         HOLD;                                                          18395000
         GO TO SYS;                                                     18396000
    UNSYS:                                                              18397000
$INCLUDE 18399001, IF SHAREDISK;                                        18397999
         P(SYSNO); ::P(.STOG,+,LOD,NOT); T:=P;                          18398000
         FH[4]:=P(DUP,LOD) AND T;                                       18399000
$OMIT 18399101, IF SHAREDISK;                                           18399099
         FH[4].[12:1]:=0;                                               18399100
         GO TO LW;                                                      18400000
    LOCKSYS:                                                            18401000
         OPTN:=4;                                                       18402000
         GO SEE;                                                        18403000
$INCLUDE 18410001, IF SHAREDISK;                                        18403999
    STOG :::  @400000000000, @200000000000,                             18404000
              @100000000000, @40000000000;                              18405000
    ONE  :::  32768, 1024, 32, 1;                                       18406000
    TOG1 :::  @2000000000000000,  @1000000000000000,                    18407000
              @400000000000000,   @200000000000000;                     18408000
    TOG2 :::  @100000000000000,   @40000000000000,                      18409000
              @20000000000000,    @10000000000000;                      18410000
    LOGIT:                                                              18412000
         IF FH[4].[12:4]!0 THEN GO TO EXIT; % IT IS A SYSTEM FILE       18413000
         IF FH[4].[2:1] THEN                                            18414000
         BEGIN                                                          18415000
              HOLD;                                                     18416000
              GO LOGIT;                                                 18417000
         END;                                                           18418000
         DISKLOG(A,B,FH);                                               18419000
         GO TO LW;                                                      18420000
    GETAROW:                                                            18421000
         IF FH[I:=OPTN.[FF]]=0 THEN                                     18422000
         BEGIN                                                          18423000
              DISKLOG(A,B,FH);                                          18425000
              FH[I]:=GETUSERDISK(-FH[8]);                               18426000
         END;                                                           18427000
         FOR I~FH[9].[43:5]+9 STEP -1 UNTIL 10 DO                       18428000
              M[OPTN INX I]~FH[I];                                      18429000
         GO TO LW;                                                      18430000
    CLOSE:                                                              18431000
         IF B.[3:1] THEN FH[4].[11:1] ~ 1;                              18431050
         IF OPTN GTR 511 THEN                                           18431100
         BEGIN                                                          18431200
              IF (FH[0] EQV M[OPTN])!NOT 0 THEN                         18431300
              IF (I1:=(((I1:=((((I2:=FH[7]+1) DIV (I3:=FH[0]).[30:12])  18431400
                   |I3.[42:6])|30)+(I2 MOD I3.[30:12])                  18431500
                   |(IF (I2:=I3.[1:14])=0 THEN 30 ELSE I2)) DIV 30)     18431600
                   DIV (I3:=M[OPTN]).[42:6])|I3.[30:12]                 18431700
                   +((((I1 DIV 30) MOD I3.[42:6])|30                    18431800
                   +I1 MOD 30+I3.[1:14]-1) DIV I3.[1:14])-1)            18431900
                   =M[OPTN+7] THEN GO TO LW;                            18432000
              FH[0]:=M[OPTN];                                           18432100
              FH[7]:=M[OPTN+7];                                         18432200
         END;                                                           18432300
         GO TO LW;                                                      18432400
    L7:%                                                                18432500
         IF (FH[4] AND @1400777777770000)!0 OR                          18432600
              FH[9].[1:28]!0 THEN                                       18433000
         BEGIN                                                          18434000
              HOLD;                                                     18435000
              GO TO L7;                                                 18436000
         END;                                                           18437000
    L6:%                                                                18438000
         IF LIBMSG THEN LBMESS(ABS(A),B,"REMOVED",0,0,0,0);             18439000
         IF NOT FH[4].[1:1] THEN DISKLOG(A,B,FH);                       18441000
         PBCOUNT~PBCOUNT-((((A EQV"PBD    ")=NOT 0) OR                  18442000
                ((A EQV"PUD    ")=NOT 0)) AND (B.[CF]=1));              18443000
         REMOVER;                                                       18444000
         FOR I ~ 1 STEP 1 UNTIL FH[9] DO%                               18445000
         IF  FH[9+I]!0  THEN  FORGETUSERDISK(FH[I+9],FH[8]);%           18446000
         GO TO LW;                                                      18447000
    L8:  REMOVER;                                                       18448000
         GO TO EXIT;                                                    18449000
    RSET:                                                               18450000
         FH[4].[11:1]:=(OPTN=20);                                       18451000
STREAM(DATE,J~5);BEGIN SI~LOC DATE;DS~8OCT END;FH[3].[12:18]~JUNK;      18451500
         GO TO LWS;                                                     18452000
    LWRITE:%                                                            18453000
         IF NOT B.[2:1] THEN                                            18454000
         STREAM(A~[DATE],B~[FH[3]],C~0);                                18455000
         BEGIN SI~A;DI~LOC C;DS~8 OCT;SI~LOC C;SI~SI+5;                 18456000
              DI~B;DI~DI+2;DS~3 CHR;                                    18457000
         END;                                                           18458000
    LW:                                                                 18459000
         IF FH[4].[3:1] OR TOG THEN FILEHOLD(A,B,TOG,TEMP,0);           18460000
    LWS:                                                                18460500
         DISKWAIT(F,30,K);                                              18461000
    EX:  FH[9]:=(*P(DUP)) AND 31;                                       18462000
    EXIT:%                                                              18463000
         FORGETSPACE (N);%                                              18464000
         IF A.[1:1] OR TEMP.[1:1] THEN FORGETSPACE(F);                  18465000
         UNLOCKDIRECTORY;                                               18466000
         DIRECTORYSEARCH~TEMP;                                          18467000
END; % OF DIRECTORYSEARCH                                               18468000
PROCEDURE COMMUNICATE;                                                  19000000
BEGIN REAL R4=-4,R5=-5,R6=-6,R7=-7,R8=-8;                               19001000
      INTEGER I4=-4,I5=-5,I6=-6;                                        19002000
      ARRAY A4=-4[*],A5=-5[*],A6=-6[*];                                 19003000
      ARRAY A7=-7[*];                                                   19003100
      NAME N4=-4,N5=-5,N6=-6;                                           19004000
      LABEL C0,C1,C2,C3,C4,C5,C6,C7,C8,C9,C10,C11,C12,C13,C14,C15,C16,  19005000
            C17,C18,C19,C20,C21,C22,C23,C24,C25,C26;                    19006000
      LABEL C27,C28,C29,C30,C31,C32;                                    19006100
      LABEL C33,C34,C35,C36,C37,C38,C39;                                19006200
    LABEL C21A;                                                         19006250
      LABEL INIT,C3A;                                                   19006300
      SWITCH C ~ C0,C1,INIT,C3,C4,INIT,C6,C7,INIT,INIT,INIT,INIT,       19007000
         INIT,INIT,INIT,INIT,C16,C17,INIT,INIT,C20,C21,C22,INIT,        19008000
         INIT,C25,C26,INIT,INIT,C29,C30,C31,INIT,C33,INIT,INIT,         19008100
         INIT,INIT,INIT,C39;                                            19008200
      LABEL  US,D,TD,PR,IOT,TMR,AD,WD;                                  19009000
      DEFINE CN=DIFFCOM#;                                               19009100
      SWITCH S~US,D,TD,PR,IOT,TMR,AD,WD;                                19010000
      REAL I,J,T,RCW=+0;                                                19011000
      ARRAY AIT[*]; REAL AITL=AIT; ARRAY A=AIT[*];                      19012000
          ARRAY FIB=AIT[*],FPB[*],H[*];LABEL CHANGENAME;                19012100
      NAME ADDR;                                                        19012110
      REAL K=H;                                                         19012120
      DEFINE BITS=(IF SB THEN DS~SET ELSE DS~RESET; SKIP SB)#;          19012200
%                                                                       19013000
      CHECKSTACKSPACE;%                                             %WF 19013100
      GO TO C[PRT[P1MIX,9]];                                            19014000
%     COBOL INVALID EOJ                                                 19015000
C0:   TERMINATE(P1MIX); TERMINALMESSAGE(28);                            19016000
%     TIME INTRINSIC                                                    19017000
C1:   IF (I4~I4)}(-1) AND I4{6 THEN                                     19018000
      BEGIN GO TO S[I4+1];                                              19019000
      US:       R4~USERCODE[P1MIX]; GO TO INITIATE;                     19019900
      D:    I4~DATE; GO TO INITIATE;                                    19020000
      TD:   I4~XCLOCK+P(RTR); GO TO INITIATE;                           19021000
      PR:   I4~PROCTIME[P1MIX]+JAR[P1MIX,3]+CLOCK+P(RTR);               19022000
            GO TO INITIATE;                                             19023000
      IOT:  I4~IOTIME[P1MIX]+JAR[P1MIX,4];                              19024000
 $VOID                                                              %R5919025000
            GO TO INITIATE;                                             19026000
      TMR:  I4~P(RTR);  GO TO INITIATE;                                 19027000
      AD:   I4~ACTDATE; GO TO INITIATE;                                 19027100
      WD:   I4~WEEKDAY;                                                 19027200
      END;                                                              19028000
INIT: GO TO INITIATE;                                                   19029000
%     SLEEP                                                             19030000
      % NOW IN SHORT COMMUNICATES                                       19031000
%     RETURN SPECIFIC ARRAY                                             19032000
C3:   ARTN(N4[0],1);          % RETURN 1 DIM ARRAY                      19033000
C3A:: T:=[AITL].[CF];         % REMOVE FROM AIT                         19033500
      IF NOT(AIT~PRT[P1MIX,6]).[2:1] THEN MAKEPRESENT(T);               19034000
      AIT[0]~(J~AIT[0])-1; T~N4.[33:15];                                19035000
      FOR I~1 STEP 1 UNTIL J-1 DO                                       19036000
            IF AIT[I].[18:15]=T THEN                                    19037000
                  BEGIN MOVE(J-I,[AIT[I+1]],[AIT[I]]); J~0 END;         19038000
      N4[0]~0;                                                          19039000
      GO TO INITIATE;                                                   19040000
%     GENERALIZED ZIP                                                   19041000
C4:   IF (I~A4.[8:10])!0 THEN BEGIN                                     19042000
      T:=GETSPACE(I+4,64,0)+4;                                          19042100
      IF NOT A4.[2:1] THEN MAKEPRESENT(NFLAG(NOT 3 INX [RCW]));         19043000
      IF (J~USERCODE[P1MIX])=ABS(NOT 0) THEN J~0;                       19043500
      STREAM(C~J,A4,I1~I.[36:6],I,Q~0,T);                               19044000
      BEGIN SI:=A4; SI:=SI-1;                                           19044100
      L:    SI:=SI+1; IF SC=" " THEN GO TO L; Q:=SI; DI:=Q;             19044200
            IF SC=@14 THEN DS:=LIT" " ELSE DS:=2LIT"  "; DI:=T;         19044300
            DS:=8LIT"CC USER="; SI:=LOC C; SI:=SI+1; DS:=7 CHR;         19044400
            DS:= LIT";" ; SI:=A4;                                       19044500
            I1(DS:=32WDS; DS:=32WDS);  DS:= I WDS;                      19044600
                    TALLY:=12;I:=TALLY;                                 19044610
                    DI:=Q;SI:=LOC I;SI:=SI+7;DS:=CHR;                   19044620
      END STREAM;                                                       19044700
      J~IF USERCODE[P1MIX]=ABS(NOT 0) THEN 31 ELSE 26;                  19044800
              CCARD(T&J[3:43:5]);                                       19045000
         END ELSE                                                       19045010
         BEGIN FIB~N4[NOT 2];                                           19045020
              FPB~PRT[P1MIX,3];                                         19045030
              I~IF FIB[4].[12:1] THEN FIB[4].[13:11]                    19045040
                                 ELSE (FIB[4].[13:11]-1)|ETRLNG;        19045050
              T~FPB[I+3].[43:5];                                        19045060
              IF T=10 OR T=12 OR T=13 THEN                              19045070
              BEGIN IF FIB[5].[42:1] THEN GO TO CHANGENAME;             19045080
                   H~FIB[14];                                           19045090
                   H[5]:=USERCODE[P1MIX];                               19045095
$ INCLUDE 19045098, IF SHAREDISK;                                       19045096
                   H[4].[7:1]:=1;                                       19045097
                   IF H[4] THEN %                                       19045100
                   BEGIN FILECLOSE(N4.[33:15]);                         19045110
    CHANGENAME:          IF (T~DIRECTORYSEARCH(FPB[I],FPB[I+1],4))=0    19045120
                            THEN GO TO INITIATE;                        19045130
                         H~[M[T]]&30[8:38:10];                          19045140
                         H[5]:=USERCODE[P1MIX];                         19045145
$ INCLUDE 19045148, IF SHAREDISK;                                       19045146
                         H[4].[7:1]:=1;                                 19045147
                         ENTERCONTROLDECK(H);                           19045150
                         IF (T~DIRECTORYSEARCH(FPB[I],FPB[I+1],8))!0    19045160
                            THEN FORGETSPACE(T);                        19045170
                         FORGETSPACE(H);                                19045180
                   END ELSE                                             19045190
                   BEGIN FILECLOSE((N4.[33:15])&6[18:33:15]);           19045200
                         ENTERCONTROLDECK(H);                           19045210
                         FOR T~10 STEP 1 UNTIL 29 DO H[T]~0;            19045220
                         FILECLOSE(N4.[33:15]);                         19045230
         END  END  END;                                                 19045240
      GO TO INITIATE;                                                   19046000
%     EOJ                                                               19047000
      % NOW IN SHORT COMMUNICATES                                       19048000
%     WHEN                                                              19049000
C6:   I4~60|I4+P(RTR)+CLOCK;                                            19050000
      WHILE NOTERMSET(P1MIX) AND CLOCK+P(RTR)<I4 DO                     19051000
            SLEEP([CLOCK],NOT CLOCK);                                   19052000
      GO TO INITIATE;                                                   19053000
C7:   IF NOT A5.[2:1] THEN MAKEPRESENT(NFLAG(NOT 0 INX [I4]));          19055000
      I~M[A5 INX NOT 0]; J~M[A5 INX NOT 1];                             19056000
      P([M[A5 INX NOT 1]],IOR);                                         19057000
      IF (NT2~(NT1~*(I4 INX PRT[P1MIX,4])).[18:15])>NT3~A5.[8:10] THEN  19058000
            NT2~NT3;                                                    19059000
      DISKWAIT(-A5.[CF],NT2,I4~JAR[P1MIX,NT1.[CF]                       19060000
             DIV JAR[P1MIX,8]+10]+NT1.[33:15] MOD JAR[P1MIX,8]);        19061000
      M[A5 INX NOT 0]~I;                                                19063000
      IF NOT J.[2:1] THEN P([M[A5 INX NOT 1]],PRL);                     19064000
      GO TO INITIATE;                                                   19065000
%     PLAIN ZIP                                                         19066000
      % NOW IN SHORT COMMUNICATES                                       19067000
                                                                        19068000
%     FILL WITH INQUIRY                                                 19069000
      % NOT IN TIME SHARING SYSTEM                                      19070000
%     BLOCK EXIT                                                        19079000
      % NOW IN SHORT COMMUNICATES                                       19080000
%     ALGOL I/O FUNCTIONS                                               19081000
      % NOW IN SHORT COMMUNICATES                                       19082000
%     BREAKOUT                                                          19083000
      % NOT IN TIME SHARING SYSTEM                                      19084000
                                                                        19086000
%     COBOL I/O FUNCTIONS                                               19087000
      % NOW IN SHORT COMMUNICATES                                       19088000
%     INVERT OVERLAYABLE STATUS                                         19089000
      % NOW IN SHORT COMMUNICATES                                       19090000
                                                                        19091000
                                                                        19092000
%     DISPLAY (COBOL)                                                   19093000
      % NOW IN SHORT COMMUNICATES                                       19094000
%     COBOL ACCEPT                                                      19095000
C16:  DISPLAY(A4 INX 2); REPLY[P1MIX]~-@612;                            19096000
      IF [MEM[P1MIX,MLINK1]].[CF]}FENCE THEN                            19096100
            SWAP(WAITSWAP,1) ELSE                                       19096200
      COMPLEXSLEEP((TERMSET(P1MIX) OR REPLY[P1MIX]>0));                 19097000
      IF TERMSET(P1MIX) THEN GO TO INITIATE;                            19098000
      IF NOT WHYSLEEP(@612) THEN GO TO C16;                             19099000
      T~REPLY[P1MIX].[18:15]; REPLY[P1MIX]~0;                           19100000
      STREAM(T,S~A4 INX 2);                                             19101000
            BEGIN SI~T;                                                 19102000
            L:    IF SC!"X" THEN BEGIN SI~SI+1; GO TO L END;            19103000
                  SI~SI+1; 2(DS~40 CHR);                                19104000
            END;                                                        19105000
      FORGETSPACE(T-1); GO TO INITIATE;                                 19106000
%     COBOL I/O ERROR                                                   19107000
C17:  A5~*A5; A~PRT[P1MIX,3]; I~"I/O ERR";                              19108000
      IF A5[5].[1:1] THEN                                               19108100
         BEGIN I:= "INVALID";J:="   USER"; R6:=1 END ELSE               19108200
      STREAM(R4,N~[J]); BEGIN SI~LOC R4; DI~DI+1; DS~7 DEC;             19109000
                              DI~DI-7; DS~5 FILL;                       19110000
                        END;                                            19111000
      FILEMESS(I&R6[1:47:1],J,A[T~A5[4].[13:11]],A[T+1],                19112000
              IF R4~(R4=16 OR R4=17 OR R4=82) THEN R8 ELSE 0,           19112100
               IF R4 THEN R7 ELSE 0,0);                                 19112200
      GO TO INITIATE;                                                   19113000
%     ERROR - INQUIRY WRITE                                             19114000
      % NOT IN TIME SHARING SYSTEM                                      19115000
%     PRINT BACK-UP                                                     19116000
      % NOW IN SHORT COMMUNICATES                                       19117000
%     TAPE SWAP FOR TAPE SORT                                           19118000
C20:  SLEEP([N4[3]],IOMASK); SLEEP([N4[4]],IOMASK);                     19119000
      FOR I~3 STEP 1 UNTIL 4 DO                                         19120000
      BEGIN N5[I].[33:15]~N4[I];                                        19121000
            M[N4[I] INX NOT 1]~(*P(DUP))&N5[3][14:3:4]&[N5[3]][33:33:15]19122000
      END;                                                              19123000
      A~N4[0]; A[5].[39:4]~2; A[16]~0; A[18]~NABS(*P(DUP));             19124000
      A~N5[0]; A[5]~0; A[16]~NFLAG(N5[3]); A[18]~ABS(*P(DUP));          19125000
      GO TO INITIATE;                                                   19126000
%     SORT STORAGE ASSIGNMENT                                           19127000
C21:  A~[M[GETSPACE(R6+R5,2,1)+2]]&R5[8:38:10];                         19128000
      A[0]~(R5 INX A)&(A)[CTF]&R6[8:38:10];                             19129000
      N4[0]~A;                                                          19131000
      IF NOT CONQUER(0,R5-1,R6,1 INX A,J) THEN                          19131100
      BEGIN FORGETSPACE(A);                                             19131110
C21A: STREAM(P1MIX,T~R5|R6,A~I~SPACE(7));                               19131120
      BEGIN DS~LIT "#"; SI~LOC P1MIX;                                   19131130
            DS~2 DEC; DS~ 13 LIT " NO SORT MEM:";                       19131140
            DS~5 DEC; DS~9 LIT " WDS RQD~";                             19131150
      END;                                                              19131160
      SPOUT(I);                                                         19131170
      REPLY[P1MIX]~-@30412;                                             19131180
      COMPLEXSLEEP(REPLY[P1MIX]>0 OR TERMSET(P1MIX));                   19131190
      IF TERMSET(P1MIX) THEN GO TO INITIATE;                            19131200
      IF NOT WHYSLEEP(@30412) THEN GO TO C21A;                          19131210
      J~REPLY[P1MIX].[CF]=3;                                            19131220
      GO TO C21;                                                        19131230
      END;                                                              19131240
      GO TO INITIATE;                                                   19132000
%     SORT STORAGE RETURN                                               19133000
C22:  J~(A~FLAG(N4[0])).[8:10]-1;                                       19134000
      FOR I~1 STEP 1 UNTIL J DO                                         19135000
      IF T>(T~A[I].[CF]) OR T>K THEN                                    19135100
         BEGIN K~M[T-2].[CF]; FORGETSPACE(T) END;                       19135200
      FORGETSPACE(N4[0]); N4[0]~0;                                      19136000
      GO TO INITIATE;                                                   19137000
%     LOAD CONTROL                                                      19138000
      % NOW IN SHORT COMMUNICATES                                       19139000
%     RETURN ONE ROW OF A DISK FILE                                     19140000
      % NOW IN SHORT COMMUNICATES                                       19141000
                                                                        19142000
%     RETURN OLD COPY OF OWN ARRAY                                      19143000
C25:: ARTN(A5,R4);                                                      19144000
      M[A5.[FF]]~A~PRT[P1MIX,17]&P(.A5,LOD)[18:18:15];                  19145000
     IF A.[2:1] THEN M[A.[CF]-1].[CF]~A5.[FF];                          19146000
      GO TO INITIATE;                                                   19147000
%     INVALID ARGUMENTS TO ALGOL INTRINSICS                         %WF 19148000
C26:: IF (I ~ R4)}0 THEN                                                19149000
      STREAM(A:=R4, I:=I:=SPACE(10));                                   19149500
      BEGIN SI~LOC I;  SI~SI-1;  DS~LIT "-";                        %WF 19150000
            IF SC}@3 THEN DS~4 LIT "MAXN" ELSE                      %WF 19150100
            IF SC<@2 THEN DS~5 LIT "NEGTV" ELSE DS~4 LIT "ZERO";    %WF 19151000
            DS~8 LIT " ARGMNT ";                                    %WF 19152000
            CI~CI+A;                                                %WF 19152100
            GO LOG;  GO ROOT;  GO LOG;  GO EXP;  GO SIN;            %WF 19152200
            DS~3 LIT "COS";    GO EXIT;                             %WF 19153000
      LOG:  DS~2 LIT "LN";     GO EXIT;                             %WF 19153100
      ROOT: DS~4 LIT "SQRT";   GO EXIT;                             %WF 19153200
      EXP:  DS~3 LIT "EXP";    GO EXIT;                             %WF 19153300
      SIN:  DS~3 LIT "SIN";                                         %WF 19153400
      EXIT: DS:=2 LIT ":~";                                             19154000
      END;                                                              19155000
      IF I=(-7) THEN BEGIN  R4~R5;  R5~R6;  END;                        19155100
      TERMINATE(P1MIX);  TERMINALMESSAGE(-I);                       %WF 19156000
                                                                        19157000
                                                                        19158000
                                                                        19159000
%     COBOL DATACOM I INTERROGATE                                       19160000
      % NOT IN TIME SHARING SYSTEM                                      19161000
                                                                        19170000
%     ALGOL DATACOM I INTERROGATE                                       19171000
      % NOT IN TIME SHARING SYSTEM                                      19171500
                                                                        19174000
C29:: COMMENT THIS COMMUNICATE PROVIDES FOR DS-ING AN OBJECT PROGRAM    19175000
              AND/OR SPOUTING A MESSAGE ABOUT A PROGRAM.                19175010
              R4 IS USED TO SPECIFY THE  MESSAGE REQUIRED.              19175020
              R5 SET TO TRUE SPECIFIES P1MIX IS TO BE DS-ED.            19175030
              T IS THE ADDRESS OF THE MESSAGE(WHICH ENDS WITH A "~").   19175040
              REMAINING VARIABLES MAY BE USED AS DESIRED;               19175050
    T := SPACE(12);                                                     19175060
    IF R4 { 2 THEN                                                      19175070
         BEGIN;              % 29-1                                     19175080
         STREAM(J:T);                                                   19175090
              BEGIN          % 29-2                                     19175100
              DS:=9 LIT "-DEC ERR,";                                    19175110
              J ~ DI;                                                   19175120
              END;           % 29-2                                     19175130
         J ~ P;                                                         19175135
         IF R4=1 THEN                                                   19175140
              BEGIN;         % 29-3                                     19175150
              STREAM(T1~(R6<0),R6~ABS(R6),J);                           19175160
                   BEGIN     % 29-4                                     19175170
                   DS~17 LIT "ARRAY DIMENSION= ";T1(DS~ 1 LIT "-";);    19175180
                   SI ~ LOC R6;                                         19175190
                   DS ~ 8 DEC;  J  ~DI;                                 19175200
                   DI ~ DI-8;                                           19175210
                   DS ~ 7 FILL; DI ~ J;                                 19175220
                   DS:=2 LIT ":~";                                      19175230
                   END;      % 29-4                                     19175240
              END            % 29-3                                     19175250
         ELSE                                                           19175260
              BEGIN;         % 29-5                                     19175270
              STREAM(R6,J);                                             19175280
                   BEGIN     % 29-6                                     19175290
                   DS ~15 LIT "NO. DISK ROWS= ";                        19175300
                   SI ~ LOC R6;                                         19175310
                   DS ~ 8 DEC;    J ~ DI;                               19175320
                   DI ~ DI-8;                                           19175330
                   DS ~ 7 FILL;  DI ~ J;                                19175340
                   DS:=2 LIT ":~";                                      19175350
                   END;      % 29-6                                     19175360
              END;           % 29-5                                     19175370
         END;                % 29-1                                     19175380
         IF R4=3 THEN                                                   19175381
              BEGIN                                                     19175382
              ;STREAM(T);                                               19175383
                   BEGIN                                                19175385
                   DS~ 18 LIT "-MAXN ARGMNT EXP:~";                     19175387
                   END;                                                 19175388
              END;                                                      19175389
    IF R5 THEN                                                          19175390
         BEGIN               % 29-7                                     19175400
              TERMINATE(P1MIX);                                         19175420
              TERMINALMESSAGE(-T);                                      19175430
         END                 % 29-7                                     19175440
    ELSE                                                                19175450
         SPOUT(T);                                                      19175460
    GO TO INITIATE;                                                     19175470
%   DIRECTORYSEARCH AND UN-FILL FILE ID FOR NORMAL STATE PROGRAMS       19176000
C30::    COMMENT SEARCHES DISK DIRECTORY AND RETURNS DATA IN ARRAY.     19177000
              [0] IS USER-TYPE OR NOT-PRESENT FLAG                      19178000
              [1] IS MULTI-FILE ID                                      19179000
              [2] IS FILE ID                                            19180000
              IF NOT PRESENT, [3] => [5] ARE -1                         19181000
              IF INVALID USER, [3] => [5] ARE 0                         19182000
              IF PRIMARY, SECONDARY, OR TERTIARY USER:                  19183000
              [3] IS RECORD LENGTH                                      19184000
              [4] IS BLOCK LENGTH                                       19185000
              [5] IS END OF FILE POINTER                                19186000
              [6] IS OPEN COUNT                                         19187000
              NOT-PRESENT    FLAG IS  -1                                19188000
              INVALID   USER FLAG IS   0                                19189000
              PRIMARY   USER FLAG IS   7 (LM,INPUT, AND OUTPUT BITS)    19190000
              SECONDARY USER FLAG IS   3 (INPUT AND OUTPUT BITS)        19191000
              TERTIARY  USER FLAG IS   2 (INPUT BIT ONLY)               19192000
      ;                                                                 19193000
      IF A4.[8:10]<7 THEN BEGIN TERMINATE(P1MIX);%                      19200000
                                TERMINALMESSAGE(7);  END;%              19201000
      IF NOT A4.[2:1] THEN MAKEPRESENT(NFLAG(NOT 3 INX [RCW]));%        19202000
      P([M[A4 INX NOT 1]],DUP,DUP,LOD,XCH,CCX,.J,STD,IOR);%             19203000
      FIB ~ N5[NOT 2];  FPB ~ PRT[P1MIX,3];                             19204000
      I ~ IF FIB[4].[12:1] THEN FIB[4].[13:11]%                         19205000
            ELSE (FIB[4].[13:11]-1)|ETRLNG;                             19206000
      A4[1] ~ FPB[I];  A4[2] ~ FPB[I+1];                                19207000
       IF A4[1]=0 THEN                                              %R2219207100
       BEGIN A4[1]:=A4[2]; A4[2]:=USERCODE[P1MIX] END;              %R2219207200
      IF (T ~ DIRECTORYSEARCH(A4[1],A4[2],5))!0 THEN                    19208000
      BEGIN IF (A4[0] ~ SECURITYCHECK(A4[1],A4[2],USERCODE[P1MIX],T))!0 19209000
            THEN BEGIN A4[3] ~ M[T].[1:14];%                            19210000
                  A4[4] ~ M[T].[15:15];  A4[5] ~ M[T+7];%               19211000
$OMIT 19212001, IF SHAREDISK;                                           19211999
                  A4[6]:=M[T+4].[16:5]+M[T+9].[9:5];                    19212000
$INCLUDE 19212061, IF SHAREDISK;                                        19212049
                  A4[6]:=0&(I:=M[T+4].[16:20]+M[T+9].[9:20])[43:28:5] & 19212050
                    I[38:33:5]&I[33:38:5]&I[28:43:5];                   19212060
                    IF A4.[8:10] GTR 9 THEN                         %R2219212100
                    BEGIN A4[7]:=M[T+4].[36:6];A4[8]:=M[T+3];       %R2219212200
                          A4[9]:=M[T+1];                            %R2219212300
                    END;                                            %R2219212400
            END ELSE A4[3]:=A4[4]:=A4[5]:=A4[6]:=0;                     19213000
            FORGETSPACE(T)%                                             19214000
      END ELSE A4[0]:=A4[3]:=A4[4]:=A4[5]:=A4[6]:=-1;                   19215000
      IF NOT J.[2:1] THEN P([M[J]],PRL);%                               19216000
      GO TO INITIATE;%                                                  19217000
%     ALGOL "DELAY" FUNCTION -- WAIT WITH TIMEOUT                       19218000
C31:: IF A6.[CF]<512 THEN%   CAUGHT SOMEBODY BEING SNEAKY               19219000
      BEGIN TERMINATE(P1MIX);%                                          19219100
            TERMINALMESSAGE(17);%                                       19219200
      END;%                                                             19219300
      IF NOT (M[A6] AND R5)=NOT 0 THEN%                                 19220000
             IF (I4 ~ I4|60+CLOCK+P(RTR))>CLOCK+P(RTR) THEN%            19220100
         COMPLEXSLEEP((CLOCK+P(RTR)>I4) OR       % TIMED OUT            19221000
                      TERMSET(P1MIX) OR          % DISCONTINUED         19222000
                      (NOT(M[A6] AND R5)!NOT 0));% WAIT SATISFIED       19223000
      I6 ~ NOT(M[A6] AND R5)!NOT 0;%                                    19224000
      GO TO INITIATE;%                                                  19225000
      % NOT IN TIME SHARING SYSTEM                                      19226000
                                                                        19272000
C33:: STREAM(R4,A~(R4!0),J~JARROW[P1MIX],P1MIX,%                        19273000
                        T:=T:=SPACE(10));                               19274000
      BEGIN DS~10 LIT " PAUSE # 0";%                                    19275000
             A(DI~DI-1;  SI~LOC R4;  SI~SI+2;  DS~6 CHR);               19276000
             DS~5 LIT " FOR";  SI~J;  SI~SI+1;  DS~7 CHR;%              19277000
             DS~LIT "/";  SI~SI+1;  DS~7 CHR;  DS~LIT "=";%             19278000
             SI~LOC P1MIX;  DS~2 DEC;  DS~LIT "~";  DI~DI-3;  DS~FILL;% 19279000
      END;%                                                             19280000
      SPOUT(T);%                                                        19281000
      IF NOTERMSET(P1MIX) THEN PRTROW[P1MIX].[PSF]~2;                   19282000
      GO TO INITIATE;% DON"T KEEP COMMUNICATE AROUND NEEDLESSLY         19285000
      % FORTRAN ERROR DS ROUTINE                                        19286000
      % NOW IN SHORT COMMUNICATES                                       19287000
C39:: % BASIC ARRAY RETURN                                              19287100
      ARTN(N4[0],R5);         % RETURN R5 DIM ARRAY                     19287200
      GO TO C3A;              % TO REMOVE FROM AIT                      19287300
                                                                        19288000
                                                                        19289000
    END OF COMMUNICATE PROCEDURE;                                       19499000
 PROCEDURE    SHORTCOMMUNICATES;                                        19500000
    BEGIN REAL R4=-4,R5=-5,R6=-6,R7=-7,R8=-8,R9=-9;                     19501000
         ARRAY A4=-4[*],A5=-5[*],A6=-6[*],A7=-7[*],A8=-8[*];            19502000
         REAL      T,T1=T+1;                                            19503000
         LABEL     SLOW, INIT;                                          19504000
         LABEL     C2,C5,C8,C10,C11,C13,C14,C15,C19,C23,C24,C34;        19505000
         LABEL CM1,CM2,CM3,CM4,CM5,CM6,CM7,CM8,CM9                      19505100
             ,CM20                                                      19505150
             ,CM19,CM18,CM17,CM16,CM15,CM14,CM13,CM12,CM11,CM10         19505200
             ,C35,C36,C37,C40,C41 %                                     19505300
         ;                                                              19505499
         SWITCH S~                                                      19505500
              CM20,                                                     19505700
              CM19,CM18,CM17,CM16,CM15,CM14,CM13,CM12,CM11,CM10,        19505800
              CM9,CM8,CM7,CM6,CM5,CM4,CM3,CM2,CM1,                      19505900
                   SLOW,SLOW,C2,SLOW,SLOW,C5,SLOW,SLOW,C8,INIT,C10,     19506000
                   C11,INIT,C13,C14,C15,SLOW,SLOW,INIT,C19,SLOW,SLOW,   19507000
                   SLOW,C23,C24,SLOW,SLOW,INIT,INIT,SLOW,SLOW,INIT,     19508000
                   INIT,SLOW,C34,C35,C36,C37,SLOW,SLOW,C40,C41;         19508100
         GO TO S[PRT[P1MIX,9]+                                          19508800
              20                                                        19508900
              ];                                                        19509000
              COMMENT YOU MUST ADD NEW LABELS TO THE FRONT OF THE       19509100
                   SWITCH AND CHANGE THE LITERAL ABOVE TO CHANGE        19509200
                   THE NUMBER OF "NEGATIVE" COMMUNICATES;               19509300
    C2:  SLEEP(M OR A5,R4);                                             19510000
         GO TO RETURN;                                                  19511000
    C5:  P(.COM5);           GO TO DIFFCOM;                             19512000
    C8:  ZIPPER(R5,R4);                                                 19513000
    INIT: GO TO INITIATE;                                               19514000
    C10: P(.ASR);            GO TO DIFFCOM;                             19515000
    C11: IF R4=0 THEN FILEOPEN(0,A5.[CF]);                          %R9019516000
         IF R4=6 THEN                                               %R9019516100
         BEGIN FILECLOSE(NFLAG(A5)); GO TO INITIATE END;            %R9019516200
         IF R4=4 THEN                                               %R9019516300
         BEGIN IF A5[4] THEN      % FILE IS NOT IN DIRECTORY            19516400
              FORGETSPACE(DIRECTORYSEARCH(R8,R7,-(A5.[CF])&R6[CTF]))    19516410
              ELSE A5[A6]:=GETUSERDISK(A5[8]);                          19516420
              GO TO INITIATE;                                           19516430
         END;                                                           19516440
         P(.COM11); GO TO DIFFCOM;                                  %R9019516500
    C13: P(.COM13);          GO TO DIFFCOM;                             19517000
    C14: IF NOT R4.[2:1] THEN MAKEPRESENT([R4] INX 0);                  19518000
         M[R4 INX NOT 1] ~ (*P(DUP))&(NOT P(DUP))[2:2:1];               19519000
         GO TO INITIATE;                                                19520000
    C15: DISPLAY(A4 INX 1);                                             19521000
         GO TO INITIATE;                                                19522000
    C19: P(.COM19);          GO TO DIFFCOM;                             19523000
    C23: P(.COM23);          GO TO DIFFCOM;                             19524000
    C24: T ~ A4[R5];  A4[R5] ~ 0;                                       19525000
$ OMIT 19526001, IF SHAREDISK;                                          19525999
         FORGETUSERDISK(T,A4[8]);                                       19526000
$ INCLUDE 19526501, IF SHAREDISK;                                       19526499
         FORGETUSERDISK(T,A4[8]&(NOT A4[4])[1:47:1]);                   19526500
         GO TO INITIATE;                                                19527000
    C34: STREAM(R4,T:=T:=SPACE(10));                                    19528000
         BEGIN SI~R4;  DS~10 WDS;  END;                                 19529000
         TERMINATE(P1MIX);  TERMINALMESSAGE(-T);                        19530000
C35:IF R4.[FF]>33 THEN P(..LIBRARYLOAD) ELSE P(..LIBRARYDUMP);          19530500
         T~P(DUP,LOD,RFB);T~T&SPACE(T.[8:10])[CTC];                     19530520
         DISKWAIT(-T.[CF],T.[8:10],T.[FF]+MCPBASE);                     19530540
         M[T1].[CF]:=T;                                                 19530560
         GO TO DIFFCOM;                                                 19530600
SLOW: P(..COMMUNICATE); GO TO DIFFCOM;                                  19531000
    C36: IF (M[A5] AND R4)=0 THEN                                       19532000
         BEGIN                                                          19532100
              T := M[M[A5] INX                                          19532300
                       (IF P(DUP).[22:1] THEN 2 ELSE NOT 1)].[12:6];    19532400
              WAITORSWAP(T, A5.[CF]);                                   19532500
         END;                                                           19532600
         GO TO RETURN;                                                  19532700
    C37: NEXT1[P1MIX] := R5; % SHM                                      19532800
         NEXT2[P1MIX]:=R4;                                              19532900
         GO TO INITIATE;                                                19532950
C40:: IF R5.[15:15]=0 THEN                                              19532960
      BEGIN M[R5]:=NOT 0; GO TO INITIATE; END ELSE                      19532962
      IF R5.[FF]=@77777 THEN BEGIN M[R5]:=MOD3IOS;GO INITIATE;END ELSE  19532964
      FORK(P(.DKBUSINESS),R5,0,128,0); SLEEP([M[R5]],1);                19532966
      GO RETURN;                                                        19532968
C41:: IOREQUEST(R7,R6,FLAG(R5)); GO INITIATE;                           19532970
    CM2: P(.COMM2);          GO TO DIFFCOM;                             19533000
    CM1: P(.COMM1);          GO TO DIFFCOM;                             19534000
    CM18:                                                               19539300
DO UNTIL FALSE;                                                         19539310
    CM4: FORGETESPDISK(R5);                                             19540000
         GO TO RETURN;                                                  19541000
    CM3: R4~GETESPDISK;                                                 19542000
         GO TO RETURN;                                                  19543000
    CM5: P(.COMM5);                                                     19544000
         GO TO DIFFCOM;                                                 19544100
    CM6: R4~GETUSERDISK(R7);                                            19545000
         GO TO RETURN;                                                  19546000
    CM7: FORGETUSERDISK(R6,R5);                                         19547000
         GO TO RETURN;                                                  19548000
    CM8: DISKWAIT((A8.[CF])&R9[1:47:1],R6,R5);                          19549000
         M[A8.[CF]-1]~0;                                                19549500
         GO TO RETURN;                                                  19550000
    CM9: P(.COMM9);          GO TO DIFFCOM;                             19551000
    CM10:USERCODE[P1MIX]~R5;                                            19552000
         GO TO RETURN;                                                  19553000
    CM12:LOGLINE~R8;                                                    19554000
         IF FALSE THEN                                                  19554800
    CM11:IF NOT DAT[P1MIX].NDSABLE THEN R5:=R5 OR MEMORY;               19554900
         TWXOUT(A7.[CF],R6,R5,LOGLINE);                                 19555000
         R5:=BREAK[LOGLINE.[40:8]];                                     19555100
         GO TO RETURN;                                                  19556000
    CM13:P(.COMM13);                                                    19557000
         GO TO DIFFCOM;                                                 19558000
    CM14:IF SCHEDLINE[R6:=R6.[40:8]] THEN GO TO RETURN;                 19559000
$OMIT 19559221, IF DCP;                                                 19559049
         SEQARRAY[R6]:=R5;                                              19559050
         STREAM(A:=R5.[21:27],T:=T:=GETAREA(0));                    %11019559100
         BEGIN SI:=LOC A; DS:=8 DEC; DS:=LIT LEFTARROW;             %11019559120
              DI:=DI-9; DS:=8 FILL; A:=DI;                          %11019559140
              DI:=T; SI:=A; DS:=9 CHR;                              %11019559160
         END;                                                       %11019559180
         TWXOUT(T,8,0&1[CTF]&1[2:47:1],R6);                             19559200
         FORGETAREA(0,T);                                           %11019559220
$INCLUDE 19559381, IF DCP;                                              19559299
         M[(T:=GETAREA(0))+1]:=0&SETSEQUENCEMODE[1:41:7]&1[23:47:1]&    19559300
                               STATABLE[R6][24:24:16];                  19559320
         STREAM(A:=R5.[21:27],B:=R5.[2:19],T:=T+3);                     19559340
         BEGIN SI:=LOC A; DS:=8 DEC; DS:=8 DEC; END;                    19559360
         DCPQ(T);                                                       19559380
         GO TO RETURN;                                                  19560000
    CM19:R5~GETSPACE(30,64,0)+2;                                        19560100
         IF NOT A6.[2:1] THEN MAKEPRESENT([R7] INX 1);                  19560200
         MOVE(30,A6,R5);                                                19560300
         R6~6;                                                          19560400
    CM15:P(.COMM15);                                                    19561000
         GO TO DIFFCOM;                                                 19562000
    CM16:                                                               19563000
         GO TO RETURN;                                                  19564000
$OMIT 19566001, IF DCP;                                                 19564999
    CM17:P(.COMM17);                                                    19565000
         GO TO DIFFCOM;                                                 19566000
$INCLUDE 19566601, IF DCP;                                              19566099
    CM17:M[T:=GETAREA(0)]:=0&R8[5:1:1];                                 19566100
         M[T+1]:=R7&(IF R8.[1:1] THEN R8 ELSE STATABLE[R8])[24:24:16];  19566200
         M[T+3]:=R6;                                                    19566300
         M[T+4]:=R5;                                                    19566400
         DCPQ(T);                                                       19566500
         GO TO RETURN;                                                  19566600
    CM20:IF (T:=DIRECTORYSEARCH(R6,USERCODE[P1MIX],8).[CF])=0 THEN      19567000
              GO TO RETURN;                                             19568000
         M[T+2]:=USERCODE[P1MIX]; M[T+5]:=R5; M[T+6]:=R7;               19569000
         M[T+27]:=R8;                                                   19569100
         R5:=GETSPACE(30,64,0)+2; %GET SPACE BELOW THE FENCE            19570000
         MOVE(30,T,R5);                                                 19571000
         FORK(P(.SCHEDIDLE),R5&1[2:47:1],0,160,0);                      19572000
         GO TO RETURN;                                                  19573000
    END SHORTIES;                                                       19900000
 PROCEDURE FRONTEND(MIX);                                           %R7519991000
         VALUE MIX;                                                 %R7519991100
         REAL MIX;                                                  %R7519991200
         FORWARD;                                                   %R7519991300
 %  THE FORMAT OF SEGMENT ZERO OF PROGRAMS%                             20000000
 %       S[0]           =    LOCATION OF SEGMENT DICTIONARY%            20001000
 %       S[1]           =    SIZE OF SEGMENT DICTIONARY%                20002000
 %       S[2]           =    LOCATION OF PRT%                           20003000
 %       S[3]           =    SIZE OF PRT%                               20004000
 %       S[4]           =    LOCATION OF FILE PARAMETER BLOCK%          20005000
 %       S[5]           =    SIZE OF FILE PARAMETER BLOCK%              20006000
 %       S[6].[1:1]     =    1 FOR NEW FORMAT SEGMENT 0, ELSE 0         20006500
 %       S[6]           =    STARTING SEGMENT NUMBER%                   20007000
 %       S[7].[2:1]     =    FORTRAN FAULT FLAG                         20007100
 %       S[7].[33:15]   =    NUMBER OF FILES%                           20008000
 %       S[7].[18:15]   =    CORE REQUIREMENT / 64%                     20009000
 %       IF S[2] < 0 THEN THE JOB WAS COMPILED BY COBOL%                20010000
 %       S[15]          =    DISK ADDRESS OF LABEL EQUATION ENTRIES     20010100
 %                           PRESENTED WHEN PROGRAM WAS COMPILED AND    20010200
 %                           APPLICABLE TO ALL EXECUTIONS               20010300
 %       S[16]          =    ESTIMATED PROCESSOR TIME   (FROM COMPILATN)20010400
 %       S[17]          =    ESTIMATED I/O TIME         (FROM COMPILATN)20010500
 %       S[18]          =    PRIORITY                   (FROM COMPILATN)20010600
 %       S[19]          =    COMMON VALUE               (FROM COMPILATN)20010700
 %       S[20]          =    ESTIMATED CORE REQUIREMENTS(FROM COMPILATN)20010800
 %       S[21]          =    STACK SIZE                 (FROM COMPILATN)20010900
PROCEDURE SELECTRUN(F); VALUE F; REAL F;                                20011000
  BEGIN                                                                 20012000
     REAL T,MIX,FPB,STACKSIZE,STACKLOC,FB,IOD,COMMON,SAVETIME;          20013000
      REAL Z=IOD;                                                    %JS20013010
     INTEGER LEVEL,NEXTLINK,THISLINK,LASTLINK,I,LEQLINK1,LEQLINK2;      20014000
    INTEGER PRIORITY;                                                   20014100
     DEFINE L = SAVETIME#, LINK = COMMON#;                              20014500
     BOOLEAN GOTSPACE,BELOW,ESED;                                       20015000
    INTEGER J=NT1;%                                                     20015500
     ARRAY S[*],TRP[*];                                                 20016000
      NAME ADDR;                                                     %JS20016050
    REAL RCW=+0;                                                        20016100
     REAL A1,A2,A3,S2;                                                  20016200
     LABEL DLX,START,CONTINUE,LEM,JARSPACE,PASS,LOAD,UNBLK,STOP,EXIT;   20017000
     LABEL F1;                                                          20017100
     LABEL SMSG,BMSG,OOUT;                                              20017500
SUBROUTINE DELINK; % DELINKS A SHEET ENTRY AND RETURNS SHEET DISK SPACE 20018000
BEGIN;                                                                  20019000
     STREAM(A~S[3].[8:10],B~P(.SCHEDULEIDS));                           20019200
          BEGIN SKIP A DB; DS ~ RESET END;                              20019300
     IF F=0 THEN                                                        20019400
   BEGIN                                                                20019410
     IF NEXTLINK = 0 THEN SHEET[LEVEL].[FF] ~ LASTLINK;                 20019500
     IF LASTLINK = 0 THEN BEGIN SHEET[LEVEL].[CF] ~ NEXTLINK;GO DLX END;20020000
     DISKWAIT(-S.[CF],30,LASTLINK);                                     20021000
     S[29] ~ NEXTLINK;                                                  20022000
     DISKWAIT( S.[CF],30,LASTLINK);                                     20023000
DLX: FORGETESPDISK(THISLINK);                                           20024000
   END;                                                                 20024500
END DELINK;                                                             20025000
 $ VOID 20026451                                                    %R8120025050
START:                                                                  20027000
      IF F!0 THEN                                                       20027100
         BEGIN S~IOQUE&F[CTC];                                          20027200
              T~F.[FF];                                                 20027300
              GOTSPACE~TRUE;                                            20027400
              GO TO F1;                                                 20027800
         END;                                                           20027900
      SLEEP([TOGLE],SHEETMASK); SHEETFREE~FALSE;                        20028000
     GOTSPACE~FALSE;                                                    20029000
     FOR LEVEL ~ 0 STEP 1 UNTIL SHEETMAX DO                             20030000
       BEGIN                                                            20031000
          LASTLINK ~ NEXTLINK ~ 0;                                      20032000
          IF (THISLINK~SHEET[LEVEL].[CF]) ! 0 THEN GO TO LEM;           20033000
CONTINUE: IF (THISLINK~NEXTLINK) ! 0 THEN GO TO LEM;                    20034000
       END;                                                             20035000
OOUT:                                                                   20035900
     SHEETFREE~TRUE; IF GOTSPACE THEN FORGETSPACE(S); GO TO EXIT;       20036000
                                                                        20037000
LEM: IF NOT GOTSPACE THEN                                               20038000
% GET SPACE FOR BUFFER TO HOLD SHEET, ZERO-TH SEGMENT                   20039000
         BEGIN S~IOQUE&SPACE(31)[CTC]; GOTSPACE~TRUE END;               20040000
% READ SHEET ENTRY INTO S                                               20041000
     DISKWAIT(-S.[CF],30,THISLINK);                                     20042000
     NEXTLINK ~ S[29];                                                  20043000
     T := SPACE(30);                                                    20049000
     DISKWAIT(-T,30,S[25]);                                             20050000
 F1:                                                                    20051000
     BELOW~FALSE;                                                       20060000
     LOGLINE ~ S[26];                                                   20060400
     PRIORITY ~ S[18];                                                  20060500
COMMENT JOB WILL BE RUN ONLY IF:                                        20068000
        1) AN XS OR ES MESSAGE HAS BEEN ENTERED FOR THIS JOB, (IN WHICH 20069000
           CASE SHEETDIDDLER TURNED ON S[2].[1:1] AND CALLED SELECTION),20070000
     OR 2) THE SUM OF THIS JOBS CORE REQUIREMENTS (S[20]) PLUS THE SUM  20071000
           OF THE CORE REQUIREMENTS OF ALL OTHER JOBS ACTUALLY RUNNING  20072000
           (CORE.[FF]) IS LESS THAN THE TOTAL AMOUNT OF CORE AVAILABLE  20073000
           FOR USER PROGRAMS (THE INITIAL SPACE AVAILABLE (CORE.[CF])   20074000
           TIMES THE MULTIPROCESSING FACTOR (CORE.[4:14])),             20075000
     OR 3) THE SUM OF THE CORE REQUIREMENTS OF ALL OTHER JOBS ACTUALLY  20076000
           RUNNING EQUALS ZERO (PRESUMABLY ONLY LOAD-CONTROL OR PRINT-  20076100
           BACKUP RUNNING, SO JOB SHOULD BE ABLE TO RUN);               20076200
     MIX~0;                                                             20076300
    IF (S2~S[2].[8:10])=5 THEN                                          20076800
    BEGIN                                                               20076900
     BELOW~TRUE;                                                        20076970
     S2~2;                                                              20076980
     IF S[2]<0 THEN GO TO JARSPACE;                                     20076990
     IF S[20] + CORE.[FF] { CORE.[CF]|CORE.[4:14]/100 THEN GO JARSPACE; 20077000
     IF CORE.[FF] ! 0 THEN GO TO PASS;                                  20077500
    END ELSE BEGIN IF S[2] LSS 0 THEN GO TO JARSPACE;                   20078000
         IF BACKGROUND THEN                                             20078005
         IF LOGLINE LEQ 0 OR                                            20078010
              SCHEDLINE[LOGLINE.[40:8] MOD (LMAX+1)] THEN               20078020
              IF BATCHSELECT(F,S[20],BELOW) THEN GO TO PASS;            20078100
    END;                                                                20078200
JARSPACE:                                                               20079000
     IF NOT BELOW THEN                                                  20079010
     IF (A1:=GETUSERDISK((A2:=(A3:=NOT FENCE INX 1) DIV 30 +            20079020
       P(A3 DIV 1890,DUP,+) +6)&1[2:47:1])) = 0 THEN                    20079030
     BEGIN STREAM(X:=S[*],A3:=A3:=SPACE(5));                            20079040
          BEGIN DS:=18 LIT"#NO SWAP DISK FOR ";                         20079050
               SI:=X; SI:=SI+1; DS:=7 CHR; DS:=LIT"/";                  20079060
               SI:=SI+1; DS:=7 CHR; DS:=LIT"~";                         20079070
          END;                                                          20079080
          SPOUT(A3);                                                    20079090
          GO TO PASS;                                                   20079100
     END;                                                               20079110
$INCLUDE 20079501, IF STATISTICS;                                       20079499
      JOBNUM:=JOBNUM+1;                                                 20079500
     COMMON:=SPACE(UVSIZE);                                         %R7520080000
     MOVE(UVSIZE,COMMON-1,COMMON);                                      20080500
     FOR MIX ~ 1 STEP 1 UNTIL MIXMAX DO IF JAR[MIX,*]=0 THEN GO LOAD;   20081000
     NEEDSELECT:=1;                                                 %R9320081500
     FORGETUSERDISK(A1,-A2);                                            20081600
     FORGETSPACE(COMMON);                                               20082000
     IF BELOW.[1:1] THEN SHEETFREE:=F NEQ 0;                            20082050
PASS: IF S[3]>0 AND SCHEDMSG THEN                                       20082100
      BEGIN S[3] ~ NABS(S[3]);                                          20082110
            IF F=0 THEN                                                 20082113
            DISKWAIT(S.[CF],30,THISLINK);                               20082115
            STREAM(C~LEVEL,A~S[*],ID~S[3].[8:10],                       20082120
                   Q~I~((NT1~(XCLOCK DIV 3600)) MOD 60+(NT1 DIV 60)|100)20082130
                   ,B~T);                                               20082140
            BEGIN SI~LOC C; DS~6 DEC; DI~DI-6; DS~5 FILL; DI~B; DI~DI+6;20082150
                  DS~LIT":"; SI~A; SI~SI+1; DS~7 CHR; DS~LIT"/";        20082160
                  SI~SI+1; DS~7 CHR; DS~LIT"="; SI~LOC ID; DS~2 DEC;    20082170
                  DS~11 LIT" SCHEDULED "; DS~4 DEC; DS~LIT"~";          20082180
            END STREAM;                                                 20082190
SMSG:           SPOUT(T);                                               20082240
      END ELSE FORGETSPACE(T);                                          20082250
      IF F!0 THEN                                                       20082252
         BEGIN DISKWAIT(F.[CF],30,T~GETESPDISK);                        20082254
              FORGETSPACE(S[7]);                                        20082255
              SLEEP([TOGLE],SHEETMASK); SHEETFREE~FALSE;                20082256
              IF PRIORITY>SHEETMAX THEN PRIORITY~SHEETMAX;              20082257
              IF SHEET[PRIORITY].[CF]!0 THEN                            20082258
              BEGIN DISKWAIT(-F.[CF],30,I~SHEET[PRIORITY].[FF]);        20082260
                   S[29]~T; DISKWAIT(F.[CF],30,I);                      20082262
              END ELSE SHEET[PRIORITY]~T;                               20082264
              SHEET[PRIORITY].[FF]~T;                                   20082266
              GO TO OOUT;                                               20082268
         END;                                                           20082269
      LASTLINK~THISLINK;                                                20082270
      IF MIX{MIXMAX THEN GO CONTINUE ELSE GO OOUT;                      20082280
LOAD: % FILE HEADER NOW BECOMES JAR ENTRY                               20082300
     IF BELOW THEN                                                      20082310
     CORE.[FF] := CORE.[FF] + S[20];   % ADD IN CORE REQUIREMENTS       20082320
     UVROW[MIX]:=UVROW[0]&COMMON[CTC]&BELOW[7:1:1];                     20082360
     SINFO[MIX]~0&S[20][CTF];                                           20082400
     SQ[MIX]~-0;                                                        20082500
     STREAM(DATE:A~0); BEGIN SI~LOC DATE; DI~ LOC DATE; DS~8 OCT END;   20082600
     COMMON ~ (XCLOCK+P(RTR))&P(XCH)[1:25:23];                          20082800
     ESED~S[2].[2:1];                                                   20082810
     JARROW[MIX] ~ [M[T]]&30[8:38:10];                                  20082900
     JAR[MIX,0] ~ S[0];                                                 20082990
     JAR[MIX,1] ~ S[1];                                                 20083000
     JAR[MIX,2] ~ S[2]&S2[8:38:10];                                     20083100
     JAR[MIX,3] ~ S[16];                                                20083200
     JAR[MIX,4] ~ S[17];                                                20083300
     JAR[MIX,5] ~ COMMON;                                               20083400
     JAR[MIX,6] ~ S[6];                                                 20083500
     JAR[MIX,7] ~ S[14];                                                20084000
     COMMON ~ S[19];                                                    20085000
     IF (STACKSIZE:=S[21])<128 THEN STACKSIZE:=120;                     20086000
     SINFO[MIX].[1:17] ~ (CLOCK+P(RTR)) DIV 60;                         20086500
     PROCTIME[MIX] ~ -S[16]-CLOCK-P(RTR);                               20087000
     IOTIME[MIX] ~ -S[17];                                              20087100
     USERCODE[MIX]:= ABS(S[24]);                                        20087200
     PRYOR[P1MIX:=MIX] := -1;                                           20088000
     DAT[MIX] := -1;                                                    20088100
         IF LOGLINE.[33:7] NEQ 0 THEN                               %R7520088120
         BEGIN STATABLE[LOGLINE.[40:8]].MIXFLAG:=IOD:=                  20088130
                   (IF JAR[MIX,0].[1:2] NEQ 0                       %R7520088140
                        THEN 32 ELSE 0)+P1MIX;                      %R7520088150
              DAT[MIX].NDSABLE:=JAR[MIX,0].[2:1];                       20088160
              IF IOD LSS 32 THEN TWXOUT(0,0,1,LOGLINE);                 20088200
         END;                                                       %R7520088210
         REPORTBACK(BOJW,MIX,0);                                    %R7520088500
     IF BELOW THEN                                                      20088600
     BEGIN FRONTEND(MIX);                                           %R7520088700
          STASUS[MIX] := SELECTING;                                     20088800
     END ELSE                                                           20088900
     BEGIN DISKSTORE[MIX] := A1;                                        20089000
         INITIALSWAP(S[20].[CF]);                                       20089100
     END;                                                               20089150
     IF S[0]="CANDE  " AND S[1]="TSHARER" THEN                          20089200
         STARTCANDY(ESED,PRIORITY);                                     20089210
    NT1 ~ IF BELOW THEN 518400000 ELSE 180;                             20089300
     IOCOUNT[MIX]~-1;                                                   20089400
     ELAPSEDLIMIT[MIX]:=IOTIME[MIX]+NT1+NT1;                        %R5920089500
     PROCLIMIT[MIX]~PROCTIME[MIX]+CLOCK+P(RTR)+NT1;                     20089600
     OLAYCTR[MIX]:=UPOLAY(NT1);                                     %R3820089700
     IF S2=0 THEN                                                       20090000
         FORGETESPDISK(S[25]);                                          20091000
              STREAM( Q:=                                               20092985
              FSROW[MIX] ~ [M[GETSPACE(4,0,1)+2]]&4[8:38:10]);          20092990
                   DS:= 32 LIT "0";                                     20092995
         A1:=JAR[MIX,0];A2:=JAR[MIX,1];A3:=USERCODE[MIX];               20093000
         IF LOGLINE LSS 0 THEN                                          20093010
              DISKWAIT(-(T:=SPACE(10)),10,S[6].[CF])                    20093014
         ELSE BEGIN                                                     20093020
         IF (T:=S[2].[8:10])=0 OR T=2 OR T=5 THEN                       20093030
         BEGIN                                                          20093035
         STREAM(C:=12,A3,A1,A2,B:=T:=SPACE(9));                         20093040
               BEGIN SI:=LOC C;SI:=SI+7;DS:=1 CHR;                      20093050
                     DS:=5LIT"USER=";SI:=SI+1;DS:=7 CHR;                20093060
                     DS:=9LIT"; EXECUTE ";SI:=SI+1;DS:=LIT" ";DS:=7 CHR;20093070
                     DS:=LIT"/";SI:=SI+1;DS:=7 CHR;DS:=34LIT" ";        20093075
               END;                                                     20093080
          END ELSE                                                      20093085
          BEGIN                                                         20093090
          STREAM(C:=12,A2,A3,A1,B:=T:=SPACE(9));                        20093100
             BEGIN SI:=LOC C;SI:=SI+7;DS:=1 CHR;                        20093110
                   DS:=7LIT"COMPILE";SI:=SI+1;DS:=5LIT" ";DS:=7 CHR;    20093120
                   DS:=LIT"/";SI:=SI+1;DS:=7 CHR;DS:=5LIT" ";SI:=SI+1;  20093130
                   DS:=7 CHR;DS:=14LIT"     LIBRARY ";DS:=18LIT" ";     20093135
             END;                                                       20093140
         END;                                                           20093145
         DISKWAIT(T.[CF],10,JAR[MIX,6]:=S[6]:=GETESPDISK);              20093160
          END;                                                          20093170
          MAKELOG(T.[CF]-1,CNTRLCARD);                                  20093175
          FORGETSPACE(T);                                               20093180
          STREAM(C:=LOGLINE.[40:8]|(LOGLINE.[33:7] NEQ 0),PRIORITY,     20093200
                 KT:=(A3 NEQ A2 AND A3 NEQ 0)+2,                        20093210
                 A1,A2,A3,MIX,Q:=I:=((NT1:=(XCLOCK DIV 3600)) MOD       20093300
                 60+(NT1 DIV 60)|100),B:=T:=SPACE(10));                 20093400
            BEGIN SI:=LOC C;DS:=4DEC;DS:=LIT" ";DS:=4DEC;DS:=LIT":";    20093500
                 DI~DI-5; DS~3FILL;DI~DI-1;DS~LIT"-";DI~B; DS~8 FILL;   20094000
                 DI:=B; DI:=DI+10; SI := LOC A1;                        20094100
                 KT(SI~SI+1; DS~7 CHR; DS~LIT"/");                      20094500
                 SI~LOC MIX; DI~DI-1; DS~LIT"="; DS~2 DEC;              20095000
                  DS~5 LIT" BOJ "; DS~4 DEC; DS~LIT"~";                 20096000
             DI~DI-12; DS~FILL;                                         20096400
            END STREAM;                                                 20096500
         WHILE FALSE DO;     % KLUDGE BECAUSE  OF CONSTANTS CLEAN       20096990
 $ VOID 20097901                                                    %R7520097000
         SPOUTIT(T,((NOT JAR[MIX,0]).[2:1] OR CANDYMESS)            %R2020098000
              AND BOJMESS OR BOJK);                                 %R2020098100
     SAVETIME ~ S[22];                                                  20099000
     LEQLINK1 ~ S[15]; LEQLINK2 ~ S[13];                                20100000
     DELINK;                                                            20100100
     IF INTSIZE=0 THEN                                                  20100190
     IF  ((S[1] EQV "DISK   ")=NOT 0) AND                               20100200
         (((S[0] EQV "PRNPBT ")=NOT 0) OR                               20100202
         ((S[0] EQV "LDCNTRL")=NOT 0) OR                                20100204
         ((S[0] EQV "LIBMAIN")=NOT 0)) THEN ELSE                        20100206
     BEGIN                                                              20100210
         NT3~SPACE(4);                                                  20100220
         STREAM(NT3);                                                   20100230
         DS~24LIT"##NO INTRINSICS FILE...~";                            20100240
         SPOUT(NT3);                                                    20100250
         SLEEP([INTSIZE],@1777);                                        20100300
     END;                                                               20100310
%   READ SEGMENT ZERO INTO S                                            20100400
     IF F!0 THEN                                                        20100500
         BEGIN FORGETSPACE(S);                                          20100600
              S~S&S[7] [CTC];                                           20100700
         END ELSE                                                       20100900
     DISKWAIT(-S.[CF],30,JAR[MIX,10]);                                  20101000
      JAR[P1MIX,2]~P(DUP,LOD)&S[2][1:1:2]&S[7][3:2:1];                  20102000
      S[2]~ABS(P(DUP,LOD));                                             20102100
     SINFO[MIX].[CF]~STACKLOC~GETSPACE(STACKSIZE+S[3]+64,0,1)+2;        20103000
     T ~ (STACKLOC + STACKSIZE OR 63) + 1;                              20103200
%   ZERO OUT STACK TO EASE PROBLEMS OF CONGENITAL DUMP-READERS      %WF 20103210
     M[STACKLOC] ~ @3333333333333333;%                                  20103220
     MOVE(T-STACKLOC-1,STACKLOC,STACKLOC+1);%                       %WF 20103230
     S[7].[18:15] ~ 0;                                                  20103400
%   READ  PRT  INTO  PRTTOW [MIX]%                                      20104000
         DISKWAIT(-T,S[3],                                              20105000
              I~JAR[MIX,S[2] DIV JAR[MIX,8]+10]+S[2] MOD JAR[MIX,8]);%  20106000
         TRP ~ PRTROW[MIX]~[M[T]]&1023[8:38:10];                        20107000
 $ VOID 20108801                                                    %R8120108000
%   READ  IN  S.D.  &  FIX PRT [4]%                                     20109000
         SEGD[MIX] ~                                                    20109100
         TRP[4] ~ [M[T~GETSPACE(S[1], 1, 1)+2]];%                       20110000
         DISKIO(IOD,1-T,S[1],I~JAR[MIX,S[0].[CF] DIV JAR[MIX,8]+10]+    20111000
              S[0].[CF] MOD JAR[MIX,8]);                                20112000
%                                                                   %R8120112100
         DALOCROW[P1MIX]:=[M[T:=SPACE(7)]]&7[8:38:10];MOVE(7,T-1,T);%R6820112200
         IF (DALOC[P1MIX,1] ~ GETUSERDISK(500 OR MEMORY))!0             20112300
           THEN DALOC[P1MIX,0] ~ @200002;                               20112400
         OLAYMASK ~ TWO(P1MIX) OR OLAYMASK;                             20112500
%   READ IN FPB & FIX PRT [3]%                                          20113000
         M[(FPB~SPACE(S[5]+1))+S[5]]~0;                                 20114000
         FPBD[MIX] ~                                                    20114100
         TRP[3]~[M[FB~GETSPACE(S[7]|ETRLNG+(S[7]=0),0,1)+2]]            20115000
                        &  (S[7]|ETRLNG)[8:38:10];%                     20116000
         SLEEP([IOD],IOMASK);%                                          20117000
         DISKIO ( IOD,1-FPB , S[5] ,%                                   20118000
              I~JAR[MIX,S[4] DIV JAR[MIX,8]+10]+S[4] MOD JAR[MIX,8]);%  20119000
%   INITIALIZE OTHER PRT CELLS%                                         20120000
         TRP [0]~@2525252525252525;%                                    20121000
         TRP[2]~MEMORY;%                                                20122000
         TRP[10]~TRP&(STACKLOC+1)[18:33:15];%                           20123000
         IF JAR[MIX,0]< 0 THEN%                                         20124000
              BEGIN%                                                    20125000
                 IF S2=4 THEN                                           20126000
                   TRP[@26] ~ SAVETIME ELSE IF S2=3 THEN                20127000
                   BEGIN TRP[@26] ~ -1; JAR[MIX,2].[8:10] ~ 2 END;%     20128000
              END;%                                                     20129000
 FOR I:=@25 STEP 1 WHILE COMMON NEQ 0 AND I LSS S[3] DO     %JH428      20130000
              IF TRP[I] = 0 THEN%                                       20131000
                   BEGIN TRP[I] ~ COMMON; COMMON ~ 0 END;%              20132000
         M[TRP[4]]~S[1]-1;%                                             20133000
              TRP[6]~FLAG(0&[TRP[6]][18:33:15]&32[8:38:10]);%           20134000
              IF JAR[MIX,2]}0 THEN                                      20134400
              TRP[11]~FLAG(0&[TRP[11]][18:33:15]&8[8:38:10]);           20134500
%   BRING IN STARTING SEGMENT&BUILD CONTROL WORDS FOR INITIATE%         20135000
         MAKEPRESENT(TRP INX POLISH(S[6],TRP[4],INX,LOD).[8:10]);%      20136000
         M[STACKLOC+2]~-FLAG(POLISH(S[6],TRP[4],INX,LOD)%               20137000
                        .[18:15]);%                                     20138000
         M[STACKLOC+1]~ -FLAG( 0 &(TRP)[6:33:9]);%                      20139000
         M[STACKLOC]~ @2222222222222222 ;%                              20140000
         TRP[8] ~ -FLAG(STACKLOC+2) ;%                                  20141000
         IF (J~TRP[4].[18:6])!0 THEN%                                   20141100
           INTABLEROW[MIX] ~ INTABLEROW[J]%                             20141200
         ELSE BEGIN S2 := INTSIZE+(P(DUP)=0);                           20141300
              INTABLEROW[MIX] := [M[GETSPACE(S2,1,1)+2]]&S2[8:38:10];   20141400
              STREAM(A~INTSIZE, T~INTABLEROW[MIX]);%                    20141500
              BEGIN SI~T;  SI~SI-8;  DS~A WDS;  END;%                   20141600
         END;%                                                          20141700
         SLEEP([IOD], IOMASK);%                                         20141800
%   MOVE  MFID,FID,TYPE ,REEL=CYCLE=DATE=0   TO  FB  FROM  FPB%         20142000
         STREAM( FPB, FB,TEMP~0,C~0);%                                  20143000
              BEGIN%                                                    20144000
              SI ~ FPB;  DI ~ FB;%                                      20145000
       LL:%                                                             20146000
              IF SC="0" THEN BEGIN SI~SI+1;IF SC="0"THEN%               20147000
                   GO TO XXIT  END%                                     20148000
              ELSE  SI~SI+1 ;  SI~SI+2;%                                20149000
           2( DS~LIT "0"; DS~7CHR);%                                    20150000
              SI ~ SI - 15;%                                            20151000
              DS ~  15 LIT"0";%                                         20152000
              DS ~ CHR;%                                                20153000
              DS ~ 8 LIT "0";%                                          20154000
              SI~SI+14;%                                                20155000
              TEMP ~ DI ;%                                              20156000
              DI~LOC C ; DI~DI+7; DS~CHR; SI~SI+C;%                     20157000
              DI~TEMP    ;%                                             20158000
              GO TO LL;%                                                20159000
    XXIT:     END;%                                                     20160000
%   LABEL EQUATION PROCESSING%                                          20161000
     FOR L ~ 1 STEP 1 UNTIL 2 DO                                        20161100
       BEGIN                                                            20161200
         LINK ~ IF L THEN LEQLINK1 ELSE LEQLINK2;                       20161300
         WHILE LINK ! 0 DO                                              20162000
              BEGIN%                                                    20163000
              DISKWAIT(-S.[CF],30,                                      20164000
                     IF L THEN (I~JAR[MIX,LINK DIV JAR[MIX,8]+10] +     20164100
                                          LINK MOD JAR[MIX,8])          20164200
                          ELSE LINK);                                   20164300
                                                                        20165000
              I ~ 0;                                                    20166000
              IF NOT L THEN FORGETESPDISK(LINK);                        20167000
              LINK ~ S[29];                                             20168000
              IF S[0] = 14 THEN GO TO STOP;                             20169000
         UNBLK:%                                                        20170000
              STREAM (FN~0:ZERO~0,T2~0, FPB,F~[S[14|I+4]],C~0);%        20171000
              BEGIN%                                                    20172000
              SI ~ F; DI~LOC C; DI~DI+7 ; DS~CHR;%                      20173000
              SI ~ FPB;%                                                20174000
         L:%                                                            20175000
              DI~LOC FN; DI~DI+6; DS~2 CHR;%                            20176000
              DI ~ LOC ZERO;  SI~SI-2;%                                 20177000
              IF 2 SC = DC THEN GO TO XXIT;%                            20178000
              SI ~ SI+15;%                                              20179000
              DI ~ F;%                                                  20180000
              IF SC = DC THEN%                                          20181000
                   BEGIN%                                               20182000
                   IF C SC=DC THEN GO TO XXIT END%                      20183000
              ELSE%                                                     20184000
                   BEGIN%                                               20185000
                   SI~SI-1; DI~LOC T2; DI~DI+7; DS~CHR;%                20186000
                   SI~SI+T2;%                                           20187000
                   END;%                                                20188000
              GO TO L;%                                                 20189000
         XXIT:%                                                         20190000
              END;%                                                     20191000
    IF ( T~POLISH) ! 0 THEN%                                            20192000
         BEGIN;%                                                        20193000
         STREAM ( X~[S[14|I]],%                                         20194000
                        Y ~ (T-1)|ETRLNG+FB);%                          20195000
              BEGIN%                                                    20196000
              SI~X; DS~3 WDS; DS~ 7 CHR;%                               20197000
              IF SC ! "~" THEN IF SC !""" THEN DS ~ CHR ELSE DS ~ SET;% 20198000
              END;%                                                     20199000
         END;%                                                          20200000
         IF (I~I+1)= 1 THEN IF S[14]!14 THEN GO TO UNBLK;%              20201000
              END;                                                      20201500
    STOP:                                                               20202000
       END OF LABELEQUATION;                                            20203000
                                                                        20204000
         FORGETSPACE ( FPB);%                                           20205000
                                                                        20206000
         IF ESED THEN % CALL TERMINATE                                  20207000
           BEGIN                                                        20207100
              FORGETSPACE(S); SHEETFREE ~ TRUE;                         20208000
              TERMINATE(MIX&35[CTF]);%                                  20209000
         END ELSE                                                       20209100
         IF STACKSIZE<128 THEN                                          20209110
         BEGIN FORGETSPACE(S);  ESED := 1;                              20209120
              IF F=0 THEN SHEETFREE:=1;                                 20209125
              TERMINATE(MIX&1[CTF]);                                    20209130
         END;                                                           20209140
         STASUS[MIX]:=RUNNING;                                          20209150
$INCLUDE 20209161, IF STATISTICS;                                       20209159
         TIMING[MIX]:=CLOCK+P(RTR);                                     20209160
         SAVEMIX(P1MIX,LOGLINE);  P1MIX ~ 0;                            20209200
         PRYOR[MIX] ~ PRIORITY;                                         20209300
         IF F=0 THEN                                                    20209400
              IF ESED THEN GO TO START ELSE GO TO CONTINUE;             20209500
         IF NOT ESED THEN FORGETSPACE(S);                            %DS20209600
         IF BELOW.[1:1] THEN SHEETFREE:=1;                              20209700
    EXIT::%                                                             20210000
         KILL([RCW] INX NOT 2);                                         20210500
         END  SELECTION ROUTINE ;%                                      20211000
         DEFINE%                                                        20212000
              COMMA     = 10#,%                                         20213000
              EQUAL     = 11#,%                                         20214000
              PERIO     = 12#,%                                         20215000
              SLASH     = 13#,%                                         20216000
              QUEST     = 14#,%                                         20217000
              POUND     = 15#,%                                 %LP 1   20217500
              SPECI     = 19#,%                                         20218000
              IDENT     = 20#,%                                         20219000
              UNLOCKV   = 23#,%                                         20219050
              USEV      = 24#,                                          20219100
              LOCKV     = 25#,%                                         20219200
              FREE      = 26#,                                          20219300
              OPEN      = 27#,                                          20219310
              USER      = 28#,                                          20219400
              RUNV      = 29#,                                          20219500
              COMPI     = 30#,%                                         20220000
              EXECU     = 31#,%                                         20221000
              COPY      = 32#,                                          20222000
              UNLOAD    = 33#,                                          20223000
              ADDV      = 34#,                                          20224000
              ENTER     = 35#,                                          20224500
              REMOV     = 36#,                                          20225000
              CHANG     = 37#,                                          20225500
              ENDFI     = 39#,%                                         20226000
              DATAV     = 40#,%                                         20226500
              LABEV     = 41#,%                                         20227000
         SETV           =42#,                                           20228000
         RESETV         =43#,                                           20228100
         FILEV          =47#,                                           20228200
         EXPIRED        =48#,                                           20228300
         ACCESSD        =49#,                                           20228400
              PROCE     = 50#,% A STORE NEAR THE END OF PCC             20229000
              IO        = 51#,%  MAKES USE OF THE ORDER AND VALUES      20230000
              PRIOR     = 52#,%  OF "PROCE" THRU "SAVEV".               20231000
              COMMONV   = 53#,%                                         20232000
              COREV     = 54#,%                                         20232500
              STACK     = 55#,%                                         20233000
              SAVEV     = 56#,%  (SAVE #DAYS ON COMPILE TO LIBRARY)     20233500
              ALGOL     = 60#,%                                         20234000
         FORTRAN        = 62#,%                                         20235000
         TSPOL          =63#,                                           20235050
              BASIC = 64#,                                              20235075
         COBOL68        =65#,                                           20235080
         WITH           = 66#,                                          20235099
         COBOL          = 67#,                                          20235100
              LIBRA     = 68#,%                                         20236000
              SYNTA     = 69#,%                                         20237000
              FROM      = 70#,%                                         20238000
              TOV       = 71#,%                                         20239000
              FORM      = 78#,    %SWITCH D(PCC) "FORM"-"SPECIAL"%      20240000
              NO        = 79#,%                                         20241000
              DISK      = 80#,%                                         20242000
              TAPE      = 81#,%                                         20243000
              PUNCH     = 82#,%                                         20244000
              PRINT     = 83#,%                                         20245000
              BACK      = 85#,%                                         20246000
              SPECIAL=89#,%                                             20247000
              EU        =91#,                                           20247600
              SLOW      =92#,                                           20247700
              B6500    =93#,                                            20247800
              FAST      = 94#,                                          20247900
              PAPER     = 84#;%                                         20248000
COMMENT  RESWDS CONTAINS RESERVED WORDS FOR CONTROL CARDS;%             20249000
         PROCEDURE  RESWDS    ;%                                        20250000
         BEGIN   LABEL  L;%                                             20251000
         POLISH (XIT); POLISH(.L,DEL);%                                 20252000
   L:::%                                                                20253000
              "UNLOCK ",     23,%                                       20253050
              "USE    ",     24 ,                                       20253100
              "LOCK   ",     25,%                                       20253200
              "FREE   ",     26 ,                                       20253300
              "PUBLIC ",     27 ,                                       20253310
              "USER   ",     28 ,                                       20253400
              "RUN    ",     29,                                        20253500
              "COMPILE",     30 ,  % SWITCH TYPE(CONTROLCARD)%          20254000
              "EXECUTE",     31 ,  %  "RUN" - "LABEL"                   20255000
              "DUMP   ",     32,                                        20256000
              "UNLOAD ",     33,                                        20257000
              "ADD    ",     34,                                        20258000
              "LOAD   ",     35,                                        20259000
              "REMOVE ",     36,                                        20260000
              "CHANGE ",     37,                                        20260500
              "UNIT   ",     38,%                                       20261000
              "END    ",     39,%                                       20261500
              "DATA   ",     40,%                                       20262000
              "LABEL  ",     41,%                                       20263000
         "SET    ", 42,                                                 20264000
         "RESET  ", 43,                                                 20264100
         "FILE   ", 47,                                                 20264300
         "EXPIRED", 48,                                                 20264400
         "ACCESSD", 49,                                                 20264500
              "PROCESS",     50 ,%   A STORE NEAR THE END OF PCC        20265000
              "IO     ",     51 ,%    MAKES USE OF THE ORDER AND VALUES 20266000
              "PRIORIT", 52, %OF "PROCESS" THRU "SAVE".                 20266500
              "COMMON ",     53 ,%                                      20267000
              "CORE   ",     54 ,%                                      20267500
              "STACK  ",     55 ,%                                      20268000
              "SAVE   ",     56 ,%                                      20268500
              "ALGOL  ",     60 ,%                                      20269000
              "XALGOL ",     61 , %                                     20269100
         "FORTRAN",          62,%                                       20270000
         "TSPOL  ",          63,                                        20270050
              "BASIC  ",   64,                                          20270075
         "COBOL68",          65,                                        20270080
         "WITH   ",          66,                                        20270099
         "COBOL  ",          67,                                        20270100
              "LIBRARY",     68 ,%                                      20271000
              "SYNTAX ",     69 ,%                                      20272000
              "FROM   ",     70 ,%                                      20273000
              "TO     ",     71 ,%                                      20274000
              "FORM   ",     78 ,  % SWITCH D(PCC)%                     20275000
              "NO     ",     79 ,  %   "FORM"-"SPECIAL"%                20276000
              "DISK   ",     80 ,%                                      20277000
              "TAPE   ",     81 ,%                                      20278000
              "PUNCH  ",     82 ,%                                      20279000
              "PRINT  ",     83 ,%                                      20280000
              "BACK   ",     85 ,%                                      20281000
              "SPECIAL",89,%                                            20282000
              "SERIAL ",86,%                                            20283000
              "UPDATE ",87,%                                            20284000
              "SPO    ",88,%                                            20285000
              "PAPER  ",     84 ,%                                      20286000
              "EU     ",91,                                             20286100
              "SLOW   ",92,                                             20286200
          "B6500  ",93,                                                 20286300
              "FAST   ",94,                                             20286400
              "CC     ",     14 ,  % CC MUST = QUEST%                   20287000
                           0,0 ;  END  ;%                               20288000
ARRAY DIRECT[*];                                                        20288500
                                                                        20289000
COMMENT  FETCH READS THE NEXT CONTROL CARD  ,  SETS SOURCE TO BEGINNING 20290000
         OF CARD , SETS LAST WORD OF CARD TO PERIOD.      ;%            20291000
    PROCEDURE FETCH(UNITNO,CARDLOC,SOURCE);                             20292000
              VALUE UNITNO,CARDLOC;                                     20292100
              REAL  UNITNO,CARDLOC,SOURCE ;                             20292200
         BEGIN%                                                         20293000
               REAL T,E;                                                20294000
               E:=@14&UNITNO[45:1:1]; UNITNO:=ABS(UNITNO);              20294800
                                                                        20295000
              IF UNITNO}32 THEN T~                                      20296000
                   READEMFROMDISK(CIDROW[UNITNO-32],%                   20297000
                        [M[CARDLOC]]&10[8:38:10]) ELSE%                 20298000
      DO BEGIN T~                                                       20298100
IF UNITNO=30 THEN 0 ELSE                                                20298111
               WAITIO(CARDLOC INX @40000000,E,UNITNO);                  20299000
              IF UNITNO=25 THEN MAKELOG(CARDLOC.[CF]-1,SPIN);           20299010
              IF UNITNO=30 OR T.[45:1] THEN                             20299020
                 STREAM(CARDLOC);                                       20299030
                 BEGIN DS:=LIT MARK;DS:=4 LIT "END." END;               20299040
              IF UNITNO=25 THEN                                         20299110
              BEGIN                                                     20299111
              STREAM(T~0:CARDLOC);%                                     20300000
              BEGIN SI~CARDLOC;DI~LOC T;DI~DI+6;SI~SI-1;DS~2CHR;SI~SI-1;20301000
                   DI~CARDLOC;DI~DI-1;DS~LIT"<";8(60(IF SC="~" THEN     20301100
                   BEGIN DS~CHR;JUMP OUT 2 TO L END;IF SC="<" THEN      20301200
                   BEGIN DI~DI-1;IF SC!DC THEN DI~DI-1 END ELSE         20301300
                   DS~CHR));                                            20301400
              L:   DI~CARDLOC;DI~DI-1;SI~LOC T;SI~SI+6;DS~CHR;          20301500
              END;                                                      20301600
              END ELSE P(0);                                            20301700
         END UNTIL P.[42:6]!31;                                         20302000
         M[(SOURCE ~ CARDLOC)+9]~0&"."[1:43:5];%                        20303000
         END    ;%                                                      20304000
COMMENT THE SCAN ROUTINE IS USED FOR CONTROL CARD SCANNING.%            20305000
              SCAN  RETURNS THE FOLLOWING RESULTS :%                    20306000
                   4  FOR IDENTIFIERS WHICH ARE NOT RESERVED%           20307000
                   0  FOR PERIOD%                                       20308000
                   1  FOR SLASH%                                        20309000
                   2  FOR QUESTION MARK%                                20310000
                   5...  FOR IDENTIFIERS IN DIRECT.%                    20311000
                   3  FOR OTHER SPECIAL CHARACTERS.%                    20312000
                   13  FOR "PRIORITY"                 ;%                20313000
 REAL PROCEDURE SCN(UNITNO,CARDLOC,SOURCE,ACCUM,COUNT,LASTSCAN);        20314000
              VALUE UNITNO,CARDLOC                             ;        20314100
               REAL UNITNO,CARDLOC,SOURCE,      COUNT,LASTSCAN ;        20314200
              ARRAY                       ACCUM[*]             ;        20314300
         BEGIN%                                                         20315000
         LABEL  GOGO,       TYPE0,TYPE1,TYPE2;%                         20316000
         SWITCH TYPE ~ TYPE0,TYPE1,TYPE2 ;%                             20317000
         REAL  I;%                                                      20319000
         LABEL PERPER;%                                                 20320000
    GOGO:%                                                              20321000
         IF LASTSCAN THEN%                                              20322000
              BEGIN IF LASTSCAN < 0 OR UNITNO = 31 THEN%                20323000
                        BEGIN I ~ QUEST; LASTSCAN ~ 0; GO TO TYPE1 END; 20324000
                   FETCH(UNITNO,CARDLOC,SOURCE); LASTSCAN~0;            20325000
              END;%                                                     20326000
         I ~ IDENT;%                                                    20327000
         STREAM (J~0,K~0,SOURCE : ACCUM);%                              20328000
              BEGIN%                                                    20329000
              SI ~ SOURCE ; DI ~ ACCUM ;  DI~DI+1;%                     20330000
         L:   IF SC = " " THEN BEGIN SI~SI+1; GO L END;%                20331000
              IF SC = ALPHA THEN%                                       20332000
                   BEGIN%                                               20333000
              IF SC =@14 THEN GO TO L3;%                                20334000
                   DS ~ CHR ; TALLY ~ 1;%                               20335000
              L1:  63(IF SC=ALPHA THEN BEGIN DS~CHR;%                   20336000
                        TALLY~TALLY+1 END ELSE JUMP OUT);%              20337000
                   K~TALLY; TALLY~0; J~TALLY;  DS~8 LIT" ";%            20338000
                   END%                                                 20339000
              ELSE IF SC = """ THEN%                                    20340000
                   BEGIN    SI ~ SI+1;%                                 20341000
      30(IF SC!""" THEN IF SC!"." THEN IF SC!"~" THEN BEGIN DS~CHR;     20342000
          TALLY~TALLY +1 END ELSE JUMP OUT TO L3                        20342200
          ELSE JUMP OUT);                                               20342600
                   SI~SI+1;%                                            20343000
                   K~TALLY; TALLY~1; J~TALLY; DS~8 LIT" ";%             20344000
                   END%                                                 20345000
              ELSE BEGIN%                                               20346000
         L3:%                                                           20347000
                   TALLY ~ 2; J~TALLY; DI~LOC K; DI~DI+7; DS~CHR ;%     20348000
                   END;%                                                20349000
              SOURCE ~ SI;%                                             20350000
                   END;%                                                20351000
COMMENT  STACK NOW CONTAINS :  0 FOR IDENTIFIER & NO. OF CHRS%          20352000
                               1 FOR "ID"       & NO. OF CHRS%          20353000
                               2 FOR SPECIAL CHR & ACTUAL CHR   ;%      20354000
         P([SOURCE],~);                                                 20355000
         P([COUNT],~);                                                  20356000
         GO TO TYPE[POLISH];%                                           20357000
     TYPE0:%                                                            20358000
          BEGIN                                                         20361000
         I~-2;   WHILE  DIRECT[I~I+2]!0  DO%                            20362000
              IF (DIRECT[I] EQV ACCUM[0])= NOT 0  THEN%                 20363000
              BEGIN IF DIRECT[I+1]!QUEST OR (UNITNO=25 OR UNITNO}30)    20364000
                        AND CARDLOC.[CF]=SOURCE.[CF] THEN               20364500
                   BEGIN I~DIRECT[I+1];GO TO TYPE1 END END;%            20365000
              I ~ IDENT  ;  END;%                                       20366000
         GO TO TYPE1  ;%                                                20367000
    TYPE2:%                                                             20368000
         IF COUNT="~" OR%                                               20369000
              COUNT ="." THEN%                                          20370000
                   BEGIN LASTSCAN ~ 1;%                                 20371000
    PERPER:             I ~ PERIO; GO TO TYPE1;%                        20372000
                   END;%                                                20373000
         IF COUNT="-" THEN BEGIN IF UNITNO}32 THEN                      20374000
                                 IF CIDTABLE[UNITNO-32,3]}              20374100
                                    CIDTABLE[UNITNO-32,7] THEN          20374200
                                    BEGIN I~ENDFI; GO TO TYPE1 END;     20374300
                                 IF UNITNO = 31 THEN                    20374310
                                 BEGIN I~PERIO; GO TO TYPE1 END;        20374320
                                 FETCH(UNITNO,CARDLOC,SOURCE);          20374400
                                 GO TO GOGO;                            20374500
                           END;                                         20374600
         IF COUNT = ";" THEN%                                           20375000
              BEGIN LASTSCAN ~ -1; GO TO PERPER END;%                   20376000
         I ~ IF COUNT ="/" THEN SLASH ELSE%                             20377000
                  (IF COUNT = @14 THEN QUEST ELSE%                      20378000
                  (IF COUNT =","  THEN COMMA ELSE%                      20379000
                  (IF COUNT="=" THEN EQUAL ELSE %               %LP 1   20380000
              (IF COUNT="#" THEN POUND ELSE SPECI))));          %LP 1   20380500
    TYPE1: SCN~I;                                                       20381000
                END   SCAN  ;%                                          20382000
 PROCEDURE SEEKNAM(A,B,C,D,E,N); VALUE A,B; REAL A,B,C,D,E,N;           20382010
         BEGIN                                                          20382020
         LABEL FIND,L;                                                  20382030
         ARRAY NB[*];                                                   20382040
         REAL I,T; INTEGER J;                                       %10420382050
         INTEGER J1,J2,J3,K1,K2;                                    %10420382052
         LABEL RESTART;                                             %10420382054
         IF C=0 THEN                                                %10420382056
         BEGIN N:=SPACE(60)-1;                                      %10420382058
              J1:=J3:=0; K1:=K2:=MODULUS-1;                         %10420382060
              IF A GEQ 0 THEN J1:=K1:=(A.[6:18]+A.[24:24]) MOD MODULUS; 20382062
              IF B GEQ 0 THEN J3:=K2:=(B.[6:18]+B.[24:24]) MOD MODULUS; 20382064
         END ELSE                                                   %10420382066
         BEGIN I:=(T:=M[N]).[42:6];                                 %10420382068
              J1:=T.[36:6]; J2:=T.[30:6]; J3:=T.[12:6];             %10420382070
              K1:=T.[24:6]; K2:=T.[18:6];                           %10420382072
         END;                                                       %10420382074
         NB:=[M[N+1]]&60[8:38:10];                                  %10420382076
         LOCKDIRECTORY;                                                 20382080
         IF C NEQ 0 THEN GO TO RESTART;                             %10420382095
         FOR J1:=J1 STEP 1 UNTIL K1 DO                              %10420382100
         FOR J2:=J3 STEP 1 UNTIL K2 DO                              %10420382110
         BEGIN J:=SCRAMBLE(J1,J2);                                  %10420382120
              DO BEGIN                                              %10420382130
                   DISKWAIT(-N-1,60,J);                             %10420382140
                   FOR I:=0 STEP 3 UNTIL 57 DO                      %10420382150
                   BEGIN                                            %10420382160
                   IF (T:=NB[I]) NEQ @14 THEN                       %10420382165
                   IF (T EQV A)=NOT 0 OR A<0 THEN                       20382170
                   IF (NB[I+1] EQV B)=NOT 0 OR B<0 THEN GO FIND;        20382180
 RESTART:          END;                                             %10420382190
              END UNTIL (J:=NB[2].[FF])=0;                          %10420382195
              END;                                                      20382200
         FORGETSPACE(NB);                                           %10420382202
         C:=0;                                                      %10420382204
         GO TO L;                                                   %10420382206
    FIND:                                                               20382210
         D~NB[I];E~NB[I+1];                                             20382220
         C:=NB[I+2].[CF];                                           %10420382225
         M[N]:=I&J1[36:42:6]&J2[30:42:6]&K1[24:42:6]&K2[18:42:6]&   %10420382226
             J3[12:42:6];                                           %10420382227
    L:   UNLOCKDIRECTORY;                                               20382230
         END;      % SEEKNAME                                           20382240
 REAL PROCEDURE PPC                                                     20383000
         (ADDR,EQN,X,DEX,TYPE,UNITNO,CARDLOC,SOURCE,ACCUM,LASTSCAN);    20384000
    VALUE                TYPE,UNITNO,CARDLOC                       ;    20385000
     REAL ADDR,      DEX,TYPE,UNITNO,CARDLOC,SOURCE,      LASTSCAN ;    20386000
    ARRAY      EQN[*],X[*],                         ACCUM[*]       ;    20386100
         BEGIN%                                                         20387000
         REAL IOD,COUNT;                                                20388000
         LABEL  EXIT,ERROR,NEXT,LFORM,LNO,LDISK,LTAPE,LPUNCH,LPAPER,%   20389000
                    ROUND,%                                             20390000
              SERIAL,UPDATE,SPO,GLOTZ,%                                 20391000
         DOWN,%                                                         20392000
               LSPECIAL,LPRINT,LBACK ;%                                 20393000
         SWITCH  D ~ LFORM,LNO,LDISK,LTAPE,LPUNCH,LPRINT,LPAPER,%       20394000
              LBACK,SERIAL,UPDATE,SPO,%                                 20395000
              LSPECIAL;%                                                20396000
         REAL NOLBL,TPNO ;%                                             20397000
         REAL SUBROUTINE SCAN;                                          20397100
              BEGIN SCAN~SCN(UNITNO,CARDLOC,SOURCE,ACCUM,COUNT,LASTSCAN)20397200
              END;                                                      20397300
         IF  TYPE = FILEV  THEN%                                        20398000
              BEGIN%                                                    20399000
              IF  ADDR =0  THEN ADDR~X[13]~GETESPDISK ;%                20400000
              IF   DEX  =  2   THEN%                                    20401000
                   BEGIN%                                               20402000
                   EQN [29] ~ GETESPDISK;%                              20403000
                   DISKWAIT(EQN.[CF],30,ADDR);                          20404000
                   ADDR ~ EQN[29];%                                     20405000
                   DEX ~ 0;%                                            20406000
                   END;%                                                20408000
              TYPE ~ SCAN;%                                             20409000
              EQN ~ (14 | DEX) INX  EQN ;%                              20410000
              STREAM( COUNT, ACCUM, Z ~ [EQN[4]]);%                     20411000
                   BEGIN%                                               20412000
                   SI ~ LOC COUNT ; SI~SI+7; DI~Z; DS~CHR;%             20413000
                   SI ~ ACCUM ; SI~SI+1;  DS~ COUNT CHR ;%              20414000
                   END ;%                                               20415000
              IF  SCAN ! EQUAL OR SCAN < IDENT THEN GO TO ERROR;%       20416000
              EQN[2] ~ EQN[3]~%                                         20417000
              EQN[0]~0;  EQN[1] ~ ACCUM[0];%                            20418000
              IF  (TYPE~SCAN)= SLASH  THEN%                             20419000
              BEGIN  IF SCAN}IDENT  THEN%                               20420000
                   BEGIN   EQN[0]~EQN[1]; EQN[1]~ACCUM[0]   ;%          20421000
              ;    END    ELSE   GO TO   ERROR;%                        20422000
                        TYPE ~ SCAN  END;%                              20423000
              IF TYPE = COMMA THEN%                                     20424000
                   BEGIN%                                               20425000
              IF(TYPE~SCAN)! IDENT OR COUNT >3 THEN  GO TO ERROR;%      20426000
                   STREAM ( S ~ 3-COUNT,COUNT,ACCUM, T~[EQN[2]]);%      20427000
                   BEGIN  SI~ACCUM; SI~SI+1; DI~DI+S; DS~COUNT NUM;%    20428000
                   END;%                                                20429000
              IF(TYPE~SCAN)= COMMA THEN%                                20430000
                   BEGIN%                                               20431000
                   IF(TYPE~SCAN)! IDENT OR COUNT>5 THEN GO TO ERROR;%   20432000
                        STREAM( S~8-COUNT,COUNT,ACCUM, T~[EQN[2]]);%    20433000
                        BEGIN SI~ACCUM; SI~SI+1; DI~DI+S;DS~COUNT NUM%  20434000
                        END;%                                           20435000
                   IF(TYPE~SCAN)= COMMA  THEN%                          20436000
                        BEGIN%                                          20437000
                   IF(TYPE~SCAN)! IDENT OR COUNT > 2 THEN GO TO ERROR;% 20438000
                        STREAM(S~2-COUNT,COUNT,ACCUM,T~[EQN[3]]);%      20439000
                        BEGIN SI~ACCUM; SI~SI+1; DI~DI+S;DS~COUNT NUM;% 20440000
                        END;    TYPE ~ SCAN;%                           20441000
                        END% CYCLE ;%                                   20442000
                   END% CREATION DATE ;%                                20443000
                   END;%REEL  NUMBER;%                                  20444000
              TPNO~@37;%                                                20445000
              NOLBL ~ 0;%                                               20446000
    ROUND:%                                                             20447000
         WHILE TYPE ! PERIO AND (TYPE<FORM OR TYPE>SPECIAL)DO TYPE~SCAN;20448000
         IF TYPE = PERIO THEN GO TO EXIT;%                              20449000
         GO TO D[TYPE-FORM];%                                           20450000
      NEXT:     TYPE~SCAN;  GO TO  ROUND;%                              20451000
    LFORM:%                                                             20452000
              EQN[3].[42:1]~1; GO TO NEXT;%                             20453000
    LNO:%                                                               20454000
         NOLBL ~ 1; GO TO NEXT;%                                        20455000
    LDISK:%                                                             20456000
         TPNO ~ 10; GO TO NEXT;%                                        20457000
    LTAPE:%                                                             20458000
         TPNO ~ 2; GO TO NEXT;%                                         20459000
    LPUNCH:%                                                            20460000
         IF (TYPE~SCAN)=PERIO THEN BEGIN TPNO~0; GO EXIT END;           20461000
         IF TYPE=BACK THEN                                              20461100
         TPNO~20 ELSE                                                   20461200
         BEGIN TPNO~21; IF SCAN!BACK THEN GO ERROR END;                 20461300
         IF SCAN=PERIO THEN GO ERROR;                                   20461400
         IF (TYPE~SCAN)=PERIO THEN                                      20461500
              TPNO~TPNO+4 ELSE                                          20461600
         IF TYPE=DISK THEN                                              20461700
              TPNO~TPNO+2 ELSE                                          20461800
         IF TYPE!TAPE THEN GO ERROR;                                    20461900
              IF TYPE!PERIO THEN GO NEXT ELSE GO EXIT;                  20461950
    LPAPER:%                                                            20462000
         TYPE ~ SCAN; TPNO ~ 7; GO TO NEXT;%                            20463000
    LSPECIAL:%                                                          20464000
         TPNO ~ 3; GO TO NEXT;%                                         20465000
    LPRINT:%                                                            20466000
         IF (TYPE~SCAN)=PERIO THEN BEGIN TPNO~1; GO EXIT END;        %P 20467000
         IF TYPE=BACK THEN                                           %P 20468000
    LBACK:    TPNO~6 ELSE                                            %P 20469000
         BEGIN TPNO~4; IF SCAN!BACK THEN GO ERROR END;               %P 20470000
         IF SCAN=PERIO THEN GO ERROR;                                %P 20471000
         IF (TYPE~SCAN)=PERIO THEN                                   %P 20472000
              TPNO~22-TPNO ELSE                                      %P 20473000
         IF TYPE=DISK THEN                                           %P 20474000
              TPNO~21-TPNO ELSE                                      %P 20475000
         IF TYPE!TAPE THEN GO ERROR;                                 %P 20476000
              IF TYPE !PERIO THEN GO NEXT ELSE GO EXIT;                 20477000
%                                                                    %P 20478000
    ERROR:%                                                             20479000
         PPC~TRUE;GO DOWN;%                                             20480000
    SPO:      TPNO~11;GO TO NEXT;%                                      20481000
    SERIAL:   TPNO~12;GO TO GLOTZ;%                                     20482000
    UPDATE:   TPNO~13;%                                                 20483000
    GLOTZ:    IF       SCAN !PERIO THEN GO TO NEXT;%                    20484000
    EXIT:%                                                              20485000
         IF   NOLBL THEN TPNO ~ IF TPNO=2 THEN 9 ELSE%                  20486000
                       (IF TPNO =3 THEN 5  ELSE%                        20487000
              (IF TPNO=7 THEN 8 ELSE%                                   20488000
              (IF TPNO=@37 THEN 9 ELSE TPNO)));%                        20489000
         EQN[3].[43:5]~TPNO;%                                           20490000
              DEX  ~  DEX+1;%                                           20491000
              END%                                                      20492000
         ELSE%                                                          20493000
              BEGIN%                                                    20494000
         DO UNTIL (IOD ~ SCAN) = EQUAL OR IOD = PERIO;%                 20495000
         IF IOD = PERIO THEN GO TO ERROR;%                              20496000
              IOD ~ SCAN;%                                              20497000
              STREAM (K~0: A ~ [ACCUM[0]],COUNT);%                      20498000
                   BEGIN%                                               20499000
                   SI ~ A ; SI~SI+1; DI~LOC K;%                         20500000
                   DS ~ COUNT  OCT ;%                                   20501000
              END;%                                                     20502000
         TPNO~P;%                                                       20503000
         IF TYPE=PROCE OR TYPE=IO THEN X[16+TYPE-PROCE]~TPNO|3600       20504000
         ELSE IF TYPE=COREV THEN X[20] ~ TPNO DIV 64                    20504500
         ELSE IF TYPE}PRIOR AND TYPE{SAVEV THEN X[18+TYPE-PRIOR]~TPNO;  20505000
                                                                        20506000
                                                                        20507000
         DO UNTIL SCAN = PERIO;%                                        20508000
              END;%                                                     20509000
    DOWN:%                                                              20510000
         END;%                                                          20511000
PROCEDURE SECURITYMAINT( TYPE,SMID,SFID,CMM,SFH,CARD);                  20511100
VALUE TYPE,SMID,SFID,SFH,CARD;                                          20511110
REAL  TYPE,SMID,SFID,SFH,CARD;                                          20511120
ARRAY CMM[*];                                                           20511130
BEGIN                                                                   20511140
%                                                                       20511145
REAL N4,OPTN,T1;                                                        20511150
REAL T=TYPE;                                                            20511155
LABEL SEC3,FUNC0,FUNC1,FUNC2,FUNC3,SEC4,EXYT;                           20511160
LABEL ERR,ERROR,FUNCJ;%                                                 20511165
SWITCH FUNC~FUNCJ,FUNC0,FUNC1,FUNC2,FUNC3;%                             20511170
LABEL EXIT; %                                                           20511171
         N4:= ABS(CMM[5]);                                              20511181
         IF ((CMM[0]EQV "DECK   ")=NOT 0) AND                           20511182
            (((CMM[1]AND @77000000007777)EQV @12000000003714)=NOT 0)    20511184
         OR SYSTEMFILE(CMM[0],CMM[1]) THEN GO TO ERROR;                 20511188
         IF TYPE = USEV AND                                             20511295
         ((CMM[0]EQV SMID)=NOT 0 AND (CMM[1]EQV SFID)=NOT 0) THEN       20511300
         ELSE                                                           20511305
         IF (OPTN:=DIRECTORYSEARCH(CMM[0],CMM[1],4))!0 THEN             20511306
         IF OPTN LSS 0 THEN GO TO ERROR ELSE                            20511310
         BEGIN                                                          20511311
         IF TYPE=USEV AND M[OPTN+2]<0 THEN GO TO ERR;                   20511312
         IF (T1~((N4 EQV MCP)=NOT 0) OR (CMM[5]=NOT 0)) OR              20511315
           (M[OPTN+2]>0 AND(N4 EQV ABS(M[OPTN+2]))=NOT 0)THEN           20511320
         GO TO SEC3 ELSE                                                20511330
         BEGIN ERR: FORGETSPACE(OPTN);                                  20511340
                       FORGETSPACE(DIRECTORYSEARCH(CMM[0],CMM[1],14));  20511350
            END;                                                        20511360
         END;                                                           20511363
ERROR:                                                                  20511365
         STREAM(A:=[CMM[0]],B:=(OPTN:=SPACE(10)));                      20511370
         BEGIN SI:=A; SI:=SI+1; DS:=LIT" "; DS:=7 CHR;                  20511380
               SI:=SI+1; DS:=LIT"/"; DS:=7 CHR;                         20511390
               DS:=24 LIT " SECURITY MAINT IGNORED~";                   20511400
         END STREAM;                                                    20511410
         SPOUT(OPTN);                                                   20511420
         GO TO EXYT;                                                    20511430
    SEC3:                                                               20511440
%                                                                       20511445
         GO TO FUNC[TYPE-UNLOCKV];                                      20511450
   FUNCJ:M[OPTN INX 5]~M[OPTN INX 6]~@14;%                              20511455
         CMM[2] := " UNLOCK"; CMM[3] := "ED~~   ";%                     20511457
         GO TO SEC4;%                                                   20511459
   FUNC0:                                                               20511460
         M[OPTN INX 5]:=-SMID; M[OPTN INX 6]:= SFID;                    20511470
         CMM[2]:= " SECURE"; CMM[3]:= "D WITH ";                        20511480
         M[SFH+2] := P(DUP,LOD,SSB);                                    20511490
         GO TO SEC4;                                                    20511500
   FUNC1:                                                               20511510
         IF T1 THEN M[OPTN+2]~MCP; %                                    20511515
         SMID:=M[OPTN+5]; SFID:=M[OPTN+6];                              20511520
         M[OPTN INX 5]:= M[OPTN INX 6]:=0;                              20511525
         CMM[2]:=" LOCKED"; CMM[3]:=" FROM  "; GO TO SEC4;%             20511530
   FUNC2:                                                               20511540
         M[OPTN INX 2]:=M[OPTN INX 5]:=M[OPTN INX 6]:=0;                20511550
         CMM[2]:= " FREE F"; CMM[3]:= "ILE~~  "; GO TO SEC4;            20511560
   FUNC3:                                                               20511570
         M[OPTN INX 5]:=  @14;   M[OPTN INX 6]:= 0;                     20511580
         CMM[2]:= " PUBLIC";CMM[3]:= " FILE~~";                         20511590
    SEC4:                                                               20511600
         DISKWAIT(OPTN.[CF],30,OPTN.[FF]);                              20511610
         P(DIRECTORYSEARCH(-CMM[0],CMM[1],14),DEL);                     20511620
         IF SECMSG THEN                                                 20511640
         BEGIN                                                          20511650
         ;STREAM(A:=ABS(SMID),B:=SFID,C:=CMM,Q:=(T LSS FREE)%           20511660
              AND (T!UNLOCKV) AND (ABS(SMID)!12),                       20511662
               X:=(SFID=0 OR ABS(SFID)=12) %                            20511663
              AND T LSS FREE AND T!UNLOCKV,                             20511664
               D~OPTN~OPTN INX 0);                                      20511665
         BEGIN SI:=C; SI:=SI+1; DS:=LIT" "; DS:=7 CHR; DS:=LIT"/";      20511670
               3(SI:=SI+1; DS:=7 CHR);                                  20511680
               X(DI:=DI-7; DS:=2 LIT"~~");                              20511685
               Q(DS:=LIT" ";SI:=LOC A;SI:=SI+1;DS:=7 CHR; DS:=LIT"/";   20511690
               SI:=SI+1; DS:= 7 CHR; DS:=LIT"~");                       20511700
         END STREAM;                                                    20511710
         SPOUT(OPTN);                                                   20511720
         END ELSE FORGETSPACE(OPTN);                                    20511730
    EXYT:                                                               20511800
END SECUTITYMAINT;                                                      20511810
COMMENT  THE PRT CELL "SHEET" GIVES DISK ADDRESS OF 1ST SHEET ENTRY%    20512000
    *** ENTRIES IN THE SHEET ARE AS FOLLOWS:%                           20513000
         S[ 0]         = 1ST NAME (7 CHRS)                              20514000
         S[ 1]         = 2ND NAME (7 CHRS)                              20514500
         S[ 2].[ 1: 2] = 0 NORMAL                                       20514600
                         2 JOB HAS BEEN XS-ED (FORCED RUN)              20514700
                         3 JOB HAS BEEN ES-ED (FORCED RUN AND DS)       20514800
         S[ 2].[ 8:10] = 0 GO JOB (FROM COMPILE & GO)                   20515000
                       = 1 COMPILER (FOR COMPILE & GO)                  20515500
                       = 2 EXECUTE JOB                                  20516000
                       = 3 COMPILER (FOR SYNTAX CHECK)(SET TO 2 LATER)  20516500
                       = 4 COMPILER (FOR COMPILE TO LIBRARY)            20517000
                       = 5 RUN JOB                                      20517200
         S[ 2].[18:15] = SKELETONS DISK ADDRESS (IF S[2].[8:10] = 1,2,4 20517500
         S[ 2].[33:15] = PRIORITY, SAME AS S[18]                        20517800
         S[ 3].[ 8:10] = SCHEDULE-ID FOR THIS JOB                       20517900
         S[ 5]         = STARTING TIME FOR LOG                          20518000
         S[ 6]         = LOCATION OF LAST PART OF LOG                   20518500
         S[13]         = DISK ADDRESS OF LABEL EQUATION ENTRIES         20519000
                         APPLICABLE TO THIS EXECUTION ONLY (SEE BELOW)  20520000
         S[14]         = ACTUAL FIRST NAME                              20520100
         S[15]         = DISK ADDRESS OF LABEL EQUATION ENTRIES         20521000
                         PRESENTED WHEN PROGRAM WAS COMPILED AND        20522000
                         APPLICABLE TO ALL EXECUTIONS (SEE BELOW)       20523000
         S[16]         = ESTIMATED PROCESSOR TIME                       20524000
         S[17]         = ESTIMATED I/O TIME                             20525000
         S[18]         = PRIORITY                                       20526000
         S[19]         = COMMON VALUE                                   20527000
         S[20]         = ESTIMATED CORE REQUIREMENTS                    20528000
         S[21]         = STACK SIZE                                     20529000
         S[22]         = TIME TO SAVE PROGRAM ON COMPILE TO LIBRARY     20529500
         S[23].[9:9]   = REMOTE STATION ADDRESS, ELSE 0                 20529600
         S[23].[31:17] = TIME JOB WAS PUT INTO SHEET (FOR TS MESSAGE)   20529700
         S[24]          = USER CODE                                     20529800
         S[25]         = HEADER ADDRESS FOR THE JOB                     20529900
         S[26]         = LOGLINE FOR THIS JOB                           20529910
         S[29]         = DISK ADDRESS OF NEXT SHEET ENTRY (=0 IF LAST)  20530000
    *** ENTRIES FOR LABEL EQAT. ARE AS FOLLOWS:%                        20531000
         F[0]      = MULTI-FILE ID (7 CHRS)%                            20532000
         F[1]      = FILE ID      (7 CHRS)%                             20533000
         F[2].[0:18]= REEL NO    (3 CHRS)%                              20534000
         F[2].[18:30]=  CREATION DATE  (5 CHRS)%                        20535000
         F[3].[0:12]= CYCLE    (2 CHRS)%                                20536000
         F[3].[42:1] = 1  FOR FORMS REQUIRED                            20537000
         F[3].[43:5] = 0  FOR CP  (FILE TYPES )                         20538000
                      1  FOR LP%                                        20539000
                      2  FOR MT%                                        20540000
                      3  FOR SPECIFIC UNIT%                             20541000
                      4  FOR LP  (MAY BACKUP)%                          20542000
                      5  FOR SPECIFIC (UNLABLED)%                       20543000
                      6  FOR LP  (MUST BACKUP)%                         20544000
                      7  FOR PT%                                        20545000
                      8  FOR PT (UNLABLED)%                             20546000
                      9  FOR MT (UNLABLED)%                             20547000
                     10  FOR DISK%                                      20548000
         F[4].[0:6]= NO OF CHARS IN INTERNAL NAME%                      20549000
         F[4].[6:42]= INTERNAL NAME (MAY CONTINUE TO F[11])%            20550000
         F[14]- F[25]  SAME AS ABOVE FOR NEXT FILE (F[14]=14 IF NO NEXT)20551000
         F[29]     = DISK ADDRESS OF NEXT LABEL EQUAT. ENTRY(=0 IF NONE)20552000
    *** CONTENTS OF JAR  ARE :%                                         20553000
         J[0] -J[6] = SAME AS SHEET ENTRIES S[0]-S[6]%                  20554000
         J[7]      =  ACTUAL FIRST NAME                                 20555000
         J[8]      = LENGTH OF EACH ROW OF CODE FILE%                   20556000
         J[9]       = NO. OF ROWS%                                      20557000
         J[10]-J[29]= DISK ADDRESS OF ROWS%                             20558000
         ;%                                                             20559000
REAL PROCEDURE LIBCC(CARD,SOURCE,ACCUM,COUNT,LASTSCAN,USERID,PROG,      20566000
    CMM,OPTN,T); VALUE CARD;                                            20566100
    REAL CARD,SOURCE,COUNT,LASTSCAN,USERID,OPTN,T;                      20566200
    ARRAY ACCUM[*],PROG[*],CMM[*];                                      20566300
BEGIN                                                                   20566400
    REAL CN,LIBNO,UNITNO,CARDLOC;                                       20566500
    LABEL CCA,QUIT,POWIE,CHAN,REMO,INCSC,GETEM,ENTE,LCOPY,SEEK,INIT;    20566600
    SWITCH SW~LCOPY,LCOPY,ENTE,ENTE,REMO,CHAN;                          20566700
    REAL SUBROUTINE SCAN;                                               20566800
         SCAN~SCN(UNITNO,CARDLOC,SOURCE,ACCUM,COUNT,LASTSCAN);          20566900
    REAL SUBROUTINE SKAN;                                               20566905
    BEGIN                                                               20566910
    STREAM(X:=0:CN:=0,ACCUM);                                           20566915
    BEGIN                                                               20566920
    SI:=ACCUM;SI:=SI+1;                                                 20566925
    8(IF SC GEQ "0" THEN BEGIN SI:=SI+1;TALLY:=TALLY+1; END ELSE        20566930
      IF SC=" " THEN JUMP OUT ELSE BEGIN TALLY:=0;JUMP OUT END);        20566935
      CN:=TALLY;SI:=SI-CN;DI:=LOC X;DS:=CN OCT;                         20566940
    END;                                                                20566945
    SKAN:=P;                                                            20566950
    END OF SKAN;                                                        20566955
    LIBCC~0;                                                            20567000
    UNITNO~(CARD.[3:5]+28).[43:5]+4;                                    20567100
    CARDLOC~CARD INX 0;                                                 20567200
    GO TO SW[T-COPY];                                                   20567300
LCOPY:                                                                  20567400
ENTE:                                                                   20567500
         IF (CN:=SCAN)=IDENT THEN                                       20567600
         BEGIN;                                                         20567700
              IF(PROG[0]:=SKAN)=0 THEN PROG[0]:=511 ELSE CN:=SCAN;      20567800
              IF PROG[0]>511 THEN PROG[0]:=511;                         20567900
         END ELSE PROG[0]:=511;                                         20568000
         CMM[19]:=0;                                                    20568050
$INCLUDE 20568061,IF B6500LOAD;                                         20568059
         IF CN=B6500 THEN BEGIN CMM[19].[15:1]:=1;CN:=SCAN END;         20568060
         IF CN=TOV AND T GTR UNLOAD THEN                                20568100
         BEGIN                                                          20568200
              IF (CN:=SCAN)=EU THEN                                     20568300
              BEGIN                                                     20568400
              IF(CN:=SCAN)!IDENT THEN GO TO INCSC;                      20568500
              IF P(SKAN,DUP)>19 THEN BEGIN P(DEL);GO INCSC END;         20568600
              CN~P+1;CMM[19].[9:6]~CN;                                  20568610
              IF CN>NEUP.NEUF THEN GO TO INCSC;                         20568611
              END                                                       20568620
              ELSE IF CN=SLOW THEN CMM[19]~P(DUP,LOD) OR M ELSE         20568630
              IF CN=FAST THEN CMM[19]~-CMM[19] ELSE GO TO INCSC;        20568640
              CN:=SCAN;                                                 20568650
         END;                                                           20568700
         IF CN=EXPIRED THEN                                             20568728
         BEGIN                                                          20568729
              PROG[0].[9:1]:=1;                                         20568730
              CN:=SCAN;                                                 20568740
         END;                                                           20568750
         IF CN=ACCESSD THEN                                             20568760
         BEGIN                                                          20568770
              PROG[0].[8:1]:=1;                                         20568780
              CN:=SCAN;                                                 20568790
         END;                                                           20568795
         IF UNITNO=23 OR UNITNO=24 OR UNITNO}32 THEN                    20568900
              PROG[0].[2:6]~UNITNO;                                     20569000
         IF SCAN!IDENT THEN GO TO INCSC;                                20569100
         PROG[1]~ACCUM[0];                                              20569200
         PROG[28]~0;                                                    20569250
         CMM[0]~"LIBMAIN";                                              20569300
         CMM[1]~"DISK   ";                                              20569400
         CMM[2]~0&2[8:38:10];                                           20569500
         CMM[13]~0;                                                     20569600
         CMM[23]~0&CARD[9:9:9];                                         20569700
         LIBNO~GETESPDISK;CMM[19].[CF]~LIBNO;                           20569800
         CMM[19].[FF]~T;                                                20569810
    GETEM:  %   SCAN FILE NAMES AND STORE THEM IN ESPDISK               20569900
         FOR CN~2 STEP 2 UNTIL 26 DO                                    20570000
         BEGIN                                                          20570100
         IF (OPTN~SCAN)=EQUAL THEN PROG[CN]~-1                          20570200
              ELSE IF OPTN}IDENT THEN PROG[CN]~ACCUM[0] ELSE GO POWIE;  20570300
              IF SCAN!SLASH THEN GO POWIE;                              20570400
         IF (OPTN~SCAN)=EQUAL THEN PROG[CN+1]~-1                        20570500
              ELSE IF OPTN}IDENT THEN PROG[CN+1]~ACCUM[0] ELSE GO POWIE;20570600
              IF (OPTN~SCAN)=PERIO OR OPTN=POUND THEN GO TO QUIT%LP 1   20570700
                   ELSE IF OPTN!COMMA THEN GO POWIE;                    20570800
         END;                                                           20570900
         PROG[29]~GETESPDISK;                                           20571000
         DISKWAIT(PROG INX 0,30,LIBNO);                                 20571100
         LIBNO~PROG[29];                                                20571300
         GO GETEM;                                                      20571400
    QUIT:                                                               20571500
         PROG[29]~0;                                                    20571600
         PROG[CN+2]~@14;                                                20571700
         DISKWAIT(PROG INX 0,30,LIBNO);                                 20571800
         LIBNO~ABS(CMM[19]);                                            20572000
         GO INIT;                                                       20572100
    POWIE:                                                              20572200
         IF CMM[19].[CF]!LIBNO THEN % MORE THAN ONE SEGMENT USED        20572300
         BEGIN                                                          20572400
              DISKWAIT(-PROG.[CF],30,CMM[19].[CF]);                     20572500
              FORGETESPDISK(CMM[19].[CF]);                              20572700
              CMM[19]~PROG[29];                                         20572800
              GO POWIE;                                                 20572900
         END;                                                           20573000
         FORGETESPDISK(LIBNO);                                          20573100
         GO INCSC;                                                      20573200
    REMO:                                                               20573300
         IF (CN~SCAN)=EQUAL THEN CMM[0]~-1 ELSE                         20573400
         IF CN}IDENT THEN CMM[0]~ACCUM[0] ELSE GO INCSC;                20573500
         IF SCAN!SLASH THEN GO INCSC;                                   20573600
         IF (CN~SCAN)=EQUAL THEN CMM[1]~-1 ELSE                         20573700
         IF CN}IDENT THEN CMM[1]~ACCUM[0] ELSE GO INCSC;                20573800
         CN:=T:=0;                                                      20573850
         IF (CMM[0] OR CMM[1]) LSS 0 THEN                               20573900
    SEEK:                                                               20574000
         SEEKNAM(CMM[0],CMM[1],CN,CMM[2],CMM[3],OPTN) ELSE              20574100
         BEGIN                                                          20574200
              CMM[2]:=CMM[0];                                           20574300
              CMM[3]:=CMM[1];                                           20574400
              CN:=1;                                                    20574500
         END;                                                           20574600
         IF CN!0 THEN T:=IF SYSTEMFILE(CMM[2],CMM[3]) THEN -1 ELSE      20574700
              DIRECTORYSEARCH(CMM[2],CMM[3],4);                         20574750
         IF T=0 THEN LBMESS(IF CMM[0] LSS 0 THEN                        20574800
              "     .=" ELSE -CMM[0],IF CMM[1] LSS 0 THEN "=      "     20574900
              ELSE CMM[1],"NOT REM","OVED(","NOT ON"," DISK)",1) ELSE   20575000
         IF T LSS 0 AND CN!0 THEN LBMESS(-CMM[2],CMM[3],"NOT ",         20575200
              "REMOVED","(SYSTEM"," FILE)",1) ELSE                      20575300
         IF T GTR 0 AND CN!0 THEN                                       20575400
         BEGIN                                                          20575500
              IF M[T+2]!0 AND (USERID EQV MCP)!NOT 0 AND                20575600
              (USERID EQV ABS(M[T+2])) NEQ NOT 0 THEN %                 20575700
              BEGIN                                                     20575800
                   LBMESS(-CMM[2],CMM[3],"NOT ","REMOVED","(INVALI",    20575900
                        "D USER)",1);                                   20576000
                   FORGETSPACE(DIRECTORYSEARCH(CMM[2],CMM[3],14));      20576100
              END ELSE                                                  20576200
              FORGETSPACE(DIRECTORYSEARCH(CMM[2],CMM[3],6));            20576300
              FORGETSPACE(T);                                           20576350
         END;                                                           20576400
         IF CN!0 AND (CMM[0] OR CMM[1])<0 THEN GO SEEK;                 20576500
         IF (CN~SCAN)=COMMA THEN GO REMO;                               20576600
         IF CN=PERIO THEN GO TO CCA ELSE GO TO INCSC;                   20576700
    CHAN:                                                               20576800
         FOR CN~0 STEP 1 UNTIL 3 DO                                     20576900
         BEGIN                                                          20577000
              IF SCAN}IDENT THEN CMM[CN]~ACCUM[0] ELSE GO INCSC;        20577100
              OPTN~SCAN;                                                20577200
         END;                                                           20577300
         IF (T~DIRECTORYSEARCH(CMM[2],CMM[3],5))!0 THEN                 20577400
         BEGIN                                                          20577500
              FORGETSPACE(T);                                           20577600
             LBMESS(-CMM[0],CMM[1],"NOT ","CHANGED","(DUP ",            20577700
                   "FILE)",1);                                          20577800
         END ELSE                                                       20577900
         IF (T:=IF SYSTEMFILE(CMM[0],CMM[1]) THEN -1 ELSE               20578000
              DIRECTORYSEARCH(CMM[0],CMM[1],4 OR MEMORY))=0 THEN        20578050
             LBMESS(-CMM[0],CMM[1],"NOT ","CHANGED","(NOT ON",          20578100
                   " DISK)",1) ELSE                                     20578200
         IF T LSS 0 THEN LBMESS(-CMM[0],CMM[1],"NOT ","CHANGED",        20578210
              "(SYSTEM"," FILE)",0) ELSE                                20578220
         IF M[T+2]!0 AND (USERID EQV MCP)!NOT 0 AND                     20578300
              (USERID EQV ABS(M[T+2])) NEQ NOT 0 THEN %                 20578400
         BEGIN                                                          20578500
             LBMESS(-CMM[0],CMM[1],"NOT ","CHANGED","(INVALI",          20578600
                   "D USER)",1);                                        20578700
              FORGETSPACE(T);                                           20578800
              FORGETSPACE(DIRECTORYSEARCH(CMM[0],CMM[1],14));           20578900
         END ELSE                                                       20579000
         BEGIN                                                          20579100
              M[T+4]:=(*P(DUP))&2[1:46:2];                              20579200
              DISKLOG(CMM[0],CMM[1],IOQUE&T[CTC]);                  %11220579210
              ENTERUSERFILE(-CMM[2],CMM[3],T INX 0-1);                  20579300
              T:=T&DIRECTORYFREE[18:32:15];                             20579400
              FORGETSPACE(DIRECTORYSEARCH(CMM[0],CMM[1],8));            20579500
              HEADERUNLOCK(CMM[2],CMM[3],T);                            20579600
              IF LIBMSG THEN LBMESS(CMM[0],CMM[1],"CHANGED"," TO ",     20579700
                   -CMM[2],CMM[3],0);                                   20579710
              PBCOUNT~PBCOUNT-((((CMM[0] EQV "PBD    ")=NOT 0) OR       20579720
                   ((CMM[0] EQV "PUD    ")=NOT 0)) AND (CMM[1].[CF]=1)) 20579730
                   +((((CMM[2] EQV "PBD    ")=NOT 0) OR                 20579740
                   ((CMM[2] EQV "PUD    ")=NOT 0)) AND (CMM[3].[CF]=1));20579750
         END;                                                           20579800
         IF OPTN=COMMA THEN GO CHAN;                                    20579900
         IF OPTN=PERIO THEN GO TO CCA ELSE GO INCSC;                    20580000
INIT:    LIBCC~LIBNO; GO TO CCA;                                        20580100
INCSC:   LIBCC~1;                                                       20580200
CCA:                                                                    20580300
END; %    LIBCC PROCEDURE                                               20580400
         REAL PROCEDURE ACESBIT(CARD,SOURCE,ACCUM,COUNT,LASTSCAN,       20580500
                                USERID,CMM,TOG);                        20580505
              VALUE CARD;                                               20580510
              BOOLEAN TOG;                                              20580515
              REAL CARD,SOURCE,COUNT,LASTSCAN,USERID;                   20580520
              ARRAY ACCUM[*],CMM[*];                                    20580525
         BEGIN LABEL CCERR,MORE,SEEK;                                   20580530
               REAL CN,UNITNO,CARDLOC,N,T;                              20580535
               REAL SUBROUTINE SCAN;                                    20580540
              SCAN~SCN(UNITNO,CARDLOC,SOURCE,ACCUM,COUNT,LASTSCAN);     20580545
               UNITNO:=CARD.[2:6];                                      20580550
               CARDLOC:=CARD INX 0;                                     20580555
              IF SCAN NEQ ACCESSD THEN GO TO CCERR;                     20580560
MORE:         IF (CN:=SCAN)=EQUAL THEN CMM[0]:=-1 ELSE                  20580565
               IF CN GEQ IDENT THEN CMM[0]:=ACCUM[0] ELSE GO CCERR;     20580570
              IF SCAN NEQ SLASH THEN GO TO CCERR;                       20580575
              IF (CN:=SCAN)=EQUAL THEN CMM[1]:=-1 ELSE                  20580580
               IF CN GEQ IDENT THEN CMM[1]:=ACCUM[0] ELSE               20580585
              GO TO CCERR;                                              20580590
           CN:=0;                                                       20580595
SEEK:      IF (CMM[0] OR CMM[1]) LSS 0 THEN                             20580600
           SEEKNAM(CMM[0],CMM[1],CN,CMM[2],CMM[3],N) ELSE               20580605
           BEGIN CN:=1; CMM[2]:=CMM[0]; CMM[3]:=CMM[1] END;             20580610
           IF CN NEQ 0 THEN                                             20580615
         BEGIN                                                          20580620
         T:=IF SYSTEMFILE(CMM[2],CMM[3]) THEN -1                        20580625
                   ELSE DIRECTORYSEARCH(CMM[2],CMM[3],5);               20580626
              IF T GTR 0 THEN                                           20580630
              BEGIN                                                     20580635
      IF (USERID EQV MCP) = NOT 0 OR (USERID EQV ABS(M[T+2])) %         20580645
                        =NOT 0 OR M[T+2]=0 THEN                         20580650
                   BEGIN                                                20580655
                        FORGETSPACE(DIRECTORYSEARCH(CMM[2],CMM[3],      20580660
                             19+TOG));                                  20580665
                        IF RSTOG THEN LBMESS(CMM[2],CMM[3], IF TOG THEN 20580670
                            "SET " ELSE "RESET ","ACCESSD",             20580675
                           0,0,0);                                      20580680
                   END ELSE                                             20580685
                   BEGIN                                                20580690
                        LBMESS(-CMM[2],CMM[3],"NOT ", IF TOG THEN       20580700
                             "SET " ELSE "RESET ","(INVALI","D USER)",  20580705
                             0);                                        20580710
                   END;                                                 20580712
                   FORGETSPACE(T);                                      20580713
              END ELSE                                                  20580715
              IF T LSS 0 THEN                                           20580716
              LBMESS(-CMM[2],CMM[3],"NOT ",IF TOG THEN                  20580717
                     "SET " ELSE "RESET ","(SYSTEM",                    20580718
                     " FILE)",0) ELSE                                   20580719
              LBMESS(-CMM[2],CMM[3],"NOT ",IF TOG THEN "SET " ELSE      20580720
                   "RESET ","(NOT ON"," DISK)",0);                      20580725
         END;                                                           20580730
         IF CN NEQ 0 AND (CMM[0] OR CMM[1]) LSS 0 THEN GO SEEK;         20580735
         IF (CN:=SCAN)=COMMA THEN GO TO MORE;                           20580740
         IF CN=PERIO THEN ACESBIT:=1;                                   20580745
CCERR:                                                                  20580750
END ACESBIT;                                                            20580755
PROCEDURE CCFINISH(CMM,PROG,CEQN,PEQN,CN,T,PPCPROCESS,OPTN,PDEX,        20580800
                   CDEX,LIBNO,CLOSET,PADDR,CADDR);                      20580850
          REAL CN,T,PPCPROCESS,OPTN,PDEX,CDEX,LIBNO,CLOSET,             20580900
               PADDR,CADDR;                                             20580950
          ARRAY CMM[*],PROG[*],CEQN[*],PEQN[*];                         20581000
BEGIN                                                                   20581050
REAL TEMP;                                                              20581100
         PPCPROCESS:=0;                                                 20581150
         CN:=T;                                                         20581200
         IF OPTN = PERIO OR OPTN = LIBRA THEN                           20581250
         BEGIN                                                          20581300
              CMM[22]:= PROG[22];                                       20581350
              PROG[2].[CF]:= IF PROG[18] > 32767 THEN 32767             20581400
                             ELSE PROG[18];                             20581450
         IF PROG[20] > 512 THEN PROG[20]:= 512;                         20581500
         IF PADDR NEQ 0 THEN                                            20581550
                  BEGIN                                                 20581600
                  PEQN[29]:= 0;                                         20581650
                  IF PDEX=0 THEN PEQN[0]:=14;                           20581700
                  IF PDEX=1 THEN PEQN[14]:= 14;                         20581750
                  DISKWAIT(PEQN.[CF],30,PADDR);                         20581800
                  END;                                                  20581850
         PROG[29]:= 0;                                                  20581900
         CMM[2].[18:15]:= CLOSET:= GETESPDISK;                          20581950
         DISKWAIT(PROG.[CF],30,CLOSET);                                 20582000
         END;                                                           20582050
         IF CADDR NEQ 0 THEN                                            20582100
                  BEGIN                                                 20582150
                  CEQN[29]:= 0;                                         20582200
                  IF CDEX=0 THEN CEQN[0]:= 14;                          20582250
                  IF CDEX=1 THEN CEQN[14]:= 14;                         20582300
                  DISKWAIT(CEQN.[CF],30,CADDR);                         20582350
                  END;                                                  20582400
         SLEEP([TOGLE],SHEETMASK); SHEETFREE:=0;                        20582450
         CDEX:= GETESPDISK;                                             20582500
         CMM[2].[CF]:= IF CMM[18] > 32767 THEN 32767 ELSE CMM[18];      20582550
         PDEX:= IF CMM[18] > MIXMAX THEN MIXMAX ELSE CMM[18];           20582600
         IF LIBNO NEQ 0 THEN CMM[19]:= LIBNO;                           20582650
         IF CMM[20] > 512 THEN CMM[20] := 512;                          20582700
         STREAM(A:=0:S:=P(.SCHEDULEIDS));                               20582750
         BEGIN SI:=S;                                                   20582800
                47(SKIP SB; SKIP DB; TALLY:=TALLY+1;                    20582850
                   IF SB THEN BEGIN END ELSE JUMP OUT);                 20582900
                DS:= SET; A:= TALLY;                                    20582950
         END STREAM;                                                    20583000
          TEMP:= P; CMM[3]:= 0&TEMP[8:38:10];                           20583050
          CMM[23].[31:17]:= (CLOCK+ P(RTR)) DIV 60;                     20583100
          IF SHEET[PDEX].[CF] NEQ 0 THEN                                20583150
             BEGIN                                                      20583200
             DISKWAIT(-PROG.[CF],30,PADDR:=SHEET[PDEX].[FF]);           20583250
             PROG[29]:= CDEX;                                           20583300
             DISKWAIT(PROG.[CF],30,PADDR);                              20583350
             END                                                        20583400
          ELSE SHEET[PDEX]:= CDEX;                                      20583450
          SHEET[PDEX].[18:15]:= CDEX;                                   20583500
          CMM[29]:= 0;                                                  20583550
          DISKWAIT(CMM.[CF],30,CDEX);                                   20583600
          SHEETFREE:= 1;                                                20583650
          T:= CN;                                                       20583700
END CCFINISH;                                                           20583750
REAL PROCEDURE CCCOMPILE(CEQN,CMM,PROG,CARD,UNITNO,CARDLOC,             20583800
                         LASTSCAN,ACCUM,COUNT,USERID,T,SOURCE,CDEX,     20583850
                         CMPLR,OPTN,CADDR,CN);                          20583900
          REAL T,CDEX,UNITNO,CMPLR,OPTN,CARDLOC,CARD,LASTSCAN,          20583950
               CADDR,SOURCE,COUNT,USERID,CN;                            20584000
          ARRAY CEQN[*],PROG[*],ACCUM[*],CMM[*];                        20584050
BEGIN COMMENT SETUP OF COMPILER LABEL EQUATION CODE: PN1/PN2;%          20584100
REAL SUBROUTINE SCAN;                                                   20584150
     SCAN:= SCN(UNITNO,CARDLOC,SOURCE,ACCUM,COUNT,LASTSCAN);            20584200
LABEL EXIT;                                                             20584250
DEFINE DISKTYPE = 10#;%                                                 20584300
         T:=SCAN;%                                                      20584350
         CEQN[0]:=ACCUM[0];%                                            20584400
         T:=SCAN;%                                                      20584450
         T:=SCAN;%                                                      20584500
         CEQN[1]:=ACCUM[0];%                                            20584550
         CEQN[2]:=0;%                                                   20584600
         CEQN[3]:=DISKTYPE;%                                            20584650
         CEQN[4]:=@423462425606060;%                                    20584700
         CDEX   :=1;%                                                   20584750
         IF ((UNITNO+1)AND 24)=24 OR UNITNO GEQ 32 THEN%                20584800
         BEGIN CEQN[14]:=CEQN[16]:=CEQN[17]:=0;%                        20584850
               CEQN[15]:= "CARD 00" OR ((IF UNITNO GEQ 32 THEN%         20584900
                          "C/" ELSE @5772) + UNITNO);%                  20584950
         CEQN[18]:=@423215124000000; CDEX:=2;%                          20585000
         IF UNITNO GEQ 32 THEN CIDROW[UNITNO-32].[3:5]:=1 ELSE%         20585050
         IF UNITNO=23 THEN READERA.[FF]:=1 ELSE READERB.[FF]:=1;%       20585100
         END;                                                           20585150
         WHILE (CN:=SCAN) LSS ALGOL OR CN GTR COBOL DO                  20585200
         IF CN=PERIO THEN BEGIN CCCOMPILE:=1; GO EXIT END;              20585250
               IF CN=WITH THEN                                          20585300
               IF (CN~SCAN)=PERIO THEN BEGIN CCCOMPILE~1; GO EXIT END;  20585350
               IF CN<ALGOL OR CN>COBOL THEN                             20585355
                IF(T:=DIRECTORYSEARCH(ACCUM[0],"DISK   ",5))!0 THEN     20585360
                BEGIN IF NOT M[T+4].[8:1] THEN                          20585365
                      BEGIN LBMESS(-ACCUM[0],"DISK   ",                 20585370
                            "NOT A ","COMPILE","R",0,0);                20585375
                      FORGETSPACE(T); CCCOMPILE~1; GO EXIT;             20585380
                      END; FORGETSPACE(T);                              20585385
                END;                                                    20585390
COMMENT SET UP NOMINAL VALUES FOR PROGRAM PARAMETERS;%                  20585400
          CMM[0]:=-(CMPLR:=ACCUM[0]); CMM[1]:=CEQN[0];                  20585450
          CMM[2]:=0;                                                    20585500
          CMM[13]:= CADDR:= GETESPDISK;                                 20585550
          CMM[23]:= 0&CARD[9:9:9];                                      20585600
%   GET OPTION (GO,SYNTAX CHECK, OR LIBRARY)                            20585650
         DO OPTN:=SCAN UNTIL OPTN=PERIO OR OPTN=SYNTA OR OPTN=LIBRA;    20585700
         CMM[2].[8:10] := IF OPTN=PERIO THEN 1 ELSE                     20585750
                             IF OPTN=SYNTA THEN 3 ELSE 4;%(OPTN=LIBRA)  20585800
         IF OPTN NEQ SYNTA THEN                                         20585850
% SET UP PROG ARRAY FOR COMPILE AND GO OR COMPILE TO LIBRARY JOBS       20585900
         BEGIN                                                          20585950
              PROG[0]:= CEQN[0];                                        20586000
              PROG[1]:= CEQN[1];                                        20586050
              PROG[2]:= 0;                                              20586100
              MOVE(27,[PROG[2]],[PROG[3]]);                             20586110
              PROG[16]:=PROG[17]:= @377777777777;                       20586150
              PROG[18]:= SHEETMAX DIV 2;                                20586200
%VOID                                                                   20586250
              PROG[20]:= -1;                                            20586300
              PROG[21]:= 512;                                           20586350
              PROG[22]:= 10;                                            20586400
%VOID                                                                   20586450
              PROG[24]:= USERID;                                        20586500
              PROG[26]:= LOGLINE;                                       20586510
         END;                                                           20586550
EXIT:                                                                   20586600
END CCCOMPILE;                                                          20586650
REAL PROCEDURE INITIALIZEIT(PROG,CMM,PDEX,PADDR,T,CARD,N1,USERID,       20586700
                            OPTN,UNITNO,CARDLOC,SOURCE,ACCUM,COUNT,     20586750
                            LASTSCAN,PEQN);                             20586800
          ARRAY PROG[*],CMM[*],ACCUM[*],PEQN[*];                        20586850
          REAL PDEX,PADDR,T,CARD,N1,USERID,OPTN,UNITNO,CARDLOC,         20586900
                SOURCE,COUNT,LASTSCAN;                                  20586950
BEGIN LABEL LS,SPLAT,SPOT,EXIT;                                         20587000
REAL SUBROUTINE SCAN;                                                   20587050
     SCAN:= SCN(UNITNO,CARDLOC,SOURCE,ACCUM,COUNT,LASTSCAN);            20587100
      PROG[13]:=PADDR:=PDEX:=0; % IN CASE PROGRAM NOT IN DIRECTORY      20587150
      IF (T:=DIRECTORYSEARCH(ABS(CMM[0]),IF CMM[0] LSS 0 THEN           20587200
          "DISK   " ELSE CMM[1],3))=0 THEN                              20587250
      BEGIN                                                             20587300
              BEGIN                                                     20587500
     LS:      LBMESS(-CMM[0],CMM[1]," NOT IN"," DIRECT","ORY    ",      20587550
                     0,0);                                              20587600
              REPORTBACK(NOTIN,0,0);                                    20587610
SPLAT:                                                                  20587650
              IF UNITNO GEQ 32 THEN BEGIN INITIALIZEIT:=5;GO EXIT END;  20587700
              END;                                                      20587750
         DO T:=SCAN UNTIL T GEQ UNLOCKV AND T LEQ RESETV;               20587800
         IF UNITNO=31 AND NT1 GEQ 0 THEN BEGIN INITIALIZEIT:=7;         20587850
                                         GO EXIT END;                   20587900
         NT1:=0; INITIALIZEIT:=1; GO EXIT ;                             20587950
      END ELSE IF M[T INX 4].[9:2]=2 THEN                               20588000
      BEGIN FORGETSPACE(T);                                             20588010
         GO TO SPOT;                                                    20588020
      END;                                                              20588030
    IF SECURITYCHECK(ABS(CMM[0]),                                       20588050
                     IF CMM[0] LSS 0 THEN "DISK   " ELSE CMM[1],        20588100
                     USERID,T)=0                                        20588150
                     THEN BEGIN OPTN:=0; CMM[2]:=T;                     20588200
                          REPORTBACK(SECURED,0,0);                      20588210
                          FORGETSPACE(DIRECTORYSEARCH(ABS(CMM[0]),      20588250
                          CMM[1]:=IF CMM[0] LSS 0 THEN "DISK   "        20588300
                          ELSE CMM[1],13));INITIALIZEIT:=4;GO EXIT END; 20588350
           DISKIO(N1,-(PEQN INX 0-1),30,M[T+10]);                       20588400
           FORGETSPACE(T);                                              20588450
           CMM[24]:= USERID;                                            20588500
           CMM[25]:= T.[FF];                                            20588550
           CMM[26]:= LOGLINE;                                           20588560
           CMM[14]:= ABS(CMM[0]);                                       20588570
           SLEEP([N1],IOMASK);                                          20588600
           FOR T:=1 STEP 1 UNTIL 6 DO                                   20588650
           IF (NOT ABS(PEQN[T]&0[CTC])) NEQ NOT 0 THEN T:= 7;           20588700
           IF NOT T THEN                                                20588750
           BEGIN                                                        20588800
SPOT:                                                                   20588850
           LBMESS(-CMM[0],CMM[1]," NOT EX","ECUTEAB","LE CODE",         20588900
                 0,0);                                                  20588950
           FORGETSPACE(DIRECTORYSEARCH(ABS(CMM[0]),                     20589000
                       IF CMM[0] LSS 0 THEN "DISK   " ELSE              20589050
                       CMM[1],13));                                     20589100
           REPORTBACK(NOTX,0,0);                                        20589110
           GO TO SPLAT;                                                 20589150
           END;                                                         20589200
           IF PEQN[6] LSS 0 THEN FOR T:=15 STEP 1 UNTIL 22 DO           20589250
           CMM[T]:=PEQN[T] ELSE                                         20589300
           BEGIN                                                        20589350
                CMM[15]:= 0;                                            20589400
                CMM[16]:= CMM[17]:= @377777777777;                      20589450
                 CMM[18]:=SHEETMAX DIV 2;                               20589460
                 CMM[19]:= 0;                                           20589470
                 CMM[20]:= PEQN[7].[FF];                                20589480
                 CMM[21]:= 512;                                         20589490
           END;                                                         20589500
INITIALIZEIT:=3;                                                        20589550
EXIT:                                                                   20589600
END INITIALIZEIT;                                                       20589650
REAL PROCEDURE CCUNIT(UNITNO,CARDLOC,SOURCE,ACCUM,COUNT,LASTSCAN,       20589700
                      T, CN);                                           20589750
          REAL UNITNO,CARDLOC,SOURCE,COUNT,LASTSCAN,T,CN;               20589800
          ARRAY ACCUM[*];                                               20589850
BEGIN LABEL U1,EXIT;                                                    20589900
REAL SUBROUTINE SCAN;                                                   20589950
     SCAN:=SCN(UNITNO,CARDLOC,SOURCE,ACCUM,COUNT,LASTSCAN);             20590000
      T:= SCAN; CN:= ACCUM[0];                                          20590050
      T:= SCAN;                                                         20590100
      FOR T:= 0 STEP 1 UNTIL 31 DO                                      20590150
          IF CN.[6:18]=TINU.[30:18] THEN GO TO U1;                      20590200
          CCUNIT:=6; GO EXIT;                                           20590250
U1: IF LABELTABLE[T] NEQ @314 THEN BEGIN CCUNIT:=6; GO EXIT END;        20590300
     CN:= SCAN;                                                         20590350
     MULTITABLE[T]:=RDCTABLE[T]:=0;                                     20590400
     LABELTABLE[T]:= ACCUM[0];                                          20590450
     IF (CN:= SCAN) = SLASH THEN                                        20590500
        BEGIN MULTITABLE[T]:= LABELTABLE[T];                            20590550
              CN:= SCAN; LABELTABLE[T]:= ACCUM[0];                      20590600
        END;                                                            20590650
     CCUNIT:=0;                                                         20590700
EXIT:                                                                   20590750
END CCUNIT;                                                             20590800
REAL PROCEDURE CCSECMAINT(USERID,UNITNO,CARDLOC,SOURCE,ACCUM,COUNT,     20590850
                          LASTSCAN,CMM,PROG,SFID,SMID,CDEX,SFH,CN,CARD, 20590900
                          N1,N2,N3,ST,T,T1,LIBNO,CADDR,OPTN,OPTNN);     20590950
          VALUE OPTNN;                                                  20591000
          REAL USERID,UNITNO,CARDLOC,SOURCE,COUNT,LASTSCAN,SFID,SMID,   20591050
               CDEX,SFH,CN,CARD,N1,N2,N3,ST,T,T1,LIBNO,OPTN,OPTNN,      20591100
               CADDR;                                                   20591150
          ARRAY ACCUM[*],CMM[*],PROG[*];                                20591200
BEGIN                                                                   20591250
LABEL EXIT,CCC;                                                         20591300
REAL SUBROUTINE SCAN;                                                   20591350
     SCAN:= SCN(UNITNO,CARDLOC,SOURCE,ACCUM,COUNT,LASTSCAN);            20591400
                                                                        20591450
          LABEL OPTN0,OPTN1,OPTN2,OPTN3,SEC1,SEC2,SEC5,ST1,             20591500
                ST2,LS;                                                 20591550
         SWITCH SW:= OPTN0,OPTN1,OPTN2,OPTN3;                           20591600
          GO TO SW[OPTNN];                                              20591650
OPTN0:    USERID:= ABS(USERID);                                         20591700
          IF SCAN LSS IDENT THEN BEGIN CCSECMAINT:=6;GO EXIT END;       20591750
          SMID:= CMM[0]:= ACCUM[0]; CN:=SCAN;                           20591800
          IF SCAN LSS IDENT THEN BEGIN CCSECMAINT:=6; GO EXIT END;      20591850
          SFID:= CMM[1]:= ACCUM[0]; CDEX:= 0;                           20591900
          IF (SFH:=DIRECTORYSEARCH(SMID,SFID,4))=0 THEN GO TO LS;       20591950
          IF NOT((SMID EQV "PBD    ")=NOT 0) AND (M[SFH+5]=0            20592050
               AND M[SFH+2] NEQ 0) THEN                                 20592100
% INHIBIT USE ON PUBLIC, SECURE FILES                                   20592150
          BEGIN CN:=SCAN; GO TO OPTN2 END;                              20592200
          OPTN:=0; CMM[2]:= SFH;                                        20592250
          FORGETSPACE(DIRECTORYSEARCH(CMM[0],CMM[1],14));               20592300
                                                                        20592350
OPTN1:    STREAM(USERID,Q:=USERID>0,B:=[CMM],D:=CN:=SPACE(10));         20592400
          BEGIN Q(SI:=LOC USERID; SI:=SI+1;DS:=LIT " "; DS:= 7CHR;);    20592450
                DS:= 17LIT " INVALID USER OF "; SI:=B;                  20592500
                SI:=SI+1; DS:= 7CHR; DS:=LIT "/"; SI:=SI+1; DS:= 7CHR;  20592550
                 DS:=LIT"~";                                            20592600
          END STREAM;                                                   20592650
          SPOUT(CN); FORGETSPACE(CMM[2]);                               20592700
          IF OPTN NEQ 0 THEN GO TO SEC5;                                20592750
          IF UNITNO GEQ 32 THEN BEGIN CCSECMAINT:=5;GO EXIT END;        20592800
          GO TO CCC;                                                    20592850
OPTN2:    CMM[5]:=USERID;                                               20592900
          ST:= CDEX:= 0;                                                20592950
    SEC1: FOR OPTN:=0 STEP 1 UNTIL 1 DO                                 20593000
          BEGIN CN:= SCAN; IF T=OPEN AND CN=UNLOCKV AND OPTN=0 THEN     20593050
                BEGIN T:= UNLOCKV; GO TO SEC1; END                      20593100
                ELSE IF CN LSS IDENT AND CN NEQ EQUAL THEN GO TO ST1;   20593150
                CMM[OPTN]:= IF CN=EQUAL THEN -1 ELSE ACCUM[0];          20593200
                CN:=SCAN;                                               20593250
          END;                                                          20593300
          IF CMM[0] GEQ 0 AND CMM[1] GEQ 0 THEN GO TO SEC2;             20593350
          N1:= CMM[0]; N2:= CMM[1]; N3:= 0; ST:= 1;                     20593400
    ST2:  SEEKNAM (N1,N2,N3,CMM[0],CMM[1],T1);                          20593450
          IF N3 NEQ 0 THEN GO TO SEC2;                                  20593500
          ST:= 0; GO TO SEC5;                                           20593550
    SEC2: IF (ABS(USERID)EQV MCP) NEQ NOT 0 THEN                        20593600
          IF (CMM[0] EQV "PBD    ") = NOT 0 THEN GO TO SEC5;            20593650
          SECURITYMAINT(T,SMID,SFID,CMM,SFH,CARD);                      20593750
    SEC5: IF ST THEN GO TO ST2;                                         20593800
          IF CN=COMMA THEN GO SEC1;                                     20593850
          IF T=USEV THEN                                                20593900
          BEGIN DISKWAIT(SFH.[CF],30,SFH.[FF]);                         20593950
                P(DIRECTORYSEARCH(-SMID,SFID,14),DEL);                  20593960
          END;                                                          20593970
          GO TO CCC;                                                    20594000
                                                                        20594050
OPTN3:    CADDR:= CDEX:= 0;                                             20594100
          IF (LIBNO:=LIBCC(CARD,SOURCE,ACCUM,COUNT,LASTSCAN,USERID,PROG,20594150
              CMM,OPTN,T))>1 THEN BEGIN CCSECMAINT:=2; GO EXIT END      20594200
         ELSE IF LIBNO THEN BEGIN CCSECMAINT:=6; GO EXIT END            20594250
         ELSE BEGIN CCSECMAINT:=0; GO EXIT END;                         20594300
LS: LBMESS(-CMM[0],CMM[1]," NOT IN"," DIRECT","ORY    ",0,0);           20594350
    REPORTBACK(NOTIN,0,0);                                              20594360
    IF UNITNO GEQ 32 THEN BEGIN CCSECMAINT:=5; GO EXIT END;             20594400
CCC: DO T~SCAN UNTIL T>IDENT AND T{RESETV;                              20594450
    IF UNITNO=31 AND NT1 GEQ 0 THEN BEGIN CCSECMAINT:=7; GO EXIT END;   20594500
    NT1:= 0;  CCSECMAINT:=1; GO EXIT;                                   20594550
ST1:      IF T=USEV THEN                                                20594600
          FORGETSPACE(DIRECTORYSEARCH(SMID,SFID,SFH&1[2:47:1]));        20594650
          CCSECMAINT:=6;                                                20594700
EXIT:                                                                   20594750
END CCSECMAINT;                                                         20594800
REAL PROCEDURE CCLABEL(UNITNO,USERID,CN,CARDLOC,T,SOURCE,ACCUM,         20594850
                       COUNT,LASTSCAN);                                 20594900
          REAL UNITNO,USERID,CN,CARDLOC,T,SOURCE,COUNT,LASTSCAN;        20594950
          ARRAY ACCUM[*];                                               20595000
BEGIN                                                                   20595050
LABEL EXIT;                                                             20595100
     CN:=0;                                                             20595150
     UNITCODE[UNITNO-23]:= USERID;                                      20595200
     MULTITABLE[UNITNO]:= 0;                                            20595250
     RDCTABLE[UNITNO]:= 1&1[14:38:10];                                  20595300
     IF UNITNO=23 THEN BEGIN CN:=READERA.[FF];READERA:=CARDLOC END      20595350
     ELSE IF UNITNO=24 THEN BEGIN CN:=READERB.[FF];READERB:=CARDLOC END 20595400
     ELSE IF UNITNO GEQ 32 THEN BEGIN CN:= CIDROW[UNITNO-32].[3:5];     20595450
                                CIDROW[UNITNO-32]:=(*P(DUP))&0[3:43:5]& 20595500
                                                   CARDLOC[CTF];        20595550
%VOID                                                                   20595560
                                END;                                    20595600
     IF CN THEN BEGIN LABELTABLE[UNITNO]:= "CARD 00" OR                 20595650
                ((IF UNITNO GEQ 32 THEN "C/" ELSE @5772) + UNITNO);     20595700
                 CCLABEL:=8; GO EXIT;                                   20595750
                END;                                                    20595800
     IF T = LABEV THEN BEGIN                                            20595850
                       MULTITABLE[UNITNO]:=M[CARDLOC+1].[6:42];         20595900
                       STREAM(A:=0,B:=0,C:=0:D:=CARDLOC+3);             20595950
                       BEGIN DI:=LOC A; SI:=D;DS:=3OCT;                 20596000
                             DS:=5OCT; DS:=2OCT; END;                   20596050
                       P(P(XCH)&P[24:31:17]&P(XCH)[14:38:10],           20596100
                       [RDCTABLE[UNITNO]],~);%                          20596150
                       LABELTABLE[UNITNO]:=M[CARDLOC+2].[6:42];         20596200
                       END                                              20596250
     ELSE IF SCN(UNITNO,CARDLOC,SOURCE,ACCUM,COUNT,LASTSCAN) GEQ IDENT  20596300
          THEN LABELTABLE[UNITNO]:= ACCUM[0]                            20596350
          ELSE BEGIN IF UNITNO GEQ 32 THEN                              20596400
               CIDROW[UNITNO-32].[18:15]:=0;                            20596450
               CCLABEL:=6; GO EXIT;                                     20596500
               END;                                                     20596550
         CCLABEL:=8;                                                    20596600
EXIT:                                                                   20596650
END CCLABEL;                                                            20596700
PROCEDURE CONTROLCARD(CARD); VALUE CARD; REAL CARD;                     20597550
BEGIN                                                                   20597600
    LABEL CC,CCTYPE,COMPILE,INITIALIZATION,BEFORETRYNEXT,TRYNEXT,       20597650
          CONTROLER,CONTROLA,COMPILEJOB,COMJOB,EXEC,EXRUN,RUN,          20597700
          USERS,USES,SECBOMB,UNLOX,LOX,FREES,OPENS,ENTE,                20597750
          LCOPY,CHANGE,REMOVE,UNITI,INCSC,ENDF,ENDECK,SAVEND,           20597800
          LABE,FINIS,ZIPEXIT,EXIT,SET,RSET;                             20597850
    SWITCH TYPE:= UNLOX,USES,LOX,FREES,OPENS,USERS,                     20597900
                  RUN,COMPILE,EXEC,LCOPY,LCOPY,ENTE,ENTE,REMOVE,        20597950
                  CHANGE,UNITI,ENDF,LABE,LABE,SET,RSET;                 20598000
    REAL       A       = +1,%                                           20598050
               PPCPROCESS=A+1,%                                         20598100
               T1        = PPCPROCESS+1,%                               20598150
               CN        = T1+1,%                                       20598200
               N1       = CN+1,%                                        20598250
               N2        = N1+1,%                                       20598300
               N3        = N2+1,%                                       20598350
               ST       = N3+1,%                                        20598400
               U         = ST+1,%                                       20598450
               N4        = U,%                                          20598500
               OPTN      = U+1,%                                        20598550
               CDEX      = OPTN+1,%                                     20598600
               SDEX      = CDEX,%                                       20598650
               PDEX      = CDEX+1,%                                     20598700
               SMID      = PDEX,%                                       20598750
               CADDR     = PDEX+1,%                                     20598800
               SFID      = CADDR,%                                      20598850
               PADDR     = CADDR+1,%                                    20598900
               SFH       = PADDR,%                                      20598950
               T         = A,%                                          20599000
               UNITNO    = PADDR+1,%                                    20599050
               CARDLOC   = UNITNO+1,%                                   20599100
               SOURCE    = CARDLOC+1,%                                  20599150
               COUNT     = SOURCE+1,%                                   20599200
               LASTSCAN  = COUNT+1,%                                    20599250
               USERID    = LASTSCAN+1,%                                 20599300
               INV       = USERID+1,%                                   20599350
               SMD       = INV+1,%                                      20599400
               SFD       = SMD+1,%                                      20599450
               NT1       = SFD+1,%                                      20599500
               CLOSET    = NT1+1,%                                      20599550
               RCW       = +0,%                                         20599600
               LIBNO     = CLOSET+1,%                                   20599650
               CMPLR     = LIBNO+1;%                                    20599700
    BOOLEAN TOG  = CMPLR+1;                                             20599750
    NAME ADDR = TOG+1;%                                                 20599800
                                                                        20599850
    ARRAY CMM  = ADDR+1[*],%                                            20599900
          PROG = CMM+1[*],%                                             20599950
          CEQN = PROG+1[*],%                                            20600000
          PEQN = CEQN+1[*],%                                            20600050
          NB   = PEQN+1[*],%                                            20600100
          ACCUM= NB+1[*];%                                              20600150
REAL SUBROUTINE SCAN;                                                   20600200
     SCAN:=SCN(UNITNO,CARDLOC,SOURCE,ACCUM,COUNT,LASTSCAN);             20600250
SWITCH SW:=CC,CCTYPE,INITIALIZATION,BEFORETRYNEXT,SECBOMB,ENDECK,       20600300
           INCSC,ZIPEXIT,EXIT;                                          20600350
DEFINE SECMAINT(SECMAINT1)=CCSECMAINT(USERID,UNITNO,CARDLOC,SOURCE,ACCUM20600400
       ,COUNT,LASTSCAN,CMM,PROG,SFID,SMID,CDEX,SFH,CN,CARD,N1,N2,N3,ST, 20600450
       T,T1,LIBNO,CADDR,OPTN,SECMAINT1)#;                               20600500
         P(0,0,0,0,0,0,0,0,0,0);%                                       20600600
         P(0,0,0,0,0,0,0,0,0,0);%                                       20600650
         P(0,0,0,0,0,0,0,0,0,0);%                                       20600700
         P(0,0,0,0,0);%                                                 20600750
%VOID                                                                   20600800
         UNITNO:= (CARD.[3:5]+28).[43:5]+4;                             20600850
         IF CARD.[33:15] = 0 THEN                                       20600900
              BEGIN CARD.[33:15] := SPACE(13)+2;                        20600950
              IF WAITIO(CARD INX @40000000,@15,UNITNO).[45:3] NEQ 0%    20601000
              THEN                                                      20601050
                  BEGIN LABELTABLE[UNITNO] := @114;%                    20601100
                  RRRMECH := NOT TWO (UNITNO) AND RRRMECH;%             20601150
                  FORGETSPACE(CARD INX NOT 1);%                         20601200
                  KILL([CARD] INX NOT 1);%                              20601250
                  END;                                                  20601300
              END;                                                      20601350
         IF SWAPEND=0 THEN SLEEP([SWAPEND],63);                         20601360
COMMENT SET UP ACCUM ARRAY FOR SCAN;%                                   20601450
        ACCUM:=[M[SPACE(10)]]&10[8:38:10];%                             20601500
        ACCUM[0] := 0;%                                                 20601550
COMMENT BRING IN RESERVED WORDS, SET MEMORY LINK TO SAVE;%              20601600
         RESWDS;%                                                       20601650
         DIRECT ~ [M[P(..RESWDS,LOD,1,INX)]]&151[8:38:10];              20601700
         CCTOG:=CCTOG+1;%                                               20601750
         M[P(..RESWDS,LOD,1,NOT,INX)] .[2:1]~1;                         20601800
         CMM:= IOQUE&SPACE(130)[CTC];                                   20601850
         PEQN:=(31 INX (CEQN:=(31 INX(PROG:=(31 INX CMM)))));%          20601900
          % PLACE "." IN COL 73 ;%                                      20601950
         CARDLOC := CARD INX 0;%                                        20602000
         IF UNITNO=25 OR UNITNO=26 OR UNITNO=30 OR UNITNO=31 THEN       20602050
         SOURCE:=CARDLOC ELSE                                           20602100
         MEMORY[(SOURCE:=CARDLOC)+9]:=0&"."[1:43:5];%                   20602150
         IF UNITNO GEQ 32 AND UNITCODE[UNITNO-23].[1:1] THEN            20602200
            UNITCODE[UNITNO-23]:=M[CARDLOC + 10];                       20602250
         IF UNITNO=25 OR UNITNO=30 OR UNITNO=31 THEN USERID:=MCP ELSE   20602300
         BEGIN IF UNITNO=26 THEN UNITNO:=31;%                           20602350
         USERID:=UNITCODE[UNITNO-23];%                                  20602400
         END;%                                                          20602450
         IF LOGLINE=0 THEN LOGLINE:=-UNITNO;                            20602500
COMMENT SCAN FOR CARD WITH QUESTION MARK IN COL. 1;%                    20602550
                                                                        20602600
CC:      IF SCAN NEQ QUEST THEN GO TO INCSC;%                           20602650
         T:=SCAN;                                                       20602700
                                                                        20602750
CCTYPE:    IF (T LSS UNLOCKV) OR (T GTR RESETV) THEN%                   20602800
         GO TO INCSC;%                                                  20602850
%   BRANCH ON 1ST WORD ON CONTROL CARD%                                 20603450
          CMPLR:= -1;                                                   20603460
          LIBNO:=0;                                                     20603500
          TOG:= FALSE;                                                  20603550
          IF (T LEQ ENTER) AND (T GEQ RUNV) THEN                        20603555
               BEGIN                                                    20603560
               M[CARDLOC-2] := 0;                                       20603565
               DISKWAIT(CARDLOC,10,CMM[6]:=GETESPDISK);                 20603570
               END;                                                     20603575
          GO TO TYPE[ T - UNLOCKV ];%                                   20603600
                                                                        20603650
% COMPILER CALL OUT CARD%                                               20603700
COMPILE: IF CCCOMPILE(CEQN,CMM,PROG,CARD,UNITNO,CARDLOC,LASTSCAN,       20603750
                      ACCUM,COUNT,USERID,T,SOURCE,CDEX,CMPLR,OPTN,      20603800
                      CADDR,CN) THEN GO TO INCSC;                       20603850
INITIALIZATION: GO SW[INITIALIZEIT(PROG,CMM,PDEX,PADDR,T,CARD,N1,USERID,20603900
                      OPTN,UNITNO,CARDLOC,SOURCE,ACCUM,COUNT,LASTSCAN,  20603950
                      PEQN)];                                           20604000
BEFORETRYNEXT: IF OPTN=PERIO THEN GO TO CONTROLER;                      20604050
TRYNEXT: DO UNTIL SCAN = PERIO;                                         20604100
CONTROLER: PPCPROCESS:= 1;                                              20604150
           IF SCAN NEQ QUEST THEN GO TO INCSC;                          20604200
           T:= SCAN;                                                    20604250
CONTROLA: IF (T LSS SETV OR T>COBOL) AND ACCUM[0] NEQ CMPLR THEN        20604300
            IF T GEQ UNLOCKV AND T LEQ LABEV THEN GO TO FINIS           20604350
            ELSE GO TO INCSC;                                           20604360
%VOID                                                                   20604400
%VOID                                                                   20604450
          IF T GEQ ALGOL OR ACCUM[0]=CMPLR THEN                         20604500
           IF OPTN=EXECU OR OPTN=RUNV THEN                              20604550
              GO TO TRYNEXT                                             20604600
           ELSE GO TO COMPILEJOB;                                       20604650
         IF OPTN=SYNTA THEN GO TO TRYNEXT;                              20604700
         IF OPTN=EXECU OR OPTN=RUNV THEN GO TO COMJOB;                  20604750
% CALL PPC FOR COMPILE AND GO JOB%                                      20604800
         IF PPC(PADDR,PEQN,PROG,PDEX,T,UNITNO,CARDLOC,SOURCE,ACCUM,     20604850
                LASTSCAN) THEN GO TO INCSC;                             20604900
         GO TO CONTROLER;                                               20604950
COMPILEJOB: T:=SCAN;                                                    20605000
COMJOB: IF PPC(CADDR,CEQN,CMM,CDEX,T,UNITNO,CARDLOC,SOURCE,ACCUM,       20605050
                LASTSCAN) THEN GO TO INCSC;                             20605100
        GO TO CONTROLER;                                                20605150
                                                                        20605200
COMMENT EXECUTE CARD;%                                                  20605250
EXEC: OPTN:= EXECU; CMM[2]:= 0&2[8:38:10];                              20605300
EXRUN: CMM[13]:= CADDR:= CDEX:= 0;                                      20605350
       T:=SCAN; CMM[0]:= ACCUM[0];                                      20605400
       T:=SCAN;T:=SCAN; CMM[1]:=ACCUM[0];                               20605450
%VOID                                                                   20605500
       GO TO INITIALIZATION;                                            20605550
RUN: OPTN:= RUNV; CMM[2]:=0&5[8:38:10];                                 20605600
     GO TO EXRUN;                                                       20605650
USERS: T:=SCAN; T:= SCAN; IF USERID.[1:1] THEN                          20605700
       IF USERID NEQ MCP THEN%                                          20605750
       USERID:= ACCUM[0];                                               20605800
       NT1:= -1;                                                        20605850
       DO T~SCAN UNTIL T>IDENT AND T{RESETV;                            20605900
       IF UNITNO=31 AND NT1 GEQ 0 THEN GO TO ZIPEXIT;                   20605950
       NT1:= 0; GO TO CCTYPE;                                           20606000
USES: GO SW[SECMAINT(0)];                                               20606050
SECBOMB: GO SW[SECMAINT(1)];                                            20606100
UNLOX:                                                                  20606150
LOX:                                                                    20606200
FREES:                                                                  20606250
OPENS:                                                                  20606300
       GO SW[SECMAINT(2)];                                              20606350
ENTE::                                                                  20606400
LCOPY:                                                                  20606450
CHANGE:                                                                 20606500
REMOVE:                                                                 20606550
       GO SW[SECMAINT(3)];                                              20606600
SET: TOG:= TRUE;                                                        20606650
RSET: IF ACESBIT(CARD,SOURCE,ACCUM,COUNT,LASTSCAN,USERID,CMM,           20606700
                 TOG) THEN GO TO CC ELSE GO TO INCSC;                   20606750
UNITI: GO SW[CCUNIT(UNITNO,CARDLOC,SOURCE,ACCUM,COUNT,LASTSCAN,T,CN)];  20606800
INCSC: IF UNITNO=31 THEN                                                20606850
       BEGIN STREAM(A:=T:=GETSPACE(10,0,0)+2);                          20606900
             DS:=19LIT " ZIP ERROR-IGNORED~";                           20606950
       REPORTBACK(ZIPER,0,0);                                           20607000
       SPOUT(T); GO TO ZIPEXIT;                                         20607010
       END;                                                             20607050
       LASTSCAN:= 0;                                                    20607100
       STREAM(CARDLOC,B:=TINU[UNITNO].[30:18],A:=(T:=GETSPACE(15,0,0)   20607150
              + 2 ));                                                   20607200
       BEGIN                                                            20607250
       DS:=20LIT"#CONTROL CARD ERROR ";                                 20607300
       SI:=LOC B; SI:=SI+5;DS:=3 CHR; DS:=LIT " ";                      20607350
       SI:=CARDLOC; DS:=9 WDS; DS:=LIT"~";                              20607400
       END;                                                             20607450
          IF UNITNO=30 THEN                                             20607500
         BEGIN TWXOUT(T,100,1 OR M,ABS(SPOWORD));                       20607550
               GO TO ZIPEXIT;                                           20607600
          END;                                                          20607650
          IF UNITNO NEQ 25 THEN                                         20607700
          BEGIN SPOUT(T);                                               20607750
          IF UNITNO GEQ 32 THEN GO TO ENDECK;                           20607800
          END ELSE                                                      20607950
          BEGIN P(WAITIO(T,0,25),DEL);                                  20608000
                FORGETSPACE(T);                                         20608050
              GO TO ENDF;                                               20608060
          END;                                                          20608100
       DO DO                                                            20608150
            FETCH(-UNITNO,CARDLOC,SOURCE)                               20608200
          UNTIL SCAN=QUEST                                              20608250
       UNTIL SCAN=ENDFI;                                                20608300
                                                                        20608450
ENDF:: IF UNITNO NEQ 30 THEN UNITCODE[UNITNO-23]:= -0;                  20608500
       IF UNITNO=23 THEN READERA:=0 ELSE                                20608510
       IF UNITNO=24 THEN READERB:=0 ELSE                                20608520
        IF UNITNO GEQ 25 THEN                                           20608550
        IF UNITNO GEQ 32 THEN                                           20608600
           IF CIDTABLE[UNITNO-32,3] LSS CIDTABLE[UNITNO-32,7]THEN       20608650
           BEGIN FETCH(UNITNO,CARDLOC,SOURCE); GO TO CC END ELSE        20608700
ENDECK:    BEGIN ENDOFDECK(UNITNO-32);                                  20608750
                 GO TO ZIPEXIT;                                         20608800
           END                                                          20608850
           ELSE GO TO ZIPEXIT;                                          20608900
           IF(TWO(UNITNO) AND SAVEWORD) NEQ 0 THEN GO TO SAVEND;        20608950
           IF WAITIO(CARDLOC&400[18:33:15],@15,UNITNO).[45:3] NEQ 0 THEN20609000
           BEGIN                                                        20609050
SAVEND: LABELTABLE[UNITNO]:= @114;                                      20609100
        RRRMECH:= NOT (NT1:= TWO(UNITNO)) AND RRRMECH OR                20609150
                  NT1 AND SAVEWORD;                                     20609200
        GO TO ZIPEXIT;                                                  20609250
           END;                                                         20609300
        M[(SOURCE:= CARDLOC)+9]:= 0&"."[1:43:5];                        20609350
        USERID:= UNITCODE[UNITNO-23];                                   20609400
        GO TO CC;                                                       20609450
LABE: GO SW[CCLABEL(UNITNO,USERID,CN,CARDLOC,T,SOURCE,ACCUM,COUNT,      20609500
                    LASTSCAN)];                                         20609550
FINIS::     CCFINISH(CMM,PROG,CEQN,PEQN,CN,T,PPCPROCESS,OPTN,           20609600
                     PDEX,CDEX,LIBNO,CLOSET,PADDR,CADDR);               20609650
           SELECTION;                                                   20609700
            IF UNITNO NEQ 31 THEN                                       20609750
            IF LIBNO NEQ 0 AND (UNITNO=23 OR UNITNO=24 OR UNITNO GEQ 32)20609800
               AND T NEQ ENDFI THEN                                     20609850
            BEGIN                                                       20609900
                 LABELTABLE[UNITNO]:=@214;                              20609950
                 SLEEP([LABELTABLE[UNITNO]],@100);                      20610000
                 LABELTABLE[UNITNO]:=-@14;                              20610050
                 GO TO CCTYPE;                                          20610100
            END ELSE GO TO CCTYPE;                                      20610150
ZIPEXIT:    FORGETSPACE(CARDLOC-2);                                     20610200
EXIT::                                                                  20610250
         FORGETSPACE(ACCUM INX 0);%                                     20610300
         FORGETSPACE(CMM INX 0);%                                       20610350
         IF (CCTOG:=CCTOG - 1) LEQ 0 THEN                               20610400
         M[P(..RESWDS,LOD,1,NOT,INX)] .[2:1]~0;                         20610450
         KILL([CARD] INX NOT 1);%                                       20610600
END CONTROLCARD;                                                        20610650
 SAVE PROCEDURE SWAP(STATE,B); VALUE STATE,B; REAL STATE,B;             21000100
         BEGIN IF B=1 THEN                                              21001000
              IF TERMSET(P1MIX) THEN P(XIT);                            21001100
$INCLUDE 21001131, IF STATISTICS;                                       21001109
              IF (STATE=TIMEND) OR (STATE=WAITSWAP) OR                  21001110
              (STATE=FORCESWAP) THEN                                    21001120
              CORETIME[P1MIX]:=(*P(DUP))+CLOCK+P(RTR)-TIMING[P1MIX];    21001130
              STASUS[P1MIX]~STATE;                                      21001200
              IF STASUS[0]=READYSTATE THEN                              21001300
              BEGIN STASUS[0]~RUNNING;                                  21001400
                   FORK(P(.SWAPPER),0,-2,0,1);                          21001500
              END;                                                      21001600
              LINK[SWAPEND]~P1MIX;                                      21002000
              LINK[SWAPEND~P1MIX]~0;                                    21002100
              IF B THEN SLEEP([SQ[P1MIX]],0&RUNNING[18:42:6]);          21003000
         END;                                                           21004000
 PROCEDURE REENTER(STUFF); VALUE STUFF; REAL STUFF;                     21005000
    BEGIN REAL LOG=+5;                                                  21005100
         PROCTIME[P1MIX ~ STUFF.[3:5]] ~ *P(DUP)-P(RTR)-CLOCK;          21006000
         PRIORTY~PRYOR[P1MIX];                                          21006100
         M[STUFF.[FF]]~1;                                               21007000
         P(STUFF,STS);                                                  21008000
         P(0&STUFF[CTF],STF);                                           21009000
         LOGLINE ~ LOG;                                                 21009100
         STACKUSE ~ TRUE;                                               21010000
         GO TO P(.SLEEP,LOD);                                           21011000
    END;                                                                21012000
 PROCEDURE BRINGBACK(MIX); VALUE MIX; REAL MIX;                         21012100
$INCLUDE 21012111, IF STATISTICS;                                       21012109
         BEGIN REAL T;                                                  21012110
$INCLUDE 21012121, IF STATISTICS;                                       21012119
              T:=CLOCK+P(RTR);                                          21012120
         BEGIN IF (STASUS[MIX] AND STABLE)=0 THEN                       21012200
                   SLEEP([SQ[MIX]],0&STABLE[18:42:6]);                  21012300
              IF STASUS[MIX]=WAITSTATE THEN                             21012400
                   BEGIN STASUS[MIX]~SATISFY;                           21012500
$INCLUDE 21012506, IF STATISTICS;                                       21012504
                        SWAPDELAY[MIX]:=T;                              21012505
                        IF STASUS[0]=READYSTATE THEN                    21012510
                        BEGIN STASUS[0]~RUNNING;                        21012520
                             FORK(P(.SWAPPER),0,-2,0,1);                21012530
                        END;                                            21012540
                        LINK[SWAPEND]~MIX;                              21012600
                        LINK[SWAPEND~MIX]~0;                            21012610
                   END                                                  21012700
$INCLUDE 21012711, IF STATISTICS;                                       21012709
         END                                                            21012710
         END BRINGBACK;                                                 21012800
 SAVE PROCEDURE MCPIN(S); VALUE S; REAL S;                              21013000
         BEGIN REAL T,X,Y,Z;                                            21015000
              IF NOT M[S].[7:1] THEN                                    21016000
                   SLEEP([M[S]],0&1[7:47:1]);                           21017000
              IF (Y~NFLAG(M[S])).[CF]=(*P(.ESPBIT)).[CF] THEN           21018000
              BEGIN Z~Y.[8:10]; M[S].[7:1]~0;                           21019000
                   T~GETSPACE(Z,65,0)+2;                                21020000
                   DISKWAIT(-T,Z,Y.[FF]+MCPBASE);                       21021000
                   M[T-2].[2:1]~0;                                      21022000
                   M[T-1]~S&Z[CTF];                                     21023000
                   M[S]~ FLAG(Y)&T[CTC];                                21024000
              END;                                                      21025000
         END;                                                           21026000
% VOID.  MOVED TO 19991000.                                         %R7521026100
% VOID.                                                             %R7521026200
% VOID.                                                             %R7521026300
% VOID.                                                             %R7521026400
 PROCEDURE EXPANDER(MIX,R);                                             21026500
         VALUE MIX,R;                                                   21026600
         REAL MIX,R;                                                    21026700
         FORWARD;                                                       21026800
 BOOLEAN PROCEDURE UNHOOKANDWAIT(MIX,MCP); VALUE MIX,MCP; REAL MIX,MCP; 21027000
    BEGIN REAL I,J,K,L,N,MSTART;                                        21028000
         ARRAY A[*];%   HIDES THE INTABLE DESCRIPTOR                    21028500
       ARRAY LINKR =A[*],LINKOR=A[*,*];                                 21028600
         LABEL FOUND;                                                   21029000
         IF IOCOUNT[MIX] GEQ 0 THEN                                     21029100
         BEGIN CLICK:=CLOCK+P(RTR)+900;          %GIVE HIM 15 SECS.     21029200
              SLEEP([IOCOUNT[MIX]],-0);                                 21029300
              IF IOCOUNT[MIX] GEQ 0 THEN                                21029400
              BEGIN STASUS[MIX]:=RUNNING;                               21029500
                   UNHOOKANDWAIT:=TRUE;                                 21029600
                   IF NOTERMSET(MIX) THEN                               21029700
                   BEGIN TERMINALCLOCK := CLOCK+P(RTR);                 21029720
                        PRTROW[MIX].[FF] := 19;                         21029740
                   END;                                                 21029760
                   PRTROW[MIX].[PSF] := 1;                              21029780
                   P(RTN);                                              21029800
         END  END;                                                      21029900
         UNHOOKANDWAIT:=FALSE;                                          21030000
         WAITSTORE(0);                                                  21031000
         STOREDY[0]~0;                                                  21032000
         MSTART ~ MEM[0,MLINK1].[CF];                                   21033000
         LINKR~BED1;                                                    21034000
         WHILE TRUE DO                                                  21034500
              IF LINKR[2]=MIX THEN GO TO FOUND                          21035000
              ELSE LINKR~LINKR[1];                                      21035500
    FOUND:J~TOPSK[MIX]~LINKR[FREG].[FF];                                21036000
                   LINKOR[0,1] ~ LINKR[1];                              21037000
                   LINKOR[1,0].[CF] ~ LINKR[0];                         21038000
         L:=LINKR[4];                                                   21039000
         DO IF (N~M[J]).[CF]>MSTART THEN                                21040000
              IF N.[CF] LSS FENCE THEN                              %R8821040100
              BEGIN K~MSTART;                                           21041000
                   DO BEGIN I~K;                                        21042000
                        K~M[I].[CF];                                    21043000
                   END UNTIL N.[CF]<K;                                  21044000
                   M[N.[FF]].[CF]~M[I+1];                               21045000
                   M[J]~ NFLAG((NOT(I+1))INX N);                        21046000
              END UNTIL (J~N.[FF])<64;                                  21047000
         % HERE BEE DRAGONS . . .                                       21048000
                                                                        21049000
         N ~ M[K ~ PRT[MIX,8].[CF]].[CF];  J ~M[0].[CF];                21050000
         IF N<FENCE THEN BEGIN                                          21050100
         DO J ~ M[I ~ J].[CF] UNTIL J>N;                                21051000
         IF M[I].[3:12]=@700 THEN                                       21052000
         BEGIN M[K] ~ NFLAG(*P(DUP))&(N-I-2)[CTC];                      21053000
              N ~ M[I+1].[8:10]-1;                                      21054000
              STREAM(N~N AND 3: T~INTABLE[MIX,N.[36:10]]);              21054100
              BEGIN SI~LOC T;  SI~SI+N;  SI~SI+N;                       21054200
                   DI~LOC N;  DI~DI+6;  DS~2 CHR;  END STREAM;          21054300
              N ~ POLISH;                                               21054400
         END ELSE N ~ 0;                                                21055000
         END ELSE N ~ 0;                                                21055100
         M[K-1] ~ (*P(DUP))&N[18:38:10];                                21056000
         N ~ INTRNSC[0]-1;  I ~ J ~ 0;  A ~ INTABLEROW[MIX];            21057000
         IF A!0 THEN                                                    21057100
         DO BEGIN;                                                      21058000
              STREAM(I~I AND 3: T~[A[I.[36:10]]]);                      21059000
              BEGIN SI~LOC I;  DI~DI+I;  DI~DI+I;                       21060000
                   IF 2 SC!DC THEN TALLY~1;  I~TALLY;                   21061000
              END STREAM;                                               21062000
              IF POLISH THEN                                            21063000
                IF ((J ~ INTRNSC[I+1]).[CF]>1023) AND J<0 THEN          21064000
                   J ~ OLAY(J.[CF]-2,MIX);                              21065000
         END UNTIL (I~I+1)=N;                                           21066000
         DAT[MIX]~-*P(DUP);                                             21067000
         % THERE BEE A SLAIER OF DRAGONS . . .                          21068000
         STOREDY[0]~1;                                                  21093000
         IF L.[33:7]!0 THEN                                             21094000
         BEGIN CLEARTANK(L,MCP);                                        21095000
              STATABLE[L.[40:8]]:=(*P(DUP))&3[2:46:2];                  21096000
         END;                                                           21097000
    END UNHOOKANDWAIT;                                                  21099000
 PROCEDURE HOOKUPMCP(MIX); VALUE MIX; REAL MIX;                         21100000
    BEGIN REAL J,N,S,T;                                                 21101000
         FORK(P(.REENTER),(J~TOPSK[MIX])&[T][CTF]&MIX[3:43:5],-2,0,0);  21102000
         IF (N~M[J+5]).[33:7]!0 THEN                                    21103000
$OMIT 21103101, IF DCP;                                                 21103049
         IF (STATABLE[N.[40:8]]:=(*P(DUP))&2[2:46:2]).STATIONTYPE=TWX   21103050
         THEN                                                           21103100
$INCLUDE 21103111, IF DCP;                                              21103109
         IF NOT (STATABLE[N.[40:8]]:=(*P(DUP))&2[2:46:2]).[11:1] THEN   21103110
         IF TANKS[N.[40:8]].[SOUSE]=0                                   21103150
              THEN IF SLN[MIX]!0 THEN                                   21103200
                   BEGIN S~TWO(CLOCK.[40:2]|6)|"~00";                   21103300
                        TWXOUT([S].[CF],8,1&3[1:46:2],N);               21103500
                   END;                                                 21103600
         SLEEP([T],1);                                                  21104000
         DO IF P(N~M[J],TOP,XCH,DEL) THEN                               21105000
              BEGIN S~M[N.[FF]].[CF];                                   21106000
                   M[N.[FF]].[CF]~0;                                    21107000
                   MCPIN(S);                                            21108000
                   M[J]~FLAG(M[S] INX N);                               21109000
              END UNTIL (J~N.[FF])<64;                                  21110000
         IF (J ~ M[(S ~ PRT[MIX,8].[CF])-1].[18:10])!0 THEN             21110100
         BEGIN N ~ J INX PRT[MIX,4];                                    21110200
              MAKEPRESENT(P(MIX,PRTROW[MIX] INX N.[8:10]));             21110300
              M[S] ~ FLAG(*P(DUP))&(P(DUP) INX (N.[FF]))[CTC];          21110400
              M[S-1].[18:10] ~0;                                        21110500
         END;                                                           21110600
         DAT[MIX]~-*P(DUP);                                             21110700
         FOR J~0 STEP 1 UNTIL 29 DO                                     21111000
         IF J<16 OR J>19 THEN                                           21111100
         IF RDCTABLE[J].[8:6]=MIX THEN                                  21111200
         IF UNIT[J].[13:5]=31 THEN                                      21111300
         IF ((T~TWO(J)) AND P(RRR))!0 THEN                              21111400
         BEGIN UNIT[J].[13:5]~16;                                       21111500
              READY~READY AND NOT T;                                    21111600
              RRRMECH~RRRMECH AND NOT T;                                21111700
         END;                                                           21111800
    END HOOKUPMCP;                                                      21111900
 PROCEDURE SWAPINGIO(MIX,R); VALUE MIX,R; REAL MIX,R;                   21112000
    BEGIN INTEGER S;                                                    21113000
         REAL I,J,K,F,T0,T1,T2,T3,B,D,MSTART;                       %R0221114000
         ARRAY A=B[*];                                                  21115000
         NAME N;                                                        21116000
    STREAM PROCEDURE MOVE(N,H,T); VALUE N,H,T;                          21116100
         BEGIN LOCAL I,J;                                               21116200
              SI~LOC N; SI~SI+5; DI~LOC I; DI~DI+7; DS~CHR;             21116300
              DI~LOC J; DI~DI+7; DS~CHR;                                21116400
              SI~H; DI~T;                                               21116500
              I(32(DS~32 WDS; DS~32 WDS; DS~32 WDS; DS~32 WDS));        21116600
              J(DS~32 WDS; DS~32 WDS);                                  21116700
              DS~N WDS;                                                 21116800
         END SUPERMOVE;                                                 21116900
    SUBROUTINE DODISK;                                                  21117000
         BEGIN; STREAM(B,J); BEGIN SI~LOC B; DS~8DEC END;               21118000
              B~B+S+2;                                                  21119000
              D~J&S[CTF]&3[5:46:2]&R[24:47:1];                          21120000
              N:=K INX [T0];                                        %R0221121000
              IF (N[0] AND IOMASK)=0 THEN SLEEP([N[0]],IOMASK);         21122000
              N[0]~0;                                                   21122500
              IOREQUEST(NABS(D)&@377[25:40:8],D,[N[0]]&18[12:42:6]);    21123000
$INCLUDE 21123101, IF STATISTICS;                                       21123099
         COUNTUP(15,S);                                                 21123100
              J~30|S+J+1;                                               21124000
              K:=(K+1).[46:2];                                      %R0221125000
         END;                                                           21126000
    SUBROUTINE SWAP;                                                    21127000
         BEGIN T0:=T1:=T2:=T3:=IOMASK;                              %R0221128000
              B~DISKSTORE[MIX];                                         21129000
              K~0;S~63;                                                 21130000
              N~[T1];                                                   21130100
              WHILE J+1890<I DO DODISK;                                 21131000
              IF (S~I-J-1)>1023 THEN                                    21132000
                   BEGIN S~S DIV 30; DODISK; S~I-J-1 END;               21133000
              IF S>0 THEN                                               21134000
$INCLUDE 21134101, IF STATISTICS;                                       21134099
         BEGIN COUNTUP(15,(S+29) DIV 30);                               21134100
                   DISKWAIT((J+1)&R[1:47:1],S,B);                       21135000
$INCLUDE 21135101, IF STATISTICS;                                       21135099
         END;                                                           21135100
              IF (N[0] AND IOMASK)=0 THEN SLEEP([N[0]],IOMASK);         21137100
         END;                                                           21138000
         J~MSTART~[MEM[MIX,MLINK1]].[CF];                               21139000
         IF SQ[MIX]}0 THEN SLEEP([SQ[MIX]],-0);                         21139100
         SQ[MIX]~-*P(DUP);                                              21139200
         IF R THEN                                                      21140000
         BEGIN F~J~(I~(LC[MIX]+(EXPAND[MIX]!1))|CHUNKZIZE+FENCE)-       21141000
                   ACTLEN[MIX];                                         21141100
              SWAP;                                                     21142000
              A~F-MSTART INX M[F+ADDRESSES]; K~0;                       21143000
              FOR J~F STEP 1891 UNTIL I-1 DO                            21144000
              BEGIN M[J]~A[K]; K~K+1 END;                               21145000
              IF I!J THEN                                               21146000
              IF (S~I-J+1890)>1023 AND (S~S MOD 30)!0 THEN              21147000
                   M[I-S]~A[K];                                         21148000
              J~S~F;                                                    21149000
              I~MSTART;                                                 21150000
              WHILE I!J DO                                              21151000
              BEGIN WHILE (K~M[J])>0 DO J~K.[CF]+S-I;                   21152000
                   J~J+3;                                               21153000
                   MOVE(J-S,S,I);                                       21154000
                   S~J;                                                 21155000
                   I~K.[CF];                                            21156000
              END;                                                      21157000
         END INPUT ELSE                                                 21158000
BEGIN                                                                   21158100
         BEGIN DO IF (K~M[J])<0 OR (K~K.[CF])<J THEN                    21159000
                   BEGIN J~J+3;                                         21160000
                        IF I!F THEN MOVE(J-F,F,I);                      21161000
                        I~I+J-F;                                        21162000
                        F~K;                                            21163000
                   END UNTIL (J~K)=MSTART;                              21164000
              A~MEM[MIX,ADDRESSES]; K~0;                                21165000
              FOR J ~ MSTART STEP 1891 UNTIL I-1 DO                     21166000
              BEGIN A[K]~M[J]; K~K+1 END;                               21167000
              IF I!J THEN                                               21168000
              IF (S~I-J+1890)>1023 AND (S~S MOD 30)!0 THEN              21169000
                   A[K]~M[I-S];                                         21170000
              J~MSTART;                                                 21171000
              SWAP;                                                     21172000
              ACTLEN[MIX]~I-MSTART;                                     21173000
END;                                                                    21173100
         END OUTPUT;                                                    21174000
         IF EXPAND[MIX]!0 THEN EXPANDER(MIX,R);                         21174400
         SQ[MIX]~-*P(DUP);                                              21174500
    END SWAPINGIO;                                                      21175000
 PROCEDURE SWAPPER;                                                     21200000
    BEGIN LABEL START,TIMENDL,RDY,L1,L2,WAITSWAPL,EOJL,BOJL,SATISFYL,   21201000
         COMMON,BUMP,FORCEL,RR;                                         21202000
         SWITCH STATE~TIMENDL,WAITSWAPL,BOJL,SATISFYL,EOJL,FORCEL;      21203000
         REAL I,J,K,TA,TT,MIX,RCW=+0;                                   21204000
         REAL S,L;                                                      21205000
         REAL BJOB;                                                     21205100
    START:                                                              21206000
         IF (MIX~LINK[31])=0 THEN                                       21207000
         BEGIN STASUS[0]~READYSTATE; KILL([RCW] INX NOT 2) END;         21208000
         LINK[31]~LINK[MIX];                                            21209000
         IF MIX=SWAPEND THEN SWAPEND~31;                                21210000
         S~SC[MIX]; L~LC[MIX];                                          21210100
         BJOB:=BATCHJOB[MIX];                                           21210200
         GO TO STATE[STASUS[MIX]];                                      21211000
    TIMENDL:                                                            21212000
$INCLUDE 21212101, IF STATISTICS;                                       21212099
         SWAPS[MIX]:=*P(DUP)+1;                                         21212100
         K~RDYRPTEND;                                                   21213000
         RDYRPTEND~MIX;                                                 21214000
         SLN[MIX]~SLN[MIX]+(SLN[MIX]!7);                                21215000
    RR:  IF UNHOOKANDWAIT(MIX,1) THEN GO TO START;                      21215100
         ELAPSEDLIMIT[MIX]:=*P(DUP)-IOTIME[MIX];                    %R5921215200
         PROCLIMIT[MIX]~*P(DUP)-PROCTIME[MIX];                          21215300
         IF NOT CANTEXPAND[MIX] THEN                                    21215350
         IF OLAYCTR[MIX] LSS 0 THEN EXPAND[MIX]:=3;                 %R3821215400
         TA~TT~0;                                                       21216000
         I~RDYRPT;                                                      21216100
    RDY: LINK[MIX]~LINK[K];                                             21216200
         LINK[K]~MIX;                                                   21216300
         NLS[MIX]~SLN[MIX]+2;                                           21216400
         IF TA=0 THEN                                                   21217000
    L1:  BEGIN STASUS[MIX]~TRANSIT;                                     21218000
              SWAPINGIO(MIX,0);                                         21218100
 $ VOID                                                             %R5921218200
         END;                                                           21218300
         GO TO COMMON;                                                  21219000
    WAITSWAPL:                                                          21220000
         IF UNHOOKANDWAIT(MIX,0) THEN GO TO START;                      21221000
         ELAPSEDLIMIT[MIX]~-0;                                          21221100
         TA~-1;TT~0;                                                    21222000
         I~WAITSTATE;                                                   21223000
         GO TO L1;                                                      21224000
    FORCEL:                                                             21224100
$INCLUDE 21224111, IF STATISTICS;                                       21224109
         SWAPOUTS[MIX]:=*P(DUP)+1;                                  %R6321224110
         IF (K~FORCEND)=RDYRPTEND THEN RDYRPTEND~MIX;                   21224200
         PRTROW[FORCEND~MIX].[PSF]~0;                                   21224300
         SLN[MIX]~I~(SLN[MIX]).[45:2];                                  21224400
         IF I=0 THEN ELAPSEDLIMIT[MIX]:=IOTIME[MIX];                %R5921224500
         GO TO RR;                                                      21224900
    EOJL:TA~TT~-1;                                                      21225000
         I~STABLE;                                                      21225100
 $ VOID                                                             %R5921225200
         GO TO COMMON;                                                  21225300
    BOJL: TT~1;                                                         21226000
         I~READYBOJ;                                                    21227000
    L2:  TA~1;                                                          21228000
         J~MIX;                                                         21229000
         IF (K~LINK[READYEND])!0 THEN                                   21229100
         IF NLS[K]=0 THEN J~K ELSE NLS[K]~NLS[K]-1;                     21229110
         IF (K~READYEND)=FORCEND THEN FORCEND~J;                        21229120
         IF RDYRPTEND=READYEND THEN RDYRPTEND~J;                        21229130
         SLN[MIX]~0;                                                    21229200
         READYEND~J;                                                    21230000
         J~MIX;                                                         21230100
         GO TO RDY;                                                     21231000
     SATISFYL:                                                          21232000
         TT~0;                                                          21233000
         I~READYSTATE;                                                  21234000
         GO TO L2;                                                      21235000
    COMMON:                                                             21236000
         COUNT[MIX]~63;                                                 21237000
         STASUS[MIX]~I;                                                 21237100
$INCLUDE 21237301, IF STATISTICS;                                       21237199
         IF (I=READYSTATE) OR (I=RDYRPT) OR (I=READYBOJ) THEN           21237200
         QUETIMING[MIX]:=CLOCK+P(RTR);                                  21237300
         I~S-1;                                                         21238000
    BUMP:                                                               21239000
         IF (I~I+1)>L THEN                                              21240000
         IF (TA~EXPAND[MIX])=0 THEN GO TO START                         21240100
         ELSE IF S<0 THEN GO TO START                                   21240200
         ELSE BEGIN L~I~IF TA THEN L+1 ELSE S-1;                        21240300
                   S~-(TA~TT~1);                                        21240400
                   J~MIX;                                               21240500
              END;                                                      21240600
         ACTIVE[I]~ACTIVE[I]+TA;                                        21241000
         TOTAL[I]~TOTAL[I]+TT;                                          21242000
         IF BJOB THEN BATCHED[I]:=TT GEQ 0;                             21242100
         IF TA!1 THEN                                                   21243000
         BEGIN POSSESS[I]~J~0;                                          21244000
              DO IF (J~LINK[K~J])=0 THEN GO TO BUMP                     21245000
              UNTIL SC[J]{I AND LC[J]}I;                                21246000
         END ELSE IF (NT1~POSSESS[I])!0 THEN                            21246100
                   IF STASUS[NT1]=RUNNING THEN                          21246200
                   BEGIN IF SLN[NT1]=0 OR NLS[NT1]=0 THEN GO TO BUMP;   21246300
                        IF PRTROW[NT1].[PSF]=0 THEN                     21246400
                             PRTROW[NT1].[PSF]~3;                       21246500
                        GO TO BUMP;                                     21246600
                   END ELSE                                             21247000
                   IF STASUS[NT1]!RDYRPT THEN GO TO BUMP                21247100
                   ELSE                                                 21247110
                   BEGIN NT2~0;                                         21247120
                        WHILE (NT2~LINK[NT2])!J DO                      21247200
                             IF NT1=NT2 THEN GO TO BUMP;                21247300
                        COUNT[NT1]~COUNT[NT1]+63;                       21247400
                   END;                                                 21247500
         POSSESS[I]~J;                                                  21248000
         COUNT[J]~NT1~COUNT[J]+1 AND 63;                                21249000
         IF SC[J]+NT1!LC[J] THEN GO BUMP;                               21250000
 $ VOID                                                             %R5921251000
         IF STASUS[J]!READYBOJ THEN                                     21252000
         BEGIN STASUS[J]~TRANSIT;                                       21253000
$INCLUDE 21253011, IF STATISTICS;                                       21253009
              READYQUETIME[J]:=(*P(DUP))+CLOCK+P(RTR)-QUETIMING[J];     21253010
              SWAPINGIO(J,1);                                           21253100
              HOOKUPMCP(J);                                             21254000
              IF (NT1:=PROCLIMIT[J]) LEQ 0 OR                       %R3821255000
                   (NT2:=ELAPSEDLIMIT[J]) LEQ 0 OR                  %R3821255100
                   OLAYCTR[J] LEQ 0 THEN                            %R3821255200
              BEGIN IF (NT1~PRYOR[J])>10 THEN NT1~10;                   21255500
                   NT1~(SLN[J]|4+COUNT[J]-NT1)|8+208;                   21256000
                   NT2:=2|NT1;                                      %R5921256100
                   OLAYCTR[J]:=UPOLAY(NT1)+                         %R3821256110
                        CANTEXPAND[J]|@10000000000;                     21256120
              END;                                                      21256200
              PROCLIMIT[J]~PROCTIME[J]+NT1;                             21256400
              ELAPSEDLIMIT[J]:=IOTIME[J]+NT2;                       %R5921256500
 $ VOID 2125699                                                     %R5921256600
              STASUS[J]~RUNNING;                                        21257000
$INCLUDE 21257101, IF STATISTICS;                                       21257099
              TIMING[J]:=CLOCK+P(RTR);                                  21257100
         END ELSE STASUS[J]~SELECTING;                                  21259000
$INCLUDE 21259901, IF STATISTICS;                                       21259099
         IF STASUS[J] = SELECTING THEN                                  21259100
         BEGIN                                                          21259200
              INITIALRQTIME[J]:=READYQUETIME[J]+CLOCK+P(RTR)-           21259300
              QUETIMING[J];                                             21259400
              READYQUETIME[J]:=QUETIMING[J]:=0;                         21259500
         END;                                                           21259600
         IF SWAPDELAY[J] NEQ 0 THEN                                     21259650
         BEGIN COUNTUPBY(33,CLOCK+P(RTR)-SWAPDELAY[J]);                 21259700
               SWAPDELAY[J]:=0; COUNTUPBY(34,1);                        21259800
         END;                                                           21259900
         LINK[K]~LINK[J];                                               21260000
         IF J=FORCEND THEN FORCEND~K;                                   21260800
         IF J=RDYRPTEND THEN RDYRPTEND~K;                               21260900
         IF J!READYEND THEN GO TO BUMP;                                 21261000
         READYEND~K;                                                    21262000
         GO TO BUMP;                                                    21263000
    END SWAPPER;                                                        21264000
 PROCEDURE INITIALSWAP(N); VALUE N; REAL N;                             21265000
    BEGIN REAL I,J,K,S,T,U;                                             21266000
         LABEL L;                                                       21266100
         IF N LSS 0 THEN                                                21266200
         BEGIN K:=N.[27:6]; N:=N.[21:6] END                             21266300
         ELSE BEGIN                                                     21266400
         IF (N~(64|N-(N!0)) DIV CHUNKZIZE)>CHUNKMAX THEN N~CHUNKMAX;    21267000
         N ~ (N=0)+N;                                                   21267100
         U:=N+N LSS CHUNKMAX;                                       %R1121267200
    L:   S:=4096;                                                   %R1121268000
         FOR I ~ CHUNKMAX STEP -1 UNTIL N DO                            21269000
         BEGIN T~0;                                                     21270000
              FOR J ~ 0 STEP 1 UNTIL N DO                               21271000
                  IF (NT1:=ACTIVE[I-J]|64+TOTAL[I-J]) GTR T THEN T:=NT1;21272000
              IF T-U LSS S THEN BEGIN S:=T; K:=I END;               %R1121273000
         END;                                                           21274000
         IF S GEQ 4095 THEN BEGIN N:=N-1; GO TO L END;                  21274100
         END;                                                           21274200
         SC[P1MIX]~K-N;                                                 21275000
         LC[P1MIX]~K;                                                   21276000
         CANTEXPAND[P1MIX]:=(N=CHUNKMAX);                               21276050
$INCLUDE 21276101, IF STATISTICS;                                       21276099
         SWAPDELAY[P1MIX]:=CLOCK+P(RTR);                                21276100
         SWAP(BOJSTATE,0);                                              21277000
         SLEEP([SQ[P1MIX]],0&SELECTING[18:42:6]);                       21278000
         MEMROW[P1MIX]:=MEMROW[0]&((T:=(K-N)|CHUNKZIZE+FENCE))[CTC];    21279000
         U:=T+4;                                                        21279500
         M[S~(I~(N+1)|CHUNKZIZE)+T-3]~K~T&U[CTF]&1[2:47:1]&             21280000
              P1MIX[9:42:6];                                            21281000
         M[T]~K&U[CTC]&S[CTF]&1[17:47:1];                               21281500
         M[U]~K&S[CTC]&T[CTF];                                          21281600
         M[MEM[P1MIX,AVAIL]~S~S+1]~S&@77777[CTF];                       21282000
         M[S+1]~S;                                                      21283000
         MEM[P1MIX,LEFTLIT]:=T;                                         21283500
         FORGETSPACE(U+2);                                              21284000
         FRONTEND(P1MIX);                                               21285000
         IF LOGLINE.[33:7]!0 THEN                                       21291100
         BEGIN                                                          21291200
         TANKS[LOGLINE.[40:8]].[CF]~I~GETSPACE(30,0,1)+2;               21291300
         M[I]~0;                                                        21291400
         END;                                                           21291500
    END INITIALSWAP;                                                    21292000
 PROCEDURE FRONTEND(MIX);                                               21293000
         VALUE MIX;                                                     21294000
         REAL MIX;                                                      21295000
    BEGIN REAL I,J;                                                     21296000
         J~(I~NOT FENCE INX 1) DIV 1890+2;                              21297000
         IF MEMROW[MIX].[CF] NEQ 0 THEN                             %R7521299900
         MEM[MIX,ADDRESSES]~[M[GETSPACE(J,0&MIX[CTF],1)+1]]&64[8:38:10];21302000
         I~GETSPACE(30,0&MIX[CTF],1)+2;                                 21304000
         MOVE(30,JARROW[MIX],I);                                        21305000
         FORGETSPACE(JARROW[MIX]);                                      21306000
         JARROW[MIX].[CF]~I;                                            21307000
         I~GETSPACE(UVSIZE,0&MIX[CTF],1)+2;                             21308000
         MOVE(UVSIZE,UVROW[MIX],I);                                     21309000
         FORGETSPACE(UVROW[MIX]);                                       21310000
         UVROW[MIX].[CF]~I;                                             21311000
    END FRONTEND;                                                       21312000
PROCEDURE EXPANDER(MIX,R);                                              21313000
         VALUE MIX,R;                                                   21314000
         REAL MIX,R;                                                    21315000
    BEGIN REAL I,J;                                                     21316000
         LABEL L,L1,SOL;                                                21317000
         IF R THEN                                                      21318000
         BEGIN                                                          21319000
         IF EXPAND[MIX] THEN                                            21320000
         BEGIN MEM[MIX,0].[FF]~I~(J~MEM[MIX,AVAIL]-1)+CHUNKZIZE;        21321000
              M[I]~M[J]&J[CTF];                                         21322000
              M[J]~(*P(DUP))&I[CTC];                                    21323000
              M[(M[I~I+1]~M[J+1])+1]~I;                                 21324000
              M[M[I+1]~M[J+2]].[CF]~MEM[MIX,AVAIL]~I;                   21325000
         END ELSE                                                       21327000
         BEGIN I~(J~[MEM[MIX,0]].[CF])-CHUNKZIZE;                       21328000
              M[(M[I]~M[J]&(I+4)[CTC]).[FF]].[CF]~I;                    21329000
              M[J]~(*P(DUP))&(I+4)[CTF];                                21330000
              M[I+4]~M[I]&J[CTC]&I[CTF];                                21331000
              M[I+1]~M[J+1]; M[I+2]~M[J+2];                             21332000
              MEMROW[MIX]~MEMROW[0]&I[CTC];                             21333000
              FORGETSPACE(I+6);                                         21334000
              FORGETSPACE(J+6);                                         21335000
              FRONTEND(MIX);                                            21337000
         END;                                                           21338000
         FORGETSPACE(J+2);                                              21338100
         EXPAND[MIX]~0;                                                 21339000
         END ELSE                                                       21340000
         BEGIN J:=LC[MIX];                                              21340500
              IF (I:=SC[MIX])=0 THEN                                    21341000
              IF TOTAL[J+1] LSS 63 THEN                                 21341500
    L:        BEGIN LC[MIX]~LC[MIX]+1; I~1 END                          21342000
              ELSE GO TO SOL                                            21342500
              ELSE BEGIN                                                21343000
                   IF J!CHUNKMAX THEN                                   21343500
                   IF TOTAL[I-1] GTR TOTAL[J+1] THEN GO TO L;           21344000
                   IF TOTAL[I-1] = 63 THEN                              21344500
    SOL:           BEGIN CANTEXPAND[MIX]:=1; I:=0; GO TO L1 END;        21345000
                   SC[MIX]~I-1; I~2;                                    21346000
                   END;                                                 21347000
              IF COUNT[MIX] GEQ CHUNKMAX-1 THEN CANTEXPAND[MIX]:=1;     21347500
    L1:       EXPAND[MIX]:=I;                                           21348000
         END;                                                           21349000
    END EXPANDER;                                                       21350000
REAL SECONDCTR, LASTSCHEDSELECT;                                        22000000
$ INCLUDE 22000701, IF SHAREDISK;                                       22000499
PROCEDURE FINDFREEADDRESS(N);VALUE N;REAL N;FORWARD;                    22000500
REAL FINDFREECTR; % USED TO DETERMINE HOW FREQUENTLY                    22000600
                  % FINDFREEADDRESS IS BEING CALLED                     22000700
 PROCEDURE NSECOND;%                                                    22001000
         BEGIN REAL I,RCW=+0;%                                          22002000
              REAL J,JJ,S;% J MUST RESIDE AT F+2.....SIC..              22003000
              ARRAY A[*];%                                              22004000
              BOOLEAN W;                                                22005000
              LABEL TRYWY;                                              22005100
    SUBROUTINE PACK;                                                %R7822006000
         BEGIN                                                      %R7822006100
              IF (I:=A.[CF]) NEQ 0 THEN                             %R7822006200
              IF NOT M[I-1] THEN                                    %R7822006300
              IF (W AND TOGLE) NEQ 0 THEN                           %R7822006400
              BEGIN%                                                %R7822006500
                   TOGLE:=TOGLE AND NOT W;                          %R7822006600
                   J:=GETSPACE(S:=M[I-2].[CF]-I,0,1)+2;             %R7822006700
                   M[J-1]:=1;  MOVE(S,I,J);                         %R7822006800
                   FORGETSPACE(I); A.[CF]:=J;                       %R7822006900
                   TOGLE:=TOGLE OR W;                               %R7822007000
              END;                                                  %R7822007100
         END;                                                       %R7822007200
              J:=NEUP.NEUF ;                                            22011100
$INCLUDE 22011201, IF SHAREDISK ;                                       22011190
              DISKWAIT(-(EUIO INX 0),-(J+EUIOFFSET),EUIOHOLDER);        22011200
              FOR I:=J-1 STEP -1 UNTIL 0 DO                             22011300
               BEGIN                                                    22011400
                EUIO[I+EUIOFFSET]:=*P(DUP)|EUTAPER+PEUIO[I];            22011500
                PEUIO[I]:=0;                                            22011600
               END;                                                     22011700
$INCLUDE 22011801, IF SHAREDISK ;                                       22011790
              DISKWAIT(EUIO INX 0,-(J+EUIOFFSET),EUIOHOLDER) ;          22011800
              J:=0 ;                                                    22011810
              WHILE (NT1 ~ XCLOCK+P(RTR)) } 5184000 DO MIDNIGHT;%       22012000
              CHANGEDATE(0);                                            22013000
              IF SWAPEND = 0 THEN % FIRST TIME RUNNING.             %R7822014200
         BEGIN % PACK THE INTRNSC TABLE.                            %R7822014300
              A:=INTRNSC;  W:=FREEMASK;                             %R7822014400
              PACK;  INTRNSC:=A;                                    %R7822014500
              SWAPEND := 31;                                        %R7822014600
         END;                                                       %R7822014700
              FOR I ~ 20 STEP 1 UNTIL 21 DO%                            22032000
                   BEGIN IF NOT UNIT[I].[16:1] THEN%                    22033000
                             UNIT[I].[17:1] ~ 0;%                       22034000
                        STARTIO(I);%                                    22035000
                   END;%                                                22036000
$INCLUDE 22036999, IF DFX;                                          %DFX22036099
              DISKOUNT~(P(RRR).[29:1] AND (UNIT[18].[FF]>1023))+    %DFX22036100
                       (P(RRR).[28:1] AND (UNIT[19].[FF]>1023));    %DFX22036200
              A~IOQUE&(GETSPACE(10,0,0)+2)[CTC];                        22037000
              SYSDISKIO(1,0,A);                                         22037500
              FOR I:=1 STEP 1 UNTIL STATIONMAX DO                       22038000
              BEGIN SYSDISKIO(1,I,A);                                   22039000
                IF SCH(A) THEN                                          22039100
                 BEGIN IF STATABLE[I].DIALEDUP THEN                     22039150
                      BEGIN IF (W:=SEQARRAY[I].[CF]) GTR 511 THEN       22039200
                           IF (W:=M[W+37]&M[W+77][CTF]) NEQ A[3] THEN   22039250
                           BEGIN A[3]:=W; SYSDISKIO(0,I,A) END;         22039300
                      END ELSE                                          22039350
                      IF NOT SCHEDBUSY[I] THEN S:=S+1;                  22039400
                END ELSE                                                22039450
                IF REMOTE THEN                                          22039470
                BEGIN                                                   22039500
                   W:=FALSE;                                            22039550
                   IF A[1]!0 OR A[0].DIALEDUP THEN                      22040000
                   BEGIN IF (JJ:=STATABLE[I]).ACTIVITY THEN             22040500
                             W:=TRUE ELSE                               22041000
$INCLUDE 22042001, IF DCP;                                              22041199
                        IF JJ.DISCIT THEN                               22041200
                        IF A[2]+7200 LSS CLOCK THEN                     22041400
                        BEGIN STATABLE[I]:=JJ&0[15:15:2];               22041600
                             FORK(P(.QUITTER),I&6[33:41:7],-2,96,0);    22041800
                        END ELSE ELSE                                   22042000
                        IF A[1]!0 THEN                                  22042500
                        BEGIN                                           22042600
                        IF A[2]+A[3]<CLOCK THEN                         22043000
                        BEGIN IF (J:=JJ.MIXNR) ! CANDEMIX[I] THEN       22044000
                                  TERMINATE(J&15[CTF])                  22045000
                             ELSE BEGIN M[J~GETAREA(0)] ~               22045100
                                            0&I[CTF]&10[18:41:7];       22045200
                                       M[J+1] ~ 54;                     22045300
                                       QUEVENT(J,CANDEMIX[I]);          22045400
                                  END;                                  22045500
                            M[J:=GETAREA(0)]:=0&I[25:40:8]&54[18:41:7]; 22047000
$OMIT 22047101, IF DCP;                                                 22047049
                             IF JJ.STATIONTYPE=TWX THEN                 22047050
                             SEQARRAY[I]:=0;                        %R2722047100
                             QUEVENT(J,CANDEMIX[I]);                    22048000
                             W~TRUE;                                    22048100
                        END;                                            22049000
                        END ELSE                                        22049100
                        IF A[2]+3600<CLOCK THEN                         22049200
                        BEGIN                                           22049300
$OMIT 22049311, IF DCP;                                                 22049309
                             BLASTREAD(I,1);                            22049310
                             STREAM(J:=JJ:=([RCW] INX 2));              22049400
                                   DS:=8 LIT "!BYE!-*$";                22049450
                             TWXOUT(JJ,8,-1,I);                         22049500
                             W~TRUE;                                    22049510
                        END;                                            22049600
                        IF W THEN                                       22049700
                        BEGIN A[2]:=CLOCK;                              22049800
                             SYSDISKIO(0,I,A);                          22049900
                        END;                                            22049950
                        P([STATABLE[I]],PRL);                           22050000
                   END;                                                 22050100
                END;                                                    22050150
              END;                                                      22050200
              SYSDISKIO(1,STAMAX+1,A);                                  22050250
              FORGETSPACE(A);                                           22050300
$OMIT 22050381, IF DCP OR TWXONLY;                                      22050304
              IF REMOTE THEN                                            22050305
              IF (I:=CLOCK+P(RTR)) GTR LINETABLE[0] THEN                22050310
              BEGIN %UPDATE TIMER TO CHECK AGAIN IN A MINUTE            22050315
                   LINETABLE[0]:=I+1800;                                22050320
                   FOR I:=1 STEP 1 UNTIL LMAX DO                        22050325
                   IF LINEDISC[I]=MULTI THEN                            22050330
                   BEGIN                                                22050335
                        J:=I;W:=FALSE;                                  22050340
                        DO IF P(SEQARRAY[J],DUP).[3:1] THEN             22050345
                        BEGIN                                           22050350
                             P(P&0[3:47:1],[SEQARRAY[J]],SND);          22050355
                             W:=TRUE;                                   22050360
                        END UNTIL (J:=P.LINELINK)=I;                    22050365
                        IF W THEN ENTEREADYQ(I);                        22050370
                   END;                                                 22050375
              END;                                                      22050380
              IF (XCLOCK-LASTSCHEDSELECT)GEQ 54000 THEN                 22050400
              BEGIN LASTSCHEDSELECT:=(XCLOCK DIV 54000)|54000;          22050500
                   IF S GTR 0 THEN                                      22050600
                   IF SCHEDNUM NEQ FRSTSCHED THEN                       22050700
                        FORK(P(.SCHEDIDLE),0,0,160,0);                  22050800
              END;                                                      22050900
$INCLUDE 22050981, IF STATISTICS;                                       22050909
              COUNTARRAY[1]:=CLOCK;                                     22050910
              IF SYSTATBASE GTR 0 THEN BEGIN                            22050915
              DISKIO([JUNK],COUNTARRAY.[CF]-1,60,SYSTATBASE);           22050920
              IF XCLOCK GEQ COUNTARRAY[29] THEN                         22050930
              BEGIN                                                     22050940
                   COUNTARRAY[29]:=XCLOCK+INTERVAL;                     22050960
                   FORK(P(.FILLSYSTAT),0,0,128,0);                      22050970
              END END;                                                  22050980
$ INCLUDE 22053651, IF SHAREDISK;                                       22050999
$VOID                                                                   22051000
              LOCKDIRECTORY;                                            22051100
              IF (J:=HOLDER.[FF])!0 THEN    % HOLD LIST IS NOT EMPTY    22051200
              BEGIN                                                     22051250
                   A:=[M[SPACE(J)]]&J[8:38:10];                         22051300
                   DISKWAIT(-(A INX 0),J,HOLDER.[CF]);                  22051400
                   FOR I:=0 STEP 1 UNTIL J-1 DO                         22051500
                   IF A[I] LSS 0 THEN                                   22051600
                   IF A[I].[2:2]=SYSNO THEN                             22051700
                   BEGIN IF (JJ:=A[I]).[FF] GEQ FENCE THEN              22051800
                             BRINGBACK(JJ.[10:8]) ELSE M[JJ.[FF]]:=1;   22051900
                        A[I]:=P(DUP,LOD,SSP);                           22052000
                   END;                                                 22052100
                   DISKWAIT(A INX 0,J,HOLDER.[CF]);                     22052200
                   FORGETSPACE(A);                                      22052300
              END;                                                      22052350
              UNLOCKDIRECTORY;                                          22052400
$VOID                                                                   22052500
              IF NOT FINDINGADDRESS THEN                                22052700
              IF LQAVAIL!0 THEN                                         22052800
              BEGIN                                                     22052900
                   FINDINGADDRESS:=1;                                   22053000
                   FINDFREEADDRESS(0);                                  22053100
              END;                                                      22053200
              IF FINDFREECTR LSS 32 THEN% IT IS NOT GETTING CALLED OFTEN22053300
             IF(J:=(*P(..FINDFREEADDRESS))INX 0)>M[0].[CF] THEN         22053400
                   M[J-2].[2:1]:=0;                                     22053500
              FINDFREECTR:=0;                                           22053600
              IF RUNUMBER GTR 0 THEN STARTADECK(0);                     22053650
              IF CLOCK.[35:7]=0 THEN                                    22053660
              FOR S:=MIXMAX-1 STEP -1 UNTIL 1 DO                        22053670
                   IF (I:=REPLY[S]) LSS 0 THEN                          22053680
                   BEGIN                                                22053690
                        IF PUTORTAKE(S,[PRYOR[S]],1,0) LSS 1023 THEN    22053715
                        BEGIN                                           22053720
                             JJ:=4;                                     22053725
    TRYWY:                   STREAM(I:JJ:=[JJ]);                        22053730
                             BEGIN SI:=LOC I; SI:=SI+1;  DI:=DI+7;      22053735
                                  7(IF SC=DC THEN                       22053740
                                    BEGIN I:=TALLY; JUMP OUT END;       22053745
                                     DI:=DI-1);                         22053750
                              END;                                      22053755
                              IF P!0 THEN    % IMPROPER MSG             22053760
                              IF JJ=4 THEN   % TRY WY IF OK IS NOT      22053765
                              BEGIN JJ:=10;                             22053770
                                   GO TRYWY;                            22053775
                              END                                       22053780
                              ELSE ELSE      % MSG IS OK                22053785
                              BEGIN REPLY[S]:=JJ;                       22053790
                                   BRINGBACK(S);                        22053795
                   END  END  END;                                       22053800
              NSECONDREADY:=TRUE;                                       22053850
              SECONDCTR:=0;                                             22053900
              KILL([RCW] INX NOT 2);                                    22053950
         END;%                                                          22054000
PROCEDURE STATUS;%                                                      22055000
         BEGIN REAL U=+1,%                                              22056000
                   T=U+1,%                                              22057000
                   T1=T+1;%                                             22058000
               INTEGER%                                                 22059000
                   I=T1+1;%                                             22060000
              ARRAY AREA=I+1[*];%                                       22061000
              LABEL PAPERPUNCH,DATACOM,PAPER,EL,UNLD;%                  22062000
              LABEL L,TAPE,NOTREADY,DIE,ACCEPT,SCRATCH,INPUT,PRINTER,%  22063000
                   CARD,DRUM,DISK,SPO,PUNCH,COMMON;%                    22064000
              SWITCH S ~ CARD,PRINTER,TAPE,DRUM,DISK,SPO,PUNCH,UNLD,%   22065000
                   PAPERPUNCH,PAPER,DATACOM;%                           22066000
              REAL RCW=+0;%                                             22067000
    SUBROUTINE SPACEA;%                                                 22068000
         BEGIN AREA := [M[SPACE(12)]]&10[8:38:10];  END;                22069000
                                                                        22070000
    P(0,0,0,0,0);%                                                      22071000
                                                                        22072000
    SPACEA;%                                                            22073000
    WHILE (T ~ P(RRR) OR RRRMECH) ! READY DO%                           22074000
         BEGIN I ~ 0&TINU[U ~ (P(T EQV NOT READY,DUP,DUP,|,|)%          22075000
                   |@1000000000000).%                                   22076000
                   [3:6]][5:11:7]/@1000000000000;%                      22077000
              IF T < READY THEN%                                        22078000
                   BEGIN     COMMENT SOMETHING WENT NOT READY;%         22079000
                             READY ~ READY AND NOT I;%                  22080000
                        IF LABELTABLE[U] } 0 THEN%                      22081000
                          BEGIN%                                        22082000
         L:                  LABELTABLE[U] ~ @114;%                     22083000
                             MULTITABLE[U] ~ 0;%                        22084000
                          END;%                                         22085000
         EL:            RRRMECH ~ RRRMECH AND NOT I;%                   22086000
                   END OF NOT READY%                                    22087000
              ELSE BEGIN     COMMENT SOMETHING WENT READY;%             22088000
                        READY ~ READY OR I;%                            22089000
                        UNIT[U].[13:1] ~ 0;%                            22090000
                        IF LABELTABLE[U]!@114 OR UNIT[U].[13:5]=15 THEN 22091000
                             BEGIN RRRMECH ~ RRRMECH OR I;%             22092000
                                  IF LABELTABLE[U] = @214 THEN%         22093000
                                       BEGIN I ~ I AND NOT SAVEWORD;%   22094000
                                            GO TO L;%                   22095000
                                       END;                             22096000
                                  IF STASUS[T~RDCTABLE[U].[8:6]]=       22096100
                                       RUNNING OR T=0 THEN              22096200
                                  BEGIN T1~UNIT[U].[FF];                22096300
                                       WHILE T1<1023                    22096310
                                       DO BEGIN T1~LOCATQUE[T1].[FF];   22096400
                                            IOCOUNT[T]~*P(DUP)+1;       22096500
                                       END;                             22096600
                                       UNIT[U].[13:5]~0;                22096610
                                       STARTIO(U);                      22096700
                                  END ELSE                              22096800
                                  BEGIN IF REPLY[T]=(-4) THEN           22096900
                                            BEGIN REPLY[T]~0;           22097000
                                                 BRINGBACK(T);          22097100
                                            END;                        22097200
                                       UNIT[U].[13:5]~31;               22097300
                                  END;                                  22097400
                                  GO TO COMMON;%                        22098000
                             END;%                                      22099000
                        MULTITABLE[U] ~ RDCTABLE[U] ~ 0;%               22100000
                        IF (I AND SAVEWORD) ! 0 THEN%                   22101000
                             BEGIN RRRMECH ~ I AND SAVEWORD OR RRRMECH; 22102000
                                  GO TO COMMON;%                        22103000
                             END;%                                      22104000
                        GO S[UNIT[U].[1:4]];%                           22105000
         TAPE: P(WAITIO(@4200000000,5,U),DEL);%                         22106000
              IF (T ~ WAITIO(AREA INX @120540000000,@7500045,U)).%      22107000
                   [45:3] ! 0 THEN%                                     22108000
         NOTREADY: BEGIN READY ~ READY AND NOT I;%                      22109000
                        GO TO L;%                                       22110000
                   END;%                                                22111000
              IF MOD3IOS AND NOT T.[42:1] THEN  BEGIN                %AI22111500
                   DO UNTIL (T1~WAITIO(AREA INX @340000012,@55,U))!0;%AI22112000
              END ELSE T1~WAITIO(@4200000000,5,U);                   %AI22112500
                   IF T1.[45:3]!0 THEN GO TO NOTREADY;               %AI22113000
              DO UNTIL NOT (T1~WAITIO(@500000000,@165,U)) OR            22114000
                   (TRANSACTION[U]~0);%                                 22115000
              IF T1.[45:1] THEN GO TO NOTREADY;%                        22116000
              PRNTABLE[U]~0&(NOT T1)[1:43:1];%                          22117000
              IF T.[43:1] THEN%                                         22118000
                   BEGIN;STREAM(T~TINU[U],AREA);%                       22119000
                             BEGIN SI ~ LOC T; SI ~ SI+5;%              22120000
                                  DS ~ LIT "#"; DS ~ 3 CHR;%            22121000
                                  DS ~ 14 LIT " PARITY, RW/L~"%         22122000
                             END;%                                      22123000
   DIE: SPOUTIT(AREA,HRDWREK);  SPACEA; %PAR,RW/L                   %R6422124000
                        LABELTABLE[U] ~ @314;%                          22125000
                        GO TO EL;%                                      22126000
                   END;%                                                22127000
              IF T.[42:1] THEN%                                         22128000
                   BEGIN;STREAM(T~TINU[U],AREA);%                       22129000
                             BEGIN SI ~ LOC T; SI ~ SI+5;%              22130000
                                  DS ~ LIT "#"; DS ~ 3 CHR;%            22131000
                                  DS ~ 15 LIT " TAPE MK, RW/L~";%       22132000
                             END;%                                      22133000
                        GO TO DIE;%                                     22134000
                   END;%                                                22135000
              STREAM(Y~0:AREA,X~[T]);%                                  22136000
                   BEGIN DS ~ 8 LIT " LABEL  ";%                        22137000
                        SI ~ AREA; DI ~ DI-8;%                          22138000
                        IF 8 SC = DC THEN TALLY ~ 1;%                   22139000
                        AREA ~ TALLY;%                                  22140000
                        SI ~ SI+45; DI ~ LOC Y; DS ~ 5 OCT;%            22141000
                        SI ~ LOC AREA; DI ~ X; DS ~ WDS;%               22142000
                   END;%                                                22143000
              NT1 ~ P;%                                                 22144000
              IF T THEN PRNTABLE[U].[30:18]:=NT1 ELSE                   22145000
                  BEGIN STREAM(Y:=0:AREA,X:=[T]);                       22145050
                        BEGIN DS:=4 LIT "VOL1";                         22145100
                              SI:=AREA; DI:=DI-4;                       22145150
                              IF 4 SC=DC THEN TALLY:=1;                 22145200
                              AREA:=TALLY; SI:=SI+1;                    22145250
                              DI:=LOC Y; DS:=5 OCT;                     22145300
                              SI:=LOC AREA; DI:=X; DS:=WDS;             22145350
                        END;                                            22145400
                    NT1:=P;                                             22145450
                    IF T THEN BEGIN PRNTABLE[U].[30:18]:=NT1;           22145500
                              USASITAPE([AREA].[CF],T,1,U,1);           22145550
                              END;                                      22145600
                  END;                                                  22145650
              IF NOT T1.[43:1] THEN%                                    22146000
                   BEGIN IF T THEN%                                     22147000
                             BEGIN                                      22148000
                                  IF AREA[1] = "PBTMCP " THEN GO INPUT; 22156000
                                  IF AREA[4].[12:30] > DATE THEN%       22157000
                                  BEGIN IF RETMSG THEN                  22158000
                                        STREAM(T~TINU[U],A~[AREA[6]]);  22159000
                                        BEGIN SI~LOC T;SI~SI+5;DS~3 CHR;22160000
                                              DS~5 LIT " RET ";         22161000
                                        END ELSE GO TO INPUT;           22162000
         ACCEPT:                       T1 := SPACE(4);                  22163000
                                       STREAM(A~[AREA[1]],T1);%         22164000
                                            BEGIN SI ~ A; SI ~ SI+40;%  22165000
                                                 DS ~ LIT "#";%         22166000
                                                 DS ~ 8 CHR; SI ~ A;%   22167000
                                                 2(DS ~ LIT " ";%       22168000
                                                 SI ~ SI+1; DS ~ 7 CHR);22169000
                                                 DS ~ LIT "~";%         22170000
                                            END;%                       22171000
                                       SPOUT(T1);%                      22172000
                                       GO TO INPUT;%                    22173000
                                  END ELSE%                             22174000
         SCRATCH:                      LABELTABLE[U] ~ 0;%              22175000
                             END ELSE GO TO SCRATCH;%                   22176000
                   END%                                                 22177000
              ELSE IF T THEN BEGIN%                                     22178000
         INPUT:    LABELTABLE[U] ~ AREA[2];%                            22179000
                   MULTITABLE[U] ~ AREA[1];%                            22180000
                   STREAM(A~[AREA[3]],B~[T]);%                          22181000
                        BEGIN SI ~ A; DS ~ 3 OCT;%                      22182000
                             DS ~ 5 OCT; DS ~ 2 OCT%                    22183000
                        END;%                                           22184000
                   RDCTABLE[U] ~ I&T1[24:31:17]&T[14:38:10];%           22185000
                   IF (MULTITABLE[U]="PBTMCP " OR                       22188000
                       MULTITABLE[U]="PUTMCP ") AND                     22188100
                        LABELTABLE[U] = "BACK-UP" THEN%                 22189000
                        BEGIN LABELTABLE[U] ~ @322212342546447;%        22190000
                        STREAM(A~TINU[U],PN~MULTITABLE[U]="PUTMCP ",    22191000
                               AREA);                                   22191100
                                  BEGIN SI ~ LOC A; SI ~ SI+5;%         22192000
                                       PN(DS~3 LIT"#CP"; JUMP OUT TO L);22192100
                                       DS~3 LIT"#LP"; L:                22192200
                                       DS~12 LIT" BACK-UP ON ";         22193000
                                       DS ~ 3 CHR; DS ~ LIT "~";%       22194000
                                  END;%                                 22195000
                             SPOUT(AREA); SPACEA;%                      22196000
                        END;%                                           22197000
                   END ELSE%                                            22198000
         PAPER:%                                                        22199000
         UNLD:          LABELTABLE[U] ~ @314;%                          22200000
              GO TO COMMON;%                                            22201000
         PRINTER:%                                                      22202000
              T ~ WAITIO(@6000000000,4,U).[45:1];%                      22203000
              UNIT[U].[16:2] ~ 0;%                                      22204000
              IF T THEN GO TO NOTREADY;%                                22205000
                                                                        22206000
              IF NOT PRINTWAIT(-U) THEN GO TO SCRATCH ELSE              22207000
              GO TO COMMON;%                                            22208000
         CARD:%                                                         22209000
              CCARD(0&U[3:43:5]);                                       22210000
              RRRMECH ~ RRRMECH OR I;%                                  22211000
              LABELTABLE[U] ~ -@14;%                                    22212000
              GO TO COMMON;%                                            22213000
         PUNCH: STARTIO(U); IF UNIT[U].[15:3]=0 THEN                    22213500
              IF PRINTWAIT(-U) THEN GO TO COMMON; GO TO SCRATCH;        22213600
         DRUM:%                                                         22214000
         DISK:%                                                         22215000
         SPO:%                                                          22216000
         PAPERPUNCH:%                                                   22218000
         DATACOM:%                                                      22219000
              STARTIO(U);%                                              22220000
              GO TO SCRATCH;%                                           22221000
         COMMON:   END OF READY;%                                       22222000
         END;%                                                          22223000
    STATUSBIT ~ TRUE;%                                                  22224000
    FORGETSPACE(AREA.[33:15]);%                                         22225000
    KILL([RCW] INX NOT 2);                                              22226000
    END STATUS;%                                                        22227000
    SAVE BOOLEAN PROCEDURE OLAY(LOC,MIXX);                              22228000
    VALUE LOC,MIXX;  REAL LOC,MIXX;                                     22229000
    BEGIN REAL LINK, MOM, FRONT, BACK, CHAR, BS, STACK, S, SB,%         22230000
         T, X, DESC, DISK, IOD, MIX, JOBKILLED, MIXUP, SEGNO;%          22231000
         ARRAY NAME SEGDICT;%                                           22232000
         REAL RESULT=+1;%                                               22233000
         ARRAY SPRT=IOD[*];%                                            22234000
         REAL INITCW=MIXUP,  CORE=DISK,  CUED=SEGDICT;%                 22235000
         LABEL AROUND, CODE, BACKAGAIN, MCP, INTRINSIC;%                22236000
         LABEL ZAP;%                                                %R4222236100
         LABEL AGAIN;                                                   22236110
         BOOLEAN SUBROUTINE AWAKEN;%                                    22237000
         BEGIN COMMENT AWAKEN CHECKS TO SEE IF WE HAVE HALTED           22238000
              THE JOB ON PROCESSOR 2.  IF SO, IT RESTARTS THE           22239000
              TIMING FOR HIM, AND CALLS "HALT" TO CHECK INTERRUPTS;%    22240000
              IF JOBKILLED THEN%                                        22241000
              BEGIN PROCTIME[P2MIX] ~ *P(DUP)-CLOCK-P(RTR);%            22242000
                   JOBKILLED ~ FALSE;  OLAY ~ RESULT OR 2;%             22243000
                   HALT;  NOPROCESSTOG ~ NOPROCESSTOG-1;%               22244000
              END;%                                                     22245000
         AWAKEN ~ RESULT END;%                                          22246000
         SUBROUTINE STOP;%                                              22247000
    IF NOT JOBKILLED THEN                                               22247100
         BEGIN COMMENT STOP HALTS THE JOB ON PROCESSOR 2, AND           22248000
              CLOCKS HIM OFF.  IT SETS JOBKILLED SO THAT AWAKEN         22249000
              CAN DO ITS DIRTY WORK BEFORE RETURNING;%                  22250000
              JOBKILLED ~ TRUE;  P(HP2);%                               22251000
              PROCTIME[P2MIX] ~ *P(DUP)+CLOCK+P(RTR);%                  22252000
         END STOPPER;%                                                  22253000
         SUBROUTINE CODEOVERLAY;%                                       22254000
         BEGIN COMMENT CODEOVERLAY HANDLES ALL CASES OF MARKING         22255000
              A NORMAL-STATE SEGMENT AS NOT-PRESENT.  IT DOES THIS      22256000
              A SINGLE PRT AND STACK AT A TIME, AND IS ONLY CALLED      22257000
              REPEATEDLY FOR RE-ENTRANT CODE OR INTRINSICS;%            22258000
              IF CHAR THEN S ~ M[SB ~ M[S].[FF]].[FF] ELSE S ~ S-1;%    22259000
              SPRT ~ PRT[MIX,10];%                                      22260000
              IF SPRT[X].[2:1] THEN BEGIN%                              22261000
    % NEED TO DO PRT AND STACK SEARCH ONLY IF PRESENT IN THIS PRT       22262000
                   DO UNTIL (X ~ (SPRT[X] ~ (*P(DUP))&0[2:2:1]%         22263000
                             &(SPRT[X].[CF]-FRONT)[CTC]).[6:12])}2048;% 22264000
    AROUND::%                                                       %R4222265000
                   WHILE (STACK ~ HUNT(BS).[CF])!S DO%                  22266000
                   BEGIN CORE ~ (DESC ~ NFLAG(M[STACK])).[CF];%         22267000
                        IF CORE}FRONT AND CORE{BACK THEN%               22268000
                        IF DESC.[1:2]!0 THEN%                           22269000
                        IF DESC.[3:1] THEN%                             22270000
    % DESCRIPTOR -- INSERT OFFSET AND RESET P-BIT                       22271000
                          M[STACK] ~ FLAG(DESC&0[2:2:1]%                22272000
                                          &(CORE-FRONT)[CTC])%          22273000
                        ELSE BEGIN%                                     22274000
    % CONTROL WORD (RCW) -- UNFLAG IN STACK, PUT OFFSET INTO            22275000
    %    CORRESPONDING MSCW, AND MOM INTO RCW.[CF]                      22276000
                             M[X ~ DESC.[FF]] ~%                        22277000
                                  (*P(DUP))&(CORE-FRONT)[CTC];%         22278000
                             M[STACK] ~ DESC&SEGNO[CTC];%               22279000
                        END;%                                           22280000
                        BS ~ STACK+1;%                                  22281000
                   END;%                                                22282000
                   IF CHAR AND (STACK<SB) THEN%                         22283000
                   BEGIN BS ~ SB;  S ~ HUNT(BS+1).[CF];  GO AROUND END; 22284000
                   IF P(SPRT[19],TOP) THEN P(DEL) ELSE               %DS22284100
                   BEGIN CORE:=POLISH.[CF];                          %DS22284200
                         IF CORE LSS FRONT OR CORE GTR BACK THEN     %DS22284300
                         ELSE SPRT[19]:=(*P(DUP))&0[2:2:1]           %DS22284400
                                        &(CORE-FRONT)[CTC];          %DS22284500
                   END;                                              %DS22284600
$INCLUDE 22284701, IF STATISTICS;                                       22284699
                   CODEOLAYS[MIX]:=*P(DUP)+1;                       %R6322284700
              END OF PRESENT IN PRT CASE;%                              22285000
         END OF CODEOVERLAY;%                                           22286000
         COMMENT   OLAY HANDLES OVERLAYS.  THERE ARE 3 CLASSES          22287000
              OF THINGS WHICH MAY BE OVERLAID:                          22288000
              1)   OBJECT PROGRAM DATA SEGMENTS                         22289000
              2)   OBJECT PROGRAM CODE SEGMENTS                         22290000
         AND  3)   MCP (NON-SAVE) PROCEDURES.                           22291000
              EACH OF THESE CLASSES GETS SPECIAL HANDLING,              22292000
              WHICH WILL BE DESCRIBED AS WE COME TO IT;                 22293000
    % THIS CODE IS COMMON TO ALL CLASSES AND ALL CASES                  22294000
         LINK ~ M[LOC];  MOM ~ M[LOC+1];%                               22295000
         FRONT ~ LOC+2;  BACK ~ LINK.[CF]-1;%                           22296000
         IF (MIX ~ LINK.[9:6])=0 THEN GO TO MCP;%                       22297000
    % <MIX>=0 AND NON-SAVE MEANS MCP PROCEDURE OR INTRINSIC             22298000
         IF MIX=P2MIX THEN STOP;%                                       22299000
         CHAR ~ (INITCW ~ PRT[MIX,8]).[32:1];%                          22300000
         S ~ INITCW.[CF];  BS ~ PRT[MIX,10].[FF];%                      22301000
    % CHAR IS CWMF,  S IS TOP-OF-STACK,  BS IS BASE OF STACK            22302000
         IF P(LINK.[3:6],DUP)=1 OR P(XCH)=13 THEN GO TO CODE;           22303000
    % TYPE=1 MEANS PROGRAM, 13 MEANS TYPE 13 INTRNSC, OTHERWISE DATA.   22304000
         IF TERMSET(MIX) THEN GO TO ZAP;%                           %R4222304100
         IF M[MOM].[CF] NEQ FRONT THEN %BAD MOM DESC.               %10722304200
         BEGIN% TERMINATE THIS GUY.                                 %10722304300
              PRTROW[MIX].[FF]:=32; %MEMORY ERROR.                  %10722304400
              PRTROW[MIX].[PSF]:=1;                                 %10722304500
              GO TO ZAP;                                            %10722304600
         END  BAD MOM;                                              %10722304700
         IF CHAR THEN%                                                  22305000
    % SPECIAL CHECKS FOR ADDRESS SAVED IN CHARACTER MODE                22306000
         BEGIN CHAR ~ (((T ~ M[S-1].[CF])}FRONT AND T{BACK) OR%         22307000
    % M-REGISTER FROM ICW (SOURCE ADDRESS)                              22308000
                       ((T ~ M[S-2].[FF])}FRONT AND T{BACK));%          22309000
    % S-REGISTER FROM ILCW (DESTINATION ADDRESS)                        22310000
              IF NOT CHAR THEN%                                         22311000
              BEGIN X ~ M[S ~ M[S].[FF]].[FF]+1;%                       22312000
    % M[S].[FF] IS ADDRESS OF RCW,  M[RCW].[FF] IS ADDRESS OF MSCW      22313000
                   DO CHAR ~ ((T ~ M[S ~ S-1].[CF])}FRONT               22314000
                        AND T{BACK) UNTIL (S{X) OR CHAR;%               22315000
    % SEARCH THROUGH STREAM LOCALS AND PARAMETERS FOR ADDRESSES         22316000
                   S ~ X;%                                              22317000
              END;%                                                     22318000
         END;%                                                          22319000
         IF CHAR THEN P(AWAKEN, RTN);%                                  22320000
    % CANNOT OVERLAY IF MAY BE ADDRESSES IN CHAR MODE STACK             22321000
          IOD~M[MOM].[8:10];                                            22322000
          IF (DISK~MOM.[FF])!0 THEN MOM.[FF]~0 ELSE                     22322100
          DISK~DISKSPACE(IOD,MIX); IF DISK<0 THEN                       22322200
    % NO OVERLAY DISK, SO CANNOT OVERLAY AT THIS TIME                   22323000
           P(AWAKEN, RTN);%                                             22324000
    % IF WE REACH THIS POINT, WE CAN AND WILL OVERLAY THE AREA          22325000
         OLAYCTR[MIX]:=DOWNOLAY(IOD);                               %R3822325100
$INCLUDE 22325301, IF STATISTICS;                                       22325199
         DATAOLAYS[MIX]:=*P(DUP)+1;                                 %R6322325200
         COUNTUP((FRONT GTR FENCE)+21,(IOD+29) DIV 30);                 22325300
         IF (CUED ~ IOQUEAVAIL!0) THEN%                                 22326000
    % START DISK WRITE IF QUEUE SPACE AVAILABLE TO GET OVERLAP          22327000
           DISKIO(IOD,FRONT-1,IOD,%                                     22328000
              DALOC[MIX,DISK.[33:6]+P(DUP)-1]+DISK.[39:9]);             22328100
         IF (S ~ S-1)>MOM THEN IF MOM>BS THEN BS ~ MOM+1;%              22329000
    % IF MOTHER IS IN STACK, ONLY SEARCH ABOVE IT                       22330000
         WHILE (STACK ~ HUNT(BS).[CF])!S DO%                            22331000
         BEGIN IF (DESC ~ NFLAG(M[STACK])).[1:7]=@40 THEN%              22332000
    % ONLY WORRY ABOUT DATA DESCRIPTORS WHICH ARE PRESENT               22333000
              IF DESC.[FF]=MOM THEN%                                    22334000
    % THIS ONE DEMANDS ACTION -- IT POINTS INTO OUR ARRAY               22335000
                   IF DESC.[8:10]=0 THEN%                               22336000
    % NAME DESCRIPTOR -- PUT IN OFFSET AND RESET P-BIT                  22337000
                     M[STACK] ~ FLAG((DESC.[CF]-FRONT)&MOM[CTF])%       22338000
                   ELSE%                                                22339000
    % NORMAL ROW DESCRIPTOR -- ZERO CORE FIELD AND RESET P-BIT          22340000
                     M[STACK] ~ FLAG(0&DESC[8:8:25]);%                  22341000
              BS ~ STACK+1;%                                            22342000
         END;%                                                          22343000
    % NOW PUT DISK ADDRESS IN MOTHER AND TURN OFF HER P-BIT             22344000
         M[MOM] ~ FLAG(DISK&M[MOM][8:8:25]);%                           22345000
         P(AWAKEN, DEL);%                                               22346000
         IF NOT CUED THEN%                                              22347000
           DISKIO(IOD,FRONT-1,IOD,%                                     22348000
              DALOC[MIX,DISK.[33:6]+P(DUP)-1]+DISK.[39:9]);             22348100
         SLEEP([IOD], IOMASK);%                                         22349000
    ZAP::  FORGETSPACE(FRONT);%                                     %R4222350000
         P(TRUE, RTN);%                                                 22351000
    CODE::%                                                         %R4222352000
    % OBJECT PROGRAM CODE TO BE OVERLAID                                22353000
         IF (T ~ M[S].[CF])}FRONT AND T{BACK THEN%                      22354000
    % CANNOT OVERLAY NORMAL STATE SEGMENT HE WILL RETURN TO             22355000
           P(AWAKEN, RTN);%                                             22356000
         IF LINK.[3:6]=13 THEN %TYPE 13 INTRNSC                         22356100
         BEGIN CHAR~P(PRT[MIX,8],DUP).[32:1];                           22356110
               S~P INX 0; BS~PRT[MIX,10].[FF];                          22356120
         IF CHAR THEN S~M[SB~M[S].[FF]].[FF] ELSE S~S-1;                22356130
         AGAIN: WHILE (STACK~HUNT(BS).[CF])!S DO                        22356140
                    BEGIN CORE~(DESC~NFLAG(M[STACK])).[CF];%            22356150
                    IF CORE}FRONT AND CORE<BACK THEN%                   22356160
                        IF DESC.[1:3]=7 THEN%                           22356170
                         M[STACK]~FLAG(DESC&0[2:2:1]&(MOM.[8:10])[CTC]) 22356180
                        ELSE                                            22356190
                        BEGIN M[DESC.[FF]]~(*P(DUP))&(CORE-FRONT)[CTC]; 22356200
                              M[STACK]~DESC&(MOM.[8:10])[CTC]&          22356210
                                       1[33:47:1];                      22356220
                        END;                                            22356230
                    BS~STACK+1;                                         22356240
                    END;                                                22356250
              IF CHAR AND (STACK<SB) THEN%                              22356260
              BEGIN BS~SB; S~HUNT(BS+1).[CF]; GO AGAIN; END;            22356270
         FORGETSPACE(FRONT); P(AWAKEN,DEL,TRUE,RTN);                    22356280
         END;                                                           22356290
         IF (MIXUP ~ (SEGDICT ~ PRT[MIX,4]).[FF])!0 THEN%               22357000
    % RE-ENTRANT CODE TO BE OVERLAID -- CHECK OTHER USERS, TOO          22358000
         BEGIN MIXUP ~ MIXUP.[39:6];%                                   22359000
              DO BEGIN%                                                 22360000
                   IF MIXUP=P2MIX THEN STOP;%                           22361000
    % STOP OTHER USER OF THIS CODE IF RUNNING ON PROCESSOR 2            22362000
                   IF (T ~ M[PRT[MIXUP,8]].[CF])}FRONT AND T{BACK%      22363000
                     THEN P(AWAKEN, RTN);%                              22364000
    % SAME CRITERIA APPLY TO ALL USERS OF THIS CODE                     22365000
              END UNTIL (MIXUP ~ PRT[MIXUP,4].[24:6])=@77;%             22366000
    % CHECK ALL USERS ON MIX-INDEX LINKED LIST                          22367000
         END;%                                                          22368000
    % IF WE REACH THIS POINT, WE CAN AND WILL OVERLAY THE AREA          22369000
    BACKAGAIN:%                                                         22370000
         X ~ SEGDICT[SEGNO ~ MOM].[8:10];  CODEOVERLAY;%                22371000
         IF MIXUP THEN%                                                 22372000
    % RE-ENTRANT CODE BEING OVERLAID -- MUST FIX ALL STACKS AND PRTS    22373000
         IF (MIX ~ PRT[MIX,4].[24:6])!@77 THEN%                         22374000
    % SET UP CHAR,  S,  AND BS FOR NEXT USERS STACK                     22375000
         BEGIN CHAR ~ (S ~ PRT[MIX,8]).[32:1];%                         22376000
              S ~ S INX 0;  BS ~ PRT[MIX,10].[FF];%                     22377000
    % GO DO STACK SEARCH AND PRT FIX-UP FOR ANOTHER USER                22378000
              GO TO BACKAGAIN;%                                         22379000
         END;%                                                          22380000
         SEGDICT[MOM] ~ (*P(DUP))&MOM[FTF];%                            22381000
    % FIX UP SEGMENT DICTIONARY ENTRY LAST OF ALL                       22382000
         FORGETSPACE(FRONT);  P(AWAKEN, DEL, TRUE, RTN);%               22383000
    % NOW WAS THAT NOT TRIVIALITY PERSONIFIED...                        22384000
    MCP::%                                                          %R4222385000
         IF LINK.[3:6]=7 THEN GO TO INTRINSIC;%                         22386000
         SPRT ~ P(.BED);  BS ~ (P(0,RDF)).[FF];                         22387000
    % SET BS TO POINT AT RCW FOR CALL ON OLAY                           22388000
         DO BEGIN%                                                      22389000
              OLAY ~ NOT(S ~ ((CORE ~ (T ~ M[BS]).[CF]){BACK            22390000
                        AND CORE}FRONT));%                              22391000
    % S IS TRUE IF THE RCW POINTS TO THE ROUTINE TO BE OVERLAID         22392000
              BS ~ T.[FF];%                                             22393000
    % POINT T TO CORRESPONDING MSCW                                     22394000
              WHILE (T ~ M[BS]).[16:1] DO BS ~ T.[FF];%                 22395000
    % RUN DOWN STACK OF MSCWS UNTIL NOT MSFF                            22396000
              IF (BS ~ T.[FF]){64 THEN                                  22397000
    % END OF STACK -- THIS IS RATIONALE FOR OBSCURE USE OF "P(0,STF)"   22398000
              BEGIN S ~ S OR (SPRT ~ FLAG(M[SPRT])).[CF]=P(.BED);       22399000
                   BS ~ SPRT[FREG].[FF];                                22399100
         END  END  UNTIL S;                                             22400000
         IF RESULT THEN%                                                22401000
         BEGIN M[MOM] ~ (*P(DUP))&(*P(.ESPBIT))[CTC];%                  22402000
              FORGETSPACE(FRONT);%                                      22403000
         END;%                                                          22404000
         P(RESULT AND 1, RTN);%                                         22405000
    INTRINSIC::%                                                    %R4222406000
      IF MIXX=0 THEN BEGIN                                              22406100
         FOR MIX~1 STEP 1 UNTIL MIXMAX DO%                              22407000
         IF DAT[MIX]<0 THEN                                             22407500
         IF INTABLEROW[MIX]!0 THEN%                                     22408000
         BEGIN IF MIX=P2MIX THEN STOP;%                                 22409000
              IF (T ~ M[PRT[MIX,8]].[CF])}FRONT AND T{BACK%             22410000
                THEN P(AWAKEN, RTN);%                                   22411000
         END;%                                                          22412000
         FOR MIX~1 STEP 1 UNTIL MIXMAX DO%                              22413000
         IF DAT[MIX]<0 THEN                                             22413500
         IF INTABLEROW[MIX]!0 THEN%                                     22414000
         BEGIN SEGNO ~ MOM.[8:10]-1;%                                   22415000
              STREAM(A ~ SEGNO AND 3: T ~ [INTABLE[MIX,SEGNO DIV 4]]);  22416000
              BEGIN SI ~ T;  SI ~ SI+A;  SI ~ SI+A;  DI ~ LOC A;%       22417000
                   DI ~ DI+6;  DS ~ 2 CHR;  END STREAMING;%             22418000
              IF (SEGNO ~ POLISH)!0 THEN%                               22419000
              BEGIN CHAR ~ P(PRT[MIX,8], DUP).[32:1];%                  22420000
                   S ~ POLISH INX 0;  BS ~ PRT[MIX,10].[FF];%           22421000
                   SEGDICT ~ PRT[MIX,4];%                               22422000
                   X ~ SEGDICT[SEGNO].[8:10];  CODEOVERLAY;%            22423000
                   SEGDICT[SEGNO] ~ (*P(DUP))&MOM[FTF];%                22424000
              END;%                                                     22425000
         END;%                                                          22426000
         INTRNSC[MOM.[8:10]] ~ (*P(DUP))&MOM[FTC];%                     22427000
         FORGETSPACE(FRONT);%                                           22428000
         P(AWAKEN, DEL, TRUE, RTN);%                                    22429000
      END NORMAL CASE;                                                  22430000
         SEGNO ~ MOM.[8:10]-1;  MIX ~ MIXX;                             22431000
         STREAM(A~SEGNO AND 3: T~[INTABLE[MIX,SEGNO.[36:10]]]);         22432000
         BEGIN SI~T;  SI~SI+A;  SI~SI+A;  DI~LOC A;                     22433000
              DI~DI+6;  T~SI;  DS~2 CHR;  DI~T;  DS~2 LIT "00";         22434000
         END STREAM;                                                    22435000
         SEGNO ~ POLISH;  SEGDICT ~ PRT[MIX,4];                         22436000
         CHAR ~P(PRT[MIX,8], DUP).[32:1];                               22437000
         S ~POLISH INX 0;  BS ~PRT[MIX,10].[FF];                        22438000
         X ~ SEGDICT[SEGNO].[8:10];  CODEOVERLAY;                       22439000
         SEGDICT[SEGNO] ~ (*P(DUP))&MOM[FTF];                           22440000
         P(0,RTN);                                                      22441000
    END OF OVERLAY;%    REVISION OF 5 JANUARY 1968 . . .                22442000
 REAL SPACESTACK;                                                       23399000
 SAVE PROCEDURE FORGETSPACE(LOC);%                                      24000000
                      VALUE LOC;%                                       24001000
                      REAL LOC;%                                        24002000
    BEGIN%                                                              24003000
         REAL B,BACK,F,FRONT,LINK,X,T,SIZE;%                            24004000
         REAL MIX;                                                      24004100
         DEFINE LEFTOFF=MEM[MIX,LEFTLIT]#;                              24004200
         MIX~(LINK~M[LOC~(*P(.LOC)).[CF]-2]).[9:6];                     24005000
$ INCLUDE 24005101, IF CHECKLINK OR DEBUGGING;                          24005099
CHECKLINKS(MIX,LOC);                                                    24005100
 IF LOC LSS MEM[MIX,MLINK1].[CF] OR LOC GTR (IF LOC LSS FENCE THEN      24005200
 M[M[0].[FF]].[FF] ELSE MEM[MIX,MLINK1].[FF]) THEN DO UNTIL FALSE;      24005300
         BACK~LINK.[FF];                                                24006000
         IF (F ~ M[FRONT~LINK.[CF]]) < 0 THEN%                          24007000
                   BEGIN%                                               24008000
                    M[LOC]~LINK &F[CTC];%                               24009000
                    M[F]~M[F] & LOC[CTF];%                              24010000
                    M[T~M[FRONT+2]]~M[T] &(X~M[FRONT+1])[CTC];%         24011000
                    M[X+1]~T%                                           24012000
                   END;%                                                24013000
         IF(B~M[BACK])<0%                                               24014000
              THEN%                                                     24015000
                   BEGIN%                                               24016000
                    M[BACK]~B&(T~M[LOC].[CF])[CTC];%                    24017000
                    M[T]~M[T]& BACK[CTF];%                              24018000
                    M[BACK+1]~M[BACK+1]&(SIZE~T-BACK-2)[CTF];%          24019000
                   END%                                                 24020000
              ELSE%                                                     24021000
                   BEGIN%                                               24022000
                    M[LOC+1]~(T~M[M[LOC+2]~MEM[MIX,AVAIL]])&            24023000
                      (SIZE~M[LOC].[CF]-LOC-2)[CTF];                    24024000
                    M[MEM[MIX,AVAIL]]~T&(M[T+1]~LOC+1)[CTC];            24025000
                    M[LOC]~NABS(*P(DUP));                               24026000
                                                                        24027000
                                                                        24028000
                   END;%                                                24029000
    IF LOC{LEFTOFF THEN IF M[LOC].[CF]>LEFTOFF THEN LEFTOFF~M[LOC].[FF];24030000
$ INCLUDE 24030101, IF CHECKLINK OR DEBUGGING;                          24030099
CHECKLINKS(MIX,LEFTOFF);                                                24030100
    END FORGETSPACE;%                                                   24031000
 SAVE REAL PROCEDURE ACTSPACE(SIZE,SAVEF,MIX);                          24032000
         VALUE SIZE,SAVEF,MIX;                                          24033000
         REAL SIZE,SAVEF,MIX;                                           24034000
    BEGIN REAL LINK,LOC,X,Y,T,SIZEF;                                    24034050
         REAL LOS=SIZEF+1,MSTART=LOS+1;                                 24034100
         DEFINE LEFTOFF=MEM[MIX,LEFTLIT]#;                              24034200
         LABEL NEWSTART, SVSEARCH, ROCKABYE, START, OVERLAY;%           24035000
         LABEL OVSEARCH,XX;                                             24035050
         P(0,MEMROW[MIX].[CF],PRIORTY);  % SET UP LOS, MSTART, AND TEMP 24035100
         PRIORTY~-5;                                                    24035200
         IF SAVEF THEN%  ATTEMPT TO ALLOCATE AT START OF MEMORY         24040000
         BEGIN LINK:=M[MSTART];                                         24041000
    SVSEARCH:%                                                          24042000
              IF (LOC~LINK.[CF])=MSTART THEN                            24043000
                   GO TO ROCKABYE;                                      24044000
              IF (LINK ~ M[LOC])}0 THEN%                                24055000
              BEGIN IF NOT LINK.[2:1] THEN%                             24056000
                   BEGIN  % OVERLAY ONLY IF POTENTIAL SPACE ADEQUATE    24056100
                        SIZEF ~ -2; X ~ T ~ LOC;                        24056200
                        IF (Y~LINK.[FF])!MSTART THEN                    24056250
                          IF M[Y] < 0 THEN SIZEF~M[(T~Y)+1].[FF];       24056300
                        WHILE SIZE>SIZEF AND (Y~M[X]).[1:2]!1 DO        24056400
                             SIZEF ~ SIZEF - X + (X ~ Y.[CF]);          24056500
                        IF SIZE > SIZEF THEN                            24056600
                        BEGIN LINK ~ Y; GO TO SVSEARCH END;             24056700
                        IF OLAY(LOC,0) THEN % RE-SET "LINK"             24057000
                   IF (Y~M[LINK~T])>0 OR Y.[CF]=LOC                     24057100
                   OR M[Y].[FF]!LINK THEN                               24057150
                           % MEM LINK AT "T" NO LONGER VALID            24057200
                           LINK ~ M[MSTART];                            24057300
                   END;%                                                24057500
              GO TO SVSEARCH;%                                          24058000
              END;%                                                     24059000
              IF (SIZEF ~ M[T~LOC+1].[FF])<SIZE THEN GO SVSEARCH;%      24060000
              M[Y:=M[(X:=M[T])+1]:=M[T+1]]:=(*P(DUP))&X[CTC];           24063000
              X:=-LINK;                                                 24064000
              IF SIZEF>SIZE+DELTA THEN%                                 24065000
              BEGIN M[LOC]:=X&(Y:=LOC+SIZE+2)[CTC];                     24066000
                   M[X] ~ (*P(DUP))&Y[CTF];%                            24067000
                   M[Y]:= X.[CF]&LOC[CTF]&MIX[9:42:6];                  24068000
                   FORGETSPACE(Y+2);%                                   24069000
                   X.[CF]:=Y;                                           24069100
              END;%                                                     24070000
         END ELSE BEGIN% ALLOCATE ON "SPACE AVAILABLE" BASIS            24071000
    START:%                                                             24072000
              IF (LINK ~ P(M[MEM[MIX,AVAIL]],0,SIZE,CFX,LLL,            24073000
                0, INX, .T, STD)).[FF]=@77777 THEN%                     24074000
              BEGIN%                                                    24075000
    OVSEARCH:                                                           24075050
                   IF (LINK~M[LEFTOFF]).[1:2] = 0 THEN                  24075100
                   BEGIN  % OVERLAY ONLY IF POTENTIAL SPACE ADEQUATE    24075200
                        SIZEF ~ -2; X ~ LEFTOFF;                        24075300
                        IF (Y~LINK.[CF]) ! MSTART THEN                  24075400
                           IF M[Y] < 0 THEN SIZEF ~ M[Y+1].[FF];        24075500
                        WHILE SIZE > SIZEF AND (Y~M[X]).[1:2]!1 DO      24075600
                        BEGIN SIZEF~SIZEF+Y.[CF]-X; X~Y.[FF] END;       24075700
                        IF SIZE > SIZEF THEN                            24075800
                        BEGIN LEFTOFF ~ Y.[FF];                         24075900
                        IF X=MSTART THEN GO XX ELSE GO OVSEARCH END;    24075950
                                                                        24075960
    OVERLAY:%            OVERLAY ATTEMPTED CYCLICALLY, USING LEFTOFF    24076000
                                                                        24076500
                                                                        24077000
                        IF OLAY(LEFTOFF,0) THEN GO TO START;            24078000
                   END;%                                                24078500
                   IF (LEFTOFF~LINK.[FF])=MSTART THEN                   24079000
    XX:            IF LOS THEN GO TO ROCKABYE ELSE LOS ~ 1;             24080000
                   GO TO OVSEARCH;                                      24081000
              END;%                                                     24082000
                                                                        24083000
              IF (SIZEF ~ LINK.[FF])>SIZE+DELTA THEN%                   24084000
              BEGIN M[T] ~ LINK&(X ~ SIZEF-SIZE-2)[CTF];%               24085000
                   LOC ~ T+X+1;%                                        24086000
                   X ~ (Y ~ M[T-1])&(T-1)[CTF];%                        24087000
                   M[Y] ~ (*P(DUP))&LOC[CTF];%                          24088000
                   M[T-1] ~ Y&LOC[CTC];%                                24089000
              END ELSE BEGIN%                                           24090000
                   M[LINK+1] ~ Y ~ M[T+1];%                             24091000
                   M[Y] ~ (*P(DUP))&LINK[CTC];%                         24092000
                   X ~ M[LOC ~ T-1];%                                   24093000
              END;%                                                     24094000
         END;                                                           24095000
         M[ACTSPACE~LOC]~ABS(X&1[2:47:1]);                              24096000
         M[LOC+1]~0;                                                    24096500
 ROCKABYE:                                                              24096600
         PRIORTY~P;                                                     24096700
    END ACTSPACE;                                                       24097000
 SAVE INTEGER PROCEDURE DISKSPACE(WORDS,MIX);                           24101000
 VALUE   WORDS,MIX;                                                     24102000
 INTEGER WORDS,MIX;                                                     24103000
    BEGIN ARRAY LOC=+2[*];                                              24104000
         INTEGER   INDEX=NT1,                                           24105000
                   SEG  =NT2,                                           24106000
                   CNTRS=NT3,                                           24107000
                   SIZE =NT4,                                           24108000
                   LIMIT=NT5;                                           24109000
         REAL      T    =NT6;                                           24110000
         LABEL     L1,                                                  24111000
                   FINAL,                                               24112000
                   BADEXIT,                                             24112500
                   EXIT;                                                24113000
         DEFINE    HEURISTIC = 2#;                                      24114000
         REAL SUBROUTINE FINDSEG;                                       24115000
         BEGIN;  STREAM(A~0:T);                                         24116000
                   BEGIN SI~LOC T;  SI~SI+3;                            24117000
                        5(IF SC="0" THEN JUMP OUT TO L;                 24118000
                          SI~SI+1;  TALLY~TALLY+1);                     24119000
                   L:   A~TALLY;                                        24120000
                   END STREAM;                                          24121000
              FINDSEG ~ POLISH                                          24122000
         END FINDSEG;                                                   24123000
         SUBROUTINE FIND;                                               24124000
         BEGIN POLISH(0);                                               24125000
              T ~ LOC[INDEX];                                           24126000
              IF DRUMCTR!0 THEN IF T=0 THEN                             24126100
              BEGIN COMMENT PREFERENCE GIVEN TO ALLOCATING DRUMS;       24126200
                   SEG := 0;  DO UNTIL DRUMTABLE[SEG := SEG+1]<0;       24126300
                   DRUMTABLE[SEG] := LOC[INDEX-1];                      24126400
                   LOC[INDEX-1] := -(SEG|500);                          24126500
                   DRUMCTR := *P(DUP)-1;                                24126600
              END;                                                      24126700
              SEG ~ T.[9:3];                                            24127000
              CNTRS ~ T.[2:7];                                          24128000
              IF SEG>4 THEN                                             24129000
    L1:         IF (SEG ~ FINDSEG)=5 THEN GO TO FINAL                   24130000
              ELSE CNTRS ~0;                                            24131000
              IF SIZE+CNTRS>100 THEN GO TO L1;                          24132000
              P(DEL,(INDEX|256)+SEG|100+CNTRS);                         24133000
              STREAM(A~0:SEG,T~[T]);                                    24134000
              BEGIN SI~T;  SI~SI+3;  SI~SI+SEG;                         24135000
                   DI~LOC A;  DI~DI+7;  SEG~DI;                         24136000
                   T~SI;  DS~CHR;  TALLY~A;                             24137000
                   TALLY~TALLY+1;  A~TALLY;                             24138000
                   SI~SEG;  DI~T;  DS~CHR;                              24139000
              END STREAM;                                               24140000
              IF (POLISH=63) OR (CNTRS ~ CNTRS+SIZE)=100 THEN           24141000
              BEGIN CNTRS ~ 0;  SEG ~ FINDSEG END;                      24142000
              LOC[INDEX] ~ T&SEG[9:45:3]&CNTRS[2:41:7];                 24143000
    FINAL:    IF (DISKSPACE ~ POLISH)!0 THEN                            24144000
              BEGIN IF SEG=5 THEN INDEX ~ 0;                            24145000
                   LOC[0] ~ LIMIT&INDEX[CTF];                           24146000
                   GO TO EXIT;                                          24147000
         END  END FIND;                                                 24148000
                                                                        24149000
         P(DALOC[MIX,*]);                                               24150000
         SIZE ~ (WORDS+29) DIV 30;                                      24151000
         IF (LIMIT := LOC[0].[CF])=0 THEN GO TO BADEXIT;                24152000
         IF (INDEX ~ LOC[0].[FF])!0 THEN FIND;                          24153000
         INDEX ~ 2;                                                     24154000
         DO IF LOC[INDEX-1]<0 THEN FIND UNTIL (INDEX := INDEX+2)>LIMIT; 24154100
         INDEX := 2;  DO FIND UNTIL (INDEX := INDEX+2)>LIMIT;           24155000
    BADEXIT:                                                            24155500
         DISKSPACE ~ -1;                                                24156000
    EXIT:                                                               24157000
$INCLUDE 24157201, IF STATISTICS;                                       24157099
              IF INDEX GEQ OLAYUSED[MIX].[3:15] THEN                    24157100
              OLAYUSED[MIX]:=LOC[INDEX]&INDEX[3:33:15];                 24157200
         STREAM(A~0:L~LIMIT.[41:6],T~[LOC[1]]);                         24158000
         BEGIN SI~T;  DI~A;                                             24159000
              L(SI~SI+11;                                               24160000
                5(IF SC="0" THEN DI~DI+8;  SI~SI+1));                   24161000
              A~DI;                                                     24162000
         END STREAM;                                                    24163000
         IF (POLISH<HEURISTIC) THEN                                     24164000
              IF ((SEG ~ TWO(MIX)) AND OLAYMASK)!0 THEN                 24165000
              BEGIN OLAYMASK ~ NOT SEG AND OLAYMASK;                    24166000
                   FORK(P(.GETMOREOLAYDISK),MIX,-3,128,0);              24167000
                   IOCOUNT[MIX] ~ *P(DUP)+1;                            24168000
              END;                                                      24169000
    END DISKSPACE;                                                      24170000
 SAVE REAL PROCEDURE GETSPACE(SIZE,TYPE,SAVEF);                         24300000
         VALUE SIZE,TYPE,SAVEF;                                         24301000
         REAL SIZE,TYPE;                                                24302000
         BOOLEAN SAVEF;                                                 24303000
         BEGIN REAL MIX,T;                                              24304000
              BOOLEAN BELOW;                                            24304500
              LABEL AGAIN,SLEAP;                                        24305000
              REAL MESS,GM,GM1;%GM,GM1 MUST FOLLOW MESS.                24306000
              BELOW~[MEM[MIX~IF TYPE}64 THEN TYPE.[FF] ELSE P1MIX,0]].  24307000
                   [CF] = 0;                                            24307500
$ INCLUDE 24308001, IF CHECKLINK OR DEBUGGING;                          24307999
              CHECKLINKS(MIX,MEM[MIX,LEFTLIT]);                         24308000
    AGAIN:    WAITSTORE(MIX); STOREDY[MIX]~0;                           24309000
              IF BELOW THEN P(SPACESTACK,STS);                          24310000
              T~ACTSPACE(SIZE,SAVEF,MIX);                               24311000
              IF BELOW THEN P([BELOW] INX 2,STS);                       24312000
              STOREDY[MIX]~1;                                           24313000
              IF T=0 THEN                                               24314000
              BEGIN IF SAVEF.[46:1] THEN P(0,RTN);                      24315000
                   IF P1MIX=0 OR BELOW THEN                             24315100
                   BEGIN                                                24315200
                   IF MESS=0 THEN                                       24316000
              BEGIN;STREAM(MIX,SIZE,N~[MESS]);                          24317000
                    BEGIN SI~LOC MIX;DS~2 DEC;DS~9LIT" NO MEM ";        24318000
                          DS~5DEC;DS~5LIT" WDS~";                       24319000
                                  DI~N; DS~FILL;                        24320000
                             END;                                       24321000
                        P(WAITIO([MESS],@177,25),DEL);                  24322000
                   END;                                                 24323000
    SLEAP:         SLEEP([CLOCK],NOT CLOCK);                            24324000
                   GO TO AGAIN;                                         24325000
                   END;                                                 24326000
                   IF PRT[P1MIX,9] = 5 THEN  %EOJ DONT EXPAND           24327000
                   BEGIN MIX:=0; BELOW:=TRUE; GO TO AGAIN;              24328000
                   END;  %SPACE IS GOT BELOW FENCE IF EOJ               24329000
                   IF CANTEXPAND[MIX] THEN                              24330000
                   IF (BELOW:=BELOW+2) GTR 5 THEN                       24331000
                   BEGIN                                                24332000
                        TERMINATE(MIX&81[CTF]);                         24333000
                        GO TO INITIATE;                                 24334000
                   END ELSE GO TO SLEAP;                                24350000
                   EXPAND[MIX]~3;                                       24351000
                   SWAP(FORCESWAP,3);                                   24352000
                   GO TO AGAIN;                                         24353000
              END;                                                      24354000
              M[GETSPACE~T]~(*P(DUP))&TYPE[3:42:6]&MIX[9:42:6];         24400000
              IF MESS!0 THEN                                            24401000
              BEGIN MESS.[18:12]~"OK";                                  24402000
                   P(WAITIO([MESS],@177,25),DEL);                       24403000
              END;                                                      24404000
$ INCLUDE 24405001, IF CHECKLINK OR DEBUGGING;                          24404999
              CHECKLINKS(MIX,MEM[MIX,LEFTLIT]);                         24405000
              IF [MEM[MIX,0]].[CF]>T OR MEM[MIX,0].[FF]<T THEN          24406000
                   DO UNTIL FALSE;                                      24407000
         END GETSPACE;                                                  24408000
$ INCLUDE 24641001, IF SHAREDISK;                                       24599999
PROCEDURE FINDFREEADDRESS(N); VALUE N; REAL N;                          24600000
BEGIN                                                                   24601000
    REAL RCW=+0,T=RCW+1,A=T+1,S=A+1,U=S+1,I=U+1;                        24602000
    LABEL LOOK;                                                         24603000
    P(@2000,0,0,0,0);                                                   24609000
    IF (FINDFREECTR:=FINDFREECTR+1) GEQ 32 THEN% THIS PROCEDURE IS      24610000
              % CALLED FREQUENTLY SO MAKE IT A SAVE PROCEDURE           24611000
         M[(*P(..FINDFREEADDRESS))INX 0-2].[2:1]:=1;                    24612000
LOOK:                                                                   24613000
    P(WAITIO([T] INX @4000000000,0,18),DEL); % REPORT FREE ADDRESS      24614000
    IF A!0 THEN % THERE WAS A FREE ADDRESS                              24615000
    BEGIN                                                               24616000
         FOR I:=0 STEP 1 UNTIL LQAVAIL-1 DO                             24617000
         IF (LQUE[I].[8:40] EQV A)=NOT 0 THEN                           24618000
         BEGIN                                                          24619000
              U:=LOCATQUE[S:=LQUE[I].[1:7]].[12:6];                     24620000
              IF UNIT[U].[FF]>1023 THEN                                 24621000
              BEGIN                                                     24622000
                   UNIT[U]:=(*P(DUP))&S[CTF]&S[CTC];                    24623000
                   STARTIO(U);                                          24624000
              END ELSE                                                  24625000
              BEGIN                                                     24626000
                   LOCATQUE[UNIT[U].[CF]].[FF]:=S;                      24627000
                   UNIT[U].[CF]:=S;                                     24628000
              END;                                                      24629000
              IF I LSS (LQAVAIL:=LQAVAIL-1) THEN                        24630000
              BEGIN                                                     24631000
                   STREAM(A:=LQAVAIL-I,B:=[LQUE[I]]);                   24632000
                   BEGIN SI:=B;SI:=SI+8;DS:=A WDS END;                  24633000
                   I:=I-1;                                              24634000
              END;                                                      24635000
         END;                                                           24636000
         IF LQAVAIL!0 THEN GO LOOK;                                     24637000
    END;                                                                24638000
    FINDINGADDRESS:=0;                                                  24639000
    IF N THEN KILL([RCW] INX NOT 2);                                    24640000
END; % OF FINDFREEADDRESS                                               24641000
PROCEDURE LIBRARYLOAD;                                                  28000000
BEGIN REAL ALPHA;                                                       28001000
    REAL COMMON=-4;                                                     28002000
    REAL TYPE,SEG,UNITNO,EADD,FN,SN,U,T,Q,SIZE,N2,LAST;                 28003000
    REAL I,J,K,N,IC,Y,MID,FID,REEL,W,LOADING,N1;                        28004000
    ARRAY AROW[*],LBL[*],X[*],IOD[*],H[*],S[*],LAB[*];                  28005000
    DEFINE DSED=(TERMSET(P1MIX))#,                                      28006000
         SPACER=5&@1400[CTF]#,                                          28007000
         MM=@37700040#,                                                 28008000
         SM=@37700000#;                                                 28009000
    LABEL FINDIT,PARERR,LOOP,WATE,BACK,FINDFILENAMES,                   28010000
          EXT,OK,WY,                                                    28010100
         LOADEM,LAY,FALLOUT,ENDLOOP,EXIT;                               28011000
    BOOLEAN BB;                                                         28011010
$ INCLUDE 28011021,IF B6500LOAD;                                        28011019
    ARRAY XX[*],BCL[*];REAL CCT,NT1,NT2;                                28011020
    BOOLEAN B6500;                                                      28011030
$ INCLUDE 28012401,IF B6500LOAD;                                        28011999
    BOOLEAN SUBROUTINE UNSCREW;                                         28012000
    BEGIN                                                               28012010
    NT1:=CCT|8;                                                         28012020
    STREAM(AD:=(XX  INX(NT1 DIV 48))&(NT1 DIV 6)[30:45:3],              28012030
           BITS:=((NT1-CCT|6)MOD 6)DIV 1,N1:=0,N2:=0,N3:=0,BCL);        28012040
    BEGIN                                                               28012050
    SI:=AD;SKIP BITS SB;                                                28012060
    4(DI:=DI+6;SKIP 4 DB;8(IF SB THEN DS:=SET ELSE DS:=RESET;SKIP SB)); 28012070
    SI:=BCL;SI:=SI+24;DI:=LOC N2;DS:=WDS;                               28012080
    SI:=AD;SKIP BITS SB;SKIP 32 SB;N2(SKIP 8 SB);                       28012082
    DI:=BCL;DI:=DI+38;SKIP 4 DB;                                        28012090
    8(IF SB THEN DS:=SET ELSE DS:=RESET;SKIP SB);N3:=DI;SI:=N3;         28012100
    SI:=SI-8;DI:=LOC N3;DS:=WDS;DI:=BCL;DI:=DI+40;SI:=AD;               28012110
    SKIP BITS SB;SKIP 32 SB;                                            28012112
    N2(DI:=DI+7;SKIP 2 SB;6(IF SB THEN DS:=SET ELSE DS:=RESET;SKIP SB));28012120
    SKIP 8 SB;                                                          28012130
    N3(DI:=DI+7;SKIP 2 SB;6(IF SB THEN DS:=SET ELSE DS:=RESET;SKIP SB));28012140
    END OF EBCDIC FORMATTING;                                           28012150
    NT2:=BCL[3]+BCL[4]-1;                                               28012160
    FOR NT1:=0 STEP 1 UNTIL NT2 DO BCL[NT1+5]:=P(DUP,LOD)+@20;          28012170
    CCT:=CCT+BCL[0];                                                    28012180
    STREAM(N1:=IF BCL[3] >7 THEN 7 ELSE BCL[3],                         28012190
     N2:=IF BCL[4]>7 THEN 7 ELSE BCL[4],N3:=BCL INX 5,N4:=0,N5:=[X[I]]);28012200
    BEGIN                                                               28012210
    DS:=16LIT"0       ";                                                28012220
    DI:=DI-15;N4:=DI;SI:=N3;                                            28012230
    N1(SI:=SI+7;DS:=CHR);DI:=N4;DI:=DI+8;                               28012240
    N2(SI:=SI+7;DS:=CHR);                                               28012250
    END;                                                                28012260
    IF  BCL[2]=1 THEN BEGIN X[I+1]:=X[I];X[I]:=0 END;                   28012270
    UNSCREW:=BCL[0]=0 OR (I:=I+2)>1024;                                 28012280
END OF TAPE DIRECTORY CONVERSION;                                       28012290
    SUBROUTINE FIXHDR;                                                  28012300
    BEGIN                                                               28012310
    BCL:=[M[CCT:=SPACE(36)]]&36[8:38:10];                               28012320
    MOVE(30,CCT-1,CCT);                                                 28012330
    FOR NT1:=15 STEP 1 UNTIL 29 DO BCL[NT1-5]:=H[NT1];                  28012332
    BCL[7]:=H[4];BCL[9].[43:5]:=H[5].[23:5];                            28012340
    BCL[8]:=H[5].[28:20];BCL[3].[2:10]:=H[6].[1:10];                    28012350
    BCL[3].[30:18]:=H[6].[10:18];MOVE(30,BCL,H);                        28012360
    END OF FIXHDR;                                                      28012400
    SUBROUTINE GETASEGMENT;                                             28013000
    BEGIN                                                               28014000
         SEG:=S[29];                                                    28015000
         DISKWAIT(-S.[CF],30,SEG);                                      28016000
         FORGETESPDISK(SEG);                                            28017000
         I:=2;                                                          28018000
    END; % OF GETASEGMENT                                               28019000
    %***********************************************************        28020000
    SUBROUTINE CHECKFORSWAP;                                            28021000
    BEGIN                                                               28022000
         IF (T:=PRTROW[P1MIX].[PSF])!0 THEN                             28023000
         BEGIN                                                          28024000
              IF T=2 THEN                                               28025000
              BEGIN                                                     28026000
                   IOCOUNT[P1MIX]:=-1;                                  28027000
                   STOPM;                                               28028000
              END ELSE                                                  28029000
              IF T!1 THEN SWAP(FORCESWAP,1);                            28030000
         END;                                                           28031000
         IF ELAPSEDLIMIT[P1MIX] GTR IOTIME[P1MIX] THEN                  28032000
         IF PROCLIMIT[P1MIX]>PROCTIME[P1MIX]+CLOCK+P(RTR) THEN GO EXIT; 28033000
         FOR T:=SC[P1MIX] STEP 1 UNTIL LC[P1MIX] DO                     28034000
         IF ACTIVE[T]>1 THEN                                            28035000
         BEGIN                                                          28036000
              IOCOUNT[P1MIX]:=-1;                                       28037000
              SWAP(TIMEND,1);                                           28038000
              ELAPSEDLIMIT[P1MIX]:=*P(DUP)+128;                         28039000
              PROCLIMIT[P1MIX]:=*P(DUP)+64;                             28040000
              GO TO EXIT;                                               28041000
         END;                                                           28042000
EXIT:                                                                   28043000
    END; % OF CHECKFORSWAP                                              28044000
    %*******************************************************            28045000
    SUBROUTINE ABORT;                                                   28046000
    BEGIN                                                               28047000
         IF LOADING THEN P(DIRECTORYSEARCH(X[J],X[J+1],5+LOADING),DEL); 28048000
         IF U}0 THEN                                                    28049000
         BEGIN                                                          28050000
              STOPTIMING(5,1023);                                       28051000
              STOPTIMING(0,1023);                                       28052000
              IF NOT UNIT[U].[16:1] THEN BLASTQ(U);                     28053000
              SETNOTINUSE(U,0);                                         28054000
         END;                                                           28055000
         WHILE S[29]!0 DO GETASEGMENT;                                  28056000
         IF UNITNO!0 AND LABELTABLE[UNITNO]=@214 THEN                   28057000
              LABELTABLE [UNITNO]~@114;                                 28058000
         STREAM(T~T~GETSPACE(5,0,0)+2);                                 28058100
         BEGIN DS~21LIT"LIBRARY LOAD ABORTED~"; END;                    28058200
         SPOUT (T);                                                     28058300
         GO INITIATE;                                                   28059000
    END; % ABORT                                                        28060000
    %***********************************************************        28061000
    BOOLEAN SUBROUTINE LABELCHECK;                                      28062000
    BEGIN                                                               28063000
         P(WAITIO(LAB INX @120540000000,0,U),DEL);                      28064000
$ INCLUDE 28064101,IF B6500LOAD;                                        28064099
         IF B6500 THEN P(WAITIO(SPACER,MM,U),DEL);                      28064100
           IF @40!WAITIO(SPACER,@40,U) THEN                             28065000
                P(WAITIO(@4740000005,0,U),DEL);                         28065610
         IF DSED THEN ABORT;                                            28066000
         IF (NOT B6500 AND ((NFLAG(LAB[0]).[6:42] EQV "LABEL  ")!NOT 0  28067000
         OR (NFLAG(LAB[2]).[6:24] EQV "FILE")!NOT 0))                   28067100
$ INCLUDE 28069101,IF B6500LOAD;                                        28068999
         AND (((NT1:=NFLAG(LAB[0])).[1:23] EQV "HDR1")!NOT 0 OR         28069000
         (NT1.[24:24] EQV "FILE")!NOT 0)                                28069100
         THEN BEGIN                                                     28070000
              STREAM(A~[TINU[U]],T~T~GETSPACE(10,0,0)+2);               28071000
              BEGIN SI~A;SI~SI+5;DS~LIT".";DS~3 CHR;                    28072000
                   DS~21 LIT" NOT A LIBRARY TAPE~";                     28073000
              END;                                                      28074000
              SPOUT(T); T~1;                                            28075000
         END ELSE T~0;                                                  28076000
         LABELCHECK~T;                                                  28077000
    END;                                                                28078000
    %***********************************************************        28079000
    SUBROUTINE FINDTHETAPE;                                             28080000
    BEGIN                                                               28081000
FINDIT:                                                                 28082000
         IF (U~FINDINPUT(MID,FID,REEL,-0,0,0,0,0,1,5)) < 0 THEN ABORT;  28083000
         RRRMECH:=TWO(U) OR RRRMECH;                                    28084000
$ INCLUDE 28084101,IF B6500LOAD;                                        28084099
         IF B6500 THEN P(WAITIO(SPACER,MM,U),DEL);                      28084100
         IF LABELCHECK THEN                                             28085000
         BEGIN                                                          28086000
              SETNOTINUSE(U,1);                                         28087000
              GO FINDIT;                                                28088000
         END;                                                           28089000
         STARTIMING(5,U);                                               28090000
         M[PRT[P1MIX,3] INX (5|REEL+3)].[23:1] := 1;                    28090500
         RDCTABLE[U].[8:6]:=P1MIX;                                      28091000
         STREAM (S~PRNTABLE[U].[18:30],T~[T]);                          28091100
         BEGIN SI~LOC S; DS~8DEC; DI~DI-7; DS~6FILL; END;               28091200
         IF OPNMESS THEN FILEMESS(" IN "&TINU[U][6:30:18],T,0,MID,1,0,0)28092000
    END; % OF FINDTHETAPE                                               28093000
    %***********************************************************        28094000
    BOOLEAN SUBROUTINE ENDOFREEL;                                       28095000
    BEGIN                                                               28096000
         BLASTQ(U);                                                     28097000
$ INCLUDE 28097201,IF B6500LOAD;                                        28097099
        IF B6500 THEN                                                   28097100
        FOR CCT:=0 STEP 1 UNTIL 1 DO P(WAITIO(SPACER,MM,U),DEL);        28097200
    NT1:=WAITIO(LAB INX @120540000000,@40,U);                           28098000
         IF DSED THEN ABORT;                                            28099000
    IF ((NOT B6500) AND NFLAG(LAB[4]) AND NT1!@40)                      28101000
$ INCLUDE 28101101,IF B6500LOAD;                                        28101099
    OR((  NFLAG(LAB[0]).[1:23] EQV "EOV1")=NOT 0)                       28101100
    THEN BEGIN                                                          28102000
              STOPTIMING(5,1023);%                                      28103000
              SETNOTINUSE(U,0);                                         28104000
              REEL~REEL+1;                                              28105000
              FID:=LAB[2];                                              28106000
              FINDTHETAPE;                                              28107000
              ENDOFREEL~TRUE;                                           28108000
         END ELSE ENDOFREEL~FALSE;                                      28109000
    END;      %   OF SUBROUTINE  ENDOFREEL                              28110000
    %***********************************************************        28111000
    BOOLEAN SUBROUTINE CHECK;                                           28112000
    BEGIN                                                               28113000
         IF (Y:=IOD[W]).[27:2]!0 THEN % PARITY ERROR OR EOF             28114000
         BEGIN                                                          28115000
              IF Y.[7:1] AND Y.[27:1] THEN % END OF REEL                28116000
              BEGIN                                                     28117000
                   IF NOT ENDOFREEL THEN                                28118000
                   BEGIN                                                28119000
                        P(WAITIO(@4740000020,@377,U),DEL);              28120000
                        LBMESS(-X[J],X[J+1],"NOT ","LOADED(","UNEXPED", 28120500
                               " EOF).",TINU[U]);                       28121000
                        Y ~ 1;                                          28121500
                        GO TO EXT;                                      28121600
                   END;                                                 28122000
                   IF WAITIO(IOD[W] INX @16040540000000,SM,U)!0 THEN    28123000
                        GO PARERR;                                      28124000
                   IF IOD[1-W].[7:1] THEN % ANOTHER TAPE IO IN PROGRESS 28125000
                   BEGIN                                                28126000
                        IF WAITIO(IOD[1-W],SM,U)!0 THEN GO PARERR;      28127000
                        IOD[1-W]:=(*P(DUP)) OR IOMASK;                  28128000
                   END;                                                 28129000
                   Y~0;                                                 28129100
              END ELSE % PARITY ERROR                                   28130000
PARERR:       BEGIN                                                     28131000
                   LBMESS(-X[J],X[J+1],"NOT ","LOADED(",                28132000
                        IF Y.[7:1] THEN "TAPE P" ELSE "DISK P",         28133000
                        "ARITY),",TINU[U]);                             28134000
                   Y:=1;                                                28135000
              END;                                                      28136000
         END ELSE % CHECK RECORD SIZE                                   28137000
         IF Y.[7:1] THEN                                                28138000
         BEGIN                                                          28139000
         IF (Y:=((M[AROW[W] INX NOT 0]!900+B6500)                       28140000
             AND N LSS N1)) THEN                                        28140100
                   LBMESS(-X[J],X[J+1],"NOT ","LOADED(","INV REC",      28141000
                        "SIZE),",TINU[U]);                              28142000
         END ELSE Y:=0;                                                 28143000
EXT:     CHECK ~ Y;                                                     28144000
    END; % OF CHECK                                                     28145000
    %***********************************************************        28146000
    SUBROUTINE IO;                                                      28147000
    BEGIN                                                               28148000
         IF IC THEN                                                     28149000
         BEGIN                                                          28150000
              IOREQUEST(-(IOD[W]:=(AROW[W] INX @540000000)              28151000
                &(SIZE+B6500)[8:38:10]&TINU[U][3:3:5])OR @2017700000,   28152000
                   IOD[W],[IOD[W]]&U[12:42:6]);                         28153000
              N:=N+30;                                                  28154000
         END ELSE                                                       28155000
         BEGIN                                                          28156000
         DISKIO(IOD[W],AROW[W] INX B6500-1,(T:=IF(T:=LAST-Q+1)          28157000
                  LSS 30 THEN 30|T ELSE 900),Q);                        28158000
              Q:=Q+30;                                                  28159000
$INCLUDE 28159101, IF STATISTICS;                                       28159099
         COUNTUP(18,T DIV 30);                                          28159100
         END;                                                           28160000
    END; % OF IO                                                        28161000
    %***********************************************************        28162000
    BOOLEAN SUBROUTINE LOADAROW;                                        28163000
    BEGIN                                                               28164000
         N1 ~ H[8]; SIZE ~ 900;%                                        28165000
         LAST~(Q~H[K+9])+H[8]-1;%                                       28166000
         IOD[1]:=N2:=W:=N:=0;                                           28167000
         IC:=1;                                                         28168000
         IO; % FIRE UP FIRST TAPE READ                                  28169000
         W ~1;% SWAP BUFFERS                                            28170000
         IF N<N1 THEN% CANNOT DO ROW WITH ONE READ                      28171000
LOOP:    IO;                                                            28172000
WATE:    M[P(..LIBRARYLOAD)].[CF]~ALPHA;                                28173000
         COMPLEXSLEEP((((IOD[0] OR IOD[1]) AND IOMASK)!0) OR DSED);     28173500
         IF DSED THEN ABORT;                                            28174000
         N2~N2+15;% COUNT NUMBER OF OPERATIONS COMPLETED                28175000
         W~IF (IOD[0] AND IOD[1] AND IOMASK)!0 THEN 1-W ELSE            28176000
              ((IOD[1] AND IOMASK)!0);                                  28177000
         IF NOT(Y~CHECK) THEN% NO ERRORS WERE DETECTED                  28178000
         BEGIN% KEEP GOING                                              28179000
              IC~1-IOD[W].[7:1];% SWAP UNITS                            28180000
              IF N<N1 THEN GO TO LOOP;% ROW IS NOT FINISHED             28181000
              IF N2+30}N THEN SIZE~T; % CHANGE SIZE FOR LAST RECORD     28182000
              IF IOD[W].[24:1] THEN GO TO LOOP;% MORE WRITING TO DO     28183000
              IF N2<N THEN BEGIN IOD[W]~0; GO TO WATE END;%             28184000
         END;%                                                          28185000
         LOADAROW:=Y;                                                   28186000
    END; % OF LOADAROW                                                  28187000
    %***********************************************************        28188000
     SUBROUTINE SPACIT;%                                                28189000
    BEGIN  %                                                            28190000
BACK:    WHILE WAITIO(SPACER,MM,U)!@40 DO                               28191000
         BEGIN                                                          28192000
              IF DSED THEN ABORT;                                       28193000
              CHECKFORSWAP;                                             28194000
         END;                                                           28195000
         IF ENDOFREEL THEN GO BACK;                                     28196000
    END; % SPACIT                                                       28197000
    %***********************************************************        28198000
    ALPHA~(*P(..LIBRARYLOAD)).[CF];                                     28198500
    S:=[M[SPACE(30)]]&30[8:38:10];                                      28199000
    TYPE:=COMMON.[FF];                                                  28200000
    S[29]:=COMMON.[CF];                                                 28201000
$ INCLUDE 28201101,IF B6500LOAD;                                        28201099
    B6500:=COMMON.[15:1];                                               28201100
    COMMON ~ IF COMMON.[9:6]!0 THEN -COMMON.[9:6] OR M ELSE             28201200
             IF COMMON.[1:1] THEN 1 OR M ELSE                           28201300
             IF COMMON.[2:1] THEN 2 OR M ELSE 0;                        28201400
    REEL:=1;                                                            28202000
    GETASEGMENT;                                                        28203000
    STREAM(MID:=MID:=S[1],B:=PRT[P1MIX,3]);                             28204000
    BEGIN DS:=16 LIT"0DIRCTRY0DISK   ";DS:=25 LIT"0";SI:=LOC MID;       28205000
         SI:=SI+1;DS:=7 CHR;DS:=8 LIT"0FILE000";DS:=24 LIT"0";          28206000
    END;                                                                28207000
    UNITNO:=S[0].[2:6];                                                 28208000
    LAB:=[M[SPACE(15)]]&15[8:38:10];                                    28209000
    MID:=S[1];                                                          28210000
    FID:="FILE000";                                                     28211000
    FINDTHETAPE;                                                        28212000
    X:=[M[T:=SPACE(1024)]]&1023[8:38:10];                               28213000
    MID ~ LAB[1];                                                       28213100
    STARTIMING(0,18);                                                   28214000
    P(WAITIO((                                                          28215000
$ INCLUDE 28215003,IF B6500LOAD;                                        28215001
              IF B6500 THEN (XX:=X&(GETSPACE(1024,0,1)+2)[CTC]) ELSE    28215002
              X)&@5400[CTF],0,U),DEL);                                  28215004
$ INCLUDE 28215061,IF B6500LOAD;                                        28215009
    IF B6500 THEN                                                       28215010
         BEGIN                                                          28215020
         BCL:=XX&(GETSPACE(327,0,1)+2)[CTC];                            28215030
    CCT:=12;I:=0;MOVE(327,BCL.[CF]-1,BCL);                              28215032
         DO UNTIL UNSCREW;                                              28215040
         FORGETSPACE(XX);FORGETSPACE(BCL);                              28215044
         M[T-1]:=I;X[I-2]:=@14;                                         28215050
         END;                                                           28215060
    IF DSED THEN ABORT;                                                 28216000
    IF (N:=M[T-1]) LSS 900 THEN                                         28217000
    BEGIN % GET RID OF EXTRA MEMORY SPACE IF NOT NEEDED                 28218000
         X:=[M[SPACE(N)]]&N[8:38:10];                                   28219000
         MOVE(N,T,X);                                                   28220000
         FORGETSPACE(T);                                                28221000
    END;                                                                28222000
FINDFILENAMES:                                                          28223000
    FOR I:=2 STEP 2 UNTIL 26 DO                                         28224000
    BEGIN                                                               28225000
         J:=-2;                                                         28226000
         IF (FN~S[I])=@14 THEN GO LOADEM;                               28227000
         SN~S[I+1];W~1;                                                 28228000
         WHILE X[J~J+2]!@14 DO % MARK FILES TO BE LOADED                28229000
              IF FN<0 OR (FN EQV X[J])=NOT 0 THEN                       28230000
              IF SN<0 OR (SN EQV X[J+1])=NOT 0 THEN W~X[J]~-X[J];       28231000
         IF W>0 THEN LBMESS(IF FN<0 THEN "     .=" ELSE -FN,            28232000
              IF SN<0 THEN "=      " ELSE SN,"NOT LOA","DED(NOT",       28233000
              " ON TAP","E),",TINU[U]);                                 28234000
    END;                                                                28235000
    IF S[28]=@14 THEN GO LOADEM;                                        28236000
    GETASEGMENT;                                                        28237000
    GO FINDFILENAMES;                                                   28238000
LOADEM:                                                                 28239000
    W~J~-2;                                                             28240000
    WHILE X[J~J+2]!@14 DO IF X[J].[1:1] THEN W~J;                       28241000
    IF W<0 THEN ABORT;                                                  28241100
    X[W+2]~@14;                                                         28242000
    IF TYPE=ADDV THEN                                                   28243000
    FOR W~W STEP -2 UNTIL 0 DO                                          28244000
    IF X[W].[1:1] THEN                                                  28245000
    IF DIRECTORYSEARCH(X[W],X[W+1],5)!0 THEN X[W]:=@14 ELSE             28246000
         W:=0 ELSE X[W]:=0;                                             28247000
    IF @40=WAITIO(LAB INX @120540000000,@40,U) THEN                     28248000
    P(WAITIO(LAB INX @120540000000,0,U),DEL);                           28248100
    IF ((NOT B6500) AND (NFLAG(LAB[1])EQV MID)!NOT 0 OR                 28248200
        (NFLAG(LAB[2]) EQV FID)!NOT 0)                                  28248210
$ INCLUDE 28248311,IF B6500LOAD;                                        28248299
    AND ((NFLAG(LAB[0]).[24:24] EQV "FILE")!NOT 0 AND                   28248300
         (NFLAG(LAB[1]).[1:17] EQV FID.[30:18])!NOT 0)                  28248310
    THEN BEGIN STREAM(A:=[TINU[U]],J:=J:=SPACE(10));                    28248400
         BEGIN SI ~ A; SI ~ SI+5; DS ~ LIT"."; DS ~ 3 CHR;              28248500
               DS ~ 29 LIT " BAD FILE000 ON LIBRARY TAPE~";             28248600
         END;      SPOUT (J); ABORT;                                    28248700
    END;                                                                28248800
    J:=0;                                                               28249000
    H:=[M[SPACE(31+6|B6500)]]&36[8:38:10];                              28250000
    AROW:=[M[SPACE(2)]]&2[8:38:10];                                     28251000
    AROW[0]:=[M[SPACE(902)]]&901[8:38:10];                              28252000
    AROW[1]:=AROW[0]&SPACE(902)[CTC];                                   28253000
    IOD:=[M[SPACE(2)]]&2[8:38:10];                                      28254000
$ INCLUDE 28254201,IF B6500LOAD;                                        28254099
    IF B6500 THEN BEGIN P(WAITIO(SPACER,MM,U),DEL);                     28254100
                        P(WAITIO(SPACER,MM,U),DEL) END;                 28254200
    DO                                                                  28255000
    BEGIN                                                               28256000
         IF LABELCHECK THEN ABORT;                                      28257000
         P(WAITIO((*[AROW[0]])&@5400[CTF],0,U),DEL); % READ FILE HEADER 28258000
         MOVE(30+5|B6500,AROW[0].[CF]+B6500,H);                         28258100
$ INCLUDE 28258151,IF B6500LOAD;                                        28258149
         IF B6500 THEN FIXHDR;                                          28258150
         IF DSED THEN ABORT;                                            28259000
         T~-1;                                                          28260000
         IF M[AROW[0] INX NOT 0]!(30+6|B6500) THEN                      28260150
         BEGIN                                                          28260200
              LBMESS(-X[J],X[J+1],"NOT ","LOADED(","BAD HEA","DER).",   28260300
                     TINU[U]);                                          28260400
              H[2] ~ LAB[2];                                            28260500
              SPACIT;                                                   28260600
              IF H[2]!LAB[2] THEN ABORT; % FOR WE ARE LOST              28260700
              GO TO ENDLOOP;                                            28260800
         END ELSE                                                       28260900
         IF X[J].[1:1] THEN                                             28261000
         IF (T~DIRECTORYSEARCH(X[J]&(3+4|(TYPE=ADDV))[1:45:3],X[J+1],   28262000
               4+(TYPE=ADDV)))!0 THEN                                   28263000
         IF T LSS 0 THEN                                                28264000
              LBMESS(X[J],X[J+1],"NOT ","LOADED(","SYSTEM ","FILE),",   28265000
                   TINU[U]) ELSE                                        28266000
         BEGIN                                                          28267000
              LOADING:=9;                                               28268000
              IF DSED THEN ABORT;                                       28269000
              IF TYPE!ADDV THEN                                         28269500
              IF M[T+2]!0 THEN                                          28270000
              IF (USERCODE[P1MIX] EQV ABS(MCP))!NOT 0 THEN              28271000
             IF (USERCODE[P1MIX] EQV ABS(M[T+2])) NEQ NOT 0 THEN %      28272000
              BEGIN                                                     28273000
                   HEADERUNLOCK(ABS(X[J]),X[J+1],T);                    28274000
                   T:= -1;                                              28275000
                   LBMESS(X[J],X[J+1],"NOT ","LOADED(","INVALID",       28276000
                        " USER),",TINU[U]);                             28277000
              END;                                                      28278000
         END ELSE                                                       28279000
         IF T.[1:1] THEN%IT WAS "QT-ED"                                 28280000
         BEGIN                                                          28281000
             T:=-1;                                                     28282000
             LBMESS(X[J],X[J+1],"NOT ","LOADED(","IN USE",              28283000
                   "),",TINU[U]);                                       28284000
         END;                                                           28285000
         IF T=0 OR (T>0 AND TYPE!ADDV) THEN                             28286000
         BEGIN                                                          28287000
              IF T!0 THEN                                               28288000
              IF M[T+8]!H[8] THEN                                       28289000
              BEGIN                                                     28290000
                   FORGETSPACE(T);                                      28291000
                   P(DIRECTORYSEARCH(X[J],X[J+1],6),DEL);               28292000
                   T~0;                                                 28293000
              END;                                                      28294000
              IF T=0 THEN                                               28295000
              BEGIN                                                     28296000
                   T:=GETSPACE(30,0,1)+2;%FIXES POSSIBLE PROBLEM        28297000
                   MOVE(30,T-1,T);                                      28298000
                   M[T+4]~-0&SYSNO[4:46:2]&1[2:47:1];                   28299000
                   ENTERUSERFILE(ABS(X[J]),X[J+1],T-1);                 28300000
                   EADD~DIRECTORYFREE.[33:14];                          28301000
              END ELSE                                                  28302000
              EADD~T.[18:15];                                           28303000
              LBL ~ [M[T]] & 30[8:38:10];                               28304000
              IF (LBL[9]~(*P(DUP)) AND 31)=0 THEN                       28305000
              BEGIN                                                     28305100
                   FOR W~10 STEP 1 UNTIL 29 DO LBL[W] ~ 0;              28305200
                   LBL[7] ~ -1;                                         28305300
              END;                                                      28305400
              W ~ 0;                                                    28305500
              WHILE (W~W+1){H[9] DO                                     28307000
                   IF H[9+W]!0 THEN                                     28308000
               IF (H[9+W]:=LBL[9+W]) LEQ 0 THEN                         28309000
OK:                IF (H[9+W]~PETUSERDISK(-H[8] OR M,COMMON))<1 THEN    28310000
                   BEGIN                                                28311000
WY:                     LBMESS(-X[J],X[J+1],".#NO US","ER DISK"," ",    28311200
                               0,TINU[U]);                              28311300
                        REPLY[P1MIX] ~ -@04101220;                      28311400
                        COMPLEXSLEEP(REPLY[P1MIX]}0 OR DSED             28311500
                                     OR PRT[P1MIX,@25]=5);              28311600
                        IF NOT WHYSLEEP(@4101220) THEN GO TO WY;        28311700
                        IF REPLY[P1MIX]=4 THEN GO TO OK;                28311800
                        IF DSED THEN ABORT;                             28311900
                        IF  REPLY[P1MIX]=8 THEN                         28311910
                        BEGIN COMMON ~ COMMON AND NOT M; GO TO OK; END; 28311920
                        PRT[P1MIX,@25] ~ 0;                             28311930
                        P(DIRECTORYSEARCH(X[J],X[J+1],                  28312000
                             14-8|(LBL[9]=0)),DEL);                     28313000
                        FOR W:=W STEP -1 UNTIL 1 DO                     28314000
                             IF H[9+W]!0 THEN                           28315000
                             IF LBL[9+W]=0 THEN                         28316000
                                  FORGETUSERDISK(H[9+W],H[8]);          28317000
                        FORGETSPACE(T);                                 28318000
                        LBMESS(-X[J],X[J+1],"NOT LOA","DED(NO",         28319000
                             " USER ","DISK),",TINU[U]);                28320000
                        IF X[J+2]!@14 THEN SPACIT;                      28321000
                        GO TO ENDLOOP;                                  28322000
                   END;                                                 28323000
              FOR W:=LBL[9] STEP -1 UNTIL 1 DO                          28324000
                   IF H[9+W]=0 THEN                                     28325000
                   IF  LBL[9+W]!0 THEN FORGETUSERDISK(LBL[9+W],LBL[8]); 28326000
              STREAM(A~[H[1]],D~DATE);                                  28328000
              BEGIN SI~LOC D;DI~LOC D;DS~8 OCT;                         28329000
                   SI~SI-4;DI~A;DS~4 CHR;                               28330000
              END;                                                      28331000
              H[4]~M[T+4]&H[4][9:9:2]&0[11:47:1]&H[4][36:36:6];         28332000
              FORGETSPACE(T);                                           28332500
              H[1].[25:23]~XCLOCK+P(RTR);                               28333000
              DISKWAIT(H INX 0,30,EADD);                                28334000
              LOADING:=TRUE;                                            28335000
              FOR K~1 STEP 1 UNTIL H[9] DO                              28336000
                   IF H[K+9]!0 THEN % ROW IS ASSIGNED                   28337000
                   IF LOADAROW THEN % THERE WAS AN ERROR                28338000
                   BEGIN                                                28339000
                        COMPLEXSLEEP((((IOD[0] AND IOD[1]) AND IOMASK)!028339100
                                      ) OR DSED);                       28339200
                        IF NOT UNIT[U].[16:1] THEN BLASTQ(U);           28340000
                        P(WAITIO(@004740000020,@377,U),DEL);            28340100
                        LOADING:=FALSE;                                 28341000
                        P(DIRECTORYSEARCH(X[J],X[J+1],6),DEL);          28342000
                        IF X[J+2]!@14 THEN SPACIT;                      28343000
                        GO ENDLOOP;                                     28344000
                   END ELSE CHECKFORSWAP;                               28345000
              P(DIRECTORYSEARCH(X[J],X[J+1],14),DEL);                   28346000
              BB ~ TRUE; % MARK THAT A FILE HAS BEEN LOADED             28346100
              IF LIBMSG THEN LBMESS(ABS(X[J]),X[J+1],"LOADED,",0,0,0,   28347000
                   TINU[U]);                                            28348000
              LOADING:=FALSE;                                           28349000
              GO FALLOUT;                                               28350000
         END;                                                           28351000
         IF X[J+2]=@14 THEN GO ENDLOOP ELSE                             28352000
         FOR K~1 STEP 1 UNTIL H[9] DO                                   28353000
         IF H[K+9]!0 THEN                                               28354000
         BEGIN                                                          28355000
              CHECKFORSWAP;                                             28356000
              W:=SIZE:=LOADING:=0;                                      28357000
              IC:=1;                                                    28358000
              IO; % READ HEADER                                         28359000
              W:=1;                                                     28360000
              FOR N1~H[8] DIV 30 + ((H[8] MOD 30)!0) STEP -1 UNTIL 2 DO 28361000
              BEGIN  %   SPACE OVER FILE                                28362000
                   IO;                                                  28363000
LAY:               M[P(..LIBRARYLOAD)].[CF]~ALPHA;                      28364000
                   COMPLEXSLEEP(((IOD[0] OR IOD[1]) AND IOMASK)!0       28364500
                   OR DSED);                                            28365000
                   IF DSED THEN ABORT;                                  28366000
                   W~((IOD[1] AND IOMASK)!0);                           28367000
                   IF IOD[W].[27:2]!0 THEN                              28368000
                   IF IOD[W].[27:1] THEN %  END OF REEL                 28369000
                   BEGIN                                                28370000
                        IF NOT ENDOFREEL THEN                           28371000
                        BEGIN                                           28371100
                             TERMINATE(P1MIX&19[CTF]);                  28371200
                             ABORT;                                     28371300
                        END;                                            28371400
                        IO;                                             28372000
                        W:=1-W;                                         28373000
                        IF (IOD[W] AND IOMASK)=0 OR IOD[W].[27:1] THEN  28374000
                             N1:=N1+1;                                  28375000
                   END ELSE      %       PARITY ERROR                   28376000
                   BEGIN                                                28377000
                        SPACIT;                                         28378000
                        GO ENDLOOP;                                     28379000
                   END;                                                 28380000
              END;                                                      28381000
              IF N1}0 THEN  %         WAIT FOR LAST READ TO FINISH      28382000
              BEGIN                                                     28383000
                   N1:=(-1);                                            28384000
                   IOD[W]:=0;                                           28385000
                   GO LAY;                                              28386000
              END;                                                      28387000
         END;                                                           28388000
FALLOUT: P(WAITIO(SPACER,@40,U),DEL); IF ENDOFREEL THEN GO FALLOUT;     28389000
ENDLOOP: LOADING:=FALSE;                                                28390000
         IF DSED THEN ABORT;                                            28391000
    END UNTIL X[J:=J+2]=@14;                                            28392000
    IF NOT BB THEN                                                      28392200
    BEGIN                                                               28392300
         STREAM(BB~BB~GETSPACE(5,0,0)+2);                               28392400
         BEGIN DS~18LIT"NULL LIBRARY LOAD~"; END;                       28392500
         SPOUT (BB);                                                    28392600
    END;                                                                28392700
    STOPTIMING(0,1023);                                                 28393000
    STOPTIMING(5,1023);                                                 28394000
    SETNOTINUSE(U,0);                                                   28395000
         IF UNITNO!0 AND LABELTABLE[UNITNO]=@214 THEN                   28396000
              LABELTABLE [UNITNO]~@114;                                 28397000
         GO INITIATE;                                                   28398000
END; % OF LIBRARY LOAD PROCEDURE                                        28399000
PROCEDURE LIBRARYDUMP;                                                  28400000
BEGIN REAL ALPHA;                                                       28401000
    REAL COMMON=-4;                                                     28402000
    REAL I,J,T,U,UNITNO,DUMPING,W,Y,TM,REEL,IC,N,N1,LAST,N2;            28403000
    REAL Q,MID,FID,MAX,EXP,GTRMAX,K,K1,SEG,MIDCTR,SIZE,TYPE;            28404000
    ARRAY X[*],S[*],AROW[*],H[*],IOD[*],LBL[*];                         28405000
    DEFINE DSED=(TERMSET(P1MIX))#;                                      28406000
    LABEL LOOP,WATE,GETONE,NEXTNAME,GETMORE,WRITIT,EXIT,PARERR;         28407000
    %*******************************************************            28408000
    SUBROUTINE GETASEGMENT;                                             28409000
    BEGIN                                                               28410000
         SEG:=S[29];                                                    28411000
         DISKWAIT(-S.[CF],30,SEG);                                      28412000
         FORGETESPDISK(SEG);                                            28413000
         I:=2;                                                          28414000
    END; % OF GETASEGMENT                                               28415000
    %*******************************************************            28416000
    SUBROUTINE CHECKFORSWAP;                                            28417000
    BEGIN                                                               28418000
         IF (T:=PRTROW[P1MIX].[PSF])!0 THEN                             28419000
         BEGIN                                                          28420000
              IF T=2 THEN                                               28421000
              BEGIN                                                     28422000
                   IOCOUNT[P1MIX]:=-1;                                  28423000
                   STOPM;                                               28424000
              END ELSE                                                  28425000
              IF T!1 THEN SWAP(FORCESWAP,1);                            28426000
         END;                                                           28427000
         IF ELAPSEDLIMIT[P1MIX] GTR IOTIME[P1MIX] THEN                  28428000
         IF PROCLIMIT[P1MIX]>PROCTIME[P1MIX]+CLOCK+P(RTR) THEN GO EXIT; 28429000
         FOR T:=SC[P1MIX] STEP 1 UNTIL LC[P1MIX] DO                     28430000
         IF ACTIVE[T]>1 THEN                                            28431000
         BEGIN                                                          28432000
              IOCOUNT[P1MIX]:=-1;                                       28433000
              SWAP(TIMEND,1);                                           28434000
              ELAPSEDLIMIT[P1MIX]:=*P(DUP)+128;                         28435000
              PROCLIMIT[P1MIX]:=*P(DUP)+64;                             28436000
              GO TO EXIT;                                               28437000
         END;                                                           28438000
EXIT:                                                                   28439000
    END; % OF CHECKFORSWAP                                              28440000
    %*******************************************************            28441000
    SUBROUTINE ABORT;                                                   28442000
    BEGIN                                                               28442500
         IF DUMPING THEN J:=J-2 ELSE                                    28443000
         BEGIN X[J]:=@14;                                               28443500
              J:=-2;                                                    28444000
         END;                                                           28444500
         WHILE X[J:=J+2]!@14 AND J LSS 1022 DO                          28445000
              P(DIRECTORYSEARCH(-X[J],X[J+1],13),DEL);                  28446000
         IF U GEQ 0 THEN                                                28447000
         BEGIN                                                          28448000
              STOPTIMING(0,1023);                                       28449000
              STOPTIMING(5,1023);                                       28450000
              IF NOT UNIT[U].[16:1] THEN BLASTQ(U);                     28451000
              SETNOTINUSE(U,0);                                         28452000
         END;                                                           28453000
         WHILE S[29]!0 DO GETASEGMENT;                                  28454000
         IF UNITNO!0 AND LABELTABLE[UNITNO]=@214 THEN                   28455000
             LABELTABLE[UNITNO]:=@114;                                  28456000
         GO TO INITIATE;                                                28457000
    END; % OF ABORT                                                     28458000
    %********************************************************           28459000
    SUBROUTINE WRITENDINGLABEL;                                         28460000
    BEGIN                                                               28461000
         P(WAITIO([TM],@40,U),DEL);                                     28462000
         IF DSED THEN ABORT;                                            28463000
         P(WAITIO(LBL&@5000[CTF],@40,U),DEL);                           28464000
         IF DSED THEN ABORT;                                            28465000
    END; % OF WRITE ENDING LABEL                                        28466000
    %*******************************************************            28467000
    SUBROUTINE CHECK;                                                   28468000
    BEGIN                                                               28469000
         IF (Y:=IOD[W]).[27:2]!0 THEN % PARITY ERROR OR EOT             28470000
         BEGIN                                                          28471000
              IF Y.[7:1] AND Y.[27:1] THEN % END OF TAPE                28472000
              BEGIN                                                     28473000
                   IF IOD[1-W].[7:1] THEN                               28474000
                   BEGIN                                                28475000
                        SLEEP([IOD[1-W]],IOMASK);                       28476000
                        IF IOD[1-W].[28:1] THEN GO PARERR;              28477000
                        IOD[1-W].[27:1]:=0;                             28478000
                   END;                                                 28479000
                   LBL[4]:=(*P(DUP)) OR 1;                              28480000
                   P(WAITIO([TM],@40,U),DEL);                           28481000
                   P(WAITIO(LBL&@5000[CTF],@40,U),DEL);                 28482000
                   P(WAITIO([TM],@40,U),DEL);                           28483000
                   SETNOTINUSE(U,1);                                    28484000
                   STOPTIMING(5,1023);                                  28485000
                   LBL[4]:=(*P(DUP)) AND NOT(1);                        28486000
                   STREAM(REEL:=REEL:=REEL+1,LBL);                      28487000
                   BEGIN SI:=LOC REEL;                                  28488000
                        DI:=DI+24; DS:=3 DEC;                           28489000
                   END;                                                 28490000
                   IF (U:=LABELASCRATCH(LBL)) LSS 0 THEN ABORT;         28491000
                   STARTIMING(5,U);                                     28492000
              END ELSE % PARITY ERROR                                   28493000
PARERR:       BEGIN                                                     28494000
                   LBMESS(-X[J],X[J+1],"NOT ","DUMPED(",                28495000
                        IF Y.[7:1] THEN "TAPE PA" ELSE "DISK PA",       28496000
                        "RITY),",TINU[U]);                              28497000
                   TERMINATE(P1MIX&70[CTF]);                            28498000
                   ABORT;                                               28499000
              END;                                                      28500000
         END;                                                           28501000
    END; % OF SUBROUTINE CHECK                                          28502000
    %*******************************************************            28503000
    SUBROUTINE IO;                                                      28504000
    BEGIN                                                               28505000
         IF IC THEN                                                     28506000
              IOREQUEST(-(IOD[W]:=(AROW[W] INX @500000000)&             28507000
                   SIZE[8:38:10]&TINU[U][3:3:5]) OR @2017700000,        28508000
                   IOD[W],[IOD[W]]&U[12:42:6])                          28509000
         ELSE                                                           28510000
         BEGIN                                                          28511000
              DISKIO(IOD[W],-(AROW[W] INX 0-1),(T~IF (T~LAST-Q-N+1) LSS 28512000
                   30 THEN 30|T ELSE 900),Q+N);                         28513000
              N:=N+30;                                                  28514000
$INCLUDE 28514101, IF STATISTICS;                                       28514099
         COUNTUP(18,T DIV 30);                                          28514100
         END;                                                           28515000
    END; % OF IO                                                        28516000
    %*******************************************************            28517000
    SUBROUTINE DUMPAROW;                                                28518000
    BEGIN                                                               28519000
         N1 ~ H[8]; SIZE ~ 900;%                                        28520000
         LAST~(Q~H[K+9])+H[8]-1;%                                       28521000
         IOD[1]:=N2:=W:=N:=IC:=0;                                       28522000
         IO; % FIRE UP FIRST DISK READ                                  28523000
         W ~1;% SWAP BUFFERS                                            28524000
         IF N<N1 THEN% CANNOT DO ROW WITH ONE READ                      28525000
LOOP:    IO;                                                            28526000
WATE:    M[P(..LIBRARYDUMP)].[CF]~ALPHA;                                28527000
         COMPLEXSLEEP((((IOD[0] OR IOD[1]) AND IOMASK)!0) OR DSED);     28527500
         IF DSED THEN ABORT;                                            28528000
         N2~N2+15;% COUNT NUMBER OF OPERATIONS COMPLETED                28529000
         W~IF (IOD[0] AND IOD[1] AND IOMASK)!0 THEN 1-W ELSE            28530000
              ((IOD[1] AND IOMASK)!0);                                  28531000
         CHECK; % FOR PARITY OR END OF TAPE                             28532000
         IC~1-IOD[W].[7:1];% SWAP UNITS                                 28533000
         IF N<N1 THEN GO TO LOOP;% ROW IS NOT FINISHED                  28534000
         IF N2+30}N THEN SIZE~T; % CHANGE SIZE FOR LAST RECORD          28535000
         IF IOD[W].[24:1] THEN GO TO LOOP;% MORE WRITING TO DO          28536000
         IF N2<N THEN BEGIN IOD[W]~0; GO TO WATE END;%                  28537000
    END; % OF DUMPAROW                                                  28538000
    %*******************************************************            28539000
    ALPHA~(*P(..LIBRARYDUMP)).[CF];                                     28539500
    S:=[M[SPACE(30)]]&30[8:38:10];                                      28540000
    TYPE:=COMMON.[FF];                                                  28541000
    S[29]:=COMMON.[CF];                                                 28542000
    GETASEGMENT;                                                        28543000
    STREAM(MID:=MID:=S[1],B:=PRT[P1MIX,3]);                             28544000
    BEGIN DS:=16 LIT"0DIRCTRY0DISK   ";DS:=25 LIT"0";SI:=LOC MID;       28545000
         SI:=SI+1;DS:=7 CHR;DS:=8 LIT"0FILE000";DS:=24 LIT"0";          28546000
    END;                                                                28547000
    UNITNO:=S[0].[2:6];                                                 28548000
    X:=[M[SPACE(1023)]]&1023[8:38:10];                                  28549000
    MAX~S[0].[CF];                                                      28550000
    EXP:=S[0].[8:2];                                                    28551000
    GTRMAX~S[0]<0;                                                      28552000
    X[0]:=@14;                                                          28553000
    MOVE(1022,X,[X[1]]);                                                28554000
    U:=-1;                                                              28554500
GETONE:                                                                 28555000
    IF DSED THEN ABORT;                                                 28555500
    IF I>26 THEN GETASEGMENT;                                           28556000
    IF (S[I] OR S[I+1])<0 THEN SEEKNAM(S[I],S[I+1],W,X[J],X[J+1],Y) ELSE28557000
    BEGIN                                                               28558000
         X[J]:=S[I];                                                    28559000
         X[J+1]:=S[I+1];                                                28560000
         W:=1;                                                          28561000
    END;                                                                28562000
    IF W!0 THEN                                                         28563000
    BEGIN                                                               28564000
         T~0;                                                           28565000
         K~I;                                                           28566000
         FOR N~J-2 STEP-2 UNTIL 0 DO                                    28567000
              IF (X[J] EQV X[N])=NOT 0 THEN                             28568000
              IF (X[J+1] EQV X[N+1])=NOT 0 THEN GO TO NEXTNAME;         28569000
         IF GTRMAX THEN                                                 28569200
         BEGIN                                                          28569300
              J:=J+2;                                                   28569400
              GO TO NEXTNAME;                                           28569500
         END ELSE                                                       28569600
         IF NOT SYSTEMFILE(X[J],X[J+1]) THEN                            28570000
         IF (T:=DIRECTORYSEARCH(X[J]&1[3:47:1],X[J+1] OR M,3))=0 THEN   28571000
         BEGIN                                                          28572000
              IF DSED THEN ABORT;                                       28573000
              IF T.[1:1] THEN LBMESS(-X[J],X[J+1],"NOT DUM","PED(",     28574000
                   "IN USE)",0,0) ELSE                                  28575000
                   K:=0;                                                28576000
              GO TO NEXTNAME;                                           28577000
         END;                                                           28578000
         IF T GTR 0 THEN                                                28579000
         BEGIN                                                          28580000
              IF M[T+2]!0 THEN                                          28581000
              IF (USERCODE[P1MIX] EQV ABS(MCP))!NOT 0 THEN              28582000
             IF (USERCODE[P1MIX] EQV ABS(M[T+2])) NEQ NOT 0 THEN %      28583000
              BEGIN                                                     28584000
                   P(DIRECTORYSEARCH(-X[J],X[J+1],13),DEL);             28585000
                   LBMESS(-X[J],X[J+1],"NOT ","DUMPED(",                28586000
                        "INVALID"," USER)",0);                          28587000
                   GO TO NEXTNAME;                                      28588000
              END;                                                      28589000
              IF EXP NEQ 0 THEN                                         28590000
              BEGIN                                                     28591000
                   IF EXP THEN                                          28592000
                   BEGIN                                                28593000
                        STREAM(T:=0:A:=CALCULATEPURGE(-M[T+3].[2:10])); 28594000
                        BEGIN SI:=LOC A;DI:=LOC T;DS:=8 OCT END;        28595000
                        IF P GTR M[T+3].[12:18] THEN J:=J+2 ELSE        28596000
                        P(DIRECTORYSEARCH(-X[J],X[J+1],13),DEL);        28597000
                   END ELSE                                             28598000
                   BEGIN                                                28599000
                        IF M[T+4].[11:1] THEN J:=J+2 ELSE               28600000
                        P(DIRECTORYSEARCH(-X[J],X[J+1],13),DEL);        28601000
                   END;                                                 28602000
              END ELSE J:=J+2;                                          28603000
              GO TO NEXTNAME;                                           28604000
         END;                                                           28605000
         LBMESS(-X[J],X[J+1],"NOT ","DUMPED","(SYSTEM"," FILE)",0);     28606000
NEXTNAME:                                                               28607000
         IF (S[I] OR S[I+1])<0 THEN I~I-2 ELSE W~0;                     28608000
         IF T GTR 0 THEN FORGETSPACE(T);                                28609000
    END;                                                                28610000
    IF K<I THEN LBMESS(IF S[I]<0 THEN "     .=" ELSE -S[I],             28611000
         IF S[I+1]<0 THEN "=      " ELSE S[I+1],"NOT DUM","PED(NOT",    28612000
         " ON DIS","K)",0);                                             28613000
    IF S[I~I+2]!@14 THEN                                                28614000
    IF J<(2|MAX) OR GTRMAX THEN GO GETONE ELSE                          28615000
    BEGIN                                                               28616000
         LBL:=[M[SPACE(30)]]&30[8:38:10];                               28617000
         J~-2;                                                          28618000
         LBL[0]:=-MAX;                                                  28619000
         LBL[1]~MID;                                                    28620000
         LBL[28]~0;                                                     28621000
         STREAM(A~MIDCTR:ONE~1,MID~[MID]);                              28622000
         BEGIN SI~LOC A;SI~SI+7;IF SC="0" THEN                          28623000
              BEGIN TALLY~2;SI~MID;SI~SI+2;5(IF SC=" " THEN JUMP OUT;   28624000
                   SI~SI+1;TALLY~TALLY+1);A~TALLY;DI~DI+A;DS~LIT"1";    28625000
              END ELSE BEGIN DI~DI+A;SI~SI+16;DS~ADD;END;               28626000
         END;                                                           28627000
         MIDCTR~P;                                                      28628000
         COMMON~SEG~GETESPDISK;                                         28629000
         COMMON.[FF]:=TYPE;                                             28630000
GETMORE:                                                                28631000
         FOR K~2 STEP 2 UNTIL 26 DO                                     28632000
                                                                        28633000
         BEGIN                                                          28634000
              LBL[K]~X[J~J+2];                                          28635000
              IF LBL[K]=@14 THEN GO WRITIT;                             28636000
              LBL[K+1]~X[J+1];                                          28637000
                                                                        28638000
         END;                                                           28639000
WRITIT:                                                                 28640000
         LBL[29]~IF K! 28 THEN 0 ELSE GETESPDISK;                       28641000
         DISKWAIT(LBL INX 0,30,SEG);                                    28642000
         IF K=28 THEN                                                   28643000
         BEGIN                                                          28644000
              SEG~LBL[29];                                              28645000
              GO GETMORE;                                               28646000
         END;                                                           28647000
         FORGETSPACE(LBL);                                              28648000
         LBMESS("LIBMAIN","DISK   ","AUTO-","ZIPPED",0,0,0);            28649000
         M[(T:=GETSPACE(12,64,0)+4)-4].[9:6]:=0;                        28650000
         IF (J~USERCODE[P1MIX])=ABS(NOT 0) THEN                         28651000
         BEGIN                                                          28652000
              J~0;                                                      28653000
              K~31;                                                     28654000
         END ELSE K~26;                                                 28655000
         STREAM(J,COMMON,T);                                            28656000
         BEGIN                                                          28657000
              DS~8 LIT"CC USER=";SI~LOC J;SI~SI+1;DS~7 CHR;             28658000
              DS~29 LIT";EXECUTE LIBMAIN/DISK;COMMON=";                 28659000
              DS~8 DEC;DS~6 LIT";END. ";                                28660000
         END;                                                           28661000
         CCARD(T&K[3:43:5]);                                            28662000
         J~T~0;                                                         28663000
         GO GETONE;                                                     28664000
    END;                                                                28665000
    X[J]~@14; %    MARK END OF DIRECTORY                                28666000
    IF J=0 THEN                                                         28667000
    BEGIN                                                               28668000
         STREAM(MID,D:=I:=SPACE(10));                                   28669000
         BEGIN DS:=14 LIT"-NULL LIBRARY ";SI:=LOC MID;                  28670000
              SI:=SI+1;DS:=7 CHR; DS:=LIT"~";                           28671000
         END;                                                           28672000
         SPOUT(I);                                                      28673000
         GO TO INITIATE;                                                28674000
    END;                                                                28675000
    TM~0&"}~"[1:37:11];%                                                28676000
    IF J LSS 900 THEN                                                   28677000
    BEGIN                                                               28678000
         T:=SPACE(J+1);                                                 28679000
         MOVE(J+1,X,T);                                                 28680000
         FORGETSPACE(X);                                                28681000
         X:=[M[T]]&(J+1)[8:38:10];                                      28682000
    END;                                                                28683000
    REEL:=1;                                                            28684000
    LBL:=[M[TAPELABEL(MID,FID:="FILE000",1,1,100)]]&10[8:38:10];        28685000
    IF (U:=LABELASCRATCH(LBL)) LSS 0 THEN ABORT;                        28686000
    STARTIMING(0,18);                                                   28687000
    STARTIMING(5,U);                                                    28688000
    P(WAITIO(X&(J+1)[8:38:10]&@5000[CTF],@40,U),DEL);                   28689000
    WRITENDINGLABEL;                                                    28690000
    AROW:=[M[SPACE(2)]]&2[8:38:10];                                     28691000
    AROW[0]:=[M[SPACE(900)]]&900[8:38:10];                              28692000
    AROW[1]:=[M[SPACE(900)]]&900[8:38:10];                              28693000
    IOD:=[M[SPACE(2)]]&2[8:38:10];                                      28694000
    J:=-2;                                                              28695000
    DUMPING:=TRUE;                                                      28696000
    WHILE X[J~J+2]!@14 DO %                                             28697000
    BEGIN;                                                              28698000
         STREAM(A~(J+2) DIV 2,B~[LBL[2]]);                              28699000
         BEGIN SI:=LOC A;DI:=DI+5;DS:=3 DEC END;                        28700000
         LABELTABLE[U]~-LBL[2]; % ENTER FILE ID FOR OL MESSAGE          28701000
         H:=[M[DIRECTORYSEARCH(X[J],X[J+1],5)]]&30[8:38:10];            28702000
         H[9]:=(*P(DUP)) AND 31;                                        28702100
         P(WAITIO(LBL&@5000[CTF],@40,U),DEL);                           28703000
         IF DSED THEN ABORT;                                            28704000
         P(WAITIO([TM],@40,U),DEL);                                     28705000
         IF DSED THEN ABORT;                                            28706000
         P(WAITIO(H&@5000[CTF],@40,U),DEL);                             28707000
         IF DSED THEN ABORT;                                            28708000
         FOR K~1 STEP 1 UNTIL H[9] DO% WRITE OUT FILE, ROW BY ROW       28709000
         IF H[K+9]!0 THEN                                               28710000
         BEGIN                                                          28711000
              DUMPAROW;                                                 28712000
              CHECKFORSWAP;                                             28713000
         END;                                                           28714000
         FORGETSPACE(H);                                                28715000
         WRITENDINGLABEL;                                               28716000
         IF LIBMSG THEN LBMESS(X[J],X[J+1],"DUMPED,",0,0,0,TINU[U]);    28717000
         P(DIRECTORYSEARCH(-X[J],X[J+1],13),DEL);;                      28718000
    END; % ALL FILES NOW WRITTEN                                        28719000
    P(WAITIO([TM],@40,U),DEL);                                          28720000
    STOPTIMING(0,1023);                                                 28721000
    STOPTIMING(5,1023);%                                                28722000
    SETNOTINUSE(U,1);                                                   28723000
    IF TYPE=UNLOAD THEN                                                 28724000
         FOR J~0 STEP 2 WHILE X[J]!@14 DO                               28725000
              P(DIRECTORYSEARCH(-X[J],X[J+1],7),DEL);                   28726000
    IF UNITNO!0 AND LABELTABLE[UNITNO]=@214 THEN                        28727000
         LABELTABLE [UNITNO]~@114;                                      28728000
    GO INITIATE;                                                        28729000
END;  %  LIBRARY MAINT. PROCEDURE                                       28730000
 COMMENT  ERRORMESSER IS CALLED BY ERRORFIXER (IF OPTION 33 IS ON) TO   30900000
          TYPE OUT A PSEUDO-TERMINAL MESSAGE. IT DOES ABOUT THE SAME    30901000
          THING AS THE FIRST PART OF TERMINALMESSAGE;                   30902000
 PROCEDURE ERRORMESSER(TYPE); VALUE TYPE; REAL TYPE;                    30903000
    BEGIN INTEGER S,ADR,BF,SA,N;                                        30904000
          NAME SD;                                                      30905000
          LABEL L;                                                      30906000
          BF := SPACE(10);                                              30907000
          SD~PRT[P1MIX,4];                                              30908000
          NT1~SD[0];                                                    30909000
          ADR~M[PRT[P1MIX,8]].[CF];                                     30910000
          FOR S~1 STEP 1 UNTIL NT1 DO                                   30911000
              IF (SA~SD[S].[18:15])>1023 AND SA{ADR AND SD[S]>0 THEN    30912000
              IF M[SA-1].[18:15]+SA}ADR THEN GO L;                      30913000
          S~0;                                                          30914000
  L:      TERMINALMESSAGES;                                             30915000
          ADR~ADR-SA;                                                   30916000
          SD~[M[P(.TERMINALMESSAGES,LOD)]];                             30917000
          N~IF TYPE=1 THEN 11 ELSE IF TYPE=2 THEN 9 ELSE IF TYPE=4 THEN 30918000
                   7 ELSE IF TYPE=8 THEN 13 ELSE 5;                     30919000
          STREAM(M~[SD[N]],J~[JAR[P1MIX,0]],P1MIX,S,ADR,X~S!0,BF);      30920000
          BEGIN SI~M; SI~SI+2; DS~6 CHR; BF~DI; DI~LOC M; SI~SI+1;      30921000
                DI~DI+7; DS~CHR; DI~BF; DS~M CHR; DS~8 LIT" BRANCH ";   30922000
                SI~J; SI~SI+1; DS~7 CHR; DS~LIT"/";                     30923000
                SI~SI+1; DS~7CHR; DS~LIT"="; SI~LOC P1MIX;              30924000
                DS~2DEC; BF~DI; DI~DI-2; DS~FILL; DI~BF;                30924500
              X(DS~5 LIT", S ="; SI~LOC S; DS~4 DEC; DS~5 LIT", A =";   30925000
                   DS~4 DEC; BF~DI; DI~DI-4; DS~3 FILL;                 30926000
                   DI~BF; DI~DI-13; DS~3 FILL);                         30927000
                DI~BF; DS~ LIT"~";                                      30928000
          END;                                                          30929000
          SPOUT(BF);                                                    30930000
    END ERRORMESSER;                                                    30931000
 PROCEDURE ERRORFIXER(TYPE); VALUE TYPE; INTEGER TYPE;                  31000000
    COMMENT LOOKS FOR RUN-TIME-ERROR ACTION LABELS IN ALGOL PROGRAMS,   31001000
         AND HANDLES THEM, RETURNING ONLY IF NO LABEL GIVEN;            31002000
    BEGIN ARRAY AIT[*],PRTD[*];                                         31003000
          NAME        ADDR;                                             31004000
          REAL I, GOT, ADR=ADDR,LABLE;                                  31005000
          CHECKSTACKSPACE;                                              31005010
                        IF JAR[P1MIX,2].[3:1] THEN                      31005100
                        IF(PRT[P1MIX,@51]AND @20)!0 THEN                31005200
                        BEGIN M[PRT[P1MIX,8].[CF]-2]~@777777777777777;  31005300
                              PRT[P1MIX,@51].[45:2]~2;                  31005400
                        GO TO INITIATE;                                 31005500
                        END;                                            31005600
          IF JAR[P1MIX,2]}0 THEN%MUST BE ALGOL-TYPE                     31006000
         BEGIN PRTD~PRTROW[P1MIX];                                      31006100
               WHILE (AIT~PRTD     [AITNDX]).PBIT=0 DO                  31007000
                   MAKEPRESENT([PRTD     [AITNDX]] INX 0);              31008000
              I~AIT[0]+1;                                               31009000
              DO I~I-1 UNTIL((GOT~ (ADDR~AIT[I]).OWNBIT AND ( ADR.[CF]  31010000
                        =TYPE)) OR(I{1)); % LOOK FOR ENTRY              31011000
              IF GOT THEN % WILL REINITIATE THE GUY, SO SET HIM UP      31012000
              BEGIN IF (LABLE~M[ ADR.MOM])!0 THEN                       31013000
                   IF LABLE!15 THEN                                     31013050
                   IF LABLE.BLKCNTR{(PRTD[16]+(LABLE.MOM!0))THEN        31013100
                   BEGIN IF PRTD     [CURBLKCNTR]>LABLE.BLKCNTR THEN    31014000
                        BEGIN PRTD     [CURBLKCNTR]~LABLE.BLKCNTR+1;    31015000
                              ASR;                                      31016000
                        END; IF(ADDR~LABLE.MOM)=0 THEN                  31017000
                             LABLE.MOM~ADDR~PRTD[10].MOM+2;             31017100
                        ADDR~ADDR&ADR[33:33:15];                        31017200
                        IF OPTION.[33:1] THEN ERRORMESSER(TYPE);        31017210
                        IF PRTD[LABLE.[CF]].PBIT=0 THEN                 31017300
                             MAKEPRESENT([PRTD[LABLE.[CF]]].[CF]);      31017400
                        DO UNTIL(*(ADDR~HUNT(ADDR+1))).[1:3]=4;         31018000
                          ADDR    [1]~M[PRTD     [8] INX NOT 0];        31019000
                          ADDR    [2]~M[PRTD     [8]]&0[10:10:2]&       31020000
               (LABLE)[18:18:15]&PRTD     [(LABLE).[CF]][33:33:15];     31021000
                        PRTD     [8]~P(DUP,LOD)&(ADDR INX 2)[33:33:15]; 31022000
                        GO INITIATE;                                    31023000
         END; END; END;                                                 31024000
    END ERRORFIXER;                                                     31025000
 PROCEDURE SKIPFILE(U,D); VALUE U,D; REAL U,D;                          31100000
         BEGIN REAL T1,T2,IOD,K;                                        31101000
              NAME N;                                                   31102000
              LABEL L,EXIT;                                             31102100
              N := [T1];                                                31102200
              T2~IOMASK;                                                31102300
              IOD:=SPACE(2)&@1400[CTF]&TINU[U][3:3:5]&D[22:47:1];       31103000
         L:   IOREQUEST(NABS(IOD)&@377[25:40:8],IOD,[N]&U[12:42:6]);    31104000
              K := 1-K;                                                 31105000
              N[0] := 0;                                                31106000
              N := K INX [T1];                                          31107000
              WAITORSWAP(U,[N].[CF]);                                   31108000
              IF N[0].[27:1] THEN GO TO EXIT;                           31109000
              IF PRTROW[P1MIX].[PSF]  !  0 THEN                         31110000
              BEGIN IF (NT3:=PRTROW[P1MIX].[PSF])=1 THEN                31111000
                        TERMINALMESSAGE(PRTROW[P1MIX].[FF]);            31112000
                   IF NT3=2 THEN STOPM ELSE SWAP(FORCESWAP,1);          31113000
                   GO TO L;                                             31114000
              END;                                                      31115000
              IF MEMROW[P1MIX].[CF]<FENCE THEN GO TO L;                 31115100
              IF ELAPSEDLIMIT[P1MIX] GTR IOTIME[P1MIX]              %R5931116000
                   THEN GO TO L;                                    %R5931116100
              FOR NT3 := SC[P1MIX] STEP 1 UNTIL LC[P1MIX] DO            31117000
              IF ACTIVE[NT3] GTR 1 THEN                              %DS31118000
              BEGIN SWAP(TIMEND,1); GO TO L; END;                       31119000
              ELAPSEDLIMIT[P1MIX]:=*P(DUP)+64;                          31120000
              GO TO L;                                                  31121000
         EXIT:BLASTQ(U);                                                31122000
              FORGETSPACE(IOD);                                         31123000
         END;                                                           31124000
$INCLUDE 33614001, IF DCP;                                              32999999
PROCEDURE DCWRITE(ADR,STA,NUM,FLAGS);                                   33000000
VALUE ADR,STA,NUM,FLAGS;                                                33000500
REAL  ADR,STA,NUM,FLAGS;                                                33001000
BEGIN                                                                   33001500
    REAL CLASS,S,X,Y,Z;                                                 33002000
    BOOLEAN Q;                                                          33002500
    LABEL START;                                                        33003000
%                                                                       33003100
%   DCWRITE IS USED TO GENERATE OUTPUT REQUESTS. THE PAPRAMETERS ARE:   33003150
%     ADR     ADDRESS OF STUFF TO BE OUTPUT                             33003200
%     STA     STATION NUMBER                                            33003250
%     NUM     NUMBER OF CHARACTERS                                      33003300
%     FLAGS   IF 47:1=1 THIS OUTPUT IS THE LAST OF A SEG OF TANK        33003350
%   IF NUM IS GREATER THAN 136 (17|8), TWO REQUESTS ARE GENERATED.      33003400
%   IF THE REINITIALIZED BIT IS ON, DCWRITE SCANS FORWARD TO THE SPOT   33003450
%   POINTED TO BY THE NAK POINTER.                                      33003500
%                                                                       33003550
    IF (S:=STATABLE[STA]).[1:1] THEN P(XIT);     % PAPERTAPE            33004000
    IF S.REINITIALIZED THEN                                             33004500
    BEGIN STATABLE[STA]:=S&0[21:21:1];                                  33005000
         CLASS:=REINITIALIZEDOUTPUT;                                    33005500
         IF (X:=TNAOG[STA].[3:7])!0 THEN                                33006000
         STREAM(NM:=NUM:=NUM-X, N1:=NUM.[40:2], N:=X.[45:3],            33006500
              S:=ADR+X.[40:5], ADR);                                    33007000
         BEGIN SI:=S; SI:=SI+N;                                         33007500
              N1(DS:=32 CHR; DS:=32 CHR);                               33008000
              DS:=NM CHR;                                               33008500
         END;                                                           33009000
    END ELSE                                                            33009500
START:   CLASS:=OUTPUT;                                                 33010000
    X:=IF (Q:=NUM LEQ 136) THEN NUM ELSE 128;                           33010500
    M[(Z:=GETAREA(1+(X GTR 56)))+1]:=X;                                 33011000
    MOVE((X+7) DIV 8,ADR,Z+3);                                          33011500
    ADR:=ADR+16;                                                        33012000
    IF Q THEN M[Z]:=(*P(DUP))&FLAGS[4:47:1];                            33012500
    M[Z+1]:=(*P(DUP))&CLASS[1:41:7]&S[24:24:16];                        33013000
    TANKS[STA]:=(*P(DUP))&(P(DUP).DCPMESSAGES+1)[12:46:2];              33013500
    DCPQ(Z);                                                            33014000
    IF NOT Q THEN                                                       33014500
    BEGIN NUM:=NUM-128;                                                 33015000
         GO TO START;                                                   33015500
    END;                                                                33016000
END OF DCWRITE;                                                         33016500
REAL PROCEDURE OUTRAN(ADR,NUM,TYPE,B);                                  33017000
VALUE ADR,NUM,TYPE;                                                     33017500
REAL  ADR,NUM,TYPE,B;                                                   33018000
BEGIN                                                                   33018500
    REAL T,Q,MODE,ASCII,X,NOTEQ;                                        33019000
%                                                                       33019100
%   OUTRAN PERFORMS THE TASKS OF SCANNING OUT BLANKS, INSERTING         33019150
%   ! BEFORE CONTROL CHARACTERS AND INSERTING CARRIAGE RETURNS AND      33019200
%   LINE FEEDS. IT WORKS FOR SICASCII OR BCL.                           33019250
%                                                                       33019300
    T:=B:=SPACE(30)+1;                                                  33019500
    IF (ASCII:=TYPE.[1:1]) THEN MODE:=1 ELSE MODE:=T;                   33020000
    X:=TYPE.[2:1];                                                      33020500
    DO BEGIN                                                            33021000
         IF ASCII THEN                                                  33021500
         STREAM(Q:=0,ADR,N:=IF NUM GTR 63 THEN 63 ELSE NUM,MODE,NOTEQ:  33022000
                X,T);                                                   33022500
         BEGIN SI:=ADR;                                                 33023000
            N(IF SC="!" THEN                                            33023500
              BEGIN SI:=SI+1;                                           33024000
                   NOTEQ(TALLY:=0; JUMP OUT TO GOTOTEST);               33024500
                   IF SC="!" THEN                                       33025000
                   BEGIN TALLY:=1;                                      33025500
  GOTOTEST:             NOTEQ:=TALLY;                                   33026000
                        MODE(JUMP OUT TO L); SI:=SI-1; GO DSIT;         33026500
                   END;                                                 33027000
                   MODE(TALLY:=0; JUMP OUT TO LL); TALLY:=1;            33027500
        LL:        MODE:=TALLY; GO TO L;                                33028000
              END;                                                      33028500
              X(IF SC="~" THEN                                          33029000
                   BEGIN TALLY:=1; Q:=TALLY; JUMP OUT 2 TO EXIT END);   33029500
              MODE(IF SC="$" THEN                                       33030000
                   BEGIN TALLY:=3; Q:=TALLY; JUMP OUT 2 TO EXIT END;    33030500
                   DS:=LIT"!");                                         33031000
      DSIT:   DS:=CHR;                                                  33031500
         L: );                                                          33032000
      EXIT: ADR:=SI; N:=DI;                                             33032500
         END                                                            33033000
        ELSE                                                            33033500
         STREAM(Q:=0,ADR,N:=IF NUM GTR 63 THEN 63 ELSE NUM,MODE,X:T);   33034000
         BEGIN SI:=ADR;                                                 33034500
            N(IF SC=" " THEN DS:=CHR ELSE                               33035000
              BEGIN                                                     33035500
                 X(IF SC="~" THEN                                       33036000
                   BEGIN MODE:=DI;                                      33036500
                        TALLY:=1; Q:=TALLY;                             33037000
                        JUMP OUT 2 TO EXIT;                             33037500
                   END);                                                33038000
                   IF SC="!" THEN DS:=LIT"!";                           33038500
                   DS:=CHR;                                             33039000
                   MODE:=DI;                                            33039500
              END);                                                     33040000
    EXIT:    ADR:=SI; N:=DI;                                            33040500
         END;                                                           33041000
         NOTEQ:=P; MODE:=P; T:=P; ADR:=P;                               33041500
    END UNTIL (Q:=P) OR (NUM:=NUM-63) LEQ 0;                            33042000
    IF NOT ASCII THEN                                                   33042500
    BEGIN T:=MODE;                                                      33043000
         IF (TYPE.[18:30]!@100000)THEN                                  33043500
         BEGIN                                                          33044000
              STREAM(CR:=TYPE.[FF]-1:LF:=TYPE,T);                       33044500
              BEGIN                                                     33045000
                   CR(DS:=2 LIT"!-");                                   33045500
                   LF(DS:=2 LIT"!*");                                   33046000
                   CR:=DI;                                              33046500
              END;                                                      33047000
              T:=P;                                                     33047500
    END  END;                                                           33048000
    OUTRAN:=T.[30:3]&(T-B)[30:33:15]&Q[2:46:1];                         33048500
END OUTRAN FOR DCP;                                                     33049000
PROCEDURE PAPERTAPEIO(STA,H,MI,MI2);                                    33049500
VALUE STA,H,MI,MI2;                                                     33050000
REAL  STA,H,MI,MI2;                                                     33050500
BEGIN                                                                   33051000
    REAL T,T1,N,Q,X;                                                    33051500
%                                                                       33051600
%   PAPERTAPE INPUT IS PACKED WITH MORE THAN ONE MESSAGE TO A           33051620
%   SEGMENT, SUBJECT TO THE RESTRICTION THAT, IF A MESSAGE ENDS         33051640
%   IN A SEGMENT, ALL OTHER MESSAGES PACKED INTO THAT SEGMENT           33051660
%   MUST ALSO END WITHIN IT.                                            33051680
$VOID 33051721                                                          33051700
%   THE PAPRAMETERS ARE:                                                33051740
%     STA   STATION NUMBER                                              33051760
%     H     ADDRESS OF HARRYS BUFFER                                    33051780
%     MI    FIRST WORD OF HEADER (USED FOR EOM AND 224 CHARACTER FLAGS) 33051800
%     MI2   THIRD WORD OF HEADER (USED FOR SPECIAL CHARACTER FLAG)      33051810
%   PAPERTAPE IS PACKED INTO AN ARRAY WHOSE ADDRESS IS KEPT IN          33051820
%   INPUTANK[STA].[FF]. THE ARRAY CONTAINS:                             33051840
%     WORD    CONTENTS                                                  33051860
%     -1      I/O COMPLETE MASK                                         33051880
%     0       [FF]  ADDRESS OF WHICH BUFFER WE ARE USING                33051900
%             [CF]  NUMBER OF SEGMENTS IN CURRENT MESSAGE               33051920
%     1       RESERVED FOR DISKIO                                       33051940
%     2-31    FIRST BUFFER                                              33051960
%     32      RESERVED FOR DISKIO FOR SECOND BUFFER                     33051970
%     33-62   SECOND BUFFER                                             33051980
%   THE FIRST WORD OF THE BUFFER, AND THEREFORE OF A SEGMENT ON         33052000
%   DISK, (ALSO OF M[H]), IS USED AS FOLLOWS:                           33052020
%     [CF]   NUMBER OF CHARS IN FIRST MESSAGE IN THIS SEGMENT           33052040
%     [FF]   NUMBER OF WORDS USED IN SEGMENT                            33052060
%     [5:1]  END OF MESSAGE OR RECORD FLAG                              33052080
%     [2:1]  PAPERTAPE FLAG                                             33052100
%   IF THERE ARE MULTIPLE MESSAGES IN A SEGMENT, EACH MESSAGE IS        33052120
%   PRECEDED BY A WORD CONTAINING THE NUMBER OF CHARACTERS              33052140
%   IN THAT MESSAGE.                                                    33052160
%   JOBS READING A PAPERTAPE ARE SWAPPED IN ONLY AT THE END OF THE      33052180
%   TAPE OR WHEN THE INPUT TANK IS HALF FULL.                           33052200
%                                                                       33052220
    SUBROUTINE SWAPITIN;                                                33052500
    BEGIN                                                               33053000
         IF X.INPUTREADY THEN                                           33053500
         BEGIN BRINGBACK(STATABLE[STA].MIXNR);                          33054000
              X.INPUTREADY:=0;                                          33054500
         END;                                                           33055000
    END;                                                                33055500
%                                                                       33056000
    SUBROUTINE PAPERTAPEDISKIO;                                         33056500
    BEGIN                                                               33057000
         IF (M[T-1] AND IOMASK)=0 THEN SLEEP([M[T-1]],IOMASK);          33057500
         DISKIO(M[T-1],T1-1,30,PROGTANK+CLUMPSIZE|STA+                  33058000
               ((X.INPUTL+X.INPUTN+M[T].[CF]) AND NOT CLUMPSIZE));      33058500
$INCLUDE 33058601, IF STATISTICS;                                       33058599
         COUNTUP(16,1);                                                 33058600
         IF MI.MESSEND THEN            % UPDATE INPUTANK                33059000
         BEGIN IF (X:=X&(X.INPUTN+M[T].[CF]+1)[40:40:8]).[40:8] GTR     33059500
              CLUMPSIZE/2 THEN SWAPITIN;                                33060000
              M[T].[CF]:=0;                                             33060500
         END ELSE M[T]:=(*P(DUP))+1;                                    33061000
    END;                                                                33061500
%                                                                       33062000
    X:=INPUTANK[STA]:=ABS(*P(DUP));                                     33062500
    IF (Q:=M[T1:=M[T:=X.[FF]].[FF]].[FF]) + (N:=M[H].[FF]) GTR 28 OR    33063000
      MI.[7:1] OR (M[T1] AND NOT M[H]).[5:1] THEN                       33063100
    BEGIN IF Q!@77777 THEN             % NOT FIRST INPUT FROM TAPE      33063500
         BEGIN PAPERTAPEDISKIO;                                         33064000
              M[T].[FF]:=T1:=IF T1 GTR T+2 THEN T+2 ELSE T+33;          33064500
         END;                                                           33065000
         M[T1]:=M[H]&1[2:47:1];                                         33065500
         Q:=0;                                                          33066000
    END ELSE                                                            33066500
    BEGIN M[T1+Q]:=M[H].[CF];                                           33067000
         M[T1]:=(*P(DUP))&(P(DUP).[FF]+N)[CTF];                         33067500
    END;                                                                33068000
    STREAM(N,H:=H+1,D:=T1+Q+1);                                         33068500
    BEGIN SI:=H; DS:=N WDS END;                                         33069000
%                                                                       33069500
%   THE SPECIAL CHARACTER IS USED TO SIGNAL THE END OF THE TAPE. WE     33069600
%   PASS A QUESTION MARK TO CANDE, WRITE OUT THE LAST BUFFER, TURN      33069700
%   OF PAPERTAPE AND SWAP THE JOB IN.                                   33069800
%                                                                       33069900
    IF MI2.SPECIALCHARACTER THEN                                        33070000
    BEGIN IF NOT M[T1].MESSEND THEN                                     33070500
         BEGIN M[T1].MESSEND:=1;                                        33071000
              STATABLE[STA].OWHTHROWOUT:=1;                             33071500
         END;                                                           33072000
         IF DAT[STATABLE[STA].MIXNR].NDSABLE THEN                       33072500
         BEGIN M[T1+Q]:=1;                                              33073000
              N:=N-2;                                                   33073500
              STREAM(D:=T1+Q+1); DS:=LIT MARK;                          33074000
         END;                                                           33074500
         MI.MESSEND:=1;               % MAKE SURE INPUTANK IS UPDATED   33074600
         IF (M[T1]:=(*P(DUP))&(P(DUP).[FF]-N)[CTF]).[FF] ! 0 THEN       33075000
           PAPERTAPEDISKIO;                                             33075500
         X.[FF]:=0;                                                     33076000
         PAPERTAPE[STA]:=0;                                             33076500
         SWAPITIN;                                                      33077000
         IF (M[T-1] AND IOMASK)=0 THEN SLEEP([M[T-1]],IOMASK);          33077500
         FORGETSPACE(T);                                                33078000
    END ELSE                                                            33078500
    IF (Q:=X.INPUTN+M[T].[CF]) GTR CLUMPSIZE|.9 THEN                    33079000
    IF NOT X.SLOWDOWN THEN                                              33079500
    BEGIN QDCP(ENABLEINPUT,STA,Q);                                      33080000
         X.SLOWDOWN:=1;                                                 33080500
    END ELSE                                                            33081000
    IF Q GTR CLUMPSIZE-1 THEN TERMINATE(STATABLE[STA].MIXNR&67[CTF]);   33081500
%                                                                       33082000
    INPUTANK[STA]:=NABS(X);                                             33082500
END OF HANDLING INPUT FROM PAPER TAPE;                                  33083000
PROCEDURE OLDWIERDHAROLD;                                               33083500
%   OLD WIERD HAROLD DOES MANY STRANGE AND WONDROUS THINGS              33083600
%   SOME OF THEM USEFUL                                                 33083700
BEGIN                                                                   33084000
    REAL STA,H,I,J,SOURCE,MI,MI2,NUM,TEMP,X;                            33084500
    REAL S=SOURCE,T=TEMP;                                               33085000
    LABEL START,RESTART,AROUND,AGAIN,EOM,FIXLASTSEG,DELINKIT,UPX,       33085500
          PASSITTOCANDE,DELL,GETANOTHER,UPPTRS;                         33086000
    DEFINE DELETE   = [4:1]#,                                           33086500
           SIZEND   = [7:1]#,                                           33087000
           CELINE   = STATABLE[STA].CANDEFLAG#;                         33087500
    SUBROUTINE UPQ;                                                     33088000
    BEGIN                                                               33088500
         WORKERINQ.[CF]:=MI;                                            33089000
         FORGETAREA(MI.[2:2],I);                                        33089500
         SOURCE:=(I:=WORKERINQ.[CF])+3;                                 33090000
     END;                                                               33090500
%                                                                       33090600
%   HARRY FIRST EMPTIES THE WORKERINQ, THEN TAKES AN ITEM OUT OF THE    33090620
%   DETANKING QUEUE, THEN CHECKS THE WORKERINQ. HE CONTINUES TO         33090640
%   DO THIS UNTIL BOTH QUEUES ARE EMPTY.                                33090660
%                                                                       33090680
%   INPUT BUFFERS ARE QUEUED WITH 4:4 OF THE FIRST WORD USED TO FLAG    33090700
%   THE FOLLOWING THINGS:                                               33090720
%     4:1   DELETE HAS OCCURRED                                         33090740
%     5:1   END OF MESSAGE                                              33090760
%     6:1   END OF RECORD                                               33090780
%     7:1   224 CHARACTERS HAVE BEEN RECEIVED WITHOUT AN EOR OR EOM.    33090800
%   THE OWHTHROWOUT BIT IS USED TO SCAN PAST INPUT WITHOUT PROCESSING   33090820
%   IT, UNTIL AN EOR OR EOM IS REACHED. IT IS USED IF A RECORD          33090840
%   OVER 224 CHARACTERS LONG IS INPUT TO CANDE.                         33090860
%                                                                       33090880
    H:=SPACE(32);                                                       33091000
RESTART::                                                               33091500
    SOURCE:=(I:=WORKERINQ.[CF])+3;                                      33092000
START:                                                                  33092500
    IF I!0 THEN                                                         33093000
    BEGIN                                                               33093500
         IF STATABLE[STA:=(MI:=M[I]).LINENR].OWHTHROWOUT THEN           33094000
         BEGIN STATABLE[STA].OWHTHROWOUT:=(MI.[4:5] AND @26)=0;         33094500
              IF MI.DELETE THEN GO TO DELL;                             33095000
              UPQ;                                                      33095500
              IF MI.MESSEND THEN                                        33096000
              IF (TEMP:=INPUTANK[STA].[FF]) ! 0 THEN GO TO EOM;         33096500
              GO START;                                                 33097000
         END;                                                           33097500
         NUM:=0;                                                        33098000
         IF STA=0 THEN MI2:=0 ELSE                                      33098500
         BEGIN                                                          33099000
              M[H]:=0&(MI2:=M[I+2])[10:16:8];    % SAVE BACKSP FOR OBJOB33099500
              IF MI.DELETE THEN                                         33100000
DELL:         BEGIN X:=INPUTANK[STA].[FF];                              33100500
                   IF CELINE THEN                                       33101000
                        WHILE (TEMP:=X)!0 DO                            33101500
                        BEGIN X:=M[TEMP].[FF];                          33102000
                             FORGETSPACE(TEMP-2);                       33102500
                        END                                             33103000
                   ELSE                                                 33103500
                   IF PAPERTAPE[STA] THEN                               33104000
                   BEGIN IF NOT M[TEMP:=(M[X]:=(*P(DUP))&0[CTC]).[FF]]  33104500
                        .MESSEND THEN M[TEMP]:=0;                       33105000
                        GO AROUND;                                      33105500
                   END;                                                 33106000
                   INPUTANK[STA].[FF]:=0;                               33106500
AROUND:            UPQ;                                                 33107000
                   GO TO START;                                         33107500
              END;                                                      33108000
         END;                                                           33108500
         J:=H+1;                                                        33109000
AGAIN:                                                                  33109500
         STREAM(N:=(TEMP:=M[I+1].[40:8]).[40:3]:N1:=TEMP.[43:5],        33110000
                SOURCE,J);                                              33110500
         BEGIN SI:=SOURCE;                                              33111000
              N(DS:=32 CHR); DS:=N1 CHR;                                33111500
              N:=DI;                                                    33112000
         END;                                                           33112500
         J:=P;                                                          33113000
         NUM:=NUM+TEMP;                                                 33113500
         UPQ;                                                           33114000
         IF MI.[4:4]=0 THEN                                             33114500
         BEGIN MI:=M[I];                                                33115000
              IF (TEMP:=(MI2:=M[I+2]).[16:8]) ! 0 THEN     % BACKSPACE  33115500
              BEGIN IF (NUM:=NUM-TEMP) LSS 0 THEN NUM:=0;               33116000
                   J:=(H+1+NUM.[40:5])&NUM[30:45:3];                    33116500
              END;                                                      33117000
              GO AGAIN;                                                 33117500
         END;                                                           33118000
%                                                                       33118100
%   INPUT TO CANDE WHICH ENDS WITH AN EOR IS QUEUED IN ARRAYS           33118200
%   FORMATTED LIKE LASTSEG. THE ARRAYS ARE LINKED FROM INPUTANK{STA].[FF33118300
%   THROUGH THE FF OF THE FIRST WORD OF EACH ARRAY. WHEN AN             33118400
%   EOM IS RECEIVED, THE WHOLE THING IS LINKED INTO THE QUEUE OF        33118500
%   INPUT FOR CANDE.                                                    33118600
%                                                                       33118700
         IF CELINE OR (MI2.SPECIALCHARACTER AND NOT PAPERTAPE[STA]) THEN33119000
         BEGIN IF MI.SIZEND THEN                                        33119500
              BEGIN STATABLE[STA].OWHTHROWOUT:=1;                       33120000
                   NUM:=223;                                            33120500
                   J:=(H+29)&7[30:45:3];                                33121000
              END;                                                      33121500
              STREAM(J); DS:=LIT"~";                                    33122000
              IF ABS(SPOWORD) = STA THEN    %BACK UP SPO                33122500
              IF STA!0 THEN                                             33123000
              BEGIN M[H-1]:=0;                                          33123500
                   IF KEYBOARDCOUNTER = 0 THEN                          33124000
                   FORK(P(.KEYIN),1&(H+1)[CTF],0,192,0) ELSE            33124500
                   IF (X:=KEYBOARDCOUNTER.[FF]) NEQ 0 THEN              33125000
                   BEGIN IF (J:=M[X-2].[CF]) NEQ 0 THEN                 33125500
                        IF M[(X:=J)-2] NEQ 0 THEN GO TO START;          33126000
                        M[X-2]:=H+1;                                    33126500
                   END ELSE KEYBOARDCOUNTER:=KEYBOARDCOUNTER&(H+1)[CTF];33127000
                   KEYBOARDCOUNTER:=KEYBOARDCOUNTER&1[17:47:1];         33127500
                   H:=SPACE(32);                                        33128000
                   GO TO START;                                         33128500
              END;                                                      33129000
              X:=((NUM:=NUM+1)+7) DIV 8;                                33129500
              IF NOT MI.MESSEND THEN    % NOT ETX, MUST BE AN EOR       33130000
              BEGIN                    % SAVE IT IN CASE OF DELETE      33130500
                   P(LASTSEG,LASTOFFSET);        % MAKE LASTSEG POINT   33131000
                                                 % TP CURRENT BUFFER.   33131250
                   IF (TEMP:=INPUTANK[STA].[FF])=0 THEN                 33131500
                   BEGIN LASTSEG:=[INPUTANK[STA]]&32[10:40:8];          33132000
                        GO GETANOTHER;                                  33132500
                   END ELSE GO FIXLASTSEG;                              33133000
              END ELSE            % GOT ETX                             33133500
              IF (TEMP:=INPUTANK[STA].[FF])!0 THEN    %STUFF TO LINK IN 33134000
EOM:          BEGIN IF CANDEINPUTREADY THEN                             33134500
                   BEGIN IF (M[IOADR] AND IOMASK)=0 THEN                33135000
                        SLEEP([M[IOADR]],IOMASK);                       33135500
                        MOVE(30,TEMP,FIRSTSEG);                         33136000
                        FORGETSPACE(TEMP-2);                            33136500
                        TEMP:=FIRSTSEG.[CF];                            33137000
                        FIRSTOFFSET:=1;                                 33137500
                   END ELSE LASTSEG[0].[FF]:=TEMP;                      33138000
                   INPUTANK[STA].[FF]:=0;                               33138500
FIXLASTSEG:        DO LASTSEG.[CF]:=TEMP UNTIL (TEMP:=M[TEMP].[FF])=0;  33139000
                   IF NUM=0 THEN GO PASSITTOCANDE;                      33139500
                   IF (LASTOFFSET:=LASTSEG[0].[40:8]+1)+X GTR 29 THEN   33140000
                   GO GETANOTHER;                                       33140500
              END ELSE                                                  33141000
              IF X+LASTOFFSET GTR 29 THEN       % NO ROOM IN THIS SEG   33141500
              BEGIN IF CANDEINPUTREADY THEN     % REUSE FIRSTSEG        33142000
                   BEGIN IF (M[IOADR] AND IOMASK) = 0 THEN              33142500
                        SLEEP([M[IOADR]],IOMASK);                       33143000
                        FIRSTOFFSET:=1;                                 33143500
                   END ELSE                         % GET A NEW ONE     33144000
                   BEGIN                                                33144500
GETANOTHER:             LASTSEG[0].[FF] := (TEMP:=SPACE(32))+2;         33145000
                        M[TEMP] := IOMASK;                              33145500
                        LASTSEG.[CF]:=TEMP+2;                           33146000
                   END;                                                 33146500
                   LASTSEG[0]:=0&1[17:47:1];                            33147000
                   LASTOFFSET := 1;                                     33147500
              END;                                                      33148000
              STREAM(MA:=H+1,X,D:=[LASTSEG[LASTOFFSET+1]]);             33148500
              BEGIN SI:=MA; DS:=X WDS END;                              33149000
              LASTSEG[LASTOFFSET]:=NUM&MI2[1:35:1]&STA[10:40:8];        33149500
              LASTOFFSET.[CF]:=(LASTSEG[0]:=(*P(DUP))&(LASTOFFSET+X)    33150000
                                [CTC])+1;                               33150500
              IF NOT MI.MESSEND THEN          % RESTORE LASTSEG         33151000
              BEGIN                                                     33151500
                   LASTOFFSET:=P;                                       33152000
                   LASTSEG:=P;                                          33152500
                   GO TO START;                                         33153000
              END;                                                      33153500
PASSITTOCANDE:                                                          33154000
              IF CANDEINPUTREADY THEN                                   33154500
              BEGIN FORK(P(.NOTIFYCANDE),CANDYINX,0,0,1);               33155000
                   CANDEINPUTREADY:=FALSE;                              33155500
                   GO TO START;                                         33156000
              END;                                                      33156500
              IF CANDYINX=0 THEN                                        33157000
              BEGIN STREAM(H); DS:=27 LIT"CANDE IS DOWN...PLEASE WAIT"; 33157500
                   TWXOUT(H,27,1,STA);                                  33158000
                   GO TO START;                                         33158500
              END ELSE GO TO START;                                     33159000
         END STATION ATTACHED TO CANDE;                                 33159500
%                                                                       33159600
%   FOR OBJECT JOB INPUT, INPUTANK[STA].[FF] IS USED TO KEEP THE        33159620
%   NUMBER OF SEGMENTS WRITTEN TO DISK AS PART OF THE CURRENT           33159640
%   MESSAGE. M[H] (I.E. THE FIRST WORD OF A SEGMENT) CONTAINS:          33159660
%     [2:1]   PAPERTAPE FLAG                                            33159680
%     [5:1]   END OF RECORD FLAG                                        33159700
%     [10:8]  BACKSPACE COUNTER                                         33159720
%     [CF]    NUMBER OF CHARACTERS IN SEGMENT                           33159740
%   A MESSAGE MAY EXTEND FOR SEVERAL SEGMENTS, BUT A SEGMENT CAN        33159760
%   CONTAIN NO MORE THAN ONE MESSAGE.                                   33159780
%                                                                       33159800
         M[H]:=(*P(DUP))&NUM[CTC]&(NUM+15)[28:40:5]&((MI.[4:4] AND 6)!0)33160000
              [5:47:1];                                                 33160500
         IF PAPERTAPE[STA] THEN PAPERTAPEIO(STA,H,MI,MI2) ELSE          33161000
         BEGIN                                                          33161500
              X:=INPUTANK[STA]:=ABS(*P(DUP));                           33162000
              DISKIO(M[(H+31)],H-1,(NUM+7) DIV 8+1,PROGTANK+            33162500
                     CLUMPSIZE|STA+((X.INPUTN+X.[FF]+X.INPUTL) AND      33163000
                     NOT CLUMPSIZE));                                   33163500
$INCLUDE 33163601, IF STATISTICS;                                       33163599
              COUNTUP(16,1);                                            33163600
              IF MI.MESSEND THEN                                        33164000
              BEGIN X:=X&(X.[FF]+X.[40:8]+1)[40:40:8]&0[CTF];           33164500
                   IF INPUTANK[STA].INPUTREADY THEN                     33165000
                   BEGIN BRINGBACK(STATABLE[STA].MIXNR);                33165500
                        X.INPUTREADY:=0;                                33166000
              END  END                                                  33166500
              ELSE X.[FF]:=X.[FF]+1;                                    33167000
              IF X.INPUTN GEQ .9|CLUMPSIZE THEN                         33167500
              IF NOT X.SLOWDOWN THEN                                    33168000
              BEGIN M[(TEMP:=GETAREA(0))+1]:=0&ENABLEINPUT[1:41:7]      33168500
                        &STATABLE[STA][24:24:16];                       33169000
                   DCPQ(TEMP);                                          33169500
                   X.SLOWDOWN:=1;                                       33170000
              END ELSE                                                  33170500
              IF X.INPUTN=CLUMPSIZE-1 THEN                              33171000
             TERMINATE(STATABLE[STA].MIXNR&67[CTF]);                    33171500
              INPUTANK[STA]:=NABS(X);  % UPDATE AND UNLOCK INPUTANK     33172000
              SLEEP([M[H+31]],IOMASK);                                  33172500
         END;                                                           33173000
         GO TO START;                                                   33173500
%                                                                       33174000
  END OF INPUT HANDLING;    % IF WORKERINQ IS EMPTY WE FALL THROUGH     33174500
%                                                                       33174550
%   AFTER ALL INPUT IS DONE, HARRY DETANKS OUTPUT. FIRST HE READS       33174600
%   IN THE NEXT SEGMENT FOR A STATION (OR USES THE CORE TANK            33174620
%   IF THERE IS NONE ON DISK) AND UPS THE DETANKING POINTERS.           33174640
%   THE POINTERS KEPT ARE:                                              33174660
%     TANKS[STA].[19:7]   NUMBER OF SEGS IN USE                         33174680
%     TANKS[STA].[26:7]   OLDEST SEGMENT IN TANK                        33174700
%   FOR NON NAKABLE STATIONS, THIS IS ALL THAT IS REQUIRED,             33174720
%   SINCE NOTHING HAS TO BE SAVED. FOR NAKABLE STATIONS, THE            33174740
%   OLDEST SEGMENT IS A POINTER FOR A RETRY. THE ADDITIONAL             33174760
%   POINTERS ARE:                                                       33174780
%     TNAOG[STA]                                                        33174800
%       2:8      CHARACTER POINTER FOR RETRY                            33174820
%       10:8     POINTER TO WHERE THE DCP IS (USED TO UPDATE OLDEST     33174840
%                SEGMENT AFTER A SUCCESSFUL I/O)                        33174860
%       18:7     SEGMENT NEXT TO BE DETANKED.                           33174880
%   HARRY DETANKS HALF A SEGMENT AT A TIME, USING TANKS[STA].           33174900
%   NEXTPIECE AS A FLAG FOR WHICH HALF TO USE. IN THE CODE BELOW,       33174920
%   THE VARIABLE S PASSES TO DCWRITE WHETHER OR NOT THE SEGMENT         33174940
%   WAS EXHAUSTED.                                                      33174960
%                                                                       33174980
     IF (STA:=HEADOUT) ! 0 THEN                                         33175000
     BEGIN                                                              33175500
         IF NOT TANKS[STA].[1:1] THEN SLEEP([TANKS[STA]],-0);           33176000
         T:=TANKS[STA]:=ABS(*P(DUP));                                   33176500
         X:=T.TANKL;                                                    33177000
         IF (MI:=NAKSTA[STA]) THEN X:=X+(I:=TNAOG[STA].DETANK) AND      33177500
           NOT GLOMSIZE                                                 33178000
         ELSE I:=0;                                                     33178500
         IF T.[SOUSE] LEQ I THEN                                        33179000
         BEGIN STATABLE[STA].OUTPUTANKING:=0;                           33179500
              IF T.[CF]!0 AND M[T]!0 THEN                               33180000
              BEGIN NUM:=M[J:=T.[CF]].[CF];                             33180500
                   S:=1;                                                33181000
                   IF MI THEN                                           33181500
                   BEGIN DISKWAIT(J,30,GLOMSIZE|STA+TANKADDRESS+X);     33182000
$INCLUDE 33182101, IF STATISTICS;                                       33182099
                        COUNTUP(16,1);                                  33182100
                        TNAOG[STA].DETANK:=I+1;                         33182500
                        T:=T&(T.[SOUSE]+1)[18:40:8];                    33183000
                   END;                                                 33183500
                   M[J]:=0;                                             33184000
              END ELSE GO DELINKIT                                      33184500
         END ELSE                                                       33185000
         BEGIN DISKWAIT(-H,30,TANKADDRESS+GLOMSIZE|STA+X);              33185500
$INCLUDE 33185601, IF STATISTICS;                                       33185599
              COUNTUP(16,1);                                            33185600
              J:=H+16|(S:=T.NEXTPIECE);                                 33186000
              NUM:=M[H].[CF];                                           33186500
              IF S THEN                                                 33187000
              BEGIN NUM:=NUM-128;                                       33187500
                   GO UPPTRS;                                           33188000
              END ELSE                                                  33188500
              IF NUM GTR 136 THEN NUM:=128 ELSE                         33189000
              BEGIN S:=1;                                               33189500
    UPPTRS:        IF MI THEN                                           33190000
                   BEGIN TNAOG[STA].DETANK:=I+1;                        33190500
                        I:=T.TANKN-I-1;                                 33191000
                   END ELSE                                             33191500
                   T:=T&((X+1) AND NOT GLOMSIZE)[26:41:7]&(I:=T.TANKN-1)33192000
                     [19:41:7];                                         33192500
                   STATABLE[STA]:=(MI2:=(*P(DUP)))&(I GTR 0 OR (M[T]!0  33193000
                     AND T.[CF]!0 AND NOT MI2.SWAPPED))[18:47:1];       33193500
              END;                                                      33194000
              T:=T&(NOT S)[18:47:1];                                    33194500
         END;                                                           33195000
         DCWRITE(J+1,STA,NUM,S);                                        33195500
DELINKIT:                                                               33196000
         IF T.[10:2] ! 0 THEN                                           33196500
         IF GLOMSIZE/5 GEQ T.[SOUSE] THEN                               33197000
         BEGIN                                                          33197500
              IF T.[10:1] THEN                                          33198000
              BEGIN M[(X:=GETAREA(0))+1]:=0;                            33198500
                   M[X]:=0&STA[CTF]&10[18:41:7];                        33199000
                   QUEVENT(X,CANDEMIX[STA]);                            33199500
              END;                                                      33200000
              IF T.[11:1] THEN BRINGBACK(STATABLE[STA].MIXNR);          33200500
              T:=T&0[10:10:2];                                          33201000
         END;                                                           33201500
         HEADOUT:=TANKS[STA].[2:8];                                     33202000
         IF STA=TAILOUT THEN TAILOUT:=0;                                33202500
         TANKS[STA]:=(*P(DUP))&P(NABS(T),XCH)[12:12:2]&0[2:40:8];       33203000
         GO TO RESTART;                                                 33203500
    END;                                                                33204000
    FORGETSPACE(H);                                                     33204500
    WORKING:=FALSE;                                                     33205000
    GO TO NOTHINGTODO;                                                  33205500
END OLDWEIRDHAROLD SURE IS SKINNY;                                      33206000
PROCEDURE DCPERR(T);                                                    33206500
VALUE T;  REAL T;                                                       33207000
BEGIN REAL RCW=+0;                                                      33207500
    REAL   CLASS,STA,STAS,R,T1,T2;                                      33208000
    REAL   I,J,K,L,N;                                                   33208500
    BOOLEAN DISCONNECTED;                                               33209000
    LABEL  FOUND,UNLOAD,RETRY,QRETRY,QUEIT,OK,SETNOTREADY,SETREADY,     33209500
           TESTSPO,TELLUSER,FORGETIT,EXIT;                              33210000
    LABEL L1,L2;                                                        33210500
    LABEL MESS1;                                                        33211000
    DEFINE OKMASK       = @77606727#,                                   33211500
           STATUSOKMASK = @26000000#,                                   33212000
           SPREAD       = 16(DS:=3 RESET; 3(IF SB THEN DS:=SET ELSE     33212500
                          DS:=RESET; SKIP SB))#;                        33213000
%                                                                       33213300
%   DCPERR HANDLES VARIOUS SPECIAL CASES, ACCORDING TO T                33213400
%     T = 0 => FAULT                                                    33213500
%         1 => DCP IS HALTED                                            33213600
%         ANY OTHER VALUE IS THE ADDRESS OF A RESULT WITH AN ERROR      33213700
%                                                                       33213800
    SUBROUTINE FORKIT;                                                  33214000
    BEGIN DISCONNECTED:=TRUE;                                           33214500
         FORK(P(.QUITTER),R,-2,96,0);                                   33215000
    END;                                                                33215500
%                                                                       33216000
    SUBROUTINE LINEDISC;                                                33216500
    BEGIN IF T1.[24:8] LEQ LINETABLE.[18:8] THEN                        33217000
         IF STAS THEN                                                   33217500
         BEGIN R:=-T1;                                                  33218000
              FORKIT;                                                   33218500
         END ELSE                                                       33219000
         BEGIN M[(NT1:=GETAREA(0))+1]:=0&DISCONNECT[1:41:7]&            33219500
                 T1[24:24:8];                                           33220000
              DCPQ(NT1);                                                33220500
              M[(NT1:=GETAREA(0))+1]:=0&LOOKFORRING[1:41:7]&            33221000
                 T1[24:24:8];                                           33221500
              DCPQ(NT1);                                                33222000
         END;                                                           33222500
    END;                                                                33223000
%                                                                       33223500
    SUBROUTINE DISCIT;                                                  33224000
    BEGIN IF STA!0 THEN                                                 33224500
         BEGIN STATABLE[STA].[15:2]:=0;                                 33225000
              R:=STA&6[38:45:3]&(R=STATIONINVALID)[37:47:1];            33225500
              FORKIT;                                                   33226000
         END;                                                           33226500
    END;                                                                33227500
%                                                                       33228000
    SUBROUTINE QUEER;                                                   33228500
    BEGIN M[R:=GETAREA(0)]:=0&(M[T].[5:1] OR STA=0)[5:47:1];            33229000
         M[R+1]:=0&CLASS[1:41:7]&T1[24:24:16]&N[23:47:1];               33229500
         DCPQ(R);                                                       33230000
    END;                                                                33230500
%                                                                       33231000
    SUBROUTINE SPOIT;                                                   33231500
    BEGIN STREAM(I, J, STA, L:=T1.[24:8], S:=T1.[32:8], R:=T2.[8:8],    33232000
                 S1:=(STA=0), S2:=(T2.[1:7] GEQ OKRESULT), T:=T+1,      33232500
                 FILLIT:=0, D:=I:=SPACE(15));                           33233000
         BEGIN FILLIT:=CI; GO TO L1;                                    33233500
              DS:=3 DEC; I:=DI; DI:=DI-3; DS:=2 FILL; DI:=I; CI:=J;     33234000
         L1:  SI:=LOC I;                                                33234500
              SI:=SI+1; DS:=LIT" "; DS:=7 CHR;                          33235000
              SI:=SI+1; DS:=LIT" "; DS:=7 CHR;                          33235500
              S1(DS:=7 LIT", LINE "; SI:=SI+8;                          33236000
                 J:=CI; CI:=FILLIT; SI:=SI+8;                           33236500
                 JUMP OUT TO L2);                                       33237000
              DS:=6 LIT", STA "; J:=CI; CI:=FILLIT;                     33237500
              DS:=2 LIT"-("; J:=CI; CI:=FILLIT;                         33238000
              DS:=LIT"/"; J:=CI; CI:=FILLIT;                            33238500
              DS:=LIT")";                                               33239000
         L2:  DS:=8 LIT", RETRY "; J:=CI; CI:=FILLIT;                   33239500
              S2(DS:=3 LIT" OK");                                       33240000
              DS:=2 LIT"--"; SI:=T;                                     33240500
              2(SPREAD; DS:=2 LIT"  ");                                 33241000
              DS:=LIT"~";                                               33241500
         END;                                                           33242000
         SPOUT(I);                                                      33242500
    END;                                                                33243000
%                                                                       33243500
    IF T=0 THEN                                                         33244000
    BEGIN STREAM(F:=[DCPARRAY[3]],R:=R:=SPACE(10));                     33244500
         BEGIN SI:=F;                                                   33245000
              DS:=14 LIT"**DCP FAULT - ";                               33245500
              2(SPREAD; DS:=2 LIT"  ";);                                33246000
              DS:=LIT"~";                                               33246500
         END;                                                           33247000
         SPOUT(R);                                                      33247500
    END ELSE                                                            33248000
    IF T=1 THEN                                                         33248500
    BEGIN FOR T:=0 STEP 1 UNTIL 7 DO                                    33249000
         IF T!3 AND T!4 THEN                                            33249500
         IF (I:=DCPARRAY[T]).[CF]!0 THEN                                33250000
         IF NOT M[I].[1:1] THEN                                         33250500
           WHILE NOT (R:=I).[24:1] DO FORGETAREA((I:=M[R]).[2:2],R);    33251000
         GO TO NOTHINGTODO;                                             33251500
    END ELSE                                                            33252000
    BEGIN T2:=M[T+2];                                                   33252500
         IF (T1:=M[T+1]).[24:8] LEQ LINETABLE.[18:8] THEN               33253000
         BEGIN STREAM(D:=(LINETABLE+T1.[24:6])&T1[30:30:2]:);           33253500
              BEGIN SI:=D; DI:=LOC D; D:=TALLY;                         33254000
                   DI:=DI+6; DS:=2 CHR;                                 33254500
              END;                                                      33255000
              IF STAS:=((STA:=P)!0) THEN                                33255500
              DO IF (STATABLE[STA] EQV T1).[32:8] = @377 THEN GO FOUND  33256000
                UNTIL (STA:=STATABLE[STA].[40:8])=0;                    33256500
         END;                                                           33257000
%                                                                       33257100
%     STAS = 0 MEANS THAT THERE ARE NO STATIONS ACTIVE ON THE LINE.     33257120
%     STA IS THE INTERNAL STATION NUMBER (IF ANY) OF THE STATION.       33257140
%                                                                       33257160
%   FOR ABORTS, AN ENTERNORMALMODE IS DONE, AND, EXCEPT FOR             33257180
%   SWITCHABORTS AND DISCONNECTABORTS, THE USER AND/OR THE SPO IS       33257200
%   NOTIFIED.                                                           33257220
%   STATUS ERRORS ARE EITHER RETRIED  OR A MESSAGE IS SPOUTED,          33257240
%   DEPENDING ON THE NATURE OF THE ERROR.                               33257260
%   MESSAGERRORS CALL FOR A SETSTATIONREADY, AND A MESSAGE TO THE       33257280
%   USER AND/OR THE SPO, DEPENDING ON THE ERROR.                        33257300
%   FOR ALL OTHER ERRORS, A MESSAGE IS SPOUTED AT THE SPO, BUT          33257320
%   NOTHING ELSE IS DONE.                                               33257340
%                                                                       33257360
%   BITS 6:2 OF THE HEADER OF A REQUEST ARE ERROR FLAGS, AS FOLLOWS:    33257380
%     =2   THIS IS A MESSAGE SENT TO A USER TO INFORM HIM OF AN ERROR.  33257400
%          IF THIS DOESNT GO, HE IS LOGGED OFF.                         33257420
%     =1   FIRST RETRY OF A STATUS ERROR.                               33257440
%     =3   SECOND RETRY OF A STATUS ERROR. THIS IS ALL YOU GET.         33257460
%                                                                       33257480
FOUND:                                                                  33257500
         IF (R:=M[T].[6:2])!0 THEN                                      33258000
         IF R=2 THEN                                                    33258500
         IF (T2 AND OKMASK)!0 THEN                                      33259000
UNLOAD:  IF T1.[1:7]!DISCONNECT THEN                                    33259500
         IF STA!0 THEN                                                  33260000
         BEGIN DISCIT;                                                  33260500
              GO TO TESTSPO;                                            33261000
         END ELSE                                                       33261500
         IF STAS THEN GO TO SETNOTREADY ELSE                            33262000
         BEGIN CLASS:=DISCONNECT;                                       33262500
              GO QUEIT;                                                 33263000
         END ELSE GO TESTSPO                                            33263500
         ELSE ELSE                    % R!2, IMPLIES THIS IS A RETRY    33264000
         IF R=3 THEN                                                    33264500
         BEGIN I:="STATUS "; J:="ERROR  ";                              33265000
              GO TO UNLOAD;                                             33265500
         END ELSE GO RETRY;                                             33266000
%                                                                       33266500
         IF (R:=T2.[1:7])=IGNORED THEN GO FORGETIT;                     33267000
         IF R LEQ ADAPTORFAULT THEN                                     33267500
         BEGIN P(R-1); ::P(.MESS1,+,LOD); I:=P;                         33268000
              IF R LEQ TEXTINVALID THEN                                 33268500
              BEGIN J:="INVALID";                                       33269000
                   IF R=LINEINVALID THEN LINEDISC;                      33269500
                   IF R=STATIONINVALID THEN DISCIT;                     33270000
                   GO TO TESTSPO;                                       33270500
              END;                                                      33271000
              IF R=ADAPTORFAULT THEN                                    33271500
              BEGIN J:="FAULT  ";                                       33272000
                   GO TO TESTSPO;                                       33272500
              END;                                                      33273000
              J:="ABORT  ";                                             33273500
              CLASS:=ENTERNORMALMODE;                                   33274000
              IF R=SWITCHABORTED THEN                                   33274500
              IF NOT T2.CONNECTED THEN I:=0;                            33275000
              IF R=DISCONNECTABORTED THEN LINEDISC;                     33275500
              IF R=LOGICABORTED THEN                                    33276000
              BEGIN K:="NDL    ";                                       33276500
                   L:="ERROR  ";                                        33277000
              END;                                                      33277500
              GO QUEIT;                                                 33278000
MESS1:::      "CLASS  ",  "KEY    ",  "LINE   ",                        33278500
              "STATION",  "FUNCTN ",  "CLSTMSK",                        33279000
              "VARIANT",  "TEXT   ",                                    33279500
              "TRNSMIT",  "RECEIVE",  "LOGIC  ",                        33280000
              0,          "SWITCH ",                                    33280500
              "ADAPTOR";                                                33281000
         END;                                                           33281500
         IF R=TEXTREINITIALIZED THEN                                    33282000
         BEGIN M[T+1]:=T1&REINITIALIZEDOUTPUT[1:41:7];                  33282500
              GO TO QRETRY;                                             33283000
         END;                                                           33283500
         IF R=STATUSERROR THEN                                          33284000
         BEGIN IF (R:=T1.[1:7]) = ENTERNORMALMODE OR (R=DISCONNECT AND  33284500
                NOT T2.CONNECTED) THEN GO FORGETIT;                     33285000
              IF R=OUTPUT OR R=INPUT OR R=ENABLEDINPUT THEN             33285500
              BEGIN IF T2.CONNECTED THEN                                33286000
                   IF R!OUTPUT THEN                                     33286500
                   BEGIN K:="SYSTEM ";  L:="ERROR  ";                   33287000
                        GO TELLUSER;                                    33287500
                   END ELSE GO RETRY;                                   33288000
                   LINEDISC;                                            33288500
                   GO FORGETIT;                                         33289000
              END;                                                      33289500
              IF R LEQ REINITIALIZEDENABLEDINPUT AND                    33290000
                R GEQ REINITIALIZEDOUTPUT THEN                          33290500
              BEGIN IF T2.LINESUSPENDED THEN                            33291000
                   IF (T2 AND STATUSOKMASK)=0 THEN                      33291500
                   BEGIN I:="STATUS "; J:="ERROR  ";                    33292000
                        SPOIT;                                          33292500
                   END;                                                 33293000
                   M[T+1].[1:7]:=R+3;                                   33293500
              END;                                                      33294000
              IF R=RECALLSTATION THEN                                   33294500
              BEGIN CLASS:=SETSTATIONREADY;                             33295000
                   QUEER;                                               33295500
              END;                                                      33296000
RETRY:        CLICK:=CLOCK+P(RTR)+64+640|(M[T].[7:1]);                  33296500
              SLEEP(0,0);                                               33297000
              M[T]:=(*P(DUP))&(IF P(DUP).[7:1] THEN 3 ELSE 1)[6:46:2];  33297500
QRETRY:       DCPQ(T);                                                  33298000
              GO TO EXIT;                                               33298500
         END;                                                           33299000
         IF R GEQ OKRESULT THEN GO TO OK;                               33299500
         IF (T2 AND OKMASK)=1 THEN          % TIMEOUT                   33300000
           IF T1.[1:7]=OUTPUT THEN DISCIT ELSE ELSE                     33300500
         IF T2.BYTEOVERFLOW THEN K:="DCP    " ELSE                      33301000
         IF T2.TRANSMISSIONUMBERERROR AND (T2 AND OKMASK)=0 THEN        33301500
         BEGIN L:=1; GO TO L1;                                          33302000
         END ELSE                                                       33302500
         IF T2.ENDOFBUFFER THEN                                         33303000
         BEGIN                                                          33303500
L1:           STREAM(L,K:=(K:=GETAREA(1))+3);                           33304000
              BEGIN DS:=4 LIT"!-!*";                                    33304500
                   CI:=CI+L; GO TO L1;                                  33305000
                   DS:=25 LIT"TRANSMISSION NUMBER ERROR";               33305500
                   GO TO L2;                                            33306000
            L1:    DS:=29 LIT"DECLARED BUFFER SIZE EXCEEDED";           33306500
            L2:    DS:=23 LIT" - DATA MAY BE LOST!-!*";                 33307000
              END;                                                      33307500
              M[K+1]:=IF L THEN 52 ELSE 56;                             33308000
              GO SETREADY;                                              33308500
         END ELSE                                                       33309000
OK:      IF T2.PARITYFLAG THEN I:="PARITY " ELSE                        33309500
         IF T2.BCCCHECK THEN I:="BCC    " ELSE                          33310000
         IF T2.CARRIERLOST THEN                                         33310500
         BEGIN I:="CARRIER";                                            33311000
              J:="LOST   ";                                             33311500
              GO TO L2;                                                 33312000
         END ELSE                                                       33312500
         IF T2.ADDRESSFLAG THEN I:="ADDRESS" ELSE                       33313000
         IF T2.FORMATERROR THEN I:="FORMAT " ELSE                       33313500
         IF T1.[1:7] GEQ OKRESULT THEN GO FORGETIT;                     33314000
         J:="ERROR  ";                                                  33314500
L2:      IF R LSS OKRESULT THEN                                         33315000
         BEGIN K:=I;  L:=J;                                             33315500
SETREADY:     N:=1;                                                     33316000
SETNOTREADY:  CLASS:=SETSTATIONREADY;                                   33316500
QUEIT:        IF CLASS!0 THEN QUEER;                                    33317000
         END;                                                           33317500
TESTSPO:                                                                33318000
         IF I!0 THEN SPOIT;                                             33318500
         IF K!0 THEN                                                    33319000
         BEGIN                                                          33319500
TELLUSER:     IF L GTR 8 THEN                                           33320000
              BEGIN STREAM(K,L,D:=(K:=GETAREA(1))+3);                   33320500
                   BEGIN DS:=4 LIT"!-!*";                               33321000
                        SI:=LOC K; SI:=SI+1; DS:=7 CHR;                 33321500
                        SI:=SI+1; DS:=7 CHR;                            33322000
                        DS:=23 LIT" - DATA MAY BE LOST!-!*";            33322500
                   END;                                                 33323000
                   M[K+1]:=41;                                          33323500
              END;                                                      33324000
              M[K+1]:=(*P(DUP))&OUTPUT[1:41:7]&T1[24:24:16];            33324500
              M[K]:=0&22[3:43:5];                                       33325000
              DCPQ(K);                                                  33325500
         END;                                                           33326000
FORGETIT:                                                               33326500
         IF STA!0 THEN                                                  33327000
         IF T1.[1:7]=RECALLSTATION THEN STATABLE[STA].[22:1]:=1 ELSE    33327500
         BEGIN IF NOT DISCONNECTED THEN                                 33328000
              IF STATABLE[STA].OUTPUTANKING THEN                        33328500
              IF TANKS[STA].DCPMESSAGES LSS 2 THEN                      33329000
              IF TANKS[STA].[2:8]=0 AND STA!TAILOUT THEN                33329500
              BEGIN TANKLINE[TAILOUT]:=STA;                             33330000
                   TAILOUT:=STA;                                        33330500
                   STARTWORKING;                                        33331000
         END  END;                                                      33331500
         FORGETAREA(M[T].[2:2],T);                                      33332000
    END;                                                                33332500
EXIT:                                                                   33333000
    IF STA!0 THEN STATABLE[STA].ERRORS:=0;                              33333500
    KILL([RCW] INX NOT 2);                                              33334000
END;                                                                    33334500
PROCEDURE NEWLINE(R);                                                   33335000
VALUE R;  REAL R;                                                       33335500
%                                                                       33335600
%   NEWLINE SETS ALL STATIONS ON THE LINE READY, ENABLES INPUT,         33335650
%   AND ASKS FOR USERCODE. THE RESULTANT INPUT WILL ACTIVATE THE        33335700
%   STATIONS.  IF WE EVER DO DIAL-UP POLL LINES, THIS PROCEDURE WILL    33335750
%   HANDLE FINDING THE PROPER ADDRESSES.                                33335800
%                                                                       33335850
BEGIN REAL A,I,J,L,X;                                                   33336000
    DISKWAIT(-(A:=SPACE(30)),30,TNAOG[0]+(X:=((L:=R.[24:8])+1) DIV 30));33336500
    X:=M[A+L+1-30|X].[CF]-1;                                            33337000
    FORGETSPACE(A);                                                     33337500
    FOR I:=0 STEP 1 UNTIL X DO                                          33338000
    BEGIN R:=R&I[32:40:8]&1[23:47:1];                                   33338500
         M[A:=GETAREA(0)]:=0&1[5:47:1];                                 33339000
         M[A+1]:=R&SETSTATIONREADY[1:41:7];                             33339500
         DCPQ(A);                                                       33340000
         M[A:=GETAREA(0)]:=0&1[5:47:1];                                 33340500
         M[A+1]:=R&ENABLEINPUT[1:41:7];                                 33341000
         DCPQ(A);                                                       33341500
         STREAM(J:=0: L, I, D:=(A:=GETAREA(2))+3);                      33342000
         BEGIN DS:=34 LIT"!-!*B5700 TIME SHARING WITH DCP - ";          33342500
              SI:=LOC L; D:=DI; DI:=LOC J;                              33343000
              DS:=3 DEC; DS:=3 DEC; DS:=LIT"A";                         33343500
              SI:=LOC J; DI:=D;                                         33344000
         LL:  IF SC="0" THEN                                            33344500
              BEGIN SI:=SI+1; TALLY:=TALLY+1;                           33345000
                   IF SC!"0" THEN DS:=2 CHR ELSE                        33345500
                   BEGIN SI:=SI+1; TALLY:=TALLY+1; DS:=CHR END          33346000
              END ELSE DS:=3 CHR;                                       33346500
              IF SC GEQ "0" THEN                                        33347000
              BEGIN DS:=LIT"/"; GO TO LL END;                           33347500
              J:=TALLY;                                                 33348000
              DS:=30 LIT"!-!*ENTER USER CODE, PLEASE - ";               33348500
         END;                                                           33349000
         J:=71-P;                                                       33349500
         M[A]:=0&9[2:44:4];                                             33350000
         M[A+1]:=R&OUTPUT[1:41:7]&J[40:40:8];                           33350500
         DCPQ(A);                                                       33351000
         CLICK:=CLOCK+P(RTR)+120|(BIGUNS LEQ BIGUNMIN+1);               33351500
         SLEEP(0,0);                                                    33352000
    END;                                                                33352500
    KILL([R] INX NOT 1);                                                33353000
END;                                                                    33353500
SAVE PROCEDURE UPREQUESTQ;                                              33354000
BEGIN                                                                   33354500
    IF (REQUESTQ AND NOT MYREQUEST).[24:1] THEN                         33355000
    BEGIN REQUESTQ:=MYREQUEST;                                          33355500
         MYREQUEST:=QMASK&[MYREQUEST][9:33:15];                         33356000
         SETATTENTION;                                                  33356500
    END;                                                                33357000
END;                                                                    33357500
SAVE PROCEDURE DCPQ(ADDR);                                              33358000
VALUE ADDR;  REAL ADDR;                                                 33358500
BEGIN                                                                   33359000
    IF DCPTOG THEN                                                      33359500
    BEGIN M[M[MYREQUEST.[9:15]]:=(*P(DUP))&ADDR[24:24:24]].[24:1]:=1;   33360000
         MYREQUEST.[9:15]:=ADDR;                                        33360500
         M[ADDR+2]:=0;                                                  33361000
         UPREQUESTQ;                                                    33361500
    END ELSE FORGETAREA(M[ADDR].[2:2],ADDR);                            33362000
END;                                                                    33362500
SAVE PROCEDURE DCPINTERRUPT;                                            33363000
BEGIN                                                                   33363500
    REAL A,B,I;                                                         33364000
    SUBROUTINE QAREAS;                                                  33364500
         FOR I:=0 STEP 1 UNTIL 4 DO                                     33365000
         IF BIGUNS!0 THEN M[B].[CF]:=B:=GETAREA(1);                     33365500
%                                                                       33366000
%   IF THE DCP IS OUT OF SPACE, WE GET IT SOME. OTHERWISE, IT IS        33366100
%   ASSUMED TO BE A FAULT.                                              33366200
%                                                                       33366300
    IF DCPTOG THEN                                                      33366500
    IF SPACEQ.[24:1] THEN                                               33367000
    BEGIN A:=B:=GETAREA(1);                                             33367500
         QAREAS;                                                        33368000
         IF LMAX GEQ 30 THEN                                            33368500
         IF BIGUNS LEQ BIGUNMIN+2 THEN QAREAS;                          33369000
         M[B].[24:1]:=1;                                                33369500
         SPACEQ:=A;                                                     33370000
    END ELSE                                                            33370500
    BEGIN FORK(P(.DCPERR),0,-2,0,1);                                    33371000
         DCPTOG:=0;                                                     33371500
    END;                                                                33372000
    GO TO EXTERNAL;                                                     33372500
END;                                                                    33373000
PROCEDURE DCPHANDLER;                                                   33373500
BEGIN REAL STA,CLASS,LINE,TN,FIRSTSTA;                                  33374000
    REAL I=NT3,J=NT4,T=NT5;                                             33374500
    REAL HEADER1,HEADER2,HEADER3,R,RESULT;                              33375000
%   THIS PROCEDURE PROCESSES THE RESULT QUEUE.                          33375250
    LABEL NEWSTA,HITHERE,FOUND,WHOARTHOU,AROUND,DELINK,FORKIT,          33375500
          TESTFERERRS,CHECKFLAGS,ERROR,FORG,ERREX;                      33376000
     DEFINE OKMASK       = @77606727#;                                  33376500
%                                                                       33377000
    SUBROUTINE DELINKIT;                                                33377500
    BEGIN                                                               33378000
         FORK(P(.QUITTER),I,-2,96,0);                                   33378500
    END;                                                                33379000
%                                                                       33379500
    SUBROUTINE TESTFOROUTPUT;                                           33380000
    BEGIN                                                               33380500
              IF STATABLE[STA].[18:2] = 2 THEN                          33381000
              IF (T:=TANKS[STA]).DCPMESSAGES LSS 2 THEN                 33381500
              IF T.[2:8]=0 THEN                                         33382000
              IF TAILOUT!STA THEN                                       33382500
              BEGIN TANKLINE[TAILOUT]:=STA;                             33383000
                   TAILOUT:=STA;                                        33383500
                   STARTWORKING;                                        33384000
              END;                                                      33384500
    END;                                                                33385000
%                                                                       33385500
    SUBROUTINE GIVEITUP;                                                33386000
    BEGIN                                                               33386500
         GIVEAWAY(TN.[CF],NT1);                                         33387000
         TN:=TN&0[25:25:23];                                            33387500
    END;                                                                33388000
%                                                                       33388500
    SUBROUTINE FORKHELLO;                                               33389000
    BEGIN                                                               33389500
         M[(T:=GETAREA(0))+1]:=STA;                                     33390000
         M[T+2]:=HEADER2;                                               33390500
         FORK(P(.HELLO),T,-2,128,1);                                    33391000
    END;                                                                33391500
%                                                                       33391600
%   THE STEPS TAKEN WITH A RESULT ARE:                                  33391650
%   1. CHECK FOR SPECIAL CASES FOR WHICH THERE IS NO INTERNAL           33391700
%      STATION NUMBER AND JUST LOOK FOR ERROR CONDIT. THE               33391750
%      5:1 BIT OF WORD ZERO IMPLIES THERE IS NO STATION NUMBER FOR      33391800
%      THIS REQUEST.                                                    33391850
%   2. FIND THE STATION NUMBER. ACTIVE STATIONS FOR A LINE ARE LINKED   33391900
%      THROUGH THE 40:8 FIELD OF STATBLE. THE HEAD OF THE LINKS IS IN   33391950
%      LINETABLE.                                                       33392000
%   3. IF IT IS A NEW STATION, FIND AN AVAILABLE SLOT, GIVE IT TO HIM   33392050
%      AND FORK HELLO.                                                  33392100
%                                                                       33392150
  DO BEGIN                                 % LOOP WHILE DCPTOG          33392500
    WHILE NOT RESULTQ.[24:1] DO   %SOMETHING IS IN THE QUEUE            33393000
    BEGIN UPREQUESTQ;                                                   33393500
         HEADER1:=M[R:=RESULTQ.[CF]];                                   33394000
         HEADER2:=M[R+1];                                               33394500
         HEADER3:=M[R+2];                                               33395000
%                                                                       33395500
         STA:=0;                                                        33396000
         RESULT:=HEADER3.[1:7];                                         33396500
         IF (CLASS:=HEADER2.[1:7])=NULL OR CLASS=DISCONNECT OR          33397000
            CLASS=LOOKFORRING OR HEADER1.[5:1] THEN GO TESTFERERRS;     33397500
         IF CLASS=ANSWER THEN                                           33398000
         BEGIN FORK(P(.NEWLINE),HEADER2,-2,128,1);                      33398500
              GO TO FORG;                                               33399000
         END;                                                           33399500
         IF RESULT=STATUSPRESENT THEN                                   33400000
         BEGIN IF NOT HEADER3.CONNECTED THEN                            33400500
              BEGIN I:=HEADER2&16[1:43:5];                              33401000
                   GO FORKIT;                                           33401500
              END ELSE                                                  33402000
              GO TO FORG;                                               33402500
         END;                                                           33403000
%                                                                       33403500
         STREAM(N:=HEADER2.[30:2]:D:=LINETABLE+HEADER2.[24:6]);         33404000
         BEGIN SI:=D; SI:=SI+N; SI:=SI+N;                               33404500
              DI:=LOC N; DI:=DI+6; DS:=2 CHR;                           33405000
         END;                                                           33405500
         IF (FIRSTSTA:=STA:=P)=0 THEN GO TO NEWSTA;                     33406000
         J:=HEADER2.[32:8];                                             33406500
         DO IF STATABLE[STA].[32:8]=J THEN GO TO FOUND                  33407000
         UNTIL (STA:=STATABLE[I:=STA].[40:8])=0;                        33407500
NEWSTA:  IF RESULT LEQ MESSAGERROR THEN                                 33408000
         IF NOT (RESULT=MESSAGERROR AND HEADER3.WRU) THEN GO TO ERROR;  33408500
         FOR STA:=1 STEP 1 UNTIL STAMAX DO                              33409000
         IF STATABLE[STA]=0 THEN GO TO HITHERE;                         33409500
         STA:=0;                                                        33409600
         IF RESULT!REQUESTCONTINUED THEN FORKHELLO;                     33410000
         GO TO FORG;                                                    33410500
HITHERE:                                                                33411000
         STATABLE[STA]:=0&3[15:46:2]&(CANDYINX+160)[2:40:8]&            33411500
           HEADER2[24:24:16]&FIRSTSTA[40:40:8];                         33412000
         STREAM(STA:=FIRSTSTA:=STA,D:=(LINETABLE+HEADER2.[24:6])        33412500
                &HEADER2[30:30:2]);                                     33413000
         BEGIN SI:=LOC STA; SI:=SI+6;                                   33413500
              DS:=2 CHR;                                                33414000
         END;                                                           33414500
         FORKHELLO;                                                     33415000
FOUND:                                                                  33415500
         P([STATABLE[STA]],IOR);                                        33416000
         TN:=TNAOG[STA];                                                33416500
%                                                                       33416600
%   INPUT IS QUEUED IN TNOAG[STA].[CF]. THE 25:8 FIELD IS USED FOR      33416700
%   KEEPING THE NUMBER OF CHARACTERS QUEUED. WE PASS TO HARRY IF THIS   33416800
%   EXCEEDS 224 OR AFTER EOR OR EOM. RESULTS LEQ TEXTREINITIALIZED      33416900
%   REQUIRE THAT ALL THAT WE HAVE BE DELETED. IF AN OKRESULT HAS        33417000
%   ERROR BITS, WE COPY THE HEADER AND FORK DCPERR.                     33417100
%                                                                       33417200
         IF CLASS=ENABLEDINPUT OR CLASS=REINITIALIZEDENABLEDINPUT THEN  33417500
         BEGIN                                                          33418000
              IF RESULT LEQ TEXTREINITIALIZED THEN                      33418500
              BEGIN I:=TN;                                              33419000
                   WHILE (J:=I.[CF])!0 DO FORGETAREA((I:=M[J]).[2:2],J);33419500
                   M[I:=GETAREA(0)]:=0&STA[10:40:8];                    33420000
                   GIVEAWAY(I,8);                                       33420500
                   TNAOG[STA]:=TN&0[25:25:23];                          33421000
                   IF RESULT=TEXTREINITIALIZED THEN                     33421500
                   BEGIN M[R+1]:=0&REINITIALIZEDENABLEDINPUT[1:41:7]&   33422000
                          HEADER2[24:24:16];                            33422500
                        DCPQ(R);                                        33423000
                        GO TO ERREX;                                    33423500
                   END;                                                 33424000
                   IF HEADER3.WRU THEN                                  33424500
                   BEGIN P(3);                                          33425000
                        GO TO DELINK;                                   33425500
                   END;                                                 33426000
                   IF RESULT=IGNORED THEN GO CHECKFLAGS ELSE GO ERROR;  33426500
              END;                                                      33427000
              IF (NT2:=TN.[25:8]+HEADER2.TEXTLENGTH) GTR 232 THEN       33427500
              BEGIN NT1:=1;                                             33428000
                   GIVEITUP;                                            33428500
                   NT2:=HEADER2.TEXTLENGTH;                             33429000
              END;                                                      33429500
              IF (I:=TN.[CF])=0 THEN J:=0 ELSE                          33430000
              BEGIN M[I].[CF]:=R;                                       33430500
                   J:=0&I[CTF];                                         33431000
              END;                                                      33431500
              M[R]:=(*P(DUP))&STA[10:40:8]&J[18:18:30];                 33432000
              TN:=TN&R[CTC]&NT2[25:40:8];                               33432500
              IF RESULT ! REQUESTCONTINUED THEN                         33433000
              BEGIN IF RESULT=OKRESULT THEN                             33433500
                   BEGIN TESTFOROUTPUT;                                 33434000
                        P(4);                                           33434500
                   END ELSE P(2);                                       33435000
                   NT1:=P;                                              33435500
                   GIVEITUP;                                            33436000
                   IF HEADER3.WRU THEN                                  33436500
                   BEGIN I:=STA&3[33:41:7];                             33437000
                        DELINKIT;                                       33437500
                   END;                                                 33438000
                   IF (HEADER3 AND OKMASK) ! 0 THEN                     33438500
                   BEGIN T:=GETAREA(1);                                 33439000
                        MOVE(10,R,T);                                   33439500
                        R:=T;                                           33440000
                        TNAOG[STA]:=TN;                                 33440500
                        GO TO ERROR;                                    33441000
              END  END;                                                 33441500
              TNAOG[STA]:=TN;                                           33442000
              GO TO ERREX;                                              33442500
         END;                                                           33443000
%                                                                       33443100
%   FOR OUTPUT, WE FIRST UPDATE THE POINTERS ACCORDING TO THE RESULT.   33443150
%   THEN IF STATABLE[STA].DISCIT IS ON, AND THER IS NO MORE OUTPUT,     33443200
%   WE LOG OFF THE USER. THIS IS DONE BY SENDING A DISABLE INPUT        33443250
%   AND THEN FORKING QUITTER TO DO ALL THE DIRTY WORK.                  33443300
%                                                                       33443350
         IF CLASS=OUTPUT OR CLASS=REINITIALIZEDOUTPUT THEN              33443500
         BEGIN                                                          33444000
              IF NAKSTA[STA] THEN                                       33444500
              BEGIN                                                     33445000
                   T:=TANKS[STA];                                       33445500
                   IF RESULT=TEXTREINITIALIZED THEN                     33446000
                   BEGIN STATABLE[STA]:=(*P(DUP))&1[18:47:1]&1[21:47:1];33446500
                        TANKS[STA]:=T&TN[18:2:1];                       33447000
                        P(TN&0[11:11:14]&P(DUP)[10:2:1]);               33447500
                   END ELSE                                             33448000
                   IF RESULT=REQUESTCONTINUED THEN                      33448500
                        IF HEADER1.[4:1] THEN                           33449000
                        P(ABS(TN)&(P(DUP).DCPSEG+1)[10:40:8]) ELSE      33449500
                        P(TN&1[10:47:1])                                33450000
                   ELSE                                                 33450500
                   BEGIN IF T GEQ 0 THEN SLEEP([TANKS[STA]],-0);        33451000
                        TANKS[STA]:=(*P(DUP))&((P(DUP).TANKL+           33451500
                          (I:=(TN:=TNAOG[STA]).DCPSEG+HEADER1.[4:1]))   33452000
                          AND NOT GLOMSIZE)[26:41:7]&(P(DUP).TANKN-I)   33452500
                          [TANKNDIAL];                                  33453000
                        P(TN&0[10:10:8]&(P(DUP).DETANK-I)[18:41:7]);    33453500
                        IF RESULT=INCOMPLETEREQUEST THEN                33454000
                        BEGIN P(P&HEADER1[2:4:1] OR 0&HEADER2[2:40:8],  33454500
                             [TNAOG[STA]],STD);                         33455000
                             GO AROUND;                                 33455500
                        END;                                            33456000
                        P(ABS(P)&(NOT HEADER1)[2:4:1]&P(DUP)[10:2:1]    33456500
                          &0[3:3:7]);                                   33457000
                   END;                                                 33457500
                   P([TNAOG[STA]],STD);                                 33458000
              END;                                                      33458500
              TANKS[STA]:=(*P(DUP))&(I:=P(DUP).DCPMESSAGES-1)[12:46:2]; 33459000
AROUND:       IF RESULT LEQ MESSAGERROR THEN                            33459500
              BEGIN IF HEADER3.BROKEN THEN                              33460000
                   BEGIN STATABLE[STA].DISCIT:=0;                       33460500
                        P(2); GO DELINK;                                33461000
                   END ELSE IF RESULT=IGNORED THEN ELSE GO ERROR;       33461500
              END;                                                      33462000
              IF I=0 THEN                                               33462500
              IF STATABLE[STA].DISCIT THEN                              33463000
              BEGIN M[(I:=GETAREA(0))+1]:=0&HEADER2[24:24:16]&          33463500
                     ENABLEINPUT[1:41:7];                               33464000
                   DCPQ(I);                                             33464500
                   STATABLE[STA]:=(*P(DUP))&0[15:15:2];                 33465000
                   P(6);                                                33465500
DELINK:            I:=STA&P(XCH)[33:41:7];                              33466000
FORKIT:            DELINKIT;                                            33466500
                   GO TO FORG;                                          33467000
              END;                                                      33467500
              TESTFOROUTPUT;                                            33468000
              GO CHECKFLAGS;                                            33468500
         END;                                                           33469000
TESTFERERRS:                                                            33469500
         IF CLASS=RECALLSTATION THEN STATABLE[STA].[22:1]:=1;           33470000
         IF RESULT LSS OKRESULT THEN GO TO ERROR;                       33470500
CHECKFLAGS:                                                             33471000
         IF (HEADER3 AND OKMASK)!0 THEN                                 33471500
         BEGIN                                                          33472000
              IF RESULT!STATUSPRESENT THEN ELSE GO TO FORG;             33472500
ERROR:        FORK(P(.DCPERR),R,0,0,1);                                 33473000
              IF STA!0 THEN STATABLE[STA].ERRORS:=1;                    33473500
         END ELSE                                                       33474000
FORG:         FORGETAREA(HEADER1.[2:2],R);                              33474500
ERREX:   RESULTQ:=HEADER1;                                              33475000
    END WHILE LOOP;                                                     33475500
    SETATTENTION;                                                       33476000
%                                                                       33476500
    CLICK:=CLOCK+P(RTR)+128;                                            33477000
    COMPLEXSLEEP(NOT RESULTQ.[24:1]);                                   33477500
  END UNTIL NOT DCPTOG;                                                 33478000
  DCPERR(1);                                                            33478500
END;                                                                    33479000
PROCEDURE DCPFILECHANGER(BUFF);                                         33479500
VALUE BUFF; REAL BUFF;                                                  33480000
BEGIN REAL X,X1,X2,X3,X4,X5,X6;                                         33480500
%                                                                       33480900
%   THIS PROCEDURE CHANGES THE DCP CODE FILE. THE NAME IS KEPT          33481000
%   IN DISK SEGMENT 995.                                                33481100
%                                                                       33481200
    STREAM(A:=1:BUFF,X:=[X]);                                           33481500
    BEGIN SI:=BUFF;                                                     33482000
    L:   IF SC = " " THEN BEGIN SI:=SI+1;  GO TO L END;                 33482500
         IF SC = "~" THEN DS:=16 LIT "0CODE   0DCP    " ELSE            33483000
         BEGIN   DS:=16 LIT "0       ";  DI:=X;  DI:=DI+1;              33483500
              7(IF SC = "/" THEN JUMP OUT ELSE DS:=CHR);                33484000
              IF SC = "/" THEN SI:=SI+1 ELSE                            33484500
              BEGIN A:=TALLY;   GO TO OT END;                           33485000
              DI:=X;   DI:=DI+9;                                        33485500
              7(IF SC = "~" THEN JUMP OUT ELSE DS:=CHR);                33486000
         END;                                                           33486500
    OT:                                                                 33487000
    END OF STREAM;                                                      33487500
    BUFF:=BUFF.[15:15]-1;                                               33488000
    IF P THEN                                                           33488500
    BEGIN                                                               33489000
         DISKWAIT(-(X3:=SPACE(30)),-30,DCPDSK);                         33489500
         IF (X4:=DIRECTORYSEARCH(X,X1,17)) = 0 THEN                     33490000
              STREAM(X:=[X],BUFF);                                      33490500
              BEGIN   SI:=X;   SI:=SI+1;                                33491000
                      DS:=9 LIT "#NO FILE ";   DS:=7 CHR;               33491500
                      DS:=1 LIT "/";   SI:=SI+1;   DS:=7 CHR;           33492000
                      DS:=1 LIT "~";                                    33492500
              END                                                       33493000
         ELSE                                                           33493500
         BEGIN X6:=M[X4+4].[16:20]+M[X4+9].[9:20];                      33494000
              FORGETSPACE(X4);                                          33494500
              IF X6!0 THEN                                              33495000
              BEGIN                                                     33495500
                   STREAM(X:=[X],BUFF);                                 33496000
                   BEGIN   SI:=X;   SI:=SI+1;                           33496500
                           DS:= 22 LIT "#DCP FILE NOT CHANGED ";        33497000
                           DS:=7 CHR;   DS:=1 LIT "/";   SI:=SI+1;      33497500
                           DS:=7 CHR;   DS:=8 LIT " IN USE~";           33498000
                   END;                                                 33498500
                   P(DIRECTORYSEARCH(-X,X1,16),DEL);                    33499000
              END ELSE                                                  33499500
              BEGIN STREAM(X5:=(X5:=X3+3|SYSNO)+1:); % TEMP UNTIL GET   33500000
                   BEGIN SI:=X5; TALLY:=1;           % COLD-COOL START  33500500
                        IF SC!"0" THEN TALLY:=0 ELSE % TO FIX DCPDSK    33501000
                        BEGIN SI:=SI+8;                                 33501500
                             IF SC!"0" THEN TALLY:=0;                   33502000
                        END;                                            33502500
                        X5:=TALLY;                                      33503000
                   END;                                                 33503500
                   IF P THEN                                            33504000
                     P(DIRECTORYSEARCH(-M[X5+1],M[X5+2],16),DEL);       33504500
                   M[X5+1]:=X;                                          33505000
                   M[X5+2]:=X1;                                         33505500
                   M[X5]:=X4;                                           33506000
                   STREAM(X:=[X],BUFF);                                 33506500
                   BEGIN   SI:=X;   SI:=SI+1;                           33507000
                           DS:=22 LIT "NEXT DCP FILE WILL BE ";         33507500
                           DS:=7 CHR;   SI:=SI+1;   DS:=1 LIT "/";      33508000
                           DS:=7 CHR;   DS:=1 LIT "~";                  33508500
                   END;                                                 33509000
              END;                                                      33509500
         END;                                                           33510000
         DISKWAIT(X3,-30,DCPDSK);                                       33510500
         FORGETSPACE(X3);                                               33511000
    END;                                                                33511500
    SPOUT(BUFF);                                                        33512000
END OF CHANGING DCP CODE FILE;                                          33512500
PROCEDURE INITIALIZEDCP;                                                33513000
BEGIN REAL RCW=+0,X,X1,X2,X3,X4,X5,X6,X7,B,C,I,L,R;                     33513500
    ARRAY A[*];                                                         33514000
    BOOLEAN NOGO=X7;                                                    33514500
    LABEL L2,L3,XOUT,SPOUTER,INTERR,CHECKIT,EXIT;                       33515000
    DEFINE DCPMASK = @3760000000000000#;                                33515500
%                                                                       33516000
    SUBROUTINE BUILDSQ;                                                 33516500
    BEGIN                                                               33517000
         FOR I:=0 STEP 1 UNTIL 4 DO M[X1].[CF]:=X1:=GETAREA(1);         33517500
         M[X1].[24:1]:=1;                                               33518000
    END;                                                                33518500
%                                                                       33518600
%   THE STEPS TAKEN TO INTIALIZE ARE:                                   33518650
%     1. MAKE SURE THAT THE TANKS ARE OK.                               33518700
%     2. INITIALIZE THE DCP IF IT IS NOT RUNNING.                       33518750
%     3. INITIALIZE THE LINES AND STATIONS.                             33518800
%     4. CLEAN UP STATABLE.                                             33518850
%                                                                       33519000
    X2:=SPACE(10);                                                      33519500
    NOGO:=(SYSDISKADR=0);                                               33520000
    IF PROGTANK=0 THEN NOGO:=NOGO OR                                    33520500
    (PROGTANK:=GETUSERDISK((STAMAX+1)|CLUMPSIZE OR MEMORY))=0;          33521000
    IF TANKADDRESS=0 THEN NOGO:=NOGO OR                                 33521500
    (TANKADDRESS:=GETUSERDISK((STAMAX+1)|GLOMSIZE OR MEMORY))=0;        33522000
    IF BASEDISKADR=0 THEN NOGO:=NOGO OR                                 33522500
    (BASEDISKADR:=GETUSERDISK(-TANKCHUNKSIZE OR MEMORY))=0;             33523000
    IF NOGO THEN                                                        33523500
    BEGIN STREAM(X2);                                                   33524000
         DS:=33 LIT"-*NO USER DISK FOR DATACOM TANKS~";                 33524500
         GO TO SPOUTER;                                                 33525000
    END;                                                                33525500
%                                                                       33526000
    DISKWAIT(-(B:=SPACE(30)),30,DCPDSK);                                33526500
    MULTITABLE[30]:=M[B+3|SYSNO+1];                                     33527000
    LABELTABLE[30]:=-M[B+3|SYSNO+2];                                    33527500
    IF DCPTOG THEN FORGETSPACE(X2) ELSE                                 33528000
    BEGIN                                                               33528500
%                                                                       33528600
%   THE DCP BOOTSTRAP LOADER IS LOADED INTO X3. THE CODE IS READ IN     33528650
%   300 WORD BLOCKS INTO X6. THE DCP USES 1:7 OF @202 FOR               33528700
%   COMMUNICATION AS FOLLOWS:                                           33528750
%     =1  LOAD NEXT BLOCK INTO X6.                                      33528800
%     =3  FAULT OCCURRED.                                               33528850
%     =7  LOAD COMPLETED.                                               33528900
%                                                                       33528950
         DISKWAIT(-B,30,M[B+SYSNO|3].[18:15]);                          33529000
         DISKWAIT(-(X3:=SPACE(60)),60,M[X:=B+10]+10);                   33529500
         P(M[3]);                                                       33530000
         M[3]:=FLAG(@0400003244000031&X3[8:33:8]&X3[32:41:7]);          33530500
         M[4]:=@2000020013600000;                                       33531000
         I:=11;                                                         33531500
         X4:=(X5:=(TNAOG[0]:=M[X])+14)+M[B+8]-14;                       33532000
         X6:=SPACE(300);                                                33532500
L2:                                                                     33533000
         DISKWAIT(-X6,300,X5);                                          33533500
L3:      IF I=11 THEN                                                   33534000
         BEGIN IF NOT DCPLOAD THEN SLEEP([TOGLE],DCPLOADMASK);          33534500
              DCPLOAD:=0;                                               33535000
              HALTDCP;                                                  33535500
              CLICK:=CLOCK+P(RTR)+1;                                    33536000
              SLEEP(0,0);                                               33536500
              A:=DCPARRAY;                                              33537000
              DCPARR:=(DCPARRAY INX 0)&X6[9:33:15];                     33537500
              INITIATEDCP;                                              33538000
         END ELSE BEGIN DCPARR.[1:7]:=0; SETATTENTION END;              33538500
         CLICK:=CLOCK+P(RTR)+120;                                       33539000
         SLEEP([DCPARR],DCPMASK);                                       33539500
%                                                                       33540000
         IF I=11 THEN P(3,STD);                                         33540500
         IF NOGO:=((X1:=DCPARR.[1:7]) = 0) THEN                         33541000
         BEGIN STREAM(X2); DS:=16 LIT"-*DCP NOT READY~";                33541500
              GO TO XOUT;                                               33542000
         END;                                                           33542500
         IF NOGO:=(X1=3) THEN                                           33543000
         BEGIN STREAM(X2); DS:=18 LIT"DCP FAULT ON LOAD~";              33543500
              GO TO XOUT;                                               33544000
         END;                                                           33544500
%                                                                       33545000
         IF X1=1 THEN                                                   33545500
         BEGIN I:=I+5;                                                  33546000
              IF (X5:=X5+10) GTR X4 THEN                                33546500
              BEGIN DISKWAIT(-X6,X1:=30|(X4-X5+10),X5-10);              33547000
                   IF I-5+X1/60 LSS M[B+7] THEN                         33547500
                   BEGIN DISKWAIT(-(X6+X1),300-X1,M[X:=X+1]);           33548000
                        X4:=M[X]+M[B+8];                                33548500
                        X5:=M[X]+10-X1/30;                              33549000
                        GO TO L3;                                       33549500
                   END ELSE GO TO L3;                                   33550000
              END ELSE                                                  33550500
              IF X5=X4 THEN X4:=(X5:=M[X:=X+1])+M[B+8];                 33551000
              GO TO L2;                                                 33551500
         END;                                                           33552000
%                                                                       33552500
         DCPTOG:=1;                                                     33553000
         STREAM(X2); DS:=16 LIT"DCP INITIALIZED~";                      33553500
XOUT:                                                                   33554000
         DCPARRAY:=A;                                                   33554500
         DCPLOAD:=1;                                                    33555000
         FORGETSPACE(X6);                                               33555500
         FORGETSPACE(X3);                                               33556000
SPOUTER:                                                                33556500
         SPOUT(X2);                                                     33557000
         IF NOGO THEN                                                   33557500
         BEGIN FORGETSPACE(B);                                          33558000
              MULTITABLE[30]:=@114;                                     33558500
              LABELTABLE[30]:=0;                                        33559000
              GO TO EXIT;                                               33559500
         END;                                                           33560000
    END;                                                                33560500
    MYREQUEST:=(RESULTQ:=REQUESTQ:=QMASK)&[MYREQUEST][9:33:15];         33561000
    X1:=DCPSPACEQ:=GETAREA(1); BUILDSQ;                                 33561500
%                                                                       33561600
%   INITIALIZE THE QUEUES AND LINETABLE. LINETABLE IS ADJUSTED TO FIT   33561700
%   THE DECLARED NUMBER OF LINES.                                       33561800
%                                                                       33561900
    X1:=SPACEQ:=GETAREA(1); BUILDSQ;                                    33562000
    A:=IOQUE&B[CTC];                                                    33562500
    DISKWAIT(-B,30,TNAOG[0]);                                           33563000
    IF (X:=A[0]) GTR 256 THEN X:=256;                                   33563500
    IF (X1:=(X+3).[40:6]) LEQ ((X2:=M[X3:=LINETABLE-2].[CF] -           33564000
      LINETABLE.[CF]) - DELTA) THEN                                     33564500
    BEGIN X2:=(LINETABLE:=M[X3].[CF]-X1)-2;                             33565000
         M[M[X2]:=M[X3]&X3[CTF]].[FF]:=X2;                              33565500
         M[X3].[CF]:=X2;                                                33566000
         FORGETSPACE(X3+2);                                             33566500
    END ELSE                                                            33567000
    IF X1 GTR X2 THEN                                                   33567500
    BEGIN FORGETSPACE(LINETABLE);                                       33568000
         LINETABLE:=GETSPACE(X1,0,1)+2;                                 33568500
         MOVE(X1,LINETABLE-1,LINETABLE);                                33569000
    END;                                                                33569500
    LINETABLE:=LINETABLE&(X:=X-1)[18:40:8];                             33570000
%                                                                       33570100
%   LINE INTIALIZATION PROCEDES BY                                      33570150
%   1. INTERROGATE EACH LINE.                                           33570200
%   2. AS THE INTERROGATES RETURN IF                                    33570250
%      A. THE LINE IS CONNECTED, READY THE STATIONS AND ASK FOR THE     33570300
%         USERCODE,                                                     33570350
%      B. THE LINE IS DISCONNECTED, QUEUE A LOOKFORRING.                33570400
%   FOR CONNECTED LINES WE SEARCH STATABLE TO LINK UP THE STATIONS      33570450
%   BELONGING TO THAT LINE.                                             33570500
%                                                                       33570550
    L:=-1;                                                              33571000
    C:=0&1[24:47:1]&[C][9:33:15];      % Q OF RESULTS SAVED FOR HANDLER 33571500
INTERR:                                                                 33572000
    IF  BIGUNS LEQ BIGUNMIN+1 OR L=X THEN                               33572500
      COMPLEXSLEEP(NOT RESULTQ.[24:1]) ELSE                             33573000
    BEGIN M[(X2:=GETAREA(0))+1]:=0&INTERROGATESTATUS[1:41:7]&           33573500
             (L:=L+1)[24:40:8];                                         33574000
          DCPQ(X2);                                                     33574500
CHECKIT:                                                                33575000
         IF RESULTQ.[24:1] THEN GO  TO INTERR;                          33575500
    END;                                                                33576000
%                                                                       33576500
    RESULTQ:=M[R:=RESULTQ.[CF]];                                        33577000
    IF (X2:=(I:=M[R+1]).[1:7]) ! INTERROGATESTATUS AND                  33577500
      X2 ! ENTERNORMALMODE THEN                                         33578000
    IF X2=SETSTATIONREADY OR X2=ENABLEINPUT OR M[R].[5:1] THEN          33578500
    BEGIN FORGETAREA(M[R].[2:2],R);                                     33579000
         GO CHECKIT;                                                    33579500
    END ELSE                                                            33580000
    IF M[R+2].CONTROL THEN                                              33580500
    BEGIN M[R+1]:=(*P(DUP))&P(0,XCH)[24:24:16]&ENTERNORMALMODE[1:41:7]; 33581000
         DCPQ(R);                                                       33581500
         GO CHECKIT;                                                    33582000
    END ELSE                                                            33582500
    BEGIN M[M[C.[9:15]]:=(*P(DUP))&R[24:24:24]].[24:1]:=1;              33583000
         C.[9:15]:=R;                                                   33583500
         GO CHECKIT;                                                    33584000
    END;                                                                33584500
%                                                                       33585000
    I:=I.[24:8];                                                        33585500
    IF M[R+2].CONNECTED THEN                                            33586000
    BEGIN X1:=A[X6:=(I+1) MOD 30];                                      33586500
         X2:=0;                                                         33587000
         FOR X4:=1 STEP 1 UNTIL STAMAX DO                               33587500
         IF (X5:=STATABLE[X4]).DIALEDUP AND NOT X5.[20:1] THEN          33588000
         IF X5.[24:8]=I THEN                                            33588500
         IF X5.[32:8] LSS X1.[CF] THEN                                  33589000
         BEGIN STATABLE[X4]:=0&X5[24:24:16]&3[15:46:2]&X1[11:21:2]      33589500
              &X2[40:40:8]&(CANDYINX+32)[4:42:6];                       33590000
              X2:=X4;                                                   33590500
         END;                                                           33591000
         IF X2!0 THEN                                                   33591500
         STREAM(X2,D:=(LINETABLE+I.[40:6])&I[30:46:2]);                 33592000
         BEGIN SI:=LOC X2; SI:=SI+6;                                    33592500
              DS:=2 CHR;                                                33593000
         END;                                                           33593500
         FOR X4:=0 STEP 1 UNTIL M[R+2].[16:8] DO                        33594000
         BEGIN M[X3:=GETAREA(0)]:=0&1[5:47:1];                          33594500
              M[X3+1]:=X5:=0&1[23:47:1]&I[24:40:8]&X4[32:40:8]&         33595000
                SETSTATIONREADY[1:41:7];                                33595500
              DCPQ(X3);                                                 33596000
              M[X3:=GETAREA(0)]:=0&1[5:47:1];                           33596500
              M[X3+1]:=X5&ENABLEINPUT[1:41:7];                          33597000
              DCPQ(X3);                                                 33597500
              STREAM(D:=(X3:=GETAREA(1))+3);                            33598000
              BEGIN DS:=28 LIT"!-!*P!*L!*O!*P!*RESTARTING..";           33598500
                   DS:=28 LIT"!-!*ENTER USER CODE, PLEASE-";            33599000
              END;                                                      33599500
              M[X3]:=0&5[3:45:3];                                       33600000
              M[X3+1]:=56&X5[24:24:16]&OUTPUT[1:41:7];                  33600500
              DCPQ(X3);                                                 33601000
         END;                                                           33601500
    END ELSE                                                            33602000
    BEGIN M[X3:=GETAREA(0)]:=0&1[5:47:1];                               33602500
         M[X3+1]:=0&I[24:40:8]&LOOKFORRING[1:41:7];                     33603000
         DCPQ(X3);                                                      33603500
    END;                                                                33604000
    FORGETAREA(M[R].[2:2],R);                                           33604500
    IF I!X THEN                                                         33605000
    BEGIN IF X6=29 THEN DISKWAIT(-B,30,TNAOG[0]+1+I DIV 30);            33605500
         GO CHECKIT;                                                    33606000
    END;                                                                33606500
%                                                                       33607000
    IF NOT RESULTQ.[24:1] THEN M[C.[9:15]].[24:24]:=RESULTQ;            33607500
    RESULTQ:=C;                                                         33608000
    FORK(P(.DCPHANDLER),0,-3,9,WORKERSTACK.[FF]);                       33608500
%                                                                       33608600
%   CLEAN UP ANY STATIONS WHICH WERE ACTIVE WHEN THE DCP STOPPED        33608700
%   (OR BEFORE THE H/L) BUT ARE NOT ACTIVE NOW. BIT 22:1 IS TURNED      33608800
%   ON BY CREATELOG AND OFF WHEN AN ACTIVE STATION IS FOUND             33608900
%   IN THE CODE ABOVE.                                                  33609000
%                                                                       33609100
    FOR I:=1 STEP 1 UNTIL STAMAX DO                                     33609500
    IF (X:=STATABLE[I]).[22:1] AND X.DIALEDUP THEN                      33610000
    BEGIN SYSDISKIO(3,-I,A);                                            33610500
         STATABLE[I]:=A[0]:=A[1]:=0;                                    33611000
         SYSDISKIO(0,-I,A);                                             33611500
    END;                                                                33612000
    FORGETSPACE(A);                                                     33612500
EXIT:                                                                   33613000
    KILL([RCW] INX NOT 2);                                              33613500
END OF DCP INITIALIZATION;                                              33614000
REAL PROCEDURE FINDOUTPUT(MID,FID,TYPE,FORMS,REEL,CDATE,CYCLE,KIND);%   37000000
            VALUE MID,FID,TYPE,FORMS,REEL,CDATE,CYCLE;%                 37001000
            REAL  MID,FID,TYPE,FORMS,REEL,CDATE,CYCLE,KIND;%            37002000
BEGIN INTEGER GOTL,GOTT,GOTB,GOTP,GOTC;                                 37003000
      REAL U;                                                           37003100
      LABEL EXIT,SW,ON,OWT,AROUND,OUKID,X,ROUND,CLAIMT,THERE,SOMEWHERE; 37004000
      LABEL W1,W2,W3,W4,W5,W6,W7;                                    %P 37005000
      DEFINE DSED=(TERMSET(P1MIX))#;                                    37006000
      LABEL CP,MT,SU,PP,CKFM,DOITOVER;                               %P 37007000
      DEFINE PNTOG=(TYPE=0 OR TYPE GEQ 20)#;                            37007100
      SWITCH TYPESW~CP,ROUND,MT,SU,ROUND,SU,ROUND,PP,PP,MT;          %P 37008000
      REAL SUBROUTINE PRINTER;%                                         37009000
      BEGIN IF LABELTABLE[20]=0 THEN BEGIN U~20; P(1) END ELSE%         37010000
            IF LABELTABLE[21]=0 THEN BEGIN U~21; P(1) END ELSE P(0);%   37011000
            PRINTER~GOTL~P;%                                            37012000
      END PRINTER;%                                                     37013000
      REAL SUBROUTINE PTPUNCH;%                                         37014000
      BEGIN IF LABELTABLE[26]=0 THEN BEGIN U~26; P(1) END ELSE%         37015000
            IF LABELTABLE[29]=0 THEN BEGIN U~29; P(1) END ELSE P(0);%   37016000
            PTPUNCH~GOTP~P;%                                            37017000
      END PTPUNCH;%                                                     37018000
      REAL T1,T2,T3;%                                                   37019000
      REAL SUBROUTINE PUNCH;%                                           37019100
      BEGIN IF LABELTABLE[22]=0 THEN BEGIN U~22;P(1) END ELSE P(0);     37019200
            PUNCH~GOTC~P;                                               37019300
      END PUNCH;                                                        37019400
      REAL SUBROUTINE MAGTAPE;%                                         37020000
      BEGIN IF NOT(GOTL OR GOTB OR GOTC) THEN%                          37021000
      BEGIN IF T1!0 THEN%                                               37022000
            BEGIN FOR U~0 STEP 1 UNTIL 15 DO%                           37023000
                  IF (MULTITABLE[U] EQV T1)=NOT 0 THEN%                 37024000
                  IF LABELTABLE[U]<0 THEN%                              37025000
                  IF RDCTABLE[U].[8:6]=P1MIX THEN%                      37026000
                  IF (T3~PRNTABLE[U])<0 THEN%                           37027000
                  IF M[M[T3.[15:15]-3] INX 5].[41:1] THEN%              37028000
                  BEGIN P(1); GO OWT END;%                              37029000
            END;%                                                       37030000
            FOR U~0 STEP 1 UNTIL 15 DO%                                 37031000
            IF LABELTABLE[U]=0 AND PRNTABLE[U].[1:1]                %R9137032000
               THEN BEGIN P(1); GO OWT; END;                        %R9137032100
      END;%                                                             37033000
            P(0);%                                                      37034000
      OWT:  MAGTAPE~GOTT~P;%                                            37035000
      END MAGTAPE;%                                                     37036000
      SUBROUTINE BADFM;     %BUILD AND SPOUT BAD FM MESSAGE %           37036100
      BEGIN                                                  %RHR       37036200
           T1~GETSPACE(10,0,0)+2;                            %RHR       37036300
           STREAM(A~TINU[U],MX~P1MIX,T1);                    %RHR       37036400
           BEGIN DS~19 LIT "INVALID INPUT UNIT ";            %RHR       37036500
                SI~LOC MX; DS~2 DEC; DS~2 LIT"FM";           %RHR       37036600
                SI~LOC A; SI~SI+5; DS~3 CHR;                 %RHR       37036800
                DS~LIT "~"; DI~DI-8; DS~FILL;                %RHR       37036900
           END; SPOUT(T1);                                   %RHR       37037000
           LABELTABLE[U]~@114; READY~READY AND (U~NOT TWO(U));          37037100
           RRRMECH~RRRMECH AND U; SAVEWORD~SAVEWORD AND U;   %RHR       37037200
      END BADFM SUBROUTIN;                                   %RHR       37037300
      REAL SUBROUTINE BKUPTAPE;%                                        37038000
      BEGIN IF NOT(GOTL OR GOTC) THEN                                   37039000
            FOR U~0 STEP 1 UNTIL 15 DO%                                 37040000
            IF (LABELTABLE[U] EQV T3)=NOT 0 THEN%                       37041000
            IF (MULTITABLE[U] EQV T2)=NOT 0 THEN%                       37042000
            BEGIN P(1); GO AROUND END;%                                 37043000
            P(0);%                                                      37044000
AROUND:     BKUPTAPE~GOTB~P;%                                           37045000
      END BKUPTAPE;%                                                    37046000
      IF TYPE>1 AND TYPE!4 AND TYPE!6 AND TYPE<15 THEN GO SOMEWHERE;    37046020
 ROUND:  IF TYPE=1 OR TYPE=4 OR (TYPE>16 AND TYPE<19) THEN              37046040
         IF PRINTER THEN BEGIN KIND~1; GO CKFM END;                  %P 37046060
         IF TYPE=0 OR (TYPE>20 AND TYPE) THEN                           37046070
         IF PUNCH THEN BEGIN KIND~6; GO X END;                          37046075
         IF TYPE=4 OR TYPE=6 OR TYPE=16 OR TYPE=18 OR                   37046080
         (TYPE GEQ 20 AND NOT TYPE.[46:1]) THEN                         37046090
         BEGIN T1~0; T2~IF TYPE GEQ 20 THEN "PUTMCP " ELSE "PBTMCP ";   37046100
               T3~@122212342546447;                                     37046110
               IF BKUPTAPE THEN GO THERE;                            %P 37046120
               IF MAGTAPE THEN                                       %P 37046140
CLAIMT:       BEGIN MULTITABLE[U]~T2; LABELTABLE[U]~-T3;             %P 37046160
                   RDCTABLE[U].[8:6]~P1MIX;                             37046162
                   RRRMECH~TWO(U) OR RRRMECH;                        %P 37046170
                   T1 := SPACE(10)+2;                                   37046180
                        STREAM(U:=TINU[U],N:=PRNTABLE[U].[30:18],       37046190
                             A~REEL,B~DATE,C~CYCLE,D~0,PN~TYPE GEQ 20,  37046192
                             T~T1-2);                                   37046194
                   BEGIN DS~12LIT" NEW PBT ON"; SI~LOC U; SI~SI+5;   %P 37046200
                             PN(D~DI; DI~DI-6; DS~2LIT"UT"; DI~D);      37046205
                        DS~3 CHR;DS~25LIT"~ LABEL  0PBTMCP 0BACK-UP";%P 37046210
                             PN(D~DI; DI~DI-14; DS~2LIT"UT"; DI~D);     37046212
                             SI := LOC A; DS := 3 DEC;                  37046215
                             SI~SI+3; DS~5 CHR; SI~SI+6;DS~2 CHR;       37046217
                             15(DS:=2 LIT"0");DI:=DI-11;SI:=LOC N;      37046220
                             DS:=5 DEC;                                 37046221
                   END;                                              %P 37046240
                   P(WAITIO(T1&8[8:38:10]&5[21:45:3],0,U),DEL);      %P 37046260
                   SPOUT(T1-2)    ; T1.[1:11]~@1737;                 %P 37046280
                   P(WAITIO([T1],0,U),DEL);                          %P 37046300
THERE:             LABELTABLE[U].[1:5]~@20; KIND~7; GO EXIT          %P 37046320
         END; END;                                                   %P 37046340
      IF (TYPE GEQ 15 AND TYPE LEQ 18) OR TYPE GEQ 22 THEN              37046360
         BEGIN                                                          37046380
              IF NOT HOLDFREE THEN SLEEP([TOGLE],HOLDMASK);             37046385
              HOLDFREE~0;                                            %P 37046390
              T1 := SPACE(30);  T2 := 0;                                37046400
              DISKWAIT(-T1,-30,DIRECTORYTOP);                           37046420
 DOITOVER:    STREAM(D~T1+8,A~1,T~[T3]);                             %P 37046460
              BEGIN SI~D; DS~WDS; SI~LOC A; DI~D; DS~8 ADD;          %P 37046465
                    DI~DI-8; DS~4 LIT"0";                            %P 37046470
              END; IF T3=0 THEN GO DOITOVER;                         %P 37046475
              DISKWAIT(T1,-30,DIRECTORYTOP);                            37046480
              HOLDFREE:=1;                                              37046500
              KIND:=12; U:=T1;                                          37046510
              STREAM(T3,T1);                                            37046520
              BEGIN                                                     37046530
                   DS~8 LIT"0@+1.013";DS~24 LIT"0";                     37046540
                   DS:=7 LIT"8400000";DS:=10 LIT"0";                    37046560
                   SI~LOC T3;SI~SI+4;DS~4 CHR;DS~3 LIT"001";            37046580
                   46(DS~4 LIT"0");                                     37046600
              END;            M[T1+1]~M[T1+8]~900  ;                 %P 37046620
$ INCLUDE 37046626, IF SHAREDISK;                                       37046624
              M[T1+4].[4:2]:=SYSNO;                                     37046625
              M[T1+5]~MID&(TYPE GEQ 22)[3:47:1]; % PNCH BK UP TOG       37046630
              M[T1+3] := XCLOCK + P(RTR);                               37046635
              GO EXIT                                                %P 37046640
         END;                                                        %P 37046660
 W3:     FILEMESS("#.. ..."&(IF TYPE=6 OR TYPE=20 THEN "   " ELSE       37046680
                  (IF PNTOG THEN "CP" ELSE "LP"))[12:36:12]             37046690
                  &(IF TYPE<2 THEN "   " ELSE IF TYPE GEQ 20 THEN       37046700
                  "PUT" ELSE "PBT")[30:30:18],                          37046710
                  (IF TYPE<2 THEN "RQD    " ELSE " MT RQD"),MID,FID,    37046720
                  REEL,CDATE,CYCLE); REPLY[P1MIX]~-@31204;              37046740
         IF [MEM[P1MIX,MLINK1]].[CF]}FENCE THEN SWAP(WAITSWAP,1);       37046750
         COMPLEXSLEEP(((IF (TYPE!6 AND TYPE!20) THEN IF PNTOG THEN      37046760
                  PUNCH ELSE PRINTER ELSE 0) OR REPLY[P1MIX]            37046770
                  >0 OR(IF TYPE>1 THEN BKUPTAPE OR MAGTAPE ELSE 0) OR   37046780
                        DSED)); IF DSED THEN GO INITIATE;            %P 37046800
         IF NOT(GOTB OR GOTT OR GOTL OR GOTC) THEN                      37046820
         BEGIN IF NOT WHYSLEEP(@31204) THEN GO TO W3;                   37046840
              IF REPLY[P1MIX]=4 THEN GO TO W3;                          37046850
              IF PNTOG THEN BEGIN U~REPLY[P1MIX].[FF]; GO CP END;       37046855
 OUKID:       TYPE~IF (U~REPLY[P1MIX].[FF])=1 THEN 4 ELSE            %P 37046860
                   IF U=2 THEN 1 ELSE IF U=3 THEN 6 ELSE 15;            37046880
              REPLY[P1MIX]~0; GO  ROUND;                             %P 37046900
         END; REPLY[P1MIX]~0;                                        %P 37046920
         IF GOTB THEN GO THERE ELSE IF GOTT THEN GO CLAIMT ELSE         37046940
         IF GOTC THEN KIND~6 ELSE KIND~1;                               37046950
 CKFM:   IF FORMS THEN                                               %P 37046960
         BEGIN LABELTABLE[U]~-FID; MULTITABLE[U]~MID;                %P 37046980
              RDCTABLE[U].[8:6]~P1MIX;                                  37046990
 W7:          FILEMESS("#... FM"&TINU[U][12:30:18],"RQD    ",        %P 37047000
              MID,FID,REEL,CDATE,CYCLE); REPLY[P1MIX]~-@5030412;        37047100
              IF [MEM[P1MIX,MLINK1]].[CF]}FENCE THEN                    37047110
                   SWAP(WAITSWAP,1) ELSE                                37047120
              COMPLEXSLEEP((REPLY[P1MIX]>0 OR DSED));                %P 37047200
              IF REPLY[P1MIX]=4 THEN GO EXIT;                        %P 37047300
              IF NOT WHYSLEEP(@5030412) THEN GO W7;          %RHR       37047400
              KIND~LABELTABLE[U]~MULTITABLE[U]~GOTL~RDCTABLE[U]~U~0;    37047500
              IF NOT DSED THEN IF REPLY[P1MIX].[CF]=5 THEN   %RHR       37047600
              IF(U~REPLY[P1MIX].[FF])!20 AND U!21 THEN       %RHR       37047605
              BEGIN BADFM; GO ROUND END ELSE                 %RHR       37047610
              BEGIN LABELTABLE[U]~-FID; RDCTABLE[U].[8:6]~P1MIX;        37047625
                   MULTITABLE[U]~MID; KIND~UNIT[U].[1:4];    %RHR       37047650
                   GO EXIT;                                  %RHR       37047660
              END ELSE GO OUKID;                             %RHR       37047670
         END; GO X;                                                  %P 37047700
 SOMEWHERE: IF FORMS THEN                                            %P 37047800
W1:   BEGIN REPLY[P1MIX]~-@512;%                                        37048000
            FILEMESS("#FM RQD",0,MID,FID,REEL,CDATE,CYCLE);%            37049000
            IF [MEM[P1MIX,MLINK1]]}FENCE THEN SWAP(WAITSWAP,1) ELSE     37049500
            COMPLEXSLEEP((REPLY[P1MIX]>0) OR DSED);%                    37050000
            IF DSED THEN GO TO INITIATE;%                               37051000
            IF NOT WHYSLEEP(@512) THEN GO TO W1;%                       37052000
            U~REPLY[P1MIX].[18:15]; REPLY[P1MIX]~0;%                    37053000
            GO TO X;%                                                   37054000
      END;%                                                             37055000
SW:   GO TO TYPESW[TYPE];%                                              37056000
%                                                                       37057000
CP:   TYPE~IF U=1 THEN 21 ELSE IF U=3 THEN 20 ELSE                      37058000
           IF U=5 THEN 0 ELSE 22; REPLY[P1MIX]~0; GO ROUND;             37059000
%                                                                       37084000
PP:   IF NOT PTPUNCH THEN%                                              37085000
W4:   BEGIN FILEMESS("#PP RQD",0,MID,FID,REEL,CDATE,CYCLE);%            37086000
            IF OUTWAIT(PTPUNCH) THEN GO TO W4;                          37087000
            IF NOT PTPUNCH THEN GO TO W4;                               37088000
      END;%                                                             37093000
      GO TO X;%                                                         37094000
%                                                                       37095000
SU:   T1~FID.[6:18];%                                                   37096000
      FOR U~0 STEP 1 UNTIL 31 DO%                                       37097000
      IF TINU[U].[30:18]=T1 THEN GO ON;%                                37098000
      GO TO MT;%                                                        37099000
ON:   IF LABELTABLE[U]!0 THEN%                                          37100000
W5:   BEGIN FILEMESS("#...   "&T1[12:30:18],"RQD    ",%                 37101000
                     MID,FID,REEL,CDATE,CYCLE);%                        37102000
            IF OUTWAIT(LABELTABLE[U]=0) THEN GO TO W5;                  37103000
            IF LABELTABLE[U]!0 THEN GO TO W5;                           37104000
      END;%                                                             37109000
      GO TO X;%                                                         37110000
%                                                                       37111000
MT:   T1~MID;%                                                          37112000
      IF NOT MAGTAPE THEN%                                              37113000
W6:   BEGIN FILEMESS("#MT RQD",0,MID,FID,REEL,CDATE,CYCLE);%            37114000
            IF OUTWAIT(MAGTAPE) THEN GO TO W6;                          37115000
            IF DSED THEN                                                37115100
              BEGIN                                                     37115200
                   U~-1;                                                37115300
                   GO TO EXIT;                                          37115400
              END;                                                      37115500
            IF NOT MAGTAPE THEN GO TO W6;                               37116000
      END;%                                                             37121000
      IF (T1~PRNTABLE[U].[15:15])!0 THEN%                               37122000
      BEGIN FILECLOSE(T1&3[18:33:15]);%                                 37123000
            M[M[T1-3] INX 5].[39:4]~1;%                                 37124000
      END;%                                                             37125000
%                                                                       37172000
X:    KIND~UNIT[U].[1:4];%                                              37173000
      LABELTABLE[U]~-FID; MULTITABLE[U]~MID;%                           37174000
      RDCTABLE[U]~P(DUP,LOD)&REEL[14:38:10]&CDATE[24:31:17]             37174100
                   &CYCLE[41:41:7]&P1MIX[8:42:6];                       37174200
EXIT: FINDOUTPUT~U;%                                                    37175000
END FINDOUTPUT;%                                                        37176000
REAL PROCEDURE FINDINPUT(MID,FID,REEL,CDATE,CYCLE,COBOL,UL,OF,MODE,FN); 37177000
                  VALUE  MID,FID,REEL,CDATE,CYCLE,COBOL,   OF,MODE,FN;% 37178000
                  REAL   MID,FID,REEL,CDATE,CYCLE,COBOL,UL,OF,MODE,FN;% 37179000
BEGIN REAL T1,U,LO,HI,FIRST,IL;                                         37180000
      DEFINE DSED=(TERMSET(P1MIX))#;                                    37181000
      LABEL SXIT,LOOK,EXIT,START,REW,READALABEL;%                       37182000
      DEFINE UNLABELED=UL#;%                                            37183000
      LABEL WHY;%                                                       37184000
      INTEGER S;%                                                       37185000
       INTEGER USASI;                                                   37185050
      INTEGER COUNT;                                                    37185100
      LABEL X,Y;                                                        37185200
      SUBROUTINE CHECKTERMIX;                                           37185310
      BEGIN                                                             37185320
         IF DSED THEN                                                   37185330
         BEGIN                                                          37185340
              IF (JAR[P1MIX,0] EQV "LIBMAIN")=NOT 0 AND                 37185350
                 (JAR[P1MIX,1] EQV "DISK   ")=NOT 0  THEN               37185360
              BEGIN                                                     37185370
                   U~-1;                                                37185380
                   GO TO EXIT;                                          37185390
              END ELSE GO TO INITIATE;                                  37185400
         END;                                                           37185410
      END;    %   CHECKTERMIX                                           37185420
      REAL SUBROUTINE SEARCH;%                                          37186000
      BEGIN COUNT~0; IF NOT DSED THEN                                   37187000
            BEGIN LO~0; HI~15;%                                         37188000
      LOOK:       FOR U~LO STEP 1 UNTIL HI DO%                          37189000
                  IF (LABELTABLE[U] EQV FID)=NOT 0 THEN%                37190000
                  IF (MULTITABLE[U] EQV MID)=NOT 0 THEN%                37191000
                  IF ((T1~RDCTABLE[U]).[14:10]=REEL) OR (REEL=0) THEN%  37192000
                  IF (T1.[24:17]=CDATE) OR (CDATE=0) THEN%              37193000
                  IF (T1.[41:7]=CYCLE) OR (CYCLE=0) THEN%               37194000
                  BEGIN COUNT~COUNT+1; P(U,XCH) END;                    37195000
                  IF HI<24 THEN BEGIN LO~23; HI~24; GO LOOK END;%       37196000
                  IF HI<35 THEN BEGIN LO~32; HI~35; GO LOOK END;        37196100
                  IF COUNT=0 THEN                                       37196200
                  IF MID!0 THEN%                                        37197000
                  IF NOT CDATE.[1:1] THEN % NOT LIBMAIN/DISK            37197500
                  FOR U~0 STEP 1 UNTIL 15 DO%                           37198000
                  IF (MULTITABLE[U] EQV MID)=NOT 0 THEN%                37199000
                  IF (RDCTABLE[U].[24:17]=CDATE) OR (CDATE=0) THEN      37199100
                  IF LABELTABLE[U]>0 THEN%                              37200000
                  BEGIN COUNT~COUNT+1;                                  37201000
                        P(U,XCH);                                       37202000
                  END ELSE%                                             37203000
                  IF RDCTABLE[U].[8:6]=P1MIX THEN%                      37204000
                  IF (T1~M[M[PRNTABLE[U].[15:15]-3] INX 5]).[41:1] THEN 37205000
                       IF T1.[43:1] OR T1.[40:1]=0 THEN%                37206000
                  BEGIN COUNT~COUNT+1; P(U,XCH) END;                    37207000
            END;                                                        37208000
            SEARCH~S~COUNT>0;                                           37209000
      END SEARCH;%                                                      37210000
      REAL SUBROUTINE RESEARCH;                                         37210100
      BEGIN P(SEARCH); DO P(DEL) UNTIL (COUNT~COUNT-1)<0;               37210200
            RESEARCH~S;                                                 37210300
      END RESEARCH;                                                     37210400
      REAL SUBROUTINE REED;%                                            37211000
      BEGIN IF (HI~WAITIO(T1,LO&@377[18:33:15],U) AND @367)!0 THEN      37212000
            IF (HI AND NOT LO)!0 THEN                                   37213000
      BEGIN BLASTQ(U); SETNOTINUSE(U,0); STOPTIMING(FN,1023);           37214000
                  FILEMESS(-"PARITY ","ON ... "&TINU[U][24:30:18],%     37215000
                           MID,FID,REEL,CDATE,CYCLE);%                  37216000
            END;%                                                       37217000
            IF DSED THEN                                                37218000
            BEGIN                                                       37218100
              SETNOTINUSE(U,0);                                         37218200
              STOPTIMING(FN,1023);                                      37218300
              CHECKTERMIX;                                              37218400
            END;                                                        37219000
            REED~HI;%                                                   37220000
      END REED;%                                                        37221000
START:%                                                                 37222000
      IF UL THEN GO TO WHY ELSE %                                       37222500
      IF NOT SEARCH THEN%                                               37223000
WHY:  BEGIN FILEMESS("#NO FIL",0,MID,FID,REEL,CDATE,CYCLE);%            37224000
            FIRST~(((56|UL+OF)|512|ABS(COBOL)+2)|64+12)|64+10;          37225000
            FIRST~64|FIRST+4;                                           37225100
            REPLY[P1MIX]~-FIRST;%                                       37226000
            IF[MEM[P1MIX,MLINK1]].[CF]}FENCE THEN                       37226100
                  SWAP(WAITSWAP,1);                                     37226200
            COMPLEXSLEEP(RESEARCH OR (REPLY[P1MIX]>0) OR DSED);         37227000
            CHECKTERMIX;                                                37228000
            IF S THEN S~SEARCH ELSE                                     37229000
      BEGIN IF NOT WHYSLEEP(FIRST) THEN GO TO WHY;%                     37230000
            T1~REPLY[P1MIX];%                                           37231000
             IL:=T1.[33:15]=2;                                          37231100
            IF T1=4 THEN GO TO Y;                                       37231500
            BEGIN IF T1.[33:15]!2 THEN BEGIN U~-1; REPLY[P1MIX]~0;%     37232000
                                             GO TO EXIT;%               37233000
                                       END;%                            37234000
                  UNLABELED~-LABELTABLE[U~T1.[18:15]]=@314;%            37235000
                  COUNT~1; P(U);                                        37235100
                  IF LABELTABLE[U]=0 THEN%                              37236000
                  BEGIN MULTITABLE[U]~MID; LABELTABLE[U]~FID END;%      37237000
      END   END;%                                                       37238000
            REPLY[P1MIX]~0;%                                            37239000
      END;%                                                             37240000
      IF COUNT>1 THEN                                                   37240100
SXIT: BEGIN FILEMESS("#DUP   ","FIL    ",MID,FID,REEL,CDATE,CYCLE);     37240200
            WHILE (COUNT~COUNT-1)}0 DO                                  37240300
            BEGIN IF (U~P)<16 THEN IF MID!0 THEN                        37240400
                  IF (T1~PRNTABLE[U].[15:15])!0 THEN                    37240500
                     FILECLOSE(T1&@12[18:33:15]);                       37240600
                  STREAM(X:=[TINU[U]]: D:=S:=SPACE(10));                37240700
                  BEGIN SI~X; SI~SI+5; DS~8 LIT " DUP ON ";             37240800
                        DS~3 CHR; DS~LIT "~";                           37240900
                        X~DI;                                           37240910
                  END;                                                  37241000
                  T1~P;                                                 37241010
                  IF U}32 THEN IF CIDROW[U   -32]!0 THEN                37241020
                        STREAM(DK~CIDTABLE[U   -32,2],T1);              37241030
                             BEGIN DI~DI-1; DS~6 LIT ",DECK ";          37241040
                             SI~LOC DK; SI~SI+1; DS~7 CHR;              37241050
                             END;                                       37241060
                  SPOUT(S);                                             37241100
            END;                                                        37241200
            REPLY[P1MIX]:= -@20412;                                     37241300
            IF[MEM[P1MIX,MLINK1]].[CF]}FENCE THEN                       37241310
              SWAP(WAITSWAP,1) ELSE                                     37241320
            COMPLEXSLEEP(DSED OR (REPLY[P1MIX]>0));                     37241400
            CHECKTERMIX;                                                37241500
            IF (T1~REPLY[P1MIX]).[33:15]=2 THEN                         37241510
              BEGIN REPLY[P1MIX]~0;                                     37241520
                    P(T1.[18:15]);                                      37241530
                    GO TO X;                                            37241540
              END;                                                      37241550
            IF NOT WHYSLEEP(@412) THEN BEGIN S~SEARCH; GO TO SXIT END;  37241600
Y:          REPLY[P1MIX]~0; GO TO START;                                37241700
      END;                                                              37241800
X:                                                                      37241810
      LABELTABLE[U~P].[1:5]~@20;                                        37241900
      RDCTABLE[U].[8:6]~P1MIX;                                          37241910
      IF U<16 THEN IF MID!0 THEN%                                       37242000
      BEGIN IF (T1~PRNTABLE[U].[15:15])!0 THEN%                         37243000
            BEGIN FILECLOSE(T1&3[18:33:15]);%                           37244000
                  M[M[T1-3] INX 5].[39:4]~1;%                           37245000
            END;%                                                       37246000
%                                                                       37247000
            RRRMECH~TWO(U) OR RRRMECH; STARTIMING(FN,U);                37248000
             IF UNLABELED OR IL THEN GO TO EXIT;                        37248500
            T1 := SPACE(11)&10[8:38:10]&MODE[21:47:1]                   37249000
               &3[23:46:2];%                                            37250000
            LO~@40; FIRST~1;%                                           37251000
READALABEL: IF REED ! 0 THEN IF FIRST THEN%                             37252000
REW:        BEGIN FIRST~WAITIO(@4200000000,0,U); GO READALABEL END ELSE 37253000
            BEGIN SETNOTINUSE(U,1); FORGETSPACE(T1.[33:15]);            37254000
                  STOPTIMING(FN,1023); GO TO START END;                 37255000
            STREAM(Y:=0:X:=0,T1);                                       37255100
                BEGIN  DI:=LOC X; DS:=8 LIT "VOL1HDR1";                 37255200
                       SI:=T1; DI:=DI-8;                                37255300
                      IF 4 SC=DC THEN TALLY:=1 ELSE                     37255400
                    BEGIN  SI:=T1; IF 4 SC=DC THEN TALLY:=2; END;       37255500
                       Y:=TALLY;                                        37255700
                END;                                                    37255800
             IF(USASI:=P)>0 THEN USASITAPE(T1.[CF],USASI,2,U,0);        37255900
            STREAM(M~0,F~0,R~0,D~0,C~0:S~T1 INX 1);%                    37256000
            BEGIN SI~S; DI~LOC M; DS~2 WDS; DS~3 OCT;%                  37257000
                  DS~5 OCT; DS~2 OCT;%                                  37258000
            END;%                                                       37259000
            IF (P=CYCLE OR CYCLE=0) AND (P(XCH)=CDATE OR CDATE=0) AND%  37260000
               (P(XCH)=REEL OR REEL=0)AND ((P(XCH) EQV FID)=NOT 0) AND% 37261000
               ((P(XCH) EQV MID)=NOT 0) THEN%                           37262000
            BEGIN FORGETSPACE(T1.[33:15]); T1~@340000005;%              37263000
                  LO~0;T1~REED; GO TO EXIT;%                            37264000
            END;%                                                       37265000
            IF FIRST THEN GO REW;%                                      37266000
         LO:=@60; DO UNTIL (FIRST:=REED).[42:1]; DO UNTIL REED.[42:1];  37267000
         IF USASI>0 THEN DO UNTIL REED.[42:1] ELSE FIRST:=REED;         37267050
            LO~@40; GO READALABEL;                                      37267100
      END;%                                                             37268000
EXIT: FINDINPUT~U;%                                                     37269000
END FINDINPUT;%                                                         37270000
PROCEDURE STARTIMING(FN,U); VALUE FN,U; REAL FN,U;%                     37271000
BEGIN ARRAY FPB[*]; INTEGER I,J;%                                       37272000
      FPB~PRT[P1MIX,3];%                                                37273000
      IF U<32 THEN                                                      37273100
BEGIN IF FPB[FN+4]}0 THEN                                               37274000
      BEGIN IF (I~FPB[FN+3].[36:6])!0 THEN%                             37275000
            IF I!U+1 THEN IF (I~FPB.[8:10]){(1023-ETRLNG) THEN%         37276000
            BEGIN J~GETSPACE(I+ETRLNG,2,1)+2;%                          37277000
                  MOVE(I,FPB,J); MOVE(5,[FPB[FN]],J+I);%                37278000
                  FORGETSPACE(FPB.[33:15]);%                            37279000
                  FPBD[P1MIX] ~                                         37279100
                  PRT[P1MIX,3]~FPB~[M[J]]&(I+ETRLNG)[8:38:10];%         37280000
                  FPB[FN+4]~0; FPB[FN+3].[24:12]~0;%                    37281000
            END;%                                                       37282000
            FPB[FN+4]~FPB[FN+4]-CLOCK-P(RTR);%                          37283000
            FPB[FN+3].[36:6]~U+1;%                                      37284000
END   END ELSE                                                          37285000
BEGIN IF (I~FPB[FN+4]){0 THEN                                           37285100
      BEGIN FPB[FN+4]~I+CLOCK+P(RTR); I~FPB[FN+3].[36:6]-1;             37285200
            FPB[FN+3].[24:12]~P(DUP).[24:12]+TINU[I].[18:12];           37285300
            TINU[I].[18:12]~0;                                          37285400
END END END TIMING;                                                     37285500
REAL PROCEDURE DISKADDRESS(MID,FID,A,H,IO);                             37286000
    VALUE MID,FID,A,H,IO;                                               37286100
    REAL MID,FID,A,IO;                                                  37286200
    ARRAY H[*];                                                         37286300
BEGIN REAL T; INTEGER I; LABEL EOF;                                     37287000
      IF A}0 THEN%                                                      37288000
      BEGIN T~(A DIV H[0].[30:12])|H[0].[42:6];%                        37289000
            IF H[9]{I~T DIV H[1] THEN GO TO EOF;%                       37290000
            IF IO THEN%                                                 37291000
            BEGIN IF H[I~I+10]=0 THEN GO TO EOF END ELSE%               37292000
              IF H[I:=I+10]=0 THEN                                      37293000
              IF H[4] THEN P(DIRECTORYSEARCH(-MID,FID,-H&I[CTF]),DEL)   37293100
                    ELSE H[I]:=GETUSERDISK(H[8]);                       37293200
            T~H[I]+I~T MOD H[1];%                                       37294000
            STREAM(D~[T]); BEGIN SI~D; DS~8 DEC END;%                   37295000
      END ELSE%                                                         37296000
EOF:  T~0;%                                                             37297000
      DISKADDRESS~T;%                                                   37298000
END DISKADDRESS;%                                                       37299000
                                                                        37300000
                                                                        37301000
PROCEDURE SETNOTINUSE(U,RWL); VALUE U,RWL; REAL U,RWL;                  37302000
BEGIN REAL I,J;                                                         37303000
      IF U<16 THEN P(WAITIO(@4200000000,@377,U),DEL);                   37303100
      SLEEP([TOGLE],STATUSMASK);                                        37304000
      RRRMECH~((I~TWO(U)) AND SAVEWORD) OR ((I~NOT I) AND RRRMECH);%    37305000
      READY~READY AND I;%                                               37306000
      IF RWL THEN                                                       37312000
BEGIN                                                                   37313000
      STREAM(S~[TINU[U]],M~MULTITABLE[U],F~LABELTABLE[U],               37314000
             N~PRNTABLE[U].[30:18],D~J~GETSPACE(10,2,0)+2);             37314100
            BEGIN SI~S; SI~SI+5; DS~LIT "#"; DS~3 CHR;%                 37315000
                  DS~6 LIT " RW/L ";                                    37316000
                  SI~LOC M;SI~SI+1;DS~7 CHR;DS~LIT" ";                  37316100
                  SI~SI+1; DS~7 CHR; DS~LIT"(";                         37316200
                  DS~5 DEC; DS~2 LIT ")~";                              37316300
            END;%                                                       37317000
         SPOUT(J);                                                      37318000
      LABELTABLE[U]~@214;                                               37318100
END ELSE LABELTABLE[U]~@114;                                            37319000
      MULTITABLE[U]~RDCTABLE[U]~0;                                      37319010
      IF U<16 THEN PRNTABLE[U]~0 ;                                      37319020
END SETNOTINUSE;                                                        37319100
PROCEDURE BLASTQ(U); VALUE U; REAL U;%                                  37328000
BEGIN INTEGER I;%                                                       37329000
      I~UNIT[U].[18:15];%                                               37330000
      WHILE I!@77777 DO BEGIN IOQUE[I]~IOQUEAVAIL;%                     37331000
                              IOCOUNT[P1MIX]~*P(DUP)-1;                 37331500
                              IOQUEAVAIL~I+1;%                          37332000
                              I~LOCATQUE[I].[18:15];%                   37333000
                        END;%                                           37334000
      UNIT[U].[5:43]~(NOT 0).[18:30];%                                  37335000
END BLASTQ;%                                                            37336000
PROCEDURE BUILDLABEL(LABLE,MID,FID,REEL,CDATE,CYCLE,PFACT,PTN,BLKODE,%  37337000
                     BSIZE,RSIZE);%                                     37338000
                  VALUE LABLE,MID,FID,REEL,CDATE,CYCLE,PFACT,PTN,BLKODE,37339000
                        BSIZE,RSIZE;%                                   37340000
                  ARRAY LABLE[*];%                                      37341000
                  REAL  MID,FID,REEL,CDATE,CYCLE,PFACT,PTN,BLKODE,%     37342000
                        BSIZE,RSIZE;%                                   37343000
BEGIN;STREAM(D~[PFACT]); BEGIN SI~D; SI~SI+5; DS~3 OCT END;%            37344000
      PFACT~CALCULATEPURGE(PFACT);%                                     37345000
      STREAM(S~[MID],LABLE);%                                           37346000
      BEGIN DS~8 LIT " LABEL  "; SI~S; DS~2 WDS;%                       37347000
            DS~3 DEC; DS~5 DEC; DS~2 DEC; SI~SI+3; DS~5 CHR;%           37348000
            DS~14 LIT "0"; DS~5 DEC; SI~SI+7; DS~CHR;%                  37349000
            DS~5 DEC; DS~5 DEC; DS~11 LIT "0"%                          37350000
      END;%                                                             37351000
      IF (BSIZE~LABLE.[8:10])>10 THEN%                                  37352000
      STREAM(J~JARROW[P1MIX],D~[LABLE[10]]);%                           37353000
      BEGIN SI~J; SI~SI+1; DS~LIT " "; DS~7 CHR;%                       37354000
            SI~SI+1; DS~LIT "/"; DS~7 CHR; 12(DS~2 LIT " ");%           37355000
END   END GUILDLABEL;%                                                  37356000
PROCEDURE FILEMESS(I,K,M,F,R,D,C); VALUE I,K,M,F,R,D,C;%                37357000
                                   REAL  I,K,M,F,R,D,C;%                37358000
BEGIN REAL Z,L;%                                                        37359000
      REAL Q=I-1,X;                                                     37359100
      IF (X~Q.[CF])=0 THEN X~1;                                         37359200
     L := SPACE(12);                                                    37360000
      STREAM(Z:I~[I],J~[JAR[P1MIX,*]],P1MIX,L);                         37361000
      BEGIN SI~I;                                                       37362000
            IF SC="+" THEN BEGIN TALLY~1; DS~LIT "-"; SI~SI+1 END ELSE% 37363000
            BEGIN SI~SI+1; IF SC!"#" THEN DS~LIT " " END;%              37364000
            DS~7 CHR; DS~LIT " "; L~DI;%                                37365000
            2(DI~LOC Z; IF 8 SC!DC THEN BEGIN DI~L; SI~SI-7; DS~7 CHR;% 37366000
                                              DS~LIT " "; L~DI END);%   37367000
            DI~L; SI~SI+1; DS~7 CHR; DS~LIT " "; L~DI;%                 37368000
            3(DI~LOC Z; IF 8 SC!DC THEN BEGIN DI~L; SI~SI-8; DS~7 DEC;  37369000
                                              L~DI; DI~DI-7; DS~6 FILL; 37370000
                                              DI~L; DS~LIT " "; L~DI;   37371000
                                        END);                           37372000
                                                                        37373000
                                                                        37374000
            DI~L; DI~DI-1; DS~LIT ":";%                                 37375000
            Z~TALLY; SI~LOC Z; SI~SI+7;%                                37376000
            IF SC="0" THEN BEGIN SI~J; SI~SI+1; DS~7 CHR; DS~LIT "/";%  37377000
                                 SI~SI+1; DS~7 CHR; DS~LIT "=";%        37378000
                                 SI~LOC P1MIX; DS~2 DEC;                37379000
                                 L~DI; DI~DI-2; DS~FILL; DI~L END;      37379500
            DS~LIT "~";%                                                37380000
      END;%                                                             37381000
      IF P THEN BEGIN TERMINATE(P1MIX); TERMINALMESSAGE(-L) END;%       37382000
      SPOUTIT(L,X);                                                     37383000
END FILEMESS;%                                                          37384000
PROCEDURE FILLBUFFERS(CURRENT,FINAL,NF,NR); VALUE CURRENT,FINAL,NF,NR;% 37385000
                  REAL CURRENT,FINAL,NF,NR;%                            37386000
BEGIN ARRAY LOCAT[*];%                                                  37387000
      INTEGER I,J,K,D;%                                                 37388000
      INTEGER FIRSTLOC=J,PREVLOC=K,CURLOC=D;                            37388100
      REAL T=LOCAT;                                                     37388200
      LABEL LINK;                                                       37388300
      REAL BSIZE=CURRENT,N=FINAL,U=NF,ALPHA=NR;                         37388400
      IF ALPHA<512 THEN                                                 37388500
      BEGIN                                                             37388600
      J~FINAL.[33:15]-K~CURRENT.[33:15];%                               37389000
      D~2&(NOT CURRENT)[1:22:1];%                                       37390000
      LOCAT~M[K+D]; NR~NR-1;%                                           37391000
      FOR I~1 STEP 1 UNTIL NF DO%                                       37392000
      BEGIN IOREQUEST(FLAG(FINAL),CURRENT,LOCAT);%                      37393000
            M[LOCAT]~M[LOCAT]&0[26:26:7] AND NOT(M OR IOMASK);%         37394000
            IF NR>0 THEN STREAM(NR,T~M[LOCAT],LOCAT);%                  37395000
                         BEGIN SI~LOCAT; SI~SI+8; DS~NR WDS;%           37396000
                               SI~LOC T; DS~WDS END;%                   37397000
            CURRENT.[33:15]~K~M[K+D].[18:15];%                          37398000
            FINAL.[33:15]~K+J;%                                         37399000
      END   END ELSE                                                    37400000
      BEGIN                                                             37401000
      T~ALPHA&U[12:42:6] OR M;%                                         37404000
      FOR I~N-1 STEP -1 UNTIL 0 DO%                                     37405000
      BEGIN M[ALPHA+I]~(CURLOC~GETSPACE(BSIZE+4,3,1)+2)+2;              37406000
            IF FIRSTLOC=0 THEN FIRSTLOC~CURLOC;%                        37407000
            M[CURLOC+1]~0; MOVE(BSIZE+1,CURLOC+1,CURLOC+2);             37408000
LINK:       M[CURLOC]~FLAG(T)&(PREVLOC+2)[18:33:15];%                   37412000
            M[CURLOC+BSIZE+3]~FLAG(T)&(PREVLOC+BSIZE+1)[18:33:15];%     37413000
            PREVLOC~CURLOC;%                                            37414000
      END;%                                                             37415000
      IF I=(-1) THEN BEGIN CURLOC~FIRSTLOC; GO TO LINK END;%            37416000
      END END FILL OR GET BUFFERS;                                      37417000
 REAL PROCEDURE FILEHEADER(MID, FID, NROWS, SIZE, BLEN, RLEN, S);       37418000
 VALUE   MID, FID, NROWS, SIZE, S;                                      37419000
 REAL    MID, FID;                                                      37420000
 INTEGER NROWS, SIZE, BLEN, RLEN, S;                                    37421000
    BEGIN REAL     Q, Z;                                                37422000
    LABEL EXIT;                                                         37422200
         ARRAY     T = Q[*];                                            37423000
         INTEGER   LPER,                                                37424000
                   SPER,                                                37424100
                   N1,                                                  37424200
                   R1,                                                  37424300
                   L1,                                                  37424400
                   W;                                                   37424500
         SUBROUTINE GOBBLE;                                             37425000
         BEGIN SPER := (BLEN+29) DIV 30;                                37426000
              IF S=0 THEN RLEN := BLEN;                                 37427000
              LPER := BLEN DIV RLEN;                                    37428000
         END  GOBBLE;                                                   37429000
         Q:=S.[13:3];                                                   37429500
         IF (NROWS+SIZE) = 0 THEN                                       37432000
         BEGIN                                                          37433000
              IF (N1:=SECURITYCHECK(MID,FID,USERCODE[P1MIX],            37433100
                   Q)) LSS 0 THEN GO TO EXIT;                           37433200
              T := T & (N1 AND POLISH(T[4].[9:2]=1, LNG))[CTF];         37434000
              IF (L1 := (Z := T[0]).[1:14]) = 0 THEN L1 := 30;          37435000
              N1 := T[7]+1;  R1 := Z.[30:12];                           37436000
              IF BLEN = 0 THEN%  THIS IS "TECHNIQUE "D"" FILE TYPE...   37437000
              BEGIN BLEN := Z.[15:15];                                  37437500
                   S := (RLEN := L1) ! BLEN;                            37438000
              END;                                                      37438500
              W := (((N1 DIV R1) | Z.[42:6]) | 30) + (N1 MOD R1) | L1;  37439000
              GOBBLE;  T[7] := W :=                                     37439500
                        ((W DIV 30) DIV SPER) | LPER  +                 37440000
                        ((((W DIV 30) MOD SPER) | 30  +                 37440500
                            W MOD 30 + RLEN-1) DIV RLEN) - 1;           37441000
              T[1] := (T[8] DIV SPER) | SPER;                           37441500
              T[4]:=(*P(DUP)) OR 1;                                     37441600
         END ELSE BEGIN                                                 37442000
              T := MEMORY OR (GETSPACE(30, 8, 1) + @360000700002);      37442500
              STREAM(T);                                                37443000
              BEGIN SI:=T;  SI:=SI-8;  DS:=30 WDS;  END;                37443500
              T[3] := XCLOCK+P(RTR);                                    37444000
                                                                        37444500
              T[7] := -1;  T[9] := NROWS;  GOBBLE;                      37445000
              T[1] := T[8] := ((SIZE + LPER-1) DIV LPER) | SPER;        37445500
         END;                                                           37446000
         T[0] := SPER & LPER[30:36:12] & BLEN[15:33:15] & RLEN[1:34:14];37446500
         FILEHEADER := NFLAG(T);                                        37447000
EXIT:                                                                   37447500
    END;                                                                37448000
PROCEDURE PURGEIT(U); VALUE U; INTEGER U;%                              37449000
 BEGIN   ARRAY LABLE[*];                                                37450000
         REAL EOF;                                                      37451000
                                                                        37452000
      RDCTABLE[U].[8:6] := 0;%MAKE THE USER THE MCP                     37453000
      P(WAITIO(@4200000000,@377,U),DEL);                                37453100
      LABLE := [M[SPACE(10)]]&10[8:38:10]&5[21:45:3];                   37454000
      BUILDLABEL(LABLE,0,"X",1,0,1,0,PRNTABLE[U].[30:18],0,0,0);%       37455000
      P(WAITIO(LABLE,@37700000,U),DEL);%                                37456000
      EOF~@1737000000000000;%                                           37457000
      P(WAITIO([EOF],@37700000,U),DEL);%                                37458000
      FORGETSPACE(LABLE.[33:15]);                                       37463000
      SETNOTINUSE(U,0);                                                 37464000
      KILL([U] INX NOT 1);                                              37465000
END PURGEIT;%                                                           37466000
 PROCEDURE KRUNCHER(H); ARRAY H[*];                                 %R1737500000
         BEGIN DEFINE E=H[7]#,RL=H[1]#,RPB=H[0].[30:12]#,           %R1737501000
                   MAXROWS=H[9].[43:5]#,                                37501500
                   BCL=H[0].[42:6]#,BRL=H[8]#;                      %R1737502000
              ARRAY A[*];                                           %R1737504000
              LABEL FORGET,EXIT,AGAIN,DONE;                         %R1737505000
              INTEGER NB,NBR;                                       %R1737506000
              REAL I,J,K,T;                                         %R1737507000
              A:=IOQUE&SPACE(41)[CTC];                              %09737508000
              MOVE(41,A.[CF]-1,A);                                  %09737509000
              IF E LSS 0 THEN GO TO EXIT;                           %R1737510000
              NB:=E DIV RPB;                                        %R1737511000
              NBR:=RL DIV BCL;                                      %R1737512000
              IF RL NEQ BRL THEN                                    %R1737513000
              FOR I:=10 STEP 1 UNTIL 29 DO                          %R1737514000
              IF H[I] NEQ 0 THEN                                    %R1737515000
                   FORGETUSERDISK(H[I]+RL,-(ABS(BRL-RL)));              37516000
              BRL:=RL;                                              %R1737517000
              IF NB LSS NBR THEN                                    %R1737520000
              BEGIN A[0]:=H[NT2:=10];                               %R1737521000
                   NT4:=1;                                          %R1737521100
                   RL:=(NB+1)|BCL;                                  %R1737521200
                   GO TO FORGET;                                    %R1737521300
              END;                                                  %R1737521400
              T:=(K:=J:=1)+NBR|20;                                  %R1737522000
    AGAIN:    IF(NT1:=NBR DIV J)=0 THEN GO TO DONE;                 %R1737523000
              IF (NT2:=NB DIV NT1) GTR 19 THEN GO TO DONE;          %R1737524000
              IF NBR MOD J=0 THEN                                   %R1737525000
              BEGIN IF (NT3:=NT1|NT2+NT1) LSS T THEN                %R1737526000
                   BEGIN K:=J; T:=NT3; NT4:=NT2+1 END;              %R1737527000
              END;                                                  %R1737528000
              J:=J+1;                                               %R1737529000
              GO TO AGAIN;                                          %R1737530000
    DONE:     IF K=1 THEN GO TO EXIT;                               %R1737530100
              NT2:=NB DIV NBR + 10;                                 %R1737530200
              RL:=RL DIV K;                                         %R1737531000
              FOR I:=10 STEP 1 UNTIL NT2 DO                         %R1737532000
              BEGIN IF (NT1:=H[I]-RL) GTR 0 THEN                    %R1737533000
                   FOR J:=1 STEP 1 UNTIL K DO                       %R1737534000
                        A[(I-10)|K+J-1]:=NT1+J|RL;                  %R1737535000
              END;                                                  %R1737536000
              FOR K:=NT4 STEP 1 UNTIL 19 DO A[K]:=0;                %R1737538000
              MAXROWS:=(NT4 NEQ 20)+NT4; %UPDATE # ROWS USED.       %09737538500
    FORGET:   IF NB+1 NEQ NBR THEN                                  %R1737539000
                   FORGETUSERDISK(A[NT4-1]+RL,                          37542000
                                  -(ABS((NT2-9)|BRL-NT4|RL)));          37542010
              MOVE(20,A,[H[10]]);                                   %R1737543000
              BRL:=RL;                                              %R1737544000
    EXIT:     FORGETSPACE(A);                                       %R1737545000
         END;                                                       %R1737546000
PROCEDURE DISKFILEOPEN(ALPHA); VALUE ALPHA; INTEGER ALPHA;%         %R9038000000
BEGIN REAL RCW=+0,MSCW=-2;                                          %R9038001000
     REAL IOM=IOMASK, IOMASK=+1;                                    %R9038002000
     INTEGER NBUFS=+2,FNUM=+3,BLEN=+4,TYPE=+5,REEL=+6,CDATE=+7,     %R9038003000
             CYCLE=+8,MODE=+9,IO=+10,RLEN=+11,U=+12,KIND=+13,       %R9038004000
             DIREC=+14,FORMS=+15,COBOL=+16,UNLABELED=+17,               38005000
             OPTIONAL=+18,CNTCTL=+19;                                   38006000
     REAL MFID=+20,FID=+21,T1=+22,T2=+23,MASK=+24,STATE=+25;            38007000
     ARRAY FIB=+26[*],FPB=+27[*];%                                  %R9038008000
     INTEGER ACCESS=+28,FIB7=+29;                                   %R9038009000
     ARRAY HEADER=+30[*];%                                          %R9038010000
     LABEL EXIT;                                                        38010500
     SUBROUTINE DISKSETUP;%                                         %R9038011000
      BEGIN IF STATE.[42:1] THEN%                                   %R9038012000
       BEGIN                                                            38013000
            IF (NOT MFID)=(NOT 0)AND NOT USERCODE[P1MIX].[1:1] THEN     38013100
            BEGIN                                                       38013110
                 FPB[FNUM]:=MFID:=FID;                                  38013120
                 FPB[FNUM+1]:=FID:=USERCODE[P1MIX];                     38013130
            END;                                                        38013140
            IF NFLAG(FIB[14]:=FLAG(FILEHEADER(MFID,                     38013200
                 FID&FIB[5][1:45:1],FIB[8].[15:10],                     38013400
                 FIB[8].[25:23],BLEN,RLEN,STATE)))=0 THEN               38013600
            BEGIN                                                       38013800
                 P(DEL);                                                38014000
                 T1:=1;                                                 38014200
                 GO TO EXIT;                                            38014400
            END;                                                        38014600
                  FIB[18] := RLEN & BLEN[CTF] & BLEN[3:33:15];      %R9038015000
                  STATE.[46:2] := BLEN ! RLEN;                      %R9038016000
                  IF FIB[8].[15:33]!0 THEN FPB[FNUM+2].[18:30]~DATE;%R9038017000
                  STARTIMING(FNUM,18);%                             %R9038018000
            END;%                                                   %R9038019000
            HEADER~FIB[14];%                                        %R9038020000
            KIND~4; U~18;%                                          %R9038021000
            MODE~0;%                                                %R9038022000
            IF NOT COBOL THEN UNLABELED~1;%                         %R9038023000
            CNTCTL~BLEN{1023;%                                      %R9038024000
            IF COBOL>0 AND (FIB[13].[22:1] OR TYPE=10) THEN             38024100
         BEGIN     COBOL:=3;               %IF COBOL-IO OR COBOL-RANDOM 38024200
                   BLEN := BLEN + RLEN;   %THEN CHANGE BUFFSIZE TO      38024300
         END;                             %BUFFSIZE + RECSIZE           38024400
            GETBUFFERS((IF CNTCTL THEN BLEN%                        %R9038025000
                                  ELSE ((BLEN+29) DIV 30)|30)+1,%   %R9038026000
                       NBUFS,U,ALPHA);%                             %R9038027000
            IF COBOL = 3 THEN             %IF COBOL-IO OR COBOL-RANDOM  38027100
         BEGIN     COBOL := 1;            %THEN CHANGE BUFFSIZE TO      38027200
                   BLEN := BLEN - RLEN;   %BUFFSIZE - RECSIZE           38027300
         END;                             % (SEE ABOVE)                 38027400
            FIB[16]~M[ALPHA]&CNTCTL[23:47:1]&IO[24:47:1]%           %R9038028000
                  &((BLEN+29) DIV 30)[27:42:6]%                     %R9038029000
                  &(IF CNTCTL THEN BLEN ELSE 1023)[8:38:10]%        %R9038030000
                  &TINU[18][3:3:5] OR M OR IOMASK;%                 %R9038031000
            FIB[16].[2:1]:=(HEADER.[31:2] AND (IO+1))!0;            %R9038032000
               FIB[5].[1:1]:= NOT FIB[16].[2:1];                    %R9038033000
               IF FIB[5].[1:1] THEN                                 %R9038034000
           FOR MASK:=10 STEP 1 UNTIL 29 DO HEADER[MASK]:=0;         %R9038035000
            FIB[19]~(IF DIREC THEN BLEN-RLEN+1 ELSE 1)              %R9038036000
                    INX FIB[16]&0[27:27:6];                         %R9038037000
            IF STATE.[46:2]!0 THEN FIB[19].[8:10]~RLEN;%            %R9038038000
            FS[P1MIX,(T2:=(FNUM DIV ETRLNG)).[40:4]]~(*P(DUP)) OR   %R9038039000
              (TWO(0&T2[43:44:4])|((NOT HEADER).[31:2]));           %R9038040000
            T2~IF COBOL THEN 0 ELSE FIB[19].[33:15]-FIB[16].[33:15];%%R938041000
            FOR MASK~0 STEP 1 UNTIL NBUFS-1 DO%                     %R9038042000
            M[ALPHA+MASK]~(P(DUP,LOD)+T2)%                          %R9038043000
                          &P(FLAG(FIB[19-ABS(3|COBOL)]),XCH)[CTC];      38044000
            FIB[16]:=FIB[16] OR M;                                  %R9038045000
            FIB[5].[45:1]~0;                                            38045100
      END DISKSETUP;%                                               %R9038046000
      P(RCW,MSCW,STF);                                              %R9038047000
      RCW:=RCW&P(XCH)[CTC];                                         %R9038048000
      DISKSETUP;                                                    %R9038049000
      IF COBOL<0 THEN   % ADJUST UPPER BOUND FOR COBOL 68               38049200
         BEGIN  MASK ~ (IF IO AND NOT FIB[13].[22:1]                    38049300
                   THEN HEADER[7]                                       38049400
                   ELSE  (((HEADER[9] | HEADER[1]) DIV                  38049500
                            HEADER[0].[42:6]) | HEADER[0].[30:12]) - 1);38049600
         IF FIB[3]=0 OR FIB[3]>MASK THEN FIB[3]~MASK; %LESSOR OF 2 EVILS38049700
         END;                                                           38049800
      IF TYPE=10 THEN                                               %R9038050000
      BEGIN                                                         %R9038051000
           IF COBOL<1 THEN     % ALGOL OR COBOL 68                      38052000
              FOR MASK ~ 0 STEP 1 UNTIL NBUFS-1 DO                      38053000
              IF COBOL THEN M[M[ALPHA+MASK] INX NOT 2] ~ NOT 0          38053500
                        ELSE M[ALPHA+MASK]~P(DUP,LOD)&1[27:47:1];       38054000
             FIB[6]~FIB[7]~0;%                                      %R9038055000
             FIB[17]~IF IO THEN 0 ELSE BLEN;%                       %R9038056000
      END ELSE                                                      %R9038057000
      BEGIN                                                         %R9038058000
             T2~(MFID~FIB[16]).[33:15];%                            %R9038059000
             FIB7~FIB[7];                                           %R9038060000
             IF COBOL THEN%                                         %R9038061000
              BEGIN  IF COBOL>0 THEN                                    38062000
                        IF NOT (FIB7=0 OR FIB[13].[22:1]) THEN          38062500
                        BEGIN  FIB7 ~ FIB7 - 1;                         38063000
                               OPTIONAL ~ NBUFS - 1;                    38063500
                        END ELSE  OPTIONAL ~ NBUFS - 2                  38064000
                        ELSE BEGIN      % COBOL 68                      38064200
                             OPTIONAL ~ NBUFS - 1;                      38064400
                             IF DIREC THEN FIB7 ~ FIB[7] ~ FIB[3];      38064600
                             END;                                       38065000
                   FID~FIB[16];%                                    %R9038066000
                   MASK~0;%                                         %R9038067000
             END ELSE%                                              %R9038068000
             BEGIN OPTIONAL~NBUFS-1;%                               %R9038069000
                   MASK~(FID~FIB[19]).[33:15]-T2;%                  %R9038070000
             END;%                                                  %R9038071000
             IF STATE.[46:2]!0 OR IO THEN                           %R9038072000
             IF M[ALPHA].[2:1] THEN                                 %R9038073000
             FOR T1~0 STEP 1 UNTIL OPTIONAL DO%                     %R9038074000
              BEGIN IF (M[T2]:=DISKADDRESS(FPB[FNUM],FPB[FNUM+1],       38075000
               FORMS~((HEADER[0].[30:12]|T1)&DIREC[1:47:1])+FIB7,       38076000
                                       HEADER,IO))!0 THEN           %R9038077000
                   BEGIN IOREQUEST(FLAG(FID),MFID&1[24:47:1],M[T2-2]);%R38078000
                        M[ALPHA]~FLAG(MFID)&0[26:26:7]%             %R9038079000
                                     AND NOT (M OR IOMASK);%        %R9038080000
                   END ELSE%                                        %R9038081000
                   M[ALPHA   ]~P(DUP,LOD)&1[27:47:1] AND NOT M;%    %R9038082000
                   IF COBOL<0 THEN M[M[ALPHA] INX NOT 2] ~              38082400
                      (IF FORMS}0 THEN FORMS DIV FIB[11] ELSE NOT 0);   38082500
                   STREAM(N~NBUFS-1,T~M[ALPHA],ALPHA);%             %R9038083000
                   BEGIN SI~ALPHA; SI~SI+8; DS~N WDS;%              %R9038084000
                         SI~LOC T; DS~WDS;%                         %R9038085000
                   END;%                                            %R9038086000
                  MFID.[33:15]~T2~M[T2-2].[18:15];%                 %R9038087000
                   FID.[33:15]~T2+MASK;%                            %R9038088000
             END;%                                                  %R9038089000
             IF (NBUFS-1)!OPTIONAL THEN FIB[16].[33:15]~M[ALPHA] ;% %R9038090000
             FORMS~(FORMS~FIB7 MOD HEADER[0].[30:12])|RLEN;         %R9038091000
            SLEEP([M[ALPHA]],IOMASK);%                              %R9038092000
             IF COBOL } 0 THEN          % NOT COBOL 68                  38092900
              IF FIB[13].[22:1]THEN M[ALPHA].[33:15]~FIB[16]INX 1 ELSE%R38093000
             M[ALPHA].[33:15]~FIB[16].[33:15]+FORMS+1;%             %R9038094000
              IF (NBUFS-1)!OPTIONAL AND IO AND NOT FIB[13].[22:1] THEN%R38095000
                   FIB[ 17 ]~0  ELSE                                %R9038096000
             FIB[17]~IF DIREC THEN FORMS+RLEN%                      %R9038097000
                              ELSE BLEN-FORMS;%                     %R9038098000
      END;                                                          %R9038099000
      T1:=0;                                                            38099400
 EXIT:                                                                  38099500
      P(P&RCW[CTC],0,RDS,0,XCH,P&P[CTF],STF);                       %R9038100000
END DISKFILEOPEN;                                                   %R9038101000
PROCEDURE OTHERFILEOPEN(ALPHA); VALUE ALPHA; INTEGER ALPHA;%        %R9038102000
BEGIN REAL RCW=+0,MSCW=-2;                                          %R9038103000
     REAL IOM=IOMASK, IOMASK=+1;                                    %R9038104000
     INTEGER NBUFS=+2,FNUM=+3,BLEN=+4,TYPE=+5,REEL=+6,CDATE=+7,     %R9038105000
             CYCLE=+8,MODE=+9,IO=+10,RLEN=+11,U=+12,KIND=+13,       %R9038106000
             DIREC=+14,FORMS=+15,COBOL=+16,UNLABELED=+17,               38107000
             OPTIONAL=+18,CNTCTL=+19;                                   38108000
     REAL MFID=+20,FID=+21,T1=+22,T2=+23,MASK=+24,STATE=+25;            38109000
     ARRAY FIB=+26[*],FPB=+27[*];%                                  %R9038110000
     INTEGER ACCESS=+28,FIB7=+29;                                   %R9038111000
     ARRAY HEADER=+30[*];%                                          %R9038112000
     REAL USASI=NT1;                                                    38112200
     LABEL LOOKOUT,LPS,FIND,SPACER,FINALOUT,DCN,PBS;                %R9038113000
 %                                                                  %R9038114000
     SUBROUTINE TYPEOPEN;%                                          %R9038115000
         BEGIN                                                      %R9038116000
            T1 ~ ( OPNMESS AND ((T1~JAR[P1MIX,0])>0 OR T1<0 AND     %R9038117000
                 COPNMESS)) OR OPENK;                               %R9038118000
                       IF U GEQ 16 THEN T2 ~0 ELSE                      38118010
                        STREAM(S~PRNTABLE[U].[30:18],D~[T2]);%          38118100
                        BEGIN SI ~ LOC S; DS ~ 8 DEC;         %         38118200
                              DI ~ DI-7; DS ~ 6 FILL;         %         38118300
                        END;                                  %         38118400
            FILEMESS(P(T1,0) INX (IF IO THEN " IN " ELSE " OUT")    %R9038119000
                           &TINU[U][6:30:18],T2,MFID,FID,REEL,%         38120000
                           CDATE,CYCLE);%                           %R9038121000
         END;                                                       %R9038122000
 %                                                                  %R9038123000
     SUBROUTINE REED;%                                              %R9038124000
      BEGIN IF (T2~WAITIO(T1,MASK&@377[18:33:15],U) AND @367)!0 THEN%R9038125000
            IF (T2 AND NOT MASK)!0 THEN                             %R9038126000
            BEGIN STOPTIMING(FNUM,1023); SETNOTINUSE(U,0);          %R9038127000
                  FILEMESS(-"PARITY ","ON ... "&TINU[U][24:30:18],% %R9038128000
                           MFID,FID,REEL,CDATE,CYCLE);%             %R9038129000
            END;%                                                   %R9038130000
            IF TERMSET(P1MIX) THEN                                  %R9038131000
            BEGIN STOPTIMING(FNUM,1023); SETNOTINUSE(U,0);          %R9038132000
                  GO TO INITIATE;                                   %R9038133000
            END;                                                    %R9038134000
      END REED;%                                                    %R9038135000
 %                                                                  %R9038136000
     REAL SUBROUTINE CNTLBITS;%                                     %R9038137000
            CNTLBITS~IOMASK&MODE[21:47:1]&DIREC[22:47:1]&CNTCTL[23:47:1]38138000
                  &IO[24:47:1]&(KIND=7 OR KIND>9 AND KIND{12)[20:47:1]%R38139000
                  &(IF KIND=1OR KIND=7OR KIND=12THEN@20ELSE 0)[27:42:6];38140000
%                                                                   %R9038141000
     SUBROUTINE LABELAREA;%                                         %R9038142000
            M[T1~ALPHA-2]~M OR (GETSPACE((T1~M[T1].[8:10])+4,2,1)+4)%%R938143000
                          &T1[8:38:10]&CNTLBITS[18:18:15];%         %R9038144000
     SUBROUTINE DOCARDLABEL;                                        %R9038145000
            BEGIN NT3 := SPACE(13)+2;                               %R9038146000
                 MOVE(10,T1,NT3);                                   %R9038147000
                 FORGETSPACE(T1-2); T1~NT3;                         %R9038148000
                  M[ALPHA-2]~[M[T1]]&10[8:38:10]&1[24:47:1];        %R9038149000
                 MODE~CNTCTL~DIREC~0;                               %R9038150000
            END;                                                    %R9038151000
%                                                                   %R9038152000
      P(RCW,MSCW,STF);                                              %R9038153000
      RCW:=RCW&P(XCH)[CTC];                                         %R9038154000
      IF NOT IO THEN GO TO LOOKOUT;                                 %R9038155000
      IF STATE.[41:1] THEN%                                         %R9038156000
      BEGIN U~FIB[15].[25:5];%                                      %R9038157000
      END ELSE%                                                     %R9038158000
      BEGIN IF (U~FINDINPUT(MFID,FID,REEL,CDATE,CYCLE,COBOL,UNLABELED,%R38159000
                            OPTIONAL,MODE,FNUM))<0 THEN%            %R9038160000
            BEGIN FIB[5].[39:4]~9; GO TO FIND END;%                 %R9038161000
            STARTIMING(FNUM,IF U>31 THEN 18 ELSE U);                %R9038162000
            TYPEOPEN;%                                              %R9038163000
            IF U<16 THEN BEGIN RRRMECH~TWO(U) OR RRRMECH;           %R9038164000
                               PRNTABLE[U].[15:15]~ALPHA;%          %R9038165000
                         END;%                                      %R9038166000
            KIND~IF U>31 THEN 11 ELSE UNIT[U].[1:4];                %R9038167000
            IF (T1~RDCTABLE[U].[14:10])!0 THEN REEL~T1;             %R9038168000
                                                                    %R9038169000
            STATE.[39:4]~0;%                                        %R9038170000
      END;%                                                         %R9038171000
      IF KIND=0 THEN%                                               %R9038172000
      BEGIN IF U=23 THEN BEGIN T1~READERA; READERA~0 END%           %R9038173000
                    ELSE BEGIN T1~READERB; READERB~0 END;%          %R9038174000
            DOCARDLABEL;                                            %R9038175000
            IF BLEN<T1~(MODE+1)|10 THEN BLEN~T1;%                   %R9038176000
      END ELSE%                                                     %R9038177000
      IF KIND=2 THEN%                                               %R9038178000
      BEGIN IF NOT UNLABELED THEN BEGIN%                            %R9038179000
            IF DIREC AND NOT FIB[16].[22:1] THEN                        38180000
            BEGIN IF NOT STATE.[40:1] THEN BEGIN%                   %R9038181000
                  T1~5&3[23:46:2] OR M;%                            %R9038182000
      SPACER:     MASK~0; REED;%                                    %R9038183000
                  MASK:=@60; DO REED UNTIL T2.[42:1];                   38184000
                  DO REED UNTIL T2.[42:1];                          %R9038185000
                  MASK~0; REED;            END;%                    %R9038186000
            END;                                                    %R9038187000
                                                                    %R9038188000
                                                                    %R9038189000
            CNTCTL~1; LABELAREA;%                                   %R9038190000
            T1~NFLAG(M[ALPHA-2]);                                       38191000
            IF DIREC THEN T1~T1.[8:10]-1 INX T1;                        38192000
            MASK:=@40; REED;                                            38192100
            STREAM(Y:=0:X:=0,X1:=0,X2:=0,Z:=T1);                        38192200
              BEGIN  DI:=LOC X; DS:=24 LIT "VOL1HDR1HDR2EOF1EOF2EOV1";  38192300
                     DI:=LOC X;                                         38192400
                     6(TALLY:=TALLY+1;                                  38192500
                     SI:=Z;                                             38192600
                     IF 4 SC=DC THEN                                    38192700
                     JUMP OUT TO B);                                    38192800
                     TALLY:=0;                                          38192900
              B:                                                        38193000
                     Y:=TALLY;                                          38193100
              END;                                                      38193200
            IF (USASI:=P)>0 THEN                                        38193300
            USASITAPE(T1.[CF],USASI,4,U,DIREC);                         38193400
            IF T2 NEQ @40 THEN DO REED UNTIL T2.[42:1] ELSE             38198000
              FOR CNTCTL~DIREC STEP 1 UNTIL 2 DO% DIREC = 0 OR 1    %DB 38198010
              P(WAITIO(@4740000005&(NOT DIREC)[22:47:1],@377,U),DEL);%DB38198020
                                  END;%                             %R9038204000
            IF BLEN = 0 THEN                                        %R9038205000
           BEGIN;STREAM(B:=0,BF:=0,R:=0:L:="LABEL  ",S:=M[ALPHA-2]);%R9038206000
                 BEGIN SI:=LOC L; SI:=SI+1; DI:=DI+1;%              %R9038207000
                 IF 7SC = DC THEN%                                  %R9038208000
                 BEGIN SI:=S; SI:=SI+58; DI:=LOC BF; DI:=DI-1;%     %R9038209000
                        DS:=CHR;  DS:=5 OCT;  DS:=5 OCT;            %R9038210000
                  END%                                              %R9038211000
                  END   STREAM;                                     %R9038212000
                  RLEN := POLISH;  BLEN := POLISH;                  %R9038213000
                  STATE := STATE & P(XCH)[46:46:2];                 %R9038214000
                  FIB[18] := RLEN & BLEN[CTF] & BLEN[3:33:15];      %R9038215000
            END;                                                    %R9038216000
            CNTCTL~BLEN{1023;%                                      %R9038217000
      END ELSE%                                                     %R9038218000
      IF KIND=9 THEN%                                               %R9038219000
      BEGIN UNLABELED~CNTCTL~1;%                                    %R9038220000
            DIREC~0;%                                               %R9038221000
      END ELSE%                                                     %R9038222000
      IF KIND=11 THEN                                               %R9038223000
      BEGIN T1~CIDROW[U-32].[18:15];                                %R9038224000
            CIDROW[U-32].[18:15]~0;                                 %R9038225000
            DOCARDLABEL;                                            %R9038226000
            FIB[13].[1:9]~NBUFS~1; FIB[13].[10:9]~1;                %R9038227000
            IF BLEN<10 THEN BLEN~10;                                %R9038228000
      END ELSE                                                      %R9038229000
DCN:: FILEMESS(-"I/O ERR",0,MFID,FID,REEL,CDATE,CYCLE);%            %R9038230000
      P(1);                                                         %R9038231000
      GO TO FINALOUT;                                               %R9038232000
LOOKOUT:    IF STATE.[41:1] THEN%                                   %R9038233000
            BEGIN U~FIB[15].[25:5];%                                %R9038234000
            END ELSE%                                               %R9038235000
            BEGIN IF(U~FINDOUTPUT(MFID,FID,TYPE,FORMS,REEL,         %R9038236000
                                  CDATE,CYCLE,KIND))>40 THEN        %R9038237000
              BEGIN FIB[14].[3:15]~U;                               %R9038238000
                   FPB[FNUM+2].[18:30]~DATE;                        %R9038239000
                   IF MCP!NOT 0 THEN M[U+2]~USERCODE[P1MIX];        %R9038240000
                   M[U+3]~XCLOCK+P(RTR);                            %R9038241000
                   FILEMESS(P(OPNMESS OR OPENK,(IF TYPE GEQ 20 OR       38242000
                   TYPE=0 THEN "PUD...." ELSE "PBD....")&M[U+6]         38242100
                   [24:6:24]),"OUT    ",                            %R9038243000
                                         MFID,FID,REEL,CDATE,CYCLE);%R9038244000
                    STARTIMING(FNUM,U~18);                          %R9038245000
              END ELSE                                              %R9038246000
              BEGIN                                                 %R9038247000
                  STARTIMING(FNUM,U);%                              %R9038248000
                  TYPEOPEN;%                                        %R9038249000
                  IF TYPE=5 OR TYPE=8 OR TYPE=9 THEN UNLABELED~1;%  %R9038250000
                  IF U<16 THEN BEGIN RRRMECH~TWO(U) OR RRRMECH;     %R9038251000
                                     PRNTABLE[U].[15:15]~ALPHA;%    %R9038252000
              END;                       END;                       %R9038253000
            END;%                                                   %R9038254000
      IF KIND=6 THEN%                                               %R9038255000
      BEGIN BLEN:=10;                                                   38256000
            FIB[18]:=(*P(DUP))&BLEN[CTC]&BLEN[CTF]&BLEN[3:33:15];       38256500
            MODE~DIREC~CNTCTL~0;%                                   %R9038257000
      END ELSE%                                                     %R9038258000
      IF KIND=1 THEN%                                               %R9038259000
      BEGIN MODE~DIREC~CNTCTL~0;%                                   %R9038260000
LPS:                                                                %R9038261000
            IF NOT COBOL THEN M[ALPHA-2]~0&15[8:38:10];%            %R9038262000
      END ELSE%                                                     %R9038263000
      IF KIND=12 THEN                                               %R9038264000
      BEGIN TYPE~IF (TYPE!0 AND TYPE<20) THEN 15 ELSE 22;               38265000
 PBS:  MODE~DIREC~0; FIB[13].[1 :9]~NBUFS     ~CNTCTL~1;            %R9038266000
            IF BLEN>17 THEN BLEN~17;                                %R9038267000
            M[T1~GETSPACE(92,3,1)+2]~M[T1-1]~[M[ALPHA]]&(T1+2)[CTF]&%R9038268000
             U[12:42:6]; STREAM(I~T1+78);9(DS~8LIT " ");            %R9038269000
            M[ALPHA]~T1+2; HEADER~[M[T1]]&92[8:38:10];              %R9038270000
            FIB[14]~(*P(DUP))&(T1+2)[CTC]&(T1+56)[CTF];             %R9038271000
           FIB[18]~(*P(DUP))&BLEN[CTC]&BLEN[CTF]&BLEN[03:33:15];    %R9038272000
            STREAM(D~T1+1); 2(36(DS~8 LIT"0"));                     %R9038273000
            FIB[5].[FF]~(M[T1+91]~FIB[5].[FF]&1[18:47:1])+1;        %R9038274000
                                                                    %R9038275000
          HEADER[74]~MFID;                                          %R9038276000
          HEADER[75]~FID;                                           %R9038277000
          HEADER[87]~FORMS;                                         %R9038278000
                                                                    %R9038279000
          HEADER[76]~ABS(JAR[P1MIX,0]);                             %R9038280000
          HEADER[77]~ABS(JAR[P1MIX,1]);                             %R9038281000
            GO TO LPS;                                              %R9038282000
      END ELSE                                                      %R9038283000
      IF KIND=7 THEN%                                               %R9038284000
      BEGIN TYPE~IF (TYPE!0 AND TYPE<20) THEN 6 ELSE 20;                38285000
            IF SVPBT THEN SAVEWORD:=TWO(U) OR SAVEWORD;                 38286000
            GO TO PBS;                                              %R9038287000
      END ELSE%                                                     %R9038288000
      IF KIND=2 THEN%                                               %R9038289000
      BEGIN IF PRNTABLE[U]}0 THEN GO TO DCN;%                       %R9038290000
            CNTCTL~MODE;%                                           %R9038291000
      END ELSE%                                                     %R9038292000
      IF KIND=8 THEN%                                               %R9038293000
      BEGIN UNLABELED~CNTCTL~1;%                                    %R9038294000
            DIREC~0;%                                               %R9038295000
      END;%                                                         %R9038296000
      IF UNLABELED THEN%                                            %R9038297000
      BEGIN IF COBOL THEN%                                          %R9038298000
            BEGIN MASK~0;%                                          %R9038299000
                  IF KIND=1 THEN BEGIN T1~@4000100000; REED END ELSE%%R938300000
                  IF KIND=7 OR KIND=12 THEN                         %R9038301000
                BEGIN HEADER[73]~@1540176000100000&FIB[5][FTC];     %R9038302000
                        FIB[5].[FF]~FIB[5].[FF]+1;                  %R9038303000
                        FIB[14].[FF]~T1+38; GO FIND;                %R9038304000
                  END;                                              %R9038305000
            END;%                                                   %R9038306000
      END ELSE%                                                     %R9038307000
      BEGIN IF COBOL THEN%                                          %R9038308000
            BEGIN M[ALPHA-2]~P(DUP,LOD)&CNTLBITS[18:18:15];%        %R9038309000
                  IF U<16 THEN%                                     %R9038310000
                  STREAM(N~PRNTABLE[U].[30:18],D~M[ALPHA-2]);%      %R9038311000
                         BEGIN SI~LOC N; DI~DI+53; DS~5 DEC END;%   %R9038312000
            END ELSE%                                               %R9038313000
            BEGIN IF REEL=0 THEN REEL~1;%                           %R9038314000
                  IF CYCLE=0 THEN CYCLE~1;%                         %R9038315000
                  IF CDATE=0 THEN STREAM(DATE,CD~[CDATE]);%         %R9038316000
                              BEGIN SI~LOC DATE; SI~SI+3; DS~5 OCT END; 38317000
                  LABELAREA;%                                       %R9038318000
                  BUILDLABEL(M[ALPHA-2],MFID,FID,REEL,CDATE,CYCLE,% %R9038319000
                             FIB[4],(IF U<16 THEN PRNTABLE[U].[30:18]%%R38320000
                                             ELSE 0),STATE.[46:2],% %R9038321000
                             BLEN,RLEN);%                           %R9038322000
            END;%                                                   %R9038323000
            M[M[ALPHA-2] INX P(DUP).[8:10]]~@3700000000000000;%     %R9038324000
            IF KIND=7 OR KIND=12 OR KIND=1 THEN                     %R9038325000
            BEGIN IF TYPE GEQ 20 THEN                                   38325100
            BEGIN M[M[ALPHA-2] INX 4]:=FLAG(NABS(JAR[P1MIX,0]));        38325200
                  M[M[ALPHA-2] INX 5]:=FLAG(JAR[P1MIX,1]&17[1:43:5]);   38325300
                  STREAM(A:=[M[M[ALPHA-2] INX 6]]);                     38325400
                  BEGIN DS:=15 LIT" PUNCH BACK-UP "; DS:=LIT"%";        38325500
                        2(DS:=8 LIT"%%%%%%%%");                         38325600
                  END;                                                  38325700
            END ELSE                                                    38325800
            BEGIN T1:=M[M[ALPHA-2] INX 3];                              38326000
                  DISKWAIT(-(M[ALPHA-2] INX 4),10,JAR[P1MIX,6].[CF]);   38327000
              M[M[ALPHA-2] INX 13]~FLAG(NABS(JAR[P1MIX,0]))&0[2:47:1];  38328000
                  M[M[ALPHA-2]INX 14]~FLAG(JAR[P1MIX,1]&17[1:43:5]);%R9038329000
                  M[M[ALPHA-2] INX 3]:=T1;                              38330000
            END;                                                        38330100
                  M[M[ALPHA-2] INX 1]:=MFID;                            38331000
                  M[M[ALPHA-2] INX 2]~FID;                          %R9038332000
                  IF KIND=1 THEN M[ALPHA-2]~P(DUP,LOD)&1[27:42:6] ELSE%R38333000
                  BEGIN HEADER[73]~FIB[5].[FF]&1[CTF]&15[3:43:5];   %R9038334000
                        FIB[5]~P(DUP,LOD,0,1,CFX,+);                %R9038335000
                        STREAM(L~M[ALPHA-2],B~[HEADER[56]]);        %R9038336000
                        BEGIN SI~L; DS~17 WDS END;                  %R9038337000
                        FIB[14].[FF]~[HEADER[38]]; GO FIND;         %R9038338000
            END;  END;                                              %R9038339000
            T1~NFLAG(M[ALPHA-2]);%                                  %R9038340000
            MASK~0; REED;%                                          %R9038341000
            IF KIND=2 THEN%                                         %R9038342000
            BEGIN T2~@1737000000000000;%                            %R9038343000
                  T1~NFLAG([T2]);%                                  %R9038344000
                  REED;%                                            %R9038345000
            END;%                                                   %R9038346000
      END;%                                                         %R9038347000
      P(0);                                                         %R9038348000
FINALOUT:: IF BLEN=0 THEN GO TO DCN;%                               %R9038349000
           IF NOT FIB[18].[1:1] OR P THEN                           %R9038350000
                GETBUFFERS(BLEN,NBUFS,U,ALPHA);                     %R9038351000
FIND::                                                              %R9038352000
      P(P&RCW[CTC],0,RDS,0,XCH,P&P[CTF],STF);                       %R9038353000
END OTHER FILE OPEN;                                                %R9038354000
PROCEDURE DISKCLOSE(ALPHA); VALUE ALPHA; INTEGER ALPHA;%            %R9038355000
BEGIN REAL RCW=+0,MSCW=-2;                                          %R9038356000
      ARRAY FIB=+1[*],FPB=+2[*],HEADER=+3[*];%                      %R9038357000
%%%      DONT ADD ANY DECLARATIONS BETWEEN "HEADER" AND "KIND" %%% WCP%R38358000
      INTEGER KIND=+4,NBUFS=+5,U=+6,BLEN=+7,CODE=+8,                %R9038359000
              UNLABELED=+9,COBOL=+10,I=+11,J=+12,FNUM=+13;              38360000
      REAL MID=+14,FID=+15,R=+16,D=+17,C=+18,FORMS=+19,STATE=+20;       38362000
      LABEL EOF,CLEANUP;%                                           %R9038363000
      LABEL OBJTYPE, DUMMY;                                         %R9038364000
      REAL T1=+21,T2=+22,T3=+23,IOD=+24;                            %R9038365000
      ARRAY SEG0=+25[*],SKEL=+26[*];                                %R9038366000
      LABEL L1,L2,L3;                                               %R9038367000
%                                                                   %R9038368000
      SUBROUTINE COOLOFF;%                                          %R9038369000
      BEGIN FOR I~0 STEP 1 UNTIL NBUFS-1 DO%                        %R9038370000
            BEGIN IF NOT M[ALPHA+I].[19:1] THEN%                    %R9038371000
                        SLEEP([M[ALPHA+I]],IOMASK);%                %R9038372000
                  IF KIND!4 THEN                                    %R9038373000
                  IF M[ALPHA+I].[27:1] THEN GO TO EOF;%             %R9038374000
            END;%                                                   %R9038375000
EOF:  END COOLOFF;%                                                 %R9038376000
%                                                                   %R9038377000
      REAL T=+27,ACCESS=+28;%                                       %R9038378000
      BOOLEAN COMPGO=+29;                                           %R9038379000
      DEFINE REW=CODE.[47:1]#,%                                     %R9038380000
             KRUNCH=NOT CODE.[42:1]#,                               %R9038381000
             REL=CODE.[46:1]#,%                                     %R9038382000
             TIME=CODE.[45:1]#,%                                    %R9038383000
             LOCK=NOT CODE.[44:1]#,%                                %R9038384000
             PURGE=NOT CODE.[43:1]#;%                               %R9038385000
      DEFINE TECH=STATE.[46:2]#,             OPENIO=FIB[13].[22:1]#,    38385400
             WRITBACK=FIB[13].[23:1]#,       LASTIO=FIB[13].[46:1]#,    38385500
             WRITEAFTEREOF=FIB[13].[44:2]#,  INPUT=STATE.[43:1]#;       38385600
%                                                                   %R9038386000
      P(RCW,MSCW,STF);       RCW ~ RCW & P(XCH)[CTC];                   38387000
      HEADER ~ FIB[14];      ACCESS ~ FIB[4].[27:3];                    38388000
      IF COBOL THEN                                                     38389000
      BEGIN  IF COBOL > 0 THEN                   % COBOL 61             38389100
             BEGIN IF WRITBACK AND TECH=0 AND LASTIO AND                38389200
                      (OPENIO OR NOT(INPUT))   THEN                     38389300
                       IF ACCESS=1 AND WRITEAFTEREOF!0 THEN             38389400
                       BEGIN  FIB[7] ~ *P(DUP) - 1;                     38389500
                              HEADER[7] ~ *P(DUP) - 1;                  38389600
                       END ELSE WRITEAFTEREOF ~ 0;                      38389700
                   IF TECH=0 THEN IF WRITEAFTEREOF=2 THEN               38389800
                        BEGIN  FIB[7] ~ *P(DUP) + 1;                    38389900
                               HEADER[7] ~ *P(DUP) + 1;                 38390000
                        END ELSE IF WRITEAFTEREOF=1 THEN                38390100
                        BEGIN  FIB[7] ~ *P(DUP) - 1;                    38390200
                               HEADER[7] ~ *P(DUP) - 1;                 38390300
                        END;                                            38390400
                   WRITEAFTEREOF ~ 0;                                   38390500
             END;                                                       38391000
             IF ACCESS=1 THEN                    % IF RANDOM            38391100
            BEGIN IF COBOL > 0 THEN              % COBOL61              38391200
                  BEGIN ACCESS ~ 4;                                     38391300
                  IF FIB[13].[10:9] = 2 THEN     % SEEK IN PROCESS      38391400
                     BEGIN COOLOFF; FIB[13].[10:9] ~ 1;  END            38391500
                  END ELSE IF FIB[17]<BLEN THEN ACCESS~4;  % COBOL68    38391600
            END;                                                        38391700
            IF FIB[13].[23:1] AND ACCESS=0 THEN                         38391800
            BEGIN FIB[7]~P(DUP,LOD)-1;                                  38391900
                  ACCESS~4;                                             38391910
      END;  END;                                                        38391950
      IF NOT STATE.[41:1] THEN%                                     %R9038392000
      BEGIN IF ACCESS=1 THEN%                                       %R9038393000
            BEGIN COOLOFF;%                                         %R9038394000
            END ELSE%                                               %R9038395000
            IF ACCESS=0 THEN%                                       %R9038396000
            BEGIN COOLOFF; IF NOT STATE.[43:1] THEN%                %R9038397000
                  IF FIB[17]<BLEN AND STATE.[46:2]!0 THEN%          %R9038398000
                   BEGIN R := SPACE(((BLEN+29) DIV 30)|30 + 1);         38399000
                        IF (M[R]~M[FIB[16]]~%                       %R9038400000
                        DISKADDRESS(MID,FID,FIB[7]-1,HEADER,0))!0 THEN  38401000
                        BEGIN                                           38401500
                        P(WAITIO(FIB[16]&1[24:47:1]&R[33:33:15],%   %R9038402000
                                 0,U),DEL);%                        %R9038403000
                        MOVE(FIB[17],R+BLEN-FIB[17]+1,%             %R9038404000
                              FIB[16] INX BLEN-FIB[17]+1);%         %R9038405000
                        P(WAITIO(FIB[16],0,U),DEL);%                %R9038406000
                        IF NOT FIB[16].[24:1] THEN HEADER[4].[11:1]~1;  38406500
                        END;                                            38407000
                        FORGETSPACE(R);%                            %R9038408000
                  END;%                                             %R9038409000
            END ELSE%                                               %R9038410000
            BEGIN  COOLOFF;                                             38411000
                   IF (FIB[17] LSS BLEN AND STATE.[46:2]!0) OR          38411500
                   ACCESS=4 THEN                                        38412000
            BEGIN       IF ACCESS=4 THEN                                38412500
                             IF FIB[13].[23:1] OR NOT STATE.[43:1] THEN 38413000
                                  ACCESS := 2;                          38413500
                             IF (M[FIB[16]]:=DISKADDRESS(MID,FID,FIB[7],38414000
                                  HEADER,0))=0 THEN ACCESS := 4;        38414200
                        IF ACCESS!4 THEN                                38414400
                          BEGIN P(WAITIO(FIB[16]&0[24:24:1],0,U),DEL);  38414500
                                HEADER[4].[11:1]~1; END;                38414600
            END;   IF ACCESS = 4 THEN ACCESS := 2;                      38414800
            END;%                                                   %R9038415000
      END;%                                                         %R9038416000
    IF (NOT REW) OR LOCK OR REL OR TIME THEN                        %R9038419000
    BEGIN                                                           %R9038420000
      FORMS~HEADER[3];                                              %R9038421000
      STREAM(PF~[FIB[4]],D~FPB[FNUM+2].[18:30],H~[HEADER[3]],S~[T]);%R9038422000
      BEGIN SI~PF;SI~SI+5;DS~3 OCT;SI~LOC D;DI~H;DS~8 OCT END;      %R9038423000
      HEADER[3]~(P(DUP,LOD,SSN))&(P(DUP))[12:30:18]&T[2:38:10];     %R9038424000
    END;                                                            %R9038425000
      IF LOCK THEN%                                                 %R9038426000
      BEGIN IF NOT HEADER[4] THEN % FILE IS BEING CREATED               38427000
            BEGIN                                                   %R9038428000
              IF KRUNCH THEN KRUNCHER(HEADER);                      %R9038429000
                   HEADER[4].[9:3]:=5;% MARK AS NEW FORMAT,ACCESSED %R9038430000
                  IF JAR[P1MIX,0] < 0 AND FIB[4].[29:1] THEN        %R9038431000
% COMPILER CLOSING CODE FILE WITH LOCK *********************************38432000
                   BEGIN                                            %R9038433000
                        SEG0 ~ [M[GETSPACE(62,2,0)+2]]&30[8:38:10]; %R9038434000
                        SKEL ~ 31 INX SEG0; T3 ~ JAR[P1MIX,2].[FF]; %R9038435000
                        % READ IN SEGMENT ZERO                      %R9038436000
                        DISKWAIT(-SEG0.[CF],30,HEADER[10]);         %R9038437000
                        % READ IN SKELETON SHEET                    %R9038438000
                        DISKWAIT(-SKEL.[CF],30,T3);                 %R9038439000
                        IF SKEL[20]<0 THEN SKEL[20] ~ SEG0[7].[FF]; %R9038440000
                        IF JAR[P1MIX,2].[8:10]=1 THEN               %R9038441000
                           BEGIN % COMPILE AND GO **********************38442000
                             DISKWAIT(SKEL.[CF],30,T3);             %R9038443000
                             COMPGO ~ TRUE;                         %R9038444000
                           END                                      %R9038445000
                        ELSE                                        %R9038446000
                           BEGIN % COMPILE TO LIBRARY ******************38447000
                             FOR T1 ~ 15 STEP 1 UNTIL 22 DO         %R9038448000
                                  SEG0[T1] ~ SKEL[T1];              %R9038449000
                             IF (T2 ~ SKEL[13]) = 0 THEN GO TO L3;  %R9038450000
                             SKEL[13] ~ 0; % IN CASE I CALL TERMINATE%R938451000
                             DISKWAIT(SKEL.[CF],30,T3);             %R9038452000
                             IF (T1:=DISKADDRESS(MID,FID,HEADER[7]:=    38453000
                                  (*P(DUP))+1,HEADER,0))=0 THEN         38454000
                                  FILEMESS(-"DISK   ","OVRFLOW",MID,FID,38455000
                                                           R,D,C);  %R9038456000
                             SEG0[15] ~ T1 ~ HEADER[7];             %R9038457000
                   L1:       DISKWAIT(-SKEL.[CF],30,T2);            %R9038458000
                             FORGETESPDISK(T2);                     %R9038459000
                             IF (T2~SKEL[29]) = 0 THEN GO TO L2;    %R9038460000
                             IF (T3:=DISKADDRESS(MID,FID,               38461000
                                  HEADER[7]:=(*P(DUP))+1,               38461500
                                       HEADER,0))=0 THEN            %R9038462000
                                  FILEMESS(-"DISK   ","OVRFLOW",MID,FID,38463000
                                                           R,D,C);  %R9038464000
                             SKEL[29] ~ T3 ~ HEADER[7];             %R9038465000
                             DISKWAIT(SKEL.[CF],30,                 %R9038466000
                                    I~HEADER[T1 DIV HEADER[8]+10] + %R9038467000
                                             T1 MOD HEADER[8]);     %R9038468000
                             T1 ~ T3;                               %R9038469000
                             GO TO L1;                              %R9038470000
                   L2:       DISKWAIT(SKEL.[CF],30,                 %R9038471000
                                    I~HEADER[T1 DIV HEADER[8]+10] + %R9038472000
                                             T1 MOD HEADER[8]);     %R9038473000
                   L3:       SEG0[6] ~ P(DUP,LOD,SSN); % "NEW FORMAT"%R938474000
                             HEADER[4].[10:1]~1;%MARK AS PROGRAM FILE%R938475000
                             DISKWAIT(SEG0.[CF],30,HEADER[10]);     %R9038476000
                           END COPY OF LABEL EQUATION CARDS;        %R9038477000
                        FORGETSPACE(SEG0);                          %R9038478000
                        IF HEADER[7]<HEADER[8]-1 THEN               %R9038479000
                          BEGIN FORGETUSERDISK(HEADER[10]+HEADER[7]+1,%R38480000
                                               HEADER[7]-HEADER[8]+1);  38481000
                                HEADER[8] ~ HEADER[7]+1;            %R9038482000
                          END;                                      %R9038483000
                        FOR T1:=-1 STEP 1 UNTIL 4 DO                %R9038484000
DUMMY ::                      IF P(.OBJTYPE,T1,+,LOD) =             %R9038485000
                                  ABS(JAR[P1MIX,0]) THEN            %R9038486000
                                       HEADER[4].[36:6]:=T1+2;      %R9038487000
                   END CODE FILE;                                       38488000
                   HEADER[1]~FORMS&HEADER[3][6:30:18];              %R9038489000
                    IF (HEADER[2]:=USERCODE[P1MIX]).[1:1] THEN      %R9038490000
                        HEADER[2]:=0;                               %R9038491000
                  HEADER[5] := HEADER[6] := 0;                      %R9038492000
%                                                                   %R9038493000
                  IF COMPGO THEN                                    %R9038494000
                   BEGIN PRT[P1MIX,@26]~IOD~GETESPDISK;             %R9038495000
                        DISKWAIT(HEADER.[CF],30,IOD);               %R9038496000
                   END ELSE                                         %R9038497000
                   BEGIN                                            %R9038498000
                   ENTERUSERFILE(MID,FID,HEADER.[CF]-1);            %R9038499000
                   END;                                             %R9038500000
            END;%                                                   %R9038501000
      END;%                                                         %R9038502000
      IF REW AND NOT(LOCK OR REL OR TIME) THEN STATE.[39:4]~2 ELSE% %R9038503000
BEGIN%                                                              %R9038504000
      HEADER[1]~FORMS&HEADER[3][6:30:18];                           %R9038505000
       IF HEADER[4] THEN % FILE IS ALREADY IN DIRECTORY                 38506000
      BEGIN J ~ 0;                                                      38507000
           IF (T~FIB[16].[CF])!0 THEN                                   38507100
           BEGIN T~T-2;                                                 38507200
                FOR I~NBUFS-1 STEP -1 UNTIL 0 DO                        38507300
                   IF M[T].[11:1] THEN J~I~-1 ELSE                      38507400
                   T ~ M[T].[18:15] - 2;                                38507500
           END;                                                         38507600
           IF HEADER[4].[11:1] THEN J ~ 1;                              38507700
           I ~ IF FIB[5].[1:1] THEN FIB[5].[13:3]+10 ELSE               38508000
                (HEADER INX 0)&FIB[5][30:13:3];                         38508500
           IF(I~DIRECTORYSEARCH(MID,FID&J[3:47:1],I))!0 THEN            38509000
           IF PURGE THEN                                                38510000
           IF M[I+4].[12:4]=0 THEN                                      38511000
           IF NOT SYSTEMFILE(MID,FID) THEN                              38512000
              IF SECURITYCHECK(MID,FID,USERCODE[P1MIX],I).[45:1] THEN%R938513000
                                                                    %R9038514000
                 P(DIRECTORYSEARCH(-MID,FID,7),DEL);                    38515000
           IF I!0 THEN FORGETSPACE(I);                                  38516000
      END ELSE%                                                     %R9038517000
      IF NOT LOCK THEN%                                             %R9038518000
    BEGIN                                                           %R9038519000
      HEADER[2]~USERCODE[P1MIX];                                    %R9038520000
      DISKLOG(MID,FID,HEADER);                                      %R9038521000
      FOR I~10 STEP 1 UNTIL 29 DO%                                  %R9038522000
      IF HEADER[I]!0 THEN FORGETUSERDISK(HEADER[I],-HEADER[8]);%     %R938523000
    END;                                                            %R9038524000
      FORGETSPACE(HEADER);                                          %R9038525000
      STATE.[39:4]~1;%                                              %R9038526000
END;%                                                               %R9038527000
      IF NOT COBOL THEN FIB[4].[27:3]~3;                            %R9038528000
      GO CLEANUP;%                                                  %R9038529000
OBJTYPE::: "BASIC  ",  %1%                                          %R9038530000
           "ALGOL  ",  %2%                                          %R9038531000
           "COBOL  ",  %3%                                          %R9038532000
           "FORTRAN",  %4%                                          %R9038533000
           "TSPOL  ",  %5%                                          %R9038534000
           "XALGOL ",  %6%                                          %R9038535000
                   0;  %DUMMY%                                      %R9038536000
CLEANUP:                                                            %R9038537000
      P(P&RCW[CTC],0,RDS,0,XCH,P&P[CTF],STF);                       %R9038538000
END DISK CLOSE;                                                     %R9038539000
PROCEDURE BACKCLOSE(ALPHA); VALUE ALPHA; INTEGER ALPHA;%            %R9038540000
BEGIN REAL RCW=+0,MSCW=-2;                                          %R9038541000
      ARRAY FIB=+1[*],FPB=+2[*],HEADER=+3[*];%                      %R9038542000
%%%      DONT ADD ANY DECLARATIONS BETWEEN "HEADER" AND "KIND" %%% WCP%R38543000
      INTEGER KIND=+4,NBUFS=+5,U=+6,BLEN=+7,CODE=+8,                %R9038544000
              UNLABELED=+9,COBOL=+10,I=+11,J=+12,FNUM=+13;              38545000
      REAL MID=+14,FID=+15,R=+16,D=+17,C=+18,FORMS=+19,STATE=+20;       38547000
      LABEL EOF,PBD,PUD;%                                               38548000
      REAL T1=+21,T2=+22,T3=+23,IOD=+24;                            %R9038549000
      ARRAY SEG0=+25[*],SKEL=+26[*];                                %R9038550000
%                                                                   %R9038551000
      SUBROUTINE COOLOFF;%                                          %R9038552000
      BEGIN FOR I~0 STEP 1 UNTIL NBUFS-1 DO%                        %R9038553000
            BEGIN IF NOT M[ALPHA+I].[19:1] THEN%                    %R9038554000
                        SLEEP([M[ALPHA+I]],IOMASK);%                %R9038555000
                  IF KIND!4 THEN                                    %R9038556000
                  IF M[ALPHA+I].[27:1] THEN GO TO EOF;%             %R9038557000
            END;%                                                   %R9038558000
EOF:  END COOLOFF;%                                                 %R9038559000
%                                                                   %R9038560000
      REAL T=+27,ACCESS=+28;%                                       %R9038561000
      BOOLEAN COMPGO=+29;                                           %R9038562000
      REAL TYPE=+30;                                                    38562100
      DEFINE REW=CODE.[47:1]#,%                                     %R9038563000
             REL=CODE.[46:1]#,%                                     %R9038564000
             TIME=CODE.[45:1]#,%                                    %R9038565000
             LOCK=NOT CODE.[44:1]#,%                                %R9038566000
             PURGE=NOT CODE.[43:1]#;%                               %R9038567000
%                                                                   %R9038568000
%                                                                   %R9038569000
      SUBROUTINE CKBKUP;                                            %R9038570000
      BEGIN M[M[ALPHA]INX 17   ]~M[ALPHA]&(FIB[5]               )[FTC]; 38571000
            FIB[5]~P(DUP,LOD,0,1,CFX,+);                            %R9038572000
            IF NOT PRTROW[P1MIX].[7:1] THEN                             38573000
            IF FIB[14].[CF]=FIB[14].[FF]                                38573100
         THEN BEGIN PBIO(ALPHA,FIB[14]);SLEEP([M[ALPHA]],IOMASK)END ELSE38574000
              BEGIN; STREAM(S~           M[ALPHA],Z~FIB[14].[FF]);  %R9038575000
                   BEGIN SI~S; DS~18 WDS END;                       %R9038576000
                   FIB[14].[FF]~P(DUP).[FF]-18;                     %R9038577000
      END;    END;                                                  %R9038578000
      LABEL CLOSEOUT;%                                              %R9038579000
      P(RCW,MSCW,STF);                                              %R9038580000
      RCW:=RCW&P(XCH)[CTC];                                         %R9038581000
         J~LOCK; IF FIB[17]<0 THEN%                                 %R9038582000
         BEGIN M[ALPHA].[FF]~@60020; IF TYPE<20 THEN CKBKUP;            38583000
         M[ALPHA].[18:1]~0; CKBKUP END%                             %R9038584000
              ELSE IF FIB[17]<BLEN THEN%                            %R9038585000
      BEGIN IF NOT COBOL THEN FIB[17]~FIB[17]-(STATE.[46:2]=3);%    %R9038586000
            STREAM(N~FIB[17],D~M[ALPHA].[33:15]+BLEN-FIB[17]);       %AI38587000
                 BEGIN N(DS~8 LIT " "); END;                         %AI38587500
M[ALPHA]~FLAG(FIB[16]&0[20:47:1]); CKBKUP;                          %R9038588000
      END ELSE COOLOFF;                                             %R9038589000
      M[ALPHA].[FF]~@60001;                                         %R9038590000
      IF NOT UNLABELED THEN                                         %R9038591000
      BEGIN IF TYPE<20 THEN CKBKUP;                                     38591100
            M[ALPHA]~(*P(DUP))&2[18:45:3]&M[ALPHA-2][8:8:10];           38592000
            STREAM(L~M[ALPHA-2],B~M[ALPHA]); BEGIN SI~L; DS~17 WDS END; 38593000
      END; M[ALPHA].[20:1]~1; IF FIB[14].[FF]!FIB[14].[CF] THEN     %R9038594000
      BEGIN CKBKUP; FIB[14].[FF]~P(DUP);END; CKBKUP;                %R9038595000
      IF KIND=12 THEN % PBD                                         %R9038596000
      BEGIN T~FIB[14].[3:15];                                       %R9038597000
            IF(R:=M[T+7]|3)!0 THEN    %PRESUMABLY 0 IMPLIES NO USER DISK38597500
         BEGIN                                                          38598000
            IF R LSS 900 THEN                                           38598500
            BEGIN FORGETUSERDISK(M[T+10]+R,R-900);                      38599000
                  M[T+8]~R;                                         %R9038600000
            END;                                                    %R9038601000
            M[T+1]~M[T+3];                                          %R9038602000
            STREAM(A~FPB[FNUM+2].[18:30],T~T+3);                    %R9038603000
            BEGIN SI~LOC A;DS~8 OCT;DI~DI-8;DS~2 LIT"+2";           %R9038604000
                 SI~T;SI~SI+5;DS~3 CHR;                             %R9038605000
            END;                                                    %R9038606000
            M[T+1].[6:18]~M[T+3].[30:18];                           %R9038607000
            IF I:=TYPE>20 THEN M[T+5].[3:1]:=0;                         38607100
            ENTERUSERFILE(IF I THEN P(PUD) ELSE P(PBD),R~M[T+6],T-1);   38608000
            IF AUTOPRINT THEN                                           38609000
            IF PRINTORPUNCHWAIT(R.[6:24],I) THEN                        38609500
            BEGIN % MARK FILE SO THAT AUTOPRINT WILL NOT GRAB IT AGAIN  38610000
                 T~DIRECTORYSEARCH(IF I THEN P(PUD) ELSE P(PBD),        38610500
                   R&1[CTC],5);                                         38610600
                 M[T+4].[6:1]:=1;                                       38611000
                 LOCKDIRECTORY;                                         38612000
                 DISKWAIT(T INX 0,30,T.[FF]);                           38613000
                 UNLOCKDIRECTORY;                                       38614000
                 FORGETSPACE(T);                                        38615000
            END ELSE ELSE                                               38616000
            IF PBDREL OR USEPBD THEN                                    38617000
            FILEMESS((IF I THEN P(PUD) ELSE P(PBD))&R[24:6:24],         38618000
                    " REL:  ",MID,FID,0,0,0);                           38619000
            FOR T:=1 STEP 1 UNTIL R.[CF] DO                             38620000
            FORGETSPACE(DIRECTORYSEARCH(IF I THEN P(PUD) ELSE P(PBD),   38621000
                        R&T[CTC],14));                                  38621100
         END                                                            38621500
      END       ELSE                                                %R9038622000
      BEGIN T~@1737000000000000;                                    %R9038623000
            J~WAITIO([T],@40,U)!0 OR J;                             %R9038624000
            I := SPACE(8);                                          %R9038625000
            STREAM(PN:=TYPE GEQ 20,D:=0,I);                             38626000
            BEGIN                                                       38626100
                 DS:=24LIT" LABEL  0PBTMCP 0BACK-UP";                   38626200
                 PN(D:=DI; DI:=DI-14; DS:=2LIT"UT"; DI:=D);             38626300
                 20(DS:=2LIT"  ");                                      38626400
            END;                                                        38626500
      IF NOT UNLABELED THEN M[I+4]~M[M[ALPHA-2] INX 4].[42:6];      %R9038628000
      J~WAITIO(I&8[8:38:10]&5[21:45:3],@40,U)!0 OR J;%              %R9038629000
      FORGETSPACE(I);%                                              %R9038630000
      FOR I~0 STEP 1 UNTIL 1 DO%                                    %R9038631000
            P(WAITIO(@1000000340000005,@40,U),DEL);%                %R9038632000
      IF (TWO(U) AND SAVEWORD)!0 THEN%                              %R9038633000
            SETNOTINUSE(U,0) ELSE                                   %R9038634000
BEGIN%                                                              %R9038635000
      RDCTABLE[U].[8:6]~0;PRNTABLE[U].[15:15]~0;%                   %R9038637000
      RRRMECH~NOT TWO(U) AND RRRMECH;%                              %R9038638000
     I:=IF AUTOPRINT THEN NOT PRINTORPUNCHWAIT(-U,TYPE GEQ 20)          38639000
        AND 1 ELSE 1;                                                   38639100
     IF I THEN IF J THEN SETNOTINUSE(U,0) ELSE LABELTABLE[U].[1:5]:=1;%R38640000
      END; END;                                                     %R9038641000
STATE.[FF]~0;                                                       %R9038642000
      GO CLOSEOUT;%                                                 %R9038643000
PBD:::   "PBD    ";                                                 %R9038644000
PUD:::   "PUD    ";                                                     38644500
CLOSEOUT:                                                           %R9038645000
      P(P&RCW[CTC],0,RDS,0,XCH,P&P[CTF],STF);                       %R9038646000
END BACK CLOSE;                                                     %R9038647000
PROCEDURE OTHERCLOSE(ALPHA); VALUE ALPHA; INTEGER ALPHA;%           %R9038648000
BEGIN REAL RCW=+0,MSCW=-2;                                          %R9038649000
      ARRAY FIB=+1[*],FPB=+2[*],HEADER=+3[*];%                      %R9038650000
%%%      DONT ADD ANY DECLARATIONS BETWEEN "HEADER" AND "KIND" %%% WCP%R38651000
      INTEGER KIND=+4,NBUFS=+5,U=+6,BLEN=+7,CODE=+8,                %R9038652000
              UNLABELED=+9,COBOL=+10,I=+11,J=+12,FNUM=+13;              38653000
      REAL MID=+14,FID=+15,R=+16,D=+17,C=+18,FORMS=+19,STATE=+20;       38655000
      REAL T1=+21,T2=+22,T3=+23,IOD=+24;                            %R9038656000
      ARRAY SEG0=+25[*],SKEL=+26[*];                                %R9038657000
      REAL T=+27,ACCESS=+28;%                                       %R9038658000
      BOOLEAN COMPGO=+29;                                           %R9038659000
      LABEL PX,PBD;                                                 %R9038660000
      LABEL CR,LP,MT,CLOSED,DK,SP,CP,BKUP,PP,PR,DC,CD,CC;           %R9038661000
      SWITCH SW~CR,LP,MT,CLOSED,DK,SP,CP,BKUP,PP,PR,DC,CD,BKUP;     %R9038662000
      LABEL EOF,ON,DNE,CLEANUP;%                                    %R9038663000
      LABEL EOD;                                                    %R9038664000
      SUBROUTINE COOLOFF;%                                          %R9038665000
      BEGIN FOR I~0 STEP 1 UNTIL NBUFS-1 DO%                        %R9038666000
            BEGIN IF NOT M[ALPHA+I].[19:1] THEN%                    %R9038667000
                        SLEEP([M[ALPHA+I]],IOMASK);%                %R9038668000
                  IF KIND!4 THEN                                    %R9038669000
                  IF M[ALPHA+I].[27:1] THEN GO TO EOF;%             %R9038670000
            END;%                                                   %R9038671000
EOF:  END COOLOFF;%                                                 %R9038672000
%                                                                   %R9038673000
      DEFINE REW=CODE.[47:1]#,%                                     %R9038674000
             REL=CODE.[46:1]#,%                                     %R9038675000
             TIME=CODE.[45:1]#,%                                    %R9038676000
             LOCK=NOT CODE.[44:1]#,%                                %R9038677000
             PURGE=NOT CODE.[43:1]#;%                               %R9038678000
%                                                                   %R9038679000
      SUBROUTINE EMPTY;%                                            %R9038680000
      IF FIB[17]<BLEN AND (STATE.[46:2]!0 OR KIND=1) THEN           %R9038681000
      BEGIN IF NOT COBOL THEN FIB[17]~FIB[17]-(STATE.[46:2]=3);%    %R9038682000
            STREAM(KIND,N~FIB[17],D~M[ALPHA].[33:15]+BLEN-FIB[17]);  %AI38683000
            BEGIN SI~LOC KIND; SI~SI+7;%                            %R9038684000
                  IF SC="2" THEN DS~LIT "~" ELSE%                   %R9038685000
                  IF SC="5" THEN DS~LIT "~" ELSE N(DS~8 LIT " ");%  %R9038686000
            END;%                                                   %R9038687000
            P(WAITIO(FIB[16]&(BLEN-FIB[17]|(KIND=2))[8:38:10]%      %R9038688000
                                       ,@40,U),DEL);%               %R9038689000
            FIB[6]~FIB[6]+1;                                        %R9038690000
      END ELSE COOLOFF;%                                            %R9038691000
      LABEL CLOSEOUT;%                                              %R9038692000
      LABEL EOFIT;%                                                 %R9038693000
%                                                                   %R9038694000
      P(RCW,MSCW,STF);                                              %R9038695000
      RCW:=RCW&P(XCH)[CTC];                                         %R9038696000
      GO TO SW[KIND];                                               %R9038697000
%                                                                   %R9038698000
CR:   COOLOFF; BLASTQ(U);%                                          %R9038699000
      IF I}NBUFS THEN DO UNTIL WAITIO(M[ALPHA-2],@40,U)!0 ELSE%     %R9038700000
      BEGIN I~M[ALPHA+I].[33:15];%                                  %R9038701000
            T~FIB[16].[33:15]-2;%                                   %R9038702000
            FOR J~1 STEP 1 UNTIL NBUFS DO%                          %R9038703000
            BEGIN IF (I>T) AND (I{(T+BLEN+1)) THEN GO ON;%          %R9038704000
                  T~M[T].[18:15]-2;%                                %R9038705000
            END;%                                                   %R9038706000
      ON:   MOVE(10,T+2,M[ALPHA-2]);%                               %R9038707000
      END;%                                                         %R9038708000
      IF JAR[P1MIX,0]<0 THEN%                                       %R9038709000
      IF PRT[P1MIX,@25]!0 THEN%                                     %R9038710000
DNE:  BEGIN;STREAM(I:A~"END",D~M[ALPHA-2]);%                        %R9038711000
            BEGIN SI~D;%                                            %R9038712000
            L:    SI~SI+1; IF SC=" " THEN GO TO L;%                 %R9038713000
                  DI~LOC A; DI~DI+5;%                               %R9038714000
                  IF 3 SC=DC THEN TALLY~1;%                         %R9038715000
                  I~TALLY;%                                         %R9038716000
            END;%                                                   %R9038717000
            IF NOT P THEN%                                          %R9038718000
            BEGIN BLASTQ(U);%                                       %R9038719000
                  DO UNTIL WAITIO(M[ALPHA-2],@40,U)!0;%             %R9038720000
                  GO TO DNE;%                                       %R9038721000
            END;%                                                   %R9038722000
      END;%                                                         %R9038723000
      BLASTQ(U);                                                    %R9038724000
CC::                                                                %R9038725000
      NT3 ~ GETSPACE(13,64,0)+4;                                    %R9038726000
      MOVE(10,M[ALPHA-2],NT3);                                      %R9038727000
      FORGETSPACE(M[ALPHA-2] INX NOT 1);                            %R9038728000
      M[ALPHA-2]~NT3;                                               %R9038729000
      LABELTABLE[U]~-@14;                                           %R9038730000
      RDCTABLE[U]~0;                                                %R9038731000
      FREECARD((M[ALPHA-2].[CF])&U[3:43:5]);                        %R9038732000
      GO CLOSEOUT;%                                                 %R9038733000
%                                                                   %R9038734000
CP:   EMPTY;%                                                       %R9038735000
      IF NOT UNLABELED THEN P(WAITIO(M[ALPHA-2],0,U),DEL);%         %R9038736000
      SETNOTINUSE(U,FORMS);                                         %R9038737000
      GO CLOSEOUT;%                                                 %R9038738000
%                                                                   %R9038739000
LP:   EMPTY;%                                                       %R9038740000
      P(WAITIO(@4000100000,0,U),DEL);%                              %R9038741000
      IF NOT UNLABELED THEN P(WAITIO(M[ALPHA-2],0,U),DEL);%         %R9038742000
      SETNOTINUSE(U,FORMS);                                         %R9038743000
      GO CLOSEOUT;%                                                 %R9038744000
%                                                                   %R9038745000
SP:   IF STATE.[43:1] THEN COOLOFF ELSE EMPTY;%                     %R9038746000
      GO CLOSEOUT;%                                                 %R9038747000
%                                                                   %R9038748000
MT:   IF NOT STATE.[41:1] THEN%                                     %R9038749000
      BEGIN IF STATE.[43:1] THEN%                                   %R9038750000
            BEGIN COOLOFF; BLASTQ(U);%                              %R9038751000
                  IF NOT REW THEN                                       38752000
                  BEGIN T~@1000000140000005&STATE[22:44:1];%        %R9038753000
                       IF I}NBUFS THEN SKIPFILE(U,T.[22:1]);        %R9038754000
                       IF NOT UNLABELED THEN                            38754100
                       P(WAITIO(T,@377,U),DEL);                     %R9038755000
                  END;%                                             %R9038756000
            END ELSE%                                               %R9038757000
            BEGIN EMPTY;%                                           %R9038758000
      EOFIT:      T~@1737000000000000;%                             %R9038759000
                  P(WAITIO([T],@40,U),DEL);%                        %R9038760000
                  IF NOT UNLABELED THEN%                            %R9038761000
                  BEGIN;STREAM(BC~FIB[6],RC~FIB[7],D~M[ALPHA-2]);%  %R9038762000
                        BEGIN SI~LOC BC; DI~DI+40;%                 %R9038763000
                              DS~5 DEC; DS~7 DEC;%                  %R9038764000
                        END;%                                       %R9038765000
                        P(WAITIO(M[ALPHA-2],@40,U),DEL);%           %R9038766000
                        P(WAITIO([T],@40,U),DEL);%                  %R9038767000
                        T~@1000000340000005;%                       %R9038768000
                        P(WAITIO(T,@40,U) ,DEL);%                   %R9038769000
                  END;%                                             %R9038770000
            END;%                                                   %R9038771000
      END ELSE%                                                     %R9038772000
      IF FIB[18].[1:1]THEN BEGIN FIB[18].[1:1]~FIB[16]~0; GO EOFIT END; 38773000
      IF REW THEN%                                                  %R9038774000
      BEGIN P(WAITIO(@4200000000,@377,U),DEL);%                     %R9038775000
            STATE.[40:1]~0;%                                        %R9038776000
      END ELSE STATE.[40:1]~NOT STATE.[44:1];%                      %R9038777000
PX:   IF REL THEN%                                                  %R9038778000
      BEGIN SETNOTINUSE(U,0);                                       %R9038779000
            STATE.[41:2]~1;%                                        %R9038780000
      END ELSE STATE.[41:2]~2;%                                     %R9038781000
      IF LOCK THEN%                                                 %R9038782000
      BEGIN SETNOTINUSE(U,1);                                       %R9038783000
            STATE.[41:2]~1;%                                        %R9038784000
      END;%                                                         %R9038785000
      IF U LSS 16 THEN                                              %R9038786000
      IF PURGE THEN%                                                %R9038787000
      BEGIN IF PRNTABLE[U]<0 THEN%                                  %R9038788000
            FORK(P(.PURGEIT),U,-2,128,0) ELSE SETNOTINUSE(U,0);     %R9038789000
            STATE.[41:2]~1;%                                        %R9038790000
      END;%                                                         %R9038791000
      GO TO CLEANUP;%                                               %R9038792000
%                                                                   %R9038793000
PP::  IF NOT STATE.[41:1] THEN%                                     %R9038794000
      BEGIN EMPTY; P(WAITIO(@2004500000000,@40,U),DEL) END;%        %R9038795000
      GO TO PX;                                                     %R9038796000
%                                                                   %R9038797000
PR::  IF NOT STATE.[41:1] THEN BEGIN COOLOFF; BLASTQ(U) END;%       %R9038798000
      IF REW THEN P(WAITIO(@10340000000,@377,U),DEL);%              %R9038799000
      GO TO PX;%                                                    %R9038800000
%                                                                   %R9038801000
CD::  HEADER~CIDROW[U-32];                                          %R9038802000
      IF M[ALPHA].[27:1] THEN MOVE(10,FIB[16].[33:15],M[ALPHA-2]) ELSE%R38803000
EOD:  DO UNTIL READEMFROMDISK(HEADER,M[ALPHA-2]);                   %R9038804000
      IF HEADER[3]<HEADER[7] THEN                                   %R9038805000
      IF JAR[P1MIX,0]<0 AND PRT[P1MIX,21]!0 OR JAR[P1MIX,1]<0 THEN  %R9038806000
      BEGIN;STREAM(E~"END":Q~@14,D~M[ALPHA-2]);                     %R9038807000
            BEGIN SI~LOC Q; SI~SI+7; IF SC!DC THEN DI~DI+1; Q~DI; SI~Q; 38808000
               L: IF SC=" " THEN BEGIN SI~SI+1; GO TO L END;        %R9038809000
                  DI~LOC E; DI~DI+5; IF 3 SC!DC THEN TALLY~1; E~TALLY;%R38810000
            END;                                                    %R9038811000
            IF P THEN GO TO EOD;                                    %R9038812000
      END;                                                          %R9038813000
      KIND~0;                                                       %R9038814000
      GO TO CC;                                                     %R9038815000
%                                                                   %R9038816000
CLOSEOUT::  STATE.[39:4]~1; TIME~1;%                                %R9038817000
CLEANUP:: CLOSED: DK: BKUP: DC:                                     %R9038818000
      P(P&RCW[CTC],0,RDS,0,XCH,P&P[CTF],STF);                       %R9038819000
END OTHER CLOSE;                                                    %R9038820000
PROCEDURE FILEOPEN(XTRA,ALPHA);                                     %R9039000000
    VALUE ALPHA,XTRA; INTEGER ALPHA,XTRA;                           %R9039000100
BEGIN REAL RCW=+0;%                                                     39001000
      REAL IOM=IOMASK, IOMASK;                                          39001100
      REAL XTRAR=-4,XTRAC=-6;                                       %R9039001200
      INTEGER NBUFS,FNUM,BLEN,TYPE,REEL,CDATE,CYCLE,MODE,IO,RLEN,U,KIND,39002000
              DIREC,FORMS,COBOL,UNLABELED,OPTIONAL,CNTCTL;              39003000
         REAL MFID,FID,T1,T2,MASK,STATE;                                39004000
      ARRAY FIB[*],FPB[*];%                                             39005000
      INTEGER ACCESS,FIB7;                                              39006000
      LABEL DCIN,PBS;                                                   39006100
      LABEL DKRN,SPN,DKSN,DKUN,DCN;%                                    39007000
      SWITCH INSW~DKRN,SPN,DKSN,DKUN,DCIN;                              39008000
      LABEL LOOK,EXIT,LOOKOUT,LPS,FINALIN,FINALOUT,SPDC;%               39009000
 $ VOID 39026                                                       %R9039010000
      REAL SUBROUTINE CNTLBITS;%                                        39026000
            CNTLBITS~IOMASK&MODE[21:47:1]&DIREC[22:47:1]&CNTCTL[23:47:1]39027000
                  &IO[24:47:1]&(KIND=7 OR KIND>9 AND KIND{12)[20:47:1]  39028000
                  &(IF KIND=1OR KIND=7OR KIND=12THEN@20ELSE 0)[27:42:6];39029000
%                                                                       39030000
      SUBROUTINE MAKEIODS;%                                             39031000
      BEGIN FIB[16]~T1~((BLEN-1)|DIREC+M[ALPHA])&CNTLBITS[18:18:15]%    39032000
                  &(IF BLEN{1023 THEN BLEN ELSE 1023)[8:38:10]%         39033000
                  &TINU[IF (KIND=7 OR KIND=12) THEN IF TYPE<20          39034000
                        THEN 20 ELSE 22 ELSE                            39034050
                        IF KIND=11 THEN 23 ELSE U][3:3:5] OR M;         39034100
            FIB[19]~(IF STATE.[46:2]=0 THEN (DIREC INX T1)%             39035000
                        &(2|DIREC+(BLEN>1023)+1)[3:43:5] ELSE%          39036000
                  IF STATE.[46:2]=1 THEN ((NOT RLEN INX 2)|DIREC INX T1)39037000
                        &RLEN[8:38:10]&(3|DIREC+2)[3:43:5] ELSE%        39038000
                     (1-DIREC INX T1)&RLEN[8:38:10]&(DIREC+6)[3:43:5])% 39039000
                    &IO[25:47:1];%                                      39040000
            IF NOT (IO OR COBOL)THEN%                                   39041000
                  T1~FIB[19]&T1[3:3:5]&0[25:25:1];%                     39042000
            T2~T1.[33:15]-M[ALPHA];%                                    39043000
            FOR MASK~0 STEP 1 UNTIL NBUFS-1 DO%                         39044000
            BEGIN                                                    %P 39045000
            M[ALPHA+MASK]~FLAG((P(DUP,LOD)+T2)&P(T1,XCH)[33:33:15]);%   39046000
            END;%                                                       39047000
      END MAKEIODS;%                                                    39048000
      LABEL DKRO,SPO,DKSO,DKUO,DCO;%                                    39049000
      SWITCH OUTSW~DKRO,SPO,DKSO,DKUO,DCO;%                             39050000
 $ VOID 39054                                                       %R9039051000
      LABEL FIXFIB,FIND,SPACER;%                                        39054000
      LABEL PREFINAL,DK1;%                                              39055000
      ARRAY HEADER[*];%                                                 39056000
 $ VOID 39082                                                       %R9039057000
%                                                                       39082000
      FIB~M[ALPHA-3]; FPB~PRT[P1MIX,3];%                                39083000
      IOMASK:=IOM;                                                      39083100
      NBUFS~FIB[13].[1:9]; FNUM~FIB[4].[13:11]; BLEN~FIB[18].[3:15];%   39084000
      TYPE~FPB[FNUM+3].[43:5];%                                         39085000
      STREAM(S~[FPB[FNUM+2]],D~[CDATE]);%                               39086000
      BEGIN SI~S; SI~SI +3; DS~5 OCT; DS~2 OCT END;%                    39087000
      IF FPB[FNUM+4]>0 THEN REEL ~ CDATE ~ CYCLE ~ 0;                   39087500
      MODE~FIB[13].[24:1]; IO~FIB[13].[27:1]; RLEN~FIB[18].[33:15];%    39088000
      DIREC~FIB[13].[25:1]; FORMS~FPB[FNUM+3].[42:1];%                  39089000
      STATE~FIB[5];  UNLABELED~FIB[4].[2:1];                            39090000
      MFID~FPB[FNUM]; FID~FPB[FNUM+1]; OPTIONAL~FIB[4].[5:1];%          39091000
      COBOL~(FIB[13] AND 1)&([FIB].[8:10]=22)[1:47:1];  % COBOL 60 & 68 39091100
      KIND~FIB[4].[8:4]; REEL~FIB[13].[28:10];%                         39092000
      IF TYPE=19 THEN TYPE:=14 ELSE IF TYPE>25 THEN GO TO DCN;          39092050
               IF TYPE=14 THEN IF LOGLINE.[33:7]=0 THEN TYPE:=11;   %R2639092075
      IF (TYPE=0 AND NOT IO) OR TYPE GEQ 20 THEN                        39092080
      BEGIN IF USEPBD THEN TYPE~22; GO LOOKOUT END;                     39092090
      IF TYPE = 01 OR TYPE = 04 OR TYPE > 14 THEN%                   %DS39092100
        IF IO THEN GO DCN ELSE  % CANT READ PRINTERS OR PB.         %10639092110
         BEGIN  IF  USEPBD  THEN TYPE := 15; GO LOOKOUT; END;        %DS39092150
      IF REEL=0 THEN REEL~1;                                            39092200
      IF TYPE = 06 THEN IF IO THEN GO DCN; % CANT READ PBT.         %10639092300
      IF IO THEN IF TYPE}10 THEN GO TO INSW[TYPE-10] ELSE GO LOOK;%     39093000
      IF TYPE}10 THEN GO TO OUTSW[TYPE-10]; GO TO LOOKOUT;%             39094000
LOOK: OTHERFILEOPEN(1);                                             %R9039095000
      IF U LSS 0 THEN GO TO EXIT ELSE GO TO PREFINAL;               %R9039096000
 $ VOID 39143                                                       %R9039097000
DCN:  FILEMESS(-"I/O ERR",0,MFID,FID,REEL,CDATE,CYCLE);%                39143000
      GETBUFFERS(BLEN,NBUFS, U,ALPHA);%                                 39144000
PREFINAL::  MAKEIODS;%                                                  39145000
      IF KIND=11 THEN                                                   39145100
      BEGIN IF COBOL { 0 THEN          % ALGOL OR COBOL68               39145200
            IF READEMFROMDISK(CIDROW[U-32],M[ALPHA]) THEN               39145210
                  M[ALPHA]~P(DUP,LOD)&0[2:2:1]&1[27:47:1];              39145300
      END ELSE                                                          39145400
      FILLBUFFERS(FIB[16],FIB[19-3|ABS(COBOL)],NBUFS-(COBOL>0),NBUFS);  39146000
      IF COBOL>0 THEN FIB[16]~(*P(DUP))&M[ALPHA][CTC];                  39147000
FINALIN:: FIB[6] ~ FIB[7] ~ FIB[17] ~ 0; GO TO FIXFIB;                  39148000
LOOKOUT:: OTHERFILEOPEN(0);                                         %R9039155000
          IF U LSS 0 THEN GO EXIT ELSE GO FIND;                         39156000
 $ VOID 3923                                                        %R9039157000
FINALOUT::  IF NOT FIB[18].[1:1] THEN GETBUFFERS(BLEN,NBUFS,U,ALPHA);%  39230000
FIND:       MAKEIODS;%                                                  39231000
            FIB[6]~FIB[7]~0;%                                           39232000
            FIB[17]~IF COBOL THEN FIB[18].[3:15]ELSE FIB[18].[18:15];%  39233000
              IF KIND = 10 THEN                                         39233100
              M[ALPHA+1]~P(DUP,LOD)&P(DUP,LNG)[24:24:1];                39233200
            GO TO FIXFIB;%                                              39234000
DCIN::                                                                  39234900
DCO:  U~30; KIND~10;                                                    39235000
      IF (BLEN:=RLEN) LSS 17 THEN BLEN:=17;                             39235100
      FIB[13].[1:9]~NBUFS~2;                                            39235200
      FIB[18]:=(*P(DUP))&BLEN[3:33:15]&BLEN[CTF];                       39235250
      GO TO SPDC;                                                       39235300
SPO:  MODE~0; U~25; KIND~5;                                             39236000
SPDC: CNTCTL~DIREC~0; UNLABELED~1;                                      39237000
      STARTIMING(FNUM,U);%                                              39238000
      GO TO FINALOUT;%                                                  39239000
SPN:: U~25; KIND~5;                                                     39240000
      MODE~CNTCTL~DIREC~0; UNLABELED~1;%                                39241000
      STARTIMING(FNUM,U);%                                              39242000
      IF BLEN<10 THEN BLEN~10;%                                         39243000
      GETBUFFERS(BLEN,NBUFS,U,ALPHA);%                                  39244000
      MAKEIODS;%                                                        39245000
      GO TO FINALIN;%                                                   39246000
DKRN:: DKRO: ACCESS:=1;                                             %R9039247000
             GO TO DK1;                                             %R9039248000
DKUO::       IO:=1;                                                 %R9039249000
DKUN::       ACCESS:=2;                                             %R9039250000
             GO TO DK1;                                             %R9039251000
 $ VOID                                                             %R9039252000
 $ VOID                                                             %R9039253000
DKSN:: DKSO: ACCESS~0;%                                                 39254000
DK1:         DISKFILEOPEN(0);                                       %R9039255000
            IF T1 THEN GO TO EXIT;                                      39256000
FIXFIB::    FIB[4].[2:1]~UNLABELED;%                                    39294000
            FIB[4].[8:4]~KIND;%                                         39295000
            FIB[15].[24:6]~U;                                           39296000
            FIB[13].[28:10]~REEL;%                                      39297000
            FPB~PRT[P1MIX,3];                                           39297010
            FPB[FNUM+3].[43:5]~TYPE;                                    39297020
             STREAM(REEL,D~[FPB[FNUM+2]]);                              39297100
             BEGIN SI~LOC REEL;                                         39297200
                  IF 3 SC=DC THEN                                       39297300
                  BEGIN DI~D; SI~LOC REEL; DS~3 DEC END;                39297400
             END;                                                       39297500
            RDCTABLE[U].[8:6]~P1MIX;%                                   39298000
            IF FIB[18].[1:1] THEN%                                      39299000
            BEGIN FIB[16]~0;%                                           39300000
                  FIB[5]~STATE&8[39:42:6];%                             39301000
                   FIB[10].[3:15]~0;                                    39301100
            END ELSE%                                                   39302000
           FIB[5].[CF]~STATE&DIREC[44:47:1]&IO[39:43:5]&FIB[5][45:45:1];39303000
            IF COBOL>0 OR FIB[4].[7:1] THEN M[FIB INX NOT 1].[3:6] ~ 6  39304000
                     ELSE M[ALPHA-7].[3:6]~4;%                          39305000
            FIB[4].[27:3]~ACCESS;%                                      39306000
            IF U LSS 16 THEN FPB[FNUM+3].[23:1]:=IO;                    39306010
                                                                        39306100
                                                                        39306200
EXIT::%                                                                 39307000
      IF XTRA THEN                                                  %R9039307100
         XTRAC:=NOT(FIB[4].[7:1] OR UNLABELED) AND XTRAC NEQ 2;     %R9039307200
      IF XTRA LSS 2 THEN GO TO INITIATE;                            %R9039307300
      RCW:=XTRAR;                                                   %R9039307400
END FILEOPEN;%                                                          39308000
 PROCEDURE CREATELOG;                                                   39500000
         BEGIN ARRAY A=LOGARRAY[*];                                     39501000
              DEFINE IO=A[31]#,                                         39502000
                   DELTA=A[32]#,                                        39503000
                   N=A[33]#,                                            39504000
                   S=A[34]#,                                            39505000
                   R=A[35]#,                                            39506000
                   H=A[36]#;                                            39507000
              LABEL GETANOTHERROW,NEWLOG;                               39507500
              REAL T; INTEGER I,RC;                                 %LOG39508000
              ARRAY T1=RC[*];                                           39508050
              REAL B,J,K;                                               39508100
$INCLUDE 39508151, IF DCP;                                              39508149
              LABEL AROUND,EXIT;                                        39508150
$OMIT 39508501, IF DCP;                                                 39508199
              SUBROUTINE FIX;                                           39508200
              BEGIN M[T]:=[M[J]]&I[8:38:10];                            39508300
                   J:=J+I;                                              39508400
              END;                                                      39508500
              SUBROUTINE BUILDHEAD;                                     39508520
              BEGIN M[T]:=0;                                            39508540
                   MOVE(29,T,T+1);                                      39508560
                   M[T+2]:=MCP;                                         39508580
                   M[T+4].[9:1]:=1;                                     39508600
                   M[T+5]:=M[T+6]:=@14;                                 39508620
                   M[T+9]:=1;                                           39508640
                   STREAM(DATE,X:=T+3);                                 39508660
                   BEGIN SI:=LOC DATE; DS:=8 OCT;                       39508680
                        DI:=X; DS:=2 LIT"+#";                           39508700
                        SI:=X; SI:=SI+5; DS:=3 CHR;                     39508720
                   END;                                                 39508740
                   M[T+10]:=PETUSERDISK((M[T+8]:=I)&1[2:47:1],1);       39508760
              END;                                                      39508780
              A[30]:=NOT 0;                                             39508900
              IF (T:=DIRECTORYSEARCH("LOG    "                          39509000
$ INCLUDE 39509011, IF SHAREDISK;                                       39509009
                   &(SYSNO+17)[24:42:6]                                 39509010
                   ,"DISK   ",5))=0 THEN                                39509020
              BEGIN T:=SPACE(30);      % IF YOU CANT FIND ONE, MAKE %LOG39509050
                   DISKWAIT(-T,-30,DIRECTORYTOP-SYSNO);                 39509100
                   M[T INX 20].[8:10] := N := 0;                    %LOG39509150
                   DISKWAIT(T,-30,DIRECTORYTOP-SYSNO);                  39509200
                   S:=(I:=300) OR MEMORY;                               39509250
                   BUILDHEAD;                                           39509260
                   IF (R:=M[T+10])=0 THEN                               39509265
                   BEGIN M[T INX 7]:=-1;                                39509270
                        FORK(P(.LOGWARN),0,-1,128,0);                   39509275
                   END ELSE                                             39509280
                   BEGIN M[T INX 7]:=899;              %EOF POINTER     39509285
                        DISKWAIT(A INX 30,1,R);        %EOF MARKER      39509290
                   END;                                                 39509295
                   M[T] := @0001200036000301;          %BLOCKING    %LOG39509300
                   ENTERUSERFILE("LOG    "                              39509850
$ INCLUDE 39509861, IF SHAREDISK;                                       39509859
                        &(SYSNO+17)[24:42:6]                            39509860
                        ,"DISK   ",T-1);                                39509870
                   H:=DIRECTORYFREE.[33:14];                            39509900
              END ELSE                                              %LOG39510000
              BEGIN                    %AHA, THERE REALLY IS A LOG  %LOG39510050
              H~T.[FF];                                                 39518000
                   S:=M[T INX 8]&1[2:47:1];                             39519000
              I:=9;                                                 %LOG39519050
              DO I:=I+1 UNTIL M[T INX I]=0 OR I=30;                 %LOG39519100
              RC:=I:=I-10;                                          %LOG39519150
              IF N DIV S}I THEN                                         39519200
    GETANOTHERROW:                                                  %LOG39519250
              IF RC LSS 20 THEN        % DONT TRY TO GET 21-ST ROW  %LOG39519270
              BEGIN N~I|S;                                              39519300
              IF P(M[T INX I+10]:=PETUSERDISK(-S,1),DUP)=0 THEN         39519320
                   BEGIN P(DEL);                                        39519340
                        R:=0;                                           39519360
                   END ELSE                                             39519380
                   BEGIN R:=P(XCH)-N;                                   39519400
                   DISKWAIT(A INX 30,1,R+N);                        %LOG39519450
                   RC:=RC+1;                                        %LOG39519500
                   END                                                  39519550
              END ELSE ELSE                                         %LOG39519600
              BEGIN R~M[T INX I+9]-(I~(I-1)|S);                         39520000
              J:=I+S;                                                   39520100
              IF N!0 OR I!0 THEN           % SET UP SEARCH FOR EOF      39520200
              IF N LSS I THEN N:=I ELSE I:=N-1 ELSE                     39520300
              IF M[T INX 5]!@14 THEN       % MUST BE COLD START         39520400
              BEGIN M[T INX 5]:=M[T INX 6]:=@14;                        39520500
                   GO TO NEWLOG;                                        39520600
              END;                                                      39520700
              K:=1;                                                     39520800
              B := SPACE(30);                                           39521000
              FOR I~I STEP 1 UNTIL J DO                                 39522000
              BEGIN DISKWAIT(-B,30,R+I);                                39523000
                   IF (M[B]=NOT 0) OR K>(K~M[B].[25:23]) THEN           39524000
                   BEGIN J~0; N~I END;                                  39525000
              END;                                                      39526000
              FORGETSPACE(B);                                           39528000
              IF J!0 THEN GO GETANOTHERROW;                         %LOG39528050
              END;                                                      39528100
    NEWLOG:   M[T INX 7] := (M[T INX 9]:=RC) | 3|S - 1;                 39528200
              DISKWAIT(T.[CF],30,H);                                %LOG39528300
              END;                                                  %LOG39529000
              FORGETSPACE(T);                                       %LOG39530000
              IF RC = 20 THEN FORK(P(.LOGOUT),0,0,128,0);           %LOG39530500
$OMIT 39553001, IF DCP;                                                 39530999
              IF (T:=DIRECTORYSEARCH("SYSTEM "                          39531000
$ INCLUDE 39531101, IF SHAREDISK;                                       39531099
                   &(SYSNO+17)[42:42:6]                                 39531100
                   ,"DISK   ",5))!0 THEN                                39531200
              BEGIN SYSDISKADR~M[T INX 10];                             39532000
                   SYSDISK~M[T];                                        39534000
                   TOGLE:=TOGLE OR SYSDISKMASK;                         39534500
                   T1:=IOQUE&T[CTC];                                    39534600
                   SYSDISKIO(1,0,T1);                                   39535000
                   IF (LMAX:=T1[4].[40:8]) GTR MAXLMAX THEN             39536000
                     LMAX:=MAXLMAX;                                     39536500
$OMIT 39538001, IF TWXONLY;                                             39536999
                   IF (STAMAX:=T1[4].[32:8]) GTR MAXLMAX THEN           39537000
                     STAMAX:=MAXLMAX;                                   39537500
                   IF (K:=T1[4].[24:8]) GTR MAXLMAX THEN K:=MAXLMAX;    39538000
                   SYSDISKIO(1,STAMAX+1,T1);                            39539000
                   FORGETSPACE(T);                                      39540000
                   B:=(J:=M[RC:=(*(T:=P(.LINETABLE)))-2].[CF]           39541000
$OMIT 39541501, IF TWXONLY;                                             39541499
                          -LMAX-4|STAMAX-K-6)-2;                        39541500
$INCLUDE 39541601, IF TWXONLY;                                          39541599
                          -5|LMAX-5)-2;                                 39541600
                   I:=LMAX+1;  FIX;                                     39542000
$OMIT 39543001, IF TWXONLY;                                             39542999
                   I:=STAMAX+1;                                         39543000
                   T:=P(.STATABLE);  FIX;                               39544000
                   T:=P(.SEQARRAY);  FIX;                               39545000
                   T:=P(.INPUTANK);  FIX;                               39546000
                   T:=P(.TANKS);  FIX;                                  39547000
$OMIT 39549101, IF TWXONLY;                                             39547999
                   I:=K+1;                                              39548000
                   T:=P(.TNAOG);  FIX;                                  39549000
                   IF LMAX!MAXLMAX OR K!MAXLMAX THEN                    39549100
                   BEGIN                                                39549200
                        M[M[B]:=M[RC]&RC[CTF]].[FF]:=B;                 39550000
                        M[RC].[CF]:=B;                                  39551000
                        FORGETSPACE(RC+2);                              39552000
              END  END;                                                 39553000
$INCLUDE 39580001, IF DCP;                                              39553999
              IF (T:=DIRECTORYSEARCH("SYSDCP "                          39554000
$INCLUDE 39554501, IF SHAREDISK;                                        39554499
                   &(SYSNO+17)[42:42:6]                                 39554500
                   ,"DISK   ",5))=0 THEN T:=SPACE(30) ELSE              39555000
              IF M[T INX 7]=STAMAX THEN                                 39555500
              BEGIN SYSDISKADR:=M[T INX 10];                            39556000
                   SYSDISK:=M[T];                                       39556500
                   GO AROUND;                                           39557000
              END                                                       39557500
              ELSE P(DIRECTORYSEARCH(-"SYSDCP "                         39558000
$INCLUDE 39558501, IF SHAREDISK;                                        39558499
                   &(SYSNO+17)[42:42:6]                                 39558500
                   ,"DISK   ",6),DEL);                                  39559000
              I:=(STAMAX+6) DIV 7 + 1;                                  39559500
              BUILDHEAD;                                                39560000
              IF (SYSDISKADR:=M[T+10])=0 THEN                           39560500
              BEGIN STREAM(T);                                          39561000
                   DS:=31 LIT"-*NO USER DISK FOR SYSTEM/DISK~";         39561500
                   SPOUT(T);                                            39562000
                   GO TO EXIT;                                          39562500
              END;                                                      39563000
              M[T]:=SYSDISK:=@0000400036000701;                         39563500
              M[T+7]:=STAMAX;                                           39564000
              K:=SPACE(J:=30|I);                                        39564500
              MOVE(J,K-1,K);                                            39565000
              DISKWAIT(K,J,SYSDISKADR);                                 39565500
              FORGETSPACE(K);                                           39566000
              ENTERUSERFILE("SYSDCP "                                   39566500
$INCLUDE 39567001, IF SHAREDISK;                                        39566999
                   &(SYSNO+17)[42:42:6]                                 39567000
                   ,"DISK   ",T-1);                                     39567500
    AROUND:   FORGETSPACE(T);                                           39568000
              TOGLE:=TOGLE OR SYSDISKMASK;                              39568500
              T1:=IOQUE&SPACE(10)[CTC];                                 39569000
              SYSDISKIO(1,0,T1);                                        39569500
              SPOWORD:=T1[3];                                           39570000
              K:=0;                                                     39570500
%                                                                       39570600
%   USE SYSDCP TO REBUILD STATABLE AS IT WAS BEFORE THE H/L.            39570700
%                                                                       39570800
              FOR I:=1 STEP 1 UNTIL STAMAX DO                           39571000
              BEGIN INPUTANK[I]:=TANKS[I]:=-0;                          39571500
                   SYSDISKIO(1,I,T1);                                   39572000
                   IF T1[0]=0 THEN T:=0 ELSE                            39572500
                   IF (T:=0&T1[0][15:15:25]&1[22:47:1]).[20:1] THEN     39573000
                   IF T.DIALEDUP AND T1[2].[6:24]="FILE" THEN           39573500
                   BEGIN T:=T&70[16:41:7]&K[40:40:8];                   39574000
                        K:=I;                                           39574500
                   END ELSE                                             39575000
                   BEGIN T1[0]:=T1[1]:=T1[2]:=0;                        39575500
                        SYSDISKIO(0,I,T1);                              39576000
                        T:=0;                                           39576500
                   END;                                                 39577000
                   STATABLE[I]:=T;                                      39577500
              END;                                                      39578000
              STATABLE[0]:=(*P(DUP))&K[CTC]&1[4:47:1];                  39578500
              SYSDISKIO(1,STAMAX+1,T1);                                 39579000
              FORGETSPACE(T1);                                          39579500
    EXIT:                                                               39580000
         END;                                                           39580500
 PROCEDURE DIRECTORYBUILDER(A,DDD);                                     40000000
         VALUE A,DDD;                                                   40001000
         REAL A;                                                        40002000
         ARRAY DDD[*];                                                  40003000
BEGIN REAL Y,Z,B,C,I,J,T,RA,RL,RT1,R;INTEGER RADD,RLEN;                 40004000
REAL NEXTLINK,AD,X,K;ARRAY SU[*];REAL SEVEN7,FORTY,L,CTR;               40005000
ARRAY HEAD[*],KK[*],PL[*];                                              40005050
REAL W,ESPADD,DISKTOP,SUPER,EUM,NT1,NT2,NT3,NT4;                        40005100
BOOLEAN UCHANG,ERROR;INTEGER LO,REM,TN,TM,MN;REAL X1,X2,EUMASK;         40005110
ARRAY ZSF[*],SOCK[*];                                                   40005200
REAL D,Y1,Y2;                                                           40005210
LABEL FORGET;                                                           40005230
              ARRAY V[*,*];                                             40006000
              INTEGER S;                                                40006100
              ARRAY VR=V[*];                                            40007000
              REAL H,FI,FJ;                                             40008000
LABEL LOOKATDKB,BACK,EXIT,M1,SKBLK,LTR;                                 40008050
DEFINE ROW=SU[X].[3:4]#,                                             %MC40008100
       LASTAVAIL=HEAD[0].[3:15]#,                                       40008110
     AVAILABLE=HEAD[0].[FF]#,                                           40008120
       FIRSTLINK=HEAD[0].[CF]#,                                         40008130
       DA=9:24#,DAC=9:24:24#,                                        %MC40008140
     SIZE=PL[1].[DA]#,                                                  40008150
     ADDRESS=PL[0].[DA]#,                                               40008160
       HIGHLINK=PL[0].[CF]#,                                            40008170
       LOWLINK=PL[1].[CF]#,                                             40008180
       DISKRUNNING=[18:1]#,                                          %MC40008190
       FORTYMILLDISK=[19:1]#,                                        %MC40008200
       OCCUPIED=[20:1]#,                                             %MC40008210
        AV1=480#,AVBLOCK=16#;                                           40008220
SUBROUTINE SAVIT;                                                    %MC40008300
BEGIN                                                                %MC40008310
IF (W~W+2)}28 THEN                                                   %MC40008320
BEGIN ZSF[29]~ESPADD;DISKWAIT(ZSF INX 0,30,ESPADD~GETESPDISK);       %MC40008330
W~0 END;ZSF[W]~T;ZSF[W+1]~DDD[479-2|I];                              %MC40008340
END SAVIT;                                                           %MC40008350
 SUBROUTINE CLEAR;                                                      40009000
         BEGIN V[S,0]~0;                                                40010000
              V[S,1] ~ BYPASS.[CF];                                     40011000
              V[S,2]~@14;                                               40012000
              V[S,3]~V[S,4]~0;                                          40013000
              MOVE(57,[V[S,2]],[V[S,5]]);                               40014000
         END;                                                           40015000
SUBROUTINE SETUP;                                                    %MC40016000
BEGIN                                                                   40016020
LO:=(X+1) MOD 5;LO:=LO+(LO=0)|5;                                        40016025
IF RADD NEQ (LO:=LO|FORTY) OR (LO=RADD AND RLEN LSS FORTY) THEN         40016026
BEGIN                                                                %MC40016100
IF Y:=(SU[X].[CF]=0) THEN                                               40016200
    BEGIN                                                            %MC40016220
      NT1:=SU[X]:=(GETSPACE(16,0,0)+2)&SU[X][18:18:9];                  40016240
      MOVE(16,NT1-1,NT1);                                               40016260
    END;                                                             %MC40016300
M[SU[X] INX K]~RT1~GETSPACE(64+Y,0,0)+2;                             %MC40016400
KK~[M[RT1]]&(64+Y)[8:38:10];JUNK~61+Y;                                  40016410
MOVE(64+Y,RT1-1,RT1);                                                   40016420
FOR R:=3|Y STEP 2 UNTIL JUNK DO KK[R]:=RT1+R+2;                         40016500
HEAD~[M[M[SU[X]]]]&1[8:38:10];                                       %MC40016510
IF Y THEN                                                            %MC40016600
BEGIN                                                                   40016700
    KK[1]:=KK[2]:=SEVEN7;                                               40016800
    KK[1].[DA]:=LO;                                                     40016900
    KK[2].[DA]:=IF X EQL 0 THEN FORTY-(DISKBOTTOM+5) ELSE FORTY;        40016910
    M[SU[X]].[DA]:=LO;                                                  40016920
      HEAD[0]:=RT1+1;                                                   40017050
END;                                                                    40017100
HEAD[0].[FF]~RT1+3|Y;                                                %MC40017200
HEAD[0].[3:15]~62+RT1+Y;                                             %MC40017250
END                                                                     40017260
     ELSE                                                               40017270
DO BEGIN SU[X].OCCUPIED:=1;X:=X-1 END UNTIL(RLEN:=RLEN-FORTY)LSS FORTY; 40017280
END OF SETUP;                                                        %MC40017300
SUBROUTINE BUILDAVAIL;                                               %MC40027100
BEGIN                                                                %MC40027200
BACK::ERROR~1;REM~0;                                                 %MC40027230
IF(Z:=SU[X])!0 AND Z.[CF]=0 THEN BEGIN K:=0;SETUP END;                  40027240
IF (Z:=SU[X]).DISKRUNNING AND NOT Z.OCCUPIED AND RLEN>0 THEN            40027250
    BEGIN                                                            %MC40027260
       IF M[SU[X]].[DA] GEQ RADD THEN                                   40027270
       BEGIN                                                            40027280
       P(M[M[SU[X]]],0&RADD[9:24:24],LLL,0,INX,.AD,~,DEL);           %MC40027290
       HEAD~[M[M[SU[X]]]]&1[8:38:10];PL~[M[AD]]&2[8:38:10];          %MC40027295
            IF ((RA:=ADDRESS)-(RL:=SIZE) LSS RADD-RLEN OR               40039000
             (REM:=IF(NT1:=RADD MOD FORTY)=0 THEN 0 ELSE NT1-RLEN) LSS  40039100
             0)AND RADD NEQ RA THEN                                     40039200
           BEGIN                                                     %MC40040000
              IF REM LSS 0 THEN RLEN:=RADD MOD FORTY;                   40040500
              IF AVAILABLE=0 THEN%NEED ANOTHER ROW                   %MC40041000
                BEGIN                                                %MC40042000
                   K~ROW;K~K+1;ROW~K;                                %MC40042100
                   IF K GTR 15 THEN DO UNTIL FALSE;                  %MC40043000
                        SETUP;                                       %MC40044000
                END;                                                 %MC40045000
              NEXTLINK~M[R~AVAILABLE];                               %MC40046000
              M[R]~AD&(RADD-RLEN)[DAC];                              %MC40047000
              IF AD.[CF]=SEVEN7 THEN M[SU[X]].[DA]~RADD-RLEN;        %MC40047100
            IF LOWLINK=SEVEN7 THEN                                      40048000
               FIRSTLINK:=R                                             40049000
                    ELSE                                                40050000
               M[LOWLINK].[CF]:=R;                                      40051000
           M[R+1]:=PL[1]&(RADD-RLEN-(RA-RL))[DAC];                      40055000
            PL[1]:=R&(RA-RADD)[DAC];                                    40056000
              RLEN~0;                                                %MC40056100
              AVAILABLE~NEXTLINK;ERROR~FALSE;                        %MC40057000
           END                                                       %MC40058000
              ELSE%REDUCE EXISTING AREA(BEWARE OF ADDRESS CONFLICT OR%MC40059000
                  %EU UNDERFLOW).                                    %MC40060000
         BEGIN                                                       %MC40060050
              IF RADD=RA AND RL GEQ RLEN THEN                           40060100
             BEGIN                                                   %MC40060200
                ADDRESS~RA-RLEN;                                     %MC40060300
                IF HIGHLINK=SEVEN7 THEN                              %MC40060302
                M[SU[X]].[DA]~ADDRESS;                               %MC40060305
                SIZE~RL-RLEN;ERROR~RLEN~0;                           %MC40060400
             END                                                     %MC40060500
              ELSE                                                   %MC40060600
           IF RLEN>RL THEN                                           %MC40061000
            IF LOWLINK=SEVEN7 AND(X-1)MOD 5!4 THEN                   %MC40062000
               BEGIN                                                 %MC40063000
                  RADD~RADD-RL-1;RLEN~RLEN-RL-1;SIZE~0;ERROR~0;      %MC40064000
               END                                                   %MC40065000
               ELSE                                                     40065010
              IF RADD-RLEN LSS (NT1:=M[LOWLINK].[DA]) THEN              40065020
                   BEGIN                                                40065030
                   RLEN:=RLEN-(RADD-(RADD:=NT1));                       40065040
                   SUPER:=1;GO BACK;                                    40065050
                   END                                                  40065060
                        ELSE                                            40065070
              IF RADD GTR RA-RL THEN                                    40065080
                   BEGIN                                                40065090
                   RLEN:=RADD-(RA-RL);SUPER:=1;                         40065100
                   GO BACK;                                             40065110
                   END                                                  40065120
                 ELSE  RLEN~ 0                                       %MC40066000
               ELSE                                                  %MC40067000
             BEGIN SIZE~RL-RLEN;ERROR~RLEN~0; END;                   %MC40068000
         END;                                                        %MC40068050
           IF SIZE=0 THEN                                            %MC40068100
             BEGIN                                                   %MC40069000
                IF HIGHLINK=SEVEN7 AND LOWLINK=SEVEN7 THEN           %MC40070000
                  BEGIN                                              %MC40071000
                 SU[X].OCCUPIED~TRUE;                                %MC40072000
                     K~-1;                                           %MC40073000
                   WHILE(Y~M[SU[X]INX (K~K+1)])!0 AND K{15 DO        %MC40074000
                        FORGETSPACE(Y);                              %MC40075000
                     FORGETSPACE(SU[X]);                             %MC40076000
                  END                                                %MC40077000
                 ELSE                                                %MC40078015
                  BEGIN                                              %MC40078020
                      IF HIGHLINK=SEVEN7 THEN                        %MC40078030
                        BEGIN                                        %MC40078031
                        M[PL[1]].[CF]~SEVEN7;                        %MC40078032
                        M[SU[X]].[DA]~M[PL[1]].[DA];                 %MC40078033
                        END                                          %MC40078034
                             ELSE                                    %MC40078035
                        BEGIN                                        %MC40078036
                  M[PL[0]+1].[CF]:=LOWLINK;                             40078038
                        IF LOWLINK=SEVEN7 THEN                       %MC40078040
                           FIRSTLINK~HIGHLINK                        %MC40078042
                                ELSE                                 %MC40078046
                     M[PL[1]].[CF]:=HIGHLINK;                           40078048
                        END;                                         %MC40078050
                     IF M[LASTAVAIL]=0 THEN                          %MC40078052
                              M[LASTAVAIL]~AD;LASTAVAIL~AD;          %MC40078054
                     IF AVAILABLE=0 THEN AVAILABLE~AD;               %MC40078058
               PL[0]:=0;                                                40078060
                  END;                                               %MC40078065
        END;                                                         %MC40078067
IF REM LSS 0 THEN BEGIN RADD~X MOD 5;RADD~(RADD+(RADD=0))|FORTY;        40078068
    RLEN~ABS(REM); END;                                                 40078069
           X~X-(RLEN!0);                                             %MC40078070
          END ELSE                                                      40078072
          IF(NT1:=M[SU[X]].[DA]) GTR RADD-RLEN THEN                     40078074
              BEGIN RLEN:=RLEN-(RADD-(RADD:=NT1));                      40078076
              SUPER:=1; GO BACK;                                        40078078
           END                                                       %MC40078080
           ELSE                                                         40078085
              RLEN~0;                                                %MC40078087
        END;                                                         %MC40078090
    IF RLEN>0 AND NOT ERROR THEN GO BACK;                            %MC40078091
SUPER:=SUPER OR (ERROR AND SU[X].DISKRUNNING);                          40078092
END OF COMPLEMENTING DISK DIRECTORY;                                    40078093
SUBROUTINE LOCKED;                                                      40100000
BEGIN                                                                   40100100
IF (X1:=(RADD-RLEN) DIV TN)=(X2:=RADD DIV TN) THEN                      40100200
IF(TWO(X1) AND EUM)=0 THEN BUILDAVAIL ELSE GO FORGET ELSE               40100300
BEGIN                                                                   40100400
    Y1:=RADD;Y2:=RLEN;                                                  40100500
    IF(RLEN:=(X1+1)|TN-(RADD-Y2  )  )GTR 0 AND (TWO(X1) AND EUM)=0 THEN 40100600
         BEGIN RADD:=(X1+1)|TN;X:=5|D+((Y1-Y2)DIV FORTY);BUILDAVAIL END;40100700
    IF (RLEN:=  Y1-(X2|TN)) GTR 0 AND (TWO(X2) AND EUM) EQL 0 THEN      40100800
         BEGIN RADD:=Y1;X:=5|D+RADD DIV FORTY;BUILDAVAIL; END;          40100900
    WHILE (X2:=X2-1) GTR X1 DO                                          40101100
         BEGIN                                                          40101200
         RLEN:=TN;X:=5|D+((RADD:=(X2+1)|TN)-1)DIV FORTY;                40101250
         IF (TWO(X2) AND EUM)=0 THEN BUILDAVAIL;                        40101300
         END;                                                           40101400
END;                                                                    40101500
FORGET:                                                                 40101510
END OF LOCKED;                                                          40101600
              IF USEDRA AND P(RRR).[31:1] THEN                          40246000
                DRUMTABLE[2] := DRUMTABLE[1] := -1;                     40246500
              IF USEDRB AND P(RRR).[30:1] THEN                          40247000
                DRUMTABLE[4] := DRUMTABLE[3] := -1;                     40247500
              DRUMCTR := ABS(DRUMTABLE[1]+DRUMTABLE[3])+P(DUP);         40248000
SU~[M[RT1~GETSPACE(100,0,0)+2]]&100[8:38:10];                        %MC40249100
SEVEN7:=@77777;FORTY:=40000;TN:=10000;MN:=1000000;TM:=10000000;         40249105
MOVE(100,RT1-1,RT1);                                                    40249110
SOCK:=[M[RT1:=SPACE(40)]]&40[8:38:10];                                  40249120
MOVE(40,RT1-1,RT1);                                                     40249130
X1~NEUP.[CF]-1;                                                         40249200
LOOKATDKB:                                                           %MC40249300
FOR J:=0 STEP 1 UNTIL X1 DO                                             40250000
BEGIN                                                                   40251000
X2:=19;                                                                 40252000
FOR I:=0STEP 1 UNTIL X2 DO                                              40253000
BEGIN                                                                   40254000
    RADD:=MN|J+I|TN;                                                    40254100
    STREAM(Q:=RADD,B:=40+A);                                            40255000
    BEGIN SI:=LOC Q;DS:=8 DEC END;                                      40256000
    IF I EQL 0 THEN X2:=20|WAITIO(40+A INX @140000000,@64,18+C).[43:1]  40257000
     +X2;                                                               40257100
    IF NOT(R~WAITIO(40+A INX @100000000,@64,18+C)).[42:1] THEN          40258000
    BEGIN                                                               40261000
    NT2:=(NT1:=5|J+50|C)+(I DIV(SU[NT1].FORTYMILLDISK+1)DIV 4);         40261010
    SU[NT2]:=P(DUP,LOD)&1[18:47:1]&(X2>19)[19:47:1];                    40261040
    IF R.[43:1] THEN                                                    40261042
    BEGIN FORTY:=FORTY|((X2 GTR 19)+1);                                 40261043
    SOCK[(NT4:=J+C|10)+20]:=P(DUP,LOD) OR TWO(IF X2=19 THEN I ELSE      40261044
         (I DIV 8)|4+(I AND 3));SOCK[NT4]:=P(DUP,LOD) OR TWO(I);        40261045
    X:=NT2;RADD:=(RADD MOD MN)+(RLEN:=TN);BUILDAVAIL;                   40261046
    EUMASK:=EUMASK OR TWO(10|C+J);FORTY:=40000;                         40261047
    END;                                                                40261048
      END ELSE I:=I+((SU[NT1:=(5|J+50|C)].FORTYMILLDISK+1)|4);          40261050
END;                                                                    40261200
END;                                                                    40262000
 IF NOT C AND (X1:=NEUP.[FF]-NEUP.[CF]-1) GEQ 0 THEN                    40262300
BEGIN C:=1;GO LOOKATDKB; END;                                           40262310
              J~DIRMOD;                                                 40262500
              V := [M[SPACE(J)]]&J[8:38:10];                            40263000
              J ~ J-1;                                                  40264000
              H~I~T~-1;                                                 40264100
              FOR S ~ 0 STEP 1 UNTIL J DO                               40264500
                   BEGIN IF T=I THEN                                    40265000
         LTR:           BEGIN IF (H~H+1){CHUNKMAX THEN                  40265100
                             BEGIN IF TOTAL[H]!0 THEN GO TO LTR;        40265200
                                  I~CHUNKZIZE|H+FENCE;                  40265300
                             END ELSE I := SPACE(CHUNKZIZE);            40265400
                             T~I+CHUNKZIZE;                             40265500
                        END;                                            40265600
                        VR[S]~[M[I]]&62[8:38:10];                       40265700
                        I~I+64;                                         40265800
                       BYPASS~BYPASS-2;                                 40266000
                        CLEAR;                                          40267000
                   END;                                                 40268000
              ZSF~IOQUE&SPACE(31)[CTC];                                 40275500
              ZSF[0]~@14;                                               40275600
              W~0;                                                      40275700
              FOR J ~ DIRECTORYTOP+4 STEP 16 WHILE J ! 16 DO%           40276000
              BEGIN                                                     40277000
                        DISKWAIT(-A,480,J);                             40278000
                        IF J+15}BYPASS.[CF] THEN DIRECTORYFULL(1);      40278100
                        BYPASS.[FF]~J+15;                               40278200
                        FOR I ~ 0 STEP 1 UNTIL 14 DO%                   40279000
                             BEGIN T ~ DDD[478-2|I];%                   40280000
                                  H:=J+14-I;                            40280100
                                  IF T=@114 THEN                        40281000
                                       BEGIN DDD[479-2|I]:=0;           40281100
                                            UCHANG:=0;              %R6140281110
                                            I:=15;                      40281200
                                       END ELSE                         40281300
                                  IF T=@14 OR                           40282000
                                     DDD[424-I|30].[1:1] THEN           40283100
                                       BEGIN                            40283200
                                            UCHANG:=0;              %R6140283210
                                            DDD[478-2|I]~@14;           40283230
                                            DDD[479-2|I]:=NEXTSLOT;     40283300
                                            IF NEXTSLOT=0 THEN          40283400
                                            BEGIN FI:=I;FJ:=J+15 END;   40283500
                                            NEXTSLOT:=H;                40283600
                                       END ELSE                         40284000
                                       BEGIN DDD[429-I|30].[1:42]:=0;   40285000
                                            B:=DDD[429-I|30];           40285005
                                            IF (C~DDD[423-I|30])}0 THEN 40285010
                                            BEGIN DDD[423-I|30]~        40285020
                                                 -C&C[2:8:10];          40285030
                                                 UCHANG:=0;         %R6140285035
                                                        DDD[424-I|30]~0;40285135
                                            END                         40285140
                                                 ELSE                   40285150
                                            DDD[424-I|30]~P(DUP,LOD)    40285160
                                             AND @0007000000007700;     40285170
                                            IF C.[2:10]=0 THEN SAVIT;   40285500
                   FOR C:=1 STEP 1 UNTIL 20 DO                          40286000
                   BEGIN RADD:=DDD[429-I|30+C];                         40287000
                   IF RADD GEQ DISKBOTTOM+5 THEN                        40290000
                   BEGIN                                                40290100
                   IF (RADD:=RADD+(RLEN:=DDD[428-I|30])) GTR TM THEN    40290200
                   BEGIN RADD:=RADD MOD TM;X:=50 END ELSE X:=0;         40290300
                   IF SU[X:=X+5|(D:=RADD DIV MN)].FORTYMILLDISK THEN    40290400
                   FORTY:=P(FORTY,DUP,+);                               40290500
                   X:=((RADD:=RADD MOD MN)-1) DIV FORTY + X;            40290600
                   IF (EUM:=SOCK[D]) NEQ 0 THEN LOCKED ELSE BUILDAVAIL; 40292050
                   FORTY:=40000;                                        40292060
IF SUPER THEN                                                           40292200
    BEGIN                                                            %MC40292210
    LBMESS(-T,DDD[479-2|I],"DISK ","ADDRESS"," ERROR",0,0);          %MC40292220
    ERROR:=SUPER:=0;                                                    40292230
    END;                                                             %MC40292240
                   END;                                                 40292250
                                                 END;                %MC40292300
                                            B:=DDD[479-2|I];            40293010
                                            S:=(S:=DISKBOTTOM       %10440293020
                                             -SCRAMBLE(T,B)).       %10440293030
                                             [36:11];               %10440293040
                                            C:=V[S,0];                  40293050
                                            V[S,C+2]:=T; V[S,C+3]:=B;   40293060
                                            V[S,C+4]:=H;                40293070
                                            IF (V[S,0]:=C+3)=60 THEN    40293080
                                            BEGIN V[S,4].[FF]~BYPASS~   40293090
                                                 BYPASS-2;              40293100
                                                 IF J+15}BYPASS.[CF]THEN40293101
                                                 DIRECTORYFULL(1);      40293102
                                                 DISKWAIT([V[S,2]].[CF],40293110
                                                  60,V[S,1]);           40293120
                                                 CLEAR;                 40293140
                                            END;                        40293150
                                            PBCOUNT~PBCOUNT+((((DDD[478 40309100
                                            -2|I]EQV"PBD    ")=NOT 0)   40309150
                                            OR((DDD[478-2|I]EQV"PUD    "40309200
                                            )=NOT 0))AND(DDD[479-2|I].  40309250
                                            [CF]=1));                   40309300
                   IF T="PRNPBT" AND DDD[479-I-I]="DISK   " THEN L~0;%MC40309400
                             END;      END;%                            40310000
                        DISKWAIT( A,480,J);                             40311000
                        IF I = 16 THEN%                                 40312000
                             BEGIN%                                     40313000
                                  J ~ 0;%                               40314000
                             END;%                                      40315000
                   END;%                                                40317000
              IF L THEN AUTOPRINT~0;                                    40317100
              FOR I:= 0 STEP 1 UNTIL DIRMOD-1 DO                        40317200
                   DISKWAIT([V[I,1]] INX 1, 60, V[I,1]);                40317210
              FOR I~0 STEP CHUNKZIZE DIV 64 UNTIL DIRMOD-1 DO           40317220
              BEGIN V[I,0]~0;                                           40317230
                   T~[V[I,0]].[CF];                                     40317240
                   MOVE(CHUNKZIZE-1,T,T+1);                             40317250
                   IF T<FENCE THEN FORGETSPACE(T);                      40317260
              END;                                                      40317270
              B:=V.[CF];                                                40317300
              IF NEXTSLOT!0 THEN                                        40317310
              BEGIN                                                     40317320
              DISKWAIT(-B,30,FJ);                                       40317400
              VR[-2|FI+29]:=H;                                          40317500
              DISKWAIT(B,30,FJ);                                        40317600
              END ELSE NEXTSLOT:=H;                                     40317610
              FORGETSPACE(B);                                           40317700
              IF PBCOUNT=0 OR AUTOPRINT THEN ELSE                       40320100
              BEGIN;STREAM(PBCOUNT,X:=X:=SPACE(10));                    40320200
                   BEGIN DS~11 LIT" THERE ARE"; X~DI; SI~LOC PBCOUNT;   40320300
                        DS~4 DEC; DS~18 LIT" PB FILES ON DISK~";        40320400
                        DI~X; DS~3 FILL;                                40320500
              END;L:=X;                                                 40320600
              END;                                                      40320700
Z~USERDISKBOTTOM;                                                    %MC40321000
X:=-5;R:=NEUP.NEUF+2+(NEUP.NEUF+1) DIV 2;  DDD[1]:=0;                   40321100
VR:=[M[GETSPACE(R,0,0)+2]]&R[8:38:10];                                  40321110
MOVE(R,VR.[CF]-1,VR) ;                                                  40321115
VR[NEUP.NEUF+1]:=0 ;                                                    40321120
$INCLUDE 40321126, IF SHAREDISK ;                                       40321124
VR[0]:=0&R[TONUMENT] ;                                                  40321125
$OMIT 40321131, IF SHAREDISK ;                                          40321129
VR[0]:=R:=0 ;                                                           40321130
RADD:=R;  R:=R-1 ;                                                      40321135
WHILE (X~X+5)<100 DO                                                 %MC40321200
    BEGIN I~RA~-1;RLEN~RL~0;RADD~RADD+(Z-USERDISKBOTTOM)|30;            40321300
   FORTY:=(SU[X].FORTYMILLDISK+1)|FORTY ;                               40321310
  WHILE (C:=SU[X+(I:=I+1)]).DISKRUNNING AND I LEQ 4 DO                  40321400
IF NOT C.OCCUPIED THEN                                                  40321500
    BEGIN                                                            %MC40321600
        IF C.[CF]=0 THEN                                             %MC40321700
          BEGIN                                                      %MC40321800
           RA~RA+1;                                                  %MC40321810
           C:=0;                                                        40321910
              S:=(I+1)|FORTY;                                           40322000
           J~IF X+I=0 THEN                                           %MC40322100
              FORTY-(DISKBOTTOM+5) ELSE FORTY;                          40322150
           END                                                       %MC40322200
              ELSE                                                   %MC40322210
           BEGIN AD~M[M[SU[X+I]]].[CF];RA~-1;    END;                %MC40322220
        DO                                                           %MC40322250
           BEGIN                                                     %MC40322300
              IF C!0 THEN BEGIN S~M[AD].[DA];J~M[1+AD].[DA] END;     %MC40322400
              S:=S+(X MOD 50)DIV 5|MN;                                  40322410
              IF J>RLEN THEN RLEN:=J;                                   40322420
              IF X GEQ 50 THEN S:=S+TM;                                 40322425
              IF J GTR 0 AND (NT1:=S-J) GEQ DISKBOTTOM+3 THEN           40322430
              IF (Y:=DDD[ABS(R)]).DEND EQL NT1 THEN                     40322440
              BEGIN DDD[R]:=S&(LO:=Y.DSIZE+J)[TODSIZE];                 40322442
             IF LO GTR RLEN THEN RLEN:=LO END                           40322444
                 ELSE                                                %MC40322450
               BEGIN                                                 %MC40322460
                  IF R=AV1 THEN                                      %MC40322470
                    BEGIN                                            %MC40322480
                       DISKWAIT(A,AV1,Z);Z~Z + AVBLOCK;R~ -1;        %MC40322600
                    END;                                             %MC40322700
            DDD[R~R+1]~ S& J[TODSIZE];RL~RL+1;                          40322800
               END;                                                  %MC40323000
             IF C!0 THEN                                             %MC40323100
              IF M[AD].[CF]!SEVEN7 THEN                              %MC40323200
                  AD~M[AD].[CF] ELSE                                 %MC40323300
                  BEGIN                                              %MC40323400
                  K~-1;                                              %MC40323500
                   WHILE (B~(M[SU[X+I]INX(K~K+1)]))!0 AND K{15 DO    %MC40323600
                     FORGETSPACE(B);FORGETSPACE(SU[X+I]);            %MC40323700
                   C~0;                                              %MC40323710
                  END;                                               %MC40323800
           END UNTIL C=0;                                            %MC40323900
  END;                                                                  40324000
IF (DDD[R].DEND MOD MN)=((NT1:=5|FORTY)-1) THEN DDD[R].DEND:=NT1+       40324102
X DIV 5|MN ;                                                            40324104
IF((NT1~X/5){NEUP.[CF]-1)OR (NT1}10 AND(NT2~NEUP.[FF]-NEUP.[CF])!0 AND  40324110
    NT1-10{NT2) THEN                                                    40324112
BEGIN RL:=RL+1;                                                         40324120
 IF NT1 GEQ 10 THEN NT1:=NEUP.[CF]+NT1-10;                              40324190
 VR[NT1+1]:=0&(SU[X].FORTYMILLDISK+1)[TOSPEED]&RL[TONUMENT]&            40324200
 RADD[TOSTARTWRD]&RLEN[TOMAXSIZ];                                       40324210
  IF R=AV1 THEN                                                         40324300
    BEGIN                                                               40324400
      DISKWAIT(A,AV1,Z);                                                40324500
      Z~Z+AVBLOCK;R~-1;                                                 40325000
    END;                                                                40326000
  DDD[R:=R+1]:=400000 DIV(2-SU[X].FORTYMILLDISK)+(X MOD 50)DIV 5|MN+1;  40327000
  IF (LO:=RL DIV 4) LSS AVDIFFMIN THEN LO:=AVDIFFMIN ELSE               40328000
  IF LO>AVDIFFMAX THEN LO~AVDIFFMAX;                                    40329000
    IF (R:=R+LO) GTR AV1 THEN                                           40330000
     BEGIN                                                              40331000
      DISKWAIT(A,AV1,Z);Z~Z+AVBLOCK;                                    40332000
         R:=R-AV1 ;                                                     40333000
     END;                                                               40334000
END;                                                                    40334050
FORTY:=40000 ;                                                          40334054
RADD:=R+1 ;                                                             40334055
END;                                                                    40334056
DISKWAIT(A,AV1,Z);                                                      40334057
NT2:=NEUP.NEUF+2 ;                                                      40334060
FOR NT1:=NEUP.[CF]-1 STEP -1 UNTIL 0 DO                                 40334065
    IF NT1 THEN VR[NT2+NT1 DIV 2].[8:20]:=SOCK[NT1+20]                  40334070
    ELSE VR[NT2+NT1 DIV 2].[28:20]:=SOCK[NT1+20];                       40334075
IF (NT1:=NT2-3) - (X2:=NEUP.[CF]) GEQ 0 THEN                            40334077
FOR NT1:=NT1 STEP -1 UNTIL X2 DO                                        40334079
    IF NT1 THEN VR[NT2+NT1 DIV 2].[8:20]:=SOCK[NT1-X2+30]               40334081
    ELSE VR[NT2+NT1 DIV 2].[28:20]:=SOCK[NT1-X2+30];                    40334083
VR[0]:=P(DUP,LOD)&EUMASK[TOMAXSIZ];                                     40334085
$INCLUDE 40334339, IF SHAREDISK ;                                       40334308
DISKWAIT(-A,60,USERDISKBOTTOM);                                         40334310
DISKWAIT(EUIO.[CF],EUIO.[8:10],EUIOHOLDER) ;                            40334315
MOVE(VR[0] AND NUMENTM,[VR[0]],A) ;                                     40334320
DISKWAIT(A,60,USERDISKBOTTOM);                                          40334330
AVS:=(AVS:=IF(AVS:=(Z-USERDISKBOTTOM)|30+R+AVDIFFMIN)>AVSMAX THEN AVSMAX40334335
   ELSE IF AVS LSS AVSMIN THEN AVSMIN ELSE AVS)+30-(IF (AVS:=AVS MOD 30)40334337
   !0 THEN AVS ELSE 30) ;                                               40334338
$OMIT 40334351, IF SHAREDISK ;                                          40334340
AVTABLE:=[M[GETSPACE(R:=VR.[8:10],0,1)+2]]&R[8:38:10] ;                 40334345
MOVE(R,VR,AVTABLE) ;                                                    40334350
FORGETSPACE(VR);                                                        40334500
FORGETSPACE(SU);                                                        40334600
              UNLOCKDIRECTORY;                                          40336000
              USERDISKREADY:=1;                                         40336100
              MCP~"SITE   ";                                            40336200
              CREATELOG;                                                40337000
         IF L>1 THEN SPOUT(L);                                          40338000
              FOR W~W STEP -2 WHILE ZSF[W]!@14 DO                       40353100
              BEGIN                                                     40353110
                   IF W<0 THEN                                          40353120
                   BEGIN                                                40353130
                        DISKWAIT(-ZSF.[CF],30,ESPADD);                  40353140
                        FORGETESPDISK(ESPADD);                          40353160
                        ESPADD~ZSF[29];                                 40353170
                        W~26;                                           40353180
                   END;                                                 40353190
                   FORGETSPACE(DIRECTORYSEARCH(ZSF[W],ZSF[W+1],6));     40353200
              END;                                                      40353210
                                                                     %MC40353300
    ZSF[0]~@3600036000101;                                           %MC40354100
    FOR I~1 STEP 1 UNTIL 29 DO ZSF[I]~0;                             %MC40354200
    ZSF[7]~ZSF[8]~6;                                                 %MC40354300
    ZSF[3]~-0;                                                       %MC40354400
    ZSF[4]~@2006740000000000;                                        %MC40354500
ZSF[9]~1;                                                            %MC40354600
    Y~ZSF[10]~GETUSERDISK(6);                                        %MC40354700
              STREAM(DDD);                                              40355000
              BEGIN DS~8 LIT"00000000"; SI~DDD;                         40355100
                   3(DS~ 60 WDS);                                       40355300
              END;                                                      40355400
              DDD[0]~DDD[1]~DDD[7]~2;                                   40355500
              DDD[2]~3;                                                 40355600
              DDD[3]~22;                                                40355700
              DDD[4]~4;                                                 40355800
              DDD[5]~6;                                                 40355900
              DDD[17]~DDD[16]~@377777777777;                            40355910
              DDD[6]~-1;                                                40355920
              DDD[18]~SHEETMAX DIV 2;       % PRIORITY                  40355925
              DDD[20]:=80;     %   C0RE ESTIMATE                    %R8840355930
              DDD[21]~150;          %      STACK SIZE                   40355940
              DDD[30]~@12602141011;                                     40356100
              DDD[31]~@24101100000000;                                  40356200
              DDD[61]~@220000200001;                                    40356300
              DDD[108]~FLAG(@2740010000100000);                         40356400
    ENTERUSERFILE("LIBMAIN","DISK   ",ZSF INX 0-1);                  %MC40356500
              FORGETSPACE(ZSF); FORGETSPACE(SOCK);                      40356550
              DISKWAIT(DDD.[CF],180,Y);                                 40356600
         END;                                                           40400000
PROCEDURE REALFILECLOSE(ALPHA); VALUE ALPHA; INTEGER ALPHA;%        %R9041000000
BEGIN ARRAY FIB[*],FPB[*],HEADER[*];%                                   41001000
%%%      DONT ADD ANY DECLARATIONS BETWEEN "HEADER" AND "KIND" %%% WCP  41001500
         INTEGER KIND,NBUFS,U,BLEN,CODE,UNLABELED,COBOL,I,J,FNUM;       41002000
         REAL MID,FID,R,D,C,FORMS,STATE;                                41003000
      REAL RCW=+0,XTRA=-3;                                          %R9041003100
      LABEL PX,PBD;                                                  %P 41004000
      LABEL CR,LP,MT,CLOSED,DK,SP,CP,BKUP,PP,PR,DC,CD,CC;               41005000
      SWITCH SW~CR,LP,MT,CLOSED,DK,SP,CP,BKUP,PP,PR,DC,CD,BKUP;      %PB41006000
      LABEL EOF,ON,DNE,CLEANUP;%                                        41007000
      LABEL EOD;                                                        41007100
      LABEL OBJTYPE, DUMMY;                                         %R6241007150
      REAL T1,T2,T3,IOD; ARRAY SEG0[*],SKEL[*]; LABEL L1,L2,L3;         41007200
 $ VOID 41017                                                       %R9041008000
      REAL T,ACCESS;%                                                   41017000
      BOOLEAN COMPGO;                                                   41017200
      REAL TYPE;                                                        41017300
      DEFINE REW=CODE.[47:1]#,%                                         41018000
             KRUNCH=NOT CODE.[42:1]#,                               %R1741018100
             REL=CODE.[46:1]#,%                                         41019000
             TIME=CODE.[45:1]#,%                                        41020000
             LOCK=NOT CODE.[44:1]#,%                                    41021000
             PURGE=NOT CODE.[43:1]#;%                                   41022000
%                                                                       41023000
 $ VOID 41035                                                       %R9041024000
      LABEL CLOSEOUT;%                                                  41035000
      LABEL EOFIT;%                                                     41036000
      CODE~(NOT *P(.ALPHA)).[18:15];%                                   41038000
      ALPHA~P(.ALPHA,LOD).[33:15];%                                     41039000
      FIB~M[ALPHA-3]; FPB~PRT[P1MIX,3];%                                41040000
      IF (STATE~FIB[5]).[42:1] THEN GO TO CLOSED;%                      41041000
      NBUFS~FIB[13].[1:9]; FNUM~FIB[4].[13:11];%                        41042000
      U~FIB[15].[24:6];                                                 41043000
      UNLABELED~FIB[4].[2:1];%                                          41044000
      BLEN~FIB[18].[3:15];%                                             41045000
      STREAM(S~[FPB[FNUM]],D~[MID]);%                                   41046000
            BEGIN SI~S; DS~2 WDS; DS~3 OCT; DS~5 OCT; DS~2 OCT END;%    41047000
      FORMS~FPB[FNUM+3].[42:1];%                                        41048000
      I~FIB[13].[28:10];%                                               41049000
      IF I!0 OR R!0 THEN R~I;                                           41050000
      COBOL~(FIB[13] AND 1)&([FIB].[8:10]=22)[1:47:1];  % COBOL 60 & 68 41051000
      GO TO SW[KIND~FIB[4].[8:4]];%                                     41052000
%                                                                       41053000
CR:CC:CP:LP:SP:MT:PP:PR:CD:                                         %R9041054000
      OTHERCLOSE(0);                                                %R9041055000
 $ VOID 41142                                                       %R9041056000
      GO TO CLEANUP;%                                                   41142000
%                                                                       41143000
BKUP: TYPE:=FPB[FNUM+3].[43:5]; BACKCLOSE(0);                           41144000
 $ VOID 41186                                                       %R9041144100
DC::                                                                    41186000
CLOSEOUT::  STATE.[39:4]~1; TIME~1;%                                    41187000
CLEANUP::%                                                              41188000
      IF TIME THEN STOPTIMING(FNUM,1023);                           %R6241188100
      IF NOT STATE.[41:1] THEN%                                         41189000
      IF KIND{2 OR KIND=11 OR KIND}6 AND KIND{9 THEN                    41190000
      BEGIN                                                             41190500
      T ~ (CLOSEMESS AND ((T~JAR[P1MIX,0])>0 OR T<0 AND COPNMESS))      41191000
              OR CLOSEK;                                                41192000
      FILEMESS(P(T," REL"&TINU[U][6:30:18]),0,MID,FID,R,D,C);           41193000
      T := SPACE(10)-1;  MOVE(10,T,T+1);                                41193100
      MOVE(ETRLNG,[FPB[FNUM]],T+1);                                     41193200
      MAKELOG(T,FILESTATS);                                             41193300
      FORGETSPACE(T+1);                                                 41193400
      END;                                                              41193900
      IF (FIB[5]~STATE).[42:1] THEN FIB[4].[8:4]~3;%                    41194000
      IF (T~FIB[16].[33:15])!0 THEN%                                    41195000
      BEGIN T~T-1-(IF STATE.[44:1] AND (KIND=2) THEN BLEN ELSE 1);%     41196000
            FOR I~0 STEP 1 UNTIL NBUFS-1 DO%                            41197000
            BEGIN J~M[T].[18:15]-2;%                                    41198000
                  FORGETSPACE(T);%                                      41199000
                  T~J;%                                                 41200000
                  M[ALPHA+I]~P(DUP,LOD)&0[2:2:1]&1[25:47:1]%            41201000
                              &(ALPHA+1)[33:33:15];%                    41202000
            END;%                                                       41203000
            FIB[16]~0;%                                                 41204000
      END;%                                                             41205000
      IF NOT UNLABELED THEN%                                            41206000
      IF KIND!0 THEN%                                                   41207000
      IF (T~M[ALPHA-2].[33:15])!0 THEN%                                 41208000
            FORGETSPACE(T-2);%                                          41209000
      M[ALPHA-2]~P(DUP,LOD)&P(0,XCH)[8:8:10];%                          41210000
      FIB[6]~FIB[7]~0;%                                                 41211000
      GO TO CLOSED;%                                                    41213000
%                                                                       41214000
DK::  DISKCLOSE(0);                                                 %R9041215000
 $ VOID 41269                                                       %R9041216000
      GO CLEANUP;%                                                      41269000
 $ VOID 413                                                         %R9041271000
 CLOSED::                                                               41308000
      RCW:=XTRA;                                                    %R9041309000
END FILE CLOSE;                                                     %R9041310000
COMMENT ARTN RETURNS ALL STORAGE FOR AN N-DIMENSIONAL ARRAY A;%         42473000
PROCEDURE ARTN(A,N); VALUE A,N; ARRAY A[*]; INTEGER N;%                 42474000
              BEGIN INTEGER I;%                                         42475000
                   ARRAY     LOC   = +2[*];                             42475100
                   INTEGER   INDEX = NT1,                               42475200
                             WORD  = NT2,                               42475300
                             COUNT = NT3,                               42475400
                             DRUM  = NT4,                               42475500
                             X     = NT5;                               42475600
                   LABEL     L;                                         42475700
                    WAITSTORE(P1MIX);                                   42476000
                    IF A.[18:15]!0 THEN A~M[A.[18:15]];                 42476100
                    IF N>1 THEN DO ARTN(A[I],N-1) UNTIL (I~I+1)}A.SIZE; 42477000
                    X := N!(-1);  N := A INX 0;                         42478000
                    IF A.PBIT THEN                                      42478200
                              BEGIN I~M[N-1].[FF];                      42478400
                                   IF X THEN FORGETSPACE(N);            42478600
                              END ELSE I~N;                             42478800
                   IF I GTR 511 THEN                                    42479000
                   BEGIN COMMENT "DISKRTN" ROUTINE CALLED HERE...;      42479100
                        P(DALOC[P1MIX,*]);                              42479200
                        COUNT := TWO(24-6|(I.[39:9] DIV 100));          42479300
                        X := (INDEX := 0&I[41:33:6])-1;                 42479400
                        IF (WORD := LOC[INDEX].[18:30]-COUNT)=0 THEN    42479500
                        BEGIN LOC[INDEX] := 0;                          42479600
                             IF LOC[X]<0 THEN                           42479700
                             BEGIN DRUM := ABS(LOC[X] DIV 500);         42479800
                                  LOC[X] := DRUMTABLE[DRUM];            42479900
                                  DRUMTABLE[DRUM] := -1;                42480000
                                  DRUMCTR := *P(DUP)+1;                 42480100
                             END;                                       42480200
                   L::       IF P(LOC[0].[FF],DUP)!0 THEN               42480300
                               IF LOC[POLISH-1]<0 THEN P(XIT);          42480400
                             LOC[0] := (*P(DUP))&INDEX[CTF];            42480500
                        END ELSE BEGIN                                  42480600
                             LOC[INDEX] := (*P(DUP))&WORD[18:18:30];    42480700
                             IF (WORD DIV COUNT).[42:6]=0 THEN          42480800
                               IF LOC[X]<0 THEN GO TO L;                42480850
              END  END  END  ARTN;                                      42480900
COMMENT ASR IS THE ALGOL STORAGE RETURN COMMUNICATE;%                   42481000
PROCEDURE ASR; BEGIN INTEGER I,BCNTR; ARRAY AIT[*]; REAL TEMP;%         42482000
                  LABEL L;%                                             42483000
                    REAL MOTHER; ARRAY DESC[*];%                        42484000
                    WHILE (AIT~PRT[P1MIX,AITNDX]).PBIT=0 DO%            42485000
                          MAKEPRESENT([PRT[P1MIX,AITNDX]] INX 0);%      42486000
                   MEMORY[AIT INX NOT 1].[2:1]~1;%                      42487000
                   I:=AIT[0]+1;                                         42488000
                   IF (BCNTR:=PRT[P1MIX,CURBLKCNTR]) LEQ 0 THEN         42488100
                   BEGIN TERMINATE(P1MIX);                              42488200
                        TERMINALMESSAGE(78);                            42488300
                   END;                                                 42488400
              WHILE (TEMP~AIT[I~I-1]).BLKCNTR}BCNTR%                    42489000
                 DO BEGIN DESC~MEMORY[MOTHER~TEMP.MOM];%                42490000
                   IF TEMP.[1:2]!1 THEN % CHECK FOR FAULT ENTRY         42490100
                          IF TEMP.FILEBIT THEN%                         42491000
                          IF TEMP.[33:15]=2 THEN BEGIN%                 42492000
                          FILECLOSE((MOTHER+3)&((DESC[4].[25:2]=2)|@12) 42493000
                                                 [18:33:15]);           42494000
                                                                        42495000
                          GO TO L                END ELSE%              42496000
                          BEGIN FILECLOSE((DESC INX 5)&                 42497000
                                  ((M[DESC[2] INX 4].[25:2]=2)|@12)     42498000
                                                        [18:33:15]);    42499000
                                FORGETSPACE(DESC INX 0);%               42500000
                          END ELSE ARTN(DESC,TEMP.DIMENSIONS);%         42501000
                          MEMORY[MOTHER]~0;%                            42502000
              L:                                                        42503000
                    END;%                                               42504000
                    AIT[0]~I;%                                          42505000
                    PRT[P1MIX,CURBLKCNTR]~BCNTR-1;%                     42506000
                    IF I>0 THEN DO%%WIPE OUT BAD LABELS IN FAULT CELLS  42506100
                        IF AIT[I].[1:2]=1 THEN                          42506200
                        IF M[AIT[I].MOM].BLKCNTR}BCNTR THEN             42506300
                        M[AIT[I].MOM]~0 UNTIL (I~I-1){0;                42506400
                   MEMORY[AIT INX NOT 1].[2:1]~0;%                      42507000
              END ASR;%                                                 42508000
SAVE REAL PROCEDURE COREND; FORWARD;                                    42509000
PROCEDURE INTERRUPT(TYPE); VALUE TYPE; REAL TYPE;                       42510000
BEGIN LABEL FLAGBIT,INVALIDINDEX,EXPUNDERFLOW,DIVIDEBYZERO;             42511000
      SWITCH SW~FLAGBIT,INVALIDINDEX,EXPUNDERFLOW,DIVIDEBYZERO;         42512000
      ARRAY T0P=-5[*];                                                  42513000
      REAL MOM,SIZE,ALOC,I;                                             42514000
      REAL RCW=+1,RCWL=+2,SAVIT=+4; NAME A=+3;                          42515000
      REAL R=+1,S=+2,Y=+3;                                              42516000
%                                                                       42517000
      CHECKSTACKSPACE;%                                             %WF 42517100
      GO TO SW[TYPE];                                                   42518000
%                                                                       42519000
FLAGBIT:                                                                42520000
      SAVIT~T0P;                                                        42521000
      NT1~ANALYSIS;                                                     42522000
      IF SYLLABLE.[41:7]!@35 THEN                                       42523000
      IF SYLLABLE.[45:3]!0 THEN                                         42524000
      BEGIN ERRORFIXER(16); TERMINATE(P1MIX); TERMINALMESSAGE(5) END;   42524100
      A~PRT[P1MIX,4];                                                   42524200
      RCW ~ M[RCWL ~ PRT[P1MIX,8] INX NOT ((SYLLABLE=@235)+2)];%        42525000
      IF RCW.[33:1] THEN % TYPE 13 INTRNSC                              42525100
      BEGIN                                                             42525110
      Y~[I].[CF];                                                       42525120
      I  ~FLAG((@2520000000000000)&(RCW.[34:14])[CTC]);                 42525130
      MAKEPRESENT(Y.[CF]);                                              42525140
      M[RCWL]~FLAG(RCW&(M[RCW.[FF]]INX (NFLAG( I )).[CF])[CTC]);        42525150
      GO TO INITIATE;                                                   42525160
      END ELSE                                                          42525170
      IF NOT PRT[P1MIX,A[RCW].[8:10]].[2:1] THEN%                       42525500
      MAKEPRESENT(PRTROW[P1MIX] INX A[RCW].[8:10]);%                    42526000
      M[RCWL]~FLAG(RCW&(M[RCW.[18:15]] INX A[RCW].[18:15])[33:33:15]);  42527000
      GO TO INITIATE;                                                   42528000
%                                                                       42529000
INVALIDINDEX:                                                           42530000
      FOR I~6 STEP 5 UNTIL 11 DO                                        42531000
      IF T0P.[18:15]=(MOM~[PRT[P1MIX,I]].[33:15]) THEN                  42532000
      IF (SIZE~M[MOM].[8:10])<1023 THEN                                 42533000
      BEGIN IF M[MOM].[2:1]=0 THEN MAKEPRESENT(MOM);                    42534000
            M[(ALOC~M[MOM].[33:15])-2].[2:1]~1;                         42535000
            IF M[ALOC-1].[FF]!0 THEN ARTN(M[MOM], -1);                  42535500
            M[MOM]~FLAG(0&MOM[18:33:15]                                 42536000
                   &(IF SIZE<512 THEN 2|SIZE ELSE 1023)[8:38:10]);      42537000
            MAKEPRESENT(ANALYSIS);                                      42538000
            MOVE(SIZE,ALOC,M[MOM]);                                     42539000
            FORGETSPACE(ALOC);                                          42539050
            GO TO INITIATE;                                             42539100
      END;                                                              42539200
      ERRORFIXER(4); TERMINATE(P1MIX); TERMINALMESSAGE(7);              42540000
%                                                                       42541000
EXPUNDERFLOW:                                                           42542000
      R~M[S~PRT[P1MIX,8].[33:15]];                                      42543000
      STREAM(R~R.[33:15]&R[30:10:2],Y~[Y]);                             42544000
            BEGIN SI~R; SI~SI-2; DI~DI+6; DS~2 CHR END;                 42545000
      IF Y.[45:3]=5 THEN M[S-3]~0;                                      42546000
      M[S-2]~0;                                                         42547000
      IF JAR[P1MIX,2].[3:1] AND(PRT[P1MIX,@51] AND @20)!0 THEN          42547100
         PRT[P1MIX,@51]~P(DUP,LOD) OR 6;                                42547200
      GO TO INITIATE;                                                   42548000
%                                                                       42549000
DIVIDEBYZERO:                                                           42550000
              IF (P(JAR[P1MIX,2],DUP)}0 AND NOT(P(XCH).[3:1] AND        42550500
                 (PRT[P1MIX,@51] AND 8)))!0 THEN                        42550600
         BEGIN ERRORFIXER(8); TERMINATE(P1MIX); TERMINALMESSAGE(13) END 42551000
         ELSE IF JAR[P1MIX,2] < 0 THEN IF PRT[P1MIX,11].[FF] = 0 THEN   42551090
              PRT[P1MIX,11]~1 ELSE PRT[P1MIX,PRT[P1MIX,11].[FF]]~1      42551100
         ELSE                                                           42551110
         BEGIN PRT[P1MIX,@51]~P(DUP,LOD) OR 1;                          42551200
               M[PRT[P1MIX,8].[CF]-2]:=0;                               42551300
               GO TO INITIATE;                                          42551400
         END;                                                           42551500
      GO TO INITIATE;                                                   42552000
%                                                                       42553000
END INTERRUPT;                                                          42554000
$INCLUDE 42740001, IF STATISTICS;                                       42599999
PROCEDURE FILLSYSTAT;                                                   42600000
BEGIN                                                                   42600100
     REAL RCW=+0,X1,X2,X3,X4;                                           42600200
     X2:=DIRECTORYSEARCH("SYSTEM "                                      42600300
$INCLUDE 42600311, IF SHAREDISK;                                        42600309
         &(SYSNO+17)[42:42:6]                                           42600310
         ,"STATS  ",4);                                                 42600320
     IF COUNTARRAY[28] NEQ DATE THEN                                    42600700
     BEGIN                                                              42600800
          DISKWAIT(-(X1:=SPACE(30)),-30,0);                             42600850
          COUNTARRAY[28]:=DATE;                                         42600900
          M[X1+5+SYSNO]:=0;                                             42600910
          DISKWAIT(X1,-30,0);                                           42600920
          FORGETSPACE(X1);                                              42600930
     END ELSE                                                           42601000
     BEGIN                                                              42601100
         DISKWAIT(-COUNTARRAY.[CF],60,SYSTATBASE);                      42601140
         COUNTARRAY[29]:=XCLOCK;                                        42601200
         X4:=(M[X2 INX 10]+(M[X2 INX 7]|2));                            42601300
         DISKWAIT(COUNTARRAY.[CF],61,X4);                               42601600
         M[X2 INX 7]:=*P(DUP)+1;                                        42601700
         COUNTARRAY[29]:=XCLOCK+INTERVAL;                               42601750
     END;                                                               42601800
     DISKWAIT(X2.[CF],30,X2.[FF]);                                      42601810
     IF M[X2 INX 7]=99 THEN FORK(P(.SAVESTATISTICS),0,0,128,0);         42601860
     FOR X3:=0 STEP 1 UNTIL 27 DO COUNTARRAY[X3]:=0;                    42601900
     FOR X3:=30 STEP 1 UNTIL 59 DO COUNTARRAY[X3]:=0;                   42602000
     COUNTARRAY[47]:=XCLOCK;                                            42602050
     FORGETSPACE(X2);                                                   42602100
     FORGETSPACE(DIRECTORYSEARCH("SYSTEM "                              42602110
$INCLUDE 42602121, IF SHAREDISK;                                        42602119
                 &(SYSNO+17)[42:42:6]                                   42602120
                 ,"STATS  ",14));                                       42602130
     KILL([RCW] INX NOT 2);                                             42602200
END OF FILLSYSTAT;                                                      42602300
PROCEDURE SAVESTATISTICS;                                               42700000
BEGIN                                                                   42701000
     REAL RCW=+0,X,X1,X2,X3;                                            42702000
     REAL NAMEIT;                                                       42703000
     LABEL XOUT;                                                        42704000
     X:=DIRECTORYSEARCH("SYSTEM "                                       42710000
$INCLUDE 42710101, IF SHAREDISK;                                        42710099
        &(SYSNO+17)[42:42:6]                                            42710100
        ,"STATS  ",4);                                                  42710200
     DISKWAIT(-(X2:=SPACE(30)),-30,0);                                  42713000
     STREAM(A:=[NAMEIT],B:=[DATE],C:=X2+5+SYSNO);                       42713100
     BEGIN                                                              42713200
          SI:=C; DI:=A; DI:=DI+1; DS:=2 DEC;                            42713300
          DS:=2LIT"ON"; SI:=B; SI:=SI+5; DS:=3 CHR;                     42713400
     END;                                                               42713500
     MOVE(30,X.[CF],(X3:=SPACE(30)).[CF]);                              42714000
     IF (M[X3+10]:=GETUSERDISK(-200 OR M))=0 THEN                       42714100
     BEGIN                                                              42716000
          STREAM(A:=[NAMEIT],B:=(SYSNO+17),C:=X1:=SPACE(5));            42717000
          BEGIN                                                         42718000
               SI:=A; DS:=17LIT"NO USER DISK FOR ";                     42719000
               SI:=SI+1; DS:=7 CHR; DS:=7 LIT"/SYSTEM";                 42720000
$INCLUDE 42720101, IF SHAREDISK;                                        42720099
               SI:=LOC B; SI:=SI+7; DS:= CHR;                           42720100
               DS:=LIT"~";                                              42720200
          END;                                                          42721000
          SPOUT(X1);                                                    42721500
          GO TO XOUT;                                                   42722000
     END;                                                               42723000
     SYSTATBASE:=M[X3+10];                                              42723100
     STREAM(A:=[DATE],B:=X INX 3,C:=0);                                 42724000
      BEGIN                                                             42725000
           SI:=A; DI:=LOC C; DS:=8 OCT;SI:=LOC C;SI:=SI+5;              42726000
           DI:=B; DI:=DI+5; DS:=3 CHR;                                  42727000
      END;                                                              42728000
     COUNTARRAY[29]:=XCLOCK;                                            42728050
     DISKWAIT(COUNTARRAY.[CF],61,(M[X INX 10]+(M[X INX 7]|2)));         42728100
     FOR X1:=0 STEP 1 UNTIL 59 DO COUNTARRAY[X1]:=0;                    42728200
     COUNTARRAY[28]:=DATE; COUNTARRAY[29]:=XCLOCK+INTERVAL;             42728300
     COUNTARRAY[47]:=XCLOCK;                                            42728400
     M[X INX 10]:=*P(DUP)+2;                                            42728600
     M[X INX 8]:=*P(DUP)-2;                                             42728700
     M[X2+5+SYSNO]:=*P(DUP)+1;                                          42729000
     M[X3+7]:=1;                                                        42730000
     DISKWAIT(X2,-30,0);                                                42731000
     DISKWAIT(X3,30,X.[FF]);                                            42731100
     ENTERUSERFILE(-NAMEIT,"SYSTEM "                                    42732000
$INCLUDE 42732101, IF SHAREDISK;                                        42732099
                          &(SYSNO+17)[42:42:6]                          42732100
                          ,X INX 0-1);                                  42732200
     STREAM(A:=[NAMEIT],B:=(SYSNO+17),C:=X1:=SPACE(6));                 42733100
     BEGIN                                                              42733150
          DS:=21LIT"NEW STATISTICS FILE: ";                             42733200
          SI:=A; SI:=SI+1; DS:=7 CHR; DS:=7 LIT"/SYSTEM";               42733300
$INCLUDE 42733351, IF SHAREDISK;                                        42733349
          SI:=LOC B; SI:=SI+7; DS:= CHR;                                42733350
          DS:= 9 LIT " CREATED~";                                       42733360
     END;                                                               42733400
     SPOUT(X1);                                                         42733500
     FORGETSPACE(DIRECTORYSEARCH(NAMEIT,"SYSTEM "                       42733510
$INCLUDE 42733521, IF SHAREDISK;                                        42733519
                 &(SYSNO+17)[42:42:6]                                   42733520
                 ,14));                                                 42733530
XOUT:                                                                   42733550
     FORGETSPACE(X);                                                    42733600
     FORGETSPACE(X2);                                                   42736000
     FORGETSPACE(X3);                                                   42737000
     FORGETSPACE(DIRECTORYSEARCH("SYSTEM "                              42739000
$INCLUDE 42739101, IF SHAREDISK;                                        42739099
                 &(SYSNO+17)[42:42:6]                                   42739100
               ,"STATS  ",14));                                         42739200
     KILL([RCW] INX NOT 2);                                             42739500
     END;                                                               42740000
 %  THE FORMAT OF DIRECTORY TOP%                                        44000000
 %       D[0]=OPTION WORD%                                              44001000
 %       D[1]=DATE%                                                     44002000
 %       D[2]=NUMBER OF ELECTRONIC UNITS%                               44003000
 %       D[3]=HIGHEST ADDRESS OF BACKUP STORAGE%                        44004000
 %       D[4]=HIGHEST ADDRESS OF DIRECTORY%                             44005000
 %       D[5]=LAST NUMBER USED FOR CONTROL DECK%                        44006000
 %       D[6]=FIRST CONTROL DECK QUEUED (LOCATION IN DIRECTORY)%        44007000
 %       D[7]=LAST CONTROL DECK QUEUED (LOCATION IN DIRECTORY)%         44008000
 %       D[8]=NEXT NUMBER AVAILABLE FOR PRINTER BACKUP DISK          %P 44008100
 %       D[9]=CORE, CONTAINS MULTIPROCESSING FACTOR                     44008200
 %       D[10] THRU D[15] SPECIFY WHICH DC-STATIONS ARE SPO-LIKE.       44008300
 %       D[16]=QUEUE VALUES FOR SPO STATIONS(BATCH MCP)                 44008310
 %       D[17] SPECIFIES SPO UNITS FOR BATCH MCP                        44008320
 %       D[18]=TIME OF DAY                                              44008330
 %       D[19]=LOCATION OF FENCE                                        44008340
 %       D[20].[8:10]=NUMBER OF LAST LOG FILE                           44008350
 %            .[18:30]=NUMBER OF ENTRIES IN LOG (UPDATED BY NSECOND)    44008360
 %       D[21]=SCHEDWRD                                                 44008370
%       D[28]=DISK ADDRESS OF DIRECTORYTOP                              44008999
 SAVE PROCEDURE INITIALIZE;%                                            44009000
 BEGIN REAL   I = +1,                                                   44010000
              A = I+1,                                                  44010010
              T = A+1,                                                  44010020
              B = T+1,                                                  44010030
              C = B+1,                                                  44010040
              J = C+1,                                                  44010050
              LASTL = J+1,                                              44010060
              LOC = LASTL+1,                                            44010070
              LDATE = LOC+1;                                            44010080
    ARRAY     DDD = LDATE+1[*],                                         44010090
              X = DDD+1[*];                                             44010100
    REAL      RA = X+1,                                                 44010110
              RL = RA+1,                                                44010120
              RT1 = RL+1,                                               44010130
              Y = RT1+1,                                                44010140
              Z = Y+1,                                                  44010150
              ESU = Z+1,                                                44010160
              BACKUP = ESU+1,                                           44010170
              MEMASK = BACKUP+1;                                        44010180
    DEFINE NUMSTACK=2#;                                                 44011000
         REAL INTS=MEMASK+1;                                            44014000
                                                                        44015000
                                                                        44016000
                                                                        44017000
                                                                        44018000
                                                                        44019000
    REAL  W=X;%                                                         44020000
                                                                        44021000
    REAL RADD=LASTL,RLEN=LOC;%                                          44022000
         INTEGER  XCLICK=XCLOCK;%                                       44023000
                                                                        44024000
    REAL MSTART=ESU,MEND=BACKUP;                                        44024100
 REAL T1 = ESU;%                                                        44025000
                                                                        44026000
    LABEL TRYNEXTMOD,RESTARTCYCLE;                                      44027000
 SUBROUTINE XXXXXX; BEGIN A~X-X-X-X-X-X-X-X-X-X-X-X-X-X-X; END;%        44037000
$INCLUDE 44037191, IF SHAREDISK ;                                       44037090
SUBROUTINE SETUPSCRATCHDIRECTORY ;                                      44037100
    BEGIN                                                               44037110
    DISKWAIT(-SCRATCHVEC INX 0,-4,J:=DIRECTORYTOP+1) ;                  44037120
    SCRATCHVEC[SYSNO]:=0&(I:=GETESPDISK)[TOSLINK] ;                     44037130
    DISKWAIT(SCRATCHVEC INX 0,-4,J) ;                                   44037140
    SCRATCHVEC[0]:=0&1[TOSNUM];  SCRATCHVEC[1]:=1&1[TOSLENGTH] ;        44037150
    DISKWAIT(SCRATCHVEC INX 0,2,I) ;                                    44037160
    SCRATCHVEC[0]:=0&J[TOSLINK]&1[TOSSIZE] ;                            44037170
    SCRATCHVEC[1]:=2&1[TOSNUM]&I[TOSLINK] ;                             44037180
    END OF SETUPSCRATCHDIRECTORY ;                                      44037190
         DEFINE SETUPINITIALBUFFERS =                                   44040000
              J:=220 + 20|(BIGUNMIN + LMAX DIV 2);                      44040500
              I:=(T:=GETSPACE(J+2,5,0)+1)+3 AND NOT 3;              %R0744041000
              MOVE(J+2,T,T+1); T:=I+J-1;                            %R0744042000
              FOR I~I STEP 20 UNTIL T DO FORGETAREA(2,I);               44043000
              AREARDY ~ TRUE#;                                          44044000
 SUBROUTINE FIXEX;                                                      44075000
         BEGIN MCPIN(I);                                                44076000
              M[(*I).[CF]-2].[1:8]~@100;                                44077000
         END;                                                           44078000
    SUBROUTINE FIX;%                                                    44079000
         BEGIN M[T]~[M[J]]&I[8:38:10];                                  44080000
              J ~ J+I;%                                                 44081000
         END;%                                                          44082000
    SUBROUTINE FIXFENCE;                                                44082100
         BEGIN I:=T DIV 4096;               % POINT IT TO AN ON-LINE MOD44082200
              WHILE (TWO(7-I) AND MEMASK)!0 AND I LSS 8 DO              44082300
    TRYNEXTMOD:    T:=(I:=I+1)|4096;                                    44082400
              IF T-4096|I ! 0 THEN                                      44082500
              IF (TWO(8-I) AND MEMASK)=0 THEN ELSE GO TRYNEXTMOD;       44082600
    %         THIS INSURES THERE IS ROOM FOR TABLES IMMEDIATELY BELOW   44082700
    %         THE FENCE. (KILL ASSUMES IT HAS A STACKQ STACK IF S>PRT.) 44082800
         END;                                                           44082900
PEUIO:=EUIO:=[M[@133]]&20[8:38:10] ;                                    44085100
EUSN:=0;%************************TEMPORARY******************************44085101
    HOLDER:=DIRECTORYTOP-6-(HOLDMAX+29) DIV 30;                         44086100
 RESTARTCYCLE:: COMMENT RETURN TO HERE TO CHANGE FENCE POSITION;        44087000
         POLISH(0, 0, 0, 0, 0, 0, 0, 0, 0, 0);                          44087010
         POLISH(0,0,0,0,0,0,0,0,0,0);                                   44087020
              RRRMECH ~ @140000000;%                                    44088000
              IOQUEAVAIL ~ 32;%                                         44089000
$OMIT 44090001, IF DCP;                                                 44089999
              LMAX:=STAMAX:=MAXLMAX;                                    44090000
              NOPROCESSTOG ~ -1;%                                       44092000
    STREAM(S~18,D~100);%                                                44093000
         BEGIN%                                                         44094000
              SI ~ S; DS ~ 11 WDS; D ~ DI;                              44095000
              DI ~ S; 11(DS ~ 8 LIT "102(0000" );                       44096000
              19(SI ~ SI+8);  S ~ SI;                                   44097000
              DI~D; DS~2 WDS;%                                          44098000
              DI~S; DS~16 LIT"042(0000"%                                44099000
         END;%                                                          44100000
    MSTART:=P(..INITIALIZE,LOD).[CF];                                   44101000
    HOLDER:=DIRECTORYTOP-6-(HOLDMAX+29) DIV 30;                         44101100
    USERDISKBOTTOM:=HOLDER-DISKAVAILTABLEMAX;                           44101200
    I:=(USERDISKBOTTOM-50) DIV SYSMAX;                                  44101300
    ESPDISKBOTTOM:=50+(SYSNO|I);                                        44101400
    ESPDISKTOP:=ESPDISKBOTTOM+I-7;                                      44101500
    FOR I:=0 STEP 1 UNTIL 7 DO                                          44102000
    BEGIN M[4096|I]:=1; DO UNTIL (T:=COREND)!16;                        44102500
         MEMASK:=2|MEMASK+T;                                            44103000
    END;                                                                44103500
    IF FENCE.[CF]!FENCE OR FENCE LSS 8192 THEN FENCE:=16384;            44104000
    T:=FENCE;                                                           44105000
    FIXFENCE;                                                           44105500
    FENCE:=T;                                                           44106000
    CHUNKMAX:=(@100000-FENCE) DIV CHUNKZIZE;                            44107000
    J:=(A:=FENCE:=@100000-CHUNKMAX|CHUNKZIZE) DIV 4096 -1;              44108000
    MEMROW[0]~[M[0]]&4[8:38:10];                                        44109000
    MOVE(MIXMAX,MEMROW,[MEMROW[1]]);                                    44109500
    WHILE (TWO(7-J) AND MEMASK)!0 DO                                    44110000
         BEGIN J~J-1; A~A-4096 END;                                     44110100
    M[M[AVAIL]~(MEND~A-3)+1]~MEND INX @7777700001;                      44110200
    M[MEND+2]~MEND+1;                                                   44111000
    M[MEND] ~ 0&1[2:47:1]                                               44112000
                     &MSTART[CTF];%                                     44113000
    M[0]~MSTART&MEND[CTF]&@100001[2:32:16];                             44114000
    M[MSTART]~LASTL~MEND;%                                              44115000
    M[LEFTLIT]~0;                                                       44116000
    J~J-1;                                                              44117000
    FOR I~1 STEP 1 UNTIL J DO                                           44118000
   IF (TWO(7-I)AND MEMASK)!0 THEN                                       44119000
    BEGIN C~4096|I;                                                     44120000
         M[MSTART].[CF]~B~C-1;                                          44121000
         DO BEGIN I~I+1; C~C+4096 END                                   44122000
         UNTIL (TWO(7-I) AND MEMASK)=0;                                 44123000
         M[B]~C&MSTART[CTF]&1[2:47:1];                                  44124000
         M[C]~MEND&B[CTF];                                              44125000
         M[MEND].[FF]~C;                                                44125500
         FORGETSPACE(MSTART+2);                                         44126000
         MSTART~C;                                                      44127000
    END;                                                                44128000
    FORGETSPACE(MSTART+2);                                              44141000
                                                                        44142000
$INCLUDE 44143101, IF DFX;                                          %DFX44142999
 DISKOUNT~P(RRR).[29:1]+P(RRR).[28:1];                              %DFX44143000
EUW~@7777777777;                                                    %DFX44143100
         STREAM(S~100,D~18);%                                           44144000
              BEGIN%                                                    44145000
              SI ~ S; DS ~ 11 WDS;                                      44146000
              19(DI ~ DI+8); DS ~ 2 WDS;                                44147000
              END;%                                                     44148000
              SPACESTACK~MEND-128;                                      44148500
              INTS:=GETSPACE(@10000-P(..INITIALIZE,LOD).[CF]-5,0,1)+2;  44149000
              WHILE FALSE DO;% FIX C RELATIVE CONSTANT ERRORS           44150000
              I ~ (MIXMAX+1)|5                                          44151000
                   +CHUNKMAX+UVSIZE+SHEETMAX+NUMSTACK|STANDARDSTACK     44151100
                   +32           %DISK WAIT TIME                        44151110
                   +476                                                 44151200
              +5                                                    %R5944151210
$INCLUDE 44151241, IF STATISTICS;                                       44151219
              +62  % COUNTARRAY                                         44151220
             +32 % DISK WAIT TIME                                       44151230
              +MIXMAX+1 %SWAP DELAY                                     44151240
                   +128       % INDIANSTACK                             44151300
$INCLUDE 44151371, IF DCP;                                              44151349
                   +80            % DCP HANDLER-S STACK                 44151350
                   + 8            % DCPARRAY                            44151360
                   +4|STAMAX+4    % STATABLE, TANKS, INPUTANK, TNAOG    44151370
$ INCLUDE 44151401, IF DEBUGGING;                                       44151399
                +31     %DBARRAY                                        44151400
$ INCLUDE 44151451, IF SAVERESULTS OR DEBUGGING;                        44151449
                   +RESLTMAX      % RESULTHOLDER                        44151450
                   +90            % WORKERSTACK                         44151500
$ INCLUDE 44151601, IF DEBUGGING;                                       44151599
                +91     %WB[10],RB[11],TBL[50],STOPS[20]                44151600
                +(W:=(ESPDISKTOP-ESPDISKBOTTOM+48) DIV 48) % ESPTAB     44151700
$ INCLUDE 44151811, IF SHAREDISK;                                       44151799
                + LQMAX                                                 44151800
                ;                                                       44151900
              J := SPACE(I)-1;                                          44152000
              M[J] ~ 0;%                                                44153000
              MOVE(I-30,J,J+1);                                         44154000
              I ~ MIXMAX+1;%                                            44155000
              T ~ P(.PRT); FIX;%                                        44156000
              T ~ P(.JAR); FIX;%                                        44157000
              T ~ P(.DAT); FIX;                                         44157100
              T ~ P(.UV); FIX;                                          44160000
              T ~ P(.REPLY); FIX;%                                      44162000
$INCLUDE 44162901, IF STATISTICS;                                       44162899
              T:=P(.SWAPDELAY); FIX;                                    44162900
              I ~ CHUNKMAX;                                             44163100
              T ~ P(.CT); FIX;                                          44163200
              I ~ 5; T ~ P(.CHANNEL); FIX;                              44164000
              T:=P(.CHANIO); FIX;                                   %R5944164040
              T := P(.DRUMTABLE);  FIX;                                 44164050
              I ~ 4; T ~ P(.CIDROW); FIX;                               44164100
$ INCLUDE 44164121, IF SAVERESULTS OR DEBUGGING;                        44164118
              I ~ RESLTMAX;                                             44164119
              T := P(.RESULTHOLDER); FIX;                               44164120
              I ~ 3; T~P(.SPACER); FIX;                                 44164200
$INCLUDE 44164441, IF DCP;                                              44164299
              I:=8; T:=P(.DCPARRAY); FIX;                               44164300
              I:=STAMAX+1;                                              44164400
              T:=P(.STATABLE); FIX;                                     44164410
              T:=P(.TNAOG); FIX;                                        44164420
              T:=P(.TANKS); FIX;                                        44164430
              T:=P(.INPUTANK); FIX;                                     44164440
$ INCLUDE 44165401, IF DEBUGGING;                                       44164999
              I ~ 31; T ~ P(.DBARRAY); FIX;                             44165000
              I ~ 10; T ~ P(.WB); FIX;                                  44165100
              I ~ 11; T ~ P(.RBX); FIX;                                 44165200
              I ~ 20; T ~ P(.STOPS);  FIX;                              44165300
              I ~ 50; T ~ P(.TBL);  FIX;                                44165400
              I ~ SHEETMAX+1; T~P(.SHEET); FIX;                         44165500
              J ~ J+1; I ~ 37; T ~ P(.LOGARRAY); FIX;                   44166000
$INCLUDE 44166101, IF STATISTICS;                                       44166099
              J:=J+1; I:=61; T:=P(.COUNTARRAY); FIX;                    44166100
              I ~ 16; T ~ P(.PRNTABLE); FIX;                            44167000
              I ~ 32;%                                                  44168000
              T ~ P(.SQ); FIX;                                          44168100
              T ~ P(.FINALQUE); FIX;%                                   44169000
              T ~ P(.LOCATQUE); FIX;%                                   44170000
              T ~ P(.IOQUE); FIX;%                                      44171000
$INCLUDE 44171901, IF STATISTICS;                                       44171899
             T:=P(.DISKWAITIME); FIX;                                   44171900
              T ~ P(.TRANSACTION); FIX;%                                44172000
              T ~ P(.WAITQUE); FIX;%                                    44173000
              SPACESTACK ~ J; J ~ J+80;                                 44173100
$ INCLUDE 44173151, IF SHAREDISK;                                       44173139
              I:=LQMAX;                                                 44173140
              T:= P(.LQUE); FIX;                                        44173150
              ESPTAB~J; J~J+W;                                          44173200
              ESPCOUNT:=ESPDISKTOP-ESPDISKBOTTOM;                       44173300
              J:=J+1;                                                   44173450
              T:=P(.USERDISK); FIX;                                     44173500
              I ~ 36;                                                   44174000
              T ~ P(.LABELTABLE); FIX;%                                 44175000
              T ~ P(.MULTITABLE); FIX;%                                 44176000
              T ~ P(.RDCTABLE); FIX;%                                   44177000
              I ~ UVSIZE; T~UV.[CF]; FIX;                               44178000
              I:=13;T:=P(.UNITCODE);FIX;                                44178100
              I ~ 128; T ~ P(.ISTACK); FIX;%                            44179000
              WORKERSTACK:=J; J:=J+90;                                  44179100
$INCLUDE 44179151, IF DCP;                                              44179149
              WORKERSTACK.[FF]:=J;  J:=J+80;                            44179150
              I~J;                                                      44179200
              FOR T:=2 STEP 1 UNTIL NUMSTACK DO                         44179300
              BEGIN M[J~J+STANDARDSTACK]~I; I~J END;                    44179400
              J~(STACKQ~J)+STANDARDSTACK;                               44179500
              I ~ 11; T~P(.PUNTER); FIX;                                44179900
              STACKUSE ~ TRUE;%                                         44180000
$ INCLUDE 44180201, IF DEBUGGING;                                       44180099
              NSYMBS ~ 34;                                              44180100
              TBL[32] ~ "SPO"; TBL[33] ~ [TYPETOG].[33:15];             44180120
              TYPETOG ~ "O";                                            44180140
              TBL[34] ~ "F";                                            44180200
              FOR I ~ 16 STEP 1 UNTIL 31 DO%                            44181000
                   IOQUE[I] ~ I;%                                       44182000
              FOR I ~ 0 STEP 1 UNTIL 15 DO%                             44183000
                   BEGIN IOQUE[I] ~ I;%                                 44184000
                        LABELTABLE[I] ~ @114;%                          44185000
                   END;%                                                44186000
              FORKQUE ~ M OR P(.FORKQUE)&P(.FORKQUE)[CTF]&@777[9:39:9]; 44186500
              BED1 ~ FLAG(BED~[BED] INX @1007777777700000);             44187000
              CLICK ~ @777777777777;                                    44187100
              PRIORTY~PRYOR[0]~-1;                                      44187200
              NUMESS ~ -100;%                                           44188000
              CLOCK:=SPOWORD:=0;                                        44188100
$ INCLUDE 44189001, IF DEBUGGING;                                       44188999
              P(.DT,LOD,0,DIB 5,TRB 1,.DT,~);%                          44189000
              LOGARRAY[31]~IOMASK~@2000000000;                          44191000
              DISKWAIT(-(A:=SPACE(30)),-30,DIRECTORYTOP-SYSNO);         44191005
              T:=M[A+19].[CF];                                          44191010
              FIXFENCE;                                                 44191015
              IF T!FENCE AND T!0 THEN                                   44191020
              BEGIN IF (T := @100000-(((P(DUP)-T)DIV CHUNKZIZE)         44191025
                                                 |CHUNKZIZE))           44191030
                   }@20000 AND T{@70000 THEN FENCE := T;                44191040
                   M[A+19]:=FENCE;                                      44191050
                   DISKWAIT(A,-30,DIRECTORYTOP-SYSNO);                  44191055
                   TOGLE:=0;                                            44191060
                   P(0, 0, RDF, FCX, STS);  GO TO RESTARTCYCLE;         44191090
              END  FENCE MOVING JAZZ;                                   44191100
              FORGETSPACE(A);                                           44191110
              PROCTIME[0]~IOTIME[0]~@2003777777777777;                  44192000
$ INCLUDE 44192011, IF DEBUGGING;                                       44192009
              I~P(.DT);FIXEX;I~P(.EXP);FIXEX;                           44192010
              I~P(..SHORTCOMMUNICATES,NT1,DEL);FIXEX;                   44193020
$OMIT 44193036, IF DCP;                                                 44193029
              I:=P(.DCIOFINISH); FIXEX;                                 44193030
              I~P(.NEXTDCIO);FIXEX;                                     44193032
              I~P(.DCWRITE);FIXEX;                                      44193034
              I~P(.ENTERLINEQ); FIXEX;                                  44193035
$INCLUDE 44193038, IF DCP;                                              44193036
              I:=P(.DCPHANDLER); FIXEX;                                 44193037
$ INCLUDE 44193041, IF SHAREDISK;                                       44193039
              UNLOCK(DIRECTORYTOP-SYSNO);                               44193040
              FOR I ~ 20 STEP 1 UNTIL 35 DO                             44194000
                   LABELTABLE[I] ~ @114;%                               44195000
              LABELTABLE[25] ~ 0;%                                      44196000
$ INCLUDE 44199001, IF DEBUGGING;                                       44196999
              FOR I ~ 0 STEP 2 UNTIL 30 DO BEGIN%                       44197000
                   TBL[I] ~ TINU[I DIV 2] .[30:18];%                    44198000
                   TBL[I+1] ~ [LABELTABLE[I DIV 2]].[33:15] END;%       44199000
              FOR I ~ 0 STEP 1 UNTIL 31 DO TINU[I].[18:12] ~ 0;%        44200000
              FOR I:=WORKERSTACK.[CF] STEP 1 UNTIL WORKERSTACK.[CF]+89  44200700
$INCLUDE 44200801, IF DCP;                                              44200799
                   +80                                                  44200800
                DO M[I]:=@2525252525252525;                             44200900
              FOR I ~ @100 STEP 1 UNTIL @177 DO%                        44201000
                   ISTACK[I-@100]~ISTACK[I]~M[I]~@2525252525252525;     44201100
              FOR I:=@160 STEP 1 UNTIL @177 DO M[I]:=0;                 44201105
              FOR I := 0 STEP 1 UNTIL 12 DO                             44201110
                   UNITCODE[I] := -0; UNITCODE[7] := 0;                 44201120
$ INCLUDE 44201141, IF SHAREDISK;                                       44201129
              FOR I~LQMAX-1 STEP -1 UNTIL 0 DO                          44201130
                   LQUE[I]~@2525252525252525;                           44201140
              FOR I:=0 STEP 1 UNTIL 2 DO                                44201145
                   SPACER[I]:=P(DUP).[CF]&P(DUP)[CTF];                  44201150
              EVENT[0].[FF]:=[EVENT[0]];                                44201155
              SETUPINITIALBUFFERS;                                      44201160
$INCLUDE 44201166, IF DCP;                                              44201164
              LINETABLE:=SPACE(C:=64)&256[18:40:8];                     44201165
$OMIT 44201171, IF DCP;                                                 44201169
              LINETABLE:=SPACE(C:=6|LMAX+6);                            44201170
              MOVE(C,LINETABLE-1,LINETABLE);                            44201175
          % FIND INITIAL VALUE FOR CORE                                 44201200
              CORE:=P(..COREND,LOD).[CF]-P(..INITIALIZE,LOD).[CF];      44201300
              I~M[M[M[AVAIL]]];                                         44201400
              WHILE I.[FF] ! @77777 DO                                  44201500
                   BEGIN CORE ~ CORE + I.[FF];  I ~ M[I] END;           44201600
              CORE ~ CORE DIV 64;                                       44202000
              INDIAN.[FF]~[INDIAN];                                     44202095
              DDD~[M[A~GETSPACE(483,0,0)+2]]& 483[8:38:10];             44202500
              DISKWAIT(-A,-30,0);                                       44202600
              STREAM(S~M[3]~ %% PATCH LEVEL ON NEXT CARD                44203000
                  "0"                                                   44203100
                   ,FENCE,MEMASK,N:=A+10+5|SYSNO                        44203150
$ INCLUDE 44203181, IF SHAREDISK;                                       44203179
                   ,SYS~SYSNO+17                                        44203180
                   ,T:=B:=SPACE(10));                                   44203200
              BEGIN DS~5 LIT "-H/L ";                                   44204000
$ INCLUDE 44204101, IF SHAREDISK;                                       44204099
                    SI~LOC SYS;SI~SI+7;DS~7 LIT"SYSTEM ";DS~CHR;        44204100
                    DS~6 LIT" WITH ";SI~N;SI~SI+1;DS~7 CHR;             44204200
              DS:=LIT"/";SI:=SI+1;DS:=7 CHR;DS:=6 LIT" MARK ";          44204500
              DS:=4 LIT"XIII";                                          44204600
              SI:=LOC S; IF SC GEQ " " THEN;                            44205000
              8(IF TOGGLE THEN IF SC="0" THEN SI:=SI+1 ELSE DS:=CHR     44205050
                ELSE DS:=CHR);                                          44205100
              DS~ 3 LIT ",F=";  SI~ LOC FENCE;  DS~ 5 DEC;              44205140
              DS~ 7 LIT " [MODS=";                                      44205160
              SI~LOC MEMASK; SKIP 40 SB;                                44206000
              8(IF SB THEN DS~LIT"@" ELSE DS~LIT"R"; SKIP SB);          44206100
              DS~ 4 LIT "] -~";                                         44206200
              END;                                                      44206300
          MEMOD~MEMASK;                                              %AI44206900
                                                                        44207000
              STREAM(Q:=[PUNTER[1]],T:=T:=SPACE(11)-1);                 44207100
                   BEGIN DS~16 LIT "*** SHOULD H/L: ";                  44207200
                        DI~DI-16; SI~Q;                                 44207300
                        IF 16 SC=DC THEN                                44207400
                        BEGIN DI~DI-16; DS~8LIT"0";                     44207500
                             DS~16 LIT "HALT CAUSED BY: ";              44207600
                             DS~63CHR; DS~LIT "~";                      44207700
                        END;                                            44207800
                        DI:=Q; DS:=32 LIT "0";                      %R5644207801
                        DS~16 LIT "SLATE OVER FLOW~"; %5                44207810
                        DS~16 LIT "INVALID ADDRESS~"; %7                44207811
                        END;                                            44207850
$ INCLUDE 44208001, IF SHAREDISK;                                       44207899
              FOR I:=13 STEP 5 UNTIL 28 DO                              44207900
                   LDATE:=LDATE OR (DDD[I]!0 AND ((I-13) DIV 5)!SYSNO); 44207910
              UNLOCK(0);                                                44207920
              IF NOT LDATE THEN                                         44207930
              FOR I:=0 STEP 1 UNTIL 3 DO                                44207940
              BEGIN                                                     44207950
                   J:=@4060&I[30:46:2]; % CLEAR CONTENTION BITS         44207960
                   P(WAITIO([J] INX @100000000,0,18),DEL);              44207970
                   J.[37:1]:=1; % UNLOCK ADDRESSES                      44207980
                   P(WAITIO([J] INX @100000000,0,18),DEL);              44207990
              END;                                                      44208000
              FOR I:=0 STEP 1 UNTIL 15 DO                               44208900
                   J ~ WAITIO(@4200000000,@377,I);%                     44209000
              DISKWAIT(-A,30,DIRECTORYTOP-SYSNO);                       44213000
              CORE.[4:14]:=IF DDD[9]=0 THEN 100 ELSE DDD[9].[4:14];     44213500
              OPTION ~ DDD[0];%                                         44214000
              IF (SCHEDWRD:=NABS(DDD[21]))=0 THEN                       44214300
                  SCHEDWRD:=(-1)&1[CTF];                                44214310
              REMOTE~0;                                                 44215000
              LOGARRAY[33]:=DDD[20].[30:18];                            44216100
              LOGARRAY[32]~-0;                                          44216110
              IF M[T]=0 THEN SPOUT(T+1) ELSE FORGETSPACE(T+1);          44216300
              DISKWAIT(-A,-30,DIRECTORYTOP);                            44216700
              XCLICK:=(@7777777777700 AND DDD[18]) MOD 5184000;         44216900
              NEUP:=DDD[2] MOD 100 ;                                    44216910
              NEUP:=NEUP&(NEUP+DDD[2] DIV 100)[CTF] ;                   44216940
              DATE:=DDD[1];                                             44216950
              SPOUTIT(B,HALTK);                                         44216955
$ INCLUDE 44216961, IF SHAREDISK;                                       44216959
              UNLOCK(DIRECTORYTOP);                                     44216960
$ INCLUDE 44240401, IF SHAREDISK;                                       44240099
    SCRATCHVEC~[M[GETSPACE(10,SCRATCHTYPE,SCRATCHSAVE)+2]]              44240100
               & 10[TOSIZE];                                            44240200
    TOGLE~TOGLE OR SCRATCHDIRECTORYMASK OR USERDISKMASK;                44240400
    STREAM(A:=BYPASS:=DDD[4],D:=P(.DIRDSK));                            44240500
    BEGIN SI:=LOC A; DS:=8 DEC END;                                     44240600
    DISKBOTTOM:=BYPASS-2;                                               44240700
    EUIO:=[M[GETSPACE((I:=NEUP.NEUF)+EUIOFFSET,0,1)+2]]                 44240710
          &(I+EUIOFFSET)[8:38:10] ;                                     44240715
    PEUIO:=[M[GETSPACE(I,0,1)+2]]&I[8:38:10];                           44240730
    M[EUIO.[CF]-2].[9:6]:=0;  M[PEUIO.[CF]-2].[9:6]:=PEUIO[0]:=0 ;      44240735
    IF I GTR 1 THEN MOVE(I-1,PEUIO,[PEUIO[1]]) ;                        44240740
    EUIO[0]:=0;IF I+EUIOFFSET>1 THEN MOVE(I+EUIOFFSET-1,EUIO,[EUIO[1]]);44240750
              CHUNKMAX~CHUNKMAX-1;                                      44241100
              FOR I~0 STEP 1 UNTIL CHUNKMAX DO                          44241110
              IF (TWO(7-(CHUNKZIZE|I+FENCE) DIV 4096)AND MEMASK)!0 THEN 44241120
                   CT[I]:=(NOT 0).[36:12];   % ACTIVE[I]:=TOTAL[I]:=63; 44241130
              ACTDATE:=WEEKDAY:=0;                                      44241150
$ INCLUDE 44241501, IF SHAREDISK ;                                      44241199
    IF LDATE THEN                                                       44241200
    BEGIN                                                               44241250
         DISKWAIT(-EUIO.[CF],EUIO.[8:10],EUIOHOLDER) ;                  44241275
         DIRECTORYFREE~1;                                               44241325
         AVS~P(DDD[NEUP.NEUF],DUP).NUMENT+P(XCH).STARTWRD+AVDIFFMIN;    44241330
         AVS~(AVS~IF AVS >AVSMAX THEN AVSMAX ELSE IF AVS LSS AVSMIN     44241335
         THEN AVSMIN ELSE AVS)+30-(IF (AVS~AVS MOD 30)!0 THEN AVS ELSE  44241336
         30);                                                           44241337
         CLEANOUT(SYSNO);                                               44241350
         SETUPSCRATCHDIRECTORY ;                                        44241363
         CREATELOG;                                                     44241375
         DISKWAIT(-A,60,USERDISKBOTTOM);                                44241380
$VOID 44241397                                                          44241385
    END ELSE                                                            44241400
        BEGIN SCRATCHVEC[0]~SCRATCHVEC[1]~SCRATCHVEC[2]~SCRATCHVEC[3]~0;44241410
              DISKWAIT(SCRATCHVEC INX 0,4,DIRECTORYTOP+1) ;             44241420
              SETUPSCRATCHDIRECTORY ;                                   44241500
              DIRECTORYBUILDER(A,DDD);                                  44242000
$INCLUDE 44242101, IF SHAREDISK ;                                       44242090
        END ;                                                           44242100
              ACTDATE~WEEKDAY~0;                                        44242900
              TIMEOUT(SPACE(10));  DATEOUT(SPACE(10));                  44243000
              X:=[M[SPACE(30)]]&30[8:38:10];                            44243280
              LASTSEG := FIRSTSEG := P(((SPACE(32)+2)OR M)              44395100
                                  & 32[8:38:10],SFB);                   44395200
              MOVE(32,LASTSEG.[CF]-3,LASTSEG.[CF]-2);                   44395220
              M[IOADR] ~ IOMASK;                                        44395230
              PROGTANK:=TANKADDRESS:=BASEDISKADR:=0;                    44395300
              TOGLE:=TOGLE OR HOLDMASK;                                 44395320
              FIRSTOFFSET ~ LASTOFFSET ~ 1;                             44395350
              IF GIVEDATE THEN%                                         44396000
                   BEGIN;STREAM(B:=I:=SPACE(2));                        44397000
                             DS ~ 11 LIT "#DT PLEASE~";%                44398000
                        SPOUT(I);%                                      44399000
                        DATE ~ -1;%                                     44400000
                   END;                                                 44401000
              IF GIVETIME THEN%                                         44402000
                   BEGIN;STREAM(B:=I:=SPACE(2));                        44403000
                             DS ~ 11 LIT "#TR PLEASE~";%                44404000
                        SPOUT(I);%                                      44405000
                        XCLOCK ~ -5184000;%                             44406000
                   END;%                                                44407000
$ OMIT 44408001, IF SHAREDISK;                                          44407999
              DISKWAIT(-KLUMP,3,DIRECTORYTOP+3);                        44408000
              STASUS[0]~READYSTATE;                                     44408100
              CHANGEDATE(0);                                            44408200
               TOGLE:=TOGLE OR HOLDMASK OR CDMASK OR KEYBOARDMASK;      44408500
              SLEEP([DATE],NOT(-1));                                    44409000
              WHILE XCLOCK<0 DO SLEEP([XCLOCK],NOT(XCLOCK));            44409100
              FORGETSPACE(A);                                           44409300
              TOGLE:=TOGLE OR SHEETMASK OR STATUSMASK OR DCPLOADMASK;   44415000
              READY:=@343600000;%                                       44417000
$INCLUDE 44417091, IF DCP;                                              44417089
              IF DCPTOG THEN FORK(P(.INITIALIZEDCP),1,0,128,1);         44417090
$OMIT 44417101, IF DCP;                                                 44417099
              SPREADTHEWORD;                                            44417100
              FOR I~20 STEP 1 UNTIL 21 DO                               44417110
               P(WAITIO(@4000100000,@777,I),DEL);                       44417120
              TOGLE := TOGLE OR NSECONDMASK;                            44417150
              LASTSCHEDSELECT:=(XCLOCK DIV 54000)|54000;                44417200
              SCHEDLOOK(0,-1); %REORDER SCHEDULE TASK QUEUE             44418000
              X:=[M[SPACE(30)]]&30[8:38:10];                            44418100
              DISKWAIT(-(X INX 0),-30,0);                               44418500
              IF (T:=DIRECTORYSEARCH(X[13+5|SYSNO],X[14+5|SYSNO],17))=0 44419000
                   THEN                                                 44419050
              BEGIN NT1 := SPACE(4);                                    44419100
                   STREAM(NT1);%                                        44419200
                   DS ~ 28 LIT "##LOAD INTRNSC/DISK NOW....~";%         44419300
                   SPOUT(NT1);%                                         44419400
              END ELSE BEGIN%                                           44419500
                   INTRINSICTABLEBUILDER(T);  FORGETSPACE(T);%          44419600
              END;%                                                     44419700
$INCLUDE 44419721, IF SHAREDISK;                                        44419719
              UNLOCK(0);                                                44419720
              FORGETSPACE(X);                                           44419750
              INTFREE:=1;                                           %R5944419800
              IF (T:=DIRECTORYSEARCH(X[10+5|SYSNO],X[11+5|SYSNO],17))!0 44419900
$INCLUDE 44419906, IF STATISTICS;                                       44419904
              THEN MCPTOP:=MCPBASE+M[T INX 7]; IF T NEQ 0               44419905
                   THEN FORGETSPACE(T) ELSE                             44419910
              LBMESS(-X[10+5|SYSNO],X[11+5|SYSNO],"NOT ","IN DIR",      44419920
                   "ECTORY",0,0);                                       44419930
$ OMIT 44419951, IF SHAREDISK;                                          44419949
              MCPFREE:=1;                                               44419950
                                                                        44420000
              RRRMECH ~ RRRMECH AND @7637777777;%                       44421000
              READY ~ READY AND @7637777777;%                           44422000
$INCLUDE 44423101, IF STATISTICS;                                       44422049
         IF (T:=DIRECTORYSEARCH("SYSTEM "                               44422100
$INCLUDE 44422111, IF SHAREDISK;                                        44422109
                &(SYSNO+17)[42:42:6]                                    44422110
                ,"STATS  ",5))=0 THEN                                   44422120
            BEGIN                                                       44422200
                 T:=SPACE(30);                                          44422250
                 MOVE(30,T-1,T);                                        44422300
                 M[T INX 0]:=@0007400074000102;                         44422350
                 STREAM(DATE,X:=T INX 3);                               44422400
                    BEGIN                                               44422450
                         SI:=LOC DATE; DS:=8 OCT; DI:=X;                44422500
                         DS:=2LIT"+#";SI:=X; SI:=SI+5;DS:=3 CHR;        44422550
                    END;                                                44422600
                 M[T INX 7]:=1;                                         44422650
                 M[T INX 4].[9:1]:=1;                                   44422700
                 M[T INX 9]:=1;                                         44422750
                 M[T INX 10]:=                                          44422800
                 SYSTATBASE:=GETUSERDISK(-(M[T INX 8]:=200));           44422810
                 ENTERUSERFILE(-"SYSTEM "                               44422820
$INCLUDE 44422831, IF SHAREDISK;                                        44422829
                               &(SYSNO+17)[42:42:6]                     44422830
                               ,"STATS  ",T-1);                         44422840
            END ELSE BEGIN                                              44422870
            DISKWAIT(-COUNTARRAY.[CF],60,SYSTATBASE:=M[T INX 10]);      44422880
            IF COUNTARRAY[28] NEQ DATE THEN COUNTARRAY[29]:=0 END;      44422885
            FORGETSPACE(T);                                             44422900
            INTERVAL:=108000;                                           44423000
            COUNTARRAY[60]:=@3777777777777777;                          44423100
              CLOCK:=CLOCK OR @3700; % CAUSE NSECOND TO RUN.        %R7844424000
              FORGETSPACE(INTS);%                                       44437000
        GO TO NOTHINGTODO;%                                             44439000
         END;%                                                          44440000
 SAVE REAL PROCEDURE COREND;%                                           44441000
BEGIN REAL T; P(INI); END;%                                             44442000
ARRAY LINKR=NT2[*],BAK=+2[*];                                           44444000
 REAL CLICKS=+4;                                                        44444400
 REAL LINQ = +1, MIX = +3, MASK = -1, TESTER = -2;                      44445000
 COMMENT THE ABOVE DEFINE ENTITIES USED BY BEDSEARCH, WHICH (EXCEPT     44446000
         FOR "LINKR") EXIST IN THE STACK OF EACH CANDIDATE FOR AWAKENING44447000
        ;                                                               44448000
 REAL    FORKER = FORK;                                                 44449000
    COMMENT FORKER IS USED BY SLATE INITIATE CODE TO FOOL FORK.         44450000
              A MARK STACK CONTROL WORD IS PASSED AS THE LAST           44451000
              PARAMETER, BUT ONLY THE CORE FIELD IS USED.  AS LONG AS   44452000
              THE HARDWARE WORKS, SO WILL THIS CODE;                    44453000
 ARRAY   BLOB = NT3[*];                                                 44454000
    COMMENT YOU MUST PROTECT "BLOB" THE SAME AS OTHER NT-TYPE           44455000
              VARIABLES.  IN OTHER WORDS, YOU MAY NOT CALL ANY          44456000
              PROCEDURE AND EXPECT IT TO RETURN WITH THE SAME VALUE;    44457000
              :16: GO TO START;                % 20 - FIRST CODE%       46000000
              :18: GO TO TIMER;                % 22 - TIME INTERVAL%    46001000
              :19: GO TO IOBUSY;               % 23 - I-O BUSY%         46002000
              :20: GO TO KEYBOARDREQUEST;      % 24 - KEYBOARD REQUEST% 46003000
              :21: PRINTERFINISH(20);          % 25 - PRINTER 1 FINISH% 46004000
              :22: PRINTERFINISH(21);          % 26 - PRINTER 2 FINISH% 46005000
              :23: IOFINISH(RESULT1,1);        % 27 - CHANNEL 1 COMPLETE46006000
              :24: IOFINISH(RESULT2,2);        % 30 - CHANNEL 2 COMPLETE46007000
              :25: IOFINISH(RESULT3,3);        % 31 - CHANNEL 3 COMPLETE46008000
$OMIT 46009001, IF DCP;                                                 46008999
              :26: IOFINISH(RESULT4,4);        % 32 - CHANNEL 4 COMPLETE46009000
$INCLUDE 46009501, IF DCP;                                              46009499
              :26: DCPINTERRUPT;               % 32 - DCP INTERRUPT     46009500
              :27: GO TO P2BUSY;               % 33 - P2 BUSY%          46010000
$OMIT 46011001, IF DCP;                                                 46010999
              :28: GO TO INQUEST;              % 34 INQUIRY%            46011000
$INCLUDE 46011501, IF DCP;                                              46011499
              :28: GO TO EXTERNAL;             % 34 INQUIRY             46011500
              :29: DO UNTIL FALSE;             % 35 - SPECIAL INTERRUPT 46011700
$ OMIT 46012001, IF SHAREDISK;                                          46011999
              :30: DO UNTIL FALSE;             % 36 DISK 1 RD CK FINISH 46012000
$ INCLUDE 46012501, IF SHAREDISK;                                       46012499
              :30: GO FINDIT;            % 36 LOCKED ADDRESS FREE       46012500
              :31: DO UNTIL FALSE;             % 37 DISK 2 RD CK FINISH 46013000
              :32: P(0);      GO TO P2PROCESS; % 40 - P2 MEMORY PARITY% 46014000
              :33: P(4,17);   GO TO P2PROCESS; % 41 - P2 INVALID ADDRESS46015000
              :34: P(4,1);    GO TO P2PROCESS; % 42 - P2 STACK OVERFLOW 46016000
              :36: P(6);      GO TO P2PROCESS; % 44 - P2 COMMUNICATE%   46017000
              :37: P(8);      GO TO P2PROCESS; % 45 - P2 PROGRAM RELEASE46018000
              :38: P(10);     GO TO P2PROCESS; % 46 - P2 CONTINUITY BIT 46019000
              :39: P(18);     GO TO P2PROCESS; % 47 - P2 PRESENCE BIT   46020000
              :40: P(12,0);   GO TO P2PROCESS; % 50 - P2 FLAG BIT       46021000
              :41: P(12,1);   GO TO P2PROCESS; % 51 - P2 INVALID INDEX  46022000
              :42: P(12,2);   GO TO P2PROCESS; % 52 - P2 EXP UNDERFLOW  46023000
              :43: P(4,9);    GO TO P2PROCESS; % 53 - P2 EXP OVERFLOW%  46024000
              :44: P(4,11);   GO TO P2PROCESS; % 54 - P2 KINT OVERFLOW% 46025000
              :45: P(12,3);   GO TO P2PROCESS; % 55 - P2 DIVIDE BY ZERO 46026000
              :48: P(0);      GO TO P1PROCESS; % 60 - P1 MEMORY PARITY% 46027000
              :49: P(4,17);   GO TO P1PROCESS; % 61 - P1 INVALID ADDRESS46028000
STACKOVERFLOW :50: P(4,1);    GO TO P1PROCESS; % 62 - P1 STACK OVERFLOW 46029000
              :52: P(6);      GO TO P1PROCESS; % 64 - P1 COMMUNICATE%   46030000
              :53: P(8);      GO TO P1PROCESS; % 65 - P1 PROGRAM RELEASE46031000
              :54: P(10);     GO TO P1PROCESS; % 66 - P1 CONTINUITY BIT 46032000
              :55: P(18);     GO TO P1PROCESS; % 67 - P1 PRESENCE BIT   46033000
              :56: P(12,0);   GO TO P1PROCESS; % 70 - P1 FLAG BIT       46034000
              :57: P(12,1);   GO TO P1PROCESS; % 71 - P1 INVALID INDEX  46035000
              :58: P(12,2);   GO TO P1PROCESS; % 72 - P1 EXP UNDERFLOW  46036000
              :59: P(4,9);    GO TO P1PROCESS; % 73 - P1 EXP OVERFLOW%  46037000
              :60: P(4,11);   GO TO P1PROCESS; % 74 - P1 INT OVERFLOW%  46038000
              :61: P(12,3);   GO TO P1PROCESS; % 75 - P1 DIVIDE BY ZERO 46039000
 START:*: P(..COREND,LOD,4,INX,STS);%                                   46040000
         MCPBASE:=M[0].[18:30];                                         46040100
         DIRECTORYTOP:=M[1];                                            46040150
$ INCLUDE 46040401, IF SHAREDISK;                                       46040299
         SYSMAX:=M[0].[14:2];                                           46040300
         SYSNO:=M[0].[16:2];                                            46040400
$ INCLUDE 46040501, IF DEBUGGING;                                       46040499
PAUSEVALUE~0;                                                           46040500
              INITIALIZE;%                                              46042000
 TIMER::                                                                48000000
$INCLUDE 48000101, IF DCP;                                              48000099
              IF DCPTOG THEN SETATTENTION;                              48000100
              IF (CLOCK:=CLOCK+64).[37:5] = 0 OR                        48000200
                   (SECONDCTR ~ (P2MIX{0)+SECONDCTR)} 4 OR%             48001000
                   (XCLOCK ~ XCLOCK+64) } 5184000 THEN%                 48002000
                   BEGIN IF P(TIO) ! 0 THEN%                            48003000
                        IF FIRSTWAIT ! NEXTWAIT THEN%                   48004000
                             NEWIO;%                                    48005000
                        SECONDCTR ~ 3;%                                 48006000
                        IF NSECONDREADY THEN%                           48007000
                             BEGIN TOGLE~TOGLE AND NOT NSECONDMASK;     48008000
                                  FORK(P(.NSECOND),0,-1,128,0);         48009000
                   END       END;%                                      48010000
$INCLUDE 48011801, IF STATISTICS;                                       48010999
             COUNTUPBY(3,1);                                            48011000
             COUNTUPBY(14,SECONDCTR LEQ 1);                             48011100
             COUNTUPBY(38,(P1MIX=CANDYINX) AND (CANDYINX NEQ 0));       48011200
             COUNTUPBY(7,NT1:=UNIT[18].[13:5] NEQ 0);                   48011300
             COUNTUPBY(8,NT2:=UNIT[19].[13:5] NEQ 0);                   48011350
             COUNTUPBY(17,(NT1+NT2)=2);                                 48011400
             COUNTUPBY(43,(P1MIX=0) AND (NT1:=(NT1 OR NT2)));           48011450
             COUNTUPBY(39,(NT2:=(P1MIX NEQ 0)) AND NT1);                48011470
             IF (P2MIX GTR 0 AND NT1) THEN COUNTUPBY(39,16777216);      48011480
             COUNTUPBY(6,PBUSY);                                        48011500
             IF NT2 THEN COUNTUPBY(6,16777216);                         48011600
             COUNTUPBY(31,NT1:=P2MIX GTR 0);                            48011700
             IF (NT2 AND NT1) THEN                                      48011750
             COUNTUPBY(31,16777216);                                    48011800
              IF (P(RRR) OR RRRMECH)!READY THEN                         48012000
              IF STATUSBIT THEN                                         48012500
                   BEGIN TOGLE~TOGLE AND NOT STATUSMASK;                48013000
                        FORK(P(.STATUS),0,-1,128,0);                    48014000
                   END;%                                                48015000
              IF P2MIX>0 THEN                                           48015100
                 GO TO P2FAKE;                                          48015500
 EXTERNAL::%                                                            48016000
         IF P1MIX = 0 THEN GO TO NOTHINGTODO;%                          48017000
 INITIATE::%                                                            48018000
         P(NT1~PRT[P1MIX,8],STS,0,STF);                                 48019000
         IF P2MIX=0 THEN GO TO COMINIT;                                 48019500
         IF (FORKQUE INX 0)=P(.FORKQUE) THEN                            48020000
         IF BED.[CF]=P(.BED) THEN                                       48021000
 COMINIT:%                                                              48022000
         IF NOPROCESSTOG < 0 THEN%                                      48023000
 GOGOGO:      BEGIN IF PRT[P1MIX,0] ! @2525252525252525 THEN%           48024000
                        BEGIN P(64,STS); GO TO STACKOVERFLOW END;       48025000
                   P(INI);%                                             48026000
                   IF PRTROW[P1MIX].[PSF]!0 THEN                        48027000
                   BEGIN IF (NT3~PRTROW[P1MIX].[PSF])=1 THEN            48028000
                             TERMINALMESSAGE(PRTROW[P1MIX].[FF]);       48029000
                        IF NT3=2 THEN STOPM ELSE SWAP(FORCESWAP,1);     48030000
                        GO TO RETURN;                                   48031000
                   END;                                                 48031100
                                                                        48031200
              IF OLAYCTR[P1MIX] GEQ 0 THEN                          %R3848031290
              IF ELAPSEDLIMIT[P1MIX] GTR IOTIME[P1MIX] THEN         %R5948031300
                   IF IOTIME[P1MIX]>0 THEN                              48031310
                   BEGIN                                                48031320
                   TERMINATE(P1MIX&83[CTF]); GO GOGOGO                  48031330
                   END ELSE                                             48031340
                   IF (NT3~PROCTIME[P1MIX]+CLOCK+P(RTR))<               48031400
                        PROCLIMIT[P1MIX] THEN                           48031500
                   IF NT3>0 THEN                                        48031600
                   BEGIN TERMINATE(P1MIX&15[CTF]);                      48031700
                        GO GOGOGO;                                      48031800
                   END ELSE                                             48031900
                   BEGIN SECONDCTR~0;                                   48032000
                   IF P2MIX!0 THEN                                      48033000
                   P(NT1,IP1);                                          48034000
                   P(NT1,IP2);                                          48035000
                   P2MIX ~ P1MIX;%                                      48037000
                   LOGLINE2 ~ LOGLINE;                                  48037100
                   GO TO NOTHINGTODO;                                   48038000
                   END;                                                 48038100
                   IF P(0,RDS) GTR FENCE THEN                       %R3848038150
                   FOR NT2~SC[P1MIX] STEP 1 UNTIL LC[P1MIX] DO          48038200
                   IF ACTIVE[NT2] GTR 1 OR OLAYCTR[P1MIX]           %R3848038300
                        LSS 0 THEN                                  %R3848038310
                   BEGIN SWAP(TIMEND,1); GO TO RETURN  END;             48038400
                   PROCLIMIT[P1MIX]:=*P(DUP)+208;                    %DS48038500
                   ELAPSEDLIMIT[P1MIX]:=*P(DUP)+416;       %DS      %R5948038600
                   OLAYCTR[P1MIX]:=*P(DUP)+1000000;                 %R8748038610
                   SLN[P1MIX]:=SLN[P1MIX]+(SLN[P1MIX] NEQ 7);        %DS48038640
                   NLS[P1MIX]:=SLN[P1MIX]+2;                         %DS48038680
                   IF LOGLINE.[33:7]!0 THEN                             48038700
                        P([STATABLE[LOGLINE.[40:8]]],IOR);              48038800
                   GO GOGOGO;                                           48038900
              END;%                                                     48039000
         P(INI);%                                                       48040000
                                                                        48041000
         SLEEP([NOPROCESSTOG],-0);%                                     48042000
         NT1 ~ PRT[P1MIX,8];%                                           48043000
         GO GOGOGO;%                                                    48044000
 NOTHINGTODO::P1MIX ~ 0;%                                               48045000
$INCLUDE 48045901, IF STATISTICS;                                       48045899
             PBUSY:=1;                                                  48045900
              P(INI);%                                                  48046000
              P(64, STS);                                               48046500
              IF (FORKQUE INX 0)!P(.FORKQUE) THEN                       48047000
              BEGIN IF (NT1 ~ FORKQUE[4])!0 THEN                        48047500
                   BEGIN P(NT1,STS,0);                                  48048000
    SLATESTARTER:       P(SECONDCTR~0, STF);  NT6 ~ FORKQUE.[CF];       48048500
                        P(FORKQUE[1],FORKQUE[2]);                       48049000
                        PRIORTY ~ FORKQUE[0].[9:9]-64;                  48049500
                        M[NT2 ~ FORKQUE[0].[CF]].[FF] ~ P(.FORKQUE);    48050000
                        FORKQUE.[CF] ~ NT2;                             48050500
                        FORGETAREA(0,NT6);  NT4 ~ P(.BLOB,~);           48051000
                        IF (NT1 ~ P)!0 THEN                             48051500
                        BEGIN P(NT4,BLOB,NT1,GETSPACE(NT1,12,2));   %R5748052000
                             TOGLE ~ TOGLE OR STACKMASK;                48052500
                             IF (NT1 ~ P+1)=1 THEN                      48053000
                             BEGIN P(PRIORTY, XCH, MKS, FORKER);        48053500
                                  GO TO NOTHINGTODO;                    48054000
                             END;                                       48054500
                             P(DEL,.BLOB,~,.NT4,~,NT1,STS);             48055000
                        END;                                            48055500
                        LOGLINE:=NT4.[FF]&NT4[1:1:1];                   48055600
                   P(CLOCK&NT4[8:38:10],MKS,NT4,DIB 0,LOD,BLOB,COC);    48056000
                        GO TO NOTHINGTODO;                              48056500
                   END;                                                 48057000
                   IF STACKUSE THEN                                     48057100
                   BEGIN TOGLE ~ TOGLE AND NOT STACKMASK;               48057200
                        P(ISTACK, STS, FORKQUE[3]);                     48057300
                        GO TO SLATESTARTER;                             48057400
                   END;                                                 48057500
              END;                                                      48057600
              P( 64,STS);%                                              48058000
              IF TOGLE THEN GO TO PROCSWIT; COMMENT TEST HP2TOG;        48059000
$INCLUDE 48059501, IF DCP;                                              48059499
WAKEUP:                                                                 48059500
              LINKR  ~ FLAG(BED);                                       48060000
              WHILE LINKR.[CF]!P(.BED) DO                               48061000
              BEGIN P(INI,[LINKR[FREG]],STS,DUP,STF);                   48062000
                   P1MIX ~ MIX; % MIX = F+3, MASK=-1, TESTER=-2         48063000
                   IF (NOT(MASK AND TESTER))!NOT 0 OR                   48064000
                        CLOCK+P(RTR)>CLICKS THEN                        48064100
                   BEGIN                                                48065000
                        PROCTIME[P1MIX]~*P(DUP)-CLOCK-P(RTR);           48066000
                        P(BAK[0]~P(DUP,LOD)&LINQ[CTC],1,CDC,BAK,XCH,~); 48067000
                        SECONDCTR ~ 0;                                  48069000
                        LOGLINE ~ P(DEL);                               48069100
                        PRIORTY ~ LINQ.[FF]-64;                         48069200
                        P(XIT);                                         48070000
                   END;                                                 48071000
                   P1MIX ~ 0;                                           48072000
                   LINKR  ~ FLAG(LINQ);                                 48073000
              END BED SEARCH;                                           48074000
$INCLUDE 48081001, IF STATISTICS;                                       48079999
              PBUSY~0;                                                  48081000
              DO DO BEGIN P(INI);                                       48082000
$INCLUDE 48086001, IF DCP;                                              48082999
                        IF DCPTOG THEN                                  48083000
                        BEGIN IF RESULTQ.[24:1] THEN ELSE GO WAKEUP;    48084000
$VOID 48084201                                                          48084100
                             UPREQUESTQ;                                48085000
                        END;                                            48086000
                   END UNTIL (P(RRR) OR RRRMECH)!READY                  48087000
              UNTIL STATUSBIT;                                          48088000
              TOGLE:=TOGLE AND NOT STATUSMASK;                          48089000
              FORK(P(.STATUS),0,-1,128,0);                              48090000
              GO TO NOTHINGTODO;                                        48091000
P2FAKE:       TOGLE:=TOGLE OR HP2MASK;                                  48092000
              P(HP2,INI);                                               48093000
PROCSWIT:     P(16);                                                    48094000
 P2PROCESS::%                                                           48095000
         IF P(P1MIX,P2MIX,.P1MIX,~,.P2MIX,STN) ! 0 THEN%                48096000
              P(PRT[P2MIX,8],IP2);%                                     48097000
         PRIORTY~PRYOR[P1MIX];                                          48097100
         P(LOGLINE,LOGLINE2,.LOGLINE,~,.LOGLINE2,~);                    48097200
         TOGLE~TOGLE AND NOT HP2MASK;                                   48098000
 P1PROCESS::%                                                           48099000
         P(PRT[P1MIX,8],STS,0,STF);%                                    48100000
         GO TO P(ONEOHONE);%                                            48101000
         GO TO MEMORYPARITY;      %  0%                             %WF 48102000
         P(NOP,NOP);              %  2%                             %WF 48102100
         GO TO NORMALERROR;       %  4%                                 48103000
         SHORTCOMMUNICATES;       %  6%                                 48104000
         PROGRAMRELEASE;          %  8                                  48105000
         CONTINUITYBIT;           % 10                                  48106000
         INTERRUPT(ONEOHTWO); P(NOP); % 12                              48107000
         GO TO INITIATE;          % 16                                  48108000
         MAKEPRESENT(ANALYSIS);   % 18                                  48109000
 RETURN::     P(NT1~PRT[P1MIX,8],STS,0,STF);                            48110000
              GO TO COMINIT;                                            48111000
 IOBUSY:: NT1 ~ UNIT[NT2~CHANNEL[0]];%                                  48117000
         UNIT[NT2] ~ NT1&0[13:5:5];%                                    48118000
         STARTIO(NT2);%                                                 48119000
         GO TO EXTERNAL;%                                               48120000
 P2BUSY:: SAVEMIX(P1MIX,LOGLINE);                                       48121000
         PRIORTY~PRYOR[P1MIX~P2MIX];                                    48122000
         P2MIX ~ -1;%                                                   48123000
         GO TO EXTERNAL;%                                               48125000
$ INCLUDE 48125401, IF SHAREDISK;                                       48125099
FINDIT::                                                                48125100
         IF NOT FINDINGADDRESS THEN                                     48125150
         BEGIN                                                          48125200
              FINDINGADDRESS:=1;                                        48125250
              FORK(P(..FINDFREEADDRESS),1,-2,0,1);                      48125300
         END;                                                           48125350
         GO TO EXTERNAL;                                                48125400
$OMIT 48127001, IF DCP;                                                 48125499
INQUEST::                                                               48125500
$ INCLUDE 48126002, IF SAVERESULTS OR DEBUGGING;                        48126000
STORAWAY ~ UNIT[30];                                                    48126001
                   INTERROGATOR;                                        48126100
            GO TO EXTERNAL;%                                            48127000
 KEYBOARDREQUEST::%                                                     48128000
         NOBACKTALK ~ TRUE;%                                            48129000
         IF NOT KEYBOARDREADY THEN GO TO EXTERNAL;%                     48130000
         IF (KEYBOARDCOUNTER:=P(1 INX KEYBOARDCOUNTER)) = 1 THEN        48131000
         FORK(P(.KEYIN),1,0,192,0);                                     48132000
         GO TO EXTERNAL;%                                               48133000
 MEMORYPARITY::%                                                    %WF 48134000
         TERMINATE(P1MIX);%                                         %WF 48135000
         TERMINALMESSAGE(32);%                                      %WF 48136000
 NORMALERROR::%                                                         48137000
              IF P1MIX = 0 THEN%                                        48138000
                   BEGIN P(@100,STS);%                                  48139000
                        PUNT([PUNTER[7]]);                              48140000
                   END;%                                                48141000
              IF ONEOHTWO=1 THEN                                        48141100
              BEGIN P(SINFO[P1MIX],STS);                                48141200
                   INTABLEROW[P1MIX]~0;                                 48141210
                   PRT[P1MIX,15]~M[PRT[P1MIX,8]];                       48141300
                   PRT[P1MIX,8]~-[PRT[P1MIX,15]];                       48141400
                   PRT[P1MIX,3]~FPBD[P1MIX];                            48141500
                   PRT[P1MIX,4]~SEGD[P1MIX];                            48141600
              END;                                                      48141700
              P(ONEOHTWO);                                              48142000
                   IF P(DUP,DUP)=9 OR P(XCH)=11 THEN                    48142100
                        ERRORFIXER((ONEOHTWO=9)+1);                     48142200
              TERMINATE(P1MIX);                                         48142500
              NT1 ~ P;                                                  48143000
              TERMINALMESSAGE(NT1);                                     48143500
 DIFFCOM::NT4~P;                                                        48144000
         P(0,STF,PRT[P1MIX,8],STS,MKS,NT4,DIB 0,LOD,XCH,COC);           48145000
         GO TO INITIATE;                                                48146000
END.%                                                                   48161000
