VERSION E05

PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:1    
        1        1        /*M* OCA$KMISC Handle miscelaneous KEYINs in the monitor */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR,PLM=5,IND=5,CTI=5,SDI=5,MCL=10,CSI=0,ECI=0 */
        8        8        %SET LISTSUB='1'B;
        9        9                                                /**/
       10       10        /**/
       11       11        /**/
       12       12        OCA$KMISC: PROC (KMSG) ALTRET;
       13       13        /**/
       14       14        /**/
       15       15        %INCLUDE B$USER;
       16      231        %B$USERREFS;
       17      235        %INCLUDE UM_CP6;
       18     1087        %INCLUDE B$JIT_C;
       19     1401        %B$JIT0 (STCLASS=BASED);
       20     1490        %A$JIT6X;
       21     1493        %INCLUDE OC_SUBS_C;
       22     2224        %INCLUDE SS_SCHED_C;
       23     2457        %INCLUDE SS_SCHED_R;
       24     2500        %INCLUDE OC_DATA_R;
       25     2509        %INCLUDE JP_MACRO_C;
       26     2664        %INCLUDE JG_EVID_C;
       27     2889        %INCLUDE JM$STRUCT;
       28     3634        %INCLUDE JG_GHOSTS_C;
       29     3724        %INCLUDE JC_MACRO_C;
       30     3838        %INCLUDE KL_MACRO_C;
       31     7190        %INCLUDE KL_AFCN_C;
       32     7291        %INCLUDE NI$TABLES;
       33     7507        %INCLUDE TM_DATA_M;
       34     7609        %INCLUDE HF_DATA_R;
       35     7652        /**/
       36     7653        %VLR_MONINFO (FPTN=B_MONINFO,STCLASS=SYMREF);
       37     7671        /**/
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:2    
       38     7672        /**/
       39     7673    1   DCL 1 KMSG ALIGNED,
       40     7674    1            2 KIN# UBIN(18) UNAL,
       41     7675    1            2 CADDR BIT(18) UNAL,
       42     7676    1            2 SYSID UBIN(18) UNAL,
       43     7677    1            2 MODE REDEF SYSID UBIN(18) UNAL,
       44     7678    1            2 NUMU UBIN(18) UNAL,
       45     7679    1            2 BCHFLG REDEF NUMU UBIN(18) UNAL,
       46     7680    1            2 WSN CHAR(8),
       47     7681    1            2 DTTIM REDEF WSN CHAR(8),
       48     7682    1            2 * CHAR(124) UNAL;            /* LEN = 140 BYTES */
       49     7683                                                /**/
       50     7684    1   DCL 1 KMSG2 REDEF KMSG,
       51     7685    1            2 KIN# UBIN HALF CALIGNED,
       52     7686    1            2 CADDR BIT(18) CALIGNED,
       53     7687    1            2 FIL1 UBIN BYTE CALIGNED,
       54     7688    1            2 FIL2 UBIN (27) CALIGNED,
       55     7689    1            2 COUNT UBIN BYTE CALIGNED,
       56     7690    1            2 ZAP_TXT CHAR(131) CALIGNED;
       57     7691                                                /**/
       58     7692    1   DCL 1 USR ALIGNED,
       59     7693    1            2 * UBIN(27) UNAL,
       60     7694    1            2 USER# UBIN(9) UNAL;
       61     7695        %KL_TIME (FPTN=KL_TIME,STCLASS=AUTO);
       62     7719    1   DCL EVENT UBIN WORD;
       63     7720    1   DCL I REDEF EVENT UBIN WORD;
       64     7721    1   DCL J UBIN WORD;
       65     7722    1   DCL  UTSBUF UBIN WORD;
       66     7723    1   DCL P$ PTR;
       67     7724    1   DCL S_TIM_KEYIN SBIN SYMREF;
       68     7725    1   DCL SSC_TMWU(0:9) UBIN SYMREF;
       69     7726    1   DCL SSC_TMLNK(0:9) UBIN SYMREF;
       70     7727    1   DCL SSC_TMHD UBIN SYMREF;
       71     7728    1   DCL DATE CHAR(8);
       72     7729    1   DCL TIME CHAR(5);
       73     7730    1   DCL NOUSERSOK UBIN WORD STATIC ALIGNED INIT(1);
       74     7731    1   DCL BTML (0:4) UBIN BYTE CONSTANT UNAL INIT(LENGTHC(BTM.JEOK),LENGTHC(BTM.BFIS),
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:3    
       75     7732    1                                              LENGTHC(BTM.MUIS),LENGTHC(BTM.CUIS),
       76     7733    1                                              LENGTHC(BTM.UNUSD));
       77     7734    1   DCL 1 BTM ALIGNED,
       78     7735    1            2 JEOK UBIN WORD,
       79     7736    1            2 MODE REDEF JEOK UBIN WORD,
       80     7737    1            2 SUBCODE REDEF JEOK UBIN WORD,
       81     7738    1            2 BFIS UBIN WORD,
       82     7739    1            2 UNUM REDEF BFIS UBIN WORD,
       83     7740    1            2 MUIS UBIN WORD,
       84     7741    1            2 CUIS UBIN WORD,
       85     7742    1            2 UNUSD UBIN WORD;
       86     7743    1   DCL 1 USRM REDEF BTM ALIGNED,
       87     7744    1            2 MC (0:4) UBIN WORD;
       88     7745    1   DCL BUF$ PTR;
       89     7746    1   DCL BUFX SBIN;
       90     7747    1   DCL DQH$ PTR;
       91     7748    1   DCL UTS_B UBIN BASED;
       92     7749        %NI$DQH;
       93     7772    1   DCL 1 TEMP_FEP_ERA,
       94     7773    1            2 ERA UBIN(6) UNAL,
       95     7774    1            2 FUTS UBIN(30) UNAL;
       96     7775    1   DCL FS_JEOK UBIN WORD STATIC SYMDEF INIT(0);
       97     7776    1   DCL OCA_SAVE_TUIS UBIN WORD STATIC SYMDEF INIT(0);
       98     7777    1   DCL OCA_DIE_COMMENT UBIN WORD STATIC SYMDEF INIT(0);
       99     7778        %JP_CITE (FPTN=JP_CITE,COD=JPEV_JPGO#,STCLASS=STATIC);
      100     7810        %JM_CITE (FPTN=JM_SMSG,COD=JMEV_STRT#,STCLASS=CONSTANT);
      101     7860        %JC_CITE (FPTN=JC_SUSR,TYP=PCMP,COD=JCEV_SUSR#,STCLASS=CONSTANT);
      102     7910    1   DCL J_MBS CHAR(8) SYMREF READONLY;
      103     7911    1   DCL J_PRESCAN CHAR(8) SYMREF READONLY;
      104     7912    1   DCL J_SLUG CHAR(8) SYMREF READONLY;
      105     7913    1   DCL JM_BFIS UBIN WORD SYMREF;
      106     7914    1   DCL B_MUAIS SBIN SYMREF;
      107     7915    1   DCL UMT_UNIQUE UBIN WORD SYMREF;
      108     7916    1   DCL SSR$RUE ENTRY(4);
      109     7917    1   DCL SSS$CURTIME ENTRY(1);
      110     7918    1   DCL OCZ$SID_UN ENTRY(4) ALTRET;
      111     7919    1   DCL UMT$IDT ENTRY(2) ALTRET;
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:4    
      112     7920    1   DCL UMT$LCLDATE ENTRY(3) ALTRET;
      113     7921    1   DCL SSS$SETBTIME ENTRY(1);
      114     7922    1   DCL SSS$UPDITIME ENTRY;
      115     7923    1   DCL SSS$UPDUTS ENTRY(1);
      116     7924    1   DCL SSS$CACHEBP ENTRY;
      117     7925    1   DCL SSS$CACHE ENTRY;
      118     7926    1   DCL SSS$UTS_L6  ENTRY(2);
      119     7927    1   DCL SSS$FEPERA  ENTRY(2);
      120     7928    1   DCL SSW$ZAP ENTRY(1);
      121     7929    1   DCL HFA$STOPCPUT ENTRY;
      122     7930    1   DCL HFA$STARTCPU ENTRY;
      123     7931    1   DCL OCI$MK_WR ENTRY(7);
      124     7932    1   DCL KUB$WRITE ENTRY(3) ALTRET;
      125     7933    1   DCL KIA$9TO8 ENTRY(3);
      126     7934    1   DCL SC_OCOPERRECOV ENTRY CONV(2,0);
      127     7935    1   DCL SC_OCZAP ENTRY CONV(2,0);
      128     7936    1   DCL KUW$WRITE ENTRY(3) ALTRET;
      129     7937    1   DCL TMB$MCA ENTRY(4) ALTRET;
      130     7938    1   DCL TMB$BUF_ALLOC ENTRY(3) ALTRET;
      131     7939    1   DCL TMB$BUF_DEALLOC ENTRY(2) ALTRET;
      132     7940        /**/
      133     7941        /**/
      134     7942    2        DO CASE (KMSG.KIN#);
      135     7943    2        CASE (12 /* KEY_NOUSERS# */);
      136     7944    2   SIM_NOUSERS:;
      137     7945    3           IF NOUSERSOK ~= 0 THEN DO;
      138     7946    3                B_MONINFO.NOUSERS#='1'B;
      139     7947    3                BTM.SUBCODE=0;
      140     7948    3              END;
      141     7949    2           ELSE BTM.SUBCODE=2;
      142     7950    2           CALL OCI$MK_WR ('200000'O /* M_SYS  */,99 /* NOUSERS_MSG# */,LENGTHC(BTML),
              7950                    BTML,BTM);
      143     7951    2        CASE (1 /* KEY_ON# */);
      144     7952    2           IF KMSG.NUMU>B_MUAIS THEN GOTO NRMERR;
      145     7953    2           ELSE IF KMSG.NUMU > 0
      146     7954    2                THEN IF B_MONINFO.NOUSERS#
      147     7955    3                     THEN DO;
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:5    
      148     7956    3                          B_MONINFO.NOUSERS#='0'B;
      149     7957    3                          CALL KUW$WRITE (JC_SUSR,SIZEC(JC_SUSR),J_SLUG);
      150     7958    3                          BTM.SUBCODE=1;
      151     7959    3                          CALL OCI$MK_WR ('200000'O /* M_SYS  */,99 /* NOUSERS_MSG# */,
              7959                                   LENGTHC(BTML),BTML,BTM);
      152     7960    3                        END;
      153     7961        /**/
      154     7962    2           IF KMSG.MODE=0 THEN S_TUIS=KMSG.NUMU;
      155     7963    2           ELSE S_MUIS(KMSG.MODE)=KMSG.NUMU;
      156     7964    3           IF KMSG.MODE=%M_BATCH# THEN DO;
      157     7965    3                IF KMSG.NUMU~=0 THEN CALL KUW$WRITE (JM_SMSG,LENGTHC(JM_SMSG),J_MBS);
      158     7966    3                KMSG.CADDR='200000'O /* M_SYS  */;
      159     7967    3                GOTO BTMSG;
      160     7968    3              END;
      161     7969    3           ELSE DO;
      162     7970    3                BTM.MODE=KMSG.MODE;
      163     7971    3                BTM.UNUM=KMSG.NUMU;
      164     7972    3                CALL OCI$MK_WR ('200000'O /* M_SYS  */,138 /* USERS_MSG# */,LENGTHC(
              7972                         BTML),BTML,BTM);
      165     7973    3              END;
      166     7974    2        CASE (2 /* KEY_X# */,3 /* KEY_E# */);
      167     7975    2           IF KMSG.SYSID<=15/*JG_MING#    */ AND B_MONINFO.LADCFLG#=0 THEN GOTO NRMERR;
      168     7976    2           CALL OCZ$SID_UN (KMSG.SYSID,USR,KMSG.CADDR,KMSG.WSN) ALTRET (RTN);
      169     7977    2           IF KMSG.KIN#=3 /* KEY_E# */ THEN EVENT=%SS_ERR;
      170     7978    2           ELSE EVENT=%SS_ABRT;
      171     7979    2           CALL SSR$RUE (EVENT,USR.USER#);
      172     7980    2        CASE (5 /* KEY_TIME# */,4 /* KEY_DATE# */);
      173     7981    2           S_TIM_KEYIN = 1;
      174     7982    3           DO I = 0 TO 3000;
      175     7983    3              END;
      176     7984    2           CALL UMT$IDT (DATE,TIME);
      177     7985    2           IF KMSG.KIN#=5 /* KEY_TIME# */ THEN TIME=KMSG.DTTIM;
      178     7986    2           ELSE DATE=KMSG.DTTIM;
      179     7987    2           CALL UMT$LCLDATE(J,DATE,TIME) ALTRET(NRMERR); /* NEW UTS   */
      180     7988    3           IF HW_IMX THEN DO;
      181     7989    3                CALL TMB$BUF_ALLOC (BUF$,BUFX,DQH$) ALTRET (SETTIME);
      182     7990    3                BUF$ -> UTS_B = J;
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:6    
      183     7991    3                CALL TMB$MCA (DQH$->NI$DQH,4,BUFX);
      184     7992    3                CALL TMB$BUF_DEALLOC (BUF$,BUFX);
      185     7993    3              END;
      186     7994    2   SETTIME: ;
      187     7995    2           CALL HFA$STOPCPUT;         /* TELL SLAVES TO PAUSE FOR TIME UPDATE*/
      188     7996    2           CALL SSS$SETBTIME(J);           /* SET CLOCK                       */
      189     7997    2           CALL SSS$UPDITIME;              /* FIX BEGINNING OF CURRENT INTERVAL*/
      190     7998    2           UMT_UNIQUE = J;
      191     7999    2           CALL SSS$FEPERA(J,TEMP_FEP_ERA);
      192     8000    2           S_BOOTERA = TEMP_FEP_ERA.ERA/3;
      193     8001    2           S_BOOTQUARTER = MOD(TEMP_FEP_ERA.ERA,3);
      194     8002    2           I=SSC_TMHD;
      195     8003    3           DO WHILE  (I ~= 0);
      196     8004    3                CALL SSS$UPDUTS(SSC_TMWU(I)); /* FIX WAKEUP UTS        */
      197     8005    3                I=SSC_TMLNK(I);
      198     8006    3              END;
      199     8007    2           I=S_HQ(%SS_SW);
      200     8008    3           DO WHILE (I ~= 0);
      201     8009    3                P$=ADDR(B$USRT$->B$USER(I));
      202     8010    3                CALL SSS$UPDUTS(P$->B$U.MISC); /* FIX WAKEUP UTS       */
      203     8011    3                I=P$->B$U.FL;
      204     8012    3              END;
      205     8013    2           I=S_RQH((%SS_NQW-%SS_CBF)/2);
      206     8014    3           DO WHILE (I ~= 0);
      207     8015    3                P$=ADDR(B$USRT$->B$USER(I));
      208     8016    3                IF P$->B$U.MISC ~= BITBIN('777777777777'O)
      209     8017    3                     AND P$->B$U.MISC ~= BITBIN('777777777776'O) THEN
      210     8018    3                     CALL SSS$UPDUTS(P$->B$U.MISC); /* FIX WAKEUP UTS    */
      211     8019    3                I=P$->B$U.SQ;
      212     8020    3              END;
      213     8021    3           DO I = 0 TO 2000;               /* GIVE THEM A CHANCE TO GET TO DIS */
      214     8022    3              END;
      215     8023    2           CALL HFA$STARTCPU;         /* START SLAVES. THEY WILL FIX THEIR TIME*/
      216     8024    2           ADDR(KL_TIME.UTS)->UTS_B = J;
      217     8025    2           KL_TIME.FNC = 17;
      218     8026    2           CALL KUB$WRITE(KL_TIME,SIZEC(KL_TIME),'HLPADMIN');
      219     8027    2           S_TIM_KEYIN = 0;
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:7    
      220     8028    2        CASE (8 /* KEY_USRS# */);
      221     8029    2           USRM.MC(0)=S_TUIS;
      222     8030    3           DO I=1 TO 4;
      223     8031    3                USRM.MC(I)=S_MUIS(I);
      224     8032    3              END;
      225     8033    2           CALL OCI$MK_WR (KMSG.CADDR,136 /* ALLOU_MSG# */,LENGTHC(BTML),BTML,USRM);
      226     8034    2           J=0;
      227     8035    3           DO I=1 TO 4;
      228     8036    3                USRM.MC(I)=S_CUIS(I);
      229     8037    3                J=J+S_CUIS(I);
      230     8038    3              END;
      231     8039    2           USRM.MC(0)=J;
      232     8040    2           CALL OCI$MK_WR (KMSG.CADDR,137 /* RUNU_MSG# */,LENGTHC(BTML),BTML,USRM);
      233     8041    3           IF B_MONINFO.NOUSERS# THEN DO;
      234     8042    3                BTM.SUBCODE=3;
      235     8043    3                CALL OCI$MK_WR (KMSG.CADDR,99 /* NOUSERS_MSG# */,LENGTHC(BTML),BTML,BTM
              8043                         );
      236     8044    3              END;
      237     8045                          /*    The '!BATCH keyin' comes from
      238     8046                           *    KEYIN (codes 0,1,2) and
      239     8047                           *    from SLUG during startup
      240     8048                           *    (codes 3,4,5,6).
      241     8049                           */
      242     8050    2        CASE (7 /* KEY_BATCH# */);
      243     8051    3           DO CASE (KMSG.BCHFLG);
      244     8052    3           CASE (0) /* !BATCH */;
      245     8053    3   BTMSG:     ;
      246     8054    3              JP_CITE.GO=FS_JEOK;
      247     8055    3              CALL KUW$WRITE (JP_CITE,SIZEC(JP_CITE),J_PRESCAN);
      248     8056    3              BTM.JEOK=FS_JEOK;
      249     8057    3              BTM.MUIS=S_MUIS(%M_BATCH#);
      250     8058    3              BTM.CUIS=S_CUIS(%M_BATCH#);
      251     8059    3              BTM.BFIS=JM_BFIS-BTM.CUIS;
      252     8060    3              CALL OCI$MK_WR (KMSG.CADDR,139 /* BATCH_MSG# */,LENGTHC(BTML),BTML,BTM);
      253     8061    3           CASE (1) /* !BATCH ON */;
      254     8062    3              FS_JEOK=0;
      255     8063    3              GOTO BTMSG;
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:8    
      256     8064    3           CASE (2) /* !BATCH OFF */;
      257     8065    3              FS_JEOK=1;
      258     8066    3              GOTO BTMSG;
      259     8067    3           CASE (3);
      260     8068                          /*    SLUG has found one or more
      261     8069                           *    of the super files are bad.
      262     8070                           *    Simulate a NOUSERS! keyin
      263     8071                           */
      264     8072    3              GOTO SIM_NOUSERS;
      265     8073    3           CASE (4);
      266     8074                          /*    SLUG found NOUSERS set when he started.
      267     8075                           *    Print the same set of messages
      268     8076                           *    as we would when the guy does
      269     8077                           *    a NOUSERS keyin after KEYIN's
      270     8078                           *    running.  This kluge causes
      271     8079                           *    an ESC-NOUSERS keyin to elicit
      272     8080                           *    the correct set of messages
      273     8081                           *    despite the fact that he does
      274     8082                           *    the keyin before MONKEY is
      275     8083                           *    connected to CSCG
      276     8084                           */
      277     8085    3              GOTO SIM_NOUSERS;
      278     8086    3           CASE (5);
      279     8087    3           CASE (6);
      280     8088                          /*    SLUG has gone past the point where
      281     8089                           *    the NOUSERS keyin will work.
      282     8090                           *    Simulate a !BATCH keyin (for info
      283     8091                           *    and to tell PRESCAN to go if
      284     8092                           *    BATCH is ON).
      285     8093                           */
      286     8094    3              NOUSERSOK=0;
      287     8095    3              GOTO BTMSG;
      288     8096
      289     8097    3           END;
      290     8098                                                /**/
      291     8099                                           /* !DIE! keyin
      292     8100                                                operator recovery */
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:9    
      293     8101    2        CASE (6 /* KEY_DIE# */);
      294     8102    2           IF B_ZIP ~= 0
      295     8103    2           THEN
      296     8104    3           DO;
      297     8105    3                S_TUIS = OCA_SAVE_TUIS;
      298     8106    3              END;                         /* DO IF ZAP IN PROGRESS */
      299     8107
      300     8108    2           IF OCA_DIE_COMMENT ~= 0         /* IF COMMENT REQUIRED, CHECK */
      301     8109    2                AND                        /* TO SEE IF IT'S THERE */
      302     8110    2                KMSG2.FIL1 = 0
      303     8111    3           THEN DO;
      304     8112    3                CALL OCI$MK_WR (KMSG.CADDR,400 /* DIE_MSG# */,0,,);
      305     8113    3                RETURN;
      306     8114    3              END;
      307     8115
      308     8116
      309     8117    2           CALL SC_OCOPERRECOV;
      310     8118                                                /**/
      311     8119    2        CASE (9 /* KEY_MNKZAP1# */);
      312     8120                                           /* Handle initial ZAP keyin by
      313     8121                                                setting UM = 0 and informing
      314     8122                                                SLUG */
      315     8123    2           OCA_SAVE_TUIS = S_TUIS;
      316     8124    2           S_TUIS=18/*JG_RQG#     */;
      317     8125    2           B_ZIP = 1;
      318     8126                                                /**/
      319     8127    2           KMSG2.KIN# = 13 /* KEY_SLUGZAP# */;
      320     8128    2           J = SIZEC(KMSG2.KIN#) + SIZEC(KMSG2.CADDR) +
      321     8129    2                SIZEC(KMSG2.FIL1)+SIZEC(KMSG2.FIL2)+
      322     8130    2                SIZEC(KMSG2.COUNT) + KMSG2.COUNT;
      323     8131    2           CALL KUW$WRITE (KMSG2, J,J_SLUG);
      324     8132                                                /**/
      325     8133    2        CASE (10 /* KEY_MNKZAP2# */);
      326     8134                                                     /* call scheduler to kill
      327     8135                                                leftover users during zap */
      328     8136    2           J = 0;
      329     8137    2           CALL SSW$ZAP (J);
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:10   
      330     8138                                                /**/
      331     8139    2        CASE (11 /* KEY_MNKZAP3# */);
      332     8140                                                /* Final act in ZAP process... */
      333     8141    2           S_TUIS = OCA_SAVE_TUIS;
      334     8142    2           CALL SC_OCZAP;
      335     8143    2        CASE (13 /* KEY_DATE90# */);
      336     8144    2           CALL HFA$STOPCPUT;         /* TELL SLAVES TO PAUSE FOR TIME UPDATE*/
      337     8145    2           CALL SSS$CURTIME(J);
      338     8146    2           UMT_UNIQUE = J;
      339     8147    2           CALL SSS$FEPERA(J,TEMP_FEP_ERA);
      340     8148    2           S_BOOTERA = TEMP_FEP_ERA.ERA/3;
      341     8149    2           S_BOOTQUARTER = MOD(TEMP_FEP_ERA.ERA,3);
      342     8150    2           I=SSC_TMHD;
      343     8151    3           DO WHILE  (I ~= 0);
      344     8152    3                CALL SSS$UPDUTS(SSC_TMWU(I)); /* FIX WAKEUP UTS        */
      345     8153    3                I=SSC_TMLNK(I);
      346     8154    3              END;
      347     8155    2           I=S_HQ(%SS_SW);
      348     8156    3           DO WHILE (I ~= 0);
      349     8157    3                P$=ADDR(B$USRT$->B$USER(I));
      350     8158    3                CALL SSS$UPDUTS(P$->B$U.MISC); /* FIX WAKEUP UTS       */
      351     8159    3                I=P$->B$U.FL;
      352     8160    3              END;
      353     8161    2           I=S_RQH((%SS_NQW-%SS_CBF)/2);
      354     8162    3           DO WHILE (I ~= 0);
      355     8163    3                P$=ADDR(B$USRT$->B$USER(I));
      356     8164    3                IF P$->B$U.MISC ~= BITBIN('777777777777'O)
      357     8165    3                     AND P$->B$U.MISC ~= BITBIN('777777777776'O) THEN
      358     8166    3                     CALL SSS$UPDUTS(P$->B$U.MISC); /* FIX WAKEUP UTS    */
      359     8167    3                I=P$->B$U.SQ;
      360     8168    3              END;
      361     8169    3           DO I = 0 TO 2000;               /* GIVE THEM A CHANCE TO GET TO DIS */
      362     8170    3              END;
      363     8171    2           CALL HFA$STARTCPU;         /* START SLAVES. THEY WILL FIX THEIR TIME*/
      364     8172    2           ADDR(KL_TIME.UTS)->UTS_B = J;
      365     8173    2           KL_TIME.FNC = 17;
      366     8174    2           CALL KUB$WRITE(KL_TIME,SIZEC(KL_TIME),'HLPADMIN');
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:11   
      367     8175                                                /**/
      368     8176    2        CASE (ELSE);
      369     8177    2           ALTRETURN;
      370     8178    2   NRMERR: ;
      371     8179    2           CALL OCI$MK_WR (KMSG.CADDR,37 /* KMERR_MSG# */,1,'002'O,KMSG.KIN#);
      372     8180    2        END;
      373     8181    1   RTN: ;
      374     8182    1        RETURN;
      375     8183        /**/
      376     8184    1   END;
      377     8185        /**/
      378     8186        /**/
      379     8187        %EOD;

PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:12   
--  Include file information  --

   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   TM_DATA_M.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   JC_MACRO_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   JM$STRUCT.:E05TOU  is referenced.
   JG_EVID_C.:E05TOU  is referenced.
   JP_MACRO_C.:E05TOU  is referenced.
   OC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_CNTRLD_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_CNTRL_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   UM_CP6.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure OCA$KMISC.

   Procedure OCA$KMISC requires 634 words for executable code.
   Procedure OCA$KMISC requires 30 words of local(AUTO) storage.

PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:13   

 Object Unit name= OCA$KMISC                                  File name= OCA$KMISC.:E05TOU
 UTS= JUL 30 '97 03:54:57.80 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none     7      7  OCA$KMISC
    1  RoData even  UTS     12     14  OCA$KMISC
    2   Proc  even  none   634   1172  OCA$KMISC
    3  RoData even  none    37     45  OCA$KMISC

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        1  OCA$KMISC

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      1  FS_JEOK                            0      2  OCA_SAVE_TUIS
    0      3  OCA_DIE_COMMENT
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:14   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       7 OCI$MK_WR
 yes     yes           Std       2 UMT$IDT
 yes     yes           Std       3 UMT$LCLDATE
         yes           Std       1 SSW$ZAP
 yes     yes           Std       4 TMB$MCA
 yes     yes           Std       3 KUW$WRITE
 yes     yes           Std       4 OCZ$SID_UN
 yes     yes           Std       2 TMB$BUF_DEALLOC
         yes           Std       1 SSS$UPDUTS
         yes           Std       0 HFA$STARTCPU
         yes           Std       4 SSR$RUE
 yes     yes           Std       3 TMB$BUF_ALLOC
         yes           Std       0 HFA$STOPCPUT
 yes     yes           Std       3 KUB$WRITE
         yes           Std       1 SSS$SETBTIME
         yes           Std       0 SSS$UPDITIME
         yes           Std       2 SSS$FEPERA
         yes           Std       1 SSS$CURTIME
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:15   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_OCZAP                              SC_OCOPERRECOV                        B$USRT$
     S_CUIS                                S_MUIS                                S_TUIS
     S_HQ                                  S_RQH                                 S_BOOTERA
     S_BOOTQUARTER                         B_ZIP                                 HW_IMX
     B_MONINFO                             S_TIM_KEYIN                           SSC_TMWU
     SSC_TMLNK                             SSC_TMHD                         r    J_MBS
r    J_PRESCAN                        r    J_SLUG                                JM_BFIS
     B_MUAIS                               UMT_UNIQUE                            B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:16   


        1        1        /*M* OCA$KMISC Handle miscelaneous KEYINs in the monitor */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR,PLM=5,IND=5,CTI=5,SDI=5,MCL=10,CSI=0,ECI=0 */
        8        8        %SET LISTSUB='1'B;
        9        9                                                /**/
       10       10        /**/
       11       11        /**/
       12       12        OCA$KMISC: PROC (KMSG) ALTRET;

     12  2 000000   000000 700200 xent  OCA$KMISC    TSX0  ! X66_AUTO_1
         2 000001   000036 000001                    ZERO    30,1

       13       13        /**/
       14       14        /**/
       15       15        %INCLUDE B$USER;
       16      231        %B$USERREFS;
       17      235        %INCLUDE UM_CP6;
       18     1087        %INCLUDE B$JIT_C;
       19     1401        %B$JIT0 (STCLASS=BASED);
       20     1490        %A$JIT6X;
       21     1493        %INCLUDE OC_SUBS_C;
       22     2224        %INCLUDE SS_SCHED_C;
       23     2457        %INCLUDE SS_SCHED_R;
       24     2500        %INCLUDE OC_DATA_R;
       25     2509        %INCLUDE JP_MACRO_C;
       26     2664        %INCLUDE JG_EVID_C;
       27     2889        %INCLUDE JM$STRUCT;
       28     3634        %INCLUDE JG_GHOSTS_C;
       29     3724        %INCLUDE JC_MACRO_C;
       30     3838        %INCLUDE KL_MACRO_C;
       31     7190        %INCLUDE KL_AFCN_C;
       32     7291        %INCLUDE NI$TABLES;
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:17   
       33     7507        %INCLUDE TM_DATA_M;
       34     7609        %INCLUDE HF_DATA_R;
       35     7652        /**/
       36     7653        %VLR_MONINFO (FPTN=B_MONINFO,STCLASS=SYMREF);
       37     7671        /**/
       38     7672        /**/
       39     7673    1   DCL 1 KMSG ALIGNED,
       40     7674    1            2 KIN# UBIN(18) UNAL,
       41     7675    1            2 CADDR BIT(18) UNAL,
       42     7676    1            2 SYSID UBIN(18) UNAL,
       43     7677    1            2 MODE REDEF SYSID UBIN(18) UNAL,
       44     7678    1            2 NUMU UBIN(18) UNAL,
       45     7679    1            2 BCHFLG REDEF NUMU UBIN(18) UNAL,
       46     7680    1            2 WSN CHAR(8),
       47     7681    1            2 DTTIM REDEF WSN CHAR(8),
       48     7682    1            2 * CHAR(124) UNAL;            /* LEN = 140 BYTES */
       49     7683                                                /**/
       50     7684    1   DCL 1 KMSG2 REDEF KMSG,
       51     7685    1            2 KIN# UBIN HALF CALIGNED,
       52     7686    1            2 CADDR BIT(18) CALIGNED,
       53     7687    1            2 FIL1 UBIN BYTE CALIGNED,
       54     7688    1            2 FIL2 UBIN (27) CALIGNED,
       55     7689    1            2 COUNT UBIN BYTE CALIGNED,
       56     7690    1            2 ZAP_TXT CHAR(131) CALIGNED;
       57     7691                                                /**/
       58     7692    1   DCL 1 USR ALIGNED,
       59     7693    1            2 * UBIN(27) UNAL,
       60     7694    1            2 USER# UBIN(9) UNAL;
       61     7695        %KL_TIME (FPTN=KL_TIME,STCLASS=AUTO);
       62     7719    1   DCL EVENT UBIN WORD;
       63     7720    1   DCL I REDEF EVENT UBIN WORD;
       64     7721    1   DCL J UBIN WORD;
       65     7722    1   DCL  UTSBUF UBIN WORD;
       66     7723    1   DCL P$ PTR;
       67     7724    1   DCL S_TIM_KEYIN SBIN SYMREF;
       68     7725    1   DCL SSC_TMWU(0:9) UBIN SYMREF;
       69     7726    1   DCL SSC_TMLNK(0:9) UBIN SYMREF;
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:18   
       70     7727    1   DCL SSC_TMHD UBIN SYMREF;
       71     7728    1   DCL DATE CHAR(8);
       72     7729    1   DCL TIME CHAR(5);
       73     7730    1   DCL NOUSERSOK UBIN WORD STATIC ALIGNED INIT(1);
       74     7731    1   DCL BTML (0:4) UBIN BYTE CONSTANT UNAL INIT(LENGTHC(BTM.JEOK),LENGTHC(BTM.BFIS),
       75     7732    1                                              LENGTHC(BTM.MUIS),LENGTHC(BTM.CUIS),
       76     7733    1                                              LENGTHC(BTM.UNUSD));
       77     7734    1   DCL 1 BTM ALIGNED,
       78     7735    1            2 JEOK UBIN WORD,
       79     7736    1            2 MODE REDEF JEOK UBIN WORD,
       80     7737    1            2 SUBCODE REDEF JEOK UBIN WORD,
       81     7738    1            2 BFIS UBIN WORD,
       82     7739    1            2 UNUM REDEF BFIS UBIN WORD,
       83     7740    1            2 MUIS UBIN WORD,
       84     7741    1            2 CUIS UBIN WORD,
       85     7742    1            2 UNUSD UBIN WORD;
       86     7743    1   DCL 1 USRM REDEF BTM ALIGNED,
       87     7744    1            2 MC (0:4) UBIN WORD;
       88     7745    1   DCL BUF$ PTR;
       89     7746    1   DCL BUFX SBIN;
       90     7747    1   DCL DQH$ PTR;
       91     7748    1   DCL UTS_B UBIN BASED;
       92     7749        %NI$DQH;
       93     7772    1   DCL 1 TEMP_FEP_ERA,
       94     7773    1            2 ERA UBIN(6) UNAL,
       95     7774    1            2 FUTS UBIN(30) UNAL;
       96     7775    1   DCL FS_JEOK UBIN WORD STATIC SYMDEF INIT(0);
       97     7776    1   DCL OCA_SAVE_TUIS UBIN WORD STATIC SYMDEF INIT(0);
       98     7777    1   DCL OCA_DIE_COMMENT UBIN WORD STATIC SYMDEF INIT(0);
       99     7778        %JP_CITE (FPTN=JP_CITE,COD=JPEV_JPGO#,STCLASS=STATIC);
      100     7810        %JM_CITE (FPTN=JM_SMSG,COD=JMEV_STRT#,STCLASS=CONSTANT);
      101     7860        %JC_CITE (FPTN=JC_SUSR,TYP=PCMP,COD=JCEV_SUSR#,STCLASS=CONSTANT);
      102     7910    1   DCL J_MBS CHAR(8) SYMREF READONLY;
      103     7911    1   DCL J_PRESCAN CHAR(8) SYMREF READONLY;
      104     7912    1   DCL J_SLUG CHAR(8) SYMREF READONLY;
      105     7913    1   DCL JM_BFIS UBIN WORD SYMREF;
      106     7914    1   DCL B_MUAIS SBIN SYMREF;
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:19   
      107     7915    1   DCL UMT_UNIQUE UBIN WORD SYMREF;
      108     7916    1   DCL SSR$RUE ENTRY(4);
      109     7917    1   DCL SSS$CURTIME ENTRY(1);
      110     7918    1   DCL OCZ$SID_UN ENTRY(4) ALTRET;
      111     7919    1   DCL UMT$IDT ENTRY(2) ALTRET;
      112     7920    1   DCL UMT$LCLDATE ENTRY(3) ALTRET;
      113     7921    1   DCL SSS$SETBTIME ENTRY(1);
      114     7922    1   DCL SSS$UPDITIME ENTRY;
      115     7923    1   DCL SSS$UPDUTS ENTRY(1);
      116     7924    1   DCL SSS$CACHEBP ENTRY;
      117     7925    1   DCL SSS$CACHE ENTRY;
      118     7926    1   DCL SSS$UTS_L6  ENTRY(2);
      119     7927    1   DCL SSS$FEPERA  ENTRY(2);
      120     7928    1   DCL SSW$ZAP ENTRY(1);
      121     7929    1   DCL HFA$STOPCPUT ENTRY;
      122     7930    1   DCL HFA$STARTCPU ENTRY;
      123     7931    1   DCL OCI$MK_WR ENTRY(7);
      124     7932    1   DCL KUB$WRITE ENTRY(3) ALTRET;
      125     7933    1   DCL KIA$9TO8 ENTRY(3);
      126     7934    1   DCL SC_OCOPERRECOV ENTRY CONV(2,0);
      127     7935    1   DCL SC_OCZAP ENTRY CONV(2,0);
      128     7936    1   DCL KUW$WRITE ENTRY(3) ALTRET;
      129     7937    1   DCL TMB$MCA ENTRY(4) ALTRET;
      130     7938    1   DCL TMB$BUF_ALLOC ENTRY(3) ALTRET;
      131     7939    1   DCL TMB$BUF_DEALLOC ENTRY(2) ALTRET;
      132     7940        /**/
      133     7941        /**/
      134     7942    2        DO CASE (KMSG.KIN#);

   7942  2 000002   200003 470500                    LDP0    @KMSG,,AUTO
         2 000003   000000 220100                    LDX0    0,,PR0
         2 000004   000016 100003                    CMPX0   14,DU
         2 000005   000007 602010 2                  TNC     s:7942+5,X0
         2 000006   001153 710000 2                  TRA     s:8177
         2 000007   001153 710000 2                  TRA     s:8177
         2 000010   000050 710000 2                  TRA     s:7952
         2 000011   000152 710000 2                  TRA     s:7975
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:20   
         2 000012   000152 710000 2                  TRA     s:7975
         2 000013   000222 710000 2                  TRA     s:7981
         2 000014   000222 710000 2                  TRA     s:7981
         2 000015   000702 710000 2                  TRA     s:8102
         2 000016   000620 710000 2                  TRA     s:8051
         2 000017   000510 710000 2                  TRA     s:8029
         2 000020   000732 710000 2                  TRA     s:8123
         2 000021   000761 710000 2                  TRA     s:8136
         2 000022   000771 710000 2                  TRA     s:8141
         2 000023   000025 710000 2                  TRA     SIM_NOUSERS
         2 000024   000776 710000 2                  TRA     s:8144

      135     7943    2        CASE (12 /* KEY_NOUSERS# */);

   7938  2 000025                       SIM_NOUSERS  null
      136     7944    2   SIM_NOUSERS:;
      137     7945    3           IF NOUSERSOK ~= 0 THEN DO;

   7945  2 000025   000000 235000 0                  LDA     NOUSERSOK
         2 000026   000033 600000 2                  TZE     s:7949

      138     7946    3                B_MONINFO.NOUSERS#='1'B;

   7946  2 000027   400000 236003                    LDQ     -131072,DU
         2 000030   000010 256000 xsym               ORSQ    B_MONINFO+8

      139     7947    3                BTM.SUBCODE=0;

   7947  2 000031   200017 450100                    STZ     BTM,,AUTO

      140     7948    3              END;

   7948  2 000032   000035 710000 2                  TRA     s:7950

      141     7949    2           ELSE BTM.SUBCODE=2;

   7949  2 000033   000002 236007                    LDQ     2,DL
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:21   
         2 000034   200017 756100                    STQ     BTM,,AUTO

      142     7950    2           CALL OCI$MK_WR ('200000'O /* M_SYS  */,99 /* NOUSERS_MSG# */,LENGTHC(BTML),
              7950                    BTML,BTM);

   7950  2 000035   200017 630500                    EPPR0   BTM,,AUTO
         2 000036   200034 450500                    STP0    TEMP_FEP_ERA+5,,AUTO
         2 000037   000002 237000 3                  LDAQ    2
         2 000040   200032 757100                    STAQ    TEMP_FEP_ERA+3,,AUTO
         2 000041   000004 237000 3                  LDAQ    4
         2 000042   200030 757100                    STAQ    TEMP_FEP_ERA+1,,AUTO
         2 000043   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000044   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 000045   000000 701000 xent               TSX1    OCI$MK_WR
         2 000046   000000 011000                    NOP     0
         2 000047   001171 710000 2                  TRA     RTN

      143     7951    2        CASE (1 /* KEY_ON# */);

      144     7952    2           IF KMSG.NUMU>B_MUAIS THEN GOTO NRMERR;

   7952  2 000050   000001 236100                    LDQ     1,,PR0
         2 000051   777777 376007                    ANQ     -1,DL
         2 000052   000000 116000 xsym               CMPQ    B_MUAIS
         2 000053   001154 605400 2                  TPNZ    NRMERR

      145     7953    2           ELSE IF KMSG.NUMU > 0

   7953  2 000054   000001 721100                    LXL1    1,,PR0
         2 000055   000102 600000 2                  TZE     s:7962

      146     7954    2                THEN IF B_MONINFO.NOUSERS#

   7954  2 000056   000010 234000 xsym               SZN     B_MONINFO+8
         2 000057   000102 605000 2                  TPL     s:7962

      147     7955    3                     THEN DO;
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:22   

      148     7956    3                          B_MONINFO.NOUSERS#='0'B;

   7956  2 000060   000031 236000 xsym               LDQ     B_VECTNIL+25
         2 000061   000010 356000 xsym               ANSQ    B_MONINFO+8

      149     7957    3                          CALL KUW$WRITE (JC_SUSR,SIZEC(JC_SUSR),J_SLUG);

   7957  2 000062   000006 630400 3                  EPPR0   6
         2 000063   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000064   000000 701000 xent               TSX1    KUW$WRITE
         2 000065   000000 011000                    NOP     0

      150     7958    3                          BTM.SUBCODE=1;

   7958  2 000066   000001 235007                    LDA     1,DL
         2 000067   200017 755100                    STA     BTM,,AUTO

      151     7959    3                          CALL OCI$MK_WR ('200000'O /* M_SYS */,99 /* NOUSERS_MSG# */,
              7959                                   LENGTHC(BTML),BTML,BTM);

   7959  2 000070   200017 630500                    EPPR0   BTM,,AUTO
         2 000071   200034 450500                    STP0    TEMP_FEP_ERA+5,,AUTO
         2 000072   000002 237000 3                  LDAQ    2
         2 000073   200032 757100                    STAQ    TEMP_FEP_ERA+3,,AUTO
         2 000074   000004 237000 3                  LDAQ    4
         2 000075   200030 757100                    STAQ    TEMP_FEP_ERA+1,,AUTO
         2 000076   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000077   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 000100   000000 701000 xent               TSX1    OCI$MK_WR
         2 000101   000000 011000                    NOP     0

      152     7960    3                        END;

      153     7961        /**/
      154     7962    2           IF KMSG.MODE=0 THEN S_TUIS=KMSG.NUMU;

PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:23   
   7962  2 000102   200003 470500                    LDP0    @KMSG,,AUTO
         2 000103   000001 220100                    LDX0    1,,PR0
         2 000104   000111 601000 2                  TNZ     s:7963

   7962  2 000105   000001 236100                    LDQ     1,,PR0
         2 000106   777777 376007                    ANQ     -1,DL
         2 000107   000000 756000 xsym               STQ     S_TUIS
         2 000110   000114 710000 2                  TRA     s:7964

      155     7963    2           ELSE S_MUIS(KMSG.MODE)=KMSG.NUMU;

   7963  2 000111   000001 236100                    LDQ     1,,PR0
         2 000112   777777 376007                    ANQ     -1,DL
         2 000113   000000 756010 xsym               STQ     S_MUIS,X0

      156     7964    3           IF KMSG.MODE=%M_BATCH# THEN DO;

   7964  2 000114   000001 220100                    LDX0    1,,PR0
         2 000115   000001 100003                    CMPX0   1,DU
         2 000116   000131 601000 2                  TNZ     s:7970

      157     7965    3                IF KMSG.NUMU~=0 THEN CALL KUW$WRITE (JM_SMSG,LENGTHC(JM_SMSG),J_MBS);

   7965  2 000117   000001 721100                    LXL1    1,,PR0
         2 000120   000125 600000 2                  TZE     s:7966

   7965  2 000121   000012 630400 3                  EPPR0   10
         2 000122   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000123   000000 701000 xent               TSX1    KUW$WRITE
         2 000124   000000 011000                    NOP     0

      158     7966    3                KMSG.CADDR='200000'O /* M_SYS  */;

   7966  2 000125   200000 220003                    LDX0    65536,DU
         2 000126   200003 470500                    LDP0    @KMSG,,AUTO
         2 000127   000000 440100                    SXL0    0,,PR0

PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:24   
      159     7967    3                GOTO BTMSG;

   7967  2 000130   000633 710000 2                  TRA     BTMSG

      160     7968    3              END;
      161     7969    3           ELSE DO;

      162     7970    3                BTM.MODE=KMSG.MODE;

   7970  2 000131   000001 236100                    LDQ     1,,PR0
         2 000132   000022 772000                    QRL     18
         2 000133   200017 756100                    STQ     BTM,,AUTO

      163     7971    3                BTM.UNUM=KMSG.NUMU;

   7971  2 000134   000001 236100                    LDQ     1,,PR0
         2 000135   777777 376007                    ANQ     -1,DL
         2 000136   200020 756100                    STQ     BTM+1,,AUTO

      164     7972    3                CALL OCI$MK_WR ('200000'O /* M_SYS  */,138 /* USERS_MSG# */,LENGTHC(
              7972                         BTML),BTML,BTM);

   7972  2 000137   200017 631500                    EPPR1   BTM,,AUTO
         2 000140   200034 451500                    STP1    TEMP_FEP_ERA+5,,AUTO
         2 000141   000002 237000 3                  LDAQ    2
         2 000142   200032 757100                    STAQ    TEMP_FEP_ERA+3,,AUTO
         2 000143   000016 237000 3                  LDAQ    14
         2 000144   200030 757100                    STAQ    TEMP_FEP_ERA+1,,AUTO
         2 000145   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000146   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 000147   000000 701000 xent               TSX1    OCI$MK_WR
         2 000150   000000 011000                    NOP     0

      165     7973    3              END;

   7973  2 000151   001171 710000 2                  TRA     RTN

PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:25   
      166     7974    2        CASE (2 /* KEY_X# */,3 /* KEY_E# */);

      167     7975    2           IF KMSG.SYSID<=15/*JG_MING#   */ AND B_MONINFO.LADCFLG#=0 THEN GOTO NRMERR;

   7975  2 000152   000001 221100                    LDX1    1,,PR0
         2 000153   000020 101003                    CMPX1   16,DU
         2 000154   000157 603000 2                  TRC     s:7976
         2 000155   000005 235000 xsym               LDA     B_MONINFO+5
         2 000156   001154 600000 2                  TZE     NRMERR

      168     7976    2           CALL OCZ$SID_UN (KMSG.SYSID,USR,KMSG.CADDR,KMSG.WSN) ALTRET (RTN);

   7976  2 000157   200003 236100                    LDQ     @KMSG,,AUTO
         2 000160   000002 036003                    ADLQ    2,DU
         2 000161   200033 756100                    STQ     TEMP_FEP_ERA+4,,AUTO
         2 000162   200003 236100                    LDQ     @KMSG,,AUTO
         2 000163   400000 036007                    ADLQ    -131072,DL
         2 000164   200032 756100                    STQ     TEMP_FEP_ERA+3,,AUTO
         2 000165   200004 631500                    EPPR1   USR,,AUTO
         2 000166   200031 451500                    STP1    TEMP_FEP_ERA+2,,AUTO
         2 000167   200003 236100                    LDQ     @KMSG,,AUTO
         2 000170   000001 036003                    ADLQ    1,DU
         2 000171   200030 756100                    STQ     TEMP_FEP_ERA+1,,AUTO
         2 000172   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000173   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 000174   000000 701000 xent               TSX1    OCZ$SID_UN
         2 000175   001171 702000 2                  TSX2    RTN

      169     7977    2           IF KMSG.KIN#=3 /* KEY_E# */ THEN EVENT=%SS_ERR;

   7977  2 000176   200003 470500                    LDP0    @KMSG,,AUTO
         2 000177   000000 220100                    LDX0    0,,PR0
         2 000200   000003 100003                    CMPX0   3,DU
         2 000201   000205 601000 2                  TNZ     s:7978

   7977  2 000202   000016 235007                    LDA     14,DL
         2 000203   200007 755100                    STA     EVENT,,AUTO
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:26   
         2 000204   000207 710000 2                  TRA     s:7979

      170     7978    2           ELSE EVENT=%SS_ABRT;

   7978  2 000205   000020 235007                    LDA     16,DL
         2 000206   200007 755100                    STA     EVENT,,AUTO

      171     7979    2           CALL SSR$RUE (EVENT,USR.USER#);

   7979  2 000207   200032 452500                    STP2    TEMP_FEP_ERA+3,,AUTO
         2 000210   200032 236100                    LDQ     TEMP_FEP_ERA+3,,AUTO
         2 000211   000020 036000 3                  ADLQ    16
         2 000212   200031 756100                    STQ     TEMP_FEP_ERA+2,,AUTO
         2 000213   200007 631500                    EPPR1   EVENT,,AUTO
         2 000214   200030 451500                    STP1    TEMP_FEP_ERA+1,,AUTO
         2 000215   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000216   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000217   000000 701000 xent               TSX1    SSR$RUE
         2 000220   000000 011000                    NOP     0
         2 000221   001171 710000 2                  TRA     RTN

      172     7980    2        CASE (5 /* KEY_TIME# */,4 /* KEY_DATE# */);

      173     7981    2           S_TIM_KEYIN = 1;

   7981  2 000222   000001 235007                    LDA     1,DL
         2 000223   000000 755000 xsym               STA     S_TIM_KEYIN

      174     7982    3           DO I = 0 TO 3000;

   7982  2 000224   200007 450100                    STZ     EVENT,,AUTO

      175     7983    3              END;

   7983  2 000225   200007 235100                    LDA     EVENT,,AUTO
         2 000226   000001 035007                    ADLA    1,DL
         2 000227   200007 755100                    STA     EVENT,,AUTO
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:27   
         2 000230   005671 115007                    CMPA    3001,DL
         2 000231   000225 602000 2                  TNC     s:7983

      176     7984    2           CALL UMT$IDT (DATE,TIME);

   7984  2 000232   200015 630500                    EPPR0   TIME,,AUTO
         2 000233   200031 450500                    STP0    TEMP_FEP_ERA+2,,AUTO
         2 000234   200013 631500                    EPPR1   DATE,,AUTO
         2 000235   200030 451500                    STP1    TEMP_FEP_ERA+1,,AUTO
         2 000236   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000237   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000240   000000 701000 xent               TSX1    UMT$IDT
         2 000241   000000 011000                    NOP     0

      177     7985    2           IF KMSG.KIN#=5 /* KEY_TIME# */ THEN TIME=KMSG.DTTIM;

   7985  2 000242   200003 470500                    LDP0    @KMSG,,AUTO
         2 000243   000000 220100                    LDX0    0,,PR0
         2 000244   000005 100003                    CMPX0   5,DU
         2 000245   000252 601000 2                  TNZ     s:7986

   7985  2 000246   040100 100500                    MLR     fill='040'O
         2 000247   000002 000005                    ADSC9   2,,PR0                   cn=0,n=5
         2 000250   200015 000005                    ADSC9   TIME,,AUTO               cn=0,n=5
         2 000251   000255 710000 2                  TRA     s:7987

      178     7986    2           ELSE DATE=KMSG.DTTIM;

   7986  2 000252   040100 100500                    MLR     fill='040'O
         2 000253   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
         2 000254   200013 000010                    ADSC9   DATE,,AUTO               cn=0,n=8

      179     7987    2           CALL UMT$LCLDATE(J,DATE,TIME) ALTRET(NRMERR); /* NEW UTS   */

   7987  2 000255   200015 631500                    EPPR1   TIME,,AUTO
         2 000256   200032 451500                    STP1    TEMP_FEP_ERA+3,,AUTO
         2 000257   200013 633500                    EPPR3   DATE,,AUTO
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:28   
         2 000260   200031 453500                    STP3    TEMP_FEP_ERA+2,,AUTO
         2 000261   200010 634500                    EPPR4   J,,AUTO
         2 000262   200030 454500                    STP4    TEMP_FEP_ERA+1,,AUTO
         2 000263   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000264   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000265   000000 701000 xent               TSX1    UMT$LCLDATE
         2 000266   001154 702000 2                  TSX2    NRMERR

      180     7988    3           IF HW_IMX THEN DO;

   7988  2 000267   000000 234000 xsym               SZN     HW_IMX
         2 000270   000327 605000 2                  TPL     SETTIME

      181     7989    3                CALL TMB$BUF_ALLOC (BUF$,BUFX,DQH$) ALTRET (SETTIME);

   7989  2 000271   200026 630500                    EPPR0   DQH$,,AUTO
         2 000272   200032 450500                    STP0    TEMP_FEP_ERA+3,,AUTO
         2 000273   200025 631500                    EPPR1   BUFX,,AUTO
         2 000274   200031 451500                    STP1    TEMP_FEP_ERA+2,,AUTO
         2 000275   200024 633500                    EPPR3   BUF$,,AUTO
         2 000276   200030 453500                    STP3    TEMP_FEP_ERA+1,,AUTO
         2 000277   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000300   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000301   000000 701000 xent               TSX1    TMB$BUF_ALLOC
         2 000302   000327 702000 2                  TSX2    SETTIME

      182     7990    3                BUF$ -> UTS_B = J;

   7990  2 000303   200024 470500                    LDP0    BUF$,,AUTO
         2 000304   200010 235100                    LDA     J,,AUTO
         2 000305   000000 755100                    STA     0,,PR0

      183     7991    3                CALL TMB$MCA (DQH$->NI$DQH,4,BUFX);

   7991  2 000306   200025 630500                    EPPR0   BUFX,,AUTO
         2 000307   200032 450500                    STP0    TEMP_FEP_ERA+3,,AUTO
         2 000310   000021 236000 3                  LDQ     17
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:29   
         2 000311   200026 235100                    LDA     DQH$,,AUTO
         2 000312   200030 757100                    STAQ    TEMP_FEP_ERA+1,,AUTO
         2 000313   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000314   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000315   000000 701000 xent               TSX1    TMB$MCA
         2 000316   000000 011000                    NOP     0

      184     7992    3                CALL TMB$BUF_DEALLOC (BUF$,BUFX);

   7992  2 000317   200025 630500                    EPPR0   BUFX,,AUTO
         2 000320   200031 450500                    STP0    TEMP_FEP_ERA+2,,AUTO
         2 000321   200024 631500                    EPPR1   BUF$,,AUTO
         2 000322   200030 451500                    STP1    TEMP_FEP_ERA+1,,AUTO
         2 000323   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000324   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000325   000000 701000 xent               TSX1    TMB$BUF_DEALLOC
         2 000326   000000 011000                    NOP     0

      185     7993    3              END;

   7988  2 000327                       SETTIME      null
      186     7994    2   SETTIME: ;
      187     7995    2           CALL HFA$STOPCPUT;         /* TELL SLAVES TO PAUSE FOR TIME UPDATE*/

   7995  2 000327   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000330   000000 701000 xent               TSX1    HFA$STOPCPUT
         2 000331   000000 011000                    NOP     0

      188     7996    2           CALL SSS$SETBTIME(J);           /* SET CLOCK                       */

   7996  2 000332   200010 630500                    EPPR0   J,,AUTO
         2 000333   200030 450500                    STP0    TEMP_FEP_ERA+1,,AUTO
         2 000334   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000335   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000336   000000 701000 xent               TSX1    SSS$SETBTIME
         2 000337   000000 011000                    NOP     0

PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:30   
      189     7997    2           CALL SSS$UPDITIME;              /* FIX BEGINNING OF CURRENT INTERVAL*/

   7997  2 000340   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000341   000000 701000 xent               TSX1    SSS$UPDITIME
         2 000342   000000 011000                    NOP     0

      190     7998    2           UMT_UNIQUE = J;

   7998  2 000343   200010 235100                    LDA     J,,AUTO
         2 000344   000000 755000 xsym               STA     UMT_UNIQUE

      191     7999    2           CALL SSS$FEPERA(J,TEMP_FEP_ERA);

   7999  2 000345   200027 630500                    EPPR0   TEMP_FEP_ERA,,AUTO
         2 000346   200031 450500                    STP0    TEMP_FEP_ERA+2,,AUTO
         2 000347   200010 631500                    EPPR1   J,,AUTO
         2 000350   200030 451500                    STP1    TEMP_FEP_ERA+1,,AUTO
         2 000351   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000352   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000353   000000 701000 xent               TSX1    SSS$FEPERA
         2 000354   000000 011000                    NOP     0

      192     8000    2           S_BOOTERA = TEMP_FEP_ERA.ERA/3;

   8000  2 000355   200027 236100                    LDQ     TEMP_FEP_ERA,,AUTO
         2 000356   000036 772000                    QRL     30
         2 000357   000003 506007                    DIV     3,DL
         2 000360   000000 756000 xsym               STQ     S_BOOTERA

      193     8001    2           S_BOOTQUARTER = MOD(TEMP_FEP_ERA.ERA,3);

   8001  2 000361   200027 236100                    LDQ     TEMP_FEP_ERA,,AUTO
         2 000362   000036 772000                    QRL     30
         2 000363   000003 506007                    DIV     3,DL
         2 000364   000000 755000 xsym               STA     S_BOOTQUARTER

      194     8002    2           I=SSC_TMHD;
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:31   

   8002  2 000365   000000 236000 xsym               LDQ     SSC_TMHD
         2 000366   200007 756100                    STQ     EVENT,,AUTO

      195     8003    3           DO WHILE  (I ~= 0);

   8003  2 000367   000403 600000 2                  TZE     s:8007

      196     8004    3                CALL SSS$UPDUTS(SSC_TMWU(I)); /* FIX WAKEUP UTS        */

   8004  2 000370   200007 720100                    LXL0    EVENT,,AUTO
         2 000371   000000 630410 xsym               EPPR0   SSC_TMWU,X0
         2 000372   200030 450500                    STP0    TEMP_FEP_ERA+1,,AUTO
         2 000373   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000374   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000375   000000 701000 xent               TSX1    SSS$UPDUTS
         2 000376   000000 011000                    NOP     0

      197     8005    3                I=SSC_TMLNK(I);

   8005  2 000377   200007 720100                    LXL0    EVENT,,AUTO
         2 000400   000000 235010 xsym               LDA     SSC_TMLNK,X0
         2 000401   200007 755100                    STA     EVENT,,AUTO

      198     8006    3              END;

   8006  2 000402   000370 601000 2                  TNZ     s:8004

      199     8007    2           I=S_HQ(%SS_SW);

   8007  2 000403   000021 235000 xsym               LDA     S_HQ+17
         2 000404   200007 755100                    STA     EVENT,,AUTO

      200     8008    3           DO WHILE (I ~= 0);

   8008  2 000405   000424 600000 2                  TZE     s:8013

PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:32   
      201     8009    3                P$=ADDR(B$USRT$->B$USER(I));

   8009  2 000406   200007 236100                    LDQ     EVENT,,AUTO
         2 000407   000026 736000                    QLS     22
         2 000410   000000 036000 xsym               ADLQ    B$USRT$
         2 000411   200012 756100                    STQ     P$,,AUTO

      202     8010    3                CALL SSS$UPDUTS(P$->B$U.MISC); /* FIX WAKEUP UTS       */

   8010  2 000412   000017 036003                    ADLQ    15,DU
         2 000413   200030 756100                    STQ     TEMP_FEP_ERA+1,,AUTO
         2 000414   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000415   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000416   000000 701000 xent               TSX1    SSS$UPDUTS
         2 000417   000000 011000                    NOP     0

      203     8011    3                I=P$->B$U.FL;

   8011  2 000420   200012 470500                    LDP0    P$,,AUTO
         2 000421   000002 235100                    LDA     2,,PR0
         2 000422   200007 755100                    STA     EVENT,,AUTO

      204     8012    3              END;

   8012  2 000423   000406 601000 2                  TNZ     s:8009

      205     8013    2           I=S_RQH((%SS_NQW-%SS_CBF)/2);

   8013  2 000424   000002 236000 xsym               LDQ     S_RQH+2
         2 000425   200007 756100                    STQ     EVENT,,AUTO

      206     8014    3           DO WHILE (I ~= 0);

   8014  2 000426   000456 600000 2                  TZE     s:8021

      207     8015    3                P$=ADDR(B$USRT$->B$USER(I));

PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:33   
   8015  2 000427   200007 236100                    LDQ     EVENT,,AUTO
         2 000430   000026 736000                    QLS     22
         2 000431   000000 036000 xsym               ADLQ    B$USRT$
         2 000432   200012 756100                    STQ     P$,,AUTO

      208     8016    3                IF P$->B$U.MISC ~= BITBIN('777777777777'O)

   8016  2 000433   200012 470500                    LDP0    P$,,AUTO
         2 000434   000017 236100                    LDQ     15,,PR0
         2 000435   000027 116000 xsym               CMPQ    B_VECTNIL+23
         2 000436   000450 600000 2                  TZE     s:8019
         2 000437   000011 116000 1                  CMPQ    JC_SUSR+2
         2 000440   000450 600000 2                  TZE     s:8019

      209     8017    3                     AND P$->B$U.MISC ~= BITBIN('777777777776'O) THEN
      210     8018    3                     CALL SSS$UPDUTS(P$->B$U.MISC); /* FIX WAKEUP UTS    */

   8018  2 000441   200012 236100                    LDQ     P$,,AUTO
         2 000442   000017 036003                    ADLQ    15,DU
         2 000443   200030 756100                    STQ     TEMP_FEP_ERA+1,,AUTO
         2 000444   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000445   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000446   000000 701000 xent               TSX1    SSS$UPDUTS
         2 000447   000000 011000                    NOP     0

      211     8019    3                I=P$->B$U.SQ;

   8019  2 000450   200012 470500                    LDP0    P$,,AUTO
         2 000451   000010 236100                    LDQ     8,,PR0
         2 000452   000011 772000                    QRL     9
         2 000453   000777 376007                    ANQ     511,DL
         2 000454   200007 756100                    STQ     EVENT,,AUTO

      212     8020    3              END;

   8020  2 000455   000427 601000 2                  TNZ     s:8015

PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:34   
      213     8021    3           DO I = 0 TO 2000;               /* GIVE THEM A CHANCE TO GET TO DIS */

   8021  2 000456   200007 450100                    STZ     EVENT,,AUTO

      214     8022    3              END;

   8022  2 000457   200007 235100                    LDA     EVENT,,AUTO
         2 000460   000001 035007                    ADLA    1,DL
         2 000461   200007 755100                    STA     EVENT,,AUTO
         2 000462   003721 115007                    CMPA    2001,DL
         2 000463   000457 602000 2                  TNC     s:8022

      215     8023    2           CALL HFA$STARTCPU;         /* START SLAVES. THEY WILL FIX THEIR TIME*/

   8023  2 000464   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000465   000000 701000 xent               TSX1    HFA$STARTCPU
         2 000466   000000 011000                    NOP     0

      216     8024    2           ADDR(KL_TIME.UTS)->UTS_B = J;

   8024  2 000467   000100 100500                    MLR     fill='000'O
         2 000470   200010 000004                    ADSC9   J,,AUTO                  cn=0,n=4
         2 000471   200005 200004                    ADSC9   KL_TIME,,AUTO            cn=1,n=4

      217     8025    2           KL_TIME.FNC = 17;

   8025  2 000472   021000 236003                    LDQ     8704,DU
         2 000473   200005 552140                    STBQ    KL_TIME,'40'O,AUTO

      218     8026    2           CALL KUB$WRITE(KL_TIME,SIZEC(KL_TIME),'HLPADMIN');

   8026  2 000474   000022 236000 3                  LDQ     18
         2 000475   200032 756100                    STQ     TEMP_FEP_ERA+3,,AUTO
         2 000476   000007 236000 3                  LDQ     7
         2 000477   200031 756100                    STQ     TEMP_FEP_ERA+2,,AUTO
         2 000500   200005 630500                    EPPR0   KL_TIME,,AUTO
         2 000501   200030 450500                    STP0    TEMP_FEP_ERA+1,,AUTO
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:35   
         2 000502   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000503   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000504   000000 701000 xent               TSX1    KUB$WRITE
         2 000505   000000 011000                    NOP     0

      219     8027    2           S_TIM_KEYIN = 0;

   8027  2 000506   000000 450000 xsym               STZ     S_TIM_KEYIN
         2 000507   001171 710000 2                  TRA     RTN

      220     8028    2        CASE (8 /* KEY_USRS# */);

      221     8029    2           USRM.MC(0)=S_TUIS;

   8029  2 000510   000000 235000 xsym               LDA     S_TUIS
         2 000511   200017 755100                    STA     BTM,,AUTO

      222     8030    3           DO I=1 TO 4;

   8030  2 000512   000001 236007                    LDQ     1,DL
         2 000513   200007 756100                    STQ     EVENT,,AUTO

      223     8031    3                USRM.MC(I)=S_MUIS(I);

   8031  2 000514   200007 720100                    LXL0    EVENT,,AUTO
         2 000515   000000 235010 xsym               LDA     S_MUIS,X0
         2 000516   200017 755110                    STA     BTM,X0,AUTO

      224     8032    3              END;

   8032  2 000517   200007 235100                    LDA     EVENT,,AUTO
         2 000520   000001 035007                    ADLA    1,DL
         2 000521   200007 755100                    STA     EVENT,,AUTO
         2 000522   000005 115007                    CMPA    5,DL
         2 000523   000514 602000 2                  TNC     s:8031

      225     8033    2           CALL OCI$MK_WR (KMSG.CADDR,136 /* ALLOU_MSG# */,LENGTHC(BTML),BTML,USRM);
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:36   

   8033  2 000524   200017 630500                    EPPR0   BTM,,AUTO
         2 000525   200034 450500                    STP0    TEMP_FEP_ERA+5,,AUTO
         2 000526   000002 237000 3                  LDAQ    2
         2 000527   200032 757100                    STAQ    TEMP_FEP_ERA+3,,AUTO
         2 000530   000024 236000 3                  LDQ     20
         2 000531   200031 756100                    STQ     TEMP_FEP_ERA+2,,AUTO
         2 000532   200003 236100                    LDQ     @KMSG,,AUTO
         2 000533   400000 036007                    ADLQ    -131072,DL
         2 000534   200030 756100                    STQ     TEMP_FEP_ERA+1,,AUTO
         2 000535   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000536   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 000537   000000 701000 xent               TSX1    OCI$MK_WR
         2 000540   000000 011000                    NOP     0

      226     8034    2           J=0;

   8034  2 000541   200010 450100                    STZ     J,,AUTO

      227     8035    3           DO I=1 TO 4;

   8035  2 000542   000001 235007                    LDA     1,DL
         2 000543   200007 755100                    STA     EVENT,,AUTO

      228     8036    3                USRM.MC(I)=S_CUIS(I);

   8036  2 000544   200007 720100                    LXL0    EVENT,,AUTO
         2 000545   000000 235010 xsym               LDA     S_CUIS,X0
         2 000546   200017 755110                    STA     BTM,X0,AUTO

      229     8037    3                J=J+S_CUIS(I);

   8037  2 000547   200007 720100                    LXL0    EVENT,,AUTO
         2 000550   200010 236100                    LDQ     J,,AUTO
         2 000551   000000 036010 xsym               ADLQ    S_CUIS,X0
         2 000552   200010 756100                    STQ     J,,AUTO

PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:37   
      230     8038    3              END;

   8038  2 000553   200007 235100                    LDA     EVENT,,AUTO
         2 000554   000001 035007                    ADLA    1,DL
         2 000555   200007 755100                    STA     EVENT,,AUTO
         2 000556   000005 115007                    CMPA    5,DL
         2 000557   000544 602000 2                  TNC     s:8036

      231     8039    2           USRM.MC(0)=J;

   8039  2 000560   200017 756100                    STQ     BTM,,AUTO

      232     8040    2           CALL OCI$MK_WR (KMSG.CADDR,137 /* RUNU_MSG# */,LENGTHC(BTML),BTML,USRM);

   8040  2 000561   200017 630500                    EPPR0   BTM,,AUTO
         2 000562   200034 450500                    STP0    TEMP_FEP_ERA+5,,AUTO
         2 000563   000002 237000 3                  LDAQ    2
         2 000564   200032 757100                    STAQ    TEMP_FEP_ERA+3,,AUTO
         2 000565   000026 236000 3                  LDQ     22
         2 000566   200031 756100                    STQ     TEMP_FEP_ERA+2,,AUTO
         2 000567   200003 236100                    LDQ     @KMSG,,AUTO
         2 000570   400000 036007                    ADLQ    -131072,DL
         2 000571   200030 756100                    STQ     TEMP_FEP_ERA+1,,AUTO
         2 000572   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000573   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 000574   000000 701000 xent               TSX1    OCI$MK_WR
         2 000575   000000 011000                    NOP     0

      233     8041    3           IF B_MONINFO.NOUSERS# THEN DO;

   8041  2 000576   000010 234000 xsym               SZN     B_MONINFO+8
         2 000577   001171 605000 2                  TPL     RTN

      234     8042    3                BTM.SUBCODE=3;

   8042  2 000600   000003 235007                    LDA     3,DL
         2 000601   200017 755100                    STA     BTM,,AUTO
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:38   

      235     8043    3               CALL OCI$MK_WR (KMSG.CADDR,99 /* NOUSERS_MSG# */,LENGTHC(BTML),BTML,BTM
              8043                         );

   8043  2 000602   200017 630500                    EPPR0   BTM,,AUTO
         2 000603   200034 450500                    STP0    TEMP_FEP_ERA+5,,AUTO
         2 000604   000002 237000 3                  LDAQ    2
         2 000605   200032 757100                    STAQ    TEMP_FEP_ERA+3,,AUTO
         2 000606   000005 236000 3                  LDQ     5
         2 000607   200031 756100                    STQ     TEMP_FEP_ERA+2,,AUTO
         2 000610   200003 236100                    LDQ     @KMSG,,AUTO
         2 000611   400000 036007                    ADLQ    -131072,DL
         2 000612   200030 756100                    STQ     TEMP_FEP_ERA+1,,AUTO
         2 000613   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000614   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 000615   000000 701000 xent               TSX1    OCI$MK_WR
         2 000616   000000 011000                    NOP     0

      236     8044    3              END;

   8044  2 000617   001171 710000 2                  TRA     RTN

      237     8045                          /*    The '!BATCH keyin' comes from
      238     8046                           *    KEYIN (codes 0,1,2) and
      239     8047                           *    from SLUG during startup
      240     8048                           *    (codes 3,4,5,6).
      241     8049                           */
      242     8050    2        CASE (7 /* KEY_BATCH# */);

      243     8051    3           DO CASE (KMSG.BCHFLG);

   8051  2 000620   000001 721100                    LXL1    1,,PR0
         2 000621   000007 101003                    CMPX1   7,DU
         2 000622   000624 602011 2                  TNC     s:8051+4,X1
         2 000623   001171 710000 2                  TRA     RTN
         2 000624   000633 710000 2                  TRA     BTMSG
         2 000625   000670 710000 2                  TRA     s:8062
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:39   
         2 000626   000672 710000 2                  TRA     s:8065
         2 000627   000675 710000 2                  TRA     s:8072
         2 000630   000676 710000 2                  TRA     s:8085
         2 000631   000701 710000 2                  TRA     s:8097
         2 000632   000677 710000 2                  TRA     s:8094

      244     8052    3           CASE (0) /* !BATCH */;

   8042  2 000633                       BTMSG        null
      245     8053    3   BTMSG:     ;
      246     8054    3              JP_CITE.GO=FS_JEOK;

   8054  2 000633   000001 720000 0                  LXL0    FS_JEOK
         2 000634   000004 440000 0                  SXL0    JP_CITE

      247     8055    3              CALL KUW$WRITE (JP_CITE,SIZEC(JP_CITE),J_PRESCAN);

   8055  2 000635   000030 630400 3                  EPPR0   24
         2 000636   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000637   000000 701000 xent               TSX1    KUW$WRITE
         2 000640   000000 011000                    NOP     0

      248     8056    3              BTM.JEOK=FS_JEOK;

   8056  2 000641   000001 235000 0                  LDA     FS_JEOK
         2 000642   200017 755100                    STA     BTM,,AUTO

      249     8057    3              BTM.MUIS=S_MUIS(%M_BATCH#);

   8057  2 000643   000001 236000 xsym               LDQ     S_MUIS+1
         2 000644   200021 756100                    STQ     BTM+2,,AUTO

      250     8058    3              BTM.CUIS=S_CUIS(%M_BATCH#);

   8058  2 000645   000001 235000 xsym               LDA     S_CUIS+1
         2 000646   200022 755100                    STA     BTM+3,,AUTO

PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:40   
      251     8059    3              BTM.BFIS=JM_BFIS-BTM.CUIS;

   8059  2 000647   000000 236000 xsym               LDQ     JM_BFIS
         2 000650   200022 136100                    SBLQ    BTM+3,,AUTO
         2 000651   200020 756100                    STQ     BTM+1,,AUTO

      252     8060    3              CALL OCI$MK_WR (KMSG.CADDR,139 /* BATCH_MSG# */,LENGTHC(BTML),BTML,BTM);

   8060  2 000652   200017 630500                    EPPR0   BTM,,AUTO
         2 000653   200034 450500                    STP0    TEMP_FEP_ERA+5,,AUTO
         2 000654   000002 237000 3                  LDAQ    2
         2 000655   200032 757100                    STAQ    TEMP_FEP_ERA+3,,AUTO
         2 000656   000034 236000 3                  LDQ     28
         2 000657   200031 756100                    STQ     TEMP_FEP_ERA+2,,AUTO
         2 000660   200003 236100                    LDQ     @KMSG,,AUTO
         2 000661   400000 036007                    ADLQ    -131072,DL
         2 000662   200030 756100                    STQ     TEMP_FEP_ERA+1,,AUTO
         2 000663   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000664   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 000665   000000 701000 xent               TSX1    OCI$MK_WR
         2 000666   000000 011000                    NOP     0
         2 000667   001171 710000 2                  TRA     RTN

      253     8061    3           CASE (1) /* !BATCH ON */;

      254     8062    3              FS_JEOK=0;

   8062  2 000670   000001 450000 0                  STZ     FS_JEOK

      255     8063    3              GOTO BTMSG;

   8063  2 000671   000633 710000 2                  TRA     BTMSG

      256     8064    3           CASE (2) /* !BATCH OFF */;

      257     8065    3              FS_JEOK=1;

PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:41   
   8065  2 000672   000001 235007                    LDA     1,DL
         2 000673   000001 755000 0                  STA     FS_JEOK

      258     8066    3              GOTO BTMSG;

   8066  2 000674   000633 710000 2                  TRA     BTMSG

      259     8067    3           CASE (3);

      260     8068                          /*    SLUG has found one or more
      261     8069                           *    of the super files are bad.
      262     8070                           *    Simulate a NOUSERS! keyin
      263     8071                           */
      264     8072    3              GOTO SIM_NOUSERS;

   8072  2 000675   000025 710000 2                  TRA     SIM_NOUSERS

      265     8073    3           CASE (4);

      266     8074                          /*    SLUG found NOUSERS set when he started.
      267     8075                           *    Print the same set of messages
      268     8076                           *    as we would when the guy does
      269     8077                           *    a NOUSERS keyin after KEYIN's
      270     8078                           *    running.  This kluge causes
      271     8079                           *    an ESC-NOUSERS keyin to elicit
      272     8080                           *    the correct set of messages
      273     8081                           *    despite the fact that he does
      274     8082                           *    the keyin before MONKEY is
      275     8083                           *    connected to CSCG
      276     8084                           */
      277     8085    3              GOTO SIM_NOUSERS;

   8085  2 000676   000025 710000 2                  TRA     SIM_NOUSERS

      278     8086    3           CASE (5);

      279     8087    3           CASE (6);
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:42   

      280     8088                          /*    SLUG has gone past the point where
      281     8089                           *    the NOUSERS keyin will work.
      282     8090                           *    Simulate a !BATCH keyin (for info
      283     8091                           *    and to tell PRESCAN to go if
      284     8092                           *    BATCH is ON).
      285     8093                           */
      286     8094    3              NOUSERSOK=0;

   8094  2 000677   000000 450000 0                  STZ     NOUSERSOK

      287     8095    3              GOTO BTMSG;

   8095  2 000700   000633 710000 2                  TRA     BTMSG

      288     8096
      289     8097    3           END;

   8097  2 000701   001171 710000 2                  TRA     RTN

      290     8098                                                /**/
      291     8099                                           /* !DIE! keyin
      292     8100                                                operator recovery */
      293     8101    2        CASE (6 /* KEY_DIE# */);

      294     8102    2           IF B_ZIP ~= 0

   8102  2 000702   000000 235000 xsym               LDA     B_ZIP
         2 000703   000706 600000 2                  TZE     s:8108

      295     8103    2           THEN
      296     8104    3           DO;

      297     8105    3                S_TUIS = OCA_SAVE_TUIS;

   8105  2 000704   000002 236000 0                  LDQ     OCA_SAVE_TUIS
         2 000705   000000 756000 xsym               STQ     S_TUIS
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:43   

      298     8106    3              END;                         /* DO IF ZAP IN PROGRESS */

      299     8107
      300     8108    2           IF OCA_DIE_COMMENT ~= 0         /* IF COMMENT REQUIRED, CHECK */

   8108  2 000706   000003 236000 0                  LDQ     OCA_DIE_COMMENT
         2 000707   000727 600000 2                  TZE     s:8117
         2 000710   000001 236100                    LDQ     1,,PR0
         2 000711   777000 316003                    CANQ    -512,DU
         2 000712   000727 601000 2                  TNZ     s:8117

      301     8109    2                AND                        /* TO SEE IF IT'S THERE */
      302     8110    2                KMSG2.FIL1 = 0
      303     8111    3           THEN DO;

      304     8112    3                CALL OCI$MK_WR (KMSG.CADDR,400 /* DIE_MSG# */,0,,);

   8112  2 000713   000036 236000 3                  LDQ     30
         2 000714   200032 756100                    STQ     TEMP_FEP_ERA+3,,AUTO
         2 000715   000037 236000 3                  LDQ     31
         2 000716   200031 756100                    STQ     TEMP_FEP_ERA+2,,AUTO
         2 000717   200003 236100                    LDQ     @KMSG,,AUTO
         2 000720   400000 036007                    ADLQ    -131072,DL
         2 000721   200030 756100                    STQ     TEMP_FEP_ERA+1,,AUTO
         2 000722   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000723   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000724   000000 701000 xent               TSX1    OCI$MK_WR
         2 000725   000000 011000                    NOP     0

      305     8113    3                RETURN;

   8113  2 000726   000000 702200 xent               TSX2  ! X66_ARET

      306     8114    3              END;
      307     8115
      308     8116
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:44   
      309     8117    2           CALL SC_OCOPERRECOV;

   8117  2 000727   000000 713400 xsym               CLIMB   SC_OCOPERRECOV
         2 000730   000000 600000 xsid               climb   nvectors=         0
         2 000731   001171 710000 2                  TRA     RTN

      310     8118                                                /**/
      311     8119    2        CASE (9 /* KEY_MNKZAP1# */);

      312     8120                                           /* Handle initial ZAP keyin by
      313     8121                                                setting UM = 0 and informing
      314     8122                                                SLUG */
      315     8123    2           OCA_SAVE_TUIS = S_TUIS;

   8123  2 000732   000000 235000 xsym               LDA     S_TUIS
         2 000733   000002 755000 0                  STA     OCA_SAVE_TUIS

      316     8124    2           S_TUIS=18/*JG_RQG#     */;

   8124  2 000734   000022 236007                    LDQ     18,DL
         2 000735   000000 756000 xsym               STQ     S_TUIS

      317     8125    2           B_ZIP = 1;

   8125  2 000736   000001 235007                    LDA     1,DL
         2 000737   000000 755000 xsym               STA     B_ZIP

      318     8126                                                /**/
      319     8127    2           KMSG2.KIN# = 13 /* KEY_SLUGZAP# */;

   8127  2 000740   000015 220003                    LDX0    13,DU
         2 000741   000000 740100                    STX0    0,,PR0

      320     8128    2           J = SIZEC(KMSG2.KIN#) + SIZEC(KMSG2.CADDR) +

   8128  2 000742   000002 236100                    LDQ     2,,PR0
         2 000743   000033 772000                    QRL     27
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:45   
         2 000744   000011 036007                    ADLQ    9,DL
         2 000745   200010 756100                    STQ     J,,AUTO

      321     8129    2                SIZEC(KMSG2.FIL1)+SIZEC(KMSG2.FIL2)+
      322     8130    2                SIZEC(KMSG2.COUNT) + KMSG2.COUNT;
      323     8131    2           CALL KUW$WRITE (KMSG2, J,J_SLUG);

   8131  2 000746   000010 236000 3                  LDQ     8
         2 000747   200032 756100                    STQ     TEMP_FEP_ERA+3,,AUTO
         2 000750   200010 631500                    EPPR1   J,,AUTO
         2 000751   200031 451500                    STP1    TEMP_FEP_ERA+2,,AUTO
         2 000752   200003 236100                    LDQ     @KMSG,,AUTO
         2 000753   200030 756100                    STQ     TEMP_FEP_ERA+1,,AUTO
         2 000754   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000755   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000756   000000 701000 xent               TSX1    KUW$WRITE
         2 000757   000000 011000                    NOP     0
         2 000760   001171 710000 2                  TRA     RTN

      324     8132                                                /**/
      325     8133    2        CASE (10 /* KEY_MNKZAP2# */);

      326     8134                                                     /* call scheduler to kill
      327     8135                                                leftover users during zap */
      328     8136    2           J = 0;

   8136  2 000761   200010 450100                    STZ     J,,AUTO

      329     8137    2           CALL SSW$ZAP (J);

   8137  2 000762   200010 631500                    EPPR1   J,,AUTO
         2 000763   200030 451500                    STP1    TEMP_FEP_ERA+1,,AUTO
         2 000764   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 000765   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000766   000000 701000 xent               TSX1    SSW$ZAP
         2 000767   000000 011000                    NOP     0
         2 000770   001171 710000 2                  TRA     RTN
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:46   

      330     8138                                                /**/
      331     8139    2        CASE (11 /* KEY_MNKZAP3# */);

      332     8140                                                /* Final act in ZAP process... */
      333     8141    2           S_TUIS = OCA_SAVE_TUIS;

   8141  2 000771   000002 235000 0                  LDA     OCA_SAVE_TUIS
         2 000772   000000 755000 xsym               STA     S_TUIS

      334     8142    2           CALL SC_OCZAP;

   8142  2 000773   000000 713400 xsym               CLIMB   SC_OCZAP
         2 000774   000000 600000 xsid               climb   nvectors=         0
         2 000775   001171 710000 2                  TRA     RTN

      335     8143    2        CASE (13 /* KEY_DATE90# */);

      336     8144    2           CALL HFA$STOPCPUT;         /* TELL SLAVES TO PAUSE FOR TIME UPDATE*/

   8144  2 000776   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000777   000000 701000 xent               TSX1    HFA$STOPCPUT
         2 001000   000000 011000                    NOP     0

      337     8145    2           CALL SSS$CURTIME(J);

   8145  2 001001   200010 630500                    EPPR0   J,,AUTO
         2 001002   200030 450500                    STP0    TEMP_FEP_ERA+1,,AUTO
         2 001003   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 001004   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001005   000000 701000 xent               TSX1    SSS$CURTIME
         2 001006   000000 011000                    NOP     0

      338     8146    2           UMT_UNIQUE = J;

   8146  2 001007   200010 235100                    LDA     J,,AUTO
         2 001010   000000 755000 xsym               STA     UMT_UNIQUE
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:47   

      339     8147    2           CALL SSS$FEPERA(J,TEMP_FEP_ERA);

   8147  2 001011   200027 630500                    EPPR0   TEMP_FEP_ERA,,AUTO
         2 001012   200031 450500                    STP0    TEMP_FEP_ERA+2,,AUTO
         2 001013   200010 631500                    EPPR1   J,,AUTO
         2 001014   200030 451500                    STP1    TEMP_FEP_ERA+1,,AUTO
         2 001015   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 001016   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001017   000000 701000 xent               TSX1    SSS$FEPERA
         2 001020   000000 011000                    NOP     0

      340     8148    2           S_BOOTERA = TEMP_FEP_ERA.ERA/3;

   8148  2 001021   200027 236100                    LDQ     TEMP_FEP_ERA,,AUTO
         2 001022   000036 772000                    QRL     30
         2 001023   000003 506007                    DIV     3,DL
         2 001024   000000 756000 xsym               STQ     S_BOOTERA

      341     8149    2           S_BOOTQUARTER = MOD(TEMP_FEP_ERA.ERA,3);

   8149  2 001025   200027 236100                    LDQ     TEMP_FEP_ERA,,AUTO
         2 001026   000036 772000                    QRL     30
         2 001027   000003 506007                    DIV     3,DL
         2 001030   000000 755000 xsym               STA     S_BOOTQUARTER

      342     8150    2           I=SSC_TMHD;

   8150  2 001031   000000 236000 xsym               LDQ     SSC_TMHD
         2 001032   200007 756100                    STQ     EVENT,,AUTO

      343     8151    3           DO WHILE  (I ~= 0);

   8151  2 001033   001047 600000 2                  TZE     s:8155

      344     8152    3                CALL SSS$UPDUTS(SSC_TMWU(I)); /* FIX WAKEUP UTS        */

PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:48   
   8152  2 001034   200007 720100                    LXL0    EVENT,,AUTO
         2 001035   000000 630410 xsym               EPPR0   SSC_TMWU,X0
         2 001036   200030 450500                    STP0    TEMP_FEP_ERA+1,,AUTO
         2 001037   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 001040   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001041   000000 701000 xent               TSX1    SSS$UPDUTS
         2 001042   000000 011000                    NOP     0

      345     8153    3                I=SSC_TMLNK(I);

   8153  2 001043   200007 720100                    LXL0    EVENT,,AUTO
         2 001044   000000 235010 xsym               LDA     SSC_TMLNK,X0
         2 001045   200007 755100                    STA     EVENT,,AUTO

      346     8154    3              END;

   8154  2 001046   001034 601000 2                  TNZ     s:8152

      347     8155    2           I=S_HQ(%SS_SW);

   8155  2 001047   000021 235000 xsym               LDA     S_HQ+17
         2 001050   200007 755100                    STA     EVENT,,AUTO

      348     8156    3           DO WHILE (I ~= 0);

   8156  2 001051   001070 600000 2                  TZE     s:8161

      349     8157    3                P$=ADDR(B$USRT$->B$USER(I));

   8157  2 001052   200007 236100                    LDQ     EVENT,,AUTO
         2 001053   000026 736000                    QLS     22
         2 001054   000000 036000 xsym               ADLQ    B$USRT$
         2 001055   200012 756100                    STQ     P$,,AUTO

      350     8158    3                CALL SSS$UPDUTS(P$->B$U.MISC); /* FIX WAKEUP UTS       */

   8158  2 001056   000017 036003                    ADLQ    15,DU
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:49   
         2 001057   200030 756100                    STQ     TEMP_FEP_ERA+1,,AUTO
         2 001060   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 001061   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001062   000000 701000 xent               TSX1    SSS$UPDUTS
         2 001063   000000 011000                    NOP     0

      351     8159    3                I=P$->B$U.FL;

   8159  2 001064   200012 470500                    LDP0    P$,,AUTO
         2 001065   000002 235100                    LDA     2,,PR0
         2 001066   200007 755100                    STA     EVENT,,AUTO

      352     8160    3              END;

   8160  2 001067   001052 601000 2                  TNZ     s:8157

      353     8161    2           I=S_RQH((%SS_NQW-%SS_CBF)/2);

   8161  2 001070   000002 236000 xsym               LDQ     S_RQH+2
         2 001071   200007 756100                    STQ     EVENT,,AUTO

      354     8162    3           DO WHILE (I ~= 0);

   8162  2 001072   001122 600000 2                  TZE     s:8169

      355     8163    3                P$=ADDR(B$USRT$->B$USER(I));

   8163  2 001073   200007 236100                    LDQ     EVENT,,AUTO
         2 001074   000026 736000                    QLS     22
         2 001075   000000 036000 xsym               ADLQ    B$USRT$
         2 001076   200012 756100                    STQ     P$,,AUTO

      356     8164    3                IF P$->B$U.MISC ~= BITBIN('777777777777'O)

   8164  2 001077   200012 470500                    LDP0    P$,,AUTO
         2 001100   000017 236100                    LDQ     15,,PR0
         2 001101   000027 116000 xsym               CMPQ    B_VECTNIL+23
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:50   
         2 001102   001114 600000 2                  TZE     s:8167
         2 001103   000011 116000 1                  CMPQ    JC_SUSR+2
         2 001104   001114 600000 2                  TZE     s:8167

      357     8165    3                     AND P$->B$U.MISC ~= BITBIN('777777777776'O) THEN
      358     8166    3                     CALL SSS$UPDUTS(P$->B$U.MISC); /* FIX WAKEUP UTS    */

   8166  2 001105   200012 236100                    LDQ     P$,,AUTO
         2 001106   000017 036003                    ADLQ    15,DU
         2 001107   200030 756100                    STQ     TEMP_FEP_ERA+1,,AUTO
         2 001110   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 001111   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001112   000000 701000 xent               TSX1    SSS$UPDUTS
         2 001113   000000 011000                    NOP     0

      359     8167    3                I=P$->B$U.SQ;

   8167  2 001114   200012 470500                    LDP0    P$,,AUTO
         2 001115   000010 236100                    LDQ     8,,PR0
         2 001116   000011 772000                    QRL     9
         2 001117   000777 376007                    ANQ     511,DL
         2 001120   200007 756100                    STQ     EVENT,,AUTO

      360     8168    3              END;

   8168  2 001121   001073 601000 2                  TNZ     s:8163

      361     8169    3           DO I = 0 TO 2000;               /* GIVE THEM A CHANCE TO GET TO DIS */

   8169  2 001122   200007 450100                    STZ     EVENT,,AUTO

      362     8170    3              END;

   8170  2 001123   200007 235100                    LDA     EVENT,,AUTO
         2 001124   000001 035007                    ADLA    1,DL
         2 001125   200007 755100                    STA     EVENT,,AUTO
         2 001126   003721 115007                    CMPA    2001,DL
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:51   
         2 001127   001123 602000 2                  TNC     s:8170

      363     8171    2           CALL HFA$STARTCPU;         /* START SLAVES. THEY WILL FIX THEIR TIME*/

   8171  2 001130   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001131   000000 701000 xent               TSX1    HFA$STARTCPU
         2 001132   000000 011000                    NOP     0

      364     8172    2           ADDR(KL_TIME.UTS)->UTS_B = J;

   8172  2 001133   000100 100500                    MLR     fill='000'O
         2 001134   200010 000004                    ADSC9   J,,AUTO                  cn=0,n=4
         2 001135   200005 200004                    ADSC9   KL_TIME,,AUTO            cn=1,n=4

      365     8173    2           KL_TIME.FNC = 17;

   8173  2 001136   021000 236003                    LDQ     8704,DU
         2 001137   200005 552140                    STBQ    KL_TIME,'40'O,AUTO

      366     8174    2           CALL KUB$WRITE(KL_TIME,SIZEC(KL_TIME),'HLPADMIN');

   8174  2 001140   000022 236000 3                  LDQ     18
         2 001141   200032 756100                    STQ     TEMP_FEP_ERA+3,,AUTO
         2 001142   000007 236000 3                  LDQ     7
         2 001143   200031 756100                    STQ     TEMP_FEP_ERA+2,,AUTO
         2 001144   200005 630500                    EPPR0   KL_TIME,,AUTO
         2 001145   200030 450500                    STP0    TEMP_FEP_ERA+1,,AUTO
         2 001146   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 001147   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001150   000000 701000 xent               TSX1    KUB$WRITE
         2 001151   000000 011000                    NOP     0
         2 001152   001171 710000 2                  TRA     RTN

      367     8175                                                /**/
      368     8176    2        CASE (ELSE);

      369     8177    2           ALTRETURN;
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:52   

   8177  2 001153   000000 702200 xent               TSX2  ! X66_AALT

   8173  2 001154                       NRMERR       null
      370     8178    2   NRMERR: ;
      371     8179    2           CALL OCI$MK_WR (KMSG.CADDR,37 /* KMERR_MSG# */,1,'002'O,KMSG.KIN#);

   8179  2 001154   200003 236100                    LDQ     @KMSG,,AUTO
         2 001155   200034 756100                    STQ     TEMP_FEP_ERA+5,,AUTO
         2 001156   000042 237000 3                  LDAQ    34
         2 001157   200032 757100                    STAQ    TEMP_FEP_ERA+3,,AUTO
         2 001160   000044 236000 3                  LDQ     36
         2 001161   200031 756100                    STQ     TEMP_FEP_ERA+2,,AUTO
         2 001162   200003 236100                    LDQ     @KMSG,,AUTO
         2 001163   400000 036007                    ADLQ    -131072,DL
         2 001164   200030 756100                    STQ     TEMP_FEP_ERA+1,,AUTO
         2 001165   200030 630500                    EPPR0   TEMP_FEP_ERA+1,,AUTO
         2 001166   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 001167   000000 701000 xent               TSX1    OCI$MK_WR
         2 001170   000000 011000                    NOP     0

      372     8180    2        END;

   8179  2 001171                       RTN          null
      373     8181    1   RTN: ;
      374     8182    1        RETURN;

   8182  2 001171   000000 702200 xent               TSX2  ! X66_ARET

NOUSERSOK
 Sect OctLoc
   0     000   000000 000001                                                    ....

FS_JEOK
 Sect OctLoc
   0     001   000000 000000                                                    ....

PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:53   
OCA_SAVE_TUIS
 Sect OctLoc
   0     002   000000 000000                                                    ....

OCA_DIE_COMMENT
 Sect OctLoc
   0     003   000000 000000                                                    ....

JP_CITE
 Sect OctLoc
   0     004   000003 000000   000000 000000   000000 000000                    ............

BTML
 Sect OctLoc
   1     000   004004 004004   004*** ******                                    ........

JM_SMSG
 Sect OctLoc
   1     002   000012 000000   000000 000000   000000 0000**   040040 040040    ............
   1     006   040040 040040

JC_SUSR
 Sect OctLoc
   1     007   000000 000003   000000 ******                                    ........

(unnamed)
 Sect OctLoc
   1     011   777777 777776   110114 120101   104115 111116                    ....HLPADMIN

(unnamed)
 Sect OctLoc
   3     000   200000 000000   000000 000143   000007 006000   000000 006000    .......c........
   3     004   000000 006000   000001 006000   000007 006000   000012 006000    ................
   3     010   000000 006000   000000 000024   000002 006000   000011 006000    ................
   3     014   000000 006000   000000 000212   000000 006000   000015 006000    ................
   3     020   000004 600000   000006 006000   000012 006000   000000 000210    ................
   3     024   000023 006000   000000 000211   000025 006000   000000 000014    ................
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:54   
   3     030   000004 006000   000027 006000   000000 006000   000000 000213    ................
   3     034   000033 006000   000000 000620   000002 006000   000035 006000    ................
   3     040   000000 000045   002000 000000   000003 006000   000041 006000    ...%.........!..
   3     044   000040 006000                                                    . ..
      375     8183        /**/
      376     8184    1   END;
      377     8185        /**/
      378     8186        /**/
      379     8187        %EOD;

PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:55   
--  Include file information  --

   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   TM_DATA_M.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   JC_MACRO_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   JM$STRUCT.:E05TOU  is referenced.
   JG_EVID_C.:E05TOU  is referenced.
   JP_MACRO_C.:E05TOU  is referenced.
   OC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_CNTRLD_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_CNTRL_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   UM_CP6.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure OCA$KMISC.
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:56   

 **** Variables and constants ****

  ****  Section 000  Data  OCA$KMISC

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     1-0-0/w UBIN        r     1 FS_JEOK                    4-0-0/w STRC(108)   r     1 JP_CITE
     0-0-0/w UBIN        r     1 NOUSERSOK                  3-0-0/w UBIN        r     1 OCA_DIE_COMMENT
     2-0-0/w UBIN        r     1 OCA_SAVE_TUIS

  ****  Section 001 RoData OCA$KMISC

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b UBIN(9)     r     1 BTML(0:4)                  7-0-0/w STRC(54)    r     1 JC_SUSR
     2-0-0/w STRC(180)   r     1 JM_SMSG

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @KMSG                     17-0-0/w STRC(180)   r     1 BTM
    24-0-0/w PTR         r     1 BUF$                      25-0-0/w SBIN        r     1 BUFX
    13-0-0/c CHAR(8)     r     1 DATE                      26-0-0/w PTR         r     1 DQH$
     7-0-0/w UBIN        r     1 EVENT                      7-0-0/w UBIN        r     1 I
    10-0-0/w UBIN        r     1 J                          5-0-0/w STRC(45)    r     1 KL_TIME
    *0-0-0/w STRC(1260)  r     1 KMSG                      *0-0-0/w STRC(1260)  r     1 KMSG2
    12-0-0/w PTR         r     1 P$                        27-0-0/b STRC        r     1 TEMP_FEP_ERA
    15-0-0/c CHAR(5)     r     1 TIME                       4-0-0/w STRC        r     1 USR
    17-0-0/w STRC(180)   r     1 USRM

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:57   
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$USRT$                    0-0-0/d STRC(540)   r     1 B_MONINFO
     0-0-0/w SBIN        r     1 B_MUAIS                    0-0-0/w SBIN        r     1 B_ZIP
     0-0-0/w BIT         r     1 HW_IMX                     0-0-0/w UBIN        r     1 JM_BFIS
     0-0-0/c CHAR(8)     r     1 J_MBS                      0-0-0/c CHAR(8)     r     1 J_PRESCAN
     0-0-0/c CHAR(8)     r     1 J_SLUG                     0-0-0/w UBIN        r     1 SSC_TMHD
     0-0-0/w UBIN        r     1 SSC_TMLNK(0:9)
     0-0-0/w UBIN        r     1 SSC_TMWU(0:9)
     0-0-0/w UBIN        r     1 S_BOOTERA                  0-0-0/w UBIN        r     1 S_BOOTQUARTER
     0-0-0/w SBIN        r     1 S_CUIS(0:4)                0-0-0/w SBIN        r     1 S_HQ(0:8191)
     0-0-0/w SBIN        r     1 S_MUIS(0:4)                0-0-0/w SBIN        r     1 S_RQH(0:5)
     0-0-0/w SBIN        r     1 S_TIM_KEYIN                0-0-0/w SBIN        r     1 S_TUIS
     0-0-0/w UBIN        r     1 UMT_UNIQUE

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(576)   r     1 B$U                        0-0-0/w STRC(576)   r     1 B$USER(0:0)
     0-0-0/w STRC(648)   r     1 NI$DQH                     0-0-0/w UBIN        r     1 UTS_B


   Procedure OCA$KMISC requires 634 words for executable code.
   Procedure OCA$KMISC requires 30 words of local(AUTO) storage.
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:58   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:59   
          MINI XREF LISTING

B$DO.ECCINFO
       166**DCL       167--REDEF
B$JIT.ERR.MID
      1408**DCL      1408--REDEF
B$U.FL
       117**DCL      8011>>ASSIGN   8159>>ASSIGN
B$U.MISC
       145**DCL       146--REDEF    8010<>CALL     8016>>IF       8016>>IF       8018<>CALL     8158<>CALL
      8164>>IF       8164>>IF       8166<>CALL
B$U.SQ
       130**DCL      8019>>ASSIGN   8167>>ASSIGN
B$USER
       190**DCL      8009--ASSIGN   8015--ASSIGN   8157--ASSIGN   8163--ASSIGN
B$USER.MISC
       221**DCL       222--REDEF
B$USRT$
       233**DCL      8009>>ASSIGN   8015>>ASSIGN   8157>>ASSIGN   8163>>ASSIGN
BTM
      7734**DCL      7743--REDEF    7950<>CALL     7959<>CALL     7972<>CALL     8043<>CALL     8060<>CALL
BTM.BFIS
      7738**DCL      7731--DCLINIT  7739--REDEF    8059<<ASSIGN
BTM.CUIS
      7741**DCL      7732--DCLINIT  8058<<ASSIGN   8059>>ASSIGN
BTM.JEOK
      7735**DCL      7731--DCLINIT  7736--REDEF    7737--REDEF    8056<<ASSIGN
BTM.MODE
      7736**DCL      7970<<ASSIGN
BTM.MUIS
      7740**DCL      7732--DCLINIT  8057<<ASSIGN
BTM.SUBCODE
      7737**DCL      7947<<ASSIGN   7949<<ASSIGN   7958<<ASSIGN   8042<<ASSIGN
BTM.UNUM
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:60   
      7739**DCL      7971<<ASSIGN
BTM.UNUSD
      7742**DCL      7733--DCLINIT
BTML
      7731**DCL      7950--CALL     7950<>CALL     7959--CALL     7959<>CALL     7972--CALL     7972<>CALL
      8033--CALL     8033<>CALL     8040--CALL     8040<>CALL     8043--CALL     8043<>CALL     8060--CALL
      8060<>CALL
BTMSG
      8042**LABEL    7967--GOTO     8063--GOTO     8066--GOTO     8095--GOTO
BUF$
      7745**DCL      7989<>CALL     7990>>ASSIGN   7992<>CALL
BUFX
      7746**DCL      7989<>CALL     7991<>CALL     7992<>CALL
B_MONINFO.LADCFLG#
      7665**DCL      7975>>IF
B_MONINFO.NOUSERS#
      7666**DCL      7946<<ASSIGN   7954>>IF       7956<<ASSIGN   8041>>IF
B_MUAIS
      7914**DCL      7952>>IF
B_ZIP
      2508**DCL      8102>>IF       8125<<ASSIGN
DATE
      7728**DCL      7984<>CALL     7986<<ASSIGN   7987<>CALL
DQH$
      7747**DCL      7989<>CALL     7991>>CALL
EVENT
      7719**DCL      7720--REDEF    7977<<ASSIGN   7978<<ASSIGN   7979<>CALL
FS_JEOK
      7775**DCL      8054>>ASSIGN   8056>>ASSIGN   8062<<ASSIGN   8065<<ASSIGN
HFA$STARTCPU
      7930**DCL-ENT  8023--CALL     8171--CALL
HFA$STOPCPUT
      7929**DCL-ENT  7995--CALL     8144--CALL
HW_IMX
      7651**DCL      7988>>IF
I
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:61   
      7720**DCL      7982<<DOINDEX  8002<<ASSIGN   8003>>DOWHILE  8004>>CALL     8005<<ASSIGN   8005>>ASSIGN
      8007<<ASSIGN   8008>>DOWHILE  8009>>ASSIGN   8011<<ASSIGN   8013<<ASSIGN   8014>>DOWHILE  8015>>ASSIGN
      8019<<ASSIGN   8021<<DOINDEX  8030<<DOINDEX  8031>>ASSIGN   8031>>ASSIGN   8035<<DOINDEX  8036>>ASSIGN
      8036>>ASSIGN   8037>>ASSIGN   8150<<ASSIGN   8151>>DOWHILE  8152>>CALL     8153<<ASSIGN   8153>>ASSIGN
      8155<<ASSIGN   8156>>DOWHILE  8157>>ASSIGN   8159<<ASSIGN   8161<<ASSIGN   8162>>DOWHILE  8163>>ASSIGN
      8167<<ASSIGN   8169<<DOINDEX
J
      7721**DCL      7987<>CALL     7990>>ASSIGN   7996<>CALL     7998>>ASSIGN   7999<>CALL     8024>>ASSIGN
      8034<<ASSIGN   8037<<ASSIGN   8037>>ASSIGN   8039>>ASSIGN   8128<<ASSIGN   8131<>CALL     8136<<ASSIGN
      8137<>CALL     8145<>CALL     8146>>ASSIGN   8147<>CALL     8172>>ASSIGN
JC_SUSR
      7873**DCL      7957<>CALL     7957--CALL
JM_BFIS
      7913**DCL      8059>>ASSIGN
JM_SMSG
      7825**DCL      7965<>CALL     7965--CALL
JM_SMSG.ACCT
      7842**DCL      7845--REDEF
JP_CITE
      7793**DCL      8055<>CALL     8055--CALL
JP_CITE.GO
      7804**DCL      8054<<ASSIGN
JP_CITE.SYSID
      7802**DCL      7804--REDEF
J_MBS
      7910**DCL      7965<>CALL
J_PRESCAN
      7911**DCL      8055<>CALL
J_SLUG
      7912**DCL      7957<>CALL     8131<>CALL
KL_TIME
      7710**DCL      8026<>CALL     8026--CALL     8174<>CALL     8174--CALL
KL_TIME.FNC
      7711**DCL      8025<<ASSIGN   8173<<ASSIGN
KL_TIME.UTS
      7715**DCL      8024--ASSIGN   8172--ASSIGN
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:62   
KMSG
      7673**DCL        12--PROC     7684--REDEF
KMSG.BCHFLG
      7679**DCL      8051>>DOCASE
KMSG.CADDR
      7675**DCL      7966<<ASSIGN   7976<>CALL     8033<>CALL     8040<>CALL     8043<>CALL     8060<>CALL
      8112<>CALL     8179<>CALL
KMSG.DTTIM
      7681**DCL      7985>>ASSIGN   7986>>ASSIGN
KMSG.KIN#
      7674**DCL      7942>>DOCASE   7977>>IF       7985>>IF       8179<>CALL
KMSG.MODE
      7677**DCL      7962>>IF       7963>>ASSIGN   7964>>IF       7970>>ASSIGN
KMSG.NUMU
      7678**DCL      7679--REDEF    7952>>IF       7953>>IF       7962>>ASSIGN   7963>>ASSIGN   7965>>IF
      7971>>ASSIGN
KMSG.SYSID
      7676**DCL      7677--REDEF    7975>>IF       7976<>CALL
KMSG.WSN
      7680**DCL      7681--REDEF    7976<>CALL
KMSG2
      7684**DCL      8131<>CALL
KMSG2.CADDR
      7686**DCL      8128--ASSIGN
KMSG2.COUNT
      7689**DCL      8128--ASSIGN   8128>>ASSIGN
KMSG2.FIL1
      7687**DCL      8108>>IF       8128--ASSIGN
KMSG2.FIL2
      7688**DCL      8128--ASSIGN
KMSG2.KIN#
      7685**DCL      8127<<ASSIGN   8128--ASSIGN
KUB$WRITE
      7932**DCL-ENT  8026--CALL     8174--CALL
KUW$WRITE
      7936**DCL-ENT  7957--CALL     7965--CALL     8055--CALL     8131--CALL
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:63   
NI$DQH
      7758**DCL      7991<>CALL
NI$DQH.IOCHANX
      7760**DCL      7761--REDEF
NI$DQH.MBX$
      7769**DCL      7770--REDEF
NOUSERSOK
      7730**DCL      7945>>IF       8094<<ASSIGN
NRMERR
      8173**LABEL    7952--GOTO     7975--GOTO     7987--CALLALT
OCA_DIE_COMMENT
      7777**DCL      8108>>IF
OCA_SAVE_TUIS
      7776**DCL      8105>>ASSIGN   8123<<ASSIGN   8141>>ASSIGN
OCI$MK_WR
      7931**DCL-ENT  7950--CALL     7959--CALL     7972--CALL     8033--CALL     8040--CALL     8043--CALL
      8060--CALL     8112--CALL     8179--CALL
OCZ$SID_UN
      7918**DCL-ENT  7976--CALL
P$
      7723**DCL      8009<<ASSIGN   8010>>CALL     8011>>ASSIGN   8015<<ASSIGN   8016>>IF       8016>>IF
      8018>>CALL     8019>>ASSIGN   8157<<ASSIGN   8158>>CALL     8159>>ASSIGN   8163<<ASSIGN   8164>>IF
      8164>>IF       8166>>CALL     8167>>ASSIGN
RTN
      8179**LABEL    7976--CALLALT
SC_OCOPERRECOV
      7934**DCL-ENT  8117--CALL
SC_OCZAP
      7935**DCL-ENT  8142--CALL
SETTIME
      7988**LABEL    7989--CALLALT
SIM_NOUSERS
      7938**LABEL    8072--GOTO     8085--GOTO
SSC_TMHD
      7727**DCL      8002>>ASSIGN   8150>>ASSIGN
SSC_TMLNK
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:64   
      7726**DCL      8005>>ASSIGN   8153>>ASSIGN
SSC_TMWU
      7725**DCL      8004<>CALL     8152<>CALL
SSR$RUE
      7916**DCL-ENT  7979--CALL
SSS$CURTIME
      7917**DCL-ENT  8145--CALL
SSS$FEPERA
      7927**DCL-ENT  7999--CALL     8147--CALL
SSS$SETBTIME
      7921**DCL-ENT  7996--CALL
SSS$UPDITIME
      7922**DCL-ENT  7997--CALL
SSS$UPDUTS
      7923**DCL-ENT  8004--CALL     8010--CALL     8018--CALL     8152--CALL     8158--CALL     8166--CALL
SSW$ZAP
      7928**DCL-ENT  8137--CALL
S_BOOTERA
      2497**DCL      8000<<ASSIGN   8148<<ASSIGN
S_BOOTQUARTER
      2497**DCL      8001<<ASSIGN   8149<<ASSIGN
S_CUIS
      2483**DCL      8036>>ASSIGN   8037>>ASSIGN   8058>>ASSIGN
S_HQ
      2484**DCL      8007>>ASSIGN   8155>>ASSIGN
S_MUIS
      2483**DCL      7963<<ASSIGN   8031>>ASSIGN   8057>>ASSIGN
S_RQH
      2484**DCL      8013>>ASSIGN   8161>>ASSIGN
S_TIM_KEYIN
      7724**DCL      7981<<ASSIGN   8027<<ASSIGN
S_TUIS
      2483**DCL      7962<<ASSIGN   8029>>ASSIGN   8105<<ASSIGN   8123>>ASSIGN   8124<<ASSIGN   8141<<ASSIGN
TEMP_FEP_ERA
      7772**DCL      7999<>CALL     8147<>CALL
TEMP_FEP_ERA.ERA
PL6.E3A0      #001=OCA$KMISC File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:54 Page:65   
      7773**DCL      8000>>ASSIGN   8001>>ASSIGN   8148>>ASSIGN   8149>>ASSIGN
TIME
      7729**DCL      7984<>CALL     7985<<ASSIGN   7987<>CALL
TMB$BUF_ALLOC
      7938**DCL-ENT  7989--CALL
TMB$BUF_DEALLOC
      7939**DCL-ENT  7992--CALL
TMB$MCA
      7937**DCL-ENT  7991--CALL
UMT$IDT
      7919**DCL-ENT  7984--CALL
UMT$LCLDATE
      7920**DCL-ENT  7987--CALL
UMT_UNIQUE
      7915**DCL      7998<<ASSIGN   8146<<ASSIGN
USR
      7692**DCL      7976<>CALL
USR.USER#
      7694**DCL      7979<>CALL
USRM
      7743**DCL      8033<>CALL     8040<>CALL
USRM.MC
      7744**DCL      8029<<ASSIGN   8031<<ASSIGN   8036<<ASSIGN   8039<<ASSIGN
UTS_B
      7748**DCL      7990<<ASSIGN   8024<<ASSIGN   8172<<ASSIGN

PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:66   
      380        1        /*M* OCA$HDMON Handles hardware-monitor keyins in the monitor */
      381        2        /*T***********************************************************/
      382        3        /*T*                                                         */
      383        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      384        5        /*T*                                                         */
      385        6        /*T***********************************************************/
      386        7        /*X* DMR,THI=0,PLM=5,IND=5,CTI=5,SDI=5,MCL=10,DCI=5,CSU=5,ECU=5,DTI=2*/
      387        8                                                /**/
      388        9                                                /**/
      389       10        OCA$HDMON: PROC ( HDMON_KEYIN ) ALTRET;
      390       11                                                /**/
      391       12                                                /**/
      392       13    1   DCL OCZ$SID_UN ENTRY (4) ALTRET;
      393       14    1   DCL OCI$MK_WR ENTRY(7);
      394       15                                                /**/
      395       16                                                /**/
      396       17        %INCLUDE B$P;
      397      101                                                /**/
      398      102        %INCLUDE OC_SUBS_C;
      399      833                                                /**/
      400      834        %INCLUDE SS_SCHED_R;
      401      877                                                /**/
      402      878        %INCLUDE B$USER;
      403     1094        %B$USERREFS;
      404     1098                                                /**/
      405     1099                                                /**/
      406     1100    1   DCL 1 HDMON_KEYIN ALIGNED,
      407     1101    1            2 KIN# UBIN(18) UNAL,
      408     1102    1            2 CADDR UBIN(18) UNAL,
      409     1103    1            2 USID UBIN(18) UNAL,
      410     1104    1            2 CPU# UBIN(18) UNAL,
      411     1105    1            2 PROCID,
      412     1106    1                 3 COUNT UBIN(9) UNAL,
      413     1107    1                 3 TEXT CHAR(HDMON_KEYIN.PROCID.COUNT) UNAL;
      414     1108                                                /**/
      415     1109                                                /**/
      416     1110                                                /**/
PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:67   
      417     1111    1   DCL I UBIN WORD;
      418     1112    1   DCL USERNO UBIN WORD;
      419     1113                                                /**/
      420     1114    1   DCL 1 PASS_CPU,
      421     1115    1            2 NUMBER UBIN BYTE UNAL,
      422     1116    1            2 CODE UBIN BYTE UNAL;
      423     1117                                                /**/
      424     1118                                                /**/
      425     1119                                                /*****************************/
      426     1120                                                /*****************************/
      427     1121        /*
      428     1122             Begin     O C A $ H D M O N
      429     1123                                                */
      430     1124
      431     1125    2        DO CASE (HDMON_KEYIN.KIN#);
      432     1126                                                /**/
      433     1127    2        CASE (KEY_HDMONUSR#);
      434     1128    2             IF HDMON_KEYIN.USID = 0
      435     1129    2             THEN
      436     1130    3               DO;
      437     1131    3                    B$USRT$->B$USER.CPU(S_C10USR)=0;
      438     1132    3                    S_C10USR = 0;
      439     1133    3                    S_C10PR = 0;
      440     1134    3                  END;
      441     1135    2             ELSE
      442     1136    3               DO;
      443     1137    3                    CALL OCZ$SID_UN (HDMON_KEYIN.USID,
      444     1138    3                         USERNO,
      445     1139    3                         HDMON_KEYIN.CADDR)
      446     1140    3                         ALTRET (JUSTALT);
      447     1141    3                    S_C10USR = USERNO;
      448     1142    3                    S_C10PR = 0;
      449     1143    3                    IF HDMON_KEYIN.CPU# = 0
      450     1144    3                    THEN
      451     1145    4                      DO;
      452     1146    4                           B$USRT$ -> B$USER.CPU (USERNO) = 0;
      453     1147    4                           RETURN;
PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:68   
      454     1148    4                         END;              /* DO IF CPU = 0 */
      455     1149                                                /**/
      456     1150    4                    DO I = 0 TO S_NSCPU;
      457     1151    4                         IF S_PORTNR(I) = HDMON_KEYIN.CPU#
      458     1152    4                         THEN
      459     1153    5                           DO;
      460     1154    5                                B$USRT$ -> B$USER.CPU (USERNO) =
      461     1155    5                                     I + 1;
      462     1156    5                                RETURN;
      463     1157    5                              END;         /* DO IF FOUND A MATCH */
      464     1158    4                       END;                /* DO I = 0 TO NSCPU */
      465     1159                                                /**/
      466     1160    3                    PASS_CPU.NUMBER = HDMON_KEYIN.CPU#;
      467     1161    3                    PASS_CPU.CODE = 2;
      468     1162                                                /**/
      469     1163    3                    CALL OCI$MK_WR (HDMON_KEYIN.CADDR,
      470     1164    3                         CPU_MSG#,
      471     1165    3                         2,
      472     1166    3                         '001001'O,
      473     1167    3                         PASS_CPU );
      474     1168    3                    RETURN;
      475     1169    3                  END;
      476     1170                                                /**/
      477     1171                                                /**/
      478     1172    2        CASE (KEY_HDMONPR#);
      479     1173                                                /**/
      480     1174    2             IF HDMON_KEYIN.PROCID.TEXT = '0'
      481     1175    2             THEN
      482     1176    3               DO;
      483     1177    3                    S_C10PR = 0;
      484     1178    3                  END;
      485     1179    2             ELSE
      486     1180    3               DO;
      487     1181    4                    DO I = 0 TO (P_MAXPROCS - 1);
      488     1182    4                         IF B$P$ -> B$P.NAME.TEXT(I)
      489     1183    4                              = HDMON_KEYIN.PROCID.TEXT
      490     1184    4                         THEN
PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:69   
      491     1185    5                           DO;
      492     1186    5                                S_C10PR = I;
      493     1187    5                                RETURN;
      494     1188    5                              END;
      495     1189    4                       END;                /* DO I = 0 TO MAX_PROCS - 1 */
      496     1190    3                    CALL OCI$MK_WR (HDMON_KEYIN.CADDR,
      497     1191    3                         NOPROC_MSG#,
      498     1192    3                         1,
      499     1193    3                         HDMON_KEYIN.PROCID.COUNT,
      500     1194    3                         HDMON_KEYIN.PROCID.TEXT);
      501     1195    3                  END;                     /* DO IF PROC ~= '0' */
      502     1196    2        END;                               /* DO CASE (KIN#) */
      503     1197                                                /**/
      504     1198    1   JUSTALT: RETURN;
      505     1199                                                /**/
      506     1200    1   END OCA$HDMON;

PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:70   
--  Include file information  --

   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   SS_CNTRLD_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_CNTRL_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_R.:E05TOU  cannot be made into a system file and is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   B$P.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure OCA$HDMON.

   Procedure OCA$HDMON requires 133 words for executable code.
   Procedure OCA$HDMON requires 14 words of local(AUTO) storage.

    No errors detected in file OCA$KMISC.:E05TSI    .

PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:71   

 Object Unit name= OCA$HDMON                                  File name= OCA$KMISC.:E05TOU
 UTS= JUL 30 '97 03:55:50.56 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none   133    205  OCA$HDMON
    1  RoData even  none    11     13  OCA$HDMON

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        1  OCA$HDMON

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       4 OCZ$SID_UN
         yes           Std       7 OCI$MK_WR
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     P_MAXPROCS                            B$P$                                  S_PORTNR
     S_NSCPU                               S_C10USR                              S_C10PR
     B$USRT$                               B_VECTNIL
PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:72   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:73   


      380        1        /*M* OCA$HDMON Handles hardware-monitor keyins in the monitor */
      381        2        /*T***********************************************************/
      382        3        /*T*                                                         */
      383        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      384        5        /*T*                                                         */
      385        6        /*T***********************************************************/
      386        7        /*X* DMR,THI=0,PLM=5,IND=5,CTI=5,SDI=5,MCL=10,DCI=5,CSU=5,ECU=5,DTI=2*/
      387        8                                                /**/
      388        9                                                /**/
      389       10        OCA$HDMON: PROC ( HDMON_KEYIN ) ALTRET;

     10  0 000000   000000 700200 xent  OCA$HDMON    TSX0  ! X66_AUTO_1
         0 000001   000016 000001                    ZERO    14,1

      390       11                                                /**/
      391       12                                                /**/
      392       13    1   DCL OCZ$SID_UN ENTRY (4) ALTRET;
      393       14    1   DCL OCI$MK_WR ENTRY(7);
      394       15                                                /**/
      395       16                                                /**/
      396       17        %INCLUDE B$P;
      397      101                                                /**/
      398      102        %INCLUDE OC_SUBS_C;
      399      833                                                /**/
      400      834        %INCLUDE SS_SCHED_R;
      401      877                                                /**/
      402      878        %INCLUDE B$USER;
      403     1094        %B$USERREFS;
      404     1098                                                /**/
      405     1099                                                /**/
      406     1100    1   DCL 1 HDMON_KEYIN ALIGNED,
      407     1101    1            2 KIN# UBIN(18) UNAL,
      408     1102    1            2 CADDR UBIN(18) UNAL,
      409     1103    1            2 USID UBIN(18) UNAL,
      410     1104    1            2 CPU# UBIN(18) UNAL,
      411     1105    1            2 PROCID,
PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:74   
      412     1106    1                 3 COUNT UBIN(9) UNAL,
      413     1107    1                 3 TEXT CHAR(HDMON_KEYIN.PROCID.COUNT) UNAL;
      414     1108                                                /**/
      415     1109                                                /**/
      416     1110                                                /**/
      417     1111    1   DCL I UBIN WORD;
      418     1112    1   DCL USERNO UBIN WORD;
      419     1113                                                /**/
      420     1114    1   DCL 1 PASS_CPU,
      421     1115    1            2 NUMBER UBIN BYTE UNAL,
      422     1116    1            2 CODE UBIN BYTE UNAL;
      423     1117                                                /**/
      424     1118                                                /**/
      425     1119                                                /*****************************/
      426     1120                                                /*****************************/
      427     1121        /*
      428     1122             Begin     O C A $ H D M O N
      429     1123                                                */
      430     1124
      431     1125    2        DO CASE (HDMON_KEYIN.KIN#);

   1125  0 000002   200003 470500                    LDP0    @HDMON_KEYIN,,AUTO
         0 000003   000000 220100                    LDX0    0,,PR0
         0 000004   000003 100003                    CMPX0   3,DU
         0 000005   000007 602010 0                  TNC     s:1125+5,X0
         0 000006   000204 710000 0                  TRA     JUSTALT
         0 000007   000204 710000 0                  TRA     JUSTALT
         0 000010   000012 710000 0                  TRA     s:1128
         0 000011   000125 710000 0                  TRA     s:1174

      432     1126                                                /**/
      433     1127    2        CASE (KEY_HDMONUSR#);

      434     1128    2             IF HDMON_KEYIN.USID = 0

   1128  0 000012   000001 221100                    LDX1    1,,PR0
         0 000013   000024 601000 0                  TNZ     s:1137
PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:75   

      435     1129    2             THEN
      436     1130    3               DO;

      437     1131    3                    B$USRT$->B$USER.CPU(S_C10USR)=0;

   1131  0 000014   000000 235000 xsym               LDA     S_C10USR
         0 000015   000004 735000                    ALS     4
         0 000016   000000 471400 xsym               LDP1    B$USRT$
         0 000017   000000 236000 1                  LDQ     0
         0 000020   100010 356105                    ANSQ    8,AL,PR1

      438     1132    3                    S_C10USR = 0;

   1132  0 000021   000000 450000 xsym               STZ     S_C10USR

      439     1133    3                    S_C10PR = 0;

   1133  0 000022   000000 450000 xsym               STZ     S_C10PR

      440     1134    3                  END;

   1134  0 000023   000204 710000 0                  TRA     JUSTALT

      441     1135    2             ELSE
      442     1136    3               DO;

      443     1137    3                    CALL OCZ$SID_UN (HDMON_KEYIN.USID,

   1137  0 000024   200003 236100                    LDQ     @HDMON_KEYIN,,AUTO
         0 000025   400000 036007                    ADLQ    -131072,DL
         0 000026   200012 756100                    STQ     PASS_CPU+4,,AUTO
         0 000027   200005 631500                    EPPR1   USERNO,,AUTO
         0 000030   200011 451500                    STP1    PASS_CPU+3,,AUTO
         0 000031   200003 236100                    LDQ     @HDMON_KEYIN,,AUTO
         0 000032   000001 036003                    ADLQ    1,DU
         0 000033   200010 756100                    STQ     PASS_CPU+2,,AUTO
PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:76   
         0 000034   200010 630500                    EPPR0   PASS_CPU+2,,AUTO
         0 000035   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000036   000000 701000 xent               TSX1    OCZ$SID_UN
         0 000037   000204 702000 0                  TSX2    JUSTALT

      444     1138    3                         USERNO,
      445     1139    3                         HDMON_KEYIN.CADDR)
      446     1140    3                         ALTRET (JUSTALT);
      447     1141    3                    S_C10USR = USERNO;

   1141  0 000040   200005 235100                    LDA     USERNO,,AUTO
         0 000041   000000 755000 xsym               STA     S_C10USR

      448     1142    3                    S_C10PR = 0;

   1142  0 000042   000000 450000 xsym               STZ     S_C10PR

      449     1143    3                    IF HDMON_KEYIN.CPU# = 0

   1143  0 000043   200003 470500                    LDP0    @HDMON_KEYIN,,AUTO
         0 000044   000001 720100                    LXL0    1,,PR0
         0 000045   000053 601000 0                  TNZ     s:1150

      450     1144    3                    THEN
      451     1145    4                      DO;

      452     1146    4                           B$USRT$ -> B$USER.CPU (USERNO) = 0;

   1146  0 000046   000004 735000                    ALS     4
         0 000047   000000 471400 xsym               LDP1    B$USRT$
         0 000050   000000 236000 1                  LDQ     0
         0 000051   100010 356105                    ANSQ    8,AL,PR1

      453     1147    4                           RETURN;

   1147  0 000052   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:77   
      454     1148    4                         END;              /* DO IF CPU = 0 */
      455     1149                                                /**/
      456     1150    4                    DO I = 0 TO S_NSCPU;

   1150  0 000053   200004 450100                    STZ     I,,AUTO
         0 000054   000077 710000 0                  TRA     s:1158+3

      457     1151    4                         IF S_PORTNR(I) = HDMON_KEYIN.CPU#

   1151  0 000055   200004 720100                    LXL0    I,,AUTO
         0 000056   200003 470500                    LDP0    @HDMON_KEYIN,,AUTO
         0 000057   000001 236100                    LDQ     1,,PR0
         0 000060   777777 376007                    ANQ     -1,DL
         0 000061   000000 116010 xsym               CMPQ    S_PORTNR,X0
         0 000062   000074 601000 0                  TNZ     s:1158

      458     1152    4                         THEN
      459     1153    5                           DO;

      460     1154    5                                B$USRT$ -> B$USER.CPU (USERNO) =

   1154  0 000063   200005 235100                    LDA     USERNO,,AUTO
         0 000064   000004 735000                    ALS     4
         0 000065   000000 471400 xsym               LDP1    B$USRT$
         0 000066   200004 236100                    LDQ     I,,AUTO
         0 000067   000001 036007                    ADLQ    1,DL
         0 000070   100010 676105                    ERQ     8,AL,PR1
         0 000071   000777 376007                    ANQ     511,DL
         0 000072   100010 656105                    ERSQ    8,AL,PR1

      461     1155    5                                     I + 1;
      462     1156    5                                RETURN;

   1156  0 000073   000000 702200 xent               TSX2  ! X66_ARET

      463     1157    5                              END;         /* DO IF FOUND A MATCH */
      464     1158    4                       END;                /* DO I = 0 TO NSCPU */
PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:78   

   1158  0 000074   200004 235100                    LDA     I,,AUTO
         0 000075   000001 035007                    ADLA    1,DL
         0 000076   200004 755100                    STA     I,,AUTO
         0 000077   000000 236000 xsym               LDQ     S_NSCPU
         0 000100   200004 116100                    CMPQ    I,,AUTO
         0 000101   000055 603000 0                  TRC     s:1151

      465     1159                                                /**/
      466     1160    3                    PASS_CPU.NUMBER = HDMON_KEYIN.CPU#;

   1160  0 000102   000001 236100                    LDQ     1,,PR0
         0 000103   000033 736000                    QLS     27
         0 000104   200006 552140                    STBQ    PASS_CPU,'40'O,AUTO

      467     1161    3                    PASS_CPU.CODE = 2;

   1161  0 000105   000002 236003                    LDQ     2,DU
         0 000106   200006 552120                    STBQ    PASS_CPU,'20'O,AUTO

      468     1162                                                /**/
      469     1163    3                    CALL OCI$MK_WR (HDMON_KEYIN.CADDR,

   1163  0 000107   200006 631500                    EPPR1   PASS_CPU,,AUTO
         0 000110   200014 451500                    STP1    PASS_CPU+6,,AUTO
         0 000111   000004 237000 1                  LDAQ    4
         0 000112   200012 757100                    STAQ    PASS_CPU+4,,AUTO
         0 000113   000003 236000 1                  LDQ     3
         0 000114   200011 756100                    STQ     PASS_CPU+3,,AUTO
         0 000115   200003 236100                    LDQ     @HDMON_KEYIN,,AUTO
         0 000116   400000 036007                    ADLQ    -131072,DL
         0 000117   200010 756100                    STQ     PASS_CPU+2,,AUTO
         0 000120   200010 630500                    EPPR0   PASS_CPU+2,,AUTO
         0 000121   000023 631400 xsym               EPPR1   B_VECTNIL+19
         0 000122   000000 701000 xent               TSX1    OCI$MK_WR
         0 000123   000000 011000                    NOP     0

PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:79   
      470     1164    3                         CPU_MSG#,
      471     1165    3                         2,
      472     1166    3                         '001001'O,
      473     1167    3                         PASS_CPU );
      474     1168    3                    RETURN;

   1168  0 000124   000000 702200 xent               TSX2  ! X66_ARET

      475     1169    3                  END;
      476     1170                                                /**/
      477     1171                                                /**/
      478     1172    2        CASE (KEY_HDMONPR#);

      479     1173                                                /**/
      480     1174    2             IF HDMON_KEYIN.PROCID.TEXT = '0'

   1174  0 000125   000002 236100                    LDQ     2,,PR0
         0 000126   000033 772000                    QRL     27
         0 000127   000000 621006                    EAX1    0,QL
         0 000130   040000 106540                    CMPC    fill='040'O
         0 000131   000002 200011                    ADSC9   2,,PR0                   cn=1,n=*X1
         0 000132   000006 000001 1                  ADSC9   6                        cn=0,n=1
         0 000133   000136 601000 0                  TNZ     s:1181

      481     1175    2             THEN
      482     1176    3               DO;

      483     1177    3                    S_C10PR = 0;

   1177  0 000134   000000 450000 xsym               STZ     S_C10PR

      484     1178    3                  END;

   1178  0 000135   000204 710000 0                  TRA     JUSTALT

      485     1179    2             ELSE
      486     1180    3               DO;
PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:80   

      487     1181    4                    DO I = 0 TO (P_MAXPROCS - 1);

   1181  0 000136   200004 450100                    STZ     I,,AUTO
         0 000137   000161 710000 0                  TRA     s:1189+3

      488     1182    4                         IF B$P$ -> B$P.NAME.TEXT(I)

   1182  0 000140   200003 470500                    LDP0    @HDMON_KEYIN,,AUTO
         0 000141   000002 236100                    LDQ     2,,PR0
         0 000142   000033 772000                    QRL     27
         0 000143   000000 620006                    EAX0    0,QL
         0 000144   200004 236100                    LDQ     I,,AUTO
         0 000145   000210 402007                    MPY     136,DL
         0 000146   000000 471400 xsym               LDP1    B$P$
         0 000147   040140 106506                    CMPC    fill='040'O
         0 000150   100032 200037                    ADSC9   26,Q,PR1                 cn=1,n=31
         0 000151   000002 200010                    ADSC9   2,,PR0                   cn=1,n=*X0
         0 000152   000156 601000 0                  TNZ     s:1189

      489     1183    4                              = HDMON_KEYIN.PROCID.TEXT
      490     1184    4                         THEN
      491     1185    5                           DO;

      492     1186    5                                S_C10PR = I;

   1186  0 000153   200004 235100                    LDA     I,,AUTO
         0 000154   000000 755000 xsym               STA     S_C10PR

      493     1187    5                                RETURN;

   1187  0 000155   000000 702200 xent               TSX2  ! X66_ARET

      494     1188    5                              END;
      495     1189    4                       END;                /* DO I = 0 TO MAX_PROCS - 1 */

   1189  0 000156   200004 235100                    LDA     I,,AUTO
PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:81   
         0 000157   000001 035007                    ADLA    1,DL
         0 000160   200004 755100                    STA     I,,AUTO
         0 000161   200004 236100                    LDQ     I,,AUTO
         0 000162   000000 116000 xsym               CMPQ    P_MAXPROCS
         0 000163   000140 602000 0                  TNC     s:1182

      496     1190    3                    CALL OCI$MK_WR (HDMON_KEYIN.CADDR,

   1190  0 000164   200003 236100                    LDQ     @HDMON_KEYIN,,AUTO
         0 000165   000010 036000 1                  ADLQ    8
         0 000166   200014 756100                    STQ     PASS_CPU+6,,AUTO
         0 000167   200003 236100                    LDQ     @HDMON_KEYIN,,AUTO
         0 000170   000002 036003                    ADLQ    2,DU
         0 000171   000011 235000 1                  LDA     9
         0 000172   200012 757100                    STAQ    PASS_CPU+4,,AUTO
         0 000173   000012 236000 1                  LDQ     10
         0 000174   200011 756100                    STQ     PASS_CPU+3,,AUTO
         0 000175   200003 236100                    LDQ     @HDMON_KEYIN,,AUTO
         0 000176   400000 036007                    ADLQ    -131072,DL
         0 000177   200010 756100                    STQ     PASS_CPU+2,,AUTO
         0 000200   200010 630500                    EPPR0   PASS_CPU+2,,AUTO
         0 000201   000023 631400 xsym               EPPR1   B_VECTNIL+19
         0 000202   000000 701000 xent               TSX1    OCI$MK_WR
         0 000203   000000 011000                    NOP     0

      497     1191    3                         NOPROC_MSG#,
      498     1192    3                         1,
      499     1193    3                         HDMON_KEYIN.PROCID.COUNT,
      500     1194    3                         HDMON_KEYIN.PROCID.TEXT);
      501     1195    3                  END;                     /* DO IF PROC ~= '0' */

      502     1196    2        END;                               /* DO CASE (KIN#) */

      503     1197                                                /**/
      504     1198    1   JUSTALT: RETURN;

   1198  0 000204   000000 702200 xent  JUSTALT      TSX2  ! X66_ARET
PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:82   

(unnamed)
 Sect OctLoc
   1     000   777777 777000   000000 000106   001001 000000   000001 006000    .......F........
   1     004   000004 006000   000002 006000   060040 040040   000000 000322    ........0   ....
   1     010   000002 200000   000003 006000   000007 006000                    ............
      505     1199                                                /**/
      506     1200    1   END OCA$HDMON;

PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:83   
--  Include file information  --

   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   SS_CNTRLD_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_CNTRL_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_R.:E05TOU  cannot be made into a system file and is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   B$P.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure OCA$HDMON.
PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:84   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @HDMON_KEYIN              *0-0-0/w ASTR(81)    r     1 HDMON_KEYIN
     4-0-0/w UBIN        r     1 I                          6-0-0/b STRC(18)    r     1 PASS_CPU
     5-0-0/w UBIN        r     1 USERNO

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$P$                       0-0-0/w PTR         r     1 B$USRT$
     0-0-0/w UBIN        r     1 P_MAXPROCS                 0-0-0/w UBIN        r     1 S_C10PR
     0-0-0/w UBIN        r     1 S_C10USR                   0-0-0/w UBIN        r     1 S_NSCPU
     0-0-0/w UBIN        r     1 S_PORTNR(0:7)

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(1224)  r     1 B$P(0:0)                   0-0-0/w STRC(576)   r     1 B$USER(0:0)


   Procedure OCA$HDMON requires 133 words for executable code.
   Procedure OCA$HDMON requires 14 words of local(AUTO) storage.

    No errors detected in file OCA$KMISC.:E05TSI    .
PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:85   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:86   
          MINI XREF LISTING

B$DO.ECCINFO
      1029**DCL      1030--REDEF
B$P.NAME.TEXT
        51**DCL      1182>>IF
B$P$
        79**DCL      1182>>IF
B$U.MISC
      1008**DCL      1009--REDEF
B$USER.CPU
      1070**DCL      1131<<ASSIGN   1146<<ASSIGN   1154<<ASSIGN
B$USER.MISC
      1084**DCL      1085--REDEF
B$USRT$
      1096**DCL      1131>>ASSIGN   1146>>ASSIGN   1154>>ASSIGN
HDMON_KEYIN
      1100**DCL        10--PROC
HDMON_KEYIN.CADDR
      1102**DCL      1137<>CALL     1163<>CALL     1190<>CALL
HDMON_KEYIN.CPU#
      1104**DCL      1143>>IF       1151>>IF       1160>>ASSIGN
HDMON_KEYIN.KIN#
      1101**DCL      1125>>DOCASE
HDMON_KEYIN.PROCID.COUNT
      1106**DCL      1107--IMP-SIZ  1174>>IF       1182>>IF       1190<>CALL     1190>>CALL
HDMON_KEYIN.PROCID.TEXT
      1107**DCL      1174>>IF       1182>>IF       1190<>CALL
HDMON_KEYIN.USID
      1103**DCL      1128>>IF       1137<>CALL
I
      1111**DCL      1150<<DOINDEX  1151>>IF       1154>>ASSIGN   1181<<DOINDEX  1182>>IF       1186>>ASSIGN
JUSTALT
      1198**LABEL    1137--CALLALT
PL6.E3A0      #002=OCA$HDMON File=OCA$KMISC.:E05TSI                              WED 07/30/97 03:55 Page:87   
OCI$MK_WR
        14**DCL-ENT  1163--CALL     1190--CALL
OCZ$SID_UN
        13**DCL-ENT  1137--CALL
PASS_CPU
      1114**DCL      1163<>CALL
PASS_CPU.CODE
      1116**DCL      1161<<ASSIGN
PASS_CPU.NUMBER
      1115**DCL      1160<<ASSIGN
P_MAXPROCS
        73**DCL      1181>>DOINDEX
S_C10PR
       876**DCL      1133<<ASSIGN   1142<<ASSIGN   1177<<ASSIGN   1186<<ASSIGN
S_C10USR
       875**DCL      1131>>ASSIGN   1132<<ASSIGN   1141<<ASSIGN
S_NSCPU
       864**DCL      1150>>DOINDEX
S_PORTNR
       863**DCL      1151>>IF
USERNO
      1112**DCL      1137<>CALL     1141>>ASSIGN   1146>>ASSIGN   1154>>ASSIGN
