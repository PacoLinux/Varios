

14:56 JUL 28 '97 KV_PRMTBL_M.:E05SI                                        1    
    1      /*M* MACROS FOR GENERATING THE PARAMETER TABLES */
    2      /*T***********************************************************/
    3      /*T*                                                         */
    4      /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
    5      /*T*                                                         */
    6      /*T***********************************************************/
    7      %MACRO KV_BEGIN_PARMS;
    8      %SET PRM_TYPES = SUBSTR(' ', 0, 0);
    9      %SET PRM_IDS = SUBSTR(' ', 0, 0);
   10      %SET PRM_INDX = SUBSTR(' ', 0, 0);
   11      %SET PRM_BITS = SUBSTR(' ', 0, 0);
   12      %SET PRM_BINS = SUBSTR(' ', 0, 0);
   13      %SET PRM_MIN = SUBSTR(' ', 0, 0);
   14      %SET PRM_MAX = SUBSTR(' ', 0, 0);
   15      %SET PRM_STRID = SUBSTR(' ', 0, 0);
   16      %SET PRM_STRS = SUBSTR(' ', 0, 0);
   17      %SET PRM_STRS2 = SUBSTR(' ', 0, 0);
   18      %SET PRM_BFRS = SUBSTR(' ', 0, 0);
   19      %SET PRM_BFRLNG = SUBSTR(' ', 0, 0);
   20      %SET PRM_BFRTYP = SUBSTR(' ', 0, 0);
   21      %MEND;
   22      %MACRO KV_PARM (ID=0, OFFSET=0, MIN=0, MAX=32767, BFRLNG=8, BFRTYP=0,
   23                     TYPE (BIT=1, BYTE=2, TEXT=3, WORD=4, SHRBFR=5,
   24                       USRPRM=6, STRUCT=7, STRLST=8, OTHER=0)=0,
   25                     STR (VDI=1, SSN=2, STR=3, MVD=4, SVD=5, SRD=6, MRD=7, PAG=8)=0);
   26      %IF LENGTHC(PRM_IDS) = 0;
   27      %EQU PRM_TYPE_BIT = 1;
   28      %EQU PRM_TYPE_BYTE = 2;
   29      %EQU PRM_TYPE_TEXT = 3;
   30      %EQU PRM_TYPE_WORD = 4;
   31      %EQU PRM_TYPE_SHRBFR = 5;
   32      %EQU PRM_TYPE_USRPRM = 6;
   33      %EQU PRM_TYPE_STRUCT = 7;
   34      %EQU PRM_TYPE_STRLST = 8;
   35      %EQU PRM_TYPE_OTHER = 0;
   36      %ENDIF;
   37      %SET PRM_IDS = CONCAT(PRM_IDS, BINASC(ID));
14:56 JUL 28 '97 KV_PRMTBL_M.:E05SI                                        2    
   38      %LSET INDX = 0;
   39      %SET PRM_TYPES = CONCAT(PRM_TYPES, BINASC(TYPE));
   40      %LSET STR_OFF = 16-8*BITBIN(TYPE < 4)-7*BITBIN(TYPE < 2);
   41      %ERROR(MOD(OFFSET, STR_OFF) ~= 0, CONCAT('*** Improperly aligned item - ', TEXTCHAR(OFFSET)));
   42      %LSET STR_OFF = STR*4096+(OFFSET)/STR_OFF;
   43      %IF TYPE < 2;                           /* BIT OR OTHER                       */
   44         %LSET INDX = LENGTHC(PRM_BITS)/2;
   45         %SET PRM_BITS = CONCAT(PRM_BITS, BINASC(STR_OFF/256), BINASC(MOD(STR_OFF, 256)));
   46      %ELSEIF TYPE = 2 OR TYPE = 4;           /* BINS                               */
   47         %LSET INDX = LENGTHC(PRM_BINS)/2;
   48         %LSET MX = 65535-65280*BITBIN(TYPE = 2);
   49         %LSET MX = MAX-BITBIN(MAX>MX)*(MAX-MX);
   50         %SET PRM_MIN = CONCAT(PRM_MIN, BINASC(MIN/256), BINASC(MOD(MIN, 256)));
   51         %SET PRM_MAX = CONCAT(PRM_MAX, BINASC(MX/256), BINASC(MOD(MX, 256)));
   52         %SET PRM_BINS = CONCAT(PRM_BINS, BINASC(STR_OFF/256), BINASC(MOD(STR_OFF, 256)));
   53      %ELSEIF TYPE = 3 OR TYPE = 5;           /* TEXT OR SHRBFR                     */
   54         %LSET INDX = LENGTHC(PRM_BFRS)/2;
   55         %SET PRM_BFRS = CONCAT(PRM_BFRS, BINASC(STR_OFF/256), BINASC(MOD(STR_OFF, 256)));
   56         %SET PRM_BFRLNG = CONCAT(PRM_BFRLNG, BINASC(BFRLNG));
   57         %SET PRM_BFRTYP = CONCAT(PRM_BFRTYP, BINASC(BFRTYP));
   58      %ELSEIF TYPE=7 OR TYPE=8;               /* STRUCTURE                          */
   59         %LSET STR_OFF=MAX/8;
   60         %KV_SUBSTR (OFFSET=STR_OFF); /* ID=0 ENTRY TO END PREVIOUS, SIZE IN OFFSET */
   61         %LSET INDX=LENGTHC(PRM_STRID);
   62      %ENDIF;
   63      %SET PRM_INDX = CONCAT(PRM_INDX, BINASC(INDX));
   64      %MEND;
   65      %MACRO KV_SUBSTR(ID = 0, OFFSET = 0, TYPE(BIT = 0, BITCND = 1, BIN2 = 2, BIN3 = 3, BIN4 = 4, BIN5 = 5, BIN6 = 6,
   66                       BIN7 = 7, EXTBIT = 8, BYT = 9, BYTCND = 10, BFR = 11, OTHER = 12) = 0);
   67      %IF LENGTHC(PRM_STRID) = 0;
   68      %EQU PRM_STR_TYPE_OTHER = 12;
   69      %EQU PRM_STR_TYPE_BIT = 0;
   70      %EQU PRM_STR_TYPE_BITCND = 1;
   71      %EQU PRM_STR_TYPE_EXTBIT = 8;
   72      %EQU PRM_STR_TYPE_BYT = 9;
   73      %EQU PRM_STR_TYPE_BYTCND = 10;
   74      %EQU PRM_STR_TYPE_BFR = 11;
14:56 JUL 28 '97 KV_PRMTBL_M.:E05SI                                        3    
   75      %ENDIF;
   76      %SET PRM_STRID = CONCAT(PRM_STRID, BINASC(ID));
   77      %LSET TYP_OFF = 16-8*BITBIN(TYPE < 12)-7*BITBIN(TYPE < 9);
   78      %ERROR(MOD(OFFSET, TYP_OFF) ~= 0, CONCAT('*** Improperly aligned subitem - ', TEXTCHAR(OFFSET)));
   79      %LSET TYP_OFF = TYPE*4096+OFFSET/TYP_OFF;
   80      %IF LENGTHC(PRM_STRS)<254;
   81      %SET PRM_STRS = CONCAT(PRM_STRS, BINASC(TYP_OFF/256), BINASC(MOD(TYP_OFF, 256)));
   82      %ELSE;
   83      %SET PRM_STRS2 = CONCAT(PRM_STRS2, BINASC(TYP_OFF/256), BINASC(MOD(TYP_OFF, 256)));
   84      %ENDIF;
   85      %MEND;
   86      %MACRO KV_END_PARMS;
   87      %LSET LISTDIR = '0'B;
   88      %LSET LISTEXP = '1'B;
   89      %LSET LISTMAC = '1'B;
   90      %LSET LISTINC = '1'B;
   91      %IF TEXTCHAR(CVERSION)~='1';
   92      DCL 1 KV_PRMTBL CONSTANT SYMDEF,
   93            2 IDS CHAR(0) INIT(%PRM_IDS),
   94      %LSET HOLE = CHARTEXT(SUBSTR('2 * CHAR(1), ', 0, 12*MOD(LENGTHC(PRM_IDS), 2)));
   95              %HOLE
   96                2 TYPES CHAR(0) INIT(%PRM_TYPES),
   97                2 TYPE(0:%(LENGTHC(PRM_IDS)-1)) REDEF TYPES UBIN BYTE CALIGNED,
   98                %HOLE
   99                2 INDXS CHAR(0) INIT(%PRM_INDX),
  100                2 INDX(0:%(LENGTHC(PRM_IDS)-1)) REDEF INDXS UBIN BYTE CALIGNED;
  101      DCL 1 KV_WHERES CONSTANT SYMDEF, 2 * CHAR(0) INIT(%PRM_BITS),
  102            2 * CHAR(0) INIT(%PRM_BINS), 2 * CHAR(0) INIT(%PRM_BFRS);
  103      %LSET SIZE = LENGTHC(PRM_BITS)+LENGTHC(PRM_BINS)+LENGTHC(PRM_BFRS);
  104      DCL 1 KV_WHERE(0:%(SIZE/2-1)) REDEF KV_WHERES,
  105            2 STRUCTURE UBIN(4)UNAL,
  106            2 OFFSET UBIN(12) UNAL;
  107      DCL KV_WHROFFS(0:7) CONSTANT UBIN
  108      %LSET OFF_BINS = LENGTHC(PRM_BITS)/2;
  109      %LSET OFF_BFRS = OFF_BINS+LENGTHC(PRM_BINS)/2;
  110                INIT(0, 0, %OFF_BINS, %OFF_BFRS, %OFF_BINS, %OFF_BFRS, 0, 0);
  111      DCL KV_MINS CONSTANT SYMDEF CHAR(0) INIT(%PRM_MIN);
14:56 JUL 28 '97 KV_PRMTBL_M.:E05SI                                        4    
  112      DCL KV_MIN(0:%(LENGTHC(PRM_BINS)/2-1)) REDEF KV_MINS UBIN;
  113      DCL KV_MAXS CONSTANT SYMDEF CHAR(0) INIT(%PRM_MAX);
  114      DCL KV_MAX(0:%(LENGTHC(PRM_BINS)/2-1)) REDEF KV_MAXS UBIN;
  115      DCL KV_BFRLNGS CONSTANT SYMDEF CHAR(0) INIT(%PRM_BFRLNG);
  116      DCL KV_BFRLNG(0:%(LENGTHC(PRM_BFRS)/2-1)) REDEF KV_BFRLNGS UBIN BYTE CALIGNED;
  117      DCL KV_BFRTYPS CONSTANT SYMDEF CHAR(0) INIT(%PRM_BFRTYP);
  118      DCL KV_BFRTYP(0:%(LENGTHC(PRM_BFRS)/2-1)) REDEF KV_BFRTYPS UBIN BYTE CALIGNED;
  119      %SET PRM_STRS2 = CONCAT(PRM_STRS2, '  ');
  120      %SET PRM_STRID = CONCAT(PRM_STRID, BINASC(0));
  121      DCL 1 KV_STRS CONSTANT SYMDEF, 2 * CHAR(0) INIT(%PRM_STRS),2 * CHAR(0) INIT(%PRM_STRS2);
  122      DCL 1 KV_STR(0:%(LENGTHC(PRM_STRID)-1)) REDEF KV_STRS,
  123            2 TYPE UBIN(4)UNAL,
  124            2 OFFSET UBIN(12) UNAL;
  125      DCL KV_STRIDS CONSTANT SYMDEF CHAR(0) INIT(%PRM_STRID);
  126      DCL KV_STRID(0:%(LENGTHC(PRM_STRID)-1)) REDEF KV_STRIDS UBIN BYTE UNAL;
  127      %ELSE;
  128      DCL KV_PRMTBL_IDS CONSTANT SYMDEF CHAR(0)INIT(%PRM_IDS);
  129      DCL KV_PRMTBL_TYPE CONSTANT SYMDEF CHAR(0)INIT(%PRM_TYPES);
  130      DCL KV_PRMTBL_INDX CONSTANT SYMDEF CHAR(0)INIT(%PRM_INDX);
  131      DCL 1 KV_WHERE CONSTANT SYMDEF,2 * CHAR(0)INIT
  132      (%PRM_BITS),2 * CHAR(0)INIT(%PRM_BINS),2 * CHAR(0)INIT(%PRM_BFRS);
  133      DCL KV_WHROFFS(0:7)CONSTANT SYMDEF UBIN
  134      %SET OFF_BINS=LENGTHC(PRM_BITS)/ 2;
  135      %SET OFF_BFRS=OFF_BINS+LENGTHC(PRM_BINS)/ 2;
  136      INIT(0,0,%OFF_BINS,%OFF_BFRS,%OFF_BINS,%OFF_BFRS,0,0);
  137      DCL KV_MIN CONSTANT SYMDEF CHAR(0)INIT(%PRM_MIN);
  138      DCL KV_MAX CONSTANT SYMDEF CHAR(0)INIT(%PRM_MAX);
  139      DCL KV_BFRLNG CONSTANT SYMDEF CHAR(0)INIT(%PRM_BFRLNG);
  140      DCL KV_BFRTYP CONSTANT SYMDEF CHAR(0)INIT(%PRM_BFRTYP);
  141      %SET PRM_STRS2=CONCAT(PRM_STRS2,'  ');
  142      %SET PRM_STRID=CONCAT(PRM_STRID,BINASC(0));
  143      DCL 1 KV_STRS CONSTANT SYMDEF,2 * CHAR(0)INIT(%PRM_STRS),2 * CHAR(0)INIT(%PRM_STRS2);
  144      DCL KV_STRID CONSTANT SYMDEF CHAR(0)INIT(%PRM_STRID);
  145      %ENDIF;
  146      %MEND;

