
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:1    
        1        1        /*M*   ZIU$Q2IN          I-D-S/II       UTILITY INITIALIZE   */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*P*
        8        8        NAME: Q2IN
        9        9        PURPOSE:  INITIALIZES AN AREA IN A SCHEMA
       10       10         ********************************************************/
       11       11        ZIU$Q2IN: PROC ALTRET;
       12       12    1   DCL TOT_PGS UBIN(36) STATIC ALIGNED;
       13       13    1   DCL CALC_TEMP SBIN(36) STATIC ALIGNED;
       14       14    1   DCL CALC_KY_SZ SBIN(36) STATIC ALIGNED; /*Calc header size*/
       15       15    1   DCL PTR_LEN SBIN SYMREF ALIGNED;
       16       16    1   DCL CALC_HDR_SIZE SBIN STATIC ALIGNED;
       17       17    1   DCL 1 REC_HDR BASED(REC$) CALIGNED,
       18       18    1         2 REC_TYP UBIN(18) CALIGNED,
       19       19    1         2 REC_SZ UBIN(18) CALIGNED;
       20       20    1   DCL PTR_V CHAR(PTR_LEN) BASED CALIGNED;
       21       21    1   DCL PAGES_PER_HDR UBIN HALF STATIC ALIGNED;
       22       22    1   DCL HDRS_PER_PAGE UBIN HALF STATIC UNAL;
       23       23    1   DCL PAGES_INIT SBIN STATIC ALIGNED;
       24       24    1   DCL P$ PTR STATIC INIT(ADDR(CHAR10));
       25       25    1   DCL C_V CHAR(X) BASED(P$);
       26       26    1   DCL CHAR10 CHAR(10) STATIC;
       27       27    1   DCL CPLTE_INT SBIN(36) STATIC ALIGNED; /*Complete init switch(bit)*/
       28       28    1   DCL TOT_DBK SBIN STATIC ALIGNED;
       29       29    1   DCL CALC_TEMP2 SBIN(36) STATIC ALIGNED;
                29            /*Varible used for  less than 1 calc hdr per page*/
       30       30    1   DCL X1 SBIN WORD STATIC ALIGNED; /*D* X1=NUMBER OF DATA PAGES */
       31       31    1   DCL X2 SBIN WORD STATIC ALIGNED; /*D* X2=NUMBER OF INV PAGES */
       32       32    1   DCL CALC_TOT SBIN WORD STATIC ALIGNED;
                32            /*D* CALC_TOT = TOTAL CALC HDRS IN THIS AREA*/
       33       33    1   DCL TSTMP BIT(36) ALIGNED;
       34       34    1   DCL 1 FILE# STATIC,
       35       35    1         2 CNT UBIN(9) UNAL,
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:2    
       36       36    1         2 NAME CHAR(31) UNAL;
       37       37        /**/
       38       38    1   DCL DB_FUNC_FRS ENTRY(2) ALTRET;
       39       39    1   DCL DB_FUNC_FOR ENTRY(1) ALTRET;
       40       40    1   DCL DB_FUNC_GET ENTRY(1) ALTRET;
       41       41    1   DCL 1 EIS BASED ALIGNED,
       42       42    1         2 * UBIN(3) UNAL,
       43       43    1         2 BYT_OFF UBIN(17) UNAL,
       44       44    1         2 * UBIN(16) UNAL;
       45       45        %INCLUDE ZI_RVA_C;
       46      726        %CAN_RVA_REF;
       47     1045    1   DCL SYS_FUNC_OPEN ENTRY ALTRET;
       48     1046    1   DCL SYS_FUNC_CLOS ENTRY ALTRET;
       49     1047    1   DCL SYS_FUNC_RELEASE ENTRY ALTRET;
       50     1048    1   DCL SYS_FUNC_READ ENTRY ALTRET;
       51     1049    1   DCL SYS_FUNC_WRIT ENTRY ALTRET;
       52     1050    1   DCL SYS_FUNC_TSTAMP ENTRY ALTRET;
       53     1051    1   DCL SYS_FUNC_REW ENTRY ALTRET;
       54     1052    1   DCL SYS_FUNC_ERRMSG ENTRY ALTRET;
       55     1053    1   DCL SYS_FUNC_RELDCB ENTRY ALTRET;
       56     1054    1   DCL DB_FUNC_FIN ENTRY ALTRET;
       57     1055    1   DCL EXECUTION_OUTPUT ENTRY;
       58     1056    1   DCL EXCTN_REPRT_SETUP ENTRY;
       59     1057    1   DCL CHKSUM ENTRY;
       60     1058    1   DCL ZERO_SUP ENTRY(3);
       61     1059    1   DCL GET_FILESZ ENTRY ALTRET;
       62     1060    1   DCL NBUFS SBIN SYMREF; /* # OF BUFS ALLOC IN I_O_BUF */
       63     1061        /**/
       64     1062        %INCLUDE CP_6;
       65     1143        %INCLUDE CP_6_SUBS;
       66     1683        %VLP_ALTKEYS(STCLASS=SYMREF);
       67     1698        %F$DCB (DCBN=F$DCB);
       68     1755        %INCLUDE ZI_ERRORS_SUBS;
       69     2275        %INCLUDE ZI_UWA_C;
       70     2965        %ZI$UWAB;
       71     3305        %INCLUDE ZI$DIR;
       72     3462        %DIR;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:3    
       73     3606        %INCLUDE ZI_GLOBAL_DBUTIL;
       74     3784        %MISC_DCLS;
       75     3837        %SYS_FUNC;
       76     3929        %INCLUDE ZI$PG_STRUCTS;
       77     4032        %ATBLK_PG;
       78     4088        %DATA_PG;
       79     4107        %INVTY_PG;
       80     4123        %INCLUDE B$JIT;
       81     4413        %INCLUDE B$ROSEG;
       82     4476        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:4    
       83     4477        /*
       84     4478                 SUBR:  ERR_MSG TRANSFER CALL TO SYS_FUNC_ERRMSG
       85     4479                        FOR MESSAGES WITH ONLY %U1 AND FIX TO ZI$DIR.AREA_NM
       86     4480        */
       87     4481    1   ERR_MSG: PROC(ERR#,FLAG#);
       88     4482
       89     4483    2   DCL ERR# SBIN; /* INPUT: ERR_CODE */
       90     4484    2   DCL FLAG# SBIN; /* AND ERROR FLAG */
       91     4485
       92     4486    2       ERRCODESF.ERR# = ERR#;
       93     4487    2       ERRFLGSF = FLAG#;
       94     4488    2       MSGCODE = ERRCODE_RDEF;
       95     4489    2       ERR_INSERT(0) = ZI$DIR.AREA_NM; /* FIX CODE TO SUB %U1 */
       96     4490    2       CALL SYS_FUNC_ERRMSG;
       97     4491    2   END ERR_MSG;
       98     4492
       99     4493        /*
      100     4494                 SUBR  CALC_TOTAL CALCULATE THE TOT_PGS BASED ON TOT_DBK
      101     4495        */
      102     4496    1   CALC_TOTAL: PROC;
      103     4497
      104     4498    2       INIT_RG.SECRNG(0)=(TOT_DBK+UWA.AC_REC.LPP-1)/UWA.AC_REC.LPP;
      105     4499    2       TOT_PGS = INIT_RG.SECRNG(0);
      106     4500    2       IF UWA.AC_REC.FIR_INV_PG > 0 THEN
      107     4501    2           TOT_PGS = TOT_PGS + (TOT_PGS+4071) / 4072;
      108     4502         /* NUMBER OF DATA PAGES + INV PAGES */
      109     4503    2   END CALC_TOTAL;
      110     4504        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:5    
      111     4505        /*
      112     4506                 SUBR:  OPEN  TRANSFERS CALLS TO SYS_FUNC_OPEN
      113     4507                        INPUT FUNSF AND ORGSF
      114     4508        */
      115     4509    1   OPEN: PROC(FUN,ORG) ALTRET;
      116     4510
      117     4511    2   DCL FUN SBIN;
      118     4512    2   DCL ORG SBIN;
      119     4513
      120     4514    2       DCBSF = ZI$DIR.AREA_NM.DCB#;
      121     4515    2       TESTSF = %NO#;
      122     4516    2       ORGSF = ORG;
      123     4517    2       IF ORGSF = %KEYED# THEN
      124     4518    2           REASGNSF = %NO#; /* DONT REASSIGN WHEN CREATE KEY FILE */
      125     4519    2       ELSE
      126     4520    2           REASGNSF = %YES#;
      127     4521    2       FULLSF = %YES#;
      128     4522    2       SHARESF = %NONE#;
      129     4523    2       CARRY_ATTRIBUTESF = %NO#;
      130     4524    2       ACSSF = %DIRECT#;
      131     4525    2       ASNSF = %FILE#;
      132     4526    2       ACNT = ZI$DIR.ACNT;
      133     4527    2       FIDSF = ZI$DIR.AREA_NM.NAME.TEXT;
      134     4528    2       FUNSF = FUN; /* ONLY INPUT ARGU */
      135     4529    2       EXISTSF = %NEWFILE#;
      136     4530    2       CALL SYS_FUNC_OPEN ALTRET(ALT_RET);
      137     4531    2       RETURN;
      138     4532    2   ALT_RET: ALTRETURN;
      139     4533    2   END OPEN;
      140     4534
      141     4535        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:6    
      142     4536        /*
      143     4537                 SUBR: READ_WRITE(FLAG) CALL SYS_FUNC_READ/WRIT
      144     4538        */
      145     4539    1   READ_WRITE: PROC(FLAG) ALTRET;
      146     4540
      147     4541    2   DCL FLAG UBIN; /* FLAG=1 IF SYS_FUNC_READ, OTHERWISE WRIT */
      148     4542
      149     4543    2       DCBSF = ZI$DIR.AREA_NM.DCB#;
      150     4544    2       BUFSF = VECTOR(I_O_BUF(0));
      151     4545    2       BUFLNSF = I_O_SIZE*4096; /* I_O_SIZE IS ANOTHER INPUT */
      152     4546    2       KEYVSF.IDSKEY = I_O_KEY; /* THIS IS THE THIRD INPUT */
      153     4547    2       FULLSF = %YES#;
      154     4548    2       KEYSF = %YES#;
      155     4549    2       NOTIMESF = %YES#;
      156     4550    2       VFCSF = %NO#;
      157     4551    2       ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;
      158     4552    2       IF FLAG=1 THEN
      159     4553    2           CALL SYS_FUNC_READ ALTRET(ALTRTN);
      160     4554    2       ELSE
      161     4555    2           CALL SYS_FUNC_WRIT ALTRET(ALTRTN);
      162     4556    2       RETURN;
      163     4557    2   ALTRTN: ALTRETURN;
      164     4558    2   END READ_WRITE;
      165     4559        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:7    
      166     4560
      167     4561        /*E* ERROR: ZIU-DBU#INITMP-C
      168     4562        MESSAGE: "%U1" is defined as a temporary area in the schema DDL;
      169     4563                 it is initialized during runtime when it is READYed. */
      170     4564
      171     4565        /*E* ERROR: ZIU-DBU#NOENCRP-C
      172     4566        MESSAGE: Encryption required for %U1.  No encryption seed has been specified.
      173     4567                 Encryption seed is assumed to be '0' or 'NULL'. */
      174     4568
      175     4569        /*E* ERROR: ZIU-DBU#IGNOENCP-0
      176     4570        MESSAGE: Encryption not defined but specified for area "%U1" - ignored. */
      177     4571
      178     4572        /*E* ERROR: ZIU-DBU#RNGKYCLS-C
      179     4573        MESSAGE: KEY clause ignored on partial initialization of %U1.  */
      180     4574
      181     4575        /*E* ERROR: ZIU-DBU#BADKYCLS-C
      182     4576        MESSAGE: KEY clause ignored on directive because "%U1" is not a TEMPLATE area. */
      183     4577
      184     4578        /*E* ERROR: ZIU-DBU#TMPLTAREA-C
      185     4579        MESSAGE: "%U1" is defined as a template area by the schema DMCL. */
      186     4580
      187     4581        /*E* ERROR: ZIU-DBU#NOKYCLS-C
      188     4582        MESSAGE: No KEY clause present in the directive.
      189     4583                 Default values in schema DMCL are used for this operation. */
      190     4584
      191     4585        /*E* ERROR: ZIU-DBU#MXKYCLS-C
      192     4586        MESSAGE: Value specified in KEY ALLOCATION clause is greater than
      193     4587                       the maximum reserved keys(maximum used instead). */
      194     4588
      195     4589        /*E* ERROR: ZIU-DBU#MNKYCLS-C
      196     4590        MESSAGE: Value in KEY clause less than minimum allowed for %U1.
      197     4591                 The number of allocation keys in DMCL is used instead. */
      198     4592        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:8    
      199     4593        /*
      200     4594              ZIU$Q2IN - DBUTIL INIT PROCESSING STARTS HERE.
      201     4595        */
      202     4596    1       PAGES_INIT=0; /* COUNTER FOR NUMBER PAGES INITED */
      203     4597    1       CPLTE_INT=0; /* SET TO PARTIAL INIT FIRST */
      204     4598    1       IF UWA.AC_REC.PERMTYPE=1 THEN
      205     4599    2       DO;
      206     4600    2           CALL ERR_MSG(DBU#INITMP,0); /* TEMP AREA SHOULD NOT BE INIT */
      207     4601    2           ICNT = -1;
      208     4602    2           RETURN;
      209     4603    2           END;
      210     4604    1       IF UWA.AC_REC.PG_TYPE>0 THEN GOTO INIT_INDEX; /* MAY BE INDEX */
      211     4605
      212     4606    1       IF UWA.AC_REC.SWS.ENCRYP AND ZI$DIR.ENCRPT=%NO# THEN
      213     4607    1           CALL ERR_MSG(DBU#NOENCRP,0); /* ENCRYP SEED NOT GIVEN */
      214     4608    1       IF UWA.AC_REC.SWS.ENCRYP=%NO# AND ZI$DIR.ENCRPT THEN
      215     4609    2       DO; /* AREA IS NOT ENCRYPTED BUT CRPT SPECIFIED */
      216     4610    2           ZI$DIR.ENCP_SEED_RD=0; /* IGNORE IT */
      217     4611    2           CALL ERR_MSG(DBU#IGNOENCP,0); /* AND GIVE A WARNING */
      218     4612    2           END;
      219     4613
      220     4614    1       TOT_DBK = UWA.AC_REC.KEY_ALLOC; /* SET DEFAULT DBK = DMCL DEF */
      221     4615    1       IF ICNT>=0 AND ZI$DIR.INIT_TMPLT_KEY>0 THEN
      222     4616    1           CALL ERR_MSG(DBU#RNGKYCLS,0); /* KEY IGNORED ON PARTIAL INIT */
      223     4617    1       IF ICNT=-1 THEN /* NO PAGE RANGE SPECIFIED */
      224     4618    2       DO; /* THIS IS A FULL INIT OF AREA */
      225     4619    2           ICNT=0;
      226     4620    2           INIT_RG.FIRNG(0)=0; /* STARTING FROM PAGE 0 */
      227     4621    2           CPLTE_INT = 1; /* SET FULL INIT FLAG */
      228     4622    2           IF UWA.AC_REC.SWS.TEMPLAT~='1'B AND
      229     4623    2              ZI$DIR.INIT_TMPLT_KEY>0 THEN /* NOT TEMPLATE BUT KEY SPECIFIED */
      230     4624    2               CALL ERR_MSG(DBU#BADKYCLS,1); /* GIVE A WARNING */
      231     4625    2           ELSE
      232     4626    2               IF UWA.AC_REC.SWS.TEMPLAT THEN
      233     4627    3               DO;
      234     4628    3                   CALL ERR_MSG(DBU#TMPLTAREA,0); /* MSG RECONIZING TMPLAT */
      235     4629    3                   IF ZI$DIR.INIT_TMPLT_KEY=0 THEN /* IF NO KEY SPECIFIED */
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:9    
      236     4630    3                       CALL ERR_MSG(DBU#NOKYCLS,0); /* TELL HIM DEFAULT USED */
      237     4631    3                   ELSE
      238     4632    4                   DO; /* KEY SPECIFIED, CHK IF IT IS A GOOD KEY */
      239     4633    4                       IF ZI$DIR.INIT_TMPLT_KEY>UWA.AC_REC.KEY_ALLOC+
      240     4634    4                          UWA.AC_REC.KEYS_RESER THEN
      241     4635    5                       DO; /* KEY SPECIFIED IS BIGGER THAN MAXIMUN */
      242     4636    5                           TOT_DBK = UWA.AC_REC.KEY_ALLOC+UWA.AC_REC.KEYS_RESER;
      243     4637    5                           CALL ERR_MSG(DBU#MXKYCLS,2); /* 2 STARS MSG */
      244     4638    5                           END;
      245     4639    4                       ELSE
      246     4640    4                           IF ZI$DIR.INIT_TMPLT_KEY<UWA.AC_REC.KEY_ALLOC THEN
      247     4641    4                               CALL ERR_MSG(DBU#MNKYCLS,2); /* OR SMALLER THAN MIN */
      248     4642    4                           ELSE
      249     4643    4                               TOT_DBK=ZI$DIR.INIT_TMPLT_KEY; /* KEY IS GOOD */
      250     4644    4                       END;
      251     4645    3                   END;
      252     4646         /* NOW WE HAVE TOTAL_DBKEYS IN THE AREA FIGURED OUT */
      253     4647    2           TOT_PGS=(TOT_DBK+UWA.AC_REC.LPP-1)/UWA.AC_REC.LPP;
      254     4648    2           INIT_RG.SECRNG(0)=TOT_PGS; /* THEN COMPUTE NUMBER OF PAGES */
      255     4649    2           IF UWA.AC_REC.FIR_INV_PG>0 THEN
      256     4650    2               TOT_PGS=TOT_PGS+(TOT_PGS+4071)/4072; /* AND INV PAGES */
      257     4651    2           END;
      258     4652        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:10   
      259     4653        /*
      260     4654                 THIS SECTION WILL BUILD OR RE-BUILD THE ALTBLK PAGE
      261     4655                 DEPENDING UPON PAGE 0 SPECIFIED OR NOT
      262     4656        */
      263     4657    1       IF CPLTE_INT=1 THEN
      264     4658    2       DO;
      265     4659    2           XTENSIZESF = 1;
      266     4660    2           CALL OPEN(%CREATE#,%IDS#) ALTRET(ALTEND_ZIU$Q2IN);
      267     4661    2           CALL SYS_FUNC_RELEASE; /* SO DELETE EXISTING FILE */
      268     4662    2           XTENSIZESF = TOT_PGS + 1;
      269     4663    2           CALL OPEN(%CREATE#,%IDS#) ALTRET(ALTEND_ZIU$Q2IN);
      270     4664    2           END;
      271     4665    1       ELSE
      272     4666    1           CALL OPEN(%UPDATE#,%IDS#) ALTRET(ALTEND_ZIU$Q2IN);
      273     4667    1       FILE# = DCBADDR(DCBSF) -> F$DCB.NAME# ; /* GET FID FROM DCB */
      274     4668    1       IF DCBADDR(DCBSF) -> F$DCB.ORG# ~= %IDS# THEN
      275     4669    2       DO;
      276     4670    2           ZI$DIR.AREA_NM.NAME=FILE#;
      277     4671        /*E* ERROR: ZIU-DBU#NONIDS-C
      278     4672        MESSAGE: %U1 is not an IDS file. INITialization aborted.    */
      279     4673    2           CALL ERR_MSG(DBU#NONIDS,3);
      280     4674    2           GOTO ALTEND_ZIU$Q2IN;
      281     4675    2           END;
      282     4676    1       IF CPLTE_INT ~= 1 THEN /* PARTIAL INIT */
      283     4677    2       DO I=0 TO ICNT; /* SEE IF PAGE 0 SPECIFIED */
      284     4678    2           IF INIT_RG.FIRNG(I)=0 OR INIT_RG.SECRNG(I)=0 THEN
      285     4679    3           DO;
      286     4680    3               CPLTE_INT=-1; /* MARK PARTIAL INIT WITH PAGE 0 */
      287     4681        /*
      288     4682                 NOW, WE CALCULATE TOT_DBK AND TOT_PGS BASED ON
      289     4683                 THE GRANULE SIZE OF THIS AREA
      290     4684        */
      291     4685    3               CALL GET_FILESZ; /* GET SIZE OF AREA */
      292     4686    3               TOT_PGS = XTENSIZESF - 1; /* MINUS THE ATBLK PAGE */
      293     4687    3               IF UWA.AC_REC.FIR_INV_PG = 0 THEN
      294     4688    3                   TOT_DBK=TOT_PGS*UWA.AC_REC.LPP;
      295     4689    3               ELSE /* NEED TO FIGURE OUT THE # OF INV PAGES */
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:11   
      296     4690    4               DO;
      297     4691    4                   X=(TOT_PGS+4071)/4072; /* ASSUME ALL DATA PGS */
      298     4692    5                   DO WHILE (((TOT_PGS-X)+4071)/4072<X);
      299     4693    5                       X=X-1; /* X IS THE # OF INV PAGES */
      300     4694    5                       END; /* DO NECESSARY ADJUSTMENT */
      301     4695    4                   TOT_DBK=(TOT_PGS-X)*UWA.AC_REC.LPP;
      302     4696    4                   END;
      303     4697    3               I = ICNT; /* GET OUT OF LOOP */
      304     4698    3               END;
      305     4699    2           END;
      306     4700    1       I_O_KEY=0; /* IN CASE WE READ PAGE 0 */
      307     4701    1       I_O_SIZE=1; /* OR WRITE PAGE 0 */
      308     4702    1       OUT_INDX=0; /* USE I_O_BUF(0:1023) FOR BUF */
      309     4703    1       DATA$=ADDR(I_O_BUF(0));
      310     4704    1       ATBLK$=DATA$;
      311     4705    1       IF CPLTE_INT = 0 THEN /* PARTIAL INIT WITHIN NO PAGE 0 */
      312     4706    2       DO;
      313     4707    2           CALL READ_WRITE(1) ALTRET(ALTEND_ZIU$Q2IN);
      314     4708    2           TOT_PGS = ATBLK_PG.NUM_DBPG;
      315     4709    2           TOT_DBK = ATBLK_PG.HIGH_DBK - UWA.AC_REC.BASE_DBK;
      316     4710    2           END;
      317     4711    1       X1=(TOT_DBK+UWA.AC_REC.LPP-1)/UWA.AC_REC.LPP; /* TOTAL DATAPG */
      318     4712    1       X2=TOT_PGS-X1; /* AND X2 = TOTAL INV PAGES */
      319     4713        /*
      320     4714                 NOW WE HAVE TOT_PGS,TOT_DBK IN HAND FOR ANY CPLTE_INT CASE
      321     4715                 NEXT, WE GOT TO COMPUTE THE CALC_TOT
      322     4716                 AND GET THE CURRENT TIME STAMP BEFORE WE TRY TO CALL
      323     4717                 ATBLK_SETUP WHEN CPLTE_INT=1 OR -1
      324     4718        */
      325     4719    1       TSTAMPSF=VECTOR(TSTMP);
      326     4720    1       DATESF=VECTOR(NIL);
      327     4721    1       SOURCESF=%CLOCK#;
      328     4722    1       DESTSF=%UTS#;
      329     4723    1       CALL SYS_FUNC_TSTAMP;
      330     4724    1       CALC_TEMP2=0; /* THIS IS #CALC_HDRS PER PAGE */
      331     4725    1       CALC_TOT=0;
      332     4726    1       IF UWA.AC_REC.CALC_NULL=1 THEN
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:12   
      333     4727    1           CALC_TEMP = 0; /* NO CALC HDRS IN THIS AREA */
      334     4728    1       ELSE
      335     4729    1           IF UWA.AC_REC.LPP >= UWA.AC_REC.IDB THEN
      336     4730    1               CALC_TEMP=UWA.AC_REC.LPP/UWA.AC_REC.IDB; /*Find interval for calc hdrs*/
      337     4731    1           ELSE
      338     4732    1               CALC_TEMP2=UWA.AC_REC.IDB/UWA.AC_REC.LPP;
      339     4733    1       IF CALC_TEMP ~= 0 OR CALC_TEMP2 ~= 0 THEN
      340     4734    2       DO;
      341     4735    2           CALC_TOT = (TOT_DBK+(UWA.AC_REC.IDB-1))/UWA.AC_REC.IDB;
      342     4736    2   PRIME:  IF CALC_TOT > 3 THEN /* FIND THE CLOSEST PRIME # */
      343     4737    3           DO;
      344     4738    3               IF MOD(CALC_TOT,2)=0 THEN
      345     4739    3                   CALC_TOT=CALC_TOT-1;
      346     4740    4               DO X = 3 TO CALC_TOT/2 BY 2;
      347     4741    4                   IF MOD(CALC_TOT,X)=0 THEN
      348     4742    5                   DO;
      349     4743    5                       CALC_TOT=CALC_TOT-1;
      350     4744    5                       GOTO PRIME;
      351     4745    5                       END;
      352     4746    4                   END;
      353     4747    3               END;
      354     4748    2           END;
      355     4749    1       IF CALC_TEMP2 ~= 0 THEN CALC_TEMP=0;
      356     4750    1       PAGES_PER_HDR=CALC_TEMP2; /* REMBER THIS */
      357     4751    1       HDRS_PER_PAGE=CALC_TEMP; /* AND THIS */
      358     4752    1       PTR_LEN=UWA.OA_REC.GLBL+1; /* GLOBAL POINTER SIZE */
      359     4753    1       CALC_HDR_SIZE=4+2*PTR_LEN; /* *CALC.RC RECORD SIZE */
      360     4754    1       IF CPLTE_INT~=0 THEN /* SEE IF UPDATE PAGE 0 */
      361     4755    2       DO; /* FULL INIT OR PARTIAL INIT WITHIN PAGE 0 */
      362     4756    2           DATA_PG='0'B;
      363     4757    2           CALL ATBLK_PG_SETUP; /* BUILD ALBLK PAGE */
      364     4758    2           CALL READ_WRITE(0) ALTRET(ALTEND_ZIU$Q2IN);
      365     4759    2           CALL EXCTN_REPRT_SETUP; /* PREPARE DATA FOR REPORT */
      366     4760    2           END;
      367     4761        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:13   
      368     4762        /*
      369     4763                 INIT PAGE RANGES AS SPECIFIED
      370     4764        */
      371     4765    2       DO I=0 TO ICNT;
              4765                /*Start reading from the page range array gotten from directive*/
      372     4766    2           RB=INIT_RG.FIRNG(I); /*Beginning range*/
      373     4767    2           RE=INIT_RG.SECRNG(I); /*Ending page range*/
      374     4768    2           IF RB>RE THEN /* REVERSE THE RANGE IF WRONG */
      375     4769    3           DO;
      376     4770    3               INIT_RG.FIRNG(I)=RE;
      377     4771    3               INIT_RG.SECRNG(I)=RB;
      378     4772    3               RB=RE;
      379     4773    3               RE=INIT_RG.SECRNG(I);
      380     4774    3               CALL ERR_MSG(1003,0); /* GIVE A WARNING MESSAGE */
      381     4775    3               END;
      382     4776    2           IF RB=0 AND RE =0 THEN GOTO NEXT_RANGE;
      383     4777    2           IF RB=0 THEN RB=1;
      384     4778    2           IF RE>X1 THEN /* IF PAGE RANGE OVER INV PAGES */
      385     4779    3           DO;
      386     4780        /***************************************************/
      387     4781        /*E* ERROR: ZIU-DBU#BADRNG-C
      388     4782        MESSAGE: Page range for %U1 is greater than or equal to the first inventory page.
      389     4783        */
      390     4784        /*******************************************************/
      391     4785    3               CALL ERR_MSG(DBU#BADRNG,3); /* DESERVE A 3 STARS */
      392     4786    3               ICNT=-1; /*Initialize icnt for init all*/
      393     4787    3               GOTO ALTEND_ZIU$Q2IN;
      394     4788    3               END;
      395     4789    2   BUF_FULL: /* RESTART INIT PAGES AFTER LAST BLOCK WRITTEN */
      396     4790    2           I_O_SIZE = RE - RB + 1;
      397     4791    2           IF I_O_SIZE > 2*NBUFS THEN
      398     4792    2               I_O_SIZE = 2*NBUFS; /* USE MAX SIZE OF BUF */
      399     4793    2           OUT_INDX=0; /* NOTHING IN THE NEW BLOCK */
      400     4794    2           I_O_KEY = RB; /* REM FIRST RB FOR IDSKEY */
      401     4795    3           DO RB=RB TO RE BY 1;
      402     4796    3               IF BREAK_FLAG > 0 THEN
      403     4797    4               DO;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:14   
      404     4798    4                   DCBSF = ZI$DIR.AREA_NM.DCB#;
      405     4799    4                   CALL SYS_FUNC_CLOS;
      406     4800    4                   UNWIND TO RESTART;
      407     4801    4                   END;
      408     4802    3               DATA$=ADDR(I_O_BUF(OUT_INDX)); /*Ptr to page to be inited*/
      409     4803    3               CALL DPG_SETUP ;
      410     4804    3               OUT_INDX=OUT_INDX+1;
      411     4805    3               IF OUT_INDX = I_O_SIZE THEN
      412     4806    4               DO;
      413     4807    4                   CALL READ_WRITE(0) ALTRET(ALTEND_ZIU$Q2IN);
      414     4808    4                   RB=RB+1; /* SIMULATE DO RB LOOP */
      415     4809    4                   GOTO BUF_FULL;
      416     4810    4                   END;
      417     4811    3               END;
      418     4812    2   NEXT_RANGE:
      419     4813    2           END;
      420     4814        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:15   
      421     4815        /*
      422     4816                 NOW WE ARE GOING TO UPDATE THE INVENTORY PAGES
      423     4817        */
      424     4818    1       IF X2=0 THEN GOTO END_ZIU$Q2IN; /* NO INV PAGES AT ALL */
      425     4819    2       DO I=0 TO ICNT; /* LOOP THRU PAGE RANGE */
      426     4820    2           RB=INIT_RG.FIRNG(I);
      427     4821    2           RE=INIT_RG.SECRNG(I);
      428     4822    2           IF RB=0 AND RE=0 THEN GOTO NEXT_INV_RANGE;
      429     4823    2           IF RB=0 THEN RB=1;
      430     4824    2           IB=(RB+4071)/4072+X1; /* FIRST INV PAGE # */
      431     4825    2           IE=(RE+4071)/4072+X1; /* LAST INV PAGE # */
      432     4826    2   INV_BUF_FULL:
      433     4827    2           I_O_SIZE = IE - IB + 1;
      434     4828    2           IF I_O_SIZE > 2*NBUFS THEN
      435     4829    2               I_O_SIZE = 2*NBUFS;
      436     4830    2           OUT_INDX = 0;
      437     4831    2           INVPG$=ADDR(I_O_BUF(0));
      438     4832    2           DATA$ = INVPG$;
      439     4833    2           I_O_KEY = IB;
      440     4834    2           IF CPLTE_INT < 1 THEN /* THIS IS A PARTIAL INIT */
      441     4835    2               CALL READ_WRITE(1) ALTRET(ALTEND_ZIU$Q2IN);
      442     4836    3           DO RB = RB TO RE;
      443     4837    3               IF MOD(RB+4071,4072)=0 AND CPLTE_INT=1 THEN
      444     4838    3                   CALL INVPG_SETUP; /* FOR FULL INIT, SETUP HEADER */
      445     4839    3               X=MOD(RB-1,4072);
      446     4840    3               INV_PG.INVENT_CT(X)='777'O;
      447     4841    3               IF MOD(RB,4072)=0 THEN /* SWITCH TO NEXT INV */
      448     4842    4               DO;
      449     4843    4                   IF UWA.AC_REC.SWS.CHECKSUM THEN
      450     4844    4                       CALL GET_CHKSUM;
      451     4845    4                   OUT_INDX=OUT_INDX+1;
      452     4846    4                   INVPG$=ADDR(I_O_BUF(OUT_INDX));
      453     4847    4                   DATA$=INVPG$;
      454     4848    4                   IB = IB + 1; /* INCREMENT INV PAGE # */
      455     4849    4                   IF OUT_INDX=I_O_SIZE THEN
      456     4850    5                   DO;
      457     4851    5                       CALL READ_WRITE(0) ALTRET(ALTEND_ZIU$Q2IN);
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:16   
      458     4852    5                       RB=RB+1;
      459     4853    5                       GOTO INV_BUF_FULL;
      460     4854    5                       END;
      461     4855    4                   END;
      462     4856    3               END;
      463     4857    2           IF I_O_SIZE>0 THEN /* ANY INV LEFT IN BUFFER */
      464     4858    3           DO;
      465     4859    3               IF UWA.AC_REC.SWS.CHECKSUM THEN CALL GET_CHKSUM;
      466     4860    3               CALL READ_WRITE(0) ALTRET(ALTEND_ZIU$Q2IN);
      467     4861    3               END;
      468     4862    2   NEXT_INV_RANGE:
      469     4863    2           END;
      470     4864    1       GOTO END_ZIU$Q2IN;
      471     4865        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:17   
      472     4866    1   ATBLK_PG_SETUP: PROC;
      473     4867    2       ATBLK_PG.SYS_WRDS.DATE=TSTMP;
      474     4868    2       ATBLK_PG.DB_INFO.DBK_SZ = UWA.OA_REC.GLBL+1;/*Size of gblptrs*/
      475     4869    2       IF UWA.AC_REC.FIR_INV_PG=0
      476     4870    2       THEN ATBLK_PG.DB_INFO.PRCNT_INV=0;
      477     4871    2       ELSE IF UWA.AC_REC.PER_INV >= 100 THEN
      478     4872    2               ATBLK_PG.DB_INFO.PRCNT_INV=100;
      479     4873    2           ELSE IF UWA.AC_REC.PER_INV >= 0 THEN
      480     4874    2                   ATBLK_PG.DB_INFO.PRCNT_INV = UWA.AC_REC.PER_INV;
      481     4875    2       ATBLK_PG.PG_NUM=0;
      482     4876    2       ATBLK_PG.NUM_DBPG=TOT_PGS;
      483     4877         /* Total of all data pgs + atblk + data_pgs per invpg*/
      484     4878    2       ATBLK_PG.SCHNAM=ZI$DIR.SCHEMA_NM.NAME.TEXT;
      485     4879    2       ATBLK_PG.MISC_INFO.CHKSM=UWA.AC_REC.SWS.CHECKSUM;
      486     4880    2       IF UWA.AC_REC.PER_INV ~= 0 THEN
      487     4881    2           ATBLK_PG.MISC_INFO.IUSZ=((4096*(100-UWA.AC_REC.PER_INV))+51199)/51200;
      488     4882    2       ATBLK_PG.TOT_CALC_HDRS = CALC_TOT; /*Number of calc hdrs in the area*/
      489     4883    2       ATBLK_PG.IDS_HDR = 'IDS2';
      490     4884    2       ATBLK_PG.AREA_NM = ZI$DIR.AREA_NM.NAME.TEXT;
      491     4885    2       CALL INDEX1(J,' ',ZI$DIR.AREA_NM.NAME.TEXT);
      492     4886    2       ATBLK_PG.DB_INFO.AREA_NM_SZ=J;
      493     4887    2       ATBLK_PG.DB_INFO.PG_MD = UWA.AC_REC.P_TYP.P_MD;
      494     4888    2       ATBLK_PG.LINE_INFO.LPP = UWA.AC_REC.LPP;
      495     4889    2       ATBLK_PG.HIGH_DBK=TOT_DBK+UWA.AC_REC.BASE_DBK;
      496     4890    2       ATBLK_PG.CALC_INFO.IDB = UWA.AC_REC.IDB;
      497     4891    2       IF UWA.AC_REC.FIR_INV_PG ~= 0 THEN
      498     4892    2           ATBLK_PG.FIR_INV_PGNO = X1 + 1;
      499     4893    2       ATBLK_PG.LOW_DBK = UWA.AC_REC.MIN_DBK;
      500     4894    2       IF UWA.AC_REC.SEC_KEY = 1 THEN ATBLK_PG.MISC_INFO.KEY_FILE_BLT='1'B;
      501     4895    2       ATBLK_PG.DATE_INIT=TSTMP;
      502     4896    2       IF UWA.AC_REC.SWS.CHECKSUM THEN CALL GET_CHKSUM;
      503     4897    2   END ATBLK_PG_SETUP;
      504     4898        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:18   
      505     4899    1   DPG_SETUP: PROC; /* SETUP A DATA PAGE AND INIT CALC HEADERS */
      506     4900
      507     4901    2       IF PAGES_PER_HDR > 0 THEN CALC_TEMP = 0;
      508     4902    2       PAGES_INIT=PAGES_INIT+1; /* ADD STATS COUNT */
      509     4903    2       DATA_PG = '0'B; /* ZERO OUT THIS PAGE */
      510     4904    2       DATA_PG.SYS_WRDS.DATE=TSTMP;
      511     4905    2       DATA_PG.PG_SZ.FIR=4084; /* FIXED PAGE SIZE */
      512     4906    2       DATA_PG.CON_INTRVAL = RB; /* PAGE NUMBER */
      513     4907
      514     4908    2       X = (RB-1)*UWA.AC_REC.LPP; /* X=1ST DBKEY ON PAGE -1 */
      515     4909    2       IF PAGES_PER_HDR = 0 AND HDRS_PER_PAGE = 1 THEN
      516     4910    2           CALC_TEMP = 1;
      517     4911    2       IF PAGES_PER_HDR > 0 AND MOD(RB, PAGES_PER_HDR) = 1 THEN
      518     4912    2           CALC_TEMP = 1; /*  TIME IS UP TO STORE 1 CALC HEADER */
      519     4913    2       ELSE
      520     4914    2           IF HDRS_PER_PAGE>1 AND RB=X1 THEN /* SPECIAL CHECK ON LAST PAGE */
      521     4915    2               CALC_TEMP=(TOT_DBK-X+UWA.AC_REC.IDB-1)/UWA.AC_REC.IDB;
      522     4916    2       IF CALC_TEMP=0 THEN /* NO CALC HEADER TO BE STORED */
      523     4917    3       DO;
      524     4918    3           DATA_PG.PG_SZ.SEC = 4070; /* SPACE AVAIL */
      525     4919    3           DATA_PG.OFF_LN.FIR=0; /* FIRST AVAIL LINE = 0 */
      526     4920    3           DATA_PG.OFF_LN.SEC=0; /* CURRENT HIGH LINE = 0 */
      527     4921    3           DATA_PG.OFFSET(2035)=131072; /* LET 1ST OFFSET BE 400000 */
      528     4922    3           END;
      529     4923    2       ELSE
      530     4924    3       DO; /* STORE CALC HEADERS */
      531     4925    3           K = (CALC_TEMP-1)*UWA.AC_REC.IDB; /* HIGHEST LINE USED */
      532     4926    3           IF K=0 THEN /* ONLY 1 HDR TO BE STORED */
      533     4927    4           DO;
      534     4928    4               K = 1; /* LET HIGH LINE BE 1 */
      535     4929    4               DATA_PG.OFFSET(2034)=131072; /* LET IT BE AVAILABLE */
      536     4930    4               END;
      537     4931    3           ELSE /* MORE THAN 1 CALC HEADER TO BE STORED */
      538     4932    3               DATA_PG.OFFSET(2035-K+1)=131072; /* LAST 1 IN AVAIL CHAIN */
      539     4933    3           DATA_PG.PG_SZ.SEC=4070-2*K-CALC_TEMP*CALC_HDR_SIZE;
      540     4934    3           DATA_PG.OFF_LN.FIR = 1; /* 1ST LINE IS 1 */
      541     4935    3           DATA_PG.OFF_LN.SEC = K; /* CURRENT HIGH LINE */
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:19   
      542     4936    3           X = X + UWA.AC_REC.BASE_DBK+1; /* CHANGE 1ST DBK TO GLOBAL */
      543     4937    4           DO J=0 TO CALC_TEMP-1;
      544     4938    4               DATA_PG.OFFSET(2035-J*UWA.AC_REC.IDB)=12+J*CALC_HDR_SIZE;
      545     4939    4               REC$=PINCRC(DATA$,24+J*CALC_HDR_SIZE);
      546     4940    4               REC_HDR.REC_TYP = 4000;
      547     4941    4               REC_HDR.REC_SZ = CALC_HDR_SIZE;
      548     4942    4               PINCRC(REC$,4)->PTR_V=PINCRC(ADDR(X),4-PTR_LEN)->PTR_V;
      549     4943    4               PINCRC(REC$,4+PTR_LEN)->PTR_V=PINCRC(ADDR(X),4-PTR_LEN)->PTR_V;
      550     4944    4               X = X + UWA.AC_REC.IDB; /* DBKEY FOR THE NEXT CALC HDR */
      551     4945    4               END;
      552     4946    4           DO J=1 TO K-2; /* CHAIN AVAIL LINE WHEN 2 OR MORE HDRS STORED */
      553     4947    4               IF MOD(J+1,UWA.AC_REC.IDB)>0 THEN
      554     4948    4                   DATA_PG.OFFSET(2035-J)=131072+J+1;
      555     4949    4               ELSE
      556     4950    5               DO; /* NEXT OFFSET IS OCCUIPED BY CALC.RC */
      557     4951    5                   DATA_PG.OFFSET(2035-J)=131072+J+2; /* SKIP IT */
      558     4952    5                   J = J + 1; /* SKIP UPDATE NEXT OFFSET */
      559     4953    5                   END;
      560     4954    4               END;
      561     4955    3           END;
      562     4956    2       IF UWA.AC_REC.SWS.CHECKSUM THEN
      563     4957    2           CALL GET_CHKSUM;
      564     4958    2   END DPG_SETUP;
      565     4959        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:20   
      566     4960    1   INVPG_SETUP: PROC;
      567     4961    2       DATA_PG='0'B;
      568     4962    2       INV_PG.SYS_WRDS.DATE=TSTMP;
      569     4963    2       INV_PG.PG_SZ_INFO.PG_SZ = 4084;
      570     4964    2       INV_PG.PG_SZ_INFO.SP_AV = 0;
      571     4965    2       INV_PG.CI_NO=IB;
      572     4966    2       INV_PG.LN_AV.FT_AV = 0;
      573     4967    2       INV_PG.LN_AV.HI_LN = 0;
      574     4968    2   END INVPG_SETUP;
      575     4969         /********************************************************************/
      576     4970    1   GET_CHKSUM: PROC;
      577     4971    2       ICHKSUM = 0; /* Checksum word*/
      578     4972    2       CALL CHKSUM;
      579     4973    2       DATA_PG.CHKSUM_WD = ICHKSUM;
      580     4974    2   END GET_CHKSUM;
      581     4975    1   END_ZIU$Q2IN:
      582     4976    1   /**/ DCBSF = ZI$DIR.AREA_NM.DCB#;
      583     4977    1       CALL SYS_FUNC_CLOS;
      584     4978    1       IF CPLTE_INT=1 AND UWA.AC_REC.SEC_KEY=1 THEN
      585     4979         /*If area has secondary keys then create a keyed file associated with it*/
      586     4980         /*Nothing is stored in the area (just created)*/
      587     4981    2       DO;
      588     4982    2           CALL INSERT(FILE#.NAME,FILE#.CNT,1,':');
      589     4983    2           ZI$DIR.AREA_NM.NAME.TEXT=FILE#.NAME;
      590     4984    2    /**/   XTENSIZESF = (TOT_PGS+9)/10;
      591     4985    2           CALL OPEN(%CREATE#,%KEYED#) ALTRET(ALTEND_ZIU$Q2IN);
      592     4986    2           CALL SYS_FUNC_CLOS;
      593     4987    2           END;
      594     4988    1       IF CPLTE_INT=0 THEN /* PARTIAL INIT,DONT PRINT SUMMARY */
      595     4989    2       DO;
      596     4990    2           CALL BINCHAR(CHAR10,PAGES_INIT);
      597     4991    2           CALL ZERO_SUP(CHAR10,10,'1'B);
      598     4992    2           CALL INDEX1(X,' ',CHAR10);
      599     4993    2           CALL CONCAT(FILE#.NAME,'BPartial INIT: ',C_V,' pages');
      600     4994    2           DCBSF=DCBNUM(M$LO);
      601     4995    2           BUFLNSF=30;
      602     4996    2           BUFSF=VECTOR(FILE#.NAME);
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:21   
      603     4997    2           CALL SYS_FUNC_WRIT;
      604     4998    2           END;
      605     4999    1       ELSE
      606     5000    1           CALL EXECUTION_OUTPUT;
      607     5001    1       ICNT = -1; /*Intialize icnt for init all*/
      608     5002    1       RETURN;
      609     5003    1   ALTEND_ZIU$Q2IN:
      610     5004    1   /**/ DCBSF =ZI$DIR.AREA_NM.DCB#;
      611     5005    1       CALL SYS_FUNC_CLOS;
      612     5006    1       ALTRETURN;
      613     5007    1   INIT_INDEX:
      614     5008    1       IF (UWA.AC_REC.PG_TYPE=2 OR UWA.AC_REC.PG_TYPE=3) AND
      615     5009    1          UWA.AC_REC.PERMTYPE~=1 THEN
      616     5010    2       DO; /* INDEX AREA OR INDEX AREA WITH ALTERNATE KEYS */
      617     5011    2           CALL DB_FUNC_FRS(CAN_RVA.RAREC.SEC,CAN_RVA.ACRA.SEC) ALTRET(DBALT);
      618     5012    2           IF UWA.DB_STATUS='00000' THEN
      619     5013    3           DO;
      620     5014    3               CALL DB_FUNC_FOR(CAN_RVA.RCRA.SEC) ALTRET(DBALT); /* GET RC */
      621     5015    3               CALL DB_FUNC_FRS(CAN_RVA.SMREC.SEC,CAN_RVA.RCSOSM.SEC) ALTRET(DBALT);
      622     5016    3               TOT_DBK=0; /* TO KEEP TRACK THE HIGH NUMBER OF ALTKEY */
      623     5017    4               DO WHILE(UWA.DB_STATUS='00000');
      624     5018    4                   CALL DB_FUNC_GET(CAN_RVA.SMREC.SEC) ALTRET(DBALT);
      625     5019    4                   CALL DB_FUNC_FOR(CAN_RVA.SCSOSM.SEC) ALTRET(DBALT);
      626     5020    4                   CALL DB_FUNC_GET(CAN_RVA.SCREC.SEC) ALTRET(DBALT);
      627     5021    4                   CALL DB_FUNC_FOR(CAN_RVA.SNSE.SEC) ALTRET(DBALT);
      628     5022    4                   CALL DB_FUNC_GET(CAN_RVA.SNREC.SEC) ALTRET(DBALT);
      629     5023    4                   CALL DB_FUNC_FRS(CAN_RVA.CFREC.SEC,CAN_RVA.SMSSCF.SEC) ALTRET(DBALT)
              5023                            ;
      630     5024    4                   CALL DB_FUNC_GET(CAN_RVA.CFREC.SEC) ALTRET(DBALT);
      631     5025    4                   CALL DB_FUNC_FOR(CAN_RVA.FRCFS.SEC) ALTRET(DBALT);
      632     5026    4                   CALL DB_FUNC_GET(CAN_RVA.FRREC.SEC) ALTRET(DBALT);
      633     5027    4                   X=UWA.SM_REC.PA_MEMPNT-2; /* GET ALTKEY # */
      634     5028    4                   X1=UWA.SC_REC.KEY_LENGHT; /* GET KEY LEN IN BYTES */
      635     5029    4                   X2=ADDR(UWA.FR_REC.BUFLOC)->EIS.BYT_OFF;
      636     5030    4                   IF X=-1 THEN /* THIS IS THE PRIMARY KEY EIS */
      637     5031    5                   DO;
      638     5032    5                       KEYLSF=X1; /* SET OPEN PARAMETER */
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:22   
      639     5033    5                       KEYXSF=X2;
      640     5034    5                       RECORD_LIST.NAME(0)=UWA.SN_REC.SENAME;
      641     5035    5                       END;
      642     5036    4                   ELSE
      643     5037    4                       IF X>=0 AND X<20 THEN /* LOAD INFO INTO VLP_ATLKEYS */
      644     5038    5                       DO;
      645     5039    5                           IF UWA.SM_REC.SEQDUP=2 THEN
      646     5040    5                               VLP_ALTKEYS.K.UNIQUE#(X)='1'B; /* DUP NOT */
      647     5041    5                           ELSE
      648     5042    5                               VLP_ALTKEYS.K.UNIQUE#(X)='0'B; /* DUP OK */
      649     5043    5                           VLP_ALTKEYS.K.KEYL#(X)=X1;
      650     5044    5                           VLP_ALTKEYS.K.KEYX#(X)=X2;
      651     5045    5                           RECORD_LIST.NAME(X+1)=UWA.SN_REC.SENAME;
      652     5046    5                           IF X>=TOT_DBK THEN
      653     5047    5                               TOT_DBK=X+1;
      654     5048    5                           END;
      655     5049    4                   CALL DB_FUNC_FRS(CAN_RVA.SMREC.SEC,CAN_RVA.RCSOSM.SEC) ALTRET(DBALT)
              5049                            ;
      656     5050    4                   END;
      657     5051    3    /**/       XTENSIZESF = 5; /* SET TO 5 FOR A WHILE */
      658     5052    3    /**/       VLP_ALTKEYS.SIZ#=TOT_DBK; /* NUMBER OF ALTKEYS */
      659     5053    3               CALL OPEN(%CREATE#,%INDEXED#) ALTRET(ALTEND_ZIU$Q2IN);
      660     5054    3               CALL SYS_FUNC_CLOS;
      661     5055    3               CALL EXCTN_REPRT_SETUP;
      662     5056    3               CALL EXECUTION_OUTPUT; /* WRITES INIT SUMMARY */
      663     5057    3               RETURN;
      664     5058    3               END;
      665     5059    2           END;
      666     5060        /***************************************************************************/
      667     5061        /*E* ERROR: ZIU-DBU#BADAREA-C
      668     5062        MESSAGE: Page type in schema for %U1 is not IDS or INDEXED, cannot initialize it.
      669     5063        */
      670     5064        /***************************************************************************/
      671     5065    1       CALL ERR_MSG(DBU#BADAREA,3);
      672     5066    1       ICNT=-1; /*Initialize icnt for init all*/
      673     5067    1       ALTRETURN;
      674     5068    1   DBALT: ERR_INSERT.TEXT(0)=UWA.DB_STATUS;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:23   
      675     5069    1       ERR_INSERT.CNT(0)=5; /* 5 CHARACTERS OF DB_STATUS */
      676     5070    1       CALL ERR_MSG(3002,3); /* PASS DB_STATUS AS AREA NAME */
      677     5071    1       ALTRETURN;
      678     5072    1   END ZIU$Q2IN;

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:24   
--  Include file information  --

   B$ROSEG.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
   ZI$PG_STRUCTS.:ZIC0TOU  is referenced.
   ZI_GLOBAL_DBUTIL.:ZIC0TOU  is referenced.
   ZI$DIR.:ZIC0TOU  is referenced.
   ZI_UWA_C.:ZIC0TOU  is referenced.
   ZI_ERRORS_SUBS.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   ZI_RVA_C.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIU$Q2IN.

   Procedure ZIU$Q2IN requires 1250 words for executable code.
   Procedure ZIU$Q2IN requires 10 words of local(AUTO) storage.

    No errors detected in file ZIU$Q2IN.:ZIC0TSI    .

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:25   

 Object Unit name= ZIU$Q2IN                                   File name= ZIU$Q2IN.:ZIC0TOU
 UTS= SEP 05 '97 13:21:58.68 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none    25     31  ZIU$Q2IN
    1   DCB   even  none     0      0  M$UC
    2   DCB   even  none     0      0  M$LO
    3  RoData even  UTS      9     11  ZIU$Q2IN
    4   Proc  even  none  1250   2342  ZIU$Q2IN
    5  RoData even  none    76    114  ZIU$Q2IN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     4      0   yes    yes     yes      Std        0  ZIU$Q2IN
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:26   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       0 GET_FILESZ
 yes     yes           Std       1 DB_FUNC_GET
         yes           Std       0 EXCTN_REPRT_SETUP
         yes           Std       0 EXECUTION_OUTPUT
 yes     yes           Std       0 SYS_FUNC_CLOS
 yes     yes           Std       0 SYS_FUNC_RELEASE
 yes     yes           Std       0 SYS_FUNC_TSTAMP
         yes           Std       3 ZERO_SUP
 yes     yes           Std       0 SYS_FUNC_WRIT
 yes     yes           Std       2 DB_FUNC_FRS
 yes     yes           Std       1 DB_FUNC_FOR
 yes     yes           Std       0 SYS_FUNC_ERRMSG
 yes     yes           Std       0 SYS_FUNC_OPEN
 yes     yes           Std       0 SYS_FUNC_READ
         yes           Std       0 CHKSUM
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
                       nStd      0 X66_AUNWIND
                       nStd      0 X66_AALT
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:27   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     PTR_LEN                               CAN_RVA                               NBUFS
     M$UC                                  VLP_ALTKEYS                           UWA
     ZI$DIR                                SCHEMA_ACTIVE                         RECORD_LIST
     SET_LIST                              RETAIN_LIST                           DUMP_FID
     ALTKY                                 INIT_RG                               KEY_RNG
     ITEM_LIST                             REC$                                  RB
     RE                                    IE                                    IB
     CNT                                   ICNT                                  RCNT
     SCNT                                  FIRST_SET                             RETCNT
     DMPCNT                                KCNT                                  ACNT_IDX
     I                                     J                                     K
     X                                     STEPCC                                I_O_BUF$
     OUT_INDX                              I_O_SIZE                              REC_DATA_LN
     M$LO                                  B$TCB$                                B$ROS$
     B$JIT$                                KEYFID                                I_O_KEY
     RESTART                               BREAK_FLAG                            ICHKSUM
     ITMCNT                                GAP1                                  BLKLSF
     KEYLSF                                KEYXSF                                DCBSF
     ORGSF                                 KEYSF                                 KEYVSF
     ACSSF                                 NOTIMESF                              FUNSF
     ASNSF                                 TESTSF                                XTENSIZESF
     DISPSF                                WAITSF                                VFCSF
     FULLSF                                BKUPSF                                BUFLNSF
     BUFSF                                 SOURCESF                              DESTSF
     DATESF                                TIMESF                                UTSSF
     DAYSF                                 TSTAMPSF                              ENCRP_SEEDSF
     ERRCODESF                             MSGCODE                               INCL_ERR
     ERR_INSERT                            FIDSF_RD                              ACNT
     EXISTSF                               SHARESF                               DCBNMSF
     KEYRSF                                NO_KEYSF                              REASGNSF
     CARRY_ATTRIBUTESF                     SUBMESSF                              SPKY_OPNSF
     POSSF                                 ERRFLGSF                              MERGESF
     FSA_FLAG                              RELGSF                                UNUSED
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:28   
     HELPCODE                              COUNTSF                               INDEXSF
     GAP                                   PSNSF                                 ACNTSF
     KEY_SHADWSF                           ATBLK$                                DATA$
     INVPG$

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 ROSID                                 NULLSID
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:29   


        1        1        /*M*   ZIU$Q2IN          I-D-S/II       UTILITY INITIALIZE   */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*P*
        8        8        NAME: Q2IN
        9        9        PURPOSE:  INITIALIZES AN AREA IN A SCHEMA
       10       10         ********************************************************/
       11       11        ZIU$Q2IN: PROC ALTRET;

     11  4 000000   000000 700200 xent  ZIU$Q2IN     TSX0  ! X66_AUTO_0
         4 000001   000012 000000                    ZERO    10,0
         4 000002   000161 710000 4                  TRA     s:4596

       12       12    1   DCL TOT_PGS UBIN(36) STATIC ALIGNED;
       13       13    1   DCL CALC_TEMP SBIN(36) STATIC ALIGNED;
       14       14    1   DCL CALC_KY_SZ SBIN(36) STATIC ALIGNED; /*Calc header size*/
       15       15    1   DCL PTR_LEN SBIN SYMREF ALIGNED;
       16       16    1   DCL CALC_HDR_SIZE SBIN STATIC ALIGNED;
       17       17    1   DCL 1 REC_HDR BASED(REC$) CALIGNED,
       18       18    1         2 REC_TYP UBIN(18) CALIGNED,
       19       19    1         2 REC_SZ UBIN(18) CALIGNED;
       20       20    1   DCL PTR_V CHAR(PTR_LEN) BASED CALIGNED;
       21       21    1   DCL PAGES_PER_HDR UBIN HALF STATIC ALIGNED;
       22       22    1   DCL HDRS_PER_PAGE UBIN HALF STATIC UNAL;
       23       23    1   DCL PAGES_INIT SBIN STATIC ALIGNED;
       24       24    1   DCL P$ PTR STATIC INIT(ADDR(CHAR10));
       25       25    1   DCL C_V CHAR(X) BASED(P$);
       26       26    1   DCL CHAR10 CHAR(10) STATIC;
       27       27    1   DCL CPLTE_INT SBIN(36) STATIC ALIGNED; /*Complete init switch(bit)*/
       28       28    1   DCL TOT_DBK SBIN STATIC ALIGNED;
       29       29    1   DCL CALC_TEMP2 SBIN(36) STATIC ALIGNED;
                29            /*Varible used for  less than 1 calc hdr per page*/
       30       30    1   DCL X1 SBIN WORD STATIC ALIGNED; /*D* X1=NUMBER OF DATA PAGES */
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:30   
       31       31    1   DCL X2 SBIN WORD STATIC ALIGNED; /*D* X2=NUMBER OF INV PAGES */
       32       32    1   DCL CALC_TOT SBIN WORD STATIC ALIGNED;
                32            /*D* CALC_TOT = TOTAL CALC HDRS IN THIS AREA*/
       33       33    1   DCL TSTMP BIT(36) ALIGNED;
       34       34    1   DCL 1 FILE# STATIC,
       35       35    1         2 CNT UBIN(9) UNAL,
       36       36    1         2 NAME CHAR(31) UNAL;
       37       37        /**/
       38       38    1   DCL DB_FUNC_FRS ENTRY(2) ALTRET;
       39       39    1   DCL DB_FUNC_FOR ENTRY(1) ALTRET;
       40       40    1   DCL DB_FUNC_GET ENTRY(1) ALTRET;
       41       41    1   DCL 1 EIS BASED ALIGNED,
       42       42    1         2 * UBIN(3) UNAL,
       43       43    1         2 BYT_OFF UBIN(17) UNAL,
       44       44    1         2 * UBIN(16) UNAL;
       45       45        %INCLUDE ZI_RVA_C;
       46      726        %CAN_RVA_REF;
       47     1045    1   DCL SYS_FUNC_OPEN ENTRY ALTRET;
       48     1046    1   DCL SYS_FUNC_CLOS ENTRY ALTRET;
       49     1047    1   DCL SYS_FUNC_RELEASE ENTRY ALTRET;
       50     1048    1   DCL SYS_FUNC_READ ENTRY ALTRET;
       51     1049    1   DCL SYS_FUNC_WRIT ENTRY ALTRET;
       52     1050    1   DCL SYS_FUNC_TSTAMP ENTRY ALTRET;
       53     1051    1   DCL SYS_FUNC_REW ENTRY ALTRET;
       54     1052    1   DCL SYS_FUNC_ERRMSG ENTRY ALTRET;
       55     1053    1   DCL SYS_FUNC_RELDCB ENTRY ALTRET;
       56     1054    1   DCL DB_FUNC_FIN ENTRY ALTRET;
       57     1055    1   DCL EXECUTION_OUTPUT ENTRY;
       58     1056    1   DCL EXCTN_REPRT_SETUP ENTRY;
       59     1057    1   DCL CHKSUM ENTRY;
       60     1058    1   DCL ZERO_SUP ENTRY(3);
       61     1059    1   DCL GET_FILESZ ENTRY ALTRET;
       62     1060    1   DCL NBUFS SBIN SYMREF; /* # OF BUFS ALLOC IN I_O_BUF */
       63     1061        /**/
       64     1062        %INCLUDE CP_6;
       65     1143        %INCLUDE CP_6_SUBS;
       66     1683        %VLP_ALTKEYS(STCLASS=SYMREF);
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:31   
       67     1698        %F$DCB (DCBN=F$DCB);
       68     1755        %INCLUDE ZI_ERRORS_SUBS;
       69     2275        %INCLUDE ZI_UWA_C;
       70     2965        %ZI$UWAB;
       71     3305        %INCLUDE ZI$DIR;
       72     3462        %DIR;
       73     3606        %INCLUDE ZI_GLOBAL_DBUTIL;
       74     3784        %MISC_DCLS;
       75     3837        %SYS_FUNC;
       76     3929        %INCLUDE ZI$PG_STRUCTS;
       77     4032        %ATBLK_PG;
       78     4088        %DATA_PG;
       79     4107        %INVTY_PG;
       80     4123        %INCLUDE B$JIT;
       81     4413        %INCLUDE B$ROSEG;
       82     4476        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:32   
       83     4477        /*
       84     4478                 SUBR:  ERR_MSG TRANSFER CALL TO SYS_FUNC_ERRMSG
       85     4479                        FOR MESSAGES WITH ONLY %U1 AND FIX TO ZI$DIR.AREA_NM
       86     4480        */
       87     4481    1   ERR_MSG: PROC(ERR#,FLAG#);

   4481  4 000003   200004 741300       ERR_MSG      STX1  ! TSTMP+1,,AUTO

       88     4482
       89     4483    2   DCL ERR# SBIN; /* INPUT: ERR_CODE */
       90     4484    2   DCL FLAG# SBIN; /* AND ERROR FLAG */
       91     4485
       92     4486    2       ERRCODESF.ERR# = ERR#;

   4486  4 000004   200005 470500                    LDP0    @ERR#,,AUTO
         4 000005   000000 236100                    LDQ     0,,PR0
         4 000006   000003 736000                    QLS     3
         4 000007   000000 676000 xsym               ERQ     ERRCODESF
         4 000010   377770 376007                    ANQ     131064,DL
         4 000011   000000 656000 xsym               ERSQ    ERRCODESF

       93     4487    2       ERRFLGSF = FLAG#;

   4487  4 000012   200006 471500                    LDP1    @FLAG#,,AUTO
         4 000013   100000 235100                    LDA     0,,PR1
         4 000014   000033 735000                    ALS     27
         4 000015   000000 755000 xsym               STA     ERRFLGSF

       94     4488    2       MSGCODE = ERRCODE_RDEF;

   4488  4 000016   000000 236000 xsym               LDQ     ERRCODESF
         4 000017   000000 756000 xsym               STQ     MSGCODE

       95     4489    2       ERR_INSERT(0) = ZI$DIR.AREA_NM; /* FIX CODE TO SUB %U1 */

   4489  4 000020   000000 100400                    MLR     fill='000'O
         4 000021   000234 000037 xsym               ADSC9   ZI$DIR+156               cn=0,n=31
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:33   
         4 000022   000000 000037 xsym               ADSC9   ERR_INSERT               cn=0,n=31

       96     4490    2       CALL SYS_FUNC_ERRMSG;

   4490  4 000023   000000 631400 5                  EPPR1   0
         4 000024   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         4 000025   000000 011000                    NOP     0

       97     4491    2   END ERR_MSG;

   4491  4 000026   200004 221300                    LDX1  ! TSTMP+1,,AUTO
         4 000027   000001 702211                    TSX2  ! 1,X1

       98     4492
       99     4493        /*
      100     4494                 SUBR  CALC_TOTAL CALCULATE THE TOT_PGS BASED ON TOT_DBK
      101     4495        */
      102     4496    1   CALC_TOTAL: PROC;

   4496  4 000030   200004 741300       CALC_TOTAL   STX1  ! TSTMP+1,,AUTO

      103     4497
      104     4498    2       INIT_RG.SECRNG(0)=(TOT_DBK+UWA.AC_REC.LPP-1)/UWA.AC_REC.LPP;

   4498  4 000031   000014 236000 0                  LDQ     TOT_DBK
         4 000032   000253 036000 xsym               ADLQ    UWA+171
         4 000033   000001 136007                    SBLQ    1,DL
         4 000034   000253 506000 xsym               DIV     UWA+171
         4 000035   000001 756000 xsym               STQ     INIT_RG+1

      105     4499    2       TOT_PGS = INIT_RG.SECRNG(0);

   4499  4 000036   000000 756000 0                  STQ     TOT_PGS

      106     4500    2       IF UWA.AC_REC.FIR_INV_PG > 0 THEN

   4500  4 000037   000252 235000 xsym               LDA     UWA+170
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:34   
         4 000040   000046 604400 4                  TMOZ    s:4503

      107     4501    2           TOT_PGS = TOT_PGS + (TOT_PGS+4071) / 4072;

   4501  4 000041   007747 036007                    ADLQ    4071,DL
         4 000042   000001 772000                    QRL     1
         4 000043   003764 506007                    DIV     2036,DL
         4 000044   000000 036000 0                  ADLQ    TOT_PGS
         4 000045   000000 756000 0                  STQ     TOT_PGS

      108     4502         /* NUMBER OF DATA PAGES + INV PAGES */
      109     4503    2   END CALC_TOTAL;

   4503  4 000046   000001 702211                    TSX2  ! 1,X1

      110     4504        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:35   
      111     4505        /*
      112     4506                 SUBR:  OPEN  TRANSFERS CALLS TO SYS_FUNC_OPEN
      113     4507                        INPUT FUNSF AND ORGSF
      114     4508        */
      115     4509    1   OPEN: PROC(FUN,ORG) ALTRET;

   4509  4 000047   200004 741300       OPEN         STX1  ! TSTMP+1,,AUTO

      116     4510
      117     4511    2   DCL FUN SBIN;
      118     4512    2   DCL ORG SBIN;
      119     4513
      120     4514    2       DCBSF = ZI$DIR.AREA_NM.DCB#;

   4514  4 000050   000244 220000 xsym               LDX0    ZI$DIR+164
         4 000051   000000 740000 xsym               STX0    DCBSF

      121     4515    2       TESTSF = %NO#;

   4515  4 000052   000000 450000 xsym               STZ     TESTSF

      122     4516    2       ORGSF = ORG;

   4516  4 000053   200006 470500                    LDP0    @ORG,,AUTO
         4 000054   000000 235100                    LDA     0,,PR0
         4 000055   000000 755000 xsym               STA     ORGSF

      123     4517    2       IF ORGSF = %KEYED# THEN

   4517  4 000056   000002 115007                    CMPA    2,DL
         4 000057   000062 601000 4                  TNZ     s:4520

      124     4518    2           REASGNSF = %NO#; /* DONT REASSIGN WHEN CREATE KEY FILE */

   4518  4 000060   000000 450000 xsym               STZ     REASGNSF
         4 000061   000064 710000 4                  TRA     s:4521

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:36   
      125     4519    2       ELSE
      126     4520    2           REASGNSF = %YES#;

   4520  4 000062   400000 236003                    LDQ     -131072,DU
         4 000063   000000 756000 xsym               STQ     REASGNSF

      127     4521    2       FULLSF = %YES#;

   4521  4 000064   400000 236003                    LDQ     -131072,DU
         4 000065   000000 756000 xsym               STQ     FULLSF

      128     4522    2       SHARESF = %NONE#;

   4522  4 000066   600000 236003                    LDQ     -65536,DU
         4 000067   000000 756000 xsym               STQ     SHARESF

      129     4523    2       CARRY_ATTRIBUTESF = %NO#;

   4523  4 000070   000000 450000 xsym               STZ     CARRY_ATTRIBUTESF

      130     4524    2       ACSSF = %DIRECT#;

   4524  4 000071   000002 235007                    LDA     2,DL
         4 000072   000000 755000 xsym               STA     ACSSF

      131     4525    2       ASNSF = %FILE#;

   4525  4 000073   000001 235007                    LDA     1,DL
         4 000074   000000 755000 xsym               STA     ASNSF

      132     4526    2       ACNT = ZI$DIR.ACNT;

   4526  4 000075   000000 100400                    MLR     fill='000'O
         4 000076   000002 400120 xsym               ADSC9   ZI$DIR+2                 cn=2,n=80
         4 000077   000000 000120 xsym               ADSC9   ACNT                     cn=0,n=80

      133     4527    2       FIDSF = ZI$DIR.AREA_NM.NAME.TEXT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:37   

   4527  4 000100   040000 100400                    MLR     fill='040'O
         4 000101   000234 200036 xsym               ADSC9   ZI$DIR+156               cn=1,n=30
         4 000102   000000 000036 xsym               ADSC9   FIDSF_RD                 cn=0,n=30

      134     4528    2       FUNSF = FUN; /* ONLY INPUT ARGU */

   4528  4 000103   200005 471500                    LDP1    @FUN,,AUTO
         4 000104   100000 235100                    LDA     0,,PR1
         4 000105   000000 755000 xsym               STA     FUNSF

      135     4529    2       EXISTSF = %NEWFILE#;

   4529  4 000106   000000 756000 xsym               STQ     EXISTSF

      136     4530    2       CALL SYS_FUNC_OPEN ALTRET(ALT_RET);

   4530  4 000107   000000 631400 5                  EPPR1   0
         4 000110   000000 701000 xent               TSX1    SYS_FUNC_OPEN
         4 000111   000114 702000 4                  TSX2    ALT_RET

      137     4531    2       RETURN;

   4531  4 000112   200004 221300                    LDX1  ! TSTMP+1,,AUTO
         4 000113   000001 702211                    TSX2  ! 1,X1

      138     4532    2   ALT_RET: ALTRETURN;

   4532  4 000114   200004 221300       ALT_RET      LDX1  ! TSTMP+1,,AUTO
         4 000115   000000 702211                    TSX2  ! 0,X1

      139     4533    2   END OPEN;
      140     4534
      141     4535        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:38   
      142     4536        /*
      143     4537                 SUBR: READ_WRITE(FLAG) CALL SYS_FUNC_READ/WRIT
      144     4538        */
      145     4539    1   READ_WRITE: PROC(FLAG) ALTRET;

   4539  4 000116   200004 741300       READ_WRITE   STX1  ! TSTMP+1,,AUTO

      146     4540
      147     4541    2   DCL FLAG UBIN; /* FLAG=1 IF SYS_FUNC_READ, OTHERWISE WRIT */
      148     4542
      149     4543    2       DCBSF = ZI$DIR.AREA_NM.DCB#;

   4543  4 000117   000244 220000 xsym               LDX0    ZI$DIR+164
         4 000120   000000 740000 xsym               STX0    DCBSF

      150     4544    2       BUFSF = VECTOR(I_O_BUF(0));

   4544  4 000121   000001 235000 5                  LDA     1
         4 000122   000000 236000 xsym               LDQ     I_O_BUF$
         4 000123   000000 755000 xsym               STA     BUFSF
         4 000124   000001 756000 xsym               STQ     BUFSF+1

      151     4545    2       BUFLNSF = I_O_SIZE*4096; /* I_O_SIZE IS ANOTHER INPUT */

   4545  4 000125   000000 235000 xsym               LDA     I_O_SIZE
         4 000126   000014 735000                    ALS     12
         4 000127   000000 755000 xsym               STA     BUFLNSF

      152     4546    2       KEYVSF.IDSKEY = I_O_KEY; /* THIS IS THE THIRD INPUT */

   4546  4 000130   000000 100400                    MLR     fill='000'O
         4 000131   000000 000004 xsym               ADSC9   I_O_KEY                  cn=0,n=4
         4 000132   000000 200004 xsym               ADSC9   KEYVSF                   cn=1,n=4

      153     4547    2       FULLSF = %YES#;

   4547  4 000133   400000 236003                    LDQ     -131072,DU
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:39   
         4 000134   000000 756000 xsym               STQ     FULLSF

      154     4548    2       KEYSF = %YES#;

   4548  4 000135   000000 756000 xsym               STQ     KEYSF

      155     4549    2       NOTIMESF = %YES#;

   4549  4 000136   000000 756000 xsym               STQ     NOTIMESF

      156     4550    2       VFCSF = %NO#;

   4550  4 000137   000000 450000 xsym               STZ     VFCSF

      157     4551    2       ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;

   4551  4 000140   000027 236000 xsym               LDQ     ZI$DIR+23
         4 000141   000000 756000 xsym               STQ     ENCRP_SEEDSF

      158     4552    2       IF FLAG=1 THEN

   4552  4 000142   200005 470500                    LDP0    @FLAG,,AUTO
         4 000143   000000 235100                    LDA     0,,PR0
         4 000144   000001 115007                    CMPA    1,DL
         4 000145   000152 601000 4                  TNZ     s:4555

      159     4553    2           CALL SYS_FUNC_READ ALTRET(ALTRTN);

   4553  4 000146   000000 631400 5                  EPPR1   0
         4 000147   000000 701000 xent               TSX1    SYS_FUNC_READ
         4 000150   000157 702000 4                  TSX2    ALTRTN
         4 000151   000155 710000 4                  TRA     s:4556

      160     4554    2       ELSE
      161     4555    2           CALL SYS_FUNC_WRIT ALTRET(ALTRTN);

   4555  4 000152   000000 631400 5                  EPPR1   0
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:40   
         4 000153   000000 701000 xent               TSX1    SYS_FUNC_WRIT
         4 000154   000157 702000 4                  TSX2    ALTRTN

      162     4556    2       RETURN;

   4556  4 000155   200004 221300                    LDX1  ! TSTMP+1,,AUTO
         4 000156   000001 702211                    TSX2  ! 1,X1

      163     4557    2   ALTRTN: ALTRETURN;

   4557  4 000157   200004 221300       ALTRTN       LDX1  ! TSTMP+1,,AUTO
         4 000160   000000 702211                    TSX2  ! 0,X1

      164     4558    2   END READ_WRITE;
      165     4559        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:41   
      166     4560
      167     4561        /*E* ERROR: ZIU-DBU#INITMP-C
      168     4562        MESSAGE: "%U1" is defined as a temporary area in the schema DDL;
      169     4563                 it is initialized during runtime when it is READYed. */
      170     4564
      171     4565        /*E* ERROR: ZIU-DBU#NOENCRP-C
      172     4566        MESSAGE: Encryption required for %U1.  No encryption seed has been specified.
      173     4567                 Encryption seed is assumed to be '0' or 'NULL'. */
      174     4568
      175     4569        /*E* ERROR: ZIU-DBU#IGNOENCP-0
      176     4570        MESSAGE: Encryption not defined but specified for area "%U1" - ignored. */
      177     4571
      178     4572        /*E* ERROR: ZIU-DBU#RNGKYCLS-C
      179     4573        MESSAGE: KEY clause ignored on partial initialization of %U1.  */
      180     4574
      181     4575        /*E* ERROR: ZIU-DBU#BADKYCLS-C
      182     4576        MESSAGE: KEY clause ignored on directive because "%U1" is not a TEMPLATE area. */
      183     4577
      184     4578        /*E* ERROR: ZIU-DBU#TMPLTAREA-C
      185     4579        MESSAGE: "%U1" is defined as a template area by the schema DMCL. */
      186     4580
      187     4581        /*E* ERROR: ZIU-DBU#NOKYCLS-C
      188     4582        MESSAGE: No KEY clause present in the directive.
      189     4583                 Default values in schema DMCL are used for this operation. */
      190     4584
      191     4585        /*E* ERROR: ZIU-DBU#MXKYCLS-C
      192     4586        MESSAGE: Value specified in KEY ALLOCATION clause is greater than
      193     4587                       the maximum reserved keys(maximum used instead). */
      194     4588
      195     4589        /*E* ERROR: ZIU-DBU#MNKYCLS-C
      196     4590        MESSAGE: Value in KEY clause less than minimum allowed for %U1.
      197     4591                 The number of allocation keys in DMCL is used instead. */
      198     4592        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:42   
      199     4593        /*
      200     4594              ZIU$Q2IN - DBUTIL INIT PROCESSING STARTS HERE.
      201     4595        */
      202     4596    1       PAGES_INIT=0; /* COUNTER FOR NUMBER PAGES INITED */

   4596  4 000161   000006 450000 0                  STZ     PAGES_INIT

      203     4597    1       CPLTE_INT=0; /* SET TO PARTIAL INIT FIRST */

   4597  4 000162   000013 450000 0                  STZ     CPLTE_INT

      204     4598    1       IF UWA.AC_REC.PERMTYPE=1 THEN

   4598  4 000163   000236 235000 xsym               LDA     UWA+158
         4 000164   000001 115007                    CMPA    1,DL
         4 000165   000177 601000 4                  TNZ     s:4604

      205     4599    2       DO;

      206     4600    2           CALL ERR_MSG(DBU#INITMP,0); /* TEMP AREA SHOULD NOT BE INIT */

   4600  4 000166   000003 236000 5                  LDQ     3
         4 000167   200006 756100                    STQ     @FLAG+1,,AUTO
         4 000170   000004 236000 5                  LDQ     4
         4 000171   200005 756100                    STQ     TSTMP+2,,AUTO
         4 000172   000003 701000 4                  TSX1    ERR_MSG
         4 000173   000000 011000                    NOP     0

      207     4601    2           ICNT = -1;

   4601  4 000174   000001 335007                    LCA     1,DL
         4 000175   000000 755000 xsym               STA     ICNT

      208     4602    2           RETURN;

   4602  4 000176   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:43   
      209     4603    2           END;
      210     4604    1       IF UWA.AC_REC.PG_TYPE>0 THEN GOTO INIT_INDEX; /* MAY BE INDEX */

   4604  4 000177   000237 236000 xsym               LDQ     UWA+159
         4 000200   002101 605400 4                  TPNZ    INIT_INDEX

      211     4605
      212     4606    1       IF UWA.AC_REC.SWS.ENCRYP AND ZI$DIR.ENCRPT=%NO# THEN

   4606  4 000201   000233 236000 xsym               LDQ     UWA+155
         4 000202   200000 316003                    CANQ    65536,DU
         4 000203   000215 600000 4                  TZE     s:4608
         4 000204   000000 236000 xsym               LDQ     ZI$DIR
         4 000205   002000 316003                    CANQ    1024,DU
         4 000206   000215 601000 4                  TNZ     s:4608

      213     4607    1           CALL ERR_MSG(DBU#NOENCRP,0); /* ENCRYP SEED NOT GIVEN */

   4607  4 000207   000003 236000 5                  LDQ     3
         4 000210   200006 756100                    STQ     @FLAG+1,,AUTO
         4 000211   000006 236000 5                  LDQ     6
         4 000212   200005 756100                    STQ     TSTMP+2,,AUTO
         4 000213   000003 701000 4                  TSX1    ERR_MSG
         4 000214   000000 011000                    NOP     0

      214     4608    1       IF UWA.AC_REC.SWS.ENCRYP=%NO# AND ZI$DIR.ENCRPT THEN

   4608  4 000215   000233 236000 xsym               LDQ     UWA+155
         4 000216   200000 316003                    CANQ    65536,DU
         4 000217   000232 601000 4                  TNZ     s:4614
         4 000220   000000 236000 xsym               LDQ     ZI$DIR
         4 000221   002000 316003                    CANQ    1024,DU
         4 000222   000232 600000 4                  TZE     s:4614

      215     4609    2       DO; /* AREA IS NOT ENCRYPTED BUT CRPT SPECIFIED */

      216     4610    2           ZI$DIR.ENCP_SEED_RD=0; /* IGNORE IT */
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:44   

   4610  4 000223   000027 450000 xsym               STZ     ZI$DIR+23

      217     4611    2           CALL ERR_MSG(DBU#IGNOENCP,0); /* AND GIVE A WARNING */

   4611  4 000224   000003 236000 5                  LDQ     3
         4 000225   200006 756100                    STQ     @FLAG+1,,AUTO
         4 000226   000010 236000 5                  LDQ     8
         4 000227   200005 756100                    STQ     TSTMP+2,,AUTO
         4 000230   000003 701000 4                  TSX1    ERR_MSG
         4 000231   000000 011000                    NOP     0

      218     4612    2           END;

      219     4613
      220     4614    1       TOT_DBK = UWA.AC_REC.KEY_ALLOC; /* SET DEFAULT DBK = DMCL DEF */

   4614  4 000232   000243 235000 xsym               LDA     UWA+163
         4 000233   000014 755000 0                  STA     TOT_DBK

      221     4615    1       IF ICNT>=0 AND ZI$DIR.INIT_TMPLT_KEY>0 THEN

   4615  4 000234   000000 236000 xsym               LDQ     ICNT
         4 000235   000246 604000 4                  TMI     s:4617
         4 000236   000221 235000 xsym               LDA     ZI$DIR+145
         4 000237   000246 600000 4                  TZE     s:4617

      222     4616    1           CALL ERR_MSG(DBU#RNGKYCLS,0); /* KEY IGNORED ON PARTIAL INIT */

   4616  4 000240   000003 236000 5                  LDQ     3
         4 000241   200006 756100                    STQ     @FLAG+1,,AUTO
         4 000242   000012 236000 5                  LDQ     10
         4 000243   200005 756100                    STQ     TSTMP+2,,AUTO
         4 000244   000003 701000 4                  TSX1    ERR_MSG
         4 000245   000000 011000                    NOP     0

      223     4617    1       IF ICNT=-1 THEN /* NO PAGE RANGE SPECIFIED */
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:45   

   4617  4 000246   000000 235000 xsym               LDA     ICNT
         4 000247   000013 115000 5                  CMPA    11
         4 000250   000362 601000 4                  TNZ     s:4657

      224     4618    2       DO; /* THIS IS A FULL INIT OF AREA */

      225     4619    2           ICNT=0;

   4619  4 000251   000000 450000 xsym               STZ     ICNT

      226     4620    2           INIT_RG.FIRNG(0)=0; /* STARTING FROM PAGE 0 */

   4620  4 000252   000000 450000 xsym               STZ     INIT_RG

      227     4621    2           CPLTE_INT = 1; /* SET FULL INIT FLAG */

   4621  4 000253   000001 235007                    LDA     1,DL
         4 000254   000013 755000 0                  STA     CPLTE_INT

      228     4622    2           IF UWA.AC_REC.SWS.TEMPLAT~='1'B AND

   4622  4 000255   000233 236000 xsym               LDQ     UWA+155
         4 000256   040000 316003                    CANQ    16384,DU
         4 000257   000271 601000 4                  TNZ     s:4626
         4 000260   000221 235000 xsym               LDA     ZI$DIR+145
         4 000261   000271 600000 4                  TZE     s:4626

      229     4623    2              ZI$DIR.INIT_TMPLT_KEY>0 THEN /* NOT TEMPLATE BUT KEY SPECIFIED */
      230     4624    2               CALL ERR_MSG(DBU#BADKYCLS,1); /* GIVE A WARNING */

   4624  4 000262   000016 236000 5                  LDQ     14
         4 000263   200006 756100                    STQ     @FLAG+1,,AUTO
         4 000264   000017 236000 5                  LDQ     15
         4 000265   200005 756100                    STQ     TSTMP+2,,AUTO
         4 000266   000003 701000 4                  TSX1    ERR_MSG
         4 000267   000000 011000                    NOP     0
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:46   
         4 000270   000345 710000 4                  TRA     s:4647

      231     4625    2           ELSE
      232     4626    2               IF UWA.AC_REC.SWS.TEMPLAT THEN

   4626  4 000271   040000 316003                    CANQ    16384,DU
         4 000272   000345 600000 4                  TZE     s:4647

      233     4627    3               DO;

      234     4628    3                   CALL ERR_MSG(DBU#TMPLTAREA,0); /* MSG RECONIZING TMPLAT */

   4628  4 000273   000003 236000 5                  LDQ     3
         4 000274   200006 756100                    STQ     @FLAG+1,,AUTO
         4 000275   000021 236000 5                  LDQ     17
         4 000276   200005 756100                    STQ     TSTMP+2,,AUTO
         4 000277   000003 701000 4                  TSX1    ERR_MSG
         4 000300   000000 011000                    NOP     0

      235     4629    3                   IF ZI$DIR.INIT_TMPLT_KEY=0 THEN /* IF NO KEY SPECIFIED */

   4629  4 000301   000221 235000 xsym               LDA     ZI$DIR+145
         4 000302   000312 601000 4                  TNZ     s:4633

      236     4630    3                       CALL ERR_MSG(DBU#NOKYCLS,0); /* TELL HIM DEFAULT USED */

   4630  4 000303   000003 236000 5                  LDQ     3
         4 000304   200006 756100                    STQ     @FLAG+1,,AUTO
         4 000305   000023 236000 5                  LDQ     19
         4 000306   200005 756100                    STQ     TSTMP+2,,AUTO
         4 000307   000003 701000 4                  TSX1    ERR_MSG
         4 000310   000000 011000                    NOP     0
         4 000311   000345 710000 4                  TRA     s:4647

      237     4631    3                   ELSE
      238     4632    4                   DO; /* KEY SPECIFIED, CHK IF IT IS A GOOD KEY */

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:47   
      239     4633    4                       IF ZI$DIR.INIT_TMPLT_KEY>UWA.AC_REC.KEY_ALLOC+

   4633  4 000312   000243 236000 xsym               LDQ     UWA+163
         4 000313   000244 036000 xsym               ADLQ    UWA+164
         4 000314   000317 604000 4                  TMI     s:4636
         4 000315   000221 116000 xsym               CMPQ    ZI$DIR+145
         4 000316   000331 603000 4                  TRC     s:4640

      240     4634    4                          UWA.AC_REC.KEYS_RESER THEN
      241     4635    5                       DO; /* KEY SPECIFIED IS BIGGER THAN MAXIMUN */

      242     4636    5                           TOT_DBK = UWA.AC_REC.KEY_ALLOC+UWA.AC_REC.KEYS_RESER;

   4636  4 000317   000243 236000 xsym               LDQ     UWA+163
         4 000320   000244 036000 xsym               ADLQ    UWA+164
         4 000321   000014 756000 0                  STQ     TOT_DBK

      243     4637    5                           CALL ERR_MSG(DBU#MXKYCLS,2); /* 2 STARS MSG */

   4637  4 000322   000026 236000 5                  LDQ     22
         4 000323   200006 756100                    STQ     @FLAG+1,,AUTO
         4 000324   000027 236000 5                  LDQ     23
         4 000325   200005 756100                    STQ     TSTMP+2,,AUTO
         4 000326   000003 701000 4                  TSX1    ERR_MSG
         4 000327   000000 011000                    NOP     0

      244     4638    5                           END;

   4638  4 000330   000345 710000 4                  TRA     s:4647

      245     4639    4                       ELSE
      246     4640    4                           IF ZI$DIR.INIT_TMPLT_KEY<UWA.AC_REC.KEY_ALLOC THEN

   4640  4 000331   000221 236000 xsym               LDQ     ZI$DIR+145
         4 000332   000344 604000 4                  TMI     s:4643
         4 000333   000243 116000 xsym               CMPQ    UWA+163
         4 000334   000344 605000 4                  TPL     s:4643
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:48   

      247     4641    4                               CALL ERR_MSG(DBU#MNKYCLS,2); /* OR SMALLER THAN MIN */

   4641  4 000335   000026 236000 5                  LDQ     22
         4 000336   200006 756100                    STQ     @FLAG+1,,AUTO
         4 000337   000031 236000 5                  LDQ     25
         4 000340   200005 756100                    STQ     TSTMP+2,,AUTO
         4 000341   000003 701000 4                  TSX1    ERR_MSG
         4 000342   000000 011000                    NOP     0
         4 000343   000345 710000 4                  TRA     s:4647

      248     4642    4                           ELSE
      249     4643    4                               TOT_DBK=ZI$DIR.INIT_TMPLT_KEY; /* KEY IS GOOD */

   4643  4 000344   000014 756000 0                  STQ     TOT_DBK

      250     4644    4                       END;

      251     4645    3                   END;

      252     4646         /* NOW WE HAVE TOTAL_DBKEYS IN THE AREA FIGURED OUT */
      253     4647    2           TOT_PGS=(TOT_DBK+UWA.AC_REC.LPP-1)/UWA.AC_REC.LPP;

   4647  4 000345   000014 236000 0                  LDQ     TOT_DBK
         4 000346   000253 036000 xsym               ADLQ    UWA+171
         4 000347   000001 136007                    SBLQ    1,DL
         4 000350   000253 506000 xsym               DIV     UWA+171
         4 000351   000000 756000 0                  STQ     TOT_PGS

      254     4648    2           INIT_RG.SECRNG(0)=TOT_PGS; /* THEN COMPUTE NUMBER OF PAGES */

   4648  4 000352   000001 756000 xsym               STQ     INIT_RG+1

      255     4649    2           IF UWA.AC_REC.FIR_INV_PG>0 THEN

   4649  4 000353   000252 235000 xsym               LDA     UWA+170
         4 000354   000362 604400 4                  TMOZ    s:4657
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:49   

      256     4650    2               TOT_PGS=TOT_PGS+(TOT_PGS+4071)/4072; /* AND INV PAGES */

   4650  4 000355   007747 036007                    ADLQ    4071,DL
         4 000356   000001 772000                    QRL     1
         4 000357   003764 506007                    DIV     2036,DL
         4 000360   000000 036000 0                  ADLQ    TOT_PGS
         4 000361   000000 756000 0                  STQ     TOT_PGS

      257     4651    2           END;

      258     4652        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:50   
      259     4653        /*
      260     4654                 THIS SECTION WILL BUILD OR RE-BUILD THE ALTBLK PAGE
      261     4655                 DEPENDING UPON PAGE 0 SPECIFIED OR NOT
      262     4656        */
      263     4657    1       IF CPLTE_INT=1 THEN

   4657  4 000362   000013 235000 0                  LDA     CPLTE_INT
         4 000363   000001 115007                    CMPA    1,DL
         4 000364   000412 601000 4                  TNZ     s:4666

      264     4658    2       DO;

      265     4659    2           XTENSIZESF = 1;

   4659  4 000365   000001 236007                    LDQ     1,DL
         4 000366   000000 756000 xsym               STQ     XTENSIZESF

      266     4660    2           CALL OPEN(%CREATE#,%IDS#) ALTRET(ALTEND_ZIU$Q2IN);

   4660  4 000367   000034 236000 5                  LDQ     28
         4 000370   200006 756100                    STQ     @FLAG+1,,AUTO
         4 000371   000035 236000 5                  LDQ     29
         4 000372   200005 756100                    STQ     TSTMP+2,,AUTO
         4 000373   000047 701000 4                  TSX1    OPEN
         4 000374   002073 702000 4                  TSX2    ALTEND_ZIU$Q2IN

      267     4661    2           CALL SYS_FUNC_RELEASE; /* SO DELETE EXISTING FILE */

   4661  4 000375   000000 631400 5                  EPPR1   0
         4 000376   000000 701000 xent               TSX1    SYS_FUNC_RELEASE
         4 000377   000000 011000                    NOP     0

      268     4662    2           XTENSIZESF = TOT_PGS + 1;

   4662  4 000400   000000 235000 0                  LDA     TOT_PGS
         4 000401   000001 035007                    ADLA    1,DL
         4 000402   000000 755000 xsym               STA     XTENSIZESF
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:51   

      269     4663    2           CALL OPEN(%CREATE#,%IDS#) ALTRET(ALTEND_ZIU$Q2IN);

   4663  4 000403   000034 236000 5                  LDQ     28
         4 000404   200006 756100                    STQ     @FLAG+1,,AUTO
         4 000405   000035 236000 5                  LDQ     29
         4 000406   200005 756100                    STQ     TSTMP+2,,AUTO
         4 000407   000047 701000 4                  TSX1    OPEN
         4 000410   002073 702000 4                  TSX2    ALTEND_ZIU$Q2IN

      270     4664    2           END;

   4664  4 000411   000420 710000 4                  TRA     s:4667

      271     4665    1       ELSE
      272     4666    1           CALL OPEN(%UPDATE#,%IDS#) ALTRET(ALTEND_ZIU$Q2IN);

   4666  4 000412   000034 236000 5                  LDQ     28
         4 000413   200006 756100                    STQ     @FLAG+1,,AUTO
         4 000414   000016 236000 5                  LDQ     14
         4 000415   200005 756100                    STQ     TSTMP+2,,AUTO
         4 000416   000047 701000 4                  TSX1    OPEN
         4 000417   002073 702000 4                  TSX2    ALTEND_ZIU$Q2IN

      273     4667    1       FILE# = DCBADDR(DCBSF) -> F$DCB.NAME# ; /* GET FID FROM DCB */

   4667  4 000420   000036 470400 5                  LDP0    30
         4 000421   000000 471500                    LDP1    0,,PR0
         4 000422   000000 220000 xsym               LDX0    DCBSF
         4 000423   100000 473510                    LDP3    0,X0,PR1
         4 000424   000000 100500                    MLR     fill='000'O
         4 000425   300010 000040                    ADSC9   8,,PR3                   cn=0,n=32
         4 000426   000021 000040 0                  ADSC9   FILE#                    cn=0,n=32

      274     4668    1       IF DCBADDR(DCBSF) -> F$DCB.ORG# ~= %IDS# THEN

   4668  4 000427   300032 236100                    LDQ     26,,PR3
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:52   
         4 000430   777000 376003                    ANQ     -512,DU
         4 000431   007000 116003                    CMPQ    3584,DU
         4 000432   000445 600000 4                  TZE     s:4676

      275     4669    2       DO;

      276     4670    2           ZI$DIR.AREA_NM.NAME=FILE#;

   4670  4 000433   000000 100400                    MLR     fill='000'O
         4 000434   000021 000037 0                  ADSC9   FILE#                    cn=0,n=31
         4 000435   000234 000037 xsym               ADSC9   ZI$DIR+156               cn=0,n=31

      277     4671        /*E* ERROR: ZIU-DBU#NONIDS-C
      278     4672        MESSAGE: %U1 is not an IDS file. INITialization aborted.    */
      279     4673    2           CALL ERR_MSG(DBU#NONIDS,3);

   4673  4 000436   000035 236000 5                  LDQ     29
         4 000437   200006 756100                    STQ     @FLAG+1,,AUTO
         4 000440   000040 236000 5                  LDQ     32
         4 000441   200005 756100                    STQ     TSTMP+2,,AUTO
         4 000442   000003 701000 4                  TSX1    ERR_MSG
         4 000443   000000 011000                    NOP     0

      280     4674    2           GOTO ALTEND_ZIU$Q2IN;

   4674  4 000444   002073 710000 4                  TRA     ALTEND_ZIU$Q2IN

      281     4675    2           END;
      282     4676    1       IF CPLTE_INT ~= 1 THEN /* PARTIAL INIT */

   4676  4 000445   000013 235000 0                  LDA     CPLTE_INT
         4 000446   000001 115007                    CMPA    1,DL
         4 000447   000530 600000 4                  TZE     s:4700

      283     4677    2       DO I=0 TO ICNT; /* SEE IF PAGE 0 SPECIFIED */

   4677  4 000450   000000 450000 xsym               STZ     I
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:53   
         4 000451   000525 710000 4                  TRA     s:4699+1

      284     4678    2           IF INIT_RG.FIRNG(I)=0 OR INIT_RG.SECRNG(I)=0 THEN

   4678  4 000452   000000 235000 xsym               LDA     I
         4 000453   000001 735000                    ALS     1
         4 000454   000000 235005 xsym               LDA     INIT_RG,AL
         4 000455   000462 600000 4                  TZE     s:4680
         4 000456   000000 235000 xsym               LDA     I
         4 000457   000001 735000                    ALS     1
         4 000460   000001 235005 xsym               LDA     INIT_RG+1,AL
         4 000461   000524 601000 4                  TNZ     s:4699

      285     4679    3           DO;

      286     4680    3               CPLTE_INT=-1; /* MARK PARTIAL INIT WITH PAGE 0 */

   4680  4 000462   000001 335007                    LCA     1,DL
         4 000463   000013 755000 0                  STA     CPLTE_INT

      287     4681        /*
      288     4682                 NOW, WE CALCULATE TOT_DBK AND TOT_PGS BASED ON
      289     4683                 THE GRANULE SIZE OF THIS AREA
      290     4684        */
      291     4685    3               CALL GET_FILESZ; /* GET SIZE OF AREA */

   4685  4 000464   000000 631400 5                  EPPR1   0
         4 000465   000000 701000 xent               TSX1    GET_FILESZ
         4 000466   000000 011000                    NOP     0

      292     4686    3               TOT_PGS = XTENSIZESF - 1; /* MINUS THE ATBLK PAGE */

   4686  4 000467   000000 235000 xsym               LDA     XTENSIZESF
         4 000470   000001 135007                    SBLA    1,DL
         4 000471   000000 755000 0                  STA     TOT_PGS

      293     4687    3               IF UWA.AC_REC.FIR_INV_PG = 0 THEN
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:54   

   4687  4 000472   000252 236000 xsym               LDQ     UWA+170
         4 000473   000500 601000 4                  TNZ     s:4691

      294     4688    3                   TOT_DBK=TOT_PGS*UWA.AC_REC.LPP;

   4688  4 000474   000000 236000 0                  LDQ     TOT_PGS
         4 000475   000253 402000 xsym               MPY     UWA+171
         4 000476   000014 756000 0                  STQ     TOT_DBK
         4 000477   000522 710000 4                  TRA     s:4697

      295     4689    3               ELSE /* NEED TO FIGURE OUT THE # OF INV PAGES */
      296     4690    4               DO;

      297     4691    4                   X=(TOT_PGS+4071)/4072; /* ASSUME ALL DATA PGS */

   4691  4 000500   000000 236000 0                  LDQ     TOT_PGS
         4 000501   007747 036007                    ADLQ    4071,DL
         4 000502   000001 772000                    QRL     1
         4 000503   003764 506007                    DIV     2036,DL
         4 000504   000000 756000 xsym               STQ     X

      298     4692    5                   DO WHILE (((TOT_PGS-X)+4071)/4072<X);

   4692  4 000505   000510 710000 4                  TRA     s:4694

      299     4693    5                       X=X-1; /* X IS THE # OF INV PAGES */

   4693  4 000506   000001 336007                    LCQ     1,DL
         4 000507   000000 056000 xsym               ASQ     X

      300     4694    5                       END; /* DO NECESSARY ADJUSTMENT */

   4694  4 000510   000000 236000 0                  LDQ     TOT_PGS
         4 000511   000000 136000 xsym               SBLQ    X
         4 000512   007747 036007                    ADLQ    4071,DL
         4 000513   007750 506007                    DIV     4072,DL
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:55   
         4 000514   000000 116000 xsym               CMPQ    X
         4 000515   000506 604000 4                  TMI     s:4693

      301     4695    4                   TOT_DBK=(TOT_PGS-X)*UWA.AC_REC.LPP;

   4695  4 000516   000000 236000 0                  LDQ     TOT_PGS
         4 000517   000000 136000 xsym               SBLQ    X
         4 000520   000253 402000 xsym               MPY     UWA+171
         4 000521   000014 756000 0                  STQ     TOT_DBK

      302     4696    4                   END;

      303     4697    3               I = ICNT; /* GET OUT OF LOOP */

   4697  4 000522   000000 235000 xsym               LDA     ICNT
         4 000523   000000 755000 xsym               STA     I

      304     4698    3               END;

      305     4699    2           END;

   4699  4 000524   000000 054000 xsym               AOS     I
         4 000525   000000 236000 xsym               LDQ     I
         4 000526   000000 116000 xsym               CMPQ    ICNT
         4 000527   000452 604400 4                  TMOZ    s:4678

      306     4700    1       I_O_KEY=0; /* IN CASE WE READ PAGE 0 */

   4700  4 000530   000000 450000 xsym               STZ     I_O_KEY

      307     4701    1       I_O_SIZE=1; /* OR WRITE PAGE 0 */

   4701  4 000531   000001 235007                    LDA     1,DL
         4 000532   000000 755000 xsym               STA     I_O_SIZE

      308     4702    1       OUT_INDX=0; /* USE I_O_BUF(0:1023) FOR BUF */

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:56   
   4702  4 000533   000000 450000 xsym               STZ     OUT_INDX

      309     4703    1       DATA$=ADDR(I_O_BUF(0));

   4703  4 000534   000000 236000 xsym               LDQ     I_O_BUF$
         4 000535   000000 756000 xsym               STQ     DATA$

      310     4704    1       ATBLK$=DATA$;

   4704  4 000536   000000 756000 xsym               STQ     ATBLK$

      311     4705    1       IF CPLTE_INT = 0 THEN /* PARTIAL INIT WITHIN NO PAGE 0 */

   4705  4 000537   000013 235000 0                  LDA     CPLTE_INT
         4 000540   000553 601000 4                  TNZ     s:4711

      312     4706    2       DO;

      313     4707    2           CALL READ_WRITE(1) ALTRET(ALTEND_ZIU$Q2IN);

   4707  4 000541   000016 236000 5                  LDQ     14
         4 000542   200005 756100                    STQ     TSTMP+2,,AUTO
         4 000543   000116 701000 4                  TSX1    READ_WRITE
         4 000544   002073 702000 4                  TSX2    ALTEND_ZIU$Q2IN

      314     4708    2           TOT_PGS = ATBLK_PG.NUM_DBPG;

   4708  4 000545   000000 470400 xsym               LDP0    ATBLK$
         4 000546   000005 235100                    LDA     5,,PR0
         4 000547   000000 755000 0                  STA     TOT_PGS

      315     4709    2           TOT_DBK = ATBLK_PG.HIGH_DBK - UWA.AC_REC.BASE_DBK;

   4709  4 000550   000016 236100                    LDQ     14,,PR0
         4 000551   000242 136000 xsym               SBLQ    UWA+162
         4 000552   000014 756000 0                  STQ     TOT_DBK

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:57   
      316     4710    2           END;

      317     4711    1       X1=(TOT_DBK+UWA.AC_REC.LPP-1)/UWA.AC_REC.LPP; /* TOTAL DATAPG */

   4711  4 000553   000014 236000 0                  LDQ     TOT_DBK
         4 000554   000253 036000 xsym               ADLQ    UWA+171
         4 000555   000001 136007                    SBLQ    1,DL
         4 000556   000253 506000 xsym               DIV     UWA+171
         4 000557   000016 756000 0                  STQ     X1

      318     4712    1       X2=TOT_PGS-X1; /* AND X2 = TOTAL INV PAGES */

   4712  4 000560   000000 236000 0                  LDQ     TOT_PGS
         4 000561   000016 136000 0                  SBLQ    X1
         4 000562   000017 756000 0                  STQ     X2

      319     4713        /*
      320     4714                 NOW WE HAVE TOT_PGS,TOT_DBK IN HAND FOR ANY CPLTE_INT CASE
      321     4715                 NEXT, WE GOT TO COMPUTE THE CALC_TOT
      322     4716                 AND GET THE CURRENT TIME STAMP BEFORE WE TRY TO CALL
      323     4717                 ATBLK_SETUP WHEN CPLTE_INT=1 OR -1
      324     4718        */
      325     4719    1       TSTAMPSF=VECTOR(TSTMP);

   4719  4 000563   777640 235007                    LDA     -96,DL
         4 000564   200010 452500                    STP2    @ORG+2,,AUTO
         4 000565   200010 236100                    LDQ     @ORG+2,,AUTO
         4 000566   000003 036003                    ADLQ    3,DU
         4 000567   000000 755000 xsym               STA     TSTAMPSF
         4 000570   000001 756000 xsym               STQ     TSTAMPSF+1

      326     4720    1       DATESF=VECTOR(NIL);

   4720  4 000571   000042 237000 5                  LDAQ    34
         4 000572   000000 755000 xsym               STA     DATESF
         4 000573   000001 756000 xsym               STQ     DATESF+1

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:58   
      327     4721    1       SOURCESF=%CLOCK#;

   4721  4 000574   000000 450000 xsym               STZ     SOURCESF

      328     4722    1       DESTSF=%UTS#;

   4722  4 000575   000004 235007                    LDA     4,DL
         4 000576   000000 755000 xsym               STA     DESTSF

      329     4723    1       CALL SYS_FUNC_TSTAMP;

   4723  4 000577   000000 631400 5                  EPPR1   0
         4 000600   000000 701000 xent               TSX1    SYS_FUNC_TSTAMP
         4 000601   000000 011000                    NOP     0

      330     4724    1       CALC_TEMP2=0; /* THIS IS #CALC_HDRS PER PAGE */

   4724  4 000602   000015 450000 0                  STZ     CALC_TEMP2

      331     4725    1       CALC_TOT=0;

   4725  4 000603   000020 450000 0                  STZ     CALC_TOT

      332     4726    1       IF UWA.AC_REC.CALC_NULL=1 THEN

   4726  4 000604   000241 235000 xsym               LDA     UWA+161
         4 000605   000001 115007                    CMPA    1,DL
         4 000606   000611 601000 4                  TNZ     s:4729

      333     4727    1           CALC_TEMP = 0; /* NO CALC HDRS IN THIS AREA */

   4727  4 000607   000001 450000 0                  STZ     CALC_TEMP
         4 000610   000622 710000 4                  TRA     s:4733

      334     4728    1       ELSE
      335     4729    1           IF UWA.AC_REC.LPP >= UWA.AC_REC.IDB THEN

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:59   
   4729  4 000611   000253 236000 xsym               LDQ     UWA+171
         4 000612   000254 116000 xsym               CMPQ    UWA+172
         4 000613   000617 604000 4                  TMI     s:4732

      336     4730    1              CALC_TEMP=UWA.AC_REC.LPP/UWA.AC_REC.IDB; /*Find interval for calc hdrs*/

   4730  4 000614   000254 506000 xsym               DIV     UWA+172
         4 000615   000001 756000 0                  STQ     CALC_TEMP
         4 000616   000622 710000 4                  TRA     s:4733

      337     4731    1           ELSE
      338     4732    1               CALC_TEMP2=UWA.AC_REC.IDB/UWA.AC_REC.LPP;

   4732  4 000617   000254 236000 xsym               LDQ     UWA+172
         4 000620   000253 506000 xsym               DIV     UWA+171
         4 000621   000015 756000 0                  STQ     CALC_TEMP2

      339     4733    1       IF CALC_TEMP ~= 0 OR CALC_TEMP2 ~= 0 THEN

   4733  4 000622   000001 235000 0                  LDA     CALC_TEMP
         4 000623   000626 601000 4                  TNZ     s:4735
         4 000624   000015 236000 0                  LDQ     CALC_TEMP2
         4 000625   000666 600000 4                  TZE     s:4749

      340     4734    2       DO;

      341     4735    2           CALC_TOT = (TOT_DBK+(UWA.AC_REC.IDB-1))/UWA.AC_REC.IDB;

   4735  4 000626   000254 236000 xsym               LDQ     UWA+172
         4 000627   000014 036000 0                  ADLQ    TOT_DBK
         4 000630   000001 136007                    SBLQ    1,DL
         4 000631   000254 506000 xsym               DIV     UWA+172
         4 000632   000020 756000 0                  STQ     CALC_TOT

      342     4736    2   PRIME:  IF CALC_TOT > 3 THEN /* FIND THE CLOSEST PRIME # */

   4736  4 000633   000020 235000 0     PRIME        LDA     CALC_TOT
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:60   
         4 000634   000003 115007                    CMPA    3,DL
         4 000635   000666 604400 4                  TMOZ    s:4749

      343     4737    3           DO;

      344     4738    3               IF MOD(CALC_TOT,2)=0 THEN

   4738  4 000636   000020 236000 0                  LDQ     CALC_TOT
         4 000637   000002 506007                    DIV     2,DL
         4 000640   000044 733000                    LRS     36
         4 000641   000000 116003                    CMPQ    0,DU
         4 000642   000645 601000 4                  TNZ     s:4740

      345     4739    3                   CALC_TOT=CALC_TOT-1;

   4739  4 000643   000001 336007                    LCQ     1,DL
         4 000644   000020 056000 0                  ASQ     CALC_TOT

      346     4740    4               DO X = 3 TO CALC_TOT/2 BY 2;

   4740  4 000645   000003 235007                    LDA     3,DL
         4 000646   000000 755000 xsym               STA     X
         4 000647   000662 710000 4                  TRA     s:4746+2

      347     4741    4                   IF MOD(CALC_TOT,X)=0 THEN

   4741  4 000650   000020 236000 0                  LDQ     CALC_TOT
         4 000651   000000 506000 xsym               DIV     X
         4 000652   000044 733000                    LRS     36
         4 000653   000000 116003                    CMPQ    0,DU
         4 000654   000660 601000 4                  TNZ     s:4746

      348     4742    5                   DO;

      349     4743    5                       CALC_TOT=CALC_TOT-1;

   4743  4 000655   000001 336007                    LCQ     1,DL
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:61   
         4 000656   000020 056000 0                  ASQ     CALC_TOT

      350     4744    5                       GOTO PRIME;

   4744  4 000657   000633 710000 4                  TRA     PRIME

      351     4745    5                       END;
      352     4746    4                   END;

   4746  4 000660   000002 236007                    LDQ     2,DL
         4 000661   000000 056000 xsym               ASQ     X
         4 000662   000020 236000 0                  LDQ     CALC_TOT
         4 000663   000002 506007                    DIV     2,DL
         4 000664   000000 116000 xsym               CMPQ    X
         4 000665   000650 605000 4                  TPL     s:4741

      353     4747    3               END;

      354     4748    2           END;

      355     4749    1       IF CALC_TEMP2 ~= 0 THEN CALC_TEMP=0;

   4749  4 000666   000015 235000 0                  LDA     CALC_TEMP2
         4 000667   000671 600000 4                  TZE     s:4750

   4749  4 000670   000001 450000 0                  STZ     CALC_TEMP

      356     4750    1       PAGES_PER_HDR=CALC_TEMP2; /* REMBER THIS */

   4750  4 000671   000000 620005                    EAX0    0,AL
         4 000672   000004 740000 0                  STX0    PAGES_PER_HDR

      357     4751    1       HDRS_PER_PAGE=CALC_TEMP; /* AND THIS */

   4751  4 000673   000001 721000 0                  LXL1    CALC_TEMP
         4 000674   000005 741000 0                  STX1    HDRS_PER_PAGE

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:62   
      358     4752    1       PTR_LEN=UWA.OA_REC.GLBL+1; /* GLOBAL POINTER SIZE */

   4752  4 000675   000226 235000 xsym               LDA     UWA+150
         4 000676   000001 035007                    ADLA    1,DL
         4 000677   000000 755000 xsym               STA     PTR_LEN

      359     4753    1       CALC_HDR_SIZE=4+2*PTR_LEN; /* *CALC.RC RECORD SIZE */

   4753  4 000700   000001 735000                    ALS     1
         4 000701   000004 035007                    ADLA    4,DL
         4 000702   000003 755000 0                  STA     CALC_HDR_SIZE

      360     4754    1       IF CPLTE_INT~=0 THEN /* SEE IF UPDATE PAGE 0 */

   4754  4 000703   000013 236000 0                  LDQ     CPLTE_INT
         4 000704   000723 600000 4                  TZE     s:4765

      361     4755    2       DO; /* FULL INIT OR PARTIAL INIT WITHIN PAGE 0 */

      362     4756    2           DATA_PG='0'B;

   4756  4 000705   000000 470400 xsym               LDP0    DATA$
         4 000706   010000 222003                    LDX2    4096,DU
         4 000707   000140 100400                    MLR     fill='000'O
         4 000710   000000 000001 5                  ADSC9   0                        cn=0,n=1
         4 000711   000000 000012                    ADSC9   0,,PR0                   cn=0,n=*X2

      363     4757    2           CALL ATBLK_PG_SETUP; /* BUILD ALBLK PAGE */

   4757  4 000712   001267 701000 4                  TSX1    ATBLK_PG_SETUP
         4 000713   000000 011000                    NOP     0

      364     4758    2           CALL READ_WRITE(0) ALTRET(ALTEND_ZIU$Q2IN);

   4758  4 000714   000003 236000 5                  LDQ     3
         4 000715   200005 756100                    STQ     TSTMP+2,,AUTO
         4 000716   000116 701000 4                  TSX1    READ_WRITE
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:63   
         4 000717   002073 702000 4                  TSX2    ALTEND_ZIU$Q2IN

      365     4759    2           CALL EXCTN_REPRT_SETUP; /* PREPARE DATA FOR REPORT */

   4759  4 000720   000000 631400 5                  EPPR1   0
         4 000721   000000 701000 xent               TSX1    EXCTN_REPRT_SETUP
         4 000722   000000 011000                    NOP     0

      366     4760    2           END;

      367     4761        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:64   
      368     4762        /*
      369     4763                 INIT PAGE RANGES AS SPECIFIED
      370     4764        */
      371     4765    2       DO I=0 TO ICNT;
              4765                /*Start reading from the page range array gotten from directive*/

   4765  4 000723   000000 450000 xsym               STZ     I
         4 000724   001071 710000 4                  TRA     NEXT_RANGE+1

      372     4766    2           RB=INIT_RG.FIRNG(I); /*Beginning range*/

   4766  4 000725   000000 235000 xsym               LDA     I
         4 000726   000001 735000                    ALS     1
         4 000727   000000 235005 xsym               LDA     INIT_RG,AL
         4 000730   000000 755000 xsym               STA     RB

      373     4767    2           RE=INIT_RG.SECRNG(I); /*Ending page range*/

   4767  4 000731   000000 236000 xsym               LDQ     I
         4 000732   000001 736000                    QLS     1
         4 000733   000001 235006 xsym               LDA     INIT_RG+1,QL
         4 000734   000000 755000 xsym               STA     RE

      374     4768    2           IF RB>RE THEN /* REVERSE THE RANGE IF WRONG */

   4768  4 000735   000000 236000 xsym               LDQ     RE
         4 000736   000000 116000 xsym               CMPQ    RB
         4 000737   000761 603000 4                  TRC     s:4776

      375     4769    3           DO;

      376     4770    3               INIT_RG.FIRNG(I)=RE;

   4770  4 000740   000000 235000 xsym               LDA     I
         4 000741   000001 735000                    ALS     1
         4 000742   000000 756005 xsym               STQ     INIT_RG,AL

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:65   
      377     4771    3               INIT_RG.SECRNG(I)=RB;

   4771  4 000743   000000 236000 xsym               LDQ     RB
         4 000744   000001 756005 xsym               STQ     INIT_RG+1,AL

      378     4772    3               RB=RE;

   4772  4 000745   000000 235000 xsym               LDA     RE
         4 000746   000000 755000 xsym               STA     RB

      379     4773    3               RE=INIT_RG.SECRNG(I);

   4773  4 000747   000000 236000 xsym               LDQ     I
         4 000750   000001 736000                    QLS     1
         4 000751   000001 235006 xsym               LDA     INIT_RG+1,QL
         4 000752   000000 755000 xsym               STA     RE

      380     4774    3               CALL ERR_MSG(1003,0); /* GIVE A WARNING MESSAGE */

   4774  4 000753   000003 236000 5                  LDQ     3
         4 000754   200006 756100                    STQ     @FLAG+1,,AUTO
         4 000755   000045 236000 5                  LDQ     37
         4 000756   200005 756100                    STQ     TSTMP+2,,AUTO
         4 000757   000003 701000 4                  TSX1    ERR_MSG
         4 000760   000000 011000                    NOP     0

      381     4775    3               END;

      382     4776    2           IF RB=0 AND RE =0 THEN GOTO NEXT_RANGE;

   4776  4 000761   000000 235000 xsym               LDA     RB
         4 000762   000765 601000 4                  TNZ     s:4777
         4 000763   000000 236000 xsym               LDQ     RE
         4 000764   001070 600000 4                  TZE     NEXT_RANGE

      383     4777    2           IF RB=0 THEN RB=1;

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:66   
   4777  4 000765   000000 115003                    CMPA    0,DU
         4 000766   000771 601000 4                  TNZ     s:4778

   4777  4 000767   000001 236007                    LDQ     1,DL
         4 000770   000000 756000 xsym               STQ     RB

      384     4778    2           IF RE>X1 THEN /* IF PAGE RANGE OVER INV PAGES */

   4778  4 000771   000000 236000 xsym               LDQ     RE
         4 000772   000775 604000 4                  TMI     s:4785
         4 000773   000016 116000 0                  CMPQ    X1
         4 000774   001006 604400 4                  TMOZ    BUF_FULL

      385     4779    3           DO;

      386     4780        /***************************************************/
      387     4781        /*E* ERROR: ZIU-DBU#BADRNG-C
      388     4782        MESSAGE: Page range for %U1 is greater than or equal to the first inventory page.
      389     4783        */
      390     4784        /*******************************************************/
      391     4785    3               CALL ERR_MSG(DBU#BADRNG,3); /* DESERVE A 3 STARS */

   4785  4 000775   000035 236000 5                  LDQ     29
         4 000776   200006 756100                    STQ     @FLAG+1,,AUTO
         4 000777   000047 236000 5                  LDQ     39
         4 001000   200005 756100                    STQ     TSTMP+2,,AUTO
         4 001001   000003 701000 4                  TSX1    ERR_MSG
         4 001002   000000 011000                    NOP     0

      392     4786    3               ICNT=-1; /*Initialize icnt for init all*/

   4786  4 001003   000001 335007                    LCA     1,DL
         4 001004   000000 755000 xsym               STA     ICNT

      393     4787    3               GOTO ALTEND_ZIU$Q2IN;

   4787  4 001005   002073 710000 4                  TRA     ALTEND_ZIU$Q2IN
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:67   

      394     4788    3               END;
      395     4789    2   BUF_FULL: /* RESTART INIT PAGES AFTER LAST BLOCK WRITTEN */
      396     4790    2           I_O_SIZE = RE - RB + 1;

   4790  4 001006   000000 236000 xsym  BUF_FULL     LDQ     RE
         4 001007   000000 136000 xsym               SBLQ    RB
         4 001010   000001 036007                    ADLQ    1,DL
         4 001011   000000 756000 xsym               STQ     I_O_SIZE

      397     4791    2           IF I_O_SIZE > 2*NBUFS THEN

   4791  4 001012   000000 236000 xsym               LDQ     NBUFS
         4 001013   000001 736000                    QLS     1
         4 001014   000000 116000 xsym               CMPQ    I_O_SIZE
         4 001015   001017 605000 4                  TPL     s:4793

      398     4792    2               I_O_SIZE = 2*NBUFS; /* USE MAX SIZE OF BUF */

   4792  4 001016   000000 756000 xsym               STQ     I_O_SIZE

      399     4793    2           OUT_INDX=0; /* NOTHING IN THE NEW BLOCK */

   4793  4 001017   000000 450000 xsym               STZ     OUT_INDX

      400     4794    2           I_O_KEY = RB; /* REM FIRST RB FOR IDSKEY */

   4794  4 001020   000000 235000 xsym               LDA     RB
         4 001021   000000 755000 xsym               STA     I_O_KEY

      401     4795    3           DO RB=RB TO RE BY 1;

   4795  4 001022   001065 710000 4                  TRA     s:4811+3

      402     4796    3               IF BREAK_FLAG > 0 THEN

   4796  4 001023   000000 235000 xsym               LDA     BREAK_FLAG
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:68   
         4 001024   001040 604400 4                  TMOZ    s:4802

      403     4797    4               DO;

      404     4798    4                   DCBSF = ZI$DIR.AREA_NM.DCB#;

   4798  4 001025   000244 220000 xsym               LDX0    ZI$DIR+164
         4 001026   000000 740000 xsym               STX0    DCBSF

      405     4799    4                   CALL SYS_FUNC_CLOS;

   4799  4 001027   000000 631400 5                  EPPR1   0
         4 001030   000000 701000 xent               TSX1    SYS_FUNC_CLOS
         4 001031   000000 011000                    NOP     0

      406     4800    4                   UNWIND TO RESTART;

   4800  4 001032   000100 100600                    MLR   ! fill='000'O
         4 001033   000000 000010 xsym               ADSC9   RESTART                  cn=0,n=8
         4 001034   200010 000010                    ADSC9   @ORG+2,,AUTO             cn=0,n=8
         4 001035   200010 237300                    LDAQ  ! @ORG+2,,AUTO
         4 001036   000000 700200 xent               TSX0  ! X66_AUNWIND
         4 001037   000000 000200                    ZERO    0,128

      407     4801    4                   END;
      408     4802    3               DATA$=ADDR(I_O_BUF(OUT_INDX)); /*Ptr to page to be inited*/

   4802  4 001040   000000 236000 xsym               LDQ     OUT_INDX
         4 001041   000034 736000                    QLS     28
         4 001042   000000 036000 xsym               ADLQ    I_O_BUF$
         4 001043   000000 756000 xsym               STQ     DATA$

      409     4803    3               CALL DPG_SETUP ;

   4803  4 001044   001416 701000 4                  TSX1    DPG_SETUP
         4 001045   000000 011000                    NOP     0

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:69   
      410     4804    3               OUT_INDX=OUT_INDX+1;

   4804  4 001046   000000 054000 xsym               AOS     OUT_INDX

      411     4805    3               IF OUT_INDX = I_O_SIZE THEN

   4805  4 001047   000000 236000 xsym               LDQ     OUT_INDX
         4 001050   000000 116000 xsym               CMPQ    I_O_SIZE
         4 001051   001062 601000 4                  TNZ     s:4811

      412     4806    4               DO;

      413     4807    4                   CALL READ_WRITE(0) ALTRET(ALTEND_ZIU$Q2IN);

   4807  4 001052   000003 236000 5                  LDQ     3
         4 001053   200005 756100                    STQ     TSTMP+2,,AUTO
         4 001054   000116 701000 4                  TSX1    READ_WRITE
         4 001055   002073 702000 4                  TSX2    ALTEND_ZIU$Q2IN

      414     4808    4                   RB=RB+1; /* SIMULATE DO RB LOOP */

   4808  4 001056   000000 235000 xsym               LDA     RB
         4 001057   000001 035007                    ADLA    1,DL
         4 001060   000000 755000 xsym               STA     RB

      415     4809    4                   GOTO BUF_FULL;

   4809  4 001061   001006 710000 4                  TRA     BUF_FULL

      416     4810    4                   END;
      417     4811    3               END;

   4811  4 001062   000000 235000 xsym               LDA     RB
         4 001063   000001 035007                    ADLA    1,DL
         4 001064   000000 755000 xsym               STA     RB
         4 001065   000000 236000 xsym               LDQ     RE
         4 001066   000000 116000 xsym               CMPQ    RB
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:70   
         4 001067   001023 603000 4                  TRC     s:4796

      418     4812    2   NEXT_RANGE:
      419     4813    2           END;

   4813  4 001070   000000 054000 xsym  NEXT_RANGE   AOS     I
         4 001071   000000 236000 xsym               LDQ     I
         4 001072   000000 116000 xsym               CMPQ    ICNT
         4 001073   000725 604400 4                  TMOZ    s:4766

      420     4814        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:71   
      421     4815        /*
      422     4816                 NOW WE ARE GOING TO UPDATE THE INVENTORY PAGES
      423     4817        */
      424     4818    1       IF X2=0 THEN GOTO END_ZIU$Q2IN; /* NO INV PAGES AT ALL */

   4818  4 001074   000017 235000 0                  LDA     X2
         4 001075   001753 600000 4                  TZE     END_ZIU$Q2IN

      425     4819    2       DO I=0 TO ICNT; /* LOOP THRU PAGE RANGE */

   4819  4 001076   000000 450000 xsym               STZ     I
         4 001077   001263 710000 4                  TRA     NEXT_INV_RANGE+1

      426     4820    2           RB=INIT_RG.FIRNG(I);

   4820  4 001100   000000 235000 xsym               LDA     I
         4 001101   000001 735000                    ALS     1
         4 001102   000000 235005 xsym               LDA     INIT_RG,AL
         4 001103   000000 755000 xsym               STA     RB

      427     4821    2           RE=INIT_RG.SECRNG(I);

   4821  4 001104   000000 236000 xsym               LDQ     I
         4 001105   000001 736000                    QLS     1
         4 001106   000001 235006 xsym               LDA     INIT_RG+1,QL
         4 001107   000000 755000 xsym               STA     RE

      428     4822    2           IF RB=0 AND RE=0 THEN GOTO NEXT_INV_RANGE;

   4822  4 001110   000000 235000 xsym               LDA     RB
         4 001111   001114 601000 4                  TNZ     s:4823
         4 001112   000000 235000 xsym               LDA     RE
         4 001113   001262 600000 4                  TZE     NEXT_INV_RANGE

      429     4823    2           IF RB=0 THEN RB=1;

   4823  4 001114   000000 235000 xsym               LDA     RB
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:72   
         4 001115   001120 601000 4                  TNZ     s:4824

   4823  4 001116   000001 235007                    LDA     1,DL
         4 001117   000000 755000 xsym               STA     RB

      430     4824    2           IB=(RB+4071)/4072+X1; /* FIRST INV PAGE # */

   4824  4 001120   000000 236000 xsym               LDQ     RB
         4 001121   007747 036007                    ADLQ    4071,DL
         4 001122   000001 772000                    QRL     1
         4 001123   003764 506007                    DIV     2036,DL
         4 001124   000016 036000 0                  ADLQ    X1
         4 001125   000000 756000 xsym               STQ     IB

      431     4825    2           IE=(RE+4071)/4072+X1; /* LAST INV PAGE # */

   4825  4 001126   000000 236000 xsym               LDQ     RE
         4 001127   007747 036007                    ADLQ    4071,DL
         4 001130   000001 772000                    QRL     1
         4 001131   003764 506007                    DIV     2036,DL
         4 001132   000016 036000 0                  ADLQ    X1
         4 001133   000000 756000 xsym               STQ     IE

      432     4826    2   INV_BUF_FULL:
      433     4827    2           I_O_SIZE = IE - IB + 1;

   4827  4 001134   000000 236000 xsym  INV_BUF_FULL LDQ     IE
         4 001135   000000 136000 xsym               SBLQ    IB
         4 001136   000001 036007                    ADLQ    1,DL
         4 001137   000000 756000 xsym               STQ     I_O_SIZE

      434     4828    2           IF I_O_SIZE > 2*NBUFS THEN

   4828  4 001140   000000 236000 xsym               LDQ     NBUFS
         4 001141   000001 736000                    QLS     1
         4 001142   000000 116000 xsym               CMPQ    I_O_SIZE
         4 001143   001145 605000 4                  TPL     s:4830
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:73   

      435     4829    2               I_O_SIZE = 2*NBUFS;

   4829  4 001144   000000 756000 xsym               STQ     I_O_SIZE

      436     4830    2           OUT_INDX = 0;

   4830  4 001145   000000 450000 xsym               STZ     OUT_INDX

      437     4831    2           INVPG$=ADDR(I_O_BUF(0));

   4831  4 001146   000000 236000 xsym               LDQ     I_O_BUF$
         4 001147   000000 756000 xsym               STQ     INVPG$

      438     4832    2           DATA$ = INVPG$;

   4832  4 001150   000000 756000 xsym               STQ     DATA$

      439     4833    2           I_O_KEY = IB;

   4833  4 001151   000000 235000 xsym               LDA     IB
         4 001152   000000 755000 xsym               STA     I_O_KEY

      440     4834    2           IF CPLTE_INT < 1 THEN /* THIS IS A PARTIAL INIT */

   4834  4 001153   000013 235000 0                  LDA     CPLTE_INT
         4 001154   001161 605400 4                  TPNZ    s:4836

      441     4835    2               CALL READ_WRITE(1) ALTRET(ALTEND_ZIU$Q2IN);

   4835  4 001155   000016 236000 5                  LDQ     14
         4 001156   200005 756100                    STQ     TSTMP+2,,AUTO
         4 001157   000116 701000 4                  TSX1    READ_WRITE
         4 001160   002073 702000 4                  TSX2    ALTEND_ZIU$Q2IN

      442     4836    3           DO RB = RB TO RE;

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:74   
   4836  4 001161   001245 710000 4                  TRA     s:4856+3

      443     4837    3               IF MOD(RB+4071,4072)=0 AND CPLTE_INT=1 THEN

   4837  4 001162   000000 235000 xsym               LDA     RB
         4 001163   007747 035007                    ADLA    4071,DL
         4 001164   000043 773000                    LRL     35
         4 001165   007750 507007                    DVF     4072,DL
         4 001166   000000 116003                    CMPQ    0,DU
         4 001167   001175 601000 4                  TNZ     s:4839
         4 001170   000013 235000 0                  LDA     CPLTE_INT
         4 001171   000001 115007                    CMPA    1,DL
         4 001172   001175 601000 4                  TNZ     s:4839

      444     4838    3                   CALL INVPG_SETUP; /* FOR FULL INIT, SETUP HEADER */

   4838  4 001173   001716 701000 4                  TSX1    INVPG_SETUP
         4 001174   000000 011000                    NOP     0

      445     4839    3               X=MOD(RB-1,4072);

   4839  4 001175   000000 236000 xsym               LDQ     RB
         4 001176   000001 136007                    SBLQ    1,DL
         4 001177   007750 506007                    DIV     4072,DL
         4 001200   000000 755000 xsym               STA     X

      446     4840    3               INV_PG.INVENT_CT(X)='777'O;

   4840  4 001201   000000 470400 xsym               LDP0    INVPG$
         4 001202   000105 100400                    MLR     fill='000'O
         4 001203   000050 000001 5                  ADSC9   40                       cn=0,n=1
         4 001204   000006 000001                    ADSC9   6,A,PR0                  cn=0,n=1

      447     4841    3               IF MOD(RB,4072)=0 THEN /* SWITCH TO NEXT INV */

   4841  4 001205   000000 235000 xsym               LDA     RB
         4 001206   000043 773000                    LRL     35
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:75   
         4 001207   007750 507007                    DVF     4072,DL
         4 001210   000000 116003                    CMPQ    0,DU
         4 001211   001242 601000 4                  TNZ     s:4856

      448     4842    4               DO;

      449     4843    4                   IF UWA.AC_REC.SWS.CHECKSUM THEN

   4843  4 001212   000233 234000 xsym               SZN     UWA+155
         4 001213   001216 605000 4                  TPL     s:4845

      450     4844    4                       CALL GET_CHKSUM;

   4844  4 001214   001741 701000 4                  TSX1    GET_CHKSUM
         4 001215   000000 011000                    NOP     0

      451     4845    4                   OUT_INDX=OUT_INDX+1;

   4845  4 001216   000000 054000 xsym               AOS     OUT_INDX

      452     4846    4                   INVPG$=ADDR(I_O_BUF(OUT_INDX));

   4846  4 001217   000000 236000 xsym               LDQ     OUT_INDX
         4 001220   000034 736000                    QLS     28
         4 001221   000000 036000 xsym               ADLQ    I_O_BUF$
         4 001222   000000 756000 xsym               STQ     INVPG$

      453     4847    4                   DATA$=INVPG$;

   4847  4 001223   000000 756000 xsym               STQ     DATA$

      454     4848    4                   IB = IB + 1; /* INCREMENT INV PAGE # */

   4848  4 001224   000000 235000 xsym               LDA     IB
         4 001225   000001 035007                    ADLA    1,DL
         4 001226   000000 755000 xsym               STA     IB

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:76   
      455     4849    4                   IF OUT_INDX=I_O_SIZE THEN

   4849  4 001227   000000 236000 xsym               LDQ     OUT_INDX
         4 001230   000000 116000 xsym               CMPQ    I_O_SIZE
         4 001231   001242 601000 4                  TNZ     s:4856

      456     4850    5                   DO;

      457     4851    5                       CALL READ_WRITE(0) ALTRET(ALTEND_ZIU$Q2IN);

   4851  4 001232   000003 236000 5                  LDQ     3
         4 001233   200005 756100                    STQ     TSTMP+2,,AUTO
         4 001234   000116 701000 4                  TSX1    READ_WRITE
         4 001235   002073 702000 4                  TSX2    ALTEND_ZIU$Q2IN

      458     4852    5                       RB=RB+1;

   4852  4 001236   000000 235000 xsym               LDA     RB
         4 001237   000001 035007                    ADLA    1,DL
         4 001240   000000 755000 xsym               STA     RB

      459     4853    5                       GOTO INV_BUF_FULL;

   4853  4 001241   001134 710000 4                  TRA     INV_BUF_FULL

      460     4854    5                       END;
      461     4855    4                   END;
      462     4856    3               END;

   4856  4 001242   000000 235000 xsym               LDA     RB
         4 001243   000001 035007                    ADLA    1,DL
         4 001244   000000 755000 xsym               STA     RB
         4 001245   000000 236000 xsym               LDQ     RE
         4 001246   000000 116000 xsym               CMPQ    RB
         4 001247   001162 603000 4                  TRC     s:4837

      463     4857    2           IF I_O_SIZE>0 THEN /* ANY INV LEFT IN BUFFER */
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:77   

   4857  4 001250   000000 235000 xsym               LDA     I_O_SIZE
         4 001251   001262 604400 4                  TMOZ    NEXT_INV_RANGE

      464     4858    3           DO;

      465     4859    3               IF UWA.AC_REC.SWS.CHECKSUM THEN CALL GET_CHKSUM;

   4859  4 001252   000233 234000 xsym               SZN     UWA+155
         4 001253   001256 605000 4                  TPL     s:4860

   4859  4 001254   001741 701000 4                  TSX1    GET_CHKSUM
         4 001255   000000 011000                    NOP     0

      466     4860    3               CALL READ_WRITE(0) ALTRET(ALTEND_ZIU$Q2IN);

   4860  4 001256   000003 236000 5                  LDQ     3
         4 001257   200005 756100                    STQ     TSTMP+2,,AUTO
         4 001260   000116 701000 4                  TSX1    READ_WRITE
         4 001261   002073 702000 4                  TSX2    ALTEND_ZIU$Q2IN

      467     4861    3               END;

      468     4862    2   NEXT_INV_RANGE:
      469     4863    2           END;

   4863  4 001262   000000 054000 xsym  NEXT_INV_RA* AOS     I
         4 001263   000000 236000 xsym               LDQ     I
         4 001264   000000 116000 xsym               CMPQ    ICNT
         4 001265   001100 604400 4                  TMOZ    s:4820

      470     4864    1       GOTO END_ZIU$Q2IN;

   4864  4 001266   001753 710000 4                  TRA     END_ZIU$Q2IN

      471     4865        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:78   
      472     4866    1   ATBLK_PG_SETUP: PROC;

   4866  4 001267   200004 741300       ATBLK_PG_SE* STX1  ! TSTMP+1,,AUTO

      473     4867    2       ATBLK_PG.SYS_WRDS.DATE=TSTMP;

   4867  4 001270   200003 236100                    LDQ     TSTMP,,AUTO
         4 001271   000000 470400 xsym               LDP0    ATBLK$
         4 001272   000001 756100                    STQ     1,,PR0

      474     4868    2       ATBLK_PG.DB_INFO.DBK_SZ = UWA.OA_REC.GLBL+1;/*Size of gblptrs*/

   4868  4 001273   000226 720000 xsym               LXL0    UWA+150
         4 001274   000001 621010                    EAX1    1,X0
         4 001275   000010 741100                    STX1    8,,PR0

      475     4869    2       IF UWA.AC_REC.FIR_INV_PG=0

   4869  4 001276   000252 235000 xsym               LDA     UWA+170
         4 001277   001303 601000 4                  TNZ     s:4871

      476     4870    2       THEN ATBLK_PG.DB_INFO.PRCNT_INV=0;

   4870  4 001300   000000 236003                    LDQ     0,DU
         4 001301   000010 552110                    STBQ    8,'10'O,PR0
         4 001302   001316 710000 4                  TRA     s:4875

      477     4871    2       ELSE IF UWA.AC_REC.PER_INV >= 100 THEN

   4871  4 001303   000240 235000 xsym               LDA     UWA+160
         4 001304   000144 115007                    CMPA    100,DL
         4 001305   001311 604000 4                  TMI     s:4873

      478     4872    2               ATBLK_PG.DB_INFO.PRCNT_INV=100;

   4872  4 001306   144000 236007                    LDQ     51200,DL
         4 001307   000010 552110                    STBQ    8,'10'O,PR0
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:79   
         4 001310   001316 710000 4                  TRA     s:4875

      479     4873    2           ELSE IF UWA.AC_REC.PER_INV >= 0 THEN

   4873  4 001311   000000 115003                    CMPA    0,DU
         4 001312   001316 604000 4                  TMI     s:4875

      480     4874    2                   ATBLK_PG.DB_INFO.PRCNT_INV = UWA.AC_REC.PER_INV;

   4874  4 001313   000240 236000 xsym               LDQ     UWA+160
         4 001314   000011 736000                    QLS     9
         4 001315   000010 552110                    STBQ    8,'10'O,PR0

      481     4875    2       ATBLK_PG.PG_NUM=0;

   4875  4 001316   000004 450100                    STZ     4,,PR0

      482     4876    2       ATBLK_PG.NUM_DBPG=TOT_PGS;

   4876  4 001317   000000 235000 0                  LDA     TOT_PGS
         4 001320   000005 755100                    STA     5,,PR0

      483     4877         /* Total of all data pgs + atblk + data_pgs per invpg*/
      484     4878    2       ATBLK_PG.SCHNAM=ZI$DIR.SCHEMA_NM.NAME.TEXT;

   4878  4 001321   040100 100400                    MLR     fill='040'O
         4 001322   000223 200036 xsym               ADSC9   ZI$DIR+147               cn=1,n=30
         4 001323   000031 000036                    ADSC9   25,,PR0                  cn=0,n=30

      485     4879    2       ATBLK_PG.MISC_INFO.CHKSM=UWA.AC_REC.SWS.CHECKSUM;

   4879  4 001324   000233 236000 xsym               LDQ     UWA+155
         4 001325   000001 772000                    QRL     1
         4 001326   000030 676100                    ERQ     24,,PR0
         4 001327   200000 376003                    ANQ     65536,DU
         4 001330   000030 656100                    ERSQ    24,,PR0

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:80   
      486     4880    2       IF UWA.AC_REC.PER_INV ~= 0 THEN

   4880  4 001331   000240 236000 xsym               LDQ     UWA+160
         4 001332   001341 600000 4                  TZE     s:4882

      487     4881    2           ATBLK_PG.MISC_INFO.IUSZ=((4096*(100-UWA.AC_REC.PER_INV))+51199)/51200;

   4881  4 001333   000014 736000                    QLS     12
         4 001334   000013 676000 5                  ERQ     11
         4 001335   000051 036000 5                  ADLQ    41
         4 001336   144000 506007                    DIV     51200,DL
         4 001337   000000 620006                    EAX0    0,QL
         4 001340   000030 440100                    SXL0    24,,PR0

      488     4882    2       ATBLK_PG.TOT_CALC_HDRS = CALC_TOT; /*Number of calc hdrs in the area*/

   4882  4 001341   000020 235000 0                  LDA     CALC_TOT
         4 001342   000013 755100                    STA     11,,PR0

      489     4883    2       ATBLK_PG.IDS_HDR = 'IDS2';

   4883  4 001343   000000 236000 3                  LDQ     0
         4 001344   000003 756100                    STQ     3,,PR0

      490     4884    2       ATBLK_PG.AREA_NM = ZI$DIR.AREA_NM.NAME.TEXT;

   4884  4 001345   040100 100400                    MLR     fill='040'O
         4 001346   000234 200036 xsym               ADSC9   ZI$DIR+156               cn=1,n=30
         4 001347   000017 000040                    ADSC9   15,,PR0                  cn=0,n=32

      491     4885    2       CALL INDEX1(J,' ',ZI$DIR.AREA_NM.NAME.TEXT);

   4885  4 001350   000000 124400                    SCM     mask='000'O
         4 001351   000234 200036 xsym               ADSC9   ZI$DIR+156               cn=1,n=30
         4 001352   000052 000001 5                  ADSC9   42                       cn=0,n=1
         4 001353   000000 000000 xsym               ARG     J

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:81   
      492     4886    2       ATBLK_PG.DB_INFO.AREA_NM_SZ=J;

   4886  4 001354   000000 236000 xsym               LDQ     J
         4 001355   000010 752101                    STCQ    8,'01'O,PR0

      493     4887    2       ATBLK_PG.DB_INFO.PG_MD = UWA.AC_REC.P_TYP.P_MD;

   4887  4 001356   000237 236000 xsym               LDQ     UWA+159
         4 001357   000007 736000                    QLS     7
         4 001360   000010 676100                    ERQ     8,,PR0
         4 001361   000600 376007                    ANQ     384,DL
         4 001362   000010 656100                    ERSQ    8,,PR0

      494     4888    2       ATBLK_PG.LINE_INFO.LPP = UWA.AC_REC.LPP;

   4888  4 001363   000253 720000 xsym               LXL0    UWA+171
         4 001364   000012 440100                    SXL0    10,,PR0

      495     4889    2       ATBLK_PG.HIGH_DBK=TOT_DBK+UWA.AC_REC.BASE_DBK;

   4889  4 001365   000014 236000 0                  LDQ     TOT_DBK
         4 001366   000242 036000 xsym               ADLQ    UWA+162
         4 001367   000016 756100                    STQ     14,,PR0

      496     4890    2       ATBLK_PG.CALC_INFO.IDB = UWA.AC_REC.IDB;

   4890  4 001370   000254 721000 xsym               LXL1    UWA+172
         4 001371   000011 441100                    SXL1    9,,PR0

      497     4891    2       IF UWA.AC_REC.FIR_INV_PG ~= 0 THEN

   4891  4 001372   000252 235000 xsym               LDA     UWA+170
         4 001373   001377 600000 4                  TZE     s:4893

      498     4892    2           ATBLK_PG.FIR_INV_PGNO = X1 + 1;

   4892  4 001374   000016 235000 0                  LDA     X1
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:82   
         4 001375   000001 035007                    ADLA    1,DL
         4 001376   000014 755100                    STA     12,,PR0

      499     4893    2       ATBLK_PG.LOW_DBK = UWA.AC_REC.MIN_DBK;

   4893  4 001377   000245 235000 xsym               LDA     UWA+165
         4 001400   000015 755100                    STA     13,,PR0

      500     4894    2       IF UWA.AC_REC.SEC_KEY = 1 THEN ATBLK_PG.MISC_INFO.KEY_FILE_BLT='1'B;

   4894  4 001401   000235 235000 xsym               LDA     UWA+157
         4 001402   000001 115007                    CMPA    1,DL
         4 001403   001406 601000 4                  TNZ     s:4895

   4894  4 001404   400000 236003                    LDQ     -131072,DU
         4 001405   000030 256100                    ORSQ    24,,PR0

      501     4895    2       ATBLK_PG.DATE_INIT=TSTMP;

   4895  4 001406   200003 236100                    LDQ     TSTMP,,AUTO
         4 001407   000027 756100                    STQ     23,,PR0

      502     4896    2       IF UWA.AC_REC.SWS.CHECKSUM THEN CALL GET_CHKSUM;

   4896  4 001410   000233 234000 xsym               SZN     UWA+155
         4 001411   001414 605000 4                  TPL     s:4897

   4896  4 001412   001741 701000 4                  TSX1    GET_CHKSUM
         4 001413   000000 011000                    NOP     0

      503     4897    2   END ATBLK_PG_SETUP;

   4897  4 001414   200004 221300                    LDX1  ! TSTMP+1,,AUTO
         4 001415   000001 702211                    TSX2  ! 1,X1

      504     4898        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:83   
      505     4899    1   DPG_SETUP: PROC; /* SETUP A DATA PAGE AND INIT CALC HEADERS */

   4899  4 001416   200004 741300       DPG_SETUP    STX1  ! TSTMP+1,,AUTO

      506     4900
      507     4901    2       IF PAGES_PER_HDR > 0 THEN CALC_TEMP = 0;

   4901  4 001417   000004 220000 0                  LDX0    PAGES_PER_HDR
         4 001420   001422 600000 4                  TZE     s:4902

   4901  4 001421   000001 450000 0                  STZ     CALC_TEMP

      508     4902    2       PAGES_INIT=PAGES_INIT+1; /* ADD STATS COUNT */

   4902  4 001422   000006 054000 0                  AOS     PAGES_INIT

      509     4903    2       DATA_PG = '0'B; /* ZERO OUT THIS PAGE */

   4903  4 001423   000000 470400 xsym               LDP0    DATA$
         4 001424   010000 222003                    LDX2    4096,DU
         4 001425   000140 100400                    MLR     fill='000'O
         4 001426   000000 000001 5                  ADSC9   0                        cn=0,n=1
         4 001427   000000 000012                    ADSC9   0,,PR0                   cn=0,n=*X2

      510     4904    2       DATA_PG.SYS_WRDS.DATE=TSTMP;

   4904  4 001430   200003 236100                    LDQ     TSTMP,,AUTO
         4 001431   000000 470400 xsym               LDP0    DATA$
         4 001432   000001 756100                    STQ     1,,PR0

      511     4905    2       DATA_PG.PG_SZ.FIR=4084; /* FIXED PAGE SIZE */

   4905  4 001433   007764 221003                    LDX1    4084,DU
         4 001434   000003 741100                    STX1    3,,PR0

      512     4906    2       DATA_PG.CON_INTRVAL = RB; /* PAGE NUMBER */

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:84   
   4906  4 001435   000000 235000 xsym               LDA     RB
         4 001436   000004 755100                    STA     4,,PR0

      513     4907
      514     4908    2       X = (RB-1)*UWA.AC_REC.LPP; /* X=1ST DBKEY ON PAGE -1 */

   4908  4 001437   000000 236000 xsym               LDQ     RB
         4 001440   000001 136007                    SBLQ    1,DL
         4 001441   000253 402000 xsym               MPY     UWA+171
         4 001442   000000 756000 xsym               STQ     X

      515     4909    2       IF PAGES_PER_HDR = 0 AND HDRS_PER_PAGE = 1 THEN

   4909  4 001443   000000 100003                    CMPX0   0,DU
         4 001444   001452 601000 4                  TNZ     s:4911
         4 001445   000005 223000 0                  LDX3    HDRS_PER_PAGE
         4 001446   000001 103003                    CMPX3   1,DU
         4 001447   001452 601000 4                  TNZ     s:4911

      516     4910    2           CALC_TEMP = 1;

   4910  4 001450   000001 235007                    LDA     1,DL
         4 001451   000001 755000 0                  STA     CALC_TEMP

      517     4911    2       IF PAGES_PER_HDR > 0 AND MOD(RB, PAGES_PER_HDR) = 1 THEN

   4911  4 001452   000000 100003                    CMPX0   0,DU
         4 001453   001477 600000 4                  TZE     s:4914
         4 001454   000004 235000 0                  LDA     PAGES_PER_HDR
         4 001455   000022 771000                    ARL     18
         4 001456   200010 755100                    STA     @ORG+2,,AUTO
         4 001457   000000 236000 xsym               LDQ     RB
         4 001460   001470 605000 4                  TPL     s:4911+14
         4 001461   000001 405007                    CMG     1,DL
         4 001462   001466 600000 4                  TZE     s:4911+12
         4 001463   000000 235003                    LDA     0,DU
         4 001464   000001 737000                    LLS     1
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:85   
         4 001465   200010 507100                    DVF     @ORG+2,,AUTO
         4 001466   000044 737000                    LLS     36
         4 001467   001471 710000 4                  TRA     s:4911+15
         4 001470   200010 506100                    DIV     @ORG+2,,AUTO
         4 001471   000044 733000                    LRS     36
         4 001472   000001 116007                    CMPQ    1,DL
         4 001473   001477 601000 4                  TNZ     s:4914

      518     4912    2           CALC_TEMP = 1; /*  TIME IS UP TO STORE 1 CALC HEADER */

   4912  4 001474   000001 235007                    LDA     1,DL
         4 001475   000001 755000 0                  STA     CALC_TEMP
         4 001476   001514 710000 4                  TRA     s:4916

      519     4913    2       ELSE
      520     4914    2           IF HDRS_PER_PAGE>1 AND RB=X1 THEN /* SPECIAL CHECK ON LAST PAGE */

   4914  4 001477   000005 223000 0                  LDX3    HDRS_PER_PAGE
         4 001500   000002 103003                    CMPX3   2,DU
         4 001501   001514 602000 4                  TNC     s:4916
         4 001502   000000 236000 xsym               LDQ     RB
         4 001503   001514 604000 4                  TMI     s:4916
         4 001504   000016 116000 0                  CMPQ    X1
         4 001505   001514 601000 4                  TNZ     s:4916

      521     4915    2               CALC_TEMP=(TOT_DBK-X+UWA.AC_REC.IDB-1)/UWA.AC_REC.IDB;

   4915  4 001506   000014 236000 0                  LDQ     TOT_DBK
         4 001507   000000 136000 xsym               SBLQ    X
         4 001510   000254 036000 xsym               ADLQ    UWA+172
         4 001511   000001 136007                    SBLQ    1,DL
         4 001512   000254 506000 xsym               DIV     UWA+172
         4 001513   000001 756000 0                  STQ     CALC_TEMP

      522     4916    2       IF CALC_TEMP=0 THEN /* NO CALC HEADER TO BE STORED */

   4916  4 001514   000001 235000 0                  LDA     CALC_TEMP
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:86   
         4 001515   001526 601000 4                  TNZ     s:4925

      523     4917    3       DO;

      524     4918    3           DATA_PG.PG_SZ.SEC = 4070; /* SPACE AVAIL */

   4918  4 001516   007746 223003                    LDX3    4070,DU
         4 001517   000003 443100                    SXL3    3,,PR0

      525     4919    3           DATA_PG.OFF_LN.FIR=0; /* FIRST AVAIL LINE = 0 */

   4919  4 001520   000000 224003                    LDX4    0,DU
         4 001521   000005 744100                    STX4    5,,PR0

      526     4920    3           DATA_PG.OFF_LN.SEC=0; /* CURRENT HIGH LINE = 0 */

   4920  4 001522   000005 444100                    SXL4    5,,PR0

      527     4921    3           DATA_PG.OFFSET(2035)=131072; /* LET 1ST OFFSET BE 400000 */

   4921  4 001523   400000 225003                    LDX5    -131072,DU
         4 001524   001777 445100                    SXL5    1023,,PR0

      528     4922    3           END;

   4922  4 001525   001710 710000 4                  TRA     s:4956

      529     4923    2       ELSE
      530     4924    3       DO; /* STORE CALC HEADERS */

      531     4925    3           K = (CALC_TEMP-1)*UWA.AC_REC.IDB; /* HIGHEST LINE USED */

   4925  4 001526   000001 236000 0                  LDQ     CALC_TEMP
         4 001527   000001 136007                    SBLQ    1,DL
         4 001530   000254 402000 xsym               MPY     UWA+172
         4 001531   000000 756000 xsym               STQ     K

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:87   
      532     4926    3           IF K=0 THEN /* ONLY 1 HDR TO BE STORED */

   4926  4 001532   000000 116003                    CMPQ    0,DU
         4 001533   001541 601000 4                  TNZ     s:4932

      533     4927    4           DO;

      534     4928    4               K = 1; /* LET HIGH LINE BE 1 */

   4928  4 001534   000001 235007                    LDA     1,DL
         4 001535   000000 755000 xsym               STA     K

      535     4929    4               DATA_PG.OFFSET(2034)=131072; /* LET IT BE AVAILABLE */

   4929  4 001536   400000 223003                    LDX3    -131072,DU
         4 001537   001777 743100                    STX3    1023,,PR0

      536     4930    4               END;

   4930  4 001540   001546 710000 4                  TRA     s:4933

      537     4931    3           ELSE /* MORE THAN 1 CALC HEADER TO BE STORED */
      538     4932    3               DATA_PG.OFFSET(2035-K+1)=131072; /* LAST 1 IN AVAIL CHAIN */

   4932  4 001541   000000 335000 xsym               LCA     K
         4 001542   000001 735000                    ALS     1
         4 001543   000105 101400                    MRL     fill='000'O
         4 001544   000053 000004 5                  ADSC9   43                       cn=0,n=4
         4 001545   002000 000002                    ADSC9   1024,A,PR0               cn=0,n=2

      539     4933    3           DATA_PG.PG_SZ.SEC=4070-2*K-CALC_TEMP*CALC_HDR_SIZE;

   4933  4 001546   000001 236000 0                  LDQ     CALC_TEMP
         4 001547   000003 402000 0                  MPY     CALC_HDR_SIZE
         4 001550   200010 756100                    STQ     @ORG+2,,AUTO
         4 001551   000000 236000 xsym               LDQ     K
         4 001552   000001 736000                    QLS     1
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:88   
         4 001553   200010 036100                    ADLQ    @ORG+2,,AUTO
         4 001554   770031 623006                    EAX3    -4071,QL
         4 001555   777777 663003                    ERX3    -1,DU
         4 001556   000000 470400 xsym               LDP0    DATA$
         4 001557   000003 443100                    SXL3    3,,PR0

      540     4934    3           DATA_PG.OFF_LN.FIR = 1; /* 1ST LINE IS 1 */

   4934  4 001560   000001 224003                    LDX4    1,DU
         4 001561   000005 744100                    STX4    5,,PR0

      541     4935    3           DATA_PG.OFF_LN.SEC = K; /* CURRENT HIGH LINE */

   4935  4 001562   000000 725000 xsym               LXL5    K
         4 001563   000005 445100                    SXL5    5,,PR0

      542     4936    3           X = X + UWA.AC_REC.BASE_DBK+1; /* CHANGE 1ST DBK TO GLOBAL */

   4936  4 001564   000000 236000 xsym               LDQ     X
         4 001565   000242 036000 xsym               ADLQ    UWA+162
         4 001566   000001 036007                    ADLQ    1,DL
         4 001567   000000 756000 xsym               STQ     X

      543     4937    4           DO J=0 TO CALC_TEMP-1;

   4937  4 001570   000000 450000 xsym               STZ     J
         4 001571   001643 710000 4                  TRA     s:4945+1

      544     4938    4               DATA_PG.OFFSET(2035-J*UWA.AC_REC.IDB)=12+J*CALC_HDR_SIZE;

   4938  4 001572   000000 236000 xsym               LDQ     J
         4 001573   000254 402000 xsym               MPY     UWA+172
         4 001574   200010 756100                    STQ     @ORG+2,,AUTO
         4 001575   000000 236000 xsym               LDQ     J
         4 001576   000003 402000 0                  MPY     CALC_HDR_SIZE
         4 001577   000014 036007                    ADLQ    12,DL
         4 001600   200011 756100                    STQ     @ORG+3,,AUTO
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:89   
         4 001601   200010 335100                    LCA     @ORG+2,,AUTO
         4 001602   000001 735000                    ALS     1
         4 001603   000000 470400 xsym               LDP0    DATA$
         4 001604   000105 101500                    MRL     fill='000'O
         4 001605   200011 000004                    ADSC9   @ORG+3,,AUTO             cn=0,n=4
         4 001606   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2

      545     4939    4               REC$=PINCRC(DATA$,24+J*CALC_HDR_SIZE);

   4939  4 001607   000000 236000 xsym               LDQ     J
         4 001610   000003 402000 0                  MPY     CALC_HDR_SIZE
         4 001611   000020 736000                    QLS     16
         4 001612   000006 036003                    ADLQ    6,DU
         4 001613   000000 036000 xsym               ADLQ    DATA$
         4 001614   000000 756000 xsym               STQ     REC$

      546     4940    4               REC_HDR.REC_TYP = 4000;

   4940  4 001615   000000 470400 xsym               LDP0    REC$
         4 001616   000100 101400                    MRL     fill='000'O
         4 001617   000054 000004 5                  ADSC9   44                       cn=0,n=4
         4 001620   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2

      547     4941    4               REC_HDR.REC_SZ = CALC_HDR_SIZE;

   4941  4 001621   000000 470400 xsym               LDP0    REC$
         4 001622   000100 101400                    MRL     fill='000'O
         4 001623   000003 000004 0                  ADSC9   CALC_HDR_SIZE            cn=0,n=4
         4 001624   000000 400002                    ADSC9   0,,PR0                   cn=2,n=2

      548     4942    4               PINCRC(REC$,4)->PTR_V=PINCRC(ADDR(X),4-PTR_LEN)->PTR_V;

   4942  4 001625   000000 335000 xsym               LCA     PTR_LEN
         4 001626   000000 720000 xsym               LXL0    PTR_LEN
         4 001627   000000 470400 xsym               LDP0    REC$
         4 001630   040140 100445                    MLR     fill='040'O
         4 001631   000001 000010 xsym               ADSC9   X+1,A                    cn=0,n=*X0
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:90   
         4 001632   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0

      549     4943    4               PINCRC(REC$,4+PTR_LEN)->PTR_V=PINCRC(ADDR(X),4-PTR_LEN)->PTR_V;

   4943  4 001633   000000 236000 xsym               LDQ     PTR_LEN
         4 001634   040146 100445                    MLR     fill='040'O
         4 001635   000001 000010 xsym               ADSC9   X+1,A                    cn=0,n=*X0
         4 001636   000001 000010                    ADSC9   1,Q,PR0                  cn=0,n=*X0

      550     4944    4               X = X + UWA.AC_REC.IDB; /* DBKEY FOR THE NEXT CALC HDR */

   4944  4 001637   000000 236000 xsym               LDQ     X
         4 001640   000254 036000 xsym               ADLQ    UWA+172
         4 001641   000000 756000 xsym               STQ     X

      551     4945    4               END;

   4945  4 001642   000000 054000 xsym               AOS     J
         4 001643   000000 236000 xsym               LDQ     J
         4 001644   000001 116000 0                  CMPQ    CALC_TEMP
         4 001645   001572 604000 4                  TMI     s:4938

      552     4946    4           DO J=1 TO K-2; /* CHAIN AVAIL LINE WHEN 2 OR MORE HDRS STORED */

   4946  4 001646   000001 235007                    LDA     1,DL
         4 001647   000000 755000 xsym               STA     J
         4 001650   001704 710000 4                  TRA     s:4954+1

      553     4947    4               IF MOD(J+1,UWA.AC_REC.IDB)>0 THEN

   4947  4 001651   000000 236000 xsym               LDQ     J
         4 001652   000001 036007                    ADLQ    1,DL
         4 001653   000254 506000 xsym               DIV     UWA+172
         4 001654   000044 733000                    LRS     36
         4 001655   000000 116003                    CMPQ    0,DU
         4 001656   001671 604400 4                  TMOZ    s:4951

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:91   
      554     4948    4                   DATA_PG.OFFSET(2035-J)=131072+J+1;

   4948  4 001657   000000 236000 xsym               LDQ     J
         4 001660   400001 036007                    ADLQ    -131071,DL
         4 001661   200010 756100                    STQ     @ORG+2,,AUTO
         4 001662   000000 335000 xsym               LCA     J
         4 001663   000001 735000                    ALS     1
         4 001664   000000 470400 xsym               LDP0    DATA$
         4 001665   000105 101500                    MRL     fill='000'O
         4 001666   200010 000004                    ADSC9   @ORG+2,,AUTO             cn=0,n=4
         4 001667   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         4 001670   001703 710000 4                  TRA     s:4954

      555     4949    4               ELSE
      556     4950    5               DO; /* NEXT OFFSET IS OCCUIPED BY CALC.RC */

      557     4951    5                   DATA_PG.OFFSET(2035-J)=131072+J+2; /* SKIP IT */

   4951  4 001671   000000 236000 xsym               LDQ     J
         4 001672   400002 036007                    ADLQ    -131070,DL
         4 001673   200010 756100                    STQ     @ORG+2,,AUTO
         4 001674   000000 335000 xsym               LCA     J
         4 001675   000001 735000                    ALS     1
         4 001676   000000 470400 xsym               LDP0    DATA$
         4 001677   000105 101500                    MRL     fill='000'O
         4 001700   200010 000004                    ADSC9   @ORG+2,,AUTO             cn=0,n=4
         4 001701   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2

      558     4952    5                   J = J + 1; /* SKIP UPDATE NEXT OFFSET */

   4952  4 001702   000000 054000 xsym               AOS     J

      559     4953    5                   END;

      560     4954    4               END;

   4954  4 001703   000000 054000 xsym               AOS     J
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:92   
         4 001704   000000 236000 xsym               LDQ     K
         4 001705   000002 136007                    SBLQ    2,DL
         4 001706   000000 116000 xsym               CMPQ    J
         4 001707   001651 605000 4                  TPL     s:4947

      561     4955    3           END;

      562     4956    2       IF UWA.AC_REC.SWS.CHECKSUM THEN

   4956  4 001710   000233 234000 xsym               SZN     UWA+155
         4 001711   001714 605000 4                  TPL     s:4958

      563     4957    2           CALL GET_CHKSUM;

   4957  4 001712   001741 701000 4                  TSX1    GET_CHKSUM
         4 001713   000000 011000                    NOP     0

      564     4958    2   END DPG_SETUP;

   4958  4 001714   200004 221300                    LDX1  ! TSTMP+1,,AUTO
         4 001715   000001 702211                    TSX2  ! 1,X1

      565     4959        %EJECT;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:93   
      566     4960    1   INVPG_SETUP: PROC;

   4960  4 001716   200004 741300       INVPG_SETUP  STX1  ! TSTMP+1,,AUTO

      567     4961    2       DATA_PG='0'B;

   4961  4 001717   000000 470400 xsym               LDP0    DATA$
         4 001720   010000 220003                    LDX0    4096,DU
         4 001721   000140 100400                    MLR     fill='000'O
         4 001722   000000 000001 5                  ADSC9   0                        cn=0,n=1
         4 001723   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0

      568     4962    2       INV_PG.SYS_WRDS.DATE=TSTMP;

   4962  4 001724   200003 236100                    LDQ     TSTMP,,AUTO
         4 001725   000000 470400 xsym               LDP0    INVPG$
         4 001726   000001 756100                    STQ     1,,PR0

      569     4963    2       INV_PG.PG_SZ_INFO.PG_SZ = 4084;

   4963  4 001727   007764 221003                    LDX1    4084,DU
         4 001730   000003 741100                    STX1    3,,PR0

      570     4964    2       INV_PG.PG_SZ_INFO.SP_AV = 0;

   4964  4 001731   000000 222003                    LDX2    0,DU
         4 001732   000003 442100                    SXL2    3,,PR0

      571     4965    2       INV_PG.CI_NO=IB;

   4965  4 001733   000000 235000 xsym               LDA     IB
         4 001734   000004 755100                    STA     4,,PR0

      572     4966    2       INV_PG.LN_AV.FT_AV = 0;

   4966  4 001735   000005 742100                    STX2    5,,PR0

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:94   
      573     4967    2       INV_PG.LN_AV.HI_LN = 0;

   4967  4 001736   000005 442100                    SXL2    5,,PR0

      574     4968    2   END INVPG_SETUP;

   4968  4 001737   200004 221300                    LDX1  ! TSTMP+1,,AUTO
         4 001740   000001 702211                    TSX2  ! 1,X1

      575     4969         /********************************************************************/
      576     4970    1   GET_CHKSUM: PROC;

   4970  4 001741   200006 741300       GET_CHKSUM   STX1  ! @ORG,,AUTO

      577     4971    2       ICHKSUM = 0; /* Checksum word*/

   4971  4 001742   000000 450000 xsym               STZ     ICHKSUM

      578     4972    2       CALL CHKSUM;

   4972  4 001743   000000 631400 5                  EPPR1   0
         4 001744   000000 701000 xent               TSX1    CHKSUM
         4 001745   000000 011000                    NOP     0

      579     4973    2       DATA_PG.CHKSUM_WD = ICHKSUM;

   4973  4 001746   000000 470400 xsym               LDP0    DATA$
         4 001747   000000 235000 xsym               LDA     ICHKSUM
         4 001750   000002 755100                    STA     2,,PR0

      580     4974    2   END GET_CHKSUM;

   4974  4 001751   200006 221300                    LDX1  ! @ORG,,AUTO
         4 001752   000001 702211                    TSX2  ! 1,X1

      581     4975    1   END_ZIU$Q2IN:
      582     4976    1   /**/ DCBSF = ZI$DIR.AREA_NM.DCB#;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:95   

   4976  4 001753   000244 220000 xsym  END_ZIU$Q2IN LDX0    ZI$DIR+164
         4 001754   000000 740000 xsym               STX0    DCBSF

      583     4977    1       CALL SYS_FUNC_CLOS;

   4977  4 001755   000000 631400 5                  EPPR1   0
         4 001756   000000 701000 xent               TSX1    SYS_FUNC_CLOS
         4 001757   000000 011000                    NOP     0

      584     4978    1       IF CPLTE_INT=1 AND UWA.AC_REC.SEC_KEY=1 THEN

   4978  4 001760   000013 235000 0                  LDA     CPLTE_INT
         4 001761   000001 115007                    CMPA    1,DL
         4 001762   002014 601000 4                  TNZ     s:4988
         4 001763   000235 236000 xsym               LDQ     UWA+157
         4 001764   000001 116007                    CMPQ    1,DL
         4 001765   002014 601000 4                  TNZ     s:4988

      585     4979         /*If area has secondary keys then create a keyed file associated with it*/
      586     4980         /*Nothing is stored in the area (just created)*/
      587     4981    2       DO;

      588     4982    2           CALL INSERT(FILE#.NAME,FILE#.CNT,1,':');

   4982  4 001766   000021 236000 0                  LDQ     FILE#
         4 001767   000033 772000                    QRL     27
         4 001770   040006 100400                    MLR     fill='040'O
         4 001771   000055 000001 5                  ADSC9   45                       cn=0,n=1
         4 001772   000021 200001 0                  ADSC9   FILE#,Q                  cn=1,n=1

      589     4983    2           ZI$DIR.AREA_NM.NAME.TEXT=FILE#.NAME;

   4983  4 001773   040000 100400                    MLR     fill='040'O
         4 001774   000021 200036 0                  ADSC9   FILE#                    cn=1,n=30
         4 001775   000234 200036 xsym               ADSC9   ZI$DIR+156               cn=1,n=30

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:96   
      590     4984    2    /**/   XTENSIZESF = (TOT_PGS+9)/10;

   4984  4 001776   000000 236000 0                  LDQ     TOT_PGS
         4 001777   000011 036007                    ADLQ    9,DL
         4 002000   000001 772000                    QRL     1
         4 002001   000005 506007                    DIV     5,DL
         4 002002   000000 756000 xsym               STQ     XTENSIZESF

      591     4985    2           CALL OPEN(%CREATE#,%KEYED#) ALTRET(ALTEND_ZIU$Q2IN);

   4985  4 002003   000026 236000 5                  LDQ     22
         4 002004   200006 756100                    STQ     @FLAG+1,,AUTO
         4 002005   000035 236000 5                  LDQ     29
         4 002006   200005 756100                    STQ     TSTMP+2,,AUTO
         4 002007   000047 701000 4                  TSX1    OPEN
         4 002010   002073 702000 4                  TSX2    ALTEND_ZIU$Q2IN

      592     4986    2           CALL SYS_FUNC_CLOS;

   4986  4 002011   000000 631400 5                  EPPR1   0
         4 002012   000000 701000 xent               TSX1    SYS_FUNC_CLOS
         4 002013   000000 011000                    NOP     0

      593     4987    2           END;

      594     4988    1       IF CPLTE_INT=0 THEN /* PARTIAL INIT,DONT PRINT SUMMARY */

   4988  4 002014   000013 235000 0                  LDA     CPLTE_INT
         4 002015   002065 601000 4                  TNZ     s:5000

      595     4989    2       DO;

      596     4990    2           CALL BINCHAR(CHAR10,PAGES_INIT);

   4990  4 002016   000000 301400                    BTD
         4 002017   000006 000004 0                  NDSC9   PAGES_INIT               cn=0,s=lsgnf,sf=0,n=4
         4 002020   000010 030012 0                  NDSC9   CHAR10                   cn=0,s=nosgn,sf=0,n=10
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:97   

      597     4991    2           CALL ZERO_SUP(CHAR10,10,'1'B);

   4991  4 002021   000061 630400 5                  EPPR0   49
         4 002022   000056 631400 5                  EPPR1   46
         4 002023   000000 701000 xent               TSX1    ZERO_SUP
         4 002024   000000 011000                    NOP     0

      598     4992    2           CALL INDEX1(X,' ',CHAR10);

   4992  4 002025   000000 124400                    SCM     mask='000'O
         4 002026   000010 000012 0                  ADSC9   CHAR10                   cn=0,n=10
         4 002027   000052 000001 5                  ADSC9   42                       cn=0,n=1
         4 002030   000000 000000 xsym               ARG     X

      599     4993    2           CALL CONCAT(FILE#.NAME,'BPartial INIT: ',C_V,' pages');

   4993  4 002031   040000 100400                    MLR     fill='040'O
         4 002032   000001 000017 3                  ADSC9   1                        cn=0,n=15
         4 002033   000021 200017 0                  ADSC9   FILE#                    cn=1,n=15
         4 002034   000007 470400 0                  LDP0    P$
         4 002035   000000 720000 xsym               LXL0    X
         4 002036   040000 100540                    MLR     fill='040'O
         4 002037   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         4 002040   000025 000020 0                  ADSC9   FILE#+4                  cn=0,n=16
         4 002041   000000 236000 xsym               LDQ     X
         4 002042   000020 116007                    CMPQ    16,DL
         4 002043   002051 605000 4                  TPL     s:4994
         4 002044   777757 621006                    EAX1    -17,QL
         4 002045   777777 661003                    ERX1    -1,DU
         4 002046   040046 100400                    MLR     fill='040'O
         4 002047   000005 000006 3                  ADSC9   5                        cn=0,n=6
         4 002050   000025 000011 0                  ADSC9   FILE#+4,Q                cn=0,n=*X1

      600     4994    2           DCBSF=DCBNUM(M$LO);

   4994  4 002051   000000 236007 xsym               LDQ     M$LO,DL
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:98   
         4 002052   000000 621006                    EAX1    0,QL
         4 002053   000000 741000 xsym               STX1    DCBSF

      601     4995    2           BUFLNSF=30;

   4995  4 002054   000036 235007                    LDA     30,DL
         4 002055   000000 755000 xsym               STA     BUFLNSF

      602     4996    2           BUFSF=VECTOR(FILE#.NAME);

   4996  4 002056   000064 237000 5                  LDAQ    52
         4 002057   000000 755000 xsym               STA     BUFSF
         4 002060   000001 756000 xsym               STQ     BUFSF+1

      603     4997    2           CALL SYS_FUNC_WRIT;

   4997  4 002061   000000 631400 5                  EPPR1   0
         4 002062   000000 701000 xent               TSX1    SYS_FUNC_WRIT
         4 002063   000000 011000                    NOP     0

      604     4998    2           END;

   4998  4 002064   002070 710000 4                  TRA     s:5001

      605     4999    1       ELSE
      606     5000    1           CALL EXECUTION_OUTPUT;

   5000  4 002065   000000 631400 5                  EPPR1   0
         4 002066   000000 701000 xent               TSX1    EXECUTION_OUTPUT
         4 002067   000000 011000                    NOP     0

      607     5001    1       ICNT = -1; /*Intialize icnt for init all*/

   5001  4 002070   000001 335007                    LCA     1,DL
         4 002071   000000 755000 xsym               STA     ICNT

      608     5002    1       RETURN;
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:99   

   5002  4 002072   000000 702200 xent               TSX2  ! X66_ARET

      609     5003    1   ALTEND_ZIU$Q2IN:
      610     5004    1   /**/ DCBSF =ZI$DIR.AREA_NM.DCB#;

   5004  4 002073   000244 220000 xsym  ALTEND_ZIU$* LDX0    ZI$DIR+164
         4 002074   000000 740000 xsym               STX0    DCBSF

      611     5005    1       CALL SYS_FUNC_CLOS;

   5005  4 002075   000000 631400 5                  EPPR1   0
         4 002076   000000 701000 xent               TSX1    SYS_FUNC_CLOS
         4 002077   000000 011000                    NOP     0

      612     5006    1       ALTRETURN;

   5006  4 002100   000000 702200 xent               TSX2  ! X66_AALT

      613     5007    1   INIT_INDEX:
      614     5008    1       IF (UWA.AC_REC.PG_TYPE=2 OR UWA.AC_REC.PG_TYPE=3) AND

   5008  4 002101   000002 116007       INIT_INDEX   CMPQ    2,DL
         4 002102   002105 600000 4                  TZE     INIT_INDEX+4
         4 002103   000003 116007                    CMPQ    3,DL
         4 002104   002315 601000 4                  TNZ     s:5065
         4 002105   000001 115007                    CMPA    1,DL
         4 002106   002315 600000 4                  TZE     s:5065

      615     5009    1          UWA.AC_REC.PERMTYPE~=1 THEN
      616     5010    2       DO; /* INDEX AREA OR INDEX AREA WITH ALTERNATE KEYS */

      617     5011    2           CALL DB_FUNC_FRS(CAN_RVA.RAREC.SEC,CAN_RVA.ACRA.SEC) ALTRET(DBALT);

   5011  4 002107   000067 630400 5                  EPPR0   55
         4 002110   000066 631400 5                  EPPR1   54
         4 002111   000000 701000 xent               TSX1    DB_FUNC_FRS
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:100  
         4 002112   002326 702000 4                  TSX2    DBALT

      618     5012    2           IF UWA.DB_STATUS='00000' THEN

   5012  4 002113   040000 106400                    CMPC    fill='040'O
         4 002114   000001 400005 xsym               ADSC9   UWA+1                    cn=2,n=5
         4 002115   000007 000005 3                  ADSC9   7                        cn=0,n=5
         4 002116   002315 601000 4                  TNZ     s:5065

      619     5013    3           DO;

      620     5014    3               CALL DB_FUNC_FOR(CAN_RVA.RCRA.SEC) ALTRET(DBALT); /* GET RC */

   5014  4 002117   000072 630400 5                  EPPR0   58
         4 002120   000071 631400 5                  EPPR1   57
         4 002121   000000 701000 xent               TSX1    DB_FUNC_FOR
         4 002122   002326 702000 4                  TSX2    DBALT

      621     5015    3               CALL DB_FUNC_FRS(CAN_RVA.SMREC.SEC,CAN_RVA.RCSOSM.SEC) ALTRET(DBALT);

   5015  4 002123   000073 630400 5                  EPPR0   59
         4 002124   000066 631400 5                  EPPR1   54
         4 002125   000000 701000 xent               TSX1    DB_FUNC_FRS
         4 002126   002326 702000 4                  TSX2    DBALT

      622     5016    3               TOT_DBK=0; /* TO KEEP TRACK THE HIGH NUMBER OF ALTKEY */

   5016  4 002127   000014 450000 0                  STZ     TOT_DBK

      623     5017    4               DO WHILE(UWA.DB_STATUS='00000');

   5017  4 002130   040000 106400                    CMPC    fill='040'O
         4 002131   000001 400005 xsym               ADSC9   UWA+1                    cn=2,n=5
         4 002132   000007 000005 3                  ADSC9   7                        cn=0,n=5
         4 002133   002271 601000 4                  TNZ     s:5051

      624     5018    4                   CALL DB_FUNC_GET(CAN_RVA.SMREC.SEC) ALTRET(DBALT);
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:101  

   5018  4 002134   000073 630400 5                  EPPR0   59
         4 002135   000071 631400 5                  EPPR1   57
         4 002136   000000 701000 xent               TSX1    DB_FUNC_GET
         4 002137   002326 702000 4                  TSX2    DBALT

      625     5019    4                   CALL DB_FUNC_FOR(CAN_RVA.SCSOSM.SEC) ALTRET(DBALT);

   5019  4 002140   000075 630400 5                  EPPR0   61
         4 002141   000071 631400 5                  EPPR1   57
         4 002142   000000 701000 xent               TSX1    DB_FUNC_FOR
         4 002143   002326 702000 4                  TSX2    DBALT

      626     5020    4                   CALL DB_FUNC_GET(CAN_RVA.SCREC.SEC) ALTRET(DBALT);

   5020  4 002144   000076 630400 5                  EPPR0   62
         4 002145   000071 631400 5                  EPPR1   57
         4 002146   000000 701000 xent               TSX1    DB_FUNC_GET
         4 002147   002326 702000 4                  TSX2    DBALT

      627     5021    4                   CALL DB_FUNC_FOR(CAN_RVA.SNSE.SEC) ALTRET(DBALT);

   5021  4 002150   000077 630400 5                  EPPR0   63
         4 002151   000071 631400 5                  EPPR1   57
         4 002152   000000 701000 xent               TSX1    DB_FUNC_FOR
         4 002153   002326 702000 4                  TSX2    DBALT

      628     5022    4                   CALL DB_FUNC_GET(CAN_RVA.SNREC.SEC) ALTRET(DBALT);

   5022  4 002154   000100 630400 5                  EPPR0   64
         4 002155   000071 631400 5                  EPPR1   57
         4 002156   000000 701000 xent               TSX1    DB_FUNC_GET
         4 002157   002326 702000 4                  TSX2    DBALT

      629     5023    4                  CALL DB_FUNC_FRS(CAN_RVA.CFREC.SEC,CAN_RVA.SMSSCF.SEC) ALTRET(DBALT)
              5023                            ;

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:102  
   5023  4 002160   000101 630400 5                  EPPR0   65
         4 002161   000066 631400 5                  EPPR1   54
         4 002162   000000 701000 xent               TSX1    DB_FUNC_FRS
         4 002163   002326 702000 4                  TSX2    DBALT

      630     5024    4                   CALL DB_FUNC_GET(CAN_RVA.CFREC.SEC) ALTRET(DBALT);

   5024  4 002164   000101 630400 5                  EPPR0   65
         4 002165   000071 631400 5                  EPPR1   57
         4 002166   000000 701000 xent               TSX1    DB_FUNC_GET
         4 002167   002326 702000 4                  TSX2    DBALT

      631     5025    4                   CALL DB_FUNC_FOR(CAN_RVA.FRCFS.SEC) ALTRET(DBALT);

   5025  4 002170   000103 630400 5                  EPPR0   67
         4 002171   000071 631400 5                  EPPR1   57
         4 002172   000000 701000 xent               TSX1    DB_FUNC_FOR
         4 002173   002326 702000 4                  TSX2    DBALT

      632     5026    4                   CALL DB_FUNC_GET(CAN_RVA.FRREC.SEC) ALTRET(DBALT);

   5026  4 002174   000104 630400 5                  EPPR0   68
         4 002175   000071 631400 5                  EPPR1   57
         4 002176   000000 701000 xent               TSX1    DB_FUNC_GET
         4 002177   002326 702000 4                  TSX2    DBALT

      633     5027    4                   X=UWA.SM_REC.PA_MEMPNT-2; /* GET ALTKEY # */

   5027  4 002200   000373 235000 xsym               LDA     UWA+251
         4 002201   000002 135007                    SBLA    2,DL
         4 002202   000000 755000 xsym               STA     X

      634     5028    4                   X1=UWA.SC_REC.KEY_LENGHT; /* GET KEY LEN IN BYTES */

   5028  4 002203   000324 236000 xsym               LDQ     UWA+212
         4 002204   000016 756000 0                  STQ     X1

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:103  
      635     5029    4                   X2=ADDR(UWA.FR_REC.BUFLOC)->EIS.BYT_OFF;

   5029  4 002205   000351 236000 xsym               LDQ     UWA+233
         4 002206   000020 772000                    QRL     16
         4 002207   377777 376007                    ANQ     131071,DL
         4 002210   000017 756000 0                  STQ     X2

      636     5030    4                   IF X=-1 THEN /* THIS IS THE PRIMARY KEY EIS */

   5030  4 002211   000013 115000 5                  CMPA    11
         4 002212   002222 601000 4                  TNZ     s:5037

      637     5031    5                   DO;

      638     5032    5                       KEYLSF=X1; /* SET OPEN PARAMETER */

   5032  4 002213   000016 235000 0                  LDA     X1
         4 002214   000000 755000 xsym               STA     KEYLSF

      639     5033    5                       KEYXSF=X2;

   5033  4 002215   000000 756000 xsym               STQ     KEYXSF

      640     5034    5                       RECORD_LIST.NAME(0)=UWA.SN_REC.SENAME;

   5034  4 002216   040000 100400                    MLR     fill='040'O
         4 002217   000427 000036 xsym               ADSC9   UWA+279                  cn=0,n=30
         4 002220   000000 000036 xsym               ADSC9   RECORD_LIST              cn=0,n=30

      641     5035    5                       END;

   5035  4 002221   002261 710000 4                  TRA     s:5049

      642     5036    4                   ELSE
      643     5037    4                       IF X>=0 AND X<20 THEN /* LOAD INFO INTO VLP_ATLKEYS */

   5037  4 002222   000000 115003                    CMPA    0,DU
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:104  
         4 002223   002261 604000 4                  TMI     s:5049
         4 002224   000024 115007                    CMPA    20,DL
         4 002225   002261 605000 4                  TPL     s:5049

      644     5038    5                       DO;

      645     5039    5                           IF UWA.SM_REC.SEQDUP=2 THEN

   5039  4 002226   000363 235000 xsym               LDA     UWA+243
         4 002227   000002 115007                    CMPA    2,DL
         4 002230   002235 601000 4                  TNZ     s:5042

      646     5040    5                               VLP_ALTKEYS.K.UNIQUE#(X)='1'B; /* DUP NOT */

   5040  4 002231   000000 720000 xsym               LXL0    X
         4 002232   400000 236003                    LDQ     -131072,DU
         4 002233   000001 256010 xsym               ORSQ    VLP_ALTKEYS+1,X0
         4 002234   002240 710000 4                  TRA     s:5043

      647     5041    5                           ELSE
      648     5042    5                               VLP_ALTKEYS.K.UNIQUE#(X)='0'B; /* DUP OK */

   5042  4 002235   000000 720000 xsym               LXL0    X
         4 002236   000105 236000 5                  LDQ     69
         4 002237   000001 356010 xsym               ANSQ    VLP_ALTKEYS+1,X0

      649     5043    5                           VLP_ALTKEYS.K.KEYL#(X)=X1;

   5043  4 002240   000016 236000 0                  LDQ     X1
         4 002241   000022 736000                    QLS     18
         4 002242   000001 676010 xsym               ERQ     VLP_ALTKEYS+1,X0
         4 002243   000777 376003                    ANQ     511,DU
         4 002244   000001 656010 xsym               ERSQ    VLP_ALTKEYS+1,X0

      650     5044    5                           VLP_ALTKEYS.K.KEYX#(X)=X2;

   5044  4 002245   000017 721000 0                  LXL1    X2
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:105  
         4 002246   000001 441010 xsym               SXL1    VLP_ALTKEYS+1,X0

      651     5045    5                           RECORD_LIST.NAME(X+1)=UWA.SN_REC.SENAME;

   5045  4 002247   000000 236000 xsym               LDQ     X
         4 002250   000005 736000                    QLS     5
         4 002251   040006 100400                    MLR     fill='040'O
         4 002252   000427 000036 xsym               ADSC9   UWA+279                  cn=0,n=30
         4 002253   000010 000036 xsym               ADSC9   RECORD_LIST+8,Q          cn=0,n=30

      652     5046    5                           IF X>=TOT_DBK THEN

   5046  4 002254   000000 236000 xsym               LDQ     X
         4 002255   000014 116000 0                  CMPQ    TOT_DBK
         4 002256   002261 604000 4                  TMI     s:5049

      653     5047    5                               TOT_DBK=X+1;

   5047  4 002257   000001 036007                    ADLQ    1,DL
         4 002260   000014 756000 0                  STQ     TOT_DBK

      654     5048    5                           END;

      655     5049    4                  CALL DB_FUNC_FRS(CAN_RVA.SMREC.SEC,CAN_RVA.RCSOSM.SEC) ALTRET(DBALT)
              5049                            ;

   5049  4 002261   000073 630400 5                  EPPR0   59
         4 002262   000066 631400 5                  EPPR1   54
         4 002263   000000 701000 xent               TSX1    DB_FUNC_FRS
         4 002264   002326 702000 4                  TSX2    DBALT

      656     5050    4                   END;

   5050  4 002265   040000 106400                    CMPC    fill='040'O
         4 002266   000001 400005 xsym               ADSC9   UWA+1                    cn=2,n=5
         4 002267   000007 000005 3                  ADSC9   7                        cn=0,n=5
         4 002270   002134 600000 4                  TZE     s:5018
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:106  

      657     5051    3    /**/       XTENSIZESF = 5; /* SET TO 5 FOR A WHILE */

   5051  4 002271   000005 235007                    LDA     5,DL
         4 002272   000000 755000 xsym               STA     XTENSIZESF

      658     5052    3    /**/       VLP_ALTKEYS.SIZ#=TOT_DBK; /* NUMBER OF ALTKEYS */

   5052  4 002273   000014 236000 0                  LDQ     TOT_DBK
         4 002274   000000 756000 xsym               STQ     VLP_ALTKEYS

      659     5053    3               CALL OPEN(%CREATE#,%INDEXED#) ALTRET(ALTEND_ZIU$Q2IN);

   5053  4 002275   000107 236000 5                  LDQ     71
         4 002276   200006 756100                    STQ     @FLAG+1,,AUTO
         4 002277   000035 236000 5                  LDQ     29
         4 002300   200005 756100                    STQ     TSTMP+2,,AUTO
         4 002301   000047 701000 4                  TSX1    OPEN
         4 002302   002073 702000 4                  TSX2    ALTEND_ZIU$Q2IN

      660     5054    3               CALL SYS_FUNC_CLOS;

   5054  4 002303   000000 631400 5                  EPPR1   0
         4 002304   000000 701000 xent               TSX1    SYS_FUNC_CLOS
         4 002305   000000 011000                    NOP     0

      661     5055    3               CALL EXCTN_REPRT_SETUP;

   5055  4 002306   000000 631400 5                  EPPR1   0
         4 002307   000000 701000 xent               TSX1    EXCTN_REPRT_SETUP
         4 002310   000000 011000                    NOP     0

      662     5056    3               CALL EXECUTION_OUTPUT; /* WRITES INIT SUMMARY */

   5056  4 002311   000000 631400 5                  EPPR1   0
         4 002312   000000 701000 xent               TSX1    EXECUTION_OUTPUT
         4 002313   000000 011000                    NOP     0
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:107  

      663     5057    3               RETURN;

   5057  4 002314   000000 702200 xent               TSX2  ! X66_ARET

      664     5058    3               END;
      665     5059    2           END;
      666     5060        /***************************************************************************/
      667     5061        /*E* ERROR: ZIU-DBU#BADAREA-C
      668     5062        MESSAGE: Page type in schema for %U1 is not IDS or INDEXED, cannot initialize it.
      669     5063        */
      670     5064        /***************************************************************************/
      671     5065    1       CALL ERR_MSG(DBU#BADAREA,3);

   5065  4 002315   000035 236000 5                  LDQ     29
         4 002316   200006 756100                    STQ     @FLAG+1,,AUTO
         4 002317   000111 236000 5                  LDQ     73
         4 002320   200005 756100                    STQ     TSTMP+2,,AUTO
         4 002321   000003 701000 4                  TSX1    ERR_MSG
         4 002322   000000 011000                    NOP     0

      672     5066    1       ICNT=-1; /*Initialize icnt for init all*/

   5066  4 002323   000001 335007                    LCA     1,DL
         4 002324   000000 755000 xsym               STA     ICNT

      673     5067    1       ALTRETURN;

   5067  4 002325   000000 702200 xent               TSX2  ! X66_AALT

      674     5068    1   DBALT: ERR_INSERT.TEXT(0)=UWA.DB_STATUS;

   5068  4 002326   040000 100400       DBALT        MLR     fill='040'O
         4 002327   000001 400005 xsym               ADSC9   UWA+1                    cn=2,n=5
         4 002330   000000 200036 xsym               ADSC9   ERR_INSERT               cn=1,n=30

      675     5069    1       ERR_INSERT.CNT(0)=5; /* 5 CHARACTERS OF DB_STATUS */
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:108  

   5069  4 002331   005000 236003                    LDQ     2560,DU
         4 002332   000000 552040 xsym               STBQ    ERR_INSERT,'40'O

      676     5070    1       CALL ERR_MSG(3002,3); /* PASS DB_STATUS AS AREA NAME */

   5070  4 002333   000035 236000 5                  LDQ     29
         4 002334   200006 756100                    STQ     @FLAG+1,,AUTO
         4 002335   000113 236000 5                  LDQ     75
         4 002336   200005 756100                    STQ     TSTMP+2,,AUTO
         4 002337   000003 701000 4                  TSX1    ERR_MSG
         4 002340   000000 011000                    NOP     0

      677     5071    1       ALTRETURN;

   5071  4 002341   000000 702200 xent               TSX2  ! X66_AALT

P$
 Sect OctLoc
   0     007   000010 006000                                                    ....

FILE#
 Sect OctLoc
   0     021   ****** ******   ****** ******   ****** ******   ****** ******    ................

(unnamed)
 Sect OctLoc
   3     000   111104 123062   102120 141162   164151 141154   040111 116111    IDS2BPartial INI
   3     004   124072 040040   040160 141147   145163 040040   060060 060060    T:   pages  0000
   3     010   060040 040040                                                    0

(unnamed)
 Sect OctLoc
   5     000   000000 000000   001777 777640   000000 022010   000000 006000    ................
   5     004   000002 006000   000000 021456   000005 006000   000000 021473    ................
   5     010   000007 006000   000000 021462   000011 006000   777777 777777    ................
   5     014   000000 021451   000000 000001   000015 006000   000014 006000    ................
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:109  
   5     020   000000 021452   000020 006000   000000 021453   000022 006000    ................
   5     024   000000 021454   000000 000002   000025 006000   000024 006000    ................
   5     030   000000 021455   000030 006000   000000 000003   000000 000007    ................
   5     034   000033 006000   000032 006000   000000 006003   000000 021465    ................
   5     040   000037 006000   000000 000000   000000 177640   000000 006014    ................
   5     044   000000 001753   000044 006000   000000 021461   000046 006000    .....$.......&..
   5     050   777000 000000   000001 604000   040040 040040   000000 400000    ........    ....
   5     054   000000 007640   072040 040040   000003 000000   000000 000012    ....:   ........
   5     060   400000 000000   000010 006000   000057 006000   000060 006000    ........./...0..
   5     064   000007 577640   000021 206000   000002 000000   000066 406000    .............6..
   5     070   000001 406000   000001 000000   000030 406000   000071 406000    .............9..
   5     074   000031 406000   000034 406000   000065 406000   000047 406000    .........5...'..
   5     100   000075 406000   000073 406000   000041 406000   000014 406000    .=...;...!......
   5     104   000067 406000   377777 777777   000000 000006   000106 006000    .7...........F..
   5     110   000000 021457   000110 006000   000000 005672   000112 006000    .....H.......J..
      678     5072    1   END ZIU$Q2IN;

PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:110  
--  Include file information  --

   B$ROSEG.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
   ZI$PG_STRUCTS.:ZIC0TOU  is referenced.
   ZI_GLOBAL_DBUTIL.:ZIC0TOU  is referenced.
   ZI$DIR.:ZIC0TOU  is referenced.
   ZI_UWA_C.:ZIC0TOU  is referenced.
   ZI_ERRORS_SUBS.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   ZI_RVA_C.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIU$Q2IN.

   Procedure ZIU$Q2IN requires 1250 words for executable code.
   Procedure ZIU$Q2IN requires 10 words of local(AUTO) storage.

    No errors detected in file ZIU$Q2IN.:ZIC0TSI    .
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:111  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:112  
          MINI XREF LISTING

ACNT
      3896**DCL      4526<<ASSIGN
ACSSF
      3856**DCL      4524<<ASSIGN
ALTEND_ZIU$Q2IN
      5004**LABEL    4660--CALLALT  4663--CALLALT  4666--CALLALT  4674--GOTO     4707--CALLALT  4758--CALLALT
      4787--GOTO     4807--CALLALT  4835--CALLALT  4851--CALLALT  4860--CALLALT  4985--CALLALT  5053--CALLALT
ALTRTN IN PROCEDURE READ_WRITE
      4557**LABEL    4553--CALLALT  4555--CALLALT
ALT_RET IN PROCEDURE OPEN
      4532**LABEL    4530--CALLALT
ASNSF
      3859**DCL      4525<<ASSIGN
ATBLK$
      4033**DCL      4034--IMP-PTR  4704<<ASSIGN   4708>>ASSIGN   4709>>ASSIGN   4867>>ASSIGN   4868>>ASSIGN
      4870>>ASSIGN   4872>>ASSIGN   4874>>ASSIGN   4875>>ASSIGN   4876>>ASSIGN   4878>>ASSIGN   4879>>ASSIGN
      4881>>ASSIGN   4882>>ASSIGN   4883>>ASSIGN   4884>>ASSIGN   4886>>ASSIGN   4887>>ASSIGN   4888>>ASSIGN
      4889>>ASSIGN   4890>>ASSIGN   4892>>ASSIGN   4893>>ASSIGN   4894>>ASSIGN   4895>>ASSIGN
ATBLK_PG.AREA_NM
      4059**DCL      4060--REDEF    4884<<ASSIGN
ATBLK_PG.CALC_INFO.IDB
      4051**DCL      4890<<ASSIGN
ATBLK_PG.DATE_INIT
      4061**DCL      4895<<ASSIGN
ATBLK_PG.DB_INFO.AREA_NM_SZ
      4048**DCL      4886<<ASSIGN
ATBLK_PG.DB_INFO.DBK_SZ
      4044**DCL      4868<<ASSIGN
ATBLK_PG.DB_INFO.PG_MD
      4046**DCL      4887<<ASSIGN
ATBLK_PG.DB_INFO.PRCNT_INV
      4045**DCL      4870<<ASSIGN   4872<<ASSIGN   4874<<ASSIGN
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:113  
ATBLK_PG.FIR_INV_PGNO
      4056**DCL      4892<<ASSIGN
ATBLK_PG.HIGH_DBK
      4058**DCL      4709>>ASSIGN   4889<<ASSIGN
ATBLK_PG.IDS_HDR
      4039**DCL      4883<<ASSIGN
ATBLK_PG.LINE_INFO.LPP
      4054**DCL      4888<<ASSIGN
ATBLK_PG.LOW_DBK
      4057**DCL      4893<<ASSIGN
ATBLK_PG.MISC_INFO.CHKSM
      4064**DCL      4879<<ASSIGN
ATBLK_PG.MISC_INFO.IUSZ
      4066**DCL      4881<<ASSIGN
ATBLK_PG.MISC_INFO.KEY_FILE_BLT
      4063**DCL      4894<<ASSIGN
ATBLK_PG.NUM_DBPG
      4041**DCL      4708>>ASSIGN   4876<<ASSIGN
ATBLK_PG.PG_NUM
      4040**DCL      4875<<ASSIGN
ATBLK_PG.SCHNAM
      4067**DCL      4878<<ASSIGN
ATBLK_PG.STATUS
      4068**DCL      4076--REDEF
ATBLK_PG.SYS_WRDS.DATE
      4037**DCL      4867<<ASSIGN
ATBLK_PG.TOT_CALC_HDRS
      4055**DCL      4882<<ASSIGN
ATBLK_PG_SETUP
      4866**PROC     4757--CALL
B$JIT.CPFLAGS1.SLEAZE
      4231**DCL      4231--REDEF
B$JIT.ERR.MID
      4138**DCL      4138--REDEF
B$JIT.JRESPEAK
      4299**DCL      4300--REDEF
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:114  
B$JIT.ORIGINATOR_PORT.FROM_CR
      4408**DCL      4408--REDEF    4409--REDEF
B$JIT.PNR
      4312**DCL      4312--REDEF
B$JIT.TSLINE
      4406**DCL      4407--REDEF
B$JIT$
      3823**DCL      4132--IMP-PTR
BREAK_FLAG
      3831**DCL      4796>>IF
BUFLNSF
      3867**DCL      4545<<ASSIGN   4995<<ASSIGN
BUFSF
      3868**DCL      4544<<ASSIGN   4996<<ASSIGN
BUF_FULL
      4790**LABEL    4809--GOTO
CALC_HDR_SIZE
        16**DCL      4753<<ASSIGN   4933>>ASSIGN   4938>>ASSIGN   4939>>ASSIGN   4941>>ASSIGN
CALC_TEMP
        13**DCL      4727<<ASSIGN   4730<<ASSIGN   4733>>IF       4749<<ASSIGN   4751>>ASSIGN   4901<<ASSIGN
      4910<<ASSIGN   4912<<ASSIGN   4915<<ASSIGN   4916>>IF       4925>>ASSIGN   4933>>ASSIGN   4937>>DOINDEX
CALC_TEMP2
        29**DCL      4724<<ASSIGN   4732<<ASSIGN   4733>>IF       4749>>IF       4750>>ASSIGN
CALC_TOT
        32**DCL      4725<<ASSIGN   4735<<ASSIGN   4736>>IF       4738>>IF       4739<<ASSIGN   4739>>ASSIGN
      4740>>DOINDEX  4741>>IF       4743<<ASSIGN   4743>>ASSIGN   4882>>ASSIGN
CAN_RVA.ACRA.SEC
       732**DCL      5011<>CALL
CAN_RVA.CFREC.SEC
       906**DCL      5023<>CALL     5024<>CALL
CAN_RVA.FRCFS.SEC
       765**DCL      5025<>CALL
CAN_RVA.FRREC.SEC
       894**DCL      5026<>CALL
CAN_RVA.RAREC.SEC
       891**DCL      5011<>CALL
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:115  
CAN_RVA.RCRA.SEC
       801**DCL      5014<>CALL
CAN_RVA.RCSOSM.SEC
       804**DCL      5015<>CALL     5049<>CALL
CAN_RVA.SCREC.SEC
       888**DCL      5020<>CALL
CAN_RVA.SCSOSM.SEC
       813**DCL      5019<>CALL
CAN_RVA.SMREC.SEC
       900**DCL      5015<>CALL     5018<>CALL     5049<>CALL
CAN_RVA.SMSSCF.SEC
       828**DCL      5023<>CALL
CAN_RVA.SNREC.SEC
       912**DCL      5022<>CALL
CAN_RVA.SNSE.SEC
       846**DCL      5021<>CALL
CARRY_ATTRIBUTESF
      3903**DCL      4523<<ASSIGN
CHAR10
        26**DCL        24--DCLINIT  4990<<CALLBLT  4991<>CALL     4992>>CALLBLT
CHKSUM
      1057**DCL-ENT  4972--CALL
COUNTSF
      3918**DCL      3919--REDEF
CPLTE_INT
        27**DCL      4597<<ASSIGN   4621<<ASSIGN   4657>>IF       4676>>IF       4680<<ASSIGN   4705>>IF
      4754>>IF       4834>>IF       4837>>IF       4978>>IF       4988>>IF
C_V
        25**DCL      4993>>CALLBLT
DATA$
      4089**DCL      4090--IMP-PTR  4703<<ASSIGN   4704>>ASSIGN   4756>>ASSIGN   4802<<ASSIGN   4832<<ASSIGN
      4847<<ASSIGN   4903>>ASSIGN   4904>>ASSIGN   4905>>ASSIGN   4906>>ASSIGN   4918>>ASSIGN   4919>>ASSIGN
      4920>>ASSIGN   4921>>ASSIGN   4929>>ASSIGN   4932>>ASSIGN   4933>>ASSIGN   4934>>ASSIGN   4935>>ASSIGN
      4938>>ASSIGN   4939>>ASSIGN   4948>>ASSIGN   4951>>ASSIGN   4961>>ASSIGN   4973>>ASSIGN
DATA_PG
      4090**DCL      4756<<ASSIGN   4903<<ASSIGN   4961<<ASSIGN
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:116  
DATA_PG.ACT_DATA
      4102**DCL      4103--REDEF    4104--REDEF    4105--REDEF
DATA_PG.CHKSUM_WD
      4094**DCL      4973<<ASSIGN
DATA_PG.CON_INTRVAL
      4098**DCL      4906<<ASSIGN
DATA_PG.OFFSET
      4104**DCL      4921<<ASSIGN   4929<<ASSIGN   4932<<ASSIGN   4938<<ASSIGN   4948<<ASSIGN   4951<<ASSIGN
DATA_PG.OFF_LN.FIR
      4100**DCL      4919<<ASSIGN   4934<<ASSIGN
DATA_PG.OFF_LN.SEC
      4101**DCL      4920<<ASSIGN   4935<<ASSIGN
DATA_PG.PG_SZ.FIR
      4096**DCL      4905<<ASSIGN
DATA_PG.PG_SZ.SEC
      4097**DCL      4918<<ASSIGN   4933<<ASSIGN
DATA_PG.SYS_WRDS.DATE
      4093**DCL      4904<<ASSIGN
DATESF
      3871**DCL      4720<<ASSIGN
DBALT
      5068**LABEL    5011--CALLALT  5014--CALLALT  5015--CALLALT  5018--CALLALT  5019--CALLALT  5020--CALLALT
      5021--CALLALT  5022--CALLALT  5023--CALLALT  5024--CALLALT  5025--CALLALT  5026--CALLALT  5049--CALLALT
DB_FUNC_FOR
        39**DCL-ENT  5014--CALL     5019--CALL     5021--CALL     5025--CALL
DB_FUNC_FRS
        38**DCL-ENT  5011--CALL     5015--CALL     5023--CALL     5049--CALL
DB_FUNC_GET
        40**DCL-ENT  5018--CALL     5020--CALL     5022--CALL     5024--CALL     5026--CALL
DCBSF
      3847**DCL      4514<<ASSIGN   4543<<ASSIGN   4667--ASSIGN   4668--IF       4798<<ASSIGN   4976<<ASSIGN
      4994<<ASSIGN   5004<<ASSIGN
DESTSF
      3870**DCL      4722<<ASSIGN
DPG_SETUP
      4899**PROC     4803--CALL
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:117  
EIS.BYT_OFF
        43**DCL      5029>>ASSIGN
ENCRP_SEEDSF
      3876**DCL      3877--REDEF    4551<<ASSIGN
END_ZIU$Q2IN
      4976**LABEL    4818--GOTO     4864--GOTO
ERR# IN PROCEDURE ERR_MSG
      4483**DCL      4481--PROC     4486>>ASSIGN
ERRCODESF
      3878**DCL      3883--REDEF
ERRCODESF.ERR#
      3881**DCL      4486<<ASSIGN
ERRCODE_RDEF
      3883**DCL      4488>>ASSIGN
ERRFLGSF
      3907**DCL      4487<<ASSIGN
ERR_INSERT
      3891**DCL      4489<<ASSIGN
ERR_INSERT.CNT
      3892**DCL      5069<<ASSIGN
ERR_INSERT.TEXT
      3893**DCL      5068<<ASSIGN
ERR_MSG
      4481**PROC     4600--CALL     4607--CALL     4611--CALL     4616--CALL     4624--CALL     4628--CALL
      4630--CALL     4637--CALL     4641--CALL     4673--CALL     4774--CALL     4785--CALL     5065--CALL
      5070--CALL
EXCTN_REPRT_SETUP
      1056**DCL-ENT  4759--CALL     5055--CALL
EXECUTION_OUTPUT
      1055**DCL-ENT  5000--CALL     5056--CALL
EXISTSF
      3897**DCL      4529<<ASSIGN
F$DCB.ACTPOS
      1731**DCL      1731--REDEF
F$DCB.ARS#
      1705**DCL      1705--REDEF
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:118  
F$DCB.ATTR
      1724**DCL      1725--REDEF
F$DCB.BORROW
      1739**DCL      1739--REDEF    1739--REDEF    1739--REDEF
F$DCB.DCBNAME.L
      1753**DCL      1753--IMP-SIZ
F$DCB.EOMCHAR#
      1709**DCL      1709--REDEF
F$DCB.FLDID
      1734**DCL      1734--REDEF
F$DCB.FORM$
      1728**DCL      1728--REDEF
F$DCB.FSECT
      1744**DCL      1744--REDEF
F$DCB.FSN#
      1721**DCL      1721--REDEF    1721--REDEF    1722--REDEF
F$DCB.HEADER$
      1727**DCL      1727--REDEF
F$DCB.IXTNSIZE#
      1725**DCL      1725--REDEF
F$DCB.LASTSTA$
      1714**DCL      1714--REDEF
F$DCB.LVL
      1740**DCL      1740--REDEF
F$DCB.NAME#
      1715**DCL      4667>>ASSIGN
F$DCB.NAME#.C
      1715**DCL      1715--REDEF
F$DCB.NOEOF
      1737**DCL      1737--REDEF
F$DCB.NRECS#
      1726**DCL      1726--REDEF
F$DCB.NRECX
      1745**DCL      1745--REDEF
F$DCB.OHDR
      1737**DCL      1737--REDEF
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:119  
F$DCB.ORG#
      1720**DCL      1720--REDEF    4668>>IF
F$DCB.PRECNO
      1743**DCL      1743--REDEF
F$DCB.RCSZ
      1749**DCL      1749--REDEF
F$DCB.RES#
      1716**DCL      1716--REDEF
F$DCB.SETX
      1728**DCL      1728--REDEF
F$DCB.TAB$
      1728**DCL      1728--REDEF
F$DCB.TDA
      1742**DCL      1743--REDEF
F$DCB.WSN#
      1716**DCL      1716--REDEF
FIDSF
      3895**DCL      4527<<ASSIGN
FIDSF_RD
      3894**DCL      3895--REDEF
FILE#
        34**DCL      4667<<ASSIGN   4670>>ASSIGN
FILE#.CNT
        35**DCL      4982>>CALLBLT
FILE#.NAME
        36**DCL      4982<<CALLBLT  4983>>ASSIGN   4993<<CALLBLT  4996--ASSIGN
FLAG IN PROCEDURE READ_WRITE
      4541**DCL      4539--PROC     4552>>IF
FLAG# IN PROCEDURE ERR_MSG
      4484**DCL      4481--PROC     4487>>ASSIGN
FULLSF
      3865**DCL      4521<<ASSIGN   4547<<ASSIGN
FUN IN PROCEDURE OPEN
      4511**DCL      4509--PROC     4528>>ASSIGN
FUNSF
      3858**DCL      4528<<ASSIGN
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:120  
GET_CHKSUM
      4970**PROC     4844--CALL     4859--CALL     4896--CALL     4957--CALL
GET_FILESZ
      1059**DCL-ENT  4685--CALL
HDRS_PER_PAGE
        22**DCL      4751<<ASSIGN   4909>>IF       4914>>IF
HELPCODE
      3912**DCL      3917--REDEF
I
      3805**DCL      4677<<DOINDEX  4678>>IF       4678>>IF       4697<<ASSIGN   4765<<DOINDEX  4766>>ASSIGN
      4767>>ASSIGN   4770>>ASSIGN   4771>>ASSIGN   4773>>ASSIGN   4819<<DOINDEX  4820>>ASSIGN   4821>>ASSIGN
IB
      3795**DCL      4824<<ASSIGN   4827>>ASSIGN   4833>>ASSIGN   4848<<ASSIGN   4848>>ASSIGN   4965>>ASSIGN
ICHKSUM
      3832**DCL      3833--REDEF    4971<<ASSIGN   4973>>ASSIGN
ICNT
      3797**DCL      4601<<ASSIGN   4615>>IF       4617>>IF       4619<<ASSIGN   4677>>DOINDEX  4697>>ASSIGN
      4765>>DOINDEX  4786<<ASSIGN   4819>>DOINDEX  5001<<ASSIGN   5066<<ASSIGN
IE
      3794**DCL      4825<<ASSIGN   4827>>ASSIGN
INIT_INDEX
      5008**LABEL    4604--GOTO
INIT_RG.FIRNG
      3596**DCL      4620<<ASSIGN   4678>>IF       4766>>ASSIGN   4770<<ASSIGN   4820>>ASSIGN
INIT_RG.SECRNG
      3597**DCL      4498<<ASSIGN   4499>>ASSIGN   4648<<ASSIGN   4678>>IF       4767>>ASSIGN   4771<<ASSIGN
      4773>>ASSIGN   4821>>ASSIGN
INVPG$
      4108**DCL      4109--IMP-PTR  4831<<ASSIGN   4832>>ASSIGN   4840>>ASSIGN   4846<<ASSIGN   4847>>ASSIGN
      4962>>ASSIGN   4963>>ASSIGN   4964>>ASSIGN   4965>>ASSIGN   4966>>ASSIGN   4967>>ASSIGN
INVPG_SETUP
      4960**PROC     4838--CALL
INV_BUF_FULL
      4827**LABEL    4853--GOTO
INV_PG.CI_NO
      4117**DCL      4965<<ASSIGN
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:121  
INV_PG.INVENT_CT
      4121**DCL      4840<<ASSIGN
INV_PG.LN_AV.FT_AV
      4119**DCL      4966<<ASSIGN
INV_PG.LN_AV.HI_LN
      4120**DCL      4967<<ASSIGN
INV_PG.PG_SZ_INFO.PG_SZ
      4115**DCL      4963<<ASSIGN
INV_PG.PG_SZ_INFO.SP_AV
      4116**DCL      4964<<ASSIGN
INV_PG.SYS_WRDS.DATE
      4112**DCL      4962<<ASSIGN
I_O_BUF
      3811**DCL      4544--ASSIGN   4703--ASSIGN   4802--ASSIGN   4831--ASSIGN   4846--ASSIGN
I_O_BUF$
      3810**DCL      3811--IMP-PTR  4544>>ASSIGN   4703>>ASSIGN   4802>>ASSIGN   4831>>ASSIGN   4846>>ASSIGN
I_O_KEY
      3829**DCL      4546>>ASSIGN   4700<<ASSIGN   4794<<ASSIGN   4833<<ASSIGN
I_O_SIZE
      3813**DCL      4545>>ASSIGN   4701<<ASSIGN   4790<<ASSIGN   4791>>IF       4792<<ASSIGN   4805>>IF
      4827<<ASSIGN   4828>>IF       4829<<ASSIGN   4849>>IF       4857>>IF
J
      3806**DCL      4885<<CALLBLT  4886>>ASSIGN   4937<<DOINDEX  4938>>ASSIGN   4938>>ASSIGN   4939>>ASSIGN
      4946<<DOINDEX  4947>>IF       4948>>ASSIGN   4948>>ASSIGN   4951>>ASSIGN   4951>>ASSIGN   4952<<ASSIGN
      4952>>ASSIGN
K
      3807**DCL      4925<<ASSIGN   4926>>IF       4928<<ASSIGN   4932>>ASSIGN   4933>>ASSIGN   4935>>ASSIGN
      4946>>DOINDEX
KEYLSF
      3845**DCL      5032<<ASSIGN
KEYSF
      3849**DCL      4548<<ASSIGN
KEYVSF
      3850**DCL      3855--REDEF
KEYVSF.IDSKEY
      3853**DCL      4546<<ASSIGN
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:122  
KEYVSF.WD_ONE
      3852**DCL      3853--REDEF
KEYXSF
      3846**DCL      5033<<ASSIGN
M$LO
      3820**DCL      4994>>ASSIGN
MSGCODE
      3884**DCL      3885--REDEF    4488<<ASSIGN
NBUFS
      1060**DCL      4791>>IF       4792>>ASSIGN   4828>>IF       4829>>ASSIGN
NEXT_INV_RANGE
      4863**LABEL    4822--GOTO
NEXT_RANGE
      4813**LABEL    4776--GOTO
NOTIMESF
      3857**DCL      4549<<ASSIGN
OPEN
      4509**PROC     4660--CALL     4663--CALL     4666--CALL     4985--CALL     5053--CALL
ORG IN PROCEDURE OPEN
      4512**DCL      4509--PROC     4516>>ASSIGN
ORGSF
      3848**DCL      4516<<ASSIGN   4517>>IF
OUT_INDX
      3812**DCL      4702<<ASSIGN   4793<<ASSIGN   4802>>ASSIGN   4804<<ASSIGN   4804>>ASSIGN   4805>>IF
      4830<<ASSIGN   4845<<ASSIGN   4845>>ASSIGN   4846>>ASSIGN   4849>>IF
P$
        24**DCL        25--IMP-PTR  4993>>CALLBLT
PAGES_INIT
        23**DCL      4596<<ASSIGN   4902<<ASSIGN   4902>>ASSIGN   4990>>CALLBLT
PAGES_PER_HDR
        21**DCL      4750<<ASSIGN   4901>>IF       4909>>IF       4911>>IF       4911>>IF
PRIME
      4736**LABEL    4744--GOTO
PTR_LEN
        15**DCL        20--IMP-SIZ  4752<<ASSIGN   4753>>ASSIGN   4942>>ASSIGN   4942>>ASSIGN   4942>>ASSIGN
      4943>>ASSIGN   4943>>ASSIGN   4943>>ASSIGN   4943>>ASSIGN
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:123  
PTR_V
        20**DCL      4942<<ASSIGN   4942>>ASSIGN   4943<<ASSIGN   4943>>ASSIGN
RB
      3792**DCL      4766<<ASSIGN   4768>>IF       4771>>ASSIGN   4772<<ASSIGN   4776>>IF       4777>>IF
      4777<<ASSIGN   4790>>ASSIGN   4794>>ASSIGN   4795<<DOINDEX  4795>>DOINDEX  4808<<ASSIGN   4808>>ASSIGN
      4820<<ASSIGN   4822>>IF       4823>>IF       4823<<ASSIGN   4824>>ASSIGN   4836<<DOINDEX  4836>>DOINDEX
      4837>>IF       4839>>ASSIGN   4841>>IF       4852<<ASSIGN   4852>>ASSIGN   4906>>ASSIGN   4908>>ASSIGN
      4911>>IF       4914>>IF
RE
      3793**DCL      4767<<ASSIGN   4768>>IF       4770>>ASSIGN   4772>>ASSIGN   4773<<ASSIGN   4776>>IF
      4778>>IF       4790>>ASSIGN   4795>>DOINDEX  4821<<ASSIGN   4822>>IF       4825>>ASSIGN   4836>>DOINDEX
READ_WRITE
      4539**PROC     4707--CALL     4758--CALL     4807--CALL     4835--CALL     4851--CALL     4860--CALL
REASGNSF
      3902**DCL      4518<<ASSIGN   4520<<ASSIGN
REC$
      3791**DCL        17--IMP-PTR  3814--IMP-PTR  4939<<ASSIGN   4940>>ASSIGN   4941>>ASSIGN   4942>>ASSIGN
      4943>>ASSIGN
RECORD_LIST.NAME
      3581**DCL      5034<<ASSIGN   5045<<ASSIGN
REC_DATA_LN
      3819**DCL      3818--IMP-SIZ
REC_HDR.REC_SZ
        19**DCL      4941<<ASSIGN
REC_HDR.REC_TYP
        18**DCL      4940<<ASSIGN
RESTART
      3830**DCL      4800>>UNWIND
SHARESF
      3898**DCL      4522<<ASSIGN
SOURCESF
      3869**DCL      4721<<ASSIGN
SYS_FUNC_CLOS
      1046**DCL-ENT  4799--CALL     4977--CALL     4986--CALL     5005--CALL     5054--CALL
SYS_FUNC_ERRMSG
      1052**DCL-ENT  4490--CALL
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:124  
SYS_FUNC_OPEN
      1045**DCL-ENT  4530--CALL
SYS_FUNC_READ
      1048**DCL-ENT  4553--CALL
SYS_FUNC_RELEASE
      1047**DCL-ENT  4661--CALL
SYS_FUNC_TSTAMP
      1050**DCL-ENT  4723--CALL
SYS_FUNC_WRIT
      1049**DCL-ENT  4555--CALL     4997--CALL
TESTSF
      3860**DCL      4515<<ASSIGN
TOT_DBK
        28**DCL      4498>>ASSIGN   4614<<ASSIGN   4636<<ASSIGN   4643<<ASSIGN   4647>>ASSIGN   4688<<ASSIGN
      4695<<ASSIGN   4709<<ASSIGN   4711>>ASSIGN   4735>>ASSIGN   4889>>ASSIGN   4915>>ASSIGN   5016<<ASSIGN
      5046>>IF       5047<<ASSIGN   5052>>ASSIGN
TOT_PGS
        12**DCL      4499<<ASSIGN   4501<<ASSIGN   4501>>ASSIGN   4501>>ASSIGN   4647<<ASSIGN   4648>>ASSIGN
      4650<<ASSIGN   4650>>ASSIGN   4650>>ASSIGN   4662>>ASSIGN   4686<<ASSIGN   4688>>ASSIGN   4691>>ASSIGN
      4692>>DOWHILE  4695>>ASSIGN   4708<<ASSIGN   4712>>ASSIGN   4876>>ASSIGN   4984>>ASSIGN
TSTAMPSF
      3875**DCL      4719<<ASSIGN
TSTMP
        33**DCL      4719--ASSIGN   4867>>ASSIGN   4895>>ASSIGN   4904>>ASSIGN   4962>>ASSIGN
UWA.AC_REC.BASE_DBK
      3062**DCL      4709>>ASSIGN   4889>>ASSIGN   4936>>ASSIGN
UWA.AC_REC.CALC_NEXT
      3081**DCL      3082--REDEF
UWA.AC_REC.CALC_NULL
      3061**DCL      4726>>IF
UWA.AC_REC.CALC_PRIOR
      3090**DCL      3091--REDEF
UWA.AC_REC.DEFAULTS
      3039**DCL      3040--REDEF
UWA.AC_REC.FILE_CODE
      3044**DCL      3045--REDEF
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:125  
UWA.AC_REC.FIR_INV_PG
      3070**DCL      4500>>IF       4649>>IF       4687>>IF       4869>>IF       4891>>IF
UWA.AC_REC.FLAG1.ERROR_TYPE
      3041**DCL      3042--REDEF
UWA.AC_REC.IDB
      3072**DCL      4729>>IF       4730>>ASSIGN   4732>>ASSIGN   4735>>ASSIGN   4735>>ASSIGN   4890>>ASSIGN
      4915>>ASSIGN   4915>>ASSIGN   4925>>ASSIGN   4938>>ASSIGN   4944>>ASSIGN   4947>>IF
UWA.AC_REC.KEYS_RESER
      3064**DCL      4633>>IF       4636>>ASSIGN
UWA.AC_REC.KEY_ALLOC
      3063**DCL      4614>>ASSIGN   4633>>IF       4636>>ASSIGN   4640>>IF
UWA.AC_REC.LPP
      3071**DCL      4498>>ASSIGN   4498>>ASSIGN   4647>>ASSIGN   4647>>ASSIGN   4688>>ASSIGN   4695>>ASSIGN
      4711>>ASSIGN   4711>>ASSIGN   4729>>IF       4730>>ASSIGN   4732>>ASSIGN   4888>>ASSIGN   4908>>ASSIGN
UWA.AC_REC.MIN_DBK
      3065**DCL      4893>>ASSIGN
UWA.AC_REC.PERMTYPE
      3055**DCL      4598>>IF       5008>>IF
UWA.AC_REC.PER_INV
      3060**DCL      4871>>IF       4873>>IF       4874>>ASSIGN   4880>>IF       4881>>ASSIGN
UWA.AC_REC.PG_TYPE
      3056**DCL      3057--REDEF    4604>>IF       5008>>IF       5008>>IF
UWA.AC_REC.P_TYP.P_MD
      3059**DCL      4887>>ASSIGN
UWA.AC_REC.SEC_KEY
      3054**DCL      4894>>IF       4978>>IF
UWA.AC_REC.SWS.CHECKSUM
      3046**DCL      4843>>IF       4859>>IF       4879>>ASSIGN   4896>>IF       4956>>IF
UWA.AC_REC.SWS.ENCRYP
      3047**DCL      4606>>IF       4608>>IF
UWA.AC_REC.SWS.TEMPLAT
      3049**DCL      4622>>IF       4626>>IF
UWA.AD_REC.ADDATE
      3021**DCL      3022--REDEF
UWA.DB_STATUS
      2969**DCL      5012>>IF       5017>>DOWHILE  5068>>ASSIGN
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:126  
UWA.FR_REC.BUFLOC
      3151**DCL      5029--ASSIGN
UWA.OA_REC.GLBL
      3035**DCL      4752>>ASSIGN   4868>>ASSIGN
UWA.SC_REC.KEY_LENGHT
      3129**DCL      5028>>ASSIGN
UWA.SM_REC.PA_MEMPNT
      3169**DCL      5027>>ASSIGN
UWA.SM_REC.SEQDUP
      3161**DCL      5039>>IF
UWA.SN_REC.SENAME
      3200**DCL      5034>>ASSIGN   5045>>ASSIGN
VFCSF
      3864**DCL      4550<<ASSIGN
VLP_ALTKEYS.K.KEYL#
      1695**DCL      5043<<ASSIGN
VLP_ALTKEYS.K.KEYX#
      1695**DCL      5044<<ASSIGN
VLP_ALTKEYS.K.UNIQUE#
      1694**DCL      5040<<ASSIGN   5042<<ASSIGN
VLP_ALTKEYS.SIZ#
      1694**DCL      5052<<ASSIGN
X
      3808**DCL        25--IMP-SIZ  4691<<ASSIGN   4692>>DOWHILE  4692>>DOWHILE  4693<<ASSIGN   4693>>ASSIGN
      4695>>ASSIGN   4740<<DOINDEX  4741>>IF       4839<<ASSIGN   4840>>ASSIGN   4908<<ASSIGN   4915>>ASSIGN
      4936<<ASSIGN   4936>>ASSIGN   4942--ASSIGN   4943--ASSIGN   4944<<ASSIGN   4944>>ASSIGN   4992<<CALLBLT
      4993>>CALLBLT  5027<<ASSIGN   5030>>IF       5037>>IF       5037>>IF       5040>>ASSIGN   5042>>ASSIGN
      5043>>ASSIGN   5044>>ASSIGN   5045>>ASSIGN   5046>>IF       5047>>ASSIGN
X1
        30**DCL      4711<<ASSIGN   4712>>ASSIGN   4778>>IF       4824>>ASSIGN   4825>>ASSIGN   4892>>ASSIGN
      4914>>IF       5028<<ASSIGN   5032>>ASSIGN   5043>>ASSIGN
X2
        31**DCL      4712<<ASSIGN   4818>>IF       5029<<ASSIGN   5033>>ASSIGN   5044>>ASSIGN
XTENSIZESF
      3861**DCL      4659<<ASSIGN   4662<<ASSIGN   4686>>ASSIGN   4984<<ASSIGN   5051<<ASSIGN
ZERO_SUP
PL6.E3A0      #001=ZIU$Q2IN File=ZIU$Q2IN.:ZIC0TSI                               FRI 09/05/97 13:21 Page:127  
      1058**DCL-ENT  4991--CALL
ZI$DIR.ACNT
      3486**DCL      4526>>ASSIGN
ZI$DIR.ALTKEY
      3534**DCL      3535--REDEF    3536--REDEF
ZI$DIR.AREAFID
      3500**DCL      3501--REDEF
ZI$DIR.AREA_NM
      3563**DCL      4489>>ASSIGN
ZI$DIR.AREA_NM.DCB#
      3567**DCL      4514>>ASSIGN   4543>>ASSIGN   4798>>ASSIGN   4976>>ASSIGN   5004>>ASSIGN
ZI$DIR.AREA_NM.NAME
      3564**DCL      4670<<ASSIGN
ZI$DIR.AREA_NM.NAME.TEXT
      3566**DCL      4527>>ASSIGN   4884>>ASSIGN   4885>>CALLBLT  4983<<ASSIGN
ZI$DIR.DATE
      3539**DCL      3543--REDEF
ZI$DIR.DEST_SEED
      3495**DCL      3496--REDEF    3497--REDEF
ZI$DIR.ENCP_SEED
      3492**DCL      3493--REDEF    3494--REDEF    4551>>ASSIGN
ZI$DIR.ENCP_SEED_RD
      3493**DCL      4610<<ASSIGN
ZI$DIR.ENCRPT
      3478**DCL      4606>>IF       4608>>IF
ZI$DIR.INIT_TMPLT_KEY
      3556**DCL      4615>>IF       4622>>IF       4629>>IF       4633>>IF       4640>>IF       4643>>ASSIGN
ZI$DIR.REPRT_ZERO
      3526**DCL      3527--REDEF
ZI$DIR.SCHEMA_NM.NAME.TEXT
      3561**DCL      4878>>ASSIGN
ZI$DIR.SCHFID
      3498**DCL      3499--REDEF
ZI$DIR.TIME
      3544**DCL      3549--REDEF
