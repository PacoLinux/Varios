
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:1    
        1        1        /*M*    ZIO$GETBUF - Get a buffer for I/O. */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*P*
        8        8        NAME:   ZIO$GETBUF
        9        9        PURPOSE:To get a buffer for I/O and unsure an unmodified buffer exists.
       10       10        */
       11       11        /*D*
       12       12        NAME:   ZIO$GETBUF
       13       13        CALL:   CALL ZIO$GETBUF
       14       14        ENTRY:  CALL ZIO$GETSLOT
       15       15        ENTRY:  CALL ZIO$CHKBUSY
       16       16        INPUT:  GLOBAL.PARAN.IO.PGNO - The page number to read
       17       17                GLOBAL.PARAN.IO.AWS$ - The AREA to read
       18       18        OUTPUT: GLOBAL.BCB.SLOT - The slot that contins the buffer
       19       19                GLOBAL.PARAN.IO.BUF$ - The pointer to the buffer.
       20       20        DESCRIPTION;
       21       21            The buffer pool is searched to see if the buffer is in memory
       22       22            already.  If it is found it is returned.  If not, the
       23       23            least recently used slot that is not locked is cleared (by
       24       24            writting it out if it has been modified) and used.
       25       25
       26       26            After a buffer is selected, it is checked to make sure it is
       27       27            not busy.  In addition an attempt is made to have a slot
       28       28            available for another read by making sure at least one
       29       29            unupdated buffer exists.  This will allow us to read into
       30       30            it without first performing a write, when the next buffer
       31       31            request is recieved.
       32       32
       33       33            The entry point ZIO$GETSLOT is used when it is known that
       34       34            the buffer is not in memory.  Thus there is no need to
       35       35            search the buffer pool.  This entry point is used when
       36       36            concurrent access control is active since it keeps track
       37       37            of buffers that ENQs are tied to.
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:2    
       38       38
       39       39            The entry point ZIO$CHKBUSY is used when it is known that
       40       40            the buffer is in memory and which buffer it is.  At this
       41       41            point we need only inusre that the buffer is not busy.
       42       42            This entry point is also used when concurrent access
       43       43            control is active since it keeps track of buffers that
       44       44            ENQs are tied to.
       45       45        */
       46       46        %EJECT;
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:3    
       47       47        ZIO$GETBUF: PROC ALTRET
       48       48         /* USE($PR5 FOR GLOBAL$) */
       49       49               AVOID($PR5,$PR6,$PR7);
       50       50        %INCLUDE ZI$GLOBAL;
       51      536            %GLOBALS;
       52      844            %BUFFERS;
       53      859            %ENQLIST;
       54      877        %INCLUDE ZI$DBCB;
       55     1519            %AWS;
       56     1559        %INCLUDE CP_6;
       57     1640            %FPT_WAIT(STCLASS=SYMREF);
       58     1654        %INCLUDE CP_6_SUBS;
       59     2194        %INCLUDE ZI_ERRORS_C;
       60     2520    1   DCL ERROR UBIN(36);
       61     2521    1   DCL SLOT UBIN(36);
       62     2522    1   DCL PRESLOT UBIN(36);
       63     2523    1   DCL ZIM$DEQ_ONE ENTRY ALTRET;
       64     2524    1   DCL ZIO$DWRITE ENTRY(1) ALTRET;
       65     2525    1       ERROR=1; /* ASSUME PAGE IS IN BUFFER POOL */
       66     2526    1       SLOT=GLOBAL.BCB.HEAD; /* SEARCH FROM MOST RECENT USED */
       67     2527    2       DO WHILE(SLOT~=0);
       68     2528    2           IF GLOBAL.BCB.BUF.PGNO(SLOT)=GLOBAL.PARAN.IO.PGNO AND
       69     2529    2              GLOBAL.BCB.BUF.AWS$(SLOT)=GLOBAL.PARAN.IO.AWS$ THEN
       70     2530    2               GOTO CHKBUSY;
       71     2531    2           SLOT=GLOBAL.BCB.BUF.BLINK(SLOT);
       72     2532    2           END;
       73     2533    1   ZIO$GETSLOT: ENTRY ALTRET; /* FIND A AVAIL SLOT, SWAP 1 OUT IF NEEDED */
       74     2534        /*      Set buffer not found flag. */
       75     2535    1       ERROR=0;
       76     2536    1       SLOT=GLOBAL.BCB.TAIL;
       77     2537    2       DO WHILE (SLOT~=0);
       78     2538    3           IF GLOBAL.BCB.BUF.LOCK(SLOT)=0 THEN DO;
       79     2539    4               IF GLOBAL.BCB.BUF.AWS$(SLOT)~=ADDR(NIL) THEN DO;
       80     2540        /*                  If this buffer has something valid in it. */
       81     2541    4                   IF GLOBAL.BCB.BUF.STATUS.BUSY(SLOT)=%NO# AND
       82     2542    4                      GLOBAL.BCB.BUF.STATUS.MODIFY(SLOT)=%YES# THEN
       83     2543    4                       CALL ZIO$DWRITE(SLOT) ALTRET(ER_WRITE);
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:4    
       84     2544    4                   ENQLIST$=GLOBAL.ENQ.LIST.BASE$;
       85     2545    5                   IF GLOBAL.BCB.BUF.AWS$(SLOT)->AWS.ATRIB.CURONLY THEN DO;
       86     2546        /*                      The page just written should be DEQed. */
       87     2547    5                       GLOBAL.ENQ.LIST.INDX=GLOBAL.BCB.BUF.ENQINDX(SLOT);
       88     2548    5                       IF GLOBAL.ENQ.LIST.INDX~=0 AND
       89     2549    5                          NOT ENQLIST.STATUS.KEEP(GLOBAL.ENQ.LIST.INDX) AND
       90     2550    5                          NOT ENQLIST.STATUS.CURRENT(GLOBAL.ENQ.LIST.INDX) AND
       91     2551    6                          NOT ENQLIST.STATUS.MODIFY(GLOBAL.ENQ.LIST.INDX) THEN DO;
       92     2552    6                           CALL ZIM$DEQ_ONE ALTRET(ALT);
       93     2553    6                           GOTO NEW;
       94     2554    6                           END;
       95     2555    5                       END;
       96     2556    5                   IF GLOBAL.BCB.BUF.AWS$(SLOT)->AWS.ATRIB.CAC THEN DO;
       97     2557        /*                      Delete old link from ENQ list. */
       98     2558    5                       ENQLIST.BUFSLOT(GLOBAL.BCB.BUF.ENQINDX(SLOT))=0;
       99     2559    5                       GLOBAL.BCB.BUF.ENQINDX(SLOT)=0;
      100     2560    5                       END;
      101     2561    4                   END;
      102     2562
      103     2563        /*              Assign new values for this buffer. */
      104     2564    3   NEW:        ;
      105     2565    3               GLOBAL.BCB.BUF.PGNO(SLOT)=GLOBAL.PARAN.IO.PGNO;
      106     2566    3               GLOBAL.BCB.BUF.AWS$(SLOT)=GLOBAL.PARAN.IO.AWS$;
      107     2567    3               GOTO CHKBUSY;
      108     2568    3               END;
      109     2569    2           SLOT=GLOBAL.BCB.BUF.LINK(SLOT);
      110     2570    2           END;
      111     2571
      112     2572    1       ERROR=ERR#IO#E18;
      113     2573    1       GOTO ALT;
      114     2574
      115     2575    1   ZIO$CHKBUSY: ENTRY ALTRET;
      116     2576    1       ERROR=0;
      117     2577    1       SLOT=GLOBAL.BCB.SLOT;
      118     2578    1   CHKBUSY: ;
      119     2579    1       GLOBAL.PARAN.IO.BUF$=GLOBAL.BCB.BUF.BUF$(SLOT);
      120     2580    1       IF SLOT~=GLOBAL.BCB.HEAD THEN
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:5    
      121     2581    2       DO;
      122     2582    2           IF SLOT=GLOBAL.BCB.TAIL THEN
      123     2583    3           DO;
      124     2584    3               GLOBAL.BCB.TAIL=GLOBAL.BCB.BUF.LINK(SLOT);
      125     2585    3               GLOBAL.BCB.BUF.BLINK(GLOBAL.BCB.TAIL)=0;
      126     2586    3               END;
      127     2587    2           ELSE
      128     2588    3           DO; /* MIDDLE SLOT, UPDATE LINK AND BLINK */
      129     2589    3               PRESLOT=GLOBAL.BCB.BUF.BLINK(SLOT);
      130     2590    3               GLOBAL.BCB.BUF.LINK(PRESLOT)=GLOBAL.BCB.BUF.LINK(SLOT);
      131     2591    3               GLOBAL.BCB.BUF.BLINK(GLOBAL.BCB.BUF.LINK(SLOT))=PRESLOT;
      132     2592    3               END;
      133     2593    2           GLOBAL.BCB.BUF.BLINK(SLOT)=GLOBAL.BCB.HEAD;
      134     2594    2           GLOBAL.BCB.BUF.LINK(GLOBAL.BCB.HEAD)=SLOT;
      135     2595    2           GLOBAL.BCB.HEAD=SLOT;
      136     2596    2           GLOBAL.BCB.BUF.LINK(GLOBAL.BCB.HEAD)=0;
      137     2597    2           END;
      138     2598        /*      Save SLOT for returning. */
      139     2599    1       GLOBAL.BCB.SLOT=SLOT;
      140     2600    1       SLOT=GLOBAL.BCB.TAIL;
      141     2601    2       DO WHILE (SLOT~=0);
      142     2602    3           IF GLOBAL.BCB.BUF.LOCK(SLOT)=0 THEN DO;
      143     2603    3               IF GLOBAL.BCB.BUF.STATUS.BUSY(SLOT)=%NO# AND
      144     2604    3                  GLOBAL.BCB.BUF.STATUS.MODIFY(SLOT) = %YES# AND
      145     2605    3                  GLOBAL.BCB.SLOT ~= SLOT THEN
      146     2606        /*                  Clear modify flag on some other buffer. */
      147     2607    3                   CALL ZIO$DWRITE(SLOT) ALTRET(ER_WRITE);
      148     2608    3               GOTO WAIT;
      149     2609    3               END;
      150     2610    2           SLOT=GLOBAL.BCB.BUF.LINK(SLOT);
      151     2611    2           END;
      152     2612
      153     2613        /*      Make sure buffer not busy before returning. */
      154     2614    1   WAIT: ;
      155     2615    2       DO WHILE(GLOBAL.BCB.BUF.STATUS.BUSY(GLOBAL.BCB.SLOT));
      156     2616    2           CALL M$WAIT(FPT_WAIT);
      157     2617    2           END;
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:6    
      158     2618    1       PINCRW(GLOBAL.PARAN.IO.BUF$,-3)->BLOCK.PSTAMP=
      159     2619    1          GLOBAL.BCB.SLOT;
      160     2620            %DBEXC;
      161     2624    1   ER_WRITE: ;
      162     2625    1   ALT: ;
      163     2626            %DBALT;
      164     2640    1   END ZIO$GETBUF;
      165     2641        %EOD;

PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:7    
--  Include file information  --

   ZI_ERRORS_C.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   ZI$DBCB.:ZIC0TOU  is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIO$GETBUF.

   Procedure ZIO$GETBUF requires 249 words for executable code.
   Procedure ZIO$GETBUF requires 10 words of local(AUTO) storage.

PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:8    

 Object Unit name= ZIO$GETBUF                                 File name= ZIM$BUFM.:ZIC0TOU
 UTS= SEP 05 '97 12:35:11.20 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Proc  even  none   249    371  ZIO$GETBUF
    2  RoData even  none     5      5  ZIO$GETBUF

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      XStd       0  ZIO$GETBUF
     1     32          yes     yes      XStd       0  ZIO$GETSLOT
     1    174          yes     yes      XStd       0  ZIO$CHKBUSY

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           XStd      1 ZIO$DWRITE
 yes     yes           XStd      0 ZIM$DEQ_ONE
         yes           XStd      0 ZIB$ERR
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:9    

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    GLOBAL$                               M$UC                                  FPT_WAIT

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:10   


        1        1        /*M*    ZIO$GETBUF - Get a buffer for I/O. */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*P*
        8        8        NAME:   ZIO$GETBUF
        9        9        PURPOSE:To get a buffer for I/O and unsure an unmodified buffer exists.
       10       10        */
       11       11        /*D*
       12       12        NAME:   ZIO$GETBUF
       13       13        CALL:   CALL ZIO$GETBUF
       14       14        ENTRY:  CALL ZIO$GETSLOT
       15       15        ENTRY:  CALL ZIO$CHKBUSY
       16       16        INPUT:  GLOBAL.PARAN.IO.PGNO - The page number to read
       17       17                GLOBAL.PARAN.IO.AWS$ - The AREA to read
       18       18        OUTPUT: GLOBAL.BCB.SLOT - The slot that contins the buffer
       19       19                GLOBAL.PARAN.IO.BUF$ - The pointer to the buffer.
       20       20        DESCRIPTION;
       21       21            The buffer pool is searched to see if the buffer is in memory
       22       22            already.  If it is found it is returned.  If not, the
       23       23            least recently used slot that is not locked is cleared (by
       24       24            writting it out if it has been modified) and used.
       25       25
       26       26            After a buffer is selected, it is checked to make sure it is
       27       27            not busy.  In addition an attempt is made to have a slot
       28       28            available for another read by making sure at least one
       29       29            unupdated buffer exists.  This will allow us to read into
       30       30            it without first performing a write, when the next buffer
       31       31            request is recieved.
       32       32
       33       33            The entry point ZIO$GETSLOT is used when it is known that
       34       34            the buffer is not in memory.  Thus there is no need to
       35       35            search the buffer pool.  This entry point is used when
       36       36            concurrent access control is active since it keeps track
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:11   
       37       37            of buffers that ENQs are tied to.
       38       38
       39       39            The entry point ZIO$CHKBUSY is used when it is known that
       40       40            the buffer is in memory and which buffer it is.  At this
       41       41            point we need only inusre that the buffer is not busy.
       42       42            This entry point is also used when concurrent access
       43       43            control is active since it keeps track of buffers that
       44       44            ENQs are tied to.
       45       45        */
       46       46        %EJECT;
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:12   
       47       47        ZIO$GETBUF: PROC ALTRET

     47  1 000000   000000 700200 xent  ZIO$GETBUF   TSX0  ! X66_AUTO_0
         1 000001   000012 000000                    ZERO    10,0

       48       48         /* USE($PR5 FOR GLOBAL$) */
       49       49               AVOID($PR5,$PR6,$PR7);
       50       50        %INCLUDE ZI$GLOBAL;
       51      536            %GLOBALS;
       52      844            %BUFFERS;
       53      859            %ENQLIST;
       54      877        %INCLUDE ZI$DBCB;
       55     1519            %AWS;
       56     1559        %INCLUDE CP_6;
       57     1640            %FPT_WAIT(STCLASS=SYMREF);
       58     1654        %INCLUDE CP_6_SUBS;
       59     2194        %INCLUDE ZI_ERRORS_C;
       60     2520    1   DCL ERROR UBIN(36);
       61     2521    1   DCL SLOT UBIN(36);
       62     2522    1   DCL PRESLOT UBIN(36);
       63     2523    1   DCL ZIM$DEQ_ONE ENTRY ALTRET;
       64     2524    1   DCL ZIO$DWRITE ENTRY(1) ALTRET;
       65     2525    1       ERROR=1; /* ASSUME PAGE IS IN BUFFER POOL */

   2525  1 000002   000001 235007                    LDA     1,DL
         1 000003   200005 755100                    STA     ERROR,,AUTO

       66     2526    1       SLOT=GLOBAL.BCB.HEAD; /* SEARCH FROM MOST RECENT USED */

   2526  1 000004   000000 470400 xsym               LDP0    GLOBAL$
         1 000005   000175 235100                    LDA     125,,PR0
         1 000006   200006 755100                    STA     SLOT,,AUTO

       67     2527    2       DO WHILE(SLOT~=0);

   2527  1 000007   000031 600000 1                  TZE     s:2532+1

PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:13   
       68     2528    2           IF GLOBAL.BCB.BUF.PGNO(SLOT)=GLOBAL.PARAN.IO.PGNO AND

   2528  1 000010   000000 470400 xsym               LDP0    GLOBAL$
         1 000011   200006 236100                    LDQ     SLOT,,AUTO
         1 000012   000005 402007                    MPY     5,DL
         1 000013   000203 236106                    LDQ     131,QL,PR0
         1 000014   000021 116100                    CMPQ    17,,PR0
         1 000015   000023 601000 1                  TNZ     s:2531
         1 000016   200006 236100                    LDQ     SLOT,,AUTO
         1 000017   000005 402007                    MPY     5,DL
         1 000020   000204 236106                    LDQ     132,QL,PR0
         1 000021   000020 116100                    CMPQ    16,,PR0
         1 000022   000202 600000 1                  TZE     CHKBUSY

       69     2529    2              GLOBAL.BCB.BUF.AWS$(SLOT)=GLOBAL.PARAN.IO.AWS$ THEN
       70     2530    2               GOTO CHKBUSY;
       71     2531    2           SLOT=GLOBAL.BCB.BUF.BLINK(SLOT);

   2531  1 000023   200006 236100                    LDQ     SLOT,,AUTO
         1 000024   000005 402007                    MPY     5,DL
         1 000025   000205 236106                    LDQ     133,QL,PR0
         1 000026   777777 376007                    ANQ     -1,DL
         1 000027   200006 756100                    STQ     SLOT,,AUTO

       72     2532    2           END;

   2532  1 000030   000010 601000 1                  TNZ     s:2528
         1 000031   000034 710000 1                  TRA     s:2535

       73     2533    1   ZIO$GETSLOT: ENTRY ALTRET; /* FIND A AVAIL SLOT, SWAP 1 OUT IF NEEDED */

   2533  1 000032   000000 700200 xent  ZIO$GETSLOT  TSX0  ! X66_AUTO_0
         1 000033   000012 000000                    ZERO    10,0

       74     2534        /*      Set buffer not found flag. */
       75     2535    1       ERROR=0;

PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:14   
   2535  1 000034   200005 450100                    STZ     ERROR,,AUTO

       76     2536    1       SLOT=GLOBAL.BCB.TAIL;

   2536  1 000035   000000 470400 xsym               LDP0    GLOBAL$
         1 000036   000176 235100                    LDA     126,,PR0
         1 000037   200006 755100                    STA     SLOT,,AUTO

       77     2537    2       DO WHILE (SLOT~=0);

   2537  1 000040   000171 600000 1                  TZE     s:2572

       78     2538    3           IF GLOBAL.BCB.BUF.LOCK(SLOT)=0 THEN DO;

   2538  1 000041   200006 236100                    LDQ     SLOT,,AUTO
         1 000042   000005 402007                    MPY     5,DL
         1 000043   000000 470400 xsym               LDP0    GLOBAL$
         1 000044   000206 220106                    LDX0    134,QL,PR0
         1 000045   000165 601000 1                  TNZ     s:2569

       79     2539    4               IF GLOBAL.BCB.BUF.AWS$(SLOT)~=ADDR(NIL) THEN DO;

   2539  1 000046   000204 236106                    LDQ     132,QL,PR0
         1 000047   000000 116000 2                  CMPQ    0
         1 000050   000152 600000 1                  TZE     NEW

       80     2540        /*                  If this buffer has something valid in it. */
       81     2541    4                   IF GLOBAL.BCB.BUF.STATUS.BUSY(SLOT)=%NO# AND

   2541  1 000051   200006 236100                    LDQ     SLOT,,AUTO
         1 000052   000005 402007                    MPY     5,DL
         1 000053   000206 236106                    LDQ     134,QL,PR0
         1 000054   400000 316007                    CANQ    -131072,DL
         1 000055   000071 601000 1                  TNZ     s:2544
         1 000056   200006 236100                    LDQ     SLOT,,AUTO
         1 000057   000005 402007                    MPY     5,DL
         1 000060   000206 236106                    LDQ     134,QL,PR0
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:15   
         1 000061   200000 316007                    CANQ    65536,DL
         1 000062   000071 600000 1                  TZE     s:2544

       82     2542    4                      GLOBAL.BCB.BUF.STATUS.MODIFY(SLOT)=%YES# THEN
       83     2543    4                       CALL ZIO$DWRITE(SLOT) ALTRET(ER_WRITE);

   2543  1 000063   200006 631500                    EPPR1   SLOT,,AUTO
         1 000064   200010 451500                    STP1    PRESLOT+1,,AUTO
         1 000065   200010 630500                    EPPR0   PRESLOT+1,,AUTO
         1 000066   000001 631400 2                  EPPR1   1
         1 000067   000000 701000 xent               TSX1    ZIO$DWRITE
         1 000070   000350 702000 1                  TSX2    ER_WRITE

       84     2544    4                   ENQLIST$=GLOBAL.ENQ.LIST.BASE$;

   2544  1 000071   000000 470400 xsym               LDP0    GLOBAL$
         1 000072   001411 236100                    LDQ     777,,PR0
         1 000073   200003 756100                    STQ     ENQLIST$,,AUTO

       85     2545    5                   IF GLOBAL.BCB.BUF.AWS$(SLOT)->AWS.ATRIB.CURONLY THEN DO;

   2545  1 000074   200006 236100                    LDQ     SLOT,,AUTO
         1 000075   000005 402007                    MPY     5,DL
         1 000076   000204 471506                    LDP1    132,QL,PR0
         1 000077   100000 236100                    LDQ     0,,PR1
         1 000100   200000 316003                    CANQ    65536,DU
         1 000101   000126 600000 1                  TZE     s:2556

       86     2546        /*                      The page just written should be DEQed. */
       87     2547    5                       GLOBAL.ENQ.LIST.INDX=GLOBAL.BCB.BUF.ENQINDX(SLOT);

   2547  1 000102   200006 236100                    LDQ     SLOT,,AUTO
         1 000103   000005 402007                    MPY     5,DL
         1 000104   000206 720106                    LXL0    134,QL,PR0
         1 000105   077777 360003                    ANX0    32767,DU
         1 000106   001412 740100                    STX0    778,,PR0

PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:16   
       88     2548    5                       IF GLOBAL.ENQ.LIST.INDX~=0 AND

   2548  1 000107   000126 600000 1                  TZE     s:2556
         1 000110   001412 221100                    LDX1    778,,PR0
         1 000111   001412 021100                    ADLX1   778,,PR0
         1 000112   200003 471500                    LDP1    ENQLIST$,,AUTO
         1 000113   100000 234111                    SZN     0,X1,PR1
         1 000114   000126 604000 1                  TMI     s:2556
         1 000115   100000 236111                    LDQ     0,X1,PR1
         1 000116   200000 316003                    CANQ    65536,DU
         1 000117   000126 601000 1                  TNZ     s:2556
         1 000120   100000 316003                    CANQ    32768,DU
         1 000121   000126 601000 1                  TNZ     s:2556

       89     2549    5                          NOT ENQLIST.STATUS.KEEP(GLOBAL.ENQ.LIST.INDX) AND
       90     2550    5                          NOT ENQLIST.STATUS.CURRENT(GLOBAL.ENQ.LIST.INDX) AND
       91     2551    6                          NOT ENQLIST.STATUS.MODIFY(GLOBAL.ENQ.LIST.INDX) THEN DO;

       92     2552    6                           CALL ZIM$DEQ_ONE ALTRET(ALT);

   2552  1 000122   000002 631400 2                  EPPR1   2
         1 000123   000000 701000 xent               TSX1    ZIM$DEQ_ONE
         1 000124   000350 702000 1                  TSX2    ER_WRITE

       93     2553    6                           GOTO NEW;

   2553  1 000125   000152 710000 1                  TRA     NEW

       94     2554    6                           END;
       95     2555    5                       END;
       96     2556    5                   IF GLOBAL.BCB.BUF.AWS$(SLOT)->AWS.ATRIB.CAC THEN DO;

   2556  1 000126   200006 236100                    LDQ     SLOT,,AUTO
         1 000127   000005 402007                    MPY     5,DL
         1 000130   000204 471506                    LDP1    132,QL,PR0
         1 000131   100000 236100                    LDQ     0,,PR1
         1 000132   000001 316003                    CANQ    1,DU
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:17   
         1 000133   000152 600000 1                  TZE     NEW

       97     2557        /*                      Delete old link from ENQ list. */
       98     2558    5                       ENQLIST.BUFSLOT(GLOBAL.BCB.BUF.ENQINDX(SLOT))=0;

   2558  1 000134   200006 236100                    LDQ     SLOT,,AUTO
         1 000135   000005 402007                    MPY     5,DL
         1 000136   000206 236106                    LDQ     134,QL,PR0
         1 000137   000001 736000                    QLS     1
         1 000140   177776 376007                    ANQ     65534,DL
         1 000141   200003 471500                    LDP1    ENQLIST$,,AUTO
         1 000142   000000 620006                    EAX0    0,QL
         1 000143   000003 236000 2                  LDQ     3
         1 000144   100000 356110                    ANSQ    0,X0,PR1

       99     2559    5                       GLOBAL.BCB.BUF.ENQINDX(SLOT)=0;

   2559  1 000145   200006 236100                    LDQ     SLOT,,AUTO
         1 000146   000005 402007                    MPY     5,DL
         1 000147   000000 620006                    EAX0    0,QL
         1 000150   000004 236000 2                  LDQ     4
         1 000151   000206 356110                    ANSQ    134,X0,PR0

      100     2560    5                       END;

      101     2561    4                   END;

   2558  1 000152                       NEW          null
      102     2562
      103     2563        /*              Assign new values for this buffer. */
      104     2564    3   NEW:        ;
      105     2565    3               GLOBAL.BCB.BUF.PGNO(SLOT)=GLOBAL.PARAN.IO.PGNO;

   2565  1 000152   200006 236100                    LDQ     SLOT,,AUTO
         1 000153   000005 402007                    MPY     5,DL
         1 000154   000000 470400 xsym               LDP0    GLOBAL$
         1 000155   000021 235100                    LDA     17,,PR0
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:18   
         1 000156   000203 755106                    STA     131,QL,PR0

      106     2566    3               GLOBAL.BCB.BUF.AWS$(SLOT)=GLOBAL.PARAN.IO.AWS$;

   2566  1 000157   200006 236100                    LDQ     SLOT,,AUTO
         1 000160   000005 402007                    MPY     5,DL
         1 000161   000000 620006                    EAX0    0,QL
         1 000162   000020 236100                    LDQ     16,,PR0
         1 000163   000204 756110                    STQ     132,X0,PR0

      107     2567    3               GOTO CHKBUSY;

   2567  1 000164   000202 710000 1                  TRA     CHKBUSY

      108     2568    3               END;
      109     2569    2           SLOT=GLOBAL.BCB.BUF.LINK(SLOT);

   2569  1 000165   000205 236106                    LDQ     133,QL,PR0
         1 000166   000022 772000                    QRL     18
         1 000167   200006 756100                    STQ     SLOT,,AUTO

      110     2570    2           END;

   2570  1 000170   000041 601000 1                  TNZ     s:2538

      111     2571
      112     2572    1       ERROR=ERR#IO#E18;

   2572  1 000171   303266 235007                    LDA     100022,DL
         1 000172   200005 755100                    STA     ERROR,,AUTO

      113     2573    1       GOTO ALT;

   2573  1 000173   000350 710000 1                  TRA     ER_WRITE

      114     2574
      115     2575    1   ZIO$CHKBUSY: ENTRY ALTRET;
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:19   

   2575  1 000174   000000 700200 xent  ZIO$CHKBUSY  TSX0  ! X66_AUTO_0
         1 000175   000012 000000                    ZERO    10,0

      116     2576    1       ERROR=0;

   2576  1 000176   200005 450100                    STZ     ERROR,,AUTO

      117     2577    1       SLOT=GLOBAL.BCB.SLOT;

   2577  1 000177   000000 470400 xsym               LDP0    GLOBAL$
         1 000200   000200 235100                    LDA     128,,PR0
         1 000201   200006 755100                    STA     SLOT,,AUTO

   2577  1 000202                       CHKBUSY      null
      118     2578    1   CHKBUSY: ;
      119     2579    1       GLOBAL.PARAN.IO.BUF$=GLOBAL.BCB.BUF.BUF$(SLOT);

   2579  1 000202   200006 236100                    LDQ     SLOT,,AUTO
         1 000203   000005 402007                    MPY     5,DL
         1 000204   000202 236106                    LDQ     130,QL,PR0
         1 000205   000022 756100                    STQ     18,,PR0

      120     2580    1       IF SLOT~=GLOBAL.BCB.HEAD THEN

   2580  1 000206   200006 236100                    LDQ     SLOT,,AUTO
         1 000207   000175 116100                    CMPQ    125,,PR0
         1 000210   000262 600000 1                  TZE     s:2599

      121     2581    2       DO;

      122     2582    2           IF SLOT=GLOBAL.BCB.TAIL THEN

   2582  1 000211   000176 116100                    CMPQ    126,,PR0
         1 000212   000223 601000 1                  TNZ     s:2589

      123     2583    3           DO;
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:20   

      124     2584    3               GLOBAL.BCB.TAIL=GLOBAL.BCB.BUF.LINK(SLOT);

   2584  1 000213   000005 402007                    MPY     5,DL
         1 000214   000205 236106                    LDQ     133,QL,PR0
         1 000215   000022 772000                    QRL     18
         1 000216   000176 756100                    STQ     126,,PR0

      125     2585    3               GLOBAL.BCB.BUF.BLINK(GLOBAL.BCB.TAIL)=0;

   2585  1 000217   000005 402007                    MPY     5,DL
         1 000220   000000 220003                    LDX0    0,DU
         1 000221   000205 440106                    SXL0    133,QL,PR0

      126     2586    3               END;

   2586  1 000222   000244 710000 1                  TRA     s:2593

      127     2587    2           ELSE
      128     2588    3           DO; /* MIDDLE SLOT, UPDATE LINK AND BLINK */

      129     2589    3               PRESLOT=GLOBAL.BCB.BUF.BLINK(SLOT);

   2589  1 000223   000005 402007                    MPY     5,DL
         1 000224   000205 236106                    LDQ     133,QL,PR0
         1 000225   777777 376007                    ANQ     -1,DL
         1 000226   200007 756100                    STQ     PRESLOT,,AUTO

      130     2590    3               GLOBAL.BCB.BUF.LINK(PRESLOT)=GLOBAL.BCB.BUF.LINK(SLOT);

   2590  1 000227   000005 402007                    MPY     5,DL
         1 000230   000000 620006                    EAX0    0,QL
         1 000231   200006 236100                    LDQ     SLOT,,AUTO
         1 000232   000005 402007                    MPY     5,DL
         1 000233   000205 221106                    LDX1    133,QL,PR0
         1 000234   000205 741110                    STX1    133,X0,PR0

PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:21   
      131     2591    3               GLOBAL.BCB.BUF.BLINK(GLOBAL.BCB.BUF.LINK(SLOT))=PRESLOT;

   2591  1 000235   200006 236100                    LDQ     SLOT,,AUTO
         1 000236   000005 402007                    MPY     5,DL
         1 000237   000205 236106                    LDQ     133,QL,PR0
         1 000240   000022 772000                    QRL     18
         1 000241   000005 402007                    MPY     5,DL
         1 000242   200007 722100                    LXL2    PRESLOT,,AUTO
         1 000243   000205 442106                    SXL2    133,QL,PR0

      132     2592    3               END;

      133     2593    2           GLOBAL.BCB.BUF.BLINK(SLOT)=GLOBAL.BCB.HEAD;

   2593  1 000244   200006 236100                    LDQ     SLOT,,AUTO
         1 000245   000005 402007                    MPY     5,DL
         1 000246   000175 720100                    LXL0    125,,PR0
         1 000247   000205 440106                    SXL0    133,QL,PR0

      134     2594    2           GLOBAL.BCB.BUF.LINK(GLOBAL.BCB.HEAD)=SLOT;

   2594  1 000250   000175 236100                    LDQ     125,,PR0
         1 000251   000005 402007                    MPY     5,DL
         1 000252   200006 720100                    LXL0    SLOT,,AUTO
         1 000253   000205 740106                    STX0    133,QL,PR0

      135     2595    2           GLOBAL.BCB.HEAD=SLOT;

   2595  1 000254   200006 235100                    LDA     SLOT,,AUTO
         1 000255   000175 755100                    STA     125,,PR0

      136     2596    2           GLOBAL.BCB.BUF.LINK(GLOBAL.BCB.HEAD)=0;

   2596  1 000256   000175 236100                    LDQ     125,,PR0
         1 000257   000005 402007                    MPY     5,DL
         1 000260   000000 220003                    LDX0    0,DU
         1 000261   000205 740106                    STX0    133,QL,PR0
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:22   

      137     2597    2           END;

      138     2598        /*      Save SLOT for returning. */
      139     2599    1       GLOBAL.BCB.SLOT=SLOT;

   2599  1 000262   200006 235100                    LDA     SLOT,,AUTO
         1 000263   000200 755100                    STA     128,,PR0

      140     2600    1       SLOT=GLOBAL.BCB.TAIL;

   2600  1 000264   000176 235100                    LDA     126,,PR0
         1 000265   200006 755100                    STA     SLOT,,AUTO

      141     2601    2       DO WHILE (SLOT~=0);

   2601  1 000266   000323 600000 1                  TZE     WAIT

      142     2602    3           IF GLOBAL.BCB.BUF.LOCK(SLOT)=0 THEN DO;

   2602  1 000267   200006 236100                    LDQ     SLOT,,AUTO
         1 000270   000005 402007                    MPY     5,DL
         1 000271   000000 470400 xsym               LDP0    GLOBAL$
         1 000272   000206 220106                    LDX0    134,QL,PR0
         1 000273   000317 601000 1                  TNZ     s:2610

      143     2603    3               IF GLOBAL.BCB.BUF.STATUS.BUSY(SLOT)=%NO# AND

   2603  1 000274   000206 236106                    LDQ     134,QL,PR0
         1 000275   400000 316007                    CANQ    -131072,DL
         1 000276   000316 601000 1                  TNZ     s:2608
         1 000277   200006 236100                    LDQ     SLOT,,AUTO
         1 000300   000005 402007                    MPY     5,DL
         1 000301   000206 236106                    LDQ     134,QL,PR0
         1 000302   200000 316007                    CANQ    65536,DL
         1 000303   000316 600000 1                  TZE     s:2608
         1 000304   000200 236100                    LDQ     128,,PR0
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:23   
         1 000305   000310 604000 1                  TMI     s:2607
         1 000306   200006 116100                    CMPQ    SLOT,,AUTO
         1 000307   000316 600000 1                  TZE     s:2608

      144     2604    3                  GLOBAL.BCB.BUF.STATUS.MODIFY(SLOT) = %YES# AND
      145     2605    3                  GLOBAL.BCB.SLOT ~= SLOT THEN
      146     2606        /*                  Clear modify flag on some other buffer. */
      147     2607    3                   CALL ZIO$DWRITE(SLOT) ALTRET(ER_WRITE);

   2607  1 000310   200006 631500                    EPPR1   SLOT,,AUTO
         1 000311   200010 451500                    STP1    PRESLOT+1,,AUTO
         1 000312   200010 630500                    EPPR0   PRESLOT+1,,AUTO
         1 000313   000001 631400 2                  EPPR1   1
         1 000314   000000 701000 xent               TSX1    ZIO$DWRITE
         1 000315   000350 702000 1                  TSX2    ER_WRITE

      148     2608    3               GOTO WAIT;

   2608  1 000316   000323 710000 1                  TRA     WAIT

      149     2609    3               END;
      150     2610    2           SLOT=GLOBAL.BCB.BUF.LINK(SLOT);

   2610  1 000317   000205 236106                    LDQ     133,QL,PR0
         1 000320   000022 772000                    QRL     18
         1 000321   200006 756100                    STQ     SLOT,,AUTO

      151     2611    2           END;

   2611  1 000322   000267 601000 1                  TNZ     s:2602

   2604  1 000323                       WAIT         null
      152     2612
      153     2613        /*      Make sure buffer not busy before returning. */
      154     2614    1   WAIT: ;
      155     2615    2       DO WHILE(GLOBAL.BCB.BUF.STATUS.BUSY(GLOBAL.BCB.SLOT));

PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:24   
   2615  1 000323   000000 470400 xsym               LDP0    GLOBAL$
         1 000324   000200 236100                    LDQ     128,,PR0
         1 000325   000005 402007                    MPY     5,DL
         1 000326   000206 236106                    LDQ     134,QL,PR0
         1 000327   400000 316007                    CANQ    -131072,DL
         1 000330   000342 600000 1                  TZE     s:2618

      156     2616    2           CALL M$WAIT(FPT_WAIT);

   2616  1 000331   000000 630400 xsym               EPPR0   FPT_WAIT
         1 000332   020006 713400                    CLIMB   8198
         1 000333   400400 401760                    pmme    nvectors=2

      157     2617    2           END;

   2617  1 000334   000000 470400 xsym               LDP0    GLOBAL$
         1 000335   000200 236100                    LDQ     128,,PR0
         1 000336   000005 402007                    MPY     5,DL
         1 000337   000206 236106                    LDQ     134,QL,PR0
         1 000340   400000 316007                    CANQ    -131072,DL
         1 000341   000331 601000 1                  TNZ     s:2616

      158     2618    1       PINCRW(GLOBAL.PARAN.IO.BUF$,-3)->BLOCK.PSTAMP=

   2618  1 000342   000022 471500                    LDP1    18,,PR0
         1 000343   000200 235100                    LDA     128,,PR0
         1 000344   177775 755100                    STA     -3,,PR1

      159     2619    1          GLOBAL.BCB.SLOT;
      160     2620            %DBEXC;

   2621  1 000345   200005 235100                    LDA     ERROR,,AUTO
         1 000346   000006 755100                    STA     6,,PR0

   2622  1 000347   000000 702200 xent               TSX2  ! X66_ARET

   2621  1 000350                       ER_WRITE     null
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:25   
   2621  1 000350                       ALT          null
      161     2624    1   ER_WRITE: ;
      162     2625    1   ALT: ;
      163     2626            %DBALT;

   2627  1 000350   000000 470400 xsym               LDP0    GLOBAL$
         1 000351   000006 235100                    LDA     6,,PR0
         1 000352   000361 601000 1                  TNZ     s:2635

   2629  1 000353   000010 450100                    STZ     8,,PR0

   2630  1 000354   000012 450100                    STZ     10,,PR0

   2631  1 000355   000013 450100                    STZ     11,,PR0

   2632  1 000356   000011 450100                    STZ     9,,PR0

   2633  1 000357   200005 236100                    LDQ     ERROR,,AUTO
         1 000360   000006 756100                    STQ     6,,PR0

   2635  1 000361   000006 235100                    LDA     6,,PR0
         1 000362   303240 115007                    CMPA    100000,DL
         1 000363   000365 603000 1                  TRC     s:2638

   2636  1 000364   000000 702200 xent               TSX2  ! X66_AALT

   2638  1 000365   000002 631400 2                  EPPR1   2
         1 000366   000000 701000 xent               TSX1    ZIB$ERR
         1 000367   000000 011000                    NOP     0

      164     2640    1   END ZIO$GETBUF;

   2640  1 000370   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   2     000   000000 006014   000001 000000   000000 000000   777000 777777    ................
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:26   
   2     004   777777 700000                                                    ....
      165     2641        %EOD;

PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:27   
--  Include file information  --

   ZI_ERRORS_C.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   ZI$DBCB.:ZIC0TOU  is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIO$GETBUF.

   Procedure ZIO$GETBUF requires 249 words for executable code.
   Procedure ZIO$GETBUF requires 10 words of local(AUTO) storage.
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:28   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:29   
          MINI XREF LISTING

ALT
      2621**LABEL    2552--CALLALT  2573--GOTO
AWS.ATRIB.CAC
      1538**DCL      2556>>IF
AWS.ATRIB.CURONLY
      1524**DCL      2545>>IF
AWS$
      1520**DCL      1521--IMP-PTR
BLOCK.PSTAMP
       849**DCL      2618<<ASSIGN
CHKBUSY
      2577**LABEL    2530--GOTO     2567--GOTO
ENQLIST.BUFSLOT
       869**DCL      2558<<ASSIGN
ENQLIST.STATUS.CURRENT
       864**DCL      2548>>IF
ENQLIST.STATUS.KEEP
       862**DCL      2548>>IF
ENQLIST.STATUS.MODIFY
       866**DCL      2548>>IF
ENQLIST$
       875**DCL       860--IMP-PTR  2544<<ASSIGN   2548>>IF       2548>>IF       2548>>IF       2558>>ASSIGN
ERROR
      2520**DCL      2525<<ASSIGN   2535<<ASSIGN   2572<<ASSIGN   2576<<ASSIGN   2621>>ASSIGN   2633>>ASSIGN
ER_WRITE
      2621**LABEL    2543--CALLALT  2607--CALLALT
FPT_WAIT
      1651**DCL      2616<>CALL
GLOBAL.ACTIVE.DBCB$
       543**DCL       544--REDEF
GLOBAL.ACTIVE.SSS$
       539**DCL       540--REDEF
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:30   
GLOBAL.BCB.BUF.AWS$
       652**DCL      2528>>IF       2539>>IF       2545>>IF       2556>>IF       2566<<ASSIGN
GLOBAL.BCB.BUF.BLINK
       654**DCL      2531>>ASSIGN   2585<<ASSIGN   2589>>ASSIGN   2591<<ASSIGN   2593<<ASSIGN
GLOBAL.BCB.BUF.BUF$
       650**DCL      2579>>ASSIGN
GLOBAL.BCB.BUF.ENQINDX
       660**DCL      2547>>ASSIGN   2558>>ASSIGN   2559<<ASSIGN
GLOBAL.BCB.BUF.LINK
       653**DCL      2569>>ASSIGN   2584>>ASSIGN   2590<<ASSIGN   2590>>ASSIGN   2591>>ASSIGN   2594<<ASSIGN
      2596<<ASSIGN   2610>>ASSIGN
GLOBAL.BCB.BUF.LOCK
       655**DCL      2538>>IF       2602>>IF
GLOBAL.BCB.BUF.PGNO
       651**DCL      2528>>IF       2565<<ASSIGN
GLOBAL.BCB.BUF.STATUS.BUSY
       657**DCL      2541>>IF       2603>>IF       2615>>DOWHILE
GLOBAL.BCB.BUF.STATUS.MODIFY
       658**DCL      2541>>IF       2603>>IF
GLOBAL.BCB.HEAD
       644**DCL      2526>>ASSIGN   2580>>IF       2593>>ASSIGN   2594>>ASSIGN   2595<<ASSIGN   2596>>ASSIGN
GLOBAL.BCB.SLOT
       647**DCL      2577>>ASSIGN   2599<<ASSIGN   2603>>IF       2615>>DOWHILE  2618>>ASSIGN
GLOBAL.BCB.TAIL
       645**DCL      2536>>ASSIGN   2582>>IF       2584<<ASSIGN   2585>>ASSIGN   2600>>ASSIGN
GLOBAL.ENQ.LIST.BASE$
       675**DCL      2544>>ASSIGN
GLOBAL.ENQ.LIST.INDX
       677**DCL      2547<<ASSIGN   2548>>IF       2548>>IF       2548>>IF       2548>>IF
GLOBAL.KEY
       747**DCL       750--REDEF
GLOBAL.PARAN.IO.AWS$
       586**DCL      2528>>IF       2566>>ASSIGN
GLOBAL.PARAN.IO.BUF$
       588**DCL      2579<<ASSIGN   2618>>ASSIGN
GLOBAL.PARAN.IO.PGNO
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:31   
       587**DCL      2528>>IF       2565>>ASSIGN
GLOBAL.PARAN.TRACE.MODE
       622**DCL       629--REDEF
GLOBAL.PRINTBUF.BUFFER
       781**DCL       782--REDEF     783--REDEF     784--REDEF
GLOBAL.PRINTBUF.ERR.V
       786**DCL       789--REDEF     790--REDEF     791--REDEF
GLOBAL.RET.AC#
       559**DCL      2629<<ASSIGN
GLOBAL.RET.ERROR#
       557**DCL      2621<<ASSIGN   2627>>IF       2633<<ASSIGN   2635>>IF
GLOBAL.RET.FR#
       560**DCL      2632<<ASSIGN
GLOBAL.RET.RC#
       562**DCL      2631<<ASSIGN
GLOBAL.RET.SC#
       561**DCL      2630<<ASSIGN
GLOBAL$
       841**DCL       537--IMP-PTR  2526>>ASSIGN   2528>>IF       2528>>IF       2528>>IF       2528>>IF
      2531>>ASSIGN   2536>>ASSIGN   2538>>IF       2539>>IF       2541>>IF       2541>>IF       2544>>ASSIGN
      2545>>IF       2547>>ASSIGN   2547>>ASSIGN   2548>>IF       2548>>IF       2548>>IF       2548>>IF
      2556>>IF       2558>>ASSIGN   2559>>ASSIGN   2565>>ASSIGN   2565>>ASSIGN   2566>>ASSIGN   2566>>ASSIGN
      2569>>ASSIGN   2577>>ASSIGN   2579>>ASSIGN   2579>>ASSIGN   2580>>IF       2582>>IF       2584>>ASSIGN
      2584>>ASSIGN   2585>>ASSIGN   2585>>ASSIGN   2589>>ASSIGN   2590>>ASSIGN   2590>>ASSIGN   2591>>ASSIGN
      2591>>ASSIGN   2593>>ASSIGN   2593>>ASSIGN   2594>>ASSIGN   2594>>ASSIGN   2595>>ASSIGN   2596>>ASSIGN
      2596>>ASSIGN   2599>>ASSIGN   2600>>ASSIGN   2602>>IF       2603>>IF       2603>>IF       2603>>IF
      2610>>ASSIGN   2615>>DOWHILE  2615>>DOWHILE  2618>>ASSIGN   2618>>ASSIGN   2621>>ASSIGN   2627>>IF
      2629>>ASSIGN   2630>>ASSIGN   2631>>ASSIGN   2632>>ASSIGN   2633>>ASSIGN   2635>>IF
M$WAIT
      1626**DCL-ENT  2616--CALL
NEW
      2558**LABEL    2553--GOTO
PRESLOT
      2522**DCL      2589<<ASSIGN   2590>>ASSIGN   2591>>ASSIGN
SLOT
      2521**DCL      2526<<ASSIGN   2527>>DOWHILE  2528>>IF       2528>>IF       2531<<ASSIGN   2531>>ASSIGN
PL6.E3A0      #001=ZIO$GETBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:32   
      2536<<ASSIGN   2537>>DOWHILE  2538>>IF       2539>>IF       2541>>IF       2541>>IF       2543<>CALL
      2545>>IF       2547>>ASSIGN   2556>>IF       2558>>ASSIGN   2559>>ASSIGN   2565>>ASSIGN   2566>>ASSIGN
      2569<<ASSIGN   2569>>ASSIGN   2577<<ASSIGN   2579>>ASSIGN   2580>>IF       2582>>IF       2584>>ASSIGN
      2589>>ASSIGN   2590>>ASSIGN   2591>>ASSIGN   2593>>ASSIGN   2594>>ASSIGN   2595>>ASSIGN   2599>>ASSIGN
      2600<<ASSIGN   2601>>DOWHILE  2602>>IF       2603>>IF       2603>>IF       2603>>IF       2607<>CALL
      2610<<ASSIGN   2610>>ASSIGN
WAIT
      2604**LABEL    2608--GOTO
ZIB$ERR
       842**DCL-ENT  2638--CALL
ZIM$DEQ_ONE
      2523**DCL-ENT  2552--CALL
ZIO$DWRITE
      2524**DCL-ENT  2543--CALL     2607--CALL

PL6.E3A0      #002=ZIO$FLUSH File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:33   
      166        1        /*M* ZIO$FLUSH - outputs to the file system those pages in the
      167        2                         buffer pool having writes pending, and then
      168        3                         waits for completion of i/o activity on those
      169        4                         pages in the pool that have a busy i/o status.     */
      170        5        /*T***********************************************************/
      171        6        /*T*                                                         */
      172        7        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      173        8        /*T*                                                         */
      174        9        /*T***********************************************************/
      175       10        ZIO$FLUSH: PROC(ERASEBUF) ALTRET
      176       11         /* USE($PR5 FOR GLOBAL$) */
      177       12               AVOID($PR5,$PR6,$PR7);
      178       13    1   DCL ERROR SBIN;
      179       14    1   DCL ZIO$DWRITE ENTRY(1) ALTRET;
      180       15    1   DCL SLOT UBIN(36);
      181       16    1   DCL PRESLOT UBIN(36);
      182       17        %INCLUDE ZI$GLOBAL;
      183      503         %ENQLIST;
      184      521        %INCLUDE ZI$DBCB;
      185     1163         %AWS;
      186     1203         %GLOBALS;
      187     1511        %INCLUDE CP_6;
      188     1592         %FPT_WAIT(STCLASS=SYMREF);
      189     1606        %INCLUDE CP_6_SUBS;
      190     2146        %INCLUDE ZI_ERRORS_C;
      191     2472    1   DCL ERASEBUF BIT(1);
      192     2473    1   DCL INDX SBIN WORD ALIGNED;
      193     2474    1       ERROR=0;
      194     2475    1       SLOT=GLOBAL.BCB.TAIL;
      195     2476    2       DO WHILE (SLOT~=0);
      196     2477    2           IF GLOBAL.BCB.BUF.AWS$(SLOT)~=ADDR(NIL) THEN
      197     2478    3           DO;
      198     2479    3               GLOBAL.BCB.BUF.LOCK(SLOT)=0;
      199     2480    3               IF GLOBAL.BCB.BUF.STATUS.MODIFY(SLOT)=%YES# AND
      200     2481    3                  GLOBAL.BCB.BUF.STATUS.BUSY(SLOT)=%NO# THEN
      201     2482    3                   IF GLOBAL.PENDING.FORGET THEN
      202     2483    4                   DO INHIBIT;
PL6.E3A0      #002=ZIO$FLUSH File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:34   
      203     2484    4                       GLOBAL.BCB.BUF.STATUS.MODIFY(SLOT)=%NO#;
      204     2485    4                       GLOBAL.STATS.CURR.WRITES=GLOBAL.STATS.CURR.WRITES+1;
      205     2486    4                       END;
      206     2487    3                   ELSE
      207     2488    3                       CALL ZIO$DWRITE(SLOT) ALTRET(ER_WRT);
      208     2489    4   CHKBSY:     DO WHILE(GLOBAL.BCB.BUF.STATUS.BUSY(SLOT)=%YES#);
      209     2490    4                   CALL M$WAIT(FPT_WAIT);
      210     2491    4                   END;
      211     2492        /*          Next request get new copy of page if doing ENQ/DEQ */
      212     2493    3               INDX=GLOBAL.BCB.BUF.ENQINDX(SLOT);
      213     2494    3               IF INDX>0 OR ERASEBUF=%YES#
      214     2495    3                  OR GLOBAL.BCB.BUF.AWS$(SLOT)->AWS.ATRIB.SHANY THEN
      215     2496    4               DO; /* IF PAGE IS IN ENQ LIST, OR OPTIONAL ERASE */
      216     2497    4                   GLOBAL.BCB.BUF.AWS$(SLOT)=ADDR(NIL);
      217     2498    4                   IF INDX>0 THEN /* IF PAGE IS IN ENQ_LIST */
      218     2499    5                   DO; /* RESET BOTH WAY POINTERS TO 0 */
      219     2500    5                       ENQLIST$ = GLOBAL.ENQ.LIST.BASE$;
      220     2501    5                       ENQLIST.BUFSLOT(INDX) = 0;
      221     2502    5                       GLOBAL.BCB.BUF.ENQINDX(SLOT)=0;
      222     2503    5                       END;
      223     2504    4                   END;
      224     2505    3               END;
      225     2506    2           SLOT=GLOBAL.BCB.BUF.LINK(SLOT);
      226     2507    2           END;
      227     2508    1       IF ERROR~=0 THEN
      228     2509    1           ALTRETURN;
      229     2510    1       RETURN;
      230     2511    1   ER_WRT: ERROR=ERR#IO#FLSH;
      231     2512    1       GOTO CHKBSY;
      232     2513    1   END ZIO$FLUSH;
      233     2514        %EOD;

PL6.E3A0      #002=ZIO$FLUSH File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:35   
--  Include file information  --

   ZI_ERRORS_C.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   ZI$DBCB.:ZIC0TOU  is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIO$FLUSH.

   Procedure ZIO$FLUSH requires 107 words for executable code.
   Procedure ZIO$FLUSH requires 12 words of local(AUTO) storage.

PL6.E3A0      #002=ZIO$FLUSH File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:36   

 Object Unit name= ZIO$FLUSH                                  File name= ZIM$BUFM.:ZIC0TOU
 UTS= SEP 05 '97 12:35:21.12 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Proc  even  none   107    153  ZIO$FLUSH
    2  RoData even  none     6      6  ZIO$FLUSH

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      XStd       1  ZIO$FLUSH

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           XStd      1 ZIO$DWRITE
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    GLOBAL$                               M$UC                                  FPT_WAIT
PL6.E3A0      #002=ZIO$FLUSH File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:37   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID
PL6.E3A0      #002=ZIO$FLUSH File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:38   


      166        1        /*M* ZIO$FLUSH - outputs to the file system those pages in the
      167        2                         buffer pool having writes pending, and then
      168        3                         waits for completion of i/o activity on those
      169        4                         pages in the pool that have a busy i/o status.     */
      170        5        /*T***********************************************************/
      171        6        /*T*                                                         */
      172        7        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      173        8        /*T*                                                         */
      174        9        /*T***********************************************************/
      175       10        ZIO$FLUSH: PROC(ERASEBUF) ALTRET

     10  1 000000   000000 700200 xent  ZIO$FLUSH    TSX0  ! X66_AUTO_1
         1 000001   000014 000001                    ZERO    12,1

      176       11         /* USE($PR5 FOR GLOBAL$) */
      177       12               AVOID($PR5,$PR6,$PR7);
      178       13    1   DCL ERROR SBIN;
      179       14    1   DCL ZIO$DWRITE ENTRY(1) ALTRET;
      180       15    1   DCL SLOT UBIN(36);
      181       16    1   DCL PRESLOT UBIN(36);
      182       17        %INCLUDE ZI$GLOBAL;
      183      503         %ENQLIST;
      184      521        %INCLUDE ZI$DBCB;
      185     1163         %AWS;
      186     1203         %GLOBALS;
      187     1511        %INCLUDE CP_6;
      188     1592         %FPT_WAIT(STCLASS=SYMREF);
      189     1606        %INCLUDE CP_6_SUBS;
      190     2146        %INCLUDE ZI_ERRORS_C;
      191     2472    1   DCL ERASEBUF BIT(1);
      192     2473    1   DCL INDX SBIN WORD ALIGNED;
      193     2474    1       ERROR=0;

   2474  1 000002   200004 450100                    STZ     ERROR,,AUTO

      194     2475    1       SLOT=GLOBAL.BCB.TAIL;
PL6.E3A0      #002=ZIO$FLUSH File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:39   

   2475  1 000003   000000 470400 xsym               LDP0    GLOBAL$
         1 000004   000176 235100                    LDA     126,,PR0
         1 000005   200005 755100                    STA     SLOT,,AUTO

      195     2476    2       DO WHILE (SLOT~=0);

   2476  1 000006   000144 600000 1                  TZE     s:2508

      196     2477    2           IF GLOBAL.BCB.BUF.AWS$(SLOT)~=ADDR(NIL) THEN

   2477  1 000007   200005 236100                    LDQ     SLOT,,AUTO
         1 000010   000005 402007                    MPY     5,DL
         1 000011   000000 470400 xsym               LDP0    GLOBAL$
         1 000012   000204 236106                    LDQ     132,QL,PR0
         1 000013   000000 116000 2                  CMPQ    0
         1 000014   000136 600000 1                  TZE     s:2506

      197     2478    3           DO;

      198     2479    3               GLOBAL.BCB.BUF.LOCK(SLOT)=0;

   2479  1 000015   200005 236100                    LDQ     SLOT,,AUTO
         1 000016   000005 402007                    MPY     5,DL
         1 000017   000000 220003                    LDX0    0,DU
         1 000020   000206 740106                    STX0    134,QL,PR0

      199     2480    3               IF GLOBAL.BCB.BUF.STATUS.MODIFY(SLOT)=%YES# AND

   2480  1 000021   200005 236100                    LDQ     SLOT,,AUTO
         1 000022   000005 402007                    MPY     5,DL
         1 000023   000206 236106                    LDQ     134,QL,PR0
         1 000024   200000 316007                    CANQ    65536,DL
         1 000025   000055 600000 1                  TZE     CHKBSY
         1 000026   200005 236100                    LDQ     SLOT,,AUTO
         1 000027   000005 402007                    MPY     5,DL
         1 000030   000206 236106                    LDQ     134,QL,PR0
PL6.E3A0      #002=ZIO$FLUSH File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:40   
         1 000031   400000 316007                    CANQ    -131072,DL
         1 000032   000055 601000 1                  TNZ     CHKBSY

      200     2481    3                  GLOBAL.BCB.BUF.STATUS.BUSY(SLOT)=%NO# THEN
      201     2482    3                   IF GLOBAL.PENDING.FORGET THEN

   2482  1 000033   000017 236100                    LDQ     15,,PR0
         1 000034   000100 316003                    CANQ    64,DU
         1 000035   000047 600000 1                  TZE     s:2488

      202     2483    4                   DO INHIBIT;

      203     2484    4                       GLOBAL.BCB.BUF.STATUS.MODIFY(SLOT)=%NO#;

   2484  1 000036   200005 236300                    LDQ   ! SLOT,,AUTO
         1 000037   000005 402207                    MPY   ! 5,DL
         1 000040   000000 621206                    EAX1  ! 0,QL
         1 000041   000001 236200 2                  LDQ   ! 1
         1 000042   000206 356311                    ANSQ  ! 134,X1,PR0

      204     2485    4                       GLOBAL.STATS.CURR.WRITES=GLOBAL.STATS.CURR.WRITES+1;

   2485  1 000043   001426 235300                    LDA   ! 790,,PR0
         1 000044   000001 035207                    ADLA  ! 1,DL
         1 000045   001426 755300                    STA   ! 790,,PR0

      205     2486    4                       END;

   2486  1 000046   000055 710000 1                  TRA     CHKBSY

      206     2487    3                   ELSE
      207     2488    3                       CALL ZIO$DWRITE(SLOT) ALTRET(ER_WRT);

   2488  1 000047   200005 631500                    EPPR1   SLOT,,AUTO
         1 000050   200012 451500                    STP1    INDX+1,,AUTO
         1 000051   200012 630500                    EPPR0   INDX+1,,AUTO
         1 000052   000002 631400 2                  EPPR1   2
PL6.E3A0      #002=ZIO$FLUSH File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:41   
         1 000053   000000 701000 xent               TSX1    ZIO$DWRITE
         1 000054   000150 702000 1                  TSX2    ER_WRT

      208     2489    4   CHKBSY:     DO WHILE(GLOBAL.BCB.BUF.STATUS.BUSY(SLOT)=%YES#);

   2489  1 000055   200005 236100       CHKBSY       LDQ     SLOT,,AUTO
         1 000056   000005 402007                    MPY     5,DL
         1 000057   000000 470400 xsym               LDP0    GLOBAL$
         1 000060   000206 236106                    LDQ     134,QL,PR0
         1 000061   400000 316007                    CANQ    -131072,DL
         1 000062   000074 600000 1                  TZE     s:2493

      209     2490    4                   CALL M$WAIT(FPT_WAIT);

   2490  1 000063   000000 630400 xsym               EPPR0   FPT_WAIT
         1 000064   020006 713400                    CLIMB   8198
         1 000065   400400 401760                    pmme    nvectors=2

      210     2491    4                   END;

   2491  1 000066   200005 236100                    LDQ     SLOT,,AUTO
         1 000067   000005 402007                    MPY     5,DL
         1 000070   000000 470400 xsym               LDP0    GLOBAL$
         1 000071   000206 236106                    LDQ     134,QL,PR0
         1 000072   400000 316007                    CANQ    -131072,DL
         1 000073   000063 601000 1                  TNZ     s:2490

      211     2492        /*          Next request get new copy of page if doing ENQ/DEQ */
      212     2493    3               INDX=GLOBAL.BCB.BUF.ENQINDX(SLOT);

   2493  1 000074   200005 236100                    LDQ     SLOT,,AUTO
         1 000075   000005 402007                    MPY     5,DL
         1 000076   000206 236106                    LDQ     134,QL,PR0
         1 000077   077777 376007                    ANQ     32767,DL
         1 000100   200011 756100                    STQ     INDX,,AUTO

      213     2494    3               IF INDX>0 OR ERASEBUF=%YES#
PL6.E3A0      #002=ZIO$FLUSH File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:42   

   2494  1 000101   000114 605400 1                  TPNZ    s:2497
         1 000102   200003 471500                    LDP1    @ERASEBUF,,AUTO
         1 000103   000000 066500                    CMPB    filb='0'B
         1 000104   100000 000001                    BDSC    0,,PR1                   by=0,bit=0,n=1
         1 000105   000003 000022 2                  BDSC    3                        by=0,bit=0,n=18
         1 000106   000114 601000 1                  TNZ     s:2497
         1 000107   200005 236100                    LDQ     SLOT,,AUTO
         1 000110   000005 402007                    MPY     5,DL
         1 000111   000204 473506                    LDP3    132,QL,PR0
         1 000112   300000 430100                    FSZN    0,,PR3
         1 000113   000136 605000 1                  TPL     s:2506

      214     2495    3                  OR GLOBAL.BCB.BUF.AWS$(SLOT)->AWS.ATRIB.SHANY THEN
      215     2496    4               DO; /* IF PAGE IS IN ENQ LIST, OR OPTIONAL ERASE */

      216     2497    4                   GLOBAL.BCB.BUF.AWS$(SLOT)=ADDR(NIL);

   2497  1 000114   200005 236100                    LDQ     SLOT,,AUTO
         1 000115   000005 402007                    MPY     5,DL
         1 000116   000000 620006                    EAX0    0,QL
         1 000117   000000 236000 2                  LDQ     0
         1 000120   000204 756110                    STQ     132,X0,PR0

      217     2498    4                   IF INDX>0 THEN /* IF PAGE IS IN ENQ_LIST */

   2498  1 000121   200011 235100                    LDA     INDX,,AUTO
         1 000122   000136 604400 1                  TMOZ    s:2506

      218     2499    5                   DO; /* RESET BOTH WAY POINTERS TO 0 */

      219     2500    5                       ENQLIST$ = GLOBAL.ENQ.LIST.BASE$;

   2500  1 000123   001411 236100                    LDQ     777,,PR0
         1 000124   200007 756100                    STQ     ENQLIST$,,AUTO

      220     2501    5                       ENQLIST.BUFSLOT(INDX) = 0;
PL6.E3A0      #002=ZIO$FLUSH File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:43   

   2501  1 000125   000001 735000                    ALS     1
         1 000126   200007 471500                    LDP1    ENQLIST$,,AUTO
         1 000127   000004 236000 2                  LDQ     4
         1 000130   100000 356105                    ANSQ    0,AL,PR1

      221     2502    5                       GLOBAL.BCB.BUF.ENQINDX(SLOT)=0;

   2502  1 000131   200005 236100                    LDQ     SLOT,,AUTO
         1 000132   000005 402007                    MPY     5,DL
         1 000133   000000 620006                    EAX0    0,QL
         1 000134   000005 236000 2                  LDQ     5
         1 000135   000206 356110                    ANSQ    134,X0,PR0

      222     2503    5                       END;

      223     2504    4                   END;

      224     2505    3               END;

      225     2506    2           SLOT=GLOBAL.BCB.BUF.LINK(SLOT);

   2506  1 000136   200005 236100                    LDQ     SLOT,,AUTO
         1 000137   000005 402007                    MPY     5,DL
         1 000140   000205 236106                    LDQ     133,QL,PR0
         1 000141   000022 772000                    QRL     18
         1 000142   200005 756100                    STQ     SLOT,,AUTO

      226     2507    2           END;

   2507  1 000143   000007 601000 1                  TNZ     s:2477

      227     2508    1       IF ERROR~=0 THEN

   2508  1 000144   200004 235100                    LDA     ERROR,,AUTO
         1 000145   000147 600000 1                  TZE     s:2510

PL6.E3A0      #002=ZIO$FLUSH File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:44   
      228     2509    1           ALTRETURN;

   2509  1 000146   000000 702200 xent               TSX2  ! X66_AALT

      229     2510    1       RETURN;

   2510  1 000147   000000 702200 xent               TSX2  ! X66_ARET

      230     2511    1   ER_WRT: ERROR=ERR#IO#FLSH;

   2511  1 000150   303363 235007       ER_WRT       LDA     100083,DL
         1 000151   200004 755100                    STA     ERROR,,AUTO

      231     2512    1       GOTO CHKBSY;

   2512  1 000152   000055 710000 1                  TRA     CHKBSY

(unnamed)
 Sect OctLoc
   2     000   000000 006014   777777 577777   000001 000000   000000 000000    ................
   2     004   777000 777777   777777 700000                                    ........
      232     2513    1   END ZIO$FLUSH;
      233     2514        %EOD;

PL6.E3A0      #002=ZIO$FLUSH File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:45   
--  Include file information  --

   ZI_ERRORS_C.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   ZI$DBCB.:ZIC0TOU  is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIO$FLUSH.

   Procedure ZIO$FLUSH requires 107 words for executable code.
   Procedure ZIO$FLUSH requires 12 words of local(AUTO) storage.
PL6.E3A0      #002=ZIO$FLUSH File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:46   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=ZIO$FLUSH File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:47   
          MINI XREF LISTING

AWS.ATRIB.SHANY
      1174**DCL      2494>>IF
AWS$
      1164**DCL      1165--IMP-PTR
CHKBSY
      2489**LABEL    2512--GOTO
ENQLIST.BUFSLOT
       513**DCL      2501<<ASSIGN
ENQLIST$
       519**DCL       504--IMP-PTR  2500<<ASSIGN   2501>>ASSIGN
ERASEBUF
      2472**DCL        10--PROC     2494>>IF
ERROR
        13**DCL      2474<<ASSIGN   2508>>IF       2511<<ASSIGN
ER_WRT
      2511**LABEL    2488--CALLALT
FPT_WAIT
      1603**DCL      2490<>CALL
GLOBAL.ACTIVE.DBCB$
      1210**DCL      1211--REDEF
GLOBAL.ACTIVE.SSS$
      1206**DCL      1207--REDEF
GLOBAL.BCB.BUF.AWS$
      1319**DCL      2477>>IF       2494>>IF       2497<<ASSIGN
GLOBAL.BCB.BUF.ENQINDX
      1327**DCL      2493>>ASSIGN   2502<<ASSIGN
GLOBAL.BCB.BUF.LINK
      1320**DCL      2506>>ASSIGN
GLOBAL.BCB.BUF.LOCK
      1322**DCL      2479<<ASSIGN
GLOBAL.BCB.BUF.STATUS.BUSY
      1324**DCL      2480>>IF       2489>>DOWHILE
PL6.E3A0      #002=ZIO$FLUSH File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:48   
GLOBAL.BCB.BUF.STATUS.MODIFY
      1325**DCL      2480>>IF       2484<<ASSIGN
GLOBAL.BCB.TAIL
      1312**DCL      2475>>ASSIGN
GLOBAL.ENQ.LIST.BASE$
      1342**DCL      2500>>ASSIGN
GLOBAL.KEY
      1414**DCL      1417--REDEF
GLOBAL.PARAN.TRACE.MODE
      1289**DCL      1296--REDEF
GLOBAL.PENDING.FORGET
      1248**DCL      2482>>IF
GLOBAL.PRINTBUF.BUFFER
      1448**DCL      1449--REDEF    1450--REDEF    1451--REDEF
GLOBAL.PRINTBUF.ERR.V
      1453**DCL      1456--REDEF    1457--REDEF    1458--REDEF
GLOBAL.STATS.CURR.WRITES
      1365**DCL      2485<<ASSIGN   2485>>ASSIGN
GLOBAL$
      1508**DCL      1204--IMP-PTR  2475>>ASSIGN   2477>>IF       2479>>ASSIGN   2480>>IF       2480>>IF
      2482>>IF       2484>>ASSIGN   2485>>ASSIGN   2485>>ASSIGN   2489>>DOWHILE  2493>>ASSIGN   2494>>IF
      2497>>ASSIGN   2500>>ASSIGN   2502>>ASSIGN   2506>>ASSIGN
INDX
      2473**DCL      2493<<ASSIGN   2494>>IF       2498>>IF       2501>>ASSIGN
M$WAIT
      1578**DCL-ENT  2490--CALL
SLOT
        15**DCL      2475<<ASSIGN   2476>>DOWHILE  2477>>IF       2479>>ASSIGN   2480>>IF       2480>>IF
      2484>>ASSIGN   2488<>CALL     2489>>DOWHILE  2493>>ASSIGN   2494>>IF       2497>>ASSIGN   2502>>ASSIGN
      2506<<ASSIGN   2506>>ASSIGN
ZIO$DWRITE
        14**DCL-ENT  2488--CALL

PL6.E3A0      #003=ZIO$DBBCC File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:49   
      234        1        /*M* ZIO$DBBCC - determines if a particular buffer is busy.
      235        2                 INPUT: GLOBAL.PARAN.CALLPM0$.. buffer pointer
      236        3                 Return through %DBEXC
      237        4                   ERROR = 0 buffer is locked
      238        5                   ERROR = 1 buffer is unlocked
      239        6                 Calling procedure must reset/restore GLOBAL.RET.ERROR#  */
      240        7        /*T***********************************************************/
      241        8        /*T*                                                         */
      242        9        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      243       10        /*T*                                                         */
      244       11        /*T***********************************************************/
      245       12        ZIO$DBBCC: PROC ALTRET AVOID ($PR5, $PR6, $PR7);
      246       13        %INCLUDE ZI$GLOBAL;
      247      499         %GLOBALS;
      248      807         %BUFFERS;
      249      822        %INCLUDE CP_6;
      250      903        %INCLUDE CP_6_SUBS;
      251     1443        %INCLUDE ZI_ERRORS_C;
      252     1769    1   DCL SLOT UBIN (36);
      253     1770    1   DCL ERROR UBIN (36);
      254     1771         /* start procedure */
      255     1772    1       ERROR = 0;
      256     1773    1       SLOT = GLOBAL.BCB.TAIL;
      257     1774    2       DO WHILE (SLOT ~= 0);
      258     1775    2           IF GLOBAL.BCB.BUF.BUF$(SLOT) = GLOBAL.PARAN.CALLPM0$ AND
      259     1776    3              GLOBAL.BCB.BUF.LOCK(SLOT) > 0 THEN DO;
      260     1777                    %DBEXC;
      261     1781    3               END; /* must equal buf pointer and be busy */
      262     1782    2           SLOT = GLOBAL.BCB.BUF.LINK(SLOT);
      263     1783    2           END; /* list traversed */
      264     1784    1       ERROR = 1; /* Indicate that buffer is unlocked */
      265     1785            %DBEXC;
      266     1789    1   END ZIO$DBBCC;
      267     1790        %EOD;

PL6.E3A0      #003=ZIO$DBBCC File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:50   
--  Include file information  --

   ZI_ERRORS_C.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIO$DBBCC.

   Procedure ZIO$DBBCC requires 30 words for executable code.
   Procedure ZIO$DBBCC requires 6 words of local(AUTO) storage.

PL6.E3A0      #003=ZIO$DBBCC File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:51   

 Object Unit name= ZIO$DBBCC                                  File name= ZIM$BUFM.:ZIC0TOU
 UTS= SEP 05 '97 12:35:28.32 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Proc  even  none    30     36  ZIO$DBBCC

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      XStd       0  ZIO$DBBCC

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    GLOBAL$                               M$UC
PL6.E3A0      #003=ZIO$DBBCC File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:52   


      234        1        /*M* ZIO$DBBCC - determines if a particular buffer is busy.
      235        2                 INPUT: GLOBAL.PARAN.CALLPM0$.. buffer pointer
      236        3                 Return through %DBEXC
      237        4                   ERROR = 0 buffer is locked
      238        5                   ERROR = 1 buffer is unlocked
      239        6                 Calling procedure must reset/restore GLOBAL.RET.ERROR#  */
      240        7        /*T***********************************************************/
      241        8        /*T*                                                         */
      242        9        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      243       10        /*T*                                                         */
      244       11        /*T***********************************************************/
      245       12        ZIO$DBBCC: PROC ALTRET AVOID ($PR5, $PR6, $PR7);

     12  1 000000   000000 700200 xent  ZIO$DBBCC    TSX0  ! X66_AUTO_0
         1 000001   000006 000000                    ZERO    6,0

      246       13        %INCLUDE ZI$GLOBAL;
      247      499         %GLOBALS;
      248      807         %BUFFERS;
      249      822        %INCLUDE CP_6;
      250      903        %INCLUDE CP_6_SUBS;
      251     1443        %INCLUDE ZI_ERRORS_C;
      252     1769    1   DCL SLOT UBIN (36);
      253     1770    1   DCL ERROR UBIN (36);
      254     1771         /* start procedure */
      255     1772    1       ERROR = 0;

   1772  1 000002   200004 450100                    STZ     ERROR,,AUTO

      256     1773    1       SLOT = GLOBAL.BCB.TAIL;

   1773  1 000003   000000 470400 xsym               LDP0    GLOBAL$
         1 000004   000176 235100                    LDA     126,,PR0
         1 000005   200003 755100                    STA     SLOT,,AUTO

      257     1774    2       DO WHILE (SLOT ~= 0);
PL6.E3A0      #003=ZIO$DBBCC File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:53   

   1774  1 000006   000032 600000 1                  TZE     s:1784

      258     1775    2           IF GLOBAL.BCB.BUF.BUF$(SLOT) = GLOBAL.PARAN.CALLPM0$ AND

   1775  1 000007   000000 470400 xsym               LDP0    GLOBAL$
         1 000010   200003 236100                    LDQ     SLOT,,AUTO
         1 000011   000005 402007                    MPY     5,DL
         1 000012   000202 236106                    LDQ     130,QL,PR0
         1 000013   000026 116100                    CMPQ    22,,PR0
         1 000014   000024 601000 1                  TNZ     s:1782
         1 000015   200003 236100                    LDQ     SLOT,,AUTO
         1 000016   000005 402007                    MPY     5,DL
         1 000017   000206 220106                    LDX0    134,QL,PR0
         1 000020   000024 600000 1                  TZE     s:1782

      259     1776    3              GLOBAL.BCB.BUF.LOCK(SLOT) > 0 THEN DO;

      260     1777                    %DBEXC;

   1778  1 000021   200004 235100                    LDA     ERROR,,AUTO
         1 000022   000006 755100                    STA     6,,PR0

   1779  1 000023   000000 702200 xent               TSX2  ! X66_ARET

      261     1781    3               END; /* must equal buf pointer and be busy */
      262     1782    2           SLOT = GLOBAL.BCB.BUF.LINK(SLOT);

   1782  1 000024   200003 236100                    LDQ     SLOT,,AUTO
         1 000025   000005 402007                    MPY     5,DL
         1 000026   000205 236106                    LDQ     133,QL,PR0
         1 000027   000022 772000                    QRL     18
         1 000030   200003 756100                    STQ     SLOT,,AUTO

      263     1783    2           END; /* list traversed */

   1783  1 000031   000007 601000 1                  TNZ     s:1775
PL6.E3A0      #003=ZIO$DBBCC File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:54   

      264     1784    1       ERROR = 1; /* Indicate that buffer is unlocked */

   1784  1 000032   000001 235007                    LDA     1,DL
         1 000033   200004 755100                    STA     ERROR,,AUTO

      265     1785            %DBEXC;

   1786  1 000034   000006 755100                    STA     6,,PR0

   1787  1 000035   000000 702200 xent               TSX2  ! X66_ARET
      266     1789    1   END ZIO$DBBCC;
      267     1790        %EOD;

PL6.E3A0      #003=ZIO$DBBCC File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:55   
--  Include file information  --

   ZI_ERRORS_C.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIO$DBBCC.

   Procedure ZIO$DBBCC requires 30 words for executable code.
   Procedure ZIO$DBBCC requires 6 words of local(AUTO) storage.
PL6.E3A0      #003=ZIO$DBBCC File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:56   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=ZIO$DBBCC File=ZIM$BUFM.:ZIC0TSI                              FRI 09/05/97 12:35 Page:57   
          MINI XREF LISTING

ERROR
      1770**DCL      1772<<ASSIGN   1778>>ASSIGN   1784<<ASSIGN   1786>>ASSIGN
GLOBAL.ACTIVE.DBCB$
       506**DCL       507--REDEF
GLOBAL.ACTIVE.SSS$
       502**DCL       503--REDEF
GLOBAL.BCB.BUF.BUF$
       613**DCL      1775>>IF
GLOBAL.BCB.BUF.LINK
       616**DCL      1782>>ASSIGN
GLOBAL.BCB.BUF.LOCK
       618**DCL      1775>>IF
GLOBAL.BCB.TAIL
       608**DCL      1773>>ASSIGN
GLOBAL.KEY
       710**DCL       713--REDEF
GLOBAL.PARAN.CALLPM0$
       562**DCL      1775>>IF
GLOBAL.PARAN.TRACE.MODE
       585**DCL       592--REDEF
GLOBAL.PRINTBUF.BUFFER
       744**DCL       745--REDEF     746--REDEF     747--REDEF
GLOBAL.PRINTBUF.ERR.V
       749**DCL       752--REDEF     753--REDEF     754--REDEF
GLOBAL.RET.ERROR#
       520**DCL      1778<<ASSIGN   1786<<ASSIGN
GLOBAL$
       804**DCL       500--IMP-PTR  1773>>ASSIGN   1775>>IF       1775>>IF       1775>>IF       1778>>ASSIGN
      1782>>ASSIGN   1786>>ASSIGN
SLOT
      1769**DCL      1773<<ASSIGN   1774>>DOWHILE  1775>>IF       1775>>IF       1782<<ASSIGN   1782>>ASSIGN

PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:58   
      268        1        /*M* ZIO$LOCK - locks buffer in memory.          */
      269        2        /*T***********************************************************/
      270        3        /*T*                                                         */
      271        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      272        5        /*T*                                                         */
      273        6        /*T***********************************************************/
      274        7        ZIO$LOCK: PROC ALTRET
      275        8         /* USE($PR5 FOR GLOBAL$) */
      276        9               AVOID($PR5,$PR6,$PR7);
      277       10        %INCLUDE ZI$GLOBAL;
      278      496            %GLOBALS;
      279      804            %BUFFERS;
      280      819            %TRCE_SUBS;
      281      843            %ENQLIST;
      282      861        %INCLUDE ZI$DBCB;
      283     1503            %AWS;
      284     1543        %INCLUDE CP_6_SUBS;
      285     2083        %INCLUDE CP_6;
      286     2164            %FPT_ENQ(FPTN=FPT$ENQ,STCLASS=BASED);
      287     2182            %B$TCB;
      288     2185            %B$ALT;
      289     2193            %F$DCB;
      290     2250        %INCLUDE B_ERRORS_C;
      291     3377        %INCLUDE ZI_ERRORS_C;
      292     3703    1   DCL ZIM$TRACE ENTRY;
      293     3704    1   DCL ZIM$ENQMOD ENTRY ALTRET;
      294     3705    1   DCL ZIM$JCKSMT ENTRY(1);
      295     3706    1   DCL B$TCB$ SYMREF PTR;
      296     3707    1   DCL ERROR UBIN(36);
      297     3708    1   DCL INDX SBIN WORD ALIGNED;
      298     3709    1   DCL BUFNUM SBIN WORD ALIGNED;
      299     3710    1       CALL FINDBUF ALTRET(ALT);
      300     3711    1       IF GLOBAL.BCB.BUF.LOCK(BUFNUM)=LOCK#MAX THEN
      301     3712    1           GOTO ER_BM;
      302     3713    1       GLOBAL.BCB.BUF.LOCK(BUFNUM)=GLOBAL.BCB.BUF.LOCK(BUFNUM)+1;
      303     3714    1       RETURN;
      304     3715        %EJECT;
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:59   
      305     3716        /*M*     ZIO$UNLOCK - Unlocks buffers in memory */
      306     3717    1   ZIO$UNLOCK: ENTRY ALTRET;
      307     3718    1       CALL FINDBUF ALTRET(ALT);
      308     3719    1       IF GLOBAL.BCB.BUF.LOCK(BUFNUM)=0 THEN
      309     3720    1           GOTO ER_BM;
      310     3721    1       GLOBAL.BCB.BUF.LOCK(BUFNUM)=GLOBAL.BCB.BUF.LOCK(BUFNUM)-1;
      311     3722    1       RETURN;
      312     3723        %EJECT;
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:60   
      313     3724        /*M*     ZIO$MODIFY - Sets buffer modify flag in control block */
      314     3725    1   ZIO$MODIFY: ENTRY ALTRET;
      315     3726    1       CALL FINDBUF ALTRET(ALT);
      316     3727    1       AWS$=GLOBAL.BCB.BUF.AWS$(BUFNUM);
      317     3728    1       IF AWS.DDCB=0 THEN
      318     3729    1           GOTO ER_IUM;
      319     3730    1       IF AWS.ATRIB.FUN=%IN# THEN
      320     3731    1           GOTO ER_IUM;
      321     3732    2       IF NOT GLOBAL.BCB.BUF.STATUS.MODIFY(BUFNUM) THEN DO;
      322     3733        /*          Buffer has not been modified yet. */
      323     3734    2           GLOBAL.ENQ.LIST.INDX=GLOBAL.BCB.BUF.ENQINDX(BUFNUM);
      324     3735    3           IF GLOBAL.ENQ.LIST.INDX~=0 THEN DO;
      325     3736        /*              Under ENQ control. */
      326     3737    3               ENQLIST$=GLOBAL.ENQ.LIST.BASE$;
      327     3738    4               IF NOT ENQLIST.STATUS.MODIFY(GLOBAL.ENQ.LIST.INDX) THEN DO;
      328     3739        /*                  Page not ENQed exclusive yet. */
      329     3740    4                   GLOBAL.ENQ.VALUE = ENQLIST.VALUE(GLOBAL.ENQ.LIST.INDX);
      330     3741    4                   GLOBAL.ENQ.SHARE=%NONE#;
      331     3742    4                   CALL ZIM$ENQMOD ALTRET(ALT);
      332     3743    4                   END;
      333     3744    3               END;
      334     3745    3           DO INHIBIT;
      335     3746    3               GLOBAL.BCB.BUF.STATUS.MODIFY(BUFNUM)=%YES#;
      336     3747    3               END;
      337     3748    2           GLOBAL.STATS.CURR.WRITES=GLOBAL.STATS.CURR.WRITES+1;
      338     3749    2           IF GLOBAL.PARAN.TRACE.MODE~='0'B THEN
      339     3750    3           DO;
      340     3751    3               IF NOT AWS.ATRIB.CAC THEN
      341     3752    3                   GLOBAL.PARAN.TRACE.TYPE=TR#PMOD;
      342     3753    3               ELSE
      343     3754    3                   GLOBAL.PARAN.TRACE.TYPE=TR#PMODENQ;
      344     3755    3               GLOBAL.PARAN.TRACE.PDCB=AWS.DDCB;
      345     3756    3               GLOBAL.PARAN.TRACE.PNO=GLOBAL.BCB.BUF.PGNO(BUFNUM);
      346     3757    3               CALL ZIM$TRACE;
      347     3758    3               END;
      348     3759    2           IF AWS.ATRIB.TJRNL AND GLOBAL.BCB.BUF.PGNO(BUFNUM)~=0 AND
      349     3760    2              (AWS.FIPN=0 OR GLOBAL.BCB.BUF.PGNO(BUFNUM)<AWS.FIPN) THEN
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:61   
      350     3761    2               CALL ZIM$JCKSMT(BUFNUM);
      351     3762    2           END;
      352     3763    1       RETURN;
      353     3764        %EJECT;
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:62   
      354     3765    1   ER_IUM: ERROR=EXC#IUM;
      355     3766    1       GOTO ALT;
      356     3767    1   ER_BM: ERROR=ERR#BM#E02;
      357     3768    1   ALT: ;
      358     3769            %DBALT;
      359     3783        %EJECT;
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:63   
      360     3784        /*
      361     3785              EACH PAGE IN BUFFER HAS THE BUF SLOT NUMBER STORED AT THE
      362     3786              1ST WORD(PAGE STAMP).  AND MONITOR WILL RESET IT WHEN WRITES .
      363     3787        */
      364     3788    1   FINDBUF: PROC ALTRET;
      365     3789    2       BUFNUM=PINCRW(GLOBAL.PARAN.IO.BUF$,-3)->BLOCK.PSTAMP;
      366     3790    2       IF BUFNUM<=0 OR BUFNUM>GLOBAL.BCB.COUNT OR
      367     3791    2          GLOBAL.BCB.BUF.BUF$(BUFNUM)~=GLOBAL.PARAN.IO.BUF$ THEN
      368     3792    3       DO; /* INCONSISTANT OF POINTERS, ERROR THE JOB */
      369     3793    3           ERROR=ERR#BM#E02;
      370     3794                %DBALT; /* M$ERR THE JOB */
      371     3808    3           END;
      372     3809    2   END FINDBUF;
      373     3810    1   END ZIO$LOCK;
      374     3811        %EOD;

PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:64   
--  Include file information  --

   ZI_ERRORS_C.:ZIC0TOU  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   ZI$DBCB.:ZIC0TOU  is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIO$LOCK.

   Procedure ZIO$LOCK requires 179 words for executable code.
   Procedure ZIO$LOCK requires 12 words of local(AUTO) storage.

PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:65   

 Object Unit name= ZIO$LOCK                                   File name= ZIM$BUFM.:ZIC0TOU
 UTS= SEP 05 '97 12:35:33.72 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Proc  even  none   179    263  ZIO$LOCK
    2  RoData even  none     2      2  ZIO$LOCK

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      XStd       0  ZIO$LOCK
     1     15          yes     yes      XStd       0  ZIO$UNLOCK
     1     31          yes     yes      XStd       0  ZIO$MODIFY

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           XStd      0 ZIM$TRACE
         yes           XStd      1 ZIM$JCKSMT
         yes           XStd      0 ZIB$ERR
 yes     yes           XStd      0 ZIM$ENQMOD
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:66   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    GLOBAL$                               M$UC                                  B$TCB$
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:67   


      268        1        /*M* ZIO$LOCK - locks buffer in memory.          */
      269        2        /*T***********************************************************/
      270        3        /*T*                                                         */
      271        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      272        5        /*T*                                                         */
      273        6        /*T***********************************************************/
      274        7        ZIO$LOCK: PROC ALTRET

      7  1 000000   000000 700200 xent  ZIO$LOCK     TSX0  ! X66_AUTO_0
         1 000001   000014 000000                    ZERO    12,0

      275        8         /* USE($PR5 FOR GLOBAL$) */
      276        9               AVOID($PR5,$PR6,$PR7);
      277       10        %INCLUDE ZI$GLOBAL;
      278      496            %GLOBALS;
      279      804            %BUFFERS;
      280      819            %TRCE_SUBS;
      281      843            %ENQLIST;
      282      861        %INCLUDE ZI$DBCB;
      283     1503            %AWS;
      284     1543        %INCLUDE CP_6_SUBS;
      285     2083        %INCLUDE CP_6;
      286     2164            %FPT_ENQ(FPTN=FPT$ENQ,STCLASS=BASED);
      287     2182            %B$TCB;
      288     2185            %B$ALT;
      289     2193            %F$DCB;
      290     2250        %INCLUDE B_ERRORS_C;
      291     3377        %INCLUDE ZI_ERRORS_C;
      292     3703    1   DCL ZIM$TRACE ENTRY;
      293     3704    1   DCL ZIM$ENQMOD ENTRY ALTRET;
      294     3705    1   DCL ZIM$JCKSMT ENTRY(1);
      295     3706    1   DCL B$TCB$ SYMREF PTR;
      296     3707    1   DCL ERROR UBIN(36);
      297     3708    1   DCL INDX SBIN WORD ALIGNED;
      298     3709    1   DCL BUFNUM SBIN WORD ALIGNED;
      299     3710    1       CALL FINDBUF ALTRET(ALT);
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:68   

   3710  1 000002   000217 701000 1                  TSX1    FINDBUF
         1 000003   000176 702000 1                  TSX2    ALT

      300     3711    1       IF GLOBAL.BCB.BUF.LOCK(BUFNUM)=LOCK#MAX THEN

   3711  1 000004   200007 236100                    LDQ     BUFNUM,,AUTO
         1 000005   000005 402007                    MPY     5,DL
         1 000006   000000 470400 xsym               LDP0    GLOBAL$
         1 000007   000206 220106                    LDX0    134,QL,PR0
         1 000010   000007 100003                    CMPX0   7,DU
         1 000011   000174 600000 1                  TZE     ER_BM

      301     3712    1           GOTO ER_BM;
      302     3713    1       GLOBAL.BCB.BUF.LOCK(BUFNUM)=GLOBAL.BCB.BUF.LOCK(BUFNUM)+1;

   3713  1 000012   000001 621010                    EAX1    1,X0
         1 000013   000206 741106                    STX1    134,QL,PR0

      303     3714    1       RETURN;

   3714  1 000014   000000 702200 xent               TSX2  ! X66_ARET

      304     3715        %EJECT;
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:69   
      305     3716        /*M*     ZIO$UNLOCK - Unlocks buffers in memory */
      306     3717    1   ZIO$UNLOCK: ENTRY ALTRET;

   3717  1 000015   000000 700200 xent  ZIO$UNLOCK   TSX0  ! X66_AUTO_0
         1 000016   000014 000000                    ZERO    12,0

      307     3718    1       CALL FINDBUF ALTRET(ALT);

   3718  1 000017   000217 701000 1                  TSX1    FINDBUF
         1 000020   000176 702000 1                  TSX2    ALT

      308     3719    1       IF GLOBAL.BCB.BUF.LOCK(BUFNUM)=0 THEN

   3719  1 000021   200007 236100                    LDQ     BUFNUM,,AUTO
         1 000022   000005 402007                    MPY     5,DL
         1 000023   000000 470400 xsym               LDP0    GLOBAL$
         1 000024   000206 220106                    LDX0    134,QL,PR0
         1 000025   000174 600000 1                  TZE     ER_BM

      309     3720    1           GOTO ER_BM;
      310     3721    1       GLOBAL.BCB.BUF.LOCK(BUFNUM)=GLOBAL.BCB.BUF.LOCK(BUFNUM)-1;

   3721  1 000026   777777 621010                    EAX1    -1,X0
         1 000027   000206 741106                    STX1    134,QL,PR0

      311     3722    1       RETURN;

   3722  1 000030   000000 702200 xent               TSX2  ! X66_ARET

      312     3723        %EJECT;
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:70   
      313     3724        /*M*     ZIO$MODIFY - Sets buffer modify flag in control block */
      314     3725    1   ZIO$MODIFY: ENTRY ALTRET;

   3725  1 000031   000000 700200 xent  ZIO$MODIFY   TSX0  ! X66_AUTO_0
         1 000032   000014 000000                    ZERO    12,0

      315     3726    1       CALL FINDBUF ALTRET(ALT);

   3726  1 000033   000217 701000 1                  TSX1    FINDBUF
         1 000034   000176 702000 1                  TSX2    ALT

      316     3727    1       AWS$=GLOBAL.BCB.BUF.AWS$(BUFNUM);

   3727  1 000035   200007 236100                    LDQ     BUFNUM,,AUTO
         1 000036   000005 402007                    MPY     5,DL
         1 000037   000000 470400 xsym               LDP0    GLOBAL$
         1 000040   000204 236106                    LDQ     132,QL,PR0
         1 000041   200004 756100                    STQ     AWS$,,AUTO

      317     3728    1       IF AWS.DDCB=0 THEN

   3728  1 000042   200004 471500                    LDP1    AWS$,,AUTO
         1 000043   100006 220100                    LDX0    6,,PR1
         1 000044   000171 600000 1                  TZE     ER_IUM

      318     3729    1           GOTO ER_IUM;
      319     3730    1       IF AWS.ATRIB.FUN=%IN# THEN

   3730  1 000045   100000 236100                    LDQ     0,,PR1
         1 000046   000060 376003                    ANQ     48,DU
         1 000047   000040 116003                    CMPQ    32,DU
         1 000050   000171 600000 1                  TZE     ER_IUM

      320     3731    1           GOTO ER_IUM;
      321     3732    2       IF NOT GLOBAL.BCB.BUF.STATUS.MODIFY(BUFNUM) THEN DO;

   3732  1 000051   200007 236100                    LDQ     BUFNUM,,AUTO
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:71   
         1 000052   000005 402007                    MPY     5,DL
         1 000053   000206 236106                    LDQ     134,QL,PR0
         1 000054   200000 316007                    CANQ    65536,DL
         1 000055   000170 601000 1                  TNZ     s:3763

      322     3733        /*          Buffer has not been modified yet. */
      323     3734    2           GLOBAL.ENQ.LIST.INDX=GLOBAL.BCB.BUF.ENQINDX(BUFNUM);

   3734  1 000056   200007 236100                    LDQ     BUFNUM,,AUTO
         1 000057   000005 402007                    MPY     5,DL
         1 000060   000206 721106                    LXL1    134,QL,PR0
         1 000061   077777 361003                    ANX1    32767,DU
         1 000062   001412 741100                    STX1    778,,PR0

      324     3735    3           IF GLOBAL.ENQ.LIST.INDX~=0 THEN DO;

   3735  1 000063   000106 600000 1                  TZE     s:3746

      325     3736        /*              Under ENQ control. */
      326     3737    3               ENQLIST$=GLOBAL.ENQ.LIST.BASE$;

   3737  1 000064   001411 236100                    LDQ     777,,PR0
         1 000065   200003 756100                    STQ     ENQLIST$,,AUTO

      327     3738    4               IF NOT ENQLIST.STATUS.MODIFY(GLOBAL.ENQ.LIST.INDX) THEN DO;

   3738  1 000066   001412 220100                    LDX0    778,,PR0
         1 000067   001412 020100                    ADLX0   778,,PR0
         1 000070   200003 473500                    LDP3    ENQLIST$,,AUTO
         1 000071   300000 236110                    LDQ     0,X0,PR3
         1 000072   100000 316003                    CANQ    32768,DU
         1 000073   000106 601000 1                  TNZ     s:3746

      328     3739        /*                  Page not ENQed exclusive yet. */
      329     3740    4                   GLOBAL.ENQ.VALUE = ENQLIST.VALUE(GLOBAL.ENQ.LIST.INDX);

   3740  1 000074   000000 635010                    EAA     0,X0
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:72   
         1 000075   000020 771000                    ARL     16
         1 000076   000100 100505                    MLR     fill='000'O
         1 000077   300000 400006                    ADSC9   0,A,PR3                  cn=2,n=6
         1 000100   001407 400006                    ADSC9   775,,PR0                 cn=2,n=6

      330     3741    4                   GLOBAL.ENQ.SHARE=%NONE#;

   3741  1 000101   003000 236003                    LDQ     1536,DU
         1 000102   001407 552140                    STBQ    775,'40'O,PR0

      331     3742    4                   CALL ZIM$ENQMOD ALTRET(ALT);

   3742  1 000103   000000 631400 2                  EPPR1   0
         1 000104   000000 701000 xent               TSX1    ZIM$ENQMOD
         1 000105   000176 702000 1                  TSX2    ALT

      332     3743    4                   END;

      333     3744    3               END;

      334     3745    3           DO INHIBIT;

      335     3746    3               GLOBAL.BCB.BUF.STATUS.MODIFY(BUFNUM)=%YES#;

   3746  1 000106   200007 236300                    LDQ   ! BUFNUM,,AUTO
         1 000107   000005 402207                    MPY   ! 5,DL
         1 000110   000000 470600 xsym               LDP0  ! GLOBAL$
         1 000111   000000 620206                    EAX0  ! 0,QL
         1 000112   200000 236207                    LDQ   ! 65536,DL
         1 000113   000206 256310                    ORSQ  ! 134,X0,PR0

      336     3747    3               END;

      337     3748    2           GLOBAL.STATS.CURR.WRITES=GLOBAL.STATS.CURR.WRITES+1;

   3748  1 000114   001426 235100                    LDA     790,,PR0
         1 000115   000001 035007                    ADLA    1,DL
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:73   
         1 000116   001426 755100                    STA     790,,PR0

      338     3749    2           IF GLOBAL.PARAN.TRACE.MODE~='0'B THEN

   3749  1 000117   000061 235100                    LDA     49,,PR0
         1 000120   000143 600000 1                  TZE     s:3759

      339     3750    3           DO;

      340     3751    3               IF NOT AWS.ATRIB.CAC THEN

   3751  1 000121   200004 471500                    LDP1    AWS$,,AUTO
         1 000122   100000 236100                    LDQ     0,,PR1
         1 000123   000001 316003                    CANQ    1,DU
         1 000124   000130 601000 1                  TNZ     s:3754

      341     3752    3                   GLOBAL.PARAN.TRACE.TYPE=TR#PMOD;

   3752  1 000125   000004 220003                    LDX0    4,DU
         1 000126   000060 740100                    STX0    48,,PR0
         1 000127   000132 710000 1                  TRA     s:3755

      342     3753    3               ELSE
      343     3754    3                   GLOBAL.PARAN.TRACE.TYPE=TR#PMODENQ;

   3754  1 000130   000016 220003                    LDX0    14,DU
         1 000131   000060 740100                    STX0    48,,PR0

      344     3755    3               GLOBAL.PARAN.TRACE.PDCB=AWS.DDCB;

   3755  1 000132   100006 221100                    LDX1    6,,PR1
         1 000133   000055 441100                    SXL1    45,,PR0

      345     3756    3               GLOBAL.PARAN.TRACE.PNO=GLOBAL.BCB.BUF.PGNO(BUFNUM);

   3756  1 000134   200007 236100                    LDQ     BUFNUM,,AUTO
         1 000135   000005 402007                    MPY     5,DL
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:74   
         1 000136   000203 235106                    LDA     131,QL,PR0
         1 000137   000056 755100                    STA     46,,PR0

      346     3757    3               CALL ZIM$TRACE;

   3757  1 000140   000000 631400 2                  EPPR1   0
         1 000141   000000 701000 xent               TSX1    ZIM$TRACE
         1 000142   000000 011000                    NOP     0

      347     3758    3               END;

      348     3759    2           IF AWS.ATRIB.TJRNL AND GLOBAL.BCB.BUF.PGNO(BUFNUM)~=0 AND

   3759  1 000143   200004 470500                    LDP0    AWS$,,AUTO
         1 000144   000000 236100                    LDQ     0,,PR0
         1 000145   020000 316003                    CANQ    8192,DU
         1 000146   000170 600000 1                  TZE     s:3763
         1 000147   200007 236100                    LDQ     BUFNUM,,AUTO
         1 000150   000005 402007                    MPY     5,DL
         1 000151   000000 471400 xsym               LDP1    GLOBAL$
         1 000152   100203 235106                    LDA     131,QL,PR1
         1 000153   000170 600000 1                  TZE     s:3763
         1 000154   000005 235100                    LDA     5,,PR0
         1 000155   000162 600000 1                  TZE     s:3761
         1 000156   100203 236106                    LDQ     131,QL,PR1
         1 000157   000170 604000 1                  TMI     s:3763
         1 000160   000005 116100                    CMPQ    5,,PR0
         1 000161   000170 605000 1                  TPL     s:3763

      349     3760    2              (AWS.FIPN=0 OR GLOBAL.BCB.BUF.PGNO(BUFNUM)<AWS.FIPN) THEN
      350     3761    2               CALL ZIM$JCKSMT(BUFNUM);

   3761  1 000162   200007 633500                    EPPR3   BUFNUM,,AUTO
         1 000163   200012 453500                    STP3    BUFNUM+3,,AUTO
         1 000164   200012 630500                    EPPR0   BUFNUM+3,,AUTO
         1 000165   000001 631400 2                  EPPR1   1
         1 000166   000000 701000 xent               TSX1    ZIM$JCKSMT
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:75   
         1 000167   000000 011000                    NOP     0

      351     3762    2           END;

      352     3763    1       RETURN;

   3763  1 000170   000000 702200 xent               TSX2  ! X66_ARET

      353     3764        %EJECT;
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:76   
      354     3765    1   ER_IUM: ERROR=EXC#IUM;

   3765  1 000171   021760 235007       ER_IUM       LDA     9200,DL
         1 000172   200005 755100                    STA     ERROR,,AUTO

      355     3766    1       GOTO ALT;

   3766  1 000173   000176 710000 1                  TRA     ALT

      356     3767    1   ER_BM: ERROR=ERR#BM#E02;

   3767  1 000174   303331 235007       ER_BM        LDA     100057,DL
         1 000175   200005 755100                    STA     ERROR,,AUTO

   3760  1 000176                       ALT          null
      357     3768    1   ALT: ;
      358     3769            %DBALT;

   3770  1 000176   000000 470400 xsym               LDP0    GLOBAL$
         1 000177   000006 235100                    LDA     6,,PR0
         1 000200   000207 601000 1                  TNZ     s:3778

   3772  1 000201   000010 450100                    STZ     8,,PR0

   3773  1 000202   000012 450100                    STZ     10,,PR0

   3774  1 000203   000013 450100                    STZ     11,,PR0

   3775  1 000204   000011 450100                    STZ     9,,PR0

   3776  1 000205   200005 236100                    LDQ     ERROR,,AUTO
         1 000206   000006 756100                    STQ     6,,PR0

   3778  1 000207   000006 235100                    LDA     6,,PR0
         1 000210   303240 115007                    CMPA    100000,DL
         1 000211   000213 603000 1                  TRC     s:3781

PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:77   
   3779  1 000212   000000 702200 xent               TSX2  ! X66_AALT

   3781  1 000213   000000 631400 2                  EPPR1   0
         1 000214   000000 701000 xent               TSX1    ZIB$ERR
         1 000215   000000 011000                    NOP     0
         1 000216   000262 710000 1                  TRA     s:3810

      359     3783        %EJECT;
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:78   
      360     3784        /*
      361     3785              EACH PAGE IN BUFFER HAS THE BUF SLOT NUMBER STORED AT THE
      362     3786              1ST WORD(PAGE STAMP).  AND MONITOR WILL RESET IT WHEN WRITES .
      363     3787        */
      364     3788    1   FINDBUF: PROC ALTRET;

   3788  1 000217   200010 741300       FINDBUF      STX1  ! BUFNUM+1,,AUTO

      365     3789    2       BUFNUM=PINCRW(GLOBAL.PARAN.IO.BUF$,-3)->BLOCK.PSTAMP;

   3789  1 000220   000000 470400 xsym               LDP0    GLOBAL$
         1 000221   000022 471500                    LDP1    18,,PR0
         1 000222   177775 235100                    LDA     -3,,PR1
         1 000223   200007 755100                    STA     BUFNUM,,AUTO

      366     3790    2       IF BUFNUM<=0 OR BUFNUM>GLOBAL.BCB.COUNT OR

   3790  1 000224   000236 604400 1                  TMOZ    s:3793
         1 000225   000177 236100                    LDQ     127,,PR0
         1 000226   000231 604000 1                  TMI     s:3790+5
         1 000227   200007 116100                    CMPQ    BUFNUM,,AUTO
         1 000230   000236 604000 1                  TMI     s:3793
         1 000231   200007 236100                    LDQ     BUFNUM,,AUTO
         1 000232   000005 402007                    MPY     5,DL
         1 000233   000202 236106                    LDQ     130,QL,PR0
         1 000234   000022 116100                    CMPQ    18,,PR0
         1 000235   000260 600000 1                  TZE     s:3809

      367     3791    2          GLOBAL.BCB.BUF.BUF$(BUFNUM)~=GLOBAL.PARAN.IO.BUF$ THEN
      368     3792    3       DO; /* INCONSISTANT OF POINTERS, ERROR THE JOB */

      369     3793    3           ERROR=ERR#BM#E02;

   3793  1 000236   303331 235007                    LDA     100057,DL
         1 000237   200005 755100                    STA     ERROR,,AUTO

      370     3794                %DBALT; /* M$ERR THE JOB */
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:79   

   3795  1 000240   000006 235100                    LDA     6,,PR0
         1 000241   000250 601000 1                  TNZ     s:3803

   3797  1 000242   000010 450100                    STZ     8,,PR0

   3798  1 000243   000012 450100                    STZ     10,,PR0

   3799  1 000244   000013 450100                    STZ     11,,PR0

   3800  1 000245   000011 450100                    STZ     9,,PR0

   3801  1 000246   200005 236100                    LDQ     ERROR,,AUTO
         1 000247   000006 756100                    STQ     6,,PR0

   3803  1 000250   000006 235100                    LDA     6,,PR0
         1 000251   303240 115007                    CMPA    100000,DL
         1 000252   000255 603000 1                  TRC     s:3806

   3804  1 000253   200010 221300                    LDX1  ! BUFNUM+1,,AUTO
         1 000254   000000 702211                    TSX2  ! 0,X1

   3806  1 000255   000000 631400 2                  EPPR1   0
         1 000256   000000 701000 xent               TSX1    ZIB$ERR
         1 000257   000000 011000                    NOP     0

      371     3808    3           END;

      372     3809    2   END FINDBUF;

   3809  1 000260   200010 221300                    LDX1  ! BUFNUM+1,,AUTO
         1 000261   000001 702211                    TSX2  ! 1,X1

      373     3810    1   END ZIO$LOCK;

   3810  1 000262   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:80   
(unnamed)
 Sect OctLoc
   2     000   000000 000000   000001 000000                                    ........
      374     3811        %EOD;

PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:81   
--  Include file information  --

   ZI_ERRORS_C.:ZIC0TOU  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   ZI$DBCB.:ZIC0TOU  is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIO$LOCK.

   Procedure ZIO$LOCK requires 179 words for executable code.
   Procedure ZIO$LOCK requires 12 words of local(AUTO) storage.
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:82   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:83   
          MINI XREF LISTING

ALT
      3760**LABEL    3710--CALLALT  3718--CALLALT  3726--CALLALT  3742--CALLALT  3766--GOTO
AWS.ATRIB.CAC
      1522**DCL      3751>>IF
AWS.ATRIB.FUN
      1518**DCL      3730>>IF
AWS.ATRIB.TJRNL
      1511**DCL      3759>>IF
AWS.DDCB
      1530**DCL      3728>>IF       3755>>ASSIGN
AWS.FIPN
      1529**DCL      3759>>IF       3759>>IF
AWS$
      1504**DCL      1505--IMP-PTR  3727<<ASSIGN   3728>>IF       3730>>IF       3751>>IF       3755>>ASSIGN
      3759>>IF       3759>>IF       3759>>IF
B$ALT.CODE
      2187**DCL      2187--REDEF    2188--REDEF    2188--REDEF
B$ALT.ERR.ERR#
      2189**DCL      2189--REDEF
B$ALT.EVID
      2188**DCL      2188--REDEF    2188--REDEF
BLOCK.PSTAMP
       809**DCL      3789>>ASSIGN
BUFNUM
      3709**DCL      3711>>IF       3713>>ASSIGN   3713>>ASSIGN   3719>>IF       3721>>ASSIGN   3721>>ASSIGN
      3727>>ASSIGN   3732>>IF       3734>>ASSIGN   3746>>ASSIGN   3756>>ASSIGN   3759>>IF       3759>>IF
      3761<>CALL     3789<<ASSIGN   3790>>IF       3790>>IF       3790>>IF
ENQLIST.STATUS.MODIFY
       850**DCL      3738>>IF
ENQLIST.VALUE
       855**DCL      3740>>ASSIGN
ENQLIST$
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:84   
       859**DCL       844--IMP-PTR  3737<<ASSIGN   3738>>IF       3740>>ASSIGN
ERROR
      3707**DCL      3765<<ASSIGN   3767<<ASSIGN   3776>>ASSIGN   3793<<ASSIGN   3801>>ASSIGN
ER_BM
      3767**LABEL    3712--GOTO     3720--GOTO
ER_IUM
      3765**LABEL    3729--GOTO     3731--GOTO
F$DCB.ACTPOS
      2226**DCL      2226--REDEF
F$DCB.ARS#
      2200**DCL      2200--REDEF
F$DCB.ATTR
      2219**DCL      2220--REDEF
F$DCB.BORROW
      2234**DCL      2234--REDEF    2234--REDEF    2234--REDEF
F$DCB.DCBNAME.L
      2248**DCL      2248--IMP-SIZ
F$DCB.EOMCHAR#
      2204**DCL      2204--REDEF
F$DCB.FLDID
      2229**DCL      2229--REDEF
F$DCB.FORM$
      2223**DCL      2223--REDEF
F$DCB.FSECT
      2239**DCL      2239--REDEF
F$DCB.FSN#
      2216**DCL      2216--REDEF    2216--REDEF    2217--REDEF
F$DCB.HEADER$
      2222**DCL      2222--REDEF
F$DCB.IXTNSIZE#
      2220**DCL      2220--REDEF
F$DCB.LASTSTA$
      2209**DCL      2209--REDEF
F$DCB.LVL
      2235**DCL      2235--REDEF
F$DCB.NAME#.C
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:85   
      2210**DCL      2210--REDEF
F$DCB.NOEOF
      2232**DCL      2232--REDEF
F$DCB.NRECS#
      2221**DCL      2221--REDEF
F$DCB.NRECX
      2240**DCL      2240--REDEF
F$DCB.OHDR
      2232**DCL      2232--REDEF
F$DCB.ORG#
      2215**DCL      2215--REDEF
F$DCB.PRECNO
      2238**DCL      2238--REDEF
F$DCB.RCSZ
      2244**DCL      2244--REDEF
F$DCB.RES#
      2211**DCL      2211--REDEF
F$DCB.SETX
      2223**DCL      2223--REDEF
F$DCB.TAB$
      2223**DCL      2223--REDEF
F$DCB.TDA
      2237**DCL      2238--REDEF
F$DCB.WSN#
      2211**DCL      2211--REDEF
FINDBUF
      3788**PROC     3710--CALL     3718--CALL     3726--CALL
GLOBAL.ACTIVE.DBCB$
       503**DCL       504--REDEF
GLOBAL.ACTIVE.SSS$
       499**DCL       500--REDEF
GLOBAL.BCB.BUF.AWS$
       612**DCL      3727>>ASSIGN
GLOBAL.BCB.BUF.BUF$
       610**DCL      3790>>IF
GLOBAL.BCB.BUF.ENQINDX
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:86   
       620**DCL      3734>>ASSIGN
GLOBAL.BCB.BUF.LOCK
       615**DCL      3711>>IF       3713<<ASSIGN   3713>>ASSIGN   3719>>IF       3721<<ASSIGN   3721>>ASSIGN
GLOBAL.BCB.BUF.PGNO
       611**DCL      3756>>ASSIGN   3759>>IF       3759>>IF
GLOBAL.BCB.BUF.STATUS.MODIFY
       618**DCL      3732>>IF       3746<<ASSIGN
GLOBAL.BCB.COUNT
       606**DCL      3790>>IF
GLOBAL.ENQ.LIST.BASE$
       635**DCL      3737>>ASSIGN
GLOBAL.ENQ.LIST.INDX
       637**DCL      3734<<ASSIGN   3735>>IF       3738>>IF       3740>>ASSIGN
GLOBAL.ENQ.SHARE
       623**DCL      3741<<ASSIGN
GLOBAL.ENQ.VALUE
       628**DCL      3740<<ASSIGN
GLOBAL.KEY
       707**DCL       710--REDEF
GLOBAL.PARAN.IO.BUF$
       548**DCL      3789>>ASSIGN   3790>>IF
GLOBAL.PARAN.TRACE.MODE
       582**DCL       589--REDEF    3749>>IF
GLOBAL.PARAN.TRACE.PDCB
       577**DCL      3755<<ASSIGN
GLOBAL.PARAN.TRACE.PNO
       578**DCL      3756<<ASSIGN
GLOBAL.PARAN.TRACE.TYPE
       580**DCL      3752<<ASSIGN   3754<<ASSIGN
GLOBAL.PRINTBUF.BUFFER
       741**DCL       742--REDEF     743--REDEF     744--REDEF
GLOBAL.PRINTBUF.ERR.V
       746**DCL       749--REDEF     750--REDEF     751--REDEF
GLOBAL.RET.AC#
       519**DCL      3772<<ASSIGN   3797<<ASSIGN
GLOBAL.RET.ERROR#
PL6.E3A0      #004=ZIO$LOCK File=ZIM$BUFM.:ZIC0TSI                               FRI 09/05/97 12:35 Page:87   
       517**DCL      3770>>IF       3776<<ASSIGN   3778>>IF       3795>>IF       3801<<ASSIGN   3803>>IF
GLOBAL.RET.FR#
       520**DCL      3775<<ASSIGN   3800<<ASSIGN
GLOBAL.RET.RC#
       522**DCL      3774<<ASSIGN   3799<<ASSIGN
GLOBAL.RET.SC#
       521**DCL      3773<<ASSIGN   3798<<ASSIGN
GLOBAL.STATS.CURR.WRITES
       658**DCL      3748<<ASSIGN   3748>>ASSIGN
GLOBAL$
       801**DCL       497--IMP-PTR  3711>>IF       3713>>ASSIGN   3713>>ASSIGN   3719>>IF       3721>>ASSIGN
      3721>>ASSIGN   3727>>ASSIGN   3732>>IF       3734>>ASSIGN   3734>>ASSIGN   3735>>IF       3737>>ASSIGN
      3738>>IF       3740>>ASSIGN   3740>>ASSIGN   3741>>ASSIGN   3746>>ASSIGN   3748>>ASSIGN   3748>>ASSIGN
      3749>>IF       3752>>ASSIGN   3754>>ASSIGN   3755>>ASSIGN   3756>>ASSIGN   3756>>ASSIGN   3759>>IF
      3759>>IF       3770>>IF       3772>>ASSIGN   3773>>ASSIGN   3774>>ASSIGN   3775>>ASSIGN   3776>>ASSIGN
      3778>>IF       3789>>ASSIGN   3790>>IF       3790>>IF       3790>>IF       3795>>IF       3797>>ASSIGN
      3798>>ASSIGN   3799>>ASSIGN   3800>>ASSIGN   3801>>ASSIGN   3803>>IF
ZIB$ERR
       802**DCL-ENT  3781--CALL     3806--CALL
ZIM$ENQMOD
      3704**DCL-ENT  3742--CALL
ZIM$JCKSMT
      3705**DCL-ENT  3761--CALL
ZIM$TRACE
      3703**DCL-ENT  3757--CALL

PL6.E3A0      #005=ZIM$EADDBUF File=ZIM$BUFM.:ZIC0TSI                            FRI 09/05/97 12:35 Page:88   
      375        1        /*T***********************************************************/
      376        2        /*T*                                                         */
      377        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      378        4        /*T*                                                         */
      379        5        /*T***********************************************************/
      380        6        /*F*
      381        7        NAME: ZIM$EADDBUF
      382        8        PURPOSE: adds user requested pages to the buffer pool
      383        9        DESCRIPTION:
      384       10            The resulting # of buffers in the pool is returned in
      385       11            parameter 2. Each buffer is 1024 words.
      386       12        */
      387       13        ZIM$EADDBUF: PROC ALTRET
      388       14         /* USE($PR5 FOR GLOBAL$) */
      389       15               AVOID($PR5,$PR6,$PR7);
      390       16        %INCLUDE ZI$GLOBAL;
      391      502            %GLOBALS;
      392      810            %BUFFERS;
      393      825    1   DCL PS0$ PTR SYMREF;
      394      826    1   DCL PS1$ PTR SYMREF;
      395      827    1   DCL BUFREQ BASED(PS0$) SBIN(36); /* Requested buffers */
      396      828    1   DCL BUFTOT BASED(PS1$) SBIN(36); /* Number obtained */
      397      829    1   DCL ZIO$GETSEG ENTRY (3) ALTRET;
      398      830    1   DCL ZIO$ADDBUF ENTRY(1);
      399      831    1   DCL ZIB$SEGSIZE ENTRY(2);
      400      832    1   DCL ZIO$FLUSH ENTRY(1) ALTRET;
      401      833    1   DCL ZIO$FREESEG ENTRY(2);
      402      834    1   DCL ZIM$MOVE_ENQLIST ENTRY(1);
      403      835        %SUB BUF#MIN=6;
      404      836    1   DCL NSIZE UBIN(36);
      405      837    1   DCL WANT SBIN(36);
      406      838    1   DCL LESS SBIN(36);
      407      839    1   DCL OLDSIZE UBIN(36);
      408      840    1       CALL ZIB$SEGSIZE(GLOBAL$,OLDSIZE);
      409      841    1       IF BUFREQ<BUF#MAX THEN
      410      842    1           WANT=BUFREQ-GLOBAL.BCB.COUNT;
      411      843    1       ELSE
PL6.E3A0      #005=ZIM$EADDBUF File=ZIM$BUFM.:ZIC0TSI                            FRI 09/05/97 12:35 Page:89   
      412      844    1           WANT=BUF#MAX-GLOBAL.BCB.COUNT;
      413      845    1       IF WANT<0 THEN /* REQ TO FREE SOME BUFFERS */
      414      846    2       DO;
      415      847    2           IF BUFREQ < BUF#MIN THEN
      416      848    2               WANT=BUF#MIN-GLOBAL.BCB.COUNT;
      417      849    2           IF WANT<0 THEN
      418      850    3           DO;
      419      851    3               CALL ZIO$FLUSH ('1'B) ALTRET(ALT);
      420      852         /* As the num buffers decreases
      421      853            the start loc of the queue
      422      854            decreases */
      423      855    3               LESS = GLOBAL.BCB.COUNT + WANT;
      424      856    3               GLOBAL.BCB.COUNT = 0;
      425      857    3               GLOBAL.BCB.TAIL = 0;
      426      858    3               GLOBAL.BCB.HEAD = 1;
      427      859    3               CALL ZIO$ADDBUF(LESS);
      428      860         /* ZIO$ADDBUF reduces by completely
      429      861            rebuilding */
      430      862    3               CALL ZIM$MOVE_ENQLIST(WANT);
      431      863    3               END;
      432      864    2           END; /* want less */
      433      865    2       ELSE DO;
      434      866    2           CALL ZIO$GETSEG (GLOBAL$, 1024 * WANT) ALTRET (ER_GETSEG);
      435      867    2           CALL ZIO$ADDBUF (WANT);
      436      868         /* As num buffers increase the
      437      869            start loc of the queue
      438      870            increases */
      439      871    2           CALL ZIM$MOVE_ENQLIST (WANT);
      440      872    2           END; /* want more */
      441      873    1       BUFTOT = GLOBAL.BCB.COUNT;
      442      874    1       RETURN;
      443      875    1   ALT: ALTRETURN;
      444      876    1   ER_GETSEG:
      445      877    1       CALL ZIB$SEGSIZE(GLOBAL$, NSIZE);
      446      878    1       WANT = (NSIZE - OLDSIZE)/1024;
      447      879    2       IF WANT ~= 0 THEN DO;
      448      880    2           CALL ZIO$ADDBUF (WANT);
PL6.E3A0      #005=ZIM$EADDBUF File=ZIM$BUFM.:ZIC0TSI                            FRI 09/05/97 12:35 Page:90   
      449      881    2           CALL ZIM$MOVE_ENQLIST (WANT);
      450      882    2           END;
      451      883    1       BUFTOT = GLOBAL.BCB.COUNT;
      452      884    1       RETURN;
      453      885    1   END ZIM$EADDBUF;
      454      886        %EOD;

PL6.E3A0      #005=ZIM$EADDBUF File=ZIM$BUFM.:ZIC0TSI                            FRI 09/05/97 12:35 Page:91   
--  Include file information  --

   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure ZIM$EADDBUF.

   Procedure ZIM$EADDBUF requires 119 words for executable code.
   Procedure ZIM$EADDBUF requires 12 words of local(AUTO) storage.

PL6.E3A0      #005=ZIM$EADDBUF File=ZIM$BUFM.:ZIC0TSI                            FRI 09/05/97 12:35 Page:92   

 Object Unit name= ZIM$EADDBUF                                File name= ZIM$BUFM.:ZIC0TOU
 UTS= SEP 05 '97 12:35:45.36 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none   119    167  ZIM$EADDBUF
    1  RoData even  none     7      7  ZIM$EADDBUF

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      XStd       0  ZIM$EADDBUF

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           XStd      2 ZIB$SEGSIZE
 yes     yes           XStd      1 ZIO$FLUSH
         yes           XStd      1 ZIO$ADDBUF
         yes           XStd      1 ZIM$MOVE_ENQLIST
 yes     yes           XStd      3 ZIO$GETSEG
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #005=ZIM$EADDBUF File=ZIM$BUFM.:ZIC0TSI                            FRI 09/05/97 12:35 Page:93   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    GLOBAL$                               PS0$                                  PS1$

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID
PL6.E3A0      #005=ZIM$EADDBUF File=ZIM$BUFM.:ZIC0TSI                            FRI 09/05/97 12:35 Page:94   


      375        1        /*T***********************************************************/
      376        2        /*T*                                                         */
      377        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      378        4        /*T*                                                         */
      379        5        /*T***********************************************************/
      380        6        /*F*
      381        7        NAME: ZIM$EADDBUF
      382        8        PURPOSE: adds user requested pages to the buffer pool
      383        9        DESCRIPTION:
      384       10            The resulting # of buffers in the pool is returned in
      385       11            parameter 2. Each buffer is 1024 words.
      386       12        */
      387       13        ZIM$EADDBUF: PROC ALTRET

     13  0 000000   000000 700200 xent  ZIM$EADDBUF  TSX0  ! X66_AUTO_0
         0 000001   000014 000000                    ZERO    12,0

      388       14         /* USE($PR5 FOR GLOBAL$) */
      389       15               AVOID($PR5,$PR6,$PR7);
      390       16        %INCLUDE ZI$GLOBAL;
      391      502            %GLOBALS;
      392      810            %BUFFERS;
      393      825    1   DCL PS0$ PTR SYMREF;
      394      826    1   DCL PS1$ PTR SYMREF;
      395      827    1   DCL BUFREQ BASED(PS0$) SBIN(36); /* Requested buffers */
      396      828    1   DCL BUFTOT BASED(PS1$) SBIN(36); /* Number obtained */
      397      829    1   DCL ZIO$GETSEG ENTRY (3) ALTRET;
      398      830    1   DCL ZIO$ADDBUF ENTRY(1);
      399      831    1   DCL ZIB$SEGSIZE ENTRY(2);
      400      832    1   DCL ZIO$FLUSH ENTRY(1) ALTRET;
      401      833    1   DCL ZIO$FREESEG ENTRY(2);
      402      834    1   DCL ZIM$MOVE_ENQLIST ENTRY(1);
      403      835        %SUB BUF#MIN=6;
      404      836    1   DCL NSIZE UBIN(36);
      405      837    1   DCL WANT SBIN(36);
      406      838    1   DCL LESS SBIN(36);
PL6.E3A0      #005=ZIM$EADDBUF File=ZIM$BUFM.:ZIC0TSI                            FRI 09/05/97 12:35 Page:95   
      407      839    1   DCL OLDSIZE UBIN(36);
      408      840    1       CALL ZIB$SEGSIZE(GLOBAL$,OLDSIZE);

    840  0 000002   200006 630500                    EPPR0   OLDSIZE,,AUTO
         0 000003   200011 450500                    STP0    OLDSIZE+3,,AUTO
         0 000004   000001 236000 1                  LDQ     1
         0 000005   200010 756100                    STQ     OLDSIZE+2,,AUTO
         0 000006   200010 630500                    EPPR0   OLDSIZE+2,,AUTO
         0 000007   000000 631400 1                  EPPR1   0
         0 000010   000000 701000 xent               TSX1    ZIB$SEGSIZE
         0 000011   000000 011000                    NOP     0

      409      841    1       IF BUFREQ<BUF#MAX THEN

    841  0 000012   000000 470400 xsym               LDP0    PS0$
         0 000013   000000 235100                    LDA     0,,PR0
         0 000014   000200 115007                    CMPA    128,DL
         0 000015   000023 605000 0                  TPL     s:844

      410      842    1           WANT=BUFREQ-GLOBAL.BCB.COUNT;

    842  0 000016   000000 471400 xsym               LDP1    GLOBAL$
         0 000017   000000 236100                    LDQ     0,,PR0
         0 000020   100177 136100                    SBLQ    127,,PR1
         0 000021   200004 756100                    STQ     WANT,,AUTO
         0 000022   000030 710000 0                  TRA     s:845

      411      843    1       ELSE
      412      844    1           WANT=BUF#MAX-GLOBAL.BCB.COUNT;

    844  0 000023   000000 471400 xsym               LDP1    GLOBAL$
         0 000024   100177 235100                    LDA     127,,PR1
         0 000025   000003 675000 1                  ERA     3
         0 000026   000201 035007                    ADLA    129,DL
         0 000027   200004 755100                    STA     WANT,,AUTO

      413      845    1       IF WANT<0 THEN /* REQ TO FREE SOME BUFFERS */
PL6.E3A0      #005=ZIM$EADDBUF File=ZIM$BUFM.:ZIC0TSI                            FRI 09/05/97 12:35 Page:96   

    845  0 000030   200004 235100                    LDA     WANT,,AUTO
         0 000031   000074 605000 0                  TPL     s:866

      414      846    2       DO;

      415      847    2           IF BUFREQ < BUF#MIN THEN

    847  0 000032   000000 235100                    LDA     0,,PR0
         0 000033   000006 115007                    CMPA    6,DL
         0 000034   000041 605000 0                  TPL     s:849

      416      848    2               WANT=BUF#MIN-GLOBAL.BCB.COUNT;

    848  0 000035   100177 235100                    LDA     127,,PR1
         0 000036   000003 675000 1                  ERA     3
         0 000037   000007 035007                    ADLA    7,DL
         0 000040   200004 755100                    STA     WANT,,AUTO

      417      849    2           IF WANT<0 THEN

    849  0 000041   200004 235100                    LDA     WANT,,AUTO
         0 000042   000122 605000 0                  TPL     s:873

      418      850    3           DO;

      419      851    3               CALL ZIO$FLUSH ('1'B) ALTRET(ALT);

    851  0 000043   000006 630400 1                  EPPR0   6
         0 000044   000004 631400 1                  EPPR1   4
         0 000045   000000 701000 xent               TSX1    ZIO$FLUSH
         0 000046   000127 702000 0                  TSX2    ALT

      420      852         /* As the num buffers decreases
      421      853            the start loc of the queue
      422      854            decreases */
      423      855    3               LESS = GLOBAL.BCB.COUNT + WANT;
PL6.E3A0      #005=ZIM$EADDBUF File=ZIM$BUFM.:ZIC0TSI                            FRI 09/05/97 12:35 Page:97   

    855  0 000047   000000 470400 xsym               LDP0    GLOBAL$
         0 000050   000177 236100                    LDQ     127,,PR0
         0 000051   200004 036100                    ADLQ    WANT,,AUTO
         0 000052   200005 756100                    STQ     LESS,,AUTO

      424      856    3               GLOBAL.BCB.COUNT = 0;

    856  0 000053   000177 450100                    STZ     127,,PR0

      425      857    3               GLOBAL.BCB.TAIL = 0;

    857  0 000054   000176 450100                    STZ     126,,PR0

      426      858    3               GLOBAL.BCB.HEAD = 1;

    858  0 000055   000001 235007                    LDA     1,DL
         0 000056   000175 755100                    STA     125,,PR0

      427      859    3               CALL ZIO$ADDBUF(LESS);

    859  0 000057   200005 631500                    EPPR1   LESS,,AUTO
         0 000060   200010 451500                    STP1    OLDSIZE+2,,AUTO
         0 000061   200010 630500                    EPPR0   OLDSIZE+2,,AUTO
         0 000062   000004 631400 1                  EPPR1   4
         0 000063   000000 701000 xent               TSX1    ZIO$ADDBUF
         0 000064   000000 011000                    NOP     0

      428      860         /* ZIO$ADDBUF reduces by completely
      429      861            rebuilding */
      430      862    3               CALL ZIM$MOVE_ENQLIST(WANT);

    862  0 000065   200004 630500                    EPPR0   WANT,,AUTO
         0 000066   200010 450500                    STP0    OLDSIZE+2,,AUTO
         0 000067   200010 630500                    EPPR0   OLDSIZE+2,,AUTO
         0 000070   000004 631400 1                  EPPR1   4
         0 000071   000000 701000 xent               TSX1    ZIM$MOVE_ENQLIST
PL6.E3A0      #005=ZIM$EADDBUF File=ZIM$BUFM.:ZIC0TSI                            FRI 09/05/97 12:35 Page:98   
         0 000072   000000 011000                    NOP     0

      431      863    3               END;

      432      864    2           END; /* want less */

    864  0 000073   000122 710000 0                  TRA     s:873

      433      865    2       ELSE DO;

      434      866    2           CALL ZIO$GETSEG (GLOBAL$, 1024 * WANT) ALTRET (ER_GETSEG);

    866  0 000074   000012 735000                    ALS     10
         0 000075   200010 755100                    STA     OLDSIZE+2,,AUTO
         0 000076   200010 633500                    EPPR3   OLDSIZE+2,,AUTO
         0 000077   200013 453500                    STP3    OLDSIZE+5,,AUTO
         0 000100   000001 236000 1                  LDQ     1
         0 000101   200012 756100                    STQ     OLDSIZE+4,,AUTO
         0 000102   200012 630500                    EPPR0   OLDSIZE+4,,AUTO
         0 000103   000000 631400 1                  EPPR1   0
         0 000104   000000 701000 xent               TSX1    ZIO$GETSEG
         0 000105   000130 702000 0                  TSX2    ER_GETSEG

      435      867    2           CALL ZIO$ADDBUF (WANT);

    867  0 000106   200004 630500                    EPPR0   WANT,,AUTO
         0 000107   200010 450500                    STP0    OLDSIZE+2,,AUTO
         0 000110   200010 630500                    EPPR0   OLDSIZE+2,,AUTO
         0 000111   000004 631400 1                  EPPR1   4
         0 000112   000000 701000 xent               TSX1    ZIO$ADDBUF
         0 000113   000000 011000                    NOP     0

      436      868         /* As num buffers increase the
      437      869            start loc of the queue
      438      870            increases */
      439      871    2           CALL ZIM$MOVE_ENQLIST (WANT);

PL6.E3A0      #005=ZIM$EADDBUF File=ZIM$BUFM.:ZIC0TSI                            FRI 09/05/97 12:35 Page:99   
    871  0 000114   200004 630500                    EPPR0   WANT,,AUTO
         0 000115   200010 450500                    STP0    OLDSIZE+2,,AUTO
         0 000116   200010 630500                    EPPR0   OLDSIZE+2,,AUTO
         0 000117   000004 631400 1                  EPPR1   4
         0 000120   000000 701000 xent               TSX1    ZIM$MOVE_ENQLIST
         0 000121   000000 011000                    NOP     0

      440      872    2           END; /* want more */

      441      873    1       BUFTOT = GLOBAL.BCB.COUNT;

    873  0 000122   000000 470400 xsym               LDP0    GLOBAL$
         0 000123   000177 235100                    LDA     127,,PR0
         0 000124   000000 471400 xsym               LDP1    PS1$
         0 000125   100000 755100                    STA     0,,PR1

      442      874    1       RETURN;

    874  0 000126   000000 702200 xent               TSX2  ! X66_ARET

      443      875    1   ALT: ALTRETURN;

    875  0 000127   000000 702200 xent  ALT          TSX2  ! X66_AALT

      444      876    1   ER_GETSEG:
      445      877    1       CALL ZIB$SEGSIZE(GLOBAL$, NSIZE);

    877  0 000130   200003 630500       ER_GETSEG    EPPR0   NSIZE,,AUTO
         0 000131   200011 450500                    STP0    OLDSIZE+3,,AUTO
         0 000132   000001 236000 1                  LDQ     1
         0 000133   200010 756100                    STQ     OLDSIZE+2,,AUTO
         0 000134   200010 630500                    EPPR0   OLDSIZE+2,,AUTO
         0 000135   000000 631400 1                  EPPR1   0
         0 000136   000000 701000 xent               TSX1    ZIB$SEGSIZE
         0 000137   000000 011000                    NOP     0

      446      878    1       WANT = (NSIZE - OLDSIZE)/1024;
PL6.E3A0      #005=ZIM$EADDBUF File=ZIM$BUFM.:ZIC0TSI                            FRI 09/05/97 12:35 Page:100  

    878  0 000140   200003 236100                    LDQ     NSIZE,,AUTO
         0 000141   200006 136100                    SBLQ    OLDSIZE,,AUTO
         0 000142   002000 506007                    DIV     1024,DL
         0 000143   200004 756100                    STQ     WANT,,AUTO

      447      879    2       IF WANT ~= 0 THEN DO;

    879  0 000144   000000 116003                    CMPQ    0,DU
         0 000145   000162 600000 0                  TZE     s:883

      448      880    2           CALL ZIO$ADDBUF (WANT);

    880  0 000146   200004 630500                    EPPR0   WANT,,AUTO
         0 000147   200010 450500                    STP0    OLDSIZE+2,,AUTO
         0 000150   200010 630500                    EPPR0   OLDSIZE+2,,AUTO
         0 000151   000004 631400 1                  EPPR1   4
         0 000152   000000 701000 xent               TSX1    ZIO$ADDBUF
         0 000153   000000 011000                    NOP     0

      449      881    2           CALL ZIM$MOVE_ENQLIST (WANT);

    881  0 000154   200004 630500                    EPPR0   WANT,,AUTO
         0 000155   200010 450500                    STP0    OLDSIZE+2,,AUTO
         0 000156   200010 630500                    EPPR0   OLDSIZE+2,,AUTO
         0 000157   000004 631400 1                  EPPR1   4
         0 000160   000000 701000 xent               TSX1    ZIM$MOVE_ENQLIST
         0 000161   000000 011000                    NOP     0

      450      882    2           END;

      451      883    1       BUFTOT = GLOBAL.BCB.COUNT;

    883  0 000162   000000 470400 xsym               LDP0    GLOBAL$
         0 000163   000177 235100                    LDA     127,,PR0
         0 000164   000000 471400 xsym               LDP1    PS1$
         0 000165   100000 755100                    STA     0,,PR1
PL6.E3A0      #005=ZIM$EADDBUF File=ZIM$BUFM.:ZIC0TSI                            FRI 09/05/97 12:35 Page:101  

      452      884    1       RETURN;

    884  0 000166   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   000002 000000   000000 006000   000000 006014   777777 777777    ................
   1     004   000001 000000   400000 000000   000005 006000                    ............
      453      885    1   END ZIM$EADDBUF;
      454      886        %EOD;

PL6.E3A0      #005=ZIM$EADDBUF File=ZIM$BUFM.:ZIC0TSI                            FRI 09/05/97 12:35 Page:102  
--  Include file information  --

   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure ZIM$EADDBUF.

   Procedure ZIM$EADDBUF requires 119 words for executable code.
   Procedure ZIM$EADDBUF requires 12 words of local(AUTO) storage.
PL6.E3A0      #005=ZIM$EADDBUF File=ZIM$BUFM.:ZIC0TSI                            FRI 09/05/97 12:35 Page:103  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=ZIM$EADDBUF File=ZIM$BUFM.:ZIC0TSI                            FRI 09/05/97 12:35 Page:104  
          MINI XREF LISTING

ALT
       875**LABEL     851--CALLALT
BUFREQ
       827**DCL       841>>IF        842>>ASSIGN    847>>IF
BUFTOT
       828**DCL       873<<ASSIGN    883<<ASSIGN
ER_GETSEG
       877**LABEL     866--CALLALT
GLOBAL.ACTIVE.DBCB$
       509**DCL       510--REDEF
GLOBAL.ACTIVE.SSS$
       505**DCL       506--REDEF
GLOBAL.BCB.BUF
       615**DCL       841--IF        841--IF        844--ASSIGN    844--ASSIGN
GLOBAL.BCB.COUNT
       612**DCL       842>>ASSIGN    844>>ASSIGN    848>>ASSIGN    855>>ASSIGN    856<<ASSIGN    873>>ASSIGN
       883>>ASSIGN
GLOBAL.BCB.HEAD
       610**DCL       858<<ASSIGN
GLOBAL.BCB.TAIL
       611**DCL       857<<ASSIGN
GLOBAL.KEY
       713**DCL       716--REDEF
GLOBAL.PARAN.TRACE.MODE
       588**DCL       595--REDEF
GLOBAL.PRINTBUF.BUFFER
       747**DCL       748--REDEF     749--REDEF     750--REDEF
GLOBAL.PRINTBUF.ERR.V
       752**DCL       755--REDEF     756--REDEF     757--REDEF
GLOBAL$
       807**DCL       503--IMP-PTR   840<>CALL      842>>ASSIGN    844>>ASSIGN    848>>ASSIGN    855>>ASSIGN
       856>>ASSIGN    857>>ASSIGN    858>>ASSIGN    866<>CALL      873>>ASSIGN    877<>CALL      883>>ASSIGN
PL6.E3A0      #005=ZIM$EADDBUF File=ZIM$BUFM.:ZIC0TSI                            FRI 09/05/97 12:35 Page:105  
LESS
       838**DCL       855<<ASSIGN    859<>CALL
NSIZE
       836**DCL       877<>CALL      878>>ASSIGN
OLDSIZE
       839**DCL       840<>CALL      878>>ASSIGN
PS0$
       825**DCL       827--IMP-PTR   841>>IF        842>>ASSIGN    847>>IF
PS1$
       826**DCL       828--IMP-PTR   873>>ASSIGN    883>>ASSIGN
WANT
       837**DCL       842<<ASSIGN    844<<ASSIGN    845>>IF        848<<ASSIGN    849>>IF        855>>ASSIGN
       862<>CALL      866>>CALL      867<>CALL      871<>CALL      878<<ASSIGN    879>>IF        880<>CALL
       881<>CALL
ZIB$SEGSIZE
       831**DCL-ENT   840--CALL      877--CALL
ZIM$MOVE_ENQLIST
       834**DCL-ENT   862--CALL      871--CALL      881--CALL
ZIO$ADDBUF
       830**DCL-ENT   859--CALL      867--CALL      880--CALL
ZIO$FLUSH
       832**DCL-ENT   851--CALL
ZIO$GETSEG
       829**DCL-ENT   866--CALL

PL6.E3A0      #006=ZIO$ADDBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:106  
      455        1        /*M*     ZIO$ADDBUF - Appends newly obtained memory to the tail
      456        2                              of the buffer chain.                     */
      457        3        /*T***********************************************************/
      458        4        /*T*                                                         */
      459        5        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      460        6        /*T*                                                         */
      461        7        /*T***********************************************************/
      462        8        ZIO$ADDBUF: PROC(COUNT)
      463        9         /* USE($PR5 FOR GLOBAL$ */
      464       10               AVOID($PR5,$PR6,$PR7);
      465       11    1   DCL COUNT UBIN(36);
      466       12    1   DCL I UBIN(36);
      467       13        %INCLUDE ZI$GLOBAL;
      468      499         %GLOBALS;
      469      807    2       DO I=GLOBAL.BCB.COUNT+1 TO GLOBAL.BCB.COUNT+COUNT;
      470      808    2           GLOBAL.BCB.BUF.LINK(I)=GLOBAL.BCB.TAIL;
      471      809    2           GLOBAL.BCB.BUF.BLINK(GLOBAL.BCB.TAIL)=I;
      472      810    2           GLOBAL.BCB.BUF.BUF$(I)=PINCRW(GLOBAL.BCB.LASTP$,1024*I+3);
      473      811    2           GLOBAL.BCB.BUF.AWS$(I)=ADDR(NIL);
      474      812    2           GLOBAL.BCB.TAIL=I;
      475      813    2           END;
      476      814    1       GLOBAL.BCB.BUF.BLINK(GLOBAL.BCB.TAIL)=0;
      477      815    1       GLOBAL.BCB.COUNT=I-1;
      478      816    1       RETURN;
      479      817    1   END ZIO$ADDBUF;

PL6.E3A0      #006=ZIO$ADDBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:107  
--  Include file information  --

   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure ZIO$ADDBUF.

   Procedure ZIO$ADDBUF requires 43 words for executable code.
   Procedure ZIO$ADDBUF requires 6 words of local(AUTO) storage.

    No errors detected in file ZIM$BUFM.:ZIC0TSI    .

PL6.E3A0      #006=ZIO$ADDBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:108  

 Object Unit name= ZIO$ADDBUF                                 File name= ZIM$BUFM.:ZIC0TOU
 UTS= SEP 05 '97 12:35:49.88 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    43     53  ZIO$ADDBUF
    1  RoData even  none     1      1  ZIO$ADDBUF

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      XStd       1  ZIO$ADDBUF

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    GLOBAL$
PL6.E3A0      #006=ZIO$ADDBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:109  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID
PL6.E3A0      #006=ZIO$ADDBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:110  


      455        1        /*M*     ZIO$ADDBUF - Appends newly obtained memory to the tail
      456        2                              of the buffer chain.                     */
      457        3        /*T***********************************************************/
      458        4        /*T*                                                         */
      459        5        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      460        6        /*T*                                                         */
      461        7        /*T***********************************************************/
      462        8        ZIO$ADDBUF: PROC(COUNT)

      8  0 000000   000000 700200 xent  ZIO$ADDBUF   TSX0  ! X66_AUTO_1
         0 000001   000006 000001                    ZERO    6,1

      463        9         /* USE($PR5 FOR GLOBAL$ */
      464       10               AVOID($PR5,$PR6,$PR7);
      465       11    1   DCL COUNT UBIN(36);
      466       12    1   DCL I UBIN(36);
      467       13        %INCLUDE ZI$GLOBAL;
      468      499         %GLOBALS;
      469      807    2       DO I=GLOBAL.BCB.COUNT+1 TO GLOBAL.BCB.COUNT+COUNT;

    807  0 000002   000000 470400 xsym               LDP0    GLOBAL$
         0 000003   000177 235100                    LDA     127,,PR0
         0 000004   000001 035007                    ADLA    1,DL
         0 000005   200004 755100                    STA     I,,AUTO
         0 000006   000036 710000 0                  TRA     s:813+2

      470      808    2           GLOBAL.BCB.BUF.LINK(I)=GLOBAL.BCB.TAIL;

    808  0 000007   200004 236100                    LDQ     I,,AUTO
         0 000010   000005 402007                    MPY     5,DL
         0 000011   000000 470400 xsym               LDP0    GLOBAL$
         0 000012   000176 720100                    LXL0    126,,PR0
         0 000013   000205 740106                    STX0    133,QL,PR0

      471      809    2           GLOBAL.BCB.BUF.BLINK(GLOBAL.BCB.TAIL)=I;

PL6.E3A0      #006=ZIO$ADDBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:111  
    809  0 000014   000176 236100                    LDQ     126,,PR0
         0 000015   000005 402007                    MPY     5,DL
         0 000016   200004 720100                    LXL0    I,,AUTO
         0 000017   000205 440106                    SXL0    133,QL,PR0

      472      810    2           GLOBAL.BCB.BUF.BUF$(I)=PINCRW(GLOBAL.BCB.LASTP$,1024*I+3);

    810  0 000020   200004 236100                    LDQ     I,,AUTO
         0 000021   000005 402007                    MPY     5,DL
         0 000022   000201 471500                    LDP1    129,,PR0
         0 000023   200004 235100                    LDA     I,,AUTO
         0 000024   000012 735000                    ALS     10
         0 000025   100003 633505                    EPPR3   3,AL,PR1
         0 000026   000202 453506                    STP3    130,QL,PR0

      473      811    2           GLOBAL.BCB.BUF.AWS$(I)=ADDR(NIL);

    811  0 000027   000000 621006                    EAX1    0,QL
         0 000030   000000 236000 1                  LDQ     0
         0 000031   000204 756111                    STQ     132,X1,PR0

      474      812    2           GLOBAL.BCB.TAIL=I;

    812  0 000032   200004 235100                    LDA     I,,AUTO
         0 000033   000176 755100                    STA     126,,PR0

      475      813    2           END;

    813  0 000034   000001 035007                    ADLA    1,DL
         0 000035   200004 755100                    STA     I,,AUTO
         0 000036   200003 471500                    LDP1    @COUNT,,AUTO
         0 000037   000177 236100                    LDQ     127,,PR0
         0 000040   100000 036100                    ADLQ    0,,PR1
         0 000041   200004 116100                    CMPQ    I,,AUTO
         0 000042   000007 603000 0                  TRC     s:808

      476      814    1       GLOBAL.BCB.BUF.BLINK(GLOBAL.BCB.TAIL)=0;
PL6.E3A0      #006=ZIO$ADDBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:112  

    814  0 000043   000176 236100                    LDQ     126,,PR0
         0 000044   000005 402007                    MPY     5,DL
         0 000045   000000 220003                    LDX0    0,DU
         0 000046   000205 440106                    SXL0    133,QL,PR0

      477      815    1       GLOBAL.BCB.COUNT=I-1;

    815  0 000047   200004 235100                    LDA     I,,AUTO
         0 000050   000001 135007                    SBLA    1,DL
         0 000051   000177 755100                    STA     127,,PR0

      478      816    1       RETURN;

    816  0 000052   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   000000 006014                                                    ....
      479      817    1   END ZIO$ADDBUF;

PL6.E3A0      #006=ZIO$ADDBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:113  
--  Include file information  --

   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure ZIO$ADDBUF.

   Procedure ZIO$ADDBUF requires 43 words for executable code.
   Procedure ZIO$ADDBUF requires 6 words of local(AUTO) storage.

    No errors detected in file ZIM$BUFM.:ZIC0TSI    .
PL6.E3A0      #006=ZIO$ADDBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:114  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #006=ZIO$ADDBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:115  
          MINI XREF LISTING

COUNT
        11**DCL         8--PROC      807>>DOINDEX
GLOBAL.ACTIVE.DBCB$
       506**DCL       507--REDEF
GLOBAL.ACTIVE.SSS$
       502**DCL       503--REDEF
GLOBAL.BCB.BUF.AWS$
       615**DCL       811<<ASSIGN
GLOBAL.BCB.BUF.BLINK
       617**DCL       809<<ASSIGN    814<<ASSIGN
GLOBAL.BCB.BUF.BUF$
       613**DCL       810<<ASSIGN
GLOBAL.BCB.BUF.LINK
       616**DCL       808<<ASSIGN
GLOBAL.BCB.COUNT
       609**DCL       807>>DOINDEX   807>>DOINDEX   815<<ASSIGN
GLOBAL.BCB.LASTP$
       611**DCL       810>>ASSIGN
GLOBAL.BCB.TAIL
       608**DCL       808>>ASSIGN    809>>ASSIGN    812<<ASSIGN    814>>ASSIGN
GLOBAL.KEY
       710**DCL       713--REDEF
GLOBAL.PARAN.TRACE.MODE
       585**DCL       592--REDEF
GLOBAL.PRINTBUF.BUFFER
       744**DCL       745--REDEF     746--REDEF     747--REDEF
GLOBAL.PRINTBUF.ERR.V
       749**DCL       752--REDEF     753--REDEF     754--REDEF
GLOBAL$
       804**DCL       500--IMP-PTR   807>>DOINDEX   807>>DOINDEX   808>>ASSIGN    808>>ASSIGN    809>>ASSIGN
       809>>ASSIGN    810>>ASSIGN    810>>ASSIGN    811>>ASSIGN    812>>ASSIGN    814>>ASSIGN    814>>ASSIGN
       815>>ASSIGN
PL6.E3A0      #006=ZIO$ADDBUF File=ZIM$BUFM.:ZIC0TSI                             FRI 09/05/97 12:35 Page:116  
I
        12**DCL       807<<DOINDEX   808>>ASSIGN    809>>ASSIGN    810>>ASSIGN    810>>ASSIGN    811>>ASSIGN
       812>>ASSIGN    815>>ASSIGN
