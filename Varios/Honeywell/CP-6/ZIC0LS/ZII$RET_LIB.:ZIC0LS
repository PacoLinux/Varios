
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:1    
        1        1        /*M* ZII$RETRIEVE Performs actual database (IDS) data retrieval.   */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*P* NAME:       ZII$RETRIEVE
        8        8
        9        9             PURPOSE:    This module does the retrieval of databases accessed
       10       10                         by IDP. It uses information generated by the TOPOLOGY
       11       11                         module such as the Path list and the Access list. The
       12       12                         RETRIEVE module follows the directions given by the
       13       13                         Path list to traverse READYd areas in order to access
       14       14                         fields that were cited in the (IDP) DISPLAY command.
       15       15
       16       16            DESCRIPTION: When ZII$RETRIEVE is called by IDP (or some other
       17       17                         processor), the Path list is scanned cell by cell
       18       18                         with appropriate DB call being made along the way
       19       19                         in accordance with the Path list instructions. Each
       20       20                         branch of each lambda structure is traversed as far
       21       21                         as possible until either the end of the branches are
       22       22                         reached or an end-of-set condition is detected.
       23       23                         Then, an output routine is called by RETRIEVE to
       24       24                         display what was previously placed in the UWA.
       25       25                         ZII$RETRIEVE does all necessary READYs and FINISHes.
       26       26                                                                              */
       27       27        /*D* NAME:      ZII$RETRIEVE
       28       28
       29       29             CALL:      CALL ZII$RETRIEVE(PATH_LIST,ACCESS_LIST,AREA_LIST,
       30       30                                          OUTPUT_ROUTINE,STATUS_CODE,
       31       31                                          SHARE_TYPE) ALTRET(LBL);
       32       32
       33       33                        (called by IDP, from ZEG$REPORT)
       34       34
       35       35             INPUT:     PATH_LIST      - Array describing the path to be
       36       36                                         followed for a particular retrieval.
       37       37                                         Contains records, sets, etc., in
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:2    
       38       38                                         path order.
       39       39
       40       40                        ACCESS_LIST    - Contains information about the port
       41       41                                         record and how it is to be retrieved.
       42       42
       43       43                        AREA_LIST      - List of areas to be readied. If
       44       44                                         AREA_IDX = 0, all areas in the
       45       45                                         database should be readied.
       46       46
       47       47                        OUTPUT_ROUTINE - Routine supplied by the calling
       48       48                                         program to output a formatted output
       49       49                                         record made from pieces of retrieved
       50       50                                         database records which were marked
       51       51                                         for display.
       52       52
       53       53                        SHARE_TYPE     - How this database is to be shared.
       54       54
       55       55                                         NOSHARE    = 20
       56       56                                         SHAREALL   = 28
       57       57                                         SHAREANY   = 29
       58       58                                         SHAREIN    = 30
       59       59                                         SHARECUR   = 48
       60       60                                         SHAREINCUR = 49
       61       61
       62       62                                         (Equates found in ZI$DESC)
       63       63
       64       64             OUTPUT:    STATUS_CODE    - Contains error code describing the
       65       65                                         reason for an altreturn. 0 otherwise.
       66       66
       67       67                        An output record in the calling routine's specified
       68       68                        area.
       69       69
       70       70             DESCRIPTION: ZII$RETRIEVE is called by IDP after first calling
       71       71                          ZII$BUILD_TABLES to place the Topology and Subschema
       72       72                          tables into the Common dynamic segment, then calling
       73       73                          ZII$TOPOLOGY in order to build the Path list and
       74       74                          Access lists.
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:3    
       75       75
       76       76                                ZII$RETRIEVE starts by READYing the areas of
       77       77                          the users's database. If either the INVOKE (HIA) or
       78       78                          READY calls fail, then the ALTRETURN is taken.
       79       79                                Next, Retrieve determines from the Access list
       80       80                          whether the Port was declared (either by the user or
       81       81                          by Topology's Port Selector) to be Serial, Direct,
       82       82                          Indexed, or by Alternate Keys. Retrieve then
       83       83                          performs the appropriate FIND for the first occurrence
       84       84                          of the Port. If constraints are present, the Port
       85       85                          occurrence is checked against them to determine whether
       86       86                          it passed. If not, a new Port occurrence is found.
       87       87                          If it passed the constraint check, then Retrieve
       88       88                          proceeds to follow the Path list.
       89       89                                If only one record is involved in the search
       90       90                          (the port record is all that's required), then the
       91       91                          output routine is called immediately and Retrieve
       92       92                          looks for a new port record.
       93       93                                If there is more than one record involved in
       94       94                          the database retrieval, then Retrieve follows the
       95       95                          path list down each branch until it either hits
       96       96                          end of set while when trying to find a record
       97       97                          subordinate to the port record or reaches the
       98       98                          end of the branch. this procedure is done through
       99       99                          a call to a recursive routine which follows the Path
      100      100                          list down as far as it can for each branch. When
      101      101                          all branches have been tried for this pass, then the
      102      102                          output routine is called to make the UWA available
      103      103                          to the calling program. Then the appropriate position
      104      104                          on the next branch is determined in order to put
      105      105                          together another potential output record.
      106      106                                NOTE: The actual retrieval of records is done
      107      107                          by this module, but all constraint checking against
      108      108                          both present and non-present records is done by code
      109      109                          furnished by IDP via EPTRS. In particular, IDP assumes
      110      110                          that the PATH_LIST.INIT_EPTR(I) will be called ONLY
      111      111                          when a record is not found. It will set a field for
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:4    
      112      112                          IDP's use indicating that the record is not present.
      113      113                          Therefore, the PATH_LIST.CONVERT_EPTR(I) should be
      114      114                          used for all records actually present and the
      115      115                          INIT_EPTR for those which are not. Otherwise, the
      116      116                          constraint checking mechanism will not work correctly.
      117      117                                When Retrieve finds that all branches eminating
      118      118                          from the Port record have been exhausted, a new Port
      119      119                          record FIND is attempted. (A branch is considered to
      120      120                          be exhausted if (1) end of set has been reached for
      121      121                          all sets on the branch for which find-members are
      122      122                          done and any sets requiring find-owner operations
      123      123                          successfully found the owner or (2) the branch
      124      124                          contains sets for which only find-owner operations
      125      125                          must be done and all such owners were successfully
      126      126                          found. Any set indicated in the path list requires
      127      127                          either a find-member or find-owner operation, never
      128      128                          both.) If a new Port record occurrence is found,
      129      129                          then the procedure is repeated. Retrieval is
      130      130                          complete when no more new Port records are found.
      131      131                                Then Retrieve proceeds to FINISH all areas that
      132      132                          previously READYd and returns control to the calling
      133      133                          program.                                             */
      134      134        ZII$RETRIEVE: PROC (PATH_LIST,ACCESS_LIST,AREA_LIST,RETRIEVE_EXIT,STATUS_CODE,
               134            SHARE_TYPE) ALTRET;
      135      135    1   DCL RETRIEVE_EXIT EPTR;
      136      136    1   DCL GEN_CODE_EPTR EPTR STATIC;
      137      137    1   DCL STATUS_CODE UBIN(36);
      138      138    1   DCL SHARE_TYPE UBIN HALF;
      139      139        /*
      140      140          PRESENCE_LIST.REC_NO(0) contains the count of all current members
      141      141          of the PRESENCE_LIST; i.e., the number of unique records involved
      142      142          in this display. P_VALUE indicates the presence value of a member
      143      143          record (0 = not present, 1 = old value, 2 = new value).
      144      144        */
      145      145        %EQU OLD = 1;
      146      146        %EQU NEW = 2;
      147      147    1   DCL 1 PRESENCE_LIST (0:200) STATIC ALIGNED,
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:5    
      148      148    1         2 REC_NO UBIN(18) UNAL,
      149      149    1         2 P_VALUE UBIN(18) UNAL,
      150      150    1         2 DB_KEY_SAVE UBIN(36) UNAL;
      151      151    1   DCL BRANCH_FAILED(0:50) BIT(1) STATIC ALIGNED;
      152      152    1   DCL CONSTRAINT_FAILED BIT(1) ALIGNED EXT;
      153      153    1   DCL 1 ZII$PARAMS (0:20) SYMREF,
      154      154    1         2 L_HALF UBIN(18) UNAL,
      155      155    1         2 R_HALF UBIN(18) UNAL;
      156      156    1   DCL ZII$INTEGER1 SBIN SYMREF;
      157      157    1   DCL ZII$INTEGER2 SBIN SYMREF;
      158      158    1   DCL DB_STATUS_SAVE CHAR(7) STATIC;
      159      159    1   DCL I UBIN STATIC;
      160      160    1   DCL J UBIN STATIC;
      161      161    1   DCL BRANCH_COUNT UBIN STATIC;
      162      162    1   DCL PIVOT_REC_IDX UBIN EXT;
      163      163    1   DCL ALL_BRANCHES_DONE UBIN STATIC;
      164      164    1   DCL N UBIN STATIC;
      165      165    1   DCL RETRIEVE_RETURN BIT(72) EXTROOT;
      166      166    1   DCL TEMP_VALUE UBIN AUTO;
      167      167    1   DCL NEXT_BRANCH UBIN AUTO;
      168      168    1   DCL START_OF_BRANCH UBIN AUTO;
      169      169    1   DCL CURRENT_BRANCH UBIN AUTO;
      170      170    1   DCL ZI_PRINT_FLAG BIT(1) EXTROOT;
      171      171    1   DCL SHARE_IND BIT(1);
      172      172    1   DCL ZI_RETRIEVING BIT(1) EXTROOT INIT('0'B);
      173      173         /* Used to indicate to ZEE$INTERRUPT, the
      174      174            IDP break routine, whether database
      175      175            retrieval is in progress or not */
      176      176        /**/
      177      177        %INCLUDE CP_6;
      178      258        %INCLUDE CP_6_SUBS;
      179      798        %INCLUDE ZI$STRUCTS;
      180      870        %NAM1;
      181      899        %NAM2;
      182      913        %UWA1;
      183      936        %INCLUDE ZI$DESC;
      184     1786        %DSC_AREA;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:6    
      185     1808        %DSC_SET;
      186     1850        %DSC_REC;
      187     1884        %DSC_KEY;
      188     1894        %DSC_RA;
      189     1909        %KEYWD_VAL;
      190     1956        %INCLUDE ZI$PATH_STRUCTS;
      191     2094        %PATH_DESC (STCLASS=" ");
      192     2134        %ACCESS_DESC (STCLASS=" ");
      193     2173        %AREA_LIST_DESC (STCLASS=" ");
      194     2180        %INCLUDE ZI_IDPERR_SUBS;
      195     2214        /**/
      196     2215        %VLP_VECTOR (FPTN=IA_,STCLASS=EXT);
      197     2230        %VLP_VECTOR (FPTN=UWA_,STCLASS=EXT);
      198     2245        %VLP_VECTOR (FPTN=RVA_,STCLASS=EXT);
      199     2260        /**/
      200     2261    1   DCL ZII$INVOKE ENTRY(3) ALTRET;
      201     2262    1   DCL ZII$READY ENTRY(0) ALTRET;
      202     2263    1   DCL ZII$FINISH ENTRY(0) ALTRET;
      203     2264    1   DCL ZII$FIND ENTRY(0) ALTRET;
      204     2265    1   DCL ZII$CHECK ENTRY(0) ALTRET;
      205     2266    1   DCL ZII$CLR_PARAMS ENTRY;
      206     2267    1   DCL ZII$RECURSE ENTRY(5) ALTRET;
      207     2268    1   DCL ZII$GET ENTRY(0) ALTRET;
      208     2269    1   DCL ZII$BUFFERS ENTRY(0) ALTRET;
      209     2270    1   DCL ZII$FIND_PRESENCE_IDX ENTRY(3);
      210     2271    1   DCL ZII$FIND_FIRST ENTRY(1) ALTRET;
      211     2272        /**/
      212     2273        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:7    
      213     2274        /*
      214     2275          Init all variables used as indicators for retrieval. STATUS_CODE
      215     2276          is the error indicator for the recursion. SET_PRESENCE_LIST init-
      216     2277          ializes the list that shows presence for each record after
      217     2278          database FINDs have been done.
      218     2279        */
      219     2280    1       STATUS_CODE=0;
      220     2281    1       ALL_BRANCHES_DONE=0;
      221     2282    1       CONSTRAINT_FAILED = '0'B;
      222     2283    1       N=1;
      223     2284    1       ACCESS_LIST.PORT_IDX=0;
      224     2285    1       CALL SET_PRESENCE_LIST;
      225     2286        /*
      226     2287          If KEYED access and PORT_NUM is 0, then set PORT_NUM to 1 and
      227     2288          KEYED.MOVE/CHECK to NIL.
      228     2289        */
      229     2290    1       IF ACCESS_LIST.PORT_TYPE = %KEYED_ACCESS AND
      230     2291    1          ACCESS_LIST.PORT_NUM = 0 THEN
      231     2292    2       DO;
      232     2293    2           ACCESS_LIST.PORT_NUM=1;
      233     2294    2           ACCESS_LIST.KEYED.MOVE(0)=ENTADDR(NIL);
      234     2295    2           ACCESS_LIST.KEYED.CHECK(0)=ENTADDR(NIL);
      235     2296    2           END;
      236     2297        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:8    
      237     2298        /*
      238     2299          HIA the database, get buffers and, if there is a list of areas
      239     2300          given, READY only those areas, else READY all areas in the
      240     2301          database.
      241     2302        */
      242     2303    1       ZII$PARAMS='0'B;
      243     2304    1       CALL ZII$INVOKE(IA_,UWA_,RVA_) ALTRET(BAD_HIA);
      244     2305    1       IF UWA.DB_STATUS~='0000000' THEN
      245     2306    1           GOTO BAD_READY;
      246     2307    1       ZI_RETRIEVING = '1'B;
      247     2308    1       ZII$PARAMS='0'B;
      248     2309    1       ZII$PARAMS.R_HALF(0)=2;
      249     2310    1       ZII$PARAMS.R_HALF(1)=1;
      250     2311    1       ZII$PARAMS.R_HALF(2)=1;
      251     2312    1       ZII$INTEGER1=50;
      252     2313    1       ZII$INTEGER2=0;
      253     2314    1       CALL ZII$BUFFERS ALTRET(BAD_BUFFERS);
      254     2315    1       ZII$PARAMS='0'B;
      255     2316    1       IF AREA_LIST.AREA_IDX(0)=0 THEN
      256     2317    2       DO;
      257     2318    2           IF SHARE_TYPE = 0 THEN
      258     2319    2               ZII$PARAMS.R_HALF(0) = 1;
      259     2320    3           ELSE DO;
      260     2321    3               ZII$PARAMS.R_HALF(0) = 2;
      261     2322    3               ZII$PARAMS.R_HALF(2) = SHARE_TYPE;
      262     2323    3               END;
      263     2324    2           ZII$PARAMS.R_HALF(1)=%RETRIEVAL;
      264     2325    2           CALL ZII$READY ALTRET(BAD_READY);
      265     2326    2           IF UWA.DB_STATUS ~='0000000' THEN
      266     2327    2               GOTO BAD_READY;
      267     2328    2           END;
      268     2329    1       ELSE
      269     2330    2       DO;
      270     2331    2           IF SHARE_TYPE = 0 THEN
      271     2332    2               ZII$PARAMS.R_HALF(0) = 2;
      272     2333    3           ELSE DO;
      273     2334    3               ZII$PARAMS.R_HALF(0) = 3;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:9    
      274     2335    3               ZII$PARAMS.R_HALF(3) = SHARE_TYPE;
      275     2336    3               END;
      276     2337    2           ZII$PARAMS.R_HALF(2)=%RETRIEVAL;
      277     2338    2           I=1;
      278     2339    3           DO WHILE (I<=AREA_LIST.AREA_IDX(0));
      279     2340    3               ZII$PARAMS.L_HALF(1)=NAM1.DESC$(AREA_LIST.AREA_IDX(I))->AREA.RVA_OFF;
      280     2341    3               CALL ZII$READY ALTRET(BAD_READY);
      281     2342    3               IF UWA.DB_STATUS~='0000000' THEN
      282     2343    3                   GOTO BAD_READY;
      283     2344    3               I=I+1;
      284     2345    3               END;
      285     2346    2           END;
      286     2347        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:10   
      287     2348        /*
      288     2349          Determine for later use whether any AREAs have been opened
      289     2350          in SHARE mode; if so, SHARE_IND will be set to '1'B and
      290     2351          checkpointing will be done.
      291     2352        */
      292     2353    1       SHARE_IND='1'B;
      293     2354    1       CALL ARE_WE_SHARING ALTRET(YES_WE_ARE);
      294     2355    1       SHARE_IND='0'B;
      295     2356    1   YES_WE_ARE:
      296     2357        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:11   
      297     2358        /*
      298     2359          Count all the branches involved in this retrieval. At least one
      299     2360          Lambda structure is present if the number of branches counted is
      300     2361          > 1. Also, save the index into the Path List of the 1st occurrence
      301     2362          of the record where the lambda branching really starts. Call this
      302     2363          the PIVOT_REC_IDX.
      303     2364        */
      304     2365    1       N=1;
      305     2366    1       BRANCH_COUNT=1;
      306     2367    1       PIVOT_REC_IDX = 0;
      307     2368    1       IF PATH_LIST.REC_NO(0) = 1 THEN
      308     2369    1           ALL_BRANCHES_DONE=1;
      309     2370    1       ELSE
      310     2371    2       DO;
      311     2372    2           I=2;
      312     2373    3           DO WHILE (I<=PATH_LIST.REC_NO(0));
      313     2374    3               J=1;
      314     2375    4               DO WHILE (J<I);
      315     2376    4                   IF PATH_LIST.REC_NO(J)=PATH_LIST.REC_NO(I) THEN
      316     2377    5                   DO;
      317     2378    5                       IF PIVOT_REC_IDX = 0 THEN
      318     2379    5                           PIVOT_REC_IDX = J;
      319     2380    5                       BRANCH_COUNT=BRANCH_COUNT+1;
      320     2381    5                       J=I;
      321     2382    5                       END;
      322     2383    4                   J=J+1;
      323     2384    4                   END;
      324     2385    3               I=I+1;
      325     2386    3               END;
      326     2387    2           END;
      327     2388        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:12   
      328     2389        /*
      329     2390          Now retrieve a port occurrence. If access was SERIAL then the
      330     2391          first instance of the Port record was the first occurrence in the
      331     2392          database. If calc, then that record whose calc-key matches the
      332     2393          one specified in the WHEN clause of the DISPLAY command will be
      333     2394          retrieved. If KEYED access then either an alternate key or index
      334     2395          key will be used for retrieval. If DIRECT then a DB_KEY from the list
      335     2396          contained in ACCESS_LIST will be used.
      336     2397        */
      337     2398    1       ZII$PARAMS='0'B;
      338     2399    2       DO CASE(ACCESS_LIST.PORT_TYPE);
      339     2400    2       CASE(%SERIAL_ACCESS);
      340     2401    2           ZII$PARAMS.R_HALF(0)=3;
      341     2402    2           ZII$PARAMS.R_HALF(1)=%FIRST;
      342     2403    2           DR$=NAM1.DESC$(PATH_LIST.REC_NO(1));
      343     2404    2           ZII$PARAMS.L_HALF(2)=RECORD.RVA_OFF;
      344     2405    2           DR$=NAM1.DESC$(PATH_LIST.REC_NO(1));
      345     2406    2           DRA$=RECORD.RA_DSC$;
      346     2407    2           DA$=NAM1.DESC$(RA_DSC.AREA_IDX);
      347     2408    2           ZII$PARAMS.L_HALF(3)=AREA.RVA_OFF;
      348     2409    2       CASE(%DIRECT_ACCESS);
      349     2410    2           IF ACCESS_LIST.PORT_IDX ~= 0 THEN
      350     2411    3           DO;
      351     2412    3               STATUS_CODE=%ZII_NO_DBKEYS;
      352     2413    3               ZI_RETRIEVING = '0'B;
      353     2414    3               ALTRETURN;
      354     2415    3               END;
      355     2416    2           ZII$PARAMS.R_HALF(0)=3;
      356     2417    2           DR$=NAM1.DESC$(PATH_LIST.REC_NO(1));
      357     2418    2           ZII$PARAMS.L_HALF(1)=RECORD.RVA_OFF;
      358     2419    2           ZII$PARAMS.R_HALF(2)=%DBKEY;
      359     2420    2           ZII$PARAMS.R_HALF(3)=1;
      360     2421    2           ZII$INTEGER1=ACCESS_LIST.DIRECT(ACCESS_LIST.PORT_IDX);
      361     2422    2           ACCESS_LIST.PORT_IDX=ACCESS_LIST.PORT_IDX+1;
      362     2423    2       CASE(%KEYED_ACCESS);
      363     2424    2           IF ACCESS_LIST.KEYED.MOVE(ACCESS_LIST.PORT_IDX) ~= ENTADDR(NIL) THEN
      364     2425    3           DO;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:13   
      365     2426    3               IF ACCESS_LIST.PORT_IDX ~= 0 THEN
      366     2427    4               DO;
      367     2428    4                   STATUS_CODE=%ZII_NO_DBKEYS;
      368     2429    4                   ZI_RETRIEVING = '0'B;
      369     2430    4                   ALTRETURN;
      370     2431    4                   END;
      371     2432    3               ZII$PARAMS.R_HALF(0)=3;
      372     2433    3               ZII$PARAMS.L_HALF(1)=NAM1.DESC$(ACCESS_LIST.PORT) -> RECORD.RVA_OFF;
      373     2434    3               ZII$PARAMS.R_HALF(2)=%USING;
      374     2435    3               ZII$PARAMS.L_HALF(3)=NAM1.DESC$(ACCESS_LIST.PORT_KEY) -> KEY.RVA_OFF;
      375     2436    3               IF ACCESS_LIST.KEYED.MOVE(ACCESS_LIST.PORT_IDX)~=ENTADDR(NIL) THEN
      376     2437    4               DO;
      377     2438    4                   GEN_CODE_EPTR=ACCESS_LIST.KEYED.MOVE(ACCESS_LIST.PORT_IDX);
      378     2439    4                   CALL GEN_CODE_EPTR ALTRET(BAD_FIND);
      379     2440    4                   END;
      380     2441    3               END;
      381     2442    2           ELSE
      382     2443    3           DO;
      383     2444    3               CALL ZII$FIND_FIRST(ACCESS_LIST) ALTRET(ERR_STATUS);
      384     2445    3               ZII$PARAMS.R_HALF(0)=3;
      385     2446    3               ZII$PARAMS.L_HALF(1)=NAM1.DESC$(ACCESS_LIST.PORT) -> RECORD.RVA_OFF;
      386     2447    3               ZII$PARAMS.R_HALF(2)=%USING;
      387     2448    3               ZII$PARAMS.L_HALF(3)=NAM1.DESC$(ACCESS_LIST.PORT_KEY) -> KEY.RVA_OFF;
      388     2449    3               CALL ZII$FIND ALTRET(BAD_FIND);
      389     2450    3               IF UWA.DB_STATUS = '0502100' /*end-of-set*/ THEN
      390     2451    3                   GOTO FINLBL;
      391     2452    3               IF UWA.DB_STATUS ~= '0000000' AND
      392     2453    3                  UWA.DB_STATUS ~= '0502401' /* key val of record found is
      393     2454         greater than specified val */
      394     2455    3               THEN GOTO BAD_FIND;
      395     2456    3               CALL ZII$CLR_PARAMS;
      396     2457    3               ZII$PARAMS.R_HALF(0)=4;
      397     2458    3               ZII$PARAMS.R_HALF(1)=%FIRST;
      398     2459    3               ZII$PARAMS.L_HALF(2)=NAM1.DESC$(ACCESS_LIST.PORT) -> RECORD.RVA_OFF;
      399     2460    3               ZII$PARAMS.R_HALF(3)=%USING;
      400     2461    3               ZII$PARAMS.L_HALF(4)=NAM1.DESC$(ACCESS_LIST.PORT_KEY) -> KEY.RVA_OFF;
      401     2462    3               END;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:14   
      402     2463    2       CASE(%CALC_ACCESS);
      403     2464    2           ZII$PARAMS.R_HALF(0)=2;
      404     2465    2           ZII$PARAMS.R_HALF(1)=%ANY;
      405     2466    2           ZII$PARAMS.L_HALF(2)=NAM1.DESC$(ACCESS_LIST.PORT)->RECORD.RVA_OFF;
      406     2467    2           IF ACCESS_LIST.PORT_IDX < ACCESS_LIST.PORT_NUM THEN
      407     2468    3           DO;
      408     2469    3               GEN_CODE_EPTR=ACCESS_LIST.KEYED.MOVE(ACCESS_LIST.PORT_IDX);
      409     2470    3               CALL GEN_CODE_EPTR ALTRET(BAD_FIND);
      410     2471    3               CALL ZII$FIND ALTRET(BAD_FIND);
      411     2472    3               END;
      412     2473    2           ELSE
      413     2474    2               GOTO FINLBL;
      414     2475    2       CASE(ELSE);
      415     2476         /* The parameter ACCESS_LIST is screwed. */
      416     2477    2           GOTO ERR_STATUS;
      417     2478    2           END;
      418     2479    1   FNDLBL:
      419     2480    1       CALL ZII$FIND ALTRET(BAD_FIND);
      420     2481    1       IF ACCESS_LIST.PORT_TYPE = %KEYED_ACCESS THEN
      421     2482    2       DO;
      422     2483    2           IF UWA.DB_STATUS = '0502100' /* end-of-set */ THEN
      423     2484    2               GOTO NXTPORT_IDX;
      424     2485    2           IF UWA.DB_STATUS ~= '0000000' AND
      425     2486    2              UWA.DB_STATUS ~= '0502401' /* key val of record found is
      426     2487         greater than specified value */
      427     2488    2           THEN GOTO BAD_FIND;
      428     2489    2           END;
      429     2490    1       ELSE
      430     2491    2       DO;
      431     2492    2           IF UWA.DB_STATUS = '0502100' /* end-of-set */ THEN
      432     2493    2               IF ACCESS_LIST.PORT_TYPE = %DIRECT_ACCESS THEN
      433     2494    2                   GOTO NXTPORT;
      434     2495    2               ELSE
      435     2496    2                   GOTO FINLBL;
      436     2497    2           IF UWA.DB_STATUS = '0502400' /* no such record found */ THEN
      437     2498    2               GOTO NXTPORT;
      438     2499    2           IF UWA.DB_STATUS ~= '0000000' THEN
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:15   
      439     2500    2               GOTO BAD_FIND;
      440     2501    2           END;
      441     2502    1       CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,PATH_LIST.REC_NO(1),TEMP_VALUE);
      442     2503    1       PRESENCE_LIST.P_VALUE(TEMP_VALUE)=%NEW;
      443     2504    1       PRESENCE_LIST.DB_KEY_SAVE(TEMP_VALUE)=UWA.DIRECT_REFERENCE;
      444     2505    1       PATH_LIST.BRANCH_EXHAUSTED(1)='0'B;
      445     2506    1       IF PATH_LIST.GET_IND(1) THEN
      446     2507    2       DO;
      447     2508    2           ZII$PARAMS='0'B;
      448     2509    2           ZII$PARAMS.R_HALF(0)=1;
      449     2510    2           DR$=NAM1.DESC$(PATH_LIST.REC_NO(1));
      450     2511    2           ZII$PARAMS.L_HALF(1)=RECORD.RVA_OFF;
      451     2512    2           CALL ZII$GET ALTRET(BAD_GET);
      452     2513    2           IF UWA.DB_STATUS~='0000000' THEN
      453     2514    2               GOTO BAD_GET;
      454     2515    3           ELSE DO;
      455     2516    3               GEN_CODE_EPTR=PATH_LIST.CONVERT_EPTR(1);
      456     2517    3               CALL GEN_CODE_EPTR;
      457     2518    3               IF ACCESS_LIST.PORT_TYPE = %KEYED_ACCESS AND
      458     2519    3                  ACCESS_LIST.KEYED.CHECK(ACCESS_LIST.PORT_IDX) ~= ENTADDR(NIL) THEN
      459     2520    4               DO;
      460     2521    4                   GEN_CODE_EPTR=ACCESS_LIST.KEYED.CHECK(ACCESS_LIST.PORT_IDX);
      461     2522    4                   CALL GEN_CODE_EPTR ALTRET(NXTPORT_IDX);
      462     2523    4                   END;
      463     2524    3               GEN_CODE_EPTR=PATH_LIST.CONSTRAINT_EPTR(1);
      464     2525    3               IF GEN_CODE_EPTR~=ENTADDR(NIL) THEN
      465     2526    3                   CALL GEN_CODE_EPTR ALTRET(NXTPORT);
      466     2527    3               END;
      467     2528    2           END;
      468     2529    1       PATH_LIST.FIND_ATTEMPTED(1)='1'B;
      469     2530    1       IF PATH_LIST.REC_NO(0) = 1 THEN
      470     2531    1           GOTO OUTLBL;
      471     2532        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:16   
      472     2533         /*
      473     2534            Set appropriate find first flags for all records in the
      474     2535            path list indicated as set members rather than set owners.
      475     2536            Don't bother to set it for records at the start of a new branch.
      476     2537         */
      477     2538    2       DO I=1 TO PATH_LIST.REC_NO(0)-1;
      478     2539    2           IF NOT PATH_LIST.OWN_NEXT(I) AND PATH_LIST.SET_NO(I)~=0 THEN
      479     2540    2               PATH_LIST.FIND_FIRST(I+1)='1'B;
      480     2541    2           END;
      481     2542        /*
      482     2543          Now recursively traverse the database to retrieve all record occurrences
      483     2544          in the path. When the path has been traversed as far as possible,
      484     2545          control is passed to the label OUTLBL where further checking is
      485     2546          done to determine whether the results of the traversal should be
      486     2547          output for display. If so, the display routine supplied by the
      487     2548          calling program is called.
      488     2549        */
      489     2550    1   RECUR:
      490     2551    1       ALL_BRANCHES_DONE=0;
      491     2552    1       START_OF_BRANCH=1;
      492     2553    1       NEXT_BRANCH = 1;
      493     2554    2       DO I = 1 TO BRANCH_COUNT;
      494     2555    2           BRANCH_FAILED(I) = '0'B;
      495     2556    2           END;
      496     2557    2       DO WHILE (ALL_BRANCHES_DONE=0);
      497     2558    2           CURRENT_BRANCH = NEXT_BRANCH;
      498     2559    3           DO WHILE (CURRENT_BRANCH<=BRANCH_COUNT);
      499     2560    3               CURRENT_BRANCH = NEXT_BRANCH;
      500     2561    3               REMEMBER COMEBACK IN RETRIEVE_RETURN;
      501     2562    3               CALL ZII$RECURSE(N,PATH_LIST,PRESENCE_LIST,START_OF_BRANCH,STATUS_CODE)
              2562                        ALTRET(BAD_RECURSION);
      502     2563    3   COMEBACK:
      503     2564    4               IF CONSTRAINT_FAILED THEN DO;
      504     2565    4                   BRANCH_FAILED(CURRENT_BRANCH) = '1'B;
      505     2566    4                   CONSTRAINT_FAILED = '0'B;
      506     2567    4                   END;
      507     2568    3               ELSE
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:17   
      508     2569    3                   BRANCH_FAILED(CURRENT_BRANCH) = '0'B;
      509     2570    3               IF CURRENT_BRANCH = BRANCH_COUNT THEN
      510     2571    3                   NEXT_BRANCH=1;
      511     2572    3               ELSE
      512     2573    3                   NEXT_BRANCH=CURRENT_BRANCH+1;
      513     2574    3               CALL EVAL_PRESENCE; /* Set starting point on new branch. */
      514     2575    3               IF ALL_BRANCHES_DONE=1 OR NEXT_BRANCH < CURRENT_BRANCH+1 THEN
      515     2576    3                   CURRENT_BRANCH=BRANCH_COUNT;
      516     2577    3               CURRENT_BRANCH=CURRENT_BRANCH+1;
      517     2578    3               END;
      518     2579    2   OUTLBL:
      519     2580    2           IF SHARE_IND THEN
      520     2581    3           DO;
      521     2582    3               ZII$PARAMS='0'B;
      522     2583    3               ZII$PARAMS.R_HALF(0)=2;
      523     2584    3               ZII$PARAMS.R_HALF(1)=1;
      524     2585    3               ZII$PARAMS.R_HALF(2)=1;
      525     2586    3               ZII$INTEGER1=1;
      526     2587    3               ZII$INTEGER2=0;
      527     2588    3               CALL ZII$CHECK ALTRET(ERR_STATUS);
      528     2589         /* Since we called for a checkpoint, the currencies have
      529     2590            been zeroed, so they must be restored. */
      530     2591    3               CALL RESTORE_CURRENCY ALTRET(BAD_FIND);
      531     2592    3               IF STATUS_CODE ~= 0 THEN
      532     2593    3                   GOTO ERR_STATUS;
      533     2594    3               END;
      534     2595        /*
      535     2596          First, assume we're going to print this thing.
      536     2597        */
      537     2598    2           ZI_PRINT_FLAG = '1'B;
      538     2599        /*
      539     2600          Now, check to see if any branch failed constraints during
      540     2601          recursion process. If so, don't print.
      541     2602        */
      542     2603    2           I = 1;
      543     2604    3           DO WHILE (ZI_PRINT_FLAG AND I <= BRANCH_COUNT);
      544     2605    3               IF BRANCH_FAILED(I) THEN
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:18   
      545     2606    3                   ZI_PRINT_FLAG = '0'B;
      546     2607    3               I = I+1;
      547     2608    3               END;
      548     2609        /*
      549     2610          If print flag is still on, have to see if any records
      550     2611          we did find-nexts on weren't there (hit end of set). If so, the
      551     2612          recursion process was aborted for that branch, and any records
      552     2613          further down the branch couldn't be found either. But, the UWA
      553     2614          may contain old info for such recs from a previous iteration. So,
      554     2615          init them, constrain them if necessary, and mark them not present.
      555     2616        */
      556     2617    2           IF ZI_PRINT_FLAG = '1'B THEN
      557     2618    3           DO;
      558     2619    3               I=1;
      559     2620    4               DO WHILE (I <= PATH_LIST.REC_NO(0));
      560     2621    4                   CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,PATH_LIST.REC_NO(I),
              2621                            TEMP_VALUE);
      561     2622    4                   IF PRESENCE_LIST.P_VALUE(TEMP_VALUE) = 0 THEN
      562     2623    5                   DO;
      563     2624    5                       J=I;
      564     2625    6                       DO WHILE (PATH_LIST.SET_NO(J) ~= 0);
      565     2626    6                           J=J+1;
      566     2627    6                           END;
      567     2628    6                       DO WHILE (I <= J);
      568     2629    6                           GEN_CODE_EPTR = PATH_LIST.INIT_EPTR(I);
      569     2630    6                           IF GEN_CODE_EPTR ~= ENTADDR(NIL) THEN
      570     2631    6                               CALL GEN_CODE_EPTR ALTRET(ERR_STATUS);
      571     2632    6                           GEN_CODE_EPTR = PATH_LIST.CONSTRAINT_EPTR(I);
      572     2633    6                           IF GEN_CODE_EPTR ~= ENTADDR(NIL) THEN
      573     2634    6                               CALL GEN_CODE_EPTR ALTRET(DONT_PRINT);
      574     2635    7                           IF '0'B THEN DO;
      575     2636    7   DONT_PRINT:                 ;
      576     2637    7                               ZI_PRINT_FLAG = '0'B;
      577     2638    7                               END;
      578     2639    6                           I=I+1;
      579     2640    7                           IF I <= J THEN DO;
      580     2641    7                               CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:19   
      581     2642    7                                  PATH_LIST.REC_NO(I),TEMP_VALUE);
      582     2643    7                               PRESENCE_LIST.P_VALUE(TEMP_VALUE) = 0;
      583     2644    7                               END;
      584     2645    6                           END;
      585     2646    5                       END;
      586     2647    4                   ELSE I=I+1;
      587     2648    4                   END;
      588     2649        /*
      589     2650          If print flag is still on, then output rec passed all constraints.
      590     2651          Therefore, if anything to be displayed was found new on the last
      591     2652          go round, print it. Else, if all to be displayed are old but
      592     2653          present, print it. Else, if all are old and one or more weren't
      593     2654          found this time, don't bother to print it since no new info (just
      594     2655          indicates end of set condition).
      595     2656        */
      596     2657    4               IF ZI_PRINT_FLAG THEN DO;
      597     2658    4   PRINT_CHECK:
      598     2659    5                   DO I = 1 TO PATH_LIST.REC_NO(0);
      599     2660    6                       IF PATH_LIST.DISPLAY_IND(I) THEN DO;
      600     2661    6                           CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,
      601     2662    6                              PATH_LIST.REC_NO(I),TEMP_VALUE);
      602     2663    7                           DO CASE(PRESENCE_LIST.P_VALUE(TEMP_VALUE));
      603     2664    7                           CASE(0); /* record not present */
      604     2665    7                               ZI_PRINT_FLAG = '0'B;
      605     2666    7                           CASE(%OLD); /* record value present, but old */
      606     2667    7                           CASE(%NEW); /* record value present and new */
      607     2668    7                               ZI_PRINT_FLAG = '1'B;
      608     2669    7                               EXIT PRINT_CHECK;
      609     2670    7                               END;
      610     2671    6                           END;
      611     2672    5                       END;
      612     2673    4                   END;
      613     2674    3               IF ZI_PRINT_FLAG THEN /* print it (finally) */
      614     2675    3                   CALL RETRIEVE_EXIT ALTRET(FINLBL);
      615     2676    3               END;
      616     2677        /*
      617     2678          Change all values marked new to old for next go round.
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:20   
      618     2679        */
      619     2680    3           DO I = 1 TO PRESENCE_LIST.REC_NO(0);
      620     2681    3               IF PRESENCE_LIST.P_VALUE(I) = %NEW THEN
      621     2682    3                   PRESENCE_LIST.P_VALUE(I) = %OLD;
      622     2683    3               END;
      623     2684    2   CHKSNGL:
      624     2685    2           IF PATH_LIST.REC_NO(0) = 1 THEN
      625     2686    2               GOTO NXTPORT;
      626     2687    2           END;
      627     2688        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:21   
      628     2689        /*
      629     2690          Now find the next port occurrence. If retrieval list is exhausted or
      630     2691          end-of-realm condition is detected, FINISH the areas and exit.
      631     2692        */
      632     2693    1   NXTPORT:
      633     2694    1       ZII$PARAMS='0'B;
      634     2695    2       DO CASE(ACCESS_LIST.PORT_TYPE);
      635     2696    2       CASE(%SERIAL_ACCESS);
      636     2697    2           IF PATH_LIST.REC_NO(0)>1 THEN
      637     2698    3           DO;
      638     2699    3               ZII$PARAMS.R_HALF(0)=3;
      639     2700    3               DR$=NAM1.DESC$(PATH_LIST.REC_NO(1));
      640     2701    3               ZII$PARAMS.L_HALF(1)=RECORD.RVA_OFF;
      641     2702    3               ZII$PARAMS.R_HALF(2)=%DBKEY;
      642     2703    3               ZII$PARAMS.R_HALF(3)=1;
      643     2704    3               CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,PATH_LIST.REC_NO(1),TEMP_VALUE)
              2704                        ;
      644     2705    3               ZII$INTEGER1=PRESENCE_LIST.DB_KEY_SAVE(TEMP_VALUE);
      645     2706    3               CALL ZII$FIND ALTRET(BAD_FIND);
      646     2707    3               IF UWA.DB_STATUS~='0000000' THEN
      647     2708    3                   GOTO BAD_FIND;
      648     2709    3               ZII$PARAMS='0'B;
      649     2710    3               END;
      650     2711    2           ZII$PARAMS.R_HALF(0)=3;
      651     2712    2           ZII$PARAMS.R_HALF(1)=%NEXT;
      652     2713    2           ZII$PARAMS.L_HALF(2)=RECORD.RVA_OFF;
      653     2714    2           ZII$PARAMS.L_HALF(3)=AREA.RVA_OFF;
      654     2715    2           CALL ZII$FIND ALTRET(BAD_FIND);
      655     2716    2       CASE(%DIRECT_ACCESS);
      656     2717    2           IF ACCESS_LIST.PORT_IDX < ACCESS_LIST.PORT_NUM THEN
      657     2718    3           DO;
      658     2719    3               ZII$PARAMS.R_HALF(0)=3;
      659     2720    3               DR$=NAM1.DESC$(PATH_LIST.REC_NO(1));
      660     2721    3               ZII$PARAMS.L_HALF(1)=RECORD.RVA_OFF;
      661     2722    3               ZII$PARAMS.R_HALF(2)=%DBKEY;
      662     2723    3               ZII$PARAMS.R_HALF(3)=1;
      663     2724    3               ZII$INTEGER1=ACCESS_LIST.DIRECT(ACCESS_LIST.PORT_IDX);
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:22   
      664     2725    3               ACCESS_LIST.PORT_IDX=ACCESS_LIST.PORT_IDX+1;
      665     2726    3               CALL ZII$FIND ALTRET(BAD_FIND);
      666     2727    3               END;
      667     2728    2           ELSE
      668     2729    2               GOTO FINLBL;
      669     2730    2       CASE(%KEYED_ACCESS);
      670     2731    2           ZII$PARAMS.R_HALF(0) = 4;
      671     2732    2           ZII$PARAMS.R_HALF(1) = %NEXT;
      672     2733    2           ZII$PARAMS.L_HALF(2) = NAM1.DESC$(ACCESS_LIST.PORT) -> RECORD.RVA_OFF;
      673     2734    2           ZII$PARAMS.R_HALF(3) = %USING;
      674     2735    2           ZII$PARAMS.L_HALF(4) = NAM1.DESC$(ACCESS_LIST.PORT_KEY) -> KEY.RVA_OFF;
      675     2736    2           CALL ZII$FIND ALTRET(BAD_FIND);
      676     2737    2           IF UWA.DB_STATUS = '0502100' /* end-of-set */ THEN
      677     2738    2               GOTO NXTPORT_IDX;
      678     2739    2           IF UWA.DB_STATUS ~= '0000000' THEN
      679     2740    2               GOTO BAD_FIND;
      680     2741    2       CASE(%CALC_ACCESS);
      681     2742    2           IF ACCESS_LIST.PORT_IDX < ACCESS_LIST.PORT_NUM THEN
      682     2743    3           DO;
      683     2744         /*
      684     2745            Move user specified calc key value(s) into UWA.
      685     2746            This EPTR altrets if it was executed once already.
      686     2747         */
      687     2748    3               GEN_CODE_EPTR=ACCESS_LIST.KEYED.MOVE(ACCESS_LIST.PORT_IDX);
      688     2749    3               CALL GEN_CODE_EPTR ALTRET(FIND_DUPE);
      689     2750         /*
      690     2751            Find the 1st record which matches these values.
      691     2752         */
      692     2753    3               ZII$PARAMS.R_HALF(0)=2;
      693     2754    3               ZII$PARAMS.R_HALF(1)=%ANY;
      694     2755    3               ZII$PARAMS.L_HALF(2)=NAM1.DESC$(ACCESS_LIST.PORT)->RECORD.RVA_OFF;
      695     2756    3               CALL ZII$FIND ALTRET(BAD_FIND);
      696     2757    4               DO WHILE ('0'B);
      697     2758         /*
      698     2759            Already found 1st occurrence of this calc key. Since
      699     2760            duplicates may be allowed, look for dupes. When run out
      700     2761            of dupes, find rec using next specified calc key, if any.
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:23   
      701     2762            1st, position to current of port record.
      702     2763         */
      703     2764    4   FIND_DUPE:      ;
      704     2765    4                   ZII$PARAMS.R_HALF(0)=2;
      705     2766    4                   ZII$PARAMS.R_HALF(1)=%CURRENT;
      706     2767    4                   ZII$PARAMS.L_HALF(2)=NAM1.DESC$(ACCESS_LIST.PORT)->RECORD.RVA_OFF;
      707     2768    4                   CALL ZII$FIND ALTRET(BAD_FIND);
      708     2769    4                   IF UWA.DB_STATUS ~= '0000000' THEN
      709     2770    4                       GOTO BAD_FIND;
      710     2771         /*
      711     2772            Now, try to find a duplicate.
      712     2773         */
      713     2774    4                   ZII$PARAMS='0'B;
      714     2775    4                   ZII$PARAMS.R_HALF(0)=2;
      715     2776    4                   ZII$PARAMS.R_HALF(1)=%DUPLICATE;
      716     2777    4                   ZII$PARAMS.L_HALF(2)=NAM1.DESC$(ACCESS_LIST.PORT)->RECORD.RVA_OFF;
      717     2778    4                   CALL ZII$FIND ALTRET(BAD_FIND);
      718     2779    4                   IF UWA.DB_STATUS='0502400' /* no such rec found */ THEN
      719     2780    5                   DO; /* No more duplicates */
      720     2781    5                       ACCESS_LIST.PORT_IDX = ACCESS_LIST.PORT_IDX + 1;
      721     2782    5                       GOTO NXTPORT;
      722     2783    5                       END;
      723     2784    4                   END;
      724     2785    3               END;
      725     2786    2           ELSE
      726     2787    2               GOTO FINLBL;
      727     2788    2       CASE(ELSE);
      728     2789         /* The parameter ACCESS_LIST is screwed. */
      729     2790    2           GOTO ERR_STATUS;
      730     2791    2           END;
      731     2792    2       DO WHILE('0'B);
      732     2793    2   NXTPORT_IDX: ;
      733     2794    2           IF ACCESS_LIST.PORT_IDX >= ACCESS_LIST.PORT_NUM THEN
      734     2795    2               GOTO FINLBL;
      735     2796    3           IF ACCESS_LIST.KEYED.MOVE(ACCESS_LIST.PORT_IDX) ~= ENTADDR(NIL) THEN DO;
      736     2797    3               GEN_CODE_EPTR = ACCESS_LIST.KEYED.MOVE(ACCESS_LIST.PORT_IDX);
      737     2798    3               CALL GEN_CODE_EPTR ALTRET(NXTPORT_INCIDX);
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:24   
      738     2799    4               DO WHILE('0'B);
      739     2800    4   NXTPORT_INCIDX: ;
      740     2801    4                   ACCESS_LIST.PORT_IDX = ACCESS_LIST.PORT_IDX + 1;
      741     2802    4                   GOTO NXTPORT_IDX;
      742     2803    4                   END;
      743     2804    3               ZII$PARAMS = '0'B;
      744     2805    3               ZII$PARAMS.R_HALF(0) = 3;
      745     2806    3               ZII$PARAMS.L_HALF(1) = NAM1.DESC$(ACCESS_LIST.PORT)->RECORD.RVA_OFF;
      746     2807    3               ZII$PARAMS.R_HALF(2) = %USING;
      747     2808    3               ZII$PARAMS.L_HALF(3) = NAM1.DESC$(ACCESS_LIST.PORT_KEY)->KEY.RVA_OFF;
      748     2809    3               END;
      749     2810    3           ELSE DO; /* No MOVE code supplied */
      750     2811    3               ACCESS_LIST.PORT_IDX = ACCESS_LIST.PORT_IDX + 1;
      751     2812    3               IF ACCESS_LIST.PORT_IDX >= ACCESS_LIST.PORT_NUM THEN
      752     2813    3                   GOTO FINLBL;
      753     2814    3               IF ACCESS_LIST.KEYED.MOVE(ACCESS_LIST.PORT_IDX) ~= ENTADDR(NIL) THEN
      754     2815    3                   GOTO NXTPORT_IDX;
      755     2816    3               CALL ZII$FIND_FIRST(ACCESS_LIST) ALTRET(ERR_STATUS);
      756     2817    3               ZII$PARAMS = '0'B;
      757     2818    3               ZII$PARAMS.R_HALF(0) = 3;
      758     2819    3               ZII$PARAMS.L_HALF(1) = NAM1.DESC$(ACCESS_LIST.PORT)->RECORD.RVA_OFF;
      759     2820    3               ZII$PARAMS.R_HALF(2) = %USING;
      760     2821    3               ZII$PARAMS.L_HALF(3) = NAM1.DESC$(ACCESS_LIST.PORT_KEY)->KEY.RVA_OFF;
      761     2822    3               CALL ZII$FIND ALTRET(BAD_FIND);
      762     2823    3               IF UWA.DB_STATUS = '0502100' /* end-of-set */ THEN
      763     2824    3                   GOTO NXTPORT_IDX;
      764     2825    3               IF UWA.DB_STATUS ~= '0000000' AND
      765     2826    3                  UWA.DB_STATUS ~= '0502401' /* key val of rec found is
      766     2827         greater than specified val */
      767     2828    3               THEN GOTO BAD_FIND;
      768     2829    3               ZII$PARAMS = '0'B;
      769     2830    3               ZII$PARAMS.R_HALF(0)=4;
      770     2831    3               ZII$PARAMS.R_HALF(1)=%FIRST;
      771     2832    3               ZII$PARAMS.L_HALF(2)=NAM1.DESC$(ACCESS_LIST.PORT) -> RECORD.RVA_OFF;
      772     2833    3               ZII$PARAMS.R_HALF(3) = %USING;
      773     2834    3               ZII$PARAMS.L_HALF(4) = NAM1.DESC$(ACCESS_LIST.PORT_KEY)->KEY.RVA_OFF;
      774     2835    3               END;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:25   
      775     2836    2           CALL ZII$FIND ALTRET(BAD_FIND);
      776     2837    2           IF UWA.DB_STATUS = '0502100' /* end-of-set */ THEN
      777     2838    2               GOTO NXTPORT_IDX;
      778     2839    2           IF UWA.DB_STATUS ~= '0000000' AND
      779     2840    2              UWA.DB_STATUS ~= '0502401' /* key val of rec found is greater
      780     2841         than specified value */
      781     2842    2           THEN GOTO BAD_FIND;
      782     2843    2           END;
      783     2844    1   CHKPORT: IF UWA.DB_STATUS='0502100' /* end-of-set */ THEN
      784     2845    2       DO;
      785     2846    2           GEN_CODE_EPTR=PATH_LIST.INIT_EPTR(1);
      786     2847    2           CALL GEN_CODE_EPTR;
      787     2848    2           GOTO FINLBL;
      788     2849    2           END;
      789     2850    1       IF UWA.DB_STATUS = '0502400' /* no such rec found */ THEN
      790     2851    1           GOTO NXTPORT;
      791     2852    1       ELSE
      792     2853    1           IF UWA.DB_STATUS ~= '0000000' AND
      793     2854    1              UWA.DB_STATUS ~= '0502401' /* key val of rec found is greater
      794     2855         than specified value */
      795     2856    1           THEN GOTO BAD_FIND;
      796     2857    1       CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,PATH_LIST.REC_NO(1),TEMP_VALUE);
      797     2858    1       PRESENCE_LIST.P_VALUE(TEMP_VALUE)=%NEW;
      798     2859    1       PRESENCE_LIST.DB_KEY_SAVE(TEMP_VALUE)=UWA.DIRECT_REFERENCE;
      799     2860    1       IF PATH_LIST.GET_IND(1) THEN
      800     2861    2       DO;
      801     2862    2           ZII$PARAMS='0'B;
      802     2863    2           ZII$PARAMS.R_HALF(0)=1;
      803     2864    2           DR$=NAM1.DESC$(PATH_LIST.REC_NO(1));
      804     2865    2           ZII$PARAMS.L_HALF(1)=RECORD.RVA_OFF;
      805     2866    2           CALL ZII$GET ALTRET(BAD_GET);
      806     2867    2           IF UWA.DB_STATUS='0000000' THEN
      807     2868    3           DO;
      808     2869    3               ALL_BRANCHES_DONE=0;
      809     2870    3               GEN_CODE_EPTR=PATH_LIST.CONVERT_EPTR(1);
      810     2871    3               CALL GEN_CODE_EPTR;
      811     2872    3               IF ACCESS_LIST.PORT_TYPE = %KEYED_ACCESS AND
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:26   
      812     2873    4                  ACCESS_LIST.KEYED.CHECK(ACCESS_LIST.PORT_IDX)~=ENTADDR(NIL) THEN DO;
      813     2874    4                   GEN_CODE_EPTR=ACCESS_LIST.KEYED.CHECK(ACCESS_LIST.PORT_IDX);
      814     2875    4                   CALL GEN_CODE_EPTR ALTRET(NXTPORT_IDX);
      815     2876    4                   END;
      816     2877    3               GEN_CODE_EPTR=PATH_LIST.CONSTRAINT_EPTR(1);
      817     2878    3               IF GEN_CODE_EPTR~=ENTADDR(NIL) THEN
      818     2879    3                   CALL GEN_CODE_EPTR ALTRET(NXTPORT);
      819     2880    3               END;
      820     2881    2           ELSE
      821     2882    3           DO;
      822     2883    3               GEN_CODE_EPTR=PATH_LIST.INIT_EPTR(1);
      823     2884    3               CALL GEN_CODE_EPTR;
      824     2885    3               GOTO FINLBL;
      825     2886    3               END;
      826     2887    2           END;
      827     2888    2       DO I=1 TO PATH_LIST.REC_NO(0);
      828     2889    2           PATH_LIST.FIND_ATTEMPTED(I)='0'B;
      829     2890    2           END;
      830     2891    1       IF PATH_LIST.REC_NO(0)=1 THEN
      831     2892    1           GOTO OUTLBL;
      832     2893    1       ELSE
      833     2894    2       DO;
      834     2895    3           DO I=1 TO PATH_LIST.REC_NO(0);
      835     2896    3               PATH_LIST.BRANCH_EXHAUSTED(I)='0'B;
      836     2897    3               END;
      837     2898    2           N=1;
      838     2899    2           CURRENT_BRANCH=1;
      839     2900         /*
      840     2901            Set all find first flags for all records indicated as
      841     2902            set members in the path. Don't bother to set it for records
      842     2903            which indicate the start of a new branch.
      843     2904         */
      844     2905    3           DO I=1 TO PATH_LIST.REC_NO(0)-1;
      845     2906    3               IF NOT PATH_LIST.OWN_NEXT(I) AND PATH_LIST.SET_NO(I)~=0 THEN
      846     2907    3                   PATH_LIST.FIND_FIRST(I+1)='1'B;
      847     2908    3               END;
      848     2909    2           GOTO RECUR;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:27   
      849     2910    2           END;
      850     2911        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:28   
      851     2912        /*
      852     2913          This database has been exhaustively searched; FINISH all areas that
      853     2914          were previously READied and then RETURN.
      854     2915        */
      855     2916    1   FINLBL:
      856     2917    1       ZII$PARAMS='0'B;
      857     2918    1       ZII$PARAMS.R_HALF(0)=2;
      858     2919    1       ZII$PARAMS.R_HALF(1)=1;
      859     2920    1       ZII$PARAMS.R_HALF(2)=1;
      860     2921    1       ZII$INTEGER1=2;
      861     2922    1       ZII$INTEGER2=0;
      862     2923    1       CALL ZII$CHECK ALTRET(ERR_STATUS);
      863     2924    1       ZII$PARAMS.R_HALF(0)=0;
      864     2925    1       CALL ZII$FINISH ALTRET(BAD_FINISH);
      865     2926    1       ZI_RETRIEVING = '0'B;
      866     2927    1       STATUS_CODE=0;
      867     2928    1       RETURN;
      868     2929    1   ERR_STATUS:
      869     2930    1       STATUS_CODE=%ZII_INTERNAL_ERROR;
      870     2931    1       ZII$PARAMS.R_HALF(0)=0;
      871     2932    1       CALL ZII$FINISH ALTRET(BAD_FINISH);
      872     2933    1       ZI_RETRIEVING = '0'B;
      873     2934    1       ALTRETURN;
      874     2935    1   BAD_FIND:
      875     2936    1       DB_STATUS_SAVE=UWA.DB_STATUS;
      876     2937    1       STATUS_CODE=%ZII_BAD_FIND;
      877     2938    1       ZII$PARAMS.R_HALF(0)=0;
      878     2939    1       CALL ZII$FINISH ALTRET(BAD_FINISH);
      879     2940    1       ZI_RETRIEVING = '0'B;
      880     2941    1       UWA.DB_STATUS=DB_STATUS_SAVE;
      881     2942    1       ALTRETURN;
      882     2943    1   BAD_GET:
      883     2944    1       DB_STATUS_SAVE=UWA.DB_STATUS;
      884     2945    1       STATUS_CODE=%ZII_BAD_GET;
      885     2946    1       ZII$PARAMS.R_HALF(0)=0;
      886     2947    1       CALL ZII$FINISH ALTRET(BAD_FINISH);
      887     2948    1       ZI_RETRIEVING = '0'B;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:29   
      888     2949    1       UWA.DB_STATUS=DB_STATUS_SAVE;
      889     2950    1       ALTRETURN;
      890     2951    1   BAD_READY:
      891     2952    1       IF UWA.DB_STATUS = '1370079' /* can't READY integrated area */ THEN
      892     2953    1           STATUS_CODE = %ZII_CANT_OPEN_AREA;
      893     2954    1       ELSE
      894     2955    1           IF UWA.DB_STATUS = '1370080' /* can't READY altkey file */ THEN
      895     2956    1               STATUS_CODE = %ZII_CANT_OPEN_ALTKEYFILE;
      896     2957    1           ELSE
      897     2958    1               STATUS_CODE = %ZII_BAD_READY;
      898     2959    1       DB_STATUS_SAVE = UWA.DB_STATUS;
      899     2960    1       ZII$PARAMS.R_HALF(0) = 0;
      900     2961    1       CALL ZII$FINISH ALTRET(BAD_FINISH);
      901     2962    1       ZI_RETRIEVING = '0'B;
      902     2963    1       UWA.DB_STATUS = DB_STATUS_SAVE;
      903     2964    1       ALTRETURN;
      904     2965    1   BAD_HIA:
      905     2966    1       STATUS_CODE=%ZII_BAD_HIA;
      906     2967    1       ALTRETURN;
      907     2968    1   BAD_FINISH:
      908     2969    1       STATUS_CODE=%ZII_BAD_FINISH;
      909     2970    1       ZI_RETRIEVING = '0'B;
      910     2971    1       ALTRETURN;
      911     2972    1   BAD_RECURSION:
      912     2973    1       DB_STATUS_SAVE=UWA.DB_STATUS;
      913     2974    1       ZII$PARAMS.R_HALF(0)=0;
      914     2975    1       CALL ZII$FINISH ALTRET(BAD_FINISH);
      915     2976    1       ZI_RETRIEVING = '0'B;
      916     2977    1       UWA.DB_STATUS=DB_STATUS_SAVE;
      917     2978    1       ALTRETURN;
      918     2979    1   BAD_BUFFERS:
      919     2980    1       STATUS_CODE=%ZII_BAD_BUF;
      920     2981    1       ZI_RETRIEVING = '0'B;
      921     2982    1       ALTRETURN;
      922     2983         %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:30   
      923     2984        /*
      924     2985          This routine evaluates the PRESENCE_LIST and determines where on the
      925     2986          Path the next database FIND should be performed.
      926     2987        */
      927     2988    1   EVAL_PRESENCE: PROC;
      928     2989    2   DCL COUNTER UBIN AUTO;
      929     2990    2   DCL EXHAUSTED_BRANCHES UBIN AUTO;
      930     2991    2   DCL COUNTER_OF_BRANCHES UBIN AUTO;
      931     2992    2   DCL CHK_PIVOT BIT(1) ALIGNED;
      932     2993        /**/
      933     2994        /* This section sets START_OF_BRANCH to the start node of
      934     2995           NEXT_BRANCH in the Path List.                      */
      935     2996    2   BGIN: IF NEXT_BRANCH=1 THEN
      936     2997    2           START_OF_BRANCH=1;
      937     2998    2       ELSE
      938     2999    3       DO;
      939     3000    3           COUNTER=1;
      940     3001    3           START_OF_BRANCH=1;
      941     3002    4           DO WHILE(START_OF_BRANCH<=PATH_LIST.REC_NO(0));
      942     3003    4               IF PATH_LIST.SET_NO(START_OF_BRANCH)=0 THEN
      943     3004    5               DO;
      944     3005    5                   COUNTER=COUNTER+1;
      945     3006    5                   IF COUNTER=NEXT_BRANCH THEN
      946     3007    6                   DO;
      947     3008    6                       START_OF_BRANCH=START_OF_BRANCH+1;
      948     3009    6                       GOTO FOUND;
      949     3010    6                       END;
      950     3011    5                   END;
      951     3012    4               START_OF_BRANCH=START_OF_BRANCH+1;
      952     3013    4               END;
      953     3014    3           END;
      954     3015        /* This section finds the new starting node to perform the next
      955     3016           FIND on the newly found NEXT_BRANCH.                           */
      956     3017    2   FOUND: IF PATH_LIST.BRANCH_EXHAUSTED(START_OF_BRANCH)='0'B THEN
      957     3018    3       DO;
      958     3019    3           COUNTER=START_OF_BRANCH;
      959     3020    4           DO WHILE(PATH_LIST.SET_NO(COUNTER)~=0);
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:31   
      960     3021    4               COUNTER=COUNTER+1;
      961     3022    4               END;
      962     3023    3           END;
      963     3024    2       ELSE
      964     3025    2           GOTO NEWBR;
      965     3026    2   BACKUP: COUNTER=COUNTER-1;
      966     3027    2       IF COUNTER=START_OF_BRANCH THEN
      967     3028    3       DO;
      968     3029    3           IF PATH_LIST.BRANCH_EXHAUSTED(COUNTER)='1'B THEN
      969     3030    3               GOTO NEWBR;
      970     3031    3           ELSE
      971     3032    3               IF PATH_LIST.OWN_NEXT(COUNTER)='0'B THEN
      972     3033    4               DO;
      973     3034    4                   N=COUNTER;
      974     3035    4                   CALL EVALBR;
      975     3036    4                   END;
      976     3037    3               ELSE
      977     3038    4               DO;
      978     3039    4                   IF PATH_LIST.FIND_ATTEMPTED(START_OF_BRANCH)='0'B THEN
      979     3040    4                       N=START_OF_BRANCH;
      980     3041    4                   ELSE
      981     3042    5                   DO;
      982     3043    5                       PATH_LIST.BRANCH_EXHAUSTED(COUNTER)='1'B;
      983     3044    5                       GOTO NEWBR;
      984     3045    5                       END;
      985     3046    4                   END;
      986     3047    3           END;
      987     3048    3       ELSE DO; /* COUNTER ~= START_OF_BRANCH */
      988     3049         /*
      989     3050            If we're inside a branch and the set is exhausted (or it's an
      990     3051            owner), we want to back up one. But, if this is the pivot node
      991     3052            of a lambda structure and this is the 1st branch (i.e.,
      992     3053            START_OF_BRANCH is before the pivot point), then we don't want
      993     3054            to back up unless all other branches for this particular
      994     3055            pivot record are exhausted or we'll lose some records. So, if
      995     3056            all other branches aren't done yet, goto next branch instead.
      996     3057         */
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:32   
      997     3058    3           CHK_PIVOT = '1'B;
      998     3059    4           IF PATH_LIST.OWN_NEXT(COUNTER) = '0'B THEN DO; /* member */
      999     3060    4               CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,
     1000     3061    4                  PATH_LIST.REC_NO(COUNTER),TEMP_VALUE);
     1001     3062    5               IF PRESENCE_LIST.P_VALUE(TEMP_VALUE) > 0 THEN DO;
     1002     3063    5                   CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,
     1003     3064    5                      PATH_LIST.REC_NO(COUNTER+1),TEMP_VALUE);
     1004     3065    6                   IF PRESENCE_LIST.P_VALUE(TEMP_VALUE) > 0 THEN DO;
     1005     3066    6                       N = COUNTER;
     1006     3067    6                       CHK_PIVOT = '0'B;
     1007     3068    6                       END;
     1008     3069    5                   END;
     1009     3070    4               END;
     1010     3071    4           IF CHK_PIVOT THEN DO;
              3071                    /* It's an owner (or a member & may want to back up) */
     1011     3072    4               IF NEXT_BRANCH = 1 AND BRANCH_COUNT > 1 AND
     1012     3073    4                  COUNTER = PIVOT_REC_IDX THEN
     1013     3074    5               DO I = COUNTER TO PATH_LIST.REC_NO(0)-1;
     1014     3075    5                   IF PATH_LIST.SET_NO(I) = 0 AND
     1015     3076    5                      NOT PATH_LIST.BRANCH_EXHAUSTED(I+1) THEN
     1016     3077    5                       GOTO NEWBR;
     1017     3078    5                   END;
     1018     3079    4               GOTO BACKUP;
     1019     3080    4               END;
     1020     3081    3           END;
     1021     3082        /*
     1022     3083           If we're ready to go around the lambda loop again and we might be
     1023     3084           doing a find next on a new pivot record for the lambda structure,
     1024     3085           want to set all the find_attempted and branch_exhausted flags off
     1025     3086           for all 2nd and higher branches. (Since the 1st branch always
     1026     3087           starts with the port rec, it will always be cleared when the new
     1027     3088           port is found. Prior to that, it's not exhausted yet.)
     1028     3089        */
     1029     3090    2       IF NEXT_BRANCH=1 AND BRANCH_COUNT>1 AND N < PIVOT_REC_IDX THEN
     1030     3091    3       DO;
     1031     3092    3           I=1;
     1032     3093    4           DO WHILE (PATH_LIST.SET_NO(I)~=0);
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:33   
     1033     3094    4               I=I+1;
     1034     3095    4               END;
     1035     3096    3           I=I+1;
     1036     3097    4           DO WHILE (I<=PATH_LIST.REC_NO(0));
     1037     3098    4               PATH_LIST.FIND_ATTEMPTED(I)='0'B;
     1038     3099    4               PATH_LIST.BRANCH_EXHAUSTED(I) = '0'B;
     1039     3100    4               I=I+1;
     1040     3101    4               END;
     1041     3102    3           END;
     1042     3103    2       RETURN;
     1043     3104    2   NEWBR: IF NEXT_BRANCH=BRANCH_COUNT THEN
     1044     3105    2           NEXT_BRANCH=1;
     1045     3106    2       ELSE
     1046     3107    2           NEXT_BRANCH=NEXT_BRANCH+1;
     1047     3108    2       CALL EVALBR;
     1048     3109    2       IF ALL_BRANCHES_DONE=0 THEN
     1049     3110    2           GOTO BGIN;
     1050     3111    2       ELSE
     1051     3112    2           RETURN;
     1052     3113        /* This section tests all branches to determine whether a new
     1053     3114           port occurrence is to be found.                               */
     1054     3115    2   EVALBR: PROC;
     1055     3116    3       COUNTER=1;
     1056     3117    3       COUNTER_OF_BRANCHES=1;
     1057     3118    3       EXHAUSTED_BRANCHES=0;
     1058     3119    4       DO WHILE (COUNTER_OF_BRANCHES<=BRANCH_COUNT);
     1059     3120    4           IF PATH_LIST.BRANCH_EXHAUSTED(COUNTER)='1'B THEN
     1060     3121    4               EXHAUSTED_BRANCHES=EXHAUSTED_BRANCHES+1;
     1061     3122    5           DO WHILE(PATH_LIST.SET_NO(COUNTER)~=0);
     1062     3123    5               COUNTER=COUNTER+1;
     1063     3124    5               END;
     1064     3125    4           IF COUNTER<PATH_LIST.REC_NO(0) THEN
     1065     3126    4               COUNTER=COUNTER+1;
     1066     3127    4           COUNTER_OF_BRANCHES=COUNTER_OF_BRANCHES+1;
     1067     3128    4           END;
     1068     3129    3       IF EXHAUSTED_BRANCHES=BRANCH_COUNT THEN
     1069     3130    3           ALL_BRANCHES_DONE=1;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:34   
     1070     3131    3       RETURN;
     1071     3132    3   END EVALBR;
     1072     3133    2   END EVAL_PRESENCE;
     1073     3134         %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:35   
     1074     3135    1   SET_PRESENCE_LIST: PROC;
     1075     3136    2   DCL I UBIN AUTO;
     1076     3137    2   DCL J UBIN AUTO;
     1077     3138    2   DCL K UBIN AUTO;
     1078     3139    2   DCL MEMBER_OF_LIST UBIN AUTO;
     1079     3140        /**/
     1080     3141    2       I=1;
     1081     3142    2       J=1;
     1082     3143    3       DO WHILE (J<=PATH_LIST.REC_NO(0));
     1083     3144    3           K=1;
     1084     3145    3           MEMBER_OF_LIST=0;
     1085     3146    4           DO WHILE (K<J);
     1086     3147    4               IF PATH_LIST.REC_NO(K)=PATH_LIST.REC_NO(J) THEN
     1087     3148    5               DO;
     1088     3149    5                   MEMBER_OF_LIST=1;
     1089     3150    5                   K=J;
     1090     3151    5                   END;
     1091     3152    4               K=K+1;
     1092     3153    4               END;
     1093     3154    3           IF MEMBER_OF_LIST=0 THEN
     1094     3155    4           DO;
     1095     3156    4               PRESENCE_LIST.REC_NO(I)=PATH_LIST.REC_NO(J);
     1096     3157    4               PRESENCE_LIST.P_VALUE(I)=0;
     1097     3158    4               PRESENCE_LIST.DB_KEY_SAVE(I)=0;
     1098     3159    4               PRESENCE_LIST.REC_NO(0)=I;
     1099     3160    4               I=I+1;
     1100     3161    4               END;
     1101     3162    3           J=J+1;
     1102     3163    3           END;
     1103     3164    2       RETURN;
     1104     3165    2   END SET_PRESENCE_LIST;
     1105     3166        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:36   
     1106     3167    1   RESTORE_CURRENCY: PROC ALTRET;
     1107     3168    2   DCL I UBIN AUTO;
     1108     3169    2   DCL J UBIN AUTO;
     1109     3170        /**/
     1110     3171    3       IF ACCESS_LIST.PORT_TYPE = %KEYED_ACCESS THEN DO;
     1111     3172    3           J = 2;
     1112     3173    3           CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,PATH_LIST.REC_NO(1),TEMP_VALUE);
     1113     3174    4           IF PRESENCE_LIST.P_VALUE(TEMP_VALUE) > 0 THEN DO;
     1114     3175    4               ZII$PARAMS = '0'B;
     1115     3176    4               ZII$PARAMS.R_HALF(0) = 3;
     1116     3177    4               ZII$PARAMS.L_HALF(1) = NAM1.DESC$(ACCESS_LIST.PORT)->RECORD.RVA_OFF;
     1117     3178    4               ZII$PARAMS.R_HALF(2) = %USING;
     1118     3179    4               ZII$PARAMS.L_HALF(3) = NAM1.DESC$(ACCESS_LIST.PORT_KEY)->KEY.RVA_OFF;
     1119     3180    4               CALL ZII$FIND ALTRET(BAD_RESTORE);
     1120     3181    4               IF UWA.DB_STATUS ~= '0000000' THEN
     1121     3182    4                   ALTRETURN;
     1122     3183    4               IF PRESENCE_LIST.DB_KEY_SAVE(TEMP_VALUE) ~= UWA.DIRECT_REFERENCE
     1123     3184    5               THEN DO;
     1124     3185    5                   TEMP_VALUE = PRESENCE_LIST.DB_KEY_SAVE(TEMP_VALUE);
     1125     3186    5                   ZII$PARAMS = '0'B;
     1126     3187    5                   ZII$PARAMS.R_HALF(0) = 4;
     1127     3188    5                   ZII$PARAMS.R_HALF(1) = %NEXT;
     1128     3189    5                   ZII$PARAMS.L_HALF(2) = NAM1.DESC$(ACCESS_LIST.PORT)->RECORD.RVA_OFF;
     1129     3190    5                   ZII$PARAMS.R_HALF(3) = %USING;
     1130     3191    5                   ZII$PARAMS.L_HALF(4) = NAM1.DESC$(ACCESS_LIST.PORT_KEY)->KEY.RVA_OFF
              3191                            ;
     1131     3192    6                   DO UNTIL(TEMP_VALUE = UWA.DIRECT_REFERENCE);
     1132     3193    6                       CALL ZII$FIND ALTRET(BAD_RESTORE);
     1133     3194    6                       IF UWA.DB_STATUS ~= '0000000' THEN
     1134     3195    6                           ALTRETURN;
     1135     3196    6                       END;
     1136     3197    5                   END;
     1137     3198    4               END;
     1138     3199    3           END;
     1139     3200    2       ELSE
     1140     3201    2           J = 1;
     1141     3202    2       ZII$PARAMS = '0'B;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:37   
     1142     3203    2       ZII$PARAMS.R_HALF(0)=3;
     1143     3204    2       ZII$PARAMS.R_HALF(2)=%DBKEY;
     1144     3205    2       ZII$PARAMS.R_HALF(3)=1;
     1145     3206    3       DO I=J TO PATH_LIST.REC_NO(0);
     1146     3207    3           IF NOT PATH_LIST.REPEAT_IND(I) THEN
     1147     3208    4           DO;
     1148     3209    4               CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,PATH_LIST.REC_NO(I),TEMP_VALUE)
              3209                        ;
     1149     3210    4               IF PRESENCE_LIST.P_VALUE(TEMP_VALUE) > 0 THEN
     1150     3211    5               DO;
     1151     3212    5                   ZII$PARAMS.L_HALF(1)=NAM1.DESC$(PATH_LIST.REC_NO(I))->RECORD.RVA_OFF
              3212                            ;
     1152     3213    5                   ZII$INTEGER1=PRESENCE_LIST.DB_KEY_SAVE(TEMP_VALUE);
     1153     3214    5                   CALL ZII$FIND ALTRET(BAD_RESTORE);
     1154     3215    5                   IF UWA.DB_STATUS ~= '0000000' THEN
     1155     3216    5                       ALTRETURN;
     1156     3217    5                   END;
     1157     3218    4               END;
     1158     3219    3           END;
     1159     3220    2       RETURN;
     1160     3221    2   BAD_RESTORE:
     1161     3222    2       ALTRETURN;
     1162     3223    2   END RESTORE_CURRENCY;
     1163     3224        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:38   
     1164     3225    1   ARE_WE_SHARING: PROC ALTRET;
     1165     3226        /*
     1166     3227          This routine checks to see if this database is being used
     1167     3228          in concurrent access mode.
     1168     3229
     1169     3230          Sample calling sequence:
     1170     3231            WE_ARE_SHARING = '1'B;
     1171     3232            CALL ARE_WE_SHARING ALTRET(YES_WE_ARE);
     1172     3233            WE_ARE_SHARING = '0'B;
     1173     3234          YES_WE_ARE: ;
     1174     3235        */
     1175     3236        %INCLUDE B$ROSEG;
     1176     3299    2   DCL B$ROS$ PTR SYMREF;
     1177     3300        %F$DCB(BASED="BASED(DCB$)");
     1178     3357    2   DCL DCB$ PTR;
     1179     3358    2   DCL I UBIN;
     1180     3359    2   DCL NUMDCBS UBIN;
     1181     3360    2   DCL NAME CHAR(32);
     1182     3361        /**/
     1183     3362    2       NUMDCBS = B$ROS$ -> B$ROSEG.NUMDCBS;
     1184     3363    3       DO WHILE (DCBADDR(NUMDCBS) = ADDR(NIL));
     1185     3364    3           NUMDCBS = NUMDCBS - 1;
     1186     3365    3           END;
     1187     3366
     1188     3367    2       DA$ = NAM1.DESC$(0);
     1189     3368    3       DO WHILE (DA$ ~= ADDR(NIL));
     1190     3369    3           NAME = NAM1.NAME.TEXT(AREA.NAM_IDX);
     1191     3370    4           DO I=1 TO NUMDCBS;
     1192     3371    4               DCB$ = DCBADDR(I);
     1193     3372    4               IF DCB$ ~= ADDR(NIL) THEN
     1194     3373    4                   IF NAME = F$DCB.DCBNAME.N THEN
     1195     3374    4                       IF SHARE_TYPE=%SHAREALL OR SHARE_TYPE=%SHARECUR OR
     1196     3375    4                          (SHARE_TYPE=0 AND F$DCB.SHARE#=%ALL# AND
     1197     3376    4                          NOT F$DCB.UOPT#(0)) THEN
     1198     3377    4                           ALTRETURN;
     1199     3378    4                       ELSE
     1200     3379    4                           GOTO NEXT_AREA;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:39   
     1201     3380    4               END;
     1202     3381    3   NEXT_AREA:
     1203     3382    3           DA$ = AREA.LAREA$;
     1204     3383    3           END;
     1205     3384    2       RETURN;
     1206     3385    2   END ARE_WE_SHARING;
     1207     3386    1   END ZII$RETRIEVE;
     1208     3387        %EOD;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:40   
--  Include file information  --

   B$ROSEG.:LIB_E05  cannot be made into a system file and is referenced.
   ZI_IDPERR_SUBS.:ZIC0TOU  is referenced.
   ZI$PATH_STRUCTS.:ZIC0TOU  is referenced.
   ZI$DESC.:ZIC0TOU  is referenced.
   ZI$STRUCTS.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZII$RETRIEVE.

   Procedure ZII$RETRIEVE requires 2046 words for executable code.
   Procedure ZII$RETRIEVE requires 32 words of local(AUTO) storage.

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:41   

 Object Unit name= ZII$RETRIEVE                               File name= ZII$RET_LIB.:ZIC0TOU
 UTS= SEP 05 '97 12:30:15.96 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none   461    715  ZII$RETRIEVE
    1  LblCom even  none     1      1  CONSTRAINT_FAILED
    2  LblCom even  none     1      1  PIVOT_REC_IDX
    3  RtLbCm even  none     2      2  RETRIEVE_RETURN
    4  RtLbCm even  none     1      1  ZI_PRINT_FLAG
    5  RtLbCm even  none     1      1  ZI_RETRIEVING
    6   DCB   even  none     0      0  M$UC
    7  LblCom even  none     1      1  NAM1$
    8  LblCom even  none     1      1  NAM1_SIZ
    9  LblCom even  none     1      1  NAM1_IDX
   10  LblCom even  none     1      1  NAM2$
   11  LblCom even  none     1      1  NAM2_SIZ
   12  LblCom even  none     1      1  DESC#
   13  LblCom even  none     1      1  UWA$
   14  LblCom even  none     1      1  UWA_SIZ
   15  LblCom even  none     1      1  UWA#
   16  LblCom even  none     1      1  DA$
   17  LblCom even  none     1      1  DS$
   18  LblCom even  none     1      1  DR$
   19  LblCom even  none     1      1  DK$
   20  LblCom even  none     1      1  DRA$
   21  LblCom even  none     2      2  IA_
   22  LblCom even  none     2      2  UWA_
   23  LblCom even  none     2      2  RVA_
   24  RoData even  UTS     12     14  ZII$RETRIEVE
   25   Proc  even  none  2046   3776  ZII$RETRIEVE
   26  RoData even  none    14     16  ZII$RETRIEVE
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:42   

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    25      0   yes    yes     yes      Std        6  ZII$RETRIEVE

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 ZII$INVOKE
 yes     yes           Std       0 ZII$BUFFERS
 yes     yes           Std       0 ZII$READY
 yes     yes           Std       1 ZII$FIND_FIRST
         yes           Std       0 ZII$CLR_PARAMS
 yes     yes           Std       0 ZII$FIND
         yes           Std       3 ZII$FIND_PRESENCE_IDX
 yes     yes           Std       0 ZII$GET
 yes     yes           Std       0 ZII$CHECK
 yes     yes           Std       0 ZII$FINISH
 yes     yes           Std       5 ZII$RECURSE
                       nStd      0 X66_AUTO_N
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ZII$PARAMS                            ZII$INTEGER1                          ZII$INTEGER2
     M$UC                                  B$ROS$
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:43   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ROSID                                 NULLSID                               ISSID
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:44   


        1        1        /*M* ZII$RETRIEVE Performs actual database (IDS) data retrieval.   */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*P* NAME:       ZII$RETRIEVE
        8        8
        9        9             PURPOSE:    This module does the retrieval of databases accessed
       10       10                         by IDP. It uses information generated by the TOPOLOGY
       11       11                         module such as the Path list and the Access list. The
       12       12                         RETRIEVE module follows the directions given by the
       13       13                         Path list to traverse READYd areas in order to access
       14       14                         fields that were cited in the (IDP) DISPLAY command.
       15       15
       16       16            DESCRIPTION: When ZII$RETRIEVE is called by IDP (or some other
       17       17                         processor), the Path list is scanned cell by cell
       18       18                         with appropriate DB call being made along the way
       19       19                         in accordance with the Path list instructions. Each
       20       20                         branch of each lambda structure is traversed as far
       21       21                         as possible until either the end of the branches are
       22       22                         reached or an end-of-set condition is detected.
       23       23                         Then, an output routine is called by RETRIEVE to
       24       24                         display what was previously placed in the UWA.
       25       25                         ZII$RETRIEVE does all necessary READYs and FINISHes.
       26       26                                                                              */
       27       27        /*D* NAME:      ZII$RETRIEVE
       28       28
       29       29             CALL:      CALL ZII$RETRIEVE(PATH_LIST,ACCESS_LIST,AREA_LIST,
       30       30                                          OUTPUT_ROUTINE,STATUS_CODE,
       31       31                                          SHARE_TYPE) ALTRET(LBL);
       32       32
       33       33                        (called by IDP, from ZEG$REPORT)
       34       34
       35       35             INPUT:     PATH_LIST      - Array describing the path to be
       36       36                                         followed for a particular retrieval.
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:45   
       37       37                                         Contains records, sets, etc., in
       38       38                                         path order.
       39       39
       40       40                        ACCESS_LIST    - Contains information about the port
       41       41                                         record and how it is to be retrieved.
       42       42
       43       43                        AREA_LIST      - List of areas to be readied. If
       44       44                                         AREA_IDX = 0, all areas in the
       45       45                                         database should be readied.
       46       46
       47       47                        OUTPUT_ROUTINE - Routine supplied by the calling
       48       48                                         program to output a formatted output
       49       49                                         record made from pieces of retrieved
       50       50                                         database records which were marked
       51       51                                         for display.
       52       52
       53       53                        SHARE_TYPE     - How this database is to be shared.
       54       54
       55       55                                         NOSHARE    = 20
       56       56                                         SHAREALL   = 28
       57       57                                         SHAREANY   = 29
       58       58                                         SHAREIN    = 30
       59       59                                         SHARECUR   = 48
       60       60                                         SHAREINCUR = 49
       61       61
       62       62                                         (Equates found in ZI$DESC)
       63       63
       64       64             OUTPUT:    STATUS_CODE    - Contains error code describing the
       65       65                                         reason for an altreturn. 0 otherwise.
       66       66
       67       67                        An output record in the calling routine's specified
       68       68                        area.
       69       69
       70       70             DESCRIPTION: ZII$RETRIEVE is called by IDP after first calling
       71       71                          ZII$BUILD_TABLES to place the Topology and Subschema
       72       72                          tables into the Common dynamic segment, then calling
       73       73                          ZII$TOPOLOGY in order to build the Path list and
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:46   
       74       74                          Access lists.
       75       75
       76       76                                ZII$RETRIEVE starts by READYing the areas of
       77       77                          the users's database. If either the INVOKE (HIA) or
       78       78                          READY calls fail, then the ALTRETURN is taken.
       79       79                                Next, Retrieve determines from the Access list
       80       80                          whether the Port was declared (either by the user or
       81       81                          by Topology's Port Selector) to be Serial, Direct,
       82       82                          Indexed, or by Alternate Keys. Retrieve then
       83       83                          performs the appropriate FIND for the first occurrence
       84       84                          of the Port. If constraints are present, the Port
       85       85                          occurrence is checked against them to determine whether
       86       86                          it passed. If not, a new Port occurrence is found.
       87       87                          If it passed the constraint check, then Retrieve
       88       88                          proceeds to follow the Path list.
       89       89                                If only one record is involved in the search
       90       90                          (the port record is all that's required), then the
       91       91                          output routine is called immediately and Retrieve
       92       92                          looks for a new port record.
       93       93                                If there is more than one record involved in
       94       94                          the database retrieval, then Retrieve follows the
       95       95                          path list down each branch until it either hits
       96       96                          end of set while when trying to find a record
       97       97                          subordinate to the port record or reaches the
       98       98                          end of the branch. this procedure is done through
       99       99                          a call to a recursive routine which follows the Path
      100      100                          list down as far as it can for each branch. When
      101      101                          all branches have been tried for this pass, then the
      102      102                          output routine is called to make the UWA available
      103      103                          to the calling program. Then the appropriate position
      104      104                          on the next branch is determined in order to put
      105      105                          together another potential output record.
      106      106                                NOTE: The actual retrieval of records is done
      107      107                          by this module, but all constraint checking against
      108      108                          both present and non-present records is done by code
      109      109                          furnished by IDP via EPTRS. In particular, IDP assumes
      110      110                          that the PATH_LIST.INIT_EPTR(I) will be called ONLY
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:47   
      111      111                          when a record is not found. It will set a field for
      112      112                          IDP's use indicating that the record is not present.
      113      113                          Therefore, the PATH_LIST.CONVERT_EPTR(I) should be
      114      114                          used for all records actually present and the
      115      115                          INIT_EPTR for those which are not. Otherwise, the
      116      116                          constraint checking mechanism will not work correctly.
      117      117                                When Retrieve finds that all branches eminating
      118      118                          from the Port record have been exhausted, a new Port
      119      119                          record FIND is attempted. (A branch is considered to
      120      120                          be exhausted if (1) end of set has been reached for
      121      121                          all sets on the branch for which find-members are
      122      122                          done and any sets requiring find-owner operations
      123      123                          successfully found the owner or (2) the branch
      124      124                          contains sets for which only find-owner operations
      125      125                          must be done and all such owners were successfully
      126      126                          found. Any set indicated in the path list requires
      127      127                          either a find-member or find-owner operation, never
      128      128                          both.) If a new Port record occurrence is found,
      129      129                          then the procedure is repeated. Retrieval is
      130      130                          complete when no more new Port records are found.
      131      131                                Then Retrieve proceeds to FINISH all areas that
      132      132                          previously READYd and returns control to the calling
      133      133                          program.                                             */
      134      134        ZII$RETRIEVE: PROC (PATH_LIST,ACCESS_LIST,AREA_LIST,RETRIEVE_EXIT,STATUS_CODE,
               134            SHARE_TYPE) ALTRET;

    134 25 000000   000000 700200 xent  ZII$RETRIEVE TSX0  ! X66_AUTO_N
        25 000001   000040 000006                    ZERO    32,6

      135      135    1   DCL RETRIEVE_EXIT EPTR;
      136      136    1   DCL GEN_CODE_EPTR EPTR STATIC;
      137      137    1   DCL STATUS_CODE UBIN(36);
      138      138    1   DCL SHARE_TYPE UBIN HALF;
      139      139        /*
      140      140          PRESENCE_LIST.REC_NO(0) contains the count of all current members
      141      141          of the PRESENCE_LIST; i.e., the number of unique records involved
      142      142          in this display. P_VALUE indicates the presence value of a member
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:48   
      143      143          record (0 = not present, 1 = old value, 2 = new value).
      144      144        */
      145      145        %EQU OLD = 1;
      146      146        %EQU NEW = 2;
      147      147    1   DCL 1 PRESENCE_LIST (0:200) STATIC ALIGNED,
      148      148    1         2 REC_NO UBIN(18) UNAL,
      149      149    1         2 P_VALUE UBIN(18) UNAL,
      150      150    1         2 DB_KEY_SAVE UBIN(36) UNAL;
      151      151    1   DCL BRANCH_FAILED(0:50) BIT(1) STATIC ALIGNED;
      152      152    1   DCL CONSTRAINT_FAILED BIT(1) ALIGNED EXT;
      153      153    1   DCL 1 ZII$PARAMS (0:20) SYMREF,
      154      154    1         2 L_HALF UBIN(18) UNAL,
      155      155    1         2 R_HALF UBIN(18) UNAL;
      156      156    1   DCL ZII$INTEGER1 SBIN SYMREF;
      157      157    1   DCL ZII$INTEGER2 SBIN SYMREF;
      158      158    1   DCL DB_STATUS_SAVE CHAR(7) STATIC;
      159      159    1   DCL I UBIN STATIC;
      160      160    1   DCL J UBIN STATIC;
      161      161    1   DCL BRANCH_COUNT UBIN STATIC;
      162      162    1   DCL PIVOT_REC_IDX UBIN EXT;
      163      163    1   DCL ALL_BRANCHES_DONE UBIN STATIC;
      164      164    1   DCL N UBIN STATIC;
      165      165    1   DCL RETRIEVE_RETURN BIT(72) EXTROOT;
      166      166    1   DCL TEMP_VALUE UBIN AUTO;
      167      167    1   DCL NEXT_BRANCH UBIN AUTO;
      168      168    1   DCL START_OF_BRANCH UBIN AUTO;
      169      169    1   DCL CURRENT_BRANCH UBIN AUTO;
      170      170    1   DCL ZI_PRINT_FLAG BIT(1) EXTROOT;
      171      171    1   DCL SHARE_IND BIT(1);
      172      172    1   DCL ZI_RETRIEVING BIT(1) EXTROOT INIT('0'B);
      173      173         /* Used to indicate to ZEE$INTERRUPT, the
      174      174            IDP break routine, whether database
      175      175            retrieval is in progress or not */
      176      176        /**/
      177      177        %INCLUDE CP_6;
      178      258        %INCLUDE CP_6_SUBS;
      179      798        %INCLUDE ZI$STRUCTS;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:49   
      180      870        %NAM1;
      181      899        %NAM2;
      182      913        %UWA1;
      183      936        %INCLUDE ZI$DESC;
      184     1786        %DSC_AREA;
      185     1808        %DSC_SET;
      186     1850        %DSC_REC;
      187     1884        %DSC_KEY;
      188     1894        %DSC_RA;
      189     1909        %KEYWD_VAL;
      190     1956        %INCLUDE ZI$PATH_STRUCTS;
      191     2094        %PATH_DESC (STCLASS=" ");
      192     2134        %ACCESS_DESC (STCLASS=" ");
      193     2173        %AREA_LIST_DESC (STCLASS=" ");
      194     2180        %INCLUDE ZI_IDPERR_SUBS;
      195     2214        /**/
      196     2215        %VLP_VECTOR (FPTN=IA_,STCLASS=EXT);
      197     2230        %VLP_VECTOR (FPTN=UWA_,STCLASS=EXT);
      198     2245        %VLP_VECTOR (FPTN=RVA_,STCLASS=EXT);
      199     2260        /**/
      200     2261    1   DCL ZII$INVOKE ENTRY(3) ALTRET;
      201     2262    1   DCL ZII$READY ENTRY(0) ALTRET;
      202     2263    1   DCL ZII$FINISH ENTRY(0) ALTRET;
      203     2264    1   DCL ZII$FIND ENTRY(0) ALTRET;
      204     2265    1   DCL ZII$CHECK ENTRY(0) ALTRET;
      205     2266    1   DCL ZII$CLR_PARAMS ENTRY;
      206     2267    1   DCL ZII$RECURSE ENTRY(5) ALTRET;
      207     2268    1   DCL ZII$GET ENTRY(0) ALTRET;
      208     2269    1   DCL ZII$BUFFERS ENTRY(0) ALTRET;
      209     2270    1   DCL ZII$FIND_PRESENCE_IDX ENTRY(3);
      210     2271    1   DCL ZII$FIND_FIRST ENTRY(1) ALTRET;
      211     2272        /**/
      212     2273        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:50   
      213     2274        /*
      214     2275          Init all variables used as indicators for retrieval. STATUS_CODE
      215     2276          is the error indicator for the recursion. SET_PRESENCE_LIST init-
      216     2277          ializes the list that shows presence for each record after
      217     2278          database FINDs have been done.
      218     2279        */
      219     2280    1       STATUS_CODE=0;

   2280 25 000002   200007 470500                    LDP0    @STATUS_CODE,,AUTO
        25 000003   000000 450100                    STZ     0,,PR0

      220     2281    1       ALL_BRANCHES_DONE=0;

   2281 25 000004   000713 450000 0                  STZ     ALL_BRANCHES_DONE

      221     2282    1       CONSTRAINT_FAILED = '0'B;

   2282 25 000005   000000 450000 1                  STZ     CONSTRAINT_FAILED

      222     2283    1       N=1;

   2283 25 000006   000001 235007                    LDA     1,DL
        25 000007   000714 755000 0                  STA     N

      223     2284    1       ACCESS_LIST.PORT_IDX=0;

   2284 25 000010   000000 220003                    LDX0    0,DU
        25 000011   200004 471500                    LDP1    @ACCESS_LIST,,AUTO
        25 000012   100001 440100                    SXL0    1,,PR1

      224     2285    1       CALL SET_PRESENCE_LIST;

   2285 25 000013   003314 701000 25                 TSX1    SET_PRESENCE_LIST
        25 000014   000000 011000                    NOP     0

      225     2286        /*
      226     2287          If KEYED access and PORT_NUM is 0, then set PORT_NUM to 1 and
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:51   
      227     2288          KEYED.MOVE/CHECK to NIL.
      228     2289        */
      229     2290    1       IF ACCESS_LIST.PORT_TYPE = %KEYED_ACCESS AND

   2290 25 000015   200004 470500                    LDP0    @ACCESS_LIST,,AUTO
        25 000016   000001 220100                    LDX0    1,,PR0
        25 000017   000003 100003                    CMPX0   3,DU
        25 000020   000030 601000 25                 TNZ     s:2303
        25 000021   000002 221100                    LDX1    2,,PR0
        25 000022   000030 601000 25                 TNZ     s:2303

      230     2291    1          ACCESS_LIST.PORT_NUM = 0 THEN
      231     2292    2       DO;

      232     2293    2           ACCESS_LIST.PORT_NUM=1;

   2293 25 000023   000001 222003                    LDX2    1,DU
        25 000024   000002 742100                    STX2    2,,PR0

      233     2294    2           ACCESS_LIST.KEYED.MOVE(0)=ENTADDR(NIL);

   2294 25 000025   000000 236000 26                 LDQ     0
        25 000026   000003 756100                    STQ     3,,PR0

      234     2295    2           ACCESS_LIST.KEYED.CHECK(0)=ENTADDR(NIL);

   2295 25 000027   000004 756100                    STQ     4,,PR0

      235     2296    2           END;

      236     2297        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:52   
      237     2298        /*
      238     2299          HIA the database, get buffers and, if there is a list of areas
      239     2300          given, READY only those areas, else READY all areas in the
      240     2301          database.
      241     2302        */
      242     2303    1       ZII$PARAMS='0'B;

   2303 25 000030   000000 100400                    MLR     fill='000'O
        25 000031   000000 000001 26                 ADSC9   0                        cn=0,n=1
        25 000032   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84

      243     2304    1       CALL ZII$INVOKE(IA_,UWA_,RVA_) ALTRET(BAD_HIA);

   2304 25 000033   000002 630400 26                 EPPR0   2
        25 000034   000001 631400 26                 EPPR1   1
        25 000035   000000 701000 xent               TSX1    ZII$INVOKE
        25 000036   002634 702000 25                 TSX2    BAD_HIA

      244     2305    1       IF UWA.DB_STATUS~='0000000' THEN

   2305 25 000037   000000 470400 13                 LDP0    UWA$
        25 000040   040000 106500                    CMPC    fill='040'O
        25 000041   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 000042   000000 000007 24                 ADSC9   0                        cn=0,n=7
        25 000043   002571 601000 25                 TNZ     BAD_READY

      245     2306    1           GOTO BAD_READY;
      246     2307    1       ZI_RETRIEVING = '1'B;

   2307 25 000044   400000 236003                    LDQ     -131072,DU
        25 000045   000000 756000 5                  STQ     ZI_RETRIEVING

      247     2308    1       ZII$PARAMS='0'B;

   2308 25 000046   000000 100400                    MLR     fill='000'O
        25 000047   000000 000001 26                 ADSC9   0                        cn=0,n=1
        25 000050   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:53   

      248     2309    1       ZII$PARAMS.R_HALF(0)=2;

   2309 25 000051   000002 220003                    LDX0    2,DU
        25 000052   000000 440000 xsym               SXL0    ZII$PARAMS

      249     2310    1       ZII$PARAMS.R_HALF(1)=1;

   2310 25 000053   000001 221003                    LDX1    1,DU
        25 000054   000001 441000 xsym               SXL1    ZII$PARAMS+1

      250     2311    1       ZII$PARAMS.R_HALF(2)=1;

   2311 25 000055   000002 441000 xsym               SXL1    ZII$PARAMS+2

      251     2312    1       ZII$INTEGER1=50;

   2312 25 000056   000062 235007                    LDA     50,DL
        25 000057   000000 755000 xsym               STA     ZII$INTEGER1

      252     2313    1       ZII$INTEGER2=0;

   2313 25 000060   000000 450000 xsym               STZ     ZII$INTEGER2

      253     2314    1       CALL ZII$BUFFERS ALTRET(BAD_BUFFERS);

   2314 25 000061   000000 631400 26                 EPPR1   0
        25 000062   000000 701000 xent               TSX1    ZII$BUFFERS
        25 000063   002664 702000 25                 TSX2    BAD_BUFFERS

      254     2315    1       ZII$PARAMS='0'B;

   2315 25 000064   000000 100400                    MLR     fill='000'O
        25 000065   000000 000001 26                 ADSC9   0                        cn=0,n=1
        25 000066   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84

      255     2316    1       IF AREA_LIST.AREA_IDX(0)=0 THEN
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:54   

   2316 25 000067   200005 470500                    LDP0    @AREA_LIST,,AUTO
        25 000070   000000 235100                    LDA     0,,PR0
        25 000071   000117 601000 25                 TNZ     s:2331

      256     2317    2       DO;

      257     2318    2           IF SHARE_TYPE = 0 THEN

   2318 25 000072   200010 471500                    LDP1    @SHARE_TYPE,,AUTO
        25 000073   100000 220100                    LDX0    0,,PR1
        25 000074   000100 601000 25                 TNZ     s:2321

      258     2319    2               ZII$PARAMS.R_HALF(0) = 1;

   2319 25 000075   000001 221003                    LDX1    1,DU
        25 000076   000000 441000 xsym               SXL1    ZII$PARAMS
        25 000077   000104 710000 25                 TRA     s:2324

      259     2320    3           ELSE DO;

      260     2321    3               ZII$PARAMS.R_HALF(0) = 2;

   2321 25 000100   000002 221003                    LDX1    2,DU
        25 000101   000000 441000 xsym               SXL1    ZII$PARAMS

      261     2322    3               ZII$PARAMS.R_HALF(2) = SHARE_TYPE;

   2322 25 000102   100000 220100                    LDX0    0,,PR1
        25 000103   000002 440000 xsym               SXL0    ZII$PARAMS+2

      262     2323    3               END;

      263     2324    2           ZII$PARAMS.R_HALF(1)=%RETRIEVAL;

   2324 25 000104   000031 220003                    LDX0    25,DU
        25 000105   000001 440000 xsym               SXL0    ZII$PARAMS+1
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:55   

      264     2325    2           CALL ZII$READY ALTRET(BAD_READY);

   2325 25 000106   000000 631400 26                 EPPR1   0
        25 000107   000000 701000 xent               TSX1    ZII$READY
        25 000110   002571 702000 25                 TSX2    BAD_READY

      265     2326    2           IF UWA.DB_STATUS ~='0000000' THEN

   2326 25 000111   000000 470400 13                 LDP0    UWA$
        25 000112   040000 106500                    CMPC    fill='040'O
        25 000113   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 000114   000000 000007 24                 ADSC9   0                        cn=0,n=7
        25 000115   002571 601000 25                 TNZ     BAD_READY

      266     2327    2               GOTO BAD_READY;
      267     2328    2           END;

   2328 25 000116   000170 710000 25                 TRA     s:2353

      268     2329    1       ELSE
      269     2330    2       DO;

      270     2331    2           IF SHARE_TYPE = 0 THEN

   2331 25 000117   200010 471500                    LDP1    @SHARE_TYPE,,AUTO
        25 000120   100000 220100                    LDX0    0,,PR1
        25 000121   000125 601000 25                 TNZ     s:2334

      271     2332    2               ZII$PARAMS.R_HALF(0) = 2;

   2332 25 000122   000002 221003                    LDX1    2,DU
        25 000123   000000 441000 xsym               SXL1    ZII$PARAMS
        25 000124   000131 710000 25                 TRA     s:2337

      272     2333    3           ELSE DO;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:56   
      273     2334    3               ZII$PARAMS.R_HALF(0) = 3;

   2334 25 000125   000003 221003                    LDX1    3,DU
        25 000126   000000 441000 xsym               SXL1    ZII$PARAMS

      274     2335    3               ZII$PARAMS.R_HALF(3) = SHARE_TYPE;

   2335 25 000127   100000 220100                    LDX0    0,,PR1
        25 000130   000003 440000 xsym               SXL0    ZII$PARAMS+3

      275     2336    3               END;

      276     2337    2           ZII$PARAMS.R_HALF(2)=%RETRIEVAL;

   2337 25 000131   000031 220003                    LDX0    25,DU
        25 000132   000002 440000 xsym               SXL0    ZII$PARAMS+2

      277     2338    2           I=1;

   2338 25 000133   000001 235007                    LDA     1,DL
        25 000134   000710 755000 0                  STA     I

      278     2339    3           DO WHILE (I<=AREA_LIST.AREA_IDX(0));

   2339 25 000135   000000 236100                    LDQ     0,,PR0
        25 000136   000710 116000 0                  CMPQ    I
        25 000137   000170 602000 25                 TNC     s:2353

      279     2340    3               ZII$PARAMS.L_HALF(1)=NAM1.DESC$(AREA_LIST.AREA_IDX(I))->AREA.RVA_OFF;

   2340 25 000140   000710 235000 0                  LDA     I
        25 000141   000001 735000                    ALS     1
        25 000142   200005 470500                    LDP0    @AREA_LIST,,AUTO
        25 000143   000000 236105                    LDQ     0,AL,PR0
        25 000144   000012 402007                    MPY     10,DL
        25 000145   000000 471400 7                  LDP1    NAM1$
        25 000146   100011 473506                    LDP3    9,QL,PR1
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:57   
        25 000147   300000 720100                    LXL0    0,,PR3
        25 000150   000001 740000 xsym               STX0    ZII$PARAMS+1

      280     2341    3               CALL ZII$READY ALTRET(BAD_READY);

   2341 25 000151   000000 631400 26                 EPPR1   0
        25 000152   000000 701000 xent               TSX1    ZII$READY
        25 000153   002571 702000 25                 TSX2    BAD_READY

      281     2342    3               IF UWA.DB_STATUS~='0000000' THEN

   2342 25 000154   000000 470400 13                 LDP0    UWA$
        25 000155   040000 106500                    CMPC    fill='040'O
        25 000156   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 000157   000000 000007 24                 ADSC9   0                        cn=0,n=7
        25 000160   002571 601000 25                 TNZ     BAD_READY

      282     2343    3                   GOTO BAD_READY;
      283     2344    3               I=I+1;

   2344 25 000161   000710 235000 0                  LDA     I
        25 000162   000001 035007                    ADLA    1,DL
        25 000163   000710 755000 0                  STA     I

      284     2345    3               END;

   2345 25 000164   200005 471500                    LDP1    @AREA_LIST,,AUTO
        25 000165   100000 236100                    LDQ     0,,PR1
        25 000166   000710 116000 0                  CMPQ    I
        25 000167   000140 603000 25                 TRC     s:2340

      285     2346    2           END;

      286     2347        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:58   
      287     2348        /*
      288     2349          Determine for later use whether any AREAs have been opened
      289     2350          in SHARE mode; if so, SHARE_IND will be set to '1'B and
      290     2351          checkpointing will be done.
      291     2352        */
      292     2353    1       SHARE_IND='1'B;

   2353 25 000170   400000 236003                    LDQ     -131072,DU
        25 000171   200015 756100                    STQ     SHARE_IND,,AUTO

      293     2354    1       CALL ARE_WE_SHARING ALTRET(YES_WE_ARE);

   2354 25 000172   003661 701000 25                 TSX1    ARE_WE_SHARING
        25 000173   000175 702000 25                 TSX2    YES_WE_ARE

      294     2355    1       SHARE_IND='0'B;

   2355 25 000174   200015 450100                    STZ     SHARE_IND,,AUTO

      295     2356    1   YES_WE_ARE:
      296     2357        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:59   
      297     2358        /*
      298     2359          Count all the branches involved in this retrieval. At least one
      299     2360          Lambda structure is present if the number of branches counted is
      300     2361          > 1. Also, save the index into the Path List of the 1st occurrence
      301     2362          of the record where the lambda branching really starts. Call this
      302     2363          the PIVOT_REC_IDX.
      303     2364        */
      304     2365    1       N=1;

   2365 25 000175   000001 235007       YES_WE_ARE   LDA     1,DL
        25 000176   000714 755000 0                  STA     N

      305     2366    1       BRANCH_COUNT=1;

   2366 25 000177   000712 755000 0                  STA     BRANCH_COUNT

      306     2367    1       PIVOT_REC_IDX = 0;

   2367 25 000200   000000 450000 2                  STZ     PIVOT_REC_IDX

      307     2368    1       IF PATH_LIST.REC_NO(0) = 1 THEN

   2368 25 000201   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 000202   000000 220100                    LDX0    0,,PR0
        25 000203   000001 100003                    CMPX0   1,DU
        25 000204   000207 601000 25                 TNZ     s:2372

      308     2369    1           ALL_BRANCHES_DONE=1;

   2369 25 000205   000713 755000 0                  STA     ALL_BRANCHES_DONE
        25 000206   000261 710000 25                 TRA     s:2398

      309     2370    1       ELSE
      310     2371    2       DO;

      311     2372    2           I=2;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:60   
   2372 25 000207   000002 236007                    LDQ     2,DL
        25 000210   000710 756000 0                  STQ     I

      312     2373    3           DO WHILE (I<=PATH_LIST.REC_NO(0));

   2373 25 000211   000000 236100                    LDQ     0,,PR0
        25 000212   000022 772000                    QRL     18
        25 000213   000710 116000 0                  CMPQ    I
        25 000214   000261 602000 25                 TNC     s:2398

      313     2374    3               J=1;

   2374 25 000215   000001 235007                    LDA     1,DL
        25 000216   000711 755000 0                  STA     J

      314     2375    4               DO WHILE (J<I);

   2375 25 000217   000711 236000 0                  LDQ     J
        25 000220   000710 116000 0                  CMPQ    I
        25 000221   000251 603000 25                 TRC     s:2385

      315     2376    4                   IF PATH_LIST.REC_NO(J)=PATH_LIST.REC_NO(I) THEN

   2376 25 000222   000711 236000 0                  LDQ     J
        25 000223   000005 402007                    MPY     5,DL
        25 000224   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 000225   000000 220106                    LDX0    0,QL,PR0
        25 000226   000710 236000 0                  LDQ     I
        25 000227   000005 402007                    MPY     5,DL
        25 000230   000000 100106                    CMPX0   0,QL,PR0
        25 000231   000243 601000 25                 TNZ     s:2383

      316     2377    5                   DO;

      317     2378    5                       IF PIVOT_REC_IDX = 0 THEN

   2378 25 000232   000000 235000 2                  LDA     PIVOT_REC_IDX
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:61   
        25 000233   000236 601000 25                 TNZ     s:2380

      318     2379    5                           PIVOT_REC_IDX = J;

   2379 25 000234   000711 235000 0                  LDA     J
        25 000235   000000 755000 2                  STA     PIVOT_REC_IDX

      319     2380    5                       BRANCH_COUNT=BRANCH_COUNT+1;

   2380 25 000236   000712 235000 0                  LDA     BRANCH_COUNT
        25 000237   000001 035007                    ADLA    1,DL
        25 000240   000712 755000 0                  STA     BRANCH_COUNT

      320     2381    5                       J=I;

   2381 25 000241   000710 235000 0                  LDA     I
        25 000242   000711 755000 0                  STA     J

      321     2382    5                       END;

      322     2383    4                   J=J+1;

   2383 25 000243   000711 235000 0                  LDA     J
        25 000244   000001 035007                    ADLA    1,DL
        25 000245   000711 755000 0                  STA     J

      323     2384    4                   END;

   2384 25 000246   000711 236000 0                  LDQ     J
        25 000247   000710 116000 0                  CMPQ    I
        25 000250   000222 602000 25                 TNC     s:2376

      324     2385    3               I=I+1;

   2385 25 000251   000710 235000 0                  LDA     I
        25 000252   000001 035007                    ADLA    1,DL
        25 000253   000710 755000 0                  STA     I
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:62   

      325     2386    3               END;

   2386 25 000254   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 000255   000000 236100                    LDQ     0,,PR0
        25 000256   000022 772000                    QRL     18
        25 000257   000710 116000 0                  CMPQ    I
        25 000260   000215 603000 25                 TRC     s:2374

      326     2387    2           END;

      327     2388        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:63   
      328     2389        /*
      329     2390          Now retrieve a port occurrence. If access was SERIAL then the
      330     2391          first instance of the Port record was the first occurrence in the
      331     2392          database. If calc, then that record whose calc-key matches the
      332     2393          one specified in the WHEN clause of the DISPLAY command will be
      333     2394          retrieved. If KEYED access then either an alternate key or index
      334     2395          key will be used for retrieval. If DIRECT then a DB_KEY from the list
      335     2396          contained in ACCESS_LIST will be used.
      336     2397        */
      337     2398    1       ZII$PARAMS='0'B;

   2398 25 000261   000000 100400                    MLR     fill='000'O
        25 000262   000000 000001 26                 ADSC9   0                        cn=0,n=1
        25 000263   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84

      338     2399    2       DO CASE(ACCESS_LIST.PORT_TYPE);

   2399 25 000264   200004 471500                    LDP1    @ACCESS_LIST,,AUTO
        25 000265   100001 220100                    LDX0    1,,PR1
        25 000266   000005 100003                    CMPX0   5,DU
        25 000267   000271 602010 25                 TNC     s:2399+5,X0
        25 000270   000600 710000 25                 TRA     s:2477
        25 000271   000600 710000 25                 TRA     s:2477
        25 000272   000276 710000 25                 TRA     s:2401
        25 000273   000335 710000 25                 TRA     s:2410
        25 000274   000371 710000 25                 TRA     s:2424
        25 000275   000545 710000 25                 TRA     s:2464

      339     2400    2       CASE(%SERIAL_ACCESS);

      340     2401    2           ZII$PARAMS.R_HALF(0)=3;

   2401 25 000276   000003 221003                    LDX1    3,DU
        25 000277   000000 441000 xsym               SXL1    ZII$PARAMS

      341     2402    2           ZII$PARAMS.R_HALF(1)=%FIRST;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:64   
   2402 25 000300   000016 222003                    LDX2    14,DU
        25 000301   000001 442000 xsym               SXL2    ZII$PARAMS+1

      342     2403    2           DR$=NAM1.DESC$(PATH_LIST.REC_NO(1));

   2403 25 000302   000005 236100                    LDQ     5,,PR0
        25 000303   000022 772000                    QRL     18
        25 000304   000012 402007                    MPY     10,DL
        25 000305   000000 473400 7                  LDP3    NAM1$
        25 000306   300011 236106                    LDQ     9,QL,PR3
        25 000307   000000 756000 18                 STQ     DR$

      343     2404    2           ZII$PARAMS.L_HALF(2)=RECORD.RVA_OFF;

   2404 25 000310   000000 474400 18                 LDP4    DR$
        25 000311   400000 720100                    LXL0    0,,PR4
        25 000312   000002 740000 xsym               STX0    ZII$PARAMS+2

      344     2405    2           DR$=NAM1.DESC$(PATH_LIST.REC_NO(1));

   2405 25 000313   000005 236100                    LDQ     5,,PR0
        25 000314   000022 772000                    QRL     18
        25 000315   000012 402007                    MPY     10,DL
        25 000316   300011 236106                    LDQ     9,QL,PR3
        25 000317   000000 756000 18                 STQ     DR$

      345     2406    2           DRA$=RECORD.RA_DSC$;

   2406 25 000320   000000 474400 18                 LDP4    DR$
        25 000321   400003 236100                    LDQ     3,,PR4
        25 000322   000000 756000 20                 STQ     DRA$

      346     2407    2           DA$=NAM1.DESC$(RA_DSC.AREA_IDX);

   2407 25 000323   000000 475400 20                 LDP5    DRA$
        25 000324   500000 236100                    LDQ     0,,PR5
        25 000325   777777 376007                    ANQ     -1,DL
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:65   
        25 000326   000012 402007                    MPY     10,DL
        25 000327   300011 236106                    LDQ     9,QL,PR3
        25 000330   000000 756000 16                 STQ     DA$

      347     2408    2           ZII$PARAMS.L_HALF(3)=AREA.RVA_OFF;

   2408 25 000331   000000 476400 16                 LDP6    DA$
        25 000332   600000 723100                    LXL3    0,,PR6
        25 000333   000003 743000 xsym               STX3    ZII$PARAMS+3
        25 000334   000601 710000 25                 TRA     FNDLBL

      348     2409    2       CASE(%DIRECT_ACCESS);

      349     2410    2           IF ACCESS_LIST.PORT_IDX ~= 0 THEN

   2410 25 000335   100001 721100                    LXL1    1,,PR1
        25 000336   000344 600000 25                 TZE     s:2416

      350     2411    3           DO;

      351     2412    3               STATUS_CODE=%ZII_NO_DBKEYS;

   2412 25 000337   013571 235007                    LDA     6009,DL
        25 000340   200007 473500                    LDP3    @STATUS_CODE,,AUTO
        25 000341   300000 755100                    STA     0,,PR3

      352     2413    3               ZI_RETRIEVING = '0'B;

   2413 25 000342   000000 450000 5                  STZ     ZI_RETRIEVING

      353     2414    3               ALTRETURN;

   2414 25 000343   000000 702200 xent               TSX2  ! X66_AALT

      354     2415    3               END;
      355     2416    2           ZII$PARAMS.R_HALF(0)=3;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:66   
   2416 25 000344   000003 222003                    LDX2    3,DU
        25 000345   000000 442000 xsym               SXL2    ZII$PARAMS

      356     2417    2           DR$=NAM1.DESC$(PATH_LIST.REC_NO(1));

   2417 25 000346   000005 236100                    LDQ     5,,PR0
        25 000347   000022 772000                    QRL     18
        25 000350   000012 402007                    MPY     10,DL
        25 000351   000000 473400 7                  LDP3    NAM1$
        25 000352   300011 236106                    LDQ     9,QL,PR3
        25 000353   000000 756000 18                 STQ     DR$

      357     2418    2           ZII$PARAMS.L_HALF(1)=RECORD.RVA_OFF;

   2418 25 000354   000000 474400 18                 LDP4    DR$
        25 000355   400000 723100                    LXL3    0,,PR4
        25 000356   000001 743000 xsym               STX3    ZII$PARAMS+1

      358     2419    2           ZII$PARAMS.R_HALF(2)=%DBKEY;

   2419 25 000357   000014 220003                    LDX0    12,DU
        25 000360   000002 440000 xsym               SXL0    ZII$PARAMS+2

      359     2420    2           ZII$PARAMS.R_HALF(3)=1;

   2420 25 000361   000001 221003                    LDX1    1,DU
        25 000362   000003 441000 xsym               SXL1    ZII$PARAMS+3

      360     2421    2           ZII$INTEGER1=ACCESS_LIST.DIRECT(ACCESS_LIST.PORT_IDX);

   2421 25 000363   100001 724100                    LXL4    1,,PR1
        25 000364   100003 235114                    LDA     3,X4,PR1
        25 000365   000000 755000 xsym               STA     ZII$INTEGER1

      361     2422    2           ACCESS_LIST.PORT_IDX=ACCESS_LIST.PORT_IDX+1;

   2422 25 000366   000001 625014                    EAX5    1,X4
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:67   
        25 000367   100001 445100                    SXL5    1,,PR1
        25 000370   000601 710000 25                 TRA     FNDLBL

      362     2423    2       CASE(%KEYED_ACCESS);

      363     2424    2           IF ACCESS_LIST.KEYED.MOVE(ACCESS_LIST.PORT_IDX) ~= ENTADDR(NIL) THEN

   2424 25 000371   100001 236100                    LDQ     1,,PR1
        25 000372   000001 736000                    QLS     1
        25 000373   000005 376000 26                 ANQ     5
        25 000374   100003 236106                    LDQ     3,QL,PR1
        25 000375   000000 116000 26                 CMPQ    0
        25 000376   000447 600000 25                 TZE     s:2444

      364     2425    3           DO;

      365     2426    3               IF ACCESS_LIST.PORT_IDX ~= 0 THEN

   2426 25 000377   100001 721100                    LXL1    1,,PR1
        25 000400   000406 600000 25                 TZE     s:2432

      366     2427    4               DO;

      367     2428    4                   STATUS_CODE=%ZII_NO_DBKEYS;

   2428 25 000401   013571 235007                    LDA     6009,DL
        25 000402   200007 473500                    LDP3    @STATUS_CODE,,AUTO
        25 000403   300000 755100                    STA     0,,PR3

      368     2429    4                   ZI_RETRIEVING = '0'B;

   2429 25 000404   000000 450000 5                  STZ     ZI_RETRIEVING

      369     2430    4                   ALTRETURN;

   2430 25 000405   000000 702200 xent               TSX2  ! X66_AALT

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:68   
      370     2431    4                   END;
      371     2432    3               ZII$PARAMS.R_HALF(0)=3;

   2432 25 000406   000003 222003                    LDX2    3,DU
        25 000407   000000 442000 xsym               SXL2    ZII$PARAMS

      372     2433    3               ZII$PARAMS.L_HALF(1)=NAM1.DESC$(ACCESS_LIST.PORT) -> RECORD.RVA_OFF;

   2433 25 000410   100000 236100                    LDQ     0,,PR1
        25 000411   000022 772000                    QRL     18
        25 000412   000012 402007                    MPY     10,DL
        25 000413   000000 473400 7                  LDP3    NAM1$
        25 000414   300011 474506                    LDP4    9,QL,PR3
        25 000415   400000 723100                    LXL3    0,,PR4
        25 000416   000001 743000 xsym               STX3    ZII$PARAMS+1

      373     2434    3               ZII$PARAMS.R_HALF(2)=%USING;

   2434 25 000417   000040 220003                    LDX0    32,DU
        25 000420   000002 440000 xsym               SXL0    ZII$PARAMS+2

      374     2435    3               ZII$PARAMS.L_HALF(3)=NAM1.DESC$(ACCESS_LIST.PORT_KEY) -> KEY.RVA_OFF;

   2435 25 000421   100000 236100                    LDQ     0,,PR1
        25 000422   777777 376007                    ANQ     -1,DL
        25 000423   000012 402007                    MPY     10,DL
        25 000424   300011 474506                    LDP4    9,QL,PR3
        25 000425   400000 721100                    LXL1    0,,PR4
        25 000426   000003 741000 xsym               STX1    ZII$PARAMS+3

      375     2436    3               IF ACCESS_LIST.KEYED.MOVE(ACCESS_LIST.PORT_IDX)~=ENTADDR(NIL) THEN

   2436 25 000427   100001 236100                    LDQ     1,,PR1
        25 000430   000001 736000                    QLS     1
        25 000431   000005 376000 26                 ANQ     5
        25 000432   100003 236106                    LDQ     3,QL,PR1
        25 000433   000000 116000 26                 CMPQ    0
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:69   
        25 000434   000601 600000 25                 TZE     FNDLBL

      376     2437    4               DO;

      377     2438    4                   GEN_CODE_EPTR=ACCESS_LIST.KEYED.MOVE(ACCESS_LIST.PORT_IDX);

   2438 25 000435   100001 236100                    LDQ     1,,PR1
        25 000436   000001 736000                    QLS     1
        25 000437   000005 376000 26                 ANQ     5
        25 000440   100003 236106                    LDQ     3,QL,PR1
        25 000441   000000 756000 0                  STQ     GEN_CODE_EPTR

      378     2439    4                   CALL GEN_CODE_EPTR ALTRET(BAD_FIND);

   2439 25 000442   000000 224000 0                  LDX4    GEN_CODE_EPTR
        25 000443   000000 631400 26                 EPPR1   0
        25 000444   000000 701014                    TSX1    0,X4
        25 000445   002525 702000 25                 TSX2    BAD_FIND

      379     2440    4                   END;

      380     2441    3               END;

   2441 25 000446   000601 710000 25                 TRA     FNDLBL

      381     2442    2           ELSE
      382     2443    3           DO;

      383     2444    3               CALL ZII$FIND_FIRST(ACCESS_LIST) ALTRET(ERR_STATUS);

   2444 25 000447   200004 630500                    EPPR0   @ACCESS_LIST,,AUTO
        25 000450   000006 631400 26                 EPPR1   6
        25 000451   000000 701000 xent               TSX1    ZII$FIND_FIRST
        25 000452   002513 702000 25                 TSX2    ERR_STATUS

      384     2445    3               ZII$PARAMS.R_HALF(0)=3;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:70   
   2445 25 000453   000003 220003                    LDX0    3,DU
        25 000454   000000 440000 xsym               SXL0    ZII$PARAMS

      385     2446    3               ZII$PARAMS.L_HALF(1)=NAM1.DESC$(ACCESS_LIST.PORT) -> RECORD.RVA_OFF;

   2446 25 000455   200004 470500                    LDP0    @ACCESS_LIST,,AUTO
        25 000456   000000 236100                    LDQ     0,,PR0
        25 000457   000022 772000                    QRL     18
        25 000460   000012 402007                    MPY     10,DL
        25 000461   000000 471400 7                  LDP1    NAM1$
        25 000462   100011 473506                    LDP3    9,QL,PR1
        25 000463   300000 721100                    LXL1    0,,PR3
        25 000464   000001 741000 xsym               STX1    ZII$PARAMS+1

      386     2447    3               ZII$PARAMS.R_HALF(2)=%USING;

   2447 25 000465   000040 222003                    LDX2    32,DU
        25 000466   000002 442000 xsym               SXL2    ZII$PARAMS+2

      387     2448    3               ZII$PARAMS.L_HALF(3)=NAM1.DESC$(ACCESS_LIST.PORT_KEY) -> KEY.RVA_OFF;

   2448 25 000467   000000 236100                    LDQ     0,,PR0
        25 000470   777777 376007                    ANQ     -1,DL
        25 000471   000012 402007                    MPY     10,DL
        25 000472   100011 473506                    LDP3    9,QL,PR1
        25 000473   300000 723100                    LXL3    0,,PR3
        25 000474   000003 743000 xsym               STX3    ZII$PARAMS+3

      388     2449    3               CALL ZII$FIND ALTRET(BAD_FIND);

   2449 25 000475   000000 631400 26                 EPPR1   0
        25 000476   000000 701000 xent               TSX1    ZII$FIND
        25 000477   002525 702000 25                 TSX2    BAD_FIND

      389     2450    3               IF UWA.DB_STATUS = '0502100' /*end-of-set*/ THEN

   2450 25 000500   000000 470400 13                 LDP0    UWA$
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:71   
        25 000501   040000 106500                    CMPC    fill='040'O
        25 000502   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 000503   000002 000007 24                 ADSC9   2                        cn=0,n=7
        25 000504   002464 600000 25                 TZE     FINLBL

      390     2451    3                   GOTO FINLBL;
      391     2452    3               IF UWA.DB_STATUS ~= '0000000' AND

   2452 25 000505   040000 106500                    CMPC    fill='040'O
        25 000506   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 000507   000000 000007 24                 ADSC9   0                        cn=0,n=7
        25 000510   000515 600000 25                 TZE     s:2456
        25 000511   040000 106500                    CMPC    fill='040'O
        25 000512   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 000513   000004 000007 24                 ADSC9   4                        cn=0,n=7
        25 000514   002525 601000 25                 TNZ     BAD_FIND

      392     2453    3                  UWA.DB_STATUS ~= '0502401' /* key val of record found is
      393     2454         greater than specified val */
      394     2455    3               THEN GOTO BAD_FIND;
      395     2456    3               CALL ZII$CLR_PARAMS;

   2456 25 000515   000000 631400 26                 EPPR1   0
        25 000516   000000 701000 xent               TSX1    ZII$CLR_PARAMS
        25 000517   000000 011000                    NOP     0

      396     2457    3               ZII$PARAMS.R_HALF(0)=4;

   2457 25 000520   000004 220003                    LDX0    4,DU
        25 000521   000000 440000 xsym               SXL0    ZII$PARAMS

      397     2458    3               ZII$PARAMS.R_HALF(1)=%FIRST;

   2458 25 000522   000016 221003                    LDX1    14,DU
        25 000523   000001 441000 xsym               SXL1    ZII$PARAMS+1

      398     2459    3               ZII$PARAMS.L_HALF(2)=NAM1.DESC$(ACCESS_LIST.PORT) -> RECORD.RVA_OFF;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:72   

   2459 25 000524   200004 470500                    LDP0    @ACCESS_LIST,,AUTO
        25 000525   000000 236100                    LDQ     0,,PR0
        25 000526   000022 772000                    QRL     18
        25 000527   000012 402007                    MPY     10,DL
        25 000530   000000 471400 7                  LDP1    NAM1$
        25 000531   100011 473506                    LDP3    9,QL,PR1
        25 000532   300000 722100                    LXL2    0,,PR3
        25 000533   000002 742000 xsym               STX2    ZII$PARAMS+2

      399     2460    3               ZII$PARAMS.R_HALF(3)=%USING;

   2460 25 000534   000040 223003                    LDX3    32,DU
        25 000535   000003 443000 xsym               SXL3    ZII$PARAMS+3

      400     2461    3               ZII$PARAMS.L_HALF(4)=NAM1.DESC$(ACCESS_LIST.PORT_KEY) -> KEY.RVA_OFF;

   2461 25 000536   000000 236100                    LDQ     0,,PR0
        25 000537   777777 376007                    ANQ     -1,DL
        25 000540   000012 402007                    MPY     10,DL
        25 000541   100011 473506                    LDP3    9,QL,PR1
        25 000542   300000 724100                    LXL4    0,,PR3
        25 000543   000004 744000 xsym               STX4    ZII$PARAMS+4

      401     2462    3               END;

   2462 25 000544   000601 710000 25                 TRA     FNDLBL

      402     2463    2       CASE(%CALC_ACCESS);

      403     2464    2           ZII$PARAMS.R_HALF(0)=2;

   2464 25 000545   000002 221003                    LDX1    2,DU
        25 000546   000000 441000 xsym               SXL1    ZII$PARAMS

      404     2465    2           ZII$PARAMS.R_HALF(1)=%ANY;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:73   
   2465 25 000547   000007 222003                    LDX2    7,DU
        25 000550   000001 442000 xsym               SXL2    ZII$PARAMS+1

      405     2466    2           ZII$PARAMS.L_HALF(2)=NAM1.DESC$(ACCESS_LIST.PORT)->RECORD.RVA_OFF;

   2466 25 000551   100000 236100                    LDQ     0,,PR1
        25 000552   000022 772000                    QRL     18
        25 000553   000012 402007                    MPY     10,DL
        25 000554   000000 473400 7                  LDP3    NAM1$
        25 000555   300011 474506                    LDP4    9,QL,PR3
        25 000556   400000 720100                    LXL0    0,,PR4
        25 000557   000002 740000 xsym               STX0    ZII$PARAMS+2

      406     2467    2           IF ACCESS_LIST.PORT_IDX < ACCESS_LIST.PORT_NUM THEN

   2467 25 000560   100001 723100                    LXL3    1,,PR1
        25 000561   100002 103100                    CMPX3   2,,PR1
        25 000562   002464 603000 25                 TRC     FINLBL

      407     2468    3           DO;

      408     2469    3               GEN_CODE_EPTR=ACCESS_LIST.KEYED.MOVE(ACCESS_LIST.PORT_IDX);

   2469 25 000563   100001 236100                    LDQ     1,,PR1
        25 000564   000001 736000                    QLS     1
        25 000565   000005 376000 26                 ANQ     5
        25 000566   100003 236106                    LDQ     3,QL,PR1
        25 000567   000000 756000 0                  STQ     GEN_CODE_EPTR

      409     2470    3               CALL GEN_CODE_EPTR ALTRET(BAD_FIND);

   2470 25 000570   000000 224000 0                  LDX4    GEN_CODE_EPTR
        25 000571   000000 631400 26                 EPPR1   0
        25 000572   000000 701014                    TSX1    0,X4
        25 000573   002525 702000 25                 TSX2    BAD_FIND

      410     2471    3               CALL ZII$FIND ALTRET(BAD_FIND);
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:74   

   2471 25 000574   000000 631400 26                 EPPR1   0
        25 000575   000000 701000 xent               TSX1    ZII$FIND
        25 000576   002525 702000 25                 TSX2    BAD_FIND

      411     2472    3               END;

   2472 25 000577   000601 710000 25                 TRA     FNDLBL

      412     2473    2           ELSE
      413     2474    2               GOTO FINLBL;
      414     2475    2       CASE(ELSE);

      415     2476         /* The parameter ACCESS_LIST is screwed. */
      416     2477    2           GOTO ERR_STATUS;

   2477 25 000600   002513 710000 25                 TRA     ERR_STATUS

      417     2478    2           END;

      418     2479    1   FNDLBL:
      419     2480    1       CALL ZII$FIND ALTRET(BAD_FIND);

   2480 25 000601   000000 631400 26    FNDLBL       EPPR1   0
        25 000602   000000 701000 xent               TSX1    ZII$FIND
        25 000603   002525 702000 25                 TSX2    BAD_FIND

      420     2481    1       IF ACCESS_LIST.PORT_TYPE = %KEYED_ACCESS THEN

   2481 25 000604   200004 470500                    LDP0    @ACCESS_LIST,,AUTO
        25 000605   000001 220100                    LDX0    1,,PR0
        25 000606   000003 100003                    CMPX0   3,DU
        25 000607   000626 601000 25                 TNZ     s:2492

      421     2482    2       DO;

      422     2483    2           IF UWA.DB_STATUS = '0502100' /* end-of-set */ THEN
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:75   

   2483 25 000610   000000 471400 13                 LDP1    UWA$
        25 000611   040000 106500                    CMPC    fill='040'O
        25 000612   100001 000007                    ADSC9   1,,PR1                   cn=0,n=7
        25 000613   000002 000007 24                 ADSC9   2                        cn=0,n=7
        25 000614   001775 600000 25                 TZE     NXTPORT_IDX

      423     2484    2               GOTO NXTPORT_IDX;
      424     2485    2           IF UWA.DB_STATUS ~= '0000000' AND

   2485 25 000615   040000 106500                    CMPC    fill='040'O
        25 000616   100001 000007                    ADSC9   1,,PR1                   cn=0,n=7
        25 000617   000000 000007 24                 ADSC9   0                        cn=0,n=7
        25 000620   000625 600000 25                 TZE     s:2489
        25 000621   040000 106500                    CMPC    fill='040'O
        25 000622   100001 000007                    ADSC9   1,,PR1                   cn=0,n=7
        25 000623   000004 000007 24                 ADSC9   4                        cn=0,n=7
        25 000624   002525 601000 25                 TNZ     BAD_FIND

      425     2486    2              UWA.DB_STATUS ~= '0502401' /* key val of record found is
      426     2487         greater than specified value */
      427     2488    2           THEN GOTO BAD_FIND;
      428     2489    2           END;

   2489 25 000625   000646 710000 25                 TRA     s:2502

      429     2490    1       ELSE
      430     2491    2       DO;

      431     2492    2           IF UWA.DB_STATUS = '0502100' /* end-of-set */ THEN

   2492 25 000626   000000 471400 13                 LDP1    UWA$
        25 000627   040000 106500                    CMPC    fill='040'O
        25 000630   100001 000007                    ADSC9   1,,PR1                   cn=0,n=7
        25 000631   000002 000007 24                 ADSC9   2                        cn=0,n=7
        25 000632   000636 601000 25                 TNZ     s:2497

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:76   
      432     2493    2               IF ACCESS_LIST.PORT_TYPE = %DIRECT_ACCESS THEN

   2493 25 000633   000002 100003                    CMPX0   2,DU
        25 000634   001453 600000 25                 TZE     NXTPORT

      433     2494    2                   GOTO NXTPORT;
      434     2495    2               ELSE
      435     2496    2                   GOTO FINLBL;

   2496 25 000635   002464 710000 25                 TRA     FINLBL

      436     2497    2           IF UWA.DB_STATUS = '0502400' /* no such record found */ THEN

   2497 25 000636   040000 106500                    CMPC    fill='040'O
        25 000637   100001 000007                    ADSC9   1,,PR1                   cn=0,n=7
        25 000640   000006 000007 24                 ADSC9   6                        cn=0,n=7
        25 000641   001453 600000 25                 TZE     NXTPORT

      437     2498    2               GOTO NXTPORT;
      438     2499    2           IF UWA.DB_STATUS ~= '0000000' THEN

   2499 25 000642   040000 106500                    CMPC    fill='040'O
        25 000643   100001 000007                    ADSC9   1,,PR1                   cn=0,n=7
        25 000644   000000 000007 24                 ADSC9   0                        cn=0,n=7
        25 000645   002525 601000 25                 TNZ     BAD_FIND

      439     2500    2               GOTO BAD_FIND;
      440     2501    2           END;

      441     2502    1       CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,PATH_LIST.REC_NO(1),TEMP_VALUE);

   2502 25 000646   200011 633500                    EPPR3   TEMP_VALUE,,AUTO
        25 000647   200034 453500                    STP3    NAME+10,,AUTO
        25 000650   200003 236100                    LDQ     @PATH_LIST,,AUTO
        25 000651   000005 036003                    ADLQ    5,DU
        25 000652   000007 235000 26                 LDA     7
        25 000653   200032 757100                    STAQ    NAME+8,,AUTO
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:77   
        25 000654   200032 630500                    EPPR0   NAME+8,,AUTO
        25 000655   000001 631400 26                 EPPR1   1
        25 000656   000000 701000 xent               TSX1    ZII$FIND_PRESENCE_IDX
        25 000657   000000 011000                    NOP     0

      442     2503    1       PRESENCE_LIST.P_VALUE(TEMP_VALUE)=%NEW;

   2503 25 000660   200011 235100                    LDA     TEMP_VALUE,,AUTO
        25 000661   000001 735000                    ALS     1
        25 000662   000002 220003                    LDX0    2,DU
        25 000663   000001 440005 0                  SXL0    PRESENCE_LIST,AL

      443     2504    1       PRESENCE_LIST.DB_KEY_SAVE(TEMP_VALUE)=UWA.DIRECT_REFERENCE;

   2504 25 000664   000000 470400 13                 LDP0    UWA$
        25 000665   000000 621005                    EAX1    0,AL
        25 000666   000036 235100                    LDA     30,,PR0
        25 000667   000002 755011 0                  STA     PRESENCE_LIST+1,X1

      444     2505    1       PATH_LIST.BRANCH_EXHAUSTED(1)='0'B;

   2505 25 000670   200003 471500                    LDP1    @PATH_LIST,,AUTO
        25 000671   000010 236000 26                 LDQ     8
        25 000672   100006 356100                    ANSQ    6,,PR1

      445     2506    1       IF PATH_LIST.GET_IND(1) THEN

   2506 25 000673   100006 236100                    LDQ     6,,PR1
        25 000674   200000 316003                    CANQ    65536,DU
        25 000675   000767 600000 25                 TZE     s:2529

      446     2507    2       DO;

      447     2508    2           ZII$PARAMS='0'B;

   2508 25 000676   000000 100400                    MLR     fill='000'O
        25 000677   000000 000001 26                 ADSC9   0                        cn=0,n=1
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:78   
        25 000700   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84

      448     2509    2           ZII$PARAMS.R_HALF(0)=1;

   2509 25 000701   000001 221003                    LDX1    1,DU
        25 000702   000000 441000 xsym               SXL1    ZII$PARAMS

      449     2510    2           DR$=NAM1.DESC$(PATH_LIST.REC_NO(1));

   2510 25 000703   100005 236100                    LDQ     5,,PR1
        25 000704   000022 772000                    QRL     18
        25 000705   000012 402007                    MPY     10,DL
        25 000706   000000 473400 7                  LDP3    NAM1$
        25 000707   300011 236106                    LDQ     9,QL,PR3
        25 000710   000000 756000 18                 STQ     DR$

      450     2511    2           ZII$PARAMS.L_HALF(1)=RECORD.RVA_OFF;

   2511 25 000711   000000 474400 18                 LDP4    DR$
        25 000712   400000 722100                    LXL2    0,,PR4
        25 000713   000001 742000 xsym               STX2    ZII$PARAMS+1

      451     2512    2           CALL ZII$GET ALTRET(BAD_GET);

   2512 25 000714   000000 631400 26                 EPPR1   0
        25 000715   000000 701000 xent               TSX1    ZII$GET
        25 000716   002547 702000 25                 TSX2    BAD_GET

      452     2513    2           IF UWA.DB_STATUS~='0000000' THEN

   2513 25 000717   000000 470400 13                 LDP0    UWA$
        25 000720   040000 106500                    CMPC    fill='040'O
        25 000721   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 000722   000000 000007 24                 ADSC9   0                        cn=0,n=7
        25 000723   002547 601000 25                 TNZ     BAD_GET

      453     2514    2               GOTO BAD_GET;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:79   
      454     2515    3           ELSE DO;

      455     2516    3               GEN_CODE_EPTR=PATH_LIST.CONVERT_EPTR(1);

   2516 25 000724   200003 471500                    LDP1    @PATH_LIST,,AUTO
        25 000725   100010 236100                    LDQ     8,,PR1
        25 000726   000000 756000 0                  STQ     GEN_CODE_EPTR

      456     2517    3               CALL GEN_CODE_EPTR;

   2517 25 000727   000000 220000 0                  LDX0    GEN_CODE_EPTR
        25 000730   000000 631400 26                 EPPR1   0
        25 000731   000000 701010                    TSX1    0,X0
        25 000732   000000 011000                    NOP     0

      457     2518    3               IF ACCESS_LIST.PORT_TYPE = %KEYED_ACCESS AND

   2518 25 000733   200004 470500                    LDP0    @ACCESS_LIST,,AUTO
        25 000734   000001 220100                    LDX0    1,,PR0
        25 000735   000003 100003                    CMPX0   3,DU
        25 000736   000756 601000 25                 TNZ     s:2524
        25 000737   000001 236100                    LDQ     1,,PR0
        25 000740   000001 736000                    QLS     1
        25 000741   000005 376000 26                 ANQ     5
        25 000742   000004 236106                    LDQ     4,QL,PR0
        25 000743   000000 116000 26                 CMPQ    0
        25 000744   000756 600000 25                 TZE     s:2524

      458     2519    3                  ACCESS_LIST.KEYED.CHECK(ACCESS_LIST.PORT_IDX) ~= ENTADDR(NIL) THEN
      459     2520    4               DO;

      460     2521    4                   GEN_CODE_EPTR=ACCESS_LIST.KEYED.CHECK(ACCESS_LIST.PORT_IDX);

   2521 25 000745   000001 236100                    LDQ     1,,PR0
        25 000746   000001 736000                    QLS     1
        25 000747   000005 376000 26                 ANQ     5
        25 000750   000004 236106                    LDQ     4,QL,PR0
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:80   
        25 000751   000000 756000 0                  STQ     GEN_CODE_EPTR

      461     2522    4                   CALL GEN_CODE_EPTR ALTRET(NXTPORT_IDX);

   2522 25 000752   000000 221000 0                  LDX1    GEN_CODE_EPTR
        25 000753   000000 631400 26                 EPPR1   0
        25 000754   000000 701011                    TSX1    0,X1
        25 000755   001775 702000 25                 TSX2    NXTPORT_IDX

      462     2523    4                   END;

      463     2524    3               GEN_CODE_EPTR=PATH_LIST.CONSTRAINT_EPTR(1);

   2524 25 000756   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 000757   000011 236100                    LDQ     9,,PR0
        25 000760   000000 756000 0                  STQ     GEN_CODE_EPTR

      464     2525    3               IF GEN_CODE_EPTR~=ENTADDR(NIL) THEN

   2525 25 000761   000000 116000 26                 CMPQ    0
        25 000762   000767 600000 25                 TZE     s:2529

      465     2526    3                   CALL GEN_CODE_EPTR ALTRET(NXTPORT);

   2526 25 000763   000000 220000 0                  LDX0    GEN_CODE_EPTR
        25 000764   000000 631400 26                 EPPR1   0
        25 000765   000000 701010                    TSX1    0,X0
        25 000766   001453 702000 25                 TSX2    NXTPORT

      466     2527    3               END;

      467     2528    2           END;

      468     2529    1       PATH_LIST.FIND_ATTEMPTED(1)='1'B;

   2529 25 000767   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 000770   100000 236003                    LDQ     32768,DU
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:81   
        25 000771   000006 256100                    ORSQ    6,,PR0

      469     2530    1       IF PATH_LIST.REC_NO(0) = 1 THEN

   2530 25 000772   000000 220100                    LDX0    0,,PR0
        25 000773   000001 100003                    CMPX0   1,DU
        25 000774   001131 600000 25                 TZE     OUTLBL

      470     2531    1           GOTO OUTLBL;
      471     2532        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:82   
      472     2533         /*
      473     2534            Set appropriate find first flags for all records in the
      474     2535            path list indicated as set members rather than set owners.
      475     2536            Don't bother to set it for records at the start of a new branch.
      476     2537         */
      477     2538    2       DO I=1 TO PATH_LIST.REC_NO(0)-1;

   2538 25 000775   000001 235007                    LDA     1,DL
        25 000776   000710 755000 0                  STA     I
        25 000777   001015 710000 25                 TRA     s:2541+3

      478     2539    2           IF NOT PATH_LIST.OWN_NEXT(I) AND PATH_LIST.SET_NO(I)~=0 THEN

   2539 25 001000   000710 236000 0                  LDQ     I
        25 001001   000005 402007                    MPY     5,DL
        25 001002   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 001003   000001 234106                    SZN     1,QL,PR0
        25 001004   001012 604000 25                 TMI     s:2541
        25 001005   000000 720106                    LXL0    0,QL,PR0
        25 001006   001012 600000 25                 TZE     s:2541

      479     2540    2               PATH_LIST.FIND_FIRST(I+1)='1'B;

   2540 25 001007   000000 621006                    EAX1    0,QL
        25 001010   004000 236003                    LDQ     2048,DU
        25 001011   000006 256111                    ORSQ    6,X1,PR0

      480     2541    2           END;

   2541 25 001012   000710 235000 0                  LDA     I
        25 001013   000001 035007                    ADLA    1,DL
        25 001014   000710 755000 0                  STA     I
        25 001015   000000 236100                    LDQ     0,,PR0
        25 001016   000022 772000                    QRL     18
        25 001017   000710 116000 0                  CMPQ    I
        25 001020   001022 600000 25                 TZE     RECUR
        25 001021   001000 603000 25                 TRC     s:2539
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:83   

      481     2542        /*
      482     2543          Now recursively traverse the database to retrieve all record occurrences
      483     2544          in the path. When the path has been traversed as far as possible,
      484     2545          control is passed to the label OUTLBL where further checking is
      485     2546          done to determine whether the results of the traversal should be
      486     2547          output for display. If so, the display routine supplied by the
      487     2548          calling program is called.
      488     2549        */
      489     2550    1   RECUR:
      490     2551    1       ALL_BRANCHES_DONE=0;

   2551 25 001022   000713 450000 0     RECUR        STZ     ALL_BRANCHES_DONE

      491     2552    1       START_OF_BRANCH=1;

   2552 25 001023   000001 235007                    LDA     1,DL
        25 001024   200013 755100                    STA     START_OF_BRANCH,,AUTO

      492     2553    1       NEXT_BRANCH = 1;

   2553 25 001025   200012 755100                    STA     NEXT_BRANCH,,AUTO

      493     2554    2       DO I = 1 TO BRANCH_COUNT;

   2554 25 001026   000710 755000 0                  STA     I
        25 001027   001035 710000 25                 TRA     s:2556+3

      494     2555    2           BRANCH_FAILED(I) = '0'B;

   2555 25 001030   000710 720000 0                  LXL0    I
        25 001031   000623 450010 0                  STZ     BRANCH_FAILED,X0

      495     2556    2           END;

   2556 25 001032   000710 235000 0                  LDA     I
        25 001033   000001 035007                    ADLA    1,DL
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:84   
        25 001034   000710 755000 0                  STA     I
        25 001035   000712 236000 0                  LDQ     BRANCH_COUNT
        25 001036   000710 116000 0                  CMPQ    I
        25 001037   001030 603000 25                 TRC     s:2555

      496     2557    2       DO WHILE (ALL_BRANCHES_DONE=0);

   2557 25 001040   000713 235000 0                  LDA     ALL_BRANCHES_DONE
        25 001041   001453 601000 25                 TNZ     NXTPORT

      497     2558    2           CURRENT_BRANCH = NEXT_BRANCH;

   2558 25 001042   200012 235100                    LDA     NEXT_BRANCH,,AUTO
        25 001043   200014 755100                    STA     CURRENT_BRANCH,,AUTO

      498     2559    3           DO WHILE (CURRENT_BRANCH<=BRANCH_COUNT);

   2559 25 001044   000712 236000 0                  LDQ     BRANCH_COUNT
        25 001045   200014 116100                    CMPQ    CURRENT_BRANCH,,AUTO
        25 001046   001131 602000 25                 TNC     OUTLBL

      499     2560    3               CURRENT_BRANCH = NEXT_BRANCH;

   2560 25 001047   200012 235100                    LDA     NEXT_BRANCH,,AUTO
        25 001050   200014 755100                    STA     CURRENT_BRANCH,,AUTO

      500     2561    3               REMEMBER COMEBACK IN RETRIEVE_RETURN;

   2561 25 001051   001071 635000 25                 EAA     COMEBACK
        25 001052   000000 452400 3                  STP2    RETRIEVE_RETURN
        25 001053   000001 755000 3                  STA     RETRIEVE_RETURN+1

      501     2562    3               CALL ZII$RECURSE(N,PATH_LIST,PRESENCE_LIST,START_OF_BRANCH,STATUS_CODE)
              2562                        ALTRET(BAD_RECURSION);

   2562 25 001054   200007 236100                    LDQ     @STATUS_CODE,,AUTO
        25 001055   200036 756100                    STQ     NAME+12,,AUTO
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:85   
        25 001056   200013 630500                    EPPR0   START_OF_BRANCH,,AUTO
        25 001057   200035 450500                    STP0    NAME+11,,AUTO
        25 001060   000007 236000 26                 LDQ     7
        25 001061   200034 756100                    STQ     NAME+10,,AUTO
        25 001062   200003 236100                    LDQ     @PATH_LIST,,AUTO
        25 001063   000012 235000 26                 LDA     10
        25 001064   200032 757100                    STAQ    NAME+8,,AUTO
        25 001065   200032 630500                    EPPR0   NAME+8,,AUTO
        25 001066   000011 631400 26                 EPPR1   9
        25 001067   000000 701000 xent               TSX1    ZII$RECURSE
        25 001070   002645 702000 25                 TSX2    BAD_RECURSION

      502     2563    3   COMEBACK:
      503     2564    4               IF CONSTRAINT_FAILED THEN DO;

   2564 25 001071   000000 234000 1     COMEBACK     SZN     CONSTRAINT_FAILED
        25 001072   001100 605000 25                 TPL     s:2569

      504     2565    4                   BRANCH_FAILED(CURRENT_BRANCH) = '1'B;

   2565 25 001073   400000 236003                    LDQ     -131072,DU
        25 001074   200014 720100                    LXL0    CURRENT_BRANCH,,AUTO
        25 001075   000623 756010 0                  STQ     BRANCH_FAILED,X0

      505     2566    4                   CONSTRAINT_FAILED = '0'B;

   2566 25 001076   000000 450000 1                  STZ     CONSTRAINT_FAILED

      506     2567    4                   END;

   2567 25 001077   001102 710000 25                 TRA     s:2570

      507     2568    3               ELSE
      508     2569    3                   BRANCH_FAILED(CURRENT_BRANCH) = '0'B;

   2569 25 001100   200014 720100                    LXL0    CURRENT_BRANCH,,AUTO
        25 001101   000623 450010 0                  STZ     BRANCH_FAILED,X0
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:86   

      509     2570    3               IF CURRENT_BRANCH = BRANCH_COUNT THEN

   2570 25 001102   200014 236100                    LDQ     CURRENT_BRANCH,,AUTO
        25 001103   000712 116000 0                  CMPQ    BRANCH_COUNT
        25 001104   001110 601000 25                 TNZ     s:2573

      510     2571    3                   NEXT_BRANCH=1;

   2571 25 001105   000001 235007                    LDA     1,DL
        25 001106   200012 755100                    STA     NEXT_BRANCH,,AUTO
        25 001107   001112 710000 25                 TRA     s:2574

      511     2572    3               ELSE
      512     2573    3                   NEXT_BRANCH=CURRENT_BRANCH+1;

   2573 25 001110   000001 036007                    ADLQ    1,DL
        25 001111   200012 756100                    STQ     NEXT_BRANCH,,AUTO

      513     2574    3               CALL EVAL_PRESENCE; /* Set starting point on new branch. */

   2574 25 001112   002671 701000 25                 TSX1    EVAL_PRESENCE
        25 001113   000000 011000                    NOP     0

      514     2575    3               IF ALL_BRANCHES_DONE=1 OR NEXT_BRANCH < CURRENT_BRANCH+1 THEN

   2575 25 001114   000713 235000 0                  LDA     ALL_BRANCHES_DONE
        25 001115   000001 115007                    CMPA    1,DL
        25 001116   001122 600000 25                 TZE     s:2576
        25 001117   200014 236100                    LDQ     CURRENT_BRANCH,,AUTO
        25 001120   200012 116100                    CMPQ    NEXT_BRANCH,,AUTO
        25 001121   001124 602000 25                 TNC     s:2577

      515     2576    3                   CURRENT_BRANCH=BRANCH_COUNT;

   2576 25 001122   000712 236000 0                  LDQ     BRANCH_COUNT
        25 001123   200014 756100                    STQ     CURRENT_BRANCH,,AUTO
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:87   

      516     2577    3               CURRENT_BRANCH=CURRENT_BRANCH+1;

   2577 25 001124   000001 036007                    ADLQ    1,DL
        25 001125   200014 756100                    STQ     CURRENT_BRANCH,,AUTO

      517     2578    3               END;

   2578 25 001126   000712 116000 0                  CMPQ    BRANCH_COUNT
        25 001127   001047 602000 25                 TNC     s:2560
        25 001130   001047 600000 25                 TZE     s:2560

      518     2579    2   OUTLBL:
      519     2580    2           IF SHARE_IND THEN

   2580 25 001131   200015 234100       OUTLBL       SZN     SHARE_IND,,AUTO
        25 001132   001156 605000 25                 TPL     s:2598

      520     2581    3           DO;

      521     2582    3               ZII$PARAMS='0'B;

   2582 25 001133   000000 100400                    MLR     fill='000'O
        25 001134   000000 000001 26                 ADSC9   0                        cn=0,n=1
        25 001135   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84

      522     2583    3               ZII$PARAMS.R_HALF(0)=2;

   2583 25 001136   000002 220003                    LDX0    2,DU
        25 001137   000000 440000 xsym               SXL0    ZII$PARAMS

      523     2584    3               ZII$PARAMS.R_HALF(1)=1;

   2584 25 001140   000001 221003                    LDX1    1,DU
        25 001141   000001 441000 xsym               SXL1    ZII$PARAMS+1

      524     2585    3               ZII$PARAMS.R_HALF(2)=1;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:88   

   2585 25 001142   000002 441000 xsym               SXL1    ZII$PARAMS+2

      525     2586    3               ZII$INTEGER1=1;

   2586 25 001143   000001 235007                    LDA     1,DL
        25 001144   000000 755000 xsym               STA     ZII$INTEGER1

      526     2587    3               ZII$INTEGER2=0;

   2587 25 001145   000000 450000 xsym               STZ     ZII$INTEGER2

      527     2588    3               CALL ZII$CHECK ALTRET(ERR_STATUS);

   2588 25 001146   000000 631400 26                 EPPR1   0
        25 001147   000000 701000 xent               TSX1    ZII$CHECK
        25 001150   002513 702000 25                 TSX2    ERR_STATUS

      528     2589         /* Since we called for a checkpoint, the currencies have
      529     2590            been zeroed, so they must be restored. */
      530     2591    3               CALL RESTORE_CURRENCY ALTRET(BAD_FIND);

   2591 25 001151   003413 701000 25                 TSX1    RESTORE_CURRENCY
        25 001152   002525 702000 25                 TSX2    BAD_FIND

      531     2592    3               IF STATUS_CODE ~= 0 THEN

   2592 25 001153   200007 470500                    LDP0    @STATUS_CODE,,AUTO
        25 001154   000000 235100                    LDA     0,,PR0
        25 001155   002513 601000 25                 TNZ     ERR_STATUS

      532     2593    3                   GOTO ERR_STATUS;
      533     2594    3               END;

      534     2595        /*
      535     2596          First, assume we're going to print this thing.
      536     2597        */
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:89   
      537     2598    2           ZI_PRINT_FLAG = '1'B;

   2598 25 001156   400000 236003                    LDQ     -131072,DU
        25 001157   000000 756000 4                  STQ     ZI_PRINT_FLAG

      538     2599        /*
      539     2600          Now, check to see if any branch failed constraints during
      540     2601          recursion process. If so, don't print.
      541     2602        */
      542     2603    2           I = 1;

   2603 25 001160   000001 235007                    LDA     1,DL
        25 001161   000710 755000 0                  STA     I

      543     2604    3           DO WHILE (ZI_PRINT_FLAG AND I <= BRANCH_COUNT);

   2604 25 001162   001172 710000 25                 TRA     s:2608

      544     2605    3               IF BRANCH_FAILED(I) THEN

   2605 25 001163   000710 720000 0                  LXL0    I
        25 001164   000623 234010 0                  SZN     BRANCH_FAILED,X0
        25 001165   001167 605000 25                 TPL     s:2607

      545     2606    3                   ZI_PRINT_FLAG = '0'B;

   2606 25 001166   000000 450000 4                  STZ     ZI_PRINT_FLAG

      546     2607    3               I = I+1;

   2607 25 001167   000710 235000 0                  LDA     I
        25 001170   000001 035007                    ADLA    1,DL
        25 001171   000710 755000 0                  STA     I

      547     2608    3               END;

   2608 25 001172   000000 234000 4                  SZN     ZI_PRINT_FLAG
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:90   
        25 001173   001177 605000 25                 TPL     s:2617
        25 001174   000712 236000 0                  LDQ     BRANCH_COUNT
        25 001175   000710 116000 0                  CMPQ    I
        25 001176   001163 603000 25                 TRC     s:2605

      548     2609        /*
      549     2610          If print flag is still on, have to see if any records
      550     2611          we did find-nexts on weren't there (hit end of set). If so, the
      551     2612          recursion process was aborted for that branch, and any records
      552     2613          further down the branch couldn't be found either. But, the UWA
      553     2614          may contain old info for such recs from a previous iteration. So,
      554     2615          init them, constrain them if necessary, and mark them not present.
      555     2616        */
      556     2617    2           IF ZI_PRINT_FLAG = '1'B THEN

   2617 25 001177   000000 234000 4                  SZN     ZI_PRINT_FLAG
        25 001200   001424 605000 25                 TPL     s:2680

      557     2618    3           DO;

      558     2619    3               I=1;

   2619 25 001201   000001 236007                    LDQ     1,DL
        25 001202   000710 756000 0                  STQ     I

      559     2620    4               DO WHILE (I <= PATH_LIST.REC_NO(0));

   2620 25 001203   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 001204   000000 236100                    LDQ     0,,PR0
        25 001205   000022 772000                    QRL     18
        25 001206   000710 116000 0                  CMPQ    I
        25 001207   001341 602000 25                 TNC     s:2657

      560     2621    4                   CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,PATH_LIST.REC_NO(I),
              2621                            TEMP_VALUE);

   2621 25 001210   200011 630500                    EPPR0   TEMP_VALUE,,AUTO
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:91   
        25 001211   200034 450500                    STP0    NAME+10,,AUTO
        25 001212   000710 236000 0                  LDQ     I
        25 001213   000005 402003                    MPY     5,DU
        25 001214   200003 036100                    ADLQ    @PATH_LIST,,AUTO
        25 001215   000007 235000 26                 LDA     7
        25 001216   200032 757100                    STAQ    NAME+8,,AUTO
        25 001217   200032 630500                    EPPR0   NAME+8,,AUTO
        25 001220   000001 631400 26                 EPPR1   1
        25 001221   000000 701000 xent               TSX1    ZII$FIND_PRESENCE_IDX
        25 001222   000000 011000                    NOP     0

      561     2622    4                   IF PRESENCE_LIST.P_VALUE(TEMP_VALUE) = 0 THEN

   2622 25 001223   200011 235100                    LDA     TEMP_VALUE,,AUTO
        25 001224   000001 735000                    ALS     1
        25 001225   000001 720005 0                  LXL0    PRESENCE_LIST,AL
        25 001226   001331 601000 25                 TNZ     s:2647

      562     2623    5                   DO;

      563     2624    5                       J=I;

   2624 25 001227   000710 236000 0                  LDQ     I
        25 001230   000711 756000 0                  STQ     J

      564     2625    6                       DO WHILE (PATH_LIST.SET_NO(J) ~= 0);

   2625 25 001231   000005 402007                    MPY     5,DL
        25 001232   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 001233   000000 720106                    LXL0    0,QL,PR0
        25 001234   001245 600000 25                 TZE     s:2628

      565     2626    6                           J=J+1;

   2626 25 001235   000711 235000 0                  LDA     J
        25 001236   000001 035007                    ADLA    1,DL
        25 001237   000711 755000 0                  STA     J
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:92   

      566     2627    6                           END;

   2627 25 001240   000711 236000 0                  LDQ     J
        25 001241   000005 402007                    MPY     5,DL
        25 001242   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 001243   000000 720106                    LXL0    0,QL,PR0
        25 001244   001235 601000 25                 TNZ     s:2626

      567     2628    6                       DO WHILE (I <= J);

   2628 25 001245   000711 236000 0                  LDQ     J
        25 001246   000710 116000 0                  CMPQ    I
        25 001247   001334 602000 25                 TNC     s:2648

      568     2629    6                           GEN_CODE_EPTR = PATH_LIST.INIT_EPTR(I);

   2629 25 001250   000710 236000 0                  LDQ     I
        25 001251   000005 402007                    MPY     5,DL
        25 001252   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 001253   000002 236106                    LDQ     2,QL,PR0
        25 001254   000000 756000 0                  STQ     GEN_CODE_EPTR

      569     2630    6                           IF GEN_CODE_EPTR ~= ENTADDR(NIL) THEN

   2630 25 001255   000000 116000 26                 CMPQ    0
        25 001256   001263 600000 25                 TZE     s:2632

      570     2631    6                               CALL GEN_CODE_EPTR ALTRET(ERR_STATUS);

   2631 25 001257   000000 220000 0                  LDX0    GEN_CODE_EPTR
        25 001260   000000 631400 26                 EPPR1   0
        25 001261   000000 701010                    TSX1    0,X0
        25 001262   002513 702000 25                 TSX2    ERR_STATUS

      571     2632    6                           GEN_CODE_EPTR = PATH_LIST.CONSTRAINT_EPTR(I);

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:93   
   2632 25 001263   000710 236000 0                  LDQ     I
        25 001264   000005 402007                    MPY     5,DL
        25 001265   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 001266   000004 236106                    LDQ     4,QL,PR0
        25 001267   000000 756000 0                  STQ     GEN_CODE_EPTR

      572     2633    6                           IF GEN_CODE_EPTR ~= ENTADDR(NIL) THEN

   2633 25 001270   000000 116000 26                 CMPQ    0
        25 001271   001276 600000 25                 TZE     s:2635

      573     2634    6                               CALL GEN_CODE_EPTR ALTRET(DONT_PRINT);

   2634 25 001272   000000 220000 0                  LDX0    GEN_CODE_EPTR
        25 001273   000000 631400 26                 EPPR1   0
        25 001274   000000 701010                    TSX1    0,X0
        25 001275   001277 702000 25                 TSX2    DONT_PRINT

      574     2635    7                           IF '0'B THEN DO;

   2635 25 001276   001300 710000 25                 TRA     s:2639

   2634 25 001277                       DONT_PRINT   null
      575     2636    7   DONT_PRINT:                 ;
      576     2637    7                               ZI_PRINT_FLAG = '0'B;

   2637 25 001277   000000 450000 4                  STZ     ZI_PRINT_FLAG

      577     2638    7                               END;

      578     2639    6                           I=I+1;

   2639 25 001300   000710 235000 0                  LDA     I
        25 001301   000001 035007                    ADLA    1,DL
        25 001302   000710 755000 0                  STA     I

      579     2640    7                           IF I <= J THEN DO;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:94   

   2640 25 001303   000711 236000 0                  LDQ     J
        25 001304   000710 116000 0                  CMPQ    I
        25 001305   001325 602000 25                 TNC     s:2645

      580     2641    7                               CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,

   2641 25 001306   200011 630500                    EPPR0   TEMP_VALUE,,AUTO
        25 001307   200034 450500                    STP0    NAME+10,,AUTO
        25 001310   000710 236000 0                  LDQ     I
        25 001311   000005 402003                    MPY     5,DU
        25 001312   200003 036100                    ADLQ    @PATH_LIST,,AUTO
        25 001313   000007 235000 26                 LDA     7
        25 001314   200032 757100                    STAQ    NAME+8,,AUTO
        25 001315   200032 630500                    EPPR0   NAME+8,,AUTO
        25 001316   000001 631400 26                 EPPR1   1
        25 001317   000000 701000 xent               TSX1    ZII$FIND_PRESENCE_IDX
        25 001320   000000 011000                    NOP     0

      581     2642    7                                  PATH_LIST.REC_NO(I),TEMP_VALUE);
      582     2643    7                               PRESENCE_LIST.P_VALUE(TEMP_VALUE) = 0;

   2643 25 001321   200011 235100                    LDA     TEMP_VALUE,,AUTO
        25 001322   000001 735000                    ALS     1
        25 001323   000000 220003                    LDX0    0,DU
        25 001324   000001 440005 0                  SXL0    PRESENCE_LIST,AL

      583     2644    7                               END;

      584     2645    6                           END;

   2645 25 001325   000711 236000 0                  LDQ     J
        25 001326   000710 116000 0                  CMPQ    I
        25 001327   001250 603000 25                 TRC     s:2629

      585     2646    5                       END;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:95   
   2646 25 001330   001334 710000 25                 TRA     s:2648

      586     2647    4                   ELSE I=I+1;

   2647 25 001331   000710 236000 0                  LDQ     I
        25 001332   000001 036007                    ADLQ    1,DL
        25 001333   000710 756000 0                  STQ     I

      587     2648    4                   END;

   2648 25 001334   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 001335   000000 236100                    LDQ     0,,PR0
        25 001336   000022 772000                    QRL     18
        25 001337   000710 116000 0                  CMPQ    I
        25 001340   001210 603000 25                 TRC     s:2621

      588     2649        /*
      589     2650          If print flag is still on, then output rec passed all constraints.
      590     2651          Therefore, if anything to be displayed was found new on the last
      591     2652          go round, print it. Else, if all to be displayed are old but
      592     2653          present, print it. Else, if all are old and one or more weren't
      593     2654          found this time, don't bother to print it since no new info (just
      594     2655          indicates end of set condition).
      595     2656        */
      596     2657    4               IF ZI_PRINT_FLAG THEN DO;

   2657 25 001341   000000 234000 4                  SZN     ZI_PRINT_FLAG
        25 001342   001415 605000 25                 TPL     s:2674

      597     2658    4   PRINT_CHECK:
      598     2659    5                   DO I = 1 TO PATH_LIST.REC_NO(0);

   2659 25 001343   000001 235007       PRINT_CHECK  LDA     1,DL
        25 001344   000710 755000 0                  STA     I
        25 001345   001410 710000 25                 TRA     s:2672+3

      599     2660    6                       IF PATH_LIST.DISPLAY_IND(I) THEN DO;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:96   

   2660 25 001346   000710 236000 0                  LDQ     I
        25 001347   000005 402007                    MPY     5,DL
        25 001350   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 001351   000001 236106                    LDQ     1,QL,PR0
        25 001352   010000 316003                    CANQ    4096,DU
        25 001353   001405 600000 25                 TZE     s:2672

      600     2661    6                           CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,

   2661 25 001354   200011 631500                    EPPR1   TEMP_VALUE,,AUTO
        25 001355   200034 451500                    STP1    NAME+10,,AUTO
        25 001356   000710 236000 0                  LDQ     I
        25 001357   000005 402003                    MPY     5,DU
        25 001360   200003 036100                    ADLQ    @PATH_LIST,,AUTO
        25 001361   000007 235000 26                 LDA     7
        25 001362   200032 757100                    STAQ    NAME+8,,AUTO
        25 001363   200032 630500                    EPPR0   NAME+8,,AUTO
        25 001364   000001 631400 26                 EPPR1   1
        25 001365   000000 701000 xent               TSX1    ZII$FIND_PRESENCE_IDX
        25 001366   000000 011000                    NOP     0

      601     2662    6                              PATH_LIST.REC_NO(I),TEMP_VALUE);
      602     2663    7                           DO CASE(PRESENCE_LIST.P_VALUE(TEMP_VALUE));

   2663 25 001367   200011 235100                    LDA     TEMP_VALUE,,AUTO
        25 001370   000001 735000                    ALS     1
        25 001371   000001 720005 0                  LXL0    PRESENCE_LIST,AL
        25 001372   000003 100003                    CMPX0   3,DU
        25 001373   001375 602010 25                 TNC     s:2663+6,X0
        25 001374   001405 710000 25                 TRA     s:2672
        25 001375   001400 710000 25                 TRA     s:2665
        25 001376   001405 710000 25                 TRA     s:2672
        25 001377   001402 710000 25                 TRA     s:2668

      603     2664    7                           CASE(0); /* record not present */

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:97   
      604     2665    7                               ZI_PRINT_FLAG = '0'B;

   2665 25 001400   000000 450000 4                  STZ     ZI_PRINT_FLAG
        25 001401   001405 710000 25                 TRA     s:2672

      605     2666    7                           CASE(%OLD); /* record value present, but old */

      606     2667    7                           CASE(%NEW); /* record value present and new */

      607     2668    7                               ZI_PRINT_FLAG = '1'B;

   2668 25 001402   400000 236003                    LDQ     -131072,DU
        25 001403   000000 756000 4                  STQ     ZI_PRINT_FLAG

      608     2669    7                               EXIT PRINT_CHECK;

   2669 25 001404   001415 710000 25                 TRA     s:2674

      609     2670    7                               END;

      610     2671    6                           END;

      611     2672    5                       END;

   2672 25 001405   000710 235000 0                  LDA     I
        25 001406   000001 035007                    ADLA    1,DL
        25 001407   000710 755000 0                  STA     I
        25 001410   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 001411   000000 236100                    LDQ     0,,PR0
        25 001412   000022 772000                    QRL     18
        25 001413   000710 116000 0                  CMPQ    I
        25 001414   001346 603000 25                 TRC     s:2660

      612     2673    4                   END;

      613     2674    3               IF ZI_PRINT_FLAG THEN /* print it (finally) */

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:98   
   2674 25 001415   000000 234000 4                  SZN     ZI_PRINT_FLAG
        25 001416   001424 605000 25                 TPL     s:2680

      614     2675    3                   CALL RETRIEVE_EXIT ALTRET(FINLBL);

   2675 25 001417   200006 470500                    LDP0    @RETRIEVE_EXIT,,AUTO
        25 001420   000000 220100                    LDX0    0,,PR0
        25 001421   000000 631400 26                 EPPR1   0
        25 001422   000000 701010                    TSX1    0,X0
        25 001423   002464 702000 25                 TSX2    FINLBL

      615     2676    3               END;

      616     2677        /*
      617     2678          Change all values marked new to old for next go round.
      618     2679        */
      619     2680    3           DO I = 1 TO PRESENCE_LIST.REC_NO(0);

   2680 25 001424   000001 235007                    LDA     1,DL
        25 001425   000710 755000 0                  STA     I
        25 001426   001441 710000 25                 TRA     s:2683+3

      620     2681    3               IF PRESENCE_LIST.P_VALUE(I) = %NEW THEN

   2681 25 001427   000710 235000 0                  LDA     I
        25 001430   000001 735000                    ALS     1
        25 001431   000001 720005 0                  LXL0    PRESENCE_LIST,AL
        25 001432   000002 100003                    CMPX0   2,DU
        25 001433   001436 601000 25                 TNZ     s:2683

      621     2682    3                   PRESENCE_LIST.P_VALUE(I) = %OLD;

   2682 25 001434   000001 221003                    LDX1    1,DU
        25 001435   000001 441005 0                  SXL1    PRESENCE_LIST,AL

      622     2683    3               END;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:99   
   2683 25 001436   000710 236000 0                  LDQ     I
        25 001437   000001 036007                    ADLQ    1,DL
        25 001440   000710 756000 0                  STQ     I
        25 001441   000001 236000 0                  LDQ     PRESENCE_LIST
        25 001442   000022 772000                    QRL     18
        25 001443   000710 116000 0                  CMPQ    I
        25 001444   001427 603000 25                 TRC     s:2681

      623     2684    2   CHKSNGL:
      624     2685    2           IF PATH_LIST.REC_NO(0) = 1 THEN

   2685 25 001445   200003 470500       CHKSNGL      LDP0    @PATH_LIST,,AUTO
        25 001446   000000 220100                    LDX0    0,,PR0
        25 001447   000001 100003                    CMPX0   1,DU
        25 001450   001453 600000 25                 TZE     NXTPORT

      625     2686    2               GOTO NXTPORT;
      626     2687    2           END;

   2687 25 001451   000713 235000 0                  LDA     ALL_BRANCHES_DONE
        25 001452   001042 600000 25                 TZE     s:2558

      627     2688        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:100  
      628     2689        /*
      629     2690          Now find the next port occurrence. If retrieval list is exhausted or
      630     2691          end-of-realm condition is detected, FINISH the areas and exit.
      631     2692        */
      632     2693    1   NXTPORT:
      633     2694    1       ZII$PARAMS='0'B;

   2694 25 001453   000000 100400       NXTPORT      MLR     fill='000'O
        25 001454   000000 000001 26                 ADSC9   0                        cn=0,n=1
        25 001455   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84

      634     2695    2       DO CASE(ACCESS_LIST.PORT_TYPE);

   2695 25 001456   200004 470500                    LDP0    @ACCESS_LIST,,AUTO
        25 001457   000001 220100                    LDX0    1,,PR0
        25 001460   000005 100003                    CMPX0   5,DU
        25 001461   001463 602010 25                 TNC     s:2695+5,X0
        25 001462   001773 710000 25                 TRA     s:2790
        25 001463   001773 710000 25                 TRA     s:2790
        25 001464   001470 710000 25                 TRA     s:2697
        25 001465   001562 710000 25                 TRA     s:2717
        25 001466   001616 710000 25                 TRA     s:2731
        25 001467   001656 710000 25                 TRA     s:2742

      635     2696    2       CASE(%SERIAL_ACCESS);

      636     2697    2           IF PATH_LIST.REC_NO(0)>1 THEN

   2697 25 001470   200003 471500                    LDP1    @PATH_LIST,,AUTO
        25 001471   100000 221100                    LDX1    0,,PR1
        25 001472   000002 101003                    CMPX1   2,DU
        25 001473   001544 602000 25                 TNC     s:2711

      637     2698    3           DO;

      638     2699    3               ZII$PARAMS.R_HALF(0)=3;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:101  
   2699 25 001474   000003 222003                    LDX2    3,DU
        25 001475   000000 442000 xsym               SXL2    ZII$PARAMS

      639     2700    3               DR$=NAM1.DESC$(PATH_LIST.REC_NO(1));

   2700 25 001476   100005 236100                    LDQ     5,,PR1
        25 001477   000022 772000                    QRL     18
        25 001500   000012 402007                    MPY     10,DL
        25 001501   000000 473400 7                  LDP3    NAM1$
        25 001502   300011 236106                    LDQ     9,QL,PR3
        25 001503   000000 756000 18                 STQ     DR$

      640     2701    3               ZII$PARAMS.L_HALF(1)=RECORD.RVA_OFF;

   2701 25 001504   000000 474400 18                 LDP4    DR$
        25 001505   400000 721100                    LXL1    0,,PR4
        25 001506   000001 741000 xsym               STX1    ZII$PARAMS+1

      641     2702    3               ZII$PARAMS.R_HALF(2)=%DBKEY;

   2702 25 001507   000014 220003                    LDX0    12,DU
        25 001510   000002 440000 xsym               SXL0    ZII$PARAMS+2

      642     2703    3               ZII$PARAMS.R_HALF(3)=1;

   2703 25 001511   000001 223003                    LDX3    1,DU
        25 001512   000003 443000 xsym               SXL3    ZII$PARAMS+3

      643     2704    3              CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,PATH_LIST.REC_NO(1),TEMP_VALUE)
              2704                        ;

   2704 25 001513   200011 635500                    EPPR5   TEMP_VALUE,,AUTO
        25 001514   200034 455500                    STP5    NAME+10,,AUTO
        25 001515   200003 236100                    LDQ     @PATH_LIST,,AUTO
        25 001516   000005 036003                    ADLQ    5,DU
        25 001517   000007 235000 26                 LDA     7
        25 001520   200032 757100                    STAQ    NAME+8,,AUTO
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:102  
        25 001521   200032 630500                    EPPR0   NAME+8,,AUTO
        25 001522   000001 631400 26                 EPPR1   1
        25 001523   000000 701000 xent               TSX1    ZII$FIND_PRESENCE_IDX
        25 001524   000000 011000                    NOP     0

      644     2705    3               ZII$INTEGER1=PRESENCE_LIST.DB_KEY_SAVE(TEMP_VALUE);

   2705 25 001525   200011 235100                    LDA     TEMP_VALUE,,AUTO
        25 001526   000001 735000                    ALS     1
        25 001527   000002 235005 0                  LDA     PRESENCE_LIST+1,AL
        25 001530   000000 755000 xsym               STA     ZII$INTEGER1

      645     2706    3               CALL ZII$FIND ALTRET(BAD_FIND);

   2706 25 001531   000000 631400 26                 EPPR1   0
        25 001532   000000 701000 xent               TSX1    ZII$FIND
        25 001533   002525 702000 25                 TSX2    BAD_FIND

      646     2707    3               IF UWA.DB_STATUS~='0000000' THEN

   2707 25 001534   000000 470400 13                 LDP0    UWA$
        25 001535   040000 106500                    CMPC    fill='040'O
        25 001536   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 001537   000000 000007 24                 ADSC9   0                        cn=0,n=7
        25 001540   002525 601000 25                 TNZ     BAD_FIND

      647     2708    3                   GOTO BAD_FIND;
      648     2709    3               ZII$PARAMS='0'B;

   2709 25 001541   000000 100400                    MLR     fill='000'O
        25 001542   000000 000001 26                 ADSC9   0                        cn=0,n=1
        25 001543   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84

      649     2710    3               END;

      650     2711    2           ZII$PARAMS.R_HALF(0)=3;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:103  
   2711 25 001544   000003 220003                    LDX0    3,DU
        25 001545   000000 440000 xsym               SXL0    ZII$PARAMS

      651     2712    2           ZII$PARAMS.R_HALF(1)=%NEXT;

   2712 25 001546   000023 221003                    LDX1    19,DU
        25 001547   000001 441000 xsym               SXL1    ZII$PARAMS+1

      652     2713    2           ZII$PARAMS.L_HALF(2)=RECORD.RVA_OFF;

   2713 25 001550   000000 470400 18                 LDP0    DR$
        25 001551   000000 722100                    LXL2    0,,PR0
        25 001552   000002 742000 xsym               STX2    ZII$PARAMS+2

      653     2714    2           ZII$PARAMS.L_HALF(3)=AREA.RVA_OFF;

   2714 25 001553   000000 471400 16                 LDP1    DA$
        25 001554   100000 723100                    LXL3    0,,PR1
        25 001555   000003 743000 xsym               STX3    ZII$PARAMS+3

      654     2715    2           CALL ZII$FIND ALTRET(BAD_FIND);

   2715 25 001556   000000 631400 26                 EPPR1   0
        25 001557   000000 701000 xent               TSX1    ZII$FIND
        25 001560   002525 702000 25                 TSX2    BAD_FIND
        25 001561   001774 710000 25                 TRA     s:2792

      655     2716    2       CASE(%DIRECT_ACCESS);

      656     2717    2           IF ACCESS_LIST.PORT_IDX < ACCESS_LIST.PORT_NUM THEN

   2717 25 001562   000001 721100                    LXL1    1,,PR0
        25 001563   000002 101100                    CMPX1   2,,PR0
        25 001564   002464 603000 25                 TRC     FINLBL

      657     2718    3           DO;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:104  
      658     2719    3               ZII$PARAMS.R_HALF(0)=3;

   2719 25 001565   000003 222003                    LDX2    3,DU
        25 001566   000000 442000 xsym               SXL2    ZII$PARAMS

      659     2720    3               DR$=NAM1.DESC$(PATH_LIST.REC_NO(1));

   2720 25 001567   200003 471500                    LDP1    @PATH_LIST,,AUTO
        25 001570   100005 236100                    LDQ     5,,PR1
        25 001571   000022 772000                    QRL     18
        25 001572   000012 402007                    MPY     10,DL
        25 001573   000000 473400 7                  LDP3    NAM1$
        25 001574   300011 236106                    LDQ     9,QL,PR3
        25 001575   000000 756000 18                 STQ     DR$

      660     2721    3               ZII$PARAMS.L_HALF(1)=RECORD.RVA_OFF;

   2721 25 001576   000000 474400 18                 LDP4    DR$
        25 001577   400000 723100                    LXL3    0,,PR4
        25 001600   000001 743000 xsym               STX3    ZII$PARAMS+1

      661     2722    3               ZII$PARAMS.R_HALF(2)=%DBKEY;

   2722 25 001601   000014 220003                    LDX0    12,DU
        25 001602   000002 440000 xsym               SXL0    ZII$PARAMS+2

      662     2723    3               ZII$PARAMS.R_HALF(3)=1;

   2723 25 001603   000001 221003                    LDX1    1,DU
        25 001604   000003 441000 xsym               SXL1    ZII$PARAMS+3

      663     2724    3               ZII$INTEGER1=ACCESS_LIST.DIRECT(ACCESS_LIST.PORT_IDX);

   2724 25 001605   000001 724100                    LXL4    1,,PR0
        25 001606   000003 235114                    LDA     3,X4,PR0
        25 001607   000000 755000 xsym               STA     ZII$INTEGER1

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:105  
      664     2725    3               ACCESS_LIST.PORT_IDX=ACCESS_LIST.PORT_IDX+1;

   2725 25 001610   000001 625014                    EAX5    1,X4
        25 001611   000001 445100                    SXL5    1,,PR0

      665     2726    3               CALL ZII$FIND ALTRET(BAD_FIND);

   2726 25 001612   000000 631400 26                 EPPR1   0
        25 001613   000000 701000 xent               TSX1    ZII$FIND
        25 001614   002525 702000 25                 TSX2    BAD_FIND

      666     2727    3               END;

   2727 25 001615   001774 710000 25                 TRA     s:2792

      667     2728    2           ELSE
      668     2729    2               GOTO FINLBL;
      669     2730    2       CASE(%KEYED_ACCESS);

      670     2731    2           ZII$PARAMS.R_HALF(0) = 4;

   2731 25 001616   000004 221003                    LDX1    4,DU
        25 001617   000000 441000 xsym               SXL1    ZII$PARAMS

      671     2732    2           ZII$PARAMS.R_HALF(1) = %NEXT;

   2732 25 001620   000023 222003                    LDX2    19,DU
        25 001621   000001 442000 xsym               SXL2    ZII$PARAMS+1

      672     2733    2           ZII$PARAMS.L_HALF(2) = NAM1.DESC$(ACCESS_LIST.PORT) -> RECORD.RVA_OFF;

   2733 25 001622   000000 236100                    LDQ     0,,PR0
        25 001623   000022 772000                    QRL     18
        25 001624   000012 402007                    MPY     10,DL
        25 001625   000000 471400 7                  LDP1    NAM1$
        25 001626   100011 473506                    LDP3    9,QL,PR1
        25 001627   300000 720100                    LXL0    0,,PR3
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:106  
        25 001630   000002 740000 xsym               STX0    ZII$PARAMS+2

      673     2734    2           ZII$PARAMS.R_HALF(3) = %USING;

   2734 25 001631   000040 223003                    LDX3    32,DU
        25 001632   000003 443000 xsym               SXL3    ZII$PARAMS+3

      674     2735    2           ZII$PARAMS.L_HALF(4) = NAM1.DESC$(ACCESS_LIST.PORT_KEY) -> KEY.RVA_OFF;

   2735 25 001633   000000 236100                    LDQ     0,,PR0
        25 001634   777777 376007                    ANQ     -1,DL
        25 001635   000012 402007                    MPY     10,DL
        25 001636   100011 473506                    LDP3    9,QL,PR1
        25 001637   300000 724100                    LXL4    0,,PR3
        25 001640   000004 744000 xsym               STX4    ZII$PARAMS+4

      675     2736    2           CALL ZII$FIND ALTRET(BAD_FIND);

   2736 25 001641   000000 631400 26                 EPPR1   0
        25 001642   000000 701000 xent               TSX1    ZII$FIND
        25 001643   002525 702000 25                 TSX2    BAD_FIND

      676     2737    2           IF UWA.DB_STATUS = '0502100' /* end-of-set */ THEN

   2737 25 001644   000000 470400 13                 LDP0    UWA$
        25 001645   040000 106500                    CMPC    fill='040'O
        25 001646   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 001647   000002 000007 24                 ADSC9   2                        cn=0,n=7
        25 001650   001775 600000 25                 TZE     NXTPORT_IDX

      677     2738    2               GOTO NXTPORT_IDX;
      678     2739    2           IF UWA.DB_STATUS ~= '0000000' THEN

   2739 25 001651   040000 106500                    CMPC    fill='040'O
        25 001652   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 001653   000000 000007 24                 ADSC9   0                        cn=0,n=7
        25 001654   002525 601000 25                 TNZ     BAD_FIND
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:107  
        25 001655   001774 710000 25                 TRA     s:2792

      679     2740    2               GOTO BAD_FIND;
      680     2741    2       CASE(%CALC_ACCESS);

      681     2742    2           IF ACCESS_LIST.PORT_IDX < ACCESS_LIST.PORT_NUM THEN

   2742 25 001656   000001 721100                    LXL1    1,,PR0
        25 001657   000002 101100                    CMPX1   2,,PR0
        25 001660   002464 603000 25                 TRC     FINLBL

      682     2743    3           DO;

      683     2744         /*
      684     2745            Move user specified calc key value(s) into UWA.
      685     2746            This EPTR altrets if it was executed once already.
      686     2747         */
      687     2748    3               GEN_CODE_EPTR=ACCESS_LIST.KEYED.MOVE(ACCESS_LIST.PORT_IDX);

   2748 25 001661   000001 236100                    LDQ     1,,PR0
        25 001662   000001 736000                    QLS     1
        25 001663   000005 376000 26                 ANQ     5
        25 001664   000003 236106                    LDQ     3,QL,PR0
        25 001665   000000 756000 0                  STQ     GEN_CODE_EPTR

      688     2749    3               CALL GEN_CODE_EPTR ALTRET(FIND_DUPE);

   2749 25 001666   000000 222000 0                  LDX2    GEN_CODE_EPTR
        25 001667   000000 631400 26                 EPPR1   0
        25 001670   000000 701012                    TSX1    0,X2
        25 001671   001712 702000 25                 TSX2    FIND_DUPE

      689     2750         /*
      690     2751            Find the 1st record which matches these values.
      691     2752         */
      692     2753    3               ZII$PARAMS.R_HALF(0)=2;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:108  
   2753 25 001672   000002 220003                    LDX0    2,DU
        25 001673   000000 440000 xsym               SXL0    ZII$PARAMS

      693     2754    3               ZII$PARAMS.R_HALF(1)=%ANY;

   2754 25 001674   000007 221003                    LDX1    7,DU
        25 001675   000001 441000 xsym               SXL1    ZII$PARAMS+1

      694     2755    3               ZII$PARAMS.L_HALF(2)=NAM1.DESC$(ACCESS_LIST.PORT)->RECORD.RVA_OFF;

   2755 25 001676   200004 470500                    LDP0    @ACCESS_LIST,,AUTO
        25 001677   000000 236100                    LDQ     0,,PR0
        25 001700   000022 772000                    QRL     18
        25 001701   000012 402007                    MPY     10,DL
        25 001702   000000 471400 7                  LDP1    NAM1$
        25 001703   100011 473506                    LDP3    9,QL,PR1
        25 001704   300000 722100                    LXL2    0,,PR3
        25 001705   000002 742000 xsym               STX2    ZII$PARAMS+2

      695     2756    3               CALL ZII$FIND ALTRET(BAD_FIND);

   2756 25 001706   000000 631400 26                 EPPR1   0
        25 001707   000000 701000 xent               TSX1    ZII$FIND
        25 001710   002525 702000 25                 TSX2    BAD_FIND

      696     2757    4               DO WHILE ('0'B);

   2757 25 001711   001774 710000 25                 TRA     s:2792

   2756 25 001712                       FIND_DUPE    null
      697     2758         /*
      698     2759            Already found 1st occurrence of this calc key. Since
      699     2760            duplicates may be allowed, look for dupes. When run out
      700     2761            of dupes, find rec using next specified calc key, if any.
      701     2762            1st, position to current of port record.
      702     2763         */
      703     2764    4   FIND_DUPE:      ;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:109  
      704     2765    4                   ZII$PARAMS.R_HALF(0)=2;

   2765 25 001712   000002 220003                    LDX0    2,DU
        25 001713   000000 440000 xsym               SXL0    ZII$PARAMS

      705     2766    4                   ZII$PARAMS.R_HALF(1)=%CURRENT;

   2766 25 001714   000013 221003                    LDX1    11,DU
        25 001715   000001 441000 xsym               SXL1    ZII$PARAMS+1

      706     2767    4                   ZII$PARAMS.L_HALF(2)=NAM1.DESC$(ACCESS_LIST.PORT)->RECORD.RVA_OFF;

   2767 25 001716   200004 470500                    LDP0    @ACCESS_LIST,,AUTO
        25 001717   000000 236100                    LDQ     0,,PR0
        25 001720   000022 772000                    QRL     18
        25 001721   000012 402007                    MPY     10,DL
        25 001722   000000 471400 7                  LDP1    NAM1$
        25 001723   100011 473506                    LDP3    9,QL,PR1
        25 001724   300000 722100                    LXL2    0,,PR3
        25 001725   000002 742000 xsym               STX2    ZII$PARAMS+2

      707     2768    4                   CALL ZII$FIND ALTRET(BAD_FIND);

   2768 25 001726   000000 631400 26                 EPPR1   0
        25 001727   000000 701000 xent               TSX1    ZII$FIND
        25 001730   002525 702000 25                 TSX2    BAD_FIND

      708     2769    4                   IF UWA.DB_STATUS ~= '0000000' THEN

   2769 25 001731   000000 470400 13                 LDP0    UWA$
        25 001732   040000 106500                    CMPC    fill='040'O
        25 001733   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 001734   000000 000007 24                 ADSC9   0                        cn=0,n=7
        25 001735   002525 601000 25                 TNZ     BAD_FIND

      709     2770    4                       GOTO BAD_FIND;
      710     2771         /*
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:110  
      711     2772            Now, try to find a duplicate.
      712     2773         */
      713     2774    4                   ZII$PARAMS='0'B;

   2774 25 001736   000000 100400                    MLR     fill='000'O
        25 001737   000000 000001 26                 ADSC9   0                        cn=0,n=1
        25 001740   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84

      714     2775    4                   ZII$PARAMS.R_HALF(0)=2;

   2775 25 001741   000002 220003                    LDX0    2,DU
        25 001742   000000 440000 xsym               SXL0    ZII$PARAMS

      715     2776    4                   ZII$PARAMS.R_HALF(1)=%DUPLICATE;

   2776 25 001743   000015 221003                    LDX1    13,DU
        25 001744   000001 441000 xsym               SXL1    ZII$PARAMS+1

      716     2777    4                   ZII$PARAMS.L_HALF(2)=NAM1.DESC$(ACCESS_LIST.PORT)->RECORD.RVA_OFF;

   2777 25 001745   200004 471500                    LDP1    @ACCESS_LIST,,AUTO
        25 001746   100000 236100                    LDQ     0,,PR1
        25 001747   000022 772000                    QRL     18
        25 001750   000012 402007                    MPY     10,DL
        25 001751   000000 473400 7                  LDP3    NAM1$
        25 001752   300011 474506                    LDP4    9,QL,PR3
        25 001753   400000 722100                    LXL2    0,,PR4
        25 001754   000002 742000 xsym               STX2    ZII$PARAMS+2

      717     2778    4                   CALL ZII$FIND ALTRET(BAD_FIND);

   2778 25 001755   000000 631400 26                 EPPR1   0
        25 001756   000000 701000 xent               TSX1    ZII$FIND
        25 001757   002525 702000 25                 TSX2    BAD_FIND

      718     2779    4                   IF UWA.DB_STATUS='0502400' /* no such rec found */ THEN

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:111  
   2779 25 001760   000000 470400 13                 LDP0    UWA$
        25 001761   040000 106500                    CMPC    fill='040'O
        25 001762   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 001763   000006 000007 24                 ADSC9   6                        cn=0,n=7
        25 001764   001772 601000 25                 TNZ     s:2785

      719     2780    5                   DO; /* No more duplicates */

      720     2781    5                       ACCESS_LIST.PORT_IDX = ACCESS_LIST.PORT_IDX + 1;

   2781 25 001765   200004 471500                    LDP1    @ACCESS_LIST,,AUTO
        25 001766   100001 720100                    LXL0    1,,PR1
        25 001767   000001 621010                    EAX1    1,X0
        25 001770   100001 441100                    SXL1    1,,PR1

      721     2782    5                       GOTO NXTPORT;

   2782 25 001771   001453 710000 25                 TRA     NXTPORT

      722     2783    5                       END;
      723     2784    4                   END;

      724     2785    3               END;

   2785 25 001772   001774 710000 25                 TRA     s:2792

      725     2786    2           ELSE
      726     2787    2               GOTO FINLBL;
      727     2788    2       CASE(ELSE);

      728     2789         /* The parameter ACCESS_LIST is screwed. */
      729     2790    2           GOTO ERR_STATUS;

   2790 25 001773   002513 710000 25                 TRA     ERR_STATUS

      730     2791    2           END;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:112  
      731     2792    2       DO WHILE('0'B);

   2792 25 001774   002206 710000 25                 TRA     CHKPORT

   2779 25 001775                       NXTPORT_IDX  null
      732     2793    2   NXTPORT_IDX: ;
      733     2794    2           IF ACCESS_LIST.PORT_IDX >= ACCESS_LIST.PORT_NUM THEN

   2794 25 001775   200004 470500                    LDP0    @ACCESS_LIST,,AUTO
        25 001776   000001 720100                    LXL0    1,,PR0
        25 001777   000002 100100                    CMPX0   2,,PR0
        25 002000   002464 603000 25                 TRC     FINLBL

      734     2795    2               GOTO FINLBL;
      735     2796    3           IF ACCESS_LIST.KEYED.MOVE(ACCESS_LIST.PORT_IDX) ~= ENTADDR(NIL) THEN DO;

   2796 25 002001   000001 236100                    LDQ     1,,PR0
        25 002002   000001 736000                    QLS     1
        25 002003   000005 376000 26                 ANQ     5
        25 002004   000003 236106                    LDQ     3,QL,PR0
        25 002005   000000 116000 26                 CMPQ    0
        25 002006   002054 600000 25                 TZE     s:2811

      736     2797    3               GEN_CODE_EPTR = ACCESS_LIST.KEYED.MOVE(ACCESS_LIST.PORT_IDX);

   2797 25 002007   000001 236100                    LDQ     1,,PR0
        25 002010   000001 736000                    QLS     1
        25 002011   000005 376000 26                 ANQ     5
        25 002012   000003 236106                    LDQ     3,QL,PR0
        25 002013   000000 756000 0                  STQ     GEN_CODE_EPTR

      737     2798    3               CALL GEN_CODE_EPTR ALTRET(NXTPORT_INCIDX);

   2798 25 002014   000000 221000 0                  LDX1    GEN_CODE_EPTR
        25 002015   000000 631400 26                 EPPR1   0
        25 002016   000000 701011                    TSX1    0,X1
        25 002017   002021 702000 25                 TSX2    NXTPORT_INCIDX
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:113  

      738     2799    4               DO WHILE('0'B);

   2799 25 002020   002026 710000 25                 TRA     s:2804

   2798 25 002021                       NXTPORT_INC* null
      739     2800    4   NXTPORT_INCIDX: ;
      740     2801    4                   ACCESS_LIST.PORT_IDX = ACCESS_LIST.PORT_IDX + 1;

   2801 25 002021   200004 470500                    LDP0    @ACCESS_LIST,,AUTO
        25 002022   000001 720100                    LXL0    1,,PR0
        25 002023   000001 621010                    EAX1    1,X0
        25 002024   000001 441100                    SXL1    1,,PR0

      741     2802    4                   GOTO NXTPORT_IDX;

   2802 25 002025   001775 710000 25                 TRA     NXTPORT_IDX

      742     2803    4                   END;

      743     2804    3               ZII$PARAMS = '0'B;

   2804 25 002026   000000 100400                    MLR     fill='000'O
        25 002027   000000 000001 26                 ADSC9   0                        cn=0,n=1
        25 002030   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84

      744     2805    3               ZII$PARAMS.R_HALF(0) = 3;

   2805 25 002031   000003 220003                    LDX0    3,DU
        25 002032   000000 440000 xsym               SXL0    ZII$PARAMS

      745     2806    3               ZII$PARAMS.L_HALF(1) = NAM1.DESC$(ACCESS_LIST.PORT)->RECORD.RVA_OFF;

   2806 25 002033   200004 470500                    LDP0    @ACCESS_LIST,,AUTO
        25 002034   000000 236100                    LDQ     0,,PR0
        25 002035   000022 772000                    QRL     18
        25 002036   000012 402007                    MPY     10,DL
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:114  
        25 002037   000000 471400 7                  LDP1    NAM1$
        25 002040   100011 473506                    LDP3    9,QL,PR1
        25 002041   300000 721100                    LXL1    0,,PR3
        25 002042   000001 741000 xsym               STX1    ZII$PARAMS+1

      746     2807    3               ZII$PARAMS.R_HALF(2) = %USING;

   2807 25 002043   000040 222003                    LDX2    32,DU
        25 002044   000002 442000 xsym               SXL2    ZII$PARAMS+2

      747     2808    3               ZII$PARAMS.L_HALF(3) = NAM1.DESC$(ACCESS_LIST.PORT_KEY)->KEY.RVA_OFF;

   2808 25 002045   000000 236100                    LDQ     0,,PR0
        25 002046   777777 376007                    ANQ     -1,DL
        25 002047   000012 402007                    MPY     10,DL
        25 002050   100011 473506                    LDP3    9,QL,PR1
        25 002051   300000 723100                    LXL3    0,,PR3
        25 002052   000003 743000 xsym               STX3    ZII$PARAMS+3

      748     2809    3               END;

   2809 25 002053   002166 710000 25                 TRA     s:2836

      749     2810    3           ELSE DO; /* No MOVE code supplied */

      750     2811    3               ACCESS_LIST.PORT_IDX = ACCESS_LIST.PORT_IDX + 1;

   2811 25 002054   000001 621010                    EAX1    1,X0
        25 002055   000001 441100                    SXL1    1,,PR0

      751     2812    3               IF ACCESS_LIST.PORT_IDX >= ACCESS_LIST.PORT_NUM THEN

   2812 25 002056   000002 101100                    CMPX1   2,,PR0
        25 002057   002464 603000 25                 TRC     FINLBL

      752     2813    3                   GOTO FINLBL;
      753     2814    3               IF ACCESS_LIST.KEYED.MOVE(ACCESS_LIST.PORT_IDX) ~= ENTADDR(NIL) THEN
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:115  

   2814 25 002060   000001 236100                    LDQ     1,,PR0
        25 002061   000001 736000                    QLS     1
        25 002062   000005 376000 26                 ANQ     5
        25 002063   000003 236106                    LDQ     3,QL,PR0
        25 002064   000000 116000 26                 CMPQ    0
        25 002065   001775 601000 25                 TNZ     NXTPORT_IDX

      754     2815    3                   GOTO NXTPORT_IDX;
      755     2816    3               CALL ZII$FIND_FIRST(ACCESS_LIST) ALTRET(ERR_STATUS);

   2816 25 002066   200004 630500                    EPPR0   @ACCESS_LIST,,AUTO
        25 002067   000006 631400 26                 EPPR1   6
        25 002070   000000 701000 xent               TSX1    ZII$FIND_FIRST
        25 002071   002513 702000 25                 TSX2    ERR_STATUS

      756     2817    3               ZII$PARAMS = '0'B;

   2817 25 002072   000000 100400                    MLR     fill='000'O
        25 002073   000000 000001 26                 ADSC9   0                        cn=0,n=1
        25 002074   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84

      757     2818    3               ZII$PARAMS.R_HALF(0) = 3;

   2818 25 002075   000003 220003                    LDX0    3,DU
        25 002076   000000 440000 xsym               SXL0    ZII$PARAMS

      758     2819    3               ZII$PARAMS.L_HALF(1) = NAM1.DESC$(ACCESS_LIST.PORT)->RECORD.RVA_OFF;

   2819 25 002077   200004 470500                    LDP0    @ACCESS_LIST,,AUTO
        25 002100   000000 236100                    LDQ     0,,PR0
        25 002101   000022 772000                    QRL     18
        25 002102   000012 402007                    MPY     10,DL
        25 002103   000000 471400 7                  LDP1    NAM1$
        25 002104   100011 473506                    LDP3    9,QL,PR1
        25 002105   300000 721100                    LXL1    0,,PR3
        25 002106   000001 741000 xsym               STX1    ZII$PARAMS+1
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:116  

      759     2820    3               ZII$PARAMS.R_HALF(2) = %USING;

   2820 25 002107   000040 222003                    LDX2    32,DU
        25 002110   000002 442000 xsym               SXL2    ZII$PARAMS+2

      760     2821    3               ZII$PARAMS.L_HALF(3) = NAM1.DESC$(ACCESS_LIST.PORT_KEY)->KEY.RVA_OFF;

   2821 25 002111   000000 236100                    LDQ     0,,PR0
        25 002112   777777 376007                    ANQ     -1,DL
        25 002113   000012 402007                    MPY     10,DL
        25 002114   100011 473506                    LDP3    9,QL,PR1
        25 002115   300000 723100                    LXL3    0,,PR3
        25 002116   000003 743000 xsym               STX3    ZII$PARAMS+3

      761     2822    3               CALL ZII$FIND ALTRET(BAD_FIND);

   2822 25 002117   000000 631400 26                 EPPR1   0
        25 002120   000000 701000 xent               TSX1    ZII$FIND
        25 002121   002525 702000 25                 TSX2    BAD_FIND

      762     2823    3               IF UWA.DB_STATUS = '0502100' /* end-of-set */ THEN

   2823 25 002122   000000 470400 13                 LDP0    UWA$
        25 002123   040000 106500                    CMPC    fill='040'O
        25 002124   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 002125   000002 000007 24                 ADSC9   2                        cn=0,n=7
        25 002126   001775 600000 25                 TZE     NXTPORT_IDX

      763     2824    3                   GOTO NXTPORT_IDX;
      764     2825    3               IF UWA.DB_STATUS ~= '0000000' AND

   2825 25 002127   040000 106500                    CMPC    fill='040'O
        25 002130   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 002131   000000 000007 24                 ADSC9   0                        cn=0,n=7
        25 002132   002137 600000 25                 TZE     s:2829
        25 002133   040000 106500                    CMPC    fill='040'O
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:117  
        25 002134   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 002135   000004 000007 24                 ADSC9   4                        cn=0,n=7
        25 002136   002525 601000 25                 TNZ     BAD_FIND

      765     2826    3                  UWA.DB_STATUS ~= '0502401' /* key val of rec found is
      766     2827         greater than specified val */
      767     2828    3               THEN GOTO BAD_FIND;
      768     2829    3               ZII$PARAMS = '0'B;

   2829 25 002137   000000 100400                    MLR     fill='000'O
        25 002140   000000 000001 26                 ADSC9   0                        cn=0,n=1
        25 002141   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84

      769     2830    3               ZII$PARAMS.R_HALF(0)=4;

   2830 25 002142   000004 220003                    LDX0    4,DU
        25 002143   000000 440000 xsym               SXL0    ZII$PARAMS

      770     2831    3               ZII$PARAMS.R_HALF(1)=%FIRST;

   2831 25 002144   000016 221003                    LDX1    14,DU
        25 002145   000001 441000 xsym               SXL1    ZII$PARAMS+1

      771     2832    3               ZII$PARAMS.L_HALF(2)=NAM1.DESC$(ACCESS_LIST.PORT) -> RECORD.RVA_OFF;

   2832 25 002146   200004 471500                    LDP1    @ACCESS_LIST,,AUTO
        25 002147   100000 236100                    LDQ     0,,PR1
        25 002150   000022 772000                    QRL     18
        25 002151   000012 402007                    MPY     10,DL
        25 002152   000000 473400 7                  LDP3    NAM1$
        25 002153   300011 474506                    LDP4    9,QL,PR3
        25 002154   400000 722100                    LXL2    0,,PR4
        25 002155   000002 742000 xsym               STX2    ZII$PARAMS+2

      772     2833    3               ZII$PARAMS.R_HALF(3) = %USING;

   2833 25 002156   000040 223003                    LDX3    32,DU
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:118  
        25 002157   000003 443000 xsym               SXL3    ZII$PARAMS+3

      773     2834    3               ZII$PARAMS.L_HALF(4) = NAM1.DESC$(ACCESS_LIST.PORT_KEY)->KEY.RVA_OFF;

   2834 25 002160   100000 236100                    LDQ     0,,PR1
        25 002161   777777 376007                    ANQ     -1,DL
        25 002162   000012 402007                    MPY     10,DL
        25 002163   300011 474506                    LDP4    9,QL,PR3
        25 002164   400000 724100                    LXL4    0,,PR4
        25 002165   000004 744000 xsym               STX4    ZII$PARAMS+4

      774     2835    3               END;

      775     2836    2           CALL ZII$FIND ALTRET(BAD_FIND);

   2836 25 002166   000000 631400 26                 EPPR1   0
        25 002167   000000 701000 xent               TSX1    ZII$FIND
        25 002170   002525 702000 25                 TSX2    BAD_FIND

      776     2837    2           IF UWA.DB_STATUS = '0502100' /* end-of-set */ THEN

   2837 25 002171   000000 470400 13                 LDP0    UWA$
        25 002172   040000 106500                    CMPC    fill='040'O
        25 002173   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 002174   000002 000007 24                 ADSC9   2                        cn=0,n=7
        25 002175   001775 600000 25                 TZE     NXTPORT_IDX

      777     2838    2               GOTO NXTPORT_IDX;
      778     2839    2           IF UWA.DB_STATUS ~= '0000000' AND

   2839 25 002176   040000 106500                    CMPC    fill='040'O
        25 002177   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 002200   000000 000007 24                 ADSC9   0                        cn=0,n=7
        25 002201   002206 600000 25                 TZE     CHKPORT
        25 002202   040000 106500                    CMPC    fill='040'O
        25 002203   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 002204   000004 000007 24                 ADSC9   4                        cn=0,n=7
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:119  
        25 002205   002525 601000 25                 TNZ     BAD_FIND

      779     2840    2              UWA.DB_STATUS ~= '0502401' /* key val of rec found is greater
      780     2841         than specified value */
      781     2842    2           THEN GOTO BAD_FIND;
      782     2843    2           END;

      783     2844    1   CHKPORT: IF UWA.DB_STATUS='0502100' /* end-of-set */ THEN

   2844 25 002206   000000 470400 13    CHKPORT      LDP0    UWA$
        25 002207   040000 106500                    CMPC    fill='040'O
        25 002210   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 002211   000002 000007 24                 ADSC9   2                        cn=0,n=7
        25 002212   002223 601000 25                 TNZ     s:2850

      784     2845    2       DO;

      785     2846    2           GEN_CODE_EPTR=PATH_LIST.INIT_EPTR(1);

   2846 25 002213   200003 471500                    LDP1    @PATH_LIST,,AUTO
        25 002214   100007 236100                    LDQ     7,,PR1
        25 002215   000000 756000 0                  STQ     GEN_CODE_EPTR

      786     2847    2           CALL GEN_CODE_EPTR;

   2847 25 002216   000000 220000 0                  LDX0    GEN_CODE_EPTR
        25 002217   000000 631400 26                 EPPR1   0
        25 002220   000000 701010                    TSX1    0,X0
        25 002221   000000 011000                    NOP     0

      787     2848    2           GOTO FINLBL;

   2848 25 002222   002464 710000 25                 TRA     FINLBL

      788     2849    2           END;
      789     2850    1       IF UWA.DB_STATUS = '0502400' /* no such rec found */ THEN

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:120  
   2850 25 002223   040000 106500                    CMPC    fill='040'O
        25 002224   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 002225   000006 000007 24                 ADSC9   6                        cn=0,n=7
        25 002226   001453 600000 25                 TZE     NXTPORT

      790     2851    1           GOTO NXTPORT;
      791     2852    1       ELSE
      792     2853    1           IF UWA.DB_STATUS ~= '0000000' AND

   2853 25 002227   040000 106500                    CMPC    fill='040'O
        25 002230   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 002231   000000 000007 24                 ADSC9   0                        cn=0,n=7
        25 002232   002237 600000 25                 TZE     s:2857
        25 002233   040000 106500                    CMPC    fill='040'O
        25 002234   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 002235   000004 000007 24                 ADSC9   4                        cn=0,n=7
        25 002236   002525 601000 25                 TNZ     BAD_FIND

      793     2854    1              UWA.DB_STATUS ~= '0502401' /* key val of rec found is greater
      794     2855         than specified value */
      795     2856    1           THEN GOTO BAD_FIND;
      796     2857    1       CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,PATH_LIST.REC_NO(1),TEMP_VALUE);

   2857 25 002237   200011 631500                    EPPR1   TEMP_VALUE,,AUTO
        25 002240   200034 451500                    STP1    NAME+10,,AUTO
        25 002241   200003 236100                    LDQ     @PATH_LIST,,AUTO
        25 002242   000005 036003                    ADLQ    5,DU
        25 002243   000007 235000 26                 LDA     7
        25 002244   200032 757100                    STAQ    NAME+8,,AUTO
        25 002245   200032 630500                    EPPR0   NAME+8,,AUTO
        25 002246   000001 631400 26                 EPPR1   1
        25 002247   000000 701000 xent               TSX1    ZII$FIND_PRESENCE_IDX
        25 002250   000000 011000                    NOP     0

      797     2858    1       PRESENCE_LIST.P_VALUE(TEMP_VALUE)=%NEW;

   2858 25 002251   200011 235100                    LDA     TEMP_VALUE,,AUTO
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:121  
        25 002252   000001 735000                    ALS     1
        25 002253   000002 220003                    LDX0    2,DU
        25 002254   000001 440005 0                  SXL0    PRESENCE_LIST,AL

      798     2859    1       PRESENCE_LIST.DB_KEY_SAVE(TEMP_VALUE)=UWA.DIRECT_REFERENCE;

   2859 25 002255   000000 470400 13                 LDP0    UWA$
        25 002256   000000 621005                    EAX1    0,AL
        25 002257   000036 235100                    LDA     30,,PR0
        25 002260   000002 755011 0                  STA     PRESENCE_LIST+1,X1

      799     2860    1       IF PATH_LIST.GET_IND(1) THEN

   2860 25 002261   200003 471500                    LDP1    @PATH_LIST,,AUTO
        25 002262   100006 236100                    LDQ     6,,PR1
        25 002263   200000 316003                    CANQ    65536,DU
        25 002264   002370 600000 25                 TZE     s:2888

      800     2861    2       DO;

      801     2862    2           ZII$PARAMS='0'B;

   2862 25 002265   000000 100400                    MLR     fill='000'O
        25 002266   000000 000001 26                 ADSC9   0                        cn=0,n=1
        25 002267   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84

      802     2863    2           ZII$PARAMS.R_HALF(0)=1;

   2863 25 002270   000001 222003                    LDX2    1,DU
        25 002271   000000 442000 xsym               SXL2    ZII$PARAMS

      803     2864    2           DR$=NAM1.DESC$(PATH_LIST.REC_NO(1));

   2864 25 002272   100005 236100                    LDQ     5,,PR1
        25 002273   000022 772000                    QRL     18
        25 002274   000012 402007                    MPY     10,DL
        25 002275   000000 473400 7                  LDP3    NAM1$
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:122  
        25 002276   300011 236106                    LDQ     9,QL,PR3
        25 002277   000000 756000 18                 STQ     DR$

      804     2865    2           ZII$PARAMS.L_HALF(1)=RECORD.RVA_OFF;

   2865 25 002300   000000 474400 18                 LDP4    DR$
        25 002301   400000 723100                    LXL3    0,,PR4
        25 002302   000001 743000 xsym               STX3    ZII$PARAMS+1

      805     2866    2           CALL ZII$GET ALTRET(BAD_GET);

   2866 25 002303   000000 631400 26                 EPPR1   0
        25 002304   000000 701000 xent               TSX1    ZII$GET
        25 002305   002547 702000 25                 TSX2    BAD_GET

      806     2867    2           IF UWA.DB_STATUS='0000000' THEN

   2867 25 002306   000000 470400 13                 LDP0    UWA$
        25 002307   040000 106500                    CMPC    fill='040'O
        25 002310   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 002311   000000 000007 24                 ADSC9   0                        cn=0,n=7
        25 002312   002360 601000 25                 TNZ     s:2883

      807     2868    3           DO;

      808     2869    3               ALL_BRANCHES_DONE=0;

   2869 25 002313   000713 450000 0                  STZ     ALL_BRANCHES_DONE

      809     2870    3               GEN_CODE_EPTR=PATH_LIST.CONVERT_EPTR(1);

   2870 25 002314   200003 471500                    LDP1    @PATH_LIST,,AUTO
        25 002315   100010 236100                    LDQ     8,,PR1
        25 002316   000000 756000 0                  STQ     GEN_CODE_EPTR

      810     2871    3               CALL GEN_CODE_EPTR;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:123  
   2871 25 002317   000000 220000 0                  LDX0    GEN_CODE_EPTR
        25 002320   000000 631400 26                 EPPR1   0
        25 002321   000000 701010                    TSX1    0,X0
        25 002322   000000 011000                    NOP     0

      811     2872    3               IF ACCESS_LIST.PORT_TYPE = %KEYED_ACCESS AND

   2872 25 002323   200004 470500                    LDP0    @ACCESS_LIST,,AUTO
        25 002324   000001 220100                    LDX0    1,,PR0
        25 002325   000003 100003                    CMPX0   3,DU
        25 002326   002346 601000 25                 TNZ     s:2877
        25 002327   000001 236100                    LDQ     1,,PR0
        25 002330   000001 736000                    QLS     1
        25 002331   000005 376000 26                 ANQ     5
        25 002332   000004 236106                    LDQ     4,QL,PR0
        25 002333   000000 116000 26                 CMPQ    0
        25 002334   002346 600000 25                 TZE     s:2877

      812     2873    4                  ACCESS_LIST.KEYED.CHECK(ACCESS_LIST.PORT_IDX)~=ENTADDR(NIL) THEN DO;

      813     2874    4                   GEN_CODE_EPTR=ACCESS_LIST.KEYED.CHECK(ACCESS_LIST.PORT_IDX);

   2874 25 002335   000001 236100                    LDQ     1,,PR0
        25 002336   000001 736000                    QLS     1
        25 002337   000005 376000 26                 ANQ     5
        25 002340   000004 236106                    LDQ     4,QL,PR0
        25 002341   000000 756000 0                  STQ     GEN_CODE_EPTR

      814     2875    4                   CALL GEN_CODE_EPTR ALTRET(NXTPORT_IDX);

   2875 25 002342   000000 221000 0                  LDX1    GEN_CODE_EPTR
        25 002343   000000 631400 26                 EPPR1   0
        25 002344   000000 701011                    TSX1    0,X1
        25 002345   001775 702000 25                 TSX2    NXTPORT_IDX

      815     2876    4                   END;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:124  
      816     2877    3               GEN_CODE_EPTR=PATH_LIST.CONSTRAINT_EPTR(1);

   2877 25 002346   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 002347   000011 236100                    LDQ     9,,PR0
        25 002350   000000 756000 0                  STQ     GEN_CODE_EPTR

      817     2878    3               IF GEN_CODE_EPTR~=ENTADDR(NIL) THEN

   2878 25 002351   000000 116000 26                 CMPQ    0
        25 002352   002370 600000 25                 TZE     s:2888

      818     2879    3                   CALL GEN_CODE_EPTR ALTRET(NXTPORT);

   2879 25 002353   000000 220000 0                  LDX0    GEN_CODE_EPTR
        25 002354   000000 631400 26                 EPPR1   0
        25 002355   000000 701010                    TSX1    0,X0
        25 002356   001453 702000 25                 TSX2    NXTPORT

      819     2880    3               END;

   2880 25 002357   002370 710000 25                 TRA     s:2888

      820     2881    2           ELSE
      821     2882    3           DO;

      822     2883    3               GEN_CODE_EPTR=PATH_LIST.INIT_EPTR(1);

   2883 25 002360   200003 471500                    LDP1    @PATH_LIST,,AUTO
        25 002361   100007 236100                    LDQ     7,,PR1
        25 002362   000000 756000 0                  STQ     GEN_CODE_EPTR

      823     2884    3               CALL GEN_CODE_EPTR;

   2884 25 002363   000000 220000 0                  LDX0    GEN_CODE_EPTR
        25 002364   000000 631400 26                 EPPR1   0
        25 002365   000000 701010                    TSX1    0,X0
        25 002366   000000 011000                    NOP     0
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:125  

      824     2885    3               GOTO FINLBL;

   2885 25 002367   002464 710000 25                 TRA     FINLBL

      825     2886    3               END;
      826     2887    2           END;
      827     2888    2       DO I=1 TO PATH_LIST.REC_NO(0);

   2888 25 002370   000001 235007                    LDA     1,DL
        25 002371   000710 755000 0                  STA     I
        25 002372   002404 710000 25                 TRA     s:2890+3

      828     2889    2           PATH_LIST.FIND_ATTEMPTED(I)='0'B;

   2889 25 002373   000710 236000 0                  LDQ     I
        25 002374   000005 402007                    MPY     5,DL
        25 002375   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 002376   000000 620006                    EAX0    0,QL
        25 002377   000013 236000 26                 LDQ     11
        25 002400   000001 356110                    ANSQ    1,X0,PR0

      829     2890    2           END;

   2890 25 002401   000710 235000 0                  LDA     I
        25 002402   000001 035007                    ADLA    1,DL
        25 002403   000710 755000 0                  STA     I
        25 002404   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 002405   000000 236100                    LDQ     0,,PR0
        25 002406   000022 772000                    QRL     18
        25 002407   000710 116000 0                  CMPQ    I
        25 002410   002373 603000 25                 TRC     s:2889

      830     2891    1       IF PATH_LIST.REC_NO(0)=1 THEN

   2891 25 002411   000000 220100                    LDX0    0,,PR0
        25 002412   000001 100003                    CMPX0   1,DU
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:126  
        25 002413   001131 600000 25                 TZE     OUTLBL

      831     2892    1           GOTO OUTLBL;
      832     2893    1       ELSE
      833     2894    2       DO;

      834     2895    3           DO I=1 TO PATH_LIST.REC_NO(0);

   2895 25 002414   000001 235007                    LDA     1,DL
        25 002415   000710 755000 0                  STA     I
        25 002416   002430 710000 25                 TRA     s:2897+3

      835     2896    3               PATH_LIST.BRANCH_EXHAUSTED(I)='0'B;

   2896 25 002417   000710 236000 0                  LDQ     I
        25 002420   000005 402007                    MPY     5,DL
        25 002421   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 002422   000000 620006                    EAX0    0,QL
        25 002423   000010 236000 26                 LDQ     8
        25 002424   000001 356110                    ANSQ    1,X0,PR0

      836     2897    3               END;

   2897 25 002425   000710 235000 0                  LDA     I
        25 002426   000001 035007                    ADLA    1,DL
        25 002427   000710 755000 0                  STA     I
        25 002430   000000 236100                    LDQ     0,,PR0
        25 002431   000022 772000                    QRL     18
        25 002432   000710 116000 0                  CMPQ    I
        25 002433   002417 603000 25                 TRC     s:2896

      837     2898    2           N=1;

   2898 25 002434   000001 235007                    LDA     1,DL
        25 002435   000714 755000 0                  STA     N

      838     2899    2           CURRENT_BRANCH=1;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:127  

   2899 25 002436   200014 755100                    STA     CURRENT_BRANCH,,AUTO

      839     2900         /*
      840     2901            Set all find first flags for all records indicated as
      841     2902            set members in the path. Don't bother to set it for records
      842     2903            which indicate the start of a new branch.
      843     2904         */
      844     2905    3           DO I=1 TO PATH_LIST.REC_NO(0)-1;

   2905 25 002437   000710 755000 0                  STA     I
        25 002440   002456 710000 25                 TRA     s:2908+3

      845     2906    3               IF NOT PATH_LIST.OWN_NEXT(I) AND PATH_LIST.SET_NO(I)~=0 THEN

   2906 25 002441   000710 236000 0                  LDQ     I
        25 002442   000005 402007                    MPY     5,DL
        25 002443   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 002444   000001 234106                    SZN     1,QL,PR0
        25 002445   002453 604000 25                 TMI     s:2908
        25 002446   000000 720106                    LXL0    0,QL,PR0
        25 002447   002453 600000 25                 TZE     s:2908

      846     2907    3                   PATH_LIST.FIND_FIRST(I+1)='1'B;

   2907 25 002450   000000 621006                    EAX1    0,QL
        25 002451   004000 236003                    LDQ     2048,DU
        25 002452   000006 256111                    ORSQ    6,X1,PR0

      847     2908    3               END;

   2908 25 002453   000710 235000 0                  LDA     I
        25 002454   000001 035007                    ADLA    1,DL
        25 002455   000710 755000 0                  STA     I
        25 002456   000000 236100                    LDQ     0,,PR0
        25 002457   000022 772000                    QRL     18
        25 002460   000710 116000 0                  CMPQ    I
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:128  
        25 002461   002463 600000 25                 TZE     s:2909
        25 002462   002441 603000 25                 TRC     s:2906

      848     2909    2           GOTO RECUR;

   2909 25 002463   001022 710000 25                 TRA     RECUR

      849     2910    2           END;
      850     2911        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:129  
      851     2912        /*
      852     2913          This database has been exhaustively searched; FINISH all areas that
      853     2914          were previously READied and then RETURN.
      854     2915        */
      855     2916    1   FINLBL:
      856     2917    1       ZII$PARAMS='0'B;

   2917 25 002464   000000 100400       FINLBL       MLR     fill='000'O
        25 002465   000000 000001 26                 ADSC9   0                        cn=0,n=1
        25 002466   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84

      857     2918    1       ZII$PARAMS.R_HALF(0)=2;

   2918 25 002467   000002 220003                    LDX0    2,DU
        25 002470   000000 440000 xsym               SXL0    ZII$PARAMS

      858     2919    1       ZII$PARAMS.R_HALF(1)=1;

   2919 25 002471   000001 221003                    LDX1    1,DU
        25 002472   000001 441000 xsym               SXL1    ZII$PARAMS+1

      859     2920    1       ZII$PARAMS.R_HALF(2)=1;

   2920 25 002473   000002 441000 xsym               SXL1    ZII$PARAMS+2

      860     2921    1       ZII$INTEGER1=2;

   2921 25 002474   000002 235007                    LDA     2,DL
        25 002475   000000 755000 xsym               STA     ZII$INTEGER1

      861     2922    1       ZII$INTEGER2=0;

   2922 25 002476   000000 450000 xsym               STZ     ZII$INTEGER2

      862     2923    1       CALL ZII$CHECK ALTRET(ERR_STATUS);

   2923 25 002477   000000 631400 26                 EPPR1   0
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:130  
        25 002500   000000 701000 xent               TSX1    ZII$CHECK
        25 002501   002513 702000 25                 TSX2    ERR_STATUS

      863     2924    1       ZII$PARAMS.R_HALF(0)=0;

   2924 25 002502   000000 220003                    LDX0    0,DU
        25 002503   000000 440000 xsym               SXL0    ZII$PARAMS

      864     2925    1       CALL ZII$FINISH ALTRET(BAD_FINISH);

   2925 25 002504   000000 631400 26                 EPPR1   0
        25 002505   000000 701000 xent               TSX1    ZII$FINISH
        25 002506   002640 702000 25                 TSX2    BAD_FINISH

      865     2926    1       ZI_RETRIEVING = '0'B;

   2926 25 002507   000000 450000 5                  STZ     ZI_RETRIEVING

      866     2927    1       STATUS_CODE=0;

   2927 25 002510   200007 470500                    LDP0    @STATUS_CODE,,AUTO
        25 002511   000000 450100                    STZ     0,,PR0

      867     2928    1       RETURN;

   2928 25 002512   000000 702200 xent               TSX2  ! X66_ARET

      868     2929    1   ERR_STATUS:
      869     2930    1       STATUS_CODE=%ZII_INTERNAL_ERROR;

   2930 25 002513   013577 235007       ERR_STATUS   LDA     6015,DL
        25 002514   200007 470500                    LDP0    @STATUS_CODE,,AUTO
        25 002515   000000 755100                    STA     0,,PR0

      870     2931    1       ZII$PARAMS.R_HALF(0)=0;

   2931 25 002516   000000 220003                    LDX0    0,DU
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:131  
        25 002517   000000 440000 xsym               SXL0    ZII$PARAMS

      871     2932    1       CALL ZII$FINISH ALTRET(BAD_FINISH);

   2932 25 002520   000000 631400 26                 EPPR1   0
        25 002521   000000 701000 xent               TSX1    ZII$FINISH
        25 002522   002640 702000 25                 TSX2    BAD_FINISH

      872     2933    1       ZI_RETRIEVING = '0'B;

   2933 25 002523   000000 450000 5                  STZ     ZI_RETRIEVING

      873     2934    1       ALTRETURN;

   2934 25 002524   000000 702200 xent               TSX2  ! X66_AALT

      874     2935    1   BAD_FIND:
      875     2936    1       DB_STATUS_SAVE=UWA.DB_STATUS;

   2936 25 002525   000000 470400 13    BAD_FIND     LDP0    UWA$
        25 002526   040000 100500                    MLR     fill='040'O
        25 002527   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 002530   000706 000007 0                  ADSC9   DB_STATUS_SAVE           cn=0,n=7

      876     2937    1       STATUS_CODE=%ZII_BAD_FIND;

   2937 25 002531   013564 235007                    LDA     6004,DL
        25 002532   200007 471500                    LDP1    @STATUS_CODE,,AUTO
        25 002533   100000 755100                    STA     0,,PR1

      877     2938    1       ZII$PARAMS.R_HALF(0)=0;

   2938 25 002534   000000 220003                    LDX0    0,DU
        25 002535   000000 440000 xsym               SXL0    ZII$PARAMS

      878     2939    1       CALL ZII$FINISH ALTRET(BAD_FINISH);

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:132  
   2939 25 002536   000000 631400 26                 EPPR1   0
        25 002537   000000 701000 xent               TSX1    ZII$FINISH
        25 002540   002640 702000 25                 TSX2    BAD_FINISH

      879     2940    1       ZI_RETRIEVING = '0'B;

   2940 25 002541   000000 450000 5                  STZ     ZI_RETRIEVING

      880     2941    1       UWA.DB_STATUS=DB_STATUS_SAVE;

   2941 25 002542   000000 470400 13                 LDP0    UWA$
        25 002543   040100 100400                    MLR     fill='040'O
        25 002544   000706 000007 0                  ADSC9   DB_STATUS_SAVE           cn=0,n=7
        25 002545   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7

      881     2942    1       ALTRETURN;

   2942 25 002546   000000 702200 xent               TSX2  ! X66_AALT

      882     2943    1   BAD_GET:
      883     2944    1       DB_STATUS_SAVE=UWA.DB_STATUS;

   2944 25 002547   000000 470400 13    BAD_GET      LDP0    UWA$
        25 002550   040000 100500                    MLR     fill='040'O
        25 002551   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 002552   000706 000007 0                  ADSC9   DB_STATUS_SAVE           cn=0,n=7

      884     2945    1       STATUS_CODE=%ZII_BAD_GET;

   2945 25 002553   013565 235007                    LDA     6005,DL
        25 002554   200007 471500                    LDP1    @STATUS_CODE,,AUTO
        25 002555   100000 755100                    STA     0,,PR1

      885     2946    1       ZII$PARAMS.R_HALF(0)=0;

   2946 25 002556   000000 220003                    LDX0    0,DU
        25 002557   000000 440000 xsym               SXL0    ZII$PARAMS
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:133  

      886     2947    1       CALL ZII$FINISH ALTRET(BAD_FINISH);

   2947 25 002560   000000 631400 26                 EPPR1   0
        25 002561   000000 701000 xent               TSX1    ZII$FINISH
        25 002562   002640 702000 25                 TSX2    BAD_FINISH

      887     2948    1       ZI_RETRIEVING = '0'B;

   2948 25 002563   000000 450000 5                  STZ     ZI_RETRIEVING

      888     2949    1       UWA.DB_STATUS=DB_STATUS_SAVE;

   2949 25 002564   000000 470400 13                 LDP0    UWA$
        25 002565   040100 100400                    MLR     fill='040'O
        25 002566   000706 000007 0                  ADSC9   DB_STATUS_SAVE           cn=0,n=7
        25 002567   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7

      889     2950    1       ALTRETURN;

   2950 25 002570   000000 702200 xent               TSX2  ! X66_AALT

      890     2951    1   BAD_READY:
      891     2952    1       IF UWA.DB_STATUS = '1370079' /* can't READY integrated area */ THEN

   2952 25 002571   000000 470400 13    BAD_READY    LDP0    UWA$
        25 002572   040000 106500                    CMPC    fill='040'O
        25 002573   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 002574   000010 000007 24                 ADSC9   8                        cn=0,n=7
        25 002575   002602 601000 25                 TNZ     s:2955

      892     2953    1           STATUS_CODE = %ZII_CANT_OPEN_AREA;

   2953 25 002576   013575 235007                    LDA     6013,DL
        25 002577   200007 471500                    LDP1    @STATUS_CODE,,AUTO
        25 002600   100000 755100                    STA     0,,PR1
        25 002601   002615 710000 25                 TRA     s:2959
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:134  

      893     2954    1       ELSE
      894     2955    1           IF UWA.DB_STATUS = '1370080' /* can't READY altkey file */ THEN

   2955 25 002602   040000 106500                    CMPC    fill='040'O
        25 002603   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 002604   000012 000007 24                 ADSC9   10                       cn=0,n=7
        25 002605   002612 601000 25                 TNZ     s:2958

      895     2956    1               STATUS_CODE = %ZII_CANT_OPEN_ALTKEYFILE;

   2956 25 002606   013576 235007                    LDA     6014,DL
        25 002607   200007 471500                    LDP1    @STATUS_CODE,,AUTO
        25 002610   100000 755100                    STA     0,,PR1
        25 002611   002615 710000 25                 TRA     s:2959

      896     2957    1           ELSE
      897     2958    1               STATUS_CODE = %ZII_BAD_READY;

   2958 25 002612   013567 235007                    LDA     6007,DL
        25 002613   200007 471500                    LDP1    @STATUS_CODE,,AUTO
        25 002614   100000 755100                    STA     0,,PR1

      898     2959    1       DB_STATUS_SAVE = UWA.DB_STATUS;

   2959 25 002615   000000 470400 13                 LDP0    UWA$
        25 002616   040000 100500                    MLR     fill='040'O
        25 002617   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 002620   000706 000007 0                  ADSC9   DB_STATUS_SAVE           cn=0,n=7

      899     2960    1       ZII$PARAMS.R_HALF(0) = 0;

   2960 25 002621   000000 220003                    LDX0    0,DU
        25 002622   000000 440000 xsym               SXL0    ZII$PARAMS

      900     2961    1       CALL ZII$FINISH ALTRET(BAD_FINISH);

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:135  
   2961 25 002623   000000 631400 26                 EPPR1   0
        25 002624   000000 701000 xent               TSX1    ZII$FINISH
        25 002625   002640 702000 25                 TSX2    BAD_FINISH

      901     2962    1       ZI_RETRIEVING = '0'B;

   2962 25 002626   000000 450000 5                  STZ     ZI_RETRIEVING

      902     2963    1       UWA.DB_STATUS = DB_STATUS_SAVE;

   2963 25 002627   000000 470400 13                 LDP0    UWA$
        25 002630   040100 100400                    MLR     fill='040'O
        25 002631   000706 000007 0                  ADSC9   DB_STATUS_SAVE           cn=0,n=7
        25 002632   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7

      903     2964    1       ALTRETURN;

   2964 25 002633   000000 702200 xent               TSX2  ! X66_AALT

      904     2965    1   BAD_HIA:
      905     2966    1       STATUS_CODE=%ZII_BAD_HIA;

   2966 25 002634   013566 235007       BAD_HIA      LDA     6006,DL
        25 002635   200007 470500                    LDP0    @STATUS_CODE,,AUTO
        25 002636   000000 755100                    STA     0,,PR0

      906     2967    1       ALTRETURN;

   2967 25 002637   000000 702200 xent               TSX2  ! X66_AALT

      907     2968    1   BAD_FINISH:
      908     2969    1       STATUS_CODE=%ZII_BAD_FINISH;

   2969 25 002640   013570 235007       BAD_FINISH   LDA     6008,DL
        25 002641   200007 470500                    LDP0    @STATUS_CODE,,AUTO
        25 002642   000000 755100                    STA     0,,PR0

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:136  
      909     2970    1       ZI_RETRIEVING = '0'B;

   2970 25 002643   000000 450000 5                  STZ     ZI_RETRIEVING

      910     2971    1       ALTRETURN;

   2971 25 002644   000000 702200 xent               TSX2  ! X66_AALT

      911     2972    1   BAD_RECURSION:
      912     2973    1       DB_STATUS_SAVE=UWA.DB_STATUS;

   2973 25 002645   000000 470400 13    BAD_RECURSI* LDP0    UWA$
        25 002646   040000 100500                    MLR     fill='040'O
        25 002647   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 002650   000706 000007 0                  ADSC9   DB_STATUS_SAVE           cn=0,n=7

      913     2974    1       ZII$PARAMS.R_HALF(0)=0;

   2974 25 002651   000000 220003                    LDX0    0,DU
        25 002652   000000 440000 xsym               SXL0    ZII$PARAMS

      914     2975    1       CALL ZII$FINISH ALTRET(BAD_FINISH);

   2975 25 002653   000000 631400 26                 EPPR1   0
        25 002654   000000 701000 xent               TSX1    ZII$FINISH
        25 002655   002640 702000 25                 TSX2    BAD_FINISH

      915     2976    1       ZI_RETRIEVING = '0'B;

   2976 25 002656   000000 450000 5                  STZ     ZI_RETRIEVING

      916     2977    1       UWA.DB_STATUS=DB_STATUS_SAVE;

   2977 25 002657   000000 470400 13                 LDP0    UWA$
        25 002660   040100 100400                    MLR     fill='040'O
        25 002661   000706 000007 0                  ADSC9   DB_STATUS_SAVE           cn=0,n=7
        25 002662   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:137  

      917     2978    1       ALTRETURN;

   2978 25 002663   000000 702200 xent               TSX2  ! X66_AALT

      918     2979    1   BAD_BUFFERS:
      919     2980    1       STATUS_CODE=%ZII_BAD_BUF;

   2980 25 002664   013572 235007       BAD_BUFFERS  LDA     6010,DL
        25 002665   200007 470500                    LDP0    @STATUS_CODE,,AUTO
        25 002666   000000 755100                    STA     0,,PR0

      920     2981    1       ZI_RETRIEVING = '0'B;

   2981 25 002667   000000 450000 5                  STZ     ZI_RETRIEVING

      921     2982    1       ALTRETURN;

   2982 25 002670   000000 702200 xent               TSX2  ! X66_AALT

      922     2983         %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:138  
      923     2984        /*
      924     2985          This routine evaluates the PRESENCE_LIST and determines where on the
      925     2986          Path the next database FIND should be performed.
      926     2987        */
      927     2988    1   EVAL_PRESENCE: PROC;

   2988 25 002671   200016 741300       EVAL_PRESEN* STX1  ! SHARE_IND+1,,AUTO

      928     2989    2   DCL COUNTER UBIN AUTO;
      929     2990    2   DCL EXHAUSTED_BRANCHES UBIN AUTO;
      930     2991    2   DCL COUNTER_OF_BRANCHES UBIN AUTO;
      931     2992    2   DCL CHK_PIVOT BIT(1) ALIGNED;
      932     2993        /**/
      933     2994        /* This section sets START_OF_BRANCH to the start node of
      934     2995           NEXT_BRANCH in the Path List.                      */
      935     2996    2   BGIN: IF NEXT_BRANCH=1 THEN

   2996 25 002672   200012 235100       BGIN         LDA     NEXT_BRANCH,,AUTO
        25 002673   000001 115007                    CMPA    1,DL
        25 002674   002700 601000 25                 TNZ     s:3000

      936     2997    2           START_OF_BRANCH=1;

   2997 25 002675   000001 236007                    LDQ     1,DL
        25 002676   200013 756100                    STQ     START_OF_BRANCH,,AUTO
        25 002677   002736 710000 25                 TRA     FOUND

      937     2998    2       ELSE
      938     2999    3       DO;

      939     3000    3           COUNTER=1;

   3000 25 002700   000001 236007                    LDQ     1,DL
        25 002701   200017 756100                    STQ     COUNTER,,AUTO

      940     3001    3           START_OF_BRANCH=1;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:139  
   3001 25 002702   200013 756100                    STQ     START_OF_BRANCH,,AUTO

      941     3002    4           DO WHILE(START_OF_BRANCH<=PATH_LIST.REC_NO(0));

   3002 25 002703   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 002704   000000 236100                    LDQ     0,,PR0
        25 002705   000022 772000                    QRL     18
        25 002706   200013 116100                    CMPQ    START_OF_BRANCH,,AUTO
        25 002707   002736 602000 25                 TNC     FOUND

      942     3003    4               IF PATH_LIST.SET_NO(START_OF_BRANCH)=0 THEN

   3003 25 002710   200013 236100                    LDQ     START_OF_BRANCH,,AUTO
        25 002711   000005 402007                    MPY     5,DL
        25 002712   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 002713   000000 720106                    LXL0    0,QL,PR0
        25 002714   002727 601000 25                 TNZ     s:3012

      943     3004    5               DO;

      944     3005    5                   COUNTER=COUNTER+1;

   3005 25 002715   200017 235100                    LDA     COUNTER,,AUTO
        25 002716   000001 035007                    ADLA    1,DL
        25 002717   200017 755100                    STA     COUNTER,,AUTO

      945     3006    5                   IF COUNTER=NEXT_BRANCH THEN

   3006 25 002720   200017 236100                    LDQ     COUNTER,,AUTO
        25 002721   200012 116100                    CMPQ    NEXT_BRANCH,,AUTO
        25 002722   002727 601000 25                 TNZ     s:3012

      946     3007    6                   DO;

      947     3008    6                       START_OF_BRANCH=START_OF_BRANCH+1;

   3008 25 002723   200013 235100                    LDA     START_OF_BRANCH,,AUTO
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:140  
        25 002724   000001 035007                    ADLA    1,DL
        25 002725   200013 755100                    STA     START_OF_BRANCH,,AUTO

      948     3009    6                       GOTO FOUND;

   3009 25 002726   002736 710000 25                 TRA     FOUND

      949     3010    6                       END;
      950     3011    5                   END;
      951     3012    4               START_OF_BRANCH=START_OF_BRANCH+1;

   3012 25 002727   200013 235100                    LDA     START_OF_BRANCH,,AUTO
        25 002730   000001 035007                    ADLA    1,DL
        25 002731   200013 755100                    STA     START_OF_BRANCH,,AUTO

      952     3013    4               END;

   3013 25 002732   000000 236100                    LDQ     0,,PR0
        25 002733   000022 772000                    QRL     18
        25 002734   200013 116100                    CMPQ    START_OF_BRANCH,,AUTO
        25 002735   002710 603000 25                 TRC     s:3003

      953     3014    3           END;

      954     3015        /* This section finds the new starting node to perform the next
      955     3016           FIND on the newly found NEXT_BRANCH.                           */
      956     3017    2   FOUND: IF PATH_LIST.BRANCH_EXHAUSTED(START_OF_BRANCH)='0'B THEN

   3017 25 002736   200013 236100       FOUND        LDQ     START_OF_BRANCH,,AUTO
        25 002737   000005 402007                    MPY     5,DL
        25 002740   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 002741   000001 236106                    LDQ     1,QL,PR0
        25 002742   020000 316003                    CANQ    8192,DU
        25 002743   003215 601000 25                 TNZ     NEWBR

      957     3018    3       DO;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:141  
      958     3019    3           COUNTER=START_OF_BRANCH;

   3019 25 002744   200013 235100                    LDA     START_OF_BRANCH,,AUTO
        25 002745   200017 755100                    STA     COUNTER,,AUTO

      959     3020    4           DO WHILE(PATH_LIST.SET_NO(COUNTER)~=0);

   3020 25 002746   200017 236100                    LDQ     COUNTER,,AUTO
        25 002747   000005 402007                    MPY     5,DL
        25 002750   000000 720106                    LXL0    0,QL,PR0
        25 002751   002763 600000 25                 TZE     BACKUP

      960     3021    4               COUNTER=COUNTER+1;

   3021 25 002752   200017 235100                    LDA     COUNTER,,AUTO
        25 002753   000001 035007                    ADLA    1,DL
        25 002754   200017 755100                    STA     COUNTER,,AUTO

      961     3022    4               END;

   3022 25 002755   200017 236100                    LDQ     COUNTER,,AUTO
        25 002756   000005 402007                    MPY     5,DL
        25 002757   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 002760   000000 720106                    LXL0    0,QL,PR0
        25 002761   002752 601000 25                 TNZ     s:3021

      962     3023    3           END;

   3023 25 002762   002763 710000 25                 TRA     BACKUP

      963     3024    2       ELSE
      964     3025    2           GOTO NEWBR;
      965     3026    2   BACKUP: COUNTER=COUNTER-1;

   3026 25 002763   200017 235100       BACKUP       LDA     COUNTER,,AUTO
        25 002764   000001 135007                    SBLA    1,DL
        25 002765   200017 755100                    STA     COUNTER,,AUTO
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:142  

      966     3027    2       IF COUNTER=START_OF_BRANCH THEN

   3027 25 002766   200017 236100                    LDQ     COUNTER,,AUTO
        25 002767   200013 116100                    CMPQ    START_OF_BRANCH,,AUTO
        25 002770   003025 601000 25                 TNZ     s:3058

      967     3028    3       DO;

      968     3029    3           IF PATH_LIST.BRANCH_EXHAUSTED(COUNTER)='1'B THEN

   3029 25 002771   000005 402007                    MPY     5,DL
        25 002772   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 002773   000001 236106                    LDQ     1,QL,PR0
        25 002774   020000 316003                    CANQ    8192,DU
        25 002775   003215 601000 25                 TNZ     NEWBR

      969     3030    3               GOTO NEWBR;
      970     3031    3           ELSE
      971     3032    3               IF PATH_LIST.OWN_NEXT(COUNTER)='0'B THEN

   3032 25 002776   200017 236100                    LDQ     COUNTER,,AUTO
        25 002777   000005 402007                    MPY     5,DL
        25 003000   000001 234106                    SZN     1,QL,PR0
        25 003001   003007 604000 25                 TMI     s:3039

      972     3033    4               DO;

      973     3034    4                   N=COUNTER;

   3034 25 003002   200017 235100                    LDA     COUNTER,,AUTO
        25 003003   000714 755000 0                  STA     N

      974     3035    4                   CALL EVALBR;

   3035 25 003004   003233 701000 25                 TSX1    EVALBR
        25 003005   000000 011000                    NOP     0
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:143  

      975     3036    4                   END;

   3036 25 003006   003135 710000 25                 TRA     s:3090

      976     3037    3               ELSE
      977     3038    4               DO;

      978     3039    4                   IF PATH_LIST.FIND_ATTEMPTED(START_OF_BRANCH)='0'B THEN

   3039 25 003007   200013 236100                    LDQ     START_OF_BRANCH,,AUTO
        25 003010   000005 402007                    MPY     5,DL
        25 003011   000001 236106                    LDQ     1,QL,PR0
        25 003012   100000 316003                    CANQ    32768,DU
        25 003013   003017 601000 25                 TNZ     s:3043

      979     3040    4                       N=START_OF_BRANCH;

   3040 25 003014   200013 235100                    LDA     START_OF_BRANCH,,AUTO
        25 003015   000714 755000 0                  STA     N
        25 003016   003135 710000 25                 TRA     s:3090

      980     3041    4                   ELSE
      981     3042    5                   DO;

      982     3043    5                       PATH_LIST.BRANCH_EXHAUSTED(COUNTER)='1'B;

   3043 25 003017   200017 236100                    LDQ     COUNTER,,AUTO
        25 003020   000005 402007                    MPY     5,DL
        25 003021   000000 620006                    EAX0    0,QL
        25 003022   020000 236003                    LDQ     8192,DU
        25 003023   000001 256110                    ORSQ    1,X0,PR0

      983     3044    5                       GOTO NEWBR;

   3044 25 003024   003215 710000 25                 TRA     NEWBR

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:144  
      984     3045    5                       END;
      985     3046    4                   END;
      986     3047    3           END;
      987     3048    3       ELSE DO; /* COUNTER ~= START_OF_BRANCH */

      988     3049         /*
      989     3050            If we're inside a branch and the set is exhausted (or it's an
      990     3051            owner), we want to back up one. But, if this is the pivot node
      991     3052            of a lambda structure and this is the 1st branch (i.e.,
      992     3053            START_OF_BRANCH is before the pivot point), then we don't want
      993     3054            to back up unless all other branches for this particular
      994     3055            pivot record are exhausted or we'll lose some records. So, if
      995     3056            all other branches aren't done yet, goto next branch instead.
      996     3057         */
      997     3058    3           CHK_PIVOT = '1'B;

   3058 25 003025   400000 236003                    LDQ     -131072,DU
        25 003026   200022 756100                    STQ     CHK_PIVOT,,AUTO

      998     3059    4           IF PATH_LIST.OWN_NEXT(COUNTER) = '0'B THEN DO; /* member */

   3059 25 003027   200017 236100                    LDQ     COUNTER,,AUTO
        25 003030   000005 402007                    MPY     5,DL
        25 003031   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 003032   000001 234106                    SZN     1,QL,PR0
        25 003033   003076 604000 25                 TMI     s:3071

      999     3060    4               CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,

   3060 25 003034   200011 631500                    EPPR1   TEMP_VALUE,,AUTO
        25 003035   200034 451500                    STP1    NAME+10,,AUTO
        25 003036   200017 236100                    LDQ     COUNTER,,AUTO
        25 003037   000005 402003                    MPY     5,DU
        25 003040   200003 036100                    ADLQ    @PATH_LIST,,AUTO
        25 003041   000007 235000 26                 LDA     7
        25 003042   200032 757100                    STAQ    NAME+8,,AUTO
        25 003043   200032 630500                    EPPR0   NAME+8,,AUTO
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:145  
        25 003044   000001 631400 26                 EPPR1   1
        25 003045   000000 701000 xent               TSX1    ZII$FIND_PRESENCE_IDX
        25 003046   000000 011000                    NOP     0

     1000     3061    4                  PATH_LIST.REC_NO(COUNTER),TEMP_VALUE);
     1001     3062    5               IF PRESENCE_LIST.P_VALUE(TEMP_VALUE) > 0 THEN DO;

   3062 25 003047   200011 235100                    LDA     TEMP_VALUE,,AUTO
        25 003050   000001 735000                    ALS     1
        25 003051   000001 720005 0                  LXL0    PRESENCE_LIST,AL
        25 003052   003076 600000 25                 TZE     s:3071

     1002     3063    5                   CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,

   3063 25 003053   200011 630500                    EPPR0   TEMP_VALUE,,AUTO
        25 003054   200034 450500                    STP0    NAME+10,,AUTO
        25 003055   200017 236100                    LDQ     COUNTER,,AUTO
        25 003056   000005 402003                    MPY     5,DU
        25 003057   000005 036003                    ADLQ    5,DU
        25 003060   200003 036100                    ADLQ    @PATH_LIST,,AUTO
        25 003061   000007 235000 26                 LDA     7
        25 003062   200032 757100                    STAQ    NAME+8,,AUTO
        25 003063   200032 630500                    EPPR0   NAME+8,,AUTO
        25 003064   000001 631400 26                 EPPR1   1
        25 003065   000000 701000 xent               TSX1    ZII$FIND_PRESENCE_IDX
        25 003066   000000 011000                    NOP     0

     1003     3064    5                      PATH_LIST.REC_NO(COUNTER+1),TEMP_VALUE);
     1004     3065    6                   IF PRESENCE_LIST.P_VALUE(TEMP_VALUE) > 0 THEN DO;

   3065 25 003067   200011 235100                    LDA     TEMP_VALUE,,AUTO
        25 003070   000001 735000                    ALS     1
        25 003071   000001 720005 0                  LXL0    PRESENCE_LIST,AL
        25 003072   003076 600000 25                 TZE     s:3071

     1005     3066    6                       N = COUNTER;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:146  
   3066 25 003073   200017 236100                    LDQ     COUNTER,,AUTO
        25 003074   000714 756000 0                  STQ     N

     1006     3067    6                       CHK_PIVOT = '0'B;

   3067 25 003075   200022 450100                    STZ     CHK_PIVOT,,AUTO

     1007     3068    6                       END;

     1008     3069    5                   END;

     1009     3070    4               END;

     1010     3071    4           IF CHK_PIVOT THEN DO;
              3071                    /* It's an owner (or a member & may want to back up) */

   3071 25 003076   200022 234100                    SZN     CHK_PIVOT,,AUTO
        25 003077   003135 605000 25                 TPL     s:3090

     1011     3072    4               IF NEXT_BRANCH = 1 AND BRANCH_COUNT > 1 AND

   3072 25 003100   200012 235100                    LDA     NEXT_BRANCH,,AUTO
        25 003101   000001 115007                    CMPA    1,DL
        25 003102   003134 601000 25                 TNZ     s:3079
        25 003103   000712 236000 0                  LDQ     BRANCH_COUNT
        25 003104   000002 116007                    CMPQ    2,DL
        25 003105   003134 602000 25                 TNC     s:3079
        25 003106   200017 236100                    LDQ     COUNTER,,AUTO
        25 003107   000000 116000 2                  CMPQ    PIVOT_REC_IDX
        25 003110   003134 601000 25                 TNZ     s:3079

     1012     3073    4                  COUNTER = PIVOT_REC_IDX THEN
     1013     3074    5               DO I = COUNTER TO PATH_LIST.REC_NO(0)-1;

   3074 25 003111   000710 756000 0                  STQ     I
        25 003112   003126 710000 25                 TRA     s:3078+3

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:147  
     1014     3075    5                   IF PATH_LIST.SET_NO(I) = 0 AND

   3075 25 003113   000710 236000 0                  LDQ     I
        25 003114   000005 402007                    MPY     5,DL
        25 003115   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 003116   000000 720106                    LXL0    0,QL,PR0
        25 003117   003123 601000 25                 TNZ     s:3078
        25 003120   000006 236106                    LDQ     6,QL,PR0
        25 003121   020000 316003                    CANQ    8192,DU
        25 003122   003215 600000 25                 TZE     NEWBR

     1015     3076    5                      NOT PATH_LIST.BRANCH_EXHAUSTED(I+1) THEN
     1016     3077    5                       GOTO NEWBR;
     1017     3078    5                   END;

   3078 25 003123   000710 235000 0                  LDA     I
        25 003124   000001 035007                    ADLA    1,DL
        25 003125   000710 755000 0                  STA     I
        25 003126   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 003127   000000 236100                    LDQ     0,,PR0
        25 003130   000022 772000                    QRL     18
        25 003131   000710 116000 0                  CMPQ    I
        25 003132   003134 600000 25                 TZE     s:3079
        25 003133   003113 603000 25                 TRC     s:3075

     1018     3079    4               GOTO BACKUP;

   3079 25 003134   002763 710000 25                 TRA     BACKUP

     1019     3080    4               END;
     1020     3081    3           END;
     1021     3082        /*
     1022     3083           If we're ready to go around the lambda loop again and we might be
     1023     3084           doing a find next on a new pivot record for the lambda structure,
     1024     3085           want to set all the find_attempted and branch_exhausted flags off
     1025     3086           for all 2nd and higher branches. (Since the 1st branch always
     1026     3087           starts with the port rec, it will always be cleared when the new
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:148  
     1027     3088           port is found. Prior to that, it's not exhausted yet.)
     1028     3089        */
     1029     3090    2       IF NEXT_BRANCH=1 AND BRANCH_COUNT>1 AND N < PIVOT_REC_IDX THEN

   3090 25 003135   200012 235100                    LDA     NEXT_BRANCH,,AUTO
        25 003136   000001 115007                    CMPA    1,DL
        25 003137   003213 601000 25                 TNZ     s:3103
        25 003140   000712 236000 0                  LDQ     BRANCH_COUNT
        25 003141   000002 116007                    CMPQ    2,DL
        25 003142   003213 602000 25                 TNC     s:3103
        25 003143   000714 236000 0                  LDQ     N
        25 003144   000000 116000 2                  CMPQ    PIVOT_REC_IDX
        25 003145   003213 603000 25                 TRC     s:3103

     1030     3091    3       DO;

     1031     3092    3           I=1;

   3092 25 003146   000001 235007                    LDA     1,DL
        25 003147   000710 755000 0                  STA     I

     1032     3093    4           DO WHILE (PATH_LIST.SET_NO(I)~=0);

   3093 25 003150   000710 236000 0                  LDQ     I
        25 003151   000005 402007                    MPY     5,DL
        25 003152   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 003153   000000 720106                    LXL0    0,QL,PR0
        25 003154   003165 600000 25                 TZE     s:3096

     1033     3094    4               I=I+1;

   3094 25 003155   000710 235000 0                  LDA     I
        25 003156   000001 035007                    ADLA    1,DL
        25 003157   000710 755000 0                  STA     I

     1034     3095    4               END;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:149  
   3095 25 003160   000710 236000 0                  LDQ     I
        25 003161   000005 402007                    MPY     5,DL
        25 003162   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 003163   000000 720106                    LXL0    0,QL,PR0
        25 003164   003155 601000 25                 TNZ     s:3094

     1035     3096    3           I=I+1;

   3096 25 003165   000710 235000 0                  LDA     I
        25 003166   000001 035007                    ADLA    1,DL
        25 003167   000710 755000 0                  STA     I

     1036     3097    4           DO WHILE (I<=PATH_LIST.REC_NO(0));

   3097 25 003170   000000 236100                    LDQ     0,,PR0
        25 003171   000022 772000                    QRL     18
        25 003172   000710 116000 0                  CMPQ    I
        25 003173   003213 602000 25                 TNC     s:3103

     1037     3098    4               PATH_LIST.FIND_ATTEMPTED(I)='0'B;

   3098 25 003174   000710 236000 0                  LDQ     I
        25 003175   000005 402007                    MPY     5,DL
        25 003176   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 003177   000000 620006                    EAX0    0,QL
        25 003200   000013 236000 26                 LDQ     11
        25 003201   000001 356110                    ANSQ    1,X0,PR0

     1038     3099    4               PATH_LIST.BRANCH_EXHAUSTED(I) = '0'B;

   3099 25 003202   000010 236000 26                 LDQ     8
        25 003203   000001 356110                    ANSQ    1,X0,PR0

     1039     3100    4               I=I+1;

   3100 25 003204   000710 235000 0                  LDA     I
        25 003205   000001 035007                    ADLA    1,DL
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:150  
        25 003206   000710 755000 0                  STA     I

     1040     3101    4               END;

   3101 25 003207   000000 236100                    LDQ     0,,PR0
        25 003210   000022 772000                    QRL     18
        25 003211   000710 116000 0                  CMPQ    I
        25 003212   003174 603000 25                 TRC     s:3098

     1041     3102    3           END;

     1042     3103    2       RETURN;

   3103 25 003213   200016 221300                    LDX1  ! SHARE_IND+1,,AUTO
        25 003214   000001 702211                    TSX2  ! 1,X1

     1043     3104    2   NEWBR: IF NEXT_BRANCH=BRANCH_COUNT THEN

   3104 25 003215   200012 236100       NEWBR        LDQ     NEXT_BRANCH,,AUTO
        25 003216   000712 116000 0                  CMPQ    BRANCH_COUNT
        25 003217   003223 601000 25                 TNZ     s:3107

     1044     3105    2           NEXT_BRANCH=1;

   3105 25 003220   000001 235007                    LDA     1,DL
        25 003221   200012 755100                    STA     NEXT_BRANCH,,AUTO
        25 003222   003225 710000 25                 TRA     s:3108

     1045     3106    2       ELSE
     1046     3107    2           NEXT_BRANCH=NEXT_BRANCH+1;

   3107 25 003223   000001 036007                    ADLQ    1,DL
        25 003224   200012 756100                    STQ     NEXT_BRANCH,,AUTO

     1047     3108    2       CALL EVALBR;

   3108 25 003225   003233 701000 25                 TSX1    EVALBR
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:151  
        25 003226   000000 011000                    NOP     0

     1048     3109    2       IF ALL_BRANCHES_DONE=0 THEN

   3109 25 003227   000713 235000 0                  LDA     ALL_BRANCHES_DONE
        25 003230   002672 600000 25                 TZE     BGIN

     1049     3110    2           GOTO BGIN;
     1050     3111    2       ELSE
     1051     3112    2           RETURN;

   3112 25 003231   200016 221300                    LDX1  ! SHARE_IND+1,,AUTO
        25 003232   000001 702211                    TSX2  ! 1,X1

     1052     3113        /* This section tests all branches to determine whether a new
     1053     3114           port occurrence is to be found.                               */
     1054     3115    2   EVALBR: PROC;

   3115 25 003233   200024 741300       EVALBR       STX1  ! NAME+2,,AUTO

     1055     3116    3       COUNTER=1;

   3116 25 003234   000001 235007                    LDA     1,DL
        25 003235   200017 755100                    STA     COUNTER,,AUTO

     1056     3117    3       COUNTER_OF_BRANCHES=1;

   3117 25 003236   200021 755100                    STA     COUNTER_OF_BRANCHES,,AUTO

     1057     3118    3       EXHAUSTED_BRANCHES=0;

   3118 25 003237   200020 450100                    STZ     EXHAUSTED_BRANCHES,,AUTO

     1058     3119    4       DO WHILE (COUNTER_OF_BRANCHES<=BRANCH_COUNT);

   3119 25 003240   000712 236000 0                  LDQ     BRANCH_COUNT
        25 003241   200021 116100                    CMPQ    COUNTER_OF_BRANCHES,,AUTO
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:152  
        25 003242   003306 602000 25                 TNC     s:3129

     1059     3120    4           IF PATH_LIST.BRANCH_EXHAUSTED(COUNTER)='1'B THEN

   3120 25 003243   200017 236100                    LDQ     COUNTER,,AUTO
        25 003244   000005 402007                    MPY     5,DL
        25 003245   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 003246   000001 236106                    LDQ     1,QL,PR0
        25 003247   020000 316003                    CANQ    8192,DU
        25 003250   003254 600000 25                 TZE     s:3122

     1060     3121    4               EXHAUSTED_BRANCHES=EXHAUSTED_BRANCHES+1;

   3121 25 003251   200020 235100                    LDA     EXHAUSTED_BRANCHES,,AUTO
        25 003252   000001 035007                    ADLA    1,DL
        25 003253   200020 755100                    STA     EXHAUSTED_BRANCHES,,AUTO

     1061     3122    5           DO WHILE(PATH_LIST.SET_NO(COUNTER)~=0);

   3122 25 003254   200017 236100                    LDQ     COUNTER,,AUTO
        25 003255   000005 402007                    MPY     5,DL
        25 003256   000000 720106                    LXL0    0,QL,PR0
        25 003257   003270 600000 25                 TZE     s:3125

     1062     3123    5               COUNTER=COUNTER+1;

   3123 25 003260   200017 235100                    LDA     COUNTER,,AUTO
        25 003261   000001 035007                    ADLA    1,DL
        25 003262   200017 755100                    STA     COUNTER,,AUTO

     1063     3124    5               END;

   3124 25 003263   200017 236100                    LDQ     COUNTER,,AUTO
        25 003264   000005 402007                    MPY     5,DL
        25 003265   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 003266   000000 720106                    LXL0    0,QL,PR0
        25 003267   003260 601000 25                 TNZ     s:3123
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:153  

     1064     3125    4           IF COUNTER<PATH_LIST.REC_NO(0) THEN

   3125 25 003270   000000 236100                    LDQ     0,,PR0
        25 003271   000022 772000                    QRL     18
        25 003272   200017 116100                    CMPQ    COUNTER,,AUTO
        25 003273   003300 602000 25                 TNC     s:3127
        25 003274   003300 600000 25                 TZE     s:3127

     1065     3126    4               COUNTER=COUNTER+1;

   3126 25 003275   200017 235100                    LDA     COUNTER,,AUTO
        25 003276   000001 035007                    ADLA    1,DL
        25 003277   200017 755100                    STA     COUNTER,,AUTO

     1066     3127    4           COUNTER_OF_BRANCHES=COUNTER_OF_BRANCHES+1;

   3127 25 003300   200021 235100                    LDA     COUNTER_OF_BRANCHES,,AUTO
        25 003301   000001 035007                    ADLA    1,DL
        25 003302   200021 755100                    STA     COUNTER_OF_BRANCHES,,AUTO

     1067     3128    4           END;

   3128 25 003303   000712 236000 0                  LDQ     BRANCH_COUNT
        25 003304   200021 116100                    CMPQ    COUNTER_OF_BRANCHES,,AUTO
        25 003305   003243 603000 25                 TRC     s:3120

     1068     3129    3       IF EXHAUSTED_BRANCHES=BRANCH_COUNT THEN

   3129 25 003306   200020 116100                    CMPQ    EXHAUSTED_BRANCHES,,AUTO
        25 003307   003312 601000 25                 TNZ     s:3131

     1069     3130    3           ALL_BRANCHES_DONE=1;

   3130 25 003310   000001 235007                    LDA     1,DL
        25 003311   000713 755000 0                  STA     ALL_BRANCHES_DONE

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:154  
     1070     3131    3       RETURN;

   3131 25 003312   200024 221300                    LDX1  ! NAME+2,,AUTO
        25 003313   000001 702211                    TSX2  ! 1,X1

     1071     3132    3   END EVALBR;
     1072     3133    2   END EVAL_PRESENCE;
     1073     3134         %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:155  
     1074     3135    1   SET_PRESENCE_LIST: PROC;

   3135 25 003314   200016 741300       SET_PRESENC* STX1  ! SHARE_IND+1,,AUTO

     1075     3136    2   DCL I UBIN AUTO;
     1076     3137    2   DCL J UBIN AUTO;
     1077     3138    2   DCL K UBIN AUTO;
     1078     3139    2   DCL MEMBER_OF_LIST UBIN AUTO;
     1079     3140        /**/
     1080     3141    2       I=1;

   3141 25 003315   000001 235007                    LDA     1,DL
        25 003316   200017 755100                    STA     I,,AUTO

     1081     3142    2       J=1;

   3142 25 003317   200020 755100                    STA     J,,AUTO

     1082     3143    3       DO WHILE (J<=PATH_LIST.REC_NO(0));

   3143 25 003320   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 003321   000000 236100                    LDQ     0,,PR0
        25 003322   000022 772000                    QRL     18
        25 003323   200020 116100                    CMPQ    J,,AUTO
        25 003324   003411 602000 25                 TNC     s:3164

     1083     3144    3           K=1;

   3144 25 003325   000001 235007                    LDA     1,DL
        25 003326   200021 755100                    STA     K,,AUTO

     1084     3145    3           MEMBER_OF_LIST=0;

   3145 25 003327   200022 450100                    STZ     MEMBER_OF_LIST,,AUTO

     1085     3146    4           DO WHILE (K<J);

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:156  
   3146 25 003330   200021 236100                    LDQ     K,,AUTO
        25 003331   200020 116100                    CMPQ    J,,AUTO
        25 003332   003355 603000 25                 TRC     s:3154

     1086     3147    4               IF PATH_LIST.REC_NO(K)=PATH_LIST.REC_NO(J) THEN

   3147 25 003333   200021 236100                    LDQ     K,,AUTO
        25 003334   000005 402007                    MPY     5,DL
        25 003335   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 003336   000000 220106                    LDX0    0,QL,PR0
        25 003337   200020 236100                    LDQ     J,,AUTO
        25 003340   000005 402007                    MPY     5,DL
        25 003341   000000 100106                    CMPX0   0,QL,PR0
        25 003342   003347 601000 25                 TNZ     s:3152

     1087     3148    5               DO;

     1088     3149    5                   MEMBER_OF_LIST=1;

   3149 25 003343   000001 235007                    LDA     1,DL
        25 003344   200022 755100                    STA     MEMBER_OF_LIST,,AUTO

     1089     3150    5                   K=J;

   3150 25 003345   200020 235100                    LDA     J,,AUTO
        25 003346   200021 755100                    STA     K,,AUTO

     1090     3151    5                   END;

     1091     3152    4               K=K+1;

   3152 25 003347   200021 235100                    LDA     K,,AUTO
        25 003350   000001 035007                    ADLA    1,DL
        25 003351   200021 755100                    STA     K,,AUTO

     1092     3153    4               END;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:157  
   3153 25 003352   200021 236100                    LDQ     K,,AUTO
        25 003353   200020 116100                    CMPQ    J,,AUTO
        25 003354   003333 602000 25                 TNC     s:3147

     1093     3154    3           IF MEMBER_OF_LIST=0 THEN

   3154 25 003355   200022 235100                    LDA     MEMBER_OF_LIST,,AUTO
        25 003356   003401 601000 25                 TNZ     s:3162

     1094     3155    4           DO;

     1095     3156    4               PRESENCE_LIST.REC_NO(I)=PATH_LIST.REC_NO(J);

   3156 25 003357   200017 235100                    LDA     I,,AUTO
        25 003360   000001 735000                    ALS     1
        25 003361   200020 236100                    LDQ     J,,AUTO
        25 003362   000000 620005                    EAX0    0,AL
        25 003363   000005 402007                    MPY     5,DL
        25 003364   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 003365   000000 221106                    LDX1    0,QL,PR0
        25 003366   000001 741010 0                  STX1    PRESENCE_LIST,X0

     1096     3157    4               PRESENCE_LIST.P_VALUE(I)=0;

   3157 25 003367   200017 235100                    LDA     I,,AUTO
        25 003370   000001 735000                    ALS     1
        25 003371   000000 220003                    LDX0    0,DU
        25 003372   000001 440005 0                  SXL0    PRESENCE_LIST,AL

     1097     3158    4               PRESENCE_LIST.DB_KEY_SAVE(I)=0;

   3158 25 003373   000002 450005 0                  STZ     PRESENCE_LIST+1,AL

     1098     3159    4               PRESENCE_LIST.REC_NO(0)=I;

   3159 25 003374   200017 721100                    LXL1    I,,AUTO
        25 003375   000001 741000 0                  STX1    PRESENCE_LIST
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:158  

     1099     3160    4               I=I+1;

   3160 25 003376   200017 235100                    LDA     I,,AUTO
        25 003377   000001 035007                    ADLA    1,DL
        25 003400   200017 755100                    STA     I,,AUTO

     1100     3161    4               END;

     1101     3162    3           J=J+1;

   3162 25 003401   200020 235100                    LDA     J,,AUTO
        25 003402   000001 035007                    ADLA    1,DL
        25 003403   200020 755100                    STA     J,,AUTO

     1102     3163    3           END;

   3163 25 003404   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 003405   000000 236100                    LDQ     0,,PR0
        25 003406   000022 772000                    QRL     18
        25 003407   200020 116100                    CMPQ    J,,AUTO
        25 003410   003325 603000 25                 TRC     s:3144

     1103     3164    2       RETURN;

   3164 25 003411   200016 221300                    LDX1  ! SHARE_IND+1,,AUTO
        25 003412   000001 702211                    TSX2  ! 1,X1

     1104     3165    2   END SET_PRESENCE_LIST;
     1105     3166        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:159  
     1106     3167    1   RESTORE_CURRENCY: PROC ALTRET;

   3167 25 003413   200016 741300       RESTORE_CUR* STX1  ! SHARE_IND+1,,AUTO

     1107     3168    2   DCL I UBIN AUTO;
     1108     3169    2   DCL J UBIN AUTO;
     1109     3170        /**/
     1110     3171    3       IF ACCESS_LIST.PORT_TYPE = %KEYED_ACCESS THEN DO;

   3171 25 003414   200004 470500                    LDP0    @ACCESS_LIST,,AUTO
        25 003415   000001 220100                    LDX0    1,,PR0
        25 003416   000003 100003                    CMPX0   3,DU
        25 003417   003552 601000 25                 TNZ     s:3201

     1111     3172    3           J = 2;

   3172 25 003420   000002 235007                    LDA     2,DL
        25 003421   200020 755100                    STA     J,,AUTO

     1112     3173    3           CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,PATH_LIST.REC_NO(1),TEMP_VALUE);

   3173 25 003422   200011 631500                    EPPR1   TEMP_VALUE,,AUTO
        25 003423   200034 451500                    STP1    NAME+10,,AUTO
        25 003424   200003 236100                    LDQ     @PATH_LIST,,AUTO
        25 003425   000005 036003                    ADLQ    5,DU
        25 003426   000007 235000 26                 LDA     7
        25 003427   200032 757100                    STAQ    NAME+8,,AUTO
        25 003430   200032 630500                    EPPR0   NAME+8,,AUTO
        25 003431   000001 631400 26                 EPPR1   1
        25 003432   000000 701000 xent               TSX1    ZII$FIND_PRESENCE_IDX
        25 003433   000000 011000                    NOP     0

     1113     3174    4           IF PRESENCE_LIST.P_VALUE(TEMP_VALUE) > 0 THEN DO;

   3174 25 003434   200011 235100                    LDA     TEMP_VALUE,,AUTO
        25 003435   000001 735000                    ALS     1
        25 003436   000001 720005 0                  LXL0    PRESENCE_LIST,AL
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:160  
        25 003437   003554 600000 25                 TZE     s:3202

     1114     3175    4               ZII$PARAMS = '0'B;

   3175 25 003440   000000 100400                    MLR     fill='000'O
        25 003441   000000 000001 26                 ADSC9   0                        cn=0,n=1
        25 003442   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84

     1115     3176    4               ZII$PARAMS.R_HALF(0) = 3;

   3176 25 003443   000003 221003                    LDX1    3,DU
        25 003444   000000 441000 xsym               SXL1    ZII$PARAMS

     1116     3177    4               ZII$PARAMS.L_HALF(1) = NAM1.DESC$(ACCESS_LIST.PORT)->RECORD.RVA_OFF;

   3177 25 003445   200004 470500                    LDP0    @ACCESS_LIST,,AUTO
        25 003446   000000 236100                    LDQ     0,,PR0
        25 003447   000022 772000                    QRL     18
        25 003450   000012 402007                    MPY     10,DL
        25 003451   000000 471400 7                  LDP1    NAM1$
        25 003452   100011 473506                    LDP3    9,QL,PR1
        25 003453   300000 720100                    LXL0    0,,PR3
        25 003454   000001 740000 xsym               STX0    ZII$PARAMS+1

     1117     3178    4               ZII$PARAMS.R_HALF(2) = %USING;

   3178 25 003455   000040 222003                    LDX2    32,DU
        25 003456   000002 442000 xsym               SXL2    ZII$PARAMS+2

     1118     3179    4               ZII$PARAMS.L_HALF(3) = NAM1.DESC$(ACCESS_LIST.PORT_KEY)->KEY.RVA_OFF;

   3179 25 003457   000000 236100                    LDQ     0,,PR0
        25 003460   777777 376007                    ANQ     -1,DL
        25 003461   000012 402007                    MPY     10,DL
        25 003462   100011 473506                    LDP3    9,QL,PR1
        25 003463   300000 723100                    LXL3    0,,PR3
        25 003464   000003 743000 xsym               STX3    ZII$PARAMS+3
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:161  

     1119     3180    4               CALL ZII$FIND ALTRET(BAD_RESTORE);

   3180 25 003465   000000 631400 26                 EPPR1   0
        25 003466   000000 701000 xent               TSX1    ZII$FIND
        25 003467   003657 702000 25                 TSX2    BAD_RESTORE

     1120     3181    4               IF UWA.DB_STATUS ~= '0000000' THEN

   3181 25 003470   000000 470400 13                 LDP0    UWA$
        25 003471   040000 106500                    CMPC    fill='040'O
        25 003472   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 003473   000000 000007 24                 ADSC9   0                        cn=0,n=7
        25 003474   003477 600000 25                 TZE     s:3183

     1121     3182    4                   ALTRETURN;

   3182 25 003475   200016 221300                    LDX1  ! SHARE_IND+1,,AUTO
        25 003476   000000 702211                    TSX2  ! 0,X1

     1122     3183    4               IF PRESENCE_LIST.DB_KEY_SAVE(TEMP_VALUE) ~= UWA.DIRECT_REFERENCE

   3183 25 003477   200011 235100                    LDA     TEMP_VALUE,,AUTO
        25 003500   000001 735000                    ALS     1
        25 003501   000002 236005 0                  LDQ     PRESENCE_LIST+1,AL
        25 003502   000036 116100                    CMPQ    30,,PR0
        25 003503   003554 600000 25                 TZE     s:3202

     1123     3184    5               THEN DO;

     1124     3185    5                   TEMP_VALUE = PRESENCE_LIST.DB_KEY_SAVE(TEMP_VALUE);

   3185 25 003504   200011 756100                    STQ     TEMP_VALUE,,AUTO

     1125     3186    5                   ZII$PARAMS = '0'B;

   3186 25 003505   000000 100400                    MLR     fill='000'O
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:162  
        25 003506   000000 000001 26                 ADSC9   0                        cn=0,n=1
        25 003507   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84

     1126     3187    5                   ZII$PARAMS.R_HALF(0) = 4;

   3187 25 003510   000004 220003                    LDX0    4,DU
        25 003511   000000 440000 xsym               SXL0    ZII$PARAMS

     1127     3188    5                   ZII$PARAMS.R_HALF(1) = %NEXT;

   3188 25 003512   000023 221003                    LDX1    19,DU
        25 003513   000001 441000 xsym               SXL1    ZII$PARAMS+1

     1128     3189    5                  ZII$PARAMS.L_HALF(2) = NAM1.DESC$(ACCESS_LIST.PORT)->RECORD.RVA_OFF;

   3189 25 003514   200004 471500                    LDP1    @ACCESS_LIST,,AUTO
        25 003515   100000 236100                    LDQ     0,,PR1
        25 003516   000022 772000                    QRL     18
        25 003517   000012 402007                    MPY     10,DL
        25 003520   000000 473400 7                  LDP3    NAM1$
        25 003521   300011 474506                    LDP4    9,QL,PR3
        25 003522   400000 722100                    LXL2    0,,PR4
        25 003523   000002 742000 xsym               STX2    ZII$PARAMS+2

     1129     3190    5                   ZII$PARAMS.R_HALF(3) = %USING;

   3190 25 003524   000040 223003                    LDX3    32,DU
        25 003525   000003 443000 xsym               SXL3    ZII$PARAMS+3

     1130     3191    5                  ZII$PARAMS.L_HALF(4) = NAM1.DESC$(ACCESS_LIST.PORT_KEY)->KEY.RVA_OFF
              3191                            ;

   3191 25 003526   100000 236100                    LDQ     0,,PR1
        25 003527   777777 376007                    ANQ     -1,DL
        25 003530   000012 402007                    MPY     10,DL
        25 003531   300011 474506                    LDP4    9,QL,PR3
        25 003532   400000 724100                    LXL4    0,,PR4
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:163  
        25 003533   000004 744000 xsym               STX4    ZII$PARAMS+4

     1131     3192    6                   DO UNTIL(TEMP_VALUE = UWA.DIRECT_REFERENCE);

     1132     3193    6                       CALL ZII$FIND ALTRET(BAD_RESTORE);

   3193 25 003534   000000 631400 26                 EPPR1   0
        25 003535   000000 701000 xent               TSX1    ZII$FIND
        25 003536   003657 702000 25                 TSX2    BAD_RESTORE

     1133     3194    6                       IF UWA.DB_STATUS ~= '0000000' THEN

   3194 25 003537   000000 470400 13                 LDP0    UWA$
        25 003540   040000 106500                    CMPC    fill='040'O
        25 003541   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 003542   000000 000007 24                 ADSC9   0                        cn=0,n=7
        25 003543   003546 600000 25                 TZE     s:3196

     1134     3195    6                           ALTRETURN;

   3195 25 003544   200016 221300                    LDX1  ! SHARE_IND+1,,AUTO
        25 003545   000000 702211                    TSX2  ! 0,X1

     1135     3196    6                       END;

   3196 25 003546   200011 236100                    LDQ     TEMP_VALUE,,AUTO
        25 003547   000036 116100                    CMPQ    30,,PR0
        25 003550   003534 601000 25                 TNZ     s:3193

     1136     3197    5                   END;

     1137     3198    4               END;

     1138     3199    3           END;

   3199 25 003551   003554 710000 25                 TRA     s:3202

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:164  
     1139     3200    2       ELSE
     1140     3201    2           J = 1;

   3201 25 003552   000001 235007                    LDA     1,DL
        25 003553   200020 755100                    STA     J,,AUTO

     1141     3202    2       ZII$PARAMS = '0'B;

   3202 25 003554   000000 100400                    MLR     fill='000'O
        25 003555   000000 000001 26                 ADSC9   0                        cn=0,n=1
        25 003556   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84

     1142     3203    2       ZII$PARAMS.R_HALF(0)=3;

   3203 25 003557   000003 220003                    LDX0    3,DU
        25 003560   000000 440000 xsym               SXL0    ZII$PARAMS

     1143     3204    2       ZII$PARAMS.R_HALF(2)=%DBKEY;

   3204 25 003561   000014 221003                    LDX1    12,DU
        25 003562   000002 441000 xsym               SXL1    ZII$PARAMS+2

     1144     3205    2       ZII$PARAMS.R_HALF(3)=1;

   3205 25 003563   000001 222003                    LDX2    1,DU
        25 003564   000003 442000 xsym               SXL2    ZII$PARAMS+3

     1145     3206    3       DO I=J TO PATH_LIST.REC_NO(0);

   3206 25 003565   200020 235100                    LDA     J,,AUTO
        25 003566   200017 755100                    STA     I,,AUTO
        25 003567   003650 710000 25                 TRA     s:3219+3

     1146     3207    3           IF NOT PATH_LIST.REPEAT_IND(I) THEN

   3207 25 003570   200017 236100                    LDQ     I,,AUTO
        25 003571   000005 402007                    MPY     5,DL
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:165  
        25 003572   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 003573   000001 236106                    LDQ     1,QL,PR0
        25 003574   040000 316003                    CANQ    16384,DU
        25 003575   003645 601000 25                 TNZ     s:3219

     1147     3208    4           DO;

     1148     3209    4              CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,PATH_LIST.REC_NO(I),TEMP_VALUE)
              3209                        ;

   3209 25 003576   200011 631500                    EPPR1   TEMP_VALUE,,AUTO
        25 003577   200034 451500                    STP1    NAME+10,,AUTO
        25 003600   200017 236100                    LDQ     I,,AUTO
        25 003601   000005 402003                    MPY     5,DU
        25 003602   200003 036100                    ADLQ    @PATH_LIST,,AUTO
        25 003603   000007 235000 26                 LDA     7
        25 003604   200032 757100                    STAQ    NAME+8,,AUTO
        25 003605   200032 630500                    EPPR0   NAME+8,,AUTO
        25 003606   000001 631400 26                 EPPR1   1
        25 003607   000000 701000 xent               TSX1    ZII$FIND_PRESENCE_IDX
        25 003610   000000 011000                    NOP     0

     1149     3210    4               IF PRESENCE_LIST.P_VALUE(TEMP_VALUE) > 0 THEN

   3210 25 003611   200011 235100                    LDA     TEMP_VALUE,,AUTO
        25 003612   000001 735000                    ALS     1
        25 003613   000001 720005 0                  LXL0    PRESENCE_LIST,AL
        25 003614   003645 600000 25                 TZE     s:3219

     1150     3211    5               DO;

     1151     3212    5                  ZII$PARAMS.L_HALF(1)=NAM1.DESC$(PATH_LIST.REC_NO(I))->RECORD.RVA_OFF
              3212                            ;

   3212 25 003615   200017 236100                    LDQ     I,,AUTO
        25 003616   000005 402007                    MPY     5,DL
        25 003617   200003 470500                    LDP0    @PATH_LIST,,AUTO
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:166  
        25 003620   000000 236106                    LDQ     0,QL,PR0
        25 003621   000022 772000                    QRL     18
        25 003622   000012 402007                    MPY     10,DL
        25 003623   000000 471400 7                  LDP1    NAM1$
        25 003624   100011 473506                    LDP3    9,QL,PR1
        25 003625   300000 720100                    LXL0    0,,PR3
        25 003626   000001 740000 xsym               STX0    ZII$PARAMS+1

     1152     3213    5                   ZII$INTEGER1=PRESENCE_LIST.DB_KEY_SAVE(TEMP_VALUE);

   3213 25 003627   200011 235100                    LDA     TEMP_VALUE,,AUTO
        25 003630   000001 735000                    ALS     1
        25 003631   000002 235005 0                  LDA     PRESENCE_LIST+1,AL
        25 003632   000000 755000 xsym               STA     ZII$INTEGER1

     1153     3214    5                   CALL ZII$FIND ALTRET(BAD_RESTORE);

   3214 25 003633   000000 631400 26                 EPPR1   0
        25 003634   000000 701000 xent               TSX1    ZII$FIND
        25 003635   003657 702000 25                 TSX2    BAD_RESTORE

     1154     3215    5                   IF UWA.DB_STATUS ~= '0000000' THEN

   3215 25 003636   000000 470400 13                 LDP0    UWA$
        25 003637   040000 106500                    CMPC    fill='040'O
        25 003640   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        25 003641   000000 000007 24                 ADSC9   0                        cn=0,n=7
        25 003642   003645 600000 25                 TZE     s:3219

     1155     3216    5                       ALTRETURN;

   3216 25 003643   200016 221300                    LDX1  ! SHARE_IND+1,,AUTO
        25 003644   000000 702211                    TSX2  ! 0,X1

     1156     3217    5                   END;
     1157     3218    4               END;
     1158     3219    3           END;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:167  

   3219 25 003645   200017 235100                    LDA     I,,AUTO
        25 003646   000001 035007                    ADLA    1,DL
        25 003647   200017 755100                    STA     I,,AUTO
        25 003650   200003 470500                    LDP0    @PATH_LIST,,AUTO
        25 003651   000000 236100                    LDQ     0,,PR0
        25 003652   000022 772000                    QRL     18
        25 003653   200017 116100                    CMPQ    I,,AUTO
        25 003654   003570 603000 25                 TRC     s:3207

     1159     3220    2       RETURN;

   3220 25 003655   200016 221300                    LDX1  ! SHARE_IND+1,,AUTO
        25 003656   000001 702211                    TSX2  ! 1,X1

     1160     3221    2   BAD_RESTORE:
     1161     3222    2       ALTRETURN;

   3222 25 003657   200016 221300       BAD_RESTORE  LDX1  ! SHARE_IND+1,,AUTO
        25 003660   000000 702211                    TSX2  ! 0,X1

     1162     3223    2   END RESTORE_CURRENCY;
     1163     3224        %EJECT;
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:168  
     1164     3225    1   ARE_WE_SHARING: PROC ALTRET;

   3225 25 003661   200016 741300       ARE_WE_SHAR* STX1  ! SHARE_IND+1,,AUTO

     1165     3226        /*
     1166     3227          This routine checks to see if this database is being used
     1167     3228          in concurrent access mode.
     1168     3229
     1169     3230          Sample calling sequence:
     1170     3231            WE_ARE_SHARING = '1'B;
     1171     3232            CALL ARE_WE_SHARING ALTRET(YES_WE_ARE);
     1172     3233            WE_ARE_SHARING = '0'B;
     1173     3234          YES_WE_ARE: ;
     1174     3235        */
     1175     3236        %INCLUDE B$ROSEG;
     1176     3299    2   DCL B$ROS$ PTR SYMREF;
     1177     3300        %F$DCB(BASED="BASED(DCB$)");
     1178     3357    2   DCL DCB$ PTR;
     1179     3358    2   DCL I UBIN;
     1180     3359    2   DCL NUMDCBS UBIN;
     1181     3360    2   DCL NAME CHAR(32);
     1182     3361        /**/
     1183     3362    2       NUMDCBS = B$ROS$ -> B$ROSEG.NUMDCBS;

   3362 25 003662   000000 470400 xsym               LDP0    B$ROS$
        25 003663   000002 236100                    LDQ     2,,PR0
        25 003664   000022 772000                    QRL     18
        25 003665   200021 756100                    STQ     NUMDCBS,,AUTO

     1184     3363    3       DO WHILE (DCBADDR(NUMDCBS) = ADDR(NIL));

   3363 25 003666   003672 710000 25                 TRA     s:3365

     1185     3364    3           NUMDCBS = NUMDCBS - 1;

   3364 25 003667   200021 235100                    LDA     NUMDCBS,,AUTO
        25 003670   000001 135007                    SBLA    1,DL
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:169  
        25 003671   200021 755100                    STA     NUMDCBS,,AUTO

     1186     3365    3           END;

   3365 25 003672   000014 470400 26                 LDP0    12
        25 003673   000000 471500                    LDP1    0,,PR0
        25 003674   200021 720100                    LXL0    NUMDCBS,,AUTO
        25 003675   100000 236110                    LDQ     0,X0,PR1
        25 003676   000015 116000 26                 CMPQ    13
        25 003677   003667 600000 25                 TZE     s:3364

     1187     3366
     1188     3367    2       DA$ = NAM1.DESC$(0);

   3367 25 003700   000000 473400 7                  LDP3    NAM1$
        25 003701   300011 236100                    LDQ     9,,PR3
        25 003702   000000 756000 16                 STQ     DA$

     1189     3368    3       DO WHILE (DA$ ~= ADDR(NIL));

   3368 25 003703   003772 710000 25                 TRA     s:3383

     1190     3369    3           NAME = NAM1.NAME.TEXT(AREA.NAM_IDX);

   3369 25 003704   000000 470400 16                 LDP0    DA$
        25 003705   000000 236100                    LDQ     0,,PR0
        25 003706   000022 772000                    QRL     18
        25 003707   000012 402007                    MPY     10,DL
        25 003710   000002 736000                    QLS     2
        25 003711   000000 471400 7                  LDP1    NAM1$
        25 003712   040100 100506                    MLR     fill='040'O
        25 003713   100001 000040                    ADSC9   1,Q,PR1                  cn=0,n=32
        25 003714   200022 000040                    ADSC9   NAME,,AUTO               cn=0,n=32

     1191     3370    4           DO I=1 TO NUMDCBS;

   3370 25 003715   000001 235007                    LDA     1,DL
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:170  
        25 003716   200020 755100                    STA     I,,AUTO
        25 003717   003764 710000 25                 TRA     s:3380+3

     1192     3371    4               DCB$ = DCBADDR(I);

   3371 25 003720   000014 470400 26                 LDP0    12
        25 003721   000000 471500                    LDP1    0,,PR0
        25 003722   200020 720100                    LXL0    I,,AUTO
        25 003723   100000 236110                    LDQ     0,X0,PR1
        25 003724   200017 756100                    STQ     DCB$,,AUTO

     1193     3372    4               IF DCB$ ~= ADDR(NIL) THEN

   3372 25 003725   000015 116000 26                 CMPQ    13
        25 003726   003761 600000 25                 TZE     s:3380

     1194     3373    4                   IF NAME = F$DCB.DCBNAME.N THEN

   3373 25 003727   200017 473500                    LDP3    DCB$,,AUTO
        25 003730   300140 236100                    LDQ     96,,PR3
        25 003731   000033 772000                    QRL     27
        25 003732   000037 376007                    ANQ     31,DL
        25 003733   000000 621006                    EAX1    0,QL
        25 003734   040140 106500                    CMPC    fill='040'O
        25 003735   200022 000040                    ADSC9   NAME,,AUTO               cn=0,n=32
        25 003736   300140 200011                    ADSC9   96,,PR3                  cn=1,n=*X1
        25 003737   003761 601000 25                 TNZ     s:3380

     1195     3374    4                       IF SHARE_TYPE=%SHAREALL OR SHARE_TYPE=%SHARECUR OR

   3374 25 003740   200010 474500                    LDP4    @SHARE_TYPE,,AUTO
        25 003741   400000 222100                    LDX2    0,,PR4
        25 003742   000034 102003                    CMPX2   28,DU
        25 003743   003757 600000 25                 TZE     s:3377
        25 003744   000060 102003                    CMPX2   48,DU
        25 003745   003757 600000 25                 TZE     s:3377
        25 003746   000000 102003                    CMPX2   0,DU
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:171  
        25 003747   003767 601000 25                 TNZ     NEXT_AREA
        25 003750   300031 236100                    LDQ     25,,PR3
        25 003751   000600 376007                    ANQ     384,DL
        25 003752   000200 116007                    CMPQ    128,DL
        25 003753   003767 601000 25                 TNZ     NEXT_AREA
        25 003754   300031 236100                    LDQ     25,,PR3
        25 003755   000400 316003                    CANQ    256,DU
        25 003756   003767 601000 25                 TNZ     NEXT_AREA

     1196     3375    4                          (SHARE_TYPE=0 AND F$DCB.SHARE#=%ALL# AND
     1197     3376    4                          NOT F$DCB.UOPT#(0)) THEN
     1198     3377    4                           ALTRETURN;

   3377 25 003757   200016 221300                    LDX1  ! SHARE_IND+1,,AUTO
        25 003760   000000 702211                    TSX2  ! 0,X1

     1199     3378    4                       ELSE
     1200     3379    4                           GOTO NEXT_AREA;
     1201     3380    4               END;

   3380 25 003761   200020 235100                    LDA     I,,AUTO
        25 003762   000001 035007                    ADLA    1,DL
        25 003763   200020 755100                    STA     I,,AUTO
        25 003764   200021 236100                    LDQ     NUMDCBS,,AUTO
        25 003765   200020 116100                    CMPQ    I,,AUTO
        25 003766   003720 603000 25                 TRC     s:3371

     1202     3381    3   NEXT_AREA:
     1203     3382    3           DA$ = AREA.LAREA$;

   3382 25 003767   000000 470400 16    NEXT_AREA    LDP0    DA$
        25 003770   000005 236100                    LDQ     5,,PR0
        25 003771   000000 756000 16                 STQ     DA$

     1204     3383    3           END;

   3383 25 003772   000015 116000 26                 CMPQ    13
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:172  
        25 003773   003704 601000 25                 TNZ     s:3369

     1205     3384    2       RETURN;

   3384 25 003774   200016 221300                    LDX1  ! SHARE_IND+1,,AUTO
        25 003775   000001 702211                    TSX2  ! 1,X1

PRESENCE_LIST
 Sect OctLoc
   0     001   ****** ******   ****** ******   ****** ******   ****** ******    ................

BRANCH_FAILED
 Sect OctLoc
   0     623   ****** ******   ****** ******   ****** ******   ****** ******    ................

ZI_RETRIEVING
 Sect OctLoc
   5     000   0***** ******                                                    ....

IA_
 Sect OctLoc
  21     000   000000 177640   000000 006014                                    ........

UWA_
 Sect OctLoc
  22     000   000000 177640   000000 006014                                    ........

RVA_
 Sect OctLoc
  23     000   000000 177640   000000 006014                                    ........

(unnamed)
 Sect OctLoc
  24     000   060060 060060   060060 060040   060065 060062   061060 060040    0000000 0502100
  24     004   060065 060062   064060 061040   060065 060062   064060 060040    0502401 0502400
  24     010   061063 067060   060067 071040   061063 067060   060070 060040    1370079 1370080

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:173  
(unnamed)
 Sect OctLoc
  26     000   000000 000000   000003 000000   000000 006000   000000 006000    ................
  26     004   000000 006000   000001 777776   000001 000000   000001 006000    ................
  26     010   757777 777777   000005 000000   000714 006000   677777 777777    ................
  26     014   000000 006003   000000 006014                                    ........
     1206     3385    2   END ARE_WE_SHARING;
     1207     3386    1   END ZII$RETRIEVE;
     1208     3387        %EOD;

PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:174  
--  Include file information  --

   B$ROSEG.:LIB_E05  cannot be made into a system file and is referenced.
   ZI_IDPERR_SUBS.:ZIC0TOU  is referenced.
   ZI$PATH_STRUCTS.:ZIC0TOU  is referenced.
   ZI$DESC.:ZIC0TOU  is referenced.
   ZI$STRUCTS.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZII$RETRIEVE.

   Procedure ZII$RETRIEVE requires 2046 words for executable code.
   Procedure ZII$RETRIEVE requires 32 words of local(AUTO) storage.
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:175  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:176  
          MINI XREF LISTING

ACCESS_LIST
      2135**DCL       134--PROC     2444<>CALL     2816<>CALL
ACCESS_LIST.DIRECT
      2147**DCL      2149--REDEF    2156--REDEF    2421>>ASSIGN   2724>>ASSIGN
ACCESS_LIST.KEYED.CHECK
      2164**DCL      2295<<ASSIGN   2518>>IF       2521>>ASSIGN   2872>>IF       2874>>ASSIGN
ACCESS_LIST.KEYED.MOVE
      2159**DCL      2294<<ASSIGN   2424>>IF       2436>>IF       2438>>ASSIGN   2469>>ASSIGN   2748>>ASSIGN
      2796>>IF       2797>>ASSIGN   2814>>IF
ACCESS_LIST.PORT
      2136**DCL      2433>>ASSIGN   2446>>ASSIGN   2459>>ASSIGN   2466>>ASSIGN   2733>>ASSIGN   2755>>ASSIGN
      2767>>ASSIGN   2777>>ASSIGN   2806>>ASSIGN   2819>>ASSIGN   2832>>ASSIGN   3177>>ASSIGN   3189>>ASSIGN
ACCESS_LIST.PORT_IDX
      2142**DCL      2284<<ASSIGN   2410>>IF       2421>>ASSIGN   2422<<ASSIGN   2422>>ASSIGN   2424>>IF
      2426>>IF       2436>>IF       2438>>ASSIGN   2467>>IF       2469>>ASSIGN   2518>>IF       2521>>ASSIGN
      2717>>IF       2724>>ASSIGN   2725<<ASSIGN   2725>>ASSIGN   2742>>IF       2748>>ASSIGN   2781<<ASSIGN
      2781>>ASSIGN   2794>>IF       2796>>IF       2797>>ASSIGN   2801<<ASSIGN   2801>>ASSIGN   2811<<ASSIGN
      2811>>ASSIGN   2812>>IF       2814>>IF       2872>>IF       2874>>ASSIGN
ACCESS_LIST.PORT_KEY
      2138**DCL      2435>>ASSIGN   2448>>ASSIGN   2461>>ASSIGN   2735>>ASSIGN   2808>>ASSIGN   2821>>ASSIGN
      2834>>ASSIGN   3179>>ASSIGN   3191>>ASSIGN
ACCESS_LIST.PORT_NUM
      2144**DCL      2290>>IF       2293<<ASSIGN   2467>>IF       2717>>IF       2742>>IF       2794>>IF
      2812>>IF
ACCESS_LIST.PORT_TYPE
      2140**DCL      2290>>IF       2399>>DOCASE   2481>>IF       2493>>IF       2518>>IF       2695>>DOCASE
      2872>>IF       3171>>IF
ALL_BRANCHES_DONE
       163**DCL      2281<<ASSIGN   2369<<ASSIGN   2551<<ASSIGN   2557>>DOWHILE  2575>>IF       2869<<ASSIGN
      3109>>IF       3130<<ASSIGN
AREA.LAREA$
      1803**DCL      3382>>ASSIGN
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:177  
AREA.NAM_IDX
      1789**DCL      3369>>ASSIGN
AREA.RVA_OFF
      1790**DCL      2340>>ASSIGN   2408>>ASSIGN   2714>>ASSIGN
AREA_LIST
      2174**DCL       134--PROC
AREA_LIST.AREA_IDX
      2175**DCL      2316>>IF       2339>>DOWHILE  2340>>ASSIGN
ARE_WE_SHARING
      3225**PROC     2354--CALL
B$ROS$ IN PROCEDURE ARE_WE_SHARING
      3299**DCL      3362>>ASSIGN
B$ROSEG.NUMDCBS IN PROCEDURE ARE_WE_SHARING
      3249**DCL      3362>>ASSIGN
BACKUP IN PROCEDURE EVAL_PRESENCE
      3026**LABEL    3079--GOTO
BAD_BUFFERS
      2980**LABEL    2314--CALLALT
BAD_FIND
      2936**LABEL    2439--CALLALT  2449--CALLALT  2455--GOTO     2470--CALLALT  2471--CALLALT  2480--CALLALT
      2488--GOTO     2500--GOTO     2591--CALLALT  2706--CALLALT  2708--GOTO     2715--CALLALT  2726--CALLALT
      2736--CALLALT  2740--GOTO     2756--CALLALT  2768--CALLALT  2770--GOTO     2778--CALLALT  2822--CALLALT
      2828--GOTO     2836--CALLALT  2842--GOTO     2856--GOTO
BAD_FINISH
      2969**LABEL    2925--CALLALT  2932--CALLALT  2939--CALLALT  2947--CALLALT  2961--CALLALT  2975--CALLALT
BAD_GET
      2944**LABEL    2512--CALLALT  2514--GOTO     2866--CALLALT
BAD_HIA
      2966**LABEL    2304--CALLALT
BAD_READY
      2952**LABEL    2306--GOTO     2325--CALLALT  2327--GOTO     2341--CALLALT  2343--GOTO
BAD_RECURSION
      2973**LABEL    2562--CALLALT
BAD_RESTORE IN PROCEDURE RESTORE_CURRENCY
      3222**LABEL    3180--CALLALT  3193--CALLALT  3214--CALLALT
BGIN IN PROCEDURE EVAL_PRESENCE
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:178  
      2996**LABEL    3110--GOTO
BRANCH_COUNT
       161**DCL      2366<<ASSIGN   2380<<ASSIGN   2380>>ASSIGN   2554>>DOINDEX  2559>>DOWHILE  2570>>IF
      2576>>ASSIGN   2604>>DOWHILE  3072>>IF       3090>>IF       3104>>IF       3119>>DOWHILE  3129>>IF
BRANCH_FAILED
       151**DCL      2555<<ASSIGN   2565<<ASSIGN   2569<<ASSIGN   2605>>IF
CHK_PIVOT IN PROCEDURE EVAL_PRESENCE
      2992**DCL      3058<<ASSIGN   3067<<ASSIGN   3071>>IF
COMEBACK
      2564**LABEL    2561--REMEMBR
CONSTRAINT_FAILED
       152**DCL      2282<<ASSIGN   2564>>IF       2566<<ASSIGN
COUNTER IN PROCEDURE EVAL_PRESENCE
      2989**DCL      3000<<ASSIGN   3005<<ASSIGN   3005>>ASSIGN   3006>>IF       3019<<ASSIGN   3020>>DOWHILE
      3021<<ASSIGN   3021>>ASSIGN   3026<<ASSIGN   3026>>ASSIGN   3027>>IF       3029>>IF       3032>>IF
      3034>>ASSIGN   3043>>ASSIGN   3059>>IF       3060>>CALL     3063>>CALL     3066>>ASSIGN   3072>>IF
      3074>>DOINDEX  3116<<ASSIGN   3120>>IF       3122>>DOWHILE  3123<<ASSIGN   3123>>ASSIGN   3125>>IF
      3126<<ASSIGN   3126>>ASSIGN
COUNTER_OF_BRANCHES IN PROCEDURE EVAL_PRESENCE
      2991**DCL      3117<<ASSIGN   3119>>DOWHILE  3127<<ASSIGN   3127>>ASSIGN
CURRENT_BRANCH
       169**DCL      2558<<ASSIGN   2559>>DOWHILE  2560<<ASSIGN   2565>>ASSIGN   2569>>ASSIGN   2570>>IF
      2573>>ASSIGN   2575>>IF       2576<<ASSIGN   2577<<ASSIGN   2577>>ASSIGN   2899<<ASSIGN
DA$
      1787**DCL      1788--IMP-PTR  2407<<ASSIGN   2408>>ASSIGN   2714>>ASSIGN   3367<<ASSIGN   3368>>DOWHILE
      3369>>ASSIGN   3382<<ASSIGN   3382>>ASSIGN
DB_STATUS_SAVE
       158**DCL      2936<<ASSIGN   2941>>ASSIGN   2944<<ASSIGN   2949>>ASSIGN   2959<<ASSIGN   2963>>ASSIGN
      2973<<ASSIGN   2977>>ASSIGN
DCB$ IN PROCEDURE ARE_WE_SHARING
      3357**DCL      3301--IMP-PTR  3371<<ASSIGN   3372>>IF       3373>>IF       3373>>IF       3374>>IF
      3374>>IF
DESC#
       906**DCL       911--IMP-SIZ
DK$
      1885**DCL      1886--IMP-PTR
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:179  
DONT_PRINT
      2634**LABEL    2634--CALLALT
DR$
      1851**DCL      1852--IMP-PTR  2403<<ASSIGN   2404>>ASSIGN   2405<<ASSIGN   2406>>ASSIGN   2417<<ASSIGN
      2418>>ASSIGN   2510<<ASSIGN   2511>>ASSIGN   2700<<ASSIGN   2701>>ASSIGN   2713>>ASSIGN   2720<<ASSIGN
      2721>>ASSIGN   2864<<ASSIGN   2865>>ASSIGN
DRA$
      1895**DCL      1896--IMP-PTR  2406<<ASSIGN   2407>>ASSIGN
DS$
      1809**DCL      1810--IMP-PTR
ERR_STATUS
      2930**LABEL    2444--CALLALT  2477--GOTO     2588--CALLALT  2593--GOTO     2631--CALLALT  2790--GOTO
      2816--CALLALT  2923--CALLALT
EVALBR IN PROCEDURE EVAL_PRESENCE
      3115**PROC     3035--CALL     3108--CALL
EVAL_PRESENCE
      2988**PROC     2574--CALL
EXHAUSTED_BRANCHES IN PROCEDURE EVAL_PRESENCE
      2990**DCL      3118<<ASSIGN   3121<<ASSIGN   3121>>ASSIGN   3129>>IF
F$DCB.ACTPOS IN PROCEDURE ARE_WE_SHARING
      3333**DCL      3333--REDEF
F$DCB.ARS# IN PROCEDURE ARE_WE_SHARING
      3307**DCL      3307--REDEF
F$DCB.ATTR IN PROCEDURE ARE_WE_SHARING
      3326**DCL      3327--REDEF
F$DCB.BORROW IN PROCEDURE ARE_WE_SHARING
      3341**DCL      3341--REDEF    3341--REDEF    3341--REDEF
F$DCB.DCBNAME.L IN PROCEDURE ARE_WE_SHARING
      3355**DCL      3355--IMP-SIZ  3373>>IF
F$DCB.DCBNAME.N IN PROCEDURE ARE_WE_SHARING
      3355**DCL      3373>>IF
F$DCB.EOMCHAR# IN PROCEDURE ARE_WE_SHARING
      3311**DCL      3311--REDEF
F$DCB.FLDID IN PROCEDURE ARE_WE_SHARING
      3336**DCL      3336--REDEF
F$DCB.FORM$ IN PROCEDURE ARE_WE_SHARING
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:180  
      3330**DCL      3330--REDEF
F$DCB.FSECT IN PROCEDURE ARE_WE_SHARING
      3346**DCL      3346--REDEF
F$DCB.FSN# IN PROCEDURE ARE_WE_SHARING
      3323**DCL      3323--REDEF    3323--REDEF    3324--REDEF
F$DCB.HEADER$ IN PROCEDURE ARE_WE_SHARING
      3329**DCL      3329--REDEF
F$DCB.IXTNSIZE# IN PROCEDURE ARE_WE_SHARING
      3327**DCL      3327--REDEF
F$DCB.LASTSTA$ IN PROCEDURE ARE_WE_SHARING
      3316**DCL      3316--REDEF
F$DCB.LVL IN PROCEDURE ARE_WE_SHARING
      3342**DCL      3342--REDEF
F$DCB.NAME#.C IN PROCEDURE ARE_WE_SHARING
      3317**DCL      3317--REDEF
F$DCB.NOEOF IN PROCEDURE ARE_WE_SHARING
      3339**DCL      3339--REDEF
F$DCB.NRECS# IN PROCEDURE ARE_WE_SHARING
      3328**DCL      3328--REDEF
F$DCB.NRECX IN PROCEDURE ARE_WE_SHARING
      3347**DCL      3347--REDEF
F$DCB.OHDR IN PROCEDURE ARE_WE_SHARING
      3339**DCL      3339--REDEF
F$DCB.ORG# IN PROCEDURE ARE_WE_SHARING
      3322**DCL      3322--REDEF
F$DCB.PRECNO IN PROCEDURE ARE_WE_SHARING
      3345**DCL      3345--REDEF
F$DCB.RCSZ IN PROCEDURE ARE_WE_SHARING
      3351**DCL      3351--REDEF
F$DCB.RES# IN PROCEDURE ARE_WE_SHARING
      3318**DCL      3318--REDEF
F$DCB.SETX IN PROCEDURE ARE_WE_SHARING
      3330**DCL      3330--REDEF
F$DCB.SHARE# IN PROCEDURE ARE_WE_SHARING
      3321**DCL      3374>>IF
F$DCB.TAB$ IN PROCEDURE ARE_WE_SHARING
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:181  
      3330**DCL      3330--REDEF
F$DCB.TDA IN PROCEDURE ARE_WE_SHARING
      3344**DCL      3345--REDEF
F$DCB.UOPT# IN PROCEDURE ARE_WE_SHARING
      3320**DCL      3374>>IF
F$DCB.WSN# IN PROCEDURE ARE_WE_SHARING
      3318**DCL      3318--REDEF
FIND_DUPE
      2756**LABEL    2749--CALLALT
FINLBL
      2917**LABEL    2451--GOTO     2474--GOTO     2496--GOTO     2675--CALLALT  2729--GOTO     2787--GOTO
      2795--GOTO     2813--GOTO     2848--GOTO     2885--GOTO
FOUND IN PROCEDURE EVAL_PRESENCE
      3017**LABEL    3009--GOTO
GEN_CODE_EPTR
       136**DCL      2438<<ASSIGN   2439>>CALL     2469<<ASSIGN   2470>>CALL     2516<<ASSIGN   2517>>CALL
      2521<<ASSIGN   2522>>CALL     2524<<ASSIGN   2525>>IF       2526>>CALL     2629<<ASSIGN   2630>>IF
      2631>>CALL     2632<<ASSIGN   2633>>IF       2634>>CALL     2748<<ASSIGN   2749>>CALL     2797<<ASSIGN
      2798>>CALL     2846<<ASSIGN   2847>>CALL     2870<<ASSIGN   2871>>CALL     2874<<ASSIGN   2875>>CALL
      2877<<ASSIGN   2878>>IF       2879>>CALL     2883<<ASSIGN   2884>>CALL
I
       159**DCL      2338<<ASSIGN   2339>>DOWHILE  2340>>ASSIGN   2344<<ASSIGN   2344>>ASSIGN   2372<<ASSIGN
      2373>>DOWHILE  2375>>DOWHILE  2376>>IF       2381>>ASSIGN   2385<<ASSIGN   2385>>ASSIGN   2538<<DOINDEX
      2539>>IF       2539>>IF       2540>>ASSIGN   2554<<DOINDEX  2555>>ASSIGN   2603<<ASSIGN   2604>>DOWHILE
      2605>>IF       2607<<ASSIGN   2607>>ASSIGN   2619<<ASSIGN   2620>>DOWHILE  2621>>CALL     2624>>ASSIGN
      2628>>DOWHILE  2629>>ASSIGN   2632>>ASSIGN   2639<<ASSIGN   2639>>ASSIGN   2640>>IF       2641>>CALL
      2647<<ASSIGN   2647>>ASSIGN   2659<<DOINDEX  2660>>IF       2661>>CALL     2680<<DOINDEX  2681>>IF
      2682>>ASSIGN   2888<<DOINDEX  2889>>ASSIGN   2895<<DOINDEX  2896>>ASSIGN   2905<<DOINDEX  2906>>IF
      2906>>IF       2907>>ASSIGN   3074<<DOINDEX  3075>>IF       3075>>IF       3092<<ASSIGN   3093>>DOWHILE
      3094<<ASSIGN   3094>>ASSIGN   3096<<ASSIGN   3096>>ASSIGN   3097>>DOWHILE  3098>>ASSIGN   3099>>ASSIGN
      3100<<ASSIGN   3100>>ASSIGN
I IN PROCEDURE ARE_WE_SHARING
      3358**DCL      3370<<DOINDEX  3371--ASSIGN
I IN PROCEDURE RESTORE_CURRENCY
      3168**DCL      3206<<DOINDEX  3207>>IF       3209>>CALL     3212>>ASSIGN
I IN PROCEDURE SET_PRESENCE_LIST
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:182  
      3136**DCL      3141<<ASSIGN   3156>>ASSIGN   3157>>ASSIGN   3158>>ASSIGN   3159>>ASSIGN   3160<<ASSIGN
      3160>>ASSIGN
IA_
      2226**DCL      2304<>CALL
IA_.W2
      2227**DCL      2228--REDEF
J
       160**DCL      2374<<ASSIGN   2375>>DOWHILE  2376>>IF       2379>>ASSIGN   2381<<ASSIGN   2383<<ASSIGN
      2383>>ASSIGN   2624<<ASSIGN   2625>>DOWHILE  2626<<ASSIGN   2626>>ASSIGN   2628>>DOWHILE  2640>>IF
J IN PROCEDURE RESTORE_CURRENCY
      3169**DCL      3172<<ASSIGN   3201<<ASSIGN   3206>>DOINDEX
J IN PROCEDURE SET_PRESENCE_LIST
      3137**DCL      3142<<ASSIGN   3143>>DOWHILE  3146>>DOWHILE  3147>>IF       3150>>ASSIGN   3156>>ASSIGN
      3162<<ASSIGN   3162>>ASSIGN
K IN PROCEDURE SET_PRESENCE_LIST
      3138**DCL      3144<<ASSIGN   3146>>DOWHILE  3147>>IF       3150<<ASSIGN   3152<<ASSIGN   3152>>ASSIGN
KEY.RVA_OFF
      1888**DCL      2435>>ASSIGN   2448>>ASSIGN   2461>>ASSIGN   2735>>ASSIGN   2808>>ASSIGN   2821>>ASSIGN
      2834>>ASSIGN   3179>>ASSIGN   3191>>ASSIGN
MEMBER_OF_LIST IN PROCEDURE SET_PRESENCE_LIST
      3139**DCL      3145<<ASSIGN   3149<<ASSIGN   3154>>IF
N
       164**DCL      2283<<ASSIGN   2365<<ASSIGN   2562<>CALL     2898<<ASSIGN   3034<<ASSIGN   3040<<ASSIGN
      3066<<ASSIGN   3090>>IF
NAM1.DESC$
       897**DCL      2340>>ASSIGN   2403>>ASSIGN   2405>>ASSIGN   2407>>ASSIGN   2417>>ASSIGN   2433>>ASSIGN
      2435>>ASSIGN   2446>>ASSIGN   2448>>ASSIGN   2459>>ASSIGN   2461>>ASSIGN   2466>>ASSIGN   2510>>ASSIGN
      2700>>ASSIGN   2720>>ASSIGN   2733>>ASSIGN   2735>>ASSIGN   2755>>ASSIGN   2767>>ASSIGN   2777>>ASSIGN
      2806>>ASSIGN   2808>>ASSIGN   2819>>ASSIGN   2821>>ASSIGN   2832>>ASSIGN   2834>>ASSIGN   2864>>ASSIGN
      3177>>ASSIGN   3179>>ASSIGN   3189>>ASSIGN   3191>>ASSIGN   3212>>ASSIGN   3367>>ASSIGN
NAM1.NAME.TEXT
       896**DCL      3369>>ASSIGN
NAM1$
       879**DCL       882--IMP-PTR  2340>>ASSIGN   2403>>ASSIGN   2405>>ASSIGN   2407>>ASSIGN   2417>>ASSIGN
      2433>>ASSIGN   2435>>ASSIGN   2446>>ASSIGN   2448>>ASSIGN   2459>>ASSIGN   2461>>ASSIGN   2466>>ASSIGN
      2510>>ASSIGN   2700>>ASSIGN   2720>>ASSIGN   2733>>ASSIGN   2735>>ASSIGN   2755>>ASSIGN   2767>>ASSIGN
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:183  
      2777>>ASSIGN   2806>>ASSIGN   2808>>ASSIGN   2819>>ASSIGN   2821>>ASSIGN   2832>>ASSIGN   2834>>ASSIGN
      2864>>ASSIGN   3177>>ASSIGN   3179>>ASSIGN   3189>>ASSIGN   3191>>ASSIGN   3212>>ASSIGN   3367>>ASSIGN
      3369>>ASSIGN
NAM2.DESC
       910**DCL       911--REDEF
NAM2$
       904**DCL       907--IMP-PTR
NAME IN PROCEDURE ARE_WE_SHARING
      3360**DCL      3369<<ASSIGN   3373>>IF
NEWBR IN PROCEDURE EVAL_PRESENCE
      3104**LABEL    3025--GOTO     3030--GOTO     3044--GOTO     3077--GOTO
NEXT_AREA IN PROCEDURE ARE_WE_SHARING
      3382**LABEL    3379--GOTO
NEXT_BRANCH
       167**DCL      2553<<ASSIGN   2558>>ASSIGN   2560>>ASSIGN   2571<<ASSIGN   2573<<ASSIGN   2575>>IF
      2996>>IF       3006>>IF       3072>>IF       3090>>IF       3104>>IF       3105<<ASSIGN   3107<<ASSIGN
      3107>>ASSIGN
NUMDCBS IN PROCEDURE ARE_WE_SHARING
      3359**DCL      3362<<ASSIGN   3363--DOWHILE  3364<<ASSIGN   3364>>ASSIGN   3370>>DOINDEX
NXTPORT
      2694**LABEL    2494--GOTO     2498--GOTO     2526--CALLALT  2686--GOTO     2782--GOTO     2851--GOTO
      2879--CALLALT
NXTPORT_IDX
      2779**LABEL    2484--GOTO     2522--CALLALT  2738--GOTO     2802--GOTO     2815--GOTO     2824--GOTO
      2838--GOTO     2875--CALLALT
NXTPORT_INCIDX
      2798**LABEL    2798--CALLALT
OUTLBL
      2580**LABEL    2531--GOTO     2892--GOTO
PATH_LIST
      2095**DCL       134--PROC     2562<>CALL
PATH_LIST.BRANCH_EXHAUSTED
      2111**DCL      2505<<ASSIGN   2896<<ASSIGN   3017>>IF       3029>>IF       3043<<ASSIGN   3075>>IF
      3099<<ASSIGN   3120>>IF
PATH_LIST.CONSTRAINT_EPTR
      2131**DCL      2524>>ASSIGN   2632>>ASSIGN   2877>>ASSIGN
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:184  
PATH_LIST.CONVERT_EPTR
      2128**DCL      2516>>ASSIGN   2870>>ASSIGN
PATH_LIST.DISPLAY_IND
      2115**DCL      2660>>IF
PATH_LIST.FIND_ATTEMPTED
      2102**DCL      2529<<ASSIGN   2889<<ASSIGN   3039>>IF       3098<<ASSIGN
PATH_LIST.FIND_FIRST
      2117**DCL      2540<<ASSIGN   2907<<ASSIGN
PATH_LIST.GET_IND
      2100**DCL      2506>>IF       2860>>IF
PATH_LIST.INIT_EPTR
      2126**DCL      2629>>ASSIGN   2846>>ASSIGN   2883>>ASSIGN
PATH_LIST.OWN_NEXT
      2098**DCL      2539>>IF       2906>>IF       3032>>IF       3059>>IF
PATH_LIST.REC_NO
      2096**DCL      2368>>IF       2373>>DOWHILE  2376>>IF       2376>>IF       2403>>ASSIGN   2405>>ASSIGN
      2417>>ASSIGN   2502<>CALL     2510>>ASSIGN   2530>>IF       2538>>DOINDEX  2620>>DOWHILE  2621<>CALL
      2641<>CALL     2659>>DOINDEX  2661<>CALL     2685>>IF       2697>>IF       2700>>ASSIGN   2704<>CALL
      2720>>ASSIGN   2857<>CALL     2864>>ASSIGN   2888>>DOINDEX  2891>>IF       2895>>DOINDEX  2905>>DOINDEX
      3002>>DOWHILE  3060<>CALL     3063<>CALL     3074>>DOINDEX  3097>>DOWHILE  3125>>IF       3143>>DOWHILE
      3147>>IF       3147>>IF       3156>>ASSIGN   3173<>CALL     3206>>DOINDEX  3209<>CALL     3212>>ASSIGN
PATH_LIST.REPEAT_IND
      2106**DCL      3207>>IF
PATH_LIST.SET_NO
      2097**DCL      2539>>IF       2625>>DOWHILE  2906>>IF       3003>>IF       3020>>DOWHILE  3075>>IF
      3093>>DOWHILE  3122>>DOWHILE
PIVOT_REC_IDX
       162**DCL      2367<<ASSIGN   2378>>IF       2379<<ASSIGN   3072>>IF       3090>>IF
PRESENCE_LIST
       147**DCL      2502<>CALL     2562<>CALL     2621<>CALL     2641<>CALL     2661<>CALL     2704<>CALL
      2857<>CALL     3060<>CALL     3063<>CALL     3173<>CALL     3209<>CALL
PRESENCE_LIST.DB_KEY_SAVE
       150**DCL      2504<<ASSIGN   2705>>ASSIGN   2859<<ASSIGN   3158<<ASSIGN   3183>>IF       3185>>ASSIGN
      3213>>ASSIGN
PRESENCE_LIST.P_VALUE
       149**DCL      2503<<ASSIGN   2622>>IF       2643<<ASSIGN   2663>>DOCASE   2681>>IF       2682<<ASSIGN
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:185  
      2858<<ASSIGN   3062>>IF       3065>>IF       3157<<ASSIGN   3174>>IF       3210>>IF
PRESENCE_LIST.REC_NO
       148**DCL      2680>>DOINDEX  3156<<ASSIGN   3159<<ASSIGN
PRINT_CHECK
      2659**LABEL    2669--EXIT
RA_DSC.AREA_IDX
      1898**DCL      2407>>ASSIGN
RECORD.FLAG_BITS
      1856**DCL      1857--REDEF
RECORD.RA_DSC$
      1877**DCL      2406>>ASSIGN
RECORD.RVA_OFF
      1854**DCL      2404>>ASSIGN   2418>>ASSIGN   2433>>ASSIGN   2446>>ASSIGN   2459>>ASSIGN   2466>>ASSIGN
      2511>>ASSIGN   2701>>ASSIGN   2713>>ASSIGN   2721>>ASSIGN   2733>>ASSIGN   2755>>ASSIGN   2767>>ASSIGN
      2777>>ASSIGN   2806>>ASSIGN   2819>>ASSIGN   2832>>ASSIGN   2865>>ASSIGN   3177>>ASSIGN   3189>>ASSIGN
      3212>>ASSIGN
RECUR
      2551**LABEL    2909--GOTO
RESTORE_CURRENCY
      3167**PROC     2591--CALL
RETRIEVE_EXIT
       135**DCL       134--PROC     2675>>CALL
RETRIEVE_RETURN
       165**DCL      2561<<REMEMBR
RVA_
      2256**DCL      2304<>CALL
RVA_.W2
      2257**DCL      2258--REDEF
SET.FLAG_BITS
      1815**DCL      1816--REDEF
SET_PRESENCE_LIST
      3135**PROC     2285--CALL
SHARE_IND
       171**DCL      2353<<ASSIGN   2355<<ASSIGN   2580>>IF
SHARE_TYPE
       138**DCL       134--PROC     2318>>IF       2322>>ASSIGN   2331>>IF       2335>>ASSIGN   3374>>IF
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:186  
      3374>>IF       3374>>IF
START_OF_BRANCH
       168**DCL      2552<<ASSIGN   2562<>CALL     2997<<ASSIGN   3001<<ASSIGN   3002>>DOWHILE  3003>>IF
      3008<<ASSIGN   3008>>ASSIGN   3012<<ASSIGN   3012>>ASSIGN   3017>>IF       3019>>ASSIGN   3027>>IF
      3039>>IF       3040>>ASSIGN
STATUS_CODE
       137**DCL       134--PROC     2280<<ASSIGN   2412<<ASSIGN   2428<<ASSIGN   2562<>CALL     2592>>IF
      2927<<ASSIGN   2930<<ASSIGN   2937<<ASSIGN   2945<<ASSIGN   2953<<ASSIGN   2956<<ASSIGN   2958<<ASSIGN
      2966<<ASSIGN   2969<<ASSIGN   2980<<ASSIGN
TEMP_VALUE
       166**DCL      2502<>CALL     2503>>ASSIGN   2504>>ASSIGN   2621<>CALL     2622>>IF       2641<>CALL
      2643>>ASSIGN   2661<>CALL     2663>>DOCASE   2704<>CALL     2705>>ASSIGN   2857<>CALL     2858>>ASSIGN
      2859>>ASSIGN   3060<>CALL     3062>>IF       3063<>CALL     3065>>IF       3173<>CALL     3174>>IF
      3183>>IF       3185<<ASSIGN   3185>>ASSIGN   3192>>DOUNTIL  3209<>CALL     3210>>IF       3213>>ASSIGN
UWA.DB_STATUS
       919**DCL      2305>>IF       2326>>IF       2342>>IF       2450>>IF       2452>>IF       2452>>IF
      2483>>IF       2485>>IF       2485>>IF       2492>>IF       2497>>IF       2499>>IF       2513>>IF
      2707>>IF       2737>>IF       2739>>IF       2769>>IF       2779>>IF       2823>>IF       2825>>IF
      2825>>IF       2837>>IF       2839>>IF       2839>>IF       2844>>IF       2850>>IF       2853>>IF
      2853>>IF       2867>>IF       2936>>ASSIGN   2941<<ASSIGN   2944>>ASSIGN   2949<<ASSIGN   2952>>IF
      2955>>IF       2959>>ASSIGN   2963<<ASSIGN   2973>>ASSIGN   2977<<ASSIGN   3181>>IF       3194>>IF
      3215>>IF
UWA.DIRECT_REFERENCE
       928**DCL      2504>>ASSIGN   2859>>ASSIGN   3183>>IF       3192>>DOUNTIL
UWA#
       916**DCL       934--IMP-SIZ
UWA$
       914**DCL       917--IMP-PTR  2305>>IF       2326>>IF       2342>>IF       2450>>IF       2452>>IF
      2452>>IF       2483>>IF       2485>>IF       2485>>IF       2492>>IF       2497>>IF       2499>>IF
      2504>>ASSIGN   2513>>IF       2707>>IF       2737>>IF       2739>>IF       2769>>IF       2779>>IF
      2823>>IF       2825>>IF       2825>>IF       2837>>IF       2839>>IF       2839>>IF       2844>>IF
      2850>>IF       2853>>IF       2853>>IF       2859>>ASSIGN   2867>>IF       2936>>ASSIGN   2941>>ASSIGN
      2944>>ASSIGN   2949>>ASSIGN   2952>>IF       2955>>IF       2959>>ASSIGN   2963>>ASSIGN   2973>>ASSIGN
      2977>>ASSIGN   3181>>IF       3183>>IF       3192>>DOUNTIL  3194>>IF       3215>>IF
UWA_
      2241**DCL      2304<>CALL
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:187  
UWA_.W2
      2242**DCL      2243--REDEF
YES_WE_ARE
      2365**LABEL    2354--CALLALT
ZII$BUFFERS
      2269**DCL-ENT  2314--CALL
ZII$CHECK
      2265**DCL-ENT  2588--CALL     2923--CALL
ZII$CLR_PARAMS
      2266**DCL-ENT  2456--CALL
ZII$FIND
      2264**DCL-ENT  2449--CALL     2471--CALL     2480--CALL     2706--CALL     2715--CALL     2726--CALL
      2736--CALL     2756--CALL     2768--CALL     2778--CALL     2822--CALL     2836--CALL     3180--CALL
      3193--CALL     3214--CALL
ZII$FIND_FIRST
      2271**DCL-ENT  2444--CALL     2816--CALL
ZII$FIND_PRESENCE_IDX
      2270**DCL-ENT  2502--CALL     2621--CALL     2641--CALL     2661--CALL     2704--CALL     2857--CALL
      3060--CALL     3063--CALL     3173--CALL     3209--CALL
ZII$FINISH
      2263**DCL-ENT  2925--CALL     2932--CALL     2939--CALL     2947--CALL     2961--CALL     2975--CALL
ZII$GET
      2268**DCL-ENT  2512--CALL     2866--CALL
ZII$INTEGER1
       156**DCL      2312<<ASSIGN   2421<<ASSIGN   2586<<ASSIGN   2705<<ASSIGN   2724<<ASSIGN   2921<<ASSIGN
      3213<<ASSIGN
ZII$INTEGER2
       157**DCL      2313<<ASSIGN   2587<<ASSIGN   2922<<ASSIGN
ZII$INVOKE
      2261**DCL-ENT  2304--CALL
ZII$PARAMS
       153**DCL      2303<<ASSIGN   2308<<ASSIGN   2315<<ASSIGN   2398<<ASSIGN   2508<<ASSIGN   2582<<ASSIGN
      2694<<ASSIGN   2709<<ASSIGN   2774<<ASSIGN   2804<<ASSIGN   2817<<ASSIGN   2829<<ASSIGN   2862<<ASSIGN
      2917<<ASSIGN   3175<<ASSIGN   3186<<ASSIGN   3202<<ASSIGN
ZII$PARAMS.L_HALF
       154**DCL      2340<<ASSIGN   2404<<ASSIGN   2408<<ASSIGN   2418<<ASSIGN   2433<<ASSIGN   2435<<ASSIGN
PL6.E3A0      #001=ZII$RETRIEVE File=ZII$RET_LIB.:ZIC0TSI                        FRI 09/05/97 12:30 Page:188  
      2446<<ASSIGN   2448<<ASSIGN   2459<<ASSIGN   2461<<ASSIGN   2466<<ASSIGN   2511<<ASSIGN   2701<<ASSIGN
      2713<<ASSIGN   2714<<ASSIGN   2721<<ASSIGN   2733<<ASSIGN   2735<<ASSIGN   2755<<ASSIGN   2767<<ASSIGN
      2777<<ASSIGN   2806<<ASSIGN   2808<<ASSIGN   2819<<ASSIGN   2821<<ASSIGN   2832<<ASSIGN   2834<<ASSIGN
      2865<<ASSIGN   3177<<ASSIGN   3179<<ASSIGN   3189<<ASSIGN   3191<<ASSIGN   3212<<ASSIGN
ZII$PARAMS.R_HALF
       155**DCL      2309<<ASSIGN   2310<<ASSIGN   2311<<ASSIGN   2319<<ASSIGN   2321<<ASSIGN   2322<<ASSIGN
      2324<<ASSIGN   2332<<ASSIGN   2334<<ASSIGN   2335<<ASSIGN   2337<<ASSIGN   2401<<ASSIGN   2402<<ASSIGN
      2416<<ASSIGN   2419<<ASSIGN   2420<<ASSIGN   2432<<ASSIGN   2434<<ASSIGN   2445<<ASSIGN   2447<<ASSIGN
      2457<<ASSIGN   2458<<ASSIGN   2460<<ASSIGN   2464<<ASSIGN   2465<<ASSIGN   2509<<ASSIGN   2583<<ASSIGN
      2584<<ASSIGN   2585<<ASSIGN   2699<<ASSIGN   2702<<ASSIGN   2703<<ASSIGN   2711<<ASSIGN   2712<<ASSIGN
      2719<<ASSIGN   2722<<ASSIGN   2723<<ASSIGN   2731<<ASSIGN   2732<<ASSIGN   2734<<ASSIGN   2753<<ASSIGN
      2754<<ASSIGN   2765<<ASSIGN   2766<<ASSIGN   2775<<ASSIGN   2776<<ASSIGN   2805<<ASSIGN   2807<<ASSIGN
      2818<<ASSIGN   2820<<ASSIGN   2830<<ASSIGN   2831<<ASSIGN   2833<<ASSIGN   2863<<ASSIGN   2918<<ASSIGN
      2919<<ASSIGN   2920<<ASSIGN   2924<<ASSIGN   2931<<ASSIGN   2938<<ASSIGN   2946<<ASSIGN   2960<<ASSIGN
      2974<<ASSIGN   3176<<ASSIGN   3178<<ASSIGN   3187<<ASSIGN   3188<<ASSIGN   3190<<ASSIGN   3203<<ASSIGN
      3204<<ASSIGN   3205<<ASSIGN
ZII$READY
      2262**DCL-ENT  2325--CALL     2341--CALL
ZII$RECURSE
      2267**DCL-ENT  2562--CALL
ZI_PRINT_FLAG
       170**DCL      2598<<ASSIGN   2604>>DOWHILE  2606<<ASSIGN   2617>>IF       2637<<ASSIGN   2657>>IF
      2665<<ASSIGN   2668<<ASSIGN   2674>>IF
ZI_RETRIEVING
       172**DCL      2307<<ASSIGN   2413<<ASSIGN   2429<<ASSIGN   2926<<ASSIGN   2933<<ASSIGN   2940<<ASSIGN
      2948<<ASSIGN   2962<<ASSIGN   2970<<ASSIGN   2976<<ASSIGN   2981<<ASSIGN

PL6.E3A0      #002=ZII$FIND_PRESENCE_IDX File=ZII$RET_LIB.:ZIC0TSI               FRI 09/05/97 12:31 Page:189  
     1209        1        /*T***********************************************************/
     1210        2        /*T*                                                         */
     1211        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1212        4        /*T*                                                         */
     1213        5        /*T***********************************************************/
     1214        6        ZII$FIND_PRESENCE_IDX: PROC (PRESENCE_LIST,IN_VAL,OUT_IDX);
     1215        7    1   DCL IN_VAL UBIN(18);
     1216        8    1   DCL OUT_IDX UBIN;
     1217        9    1   DCL 1 PRESENCE_LIST (0:0) ALIGNED,
     1218       10    1         2 REC_NO UBIN(18) UNAL,
     1219       11    1         2 P_VALUE UBIN(18) UNAL,
     1220       12    1         2 DB_KEY_SAVE UBIN(36) UNAL;
     1221       13    1   DCL I UBIN AUTO;
     1222       14        /**/
     1223       15        %INCLUDE ZI$TOP_STRUCTS;
     1224       76        /**/
     1225       77    1       I=1;
     1226       78    2       DO WHILE(I <= PRESENCE_LIST.REC_NO(0));
     1227       79    2           IF PRESENCE_LIST.REC_NO(I) = IN_VAL THEN
     1228       80    3           DO;
     1229       81    3               OUT_IDX=I;
     1230       82    3               RETURN;
     1231       83    3               END;
     1232       84    2           I=I+1;
     1233       85    2           END;
     1234       86    1       RETURN;
     1235       87    1   END ZII$FIND_PRESENCE_IDX;
     1236       88        %EOD;

PL6.E3A0      #002=ZII$FIND_PRESENCE_IDX File=ZII$RET_LIB.:ZIC0TSI               FRI 09/05/97 12:31 Page:190  
--  Include file information  --

   ZI$TOP_STRUCTS.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure ZII$FIND_PRESENCE_IDX.

   Procedure ZII$FIND_PRESENCE_IDX requires 28 words for executable code.
   Procedure ZII$FIND_PRESENCE_IDX requires 8 words of local(AUTO) storage.

PL6.E3A0      #002=ZII$FIND_PRESENCE_IDX File=ZII$RET_LIB.:ZIC0TSI               FRI 09/05/97 12:31 Page:191  

 Object Unit name= ZII$FIND_PRESENCE_IDX                      File name= ZII$RET_LIB.:ZIC0TOU
 UTS= SEP 05 '97 12:31:31.36 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    28     34  ZII$FIND_PRESENCE_IDX

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        3  ZII$FIND_PRESENCE_IDX

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_3
                       nStd      0 X66_ARET
PL6.E3A0      #002=ZII$FIND_PRESENCE_IDX File=ZII$RET_LIB.:ZIC0TSI               FRI 09/05/97 12:31 Page:192  


     1209        1        /*T***********************************************************/
     1210        2        /*T*                                                         */
     1211        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1212        4        /*T*                                                         */
     1213        5        /*T***********************************************************/
     1214        6        ZII$FIND_PRESENCE_IDX: PROC (PRESENCE_LIST,IN_VAL,OUT_IDX);

      6  0 000000   000000 700200 xent  ZII$FIND_PR* TSX0  ! X66_AUTO_3
         0 000001   000010 000003                    ZERO    8,3

     1215        7    1   DCL IN_VAL UBIN(18);
     1216        8    1   DCL OUT_IDX UBIN;
     1217        9    1   DCL 1 PRESENCE_LIST (0:0) ALIGNED,
     1218       10    1         2 REC_NO UBIN(18) UNAL,
     1219       11    1         2 P_VALUE UBIN(18) UNAL,
     1220       12    1         2 DB_KEY_SAVE UBIN(36) UNAL;
     1221       13    1   DCL I UBIN AUTO;
     1222       14        /**/
     1223       15        %INCLUDE ZI$TOP_STRUCTS;
     1224       76        /**/
     1225       77    1       I=1;

     77  0 000002   000001 235007                    LDA     1,DL
         0 000003   200006 755100                    STA     I,,AUTO

     1226       78    2       DO WHILE(I <= PRESENCE_LIST.REC_NO(0));

     78  0 000004   200003 470500                    LDP0    @PRESENCE_LIST,,AUTO
         0 000005   000000 236100                    LDQ     0,,PR0
         0 000006   000022 772000                    QRL     18
         0 000007   200006 116100                    CMPQ    I,,AUTO
         0 000010   000033 602000 0                  TNC     s:86

     1227       79    2           IF PRESENCE_LIST.REC_NO(I) = IN_VAL THEN

     79  0 000011   200006 235100                    LDA     I,,AUTO
PL6.E3A0      #002=ZII$FIND_PRESENCE_IDX File=ZII$RET_LIB.:ZIC0TSI               FRI 09/05/97 12:31 Page:193  
         0 000012   000001 735000                    ALS     1
         0 000013   200003 470500                    LDP0    @PRESENCE_LIST,,AUTO
         0 000014   000000 220105                    LDX0    0,AL,PR0
         0 000015   200004 471500                    LDP1    @IN_VAL,,AUTO
         0 000016   100000 100100                    CMPX0   0,,PR1
         0 000017   000024 601000 0                  TNZ     s:84

     1228       80    3           DO;

     1229       81    3               OUT_IDX=I;

     81  0 000020   200005 473500                    LDP3    @OUT_IDX,,AUTO
         0 000021   200006 236100                    LDQ     I,,AUTO
         0 000022   300000 756100                    STQ     0,,PR3

     1230       82    3               RETURN;

     82  0 000023   000000 702200 xent               TSX2  ! X66_ARET

     1231       83    3               END;
     1232       84    2           I=I+1;

     84  0 000024   200006 236100                    LDQ     I,,AUTO
         0 000025   000001 036007                    ADLQ    1,DL
         0 000026   200006 756100                    STQ     I,,AUTO

     1233       85    2           END;

     85  0 000027   000000 236100                    LDQ     0,,PR0
         0 000030   000022 772000                    QRL     18
         0 000031   200006 116100                    CMPQ    I,,AUTO
         0 000032   000011 603000 0                  TRC     s:79

     1234       86    1       RETURN;

     86  0 000033   000000 702200 xent               TSX2  ! X66_ARET
     1235       87    1   END ZII$FIND_PRESENCE_IDX;
PL6.E3A0      #002=ZII$FIND_PRESENCE_IDX File=ZII$RET_LIB.:ZIC0TSI               FRI 09/05/97 12:31 Page:194  
     1236       88        %EOD;

PL6.E3A0      #002=ZII$FIND_PRESENCE_IDX File=ZII$RET_LIB.:ZIC0TSI               FRI 09/05/97 12:31 Page:195  
--  Include file information  --

   ZI$TOP_STRUCTS.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure ZII$FIND_PRESENCE_IDX.

   Procedure ZII$FIND_PRESENCE_IDX requires 28 words for executable code.
   Procedure ZII$FIND_PRESENCE_IDX requires 8 words of local(AUTO) storage.
PL6.E3A0      #002=ZII$FIND_PRESENCE_IDX File=ZII$RET_LIB.:ZIC0TSI               FRI 09/05/97 12:31 Page:196  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=ZII$FIND_PRESENCE_IDX File=ZII$RET_LIB.:ZIC0TSI               FRI 09/05/97 12:31 Page:197  
          MINI XREF LISTING

I
        13**DCL        77<<ASSIGN     78>>DOWHILE    79>>IF         81>>ASSIGN     84<<ASSIGN     84>>ASSIGN
IN_VAL
         7**DCL         6--PROC       79>>IF
OUT_IDX
         8**DCL         6--PROC       81<<ASSIGN
PRESENCE_LIST
         9**DCL         6--PROC
PRESENCE_LIST.REC_NO
        10**DCL        78>>DOWHILE    79>>IF

PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:198  
     1237        1        /*M* ZII$RECURSE Performs all of the FINDs and GETs for ZII$RETRIEVE. */
     1238        2        /*T***********************************************************/
     1239        3        /*T*                                                         */
     1240        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1241        5        /*T*                                                         */
     1242        6        /*T***********************************************************/
     1243        7        /*P* NAME:       ZII$RECURSE
     1244        8
     1245        9             PURPOSE:     This module does all of the chain-chasing for one
     1246       10                          branch of the retrieval outlined in the path list.
     1247       11                          ZII$RECURSE does all of the actual FINDs and any
     1248       12                          indicated GETs for ZII$RETRIEVE. ZII$RETRIEVE tells
     1249       13                          ZII$RECURSE which branch of the path to traverse via
     1250       14                          the N parameter. ZII$RECURSE then tries to retrieve
     1251       15                          all of it. ZII$RECURSE returns when it either
     1252       16                          successfully finds every record for every set down
     1253       17                          the branch or hits end-of-set at some point in the
     1254       18                          branch. It altreturns if any other error occurs.
     1255       19
     1256       20             DESCRIPTION: ZII$RECURSE is a recursive routine designed to
     1257       21                          traverse a selected branch of the path given to
     1258       22                          it by ZII$RETRIEVE. If it successfully finds  record
     1259       23                          occurrences along the path, it looks at the Path
     1260       24                          list to see whether to GET this record occurrence.
     1261       25                          If so, it GETs the record, and then continues down
     1262       26                          the branch until either it reaches the end of the
     1263       27                          branch or detects end-of-set at any place on the
     1264       28                          branch via the UWA.DB_STATUS special register.
     1265       29                                                                              */
     1266       30        /*D* NAME:       ZII$RECURSE
     1267       31
     1268       32             CALL:       CALL ZII$RECURSE(N,PATH_LIST,PRESENCE_LIST,
     1269       33                                          START_OF_BRANCH,STATUS_CODE)
     1270       34                              ALTRET(LBL);
     1271       35
     1272       36             INPUT:      N             - index into PATH_LIST, indicating
     1273       37                                         where to start
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:199  
     1274       38
     1275       39                         PATH_LIST     - Array describing the path of the
     1276       40                                         entire retrieval
     1277       41
     1278       42                         PRESENCE_LIST - Array containing one element for each
     1279       43                                         different record in the entire
     1280       44                                         retrieval, used to indicate whether
     1281       45                                         a record was found and store the
     1282       46                                         DBKEYs of found records
     1283       47
     1284       48                         START_OF_BRANCH - index into PATH_LIST of the start
     1285       49                                         of the branch being traversed
     1286       50
     1287       51             OUTPUT:     STATUS_CODE   - Indicates specific errors. 0 if no
     1288       52                                         error detected.
     1289       53
     1290       54             DESCRIPTION: N is the index into the PATH_LIST of the entry
     1291       55                          which describes the set to be followed for a
     1292       56                          a particular call to ZII$RECURSE. PATH_LIST.OWN_NEXT
     1293       57                          indicates whether a FIND owner or FIND member of the
     1294       58                          set should be done; '1'B =  owner, '0'B = member.
     1295       59                          In either case, PATH_LIST.REC_NO(N+1) indicates
     1296       60                          which record type is expected to be found on this
     1297       61                          call.
     1298       62
     1299       63                          The only acceptable error on a FIND is end-of-set
     1300       64                          for a FIND member, indicating that no more records
     1301       65                          of the desired type exist on this set occurrence.
     1302       66                          If any other error is specified in UWA.DB_STATUS,
     1303       67                          the STATUS_CODE is set and the altreturn taken.
     1304       68                          If end-of-set is detected, several more things are
     1305       69                          checked and possibly set. If ZII$RECURSE was trying
     1306       70                          to find a member of the first set in the branch,
     1307       71                          then the PATH_LIST.BRANCH_EXHAUSTED flag for the
     1308       72                          current branch is set since the current branch
     1309       73                          occurrence can't be traversed any further. (This
     1310       74                          indicates to ZII$RETRIEVE that it shouldn't position
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:200  
     1311       75                          to this branch any more until it's time to find a
     1312       76                          new record, and hence new set occurrences, for the
     1313       77                          start of this branch. ZII$RETRIEVE takes care of
     1314       78                          those problems. ZII$RETRIEVE also takes care of
     1315       79                          setting BRANCH_EXHAUSTED flags in all other
     1316       80                          situations, such as a branch starting with a find
     1317       81                          owner.) Then, any necessary PATH_LIST.FIND_FIRST
     1318       82                          indicators are set. If the PATH_LIST indicates a
     1319       83                          lambda structure (multiple branches), then
     1320       84                          PIVOT_REC_IDX indicates the index into PATH_LIST of
     1321       85                          the first reference to the record from which
     1322       86                          branching occurs. So, if N < PIVOT_REC_IDX,
     1323       87                          ZII$RECURSE tried to find either the branching
     1324       88                          (or pivot) record itself or a record which precedes
     1325       89                          the branching point in the path. In this case,
     1326       90                          appropriate FIND_FIRST flags are set for all records
     1327       91                          from N+1 to the end of the path in order to include
     1328       92                          all branches. If N >= PIVOT_REC_IDX, we're inside
     1329       93                          a branch and don't want to upset the apple cart for
     1330       94                          any other branches. So, in this case, appropriate
     1331       95                          FIND_FIRST flags are set only for those records from
     1332       96                          N+1 to the end of the current branch.
     1333       97                          Then, the presence value (P_VALUE) of the record in
     1334       98                          the PRESENCE_LIST is set to 0 to indicate that the
     1335       99                          record was not found. The PATH_LIST.INIT_EPTR
     1336      100                          routine is used to initialize the original caller's
     1337      101                          (IDP's) specified area to something appropriate,
     1338      102                          probably zeroes or blanks. If it exists, the
     1339      103                          PATH_LIST.CONSTRAINT_EPTR is then used to constrain
     1340      104                          against the initialized area. If the constraint
     1341      105                          fails, the CONSTRAINT_FAILED flag is set. In either
     1342      106                          case, ZII$RECURSE unwinds to ZII$RETRIEVE since it
     1343      107                          can't traverse the current iteration of the branch
     1344      108                          any further.
     1345      109
     1346      110                          If a record is successfully found, N is incremented
     1347      111                          by 1. The index into the PRESENCE_LIST for the
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:201  
     1348      112                          found record is located, and the presence value
     1349      113                          (P_VALUE) for the record in the PRESENCE_LIST is
     1350      114                          set to 2 (%NEW) to indicate that this record was
     1351      115                          just found. The DBKEY for the found record is
     1352      116                          stored in the PRESENCE_LIST as well. The DBKEY may
     1353      117                          be needed by ZII$RETRIEVE later in order to restore
     1354      118                          record currencies in case the database is shared.
     1355      119                          Then, PATH_LIST.GET_IND(N) is checked to see
     1356      120                          whether we should GET the found record. (GETs are
     1357      121                          not necessary if the record is only used to connect
     1358      122                          us to other records we need to find in the path.
     1359      123                          I.e., GETs are only done for records used for
     1360      124                          display or constraint.) A GET should never fail, so
     1361      125                          the STATUS_CODE is set and the altreturn taken if
     1362      126                          it does.
     1363      127
     1364      128                          If a GET is indicated and succeeds, the routine
     1365      129                          specified by PATH_LIST.CONVERT_EPTR is called to
     1366      130                          convert the record contents into whatever form the
     1367      131                          original caller of ZII$RETRIEVE (IDP) wanted and put
     1368      132                          the converted form wherever the caller indicated it
     1369      133                          should go. If PATH_LIST.CONSTRAINT_EPTR exists,
     1370      134                          that routine is called to constrain against the
     1371      135                          converted area. If the constraints fail, there's
     1372      136                          no reason to traverse the branch further since the
     1373      137                          output record being formed by ZII$RETRIEVE will
     1374      138                          never be printed, so the CONSTRAINT_FAILED flag is
     1375      139                          set and ZII$RECURSE unwinds back to ZII$RETRIEVE
     1376      140                          from wherever it is in the recursion process.
     1377      141                          ZII$RETRIEVE will then figure out where it should
     1378      142                          start in the path in order to collect the pieces of
     1379      143                          a new output record and call ZII$RECURSE again
     1380      144                          later.
     1381      145
     1382      146                          If the constraints don't fail, PATH_LIST.SET_NO(N)
     1383      147                          is checked to see if the last record was obtained
     1384      148                          for this iteration of the current branch. If not,
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:202  
     1385      149                          ZII$RECURSE calls itself with the newly incremented
     1386      150                          N in order to proceed further down the branch. If
     1387      151                          so, it unwinds to ZII$RETRIEVE. ZII$RETRIEVE will
     1388      152                          position N to the proper place to start the next
     1389      153                          branch and call ZII$RECURSE again later.
     1390      154
     1391      155                          Note: The method for FINDing a member of a set has
     1392      156                          been altered somewhat from the method used in B03
     1393      157                          IDP. In the old days, simple FIND NEXTs were done,
     1394      158                          which works most of the time. However, since it is
     1395      159                          possible for multiple member record types to be
     1396      160                          present on a set AND for one or more of them to be
     1397      161                          used someplace else in the path, simple FIND NEXTs
     1398      162                          don't always work since the record-set currencies
     1399      163                          may be changed. So, to be safe, it's necessary to
     1400      164                          FIND the current of record in order to restore the
     1401      165                          proper set currencies prior to a FIND NEXT. But, one
     1402      166                          can't FIND CURRENT if no such record has been found
     1403      167                          yet for this occurrence of the set. So, a FIND FIRST
     1404      168                          is done whenever a new set occurrence is begun.
     1405      169                          After the first desired record on the set occurrence
     1406      170                          has been found, it is possible to FIND CURRENT of
     1407      171                          record and then FIND NEXT within set in order to
     1408      172                          find all other members until end-of-set is detected.
     1409      173                                                                              */
     1410      174        ZII$RECURSE: PROC (N,PATH_LIST,PRESENCE_LIST,START_OF_BRANCH,STATUS_CODE) ALTRET;
     1411      175    1   DCL N UBIN;
     1412      176    1   DCL START_OF_BRANCH UBIN;
     1413      177    1   DCL STATUS_CODE UBIN;
     1414      178    1   DCL 1 ZII$PARAMS (0:20) SYMREF,
     1415      179    1         2 L_HALF UBIN(18) UNAL,
     1416      180    1         2 R_HALF UBIN(18) UNAL;
     1417      181    1   DCL ZII$INTEGER1 SBIN SYMREF;
     1418      182    1   DCL DB_KEY_SAVE UBIN(36) UNAL EXT;
     1419      183    1   DCL RETRIEVE_RETURN BIT(72) EXT;
     1420      184    1   DCL I UBIN AUTO;
     1421      185        %EQU NEW = 2;
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:203  
     1422      186    1   DCL 1 PRESENCE_LIST (0:0) ALIGNED,
     1423      187    1         2 REC_NO UBIN(18) UNAL,
     1424      188    1         2 P_VALUE UBIN(18) UNAL,
     1425      189    1         2 DB_KEY_SAVE UBIN(36) UNAL;
     1426      190    1   DCL ZI_PRINT_FLAG BIT(1) EXT;
     1427      191    1   DCL CONSTRAINT_FAILED BIT(1) ALIGNED EXT;
     1428      192    1   DCL TEMP_VALUE UBIN AUTO;
     1429      193    1   DCL PIVOT_REC_IDX UBIN EXT;
     1430      194    1   DCL GEN_CODE_EPTR EPTR STATIC;
     1431      195        /**/
     1432      196        %INCLUDE CP_6;
     1433      277        %INCLUDE ZI$STRUCTS;
     1434      349        %NAM1;
     1435      378        %UWA1;
     1436      401        %INCLUDE ZI$DESC;
     1437     1251        %DSC_SET;
     1438     1293        %DSC_REC;
     1439     1327        %KEYWD_VAL;
     1440     1374        %INCLUDE ZI$PATH_STRUCTS;
     1441     1512        %PATH_DESC (STCLASS=" ");
     1442     1552        %INCLUDE ZI$TOP_STRUCTS;
     1443     1613        %TBL_DIM_DESC (STCLASS="EXT");
     1444     1618        %INCLUDE ZI_IDPERR_SUBS;
     1445     1652        /**/
     1446     1653    1   DCL ZII$FIND ENTRY ALTRET;
     1447     1654    1   DCL ZII$GET ENTRY ALTRET;
     1448     1655    1   DCL ZII$CLR_PARAMS ENTRY;
     1449     1656    1   DCL ZII$FIND_PRESENCE_IDX ENTRY(3);
     1450     1657        /**/
     1451     1658    1       STATUS_CODE=0;
     1452     1659    1       ZII$PARAMS='0'B;
     1453     1660    1       IF NOT PATH_LIST.OWN_NEXT(N) THEN
     1454     1661    2       DO; /* Want to find next (or maybe first) member of set */
     1455     1662    2           DR$ = NAM1.DESC$(PATH_LIST.REC_NO(N+1));
     1456     1663    2           DS$ = NAM1.DESC$(PATH_LIST.SET_NO(N));
     1457     1664    2           IF PATH_LIST.FIND_FIRST(N+1) THEN /* Set up Find First */
     1458     1665    3           DO;
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:204  
     1459     1666    3               ZII$PARAMS.R_HALF(0) = 4;
     1460     1667    3               ZII$PARAMS.R_HALF(1) = %FIRST;
     1461     1668    3               ZII$PARAMS.L_HALF(2) = RECORD.RVA_OFF;
     1462     1669    3               ZII$PARAMS.R_HALF(3) = %WITHIN;
     1463     1670    3               ZII$PARAMS.L_HALF(4) = SET.RVA_OFF;
     1464     1671    3               PATH_LIST.FIND_FIRST(N+1) = '0'B;
     1465     1672    3               END;
     1466     1673    3           ELSE DO; /* Find Cur of Record, then set up Find Next */
     1467     1674    3               ZII$PARAMS.R_HALF(0) = 2;
     1468     1675    3               ZII$PARAMS.R_HALF(1) = %CURRENT;
     1469     1676    3               ZII$PARAMS.L_HALF(2) = RECORD.RVA_OFF;
     1470     1677    3               CALL ZII$FIND ALTRET(BAD_FIND);
     1471     1678    3               IF UWA.DB_STATUS ~= '0000000' THEN
     1472     1679    3                   GOTO BAD_FIND;
     1473     1680    3               ZII$PARAMS = '0'B;
     1474     1681    3               ZII$PARAMS.R_HALF(0) = 3;
     1475     1682    3               ZII$PARAMS.R_HALF(1) = %NEXT;
     1476     1683    3               ZII$PARAMS.L_HALF(2) = RECORD.RVA_OFF;
     1477     1684    3               ZII$PARAMS.L_HALF(3) = SET.RVA_OFF;
     1478     1685    3               END;
     1479     1686    2           END;
     1480     1687    1       ELSE
     1481     1688    2       DO; /* Set up for find owner of set */
     1482     1689    2           ZII$PARAMS.R_HALF(0)=2;
     1483     1690    2           ZII$PARAMS.R_HALF(1)=%OWNER;
     1484     1691    2           DS$=NAM1.DESC$(PATH_LIST.SET_NO(N));
     1485     1692    2           ZII$PARAMS.L_HALF(2)=SET.RVA_OFF;
     1486     1693    2           END;
     1487     1694    1       CALL ZII$FIND ALTRET(BAD_FIND);
     1488     1695    1       PATH_LIST.FIND_ATTEMPTED(N)='1'B;
     1489     1696    1       IF UWA.DB_STATUS='0000000' THEN
     1490     1697    2       DO;
     1491     1698    2           N=N+1;
     1492     1699    2           CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,PATH_LIST.REC_NO(N),TEMP_VALUE);
     1493     1700    2           PRESENCE_LIST.P_VALUE(TEMP_VALUE)=%NEW;
     1494     1701    2           PRESENCE_LIST.DB_KEY_SAVE(TEMP_VALUE)=UWA.DIRECT_REFERENCE;
     1495     1702    2           PATH_LIST.BRANCH_EXHAUSTED(N)='0'B;
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:205  
     1496     1703    2           END;
     1497     1704    1       ELSE
     1498     1705    1           IF UWA.DB_STATUS='0502100' /* End of Set */ THEN
     1499     1706    2           DO;
     1500     1707    2               IF PATH_LIST.REC_NO(N)=PATH_LIST.REC_NO(START_OF_BRANCH) THEN
     1501     1708    2                   PATH_LIST.BRANCH_EXHAUSTED(N)='1'B;
     1502     1709         /*
     1503     1710            If rec not found is at the lambda branching point or
     1504     1711            earlier, ensure that ZII$RETRIEVE won't try to send us thru
     1505     1712            2nd or higher branches while it's traipsing down the
     1506     1713            current iteration of the path. Keeps the EVAL_PRESENCE
     1507     1714            routine from getting confused.
     1508     1715         */
     1509     1716    2               IF N < PIVOT_REC_IDX THEN
     1510     1717    3               DO I = N+1 TO PATH_LIST.REC_NO(0)-1;
     1511     1718    3                   IF PATH_LIST.SET_NO(I) = 0 THEN
     1512     1719    3                       PATH_LIST.BRANCH_EXHAUSTED(I+1) = '1'B;
     1513     1720    3                   END;
     1514     1721         /*
     1515     1722            Set the find first flags. If the record not found is at
     1516     1723            the branching point or earlier, then we need to set the
     1517     1724            appropriate find first flags for all the branches.
     1518     1725            Otherwise, just set them from N+1 down to the end of the
     1519     1726            branch we're on.
     1520     1727         */
     1521     1728    2               IF N < PIVOT_REC_IDX THEN
     1522     1729    3               DO I = N TO PATH_LIST.REC_NO(0)-1; /* all branches */
     1523     1730    3                   IF NOT PATH_LIST.OWN_NEXT(I) AND PATH_LIST.SET_NO(I)~=0 THEN
     1524     1731    3                       PATH_LIST.FIND_FIRST(I+1)='1'B;
     1525     1732    3                   END;
     1526     1733    3               ELSE DO;
     1527     1734    3                   I=N;
     1528     1735    4                   DO WHILE(PATH_LIST.SET_NO(I)~=0); /* the rest of this branch */
     1529     1736    4                       IF NOT PATH_LIST.OWN_NEXT(I) THEN
     1530     1737    4                           PATH_LIST.FIND_FIRST(I+1)='1'B;
     1531     1738    4                       I=I+1;
     1532     1739    4                       END;
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:206  
     1533     1740    3                   END;
     1534     1741    2               CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,PATH_LIST.REC_NO(N+1),
              1741                        TEMP_VALUE);
     1535     1742    2               PRESENCE_LIST.P_VALUE(TEMP_VALUE)=0;
     1536     1743    2               GEN_CODE_EPTR=PATH_LIST.INIT_EPTR(N+1);
     1537     1744    2               CALL GEN_CODE_EPTR ALTRET(BAD_INIT);
     1538     1745    2               GEN_CODE_EPTR = PATH_LIST.CONSTRAINT_EPTR(N+1);
     1539     1746    2               IF GEN_CODE_EPTR ~= ENTADDR(NIL) THEN
     1540     1747    2                   CALL GEN_CODE_EPTR ALTRET(CONSTLBL);
     1541     1748    2               GOTO UNWINDLBL;
     1542     1749    2               END;
     1543     1750    1           ELSE
     1544     1751    1               GOTO BAD_FIND;
     1545     1752    1       IF PATH_LIST.GET_IND(N) THEN
     1546     1753    2       DO;
     1547     1754    2           ZII$PARAMS='0'B;
     1548     1755    2           CALL ZII$GET ALTRET(BAD_GET);
     1549     1756    2           IF UWA.DB_STATUS~='0000000' THEN
     1550     1757    3           DO;
     1551     1758    3               GEN_CODE_EPTR=PATH_LIST.INIT_EPTR(N);
     1552     1759    3               CALL GEN_CODE_EPTR;
     1553     1760    3               GOTO BAD_GET;
     1554     1761    3               END;
     1555     1762    2           GEN_CODE_EPTR=PATH_LIST.CONVERT_EPTR(N);
     1556     1763    2           CALL GEN_CODE_EPTR;
     1557     1764    2           GEN_CODE_EPTR=PATH_LIST.CONSTRAINT_EPTR(N);
     1558     1765    2           IF GEN_CODE_EPTR~=ENTADDR(NIL) THEN
     1559     1766    2               CALL GEN_CODE_EPTR ALTRET(CONSTLBL);
     1560     1767    2           END;
     1561     1768    1       IF PATH_LIST.SET_NO(N)=0 THEN /* at end of this branch */
     1562     1769    1   UNWINDLBL: UNWIND TO RETRIEVE_RETURN;
     1563     1770         /* Otherwise, keep recursing down this branch. */
     1564     1771    1       CALL ZII$RECURSE(N,PATH_LIST,PRESENCE_LIST,START_OF_BRANCH,STATUS_CODE);
     1565     1772    1   CONSTLBL: IF PATH_LIST.SET_NO(N)~=0 THEN
     1566     1773    2       DO;
     1567     1774    2           CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,PATH_LIST.REC_NO(N+1),TEMP_VALUE);
     1568     1775    2           PRESENCE_LIST.P_VALUE(TEMP_VALUE) = 0;
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:207  
     1569     1776    2           END;
     1570     1777    1       CONSTRAINT_FAILED = '1'B;
     1571     1778    1       GOTO UNWINDLBL;
     1572     1779    1   BAD_FIND:
     1573     1780    1       STATUS_CODE=%ZII_BAD_FIND;
     1574     1781    1       ALTRETURN;
     1575     1782    1   BAD_GET:
     1576     1783    1       STATUS_CODE=%ZII_BAD_GET;
     1577     1784    1       ALTRETURN;
     1578     1785    1   BAD_INIT:
     1579     1786    1       CALL M$ERR;
     1580     1787    1   END ZII$RECURSE;
     1581     1788        %EOD;

PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:208  
--  Include file information  --

   ZI_IDPERR_SUBS.:ZIC0TOU  is referenced.
   ZI$TOP_STRUCTS.:ZIC0TOU  is referenced.
   ZI$PATH_STRUCTS.:ZIC0TOU  is referenced.
   ZI$DESC.:ZIC0TOU  is referenced.
   ZI$STRUCTS.:ZIC0TOU  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZII$RECURSE.

   Procedure ZII$RECURSE requires 366 words for executable code.
   Procedure ZII$RECURSE requires 14 words of local(AUTO) storage.

PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:209  

 Object Unit name= ZII$RECURSE                                File name= ZII$RET_LIB.:ZIC0TOU
 UTS= SEP 05 '97 12:31:33.96 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  LblCom even  none     1      1  DB_KEY_SAVE
    1  LblCom even  none     2      2  RETRIEVE_RETURN
    2  LblCom even  none     1      1  ZI_PRINT_FLAG
    3  LblCom even  none     1      1  CONSTRAINT_FAILED
    4  LblCom even  none     1      1  PIVOT_REC_IDX
    5   Data  even  none     1      1  ZII$RECURSE
    6   DCB   even  none     0      0  M$UC
    7  LblCom even  none     1      1  NAM1$
    8  LblCom even  none     1      1  NAM1_SIZ
    9  LblCom even  none     1      1  NAM1_IDX
   10  LblCom even  none     1      1  UWA$
   11  LblCom even  none     1      1  UWA_SIZ
   12  LblCom even  none     1      1  UWA#
   13  LblCom even  none     1      1  DS$
   14  LblCom even  none     1      1  DR$
   15  LblCom even  none     1      1  TBL_DIM
   16  RoData even  UTS      4      4  ZII$RECURSE
   17   Proc  even  none   366    556  ZII$RECURSE
   18  RoData even  none     5      5  ZII$RECURSE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    17      0   yes    yes     yes      Std        5  ZII$RECURSE
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:210  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       0 ZII$FIND
         yes           Std       3 ZII$FIND_PRESENCE_IDX
 yes     yes           Std       0 ZII$GET
                       nStd      0 X66_AUTO_5
                       nStd      0 X66_AUNWIND
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ZII$PARAMS                            ZII$INTEGER1                          M$UC
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:211  


     1237        1        /*M* ZII$RECURSE Performs all of the FINDs and GETs for ZII$RETRIEVE. */
     1238        2        /*T***********************************************************/
     1239        3        /*T*                                                         */
     1240        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1241        5        /*T*                                                         */
     1242        6        /*T***********************************************************/
     1243        7        /*P* NAME:       ZII$RECURSE
     1244        8
     1245        9             PURPOSE:     This module does all of the chain-chasing for one
     1246       10                          branch of the retrieval outlined in the path list.
     1247       11                          ZII$RECURSE does all of the actual FINDs and any
     1248       12                          indicated GETs for ZII$RETRIEVE. ZII$RETRIEVE tells
     1249       13                          ZII$RECURSE which branch of the path to traverse via
     1250       14                          the N parameter. ZII$RECURSE then tries to retrieve
     1251       15                          all of it. ZII$RECURSE returns when it either
     1252       16                          successfully finds every record for every set down
     1253       17                          the branch or hits end-of-set at some point in the
     1254       18                          branch. It altreturns if any other error occurs.
     1255       19
     1256       20             DESCRIPTION: ZII$RECURSE is a recursive routine designed to
     1257       21                          traverse a selected branch of the path given to
     1258       22                          it by ZII$RETRIEVE. If it successfully finds  record
     1259       23                          occurrences along the path, it looks at the Path
     1260       24                          list to see whether to GET this record occurrence.
     1261       25                          If so, it GETs the record, and then continues down
     1262       26                          the branch until either it reaches the end of the
     1263       27                          branch or detects end-of-set at any place on the
     1264       28                          branch via the UWA.DB_STATUS special register.
     1265       29                                                                              */
     1266       30        /*D* NAME:       ZII$RECURSE
     1267       31
     1268       32             CALL:       CALL ZII$RECURSE(N,PATH_LIST,PRESENCE_LIST,
     1269       33                                          START_OF_BRANCH,STATUS_CODE)
     1270       34                              ALTRET(LBL);
     1271       35
     1272       36             INPUT:      N             - index into PATH_LIST, indicating
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:212  
     1273       37                                         where to start
     1274       38
     1275       39                         PATH_LIST     - Array describing the path of the
     1276       40                                         entire retrieval
     1277       41
     1278       42                         PRESENCE_LIST - Array containing one element for each
     1279       43                                         different record in the entire
     1280       44                                         retrieval, used to indicate whether
     1281       45                                         a record was found and store the
     1282       46                                         DBKEYs of found records
     1283       47
     1284       48                         START_OF_BRANCH - index into PATH_LIST of the start
     1285       49                                         of the branch being traversed
     1286       50
     1287       51             OUTPUT:     STATUS_CODE   - Indicates specific errors. 0 if no
     1288       52                                         error detected.
     1289       53
     1290       54             DESCRIPTION: N is the index into the PATH_LIST of the entry
     1291       55                          which describes the set to be followed for a
     1292       56                          a particular call to ZII$RECURSE. PATH_LIST.OWN_NEXT
     1293       57                          indicates whether a FIND owner or FIND member of the
     1294       58                          set should be done; '1'B =  owner, '0'B = member.
     1295       59                          In either case, PATH_LIST.REC_NO(N+1) indicates
     1296       60                          which record type is expected to be found on this
     1297       61                          call.
     1298       62
     1299       63                          The only acceptable error on a FIND is end-of-set
     1300       64                          for a FIND member, indicating that no more records
     1301       65                          of the desired type exist on this set occurrence.
     1302       66                          If any other error is specified in UWA.DB_STATUS,
     1303       67                          the STATUS_CODE is set and the altreturn taken.
     1304       68                          If end-of-set is detected, several more things are
     1305       69                          checked and possibly set. If ZII$RECURSE was trying
     1306       70                          to find a member of the first set in the branch,
     1307       71                          then the PATH_LIST.BRANCH_EXHAUSTED flag for the
     1308       72                          current branch is set since the current branch
     1309       73                          occurrence can't be traversed any further. (This
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:213  
     1310       74                          indicates to ZII$RETRIEVE that it shouldn't position
     1311       75                          to this branch any more until it's time to find a
     1312       76                          new record, and hence new set occurrences, for the
     1313       77                          start of this branch. ZII$RETRIEVE takes care of
     1314       78                          those problems. ZII$RETRIEVE also takes care of
     1315       79                          setting BRANCH_EXHAUSTED flags in all other
     1316       80                          situations, such as a branch starting with a find
     1317       81                          owner.) Then, any necessary PATH_LIST.FIND_FIRST
     1318       82                          indicators are set. If the PATH_LIST indicates a
     1319       83                          lambda structure (multiple branches), then
     1320       84                          PIVOT_REC_IDX indicates the index into PATH_LIST of
     1321       85                          the first reference to the record from which
     1322       86                          branching occurs. So, if N < PIVOT_REC_IDX,
     1323       87                          ZII$RECURSE tried to find either the branching
     1324       88                          (or pivot) record itself or a record which precedes
     1325       89                          the branching point in the path. In this case,
     1326       90                          appropriate FIND_FIRST flags are set for all records
     1327       91                          from N+1 to the end of the path in order to include
     1328       92                          all branches. If N >= PIVOT_REC_IDX, we're inside
     1329       93                          a branch and don't want to upset the apple cart for
     1330       94                          any other branches. So, in this case, appropriate
     1331       95                          FIND_FIRST flags are set only for those records from
     1332       96                          N+1 to the end of the current branch.
     1333       97                          Then, the presence value (P_VALUE) of the record in
     1334       98                          the PRESENCE_LIST is set to 0 to indicate that the
     1335       99                          record was not found. The PATH_LIST.INIT_EPTR
     1336      100                          routine is used to initialize the original caller's
     1337      101                          (IDP's) specified area to something appropriate,
     1338      102                          probably zeroes or blanks. If it exists, the
     1339      103                          PATH_LIST.CONSTRAINT_EPTR is then used to constrain
     1340      104                          against the initialized area. If the constraint
     1341      105                          fails, the CONSTRAINT_FAILED flag is set. In either
     1342      106                          case, ZII$RECURSE unwinds to ZII$RETRIEVE since it
     1343      107                          can't traverse the current iteration of the branch
     1344      108                          any further.
     1345      109
     1346      110                          If a record is successfully found, N is incremented
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:214  
     1347      111                          by 1. The index into the PRESENCE_LIST for the
     1348      112                          found record is located, and the presence value
     1349      113                          (P_VALUE) for the record in the PRESENCE_LIST is
     1350      114                          set to 2 (%NEW) to indicate that this record was
     1351      115                          just found. The DBKEY for the found record is
     1352      116                          stored in the PRESENCE_LIST as well. The DBKEY may
     1353      117                          be needed by ZII$RETRIEVE later in order to restore
     1354      118                          record currencies in case the database is shared.
     1355      119                          Then, PATH_LIST.GET_IND(N) is checked to see
     1356      120                          whether we should GET the found record. (GETs are
     1357      121                          not necessary if the record is only used to connect
     1358      122                          us to other records we need to find in the path.
     1359      123                          I.e., GETs are only done for records used for
     1360      124                          display or constraint.) A GET should never fail, so
     1361      125                          the STATUS_CODE is set and the altreturn taken if
     1362      126                          it does.
     1363      127
     1364      128                          If a GET is indicated and succeeds, the routine
     1365      129                          specified by PATH_LIST.CONVERT_EPTR is called to
     1366      130                          convert the record contents into whatever form the
     1367      131                          original caller of ZII$RETRIEVE (IDP) wanted and put
     1368      132                          the converted form wherever the caller indicated it
     1369      133                          should go. If PATH_LIST.CONSTRAINT_EPTR exists,
     1370      134                          that routine is called to constrain against the
     1371      135                          converted area. If the constraints fail, there's
     1372      136                          no reason to traverse the branch further since the
     1373      137                          output record being formed by ZII$RETRIEVE will
     1374      138                          never be printed, so the CONSTRAINT_FAILED flag is
     1375      139                          set and ZII$RECURSE unwinds back to ZII$RETRIEVE
     1376      140                          from wherever it is in the recursion process.
     1377      141                          ZII$RETRIEVE will then figure out where it should
     1378      142                          start in the path in order to collect the pieces of
     1379      143                          a new output record and call ZII$RECURSE again
     1380      144                          later.
     1381      145
     1382      146                          If the constraints don't fail, PATH_LIST.SET_NO(N)
     1383      147                          is checked to see if the last record was obtained
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:215  
     1384      148                          for this iteration of the current branch. If not,
     1385      149                          ZII$RECURSE calls itself with the newly incremented
     1386      150                          N in order to proceed further down the branch. If
     1387      151                          so, it unwinds to ZII$RETRIEVE. ZII$RETRIEVE will
     1388      152                          position N to the proper place to start the next
     1389      153                          branch and call ZII$RECURSE again later.
     1390      154
     1391      155                          Note: The method for FINDing a member of a set has
     1392      156                          been altered somewhat from the method used in B03
     1393      157                          IDP. In the old days, simple FIND NEXTs were done,
     1394      158                          which works most of the time. However, since it is
     1395      159                          possible for multiple member record types to be
     1396      160                          present on a set AND for one or more of them to be
     1397      161                          used someplace else in the path, simple FIND NEXTs
     1398      162                          don't always work since the record-set currencies
     1399      163                          may be changed. So, to be safe, it's necessary to
     1400      164                          FIND the current of record in order to restore the
     1401      165                          proper set currencies prior to a FIND NEXT. But, one
     1402      166                          can't FIND CURRENT if no such record has been found
     1403      167                          yet for this occurrence of the set. So, a FIND FIRST
     1404      168                          is done whenever a new set occurrence is begun.
     1405      169                          After the first desired record on the set occurrence
     1406      170                          has been found, it is possible to FIND CURRENT of
     1407      171                          record and then FIND NEXT within set in order to
     1408      172                          find all other members until end-of-set is detected.
     1409      173                                                                              */
     1410      174        ZII$RECURSE: PROC (N,PATH_LIST,PRESENCE_LIST,START_OF_BRANCH,STATUS_CODE) ALTRET;

    174 17 000000   000000 700200 xent  ZII$RECURSE  TSX0  ! X66_AUTO_5
        17 000001   000016 000005                    ZERO    14,5

     1411      175    1   DCL N UBIN;
     1412      176    1   DCL START_OF_BRANCH UBIN;
     1413      177    1   DCL STATUS_CODE UBIN;
     1414      178    1   DCL 1 ZII$PARAMS (0:20) SYMREF,
     1415      179    1         2 L_HALF UBIN(18) UNAL,
     1416      180    1         2 R_HALF UBIN(18) UNAL;
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:216  
     1417      181    1   DCL ZII$INTEGER1 SBIN SYMREF;
     1418      182    1   DCL DB_KEY_SAVE UBIN(36) UNAL EXT;
     1419      183    1   DCL RETRIEVE_RETURN BIT(72) EXT;
     1420      184    1   DCL I UBIN AUTO;
     1421      185        %EQU NEW = 2;
     1422      186    1   DCL 1 PRESENCE_LIST (0:0) ALIGNED,
     1423      187    1         2 REC_NO UBIN(18) UNAL,
     1424      188    1         2 P_VALUE UBIN(18) UNAL,
     1425      189    1         2 DB_KEY_SAVE UBIN(36) UNAL;
     1426      190    1   DCL ZI_PRINT_FLAG BIT(1) EXT;
     1427      191    1   DCL CONSTRAINT_FAILED BIT(1) ALIGNED EXT;
     1428      192    1   DCL TEMP_VALUE UBIN AUTO;
     1429      193    1   DCL PIVOT_REC_IDX UBIN EXT;
     1430      194    1   DCL GEN_CODE_EPTR EPTR STATIC;
     1431      195        /**/
     1432      196        %INCLUDE CP_6;
     1433      277        %INCLUDE ZI$STRUCTS;
     1434      349        %NAM1;
     1435      378        %UWA1;
     1436      401        %INCLUDE ZI$DESC;
     1437     1251        %DSC_SET;
     1438     1293        %DSC_REC;
     1439     1327        %KEYWD_VAL;
     1440     1374        %INCLUDE ZI$PATH_STRUCTS;
     1441     1512        %PATH_DESC (STCLASS=" ");
     1442     1552        %INCLUDE ZI$TOP_STRUCTS;
     1443     1613        %TBL_DIM_DESC (STCLASS="EXT");
     1444     1618        %INCLUDE ZI_IDPERR_SUBS;
     1445     1652        /**/
     1446     1653    1   DCL ZII$FIND ENTRY ALTRET;
     1447     1654    1   DCL ZII$GET ENTRY ALTRET;
     1448     1655    1   DCL ZII$CLR_PARAMS ENTRY;
     1449     1656    1   DCL ZII$FIND_PRESENCE_IDX ENTRY(3);
     1450     1657        /**/
     1451     1658    1       STATUS_CODE=0;

   1658 17 000002   200007 470500                    LDP0    @STATUS_CODE,,AUTO
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:217  
        17 000003   000000 450100                    STZ     0,,PR0

     1452     1659    1       ZII$PARAMS='0'B;

   1659 17 000004   000000 100400                    MLR     fill='000'O
        17 000005   000000 000001 18                 ADSC9   0                        cn=0,n=1
        17 000006   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84

     1453     1660    1       IF NOT PATH_LIST.OWN_NEXT(N) THEN

   1660 17 000007   200003 471500                    LDP1    @N,,AUTO
        17 000010   100000 236100                    LDQ     0,,PR1
        17 000011   000005 402007                    MPY     5,DL
        17 000012   200004 473500                    LDP3    @PATH_LIST,,AUTO
        17 000013   300001 234106                    SZN     1,QL,PR3
        17 000014   000116 604000 17                 TMI     s:1689

     1454     1661    2       DO; /* Want to find next (or maybe first) member of set */

     1455     1662    2           DR$ = NAM1.DESC$(PATH_LIST.REC_NO(N+1));

   1662 17 000015   300005 236106                    LDQ     5,QL,PR3
        17 000016   000022 772000                    QRL     18
        17 000017   000012 402007                    MPY     10,DL
        17 000020   000000 474400 7                  LDP4    NAM1$
        17 000021   400011 236106                    LDQ     9,QL,PR4
        17 000022   000000 756000 14                 STQ     DR$

     1456     1663    2           DS$ = NAM1.DESC$(PATH_LIST.SET_NO(N));

   1663 17 000023   100000 236100                    LDQ     0,,PR1
        17 000024   000005 402007                    MPY     5,DL
        17 000025   300000 236106                    LDQ     0,QL,PR3
        17 000026   777777 376007                    ANQ     -1,DL
        17 000027   000012 402007                    MPY     10,DL
        17 000030   400011 236106                    LDQ     9,QL,PR4
        17 000031   000000 756000 13                 STQ     DS$
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:218  

     1457     1664    2           IF PATH_LIST.FIND_FIRST(N+1) THEN /* Set up Find First */

   1664 17 000032   100000 236100                    LDQ     0,,PR1
        17 000033   000005 402007                    MPY     5,DL
        17 000034   300006 236106                    LDQ     6,QL,PR3
        17 000035   004000 316003                    CANQ    2048,DU
        17 000036   000061 600000 17                 TZE     s:1674

     1458     1665    3           DO;

     1459     1666    3               ZII$PARAMS.R_HALF(0) = 4;

   1666 17 000037   000004 220003                    LDX0    4,DU
        17 000040   000000 440000 xsym               SXL0    ZII$PARAMS

     1460     1667    3               ZII$PARAMS.R_HALF(1) = %FIRST;

   1667 17 000041   000016 221003                    LDX1    14,DU
        17 000042   000001 441000 xsym               SXL1    ZII$PARAMS+1

     1461     1668    3               ZII$PARAMS.L_HALF(2) = RECORD.RVA_OFF;

   1668 17 000043   000000 475400 14                 LDP5    DR$
        17 000044   500000 722100                    LXL2    0,,PR5
        17 000045   000002 742000 xsym               STX2    ZII$PARAMS+2

     1462     1669    3               ZII$PARAMS.R_HALF(3) = %WITHIN;

   1669 17 000046   000041 223003                    LDX3    33,DU
        17 000047   000003 443000 xsym               SXL3    ZII$PARAMS+3

     1463     1670    3               ZII$PARAMS.L_HALF(4) = SET.RVA_OFF;

   1670 17 000050   000000 476400 13                 LDP6    DS$
        17 000051   600000 724100                    LXL4    0,,PR6
        17 000052   000004 744000 xsym               STX4    ZII$PARAMS+4
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:219  

     1464     1671    3               PATH_LIST.FIND_FIRST(N+1) = '0'B;

   1671 17 000053   100000 236100                    LDQ     0,,PR1
        17 000054   000005 402007                    MPY     5,DL
        17 000055   000000 625006                    EAX5    0,QL
        17 000056   000001 236000 18                 LDQ     1
        17 000057   300006 356115                    ANSQ    6,X5,PR3

     1465     1672    3               END;

   1672 17 000060   000135 710000 17                 TRA     s:1694

     1466     1673    3           ELSE DO; /* Find Cur of Record, then set up Find Next */

     1467     1674    3               ZII$PARAMS.R_HALF(0) = 2;

   1674 17 000061   000002 220003                    LDX0    2,DU
        17 000062   000000 440000 xsym               SXL0    ZII$PARAMS

     1468     1675    3               ZII$PARAMS.R_HALF(1) = %CURRENT;

   1675 17 000063   000013 221003                    LDX1    11,DU
        17 000064   000001 441000 xsym               SXL1    ZII$PARAMS+1

     1469     1676    3               ZII$PARAMS.L_HALF(2) = RECORD.RVA_OFF;

   1676 17 000065   000000 475400 14                 LDP5    DR$
        17 000066   500000 722100                    LXL2    0,,PR5
        17 000067   000002 742000 xsym               STX2    ZII$PARAMS+2

     1470     1677    3               CALL ZII$FIND ALTRET(BAD_FIND);

   1677 17 000070   000000 631400 18                 EPPR1   0
        17 000071   000000 701000 xent               TSX1    ZII$FIND
        17 000072   000543 702000 17                 TSX2    BAD_FIND

PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:220  
     1471     1678    3               IF UWA.DB_STATUS ~= '0000000' THEN

   1678 17 000073   000000 470400 10                 LDP0    UWA$
        17 000074   040000 106500                    CMPC    fill='040'O
        17 000075   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        17 000076   000000 000007 16                 ADSC9   0                        cn=0,n=7
        17 000077   000543 601000 17                 TNZ     BAD_FIND

     1472     1679    3                   GOTO BAD_FIND;
     1473     1680    3               ZII$PARAMS = '0'B;

   1680 17 000100   000000 100400                    MLR     fill='000'O
        17 000101   000000 000001 18                 ADSC9   0                        cn=0,n=1
        17 000102   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84

     1474     1681    3               ZII$PARAMS.R_HALF(0) = 3;

   1681 17 000103   000003 220003                    LDX0    3,DU
        17 000104   000000 440000 xsym               SXL0    ZII$PARAMS

     1475     1682    3               ZII$PARAMS.R_HALF(1) = %NEXT;

   1682 17 000105   000023 221003                    LDX1    19,DU
        17 000106   000001 441000 xsym               SXL1    ZII$PARAMS+1

     1476     1683    3               ZII$PARAMS.L_HALF(2) = RECORD.RVA_OFF;

   1683 17 000107   000000 471400 14                 LDP1    DR$
        17 000110   100000 722100                    LXL2    0,,PR1
        17 000111   000002 742000 xsym               STX2    ZII$PARAMS+2

     1477     1684    3               ZII$PARAMS.L_HALF(3) = SET.RVA_OFF;

   1684 17 000112   000000 473400 13                 LDP3    DS$
        17 000113   300000 723100                    LXL3    0,,PR3
        17 000114   000003 743000 xsym               STX3    ZII$PARAMS+3

PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:221  
     1478     1685    3               END;

     1479     1686    2           END;

   1686 17 000115   000135 710000 17                 TRA     s:1694

     1480     1687    1       ELSE
     1481     1688    2       DO; /* Set up for find owner of set */

     1482     1689    2           ZII$PARAMS.R_HALF(0)=2;

   1689 17 000116   000002 220003                    LDX0    2,DU
        17 000117   000000 440000 xsym               SXL0    ZII$PARAMS

     1483     1690    2           ZII$PARAMS.R_HALF(1)=%OWNER;

   1690 17 000120   000026 221003                    LDX1    22,DU
        17 000121   000001 441000 xsym               SXL1    ZII$PARAMS+1

     1484     1691    2           DS$=NAM1.DESC$(PATH_LIST.SET_NO(N));

   1691 17 000122   100000 236100                    LDQ     0,,PR1
        17 000123   000005 402007                    MPY     5,DL
        17 000124   300000 236106                    LDQ     0,QL,PR3
        17 000125   777777 376007                    ANQ     -1,DL
        17 000126   000012 402007                    MPY     10,DL
        17 000127   000000 474400 7                  LDP4    NAM1$
        17 000130   400011 236106                    LDQ     9,QL,PR4
        17 000131   000000 756000 13                 STQ     DS$

     1485     1692    2           ZII$PARAMS.L_HALF(2)=SET.RVA_OFF;

   1692 17 000132   000000 475400 13                 LDP5    DS$
        17 000133   500000 722100                    LXL2    0,,PR5
        17 000134   000002 742000 xsym               STX2    ZII$PARAMS+2

     1486     1693    2           END;
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:222  

     1487     1694    1       CALL ZII$FIND ALTRET(BAD_FIND);

   1694 17 000135   000000 631400 18                 EPPR1   0
        17 000136   000000 701000 xent               TSX1    ZII$FIND
        17 000137   000543 702000 17                 TSX2    BAD_FIND

     1488     1695    1       PATH_LIST.FIND_ATTEMPTED(N)='1'B;

   1695 17 000140   200003 470500                    LDP0    @N,,AUTO
        17 000141   000000 236100                    LDQ     0,,PR0
        17 000142   000005 402007                    MPY     5,DL
        17 000143   200004 471500                    LDP1    @PATH_LIST,,AUTO
        17 000144   000000 620006                    EAX0    0,QL
        17 000145   100000 236003                    LDQ     32768,DU
        17 000146   100001 256110                    ORSQ    1,X0,PR1

     1489     1696    1       IF UWA.DB_STATUS='0000000' THEN

   1696 17 000147   000000 473400 10                 LDP3    UWA$
        17 000150   040000 106500                    CMPC    fill='040'O
        17 000151   300001 000007                    ADSC9   1,,PR3                   cn=0,n=7
        17 000152   000000 000007 16                 ADSC9   0                        cn=0,n=7
        17 000153   000216 601000 17                 TNZ     s:1705

     1490     1697    2       DO;

     1491     1698    2           N=N+1;

   1698 17 000154   000000 235100                    LDA     0,,PR0
        17 000155   000001 035007                    ADLA    1,DL
        17 000156   000000 755100                    STA     0,,PR0

     1492     1699    2           CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,PATH_LIST.REC_NO(N),TEMP_VALUE);

   1699 17 000157   000000 236100                    LDQ     0,,PR0
        17 000160   000005 402007                    MPY     5,DL
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:223  
        17 000161   200011 633500                    EPPR3   TEMP_VALUE,,AUTO
        17 000162   200014 453500                    STP3    TEMP_VALUE+3,,AUTO
        17 000163   000022 736000                    QLS     18
        17 000164   200004 036100                    ADLQ    @PATH_LIST,,AUTO
        17 000165   200005 235100                    LDA     @PRESENCE_LIST,,AUTO
        17 000166   200012 757100                    STAQ    TEMP_VALUE+1,,AUTO
        17 000167   200012 630500                    EPPR0   TEMP_VALUE+1,,AUTO
        17 000170   000002 631400 18                 EPPR1   2
        17 000171   000000 701000 xent               TSX1    ZII$FIND_PRESENCE_IDX
        17 000172   000000 011000                    NOP     0

     1493     1700    2           PRESENCE_LIST.P_VALUE(TEMP_VALUE)=%NEW;

   1700 17 000173   200011 235100                    LDA     TEMP_VALUE,,AUTO
        17 000174   000001 735000                    ALS     1
        17 000175   000002 220003                    LDX0    2,DU
        17 000176   200005 470500                    LDP0    @PRESENCE_LIST,,AUTO
        17 000177   000000 440105                    SXL0    0,AL,PR0

     1494     1701    2           PRESENCE_LIST.DB_KEY_SAVE(TEMP_VALUE)=UWA.DIRECT_REFERENCE;

   1701 17 000200   200011 235100                    LDA     TEMP_VALUE,,AUTO
        17 000201   000001 735000                    ALS     1
        17 000202   000000 471400 10                 LDP1    UWA$
        17 000203   000000 621005                    EAX1    0,AL
        17 000204   100036 235100                    LDA     30,,PR1
        17 000205   000001 755111                    STA     1,X1,PR0

     1495     1702    2           PATH_LIST.BRANCH_EXHAUSTED(N)='0'B;

   1702 17 000206   200003 471500                    LDP1    @N,,AUTO
        17 000207   100000 236100                    LDQ     0,,PR1
        17 000210   000005 402007                    MPY     5,DL
        17 000211   200004 473500                    LDP3    @PATH_LIST,,AUTO
        17 000212   000000 621006                    EAX1    0,QL
        17 000213   000003 236000 18                 LDQ     3
        17 000214   300001 356111                    ANSQ    1,X1,PR3
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:224  

     1496     1703    2           END;

   1703 17 000215   000414 710000 17                 TRA     s:1752

     1497     1704    1       ELSE
     1498     1705    1           IF UWA.DB_STATUS='0502100' /* End of Set */ THEN

   1705 17 000216   040000 106500                    CMPC    fill='040'O
        17 000217   300001 000007                    ADSC9   1,,PR3                   cn=0,n=7
        17 000220   000002 000007 16                 ADSC9   2                        cn=0,n=7
        17 000221   000543 601000 17                 TNZ     BAD_FIND

     1499     1706    2           DO;

     1500     1707    2               IF PATH_LIST.REC_NO(N)=PATH_LIST.REC_NO(START_OF_BRANCH) THEN

   1707 17 000222   000000 236100                    LDQ     0,,PR0
        17 000223   000005 402007                    MPY     5,DL
        17 000224   200006 474500                    LDP4    @START_OF_BRANCH,,AUTO
        17 000225   000000 620006                    EAX0    0,QL
        17 000226   400000 236100                    LDQ     0,,PR4
        17 000227   000005 402007                    MPY     5,DL
        17 000230   100000 221110                    LDX1    0,X0,PR1
        17 000231   100000 101106                    CMPX1   0,QL,PR1
        17 000232   000235 601000 17                 TNZ     s:1716

     1501     1708    2                   PATH_LIST.BRANCH_EXHAUSTED(N)='1'B;

   1708 17 000233   020000 236003                    LDQ     8192,DU
        17 000234   100001 256110                    ORSQ    1,X0,PR1

     1502     1709         /*
     1503     1710            If rec not found is at the lambda branching point or
     1504     1711            earlier, ensure that ZII$RETRIEVE won't try to send us thru
     1505     1712            2nd or higher branches while it's traipsing down the
     1506     1713            current iteration of the path. Keeps the EVAL_PRESENCE
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:225  
     1507     1714            routine from getting confused.
     1508     1715         */
     1509     1716    2               IF N < PIVOT_REC_IDX THEN

   1716 17 000235   000000 236100                    LDQ     0,,PR0
        17 000236   000000 116000 4                  CMPQ    PIVOT_REC_IDX
        17 000237   000264 603000 17                 TRC     s:1728

     1510     1717    3               DO I = N+1 TO PATH_LIST.REC_NO(0)-1;

   1717 17 000240   000001 036007                    ADLQ    1,DL
        17 000241   200010 756100                    STQ     I,,AUTO
        17 000242   000256 710000 17                 TRA     s:1720+3

     1511     1718    3                   IF PATH_LIST.SET_NO(I) = 0 THEN

   1718 17 000243   200010 236100                    LDQ     I,,AUTO
        17 000244   000005 402007                    MPY     5,DL
        17 000245   200004 470500                    LDP0    @PATH_LIST,,AUTO
        17 000246   000000 720106                    LXL0    0,QL,PR0
        17 000247   000253 601000 17                 TNZ     s:1720

     1512     1719    3                       PATH_LIST.BRANCH_EXHAUSTED(I+1) = '1'B;

   1719 17 000250   000000 621006                    EAX1    0,QL
        17 000251   020000 236003                    LDQ     8192,DU
        17 000252   000006 256111                    ORSQ    6,X1,PR0

     1513     1720    3                   END;

   1720 17 000253   200010 235100                    LDA     I,,AUTO
        17 000254   000001 035007                    ADLA    1,DL
        17 000255   200010 755100                    STA     I,,AUTO
        17 000256   200004 470500                    LDP0    @PATH_LIST,,AUTO
        17 000257   000000 236100                    LDQ     0,,PR0
        17 000260   000022 772000                    QRL     18
        17 000261   200010 116100                    CMPQ    I,,AUTO
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:226  
        17 000262   000264 600000 17                 TZE     s:1728
        17 000263   000243 603000 17                 TRC     s:1718

     1514     1721         /*
     1515     1722            Set the find first flags. If the record not found is at
     1516     1723            the branching point or earlier, then we need to set the
     1517     1724            appropriate find first flags for all the branches.
     1518     1725            Otherwise, just set them from N+1 down to the end of the
     1519     1726            branch we're on.
     1520     1727         */
     1521     1728    2               IF N < PIVOT_REC_IDX THEN

   1728 17 000264   200003 470500                    LDP0    @N,,AUTO
        17 000265   000000 236100                    LDQ     0,,PR0
        17 000266   000000 116000 4                  CMPQ    PIVOT_REC_IDX
        17 000267   000316 603000 17                 TRC     s:1734

     1522     1729    3               DO I = N TO PATH_LIST.REC_NO(0)-1; /* all branches */

   1729 17 000270   200010 756100                    STQ     I,,AUTO
        17 000271   000307 710000 17                 TRA     s:1732+3

     1523     1730    3                   IF NOT PATH_LIST.OWN_NEXT(I) AND PATH_LIST.SET_NO(I)~=0 THEN

   1730 17 000272   200010 236100                    LDQ     I,,AUTO
        17 000273   000005 402007                    MPY     5,DL
        17 000274   200004 470500                    LDP0    @PATH_LIST,,AUTO
        17 000275   000001 234106                    SZN     1,QL,PR0
        17 000276   000304 604000 17                 TMI     s:1732
        17 000277   000000 720106                    LXL0    0,QL,PR0
        17 000300   000304 600000 17                 TZE     s:1732

     1524     1731    3                       PATH_LIST.FIND_FIRST(I+1)='1'B;

   1731 17 000301   000000 621006                    EAX1    0,QL
        17 000302   004000 236003                    LDQ     2048,DU
        17 000303   000006 256111                    ORSQ    6,X1,PR0
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:227  

     1525     1732    3                   END;

   1732 17 000304   200010 235100                    LDA     I,,AUTO
        17 000305   000001 035007                    ADLA    1,DL
        17 000306   200010 755100                    STA     I,,AUTO
        17 000307   200004 470500                    LDP0    @PATH_LIST,,AUTO
        17 000310   000000 236100                    LDQ     0,,PR0
        17 000311   000022 772000                    QRL     18
        17 000312   200010 116100                    CMPQ    I,,AUTO
        17 000313   000315 600000 17                 TZE     s:1732+9
        17 000314   000272 603000 17                 TRC     s:1730
        17 000315   000342 710000 17                 TRA     s:1741

     1526     1733    3               ELSE DO;

     1527     1734    3                   I=N;

   1734 17 000316   200010 756100                    STQ     I,,AUTO

     1528     1735    4                   DO WHILE(PATH_LIST.SET_NO(I)~=0); /* the rest of this branch */

   1735 17 000317   000005 402007                    MPY     5,DL
        17 000320   200004 471500                    LDP1    @PATH_LIST,,AUTO
        17 000321   100000 720106                    LXL0    0,QL,PR1
        17 000322   000342 600000 17                 TZE     s:1741

     1529     1736    4                       IF NOT PATH_LIST.OWN_NEXT(I) THEN

   1736 17 000323   200010 236100                    LDQ     I,,AUTO
        17 000324   000005 402007                    MPY     5,DL
        17 000325   200004 470500                    LDP0    @PATH_LIST,,AUTO
        17 000326   000001 234106                    SZN     1,QL,PR0
        17 000327   000333 604000 17                 TMI     s:1738

     1530     1737    4                           PATH_LIST.FIND_FIRST(I+1)='1'B;

PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:228  
   1737 17 000330   000000 620006                    EAX0    0,QL
        17 000331   004000 236003                    LDQ     2048,DU
        17 000332   000006 256110                    ORSQ    6,X0,PR0

     1531     1738    4                       I=I+1;

   1738 17 000333   200010 235100                    LDA     I,,AUTO
        17 000334   000001 035007                    ADLA    1,DL
        17 000335   200010 755100                    STA     I,,AUTO

     1532     1739    4                       END;

   1739 17 000336   200010 236100                    LDQ     I,,AUTO
        17 000337   000005 402007                    MPY     5,DL
        17 000340   000000 720106                    LXL0    0,QL,PR0
        17 000341   000323 601000 17                 TNZ     s:1736

     1533     1740    3                   END;

     1534     1741    2               CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,PATH_LIST.REC_NO(N+1),
              1741                        TEMP_VALUE);

   1741 17 000342   200003 470500                    LDP0    @N,,AUTO
        17 000343   000000 236100                    LDQ     0,,PR0
        17 000344   000005 402007                    MPY     5,DL
        17 000345   200011 631500                    EPPR1   TEMP_VALUE,,AUTO
        17 000346   200014 451500                    STP1    TEMP_VALUE+3,,AUTO
        17 000347   000022 736000                    QLS     18
        17 000350   000005 036003                    ADLQ    5,DU
        17 000351   200004 036100                    ADLQ    @PATH_LIST,,AUTO
        17 000352   200005 235100                    LDA     @PRESENCE_LIST,,AUTO
        17 000353   200012 757100                    STAQ    TEMP_VALUE+1,,AUTO
        17 000354   200012 630500                    EPPR0   TEMP_VALUE+1,,AUTO
        17 000355   000002 631400 18                 EPPR1   2
        17 000356   000000 701000 xent               TSX1    ZII$FIND_PRESENCE_IDX
        17 000357   000000 011000                    NOP     0

PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:229  
     1535     1742    2               PRESENCE_LIST.P_VALUE(TEMP_VALUE)=0;

   1742 17 000360   200011 235100                    LDA     TEMP_VALUE,,AUTO
        17 000361   000001 735000                    ALS     1
        17 000362   000000 220003                    LDX0    0,DU
        17 000363   200005 470500                    LDP0    @PRESENCE_LIST,,AUTO
        17 000364   000000 440105                    SXL0    0,AL,PR0

     1536     1743    2               GEN_CODE_EPTR=PATH_LIST.INIT_EPTR(N+1);

   1743 17 000365   200003 471500                    LDP1    @N,,AUTO
        17 000366   100000 236100                    LDQ     0,,PR1
        17 000367   000005 402007                    MPY     5,DL
        17 000370   200004 473500                    LDP3    @PATH_LIST,,AUTO
        17 000371   300007 236106                    LDQ     7,QL,PR3
        17 000372   000000 756000 5                  STQ     GEN_CODE_EPTR

     1537     1744    2               CALL GEN_CODE_EPTR ALTRET(BAD_INIT);

   1744 17 000373   000000 221000 5                  LDX1    GEN_CODE_EPTR
        17 000374   000000 631400 18                 EPPR1   0
        17 000375   000000 701011                    TSX1    0,X1
        17 000376   000553 702000 17                 TSX2    BAD_INIT

     1538     1745    2               GEN_CODE_EPTR = PATH_LIST.CONSTRAINT_EPTR(N+1);

   1745 17 000377   200003 470500                    LDP0    @N,,AUTO
        17 000400   000000 236100                    LDQ     0,,PR0
        17 000401   000005 402007                    MPY     5,DL
        17 000402   200004 471500                    LDP1    @PATH_LIST,,AUTO
        17 000403   100011 236106                    LDQ     9,QL,PR1
        17 000404   000000 756000 5                  STQ     GEN_CODE_EPTR

     1539     1746    2               IF GEN_CODE_EPTR ~= ENTADDR(NIL) THEN

   1746 17 000405   000000 116000 18                 CMPQ    0
        17 000406   000413 600000 17                 TZE     s:1748
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:230  

     1540     1747    2                   CALL GEN_CODE_EPTR ALTRET(CONSTLBL);

   1747 17 000407   000000 220000 5                  LDX0    GEN_CODE_EPTR
        17 000410   000000 631400 18                 EPPR1   0
        17 000411   000000 701010                    TSX1    0,X0
        17 000412   000512 702000 17                 TSX2    CONSTLBL

     1541     1748    2               GOTO UNWINDLBL;

   1748 17 000413   000503 710000 17                 TRA     UNWINDLBL

     1542     1749    2               END;
     1543     1750    1           ELSE
     1544     1751    1               GOTO BAD_FIND;
     1545     1752    1       IF PATH_LIST.GET_IND(N) THEN

   1752 17 000414   100000 236100                    LDQ     0,,PR1
        17 000415   000005 402007                    MPY     5,DL
        17 000416   300001 236106                    LDQ     1,QL,PR3
        17 000417   200000 316003                    CANQ    65536,DU
        17 000420   000475 600000 17                 TZE     s:1768

     1546     1753    2       DO;

     1547     1754    2           ZII$PARAMS='0'B;

   1754 17 000421   000000 100400                    MLR     fill='000'O
        17 000422   000000 000001 18                 ADSC9   0                        cn=0,n=1
        17 000423   000000 000124 xsym               ADSC9   ZII$PARAMS               cn=0,n=84

     1548     1755    2           CALL ZII$GET ALTRET(BAD_GET);

   1755 17 000424   000000 631400 18                 EPPR1   0
        17 000425   000000 701000 xent               TSX1    ZII$GET
        17 000426   000547 702000 17                 TSX2    BAD_GET

PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:231  
     1549     1756    2           IF UWA.DB_STATUS~='0000000' THEN

   1756 17 000427   000000 470400 10                 LDP0    UWA$
        17 000430   040000 106500                    CMPC    fill='040'O
        17 000431   000001 000007                    ADSC9   1,,PR0                   cn=0,n=7
        17 000432   000000 000007 16                 ADSC9   0                        cn=0,n=7
        17 000433   000447 600000 17                 TZE     s:1762

     1550     1757    3           DO;

     1551     1758    3               GEN_CODE_EPTR=PATH_LIST.INIT_EPTR(N);

   1758 17 000434   200003 471500                    LDP1    @N,,AUTO
        17 000435   100000 236100                    LDQ     0,,PR1
        17 000436   000005 402007                    MPY     5,DL
        17 000437   200004 473500                    LDP3    @PATH_LIST,,AUTO
        17 000440   300002 236106                    LDQ     2,QL,PR3
        17 000441   000000 756000 5                  STQ     GEN_CODE_EPTR

     1552     1759    3               CALL GEN_CODE_EPTR;

   1759 17 000442   000000 220000 5                  LDX0    GEN_CODE_EPTR
        17 000443   000000 631400 18                 EPPR1   0
        17 000444   000000 701010                    TSX1    0,X0
        17 000445   000000 011000                    NOP     0

     1553     1760    3               GOTO BAD_GET;

   1760 17 000446   000547 710000 17                 TRA     BAD_GET

     1554     1761    3               END;
     1555     1762    2           GEN_CODE_EPTR=PATH_LIST.CONVERT_EPTR(N);

   1762 17 000447   200003 471500                    LDP1    @N,,AUTO
        17 000450   100000 236100                    LDQ     0,,PR1
        17 000451   000005 402007                    MPY     5,DL
        17 000452   200004 473500                    LDP3    @PATH_LIST,,AUTO
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:232  
        17 000453   300003 236106                    LDQ     3,QL,PR3
        17 000454   000000 756000 5                  STQ     GEN_CODE_EPTR

     1556     1763    2           CALL GEN_CODE_EPTR;

   1763 17 000455   000000 220000 5                  LDX0    GEN_CODE_EPTR
        17 000456   000000 631400 18                 EPPR1   0
        17 000457   000000 701010                    TSX1    0,X0
        17 000460   000000 011000                    NOP     0

     1557     1764    2           GEN_CODE_EPTR=PATH_LIST.CONSTRAINT_EPTR(N);

   1764 17 000461   200003 470500                    LDP0    @N,,AUTO
        17 000462   000000 236100                    LDQ     0,,PR0
        17 000463   000005 402007                    MPY     5,DL
        17 000464   200004 471500                    LDP1    @PATH_LIST,,AUTO
        17 000465   100004 236106                    LDQ     4,QL,PR1
        17 000466   000000 756000 5                  STQ     GEN_CODE_EPTR

     1558     1765    2           IF GEN_CODE_EPTR~=ENTADDR(NIL) THEN

   1765 17 000467   000000 116000 18                 CMPQ    0
        17 000470   000475 600000 17                 TZE     s:1768

     1559     1766    2               CALL GEN_CODE_EPTR ALTRET(CONSTLBL);

   1766 17 000471   000000 220000 5                  LDX0    GEN_CODE_EPTR
        17 000472   000000 631400 18                 EPPR1   0
        17 000473   000000 701010                    TSX1    0,X0
        17 000474   000512 702000 17                 TSX2    CONSTLBL

     1560     1767    2           END;

     1561     1768    1       IF PATH_LIST.SET_NO(N)=0 THEN /* at end of this branch */

   1768 17 000475   200003 470500                    LDP0    @N,,AUTO
        17 000476   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:233  
        17 000477   000005 402007                    MPY     5,DL
        17 000500   200004 471500                    LDP1    @PATH_LIST,,AUTO
        17 000501   100000 720106                    LXL0    0,QL,PR1
        17 000502   000506 601000 17                 TNZ     s:1771

     1562     1769    1   UNWINDLBL: UNWIND TO RETRIEVE_RETURN;

   1769 17 000503   000000 237200 1     UNWINDLBL    LDAQ  ! RETRIEVE_RETURN
        17 000504   000000 700200 xent               TSX0  ! X66_AUNWIND
        17 000505   000000 000200                    ZERO    0,128

     1563     1770         /* Otherwise, keep recursing down this branch. */
     1564     1771    1       CALL ZII$RECURSE(N,PATH_LIST,PRESENCE_LIST,START_OF_BRANCH,STATUS_CODE);

   1771 17 000506   200003 630500                    EPPR0   @N,,AUTO
        17 000507   000004 631400 18                 EPPR1   4
        17 000510   000000 701000 17                 TSX1    s:174
        17 000511   000000 011000                    NOP     0

     1565     1772    1   CONSTLBL: IF PATH_LIST.SET_NO(N)~=0 THEN

   1772 17 000512   200003 470500       CONSTLBL     LDP0    @N,,AUTO
        17 000513   000000 236100                    LDQ     0,,PR0
        17 000514   000005 402007                    MPY     5,DL
        17 000515   200004 471500                    LDP1    @PATH_LIST,,AUTO
        17 000516   100000 720106                    LXL0    0,QL,PR1
        17 000517   000540 600000 17                 TZE     s:1777

     1566     1773    2       DO;

     1567     1774    2           CALL ZII$FIND_PRESENCE_IDX(PRESENCE_LIST,PATH_LIST.REC_NO(N+1),TEMP_VALUE);

   1774 17 000520   200011 633500                    EPPR3   TEMP_VALUE,,AUTO
        17 000521   200014 453500                    STP3    TEMP_VALUE+3,,AUTO
        17 000522   000022 736000                    QLS     18
        17 000523   000005 036003                    ADLQ    5,DU
        17 000524   200004 036100                    ADLQ    @PATH_LIST,,AUTO
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:234  
        17 000525   200005 235100                    LDA     @PRESENCE_LIST,,AUTO
        17 000526   200012 757100                    STAQ    TEMP_VALUE+1,,AUTO
        17 000527   200012 630500                    EPPR0   TEMP_VALUE+1,,AUTO
        17 000530   000002 631400 18                 EPPR1   2
        17 000531   000000 701000 xent               TSX1    ZII$FIND_PRESENCE_IDX
        17 000532   000000 011000                    NOP     0

     1568     1775    2           PRESENCE_LIST.P_VALUE(TEMP_VALUE) = 0;

   1775 17 000533   200011 235100                    LDA     TEMP_VALUE,,AUTO
        17 000534   000001 735000                    ALS     1
        17 000535   000000 220003                    LDX0    0,DU
        17 000536   200005 470500                    LDP0    @PRESENCE_LIST,,AUTO
        17 000537   000000 440105                    SXL0    0,AL,PR0

     1569     1776    2           END;

     1570     1777    1       CONSTRAINT_FAILED = '1'B;

   1777 17 000540   400000 236003                    LDQ     -131072,DU
        17 000541   000000 756000 3                  STQ     CONSTRAINT_FAILED

     1571     1778    1       GOTO UNWINDLBL;

   1778 17 000542   000503 710000 17                 TRA     UNWINDLBL

     1572     1779    1   BAD_FIND:
     1573     1780    1       STATUS_CODE=%ZII_BAD_FIND;

   1780 17 000543   013564 235007       BAD_FIND     LDA     6004,DL
        17 000544   200007 470500                    LDP0    @STATUS_CODE,,AUTO
        17 000545   000000 755100                    STA     0,,PR0

     1574     1781    1       ALTRETURN;

   1781 17 000546   000000 702200 xent               TSX2  ! X66_AALT

PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:235  
     1575     1782    1   BAD_GET:
     1576     1783    1       STATUS_CODE=%ZII_BAD_GET;

   1783 17 000547   013565 235007       BAD_GET      LDA     6005,DL
        17 000550   200007 470500                    LDP0    @STATUS_CODE,,AUTO
        17 000551   000000 755100                    STA     0,,PR0

     1577     1784    1       ALTRETURN;

   1784 17 000552   000000 702200 xent               TSX2  ! X66_AALT

     1578     1785    1   BAD_INIT:
     1579     1786    1       CALL M$ERR;

   1786 17 000553   000002 713400       BAD_INIT     CLIMB   err
        17 000554   000000 401760                    pmme    nvectors=0

     1580     1787    1   END ZII$RECURSE;

   1787 17 000555   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
  16     000   060060 060060   060060 060040   060065 060062   061060 060040    0000000 0502100

(unnamed)
 Sect OctLoc
  18     000   000000 000000   773777 777777   000003 000000   757777 777777    ................
  18     004   000005 000000                                                    ....
     1581     1788        %EOD;

PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:236  
--  Include file information  --

   ZI_IDPERR_SUBS.:ZIC0TOU  is referenced.
   ZI$TOP_STRUCTS.:ZIC0TOU  is referenced.
   ZI$PATH_STRUCTS.:ZIC0TOU  is referenced.
   ZI$DESC.:ZIC0TOU  is referenced.
   ZI$STRUCTS.:ZIC0TOU  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZII$RECURSE.

   Procedure ZII$RECURSE requires 366 words for executable code.
   Procedure ZII$RECURSE requires 14 words of local(AUTO) storage.
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:237  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:238  
          MINI XREF LISTING

BAD_FIND
      1780**LABEL    1677--CALLALT  1679--GOTO     1694--CALLALT  1751--GOTO
BAD_GET
      1783**LABEL    1755--CALLALT  1760--GOTO
BAD_INIT
      1786**LABEL    1744--CALLALT
CONSTLBL
      1772**LABEL    1747--CALLALT  1766--CALLALT
CONSTRAINT_FAILED
       191**DCL      1777<<ASSIGN
DR$
      1294**DCL      1295--IMP-PTR  1662<<ASSIGN   1668>>ASSIGN   1676>>ASSIGN   1683>>ASSIGN
DS$
      1252**DCL      1253--IMP-PTR  1663<<ASSIGN   1670>>ASSIGN   1684>>ASSIGN   1691<<ASSIGN   1692>>ASSIGN
GEN_CODE_EPTR
       194**DCL      1743<<ASSIGN   1744>>CALL     1745<<ASSIGN   1746>>IF       1747>>CALL     1758<<ASSIGN
      1759>>CALL     1762<<ASSIGN   1763>>CALL     1764<<ASSIGN   1765>>IF       1766>>CALL
I
       184**DCL      1717<<DOINDEX  1718>>IF       1719>>ASSIGN   1729<<DOINDEX  1730>>IF       1730>>IF
      1731>>ASSIGN   1734<<ASSIGN   1735>>DOWHILE  1736>>IF       1737>>ASSIGN   1738<<ASSIGN   1738>>ASSIGN
M$ERR
       217**DCL-ENT  1786--CALL
N
       175**DCL       174--PROC     1660>>IF       1662>>ASSIGN   1663>>ASSIGN   1664>>IF       1671>>ASSIGN
      1691>>ASSIGN   1695>>ASSIGN   1698<<ASSIGN   1698>>ASSIGN   1699>>CALL     1702>>ASSIGN   1707>>IF
      1708>>ASSIGN   1716>>IF       1717>>DOINDEX  1728>>IF       1729>>DOINDEX  1734>>ASSIGN   1741>>CALL
      1743>>ASSIGN   1745>>ASSIGN   1752>>IF       1758>>ASSIGN   1762>>ASSIGN   1764>>ASSIGN   1768>>IF
      1771<>CALL     1772>>IF       1774>>CALL
NAM1.DESC$
       376**DCL      1662>>ASSIGN   1663>>ASSIGN   1691>>ASSIGN
NAM1$
       358**DCL       361--IMP-PTR  1662>>ASSIGN   1663>>ASSIGN   1691>>ASSIGN
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:239  
PATH_LIST
      1513**DCL       174--PROC     1771<>CALL
PATH_LIST.BRANCH_EXHAUSTED
      1529**DCL      1702<<ASSIGN   1708<<ASSIGN   1719<<ASSIGN
PATH_LIST.CONSTRAINT_EPTR
      1549**DCL      1745>>ASSIGN   1764>>ASSIGN
PATH_LIST.CONVERT_EPTR
      1546**DCL      1762>>ASSIGN
PATH_LIST.FIND_ATTEMPTED
      1520**DCL      1695<<ASSIGN
PATH_LIST.FIND_FIRST
      1535**DCL      1664>>IF       1671<<ASSIGN   1731<<ASSIGN   1737<<ASSIGN
PATH_LIST.GET_IND
      1518**DCL      1752>>IF
PATH_LIST.INIT_EPTR
      1544**DCL      1743>>ASSIGN   1758>>ASSIGN
PATH_LIST.OWN_NEXT
      1516**DCL      1660>>IF       1730>>IF       1736>>IF
PATH_LIST.REC_NO
      1514**DCL      1662>>ASSIGN   1699<>CALL     1707>>IF       1707>>IF       1717>>DOINDEX  1729>>DOINDEX
      1741<>CALL     1774<>CALL
PATH_LIST.SET_NO
      1515**DCL      1663>>ASSIGN   1691>>ASSIGN   1718>>IF       1730>>IF       1735>>DOWHILE  1768>>IF
      1772>>IF
PIVOT_REC_IDX
       193**DCL      1716>>IF       1728>>IF
PRESENCE_LIST
       186**DCL       174--PROC     1699<>CALL     1741<>CALL     1771<>CALL     1774<>CALL
PRESENCE_LIST.DB_KEY_SAVE
       189**DCL      1701<<ASSIGN
PRESENCE_LIST.P_VALUE
       188**DCL      1700<<ASSIGN   1742<<ASSIGN   1775<<ASSIGN
RECORD.FLAG_BITS
      1299**DCL      1300--REDEF
RECORD.RVA_OFF
      1297**DCL      1668>>ASSIGN   1676>>ASSIGN   1683>>ASSIGN
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:240  
RETRIEVE_RETURN
       183**DCL      1769>>UNWIND
SET.FLAG_BITS
      1258**DCL      1259--REDEF
SET.RVA_OFF
      1255**DCL      1670>>ASSIGN   1684>>ASSIGN   1692>>ASSIGN
START_OF_BRANCH
       176**DCL       174--PROC     1707>>IF       1771<>CALL
STATUS_CODE
       177**DCL       174--PROC     1658<<ASSIGN   1771<>CALL     1780<<ASSIGN   1783<<ASSIGN
TEMP_VALUE
       192**DCL      1699<>CALL     1700>>ASSIGN   1701>>ASSIGN   1741<>CALL     1742>>ASSIGN   1774<>CALL
      1775>>ASSIGN
UNWINDLBL
      1769**LABEL    1748--GOTO     1778--GOTO
UWA.DB_STATUS
       384**DCL      1678>>IF       1696>>IF       1705>>IF       1756>>IF
UWA.DIRECT_REFERENCE
       393**DCL      1701>>ASSIGN
UWA#
       381**DCL       399--IMP-SIZ
UWA$
       379**DCL       382--IMP-PTR  1678>>IF       1696>>IF       1701>>ASSIGN   1705>>IF       1756>>IF
ZII$FIND
      1653**DCL-ENT  1677--CALL     1694--CALL
ZII$FIND_PRESENCE_IDX
      1656**DCL-ENT  1699--CALL     1741--CALL     1774--CALL
ZII$GET
      1654**DCL-ENT  1755--CALL
ZII$PARAMS
       178**DCL      1659<<ASSIGN   1680<<ASSIGN   1754<<ASSIGN
ZII$PARAMS.L_HALF
       179**DCL      1668<<ASSIGN   1670<<ASSIGN   1676<<ASSIGN   1683<<ASSIGN   1684<<ASSIGN   1692<<ASSIGN
ZII$PARAMS.R_HALF
       180**DCL      1666<<ASSIGN   1667<<ASSIGN   1669<<ASSIGN   1674<<ASSIGN   1675<<ASSIGN   1681<<ASSIGN
      1682<<ASSIGN   1689<<ASSIGN   1690<<ASSIGN
PL6.E3A0      #003=ZII$RECURSE File=ZII$RET_LIB.:ZIC0TSI                         FRI 09/05/97 12:31 Page:241  
ZII$RECURSE
       174**PROC     1771--CALL

PL6.E3A0      #004=ZII$CLR_PARAMS File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:242  
     1582        1        /*T***********************************************************/
     1583        2        /*T*                                                         */
     1584        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1585        4        /*T*                                                         */
     1586        5        /*T***********************************************************/
     1587        6        ZII$CLR_PARAMS: PROC;
     1588        7    1   DCL 1 ZII$PARAMS (0:20) SYMREF,
     1589        8    1         2 L_HALF UBIN(18) UNAL,
     1590        9    1         2 R_HALF UBIN(18) UNAL;
     1591       10    1   DCL N UBIN AUTO;
     1592       11        /**/
     1593       12    1       N=0;
     1594       13    2       DO WHILE (N<=20);
     1595       14    2           ZII$PARAMS.L_HALF(N)=0;
     1596       15    2           ZII$PARAMS.R_HALF(N)=0;
     1597       16    2           N=N+1;
     1598       17    2           END;
     1599       18    1       RETURN;
     1600       19    1   END ZII$CLR_PARAMS;
     1601       20        %EOD;

PL6.E3A0      #004=ZII$CLR_PARAMS File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:243  
--  Include file information  --

   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure ZII$CLR_PARAMS.

   Procedure ZII$CLR_PARAMS requires 16 words for executable code.
   Procedure ZII$CLR_PARAMS requires 4 words of local(AUTO) storage.

PL6.E3A0      #004=ZII$CLR_PARAMS File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:244  

 Object Unit name= ZII$CLR_PARAMS                             File name= ZII$RET_LIB.:ZIC0TOU
 UTS= SEP 05 '97 12:31:45.32 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    16     20  ZII$CLR_PARAMS

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        0  ZII$CLR_PARAMS

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ZII$PARAMS
PL6.E3A0      #004=ZII$CLR_PARAMS File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:245  


     1582        1        /*T***********************************************************/
     1583        2        /*T*                                                         */
     1584        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1585        4        /*T*                                                         */
     1586        5        /*T***********************************************************/
     1587        6        ZII$CLR_PARAMS: PROC;

      6  0 000000   000000 700200 xent  ZII$CLR_PAR* TSX0  ! X66_AUTO_0
         0 000001   000004 000000                    ZERO    4,0

     1588        7    1   DCL 1 ZII$PARAMS (0:20) SYMREF,
     1589        8    1         2 L_HALF UBIN(18) UNAL,
     1590        9    1         2 R_HALF UBIN(18) UNAL;
     1591       10    1   DCL N UBIN AUTO;
     1592       11        /**/
     1593       12    1       N=0;

     12  0 000002   200003 450100                    STZ     N,,AUTO

     1594       13    2       DO WHILE (N<=20);

     13  0 000003   200003 235100                    LDA     N,,AUTO
         0 000004   000025 115007                    CMPA    21,DL
         0 000005   000017 603000 0                  TRC     s:18

     1595       14    2           ZII$PARAMS.L_HALF(N)=0;

     14  0 000006   000000 220003                    LDX0    0,DU
         0 000007   200003 721100                    LXL1    N,,AUTO
         0 000010   000000 740011 xsym               STX0    ZII$PARAMS,X1

     1596       15    2           ZII$PARAMS.R_HALF(N)=0;

     15  0 000011   000000 440011 xsym               SXL0    ZII$PARAMS,X1

     1597       16    2           N=N+1;
PL6.E3A0      #004=ZII$CLR_PARAMS File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:246  

     16  0 000012   200003 235100                    LDA     N,,AUTO
         0 000013   000001 035007                    ADLA    1,DL
         0 000014   200003 755100                    STA     N,,AUTO

     1598       17    2           END;

     17  0 000015   000025 115007                    CMPA    21,DL
         0 000016   000006 602000 0                  TNC     s:14

     1599       18    1       RETURN;

     18  0 000017   000000 702200 xent               TSX2  ! X66_ARET
     1600       19    1   END ZII$CLR_PARAMS;
     1601       20        %EOD;

PL6.E3A0      #004=ZII$CLR_PARAMS File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:247  
--  Include file information  --

   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure ZII$CLR_PARAMS.

   Procedure ZII$CLR_PARAMS requires 16 words for executable code.
   Procedure ZII$CLR_PARAMS requires 4 words of local(AUTO) storage.
PL6.E3A0      #004=ZII$CLR_PARAMS File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:248  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=ZII$CLR_PARAMS File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:249  
          MINI XREF LISTING

N
        10**DCL        12<<ASSIGN     13>>DOWHILE    14>>ASSIGN     15>>ASSIGN     16<<ASSIGN     16>>ASSIGN
ZII$PARAMS.L_HALF
         8**DCL        14<<ASSIGN
ZII$PARAMS.R_HALF
         9**DCL        15<<ASSIGN

PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:250  
     1602        1        /*M* ZII$FIND_FIRST Find the "first" record using some alternate key          */
     1603        2        /*T***********************************************************/
     1604        3        /*T*                                                         */
     1605        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1606        5        /*T*                                                         */
     1607        6        /*T***********************************************************/
     1608        7        ZII$FIND_FIRST: PROC(ACCESS_LIST) ALTRET;
     1609        8
     1610        9        %INCLUDE ZI$DESC;
     1611      859        %INCLUDE ZI$PATH_STRUCTS;
     1612      997        %INCLUDE ZI$STRUCTS;
     1613     1069
     1614     1070        %ACCESS_DESC(STCLASS=" ");
     1615     1109
     1616     1110        %NAM1;
     1617     1139        %NAM2;
     1618     1153        %UWA1;
     1619     1176
     1620     1177        %DSC_REC(STCLASS=" ");
     1621     1211        %DSC_RFK(STCLASS=" ");
     1622     1227        %DSC_FLD(STCLASS=" ");
     1623     1342
     1624     1343    1   DCL ZII$FIND1ST_MOVE_Z ENTRY;
     1625     1344    1   DCL ZII$FIND1ST_MOVE_4UN ENTRY;
     1626     1345    1   DCL ZII$FIND1ST_MOVE_4LS ENTRY;
     1627     1346    1   DCL ZII$FIND1ST_MOVE_4TS ENTRY;
     1628     1347    1   DCL ZII$FIND1ST_MOVE_9UN ENTRY;
     1629     1348    1   DCL ZII$FIND1ST_MOVE_9LS ENTRY;
     1630     1349    1   DCL ZII$FIND1ST_MOVE_9TS ENTRY;
     1631     1350
     1632     1351    1   DCL ZII_FIND1ST_MOVE_PTR$ PTR SYMREF;
     1633     1352    1   DCL ZII_FIND1ST_MOVE_OFF UBIN SYMREF;
     1634     1353    1   DCL ZII_FIND1ST_MOVE_LEN UBIN SYMREF;
     1635     1354
     1636     1355
     1637     1356
     1638     1357         /*
PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:251  
     1639     1358            Use the NAM1 indices ACCESS_LIST.PORT and ACCESS_LIST.PORT_KEY to
     1640     1359            set DF$ to the key field control item for this combination of
     1641     1360            record and field.
     1642     1361         */
     1643     1362
     1644     1363    1       DRFK$ = NAM1.DESC$(ACCESS_LIST.PORT)->RECORD.RFK_DSC$;
     1645     1364    2       DO WHILE(DRFK$ ~= ADDR(NIL));
     1646     1365    3           IF ACCESS_LIST.PORT_KEY = RFK_DSC.KEY_IDX THEN DO;
     1647     1366    3               DF$ = NAM1.DESC$(RFK_DSC.FLD$->RFK_DSC.FLD_IDX);
     1648     1367    3               GOTO DO_THE_FIND_FIRST;
     1649     1368    3               END;
     1650     1369    2           DRFK$ = RFK_DSC.REC$;
     1651     1370    2           END;
     1652     1371    1       ALTRETURN;
     1653     1372
     1654     1373    1   DO_THE_FIND_FIRST: ;
     1655     1374         /*
     1656     1375            ZII_FIND1ST_MOVE_PTR$ points to the start of the UWA.
     1657     1376            ZII_FIND1ST_MOVE_OFF is computed from FIELD.UWA_OFF and is the
     1658     1377            digit offset (4 or 9-bit as appropriate) to the key field.
     1659     1378            ZII_FIND1ST_MOVE_LEN is the digit length of the key field.
     1660     1379         */
     1661     1380
     1662     1381    1       ZII_FIND1ST_MOVE_PTR$ = UWA$;
     1663     1382    1       ZII_FIND1ST_MOVE_OFF = FIELD.UWA_OFF;
     1664     1383    1       ZII_FIND1ST_MOVE_LEN = FIELD.EIS_BITS.NDSC.N;
     1665     1384
     1666     1385    2       DO CASE(FIELD.FLAGS_2.DATA_TYPE);
     1667     1386    2       CASE(#FDT_CHAR);
     1668     1387    2           ZII_FIND1ST_MOVE_LEN = FIELD.EIS_BITS.ADSC.N;
     1669     1388    2           IF FIELD.FLAGS_2.BYT_NIB THEN
     1670     1389    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF / 2;
     1671     1390    2           CALL ZII$FIND1ST_MOVE_Z;
     1672     1391    2       CASE(#FDT_DBK,#FDT_INTEGER,#FDT_CMP2,#FDT_FLT_SINGLE);
     1673     1392    2           ZII_FIND1ST_MOVE_LEN = 4;
     1674     1393    2           IF FIELD.FLAGS_2.BYT_NIB THEN
     1675     1394    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF / 2;
PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:252  
     1676     1395    2           CALL ZII$FIND1ST_MOVE_Z;
     1677     1396    2       CASE(#FDT_CMP_UNSIGN);
     1678     1397    2           IF NOT FIELD.FLAGS_2.BYT_NIB THEN
     1679     1398    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF * 2;
     1680     1399    2           CALL ZII$FIND1ST_MOVE_4UN;
     1681     1400    2       CASE(#FDT_CMP_SIGN,#FDT_CMP3_SIGN);
     1682     1401    2           IF NOT FIELD.FLAGS_2.BYT_NIB THEN
     1683     1402    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF * 2;
     1684     1403    2           IF FIELD.EIS_BITS.NDSC.S = '01'B THEN
     1685     1404    2               CALL ZII$FIND1ST_MOVE_4LS;
     1686     1405    2           ELSE
     1687     1406    2               CALL ZII$FIND1ST_MOVE_4TS;
     1688     1407    2       CASE(#FDT_DISP_NUM,#FDT_DISP_NUM010,#FDT_DISP_NUM001);
     1689     1408    2           IF FIELD.FLAGS_2.BYT_NIB THEN
     1690     1409    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF / 2;
     1691     1410    2           CALL ZII$FIND1ST_MOVE_9UN;
     1692     1411    2       CASE(#FDT_DISP_NUM100);
     1693     1412    2           IF FIELD.FLAGS_2.BYT_NIB THEN
     1694     1413    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF / 2;
     1695     1414    2           CALL ZII$FIND1ST_MOVE_9LS;
     1696     1415    2       CASE(#FDT_DISP_NUM011);
     1697     1416    2           IF FIELD.FLAGS_2.BYT_NIB THEN
     1698     1417    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF / 2;
     1699     1418    2           CALL ZII$FIND1ST_MOVE_9TS;
     1700     1419    2       CASE(#FDT_CMP1);
     1701     1420    2           ZII_FIND1ST_MOVE_LEN = 2;
     1702     1421    2           IF FIELD.FLAGS_2.BYT_NIB THEN
     1703     1422    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF / 2;
     1704     1423    2           CALL ZII$FIND1ST_MOVE_Z;
     1705     1424    2       CASE(#FDT_FLT_DOUBLE,#FDT_CMPLX_SINGLE);
     1706     1425    2           ZII_FIND1ST_MOVE_LEN = 8;
     1707     1426    2           IF FIELD.FLAGS_2.BYT_NIB THEN
     1708     1427    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF / 2;
     1709     1428    2           CALL ZII$FIND1ST_MOVE_Z;
     1710     1429    2       CASE(#FDT_CMPLX_DOUBLE);
     1711     1430    2           ZII_FIND1ST_MOVE_LEN = 16;
     1712     1431    2           IF FIELD.FLAGS_2.BYT_NIB THEN
PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:253  
     1713     1432    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF / 2;
     1714     1433    2           CALL ZII$FIND1ST_MOVE_Z;
     1715     1434    2       CASE(#FDT_LOGICAL);
     1716     1435    2           ZII_FIND1ST_MOVE_LEN = 1;
     1717     1436    2           IF FIELD.FLAGS_2.BYT_NIB THEN
     1718     1437    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF / 2;
     1719     1438    2           CALL ZII$FIND1ST_MOVE_Z;
     1720     1439    2       CASE(ELSE);
     1721     1440    2           ALTRETURN;
     1722     1441    2           END; /* Do Case(FIELD.FLAGS_2.DATA_TYPE) */
     1723     1442         /*
     1724     1443            At this point an appropriate zero has been moved into the
     1725     1444            appropriate key item and I'm going to turn this all over to
     1726     1445            Mark Quinty.
     1727     1446         */
     1728     1447    1   END;

PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:254  
--  Include file information  --

   ZI$STRUCTS.:ZIC0TOU  is referenced.
   ZI$PATH_STRUCTS.:ZIC0TOU  is referenced.
   ZI$DESC.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure ZII$FIND_FIRST.

   Procedure ZII$FIND_FIRST requires 184 words for executable code.
   Procedure ZII$FIND_FIRST requires 8 words of local(AUTO) storage.

    No errors detected in file ZII$RET_LIB.:ZIC0TSI    .

PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:255  

 Object Unit name= ZII$FIND_FIRST                             File name= ZII$RET_LIB.:ZIC0TOU
 UTS= SEP 05 '97 12:31:46.72 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  LblCom even  none     1      1  NAM1$
    1  LblCom even  none     1      1  NAM1_SIZ
    2  LblCom even  none     1      1  NAM1_IDX
    3  LblCom even  none     1      1  NAM2$
    4  LblCom even  none     1      1  NAM2_SIZ
    5  LblCom even  none     1      1  DESC#
    6  LblCom even  none     1      1  UWA$
    7  LblCom even  none     1      1  UWA_SIZ
    8  LblCom even  none     1      1  UWA#
    9   Proc  even  none   184    270  ZII$FIND_FIRST
   10  RoData even  none     2      2  ZII$FIND_FIRST

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     9      0   yes    yes     yes      Std        1  ZII$FIND_FIRST
PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:256  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 ZII$FIND1ST_MOVE_Z
         yes           Std       0 ZII$FIND1ST_MOVE_4UN
         yes           Std       0 ZII$FIND1ST_MOVE_4LS
         yes           Std       0 ZII$FIND1ST_MOVE_4TS
         yes           Std       0 ZII$FIND1ST_MOVE_9UN
         yes           Std       0 ZII$FIND1ST_MOVE_9TS
         yes           Std       0 ZII$FIND1ST_MOVE_9LS
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ZII_FIND1ST_MOVE_PTR$                 ZII_FIND1ST_MOVE_OFF                  ZII_FIND1ST_MOVE_LEN

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID
PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:257  


     1602        1        /*M* ZII$FIND_FIRST Find the "first" record using some alternate key          */
     1603        2        /*T***********************************************************/
     1604        3        /*T*                                                         */
     1605        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1606        5        /*T*                                                         */
     1607        6        /*T***********************************************************/
     1608        7        ZII$FIND_FIRST: PROC(ACCESS_LIST) ALTRET;

      7  9 000000   000000 700200 xent  ZII$FIND_FI* TSX0  ! X66_AUTO_1
         9 000001   000010 000001                    ZERO    8,1

     1609        8
     1610        9        %INCLUDE ZI$DESC;
     1611      859        %INCLUDE ZI$PATH_STRUCTS;
     1612      997        %INCLUDE ZI$STRUCTS;
     1613     1069
     1614     1070        %ACCESS_DESC(STCLASS=" ");
     1615     1109
     1616     1110        %NAM1;
     1617     1139        %NAM2;
     1618     1153        %UWA1;
     1619     1176
     1620     1177        %DSC_REC(STCLASS=" ");
     1621     1211        %DSC_RFK(STCLASS=" ");
     1622     1227        %DSC_FLD(STCLASS=" ");
     1623     1342
     1624     1343    1   DCL ZII$FIND1ST_MOVE_Z ENTRY;
     1625     1344    1   DCL ZII$FIND1ST_MOVE_4UN ENTRY;
     1626     1345    1   DCL ZII$FIND1ST_MOVE_4LS ENTRY;
     1627     1346    1   DCL ZII$FIND1ST_MOVE_4TS ENTRY;
     1628     1347    1   DCL ZII$FIND1ST_MOVE_9UN ENTRY;
     1629     1348    1   DCL ZII$FIND1ST_MOVE_9LS ENTRY;
     1630     1349    1   DCL ZII$FIND1ST_MOVE_9TS ENTRY;
     1631     1350
     1632     1351    1   DCL ZII_FIND1ST_MOVE_PTR$ PTR SYMREF;
     1633     1352    1   DCL ZII_FIND1ST_MOVE_OFF UBIN SYMREF;
PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:258  
     1634     1353    1   DCL ZII_FIND1ST_MOVE_LEN UBIN SYMREF;
     1635     1354
     1636     1355
     1637     1356
     1638     1357         /*
     1639     1358            Use the NAM1 indices ACCESS_LIST.PORT and ACCESS_LIST.PORT_KEY to
     1640     1359            set DF$ to the key field control item for this combination of
     1641     1360            record and field.
     1642     1361         */
     1643     1362
     1644     1363    1       DRFK$ = NAM1.DESC$(ACCESS_LIST.PORT)->RECORD.RFK_DSC$;

   1363  9 000002   200003 470500                    LDP0    @ACCESS_LIST,,AUTO
         9 000003   000000 236100                    LDQ     0,,PR0
         9 000004   000022 772000                    QRL     18
         9 000005   000012 402007                    MPY     10,DL
         9 000006   000000 471400 0                  LDP1    NAM1$
         9 000007   100011 473506                    LDP3    9,QL,PR1
         9 000010   300007 236100                    LDQ     7,,PR3
         9 000011   200005 756100                    STQ     DRFK$,,AUTO

     1645     1364    2       DO WHILE(DRFK$ ~= ADDR(NIL));

   1364  9 000012   000033 710000 9                  TRA     s:1370

     1646     1365    3           IF ACCESS_LIST.PORT_KEY = RFK_DSC.KEY_IDX THEN DO;

   1365  9 000013   200005 470500                    LDP0    DRFK$,,AUTO
         9 000014   200003 471500                    LDP1    @ACCESS_LIST,,AUTO
         9 000015   100000 236100                    LDQ     0,,PR1
         9 000016   000000 676100                    ERQ     0,,PR0
         9 000017   777777 376007                    ANQ     -1,DL
         9 000020   000031 601000 9                  TNZ     s:1369

     1647     1366    3               DF$ = NAM1.DESC$(RFK_DSC.FLD$->RFK_DSC.FLD_IDX);

   1366  9 000021   000007 473500                    LDP3    7,,PR0
PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:259  
         9 000022   300001 236100                    LDQ     1,,PR3
         9 000023   000022 772000                    QRL     18
         9 000024   000012 402007                    MPY     10,DL
         9 000025   000000 474400 0                  LDP4    NAM1$
         9 000026   400011 236106                    LDQ     9,QL,PR4
         9 000027   200006 756100                    STQ     DF$,,AUTO

     1648     1367    3               GOTO DO_THE_FIND_FIRST;

   1367  9 000030   000036 710000 9                  TRA     DO_THE_FIND_FIRST

     1649     1368    3               END;
     1650     1369    2           DRFK$ = RFK_DSC.REC$;

   1369  9 000031   000005 236100                    LDQ     5,,PR0
         9 000032   200005 756100                    STQ     DRFK$,,AUTO

     1651     1370    2           END;

   1370  9 000033   000000 116000 10                 CMPQ    0
         9 000034   000013 601000 9                  TNZ     s:1365

     1652     1371    1       ALTRETURN;

   1371  9 000035   000000 702200 xent               TSX2  ! X66_AALT

     1653     1372
     1654     1373    1   DO_THE_FIND_FIRST: ;

   1373  9 000036                       DO_THE_FIND* null
     1655     1374         /*
     1656     1375            ZII_FIND1ST_MOVE_PTR$ points to the start of the UWA.
     1657     1376            ZII_FIND1ST_MOVE_OFF is computed from FIELD.UWA_OFF and is the
     1658     1377            digit offset (4 or 9-bit as appropriate) to the key field.
     1659     1378            ZII_FIND1ST_MOVE_LEN is the digit length of the key field.
     1660     1379         */
     1661     1380
PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:260  
     1662     1381    1       ZII_FIND1ST_MOVE_PTR$ = UWA$;

   1381  9 000036   000000 236000 6                  LDQ     UWA$
         9 000037   000000 756000 xsym               STQ     ZII_FIND1ST_MOVE_PTR$

     1663     1382    1       ZII_FIND1ST_MOVE_OFF = FIELD.UWA_OFF;

   1382  9 000040   200006 475500                    LDP5    DF$,,AUTO
         9 000041   500001 236100                    LDQ     1,,PR5
         9 000042   000022 772000                    QRL     18
         9 000043   000000 756000 xsym               STQ     ZII_FIND1ST_MOVE_OFF

     1664     1383    1       ZII_FIND1ST_MOVE_LEN = FIELD.EIS_BITS.NDSC.N;

   1383  9 000044   500005 236100                    LDQ     5,,PR5
         9 000045   000077 376007                    ANQ     63,DL
         9 000046   000000 756000 xsym               STQ     ZII_FIND1ST_MOVE_LEN

     1665     1384
     1666     1385    2       DO CASE(FIELD.FLAGS_2.DATA_TYPE);

   1385  9 000047   500004 220100                    LDX0    4,,PR5
         9 000050   177777 360003                    ANX0    65535,DU
         9 000051   000022 100003                    CMPX0   18,DU
         9 000052   000054 602010 9                  TNC     s:1385+5,X0
         9 000053   000266 710000 9                  TRA     s:1440
         9 000054   000076 710000 9                  TRA     s:1387
         9 000055   000112 710000 9                  TRA     s:1392
         9 000056   000112 710000 9                  TRA     s:1392
         9 000057   000125 710000 9                  TRA     s:1397
         9 000060   000136 710000 9                  TRA     s:1401
         9 000061   000136 710000 9                  TRA     s:1401
         9 000062   000157 710000 9                  TRA     s:1408
         9 000063   000170 710000 9                  TRA     s:1412
         9 000064   000201 710000 9                  TRA     s:1416
         9 000065   000157 710000 9                  TRA     s:1408
         9 000066   000157 710000 9                  TRA     s:1408
PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:261  
         9 000067   000212 710000 9                  TRA     s:1420
         9 000070   000112 710000 9                  TRA     s:1392
         9 000071   000112 710000 9                  TRA     s:1392
         9 000072   000225 710000 9                  TRA     s:1425
         9 000073   000225 710000 9                  TRA     s:1425
         9 000074   000240 710000 9                  TRA     s:1430
         9 000075   000253 710000 9                  TRA     s:1435

     1667     1386    2       CASE(#FDT_CHAR);

     1668     1387    2           ZII_FIND1ST_MOVE_LEN = FIELD.EIS_BITS.ADSC.N;

   1387  9 000076   500005 236100                    LDQ     5,,PR5
         9 000077   007777 376007                    ANQ     4095,DL
         9 000100   000000 756000 xsym               STQ     ZII_FIND1ST_MOVE_LEN

     1669     1388    2           IF FIELD.FLAGS_2.BYT_NIB THEN

   1388  9 000101   500004 234100                    SZN     4,,PR5
         9 000102   000106 605000 9                  TPL     s:1390

     1670     1389    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF / 2;

   1389  9 000103   000000 236000 xsym               LDQ     ZII_FIND1ST_MOVE_OFF
         9 000104   000001 772000                    QRL     1
         9 000105   000000 756000 xsym               STQ     ZII_FIND1ST_MOVE_OFF

     1671     1390    2           CALL ZII$FIND1ST_MOVE_Z;

   1390  9 000106   000001 631400 10                 EPPR1   1
         9 000107   000000 701000 xent               TSX1    ZII$FIND1ST_MOVE_Z
         9 000110   000000 011000                    NOP     0
         9 000111   000267 710000 9                  TRA     s:1447

     1672     1391    2       CASE(#FDT_DBK,#FDT_INTEGER,#FDT_CMP2,#FDT_FLT_SINGLE);

     1673     1392    2           ZII_FIND1ST_MOVE_LEN = 4;
PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:262  

   1392  9 000112   000004 235007                    LDA     4,DL
         9 000113   000000 755000 xsym               STA     ZII_FIND1ST_MOVE_LEN

     1674     1393    2           IF FIELD.FLAGS_2.BYT_NIB THEN

   1393  9 000114   500004 234100                    SZN     4,,PR5
         9 000115   000121 605000 9                  TPL     s:1395

     1675     1394    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF / 2;

   1394  9 000116   000000 236000 xsym               LDQ     ZII_FIND1ST_MOVE_OFF
         9 000117   000001 772000                    QRL     1
         9 000120   000000 756000 xsym               STQ     ZII_FIND1ST_MOVE_OFF

     1676     1395    2           CALL ZII$FIND1ST_MOVE_Z;

   1395  9 000121   000001 631400 10                 EPPR1   1
         9 000122   000000 701000 xent               TSX1    ZII$FIND1ST_MOVE_Z
         9 000123   000000 011000                    NOP     0
         9 000124   000267 710000 9                  TRA     s:1447

     1677     1396    2       CASE(#FDT_CMP_UNSIGN);

     1678     1397    2           IF NOT FIELD.FLAGS_2.BYT_NIB THEN

   1397  9 000125   500004 234100                    SZN     4,,PR5
         9 000126   000132 604000 9                  TMI     s:1399

     1679     1398    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF * 2;

   1398  9 000127   000000 235000 xsym               LDA     ZII_FIND1ST_MOVE_OFF
         9 000130   000001 735000                    ALS     1
         9 000131   000000 755000 xsym               STA     ZII_FIND1ST_MOVE_OFF

     1680     1399    2           CALL ZII$FIND1ST_MOVE_4UN;

PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:263  
   1399  9 000132   000001 631400 10                 EPPR1   1
         9 000133   000000 701000 xent               TSX1    ZII$FIND1ST_MOVE_4UN
         9 000134   000000 011000                    NOP     0
         9 000135   000267 710000 9                  TRA     s:1447

     1681     1400    2       CASE(#FDT_CMP_SIGN,#FDT_CMP3_SIGN);

     1682     1401    2           IF NOT FIELD.FLAGS_2.BYT_NIB THEN

   1401  9 000136   500004 234100                    SZN     4,,PR5
         9 000137   000143 604000 9                  TMI     s:1403

     1683     1402    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF * 2;

   1402  9 000140   000000 235000 xsym               LDA     ZII_FIND1ST_MOVE_OFF
         9 000141   000001 735000                    ALS     1
         9 000142   000000 755000 xsym               STA     ZII_FIND1ST_MOVE_OFF

     1684     1403    2           IF FIELD.EIS_BITS.NDSC.S = '01'B THEN

   1403  9 000143   500005 236100                    LDQ     5,,PR5
         9 000144   030000 376007                    ANQ     12288,DL
         9 000145   010000 116007                    CMPQ    4096,DL
         9 000146   000153 601000 9                  TNZ     s:1406

     1685     1404    2               CALL ZII$FIND1ST_MOVE_4LS;

   1404  9 000147   000001 631400 10                 EPPR1   1
         9 000150   000000 701000 xent               TSX1    ZII$FIND1ST_MOVE_4LS
         9 000151   000000 011000                    NOP     0
         9 000152   000267 710000 9                  TRA     s:1447

     1686     1405    2           ELSE
     1687     1406    2               CALL ZII$FIND1ST_MOVE_4TS;

   1406  9 000153   000001 631400 10                 EPPR1   1
         9 000154   000000 701000 xent               TSX1    ZII$FIND1ST_MOVE_4TS
PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:264  
         9 000155   000000 011000                    NOP     0
         9 000156   000267 710000 9                  TRA     s:1447

     1688     1407    2       CASE(#FDT_DISP_NUM,#FDT_DISP_NUM010,#FDT_DISP_NUM001);

     1689     1408    2           IF FIELD.FLAGS_2.BYT_NIB THEN

   1408  9 000157   500004 234100                    SZN     4,,PR5
         9 000160   000164 605000 9                  TPL     s:1410

     1690     1409    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF / 2;

   1409  9 000161   000000 236000 xsym               LDQ     ZII_FIND1ST_MOVE_OFF
         9 000162   000001 772000                    QRL     1
         9 000163   000000 756000 xsym               STQ     ZII_FIND1ST_MOVE_OFF

     1691     1410    2           CALL ZII$FIND1ST_MOVE_9UN;

   1410  9 000164   000001 631400 10                 EPPR1   1
         9 000165   000000 701000 xent               TSX1    ZII$FIND1ST_MOVE_9UN
         9 000166   000000 011000                    NOP     0
         9 000167   000267 710000 9                  TRA     s:1447

     1692     1411    2       CASE(#FDT_DISP_NUM100);

     1693     1412    2           IF FIELD.FLAGS_2.BYT_NIB THEN

   1412  9 000170   500004 234100                    SZN     4,,PR5
         9 000171   000175 605000 9                  TPL     s:1414

     1694     1413    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF / 2;

   1413  9 000172   000000 236000 xsym               LDQ     ZII_FIND1ST_MOVE_OFF
         9 000173   000001 772000                    QRL     1
         9 000174   000000 756000 xsym               STQ     ZII_FIND1ST_MOVE_OFF

     1695     1414    2           CALL ZII$FIND1ST_MOVE_9LS;
PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:265  

   1414  9 000175   000001 631400 10                 EPPR1   1
         9 000176   000000 701000 xent               TSX1    ZII$FIND1ST_MOVE_9LS
         9 000177   000000 011000                    NOP     0
         9 000200   000267 710000 9                  TRA     s:1447

     1696     1415    2       CASE(#FDT_DISP_NUM011);

     1697     1416    2           IF FIELD.FLAGS_2.BYT_NIB THEN

   1416  9 000201   500004 234100                    SZN     4,,PR5
         9 000202   000206 605000 9                  TPL     s:1418

     1698     1417    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF / 2;

   1417  9 000203   000000 236000 xsym               LDQ     ZII_FIND1ST_MOVE_OFF
         9 000204   000001 772000                    QRL     1
         9 000205   000000 756000 xsym               STQ     ZII_FIND1ST_MOVE_OFF

     1699     1418    2           CALL ZII$FIND1ST_MOVE_9TS;

   1418  9 000206   000001 631400 10                 EPPR1   1
         9 000207   000000 701000 xent               TSX1    ZII$FIND1ST_MOVE_9TS
         9 000210   000000 011000                    NOP     0
         9 000211   000267 710000 9                  TRA     s:1447

     1700     1419    2       CASE(#FDT_CMP1);

     1701     1420    2           ZII_FIND1ST_MOVE_LEN = 2;

   1420  9 000212   000002 235007                    LDA     2,DL
         9 000213   000000 755000 xsym               STA     ZII_FIND1ST_MOVE_LEN

     1702     1421    2           IF FIELD.FLAGS_2.BYT_NIB THEN

   1421  9 000214   500004 234100                    SZN     4,,PR5
         9 000215   000221 605000 9                  TPL     s:1423
PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:266  

     1703     1422    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF / 2;

   1422  9 000216   000000 236000 xsym               LDQ     ZII_FIND1ST_MOVE_OFF
         9 000217   000001 772000                    QRL     1
         9 000220   000000 756000 xsym               STQ     ZII_FIND1ST_MOVE_OFF

     1704     1423    2           CALL ZII$FIND1ST_MOVE_Z;

   1423  9 000221   000001 631400 10                 EPPR1   1
         9 000222   000000 701000 xent               TSX1    ZII$FIND1ST_MOVE_Z
         9 000223   000000 011000                    NOP     0
         9 000224   000267 710000 9                  TRA     s:1447

     1705     1424    2       CASE(#FDT_FLT_DOUBLE,#FDT_CMPLX_SINGLE);

     1706     1425    2           ZII_FIND1ST_MOVE_LEN = 8;

   1425  9 000225   000010 235007                    LDA     8,DL
         9 000226   000000 755000 xsym               STA     ZII_FIND1ST_MOVE_LEN

     1707     1426    2           IF FIELD.FLAGS_2.BYT_NIB THEN

   1426  9 000227   500004 234100                    SZN     4,,PR5
         9 000230   000234 605000 9                  TPL     s:1428

     1708     1427    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF / 2;

   1427  9 000231   000000 236000 xsym               LDQ     ZII_FIND1ST_MOVE_OFF
         9 000232   000001 772000                    QRL     1
         9 000233   000000 756000 xsym               STQ     ZII_FIND1ST_MOVE_OFF

     1709     1428    2           CALL ZII$FIND1ST_MOVE_Z;

   1428  9 000234   000001 631400 10                 EPPR1   1
         9 000235   000000 701000 xent               TSX1    ZII$FIND1ST_MOVE_Z
         9 000236   000000 011000                    NOP     0
PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:267  
         9 000237   000267 710000 9                  TRA     s:1447

     1710     1429    2       CASE(#FDT_CMPLX_DOUBLE);

     1711     1430    2           ZII_FIND1ST_MOVE_LEN = 16;

   1430  9 000240   000020 235007                    LDA     16,DL
         9 000241   000000 755000 xsym               STA     ZII_FIND1ST_MOVE_LEN

     1712     1431    2           IF FIELD.FLAGS_2.BYT_NIB THEN

   1431  9 000242   500004 234100                    SZN     4,,PR5
         9 000243   000247 605000 9                  TPL     s:1433

     1713     1432    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF / 2;

   1432  9 000244   000000 236000 xsym               LDQ     ZII_FIND1ST_MOVE_OFF
         9 000245   000001 772000                    QRL     1
         9 000246   000000 756000 xsym               STQ     ZII_FIND1ST_MOVE_OFF

     1714     1433    2           CALL ZII$FIND1ST_MOVE_Z;

   1433  9 000247   000001 631400 10                 EPPR1   1
         9 000250   000000 701000 xent               TSX1    ZII$FIND1ST_MOVE_Z
         9 000251   000000 011000                    NOP     0
         9 000252   000267 710000 9                  TRA     s:1447

     1715     1434    2       CASE(#FDT_LOGICAL);

     1716     1435    2           ZII_FIND1ST_MOVE_LEN = 1;

   1435  9 000253   000001 235007                    LDA     1,DL
         9 000254   000000 755000 xsym               STA     ZII_FIND1ST_MOVE_LEN

     1717     1436    2           IF FIELD.FLAGS_2.BYT_NIB THEN

   1436  9 000255   500004 234100                    SZN     4,,PR5
PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:268  
         9 000256   000262 605000 9                  TPL     s:1438

     1718     1437    2               ZII_FIND1ST_MOVE_OFF = ZII_FIND1ST_MOVE_OFF / 2;

   1437  9 000257   000000 236000 xsym               LDQ     ZII_FIND1ST_MOVE_OFF
         9 000260   000001 772000                    QRL     1
         9 000261   000000 756000 xsym               STQ     ZII_FIND1ST_MOVE_OFF

     1719     1438    2           CALL ZII$FIND1ST_MOVE_Z;

   1438  9 000262   000001 631400 10                 EPPR1   1
         9 000263   000000 701000 xent               TSX1    ZII$FIND1ST_MOVE_Z
         9 000264   000000 011000                    NOP     0
         9 000265   000267 710000 9                  TRA     s:1447

     1720     1439    2       CASE(ELSE);

     1721     1440    2           ALTRETURN;

   1440  9 000266   000000 702200 xent               TSX2  ! X66_AALT

     1722     1441    2           END; /* Do Case(FIELD.FLAGS_2.DATA_TYPE) */

     1723     1442         /*
     1724     1443            At this point an appropriate zero has been moved into the
     1725     1444            appropriate key item and I'm going to turn this all over to
     1726     1445            Mark Quinty.
     1727     1446         */
     1728     1447    1   END;

   1447  9 000267   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
  10     000   000000 006014   000000 000000                                    ........

PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:269  
--  Include file information  --

   ZI$STRUCTS.:ZIC0TOU  is referenced.
   ZI$PATH_STRUCTS.:ZIC0TOU  is referenced.
   ZI$DESC.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure ZII$FIND_FIRST.

   Procedure ZII$FIND_FIRST requires 184 words for executable code.
   Procedure ZII$FIND_FIRST requires 8 words of local(AUTO) storage.

    No errors detected in file ZII$RET_LIB.:ZIC0TSI    .
PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:270  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:271  
          MINI XREF LISTING

ACCESS_LIST
      1071**DCL         7--PROC
ACCESS_LIST.DIRECT
      1083**DCL      1085--REDEF    1092--REDEF
ACCESS_LIST.PORT
      1072**DCL      1363>>ASSIGN
ACCESS_LIST.PORT_KEY
      1074**DCL      1365>>IF
DESC#
      1146**DCL      1151--IMP-SIZ
DF$
      1228**DCL      1229--IMP-PTR  1366<<ASSIGN   1382>>ASSIGN   1383>>ASSIGN   1385>>DOCASE   1387>>ASSIGN
      1388>>IF       1393>>IF       1397>>IF       1401>>IF       1403>>IF       1408>>IF       1412>>IF
      1416>>IF       1421>>IF       1426>>IF       1431>>IF       1436>>IF
DO_THE_FIND_FIRST
      1373**LABEL    1367--GOTO
DR$
      1178**DCL      1179--IMP-PTR
DRFK$
      1212**DCL      1213--IMP-PTR  1363<<ASSIGN   1364>>DOWHILE  1365>>IF       1366>>ASSIGN   1369<<ASSIGN
      1369>>ASSIGN
FIELD.EIS_BITS.ADSC.N
      1337**DCL      1387>>ASSIGN
FIELD.EIS_BITS.NDSC
      1300**DCL      1329--REDEF
FIELD.EIS_BITS.NDSC.N
      1328**DCL      1383>>ASSIGN
FIELD.EIS_BITS.NDSC.S
      1319**DCL      1403>>IF
FIELD.FLAGS_2.BYT_NIB
      1270**DCL      1388>>IF       1393>>IF       1397>>IF       1401>>IF       1408>>IF       1412>>IF
      1416>>IF       1421>>IF       1426>>IF       1431>>IF       1436>>IF
PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:272  
FIELD.FLAGS_2.DATA_TYPE
      1276**DCL      1385>>DOCASE
FIELD.FLAG_BITS_1
      1241**DCL      1242--REDEF
FIELD.FLAG_BITS_2
      1268**DCL      1269--REDEF
FIELD.UWA_OFF
      1232**DCL      1382>>ASSIGN
NAM1.DESC$
      1137**DCL      1363>>ASSIGN   1366>>ASSIGN
NAM1$
      1119**DCL      1122--IMP-PTR  1363>>ASSIGN   1366>>ASSIGN
NAM2.DESC
      1150**DCL      1151--REDEF
NAM2$
      1144**DCL      1147--IMP-PTR
RECORD.FLAG_BITS
      1183**DCL      1184--REDEF
RECORD.RFK_DSC$
      1208**DCL      1363>>ASSIGN
RFK_DSC.FLD$
      1224**DCL      1366>>ASSIGN
RFK_DSC.FLD_IDX
      1216**DCL      1366>>ASSIGN
RFK_DSC.KEY_IDX
      1215**DCL      1365>>IF
RFK_DSC.REC$
      1222**DCL      1369>>ASSIGN
UWA#
      1156**DCL      1174--IMP-SIZ
UWA$
      1154**DCL      1157--IMP-PTR  1381>>ASSIGN
ZII$FIND1ST_MOVE_4LS
      1345**DCL-ENT  1404--CALL
ZII$FIND1ST_MOVE_4TS
      1346**DCL-ENT  1406--CALL
PL6.E3A0      #005=ZII$FIND_FIRST File=ZII$RET_LIB.:ZIC0TSI                      FRI 09/05/97 12:31 Page:273  
ZII$FIND1ST_MOVE_4UN
      1344**DCL-ENT  1399--CALL
ZII$FIND1ST_MOVE_9LS
      1348**DCL-ENT  1414--CALL
ZII$FIND1ST_MOVE_9TS
      1349**DCL-ENT  1418--CALL
ZII$FIND1ST_MOVE_9UN
      1347**DCL-ENT  1410--CALL
ZII$FIND1ST_MOVE_Z
      1343**DCL-ENT  1390--CALL     1395--CALL     1423--CALL     1428--CALL     1433--CALL     1438--CALL
ZII_FIND1ST_MOVE_LEN
      1353**DCL      1383<<ASSIGN   1387<<ASSIGN   1392<<ASSIGN   1420<<ASSIGN   1425<<ASSIGN   1430<<ASSIGN
      1435<<ASSIGN
ZII_FIND1ST_MOVE_OFF
      1352**DCL      1382<<ASSIGN   1389<<ASSIGN   1389>>ASSIGN   1394<<ASSIGN   1394>>ASSIGN   1398<<ASSIGN
      1398>>ASSIGN   1402<<ASSIGN   1402>>ASSIGN   1409<<ASSIGN   1409>>ASSIGN   1413<<ASSIGN   1413>>ASSIGN
      1417<<ASSIGN   1417>>ASSIGN   1422<<ASSIGN   1422>>ASSIGN   1427<<ASSIGN   1427>>ASSIGN   1432<<ASSIGN
      1432>>ASSIGN   1437<<ASSIGN   1437>>ASSIGN
ZII_FIND1ST_MOVE_PTR$
      1351**DCL      1381<<ASSIGN
