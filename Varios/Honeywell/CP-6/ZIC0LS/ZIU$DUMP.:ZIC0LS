
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:1    
        1        1        /*T***********************************************************/
        2        2        /*T*                                                         */
        3        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        4        4        /*T*                                                         */
        5        5        /*T***********************************************************/
        6        6        /*P*
        7        7            NAME: ZIU$DUMP         10/79            D.F. HANRAHAN
        8        8         PURPOSE: To compress the empty data space out of an 'IDS' file
        9        9                  and write a backup of the area to a key file. Also to
       10       10                  back up any associated key files with an area.
       11       11                                DATA BASE DUMP ROUTINE
       12       12                                       ZIU$DUMP
       13       13
       14       14
       15       15               The purpose of the Data Base Dump routine is to provide a
       16       16               backup  for IDS area  files and  associated keyed  files.
       17       17               The DUMP program will dump  the IDS files to disc or tape
       18       18               and will  compress  out any  empty data  space within the
       19       19               data pages of the  file during the  process. This is done
       20       20               by  positioning  the  offset  array in  each  data  page,
       21       21               adjacent to the  last  byte of  data in  that page,  then
       22       22               discarding the  rest of that page  when writing it out to
       23       23               the dump file.
       24       24
       25       25               In addition  to the IDS  file, the  attribute page of the
       26       26               IDS file is  checked for  the existance  of an associated
       27       27               key file. If such a file is  suppose to exist, an attempt
       28       28               is  made  to  dump it  also.  For  this  operation  to be
       29       29               successful,  the  keyed  file  must  reside in  the  same
       30       30               account  as the area  file, and  must have  the save file
       31       31               name except with  a ':' appended to  the end. If the file
       32       32               is not found, a warning  message is issued along with the
       33       33               file name not found.
       34       34
       35       35               In all utility  operations, the  associated key file will
       36       36               be kept with the area file. Any set commands for the area
       37       37               will be  applied to the  keyed file. Any  set commands on
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:2    
       38       38               the keyed file name will be ignored.
       39       39
       40       40               The DUMP program will also  dump the inventory pages, but
       41       41               as is true with the attribute page, will not compress the
       42       42               page(s). After  certain  modifications  are made  to  the
       43       43               attribute page  to  reflect the  dump  attributes,  it is
       44       44               written to the dump file.  Note that an attribute page is
       45       45               always written.
       46       46
       47       47               The major dump options are available to reduce the amount
       48       48               of data being  backed up which is  especially useful when
       49       49               backing up large data bases. These are the page range and
       50       50               the dump 'AFTER' option.  The dump may be restricted to a
       51       51               desired page  range specified in the  directive. Also the
       52       52               clause 'AFTER yymmdd [,hhmmss]' may appear after the dump
       53       53               file name, and only data  pages within the specified page
       54       54               range  and  modified  after  the  date  specified by  the
       55       55               'yymmdd [,hhmmss]' clause will be dumped.
       56       56
       57       57
       58       58               The dump program is very straight foward in operation. It
       59       59               will  first  open  the  source  file  which  must  be  an
       60       60               integrated IDS file. The  file name is extracted from the
       61       61               DCB  after the  open in  case a  set  command was used to
       62       62               change the default file  name. Once the file is open, the
       63       63               area name in that  file is checked  against the area name
       64       64               in the directive  to ensure that the  areas are the same.
       65       65               Certain attributes are then  extracted to determine where
       66       66               the  inventory pages  are and  if there is  an associated
       67       67               keyed file. A dump ID is then put into the attribute page
       68       68               along with a  flag saying  whether or  not a partial dump
       69       69               was specified. This page is  then written out to the dump
       70       70               file with  a key of  zero. Note  that the  dump file is a
       71       71               keyed file and the the key of each page is the key of the
       72       72               corresponding IDS page key.
       73       73
       74       74               A data page is read and  its' date is checked against the
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:3    
       75       75               desired dump  'AFTER' date  if one was  specified. If the
       76       76               page is  to be  dumped, a  compress  routine is called to
       77       77               squeeze out  the  empty  data  space,  then  the page  is
       78       78               written out. When complete, a report is given on the file
       79       79               names used and the number of pages dumped.
       80       80
       81       81                                                                                          */
       82       82        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:4    
       83       83        /******************************************************************/
       84       84        ZIU$DUMP: PROC ALTRET;
       85       85    1   DCL AREADCB UBIN HALF;
       86       86    1   DCL DESTDCB UBIN HALF;
       87       87    1   DCL I_O_INDX SBIN HALF STATIC;
       88       88    1   DCL BUF_PTR UBIN WORD ALIGNED SYMREF;
       89       89    1   DCL NBUFS SBIN SYMREF ALIGNED; /*NUMBER OF I_O_BUF WE HAVE */
       90       90    1   DCL FIRST_CHK BIT(1) STATIC;
       91       91    1   DCL ACCEPT_PAGE BIT(1) STATIC UNAL;
       92       92    1   DCL LAST_PAGE BIT(1) STATIC UNAL;
       93       93    1   DCL RIGHT_JUSTIFY BIT(1) CONSTANT INIT('0'B) UNAL;
       94       94    1   DCL LEFT_JUSTIFY BIT(1) CONSTANT INIT('1'B) UNAL;
       95       95    1   DCL MSG_FLG BIT(1) STATIC INIT('0'B) UNAL;
       96       96    1   DCL CHECKSUM BIT(1) STATIC INIT('0'B) UNAL;
       97       97    1   DCL PRINT_CHKS BIT(1) STATIC INIT('0'B) UNAL;
       98       98    1   DCL BAD_CHK_LOW SBIN WORD STATIC ALIGNED;
       99       99    1   DCL BAD_CHK_HIGH SBIN WORD STATIC ALIGNED;
      100      100    1   DCL KEY_FILE_ASSOCIATED BIT(1) STATIC UNAL;
      101      101    1   DCL 1 I_O_TAB BASED(DATA$) ALIGNED,
      102      102    1         2 I_O_HW (0:2047) UNAL,
      103      103    1           3 * BIT(2) UNAL,
      104      104    1           3 VAL UBIN(16) UNAL;
      105      105    1   DCL PGE_DATE UBIN WORD BASED;
      106      106    1   DCL PGE_DATE$ PTR;
      107      107    1   DCL HIGH_PAGE UBIN WORD SYMREF ALIGNED;
      108      108    1   DCL HIGH_DATA_PG UBIN WORD SYMREF ALIGNED;
      109      109    1   DCL NUM_INV_PGS UBIN WORD SYMREF ALIGNED;
      110      110    1   DCL LPP SBIN WORD SYMREF ALIGNED;
      111      111    1   DCL LOW_DBK SBIN WORD SYMREF ALIGNED;
      112      112    1   DCL COMPRESS_SIZE UBIN WORD;
      113      113    1   DCL TOTL_PGS_DUMP UBIN STATIC INIT(1);
      114      114    1   DCL RB_SAVE UBIN STATIC;
      115      115    1   DCL RE_SAVE UBIN STATIC;
      116      116    1   DCL TAPE_BLOCK SBIN STATIC ALIGNED;
      117      117    1   DCL 1 SRCE_FILE STATIC,
      118      118    1         2 CNT UBIN(9) UNAL,
      119      119    1         2 TEXT CHAR(31) UNAL;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:5    
      120      120    1   DCL 1 DEST_FILE STATIC,
      121      121    1         2 CNT UBIN(9) UNAL,
      122      122    1         2 TEXT CHAR(31) UNAL;
      123      123    1   DCL REPRT CHAR(80) STATIC INIT(' ');
      124      124        /*
      125      125           Include files and macros
      126      126        */
      127      127        %INCLUDE CP_6;
      128      208         %F$DCB;
      129      265         %B$TCB;
      130      268         %B$EXCFR;
      131      286        %INCLUDE CP_6_SUBS;
      132      826        %INCLUDE B_ERRORS_C;
      133     1953        %INCLUDE ZI$DIR;
      134     2110         %DIR;
      135     2254        %INCLUDE ZI$PG_STRUCTS;
      136     2357         %DATA_PG;
      137     2376         %INVTY_PG;
      138     2392         %ATBLK_PG;
      139     2448        %INCLUDE ZI_GLOBAL_DBUTIL;
      140     2626         %SYS_FUNC;
      141     2718         %MISC_DCLS;
      142     2771         %INCLUDE ZI_DBU_XREF;
      143     2938         %XREF_TBLS;
      144     3013        /*
      145     3014            Declarations of external subroutines.
      146     3015        */
      147     3016    1   DCL SYS_FUNC_ERRMSG ENTRY ALTRET;
      148     3017    1   DCL SYS_FUNC_GETDCB ENTRY ALTRET;
      149     3018    1   DCL SYS_FUNC_OPEN ENTRY ALTRET;
      150     3019    1   DCL SYS_FUNC_READ ENTRY ALTRET;
      151     3020    1   DCL SYS_FUNC_WRIT ENTRY ALTRET;
      152     3021    1   DCL SYS_FUNC_RELDCB ENTRY ALTRET;
      153     3022    1   DCL SYS_FUNC_TSTAMP ENTRY ALTRET;
      154     3023    1   DCL SYS_FUNC_CLOS ENTRY ALTRET;
      155     3024    1   DCL SYS_FUNC_CORRES ENTRY(2) ALTRET;
      156     3025    1   DCL SYS_FUNC_CHECK ENTRY ALTRET;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:6    
      157     3026    1   DCL GET_FILESIZE ENTRY ALTRET;
      158     3027    1   DCL SYS_FUNC_RELEASE ENTRY ALTRET;
      159     3028    1   DCL PAGE_RANGE ENTRY(6);
      160     3029    1   DCL ZERO_SUP ENTRY(3);
      161     3030    1   DCL CHKSUM ENTRY;
      162     3031    1   DCL BUILD_MSTR_TBL ENTRY ALTRET;
      163     3032    1   DCL BUILD_SETXREF ENTRY ALTRET;
      164     3033    1   DCL BUILD_RECXREF ENTRY ALTRET;
      165     3034    1   DCL CHECK_PAGES ENTRY ALTRET;
      166     3035        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:7    
      167     3036    1   DUMPING_MSG: PROC;
      168     3037    2       REPRT = '..Dumping';
      169     3038    2   /**/ DCBSF = DCBNUM(M$LO);
      170     3039    2   /**/ BUFSF = VECTOR(REPRT);
      171     3040    2   /**/ BUFLNSF = 10;
      172     3041    2   /**/ VFCSF = %NO#;
      173     3042    2       CALL SYS_FUNC_WRIT;
      174     3043    2   END DUMPING_MSG;
      175     3044
      176     3045        /*
      177     3046                 OPEN AND CHECK SOURCE FILE FOR IDS ORGANIZATION
      178     3047        */
      179     3048    1       AREADCB = ZI$DIR.SRCE_NM.DCB#;
      180     3049    1   /**/ DCBSF = AREADCB; /* DCB NUMBER FOR AREA OPENED */
      181     3050    1   /**/ ORGSF = %IDS#; /* FILE ORGANIZATION */
      182     3051    1   /**/ TESTSF =%NO#; /* TEST OPEN = NO */
      183     3052    1   /**/ ACSSF = %DIRECT#; /* ACCESS MODE */
      184     3053    1   /**/ FUNSF = %IN#; /* ONLY IN,SHARE=IN OR IN,SHARE=ALL CAN OPEN */
      185     3054    1   /**/ ASNSF = %FILE#; /* ASN# PARAMETER */
      186     3055    1   /**/ FIDSF = ZI$DIR.SRCE_NM.NAME.TEXT; /*     DCB NAME */
      187     3056    1   /**/ SHARESF = %IN#; /* SHARE PARAMETER */
      188     3057    1       CALL SYS_FUNC_OPEN ALTRET(ALT_SOURCE_FILE);
      189     3058
      190     3059    1       SRCE_FILE = DCBADDR(AREADCB) -> F$DCB.NAME#;
      191     3060    1       DESTDCB = ZI$DIR.DEST_NM.DCB#;
      192     3061    1       IF DCBADDR(AREADCB)->F$DCB.ORG#=%INDEXED# THEN
      193     3062    2       DO;
      194     3063    2           DCBSF=AREADCB; /* REOPEN SOURCE WITH BLOCK */
      195     3064    2           CALL SYS_FUNC_CLOS ALTRET(ALT_SOURCE_FILE);
      196     3065    2           CALL DUMP_INDEX_FILE('IND') ALTRET(ALT_DEST_FILE);
      197     3066    2           GOTO END_OF_DUMP;
      198     3067    2           END;
      199     3068    1       ELSE
      200     3069    1           IF DCBADDR(AREADCB)->F$DCB.ORG# ~= %IDS# THEN
      201     3070    2           DO;
      202     3071         /*E* ERROR: ZIU-01004-C
      203     3072                    MESSAGE: ..%FN is not an IDS/INDEX file - dump aborted! */
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:8    
      204     3073    2               ERRCODESF.ERR# = 1004;
      205     3074    2               MSGCODE = ERRCODE_RDEF;
      206     3075    2               ERRFLGSF = 4;
      207     3076    2               CALL SYS_FUNC_ERRMSG;
      208     3077    2               CALL CLOSE_FILES;
      209     3078    2               ALTRETURN;
      210     3079    2               END;
      211     3080    1       CALL GET_ATBLK(NUM_INV_PGS,HIGH_DATA_PG,HIGH_PAGE)
      212     3081    1          ALTRET(ALT_RD_ATBLK);
      213     3082        /*
      214     3083              Open destination file -
      215     3084              the dump file will be keyed with key of zero as attribute page.
      216     3085        */
      217     3086    1   /**/ DCBSF = DESTDCB;
      218     3087    1   /**/ ORGSF = %KEYED#;
      219     3088    1   /**/ TESTSF = %NO#;
      220     3089    1   /**/ XTENSIZESF = 1; /* CREATE A DUMMY DUMP FILE FIRST */
      221     3090    1   /**/ ASNSF = %FILE#;
      222     3091    1   /**/ ACSSF = %DIRECT#;
      223     3092    1   /**/ FUNSF = %CREATE#;
      224     3093    1   /**/ BKUPSF = %YES#;
      225     3094    1   /**/ ACNT = ZI$DIR.ACNT;
      226     3095    1   /**/ FIDSF = ZI$DIR.DEST_NM.NAME.TEXT;
      227     3096    1   /**/ EXISTSF = ZI$DIR.OPEN_MODE;
      228     3097    1   /**/ SHARESF = %NONE#;
      229     3098    1       CALL SYS_FUNC_OPEN ALTRET(ALT_DEST_FILE);
      230     3099        /*
      231     3100            RELEASE THE FILE JUST OPENED, SO THAT IF DEST IS A DISK FILE
      232     3101            IT WILL BE ERASED TO AVIOD OUT OF DISK SPACE, AND IF IT IS
      233     3102            A TAPE FILE, WE SHALL SET THE PROPER BLOCK SIZE IN TAPE
      234     3103            DEPENDING UPON THE DENSITY OF THE TAPE.
      235     3104        */
      236     3105    1       CALL SYS_FUNC_RELEASE ALTRET(ALT_DEST_FILE);
      237     3106    1       IF DCBADDR(DESTDCB)->F$DCB.ASN#=%TAPE# THEN
      238     3107    2       DO; /* DUMP TO TAPE FILE, SO SET BLOCK=YES AND BLKL */
      239     3108    2           IF DCBADDR(DESTDCB)->F$DCB.DENSITY#<3 THEN
      240     3109    2               TAPE_BLOCK = 8; /* FOR BPI<1600, USE BIG BLOCK */
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:9    
      241     3110    2           ELSE
      242     3111    2               IF DCBADDR(DESTDCB)->F$DCB.DENSITY#=3 THEN
      243     3112    2                   TAPE_BLOCK=4; /* BPI=1600,USE 4K BLOCK */
      244     3113    2               ELSE
      245     3114    2                   TAPE_BLOCK = 2; /* FOR HIGH DENSITY, USE SMALLER BLOCK */
      246     3115    2           BLKLSF = TAPE_BLOCK*4096;
      247     3116    2           END;
      248     3117    1       XTENSIZESF = HIGH_PAGE/4;
      249     3118    1       ACNT = ZI$DIR.ACNT;
      250     3119    1       CALL SYS_FUNC_OPEN ALTRET(ALT_DEST_FILE);
      251     3120
      252     3121        /*
      253     3122           Extract the file name actually opened in case a set
      254     3123           set command was used to overwrite the default.
      255     3124        */
      256     3125    1       DEST_FILE = DCBADDR(DESTDCB) -> F$DCB.NAME#;
      257     3126        /*
      258     3127                 Write out attribute page...
      259     3128                 Set key size for keyed file write - dump file keys
      260     3129                 will be identicle to 'IDS' keys except in textc format.
      261     3130        */
      262     3131    1       KEYVSF.LEN = 4;
      263     3132    1   /**/ DCBSF = DESTDCB;
      264     3133    1   /**/ ENCRP_SEEDSF = ZI$DIR.DEST_SEED;
      265     3134    1   /**/ WAITSF = %YES#;
      266     3135    1   /**/ VFCSF = %NO#;
      267     3136    1   /**/ BUFLNSF = 4096;
      268     3137    1   /**/ KEYVSF.IDSKEY = 0;
      269     3138    1       CALL SYS_FUNC_WRIT ALTRET(ALT_WRITE_DEST);
      270     3139    1       TOTL_PGS_DUMP = 1; /* INCLUDING FILE_INFO (FIT) */
      271     3140    1       LAST_PAGE = %NO# ;
      272     3141    1       FIRST_CHK = %YES# ;
      273     3142    1       IF ZI$DIR.CHECK = %YES# THEN
      274     3143    2       DO;
      275     3144    2           IF XREF_BUILT = %NO# THEN
      276     3145    3           DO;
      277     3146    3               CALL BUILD_MSTR_TBL ALTRET(ALT_AREA_READ);
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:10   
      278     3147    3               CALL BUILD_SETXREF ALTRET(ALT_AREA_READ);
      279     3148    3               CALL BUILD_RECXREF ALTRET(ALT_AREA_READ);
      280     3149    3               END;
      281     3150    2           X = 0;
      282     3151    3           DO WHILE(ZI$DIR.AREA_NM.NAME.TEXT ~= AREA_KEY_XREF.NAME(X));
      283     3152    3               X = X +1;
      284     3153    3               END;
      285     3154    2           AREA_KEY_XREF.CHECKED(X) = 1;
      286     3155    2           END;
      287     3156        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:11   
      288     3157        /*------------------------------------------------------------------
      289     3158                     B E G I N   D U M P I N G   A R E A
      290     3159          ----------------------------------------------------------------*/
      291     3160    1       CALL DUMPING_MSG; /* OUTPUT ..DUMPING MSG */
      292     3161    1       CALL PAGE_RANGE(RB_SAVE,RE_SAVE,NBUFS,I_O_SIZE,HIGH_PAGE,LAST_PAGE);
      293     3162    1       BUF_PTR = NBUFS;
      294     3163    1       BUFSF = VECTOR(I_O_BUF);
      295     3164    1       BUFLNSF = I_O_SIZE * 4096;
      296     3165    1       FULLSF = %YES#;
      297     3166    1       KEYSF = %YES#;
      298     3167    1       KEYVSF.IDSKEY = RB_SAVE;
      299     3168    1       ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;
      300     3169    1       DCBSF = ZI$DIR.SRCE_NM.DCB#;
      301     3170    1       WAITSF = %NO#; /* NO WAIT READ */
      302     3171    1       CALL SYS_FUNC_READ ALTRET(ALT_AREA_READ);
      303     3172
      304     3173    2       DO WHILE(~LAST_PAGE);
      305     3174    2           IF BREAK_FLAG > 0 THEN
      306     3175    3           DO;
      307     3176    3               CALL CLOSE_FILES;
      308     3177    3               RETURN;
      309     3178    3               END;
      310     3179    2           RB=RB_SAVE;
      311     3180    2           RE=RE_SAVE;
      312     3181    2           BUFSF = VECTOR(I_O_BUF(BUF_PTR)); /* NEXT BUF TO READ */
      313     3182    2           BUF_PTR = NBUFS - BUF_PTR; /* CURRENT BUF */
      314     3183    2           CALL PAGE_RANGE(RB_SAVE,RE_SAVE,NBUFS,I_O_SIZE,HIGH_PAGE,LAST_PAGE);
      315     3184    2           DCBSF = ZI$DIR.SRCE_NM.DCB#;
      316     3185    2           CALL SYS_FUNC_CHECK ALTRET(ALT_AREA_READ);
      317     3186    2           IF ~LAST_PAGE THEN
      318     3187    3           DO;
      319     3188    3               BUFLNSF = 4096 * I_O_SIZE;
      320     3189    3               FULLSF = %YES#;
      321     3190    3               KEYSF = %YES#;
      322     3191    3               KEYVSF.IDSKEY = RB_SAVE;
      323     3192    3               ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;
      324     3193    3               WAITSF = %NO#; /* PREPARE FOR NEXT READ AHEAD */
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:12   
      325     3194    3               CALL SYS_FUNC_READ ALTRET(ALT_AREA_READ);
      326     3195    3               END;
      327     3196    2           I_O_INDX = BUF_PTR;
      328     3197    2           IF ZI$DIR.CHECK = %YES# THEN
      329     3198    2               CALL CHECK_PAGES;
      330     3199    3           DO RB = RB TO RE;
      331     3200    3               DATA$ = ADDR(I_O_BUF(I_O_INDX));
      332     3201    3               PGE_DATE$ = PINCRW(DATA$,1);
      333     3202    3               CALL CHK_DATE(PGE_DATE$->PGE_DATE,ACCEPT_PAGE)
      334     3203    3                  ALTRET (ALT_DATE);
      335     3204    3               IF ACCEPT_PAGE THEN
      336     3205    4               DO;
      337     3206    4                   IF CHECKSUM AND RB <= HIGH_DATA_PG THEN
      338     3207    4                       CALL CHECK_SUM;
      339     3208    4                   COMPRESS_SIZE = 4096;
      340     3209    4                   IF RB <= HIGH_DATA_PG THEN
      341     3210    4                       CALL COMPRESS_PAGE(COMPRESS_SIZE);
      342     3211    4    /**/           DCBSF = DESTDCB;
      343     3212    4    /**/           BUFSF = VECTOR(I_O_BUF(I_O_INDX));
      344     3213    4    /**/           BUFLNSF = COMPRESS_SIZE;
      345     3214    4    /**/           WAITSF = %YES#;
      346     3215    4    /**/           VFCSF = %NO#;
      347     3216    4    /**/           ENCRP_SEEDSF = ZI$DIR.DEST_SEED;
      348     3217    4    /**/           KEYVSF.IDSKEY = RB; /* Give same key as area key */
      349     3218    4                   CALL SYS_FUNC_WRIT ALTRET(ALT_WRITE_DEST);
      350     3219    4                   TOTL_PGS_DUMP = TOTL_PGS_DUMP + 1;
      351     3220    4                   END;
      352     3221    3               I_O_INDX = I_O_INDX + 1;
      353     3222    3               END;
      354     3223    2           END;
      355     3224        /*
      356     3225                   Print any bad checksum pages not yet printed.
      357     3226        */
      358     3227    2       IF CHECKSUM AND MSG_FLG THEN DO;
      359     3228    2           PRINT_CHKS = %YES#;
      360     3229    2           CALL CHECK_SUM;
      361     3230    2           CHECKSUM = %NO# ;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:13   
      362     3231    2           MSG_FLG = %NO# ; /* Reset checksum flags for nxt dmp */
      363     3232    2           PRINT_CHKS = %NO# ;
      364     3233    2           END;
      365     3234    1       CALL DUMP_REPRT('IDS' /* DO IDS DUMP REPORT */);
      366     3235        /*
      367     3236               Check schema for a possible associated key file. If one exist
      368     3237               attemp to open and dump it.
      369     3238        */
      370     3239    1       IF KEY_FILE_ASSOCIATED AND ZI$DIR.NOKEYS = %NO# THEN
      371     3240    2       DO;
      372     3241    2    /**/   DCBSF = ZI$DIR.SRCE_NM.DCB#;
      373     3242    2           CALL SYS_FUNC_CLOS; /* Note: not releasing dcb yet */
      374     3243    2    /**/   DCBSF = ZI$DIR.DEST_NM.DCB#;
      375     3244    2           CALL SYS_FUNC_CLOS;
      376     3245    2           CALL DUMP_ASCFID('KEY') ALTRET(ALT_DEST_FILE);
      377     3246    2           END;
      378     3247    1       ELSE
      379     3248    1           CALL CLOSE_FILES; /* Close and release dcbs */
      380     3249    1   END_OF_DUMP:
      381     3250    1       REPRT = '...Dump terminated';
      382     3251    1   /**/ DCBSF = DCBNUM(M$LO);
      383     3252    1   /**/ BUFSF = VECTOR(REPRT);
      384     3253    1   /**/ BUFLNSF = 80;
      385     3254    1   /**/ VFCSF = %NO#;
      386     3255    1       CALL SYS_FUNC_WRIT;
      387     3256    1       RETURN;
      388     3257        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:14   
      389     3258        /*----------------------------------------------------------*/
      390     3259        /*        C O M P R E S S    P A G E    P R O C             */
      391     3260        /*----------------------------------------------------------*/
      392     3261    1   COMPRESS_PAGE: PROC(PGE_SIZE);
      393     3262    2   DCL PGE_SIZE SBIN;
      394     3263    2   DCL N SBIN STATIC;
      395     3264    2   DCL OFF_ARRAY CHAR(N) BASED;
      396     3265    2   DCL REC$ PTR STATIC;
      397     3266    2   DCL TEMP$ PTR STATIC;
      398     3267    2   DCL OFF_ARRAY$ PTR STATIC;
      399     3268        /* This routine works out how many words are occupied by the line
      400     3269           index entries at the end of a page. Then, by a series of word moves
      401     3270           it jams those entries up against the end of the last data record
      402     3271           on the page and calculates the new record length                  */
      403     3272
      404     3273         /* first calculate the # of bytes
      405     3274            in to the first free data byte */
      406     3275    2       IF I_O_TAB.I_O_HW.VAL(7) < 4 THEN
              3275                /*Don't worry about page compression it's full*/
      407     3276    3       DO;
      408     3277    3           PGE_SIZE = 4096;
      409     3278    3           RETURN;
      410     3279    3           END;
      411     3280
      412     3281    2       N = ((I_O_TAB.I_O_HW.VAL(11)+2)/2)*4;
      413     3282         /* N = no. Of chars in offset array. Take
      414     3283            no. Of pointers +1 for zero base +1 for
      415     3284            odd numbers. Div by 2 for # words and
      416     3285            mult by 4 for # chars */
      417     3286    2       PGE_SIZE = I_O_TAB.I_O_HW.VAL(6) - (I_O_TAB.I_O_HW.VAL(7) +
      418     3287    2          ((I_O_TAB.I_O_HW.VAL(11) + 1) * 2));
      419     3288
      420     3289         /* save byte count in PGE_SIZE to be
      421     3290            used for byte count in SYS_FUNC_WRIT*/
      422     3291
      423     3292    2       PGE_SIZE = PGE_SIZE + 12;
      424     3293         /* Include an extra 12 bytes (3 words)
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:15   
      425     3294            to account for 3 head rec words */
      426     3295
      427     3296    2       PGE_SIZE = ((PGE_SIZE+3)/4) * 4;
      428     3297         /*  PGE_SIZE   had actual byte count of byte
      429     3298            to first empty data byte. The
      430     3299            above pushes this count to a
      431     3300            word boundry */
      432     3301
      433     3302    2       REC$ = PINCRC(DATA$ , PGE_SIZE); /* Set REC$ to point at the
      434     3303         first byte of empty data
      435     3304         in the data page */
      436     3305
      437     3306    2       TEMP$ = ADDR(I_O_TAB.I_O_HW.VAL(2047));
      438     3307         /* Set TEMP$ to point to the
      439     3308            bottom or last byte of data */
      440     3309
      441     3310    2       OFF_ARRAY$=PINCRC(TEMP$,(0-(N-2)));
      442     3311         /* move pointer back to point to the
      443     3312            first word boundry of offset array
      444     3313            the  N-2 accounts for halfword pres-
      445     3314            ently looked at by pointer */
      446     3315
      447     3316    2       REC$->OFF_ARRAY = OFF_ARRAY$->OFF_ARRAY;
      448     3317         /* Above line does the actual commpression */
      449     3318
      450     3319    2       PGE_SIZE = PGE_SIZE + N; /* Update no. of bytes in record */
      451     3320    2       RETURN;
      452     3321    2   END;
      453     3322        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:16   
      454     3323        /*-------------------------------------------------------------*/
      455     3324        /*         GET INVENTORY  AND  FILE  SIZE  ATTRIBUTES           */
      456     3325        /*--------------------------------------------------------------*/
      457     3326    1   GET_ATBLK: PROC(INV,DATAPGS,HI_PGE) ALTRET;
      458     3327    2   DCL INV SBIN;
      459     3328    2   DCL DATAPGS SBIN;
      460     3329    2   DCL HI_PGE SBIN;
      461     3330    2   DCL 1 DUMP_INFO BASED(ATBLK$) ALIGNED,
      462     3331    2         2 * (0:2) UBIN WORD UNAL,
      463     3332    2         2 ID CHAR(4) UNAL;
      464     3333        /*
      465     3334           Evaluate high data page and number of inventory pages according
      466     3335           to attribute block information.
      467     3336        */
      468     3337    2   /**/ DCBSF = AREADCB;
      469     3338    2   /**/ BUFSF = VECTOR(I_O_BUF(0));
      470     3339    2   /**/ BUFLNSF = 4096;
      471     3340    2   /**/ FULLSF = %YES#;
      472     3341    2   /**/ ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;
      473     3342    2   /**/ KEYSF = %YES#;
      474     3343    2   /**/ KEYVSF.IDSKEY = 0;
      475     3344    2       CALL SYS_FUNC_READ ALTRET(ALT_ATBLK);
      476     3345    2       ATBLK$ = ADDR(I_O_BUF(0));
      477     3346    2       IF ZI$DIR.SRCE_NM.NAME.TEXT ~= ATBLK_PG.AREA_NM THEN
      478     3347    3       DO;
      479     3348         /*E* ERROR: ZIU-01090-C
      480     3349                MESSAGE: Area name %U1 is not the area name store in IDS file %FN.
      481     3350                 */
      482     3351    3           ERR_INSERT(0) = ZI$DIR.SRCE_NM.NAME;
      483     3352    3           ERRCODESF.ERR# = 1090;
      484     3353    3           MSGCODE = ERRCODE_RDEF;
      485     3354    3           CALL SYS_FUNC_ERRMSG;
      486     3355    3           ALTRETURN;
      487     3356    3           END;
      488     3357    2       IF ATBLK_PG.MISC_INFO.KEY_FILE_BLT THEN
      489     3358    2           KEY_FILE_ASSOCIATED = %YES#;
      490     3359    2       ELSE
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:17   
      491     3360    2           KEY_FILE_ASSOCIATED = %NO#;
      492     3361    2       IF ATBLK_PG.MISC_INFO.CHKSM = %YES# THEN
      493     3362    2           CHECKSUM = %YES#;
      494     3363    2       ELSE
      495     3364    2           CHECKSUM = %NO#;
      496     3365    2       IF ATBLK_PG.FIR_INV_PGNO = 0 THEN
      497     3366    3       DO;
      498     3367    3           HI_PGE = ATBLK_PG.NUM_DBPG;
      499     3368    3           DATAPGS = HI_PGE;
      500     3369    3           INV = 0;
      501     3370    3           END;
      502     3371    3       ELSE DO;
      503     3372    3           INV = ATBLK_PG.NUM_DBPG - ATBLK_PG.FIR_INV_PGNO + 1;
      504     3373    3           DATAPGS = ATBLK_PG.NUM_DBPG - INV;
      505     3374    3           HI_PGE = ATBLK_PG.NUM_DBPG;
      506     3375    3           END;
      507     3376        /*
      508     3377                 Insert a dump 'ID' into the attribute page and write
      509     3378                 the attribute page as the first record fo the dump.
      510     3379        */
      511     3380    2       DUMP_INFO.ID = 'DUMP';
      512     3381    2       IF ZI$DIR.RNG_LIST OR ZI$DIR.DATEFLG THEN
      513     3382    2           ATBLK_PG.STATUS.FULL_DUMP = %NO#;
      514     3383    2       ELSE
      515     3384    2           ATBLK_PG.STATUS.FULL_DUMP = %YES#;
      516     3385    2       IF ATBLK_PG.STATUS.FULL_DUMP = %NO# THEN
      517     3386    2           ZI$DIR.NOKEYS = %YES#; /* Don't dump keys on partial dump. */
      518     3387    2       LOW_DBK = ATBLK_PG.LOW_DBK;
      519     3388    2       LPP = ATBLK_PG.LINE_INFO.LPP;
      520     3389    2       RETURN;
      521     3390        /**/
      522     3391    2   ALT_ATBLK:
      523     3392    2       ALTRETURN;
      524     3393    2   END GET_ATBLK;
      525     3394        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:18   
      526     3395        /*-----------------------------------------------------------------*/
      527     3396        /*      C H E C K   D U M P   D A T E   R O U T I N E              */
      528     3397        /*-----------------------------------------------------------------*/
      529     3398    1   CHK_DATE: PROC(PAGE_DATE,PASS_DATE) ALTRET;
      530     3399    2   DCL PAGE_DATE UBIN;
      531     3400    2   DCL PASS_DATE BIT(1);
      532     3401    2   DCL DUMP_DATE UBIN STATIC;
      533     3402        /*
      534     3403           First time this routine is called - the user specified date is
      535     3404           passed to 'M$TIME' to create a tstamp. After that just a compare
      536     3405           of that stamp to the stamp on the data page is done.
      537     3406        */
      538     3407    2       IF ~ ZI$DIR.DATEFLG THEN /* No date was specified - return */
      539     3408    3       DO;
      540     3409    3           PASS_DATE = %YES#;
      541     3410    3           RETURN;
      542     3411    3           END;
      543     3412    2       IF FIRST_CHK THEN
      544     3413    3       DO;
      545     3414    3           FIRST_CHK = '0'B;
      546     3415    3    /**/   SOURCESF = %ANS#;
      547     3416    3    /**/   DESTSF = %UTS#;
      548     3417    3    /**/   TIMESF = VECTOR(ZI$DIR.TIME);
      549     3418    3    /**/   DATESF = VECTOR(ZI$DIR.DATE);
      550     3419    3    /**/   TSTAMPSF = VECTOR(DUMP_DATE);
      551     3420    3           CALL SYS_FUNC_TSTAMP ALTRET(ALT_TSTAMP);
      552     3421    3           END;
      553     3422    2       IF PAGE_DATE >= DUMP_DATE THEN
      554     3423    2           PASS_DATE = %YES#;
      555     3424    2       ELSE
      556     3425    2           PASS_DATE = %NO#;
      557     3426    2       RETURN;
      558     3427        /**/
      559     3428    2   ALT_TSTAMP:
      560     3429    2       ALTRETURN;
      561     3430    2   END CHK_DATE;
      562     3431        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:19   
      563     3432        /*
      564     3433           This routine calculates the checksum and compares it to
      565     3434           against the granual stamp. Then replaces the bad
      566     3435           checksum if not correct and prints a message.
      567     3436        */
      568     3437    1   CHECK_SUM: PROC;
      569     3438    2   DCL PAGE CHAR(6) STATIC;
      570     3439    2   DCL DASH CHAR(1) STATIC;
      571     3440    2   DCL HIGH_PGE CHAR(10) STATIC;
      572     3441    2   DCL LOW_PGE CHAR(10) STATIC;
      573     3442    2   DCL REPRT_CHK CHAR(80);
      574     3443    2   DCL I SBIN WORD STATIC;
      575     3444    2   DCL DATA (0:1023) SBIN WORD BASED(DATA$);
      576     3445
      577     3446    2       IF PRINT_CHKS = %YES# THEN
      578     3447    3       DO;
      579     3448    3           CALL BAD_CHK;
      580     3449    3           RETURN;
      581     3450    3           END;
      582     3451    2       ICHKSUM = 0;
      583     3452
      584     3453    2       CALL CHKSUM; /* BMAP - value returned in ICHKSUM */
      585     3454
      586     3455    2       DATA(0) = ICHKSUM;
      587     3456    2       IF ICHKSUM ~= DATA_PG.CHKSUM_WD THEN
      588     3457    3       DO;
      589     3458    3           DATA_PG.CHKSUM_WD = ICHKSUM;
      590     3459    3           IF MSG_FLG = %NO# THEN
      591     3460    4           DO;
      592     3461    4               MSG_FLG = %YES#;
      593     3462         /*E* ERROR: ZIU-01007-C
      594     3463                   MESSAGE: Checksum inconsistency noted while dumping...
      595     3464                            Modified checksum value(s) for the following page(s):
      596     3465                                                                            */
      597     3466    4               ERRCODESF.ERR#= 1007;
      598     3467    4               MSGCODE = ERRCODE_RDEF;
      599     3468    4               CALL SYS_FUNC_ERRMSG;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:20   
      600     3469    4               CALL BAD_CHK;
      601     3470    4               END;
      602     3471    3           ELSE
      603     3472    3               CALL BAD_CHK;
      604     3473    3           END;
      605     3474    2       RETURN;
      606     3475        /*
      607     3476           Print and keep track of bad checksum pages
      608     3477        */
      609     3478    2   BAD_CHK: PROC;
      610     3479
      611     3480    3       IF BAD_CHK_LOW = 0 THEN
      612     3481    4       DO;
      613     3482    4           BAD_CHK_LOW = RB;
      614     3483    4           BAD_CHK_HIGH= RB;
      615     3484    4           RETURN;
      616     3485    4           END;
      617     3486    3       IF RB - BAD_CHK_HIGH > 1 OR PRINT_CHKS THEN
      618     3487    4       DO;
      619     3488    4           PAGE = 'PAGE';
      620     3489    4           DASH = ' ';
      621     3490    4           HIGH_PGE = ' ';
      622     3491    4           CALL BINCHAR(LOW_PGE,BAD_CHK_LOW);
      623     3492    4           CALL ZERO_SUP(LOW_PGE,10,RIGHT_JUSTIFY);
      624     3493    4           IF BAD_CHK_LOW ~= BAD_CHK_HIGH THEN
      625     3494    5           DO;
      626     3495    5               DASH = '-';
      627     3496    5               PAGE = 'PAGES';
      628     3497    5               CALL BINCHAR(HIGH_PGE,BAD_CHK_HIGH);
      629     3498    5               CALL ZERO_SUP(HIGH_PGE,10,LEFT_JUSTIFY);
      630     3499    5               END;
      631     3500    4           END;
      632     3501    3       IF RB - BAD_CHK_HIGH > 1 OR PRINT_CHKS = %YES# THEN
      633     3502    4       DO;
      634     3503    4    /**/   DCBSF = DCBNUM(M$LO);
      635     3504    4    /**/   BUFSF = VECTOR(REPRT_CHK);
      636     3505    4    /**/   BUFLNSF = 80;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:21   
      637     3506    4    /**/   VFCSF = %NO#;
      638     3507    4           CALL CONCAT(REPRT_CHK, '      ',PAGE,LOW_PGE,DASH,HIGH_PGE);
      639     3508    4           CALL SYS_FUNC_WRIT;
      640     3509    4           BAD_CHK_LOW = RB;
      641     3510    4           BAD_CHK_HIGH = RB;
      642     3511    4           END;
      643     3512    3       ELSE
      644     3513    3           BAD_CHK_HIGH = RB;
      645     3514    3       RETURN;
      646     3515    3   END BAD_CHK;
      647     3516    2   END CHECK_SUM;
      648     3517        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:22   
      649     3518        /*-------------------------------------------------------------------
      650     3519              A S S O C I A T E D   K E Y E D   F I L E    C H E C K
      651     3520        -------------------------------------------------------------------*/
      652     3521    1   DUMP_ASCFID: PROC(FILE_TYPE) ALTRET;
      653     3522
      654     3523    2   DCL FILE_TYPE CHAR(3) CALIGNED;
      655     3524
      656     3525        /*
      657     3526           This procedure is called once it has been established in the
      658     3527           attribute block that an associated keyed file belongs to this
      659     3528           area just dumped. This routine figures out what the name of
      660     3529           the source and destination key file names are (or should be).
      661     3530           Also, this routine makes sure that the source key file can be
      662     3531           opened before calling the key file dump routine.
      663     3532        */
      664     3533    2       I=SRCE_FILE.CNT;
      665     3534    2       I=I+1;
      666     3535    2       IF I > 30 THEN I = 30; /* Only max of 30 char names allowed */
      667     3536    2       CALL INSERT(SRCE_FILE.TEXT,(I-1),1,':');
      668     3537    2       SRCE_FILE.CNT = I;
      669     3538        /*
      670     3539           The source fid should be the area name + ':'.
      671     3540        */
      672     3541    2       I=DEST_FILE.CNT;
      673     3542    2       I=I+1;
      674     3543    2       IF I > 30 THEN I = 30;
      675     3544    2       CALL INSERT(DEST_FILE.TEXT,(I-1),1,':');
      676     3545    2       DEST_FILE.CNT = I;
      677     3546        /*
      678     3547           Now use the same dcbs for these two files.
      679     3548        */
      680     3549        /*
      681     3550           Attempt to open the keyed file - if an altreturn condition
      682     3551           occurrs, inform the user you cannot backup the keyed file.
      683     3552        */
      684     3553
      685     3554    2   DUMP_INDEX_FILE: ENTRY (FILE_TYPE) ALTRET;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:23   
      686     3555
      687     3556    2   /**/ DCBSF = ZI$DIR.SRCE_NM.DCB#;
      688     3557    2   /**/ REASGNSF = %NO#;
      689     3558    2   /**/ TESTSF = %NO#;
      690     3559    2   /**/ ACSSF = %BLOCK#; /* DO BLOCK READ */
      691     3560    2   /**/ FUNSF = %IN#; /* MUST BE %IN IN BLOCK MODE */
      692     3561    2   /**/ FIDSF = SRCE_FILE.TEXT;
      693     3562    2   /**/ SHARESF = %IN#; /* NO OTHER UPDATER ALLOWED */
      694     3563        /**/
      695     3564    2       CALL SYS_FUNC_OPEN ALTRET(ALT_OPEN); /* Open source area */
      696     3565    2       DCBSF = ZI$DIR.DEST_NM.DCB#;
      697     3566    2       DESTDCB = DCBSF;
      698     3567    2       ACNT(0) = ' ';
      699     3568    2       REASGNSF = %NO#; /* WE ARE GOING TO DELETE THE DEST FILE */
      700     3569    2       ORGSF = %CONSEC#;
      701     3570    2       FUNSF = %CREATE#;
      702     3571    2       EXISTSF = %NEWFILE#;
      703     3572    2       ACSSF = %SEQUEN#;
      704     3573    2       XTENSIZESF = 1;
      705     3574    2       CARRY_ATTRIBUTESF = %NO#;
      706     3575    2       TESTSF = %NO#;
      707     3576    2       FIDSF = DEST_FILE.TEXT;
      708     3577    2       IF FILE_TYPE = 'IND' THEN
      709     3578    3       DO;
      710     3579    3           REASGNSF = %YES#;
      711     3580    3           FIDSF = ZI$DIR.DEST_NM.NAME.TEXT; /* FOR INDEX, USE !SET */
      712     3581    3           EXISTSF=ZI$DIR.OPEN_MODE; /* INDEX FILE CAN HAVE 'ON' OPT */
      713     3582    3           END;
      714     3583    2       CALL SYS_FUNC_OPEN ALTRET(ALT_OPEN);
      715     3584    2       DEST_FILE = DCBADDR(DESTDCB)->F$DCB.NAME#;
      716     3585    2       IF SUBSTR(DEST_FILE.TEXT,0,1)='*' THEN
      717     3586    3       DO;
      718     3587        /*E* ERROR: ZIU-10002-C
      719     3588        MESSAGE: The destination file cannot be a star file(*?)
      720     3589                 in DUMP/LOAD. Please reset your DCB.   */
      721     3590    3           ERRCODESF.ERR# = 10002;
      722     3591    3           MSGCODE = ERRCODE_RDEF;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:24   
      723     3592    3           ERRFLGSF =4;
      724     3593    3           CALL SYS_FUNC_ERRMSG;
      725     3594    3           ALTRETURN;
      726     3595    3           END;
      727     3596    2       CALL SYS_FUNC_RELEASE ALTRET(ALT_OPEN);
      728     3597    2       IF DCBADDR(DESTDCB)->F$DCB.ASN#=%TAPE# THEN
      729     3598    3       DO; /* DUMP TO TAPE FILE, SO SET BLOCK=YES AND BLKL */
      730     3599    3           IF DCBADDR(DESTDCB)->F$DCB.DENSITY#<3 THEN
      731     3600    3               TAPE_BLOCK = 8; /* BPI=556 OR 800, USE BIG BLOCK */
      732     3601    3           ELSE
      733     3602    3               IF DCBADDR(DESTDCB)->F$DCB.DENSITY#=3 THEN
      734     3603    3                   TAPE_BLOCK=4; /* BPI=1600,USE 4K BLOCK */
      735     3604    3               ELSE
      736     3605    3                   TAPE_BLOCK = 2; /* BPI=6250, USE SMALL BLCK FOR HIGH DEN */
      737     3606    3           BLKLSF = TAPE_BLOCK*4096;
      738     3607    3           END;
      739     3608    2       ELSE
      740     3609    2           TAPE_BLOCK=4096; /* SET TO A REAL BIG NUMBER FOR DISK DUMP */
      741     3610    2       TOTL_PGS_DUMP = 1; /* NOW WE WILL DO A REAL OPEN */
      742     3611    2       ORGSF = %RESTRICT#;
      743     3612    2       ACSSF = %BLOCK#; /* IN BLOCK MODE */
      744     3613    2       FIDSF = DEST_FILE.TEXT;
      745     3614    2       REASGNSF = %NO#;
      746     3615    2       TESTSF = %NO#;
      747     3616    2       FUNSF = %CREATE#;
      748     3617    2       EXISTSF = %NEWFILE#;
      749     3618    2       CALL GET_FILESIZE;
      750     3619    2       CALL SYS_FUNC_OPEN ALTRET(ALT_OPEN);
      751     3620    2       IF FILE_TYPE='IND' THEN
      752     3621    2           CALL DUMPING_MSG; /* NOW START DUMPING INDEX AREAS */
      753     3622    2       CALL PROCESS_KEY_DUMP ALTRET(ALTEND);
      754     3623    2       CALL DUMP_REPRT(FILE_TYPE);
      755     3624        /*
      756     3625           Close and release dcbs.
      757     3626        */
      758     3627    2       CALL CLOSE_FILES;
      759     3628    2       RETURN;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:25   
      760     3629        /**/
      761     3630    2   ALT_OPEN:
      762     3631         /*E* ERROR: ZIU-01070-C
      763     3632               MESSAGE: Unable to open the file %FN.
      764     3633               */
      765     3634    2       ERRCODESF.ERR# = 1070;
      766     3635    2       MSGCODE = ERRCODE_RDEF;
      767     3636    2       CALL SYS_FUNC_ERRMSG;
      768     3637    2   ALTEND:
      769     3638    2       ALTRETURN;
      770     3639    2   END DUMP_ASCFID;
      771     3640        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:26   
      772     3641        /*------------------------------------------------------------------
      773     3642             D U M P    K E Y E D    F I L E    F O R   A R E A
      774     3643        ------------------------------------------------------------------*/
      775     3644    1   PROCESS_KEY_DUMP: PROC ALTRET;
      776     3645         /**/
      777     3646    3       DO WHILE('1'B);
      778     3647    3           I_O_INDX = NBUFS;
      779     3648    3           DCBSF = ZI$DIR.SRCE_NM.DCB#;
      780     3649    3           BUFSF = VECTOR(I_O_BUF);
      781     3650    3           BUFLNSF = 4096 * NBUFS;
      782     3651    3           WAITSF = %YES#;
      783     3652    3           CALL SYS_FUNC_READ ALTRET(ALT_DUMP);
      784     3653    3           IF BREAK_FLAG > 0 THEN ALTRETURN;
      785     3654    3           X=DCBADDR(AREADCB)->F$DCB.ARS#/4096; /* # PAGES READ */
      786     3655    3           BUFLNSF = NBUFS * 4096;
      787     3656    3           DCBSF = DESTDCB;
      788     3657    3           I_O_INDX = 0;
      789     3658    4           DO WHILE(X>0); /* WRITE TAPE TO EACH TAPE BLOCK SIZE */
      790     3659    4               IF X>TAPE_BLOCK THEN
      791     3660    4                   BUFLNSF=TAPE_BLOCK*4096;
      792     3661    4               ELSE
      793     3662    4                   BUFLNSF=X*4096;
      794     3663    4               X=X-BUFLNSF/4096;
      795     3664    4               VFCSF = %NO#;
      796     3665    4               BUFSF = VECTOR(I_O_BUF(I_O_INDX));
      797     3666    4               CALL SYS_FUNC_WRIT ALTRET(ALT_DUMP);
      798     3667    4               TOTL_PGS_DUMP = TOTL_PGS_DUMP + (BUFLNSF+1)/4096;
      799     3668    4               I_O_INDX = I_O_INDX + (BUFLNSF+1)/4096;
      800     3669    4               END; /* DIVIDE 1 BIG WRITE TO SEVERAL SMALLER ONES IF TAPE DUMP */
      801     3670    3           END;
      802     3671         /**/
      803     3672    2   ALT_DUMP:
      804     3673    2       IF B$TCB$->B$TCB.ALT$->B$EXCFR.ERR.ERR# = %E$EOF THEN
      805     3674    2           RETURN;
      806     3675    2       ELSE
      807     3676    2           ALTRETURN;
      808     3677    2   END PROCESS_KEY_DUMP;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:27   
      809     3678        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:28   
      810     3679        /*-----------------------------------------------------------------*/
      811     3680        /*       D U M P   R E P O R T   O F   F I L E   I N F O           */
      812     3681        /*-----------------------------------------------------------------*/
      813     3682    1   DUMP_REPRT: PROC(IDS_FILE);
      814     3683    2   DCL FID$ PTR STATIC INIT(ADDR(SRCE_FILE.TEXT));
      815     3684    2   DCL FID_NM CHAR(N) BASED(FID$);
      816     3685    2   DCL N SBIN WORD;
      817     3686    2   DCL PAGES CHAR(10);
      818     3687    2   DCL IDS_FILE CHAR(3) CALIGNED;
      819     3688        /*
      820     3689           THIS ROUTINE IS USED TO PRINT THE NAME OF THE FILE THAT
      821     3690           THE SOURCE IS BEING DUMPED TO AND THE NUMBER OF PAGES DUMPED */
      822     3691    2       CALL INDEX1(N,' ',SRCE_FILE.TEXT);
      823     3692    2       CALL CONCAT(REPRT,'* * * ',IDS_FILE,' file ',FID_NM,
      824     3693    2          ' dumped to file ',DEST_FILE.TEXT);
      825     3694    2   /**/ DCBSF = DCBNUM(M$LO);
      826     3695    2   /**/ BUFSF = VECTOR(REPRT);
      827     3696    2   /**/ BUFLNSF = 80;
      828     3697    2   /**/ VFCSF = %NO#;
      829     3698    2       CALL SYS_FUNC_WRIT; /* WRITE FROM_FILE AND TO_FILE NAMES */
      830     3699    2       CALL BINCHAR(PAGES,TOTL_PGS_DUMP);
      831     3700    2       CALL ZERO_SUP(PAGES,10,'1'B);
      832     3701    2       IF IDS_FILE = 'IDS' THEN
      833     3702    2           CALL CONCAT(REPRT,'      Number of pages dumped: ',PAGES);
      834     3703    2       ELSE
      835     3704    2           CALL CONCAT(REPRT,'      Number of granules dumped: ',PAGES);
      836     3705    2   /**/ VFCSF = %NO#;
      837     3706    2       CALL SYS_FUNC_WRIT;
      838     3707    2   END DUMP_REPRT;
      839     3708        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:29   
      840     3709        /*------------------------------------------------------------------
      841     3710                  C L O S E    T H E    D C B 'S    P R O C
      842     3711        -------------------------------------------------------------------*/
      843     3712    1   CLOSE_FILES: PROC;
      844     3713    2       DCBSF = ZI$DIR.SRCE_NM.DCB#;
      845     3714    2       IF DCBADDR(DCBSF) -> F$DCB.FCD# = %YES# THEN /* dbc is open */
      846     3715    2           CALL SYS_FUNC_CLOS;
      847     3716    2       CALL SYS_FUNC_RELDCB;
      848     3717    2       IF ZI$DIR.SRCE_NM.DCB# = ZI$DIR.DEST_NM.DCB# THEN
      849     3718    2           RETURN;
      850     3719    2       DCBSF = ZI$DIR.DEST_NM.DCB#;
      851     3720    2       IF DCBADDR(DCBSF) -> F$DCB.FCD# = %YES# THEN /* dbc is open */
      852     3721    3       DO;
      853     3722    3           POSSF = ZI$DIR.POS; /* Set option for tape position */
      854     3723    3           RELGSF = '1'B; /* set only for destination files */
      855     3724    3           CALL SYS_FUNC_CLOS;
      856     3725    3           END;
      857     3726    2       CALL SYS_FUNC_RELDCB;
      858     3727    2       RETURN;
      859     3728    2   END CLOSE_FILES;
      860     3729        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:30   
      861     3730        /*-------------------------------------------------------------------
      862     3731            E X C E P T I O N A L    C O N D I T I O N   R E T U R N S
      863     3732          -----------------------------------------------------------------*/
      864     3733    1   ALT_SOURCE_FILE:
      865     3734         /*E* ERROR: ZIU-01050-C
      866     3735                MESSAGE: Unable to continue dump processing on area %U1.
      867     3736           */
      868     3737    1       ERR_INSERT.CNT(0) = ZI$DIR.SRCE_NM.NAME.CNT;
      869     3738    1       ERR_INSERT.TEXT(0) = ZI$DIR.SRCE_NM.NAME.TEXT;
      870     3739    1       ERRCODESF.ERR# = 1050;
      871     3740    1       MSGCODE = ERRCODE_RDEF;
      872     3741    1       CALL SYS_FUNC_ERRMSG;
      873     3742    1       ALTRETURN;
      874     3743    1   ALT_DEST_FILE:
      875     3744    1   /**/ DCBSF = AREADCB;
      876     3745    1       CALL SYS_FUNC_CLOS;
      877     3746         /*E* ERROR: ZIU-01051-C
      878     3747                MESSAGE: Unable to create dump file %FN.
      879     3748           */
      880     3749    1       DCBSF = DESTDCB;
      881     3750    1       ERRCODESF.ERR# = 1051;
      882     3751    1       MSGCODE = ERRCODE_RDEF;
      883     3752    1       CALL SYS_FUNC_ERRMSG;
      884     3753    1       CALL CLOSE_FILES;
      885     3754    1       ALTRETURN;
      886     3755    1   ALT_AREA_READ:
      887     3756    1       CALL CLOSE_FILES;
      888     3757    1       ALTRETURN;
      889     3758    1   ALT_WRITE_DEST:
      890     3759    1       CALL CLOSE_FILES;
      891     3760    1       ALTRETURN;
      892     3761    1   ALT_DATE:
      893     3762    1       CALL CLOSE_FILES;
      894     3763    1       ALTRETURN;
      895     3764    1   ALT_RD_ATBLK:
      896     3765         /*E* ERROR: ZIU-01060-C
      897     3766           MESSAGE: Unable to continue processing at attribute page of %FN. */
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:31   
      898     3767    1       ERRCODESF.ERR# = 1060;
      899     3768    1       MSGCODE = ERRCODE_RDEF;
      900     3769    1       CALL SYS_FUNC_ERRMSG;
      901     3770    1       CALL CLOSE_FILES;
      902     3771    1       ALTRETURN;
      903     3772    1   END ZIU$DUMP;

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:32   
--  Include file information  --

   ZI_DBU_XREF.:ZIC0TOU  cannot be made into a system file and is referenced.
   ZI_GLOBAL_DBUTIL.:ZIC0TOU  is referenced.
   ZI$PG_STRUCTS.:ZIC0TOU  is referenced.
   ZI$DIR.:ZIC0TOU  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIU$DUMP.

   Procedure ZIU$DUMP requires 1217 words for executable code.
   Procedure ZIU$DUMP requires 36 words of local(AUTO) storage.

    No errors detected in file ZIU$DUMP.:ZIC0TSI    .

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:33   

 Object Unit name= ZIU$DUMP                                   File name= ZIU$DUMP.:ZIC0TOU
 UTS= SEP 05 '97 13:14:35.60 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none    66    102  ZIU$DUMP
    1  RoData even  UTS     44     54  ZIU$DUMP
    2   DCB   even  none     0      0  M$UC
    3   DCB   even  none     0      0  M$LO
    4   Proc  even  none  1217   2301  ZIU$DUMP
    5  RoData even  none    41     51  ZIU$DUMP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     4      0   yes    yes     yes      Std        0  ZIU$DUMP
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:34   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       0 SYS_FUNC_OPEN
 yes     yes           Std       0 SYS_FUNC_READ
 yes     yes           Std       0 CHECK_PAGES
 yes     yes           Std       0 SYS_FUNC_CLOS
 yes     yes           Std       0 BUILD_MSTR_TBL
 yes     yes           Std       0 SYS_FUNC_CHECK
 yes     yes           Std       0 SYS_FUNC_ERRMSG
 yes     yes           Std       0 SYS_FUNC_RELEASE
 yes     yes           Std       0 SYS_FUNC_WRIT
 yes     yes           Std       0 BUILD_SETXREF
         yes           Std       6 PAGE_RANGE
 yes     yes           Std       0 BUILD_RECXREF
 yes     yes           Std       0 SYS_FUNC_TSTAMP
         yes           Std       0 CHKSUM
         yes           Std       3 ZERO_SUP
 yes     yes           Std       0 GET_FILESIZE
 yes     yes           Std       0 SYS_FUNC_RELDCB
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:35   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     BUF_PTR                               NBUFS                                 HIGH_PAGE
     HIGH_DATA_PG                          NUM_INV_PGS                           LPP
     LOW_DBK                               M$UC                                  ZI$DIR
     SCHEMA_ACTIVE                         RECORD_LIST                           SET_LIST
     RETAIN_LIST                           DUMP_FID                              ALTKY
     INIT_RG                               KEY_RNG                               ITEM_LIST
     DATA$                                 INVPG$                                ATBLK$
     BLKLSF                                KEYLSF                                KEYXSF
     DCBSF                                 ORGSF                                 KEYSF
     KEYVSF                                ACSSF                                 NOTIMESF
     FUNSF                                 ASNSF                                 TESTSF
     XTENSIZESF                            DISPSF                                WAITSF
     VFCSF                                 FULLSF                                BKUPSF
     BUFLNSF                               BUFSF                                 SOURCESF
     DESTSF                                DATESF                                TIMESF
     UTSSF                                 DAYSF                                 TSTAMPSF
     ENCRP_SEEDSF                          ERRCODESF                             MSGCODE
     INCL_ERR                              ERR_INSERT                            FIDSF_RD
     ACNT                                  EXISTSF                               SHARESF
     DCBNMSF                               KEYRSF                                NO_KEYSF
     REASGNSF                              CARRY_ATTRIBUTESF                     SUBMESSF
     SPKY_OPNSF                            POSSF                                 ERRFLGSF
     MERGESF                               FSA_FLAG                              RELGSF
     UNUSED                                HELPCODE                              COUNTSF
     INDEXSF                               GAP                                   PSNSF
     ACNTSF                                KEY_SHADWSF                           REC$
     RB                                    RE                                    IE
     IB                                    CNT                                   ICNT
     RCNT                                  SCNT                                  FIRST_SET
     RETCNT                                DMPCNT                                KCNT
     ACNT_IDX                              I                                     J
     K                                     X                                     STEPCC
     I_O_BUF$                              OUT_INDX                              I_O_SIZE
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:36   
     REC_DATA_LN                           M$LO                                  B$TCB$
     B$ROS$                                B$JIT$                                KEYFID
     I_O_KEY                               RESTART                               BREAK_FLAG
     ICHKSUM                               ITMCNT                                GAP1
     TYPE                                  MSTR$                                 NXT_MSLOT
     MAX_MSLOT                             MSTR_INDX                             HASHTBL
     HASHINDX                              LOC_MODE                              AREA_KEY$
     NO_AREAS                              GLBL_PTR_SZ                           SET_XREF$
     NXT_SSLOT                             MAX_SSLOT                             REC_XREF$
     NXT_RSLOT                             MAX_RSLOT                             NO_RECS
     NO_SETS                               XREF_BUILT                            TYPESET
     TYPEREC

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 ROSID
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:37   


        1        1        /*T***********************************************************/
        2        2        /*T*                                                         */
        3        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        4        4        /*T*                                                         */
        5        5        /*T***********************************************************/
        6        6        /*P*
        7        7            NAME: ZIU$DUMP         10/79            D.F. HANRAHAN
        8        8         PURPOSE: To compress the empty data space out of an 'IDS' file
        9        9                  and write a backup of the area to a key file. Also to
       10       10                  back up any associated key files with an area.
       11       11                                DATA BASE DUMP ROUTINE
       12       12                                       ZIU$DUMP
       13       13
       14       14
       15       15               The purpose of the Data Base Dump routine is to provide a
       16       16               backup  for IDS area  files and  associated keyed  files.
       17       17               The DUMP program will dump  the IDS files to disc or tape
       18       18               and will  compress  out any  empty data  space within the
       19       19               data pages of the  file during the  process. This is done
       20       20               by  positioning  the  offset  array in  each  data  page,
       21       21               adjacent to the  last  byte of  data in  that page,  then
       22       22               discarding the  rest of that page  when writing it out to
       23       23               the dump file.
       24       24
       25       25               In addition  to the IDS  file, the  attribute page of the
       26       26               IDS file is  checked for  the existance  of an associated
       27       27               key file. If such a file is  suppose to exist, an attempt
       28       28               is  made  to  dump it  also.  For  this  operation  to be
       29       29               successful,  the  keyed  file  must  reside in  the  same
       30       30               account  as the area  file, and  must have  the save file
       31       31               name except with  a ':' appended to  the end. If the file
       32       32               is not found, a warning  message is issued along with the
       33       33               file name not found.
       34       34
       35       35               In all utility  operations, the  associated key file will
       36       36               be kept with the area file. Any set commands for the area
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:38   
       37       37               will be  applied to the  keyed file. Any  set commands on
       38       38               the keyed file name will be ignored.
       39       39
       40       40               The DUMP program will also  dump the inventory pages, but
       41       41               as is true with the attribute page, will not compress the
       42       42               page(s). After  certain  modifications  are made  to  the
       43       43               attribute page  to  reflect the  dump  attributes,  it is
       44       44               written to the dump file.  Note that an attribute page is
       45       45               always written.
       46       46
       47       47               The major dump options are available to reduce the amount
       48       48               of data being  backed up which is  especially useful when
       49       49               backing up large data bases. These are the page range and
       50       50               the dump 'AFTER' option.  The dump may be restricted to a
       51       51               desired page  range specified in the  directive. Also the
       52       52               clause 'AFTER yymmdd [,hhmmss]' may appear after the dump
       53       53               file name, and only data  pages within the specified page
       54       54               range  and  modified  after  the  date  specified by  the
       55       55               'yymmdd [,hhmmss]' clause will be dumped.
       56       56
       57       57
       58       58               The dump program is very straight foward in operation. It
       59       59               will  first  open  the  source  file  which  must  be  an
       60       60               integrated IDS file. The  file name is extracted from the
       61       61               DCB  after the  open in  case a  set  command was used to
       62       62               change the default file  name. Once the file is open, the
       63       63               area name in that  file is checked  against the area name
       64       64               in the directive  to ensure that the  areas are the same.
       65       65               Certain attributes are then  extracted to determine where
       66       66               the  inventory pages  are and  if there is  an associated
       67       67               keyed file. A dump ID is then put into the attribute page
       68       68               along with a  flag saying  whether or  not a partial dump
       69       69               was specified. This page is  then written out to the dump
       70       70               file with  a key of  zero. Note  that the  dump file is a
       71       71               keyed file and the the key of each page is the key of the
       72       72               corresponding IDS page key.
       73       73
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:39   
       74       74               A data page is read and  its' date is checked against the
       75       75               desired dump  'AFTER' date  if one was  specified. If the
       76       76               page is  to be  dumped, a  compress  routine is called to
       77       77               squeeze out  the  empty  data  space,  then  the page  is
       78       78               written out. When complete, a report is given on the file
       79       79               names used and the number of pages dumped.
       80       80
       81       81                                                                                         */
       82       82        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:40   
       83       83        /******************************************************************/
       84       84        ZIU$DUMP: PROC ALTRET;

     84  4 000000   000000 700200 xent  ZIU$DUMP     TSX0  ! X66_AUTO_0
         4 000001   000044 000000                    ZERO    36,0
         4 000002   000025 710000 4                  TRA     s:3048

       85       85    1   DCL AREADCB UBIN HALF;
       86       86    1   DCL DESTDCB UBIN HALF;
       87       87    1   DCL I_O_INDX SBIN HALF STATIC;
       88       88    1   DCL BUF_PTR UBIN WORD ALIGNED SYMREF;
       89       89    1   DCL NBUFS SBIN SYMREF ALIGNED; /*NUMBER OF I_O_BUF WE HAVE */
       90       90    1   DCL FIRST_CHK BIT(1) STATIC;
       91       91    1   DCL ACCEPT_PAGE BIT(1) STATIC UNAL;
       92       92    1   DCL LAST_PAGE BIT(1) STATIC UNAL;
       93       93    1   DCL RIGHT_JUSTIFY BIT(1) CONSTANT INIT('0'B) UNAL;
       94       94    1   DCL LEFT_JUSTIFY BIT(1) CONSTANT INIT('1'B) UNAL;
       95       95    1   DCL MSG_FLG BIT(1) STATIC INIT('0'B) UNAL;
       96       96    1   DCL CHECKSUM BIT(1) STATIC INIT('0'B) UNAL;
       97       97    1   DCL PRINT_CHKS BIT(1) STATIC INIT('0'B) UNAL;
       98       98    1   DCL BAD_CHK_LOW SBIN WORD STATIC ALIGNED;
       99       99    1   DCL BAD_CHK_HIGH SBIN WORD STATIC ALIGNED;
      100      100    1   DCL KEY_FILE_ASSOCIATED BIT(1) STATIC UNAL;
      101      101    1   DCL 1 I_O_TAB BASED(DATA$) ALIGNED,
      102      102    1         2 I_O_HW (0:2047) UNAL,
      103      103    1           3 * BIT(2) UNAL,
      104      104    1           3 VAL UBIN(16) UNAL;
      105      105    1   DCL PGE_DATE UBIN WORD BASED;
      106      106    1   DCL PGE_DATE$ PTR;
      107      107    1   DCL HIGH_PAGE UBIN WORD SYMREF ALIGNED;
      108      108    1   DCL HIGH_DATA_PG UBIN WORD SYMREF ALIGNED;
      109      109    1   DCL NUM_INV_PGS UBIN WORD SYMREF ALIGNED;
      110      110    1   DCL LPP SBIN WORD SYMREF ALIGNED;
      111      111    1   DCL LOW_DBK SBIN WORD SYMREF ALIGNED;
      112      112    1   DCL COMPRESS_SIZE UBIN WORD;
      113      113    1   DCL TOTL_PGS_DUMP UBIN STATIC INIT(1);
      114      114    1   DCL RB_SAVE UBIN STATIC;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:41   
      115      115    1   DCL RE_SAVE UBIN STATIC;
      116      116    1   DCL TAPE_BLOCK SBIN STATIC ALIGNED;
      117      117    1   DCL 1 SRCE_FILE STATIC,
      118      118    1         2 CNT UBIN(9) UNAL,
      119      119    1         2 TEXT CHAR(31) UNAL;
      120      120    1   DCL 1 DEST_FILE STATIC,
      121      121    1         2 CNT UBIN(9) UNAL,
      122      122    1         2 TEXT CHAR(31) UNAL;
      123      123    1   DCL REPRT CHAR(80) STATIC INIT(' ');
      124      124        /*
      125      125           Include files and macros
      126      126        */
      127      127        %INCLUDE CP_6;
      128      208         %F$DCB;
      129      265         %B$TCB;
      130      268         %B$EXCFR;
      131      286        %INCLUDE CP_6_SUBS;
      132      826        %INCLUDE B_ERRORS_C;
      133     1953        %INCLUDE ZI$DIR;
      134     2110         %DIR;
      135     2254        %INCLUDE ZI$PG_STRUCTS;
      136     2357         %DATA_PG;
      137     2376         %INVTY_PG;
      138     2392         %ATBLK_PG;
      139     2448        %INCLUDE ZI_GLOBAL_DBUTIL;
      140     2626         %SYS_FUNC;
      141     2718         %MISC_DCLS;
      142     2771         %INCLUDE ZI_DBU_XREF;
      143     2938         %XREF_TBLS;
      144     3013        /*
      145     3014            Declarations of external subroutines.
      146     3015        */
      147     3016    1   DCL SYS_FUNC_ERRMSG ENTRY ALTRET;
      148     3017    1   DCL SYS_FUNC_GETDCB ENTRY ALTRET;
      149     3018    1   DCL SYS_FUNC_OPEN ENTRY ALTRET;
      150     3019    1   DCL SYS_FUNC_READ ENTRY ALTRET;
      151     3020    1   DCL SYS_FUNC_WRIT ENTRY ALTRET;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:42   
      152     3021    1   DCL SYS_FUNC_RELDCB ENTRY ALTRET;
      153     3022    1   DCL SYS_FUNC_TSTAMP ENTRY ALTRET;
      154     3023    1   DCL SYS_FUNC_CLOS ENTRY ALTRET;
      155     3024    1   DCL SYS_FUNC_CORRES ENTRY(2) ALTRET;
      156     3025    1   DCL SYS_FUNC_CHECK ENTRY ALTRET;
      157     3026    1   DCL GET_FILESIZE ENTRY ALTRET;
      158     3027    1   DCL SYS_FUNC_RELEASE ENTRY ALTRET;
      159     3028    1   DCL PAGE_RANGE ENTRY(6);
      160     3029    1   DCL ZERO_SUP ENTRY(3);
      161     3030    1   DCL CHKSUM ENTRY;
      162     3031    1   DCL BUILD_MSTR_TBL ENTRY ALTRET;
      163     3032    1   DCL BUILD_SETXREF ENTRY ALTRET;
      164     3033    1   DCL BUILD_RECXREF ENTRY ALTRET;
      165     3034    1   DCL CHECK_PAGES ENTRY ALTRET;
      166     3035        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:43   
      167     3036    1   DUMPING_MSG: PROC;

   3036  4 000003   200012 741300       DUMPING_MSG  STX1  ! @FILE_TYPE+1,,AUTO

      168     3037    2       REPRT = '..Dumping';

   3037  4 000004   040000 100400                    MLR     fill='040'O
         4 000005   000002 000011 1                  ADSC9   LEFT_JUSTIFY+1           cn=0,n=9
         4 000006   000036 000120 0                  ADSC9   REPRT                    cn=0,n=80

      169     3038    2   /**/ DCBSF = DCBNUM(M$LO);

   3038  4 000007   000000 236007 xsym               LDQ     M$LO,DL
         4 000010   000000 620006                    EAX0    0,QL
         4 000011   000000 740000 xsym               STX0    DCBSF

      170     3039    2   /**/ BUFSF = VECTOR(REPRT);

   3039  4 000012   000000 237000 5                  LDAQ    0
         4 000013   000000 755000 xsym               STA     BUFSF
         4 000014   000001 756000 xsym               STQ     BUFSF+1

      171     3040    2   /**/ BUFLNSF = 10;

   3040  4 000015   000012 235007                    LDA     10,DL
         4 000016   000000 755000 xsym               STA     BUFLNSF

      172     3041    2   /**/ VFCSF = %NO#;

   3041  4 000017   000000 450000 xsym               STZ     VFCSF

      173     3042    2       CALL SYS_FUNC_WRIT;

   3042  4 000020   000002 631400 5                  EPPR1   2
         4 000021   000000 701000 xent               TSX1    SYS_FUNC_WRIT
         4 000022   000000 011000                    NOP     0

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:44   
      174     3043    2   END DUMPING_MSG;

   3043  4 000023   200012 221300                    LDX1  ! @FILE_TYPE+1,,AUTO
         4 000024   000001 702211                    TSX2  ! 1,X1

      175     3044
      176     3045        /*
      177     3046                 OPEN AND CHECK SOURCE FILE FOR IDS ORGANIZATION
      178     3047        */
      179     3048    1       AREADCB = ZI$DIR.SRCE_NM.DCB#;

   3048  4 000025   000255 220000 xsym               LDX0    ZI$DIR+173
         4 000026   200003 740100                    STX0    AREADCB,,AUTO

      180     3049    1   /**/ DCBSF = AREADCB; /* DCB NUMBER FOR AREA OPENED */

   3049  4 000027   000000 740000 xsym               STX0    DCBSF

      181     3050    1   /**/ ORGSF = %IDS#; /* FILE ORGANIZATION */

   3050  4 000030   000007 235007                    LDA     7,DL
         4 000031   000000 755000 xsym               STA     ORGSF

      182     3051    1   /**/ TESTSF =%NO#; /* TEST OPEN = NO */

   3051  4 000032   000000 450000 xsym               STZ     TESTSF

      183     3052    1   /**/ ACSSF = %DIRECT#; /* ACCESS MODE */

   3052  4 000033   000002 236007                    LDQ     2,DL
         4 000034   000000 756000 xsym               STQ     ACSSF

      184     3053    1   /**/ FUNSF = %IN#; /* ONLY IN,SHARE=IN OR IN,SHARE=ALL CAN OPEN */

   3053  4 000035   000000 756000 xsym               STQ     FUNSF

      185     3054    1   /**/ ASNSF = %FILE#; /* ASN# PARAMETER */
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:45   

   3054  4 000036   000001 235007                    LDA     1,DL
         4 000037   000000 755000 xsym               STA     ASNSF

      186     3055    1   /**/ FIDSF = ZI$DIR.SRCE_NM.NAME.TEXT; /*     DCB NAME */

   3055  4 000040   040000 100400                    MLR     fill='040'O
         4 000041   000245 200036 xsym               ADSC9   ZI$DIR+165               cn=1,n=30
         4 000042   000000 000036 xsym               ADSC9   FIDSF_RD                 cn=0,n=30

      187     3056    1   /**/ SHARESF = %IN#; /* SHARE PARAMETER */

   3056  4 000043   400000 236003                    LDQ     -131072,DU
         4 000044   000000 756000 xsym               STQ     SHARESF

      188     3057    1       CALL SYS_FUNC_OPEN ALTRET(ALT_SOURCE_FILE);

   3057  4 000045   000002 631400 5                  EPPR1   2
         4 000046   000000 701000 xent               TSX1    SYS_FUNC_OPEN
         4 000047   002215 702000 4                  TSX2    ALT_SOURCE_FILE

      189     3058
      190     3059    1       SRCE_FILE = DCBADDR(AREADCB) -> F$DCB.NAME#;

   3059  4 000050   000003 470400 5                  LDP0    3
         4 000051   000000 471500                    LDP1    0,,PR0
         4 000052   200003 220100                    LDX0    AREADCB,,AUTO
         4 000053   100000 473510                    LDP3    0,X0,PR1
         4 000054   000000 100500                    MLR     fill='000'O
         4 000055   300010 000040                    ADSC9   8,,PR3                   cn=0,n=32
         4 000056   000016 000040 0                  ADSC9   SRCE_FILE                cn=0,n=32

      191     3060    1       DESTDCB = ZI$DIR.DEST_NM.DCB#;

   3060  4 000057   000266 221000 xsym               LDX1    ZI$DIR+182
         4 000060   200004 741100                    STX1    DESTDCB,,AUTO

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:46   
      192     3061    1       IF DCBADDR(AREADCB)->F$DCB.ORG#=%INDEXED# THEN

   3061  4 000061   300032 236100                    LDQ     26,,PR3
         4 000062   777000 376003                    ANQ     -512,DU
         4 000063   006000 116003                    CMPQ    3072,DU
         4 000064   000076 601000 4                  TNZ     s:3069

      193     3062    2       DO;

      194     3063    2           DCBSF=AREADCB; /* REOPEN SOURCE WITH BLOCK */

   3063  4 000065   000000 740000 xsym               STX0    DCBSF

      195     3064    2           CALL SYS_FUNC_CLOS ALTRET(ALT_SOURCE_FILE);

   3064  4 000066   000002 631400 5                  EPPR1   2
         4 000067   000000 701000 xent               TSX1    SYS_FUNC_CLOS
         4 000070   002215 702000 4                  TSX2    ALT_SOURCE_FILE

      196     3065    2           CALL DUMP_INDEX_FILE('IND') ALTRET(ALT_DEST_FILE);

   3065  4 000071   000004 236000 5                  LDQ     4
         4 000072   200011 756100                    STQ     COMPRESS_SIZE+3,,AUTO
         4 000073   001424 701000 4                  TSX1    DUMP_INDEX_FILE
         4 000074   002233 702000 4                  TSX2    ALT_DEST_FILE

      197     3066    2           GOTO END_OF_DUMP;

   3066  4 000075   000621 710000 4                  TRA     END_OF_DUMP

      198     3067    2           END;
      199     3068    1       ELSE
      200     3069    1           IF DCBADDR(AREADCB)->F$DCB.ORG# ~= %IDS# THEN

   3069  4 000076   007000 116003                    CMPQ    3584,DU
         4 000077   000115 600000 4                  TZE     s:3080

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:47   
      201     3070    2           DO;

      202     3071         /*E* ERROR: ZIU-01004-C
      203     3072                    MESSAGE: ..%FN is not an IDS/INDEX file - dump aborted! */
      204     3073    2               ERRCODESF.ERR# = 1004;

   3073  4 000100   000000 236000 xsym               LDQ     ERRCODESF
         4 000101   000005 376000 5                  ANQ     5
         4 000102   017540 276007                    ORQ     8032,DL
         4 000103   000000 756000 xsym               STQ     ERRCODESF

      205     3074    2               MSGCODE = ERRCODE_RDEF;

   3074  4 000104   000000 756000 xsym               STQ     MSGCODE

      206     3075    2               ERRFLGSF = 4;

   3075  4 000105   004000 236003                    LDQ     2048,DU
         4 000106   000000 756000 xsym               STQ     ERRFLGSF

      207     3076    2               CALL SYS_FUNC_ERRMSG;

   3076  4 000107   000002 631400 5                  EPPR1   2
         4 000110   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         4 000111   000000 011000                    NOP     0

      208     3077    2               CALL CLOSE_FILES;

   3077  4 000112   002142 701000 4                  TSX1    CLOSE_FILES
         4 000113   000000 011000                    NOP     0

      209     3078    2               ALTRETURN;

   3078  4 000114   000000 702200 xent               TSX2  ! X66_AALT

      210     3079    2               END;
      211     3080    1       CALL GET_ATBLK(NUM_INV_PGS,HIGH_DATA_PG,HIGH_PAGE)
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:48   

   3080  4 000115   000006 237000 5                  LDAQ    6
         4 000116   200012 757100                    STAQ    @FILE_TYPE+1,,AUTO
         4 000117   000010 236000 5                  LDQ     8
         4 000120   200011 756100                    STQ     COMPRESS_SIZE+3,,AUTO
         4 000121   000736 701000 4                  TSX1    GET_ATBLK
         4 000122   002266 702000 4                  TSX2    ALT_RD_ATBLK

      212     3081    1          ALTRET(ALT_RD_ATBLK);
      213     3082        /*
      214     3083              Open destination file -
      215     3084              the dump file will be keyed with key of zero as attribute page.
      216     3085        */
      217     3086    1   /**/ DCBSF = DESTDCB;

   3086  4 000123   200004 220100                    LDX0    DESTDCB,,AUTO
         4 000124   000000 740000 xsym               STX0    DCBSF

      218     3087    1   /**/ ORGSF = %KEYED#;

   3087  4 000125   000002 235007                    LDA     2,DL
         4 000126   000000 755000 xsym               STA     ORGSF

      219     3088    1   /**/ TESTSF = %NO#;

   3088  4 000127   000000 450000 xsym               STZ     TESTSF

      220     3089    1   /**/ XTENSIZESF = 1; /* CREATE A DUMMY DUMP FILE FIRST */

   3089  4 000130   000001 236007                    LDQ     1,DL
         4 000131   000000 756000 xsym               STQ     XTENSIZESF

      221     3090    1   /**/ ASNSF = %FILE#;

   3090  4 000132   000000 756000 xsym               STQ     ASNSF

      222     3091    1   /**/ ACSSF = %DIRECT#;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:49   

   3091  4 000133   000000 755000 xsym               STA     ACSSF

      223     3092    1   /**/ FUNSF = %CREATE#;

   3092  4 000134   000003 235007                    LDA     3,DL
         4 000135   000000 755000 xsym               STA     FUNSF

      224     3093    1   /**/ BKUPSF = %YES#;

   3093  4 000136   400000 236003                    LDQ     -131072,DU
         4 000137   000000 756000 xsym               STQ     BKUPSF

      225     3094    1   /**/ ACNT = ZI$DIR.ACNT;

   3094  4 000140   000000 100400                    MLR     fill='000'O
         4 000141   000002 400120 xsym               ADSC9   ZI$DIR+2                 cn=2,n=80
         4 000142   000000 000120 xsym               ADSC9   ACNT                     cn=0,n=80

      226     3095    1   /**/ FIDSF = ZI$DIR.DEST_NM.NAME.TEXT;

   3095  4 000143   040000 100400                    MLR     fill='040'O
         4 000144   000256 200036 xsym               ADSC9   ZI$DIR+174               cn=1,n=30
         4 000145   000000 000036 xsym               ADSC9   FIDSF_RD                 cn=0,n=30

      227     3096    1   /**/ EXISTSF = ZI$DIR.OPEN_MODE;

   3096  4 000146   000125 236000 xsym               LDQ     ZI$DIR+85
         4 000147   000040 772000                    QRL     32
         4 000150   000003 376007                    ANQ     3,DL
         4 000151   000042 736000                    QLS     34
         4 000152   000000 756000 xsym               STQ     EXISTSF

      228     3097    1   /**/ SHARESF = %NONE#;

   3097  4 000153   600000 236003                    LDQ     -65536,DU
         4 000154   000000 756000 xsym               STQ     SHARESF
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:50   

      229     3098    1       CALL SYS_FUNC_OPEN ALTRET(ALT_DEST_FILE);

   3098  4 000155   000002 631400 5                  EPPR1   2
         4 000156   000000 701000 xent               TSX1    SYS_FUNC_OPEN
         4 000157   002233 702000 4                  TSX2    ALT_DEST_FILE

      230     3099        /*
      231     3100            RELEASE THE FILE JUST OPENED, SO THAT IF DEST IS A DISK FILE
      232     3101            IT WILL BE ERASED TO AVIOD OUT OF DISK SPACE, AND IF IT IS
      233     3102            A TAPE FILE, WE SHALL SET THE PROPER BLOCK SIZE IN TAPE
      234     3103            DEPENDING UPON THE DENSITY OF THE TAPE.
      235     3104        */
      236     3105    1       CALL SYS_FUNC_RELEASE ALTRET(ALT_DEST_FILE);

   3105  4 000160   000002 631400 5                  EPPR1   2
         4 000161   000000 701000 xent               TSX1    SYS_FUNC_RELEASE
         4 000162   002233 702000 4                  TSX2    ALT_DEST_FILE

      237     3106    1       IF DCBADDR(DESTDCB)->F$DCB.ASN#=%TAPE# THEN

   3106  4 000163   000003 470400 5                  LDP0    3
         4 000164   000000 471500                    LDP1    0,,PR0
         4 000165   200004 220100                    LDX0    DESTDCB,,AUTO
         4 000166   100000 473510                    LDP3    0,X0,PR1
         4 000167   300032 236100                    LDQ     26,,PR3
         4 000170   777000 376007                    ANQ     -512,DL
         4 000171   002000 116007                    CMPQ    1024,DL
         4 000172   000212 601000 4                  TNZ     s:3117

      238     3107    2       DO; /* DUMP TO TAPE FILE, SO SET BLOCK=YES AND BLKL */

      239     3108    2           IF DCBADDR(DESTDCB)->F$DCB.DENSITY#<3 THEN

   3108  4 000173   300043 236100                    LDQ     35,,PR3
         4 000174   000777 376007                    ANQ     511,DL
         4 000175   000003 116007                    CMPQ    3,DL
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:51   
         4 000176   000202 603000 4                  TRC     s:3111

      240     3109    2               TAPE_BLOCK = 8; /* FOR BPI<1600, USE BIG BLOCK */

   3109  4 000177   000010 235007                    LDA     8,DL
         4 000200   000015 755000 0                  STA     TAPE_BLOCK
         4 000201   000210 710000 4                  TRA     s:3115

      241     3110    2           ELSE
      242     3111    2               IF DCBADDR(DESTDCB)->F$DCB.DENSITY#=3 THEN

   3111  4 000202   000206 601000 4                  TNZ     s:3114

      243     3112    2                   TAPE_BLOCK=4; /* BPI=1600,USE 4K BLOCK */

   3112  4 000203   000004 235007                    LDA     4,DL
         4 000204   000015 755000 0                  STA     TAPE_BLOCK
         4 000205   000210 710000 4                  TRA     s:3115

      244     3113    2               ELSE
      245     3114    2                   TAPE_BLOCK = 2; /* FOR HIGH DENSITY, USE SMALLER BLOCK */

   3114  4 000206   000002 235007                    LDA     2,DL
         4 000207   000015 755000 0                  STA     TAPE_BLOCK

      246     3115    2           BLKLSF = TAPE_BLOCK*4096;

   3115  4 000210   000014 735000                    ALS     12
         4 000211   000000 755000 xsym               STA     BLKLSF

      247     3116    2           END;

      248     3117    1       XTENSIZESF = HIGH_PAGE/4;

   3117  4 000212   000000 236000 xsym               LDQ     HIGH_PAGE
         4 000213   000002 772000                    QRL     2
         4 000214   000000 756000 xsym               STQ     XTENSIZESF
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:52   

      249     3118    1       ACNT = ZI$DIR.ACNT;

   3118  4 000215   000000 100400                    MLR     fill='000'O
         4 000216   000002 400120 xsym               ADSC9   ZI$DIR+2                 cn=2,n=80
         4 000217   000000 000120 xsym               ADSC9   ACNT                     cn=0,n=80

      250     3119    1       CALL SYS_FUNC_OPEN ALTRET(ALT_DEST_FILE);

   3119  4 000220   000002 631400 5                  EPPR1   2
         4 000221   000000 701000 xent               TSX1    SYS_FUNC_OPEN
         4 000222   002233 702000 4                  TSX2    ALT_DEST_FILE

      251     3120
      252     3121        /*
      253     3122           Extract the file name actually opened in case a set
      254     3123           set command was used to overwrite the default.
      255     3124        */
      256     3125    1       DEST_FILE = DCBADDR(DESTDCB) -> F$DCB.NAME#;

   3125  4 000223   000003 470400 5                  LDP0    3
         4 000224   000000 471500                    LDP1    0,,PR0
         4 000225   200004 220100                    LDX0    DESTDCB,,AUTO
         4 000226   100000 473510                    LDP3    0,X0,PR1
         4 000227   000000 100500                    MLR     fill='000'O
         4 000230   300010 000040                    ADSC9   8,,PR3                   cn=0,n=32
         4 000231   000026 000040 0                  ADSC9   DEST_FILE                cn=0,n=32

      257     3126        /*
      258     3127                 Write out attribute page...
      259     3128                 Set key size for keyed file write - dump file keys
      260     3129                 will be identicle to 'IDS' keys except in textc format.
      261     3130        */
      262     3131    1       KEYVSF.LEN = 4;

   3131  4 000232   004000 236003                    LDQ     2048,DU
         4 000233   000000 552040 xsym               STBQ    KEYVSF,'40'O
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:53   

      263     3132    1   /**/ DCBSF = DESTDCB;

   3132  4 000234   000000 740000 xsym               STX0    DCBSF

      264     3133    1   /**/ ENCRP_SEEDSF = ZI$DIR.DEST_SEED;

   3133  4 000235   000030 236000 xsym               LDQ     ZI$DIR+24
         4 000236   000000 756000 xsym               STQ     ENCRP_SEEDSF

      265     3134    1   /**/ WAITSF = %YES#;

   3134  4 000237   400000 236003                    LDQ     -131072,DU
         4 000240   000000 756000 xsym               STQ     WAITSF

      266     3135    1   /**/ VFCSF = %NO#;

   3135  4 000241   000000 450000 xsym               STZ     VFCSF

      267     3136    1   /**/ BUFLNSF = 4096;

   3136  4 000242   010000 235007                    LDA     4096,DL
         4 000243   000000 755000 xsym               STA     BUFLNSF

      268     3137    1   /**/ KEYVSF.IDSKEY = 0;

   3137  4 000244   000000 100400                    MLR     fill='000'O
         4 000245   000002 000004 5                  ADSC9   2                        cn=0,n=4
         4 000246   000000 200004 xsym               ADSC9   KEYVSF                   cn=1,n=4

      269     3138    1       CALL SYS_FUNC_WRIT ALTRET(ALT_WRITE_DEST);

   3138  4 000247   000002 631400 5                  EPPR1   2
         4 000250   000000 701000 xent               TSX1    SYS_FUNC_WRIT
         4 000251   002260 702000 4                  TSX2    ALT_WRITE_DEST

      270     3139    1       TOTL_PGS_DUMP = 1; /* INCLUDING FILE_INFO (FIT) */
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:54   

   3139  4 000252   000001 235007                    LDA     1,DL
         4 000253   000012 755000 0                  STA     TOTL_PGS_DUMP

      271     3140    1       LAST_PAGE = %NO# ;

   3140  4 000254   000003 450000 0                  STZ     LAST_PAGE

      272     3141    1       FIRST_CHK = %YES# ;

   3141  4 000255   400000 236003                    LDQ     -131072,DU
         4 000256   000001 756000 0                  STQ     FIRST_CHK

      273     3142    1       IF ZI$DIR.CHECK = %YES# THEN

   3142  4 000257   000125 430000 xsym               FSZN    ZI$DIR+85
         4 000260   000323 605000 4                  TPL     s:3160

      274     3143    2       DO;

      275     3144    2           IF XREF_BUILT = %NO# THEN

   3144  4 000261   000000 234000 xsym               SZN     XREF_BUILT
         4 000262   000274 604000 4                  TMI     s:3150

      276     3145    3           DO;

      277     3146    3               CALL BUILD_MSTR_TBL ALTRET(ALT_AREA_READ);

   3146  4 000263   000002 631400 5                  EPPR1   2
         4 000264   000000 701000 xent               TSX1    BUILD_MSTR_TBL
         4 000265   002255 702000 4                  TSX2    ALT_AREA_READ

      278     3147    3               CALL BUILD_SETXREF ALTRET(ALT_AREA_READ);

   3147  4 000266   000002 631400 5                  EPPR1   2
         4 000267   000000 701000 xent               TSX1    BUILD_SETXREF
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:55   
         4 000270   002255 702000 4                  TSX2    ALT_AREA_READ

      279     3148    3               CALL BUILD_RECXREF ALTRET(ALT_AREA_READ);

   3148  4 000271   000002 631400 5                  EPPR1   2
         4 000272   000000 701000 xent               TSX1    BUILD_RECXREF
         4 000273   002255 702000 4                  TSX2    ALT_AREA_READ

      280     3149    3               END;

      281     3150    2           X = 0;

   3150  4 000274   000000 450000 xsym               STZ     X

      282     3151    3           DO WHILE(ZI$DIR.AREA_NM.NAME.TEXT ~= AREA_KEY_XREF.NAME(X));

   3151  4 000275   000000 236000 xsym               LDQ     X
         4 000276   000050 402007                    MPY     40,DL
         4 000277   000000 470400 xsym               LDP0    AREA_KEY$
         4 000300   040106 106400                    CMPC    fill='040'O
         4 000301   000234 200036 xsym               ADSC9   ZI$DIR+156               cn=1,n=30
         4 000302   000001 400036                    ADSC9   1,Q,PR0                  cn=2,n=30
         4 000303   000314 600000 4                  TZE     s:3154

      283     3152    3               X = X +1;

   3152  4 000304   000000 054000 xsym               AOS     X

      284     3153    3               END;

   3153  4 000305   000000 236000 xsym               LDQ     X
         4 000306   000050 402007                    MPY     40,DL
         4 000307   000000 470400 xsym               LDP0    AREA_KEY$
         4 000310   040106 106400                    CMPC    fill='040'O
         4 000311   000234 200036 xsym               ADSC9   ZI$DIR+156               cn=1,n=30
         4 000312   000001 400036                    ADSC9   1,Q,PR0                  cn=2,n=30
         4 000313   000304 601000 4                  TNZ     s:3152
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:56   

      285     3154    2           AREA_KEY_XREF.CHECKED(X) = 1;

   3154  4 000314   000000 236000 xsym               LDQ     X
         4 000315   000012 402007                    MPY     10,DL
         4 000316   000000 620006                    EAX0    0,QL
         4 000317   000011 236106                    LDQ     9,QL,PR0
         4 000320   000011 376000 5                  ANQ     9
         4 000321   000001 276003                    ORQ     1,DU
         4 000322   000011 756110                    STQ     9,X0,PR0

      286     3155    2           END;

      287     3156        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:57   
      288     3157        /*------------------------------------------------------------------
      289     3158                     B E G I N   D U M P I N G   A R E A
      290     3159          ----------------------------------------------------------------*/
      291     3160    1       CALL DUMPING_MSG; /* OUTPUT ..DUMPING MSG */

   3160  4 000323   000003 701000 4                  TSX1    DUMPING_MSG
         4 000324   000000 011000                    NOP     0

      292     3161    1       CALL PAGE_RANGE(RB_SAVE,RE_SAVE,NBUFS,I_O_SIZE,HIGH_PAGE,LAST_PAGE);

   3161  4 000325   000013 630400 5                  EPPR0   11
         4 000326   000012 631400 5                  EPPR1   10
         4 000327   000000 701000 xent               TSX1    PAGE_RANGE
         4 000330   000000 011000                    NOP     0

      293     3162    1       BUF_PTR = NBUFS;

   3162  4 000331   000000 235000 xsym               LDA     NBUFS
         4 000332   000000 755000 xsym               STA     BUF_PTR

      294     3163    1       BUFSF = VECTOR(I_O_BUF);

   3163  4 000333   000021 235000 5                  LDA     17
         4 000334   000000 236000 xsym               LDQ     I_O_BUF$
         4 000335   000000 755000 xsym               STA     BUFSF
         4 000336   000001 756000 xsym               STQ     BUFSF+1

      295     3164    1       BUFLNSF = I_O_SIZE * 4096;

   3164  4 000337   000000 235000 xsym               LDA     I_O_SIZE
         4 000340   000014 735000                    ALS     12
         4 000341   000000 755000 xsym               STA     BUFLNSF

      296     3165    1       FULLSF = %YES#;

   3165  4 000342   400000 236003                    LDQ     -131072,DU
         4 000343   000000 756000 xsym               STQ     FULLSF
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:58   

      297     3166    1       KEYSF = %YES#;

   3166  4 000344   000000 756000 xsym               STQ     KEYSF

      298     3167    1       KEYVSF.IDSKEY = RB_SAVE;

   3167  4 000345   000000 100400                    MLR     fill='000'O
         4 000346   000013 000004 0                  ADSC9   RB_SAVE                  cn=0,n=4
         4 000347   000000 200004 xsym               ADSC9   KEYVSF                   cn=1,n=4

      299     3168    1       ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;

   3168  4 000350   000027 236000 xsym               LDQ     ZI$DIR+23
         4 000351   000000 756000 xsym               STQ     ENCRP_SEEDSF

      300     3169    1       DCBSF = ZI$DIR.SRCE_NM.DCB#;

   3169  4 000352   000255 220000 xsym               LDX0    ZI$DIR+173
         4 000353   000000 740000 xsym               STX0    DCBSF

      301     3170    1       WAITSF = %NO#; /* NO WAIT READ */

   3170  4 000354   000000 450000 xsym               STZ     WAITSF

      302     3171    1       CALL SYS_FUNC_READ ALTRET(ALT_AREA_READ);

   3171  4 000355   000002 631400 5                  EPPR1   2
         4 000356   000000 701000 xent               TSX1    SYS_FUNC_READ
         4 000357   002255 702000 4                  TSX2    ALT_AREA_READ

      303     3172
      304     3173    2       DO WHILE(~LAST_PAGE);

   3173  4 000360   000550 710000 4                  TRA     s:3223

      305     3174    2           IF BREAK_FLAG > 0 THEN
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:59   

   3174  4 000361   000000 235000 xsym               LDA     BREAK_FLAG
         4 000362   000366 604400 4                  TMOZ    s:3179

      306     3175    3           DO;

      307     3176    3               CALL CLOSE_FILES;

   3176  4 000363   002142 701000 4                  TSX1    CLOSE_FILES
         4 000364   000000 011000                    NOP     0

      308     3177    3               RETURN;

   3177  4 000365   000000 702200 xent               TSX2  ! X66_ARET

      309     3178    3               END;
      310     3179    2           RB=RB_SAVE;

   3179  4 000366   000013 236000 0                  LDQ     RB_SAVE
         4 000367   000000 756000 xsym               STQ     RB

      311     3180    2           RE=RE_SAVE;

   3180  4 000370   000014 235000 0                  LDA     RE_SAVE
         4 000371   000000 755000 xsym               STA     RE

      312     3181    2           BUFSF = VECTOR(I_O_BUF(BUF_PTR)); /* NEXT BUF TO READ */

   3181  4 000372   000021 235000 5                  LDA     17
         4 000373   000000 236000 xsym               LDQ     BUF_PTR
         4 000374   000034 736000                    QLS     28
         4 000375   000000 036000 xsym               ADLQ    I_O_BUF$
         4 000376   000000 755000 xsym               STA     BUFSF
         4 000377   000001 756000 xsym               STQ     BUFSF+1

      313     3182    2           BUF_PTR = NBUFS - BUF_PTR; /* CURRENT BUF */

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:60   
   3182  4 000400   000000 236000 xsym               LDQ     NBUFS
         4 000401   000000 136000 xsym               SBLQ    BUF_PTR
         4 000402   000000 756000 xsym               STQ     BUF_PTR

      314     3183    2           CALL PAGE_RANGE(RB_SAVE,RE_SAVE,NBUFS,I_O_SIZE,HIGH_PAGE,LAST_PAGE);

   3183  4 000403   000013 630400 5                  EPPR0   11
         4 000404   000012 631400 5                  EPPR1   10
         4 000405   000000 701000 xent               TSX1    PAGE_RANGE
         4 000406   000000 011000                    NOP     0

      315     3184    2           DCBSF = ZI$DIR.SRCE_NM.DCB#;

   3184  4 000407   000255 220000 xsym               LDX0    ZI$DIR+173
         4 000410   000000 740000 xsym               STX0    DCBSF

      316     3185    2           CALL SYS_FUNC_CHECK ALTRET(ALT_AREA_READ);

   3185  4 000411   000002 631400 5                  EPPR1   2
         4 000412   000000 701000 xent               TSX1    SYS_FUNC_CHECK
         4 000413   002255 702000 4                  TSX2    ALT_AREA_READ

      317     3186    2           IF ~LAST_PAGE THEN

   3186  4 000414   000003 236000 0                  LDQ     LAST_PAGE
         4 000415   400000 376003                    ANQ     -131072,DU
         4 000416   400000 676003                    ERQ     -131072,DU
         4 000417   000437 600000 4                  TZE     s:3196

      318     3187    3           DO;

      319     3188    3               BUFLNSF = 4096 * I_O_SIZE;

   3188  4 000420   000000 235000 xsym               LDA     I_O_SIZE
         4 000421   000014 735000                    ALS     12
         4 000422   000000 755000 xsym               STA     BUFLNSF

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:61   
      320     3189    3               FULLSF = %YES#;

   3189  4 000423   400000 236003                    LDQ     -131072,DU
         4 000424   000000 756000 xsym               STQ     FULLSF

      321     3190    3               KEYSF = %YES#;

   3190  4 000425   000000 756000 xsym               STQ     KEYSF

      322     3191    3               KEYVSF.IDSKEY = RB_SAVE;

   3191  4 000426   000000 100400                    MLR     fill='000'O
         4 000427   000013 000004 0                  ADSC9   RB_SAVE                  cn=0,n=4
         4 000430   000000 200004 xsym               ADSC9   KEYVSF                   cn=1,n=4

      323     3192    3               ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;

   3192  4 000431   000027 236000 xsym               LDQ     ZI$DIR+23
         4 000432   000000 756000 xsym               STQ     ENCRP_SEEDSF

      324     3193    3               WAITSF = %NO#; /* PREPARE FOR NEXT READ AHEAD */

   3193  4 000433   000000 450000 xsym               STZ     WAITSF

      325     3194    3               CALL SYS_FUNC_READ ALTRET(ALT_AREA_READ);

   3194  4 000434   000002 631400 5                  EPPR1   2
         4 000435   000000 701000 xent               TSX1    SYS_FUNC_READ
         4 000436   002255 702000 4                  TSX2    ALT_AREA_READ

      326     3195    3               END;

      327     3196    2           I_O_INDX = BUF_PTR;

   3196  4 000437   000000 720000 xsym               LXL0    BUF_PTR
         4 000440   000000 740000 0                  STX0    I_O_INDX

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:62   
      328     3197    2           IF ZI$DIR.CHECK = %YES# THEN

   3197  4 000441   000125 430000 xsym               FSZN    ZI$DIR+85
         4 000442   000446 605000 4                  TPL     s:3199

      329     3198    2               CALL CHECK_PAGES;

   3198  4 000443   000002 631400 5                  EPPR1   2
         4 000444   000000 701000 xent               TSX1    CHECK_PAGES
         4 000445   000000 011000                    NOP     0

      330     3199    3           DO RB = RB TO RE;

   3199  4 000446   000545 710000 4                  TRA     s:3222+3

      331     3200    3               DATA$ = ADDR(I_O_BUF(I_O_INDX));

   3200  4 000447   000000 236000 0                  LDQ     I_O_INDX
         4 000450   777777 376003                    ANQ     -1,DU
         4 000451   000012 736000                    QLS     10
         4 000452   000000 036000 xsym               ADLQ    I_O_BUF$
         4 000453   000000 756000 xsym               STQ     DATA$

      332     3201    3               PGE_DATE$ = PINCRW(DATA$,1);

   3201  4 000454   000001 036003                    ADLQ    1,DU
         4 000455   200005 756100                    STQ     PGE_DATE$,,AUTO

      333     3202    3               CALL CHK_DATE(PGE_DATE$->PGE_DATE,ACCEPT_PAGE)

   3202  4 000456   000022 236000 5                  LDQ     18
         4 000457   200012 756100                    STQ     @FILE_TYPE+1,,AUTO
         4 000460   200005 236100                    LDQ     PGE_DATE$,,AUTO
         4 000461   200011 756100                    STQ     COMPRESS_SIZE+3,,AUTO
         4 000462   001107 701000 4                  TSX1    CHK_DATE
         4 000463   002263 702000 4                  TSX2    ALT_DATE

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:63   
      334     3203    3                  ALTRET (ALT_DATE);
      335     3204    3               IF ACCEPT_PAGE THEN

   3204  4 000464   000002 234000 0                  SZN     ACCEPT_PAGE
         4 000465   000537 605000 4                  TPL     s:3221

      336     3205    4               DO;

      337     3206    4                   IF CHECKSUM AND RB <= HIGH_DATA_PG THEN

   3206  4 000466   000005 234000 0                  SZN     CHECKSUM
         4 000467   000475 605000 4                  TPL     s:3208
         4 000470   000000 236000 xsym               LDQ     HIGH_DATA_PG
         4 000471   000000 116000 xsym               CMPQ    RB
         4 000472   000475 602000 4                  TNC     s:3208

      338     3207    4                       CALL CHECK_SUM;

   3207  4 000473   001167 701000 4                  TSX1    CHECK_SUM
         4 000474   000000 011000                    NOP     0

      339     3208    4                   COMPRESS_SIZE = 4096;

   3208  4 000475   010000 235007                    LDA     4096,DL
         4 000476   200006 755100                    STA     COMPRESS_SIZE,,AUTO

      340     3209    4                   IF RB <= HIGH_DATA_PG THEN

   3209  4 000477   000000 236000 xsym               LDQ     HIGH_DATA_PG
         4 000500   000000 116000 xsym               CMPQ    RB
         4 000501   000506 602000 4                  TNC     s:3211

      341     3210    4                       CALL COMPRESS_PAGE(COMPRESS_SIZE);

   3210  4 000502   200006 630500                    EPPR0   COMPRESS_SIZE,,AUTO
         4 000503   200011 450500                    STP0    COMPRESS_SIZE+3,,AUTO
         4 000504   000641 701000 4                  TSX1    COMPRESS_PAGE
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:64   
         4 000505   000000 011000                    NOP     0

      342     3211    4    /**/           DCBSF = DESTDCB;

   3211  4 000506   200004 220100                    LDX0    DESTDCB,,AUTO
         4 000507   000000 740000 xsym               STX0    DCBSF

      343     3212    4    /**/           BUFSF = VECTOR(I_O_BUF(I_O_INDX));

   3212  4 000510   000021 235000 5                  LDA     17
         4 000511   000000 236000 0                  LDQ     I_O_INDX
         4 000512   777777 376003                    ANQ     -1,DU
         4 000513   000012 736000                    QLS     10
         4 000514   000000 036000 xsym               ADLQ    I_O_BUF$
         4 000515   000000 755000 xsym               STA     BUFSF
         4 000516   000001 756000 xsym               STQ     BUFSF+1

      344     3213    4    /**/           BUFLNSF = COMPRESS_SIZE;

   3213  4 000517   200006 235100                    LDA     COMPRESS_SIZE,,AUTO
         4 000520   000000 755000 xsym               STA     BUFLNSF

      345     3214    4    /**/           WAITSF = %YES#;

   3214  4 000521   400000 236003                    LDQ     -131072,DU
         4 000522   000000 756000 xsym               STQ     WAITSF

      346     3215    4    /**/           VFCSF = %NO#;

   3215  4 000523   000000 450000 xsym               STZ     VFCSF

      347     3216    4    /**/           ENCRP_SEEDSF = ZI$DIR.DEST_SEED;

   3216  4 000524   000030 236000 xsym               LDQ     ZI$DIR+24
         4 000525   000000 756000 xsym               STQ     ENCRP_SEEDSF

      348     3217    4    /**/           KEYVSF.IDSKEY = RB; /* Give same key as area key */
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:65   

   3217  4 000526   000000 100400                    MLR     fill='000'O
         4 000527   000000 000004 xsym               ADSC9   RB                       cn=0,n=4
         4 000530   000000 200004 xsym               ADSC9   KEYVSF                   cn=1,n=4

      349     3218    4                   CALL SYS_FUNC_WRIT ALTRET(ALT_WRITE_DEST);

   3218  4 000531   000002 631400 5                  EPPR1   2
         4 000532   000000 701000 xent               TSX1    SYS_FUNC_WRIT
         4 000533   002260 702000 4                  TSX2    ALT_WRITE_DEST

      350     3219    4                   TOTL_PGS_DUMP = TOTL_PGS_DUMP + 1;

   3219  4 000534   000012 235000 0                  LDA     TOTL_PGS_DUMP
         4 000535   000001 035007                    ADLA    1,DL
         4 000536   000012 755000 0                  STA     TOTL_PGS_DUMP

      351     3220    4                   END;

      352     3221    3               I_O_INDX = I_O_INDX + 1;

   3221  4 000537   000000 220000 0                  LDX0    I_O_INDX
         4 000540   000001 621010                    EAX1    1,X0
         4 000541   000000 741000 0                  STX1    I_O_INDX

      353     3222    3               END;

   3222  4 000542   000000 235000 xsym               LDA     RB
         4 000543   000001 035007                    ADLA    1,DL
         4 000544   000000 755000 xsym               STA     RB
         4 000545   000000 236000 xsym               LDQ     RE
         4 000546   000000 116000 xsym               CMPQ    RB
         4 000547   000447 603000 4                  TRC     s:3200

      354     3223    2           END;

   3223  4 000550   000003 236000 0                  LDQ     LAST_PAGE
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:66   
         4 000551   400000 376003                    ANQ     -131072,DU
         4 000552   400000 676003                    ERQ     -131072,DU
         4 000553   000361 601000 4                  TNZ     s:3174

      355     3224        /*
      356     3225                   Print any bad checksum pages not yet printed.
      357     3226        */
      358     3227    2       IF CHECKSUM AND MSG_FLG THEN DO;

   3227  4 000554   000005 234000 0                  SZN     CHECKSUM
         4 000555   000567 605000 4                  TPL     s:3234
         4 000556   000004 234000 0                  SZN     MSG_FLG
         4 000557   000567 605000 4                  TPL     s:3234

      359     3228    2           PRINT_CHKS = %YES#;

   3228  4 000560   400000 236003                    LDQ     -131072,DU
         4 000561   000006 756000 0                  STQ     PRINT_CHKS

      360     3229    2           CALL CHECK_SUM;

   3229  4 000562   001167 701000 4                  TSX1    CHECK_SUM
         4 000563   000000 011000                    NOP     0

      361     3230    2           CHECKSUM = %NO# ;

   3230  4 000564   000005 450000 0                  STZ     CHECKSUM

      362     3231    2           MSG_FLG = %NO# ; /* Reset checksum flags for nxt dmp */

   3231  4 000565   000004 450000 0                  STZ     MSG_FLG

      363     3232    2           PRINT_CHKS = %NO# ;

   3232  4 000566   000006 450000 0                  STZ     PRINT_CHKS

      364     3233    2           END;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:67   

      365     3234    1       CALL DUMP_REPRT('IDS' /* DO IDS DUMP REPORT */);

   3234  4 000567   000023 236000 5                  LDQ     19
         4 000570   200013 756100                    STQ     @PASS_DATE+1,,AUTO
         4 000571   002013 701000 4                  TSX1    DUMP_REPRT
         4 000572   000000 011000                    NOP     0

      366     3235        /*
      367     3236               Check schema for a possible associated key file. If one exist
      368     3237               attemp to open and dump it.
      369     3238        */
      370     3239    1       IF KEY_FILE_ASSOCIATED AND ZI$DIR.NOKEYS = %NO# THEN

   3239  4 000573   000011 234000 0                  SZN     KEY_FILE_ASSOCIATED
         4 000574   000617 605000 4                  TPL     s:3248
         4 000575   000125 236000 xsym               LDQ     ZI$DIR+85
         4 000576   020000 316003                    CANQ    8192,DU
         4 000577   000617 601000 4                  TNZ     s:3248

      371     3240    2       DO;

      372     3241    2    /**/   DCBSF = ZI$DIR.SRCE_NM.DCB#;

   3241  4 000600   000255 220000 xsym               LDX0    ZI$DIR+173
         4 000601   000000 740000 xsym               STX0    DCBSF

      373     3242    2           CALL SYS_FUNC_CLOS; /* Note: not releasing dcb yet */

   3242  4 000602   000002 631400 5                  EPPR1   2
         4 000603   000000 701000 xent               TSX1    SYS_FUNC_CLOS
         4 000604   000000 011000                    NOP     0

      374     3243    2    /**/   DCBSF = ZI$DIR.DEST_NM.DCB#;

   3243  4 000605   000266 220000 xsym               LDX0    ZI$DIR+182
         4 000606   000000 740000 xsym               STX0    DCBSF
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:68   

      375     3244    2           CALL SYS_FUNC_CLOS;

   3244  4 000607   000002 631400 5                  EPPR1   2
         4 000610   000000 701000 xent               TSX1    SYS_FUNC_CLOS
         4 000611   000000 011000                    NOP     0

      376     3245    2           CALL DUMP_ASCFID('KEY') ALTRET(ALT_DEST_FILE);

   3245  4 000612   000024 236000 5                  LDQ     20
         4 000613   200011 756100                    STQ     COMPRESS_SIZE+3,,AUTO
         4 000614   001364 701000 4                  TSX1    DUMP_ASCFID
         4 000615   002233 702000 4                  TSX2    ALT_DEST_FILE

      377     3246    2           END;

   3246  4 000616   000621 710000 4                  TRA     END_OF_DUMP

      378     3247    1       ELSE
      379     3248    1           CALL CLOSE_FILES; /* Close and release dcbs */

   3248  4 000617   002142 701000 4                  TSX1    CLOSE_FILES
         4 000620   000000 011000                    NOP     0

      380     3249    1   END_OF_DUMP:
      381     3250    1       REPRT = '...Dump terminated';

   3250  4 000621   040000 100400       END_OF_DUMP  MLR     fill='040'O
         4 000622   000010 000022 1                  ADSC9   LEFT_JUSTIFY+7           cn=0,n=18
         4 000623   000036 000120 0                  ADSC9   REPRT                    cn=0,n=80

      382     3251    1   /**/ DCBSF = DCBNUM(M$LO);

   3251  4 000624   000000 236007 xsym               LDQ     M$LO,DL
         4 000625   000000 620006                    EAX0    0,QL
         4 000626   000000 740000 xsym               STX0    DCBSF

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:69   
      383     3252    1   /**/ BUFSF = VECTOR(REPRT);

   3252  4 000627   000000 237000 5                  LDAQ    0
         4 000630   000000 755000 xsym               STA     BUFSF
         4 000631   000001 756000 xsym               STQ     BUFSF+1

      384     3253    1   /**/ BUFLNSF = 80;

   3253  4 000632   000120 235007                    LDA     80,DL
         4 000633   000000 755000 xsym               STA     BUFLNSF

      385     3254    1   /**/ VFCSF = %NO#;

   3254  4 000634   000000 450000 xsym               STZ     VFCSF

      386     3255    1       CALL SYS_FUNC_WRIT;

   3255  4 000635   000002 631400 5                  EPPR1   2
         4 000636   000000 701000 xent               TSX1    SYS_FUNC_WRIT
         4 000637   000000 011000                    NOP     0

      387     3256    1       RETURN;

   3256  4 000640   000000 702200 xent               TSX2  ! X66_ARET

      388     3257        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:70   
      389     3258        /*----------------------------------------------------------*/
      390     3259        /*        C O M P R E S S    P A G E    P R O C             */
      391     3260        /*----------------------------------------------------------*/
      392     3261    1   COMPRESS_PAGE: PROC(PGE_SIZE);

   3261  4 000641   200010 741300       COMPRESS_PA* STX1  ! COMPRESS_SIZE+2,,AUTO

      393     3262    2   DCL PGE_SIZE SBIN;
      394     3263    2   DCL N SBIN STATIC;
      395     3264    2   DCL OFF_ARRAY CHAR(N) BASED;
      396     3265    2   DCL REC$ PTR STATIC;
      397     3266    2   DCL TEMP$ PTR STATIC;
      398     3267    2   DCL OFF_ARRAY$ PTR STATIC;
      399     3268        /* This routine works out how many words are occupied by the line
      400     3269           index entries at the end of a page. Then, by a series of word moves
      401     3270           it jams those entries up against the end of the last data record
      402     3271           on the page and calculates the new record length                  */
      403     3272
      404     3273         /* first calculate the # of bytes
      405     3274            in to the first free data byte */
      406     3275    2       IF I_O_TAB.I_O_HW.VAL(7) < 4 THEN
              3275                /*Don't worry about page compression it's full*/

   3275  4 000642   000000 470400 xsym               LDP0    DATA$
         4 000643   000003 236100                    LDQ     3,,PR0
         4 000644   177777 376007                    ANQ     65535,DL
         4 000645   000004 116007                    CMPQ    4,DL
         4 000646   000654 603000 4                  TRC     s:3281

      407     3276    3       DO;

      408     3277    3           PGE_SIZE = 4096;

   3277  4 000647   010000 235007                    LDA     4096,DL
         4 000650   200011 471500                    LDP1    @PGE_SIZE,,AUTO
         4 000651   100000 755100                    STA     0,,PR1

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:71   
      409     3278    3           RETURN;

   3278  4 000652   200010 221300                    LDX1  ! COMPRESS_SIZE+2,,AUTO
         4 000653   000001 702211                    TSX2  ! 1,X1

      410     3279    3           END;
      411     3280
      412     3281    2       N = ((I_O_TAB.I_O_HW.VAL(11)+2)/2)*4;

   3281  4 000654   000005 236100                    LDQ     5,,PR0
         4 000655   177777 376007                    ANQ     65535,DL
         4 000656   000002 036007                    ADLQ    2,DL
         4 000657   000001 772000                    QRL     1
         4 000660   000002 736000                    QLS     2
         4 000661   000062 756000 0                  STQ     N

      413     3282         /* N = no. Of chars in offset array. Take
      414     3283            no. Of pointers +1 for zero base +1 for
      415     3284            odd numbers. Div by 2 for # words and
      416     3285            mult by 4 for # chars */
      417     3286    2       PGE_SIZE = I_O_TAB.I_O_HW.VAL(6) - (I_O_TAB.I_O_HW.VAL(7) +

   3286  4 000662   000003 236100                    LDQ     3,,PR0
         4 000663   177777 376007                    ANQ     65535,DL
         4 000664   200040 756100                    STQ     PAGES+19,,AUTO
         4 000665   000005 236100                    LDQ     5,,PR0
         4 000666   000001 736000                    QLS     1
         4 000667   377776 376007                    ANQ     131070,DL
         4 000670   200040 036100                    ADLQ    PAGES+19,,AUTO
         4 000671   200041 756100                    STQ     PAGES+20,,AUTO
         4 000672   000003 236100                    LDQ     3,,PR0
         4 000673   000022 772000                    QRL     18
         4 000674   177777 376007                    ANQ     65535,DL
         4 000675   200041 136100                    SBLQ    PAGES+20,,AUTO
         4 000676   000002 136007                    SBLQ    2,DL
         4 000677   200011 471500                    LDP1    @PGE_SIZE,,AUTO
         4 000700   100000 756100                    STQ     0,,PR1
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:72   

      418     3287    2          ((I_O_TAB.I_O_HW.VAL(11) + 1) * 2));
      419     3288
      420     3289         /* save byte count in PGE_SIZE to be
      421     3290            used for byte count in SYS_FUNC_WRIT*/
      422     3291
      423     3292    2       PGE_SIZE = PGE_SIZE + 12;

   3292  4 000701   000014 236007                    LDQ     12,DL
         4 000702   100000 056100                    ASQ     0,,PR1

      424     3293         /* Include an extra 12 bytes (3 words)
      425     3294            to account for 3 head rec words */
      426     3295
      427     3296    2       PGE_SIZE = ((PGE_SIZE+3)/4) * 4;

   3296  4 000703   100000 236100                    LDQ     0,,PR1
         4 000704   000003 036007                    ADLQ    3,DL
         4 000705   000004 506007                    DIV     4,DL
         4 000706   000002 736000                    QLS     2
         4 000707   100000 756100                    STQ     0,,PR1

      428     3297         /*  PGE_SIZE   had actual byte count of byte
      429     3298            to first empty data byte. The
      430     3299            above pushes this count to a
      431     3300            word boundry */
      432     3301
      433     3302    2       REC$ = PINCRC(DATA$ , PGE_SIZE); /* Set REC$ to point at the

   3302  4 000710   000020 736000                    QLS     16
         4 000711   000000 036000 xsym               ADLQ    DATA$
         4 000712   000063 756000 0                  STQ     REC$

      434     3303         first byte of empty data
      435     3304         in the data page */
      436     3305
      437     3306    2       TEMP$ = ADDR(I_O_TAB.I_O_HW.VAL(2047));
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:73   

   3306  4 000713   000000 236000 xsym               LDQ     DATA$
         4 000714   000025 036000 5                  ADLQ    21
         4 000715   000064 756000 0                  STQ     TEMP$

      438     3307         /* Set TEMP$ to point to the
      439     3308            bottom or last byte of data */
      440     3309
      441     3310    2       OFF_ARRAY$=PINCRC(TEMP$,(0-(N-2)));

   3310  4 000716   000002 236007                    LDQ     2,DL
         4 000717   000062 136000 0                  SBLQ    N
         4 000720   000020 736000                    QLS     16
         4 000721   000064 036000 0                  ADLQ    TEMP$
         4 000722   000065 756000 0                  STQ     OFF_ARRAY$

      442     3311         /* move pointer back to point to the
      443     3312            first word boundry of offset array
      444     3313            the  N-2 accounts for halfword pres-
      445     3314            ently looked at by pointer */
      446     3315
      447     3316    2       REC$->OFF_ARRAY = OFF_ARRAY$->OFF_ARRAY;

   3316  4 000723   000065 470400 0                  LDP0    OFF_ARRAY$
         4 000724   000062 720000 0                  LXL0    N
         4 000725   000063 473400 0                  LDP3    REC$
         4 000726   040140 100540                    MLR     fill='040'O
         4 000727   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         4 000730   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0

      448     3317         /* Above line does the actual commpression */
      449     3318
      450     3319    2       PGE_SIZE = PGE_SIZE + N; /* Update no. of bytes in record */

   3319  4 000731   100000 236100                    LDQ     0,,PR1
         4 000732   000062 036000 0                  ADLQ    N
         4 000733   100000 756100                    STQ     0,,PR1
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:74   

      451     3320    2       RETURN;

   3320  4 000734   200010 221300                    LDX1  ! COMPRESS_SIZE+2,,AUTO
         4 000735   000001 702211                    TSX2  ! 1,X1

      452     3321    2   END;
      453     3322        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:75   
      454     3323        /*-------------------------------------------------------------*/
      455     3324        /*         GET INVENTORY  AND  FILE  SIZE  ATTRIBUTES           */
      456     3325        /*--------------------------------------------------------------*/
      457     3326    1   GET_ATBLK: PROC(INV,DATAPGS,HI_PGE) ALTRET;

   3326  4 000736   200010 741300       GET_ATBLK    STX1  ! COMPRESS_SIZE+2,,AUTO

      458     3327    2   DCL INV SBIN;
      459     3328    2   DCL DATAPGS SBIN;
      460     3329    2   DCL HI_PGE SBIN;
      461     3330    2   DCL 1 DUMP_INFO BASED(ATBLK$) ALIGNED,
      462     3331    2         2 * (0:2) UBIN WORD UNAL,
      463     3332    2         2 ID CHAR(4) UNAL;
      464     3333        /*
      465     3334           Evaluate high data page and number of inventory pages according
      466     3335           to attribute block information.
      467     3336        */
      468     3337    2   /**/ DCBSF = AREADCB;

   3337  4 000737   200003 220100                    LDX0    AREADCB,,AUTO
         4 000740   000000 740000 xsym               STX0    DCBSF

      469     3338    2   /**/ BUFSF = VECTOR(I_O_BUF(0));

   3338  4 000741   000021 235000 5                  LDA     17
         4 000742   000000 236000 xsym               LDQ     I_O_BUF$
         4 000743   000000 755000 xsym               STA     BUFSF
         4 000744   000001 756000 xsym               STQ     BUFSF+1

      470     3339    2   /**/ BUFLNSF = 4096;

   3339  4 000745   010000 235007                    LDA     4096,DL
         4 000746   000000 755000 xsym               STA     BUFLNSF

      471     3340    2   /**/ FULLSF = %YES#;

   3340  4 000747   400000 236003                    LDQ     -131072,DU
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:76   
         4 000750   000000 756000 xsym               STQ     FULLSF

      472     3341    2   /**/ ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;

   3341  4 000751   000027 236000 xsym               LDQ     ZI$DIR+23
         4 000752   000000 756000 xsym               STQ     ENCRP_SEEDSF

      473     3342    2   /**/ KEYSF = %YES#;

   3342  4 000753   400000 236003                    LDQ     -131072,DU
         4 000754   000000 756000 xsym               STQ     KEYSF

      474     3343    2   /**/ KEYVSF.IDSKEY = 0;

   3343  4 000755   000000 100400                    MLR     fill='000'O
         4 000756   000002 000004 5                  ADSC9   2                        cn=0,n=4
         4 000757   000000 200004 xsym               ADSC9   KEYVSF                   cn=1,n=4

      475     3344    2       CALL SYS_FUNC_READ ALTRET(ALT_ATBLK);

   3344  4 000760   000002 631400 5                  EPPR1   2
         4 000761   000000 701000 xent               TSX1    SYS_FUNC_READ
         4 000762   001105 702000 4                  TSX2    ALT_ATBLK

      476     3345    2       ATBLK$ = ADDR(I_O_BUF(0));

   3345  4 000763   000000 236000 xsym               LDQ     I_O_BUF$
         4 000764   000000 756000 xsym               STQ     ATBLK$

      477     3346    2       IF ZI$DIR.SRCE_NM.NAME.TEXT ~= ATBLK_PG.AREA_NM THEN

   3346  4 000765   000000 470400 xsym               LDP0    ATBLK$
         4 000766   040100 106400                    CMPC    fill='040'O
         4 000767   000245 200036 xsym               ADSC9   ZI$DIR+165               cn=1,n=30
         4 000770   000017 000040                    ADSC9   15,,PR0                  cn=0,n=32
         4 000771   001007 600000 4                  TZE     s:3357

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:77   
      478     3347    3       DO;

      479     3348         /*E* ERROR: ZIU-01090-C
      480     3349                MESSAGE: Area name %U1 is not the area name store in IDS file %FN.
      481     3350                 */
      482     3351    3           ERR_INSERT(0) = ZI$DIR.SRCE_NM.NAME;

   3351  4 000772   000000 100400                    MLR     fill='000'O
         4 000773   000245 000037 xsym               ADSC9   ZI$DIR+165               cn=0,n=31
         4 000774   000000 000037 xsym               ADSC9   ERR_INSERT               cn=0,n=31

      483     3352    3           ERRCODESF.ERR# = 1090;

   3352  4 000775   000000 236000 xsym               LDQ     ERRCODESF
         4 000776   000005 376000 5                  ANQ     5
         4 000777   021020 276007                    ORQ     8720,DL
         4 001000   000000 756000 xsym               STQ     ERRCODESF

      484     3353    3           MSGCODE = ERRCODE_RDEF;

   3353  4 001001   000000 756000 xsym               STQ     MSGCODE

      485     3354    3           CALL SYS_FUNC_ERRMSG;

   3354  4 001002   000002 631400 5                  EPPR1   2
         4 001003   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         4 001004   000000 011000                    NOP     0

      486     3355    3           ALTRETURN;

   3355  4 001005   200010 221300                    LDX1  ! COMPRESS_SIZE+2,,AUTO
         4 001006   000000 702211                    TSX2  ! 0,X1

      487     3356    3           END;
      488     3357    2       IF ATBLK_PG.MISC_INFO.KEY_FILE_BLT THEN

   3357  4 001007   000030 234100                    SZN     24,,PR0
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:78   
         4 001010   001014 605000 4                  TPL     s:3360

      489     3358    2           KEY_FILE_ASSOCIATED = %YES#;

   3358  4 001011   400000 236003                    LDQ     -131072,DU
         4 001012   000011 756000 0                  STQ     KEY_FILE_ASSOCIATED
         4 001013   001015 710000 4                  TRA     s:3361

      490     3359    2       ELSE
      491     3360    2           KEY_FILE_ASSOCIATED = %NO#;

   3360  4 001014   000011 450000 0                  STZ     KEY_FILE_ASSOCIATED

      492     3361    2       IF ATBLK_PG.MISC_INFO.CHKSM = %YES# THEN

   3361  4 001015   000030 236100                    LDQ     24,,PR0
         4 001016   200000 316003                    CANQ    65536,DU
         4 001017   001023 600000 4                  TZE     s:3364

      493     3362    2           CHECKSUM = %YES#;

   3362  4 001020   400000 236003                    LDQ     -131072,DU
         4 001021   000005 756000 0                  STQ     CHECKSUM
         4 001022   001024 710000 4                  TRA     s:3365

      494     3363    2       ELSE
      495     3364    2           CHECKSUM = %NO#;

   3364  4 001023   000005 450000 0                  STZ     CHECKSUM

      496     3365    2       IF ATBLK_PG.FIR_INV_PGNO = 0 THEN

   3365  4 001024   000014 235100                    LDA     12,,PR0
         4 001025   001036 601000 4                  TNZ     s:3372

      497     3366    3       DO;

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:79   
      498     3367    3           HI_PGE = ATBLK_PG.NUM_DBPG;

   3367  4 001026   000005 235100                    LDA     5,,PR0
         4 001027   200013 471500                    LDP1    @HI_PGE,,AUTO
         4 001030   100000 755100                    STA     0,,PR1

      499     3368    3           DATAPGS = HI_PGE;

   3368  4 001031   200012 470500                    LDP0    @DATAPGS,,AUTO
         4 001032   000000 755100                    STA     0,,PR0

      500     3369    3           INV = 0;

   3369  4 001033   200011 473500                    LDP3    @INV,,AUTO
         4 001034   300000 450100                    STZ     0,,PR3

      501     3370    3           END;

   3370  4 001035   001054 710000 4                  TRA     s:3380

      502     3371    3       ELSE DO;

      503     3372    3           INV = ATBLK_PG.NUM_DBPG - ATBLK_PG.FIR_INV_PGNO + 1;

   3372  4 001036   000005 236100                    LDQ     5,,PR0
         4 001037   000014 136100                    SBLQ    12,,PR0
         4 001040   000001 036007                    ADLQ    1,DL
         4 001041   200011 471500                    LDP1    @INV,,AUTO
         4 001042   100000 756100                    STQ     0,,PR1

      504     3373    3           DATAPGS = ATBLK_PG.NUM_DBPG - INV;

   3373  4 001043   000000 470400 xsym               LDP0    ATBLK$
         4 001044   000005 236100                    LDQ     5,,PR0
         4 001045   100000 136100                    SBLQ    0,,PR1
         4 001046   200012 473500                    LDP3    @DATAPGS,,AUTO
         4 001047   300000 756100                    STQ     0,,PR3
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:80   

      505     3374    3           HI_PGE = ATBLK_PG.NUM_DBPG;

   3374  4 001050   000000 470400 xsym               LDP0    ATBLK$
         4 001051   000005 235100                    LDA     5,,PR0
         4 001052   200013 474500                    LDP4    @HI_PGE,,AUTO
         4 001053   400000 755100                    STA     0,,PR4

      506     3375    3           END;

      507     3376        /*
      508     3377                 Insert a dump 'ID' into the attribute page and write
      509     3378                 the attribute page as the first record fo the dump.
      510     3379        */
      511     3380    2       DUMP_INFO.ID = 'DUMP';

   3380  4 001054   000015 236000 1                  LDQ     LEFT_JUSTIFY+12
         4 001055   000000 470400 xsym               LDP0    ATBLK$
         4 001056   000003 756100                    STQ     3,,PR0

      512     3381    2       IF ZI$DIR.RNG_LIST OR ZI$DIR.DATEFLG THEN

   3381  4 001057   000000 234000 xsym               SZN     ZI$DIR
         4 001060   001064 604000 4                  TMI     s:3382
         4 001061   000125 236000 xsym               LDQ     ZI$DIR+85
         4 001062   200000 316003                    CANQ    65536,DU
         4 001063   001067 600000 4                  TZE     s:3384

      513     3382    2           ATBLK_PG.STATUS.FULL_DUMP = %NO#;

   3382  4 001064   000026 236000 5                  LDQ     22
         4 001065   000041 356100                    ANSQ    33,,PR0
         4 001066   001071 710000 4                  TRA     s:3385

      514     3383    2       ELSE
      515     3384    2           ATBLK_PG.STATUS.FULL_DUMP = %YES#;

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:81   
   3384  4 001067   010000 236003                    LDQ     4096,DU
         4 001070   000041 256100                    ORSQ    33,,PR0

      516     3385    2       IF ATBLK_PG.STATUS.FULL_DUMP = %NO# THEN

   3385  4 001071   000041 236100                    LDQ     33,,PR0
         4 001072   010000 316003                    CANQ    4096,DU
         4 001073   001076 601000 4                  TNZ     s:3387

      517     3386    2           ZI$DIR.NOKEYS = %YES#; /* Don't dump keys on partial dump. */

   3386  4 001074   020000 236003                    LDQ     8192,DU
         4 001075   000125 256000 xsym               ORSQ    ZI$DIR+85

      518     3387    2       LOW_DBK = ATBLK_PG.LOW_DBK;

   3387  4 001076   000015 235100                    LDA     13,,PR0
         4 001077   000000 755000 xsym               STA     LOW_DBK

      519     3388    2       LPP = ATBLK_PG.LINE_INFO.LPP;

   3388  4 001100   000012 236100                    LDQ     10,,PR0
         4 001101   777777 376007                    ANQ     -1,DL
         4 001102   000000 756000 xsym               STQ     LPP

      520     3389    2       RETURN;

   3389  4 001103   200010 221300                    LDX1  ! COMPRESS_SIZE+2,,AUTO
         4 001104   000001 702211                    TSX2  ! 1,X1

      521     3390        /**/
      522     3391    2   ALT_ATBLK:
      523     3392    2       ALTRETURN;

   3392  4 001105   200010 221300       ALT_ATBLK    LDX1  ! COMPRESS_SIZE+2,,AUTO
         4 001106   000000 702211                    TSX2  ! 0,X1

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:82   
      524     3393    2   END GET_ATBLK;
      525     3394        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:83   
      526     3395        /*-----------------------------------------------------------------*/
      527     3396        /*      C H E C K   D U M P   D A T E   R O U T I N E              */
      528     3397        /*-----------------------------------------------------------------*/
      529     3398    1   CHK_DATE: PROC(PAGE_DATE,PASS_DATE) ALTRET;

   3398  4 001107   200010 741300       CHK_DATE     STX1  ! COMPRESS_SIZE+2,,AUTO

      530     3399    2   DCL PAGE_DATE UBIN;
      531     3400    2   DCL PASS_DATE BIT(1);
      532     3401    2   DCL DUMP_DATE UBIN STATIC;
      533     3402        /*
      534     3403           First time this routine is called - the user specified date is
      535     3404           passed to 'M$TIME' to create a tstamp. After that just a compare
      536     3405           of that stamp to the stamp on the data page is done.
      537     3406        */
      538     3407    2       IF ~ ZI$DIR.DATEFLG THEN /* No date was specified - return */

   3407  4 001110   000125 236000 xsym               LDQ     ZI$DIR+85
         4 001111   000001 736000                    QLS     1
         4 001112   400000 376003                    ANQ     -131072,DU
         4 001113   400000 676003                    ERQ     -131072,DU
         4 001114   001123 600000 4                  TZE     s:3412

      539     3408    3       DO;

      540     3409    3           PASS_DATE = %YES#;

   3409  4 001115   200012 470500                    LDP0    @PASS_DATE,,AUTO
         4 001116   003100 060400                    CSL     bolr='003'O
         4 001117   000027 000001 5                  BDSC    23                       by=0,bit=0,n=1
         4 001120   000000 000001                    BDSC    0,,PR0                   by=0,bit=0,n=1

      541     3410    3           RETURN;

   3410  4 001121   200010 221300                    LDX1  ! COMPRESS_SIZE+2,,AUTO
         4 001122   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:84   
      542     3411    3           END;
      543     3412    2       IF FIRST_CHK THEN

   3412  4 001123   000001 234000 0                  SZN     FIRST_CHK
         4 001124   001146 605000 4                  TPL     s:3422

      544     3413    3       DO;

      545     3414    3           FIRST_CHK = '0'B;

   3414  4 001125   000001 450000 0                  STZ     FIRST_CHK

      546     3415    3    /**/   SOURCESF = %ANS#;

   3415  4 001126   000002 235007                    LDA     2,DL
         4 001127   000000 755000 xsym               STA     SOURCESF

      547     3416    3    /**/   DESTSF = %UTS#;

   3416  4 001130   000004 236007                    LDQ     4,DL
         4 001131   000000 756000 xsym               STQ     DESTSF

      548     3417    3    /**/   TIMESF = VECTOR(ZI$DIR.TIME);

   3417  4 001132   000030 237000 5                  LDAQ    24
         4 001133   000000 755000 xsym               STA     TIMESF
         4 001134   000001 756000 xsym               STQ     TIMESF+1

      549     3418    3    /**/   DATESF = VECTOR(ZI$DIR.DATE);

   3418  4 001135   000032 237000 5                  LDAQ    26
         4 001136   000000 755000 xsym               STA     DATESF
         4 001137   000001 756000 xsym               STQ     DATESF+1

      550     3419    3    /**/   TSTAMPSF = VECTOR(DUMP_DATE);

   3419  4 001140   000034 237000 5                  LDAQ    28
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:85   
         4 001141   000000 755000 xsym               STA     TSTAMPSF
         4 001142   000001 756000 xsym               STQ     TSTAMPSF+1

      551     3420    3           CALL SYS_FUNC_TSTAMP ALTRET(ALT_TSTAMP);

   3420  4 001143   000002 631400 5                  EPPR1   2
         4 001144   000000 701000 xent               TSX1    SYS_FUNC_TSTAMP
         4 001145   001165 702000 4                  TSX2    ALT_TSTAMP

      552     3421    3           END;

      553     3422    2       IF PAGE_DATE >= DUMP_DATE THEN

   3422  4 001146   200011 470500                    LDP0    @PAGE_DATE,,AUTO
         4 001147   000000 236100                    LDQ     0,,PR0
         4 001150   000066 116000 0                  CMPQ    DUMP_DATE
         4 001151   001157 602000 4                  TNC     s:3425

      554     3423    2           PASS_DATE = %YES#;

   3423  4 001152   200012 471500                    LDP1    @PASS_DATE,,AUTO
         4 001153   003100 060400                    CSL     bolr='003'O
         4 001154   000027 000001 5                  BDSC    23                       by=0,bit=0,n=1
         4 001155   100000 000001                    BDSC    0,,PR1                   by=0,bit=0,n=1
         4 001156   001163 710000 4                  TRA     s:3426

      555     3424    2       ELSE
      556     3425    2           PASS_DATE = %NO#;

   3425  4 001157   200012 471500                    LDP1    @PASS_DATE,,AUTO
         4 001160   003100 060400                    CSL     bolr='003'O
         4 001161   000002 000001 5                  BDSC    2                        by=0,bit=0,n=1
         4 001162   100000 000001                    BDSC    0,,PR1                   by=0,bit=0,n=1

      557     3426    2       RETURN;

   3426  4 001163   200010 221300                    LDX1  ! COMPRESS_SIZE+2,,AUTO
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:86   
         4 001164   000001 702211                    TSX2  ! 1,X1

      558     3427        /**/
      559     3428    2   ALT_TSTAMP:
      560     3429    2       ALTRETURN;

   3429  4 001165   200010 221300       ALT_TSTAMP   LDX1  ! COMPRESS_SIZE+2,,AUTO
         4 001166   000000 702211                    TSX2  ! 0,X1

      561     3430    2   END CHK_DATE;
      562     3431        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:87   
      563     3432        /*
      564     3433           This routine calculates the checksum and compares it to
      565     3434           against the granual stamp. Then replaces the bad
      566     3435           checksum if not correct and prints a message.
      567     3436        */
      568     3437    1   CHECK_SUM: PROC;

   3437  4 001167   200010 741300       CHECK_SUM    STX1  ! COMPRESS_SIZE+2,,AUTO

      569     3438    2   DCL PAGE CHAR(6) STATIC;
      570     3439    2   DCL DASH CHAR(1) STATIC;
      571     3440    2   DCL HIGH_PGE CHAR(10) STATIC;
      572     3441    2   DCL LOW_PGE CHAR(10) STATIC;
      573     3442    2   DCL REPRT_CHK CHAR(80);
      574     3443    2   DCL I SBIN WORD STATIC;
      575     3444    2   DCL DATA (0:1023) SBIN WORD BASED(DATA$);
      576     3445
      577     3446    2       IF PRINT_CHKS = %YES# THEN

   3446  4 001170   000006 234000 0                  SZN     PRINT_CHKS
         4 001171   001176 605000 4                  TPL     s:3451

      578     3447    3       DO;

      579     3448    3           CALL BAD_CHK;

   3448  4 001172   001235 701000 4                  TSX1    BAD_CHK
         4 001173   000000 011000                    NOP     0

      580     3449    3           RETURN;

   3449  4 001174   200010 221300                    LDX1  ! COMPRESS_SIZE+2,,AUTO
         4 001175   000001 702211                    TSX2  ! 1,X1

      581     3450    3           END;
      582     3451    2       ICHKSUM = 0;

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:88   
   3451  4 001176   000000 450000 xsym               STZ     ICHKSUM

      583     3452
      584     3453    2       CALL CHKSUM; /* BMAP - value returned in ICHKSUM */

   3453  4 001177   000002 631400 5                  EPPR1   2
         4 001200   000000 701000 xent               TSX1    CHKSUM
         4 001201   000000 011000                    NOP     0

      585     3454
      586     3455    2       DATA(0) = ICHKSUM;

   3455  4 001202   000000 235000 xsym               LDA     ICHKSUM
         4 001203   000000 470400 xsym               LDP0    DATA$
         4 001204   000000 755100                    STA     0,,PR0

      587     3456    2       IF ICHKSUM ~= DATA_PG.CHKSUM_WD THEN

   3456  4 001205   000000 470400 xsym               LDP0    DATA$
         4 001206   000000 236000 xsym               LDQ     ICHKSUM
         4 001207   000002 116100                    CMPQ    2,,PR0
         4 001210   001233 600000 4                  TZE     s:3474

      588     3457    3       DO;

      589     3458    3           DATA_PG.CHKSUM_WD = ICHKSUM;

   3458  4 001211   000002 756100                    STQ     2,,PR0

      590     3459    3           IF MSG_FLG = %NO# THEN

   3459  4 001212   000004 234000 0                  SZN     MSG_FLG
         4 001213   001231 604000 4                  TMI     s:3472

      591     3460    4           DO;

      592     3461    4               MSG_FLG = %YES#;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:89   

   3461  4 001214   400000 236003                    LDQ     -131072,DU
         4 001215   000004 756000 0                  STQ     MSG_FLG

      593     3462         /*E* ERROR: ZIU-01007-C
      594     3463                   MESSAGE: Checksum inconsistency noted while dumping...
      595     3464                            Modified checksum value(s) for the following page(s):
      596     3465                                                                            */
      597     3466    4               ERRCODESF.ERR#= 1007;

   3466  4 001216   000000 236000 xsym               LDQ     ERRCODESF
         4 001217   000005 376000 5                  ANQ     5
         4 001220   017570 276007                    ORQ     8056,DL
         4 001221   000000 756000 xsym               STQ     ERRCODESF

      598     3467    4               MSGCODE = ERRCODE_RDEF;

   3467  4 001222   000000 756000 xsym               STQ     MSGCODE

      599     3468    4               CALL SYS_FUNC_ERRMSG;

   3468  4 001223   000002 631400 5                  EPPR1   2
         4 001224   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         4 001225   000000 011000                    NOP     0

      600     3469    4               CALL BAD_CHK;

   3469  4 001226   001235 701000 4                  TSX1    BAD_CHK
         4 001227   000000 011000                    NOP     0

      601     3470    4               END;

   3470  4 001230   001233 710000 4                  TRA     s:3474

      602     3471    3           ELSE
      603     3472    3               CALL BAD_CHK;

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:90   
   3472  4 001231   001235 701000 4                  TSX1    BAD_CHK
         4 001232   000000 011000                    NOP     0

      604     3473    3           END;

      605     3474    2       RETURN;

   3474  4 001233   200010 221300                    LDX1  ! COMPRESS_SIZE+2,,AUTO
         4 001234   000001 702211                    TSX2  ! 1,X1

      606     3475        /*
      607     3476           Print and keep track of bad checksum pages
      608     3477        */
      609     3478    2   BAD_CHK: PROC;

   3478  4 001235   200036 741300       BAD_CHK      STX1  ! PAGES+17,,AUTO

      610     3479
      611     3480    3       IF BAD_CHK_LOW = 0 THEN

   3480  4 001236   000007 235000 0                  LDA     BAD_CHK_LOW
         4 001237   001244 601000 4                  TNZ     s:3486

      612     3481    4       DO;

      613     3482    4           BAD_CHK_LOW = RB;

   3482  4 001240   000000 236000 xsym               LDQ     RB
         4 001241   000007 756000 0                  STQ     BAD_CHK_LOW

      614     3483    4           BAD_CHK_HIGH= RB;

   3483  4 001242   000010 756000 0                  STQ     BAD_CHK_HIGH

      615     3484    4           RETURN;

   3484  4 001243   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:91   

      616     3485    4           END;
      617     3486    3       IF RB - BAD_CHK_HIGH > 1 OR PRINT_CHKS THEN

   3486  4 001244   000000 236000 xsym               LDQ     RB
         4 001245   000010 136000 0                  SBLQ    BAD_CHK_HIGH
         4 001246   000001 116007                    CMPQ    1,DL
         4 001247   001252 605400 4                  TPNZ    s:3488
         4 001250   000006 234000 0                  SZN     PRINT_CHKS
         4 001251   001310 605000 4                  TPL     s:3501

      618     3487    4       DO;

      619     3488    4           PAGE = 'PAGE';

   3488  4 001252   040000 100400                    MLR     fill='040'O
         4 001253   000016 000004 1                  ADSC9   LEFT_JUSTIFY+13          cn=0,n=4
         4 001254   000067 000006 0                  ADSC9   PAGE                     cn=0,n=6

      620     3489    4           DASH = ' ';

   3489  4 001255   040000 236003                    LDQ     16384,DU
         4 001256   000071 756000 0                  STQ     DASH

      621     3490    4           HIGH_PGE = ' ';

   3490  4 001257   040000 100400                    MLR     fill='040'O
         4 001260   000036 000001 5                  ADSC9   30                       cn=0,n=1
         4 001261   000072 000012 0                  ADSC9   HIGH_PGE                 cn=0,n=10

      622     3491    4           CALL BINCHAR(LOW_PGE,BAD_CHK_LOW);

   3491  4 001262   000000 301400                    BTD
         4 001263   000007 000004 0                  NDSC9   BAD_CHK_LOW              cn=0,s=lsgnf,sf=0,n=4
         4 001264   000075 030012 0                  NDSC9   LOW_PGE                  cn=0,s=nosgn,sf=0,n=10

      623     3492    4           CALL ZERO_SUP(LOW_PGE,10,RIGHT_JUSTIFY);
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:92   

   3492  4 001265   000041 630400 5                  EPPR0   33
         4 001266   000037 631400 5                  EPPR1   31
         4 001267   000000 701000 xent               TSX1    ZERO_SUP
         4 001270   000000 011000                    NOP     0

      624     3493    4           IF BAD_CHK_LOW ~= BAD_CHK_HIGH THEN

   3493  4 001271   000007 236000 0                  LDQ     BAD_CHK_LOW
         4 001272   000010 116000 0                  CMPQ    BAD_CHK_HIGH
         4 001273   001310 600000 4                  TZE     s:3501

      625     3494    5           DO;

      626     3495    5               DASH = '-';

   3495  4 001274   055000 236003                    LDQ     23040,DU
         4 001275   000071 756000 0                  STQ     DASH

      627     3496    5               PAGE = 'PAGES';

   3496  4 001276   040000 100400                    MLR     fill='040'O
         4 001277   000017 000005 1                  ADSC9   LEFT_JUSTIFY+14          cn=0,n=5
         4 001300   000067 000006 0                  ADSC9   PAGE                     cn=0,n=6

      628     3497    5               CALL BINCHAR(HIGH_PGE,BAD_CHK_HIGH);

   3497  4 001301   000000 301400                    BTD
         4 001302   000010 000004 0                  NDSC9   BAD_CHK_HIGH             cn=0,s=lsgnf,sf=0,n=4
         4 001303   000072 030012 0                  NDSC9   HIGH_PGE                 cn=0,s=nosgn,sf=0,n=10

      629     3498    5               CALL ZERO_SUP(HIGH_PGE,10,LEFT_JUSTIFY);

   3498  4 001304   000044 630400 5                  EPPR0   36
         4 001305   000037 631400 5                  EPPR1   31
         4 001306   000000 701000 xent               TSX1    ZERO_SUP
         4 001307   000000 011000                    NOP     0
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:93   

      630     3499    5               END;

      631     3500    4           END;

      632     3501    3       IF RB - BAD_CHK_HIGH > 1 OR PRINT_CHKS = %YES# THEN

   3501  4 001310   000000 236000 xsym               LDQ     RB
         4 001311   000010 136000 0                  SBLQ    BAD_CHK_HIGH
         4 001312   000001 116007                    CMPQ    1,DL
         4 001313   001316 605400 4                  TPNZ    s:3503
         4 001314   000006 234000 0                  SZN     PRINT_CHKS
         4 001315   001360 605000 4                  TPL     s:3513

      633     3502    4       DO;

      634     3503    4    /**/   DCBSF = DCBNUM(M$LO);

   3503  4 001316   000000 236007 xsym               LDQ     M$LO,DL
         4 001317   000000 620006                    EAX0    0,QL
         4 001320   000000 740000 xsym               STX0    DCBSF

      635     3504    4    /**/   BUFSF = VECTOR(REPRT_CHK);

   3504  4 001321   000000 235000 5                  LDA     0
         4 001322   200040 452500                    STP2    PAGES+19,,AUTO
         4 001323   200040 236100                    LDQ     PAGES+19,,AUTO
         4 001324   000011 036003                    ADLQ    9,DU
         4 001325   000000 755000 xsym               STA     BUFSF
         4 001326   000001 756000 xsym               STQ     BUFSF+1

      636     3505    4    /**/   BUFLNSF = 80;

   3505  4 001327   000120 235007                    LDA     80,DL
         4 001330   000000 755000 xsym               STA     BUFLNSF

      637     3506    4    /**/   VFCSF = %NO#;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:94   

   3506  4 001331   000000 450000 xsym               STZ     VFCSF

      638     3507    4           CALL CONCAT(REPRT_CHK, '      ',PAGE,LOW_PGE,DASH,HIGH_PGE);

   3507  4 001332   040100 100400                    MLR     fill='040'O
         4 001333   000021 000006 1                  ADSC9   LEFT_JUSTIFY+16          cn=0,n=6
         4 001334   200011 000006                    ADSC9   REPRT_CHK,,AUTO          cn=0,n=6
         4 001335   040100 100400                    MLR     fill='040'O
         4 001336   000067 000006 0                  ADSC9   PAGE                     cn=0,n=6
         4 001337   200012 400006                    ADSC9   @PASS_DATE,,AUTO         cn=2,n=6
         4 001340   040100 100400                    MLR     fill='040'O
         4 001341   000075 000012 0                  ADSC9   LOW_PGE                  cn=0,n=10
         4 001342   200014 000012                    ADSC9   @IDS_FILE+1,,AUTO        cn=0,n=10
         4 001343   000071 236000 0                  LDQ     DASH
         4 001344   000022 772000                    QRL     18
         4 001345   200016 552110                    STBQ    PAGES+1,'10'O,AUTO
         4 001346   040100 100400                    MLR     fill='040'O
         4 001347   000072 000012 0                  ADSC9   HIGH_PGE                 cn=0,n=10
         4 001350   200016 600071                    ADSC9   PAGES+1,,AUTO            cn=3,n=57

      639     3508    4           CALL SYS_FUNC_WRIT;

   3508  4 001351   000002 631400 5                  EPPR1   2
         4 001352   000000 701000 xent               TSX1    SYS_FUNC_WRIT
         4 001353   000000 011000                    NOP     0

      640     3509    4           BAD_CHK_LOW = RB;

   3509  4 001354   000000 235000 xsym               LDA     RB
         4 001355   000007 755000 0                  STA     BAD_CHK_LOW

      641     3510    4           BAD_CHK_HIGH = RB;

   3510  4 001356   000010 755000 0                  STA     BAD_CHK_HIGH

      642     3511    4           END;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:95   

   3511  4 001357   001362 710000 4                  TRA     s:3514

      643     3512    3       ELSE
      644     3513    3           BAD_CHK_HIGH = RB;

   3513  4 001360   000000 235000 xsym               LDA     RB
         4 001361   000010 755000 0                  STA     BAD_CHK_HIGH

      645     3514    3       RETURN;

   3514  4 001362   200036 221300                    LDX1  ! PAGES+17,,AUTO
         4 001363   000001 702211                    TSX2  ! 1,X1

      646     3515    3   END BAD_CHK;
      647     3516    2   END CHECK_SUM;
      648     3517        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:96   
      649     3518        /*-------------------------------------------------------------------
      650     3519              A S S O C I A T E D   K E Y E D   F I L E    C H E C K
      651     3520        -------------------------------------------------------------------*/
      652     3521    1   DUMP_ASCFID: PROC(FILE_TYPE) ALTRET;

   3521  4 001364   200010 741300       DUMP_ASCFID  STX1  ! COMPRESS_SIZE+2,,AUTO

      653     3522
      654     3523    2   DCL FILE_TYPE CHAR(3) CALIGNED;
      655     3524
      656     3525        /*
      657     3526           This procedure is called once it has been established in the
      658     3527           attribute block that an associated keyed file belongs to this
      659     3528           area just dumped. This routine figures out what the name of
      660     3529           the source and destination key file names are (or should be).
      661     3530           Also, this routine makes sure that the source key file can be
      662     3531           opened before calling the key file dump routine.
      663     3532        */
      664     3533    2       I=SRCE_FILE.CNT;

   3533  4 001365   000016 236000 0                  LDQ     SRCE_FILE
         4 001366   000033 772000                    QRL     27
         4 001367   000000 756000 xsym               STQ     I

      665     3534    2       I=I+1;

   3534  4 001370   000000 054000 xsym               AOS     I

      666     3535    2       IF I > 30 THEN I = 30; /* Only max of 30 char names allowed */

   3535  4 001371   000000 235000 xsym               LDA     I
         4 001372   000036 115007                    CMPA    30,DL
         4 001373   001376 604400 4                  TMOZ    s:3536

   3535  4 001374   000036 235007                    LDA     30,DL
         4 001375   000000 755000 xsym               STA     I

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:97   
      667     3536    2       CALL INSERT(SRCE_FILE.TEXT,(I-1),1,':');

   3536  4 001376   040005 100400                    MLR     fill='040'O
         4 001377   000047 000001 5                  ADSC9   39                       cn=0,n=1
         4 001400   000016 000001 0                  ADSC9   SRCE_FILE,A              cn=0,n=1

      668     3537    2       SRCE_FILE.CNT = I;

   3537  4 001401   000000 236000 xsym               LDQ     I
         4 001402   000033 736000                    QLS     27
         4 001403   000016 552040 0                  STBQ    SRCE_FILE,'40'O

      669     3538        /*
      670     3539           The source fid should be the area name + ':'.
      671     3540        */
      672     3541    2       I=DEST_FILE.CNT;

   3541  4 001404   000026 236000 0                  LDQ     DEST_FILE
         4 001405   000033 772000                    QRL     27
         4 001406   000000 756000 xsym               STQ     I

      673     3542    2       I=I+1;

   3542  4 001407   000000 054000 xsym               AOS     I

      674     3543    2       IF I > 30 THEN I = 30;

   3543  4 001410   000000 235000 xsym               LDA     I
         4 001411   000036 115007                    CMPA    30,DL
         4 001412   001415 604400 4                  TMOZ    s:3544

   3543  4 001413   000036 235007                    LDA     30,DL
         4 001414   000000 755000 xsym               STA     I

      675     3544    2       CALL INSERT(DEST_FILE.TEXT,(I-1),1,':');

   3544  4 001415   040005 100400                    MLR     fill='040'O
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:98   
         4 001416   000047 000001 5                  ADSC9   39                       cn=0,n=1
         4 001417   000026 000001 0                  ADSC9   DEST_FILE,A              cn=0,n=1

      676     3545    2       DEST_FILE.CNT = I;

   3545  4 001420   000000 236000 xsym               LDQ     I
         4 001421   000033 736000                    QLS     27
         4 001422   000026 552040 0                  STBQ    DEST_FILE,'40'O
         4 001423   001425 710000 4                  TRA     s:3556

      677     3546        /*
      678     3547           Now use the same dcbs for these two files.
      679     3548        */
      680     3549        /*
      681     3550           Attempt to open the keyed file - if an altreturn condition
      682     3551           occurrs, inform the user you cannot backup the keyed file.
      683     3552        */
      684     3553
      685     3554    2   DUMP_INDEX_FILE: ENTRY (FILE_TYPE) ALTRET;

   3554  4 001424   200010 741300       DUMP_INDEX_* STX1  ! COMPRESS_SIZE+2,,AUTO

      686     3555
      687     3556    2   /**/ DCBSF = ZI$DIR.SRCE_NM.DCB#;

   3556  4 001425   000255 220000 xsym               LDX0    ZI$DIR+173
         4 001426   000000 740000 xsym               STX0    DCBSF

      688     3557    2   /**/ REASGNSF = %NO#;

   3557  4 001427   000000 450000 xsym               STZ     REASGNSF

      689     3558    2   /**/ TESTSF = %NO#;

   3558  4 001430   000000 450000 xsym               STZ     TESTSF

      690     3559    2   /**/ ACSSF = %BLOCK#; /* DO BLOCK READ */
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:99   

   3559  4 001431   000003 235007                    LDA     3,DL
         4 001432   000000 755000 xsym               STA     ACSSF

      691     3560    2   /**/ FUNSF = %IN#; /* MUST BE %IN IN BLOCK MODE */

   3560  4 001433   000002 236007                    LDQ     2,DL
         4 001434   000000 756000 xsym               STQ     FUNSF

      692     3561    2   /**/ FIDSF = SRCE_FILE.TEXT;

   3561  4 001435   040000 100400                    MLR     fill='040'O
         4 001436   000016 200036 0                  ADSC9   SRCE_FILE                cn=1,n=30
         4 001437   000000 000036 xsym               ADSC9   FIDSF_RD                 cn=0,n=30

      693     3562    2   /**/ SHARESF = %IN#; /* NO OTHER UPDATER ALLOWED */

   3562  4 001440   400000 236003                    LDQ     -131072,DU
         4 001441   000000 756000 xsym               STQ     SHARESF

      694     3563        /**/
      695     3564    2       CALL SYS_FUNC_OPEN ALTRET(ALT_OPEN); /* Open source area */

   3564  4 001442   000002 631400 5                  EPPR1   2
         4 001443   000000 701000 xent               TSX1    SYS_FUNC_OPEN
         4 001444   001646 702000 4                  TSX2    ALT_OPEN

      696     3565    2       DCBSF = ZI$DIR.DEST_NM.DCB#;

   3565  4 001445   000266 220000 xsym               LDX0    ZI$DIR+182
         4 001446   000000 740000 xsym               STX0    DCBSF

      697     3566    2       DESTDCB = DCBSF;

   3566  4 001447   200004 740100                    STX0    DESTDCB,,AUTO

      698     3567    2       ACNT(0) = ' ';
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:100  

   3567  4 001450   000036 235000 5                  LDA     30
         4 001451   000036 236000 5                  LDQ     30
         4 001452   000000 755000 xsym               STA     ACNT
         4 001453   000001 756000 xsym               STQ     ACNT+1

      699     3568    2       REASGNSF = %NO#; /* WE ARE GOING TO DELETE THE DEST FILE */

   3568  4 001454   000000 450000 xsym               STZ     REASGNSF

      700     3569    2       ORGSF = %CONSEC#;

   3569  4 001455   000001 235007                    LDA     1,DL
         4 001456   000000 755000 xsym               STA     ORGSF

      701     3570    2       FUNSF = %CREATE#;

   3570  4 001457   000003 235007                    LDA     3,DL
         4 001460   000000 755000 xsym               STA     FUNSF

      702     3571    2       EXISTSF = %NEWFILE#;

   3571  4 001461   600000 236003                    LDQ     -65536,DU
         4 001462   000000 756000 xsym               STQ     EXISTSF

      703     3572    2       ACSSF = %SEQUEN#;

   3572  4 001463   000001 235007                    LDA     1,DL
         4 001464   000000 755000 xsym               STA     ACSSF

      704     3573    2       XTENSIZESF = 1;

   3573  4 001465   000000 755000 xsym               STA     XTENSIZESF

      705     3574    2       CARRY_ATTRIBUTESF = %NO#;

   3574  4 001466   000000 450000 xsym               STZ     CARRY_ATTRIBUTESF
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:101  

      706     3575    2       TESTSF = %NO#;

   3575  4 001467   000000 450000 xsym               STZ     TESTSF

      707     3576    2       FIDSF = DEST_FILE.TEXT;

   3576  4 001470   040000 100400                    MLR     fill='040'O
         4 001471   000026 200036 0                  ADSC9   DEST_FILE                cn=1,n=30
         4 001472   000000 000036 xsym               ADSC9   FIDSF_RD                 cn=0,n=30

      708     3577    2       IF FILE_TYPE = 'IND' THEN

   3577  4 001473   200011 470500                    LDP0    @FILE_TYPE,,AUTO
         4 001474   040000 106500                    CMPC    fill='040'O
         4 001475   000000 000003                    ADSC9   0,,PR0                   cn=0,n=3
         4 001476   000005 000003 1                  ADSC9   LEFT_JUSTIFY+4           cn=0,n=3
         4 001477   001512 601000 4                  TNZ     s:3583

      709     3578    3       DO;

      710     3579    3           REASGNSF = %YES#;

   3579  4 001500   400000 236003                    LDQ     -131072,DU
         4 001501   000000 756000 xsym               STQ     REASGNSF

      711     3580    3           FIDSF = ZI$DIR.DEST_NM.NAME.TEXT; /* FOR INDEX, USE !SET */

   3580  4 001502   040000 100400                    MLR     fill='040'O
         4 001503   000256 200036 xsym               ADSC9   ZI$DIR+174               cn=1,n=30
         4 001504   000000 000036 xsym               ADSC9   FIDSF_RD                 cn=0,n=30

      712     3581    3           EXISTSF=ZI$DIR.OPEN_MODE; /* INDEX FILE CAN HAVE 'ON' OPT */

   3581  4 001505   000125 236000 xsym               LDQ     ZI$DIR+85
         4 001506   000040 772000                    QRL     32
         4 001507   000003 376007                    ANQ     3,DL
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:102  
         4 001510   000042 736000                    QLS     34
         4 001511   000000 756000 xsym               STQ     EXISTSF

      713     3582    3           END;

      714     3583    2       CALL SYS_FUNC_OPEN ALTRET(ALT_OPEN);

   3583  4 001512   000002 631400 5                  EPPR1   2
         4 001513   000000 701000 xent               TSX1    SYS_FUNC_OPEN
         4 001514   001646 702000 4                  TSX2    ALT_OPEN

      715     3584    2       DEST_FILE = DCBADDR(DESTDCB)->F$DCB.NAME#;

   3584  4 001515   000003 470400 5                  LDP0    3
         4 001516   000000 471500                    LDP1    0,,PR0
         4 001517   200004 220100                    LDX0    DESTDCB,,AUTO
         4 001520   100000 473510                    LDP3    0,X0,PR1
         4 001521   000000 100500                    MLR     fill='000'O
         4 001522   300010 000040                    ADSC9   8,,PR3                   cn=0,n=32
         4 001523   000026 000040 0                  ADSC9   DEST_FILE                cn=0,n=32

      716     3585    2       IF SUBSTR(DEST_FILE.TEXT,0,1)='*' THEN

   3585  4 001524   000026 236000 0                  LDQ     DEST_FILE
         4 001525   000777 376003                    ANQ     511,DU
         4 001526   000052 116003                    CMPQ    42,DU
         4 001527   001544 601000 4                  TNZ     s:3596

      717     3586    3       DO;

      718     3587        /*E* ERROR: ZIU-10002-C
      719     3588        MESSAGE: The destination file cannot be a star file(*?)
      720     3589                 in DUMP/LOAD. Please reset your DCB.   */
      721     3590    3           ERRCODESF.ERR# = 10002;

   3590  4 001530   000000 236000 xsym               LDQ     ERRCODESF
         4 001531   000005 376000 5                  ANQ     5
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:103  
         4 001532   234220 276007                    ORQ     80016,DL
         4 001533   000000 756000 xsym               STQ     ERRCODESF

      722     3591    3           MSGCODE = ERRCODE_RDEF;

   3591  4 001534   000000 756000 xsym               STQ     MSGCODE

      723     3592    3           ERRFLGSF =4;

   3592  4 001535   004000 236003                    LDQ     2048,DU
         4 001536   000000 756000 xsym               STQ     ERRFLGSF

      724     3593    3           CALL SYS_FUNC_ERRMSG;

   3593  4 001537   000002 631400 5                  EPPR1   2
         4 001540   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         4 001541   000000 011000                    NOP     0

      725     3594    3           ALTRETURN;

   3594  4 001542   200010 221300                    LDX1  ! COMPRESS_SIZE+2,,AUTO
         4 001543   000000 702211                    TSX2  ! 0,X1

      726     3595    3           END;
      727     3596    2       CALL SYS_FUNC_RELEASE ALTRET(ALT_OPEN);

   3596  4 001544   000002 631400 5                  EPPR1   2
         4 001545   000000 701000 xent               TSX1    SYS_FUNC_RELEASE
         4 001546   001646 702000 4                  TSX2    ALT_OPEN

      728     3597    2       IF DCBADDR(DESTDCB)->F$DCB.ASN#=%TAPE# THEN

   3597  4 001547   000003 470400 5                  LDP0    3
         4 001550   000000 471500                    LDP1    0,,PR0
         4 001551   200004 220100                    LDX0    DESTDCB,,AUTO
         4 001552   100000 473510                    LDP3    0,X0,PR1
         4 001553   300032 236100                    LDQ     26,,PR3
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:104  
         4 001554   777000 376007                    ANQ     -512,DL
         4 001555   002000 116007                    CMPQ    1024,DL
         4 001556   001577 601000 4                  TNZ     s:3609

      729     3598    3       DO; /* DUMP TO TAPE FILE, SO SET BLOCK=YES AND BLKL */

      730     3599    3           IF DCBADDR(DESTDCB)->F$DCB.DENSITY#<3 THEN

   3599  4 001557   300043 236100                    LDQ     35,,PR3
         4 001560   000777 376007                    ANQ     511,DL
         4 001561   000003 116007                    CMPQ    3,DL
         4 001562   001566 603000 4                  TRC     s:3602

      731     3600    3               TAPE_BLOCK = 8; /* BPI=556 OR 800, USE BIG BLOCK */

   3600  4 001563   000010 235007                    LDA     8,DL
         4 001564   000015 755000 0                  STA     TAPE_BLOCK
         4 001565   001574 710000 4                  TRA     s:3606

      732     3601    3           ELSE
      733     3602    3               IF DCBADDR(DESTDCB)->F$DCB.DENSITY#=3 THEN

   3602  4 001566   001572 601000 4                  TNZ     s:3605

      734     3603    3                   TAPE_BLOCK=4; /* BPI=1600,USE 4K BLOCK */

   3603  4 001567   000004 235007                    LDA     4,DL
         4 001570   000015 755000 0                  STA     TAPE_BLOCK
         4 001571   001574 710000 4                  TRA     s:3606

      735     3604    3               ELSE
      736     3605    3                   TAPE_BLOCK = 2; /* BPI=6250, USE SMALL BLCK FOR HIGH DEN */

   3605  4 001572   000002 235007                    LDA     2,DL
         4 001573   000015 755000 0                  STA     TAPE_BLOCK

      737     3606    3           BLKLSF = TAPE_BLOCK*4096;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:105  

   3606  4 001574   000014 735000                    ALS     12
         4 001575   000000 755000 xsym               STA     BLKLSF

      738     3607    3           END;

   3607  4 001576   001601 710000 4                  TRA     s:3610

      739     3608    2       ELSE
      740     3609    2           TAPE_BLOCK=4096; /* SET TO A REAL BIG NUMBER FOR DISK DUMP */

   3609  4 001577   010000 235007                    LDA     4096,DL
         4 001600   000015 755000 0                  STA     TAPE_BLOCK

      741     3610    2       TOTL_PGS_DUMP = 1; /* NOW WE WILL DO A REAL OPEN */

   3610  4 001601   000001 235007                    LDA     1,DL
         4 001602   000012 755000 0                  STA     TOTL_PGS_DUMP

      742     3611    2       ORGSF = %RESTRICT#;

   3611  4 001603   000022 236007                    LDQ     18,DL
         4 001604   000000 756000 xsym               STQ     ORGSF

      743     3612    2       ACSSF = %BLOCK#; /* IN BLOCK MODE */

   3612  4 001605   000003 235007                    LDA     3,DL
         4 001606   000000 755000 xsym               STA     ACSSF

      744     3613    2       FIDSF = DEST_FILE.TEXT;

   3613  4 001607   040000 100400                    MLR     fill='040'O
         4 001610   000026 200036 0                  ADSC9   DEST_FILE                cn=1,n=30
         4 001611   000000 000036 xsym               ADSC9   FIDSF_RD                 cn=0,n=30

      745     3614    2       REASGNSF = %NO#;

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:106  
   3614  4 001612   000000 450000 xsym               STZ     REASGNSF

      746     3615    2       TESTSF = %NO#;

   3615  4 001613   000000 450000 xsym               STZ     TESTSF

      747     3616    2       FUNSF = %CREATE#;

   3616  4 001614   000000 755000 xsym               STA     FUNSF

      748     3617    2       EXISTSF = %NEWFILE#;

   3617  4 001615   600000 236003                    LDQ     -65536,DU
         4 001616   000000 756000 xsym               STQ     EXISTSF

      749     3618    2       CALL GET_FILESIZE;

   3618  4 001617   000002 631400 5                  EPPR1   2
         4 001620   000000 701000 xent               TSX1    GET_FILESIZE
         4 001621   000000 011000                    NOP     0

      750     3619    2       CALL SYS_FUNC_OPEN ALTRET(ALT_OPEN);

   3619  4 001622   000002 631400 5                  EPPR1   2
         4 001623   000000 701000 xent               TSX1    SYS_FUNC_OPEN
         4 001624   001646 702000 4                  TSX2    ALT_OPEN

      751     3620    2       IF FILE_TYPE='IND' THEN

   3620  4 001625   200011 470500                    LDP0    @FILE_TYPE,,AUTO
         4 001626   040000 106500                    CMPC    fill='040'O
         4 001627   000000 000003                    ADSC9   0,,PR0                   cn=0,n=3
         4 001630   000005 000003 1                  ADSC9   LEFT_JUSTIFY+4           cn=0,n=3
         4 001631   001634 601000 4                  TNZ     s:3622

      752     3621    2           CALL DUMPING_MSG; /* NOW START DUMPING INDEX AREAS */

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:107  
   3621  4 001632   000003 701000 4                  TSX1    DUMPING_MSG
         4 001633   000000 011000                    NOP     0

      753     3622    2       CALL PROCESS_KEY_DUMP ALTRET(ALTEND);

   3622  4 001634   001660 701000 4                  TSX1    PROCESS_KEY_DUMP
         4 001635   001656 702000 4                  TSX2    ALTEND

      754     3623    2       CALL DUMP_REPRT(FILE_TYPE);

   3623  4 001636   200011 236100                    LDQ     @FILE_TYPE,,AUTO
         4 001637   200013 756100                    STQ     @HI_PGE,,AUTO
         4 001640   002013 701000 4                  TSX1    DUMP_REPRT
         4 001641   000000 011000                    NOP     0

      755     3624        /*
      756     3625           Close and release dcbs.
      757     3626        */
      758     3627    2       CALL CLOSE_FILES;

   3627  4 001642   002142 701000 4                  TSX1    CLOSE_FILES
         4 001643   000000 011000                    NOP     0

      759     3628    2       RETURN;

   3628  4 001644   200010 221300                    LDX1  ! COMPRESS_SIZE+2,,AUTO
         4 001645   000001 702211                    TSX2  ! 1,X1

      760     3629        /**/
      761     3630    2   ALT_OPEN:
      762     3631         /*E* ERROR: ZIU-01070-C
      763     3632               MESSAGE: Unable to open the file %FN.
      764     3633               */
      765     3634    2       ERRCODESF.ERR# = 1070;

   3634  4 001646   000000 236000 xsym  ALT_OPEN     LDQ     ERRCODESF
         4 001647   000005 376000 5                  ANQ     5
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:108  
         4 001650   020560 276007                    ORQ     8560,DL
         4 001651   000000 756000 xsym               STQ     ERRCODESF

      766     3635    2       MSGCODE = ERRCODE_RDEF;

   3635  4 001652   000000 756000 xsym               STQ     MSGCODE

      767     3636    2       CALL SYS_FUNC_ERRMSG;

   3636  4 001653   000002 631400 5                  EPPR1   2
         4 001654   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         4 001655   000000 011000                    NOP     0

      768     3637    2   ALTEND:
      769     3638    2       ALTRETURN;

   3638  4 001656   200010 221300       ALTEND       LDX1  ! COMPRESS_SIZE+2,,AUTO
         4 001657   000000 702211                    TSX2  ! 0,X1

      770     3639    2   END DUMP_ASCFID;
      771     3640        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:109  
      772     3641        /*------------------------------------------------------------------
      773     3642             D U M P    K E Y E D    F I L E    F O R   A R E A
      774     3643        ------------------------------------------------------------------*/
      775     3644    1   PROCESS_KEY_DUMP: PROC ALTRET;

   3644  4 001660   200012 741300       PROCESS_KEY* STX1  ! @PASS_DATE,,AUTO

      776     3645         /**/
      777     3646    3       DO WHILE('1'B);

      778     3647    3           I_O_INDX = NBUFS;

   3647  4 001661   000000 720000 xsym               LXL0    NBUFS
         4 001662   000000 740000 0                  STX0    I_O_INDX

      779     3648    3           DCBSF = ZI$DIR.SRCE_NM.DCB#;

   3648  4 001663   000255 221000 xsym               LDX1    ZI$DIR+173
         4 001664   000000 741000 xsym               STX1    DCBSF

      780     3649    3           BUFSF = VECTOR(I_O_BUF);

   3649  4 001665   000021 235000 5                  LDA     17
         4 001666   000000 236000 xsym               LDQ     I_O_BUF$
         4 001667   000000 755000 xsym               STA     BUFSF
         4 001670   000001 756000 xsym               STQ     BUFSF+1

      781     3650    3           BUFLNSF = 4096 * NBUFS;

   3650  4 001671   000000 235000 xsym               LDA     NBUFS
         4 001672   000014 735000                    ALS     12
         4 001673   000000 755000 xsym               STA     BUFLNSF

      782     3651    3           WAITSF = %YES#;

   3651  4 001674   400000 236003                    LDQ     -131072,DU
         4 001675   000000 756000 xsym               STQ     WAITSF
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:110  

      783     3652    3           CALL SYS_FUNC_READ ALTRET(ALT_DUMP);

   3652  4 001676   000002 631400 5                  EPPR1   2
         4 001677   000000 701000 xent               TSX1    SYS_FUNC_READ
         4 001700   002001 702000 4                  TSX2    ALT_DUMP

      784     3653    3           IF BREAK_FLAG > 0 THEN ALTRETURN;

   3653  4 001701   000000 235000 xsym               LDA     BREAK_FLAG
         4 001702   001705 604400 4                  TMOZ    s:3654

   3653  4 001703   200012 221300                    LDX1  ! @PASS_DATE,,AUTO
         4 001704   000000 702211                    TSX2  ! 0,X1

      785     3654    3           X=DCBADDR(AREADCB)->F$DCB.ARS#/4096; /* # PAGES READ */

   3654  4 001705   000003 470400 5                  LDP0    3
         4 001706   000000 471500                    LDP1    0,,PR0
         4 001707   200003 220100                    LDX0    AREADCB,,AUTO
         4 001710   100000 473510                    LDP3    0,X0,PR1
         4 001711   300000 236100                    LDQ     0,,PR3
         4 001712   010000 506007                    DIV     4096,DL
         4 001713   000000 756000 xsym               STQ     X

      786     3655    3           BUFLNSF = NBUFS * 4096;

   3655  4 001714   000000 235000 xsym               LDA     NBUFS
         4 001715   000014 735000                    ALS     12
         4 001716   000000 755000 xsym               STA     BUFLNSF

      787     3656    3           DCBSF = DESTDCB;

   3656  4 001717   200004 221100                    LDX1    DESTDCB,,AUTO
         4 001720   000000 741000 xsym               STX1    DCBSF

      788     3657    3           I_O_INDX = 0;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:111  

   3657  4 001721   000000 222003                    LDX2    0,DU
         4 001722   000000 742000 0                  STX2    I_O_INDX

      789     3658    4           DO WHILE(X>0); /* WRITE TAPE TO EACH TAPE BLOCK SIZE */

   3658  4 001723   000000 116003                    CMPQ    0,DU
         4 001724   001661 604400 4                  TMOZ    s:3647

      790     3659    4               IF X>TAPE_BLOCK THEN

   3659  4 001725   000000 236000 xsym               LDQ     X
         4 001726   000015 116000 0                  CMPQ    TAPE_BLOCK
         4 001727   001734 604400 4                  TMOZ    s:3662

      791     3660    4                   BUFLNSF=TAPE_BLOCK*4096;

   3660  4 001730   000015 235000 0                  LDA     TAPE_BLOCK
         4 001731   000014 735000                    ALS     12
         4 001732   000000 755000 xsym               STA     BUFLNSF
         4 001733   001737 710000 4                  TRA     s:3663

      792     3661    4               ELSE
      793     3662    4                   BUFLNSF=X*4096;

   3662  4 001734   000000 235000 xsym               LDA     X
         4 001735   000014 735000                    ALS     12
         4 001736   000000 755000 xsym               STA     BUFLNSF

      794     3663    4               X=X-BUFLNSF/4096;

   3663  4 001737   000000 236000 xsym               LDQ     BUFLNSF
         4 001740   000014 772000                    QRL     12
         4 001741   200040 756100                    STQ     PAGES+19,,AUTO
         4 001742   000000 236000 xsym               LDQ     X
         4 001743   200040 136100                    SBLQ    PAGES+19,,AUTO
         4 001744   000000 756000 xsym               STQ     X
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:112  

      795     3664    4               VFCSF = %NO#;

   3664  4 001745   000000 450000 xsym               STZ     VFCSF

      796     3665    4               BUFSF = VECTOR(I_O_BUF(I_O_INDX));

   3665  4 001746   000021 235000 5                  LDA     17
         4 001747   000000 236000 0                  LDQ     I_O_INDX
         4 001750   777777 376003                    ANQ     -1,DU
         4 001751   000012 736000                    QLS     10
         4 001752   000000 036000 xsym               ADLQ    I_O_BUF$
         4 001753   000000 755000 xsym               STA     BUFSF
         4 001754   000001 756000 xsym               STQ     BUFSF+1

      797     3666    4               CALL SYS_FUNC_WRIT ALTRET(ALT_DUMP);

   3666  4 001755   000002 631400 5                  EPPR1   2
         4 001756   000000 701000 xent               TSX1    SYS_FUNC_WRIT
         4 001757   002001 702000 4                  TSX2    ALT_DUMP

      798     3667    4               TOTL_PGS_DUMP = TOTL_PGS_DUMP + (BUFLNSF+1)/4096;

   3667  4 001760   000000 236000 xsym               LDQ     BUFLNSF
         4 001761   000001 036007                    ADLQ    1,DL
         4 001762   000014 772000                    QRL     12
         4 001763   000012 036000 0                  ADLQ    TOTL_PGS_DUMP
         4 001764   000012 756000 0                  STQ     TOTL_PGS_DUMP

      799     3668    4               I_O_INDX = I_O_INDX + (BUFLNSF+1)/4096;

   3668  4 001765   000000 236000 xsym               LDQ     BUFLNSF
         4 001766   000001 036007                    ADLQ    1,DL
         4 001767   000014 772000                    QRL     12
         4 001770   000000 235000 0                  LDA     I_O_INDX
         4 001771   000022 731000                    ARS     18
         4 001772   200040 755100                    STA     PAGES+19,,AUTO
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:113  
         4 001773   200040 036100                    ADLQ    PAGES+19,,AUTO
         4 001774   000000 620006                    EAX0    0,QL
         4 001775   000000 740000 0                  STX0    I_O_INDX

      800     3669    4               END; /* DIVIDE 1 BIG WRITE TO SEVERAL SMALLER ONES IF TAPE DUMP */

   3669  4 001776   000000 235000 xsym               LDA     X
         4 001777   001725 605400 4                  TPNZ    s:3659

      801     3670    3           END;

   3670  4 002000   001661 710000 4                  TRA     s:3647

      802     3671         /**/
      803     3672    2   ALT_DUMP:
      804     3673    2       IF B$TCB$->B$TCB.ALT$->B$EXCFR.ERR.ERR# = %E$EOF THEN

   3673  4 002001   000000 470400 xsym  ALT_DUMP     LDP0    B$TCB$
         4 002002   000000 471500                    LDP1    0,,PR0
         4 002003   100102 236100                    LDQ     66,,PR1
         4 002004   377770 376007                    ANQ     131064,DL
         4 002005   000060 116007                    CMPQ    48,DL
         4 002006   002011 601000 4                  TNZ     s:3676

      805     3674    2           RETURN;

   3674  4 002007   200012 221300                    LDX1  ! @PASS_DATE,,AUTO
         4 002010   000001 702211                    TSX2  ! 1,X1

      806     3675    2       ELSE
      807     3676    2           ALTRETURN;

   3676  4 002011   200012 221300                    LDX1  ! @PASS_DATE,,AUTO
         4 002012   000000 702211                    TSX2  ! 0,X1

      808     3677    2   END PROCESS_KEY_DUMP;
      809     3678        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:114  
      810     3679        /*-----------------------------------------------------------------*/
      811     3680        /*       D U M P   R E P O R T   O F   F I L E   I N F O           */
      812     3681        /*-----------------------------------------------------------------*/
      813     3682    1   DUMP_REPRT: PROC(IDS_FILE);

   3682  4 002013   200012 741300       DUMP_REPRT   STX1  ! @PASS_DATE,,AUTO

      814     3683    2   DCL FID$ PTR STATIC INIT(ADDR(SRCE_FILE.TEXT));
      815     3684    2   DCL FID_NM CHAR(N) BASED(FID$);
      816     3685    2   DCL N SBIN WORD;
      817     3686    2   DCL PAGES CHAR(10);
      818     3687    2   DCL IDS_FILE CHAR(3) CALIGNED;
      819     3688        /*
      820     3689           THIS ROUTINE IS USED TO PRINT THE NAME OF THE FILE THAT
      821     3690           THE SOURCE IS BEING DUMPED TO AND THE NUMBER OF PAGES DUMPED */
      822     3691    2       CALL INDEX1(N,' ',SRCE_FILE.TEXT);

   3691  4 002014   000000 124400                    SCM     mask='000'O
         4 002015   000016 200037 0                  ADSC9   SRCE_FILE                cn=1,n=31
         4 002016   000036 000001 5                  ADSC9   30                       cn=0,n=1
         4 002017   200014 000100                    ARG     N,,AUTO

      823     3692    2       CALL CONCAT(REPRT,'* * * ',IDS_FILE,' file ',FID_NM,

   3692  4 002020   040000 100400                    MLR     fill='040'O
         4 002021   000023 000006 1                  ADSC9   LEFT_JUSTIFY+18          cn=0,n=6
         4 002022   000036 000006 0                  ADSC9   REPRT                    cn=0,n=6
         4 002023   200013 470500                    LDP0    @IDS_FILE,,AUTO
         4 002024   040000 100500                    MLR     fill='040'O
         4 002025   000000 000003                    ADSC9   0,,PR0                   cn=0,n=3
         4 002026   000037 400003 0                  ADSC9   REPRT+1                  cn=2,n=3
         4 002027   040000 100400                    MLR     fill='040'O
         4 002030   000025 000006 1                  ADSC9   LEFT_JUSTIFY+20          cn=0,n=6
         4 002031   000040 200006 0                  ADSC9   REPRT+2                  cn=1,n=6
         4 002032   000101 471400 0                  LDP1    FID$
         4 002033   200014 720100                    LXL0    N,,AUTO
         4 002034   040000 100540                    MLR     fill='040'O
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:115  
         4 002035   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         4 002036   000041 600101 0                  ADSC9   REPRT+3                  cn=3,n=65
         4 002037   200014 236100                    LDQ     N,,AUTO
         4 002040   000101 116007                    CMPQ    65,DL
         4 002041   002056 605000 4                  TPL     s:3694
         4 002042   777676 622006                    EAX2    -66,QL
         4 002043   777777 662003                    ERX2    -1,DU
         4 002044   040046 100400                    MLR     fill='040'O
         4 002045   000027 000020 1                  ADSC9   LEFT_JUSTIFY+22          cn=0,n=16
         4 002046   000041 600012 0                  ADSC9   REPRT+3,Q                cn=3,n=*X2
         4 002047   000061 116007                    CMPQ    49,DL
         4 002050   002056 605000 4                  TPL     s:3694
         4 002051   777716 623006                    EAX3    -50,QL
         4 002052   777777 663003                    ERX3    -1,DU
         4 002053   040046 100400                    MLR     fill='040'O
         4 002054   000026 200037 0                  ADSC9   DEST_FILE                cn=1,n=31
         4 002055   000045 600013 0                  ADSC9   REPRT+7,Q                cn=3,n=*X3

      824     3693    2          ' dumped to file ',DEST_FILE.TEXT);
      825     3694    2   /**/ DCBSF = DCBNUM(M$LO);

   3694  4 002056   000000 236007 xsym               LDQ     M$LO,DL
         4 002057   000000 622006                    EAX2    0,QL
         4 002060   000000 742000 xsym               STX2    DCBSF

      826     3695    2   /**/ BUFSF = VECTOR(REPRT);

   3695  4 002061   000000 237000 5                  LDAQ    0
         4 002062   000000 755000 xsym               STA     BUFSF
         4 002063   000001 756000 xsym               STQ     BUFSF+1

      827     3696    2   /**/ BUFLNSF = 80;

   3696  4 002064   000120 235007                    LDA     80,DL
         4 002065   000000 755000 xsym               STA     BUFLNSF

      828     3697    2   /**/ VFCSF = %NO#;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:116  

   3697  4 002066   000000 450000 xsym               STZ     VFCSF

      829     3698    2       CALL SYS_FUNC_WRIT; /* WRITE FROM_FILE AND TO_FILE NAMES */

   3698  4 002067   000002 631400 5                  EPPR1   2
         4 002070   000000 701000 xent               TSX1    SYS_FUNC_WRIT
         4 002071   000000 011000                    NOP     0

      830     3699    2       CALL BINCHAR(PAGES,TOTL_PGS_DUMP);

   3699  4 002072   000012 235000 0                  LDA     TOTL_PGS_DUMP
         4 002073   000044 773000                    LRL     36
         4 002074   200040 757100                    STAQ    PAGES+19,,AUTO
         4 002075   000100 301500                    BTD
         4 002076   200040 000010                    NDSC9   PAGES+19,,AUTO           cn=0,s=lsgnf,sf=0,n=8
         4 002077   200015 030012                    NDSC9   PAGES,,AUTO              cn=0,s=nosgn,sf=0,n=10

      831     3700    2       CALL ZERO_SUP(PAGES,10,'1'B);

   3700  4 002100   000050 236000 5                  LDQ     40
         4 002101   200042 756100                    STQ     PAGES+21,,AUTO
         4 002102   000042 236000 5                  LDQ     34
         4 002103   200041 756100                    STQ     PAGES+20,,AUTO
         4 002104   200015 630500                    EPPR0   PAGES,,AUTO
         4 002105   200040 450500                    STP0    PAGES+19,,AUTO
         4 002106   200040 630500                    EPPR0   PAGES+19,,AUTO
         4 002107   000037 631400 5                  EPPR1   31
         4 002110   000000 701000 xent               TSX1    ZERO_SUP
         4 002111   000000 011000                    NOP     0

      832     3701    2       IF IDS_FILE = 'IDS' THEN

   3701  4 002112   200013 470500                    LDP0    @IDS_FILE,,AUTO
         4 002113   040000 106500                    CMPC    fill='040'O
         4 002114   000000 000003                    ADSC9   0,,PR0                   cn=0,n=3
         4 002115   000006 000003 1                  ADSC9   LEFT_JUSTIFY+5           cn=0,n=3
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:117  
         4 002116   002126 601000 4                  TNZ     s:3704

      833     3702    2           CALL CONCAT(REPRT,'      Number of pages dumped: ',PAGES);

   3702  4 002117   040000 100400                    MLR     fill='040'O
         4 002120   000033 000036 1                  ADSC9   LEFT_JUSTIFY+26          cn=0,n=30
         4 002121   000036 000036 0                  ADSC9   REPRT                    cn=0,n=30
         4 002122   040000 100500                    MLR     fill='040'O
         4 002123   200015 000012                    ADSC9   PAGES,,AUTO              cn=0,n=10
         4 002124   000045 400062 0                  ADSC9   REPRT+7                  cn=2,n=50
         4 002125   002134 710000 4                  TRA     s:3705

      834     3703    2       ELSE
      835     3704    2           CALL CONCAT(REPRT,'      Number of granules dumped: ',PAGES);

   3704  4 002126   040000 100400                    MLR     fill='040'O
         4 002127   000043 000041 1                  ADSC9   LEFT_JUSTIFY+34          cn=0,n=33
         4 002130   000036 000041 0                  ADSC9   REPRT                    cn=0,n=33
         4 002131   040000 100500                    MLR     fill='040'O
         4 002132   200015 000012                    ADSC9   PAGES,,AUTO              cn=0,n=10
         4 002133   000046 200057 0                  ADSC9   REPRT+8                  cn=1,n=47

      836     3705    2   /**/ VFCSF = %NO#;

   3705  4 002134   000000 450000 xsym               STZ     VFCSF

      837     3706    2       CALL SYS_FUNC_WRIT;

   3706  4 002135   000002 631400 5                  EPPR1   2
         4 002136   000000 701000 xent               TSX1    SYS_FUNC_WRIT
         4 002137   000000 011000                    NOP     0

      838     3707    2   END DUMP_REPRT;

   3707  4 002140   200012 221300                    LDX1  ! @PASS_DATE,,AUTO
         4 002141   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:118  
      839     3708        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:119  
      840     3709        /*------------------------------------------------------------------
      841     3710                  C L O S E    T H E    D C B 'S    P R O C
      842     3711        -------------------------------------------------------------------*/
      843     3712    1   CLOSE_FILES: PROC;

   3712  4 002142   200012 741300       CLOSE_FILES  STX1  ! @PASS_DATE,,AUTO

      844     3713    2       DCBSF = ZI$DIR.SRCE_NM.DCB#;

   3713  4 002143   000255 220000 xsym               LDX0    ZI$DIR+173
         4 002144   000000 740000 xsym               STX0    DCBSF

      845     3714    2       IF DCBADDR(DCBSF) -> F$DCB.FCD# = %YES# THEN /* dbc is open */

   3714  4 002145   000003 470400 5                  LDP0    3
         4 002146   000000 471500                    LDP1    0,,PR0
         4 002147   100000 473510                    LDP3    0,X0,PR1
         4 002150   300031 236100                    LDQ     25,,PR3
         4 002151   020000 316007                    CANQ    8192,DL
         4 002152   002156 600000 4                  TZE     s:3716

      846     3715    2           CALL SYS_FUNC_CLOS;

   3715  4 002153   000002 631400 5                  EPPR1   2
         4 002154   000000 701000 xent               TSX1    SYS_FUNC_CLOS
         4 002155   000000 011000                    NOP     0

      847     3716    2       CALL SYS_FUNC_RELDCB;

   3716  4 002156   000002 631400 5                  EPPR1   2
         4 002157   000000 701000 xent               TSX1    SYS_FUNC_RELDCB
         4 002160   000000 011000                    NOP     0

      848     3717    2       IF ZI$DIR.SRCE_NM.DCB# = ZI$DIR.DEST_NM.DCB# THEN

   3717  4 002161   000255 220000 xsym               LDX0    ZI$DIR+173
         4 002162   000266 100000 xsym               CMPX0   ZI$DIR+182
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:120  
         4 002163   002166 601000 4                  TNZ     s:3719

      849     3718    2           RETURN;

   3718  4 002164   200012 221300                    LDX1  ! @PASS_DATE,,AUTO
         4 002165   000001 702211                    TSX2  ! 1,X1

      850     3719    2       DCBSF = ZI$DIR.DEST_NM.DCB#;

   3719  4 002166   000266 221000 xsym               LDX1    ZI$DIR+182
         4 002167   000000 741000 xsym               STX1    DCBSF

      851     3720    2       IF DCBADDR(DCBSF) -> F$DCB.FCD# = %YES# THEN /* dbc is open */

   3720  4 002170   000003 470400 5                  LDP0    3
         4 002171   000000 471500                    LDP1    0,,PR0
         4 002172   100000 473511                    LDP3    0,X1,PR1
         4 002173   300031 236100                    LDQ     25,,PR3
         4 002174   020000 316007                    CANQ    8192,DL
         4 002175   002210 600000 4                  TZE     s:3726

      852     3721    3       DO;

      853     3722    3           POSSF = ZI$DIR.POS; /* Set option for tape position */

   3722  4 002176   000141 236000 xsym               LDQ     ZI$DIR+97
         4 002177   000022 772000                    QRL     18
         4 002200   000777 376007                    ANQ     511,DL
         4 002201   000033 736000                    QLS     27
         4 002202   000000 756000 xsym               STQ     POSSF

      854     3723    3           RELGSF = '1'B; /* set only for destination files */

   3723  4 002203   400000 236003                    LDQ     -131072,DU
         4 002204   000000 756000 xsym               STQ     RELGSF

      855     3724    3           CALL SYS_FUNC_CLOS;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:121  

   3724  4 002205   000002 631400 5                  EPPR1   2
         4 002206   000000 701000 xent               TSX1    SYS_FUNC_CLOS
         4 002207   000000 011000                    NOP     0

      856     3725    3           END;

      857     3726    2       CALL SYS_FUNC_RELDCB;

   3726  4 002210   000002 631400 5                  EPPR1   2
         4 002211   000000 701000 xent               TSX1    SYS_FUNC_RELDCB
         4 002212   000000 011000                    NOP     0

      858     3727    2       RETURN;

   3727  4 002213   200012 221300                    LDX1  ! @PASS_DATE,,AUTO
         4 002214   000001 702211                    TSX2  ! 1,X1

      859     3728    2   END CLOSE_FILES;
      860     3729        %EJECT;
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:122  
      861     3730        /*-------------------------------------------------------------------
      862     3731            E X C E P T I O N A L    C O N D I T I O N   R E T U R N S
      863     3732          -----------------------------------------------------------------*/
      864     3733    1   ALT_SOURCE_FILE:
      865     3734         /*E* ERROR: ZIU-01050-C
      866     3735                MESSAGE: Unable to continue dump processing on area %U1.
      867     3736           */
      868     3737    1       ERR_INSERT.CNT(0) = ZI$DIR.SRCE_NM.NAME.CNT;

   3737  4 002215   000245 236000 xsym  ALT_SOURCE_* LDQ     ZI$DIR+165
         4 002216   000000 552040 xsym               STBQ    ERR_INSERT,'40'O

      869     3738    1       ERR_INSERT.TEXT(0) = ZI$DIR.SRCE_NM.NAME.TEXT;

   3738  4 002217   040000 100400                    MLR     fill='040'O
         4 002220   000245 200036 xsym               ADSC9   ZI$DIR+165               cn=1,n=30
         4 002221   000000 200036 xsym               ADSC9   ERR_INSERT               cn=1,n=30

      870     3739    1       ERRCODESF.ERR# = 1050;

   3739  4 002222   000000 236000 xsym               LDQ     ERRCODESF
         4 002223   000005 376000 5                  ANQ     5
         4 002224   020320 276007                    ORQ     8400,DL
         4 002225   000000 756000 xsym               STQ     ERRCODESF

      871     3740    1       MSGCODE = ERRCODE_RDEF;

   3740  4 002226   000000 756000 xsym               STQ     MSGCODE

      872     3741    1       CALL SYS_FUNC_ERRMSG;

   3741  4 002227   000002 631400 5                  EPPR1   2
         4 002230   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         4 002231   000000 011000                    NOP     0

      873     3742    1       ALTRETURN;

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:123  
   3742  4 002232   000000 702200 xent               TSX2  ! X66_AALT

      874     3743    1   ALT_DEST_FILE:
      875     3744    1   /**/ DCBSF = AREADCB;

   3744  4 002233   200003 220100       ALT_DEST_FI* LDX0    AREADCB,,AUTO
         4 002234   000000 740000 xsym               STX0    DCBSF

      876     3745    1       CALL SYS_FUNC_CLOS;

   3745  4 002235   000002 631400 5                  EPPR1   2
         4 002236   000000 701000 xent               TSX1    SYS_FUNC_CLOS
         4 002237   000000 011000                    NOP     0

      877     3746         /*E* ERROR: ZIU-01051-C
      878     3747                MESSAGE: Unable to create dump file %FN.
      879     3748           */
      880     3749    1       DCBSF = DESTDCB;

   3749  4 002240   200004 220100                    LDX0    DESTDCB,,AUTO
         4 002241   000000 740000 xsym               STX0    DCBSF

      881     3750    1       ERRCODESF.ERR# = 1051;

   3750  4 002242   000000 236000 xsym               LDQ     ERRCODESF
         4 002243   000005 376000 5                  ANQ     5
         4 002244   020330 276007                    ORQ     8408,DL
         4 002245   000000 756000 xsym               STQ     ERRCODESF

      882     3751    1       MSGCODE = ERRCODE_RDEF;

   3751  4 002246   000000 756000 xsym               STQ     MSGCODE

      883     3752    1       CALL SYS_FUNC_ERRMSG;

   3752  4 002247   000002 631400 5                  EPPR1   2
         4 002250   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:124  
         4 002251   000000 011000                    NOP     0

      884     3753    1       CALL CLOSE_FILES;

   3753  4 002252   002142 701000 4                  TSX1    CLOSE_FILES
         4 002253   000000 011000                    NOP     0

      885     3754    1       ALTRETURN;

   3754  4 002254   000000 702200 xent               TSX2  ! X66_AALT

      886     3755    1   ALT_AREA_READ:
      887     3756    1       CALL CLOSE_FILES;

   3756  4 002255   002142 701000 4     ALT_AREA_RE* TSX1    CLOSE_FILES
         4 002256   000000 011000                    NOP     0

      888     3757    1       ALTRETURN;

   3757  4 002257   000000 702200 xent               TSX2  ! X66_AALT

      889     3758    1   ALT_WRITE_DEST:
      890     3759    1       CALL CLOSE_FILES;

   3759  4 002260   002142 701000 4     ALT_WRITE_D* TSX1    CLOSE_FILES
         4 002261   000000 011000                    NOP     0

      891     3760    1       ALTRETURN;

   3760  4 002262   000000 702200 xent               TSX2  ! X66_AALT

      892     3761    1   ALT_DATE:
      893     3762    1       CALL CLOSE_FILES;

   3762  4 002263   002142 701000 4     ALT_DATE     TSX1    CLOSE_FILES
         4 002264   000000 011000                    NOP     0

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:125  
      894     3763    1       ALTRETURN;

   3763  4 002265   000000 702200 xent               TSX2  ! X66_AALT

      895     3764    1   ALT_RD_ATBLK:
      896     3765         /*E* ERROR: ZIU-01060-C
      897     3766           MESSAGE: Unable to continue processing at attribute page of %FN. */
      898     3767    1       ERRCODESF.ERR# = 1060;

   3767  4 002266   000000 236000 xsym  ALT_RD_ATBLK LDQ     ERRCODESF
         4 002267   000005 376000 5                  ANQ     5
         4 002270   020440 276007                    ORQ     8480,DL
         4 002271   000000 756000 xsym               STQ     ERRCODESF

      899     3768    1       MSGCODE = ERRCODE_RDEF;

   3768  4 002272   000000 756000 xsym               STQ     MSGCODE

      900     3769    1       CALL SYS_FUNC_ERRMSG;

   3769  4 002273   000002 631400 5                  EPPR1   2
         4 002274   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         4 002275   000000 011000                    NOP     0

      901     3770    1       CALL CLOSE_FILES;

   3770  4 002276   002142 701000 4                  TSX1    CLOSE_FILES
         4 002277   000000 011000                    NOP     0

      902     3771    1       ALTRETURN;

   3771  4 002300   000000 702200 xent               TSX2  ! X66_AALT

MSG_FLG
 Sect OctLoc
   0     004   0***** ******                                                    ....

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:126  
CHECKSUM
 Sect OctLoc
   0     005   0***** ******                                                    ....

PRINT_CHKS
 Sect OctLoc
   0     006   0***** ******                                                    ....

TOTL_PGS_DUMP
 Sect OctLoc
   0     012   000000 000001                                                    ....

SRCE_FILE
 Sect OctLoc
   0     016   ****** ******   ****** ******   ****** ******   ****** ******    ................

DEST_FILE
 Sect OctLoc
   0     026   ****** ******   ****** ******   ****** ******   ****** ******    ................

REPRT
 Sect OctLoc
   0     036   040040 040040   040040 040040   040040 040040   040040 040040
   0     056*  040040 040040   040040 040040   040040 040040   040040 040040

FID$
 Sect OctLoc
   0     101   000016 206000                                                    ....

RIGHT_JUSTIFY
 Sect OctLoc
   1     000   0***** ******                                                    ....

LEFT_JUSTIFY
 Sect OctLoc
   1     001   4***** ******                                                    ....

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:127  
(unnamed)
 Sect OctLoc
   1     002   056056 104165   155160 151156   147040 040040   111116 104040    ..Dumping   IND
   1     006   111104 123040   113105 131040   056056 056104   165155 160040    IDS KEY ...Dump
   1     012   164145 162155   151156 141164   145144 040040   104125 115120    terminated  DUMP
   1     016   120101 107105   120101 107105   123040 040040   040040 040040    PAGEPAGES
   1     022   040040 040040   052040 052040   052040 040040   040146 151154        * * *    fil
   1     026   145040 040040   040144 165155   160145 144040   164157 040146    e    dumped to f
   1     032   151154 145040   040040 040040   040040 116165   155142 145162    ile       Number
   1     036   040157 146040   160141 147145   163040 144165   155160 145144     of pages dumped
   1     042   072040 040040   040040 040040   040040 116165   155142 145162    :         Number
   1     046   040157 146040   147162 141156   165154 145163   040144 165155     of granules dum
   1     052   160145 144072   040040 040040                                    ped:

(unnamed)
 Sect OctLoc
   5     000   000023 777640   000036 006000   000000 000000   000000 006003    ................
   5     004   000005 006000   777777 400007   000000 006000   000000 006000    ................
   5     010   000000 006000   777000 777777   000006 000000   000013 006000    ................
   5     014   000014 006000   000000 006000   000000 006000   000000 006000    ................
   5     020   000003 006000   001777 777640   000002 006000   000006 006000    ................
   5     024   000007 006000   001777 420000   767777 777777   400000 000000    ................
   5     030   000001 777640   000127 606000   000001 377640   000126 206000    .....W.......V..
   5     034   000000 777640   000066 006000   040040 040040   000003 000000    .....6..    ....
   5     040   000000 000012   000075 006000   000040 006000   000000 006000    .....=... ......
   5     044   000072 006000   000040 006000   000001 006000   072040 040040    .:... ......:
   5     050   000027 006000                                                    ....
      903     3772    1   END ZIU$DUMP;

PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:128  
--  Include file information  --

   ZI_DBU_XREF.:ZIC0TOU  cannot be made into a system file and is referenced.
   ZI_GLOBAL_DBUTIL.:ZIC0TOU  is referenced.
   ZI$PG_STRUCTS.:ZIC0TOU  is referenced.
   ZI$DIR.:ZIC0TOU  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIU$DUMP.

   Procedure ZIU$DUMP requires 1217 words for executable code.
   Procedure ZIU$DUMP requires 36 words of local(AUTO) storage.

    No errors detected in file ZIU$DUMP.:ZIC0TSI    .
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:129  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:130  
          MINI XREF LISTING

ACCEPT_PAGE
        91**DCL      3202<>CALL     3204>>IF
ACNT
      2685**DCL      3094<<ASSIGN   3118<<ASSIGN   3567<<ASSIGN
ACSSF
      2645**DCL      3052<<ASSIGN   3091<<ASSIGN   3559<<ASSIGN   3572<<ASSIGN   3612<<ASSIGN
ALTEND IN PROCEDURE DUMP_ASCFID
      3638**LABEL    3622--CALLALT
ALT_AREA_READ
      3756**LABEL    3146--CALLALT  3147--CALLALT  3148--CALLALT  3171--CALLALT  3185--CALLALT  3194--CALLALT
ALT_ATBLK IN PROCEDURE GET_ATBLK
      3392**LABEL    3344--CALLALT
ALT_DATE
      3762**LABEL    3202--CALLALT
ALT_DEST_FILE
      3744**LABEL    3065--CALLALT  3098--CALLALT  3105--CALLALT  3119--CALLALT  3245--CALLALT
ALT_DUMP IN PROCEDURE PROCESS_KEY_DUMP
      3673**LABEL    3652--CALLALT  3666--CALLALT
ALT_OPEN IN PROCEDURE DUMP_ASCFID
      3634**LABEL    3564--CALLALT  3583--CALLALT  3596--CALLALT  3619--CALLALT
ALT_RD_ATBLK
      3767**LABEL    3080--CALLALT
ALT_SOURCE_FILE
      3737**LABEL    3057--CALLALT  3064--CALLALT
ALT_TSTAMP IN PROCEDURE CHK_DATE
      3429**LABEL    3420--CALLALT
ALT_WRITE_DEST
      3759**LABEL    3138--CALLALT  3218--CALLALT
AREADCB
        85**DCL      3048<<ASSIGN   3049>>ASSIGN   3059--ASSIGN   3061--IF       3063>>ASSIGN   3069--IF
      3337>>ASSIGN   3654--ASSIGN   3744>>ASSIGN
AREA_KEY$
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:131  
      2976**DCL      2979--IMP-PTR  3151>>DOWHILE  3154>>ASSIGN
AREA_KEY_XREF.CHECKED
      2984**DCL      3154<<ASSIGN
AREA_KEY_XREF.NAME
      2982**DCL      3151>>DOWHILE
ASNSF
      2648**DCL      3054<<ASSIGN   3090<<ASSIGN
ATBLK$
      2393**DCL      2394--IMP-PTR  3330--IMP-PTR  3345<<ASSIGN   3346>>IF       3357>>IF       3361>>IF
      3365>>IF       3367>>ASSIGN   3372>>ASSIGN   3372>>ASSIGN   3373>>ASSIGN   3374>>ASSIGN   3380>>ASSIGN
      3382>>ASSIGN   3384>>ASSIGN   3385>>IF       3387>>ASSIGN   3388>>ASSIGN
ATBLK_PG.AREA_NM
      2419**DCL      2420--REDEF    3346>>IF
ATBLK_PG.FIR_INV_PGNO
      2416**DCL      3365>>IF       3372>>ASSIGN
ATBLK_PG.LINE_INFO.LPP
      2414**DCL      3388>>ASSIGN
ATBLK_PG.LOW_DBK
      2417**DCL      3387>>ASSIGN
ATBLK_PG.MISC_INFO.CHKSM
      2424**DCL      3361>>IF
ATBLK_PG.MISC_INFO.KEY_FILE_BLT
      2423**DCL      3357>>IF
ATBLK_PG.NUM_DBPG
      2401**DCL      3367>>ASSIGN   3372>>ASSIGN   3373>>ASSIGN   3374>>ASSIGN
ATBLK_PG.STATUS
      2428**DCL      2436--REDEF
ATBLK_PG.STATUS.FULL_DUMP
      2434**DCL      3382<<ASSIGN   3384<<ASSIGN   3385>>IF
B$EXCFR.ASL
       269**DCL       269--REDEF
B$EXCFR.ERR.ERR#
       283**DCL       283--REDEF    3673>>IF
B$EXCFR.EVID
       282**DCL       282--REDEF     283--REDEF
B$EXCFR.IR
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:132  
       270**DCL       270--REDEF
B$EXCFR.PREVSZ
       269**DCL       269--REDEF
B$EXCFR.SUBC
       281**DCL       281--REDEF     282--REDEF     282--REDEF
B$TCB.ALT$
       266**DCL      3673>>IF
B$TCB$
      2755**DCL      3673>>IF
BAD_CHK IN PROCEDURE CHECK_SUM
      3478**PROC     3448--CALL     3469--CALL     3472--CALL
BAD_CHK_HIGH
        99**DCL      3483<<ASSIGN   3486>>IF       3493>>IF       3497>>CALLBLT  3501>>IF       3510<<ASSIGN
      3513<<ASSIGN
BAD_CHK_LOW
        98**DCL      3480>>IF       3482<<ASSIGN   3491>>CALLBLT  3493>>IF       3509<<ASSIGN
BKUPSF
      2655**DCL      3093<<ASSIGN
BLKLSF
      2633**DCL      3115<<ASSIGN   3606<<ASSIGN
BREAK_FLAG
      2765**DCL      3174>>IF       3653>>IF
BUFLNSF
      2656**DCL      3040<<ASSIGN   3136<<ASSIGN   3164<<ASSIGN   3188<<ASSIGN   3213<<ASSIGN   3253<<ASSIGN
      3339<<ASSIGN   3505<<ASSIGN   3650<<ASSIGN   3655<<ASSIGN   3660<<ASSIGN   3662<<ASSIGN   3663>>ASSIGN
      3667>>ASSIGN   3668>>ASSIGN   3696<<ASSIGN
BUFSF
      2657**DCL      3039<<ASSIGN   3163<<ASSIGN   3181<<ASSIGN   3212<<ASSIGN   3252<<ASSIGN   3338<<ASSIGN
      3504<<ASSIGN   3649<<ASSIGN   3665<<ASSIGN   3695<<ASSIGN
BUF_PTR
        88**DCL      3162<<ASSIGN   3181>>ASSIGN   3182<<ASSIGN   3182>>ASSIGN   3196>>ASSIGN
BUILD_MSTR_TBL
      3031**DCL-ENT  3146--CALL
BUILD_RECXREF
      3033**DCL-ENT  3148--CALL
BUILD_SETXREF
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:133  
      3032**DCL-ENT  3147--CALL
CARRY_ATTRIBUTESF
      2692**DCL      3574<<ASSIGN
CHECKSUM
        96**DCL      3206>>IF       3227>>IF       3230<<ASSIGN   3362<<ASSIGN   3364<<ASSIGN
CHECK_PAGES
      3034**DCL-ENT  3198--CALL
CHECK_SUM
      3437**PROC     3207--CALL     3229--CALL
CHKSUM
      3030**DCL-ENT  3453--CALL
CHK_DATE
      3398**PROC     3202--CALL
CLOSE_FILES
      3712**PROC     3077--CALL     3176--CALL     3248--CALL     3627--CALL     3753--CALL     3756--CALL
      3759--CALL     3762--CALL     3770--CALL
COMPRESS_PAGE
      3261**PROC     3210--CALL
COMPRESS_SIZE
       112**DCL      3208<<ASSIGN   3210<>CALL     3213>>ASSIGN
COUNTSF
      2707**DCL      2708--REDEF
DASH IN PROCEDURE CHECK_SUM
      3439**DCL      3489<<ASSIGN   3495<<ASSIGN   3507>>CALLBLT
DATA IN PROCEDURE CHECK_SUM
      3444**DCL      3455<<ASSIGN
DATA$
      2358**DCL       101--IMP-PTR  2359--IMP-PTR  3200<<ASSIGN   3201>>ASSIGN   3275>>IF       3281>>ASSIGN
      3286>>ASSIGN   3286>>ASSIGN   3286>>ASSIGN   3302>>ASSIGN   3306>>ASSIGN   3444--IMP-PTR  3455>>ASSIGN
      3456>>IF       3458>>ASSIGN
DATAPGS IN PROCEDURE GET_ATBLK
      3328**DCL      3326--PROC     3368<<ASSIGN   3373<<ASSIGN
DATA_PG.ACT_DATA
      2371**DCL      2372--REDEF    2373--REDEF    2374--REDEF
DATA_PG.CHKSUM_WD
      2363**DCL      3456>>IF       3458<<ASSIGN
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:134  
DATESF
      2660**DCL      3418<<ASSIGN
DCBSF
      2636**DCL      3038<<ASSIGN   3049<<ASSIGN   3063<<ASSIGN   3086<<ASSIGN   3132<<ASSIGN   3169<<ASSIGN
      3184<<ASSIGN   3211<<ASSIGN   3241<<ASSIGN   3243<<ASSIGN   3251<<ASSIGN   3337<<ASSIGN   3503<<ASSIGN
      3556<<ASSIGN   3565<<ASSIGN   3566>>ASSIGN   3648<<ASSIGN   3656<<ASSIGN   3694<<ASSIGN   3713<<ASSIGN
      3714--IF       3719<<ASSIGN   3720--IF       3744<<ASSIGN   3749<<ASSIGN
DESTDCB
        86**DCL      3060<<ASSIGN   3086>>ASSIGN   3106--IF       3108--IF       3111--IF       3125--ASSIGN
      3132>>ASSIGN   3211>>ASSIGN   3566<<ASSIGN   3584--ASSIGN   3597--IF       3599--IF       3602--IF
      3656>>ASSIGN   3749>>ASSIGN
DESTSF
      2659**DCL      3416<<ASSIGN
DEST_FILE
       120**DCL      3125<<ASSIGN   3584<<ASSIGN
DEST_FILE.CNT
       121**DCL      3541>>ASSIGN   3545<<ASSIGN
DEST_FILE.TEXT
       122**DCL      3544<<CALLBLT  3576>>ASSIGN   3585>>IF       3613>>ASSIGN   3692>>CALLBLT
DUMPING_MSG
      3036**PROC     3160--CALL     3621--CALL
DUMP_ASCFID
      3521**PROC     3245--CALL
DUMP_DATE IN PROCEDURE CHK_DATE
      3401**DCL      3419--ASSIGN   3422>>IF
DUMP_INDEX_FILE IN PROCEDURE DUMP_ASCFID
      3554**ENTRY    3065--CALL
DUMP_INFO.ID IN PROCEDURE GET_ATBLK
      3332**DCL      3380<<ASSIGN
DUMP_REPRT
      3682**PROC     3234--CALL     3623--CALL
ENCRP_SEEDSF
      2665**DCL      2666--REDEF    3133<<ASSIGN   3168<<ASSIGN   3192<<ASSIGN   3216<<ASSIGN   3341<<ASSIGN
END_OF_DUMP
      3250**LABEL    3066--GOTO
ERRCODESF
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:135  
      2667**DCL      2672--REDEF
ERRCODESF.ERR#
      2670**DCL      3073<<ASSIGN   3352<<ASSIGN   3466<<ASSIGN   3590<<ASSIGN   3634<<ASSIGN   3739<<ASSIGN
      3750<<ASSIGN   3767<<ASSIGN
ERRCODE_RDEF
      2672**DCL      3074>>ASSIGN   3353>>ASSIGN   3467>>ASSIGN   3591>>ASSIGN   3635>>ASSIGN   3740>>ASSIGN
      3751>>ASSIGN   3768>>ASSIGN
ERRFLGSF
      2696**DCL      3075<<ASSIGN   3592<<ASSIGN
ERR_INSERT
      2680**DCL      3351<<ASSIGN
ERR_INSERT.CNT
      2681**DCL      3737<<ASSIGN
ERR_INSERT.TEXT
      2682**DCL      3738<<ASSIGN
EXISTSF
      2686**DCL      3096<<ASSIGN   3571<<ASSIGN   3581<<ASSIGN   3617<<ASSIGN
F$DCB.ACTPOS
       241**DCL       241--REDEF
F$DCB.ARS#
       215**DCL       215--REDEF    3654>>ASSIGN
F$DCB.ASN#
       230**DCL      3106>>IF       3597>>IF
F$DCB.ATTR
       234**DCL       235--REDEF
F$DCB.BORROW
       249**DCL       249--REDEF     249--REDEF     249--REDEF
F$DCB.DCBNAME.L
       263**DCL       263--IMP-SIZ
F$DCB.DENSITY#
       236**DCL      3108>>IF       3111>>IF       3599>>IF       3602>>IF
F$DCB.EOMCHAR#
       219**DCL       219--REDEF
F$DCB.FCD#
       228**DCL      3714>>IF       3720>>IF
F$DCB.FLDID
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:136  
       244**DCL       244--REDEF
F$DCB.FORM$
       238**DCL       238--REDEF
F$DCB.FSECT
       254**DCL       254--REDEF
F$DCB.FSN#
       231**DCL       231--REDEF     231--REDEF     232--REDEF
F$DCB.HEADER$
       237**DCL       237--REDEF
F$DCB.IXTNSIZE#
       235**DCL       235--REDEF
F$DCB.LASTSTA$
       224**DCL       224--REDEF
F$DCB.LVL
       250**DCL       250--REDEF
F$DCB.NAME#
       225**DCL      3059>>ASSIGN   3125>>ASSIGN   3584>>ASSIGN
F$DCB.NAME#.C
       225**DCL       225--REDEF
F$DCB.NOEOF
       247**DCL       247--REDEF
F$DCB.NRECS#
       236**DCL       236--REDEF
F$DCB.NRECX
       255**DCL       255--REDEF
F$DCB.OHDR
       247**DCL       247--REDEF
F$DCB.ORG#
       230**DCL       230--REDEF    3061>>IF       3069>>IF
F$DCB.PRECNO
       253**DCL       253--REDEF
F$DCB.RCSZ
       259**DCL       259--REDEF
F$DCB.RES#
       226**DCL       226--REDEF
F$DCB.SETX
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:137  
       238**DCL       238--REDEF
F$DCB.TAB$
       238**DCL       238--REDEF
F$DCB.TDA
       252**DCL       253--REDEF
F$DCB.WSN#
       226**DCL       226--REDEF
FID$ IN PROCEDURE DUMP_REPRT
      3683**DCL      3684--IMP-PTR  3692>>CALLBLT
FIDSF
      2684**DCL      3055<<ASSIGN   3095<<ASSIGN   3561<<ASSIGN   3576<<ASSIGN   3580<<ASSIGN   3613<<ASSIGN
FIDSF_RD
      2683**DCL      2684--REDEF
FID_NM IN PROCEDURE DUMP_REPRT
      3684**DCL      3692>>CALLBLT
FILE_TYPE IN PROCEDURE DUMP_ASCFID
      3523**DCL      3521--PROC     3554--ENTRY    3577>>IF       3620>>IF       3623<>CALL
FIRST_CHK
        90**DCL      3141<<ASSIGN   3412>>IF       3414<<ASSIGN
FULLSF
      2654**DCL      3165<<ASSIGN   3189<<ASSIGN   3340<<ASSIGN
FUNSF
      2647**DCL      3053<<ASSIGN   3092<<ASSIGN   3560<<ASSIGN   3570<<ASSIGN   3616<<ASSIGN
GET_ATBLK
      3326**PROC     3080--CALL
GET_FILESIZE
      3026**DCL-ENT  3618--CALL
HELPCODE
      2701**DCL      2706--REDEF
HIGH_DATA_PG
       108**DCL      3080<>CALL     3206>>IF       3209>>IF
HIGH_PAGE
       107**DCL      3080<>CALL     3117>>ASSIGN   3161<>CALL     3183<>CALL
HIGH_PGE IN PROCEDURE CHECK_SUM
      3440**DCL      3490<<ASSIGN   3497<<CALLBLT  3498<>CALL     3507>>CALLBLT
HI_PGE IN PROCEDURE GET_ATBLK
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:138  
      3329**DCL      3326--PROC     3367<<ASSIGN   3368>>ASSIGN   3374<<ASSIGN
I
      2739**DCL      3533<<ASSIGN   3534<<ASSIGN   3534>>ASSIGN   3535>>IF       3535<<ASSIGN   3536>>CALLBLT
      3537>>ASSIGN   3541<<ASSIGN   3542<<ASSIGN   3542>>ASSIGN   3543>>IF       3543<<ASSIGN   3544>>CALLBLT
      3545>>ASSIGN
ICHKSUM
      2766**DCL      2767--REDEF    3451<<ASSIGN   3455>>ASSIGN   3456>>IF       3458>>ASSIGN
IDS_FILE IN PROCEDURE DUMP_REPRT
      3687**DCL      3682--PROC     3692>>CALLBLT  3701>>IF
INV IN PROCEDURE GET_ATBLK
      3327**DCL      3326--PROC     3369<<ASSIGN   3372<<ASSIGN   3373>>ASSIGN
INVPG$
      2377**DCL      2378--IMP-PTR
I_O_BUF
      2745**DCL      3163--ASSIGN   3181--ASSIGN   3200--ASSIGN   3212--ASSIGN   3338--ASSIGN   3345--ASSIGN
      3649--ASSIGN   3665--ASSIGN
I_O_BUF$
      2744**DCL      2745--IMP-PTR  3163>>ASSIGN   3181>>ASSIGN   3200>>ASSIGN   3212>>ASSIGN   3338>>ASSIGN
      3345>>ASSIGN   3649>>ASSIGN   3665>>ASSIGN
I_O_INDX
        87**DCL      3196<<ASSIGN   3200>>ASSIGN   3212>>ASSIGN   3221<<ASSIGN   3221>>ASSIGN   3647<<ASSIGN
      3657<<ASSIGN   3665>>ASSIGN   3668<<ASSIGN   3668>>ASSIGN
I_O_SIZE
      2747**DCL      3161<>CALL     3164>>ASSIGN   3183<>CALL     3188>>ASSIGN
I_O_TAB.I_O_HW.VAL
       104**DCL      3275>>IF       3281>>ASSIGN   3286>>ASSIGN   3286>>ASSIGN   3286>>ASSIGN   3306--ASSIGN
KEYSF
      2638**DCL      3166<<ASSIGN   3190<<ASSIGN   3342<<ASSIGN
KEYVSF
      2639**DCL      2644--REDEF
KEYVSF.IDSKEY
      2642**DCL      3137<<ASSIGN   3167<<ASSIGN   3191<<ASSIGN   3217<<ASSIGN   3343<<ASSIGN
KEYVSF.LEN
      2640**DCL      3131<<ASSIGN
KEYVSF.WD_ONE
      2641**DCL      2642--REDEF
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:139  
KEY_FILE_ASSOCIATED
       100**DCL      3239>>IF       3358<<ASSIGN   3360<<ASSIGN
LAST_PAGE
        92**DCL      3140<<ASSIGN   3161<>CALL     3173>>DOWHILE  3183<>CALL     3186>>IF
LEFT_JUSTIFY
        94**DCL      3498<>CALL
LOW_DBK
       111**DCL      3387<<ASSIGN
LOW_PGE IN PROCEDURE CHECK_SUM
      3441**DCL      3491<<CALLBLT  3492<>CALL     3507>>CALLBLT
LPP
       110**DCL      3388<<ASSIGN
M$LO
      2754**DCL      3038>>ASSIGN   3251>>ASSIGN   3503>>ASSIGN   3694>>ASSIGN
MSGCODE
      2673**DCL      2674--REDEF    3074<<ASSIGN   3353<<ASSIGN   3467<<ASSIGN   3591<<ASSIGN   3635<<ASSIGN
      3740<<ASSIGN   3751<<ASSIGN   3768<<ASSIGN
MSG_FLG
        95**DCL      3227>>IF       3231<<ASSIGN   3459>>IF       3461<<ASSIGN
MSTR$
      2945**DCL      2948--IMP-PTR
MSTR_REF.NXTHSH
      2951**DCL      2952--REDEF
MSTR_REF.PAENT
      2957**DCL      2958--REDEF
MSTR_REF.PAOFF
      2954**DCL      2955--REDEF
N IN PROCEDURE COMPRESS_PAGE
      3263**DCL      3264--IMP-SIZ  3281<<ASSIGN   3310>>ASSIGN   3316>>ASSIGN   3316>>ASSIGN   3319>>ASSIGN
N IN PROCEDURE DUMP_REPRT
      3685**DCL      3684--IMP-SIZ  3691<<CALLBLT  3692>>CALLBLT
NBUFS
        89**DCL      3161<>CALL     3162>>ASSIGN   3182>>ASSIGN   3183<>CALL     3647>>ASSIGN   3650>>ASSIGN
      3655>>ASSIGN
NUM_INV_PGS
       109**DCL      3080<>CALL
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:140  
OFF_ARRAY IN PROCEDURE COMPRESS_PAGE
      3264**DCL      3316<<ASSIGN   3316>>ASSIGN
OFF_ARRAY$ IN PROCEDURE COMPRESS_PAGE
      3267**DCL      3310<<ASSIGN   3316>>ASSIGN
ORGSF
      2637**DCL      3050<<ASSIGN   3087<<ASSIGN   3569<<ASSIGN   3611<<ASSIGN
PAGE IN PROCEDURE CHECK_SUM
      3438**DCL      3488<<ASSIGN   3496<<ASSIGN   3507>>CALLBLT
PAGES IN PROCEDURE DUMP_REPRT
      3686**DCL      3699<<CALLBLT  3700<>CALL     3702>>CALLBLT  3704>>CALLBLT
PAGE_DATE IN PROCEDURE CHK_DATE
      3399**DCL      3398--PROC     3422>>IF
PAGE_RANGE
      3028**DCL-ENT  3161--CALL     3183--CALL
PASS_DATE IN PROCEDURE CHK_DATE
      3400**DCL      3398--PROC     3409<<ASSIGN   3423<<ASSIGN   3425<<ASSIGN
PGE_DATE
       105**DCL      3202<>CALL
PGE_DATE$
       106**DCL      3201<<ASSIGN   3202>>CALL
PGE_SIZE IN PROCEDURE COMPRESS_PAGE
      3262**DCL      3261--PROC     3277<<ASSIGN   3286<<ASSIGN   3292<<ASSIGN   3292>>ASSIGN   3296<<ASSIGN
      3296>>ASSIGN   3302>>ASSIGN   3319<<ASSIGN   3319>>ASSIGN
POSSF
      2695**DCL      3722<<ASSIGN
PRINT_CHKS
        97**DCL      3228<<ASSIGN   3232<<ASSIGN   3446>>IF       3486>>IF       3501>>IF
PROCESS_KEY_DUMP
      3644**PROC     3622--CALL
RB
      2726**DCL      3179<<ASSIGN   3199<<DOINDEX  3199>>DOINDEX  3206>>IF       3209>>IF       3217>>ASSIGN
      3482>>ASSIGN   3483>>ASSIGN   3486>>IF       3501>>IF       3509>>ASSIGN   3510>>ASSIGN   3513>>ASSIGN
RB_SAVE
       114**DCL      3161<>CALL     3167>>ASSIGN   3179>>ASSIGN   3183<>CALL     3191>>ASSIGN
RE
      2727**DCL      3180<<ASSIGN   3199>>DOINDEX
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:141  
REASGNSF
      2691**DCL      3557<<ASSIGN   3568<<ASSIGN   3579<<ASSIGN   3614<<ASSIGN
REC$
      2725**DCL      2748--IMP-PTR
REC$ IN PROCEDURE COMPRESS_PAGE
      3265**DCL      3302<<ASSIGN   3316>>ASSIGN
REC_DATA_LN
      2753**DCL      2752--IMP-SIZ
REC_XREF$
      3000**DCL      3001--IMP-PTR
RELGSF
      2699**DCL      3723<<ASSIGN
REPRT
       123**DCL      3037<<ASSIGN   3039--ASSIGN   3250<<ASSIGN   3252--ASSIGN   3692<<CALLBLT  3695--ASSIGN
      3702<<CALLBLT  3704<<CALLBLT
REPRT_CHK IN PROCEDURE CHECK_SUM
      3442**DCL      3504--ASSIGN   3507<<CALLBLT
RE_SAVE
       115**DCL      3161<>CALL     3180>>ASSIGN   3183<>CALL
RIGHT_JUSTIFY
        93**DCL      3492<>CALL
SET_XREF$
      2989**DCL      2990--IMP-PTR
SHARESF
      2687**DCL      3056<<ASSIGN   3097<<ASSIGN   3562<<ASSIGN
SOURCESF
      2658**DCL      3415<<ASSIGN
SRCE_FILE
       117**DCL      3059<<ASSIGN
SRCE_FILE.CNT
       118**DCL      3533>>ASSIGN   3537<<ASSIGN
SRCE_FILE.TEXT
       119**DCL      3536<<CALLBLT  3561>>ASSIGN   3683--DCLINIT  3691>>CALLBLT
SYS_FUNC_CHECK
      3025**DCL-ENT  3185--CALL
SYS_FUNC_CLOS
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:142  
      3023**DCL-ENT  3064--CALL     3242--CALL     3244--CALL     3715--CALL     3724--CALL     3745--CALL
SYS_FUNC_ERRMSG
      3016**DCL-ENT  3076--CALL     3354--CALL     3468--CALL     3593--CALL     3636--CALL     3741--CALL
      3752--CALL     3769--CALL
SYS_FUNC_OPEN
      3018**DCL-ENT  3057--CALL     3098--CALL     3119--CALL     3564--CALL     3583--CALL     3619--CALL
SYS_FUNC_READ
      3019**DCL-ENT  3171--CALL     3194--CALL     3344--CALL     3652--CALL
SYS_FUNC_RELDCB
      3021**DCL-ENT  3716--CALL     3726--CALL
SYS_FUNC_RELEASE
      3027**DCL-ENT  3105--CALL     3596--CALL
SYS_FUNC_TSTAMP
      3022**DCL-ENT  3420--CALL
SYS_FUNC_WRIT
      3020**DCL-ENT  3042--CALL     3138--CALL     3218--CALL     3255--CALL     3508--CALL     3666--CALL
      3698--CALL     3706--CALL
TAPE_BLOCK
       116**DCL      3109<<ASSIGN   3112<<ASSIGN   3114<<ASSIGN   3115>>ASSIGN   3600<<ASSIGN   3603<<ASSIGN
      3605<<ASSIGN   3606>>ASSIGN   3609<<ASSIGN   3659>>IF       3660>>ASSIGN
TEMP$ IN PROCEDURE COMPRESS_PAGE
      3266**DCL      3306<<ASSIGN   3310>>ASSIGN
TESTSF
      2649**DCL      3051<<ASSIGN   3088<<ASSIGN   3558<<ASSIGN   3575<<ASSIGN   3615<<ASSIGN
TIMESF
      2661**DCL      3417<<ASSIGN
TOTL_PGS_DUMP
       113**DCL      3139<<ASSIGN   3219<<ASSIGN   3219>>ASSIGN   3610<<ASSIGN   3667<<ASSIGN   3667>>ASSIGN
      3699>>CALLBLT
TSTAMPSF
      2664**DCL      3419<<ASSIGN
VFCSF
      2653**DCL      3041<<ASSIGN   3135<<ASSIGN   3215<<ASSIGN   3254<<ASSIGN   3506<<ASSIGN   3664<<ASSIGN
      3697<<ASSIGN   3705<<ASSIGN
WAITSF
      2652**DCL      3134<<ASSIGN   3170<<ASSIGN   3193<<ASSIGN   3214<<ASSIGN   3651<<ASSIGN
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:143  
X
      2742**DCL      3150<<ASSIGN   3151>>DOWHILE  3152<<ASSIGN   3152>>ASSIGN   3154>>ASSIGN   3654<<ASSIGN
      3658>>DOWHILE  3659>>IF       3662>>ASSIGN   3663<<ASSIGN   3663>>ASSIGN
XREF_BUILT
      3009**DCL      3144>>IF
XTENSIZESF
      2650**DCL      3089<<ASSIGN   3117<<ASSIGN   3573<<ASSIGN
ZERO_SUP
      3029**DCL-ENT  3492--CALL     3498--CALL     3700--CALL
ZI$DIR.ACNT
      2134**DCL      3094>>ASSIGN   3118>>ASSIGN
ZI$DIR.ALTKEY
      2182**DCL      2183--REDEF    2184--REDEF
ZI$DIR.AREAFID
      2148**DCL      2149--REDEF
ZI$DIR.AREA_NM.NAME.TEXT
      2214**DCL      3151>>DOWHILE
ZI$DIR.CHECK
      2157**DCL      3142>>IF       3197>>IF
ZI$DIR.DATE
      2187**DCL      2191--REDEF    3418--ASSIGN
ZI$DIR.DATEFLG
      2151**DCL      3381>>IF       3407>>IF
ZI$DIR.DEST_NM.DCB#
      2225**DCL      3060>>ASSIGN   3243>>ASSIGN   3565>>ASSIGN   3717>>IF       3719>>ASSIGN
ZI$DIR.DEST_NM.NAME.TEXT
      2224**DCL      3095>>ASSIGN   3580>>ASSIGN
ZI$DIR.DEST_SEED
      2143**DCL      2144--REDEF    2145--REDEF    3133>>ASSIGN   3216>>ASSIGN
ZI$DIR.ENCP_SEED
      2140**DCL      2141--REDEF    2142--REDEF    3168>>ASSIGN   3192>>ASSIGN   3341>>ASSIGN
ZI$DIR.NOKEYS
      2153**DCL      3239>>IF       3386<<ASSIGN
ZI$DIR.OPEN_MODE
      2152**DCL      3096>>ASSIGN   3581>>ASSIGN
ZI$DIR.POS
PL6.E3A0      #001=ZIU$DUMP File=ZIU$DUMP.:ZIC0TSI                               FRI 09/05/97 13:14 Page:144  
      2199**DCL      3722>>ASSIGN
ZI$DIR.REPRT_ZERO
      2174**DCL      2175--REDEF
ZI$DIR.RNG_LIST
      2117**DCL      3381>>IF
ZI$DIR.SCHFID
      2146**DCL      2147--REDEF
ZI$DIR.SRCE_NM.DCB#
      2220**DCL      3048>>ASSIGN   3169>>ASSIGN   3184>>ASSIGN   3241>>ASSIGN   3556>>ASSIGN   3648>>ASSIGN
      3713>>ASSIGN   3717>>IF
ZI$DIR.SRCE_NM.NAME
      2217**DCL      3351>>ASSIGN
ZI$DIR.SRCE_NM.NAME.CNT
      2218**DCL      3737>>ASSIGN
ZI$DIR.SRCE_NM.NAME.TEXT
      2219**DCL      3055>>ASSIGN   3346>>IF       3738>>ASSIGN
ZI$DIR.TIME
      2192**DCL      2197--REDEF    3417--ASSIGN
