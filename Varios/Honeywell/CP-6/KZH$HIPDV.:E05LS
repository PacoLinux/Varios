VERSION E05

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:1    
        1        1        /*M* KZH$HIPDV - Device manager for HIP devices */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* */
        8        8        /**/
        9        9        KZH$HIPDV: PROC(PARM1,PARM2) ALTRET;
       10       10        /**/
       11       11        /**/
       12       12        /* Include Files */
       13       13        /**/
       14       14        %INCLUDE CP_6_SUBS;
       15      554        %INCLUDE LCP_6;
       16     4833        %INCLUDE KH$CHN;
       17     4955        %INCLUDE KZ$LINCTX;
       18     5575        %INCLUDE KZ$HIPCTR;
       19     5661        %INCLUDE KZ$HIPDEV;
       20     5928        %INCLUDE KZ$INPBFR;
       21     5988        %INCLUDE KZ$OTPBFR;
       22     6089        %INCLUDE KZ$PROWRT;
       23     6214        %INCLUDE KH$STT;
       24     6244        %INCLUDE KZ_HIP_C;
       25     6351        %INCLUDE KZ_CLM_E;
       26     6523        %INCLUDE KZ_LIN_C;
       27     6579        %INCLUDE KV$USR;
       28     6891        %INCLUDE KV_GLB_M;
       29     7013        %INCLUDE KV$GLB;
       30     7432        %INCLUDE KV$GLBCTX;
       31     7877        %INCLUDE KZ_3270_C;
       32     8035        %INCLUDE KV$VDH;
       33     8466        %INCLUDE KV_GLBCNS_E;
       34     8807        %INCLUDE KV_PRMID_E;
       35     8981        %INCLUDE KZ_PERR_C;
       36     9063        %INCLUDE KZ_HIPTAB_C;
       37     9305        %INCLUDE KZ$3270STT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:2    
       38     9369        %INCLUDE KHC_MAC_C;
       39     9410        %INCLUDE KL_AFCN_C;
       40     9511        %INCLUDE K_ID_E;
       41     9561        %INCLUDE KZ$BSCSTT;
       42     9667        %INCLUDE KL_MACRO_C;
       43    13019        %INCLUDE KL_SUPER_C;
       44    15921
       45    15922
       46    15923        /**/
       47    15924        /* Parameters */
       48    15925        /**/
       49    15926    1   DCL FAKE UBIN;
       50    15927    1   DCL PARM1 CHAR(FAKE);
       51    15928            %KZ$EVENT(STCLASS=REDEF PARM1);
       52    16010            %KZ$HIPDEV(NAME=DEVCTX,STCLASS=REDEF PARM1);
       53    16191            %KZ$LINCTX(NAME=LINCTX,STCLASS=REDEF PARM1);
       54    16622
       55    16623    1   DCL PARM2 CHAR(FAKE);
       56    16624    1   DCL LINRSP REDEF PARM2 UBIN;
       57    16625    1   DCL LINSTAT REDEF PARM2 BIT(16) ALIGNED;
       58    16626    1   DCL OTPBFR$ REDEF PARM2 PTR;
       59    16627    1   DCL PSTAT REDEF PARM2 BIT(16) ALIGNED;
       60    16628    1   DCL PSTATU REDEF PARM2 UBIN;
       61    16629
       62    16630                                                /* EQUS                               */
       63    16631        %KV_PRMID_E;
       64    16787        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:3    
       65    16788        /**/
       66    16789        /* Auto */
       67    16790        /**/
       68    16791    1   DCL KZ_VDHSTT$ PTR SYMREF;
       69    16792    1   DCL LIN$ PTR;
       70    16793    1   DCL CTR$ PTR;
       71    16794    1   DCL DEV$ PTR;
       72    16795    1   DCL PTR$ PTR;
       73    16796    1   DCL T$ PTR;
       74    16797    1   DCL P1$ PTR;
       75    16798    1   DCL SZ UBIN;
       76    16799    1   DCL CNT UBIN;
       77    16800    1   DCL I REDEF CNT UBIN;
       78    16801    1   DCL J UBIN;
       79    16802    1   DCL ISBIN SBIN;
       80    16803    1   DCL K UBIN(5);
       81    16804    1   DCL LOGON_STRING_LENGTH SBIN;
       82    16805    1   DCL FC1FC2 CHAR(2);
       83    16806    1   DCL FC_CHARS(0:1) REDEF FC1FC2 CHAR(1);
       84    16807    1   DCL L UBIN;
       85    16808    1   DCL BFR$ PTR;
       86    16809    1   DCL TBFR$ PTR;
       87    16810    1   DCL STATUS BIT(16);
       88    16811    1   DCL STATUSW REDEF STATUS UBIN;
       89    16812    1   DCL 1 STATUSB REDEF STATUS,
       90    16813    1         2 I UBIN BYTE UNAL,
       91    16814    1         2 J UBIN BYTE UNAL;
       92    16815    1   DCL TCTR$ PTR;
       93    16816    1   DCL TDEV$ PTR;
       94    16817    1   DCL DFRD BIT(1);
       95    16818    1   DCL VDH_FLG UBIN;
       96    16819        %EQU ESC_CHAR=BITASC('1B'X);
       97    16820    1   DCL 1 HALT_MESSAGE STATIC,
       98    16821    1         2 HALT_MSG,
       99    16822    1           3 *  CHAR(0) INIT('(XMIT TO GO)'),
      100    16823    1           3 *(0:4) CHAR(1) INIT( %ESC_CHAR ,'T',' ', %ESC_CHAR ,'U'),
      101    16824    1         2 HLTMSG REDEF HALT_MSG CHAR(17);
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:4    
      102    16825        %KV$USR_EVT (STCLASS=);
      103    16860        %KV$VDH_CNC (STCLASS=);
      104    16952        %KV$VDH_DAT (STCLASS=);
      105    17032        %KV$VDH_DSC (STCLASS=);
      106    17068        %KV$VDH_EVT (STCLASS=);
      107    17103        %KV$VDH_INT (STCLASS=);
      108    17140        %KV$VDH_OTPMRK (STCLASS=);
      109    17202        %KV@USRENT;
      110    17222        %KV_INPOPRX_E;
      111    17234        %KV_VDH_EVT_ID_E;
      112    17240        %KV_CMPCOD_E;
      113    17254        %KV_PHSPSTMOD_E;
      114    17261        %KV_INPUNT_E;
      115    17266        %K#ENTID_E;
      116    17285        %KV$USRPRM;
      117    17336        %KV_DSCRSN_E;
      118    17345        %KV_USR_EVT_ID_E;
      119    17365        %INHIBIT_DCLS;
      120    17377        %KZ$EVENT(FPTN=KZ$CLMEVENT, STCLASS="  ");
      121    17459        %KZ$EVENT(FPTN=KZ_CLMEVENT, STCLASS=CONSTANT);
      122    17541        %KZ$3270STT(STCLASS="BASED(KZ_HIP_HDR.STTBFR$)", NAME=KZ@HIPSTT);
      123    17973        %KV#VD_ORG_E;
      124    17981        %KV_SCHRSN_E;
      125    17988        %KV$STT(STCLASS="BASED(KZ_VDHSTT$)");
      126    18382        %KV_STRTYP_E;
      127    18420
      128    18421        %KL_CONTROLLER;
      129    18570        %KL_LINEDEV;
      130    18719
      131    18720        /**/
      132    18721        /* Constant */
      133    18722        /**/
      134    18723    1   DCL POLADR_B(0:31) BIT(8) CONSTANT INIT(
      135    18724    1       '20'X,'21'X,'22'X,'23'X,'24'X,'25'X,'26'X,'27'X,
      136    18725    1       '28'X,'29'X,'2A'X,'2B'X,'2C'X,'2D'X,'2E'X,'2F'X,
      137    18726    1       '30'X,'31'X,'32'X,'33'X,'34'X,'35'X,'36'X,'37'X,
      138    18727    1       '38'X,'39'X,'3A'X,'3B'X,'3C'X,'3D'X,'3E'X,'3F'X);
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:5    
      139    18728    1   DCL POLADR(0:31) REDEF POLADR_B UBIN BYTE UNAL;
      140    18729        /**/
      141    18730    1   DCL SELADR_B(0:31) BIT(8) CONSTANT INIT(
      142    18731    1       '20'X,'21'X,'22'X,'23'X,'24'X,'25'X,'26'X,'27'X,
      143    18732    1       '28'X,'29'X,'2A'X,'2B'X,'2C'X,'2D'X,'2E'X,'2F'X,
      144    18733    1       '30'X,'31'X,'32'X,'33'X,'34'X,'35'X,'36'X,'37'X,
      145    18734    1       '38'X,'39'X,'3A'X,'3B'X,'3C'X,'3D'X,'3E'X,'3F'X);
      146    18735    1   DCL SELADR(0:31) REDEF SELADR_B UBIN BYTE UNAL;
      147    18736        %KZ$HIPCTR (NAME=KZ_HIPCTR,STCLASS=CONSTANT);
      148    18773        %KZ$HIPDEV (NAME=KZ_HIPDEV,STCLASS=CONSTANT);
      149    18954        %KZ$INPBFR (NAME=KZ_INPBFR,STCLASS=CONSTANT);
      150    18987
      151    18988    1   DCL 1 PRO_ATTR CONSTANT,
      152    18989    1         2 TYP UBIN BYTE UNAL INIT(%KV_PRMID_TRMATTR),
      153    18990    1         2 LNG UBIN BYTE UNAL INIT(SIZEC(VLP_TRMATTR));
      154    18991        %VLP_TRMATTR (STCLASS=CONSTANT,CURSORUP=YES,FCNTBL='CP5');
      155    19029    1   DCL 1 PRO_CTL CONSTANT,
      156    19030    1         2 TYP UBIN BYTE UNAL INIT(%KV_PRMID_TRMCTL),
      157    19031    1         2 LNG UBIN BYTE UNAL INIT(SIZEC(VLP_TRMCTL));
      158    19032        %VLP_TRMCTL (STCLASS=CONSTANT,RETYPOVR=YES,EDITOVR=YES,UPPERCASE=NO);
      159    19072        %KV$USRPRM_INT;
      160    19086        %KV$STREVTENB(STRTYP=KV_STRTYP_MRD);
      161    19091        %KV$STREVTENB(STRTYP=KV_STRTYP_VDI);
      162    19096        %KV$USRPRM(NAME=KZ_USRPRM, STCLASS=CONSTANT,
      163    19097                   USRSBR=KZH$HIP, TRNTBLHEDPTR$=KZ_TRNTBLHED$,
      164    19098                   INPFNCTBLHEDPTR$=KZ_INPFNCTBLHED$  );
      165    19149        %KV$ERD (NAME=KV_ERD,STCLASS=CONSTANT);
      166    19233
      167    19234    1   DCL KZ_TRNTBLHED$ PTR INIT(ADDR(KZ_ASC95)) CONSTANT;
      168    19235    1   DCL KZ_INPFNCTBLHED$ PTR SYMREF;
      169    19236    1   DCL KZ_ASC95 UBIN SYMREF;
      170    19237    1   DCL KZH_USRPRM$ PTR SYMREF;
      171    19238        /**/
      172    19239        %MACRO STAT(VAL='0'B,LOG(YES='1'B,NO='0'B)='0'B,CLR(YES='1'B,NO='0'B)='0'B,
      173    19240                    DWN(YES='1'B,NO='0'B)='0'B,ACT=0,LAST=",",
      174    19241                    NOINIT(YES=1,NO=0)=0);
      175    19242        %IF NOINIT=1;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:6    
      176    19243        %LSET INIT=CHARTEXT('/*');
      177    19244                2 X ALIGNED,
      178    19245                  %ELSE;
      179    19246        %LSET INIT=CHARTEXT('INIT');
      180    19247                  2 *,
      181    19248        %ENDIF;
      182    19249                  3 VAL# BIT(16) %INIT(VAL)%CHARTEXT('/**/'),
      183    19250                  3 LOG# BIT(1) %INIT(LOG)%CHARTEXT('/**/'),
      184    19251                  3 CLR# BIT(1) %INIT(CLR)%CHARTEXT('/**/'),
      185    19252                  3 DWN# BIT(1) %INIT(DWN)%CHARTEXT('/**/'),
      186    19253                  3 * BIT(5) %INIT('0'B)%CHARTEXT('/**/'),
      187    19254                  3 ACT# UBIN BYTE UNAL %INIT(ACT)%CHARTEXT('/**/') LAST
      188    19255        %SET Y#STATSIZ=Y#STATSIZ+1;
      189    19256        %MEND;
      190    19257        /**/
      191    19258        %SET Y#STATSIZ=0;
      192    19259        /**/
      193    19260        %EQU KZ#STAT_DE=1;                      /* Device-end                         */
      194    19261        %EQU KZ#STAT_DSC=2;                     /* Disconnect                         */
      195    19262        %EQU KZ#STAT_RETRY=3;                   /* Retry                              */
      196    19263        %EQU KZ#STAT_CONT=4;                    /* Continue                           */
      197    19264        %EQU KZ#STAT_PAPER=5;                   /* Out of paper                       */
      198    19265    1   DCL 1 STAT_ CONSTANT,
      199    19266        %STAT(VAL='0000'X,ACT=%KZ#STAT_DSC,LOG=YES,DWN=YES);
      200    19282        %STAT(VAL='0200'X,ACT=%KZ#STAT_DE);
      201    19298        %STAT(VAL='0010'X,ACT=%KZ#STAT_DSC,DWN=YES);
      202    19314        %STAT(VAL='0210'X,ACT=%KZ#STAT_PAPER);
      203    19330        %STAT(VAL='0002'X,ACT=%KZ#STAT_DSC,DWN=YES,LOG=YES);
      204    19346        %STAT(VAL='0004'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
      205    19362        %STAT(VAL='0008'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
      206    19378        %STAT(VAL='000C'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
      207    19394        %STAT(VAL='040C'X,ACT=%KZ#STAT_CONT,LOG=YES);
      208    19410        %STAT(VAL='0618'X,ACT=%KZ#STAT_DSC,LOG=YES,DWN=YES);
      209    19426        %STAT(VAL='0418'X,ACT=%KZ#STAT_DSC,LOG=YES,DWN=YES);
      210    19442        %STAT(VAL='0604'X,ACT=%KZ#STAT_CONT,LOG=YES);
      211    19458        %STAT(VAL='0404'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
      212    19474        %STAT(VAL='0204'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:7    
      213    19490        %STAT(VAL='0001'X,ACT=%KZ#STAT_RETRY,LOG=YES);
      214    19506        %STAT(VAL='0020'X,ACT=%KZ#STAT_CONT,LOG=YES);
      215    19522        %STAT(VAL='0100'X,ACT=%KZ#STAT_CONT,LOG=YES);
      216    19538        %STAT(VAL='0C00'X,ACT=%KZ#STAT_CONT,LOG=YES);
      217    19554        %STAT(VAL='0E00'X,ACT=%KZ#STAT_CONT,LOG=YES);
      218    19570        %STAT(VAL='0208'X,ACT=%KZ#STAT_CONT,LOG=YES);
      219    19586        %STAT(VAL='0218'X,ACT=%KZ#STAT_DSC,LOG=YES,DWN=YES,LAST=";");
      220    19602    1   DCL 1 STAT(0:%(Y#STATSIZ-1)) REDEF STAT_,
      221    19603        %STAT(LAST=";",NOINIT=YES);
      222    19619
      223    19620
      224    19621        /**/
      225    19622        /* Based Structures */
      226    19623        /**/
      227    19624        %KH$CHN;
      228    19748        %KZ$LINCTX (STCLASS="BASED(LIN$)");
      229    20179        %KZ$HIPCTR (STCLASS="BASED(CTR$)");
      230    20216        %KZ$POLLHIP;                            /*  FOUND IN KZ$HIPCTR INCLUDE FILE   */
      231    20226        %KZ$INPDESC;                            /*  FOUND IN KZ$HIPCTR INCLUDE FILE   */
      232    20231        %KZ$HIPDEV (STCLASS="BASED(DEV$)");
      233    20412        %KZ$INPBFR (STCLASS="BASED(BFR$)");
      234    20445        %KZ$OTPBFR (STCLASS="BASED(BFR$)");
      235    20510        %KZ$CTRLR (STCLASS="BASED(PTR$)");
      236    20534        %KZ$3270DV (STCLASS="BASED(TBFR$)");
      237    20558        %SET GV@INPFNCTBL_NUL=0;
      238    20559        %KV$MRD;
      239    20606        %KV$MVD;
      240    20650        %KV$VDI;
      241    20721        %KV$PTR (STCLASS="BASED(KV$PTR$)");
      242    20764        %KV$OTPMRK (STCLASS=BASED);
      243    20791        %B$TERMINAL_ID(STCLASS=BASED);
      244    20820    1   DCL P$(0:31) PTR BASED ALIGNED;
      245    20821    1   DCL UBYT(0:31) UBIN BYTE CALIGNED BASED;
      246    20822    1   DCL BITS(0:1023) BIT(8) BASED CALIGNED;
      247    20823    1   DCL BIT16(0:1023) BIT(16) BASED ALIGNED;
      248    20824        %KZ$INPDESC(NAME=KZ@INPDESC,STCLASS=AUTO);
      249    20829    1   DCL BCHARS CHAR(32) BASED;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:8    
      250    20830    1   DCL 1 LOGON_STRING BASED,
      251    20831    1         2 * CHAR(LOGON_STRING_LENGTH);
      252    20832    1   DCL 1 WRDS3 BASED ALIGNED,
      253    20833    1         2 *(0:2) UBIN;
      254    20834    1   DCL 1 BVECTOR BASED ALIGNED,
      255    20835    1         2 BOUND UBIN,
      256    20836    1         2 ADR$ PTR;
      257    20837
      258    20838
      259    20839        /**/
      260    20840        /* External Data */
      261    20841        /**/
      262    20842            %KZ_HIP_HDR(STCLASS=SYMREF);
      263    20866            %KV$VDH_EVT(NAME=KV_VDH_EVT_RQSOTP,STCLASS=SYMREF);
      264    20901    1   DCL KH_INHLVL UBIN SYMREF;
      265    20902    1   DCL KZH_THRTL_INIT UBIN SYMREF;
      266    20903    1   DCL KZH_THRTL_UNBLK UBIN SYMREF;
      267    20904    1   DCL KZH_USRPRM UBIN SYMREF;
      268    20905    1   DCL KH_PROFILE_ VECTOR SYMREF;
      269    20906
      270    20907        %EQU Y#ID=0;
      271    20908        %KV$USR_EVT (NAME=KV_USR_EVT,STCLASS=SYMREF);
      272    20943        %KV$VDH_CNC (NAME=KV_VDH_CNC,STCLASS=SYMREF);
      273    21035        %KV$VDH_DAT (NAME=KV_VDH_DAT,STCLASS=SYMREF);
      274    21115        %KV$VDH_DSC (NAME=KV_VDH_DSC,STCLASS=SYMREF);
      275    21151        %KV$VDH_EVT (NAME=KV_VDH_EVT,STCLASS=SYMREF);
      276    21186        %KV$VDH_INT (NAME=KV_VDH_INT,STCLASS=SYMREF);
      277    21223        %KV$VDH_OTPMRK (NAME=KV_VDH_OTPMRK,STCLASS=SYMREF);
      278    21285    1   DCL KZ_HIP_BFRSIZ(0:7) UBIN SYMREF;
      279    21286
      280    21287
      281    21288        /**/
      282    21289        /* External Routines */
      283    21290        /**/
      284    21291    1   DCL KZT_CNCDSC@ EPTR SYMREF;
      285    21292    1   DCL KZH$HIP ENTRY(1) ALTRET;
      286    21293    1   DCL KHA$ERRLOG ENTRY(2) ALTRET;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:9    
      287    21294    1   DCL KZH$CMPOTP ENTRY(1) ALTRET;
      288    21295    1   DCL KVV$INT ENTRY(1) ALTRET;
      289    21296    1   DCL KVB$GETSYS ENTRY(2) ALTRET;
      290    21297    1   DCL KVB$RLSSYS ENTRY(2) ALTRET;
      291    21298    1   DCL KVV$VDI ENTRY(1) ALTRET;
      292    21299
      293    21300
      294    21301        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:10   
      295    21302
      296    21303
      297    21304    1           DEV$=ADDR(NIL);
      298    21305    1           CTR$=ADDR(NIL);
      299    21306    1           LIN$=KZ$EVENT.LINCTX$;
      300    21307    1           VDH_FLG=0;
      301    21308        /**/
      302    21309    2           DO CASE(KZ$EVENT.EVENT);
      303    21310        /**/
      304    21311        /* Get output */
      305    21312        /**/
      306    21313    2            CASE(%KZ#LINFCN_GETOTP);
      307    21314        /**/
      308    21315    3   SEARCHING: DO WHILE('1'B); /* Until output is found, or no devices are left   */
      309    21316    3                 KZ$LINCTX.OTPBFR$=ADDR(NIL);
      310    21317    3                 KZ$LINCTX.OTPCTR$=ADDR(NIL);
      311    21318    3                 KZ$LINCTX.OTPDEV$=ADDR(NIL);
      312    21319    3                 IF KZ$LINCTX.OTPCNT=0 THEN
      313    21320    3                    ALTRETURN;             /* Nothing to do                      */
      314    21321    3                 DEV$=KZ$LINCTX.OTPHD$;
      315    21322    3                 BFR$=KZ$HIPDEV.OTPHD$;
      316    21323    3                 CTR$=DEV$->KZ$HIPDEV.CTR$;
      317    21324
      318    21325        /* IF DEVICE IS HALTED(NOT HALT-WACK), ITS BUFFER SHOULD NOT BE QUEUED UP */
      319    21326    3                 IF BFR$=ADDR(NIL) THEN ALTRETURN;
      320    21327    3                 IF KZ$HIPDEV.HLT AND (NOT KZ$HIPDEV.HLT.WACK) THEN
      321    21328        /***BUGBUG:       DO WHILE('1'B); J=0; END;   ********* TEMP *********/
      322    21329    3                    ALTRETURN;
      323    21330
      324    21331
      325    21332        /* DELINK DEVICE FROM LINE CONTEXT CHAIN */
      326    21333    3                 KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT-1;
      327    21334    3                 IF KZ$LINCTX.OTPCNT=0 THEN
      328    21335    3                    KZ$LINCTX.OTPTL$=ADDR(NIL);
      329    21336    3                 KZ$LINCTX.OTPHD$=KZ$HIPDEV.OTPLNK$;
      330    21337    3                 KZ$HIPDEV.ONOTP='0'B;
      331    21338
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:11   
      332    21339    3                 KZ$LINCTX.OTPBFR$=BFR$;
      333    21340    3                 KZ$LINCTX.OTPDEV$=DEV$;
      334    21341    3                 KZ$LINCTX.OTPCTR$=CTR$;
      335    21342    3                 KZ$LINCTX.CURDEV$=DEV$;
      336    21343    3                 KZ$LINCTX.CURCTR$=CTR$;
      337    21344    3                 KZ$HIPDEV.OTPBSY='1'B;
      338    21345                      /* The DELETED bit was removed from KZ$OTPBFR for E02:
      339    21346                         see comments in KZ$OTPBFR file.
      340    21347                      IF NOT BFR$->KZ$OTPBFR.DELETED THEN
      341    21348                      DO;
      342    21349                      */
      343    21350    3                 RETURN;
      344    21351                      /* Without the DELETED bit, this code will never be
      345    21352                         executed:
      346    21353                         END;
      347    21354        \* OUTPUT HAS BEEN DELETED: THROW AWAY    *\
      348    21355                      CALL UNQRELOTPBFR;
      349    21356                      CALL REQUEUE;
      350    21357                      */
      351    21358    3                 END SEARCHING /* Do forever sends me back to top!*/;
      352    21359        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:12   
      353    21360        /**/
      354    21361        /* Requeue Output */
      355    21362        /**/
      356    21363    2            CASE(%KZ#LINFCN_REQOTP);
      357    21364
      358    21365    2              DEV$=KZ$LINCTX.CURDEV$;
      359    21366    2              KZ$HIPDEV.OTPBSY='0'B;
      360    21367    2              BFR$=KZ$HIPDEV.OTPHD$;
      361    21368    2              KZ$OTPBFR.CMPCOD=/*       TEMP       */0;
      362    21369    2              CALL REQUEUE;
      363    21370
      364    21371        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:13   
      365    21372        /**/
      366    21373        /* Release Output */
      367    21374        /**/
      368    21375    2            CASE(%KZ#LINFCN_RELOTP);
      369    21376
      370    21377        /*       Unlike the 3270 handler, I explicitly leave
      371    21378                 the output buffer queued up on the device while
      372    21379                 link level I/O is in progress. The RELOTPBFR routine
      373    21380                 has another entry point that will unlink the current
      374    21381                 output buffer */
      375    21382    2              CTR$=KZ$LINCTX.CURCTR$;
      376    21383    2              DEV$=KZ$LINCTX.CURDEV$;
      377    21384    2              BFR$=KZ$HIPDEV.OTPHD$;
      378    21385        /*       COPY HALT REQUEST BITS FROM BUFFER: */
      379    21386    2              KZ$HIPDEV.HLT.PAG=BFR$->KZ$OTPBFR.FLAGS.HALT.PAG#;
      380    21387    2              KZ$HIPDEV.HLT.INP=BFR$->KZ$OTPBFR.FLAGS.HALT.INP#;
      381    21388
      382    21389    2              CALL UNQRELOTPBFR;
      383    21390
      384    21391        /*       If the current device has output pending and is not halted
      385    21392                 then the device will be requed on the device waiting list */
      386    21393    2              CALL REQUEUE;
      387    21394        /**/
      388    21395
      389    21396        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:14   
      390    21397        /**/
      391    21398        /* The link protocol module has decided that its time for
      392    21399           a poll of all active controllers. Make sure a correct list
      393    21400           of controller addresses is present in the MLCP polling
      394    21401           table list 'POLLTBL$'.*/
      395    21402        /**/
      396    21403    2            CASE(%KZ#LINFCN_SPCPOLALL);
      397    21404
      398    21405        /* It is time for a poll. See if the polling list needs rebuilding */
      399    21406    2              KZ$LINCTX.POLLTBL$->KZ$POLLHIP.INDX=0;
      400    21407    2              KZ$LINCTX.POLLTBL$->KZ$POLLHIP.CONTINUE_POLL='0'B;
      401    21408    2              CALL REBUILD_POLL_LIST ALTRET(NO_ACTIVE_CONTROLLERS);
      402    21409    2              RETURN;
      403    21410    2   NO_ACTIVE_CONTROLLERS:;
      404    21411    2              ALTRETURN;
      405    21412        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:15   
      406    21413        /**/
      407    21414        /* Get general poll address of next inactive controller */
      408    21415        /**/
      409    21416    2            CASE(%KZ#LINFCN_INACT_CTR);
      410    21417
      411    21418    2   INACT_CTR:
      412    21419    2              KZ$LINCTX.CURDEV$=ADDR(NIL);
      413    21420    2              I=KZ$LINCTX.INACT_CTR;
      414    21421    3              DO UNTIL(I=KZ$LINCTX.INACT_CTR);
      415    21422    4                 IF KZ$LINCTX.POLLST$->UBYT(I)=0 THEN DO;
      416    21423    4                    CTR$=KZ$LINCTX.CTRLST$->P$(I);
      417    21424    4                    KZ$LINCTX.POLADR.CTR=POLADR(KZ$HIPCTR.ADR);
      418    21425    4                    KZ$LINCTX.POLADR.DEV=0; /* Just to make it look nice         */
      419    21426    4                    KZ$LINCTX.CURCTR$=CTR$;
      420    21427    4                    IF I<KZ$LINCTX.POLSIZ-1 THEN
      421    21428    4                       KZ$LINCTX.INACT_CTR=I+1;
      422    21429    4                    ELSE
      423    21430    4                       KZ$LINCTX.INACT_CTR=0;
      424    21431    4                    KZ$LINCTX.POLX=I;
      425    21432    4                    RETURN;
      426    21433    4                    END;
      427    21434    3                 I=I+1;
      428    21435    3                 IF I>=KZ$LINCTX.POLSIZ THEN /* At end                           */
      429    21436    3                    I=0;
      430    21437    3                 END;
      431    21438        /**/
      432    21439    2              ALTRETURN;
      433    21440        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:16   
      434    21441        /**/
      435    21442        /* Input */
      436    21443        /**/
      437    21444    2            CASE(%KZ#LINFCN_INP);
      438    21445
      439    21446    2              KZ@HIPSTT.BLKIN=KZ@HIPSTT.BLKIN+1;
      440    21447    2              KZ@HIPSTT.CHRIN=KZ@HIPSTT.CHRIN+KZ$LINCTX.INPDATSIZ;
      441    21448
      442    21449        /*       Link protocol level has carefully set up current device */
      443    21450
      444    21451    2              DEV$=KZ$LINCTX.CURDEV$;
      445    21452    2              CTR$=KZ$HIPDEV.CTR$;
      446    21453
      447    21454    2              KZ$HIPDEV.IGN_INP='0'B;
      448    21455    3              IF KZ$HIPDEV.HLT.PAG OR KZ$HIPDEV.HLT.INP THEN DO;
      449    21456    3                 KZ$HIPDEV.HLT.PAG='0'B;
      450    21457    3                 KZ$HIPDEV.HLT.INP='0'B;
      451    21458    3                 CALL REQUEUE;
      452    21459    3                 KZ$HIPDEV.IGN_INP='1'B;
      453    21460    3                 END;
      454    21461    2              KZ@INPDESC=ADDR(PSTAT)->KZ$INPDESC;
      455    21462    2              FC1FC2=SUBSTR(KZ$LINCTX.INPBFR$->BCHARS,KZ@INPDESC.BYTX-3,2);
      456    21463    2              IF KZ$HIPCTR.TYP=7700 THEN
      457    21464    3              DO I=0 TO 1;
      458    21465    3                 IF FC_CHARS(I)~=' ' THEN
      459    21466    4                 DO;
      460    21467    4                    IF NOT KZ$HIPDEV.DSC THEN
      461    21468    4                       KZ$HIPDEV.IGN_INP='0'B;
      462    21469    4                    KZ@INPDESC.DATBYTSIZ=KZ@INPDESC.DATBYTSIZ+2;
      463    21470    4                    KZ@INPDESC.BYTX=KZ@INPDESC.BYTX-2;
      464    21471    4                    CALL INSERT(KZ$LINCTX.INPBFR$->BCHARS,KZ@INPDESC.BYTX,2,
      465    21472    4                      %BITASC('1B'X),FC_CHARS(I));
      466    21473    4                    END;
      467    21474    3                 END;
      468    21475    2              IF(NOT KZ$HIPDEV.IGN_INP)AND KZ$HIPDEV.VDI$~=ADDR(NIL)THEN
      469    21476    3   DONT_IGNORE_INPUT:DO;
      470    21477    3                 CALL ENTER_VDH(KZ$HIPDEV.VDI$,DFRD);
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:17   
      471    21478    4                 IF DFRD THEN DO;
      472    21479                         %DISABLE(INHLVL=KH_INHLVL);
      473    21483    4                    CALL KVB$GETSYS(SIZEW(KZ$INPBFR),T$) ALTRET(NO_MEMORY);
      474    21484                         %ENABLE(INHLVL=KH_INHLVL);
      475    21490    4                    T$->KZ$INPBFR=KZ_INPBFR;
      476    21491    4                    T$->KZ$INPBFR.BFR_SIZ=KZ$LINCTX.INPBFRSIZ;
      477    21492    4                    T$->KZ$INPBFR.DATA_SIZ=KZ@INPDESC.DATBYTSIZ;
      478    21493    4                    T$->KZ$INPBFR.BYTX=KZ@INPDESC.BYTX;
      479    21494    4                    T$->KZ$INPBFR.DATA$=KZ$LINCTX.INPBFR$;
      480    21495    4                    IF KZ$HIPDEV.DFRTL$~=ADDR(NIL) THEN
      481    21496    4                       KZ$HIPDEV.DFRTL$->KZ$INPBFR.LNK$=T$;
      482    21497    4                    ELSE
      483    21498    4                       KZ$HIPDEV.DFRHD$=T$;
      484    21499    4                    KZ$HIPDEV.DFRTL$=T$;
      485    21500    4                    KZ$LINCTX.INPBFR$=ADDR(NIL);
      486    21501    4                    END;
      487    21502    4                 ELSE DO;
      488    21503    4                    KV$VDH_DAT=KV_VDH_DAT;
      489    21504    4                    KV$VDH_DAT.DAT__.ADR$=KZ$LINCTX.INPBFR$;
      490    21505    4                    KV$VDH_DAT.DAT__.BYTX=KZ@INPDESC.BYTX;
      491    21506    4                    KV$VDH_DAT.DAT__.DATBYTSIZ=KZ@INPDESC.DATBYTSIZ;
      492    21507    4                    CALL GIVE_VDH_DATA;
      493    21508
      494    21509    4                    CALL EXIT_VDH(KZ$HIPDEV.VDI$);
      495    21510    4                    END;
      496    21511    3                 END DONT_IGNORE_INPUT;
      497    21512        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:18   
      498    21513        /**/
      499    21514        /* General Poll Time-out */
      500    21515        /**/
      501    21516    2            CASE(%KZ#LINFCN_POLTIMOUT);
      502    21517
      503    21518    2              CTR$=KZ$LINCTX.CURCTR$;
      504    21519    2              IF KZ$LINCTX.POLLST$->UBYT(KZ$HIPCTR.ADR)~=0 THEN
      505    21520    3   CONTROLLER_NOW_INACTIVE: DO;
      506    21521
      507    21522    3                 KZ$LINCTX.ACTCTR=KZ$LINCTX.ACTCTR-1;
      508    21523    3                 KZ$LINCTX.POLLST$->UBYT(KZ$HIPCTR.ADR)=0;
      509    21524    3                 CALL REBUILD_POLL_LIST;
      510    21525
      511    21526    3                 END CONTROLLER_NOW_INACTIVE;
      512    21527    2              ELSE
      513    21528    2                 RETURN /* CONTROLLER WAS NOT INACTIVE, LINK PROTOCOL BUG */;
      514    21529
      515    21530    2              DEV$=KZ$HIPCTR.DEVHD$;
      516    21531    3              DO WHILE(DEV$~=ADDR(NIL));
      517    21532    4                 IF KZ$HIPDEV.ACTIVE THEN DO;
      518    21533    4                    KZ$HIPDEV.ACTIVE='0'B;
      519    21534    4                    CALL DSC_DEV(%KV_DSCRSN_LINDRP);
      520    21535    4                    END;
      521    21536    3                 DEV$=KZ$HIPDEV.LNK$;
      522    21537    3                 END;
      523    21538    2              RETURN;
      524    21539
      525    21540        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:19   
      526    21541        /**/
      527    21542        /* disconnect channels */
      528    21543        /**/
      529    21544    2            CASE(%KZ#LINFCN_DSCTRM,
      530    21545    2                %KZ#LINFCN_KILL);
      531    21546
      532    21547    3              DO CASE (KZ$EVENT.TERMID$->B$TERMINAL_ID.LEV);
      533    21548
      534    21549    3               CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                            */
      535    21550    3                 KZ$LINCTX.DSC_LEV=%TERMINAL_ID_LEV_CHAN#;
      536    21551    3                 CTR$=KZ$LINCTX.CTRHD$;
      537    21552    3                 IF CTR$=ADDR(NIL) THEN
      538    21553    3                    CALL RLS_LINE;
      539    21554    3                 ELSE
      540    21555    4                 DO WHILE(CTR$~=ADDR(NIL));
      541    21556    4                    TCTR$=KZ$HIPCTR.LNK$;
      542    21557    4                    DEV$=KZ$HIPCTR.DEVHD$;
      543    21558    4                    IF DEV$=ADDR(NIL) THEN
      544    21559    4                       CALL RLS_CTR;
      545    21560    4                    ELSE
      546    21561    5                    DO WHILE(DEV$~=ADDR(NIL));
      547    21562    5                       TDEV$=KZ$HIPDEV.LNK$;
      548    21563    6                       IF KZ$HIPDEV.ACTIVE THEN DO;
      549    21564    6                          KZ$HIPDEV.ACTIVE='0'B;
      550    21565    6                          CALL DSC_DEV(KZ$LINCTX.DSCRSN);
      551    21566    6                          END;
      552    21567    5                       ELSE
      553    21568    5                          CALL RLS_DEV;
      554    21569    5                       DEV$=TDEV$;
      555    21570    5                       END;
      556    21571    4                    CTR$=TCTR$;
      557    21572    4                    END;
      558    21573
      559    21574    3               CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                   */
      560    21575    3                 KZ$LINCTX.DSC_LEV=%TERMINAL_ID_LEV_SUBCHAN#;
      561    21576    3                 I=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBDEVICE;
      562    21577    3                 CALL FND_CTR ALTRET(NONE);
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:20   
      563    21578    3                 DEV$=KZ$HIPCTR.DEVHD$;
      564    21579    3                 IF DEV$=ADDR(NIL) THEN
      565    21580    3                    CALL RLS_CTR;
      566    21581    3                 ELSE
      567    21582    4                 DO WHILE(DEV$~=ADDR(NIL));
      568    21583    4                    TDEV$=KZ$HIPDEV.LNK$;
      569    21584    5                    IF KZ$HIPDEV.ACTIVE THEN DO;
      570    21585    5                       KZ$HIPDEV.ACTIVE='0'B;
      571    21586    5                       CALL DSC_DEV(KZ$LINCTX.DSCRSN);
      572    21587    5                       END;
      573    21588    4                    ELSE
      574    21589    4                       CALL RLS_DEV;
      575    21590    4                    DEV$=TDEV$;
      576    21591    4                    END;
      577    21592
      578    21593    3               CASE (%TERMINAL_ID_LEV_SUBSUBCHAN#); /* Device                    */
      579    21594    3                 KZ$LINCTX.DSC_LEV=%TERMINAL_ID_LEV_SUBSUBCHAN#;
      580    21595    3                 I=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBDEVICE;
      581    21596    3                 J=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBSUBDEVICE;
      582    21597    3                 CALL FND_CTR ALTRET(NONE);
      583    21598    3                 CALL FND_DEV ALTRET(NONE);
      584    21599    4                 IF KZ$HIPDEV.ACTIVE THEN DO;
      585    21600    4                    KZ$HIPDEV.ACTIVE='0'B;
      586    21601    4                    KZ$HIPDEV.REACT='1'B;
      587    21602    4                    CALL DSC_DEV(KZ$LINCTX.DSCRSN);
      588    21603    4                    END;
      589    21604    3                 ELSE
      590    21605    3                    CALL RLS_DEV;
      591    21606    3   NONE:         ;
      592    21607    3               END;
      593    21608        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:21   
      594    21609        /**/
      595    21610        /* Controller Present */
      596    21611        /**/
      597    21612    2            CASE(%KZ#LINFCN_NEWCTR);
      598    21613
      599    21614    2              CTR$=KZ$LINCTX.CTRLST$->P$(KZ$LINCTX.POLX);
      600    21615    2              KZ$LINCTX.ACTCTR=KZ$LINCTX.ACTCTR+1;
      601    21616    2              KZ$LINCTX.POLLST$->UBYT(KZ$LINCTX.POLX)=
      602    21617    2                POLADR(KZ$HIPCTR.ADR);
      603    21618    2              CALL REBUILD_POLL_LIST;
      604    21619    2              DEV$=KZ$HIPCTR.DEVHD$;
      605    21620    3              DO WHILE(DEV$~=ADDR(NIL));
      606    21621    3                 KZ$HIPDEV.ACTIVE='1'B;
      607    21622    3                 CALL CNC_DEV;
      608    21623    3                 DEV$=KZ$HIPDEV.LNK$;
      609    21624    3                 END;
      610    21625        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:22   
      611    21626        /**/
      612    21627        /* Build Controller and Device Context */
      613    21628        /**/
      614    21629    2            CASE(%KZ#LINFCN_BLDCTX);
      615    21630
      616    21631    3              IF KZ_VDHSTT$=ADDR(NIL) THEN DO;
      617    21632                                                /* INIT VDH STAT BUFFER               */
      618    21633                      %DISABLE(INHLVL=KH_INHLVL);
      619    21637    3                 SZ=SIZEW(KV$STT);
      620    21638    3                 CALL KVB$GETSYS(SZ,KZ_VDHSTT$) ALTRET (NO_MEMORY);
      621    21639    3                 KV$STT='0'B;
      622    21640    3                 KV$STT.REQSTATS.FNC=%IGA_REQSTATS;
      623    21641    3                 KV$STT.REQSTATS.SLCENT(%KH#ENTID_VDH)='1'B;
      624    21642    3                 KV$STT.REQSTATS.SLCENT(%KH#ENTID_PLDVIP)='1'B;
      625    21643    3                 KV$STT.REQSTATS.DSPENT(%KH#ENTID_VDH)='1'B;
      626    21644
      627    21645                                                /*  INIT HIP STAT BUFFER              */
      628    21646    3                 SZ=SIZEW(KZ@HIPSTT);
      629    21647    3                 CALL KVB$GETSYS(SZ,KZ_HIP_HDR.STTBFR$) ALTRET (NO_MEMORY);
      630    21648    3                 KZ@HIPSTT='0'B;
      631    21649    3                 KZ@HIPSTT.REQSTATS.FNC=%IGA_REQSTATS;
      632    21650    3                 KZ@HIPSTT.REQSTATS.DSPENT(%KH#ENTID_PLDVIP)='1'B;
      633    21651    3                 KZ@HIPSTT.REQSTATS.SLCENT(%KH#ENTID_PLDVIP)='1'B;
      634    21652    3                 KZ@HIPSTT.REQSTATS.SLCENT(%KH#ENTID_VDH)='1'B;
      635    21653    3                 SZ=SIZEW(KV$USRPRM);
      636    21654    3                 CALL KVB$GETSYS(SZ, KZH_USRPRM$) ALTRET(NO_MEMORY);
      637    21655                      %ENABLE(INHLVL=KH_INHLVL);
      638    21661    3                 KZH_USRPRM$->KV$USRPRM=KZ_USRPRM;
      639    21662    3                 KZH_USRPRM$->KV$USRPRM.HLTMSG=HALT_MESSAGE.HLTMSG;
      640    21663    3                 KZH_USRPRM$->KV$USRPRM.HLTMSGSIZ=LENGTHC(HALT_MESSAGE);
      641    21664    3                 KZH_USRPRM$->KV$USRPRM.INHLVL=KH_INHLVL;
      642    21665    3                 KZH_USRPRM$->KV$USRPRM.STT$=KZ_VDHSTT$;
      643    21666
      644    21667    3                 END;
      645    21668
      646    21669    3              DO CASE (KZ$EVENT.TERMID$->B$TERMINAL_ID.LEV);
      647    21670    3               CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                   */
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:23   
      648    21671
      649    21672    3                 KZ$LINCTX.POLSIZ=KZ$LINCTX.POLSIZ+1; /* # controllers to poll   */
      650    21673    3                 CTR$=KZ$LINCTX.CTRHD$;    /* See if CTR already present         */
      651    21674    4                 DO WHILE(CTR$~=ADDR(NIL));
      652    21675    4                    IF KZ$HIPCTR.ADR=KZ$EVENT.CHNCTX$->KL_CONTROLLER.CONT# THEN
      653    21676    4                       GOTO SETCTR;
      654    21677    4                    CTR$=KZ$HIPCTR.LNK$;
      655    21678    4                    END;
      656    21679    3                 CALL BLD_CTR_CTX ALTRET(NO_MEMORY);
      657    21680    3   SETCTR:
      658    21681    3                 KZ$HIPCTR.ADR=KZ$EVENT.CHNCTX$->KL_CONTROLLER.CONT#;
      659    21682    3                 KZ$HIPCTR.ROWS=KZ$EVENT.CHNCTX$->KL_CONTROLLER.ROWS;
      660    21683    3                 KZ$HIPCTR.COLS=KZ$EVENT.CHNCTX$->KL_CONTROLLER.COLUMNS;
      661    21684    3                 KZ$HIPCTR.TYP=KZ$EVENT.CHNCTX$->KL_CONTROLLER.TYPE;
      662    21685    3                 KZ$HIPCTR.LIN$=LIN$;
      663    21686    3                 KZ$HIPCTR.CHN$=KZ$EVENT.CHN$;
      664    21687    3                 KZ$EVENT.CHN$->KH$CHN.TERMID.TTYP = %KLTY_HIP_CONT#;
      665    21688    3                 KZ$EVENT.CHN$->KH$CHN.CTX$ = CTR$;
      666    21689
      667    21690    3               CASE (%TERMINAL_ID_LEV_SUBSUBCHAN#); /* Device                    */
      668    21691
      669    21692    3                 I=KZ$EVENT.CHNCTX$->KL_LINEDEV.CONTROLLER#;
      670    21693    3                 J=KZ$EVENT.CHNCTX$->KL_LINEDEV.DEVICE#;
      671    21694    3                 CALL FND_CTR ALTRET(NO_CTRLR);
      672    21695    3                 DEV$=KZ$HIPCTR.DEVHD$;
      673    21696    4                 DO WHILE(DEV$~=ADDR(NIL));
      674    21697    4                    IF KZ$HIPDEV.ADR=KZ$EVENT.CHNCTX$->KL_LINEDEV.DEVICE# THEN
      675    21698    4                       GOTO SETDEV;
      676    21699    4                    DEV$=KZ$HIPDEV.LNK$;
      677    21700    4                    END;
      678    21701    3                 CALL BLD_DEV_CTX ALTRET(NO_MEMORY);
      679    21702    3   SETDEV:
      680    21703    3                 KZ$HIPDEV.CHN$=KZ$EVENT.CHN$;
      681    21704    3                 KZ$EVENT.CHN$->KH$CHN.TERMID.TTYP = %KLTY_HIP_LINE#;
      682    21705    3                 KZ$EVENT.CHN$->KH$CHN.CTX$ = DEV$;
      683    21706    3                 IF KZ$HIPCTR.TYP=3276 THEN
      684    21707    3                    KZ$HIPDEV.EWALT='1'B;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:24   
      685    21708    3                 ELSE
      686    21709    3                    KZ$HIPDEV.EWALT='0'B;
      687    21710    3                 KZ$HIPDEV.PRINTER=KZ$HIPDEV.ADR~=0;
      688    21711    3                 CALL SET_PRO;
      689    21712    3   NO_CTRLR:
      690    21713    3               END;
      691    21714
      692    21715        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:25   
      693    21716        /* Build Context Complete */
      694    21717
      695    21718    2            CASE(%KZ#LINFCN_CTXCMP);
      696    21719                   %DISABLE(INHLVL=KH_INHLVL);
      697    21723    2              SZ=((KZ$LINCTX.POLSIZ*6)+5)/2;
      698    21724    2              CALL KVB$GETSYS(SZ,T$) ALTRET(NO_MEMORY);
      699    21725    2              KZ$LINCTX.CTRLST$=T$;
      700    21726    2              KZ$LINCTX.POLLST$=PINCRW(T$,
      701    21727    2                KZ$LINCTX.POLSIZ*2);
      702    21728    2              KZ$LINCTX.POLLTBL$=PINCRW(KZ$LINCTX.POLLST$,(KZ$LINCTX.POLSIZ+1)/2);
      703    21729    2              KZ$LINCTX.POLLTBL$->KZ$POLLHIP.REBUILD_POLL='1'B;
      704    21730
      705    21731    2              CTR$=KZ$LINCTX.CTRHD$;
      706    21732    3              DO I=0 TO KZ$LINCTX.POLSIZ-1;
      707    21733    3                 KZ$LINCTX.POLLST$->UBYT(I)=0; /* Make all controllers inactive  */
      708    21734    3                 KZ$LINCTX.CTRLST$->P$(I)=CTR$;
      709    21735    3                 CTR$=KZ$HIPCTR.LNK$;
      710    21736    3                 END;
      711    21737                   %ENABLE(INHLVL=KH_INHLVL);
      712    21743        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:26   
      713    21744        /* Enable Channels  */
      714    21745
      715    21746    2            CASE(%KZ#LINFCN_ENABL);
      716    21747
      717    21748    3              DO CASE (KZ$EVENT.TERMID$->B$TERMINAL_ID.LEV);
      718    21749
      719    21750    3               CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                            */
      720    21751
      721    21752    3               CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                   */
      722    21753
      723    21754    3               CASE (%TERMINAL_ID_LEV_SUBSUBCHAN#); /* Device                    */
      724    21755    3                 I=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBDEVICE;
      725    21756    3                 J=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBSUBDEVICE;
      726    21757    3                 CALL FND_CTR ALTRET(NO_WAY);
      727    21758    3                 CALL FND_DEV ALTRET(NO_WAY);
      728    21759    3                 IF KZ$HIPDEV.AWAIT_ENABLE OR
      729    21760    3                   (KZ$HIPDEV.PRINTER AND NOT KZ$HIPDEV.ACTIVE) OR
      730    21761    3                   KZ$HIPDEV.CHN$->KH$CHN.AUTLGN
      731    21762    3                 THEN CALL CNC_DEV;
      732    21763    3   NO_WAY:       ;
      733    21764    3               END;
      734    21765        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:27   
      735    21766    2            CASE(%KZ#LINFCN_DISABL);
      736    21767    2            CASE(ELSE);
      737    21768    2              CALL M$XXX;                  /* Unknown function from line-manager */
      738    21769    2            END;                           /* End DO CASE(FCN)                   */
      739    21770        /**/
      740    21771    1   XIT:
      741    21772    1           IF VDH_FLG~=0 THEN
      742    21773    1              CALL EXIT_VDH(KZ$HIPDEV.VDI$);
      743    21774        /**/
      744    21775    1           RETURN;
      745    21776
      746    21777        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:28   
      747    21778    1   NO_MEMORY:
      748    21779        /*  NO_MEMORY - Disconnect the line due to a lack of memory  */
      749    21780                %ENABLE(INHLVL=KH_INHLVL);
      750    21786    1           CALL ERRLOG(%E$NO_MEMORY);
      751    21787    1           CALL DSC_LINE;
      752    21788    1           GOTO XIT;
      753    21789        %EJECT
      754    21790        /**/
      755    21791        /* KZH$DFR - Process deferred items */
      756    21792        /**/
      757    21793
      758    21794    1   KZH$DFR: ENTRY(PARM1) ALTRET;
      759    21795
      760    21796    1           DEV$=ADDR(DEVCTX);
      761    21797    1           CTR$=KZ$HIPDEV.CTR$;
      762    21798    1           LIN$=KZ$HIPCTR.LIN$;
      763    21799    1           VDH_FLG=1;                      /* Already in VDH                     */
      764    21800        /**/
      765    21801    2           DO WHILE(KZ$HIPDEV.DFRHD$~=ADDR(NIL));
      766    21802    2              BFR$=KZ$HIPDEV.DFRHD$;
      767    21803    2              KZ$HIPDEV.DFRHD$=KZ$OTPBFR.LNK$;
      768    21804    2              IF KZ$HIPDEV.DFRHD$=ADDR(NIL) THEN
      769    21805    2                 KZ$HIPDEV.DFRTL$=ADDR(NIL);
      770    21806    3              DO CASE(KZ$OTPBFR.TYP);
      771    21807    3               CASE(%KZ#BFRTYP_OTP);
      772    21808    3                 CALL RELOTPBFR;
      773    21809    3               CASE(%KZ#BFRTYP_INP);
      774    21810    3                 KV$VDH_DAT=KV_VDH_DAT;
      775    21811    3                 KV$VDH_DAT.DAT__.ADR$=KZ$INPBFR.DATA$;
      776    21812    3                 KV$VDH_DAT.DAT__.BYTX=KZ$INPBFR.BYTX;
      777    21813    3                 KV$VDH_DAT.DAT__.DATBYTSIZ=KZ$INPBFR.DATA_SIZ;
      778    21814    3                 CALL GIVE_VDH_DATA;
      779    21815    3                 KZ@HIPSTT.KHSTT.INPBFRBYTUTL=KZ@HIPSTT.KHSTT.INPBFRBYTUTL-
      780    21816    3                   (KZ$INPBFR.BFR_SIZ*2);
      781    21817    3                 T$=KZ$INPBFR.DATA$;
      782    21818    3                 I=KZ$INPBFR.BFR_SIZ;
      783    21819    3                 CALL KVB$RLSSYS(I,T$);
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:29   
      784    21820    3                 T$=BFR$;
      785    21821    3                 CALL KVB$RLSSYS(SIZEW(KZ$INPBFR),T$);
      786    21822    3               END;
      787    21823    2              END;
      788    21824    1           RETURN;
      789    21825
      790    21826        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:30   
      791    21827        /**/
      792    21828        /* KZH$DSC - Disconnect processing */
      793    21829        /**/
      794    21830
      795    21831    1   KZH$DSC: ENTRY(PARM1) ALTRET;
      796    21832
      797    21833    1           DEV$=ADDR(DEVCTX);
      798    21834    1           CTR$=KZ$HIPDEV.CTR$;
      799    21835    1           LIN$=KZ$HIPCTR.LIN$;
      800    21836    1           VDH_FLG=1;                      /* Already in VDH                     */
      801    21837    1           CALL DSC_DEV(%KV_DSCRSN_PTH);
      802    21838    1           RETURN;
      803    21839
      804    21840    1   KZH$DSC_CONT: ENTRY(PARM1) ALTRET;
      805    21841
      806    21842    1           DEV$=ADDR(DEVCTX);
      807    21843    1           CTR$=KZ$HIPDEV.CTR$;
      808    21844    1           LIN$=KZ$HIPCTR.LIN$;
      809    21845    1           VDH_FLG=1;                      /* Already in VDH                     */
      810    21846    1           CALL DSC_DEV_CONT(%KV_DSCRSN_PTH);
      811    21847    1           RETURN;
      812    21848
      813    21849        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:31   
      814    21850        /**/
      815    21851        /* KZH$RELOTPBFR - Release an output buffer */
      816    21852        /**/
      817    21853
      818    21854    1   KZH$RELOTPBFR: ENTRY(PARM1,PARM2) ALTRET;
      819    21855
      820    21856    1           DEV$=ADDR(DEVCTX);
      821    21857    1           CTR$=KZ$HIPDEV.CTR$;
      822    21858    1           LIN$=KZ$HIPCTR.LIN$;
      823    21859    1           VDH_FLG=1;                      /* Already in VDH                     */
      824    21860    1           BFR$=OTPBFR$;
      825    21861    1           CALL RELOTPBFR;
      826    21862    1           CALL REQUEUE;
      827    21863    1           RETURN;
      828    21864
      829    21865        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:32   
      830    21866        /**/
      831    21867        /* KZH$RLSCTX - Release Context */
      832    21868        /**/
      833    21869
      834    21870    1   KZH$RLSCTX: ENTRY(PARM1) ALTRET;
      835    21871
      836    21872    1           DEV$=ADDR(DEVCTX);
      837    21873    1           KZ$HIPDEV.VDI$=ADDR(NIL);
      838    21874    1           CTR$=KZ$HIPDEV.CTR$;
      839    21875    1           LIN$=KZ$HIPCTR.LIN$;
      840    21876    1           CALL RLS_DEV;
      841    21877    1           RETURN;
      842    21878
      843    21879        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:33   
      844    21880        /**/
      845    21881        /* KZH$STATS - Get address and size of stats buffer
      846    21882
      847    21883        KZH$STATS: ENTRY(PARM1,PARM2) ALTRET;
      848    21884
      849    21885                ADDR(PARM1)->P$(0)=ADDR(KZ@HIPSTT);
      850    21886                PARM2=SIZEW(KZ@HIPSTT);
      851    21887                RETURN;                */
      852    21888        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:34   
      853    21889        /**/
      854    21890        /**/
      855    21891        /* Find controller context */
      856    21892        /**/
      857    21893        /**/
      858    21894    1   FND_CTR: PROC ALTRET;
      859    21895        /**/
      860    21896    2           IF I>31 THEN
      861    21897    3           DO;                             /* Got a bad controller number        */
      862    21898                       /*   ERROR: KZH-E$BADADR
      863    21899                          MESSAGE: GOT A BAD CTRL/DEV NUMBER.
      864    21900                          R3 = I = CONTROLLER NUM.
      865    21901                          R4 = J = DEVICE NUMBER.
      866    21902                       */
      867    21903    3   ERRDEV:    CALL ERRLOG(%E$BADADR);
      868    21904    3              ALTRETURN;
      869    21905    3              END;
      870    21906    2           CTR$=KZ$LINCTX.CTRHD$;
      871    21907    3           DO WHILE(CTR$~=ADDR(NIL));
      872    21908    3              IF KZ$HIPCTR.ADR=I THEN
      873    21909    3                 RETURN;
      874    21910    3              CTR$=KZ$HIPCTR.LNK$;
      875    21911    3              END;
      876    21912    2           GOTO ERRDEV;
      877    21913        /**/
      878    21914        /**/
      879    21915        /* Find device context given controller context */
      880    21916        /**/
      881    21917        /**/
      882    21918    2   FND_DEV: ENTRY ALTRET;
      883    21919        /**/
      884    21920    2           IF J>31 THEN
      885    21921    2              GOTO ERRDEV;
      886    21922    2           DEV$=KZ$HIPCTR.DEVHD$;
      887    21923    3           DO WHILE(DEV$~=ADDR(NIL));
      888    21924    3              IF KZ$HIPDEV.ADR=J THEN
      889    21925    3                 RETURN;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:35   
      890    21926    3              DEV$=KZ$HIPDEV.LNK$;
      891    21927    3              END;
      892    21928    2           GOTO ERRDEV;
      893    21929    2   END FND_CTR;
      894    21930        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:36   
      895    21931        /**/
      896    21932        /**/
      897    21933        /* Find device context */
      898    21934        /**/
      899    21935    1   FND_CTX: PROC ALTRET;
      900    21936        /*N*  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!  *N*/
      901    21937        /*N*                                   NOBODY                               *N*/
      902    21938        /*N*                                   CALLS                                *N*/
      903    21939        /*N*                                   THIS                                 *N*/
      904    21940        /*N*                                   THING!                               *N*/
      905    21941        /*N*  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!  *N*/
      906    21942        /**/
      907    21943    2   DCL P$ PTR;
      908    21944        /**/
      909    21945        /*N* KLUDGE UNTIL PL6 FIXED */
      910    21946    2           STATUS=KZ$LINCTX.INPBFR$->BIT16(0)&'3F3F'X;
      911    21947    2           I=STATUSB.I;
      912    21948    2           J=STATUSB.J;
      913    21949        /**/
      914    21950    2           CALL FND_CTR ALTRET(NO_CTR);
      915    21951    2           KZ$LINCTX.CURCTR$=CTR$;
      916    21952    2           CALL FND_DEV ALTRET(BLD_CTX);
      917    21953    2           KZ$LINCTX.CURDEV$=DEV$;
      918    21954    2           RETURN;
      919    21955        /**/
      920    21956    2   NO_CTR:
      921    21957        /* No such controller - screech */
      922    21958    2           ALTRETURN;
      923    21959        /**/
      924    21960    2   BLD_CTX:
      925    21961    2           CALL BLD_DEV_CTX ALTRET(NOMEM);
      926    21962    2           KZ$LINCTX.CURDEV$=DEV$;
      927    21963    2           RETURN;
      928    21964        /**/
      929    21965    2   NOMEM:  ALTRETURN;
      930    21966        /**/
      931    21967    2   END FND_CTX;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:37   
      932    21968        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:38   
      933    21969        /**/
      934    21970        /**/
      935    21971        /* Build device context */
      936    21972        /**/
      937    21973        /**/
      938    21974    1   BLD_DEV_CTX: PROC ALTRET;
      939    21975        /**/
      940    21976                %DISABLE(INHLVL=KH_INHLVL);
      941    21980    2           CALL KVB$GETSYS(SIZEW(KZ$HIPDEV),T$) ALTRET(NOMEM);
      942    21981                %ENABLE(INHLVL=KH_INHLVL);
      943    21987    2           KZ@HIPSTT.KHSTT.CTXBYTUTL = KZ@HIPSTT.KHSTT.CTXBYTUTL + SIZEC(KZ$HIPDEV);
      944    21988    2           DEV$=T$;
      945    21989    2           KZ$LINCTX.CURDEV$=DEV$;
      946    21990    2           KZ$HIPDEV=KZ_HIPDEV;
      947    21991    2           KZ$HIPDEV.CTR$=CTR$;
      948    21992    2           KZ$HIPDEV.ADR=J;
      949    21993    2           KZ$HIPDEV.ROWS=KZ$HIPCTR.ROWS;
      950    21994    2           KZ$HIPDEV.COLS=KZ$HIPCTR.COLS;
      951    21995    2           IF KZ$HIPCTR.TYP=3276 THEN
      952    21996    2              KZ$HIPDEV.EWALT='1'B;
      953    21997    2           KZ$HIPDEV.LNK$=KZ$HIPCTR.DEVHD$;
      954    21998    2           KZ$HIPCTR.DEVHD$=DEV$;
      955    21999    2           CALL SET_PRO;
      956    22000    2           RETURN;
      957    22001        /**/
      958    22002    2   NOMEM:  ALTRETURN;
      959    22003
      960    22004    2   END BLD_DEV_CTX;
      961    22005        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:39   
      962    22006        /**/
      963    22007        /**/
      964    22008        /* Build controller context */
      965    22009        /**/
      966    22010        /**/
      967    22011    1   BLD_CTR_CTX: PROC ALTRET;
      968    22012        /**/
      969    22013                %DISABLE(INHLVL=KH_INHLVL);
      970    22017    2           CALL KVB$GETSYS(SIZEW(KZ$HIPCTR),T$) ALTRET(NOMEM);
      971    22018                %ENABLE(INHLVL=KH_INHLVL);
      972    22024    2           KZ@HIPSTT.KHSTT.CTXBYTUTL = KZ@HIPSTT.KHSTT.CTXBYTUTL + SIZEC(KZ$HIPCTR);
      973    22025    2           CTR$=T$;
      974    22026    2           KZ$HIPCTR=KZ_HIPCTR;
      975    22027    2           P1$=ADDR(NIL);
      976    22028    2           T$=KZ$LINCTX.CTRHD$;
      977    22029    3           DO WHILE(T$~=ADDR(NIL));
      978    22030    3              P1$=T$;
      979    22031    3              T$=T$->KZ$HIPCTR.LNK$;
      980    22032    3              END;
      981    22033    2           IF P1$~=ADDR(NIL) THEN
      982    22034    2              P1$->KZ$HIPCTR.LNK$=CTR$;
      983    22035    2           ELSE
      984    22036    2              KZ$LINCTX.CTRHD$=CTR$;
      985    22037    2           RETURN;
      986    22038        /**/
      987    22039    2   NOMEM:  ALTRETURN;
      988    22040    2   END BLD_CTR_CTX;
      989    22041        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:40   
      990    22042        /**/
      991    22043        /**/
      992    22044        /* Initialize the PRO field in the dev context */
      993    22045        /**/
      994    22046        /**/
      995    22047    1   SET_PRO: PROC;
      996    22048        /**/
      997    22049    2           KZ$HIPDEV.PRO='0'B;
      998    22050    2           IF KZ$HIPDEV.EWALT THEN
      999    22051    2              KZ$HIPDEV.PRO.EWALT='1'B;
     1000    22052    2           RETURN;
     1001    22053    2   END SET_PRO;
     1002    22054        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:41   
     1003    22055    1   REBUILD_POLL_LIST:PROC ALTRET;
     1004    22056
     1005    22057    2   DCL I SBIN;
     1006    22058    2   DCL J SBIN;
     1007    22059
     1008    22060        /* The MLCP needs a list of poll addresses in order to
     1009    22061            poll the entire list. When ever a controller connects or
     1010    22062           disconnects, the poll list must be rebuilt */
     1011    22063
     1012    22064    2           KZ$LINCTX.POLLTBL$->KZ$POLLHIP.REBUILD_POLL='0'B;
     1013    22065    2           KZ$LINCTX.POLLTBL$->KZ$POLLHIP.INDX=0;
     1014    22066    2           KZ$LINCTX.POLLTBL$->KZ$POLLHIP.POLLX=0;
     1015    22067    2           KZ$LINCTX.POLLTBL$->KZ$POLLHIP.CONTINUE_POLL='1'B;
     1016    22068    2           J=0;
     1017    22069    3           DO I=0 TO KZ$LINCTX.POLSIZ-1;
     1018    22070    3              IF KZ$LINCTX.POLLST$->UBYT(I)~=0 THEN
     1019    22071    4              DO;
     1020    22072    4                 KZ$LINCTX.POLLTBL$->KZ$POLLHIP.POLL_LIST(J)= KZ$LINCTX.POLLST$->UBYT(I
             22072                          ); J=J+1;
     1021    22073    4                 END;
     1022    22074    3              END /* DO */;
     1023    22075    2           IF J=0 THEN
     1024    22076    2              ALTRETURN;                   /* NO ACTIVE CONTROLLERS EXIST        */
     1025    22077    2   END REBUILD_POLL_LIST;
     1026    22078        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:42   
     1027    22079        /**/
     1028    22080        /* UNQRELOTPBFR - unqueue the head of the current output devices
     1029    22081            output buffer chain, and release the output buffer.
     1030    22082        */
     1031    22083    1   UNQRELOTPBFR: PROC ALTRET;
     1032    22084
     1033    22085    2   DCL OTPBYTES UBIN;
     1034    22086    2   DCL I UBIN;
     1035    22087
     1036    22088    2           DEV$=KZ$LINCTX.CURDEV$;
     1037    22089    2           CTR$=KZ$HIPDEV.CTR$;
     1038    22090    2           BFR$=KZ$HIPDEV.OTPHD$;
     1039    22091
     1040    22092    2           KZ$HIPDEV.OTPHD$=BFR$->KZ$OTPBFR.LNK$;
     1041    22093    2           KZ$HIPDEV.OTPCNT=KZ$HIPDEV.OTPCNT-1;
     1042    22094    2           IF KZ$HIPDEV.OTPCNT=0 THEN
     1043    22095    2              KZ$HIPDEV.OTPTL$=ADDR(NIL);
     1044    22096
     1045    22097    2           KZ$HIPDEV.OTPBSY='0'B;
     1046    22098        /**/
     1047    22099        /* RELOTPBFR - Release output buffer chain */
     1048    22100        /**/
     1049    22101    2   RELOTPBFR: ENTRY ALTRET;
     1050    22102        /**/
     1051    22103        /**/
     1052    22104        /* This internal proc is called *only* any of the following conditions hold:
     1053    22105            1) Throttling or output marks exist in buffer
     1054    22106            2) VDH_FLG=1 (we are already in VDH)
     1055    22107            3) Disconnect code is in progress.
     1056    22108        */
     1057    22109    2   VDH_SPECIFIC:PROC ALTRET;
     1058    22110
     1059    22111        /**/
     1060    22112    3           CALL ENTER_VDH(KZ$HIPDEV.VDI$, DFRD);
     1061    22113    4           IF DFRD='1'B THEN DO;           /* Can't get to VDH now               */
     1062    22114    4              IF KZ$HIPDEV.DFRTL$~=ADDR(NIL) THEN
     1063    22115    4                 KZ$HIPDEV.DFRTL$->KZ$OTPBFR.LNK$=BFR$;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:43   
     1064    22116    4              ELSE
     1065    22117    4                 KZ$HIPDEV.DFRHD$=BFR$;
     1066    22118    4              KZ$HIPDEV.DFRTL$=BFR$;
     1067    22119    4              KZ$OTPBFR.LNK$=ADDR(NIL);
     1068    22120    4              ALTRETURN;
     1069    22121    4              END;
     1070    22122        /**/
     1071    22123        /**/
     1072    22124    4           IF KZ$OTPBFR.MRKCNT~=0 THEN DO; /* Output markers                     */
     1073    22125    4              TBFR$=PINCRW(BFR$,KZ_HIP_BFRSIZ(KZ$OTPBFR.BFRSIZ)-
     1074    22126    4                SIZEW(KV$OTPMRK)*KZ$OTPBFR.MRKCNT);
     1075    22127    5              DO WHILE(KZ$OTPBFR.MRKCNT~=0);
     1076    22128    5                 KV$VDH_OTPMRK=KV_VDH_OTPMRK;
     1077    22129    5                 KV$VDH_OTPMRK.DAT=TBFR$->KV$OTPMRK;
     1078    22130    5                 KV$VDH_OTPMRK.CMPCOD=KZ$OTPBFR.CMPCOD;
     1079    22131    5                 CALL KVV$VDI(KV$VDH_OTPMRK);
     1080    22132    5                 TBFR$=PINCRW(TBFR$,SIZEW(KV$OTPMRK));
     1081    22133    5                 KZ$OTPBFR.MRKCNT=KZ$OTPBFR.MRKCNT-1;
     1082    22134    5                 END;
     1083    22135    4              END;
     1084    22136    3           CALL RLS_BUFFER;
     1085    22137    4           IF KZ$HIPDEV.THROTL THEN DO;
     1086    22138    4              IF KZ$HIPDEV.PRINTER = '1'B AND KZ$HIPDEV.OTPCNT ~=0 THEN
     1087    22139    4                 KZ$HIPDEV.THROTL = '1'B;
     1088    22140    5              ELSE DO;
     1089    22141    5                 KZ$HIPDEV.THROTL = '0'B;
     1090    22142                      %KV$RQSOTP(RQSOTP=YES);
             22154    6           IF NOT KV$PTR.VDI$->KV$VDI.RQSOTP  THEN DO;
             22155    6              KV$PTR.VDI$->KV$VDI.RQSOTP = '1'B;
             22156    6              CALL KVV$VDI(KV_VDH_EVT_RQSOTP);
             22157    6              END;                         /* END IF                             */
     1091    22160    5                 END;
     1092    22161    4              END;
     1093    22162    3           IF (KZ$HIPDEV.DONE) AND (KZ$HIPDEV.OTPCNT=0) THEN
     1094    22163    3              CALL KZH$CMPOTP(KZ$HIPDEV) /* FLUSH OUT LAST BUFFER */;
     1095    22164        /**/
     1096    22165    3           IF KZ$HIPDEV.DSC.VDH_FINAL AND KZ$HIPDEV.OTPHD$=ADDR(NIL)
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:44   
     1097    22166    4           THEN DO;
     1098    22167    4              KZ$HIPDEV.DSC.DEV_FINAL='1'B; /* All output drained                */
     1099    22168    4              CALL DSC_DEV_FINAL;
     1100    22169    4              END;
     1101    22170    3   END VDH_SPECIFIC;
     1102    22171
     1103    22172        /**/
     1104    22173
     1105    22174        /*  This internal procedure is called whether or not VDH
     1106    22175            has to be entered */
     1107    22176
     1108    22177    2   RLS_BUFFER:PROC;
     1109    22178        /**/
     1110    22179    3   DCL I SBIN;
     1111    22180    3   DCL T$ PTR;
     1112    22181        /**/
     1113    22182    3           IF KZ$OTPBFR.FLAGS.CNT# THEN
     1114    22183    3              KZ$HIPDEV.OTPBYTES=KZ$HIPDEV.OTPBYTES-KZ$OTPBFR.DATA_SIZ;
     1115    22184    3           IF KZ$HIPDEV.OTPBYTES~=0 AND KZ$HIPDEV.OTPHD$=ADDR(NIL) AND
     1116    22185    4             NOT KZ$HIPDEV.OTPBSY AND KZ$HIPDEV.DFRHD$=ADDR(NIL) THEN DO;
     1117    22186    4              CALL ERRLOG(%E$THRERR);
     1118    22187    4              KZ$HIPDEV.OTPBYTES=0;
     1119    22188    4              END;
     1120    22189    3           T$=BFR$;
     1121    22190    3           I=KZ_HIP_BFRSIZ(KZ$OTPBFR.BFRSIZ);
     1122    22191    3           KZ@HIPSTT.OTPBFRSIZ(KZ$OTPBFR.BFRSIZ)=
     1123    22192    3             KZ@HIPSTT.OTPBFRSIZ(KZ$OTPBFR.BFRSIZ)-1;
     1124    22193    3           KZ@HIPSTT.KHSTT.OTPBFRBYTUTL = KZ@HIPSTT.KHSTT.OTPBFRBYTUTL - I*2;
     1125    22194    4           IF KZ$OTPBFR.CMPCOD=0 THEN DO;
     1126    22195    4              KZ@HIPSTT.CHROUT=KZ@HIPSTT.CHROUT+KZ$OTPBFR.DATA_SIZ;
     1127    22196    4              KZ@HIPSTT.BLKOUT=KZ@HIPSTT.BLKOUT+1;
     1128    22197    4              END;
     1129    22198                %DISABLE(INHLVL=KH_INHLVL);
     1130    22202    3           CALL KVB$RLSSYS(I,T$);
     1131    22203                %ENABLE(INHLVL=KH_INHLVL);
     1132    22209    3   END RLS_BUFFER;
     1133    22210
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:45   
     1134    22211
     1135    22212
     1136    22213        /* Finally, the code that does the actual work:
     1137    22214        */
     1138    22215    2           IF (KZ$OTPBFR.MRKCNT~=0)
     1139    22216    2             OR (KZ$HIPDEV.THROTL)
     1140    22217    2             OR (KZ$HIPDEV.DSC)
     1141    22218    2             OR (KZ$HIPDEV.DONE AND (KZ$HIPDEV.OTPCNT<=1))
     1142    22219    2             OR (VDH_FLG=1) THEN
     1143    22220    3           DO;
     1144    22221    3              CALL VDH_SPECIFIC ALTRET(DEFERRED_BUFFER);
     1145    22222    3              CALL EXIT_VDH(KZ$HIPDEV.VDI$);
     1146    22223    3              END;
     1147    22224    2           ELSE
     1148    22225    3           DO;
     1149    22226    3              CALL RLS_BUFFER;
     1150    22227    3              END;
     1151    22228    2           RETURN /*  BUFFER RELEASED, NORMAL EXIT */;
     1152    22229    2   DEFERRED_BUFFER:;
     1153    22230        /**/
     1154    22231    2           ALTRETURN /* INDICATE VDH NEEDED, AND CANT ENTER VDH */;
     1155    22232        /**/
     1156    22233    2   END UNQRELOTPBFR;
     1157    22234
     1158    22235        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:46   
     1159    22236        /**/
     1160    22237        /**/
     1161    22238        /*       Hook the current device backup upon awaiting output queue
     1162    22239                 if it qualifies..  output queued, not halted, and not already
     1163    22240                 on the list
     1164    22241        */
     1165    22242        /**/
     1166    22243    1   REQUEUE: PROC ALTRET;
     1167    22244    2   DCL TDEV$ PTR;
     1168    22245    2   DCL TCNT SBIN;
     1169    22246        /**/
     1170    22247    2           IF(NOT KZ$HIPDEV.ONOTP)AND(KZ$HIPDEV.OTPCNT~=0)AND
     1171    22248    2             (NOT (KZ$HIPDEV.HLT AND (NOT KZ$HIPDEV.HLT.WACK))) THEN
     1172    22249    3           DO;
     1173    22250    3              TDEV$=KZ$LINCTX.OTPHD$;
     1174    22251    3              TCNT=KZ$LINCTX.OTPCNT;
     1175    22252
     1176    22253    4   DEBUGGING: DO WHILE((TDEV$~=ADDR(NIL)) AND (TCNT>0));
     1177    22254
     1178    22255    4                 IF TDEV$=DEV$ THEN EXIT DEBUGGING;
     1179    22256    4                 TDEV$=TDEV$->KZ$HIPDEV.OTPLNK$;
     1180    22257    4                 TCNT=TCNT-1;
     1181    22258    4                 END DEBUGGING;
     1182    22259
     1183    22260    3              IF (TDEV$~=ADDR(NIL)) OR (TCNT~=0) THEN
     1184    22261    3                 ALTRETURN;
     1185    22262    3              KZ$HIPDEV.OTPLNK$=ADDR(NIL);
     1186    22263    3              IF KZ$LINCTX.OTPCNT=0 THEN
     1187    22264    3                 KZ$LINCTX.OTPHD$=DEV$;
     1188    22265    3              ELSE
     1189    22266    3                 KZ$LINCTX.OTPTL$->KZ$HIPDEV.OTPLNK$=DEV$;
     1190    22267    3              KZ$LINCTX.OTPTL$=DEV$;
     1191    22268    3              KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT+1;
     1192    22269    3              KZ$HIPDEV.ONOTP='1'B;
     1193    22270    3              END;
     1194    22271        /**/
     1195    22272    2           RETURN;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:47   
     1196    22273
     1197    22274    2   END REQUEUE;
     1198    22275        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:48   
     1199    22276        /**/
     1200    22277        /* RLS_DEV - Release Device Context */
     1201    22278        /**/
     1202    22279    1   RLS_DEV: PROC;
     1203    22280
     1204    22281    2           IF KZ$HIPDEV.VDI$~=ADDR(NIL) THEN
     1205    22282    2              RETURN;
     1206    22283    3           IF KZ$HIPDEV.REACT THEN DO;
     1207    22284    3              KZ$HIPDEV.REACT='0'B;
     1208    22285    3              KZ$HIPDEV.ACTIVE='1'B;
     1209    22286    3              END;
     1210    22287    3           IF KZ$LINCTX.FLAGS.DSC THEN DO;
     1211    22288    4              DO CASE (KZ$LINCTX.DSC_LEV);
     1212    22289    4               CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                            */
     1213    22290    4                 CALL REALLY_CLR_DEV;
     1214    22291    4               CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                   */
     1215    22292    4                 CALL CLR_DEV;
     1216    22293    4                 KZ$HIPDEV.CLRD='1'B;
     1217    22294    4               CASE (%TERMINAL_ID_LEV_SUBSUBCHAN#); /* Device                    */
     1218    22295    4                 CALL CLR_DEV;
     1219    22296    4                 KZ$LINCTX.FLAGS.DSC='0'B;
     1220    22297    4                 RETURN;
     1221    22298    4               END;
     1222    22299    3              END;
     1223    22300    3           ELSE DO;
     1224    22301    3              CALL CLR_DEV;
     1225    22302    3              RETURN;
     1226    22303    3              END;
     1227    22304    2           DEV$=KZ$HIPCTR.DEVHD$;
     1228    22305    3           DO WHILE (DEV$~=ADDR(NIL));
     1229    22306    3              IF KZ$HIPDEV.CLRD = '0'B THEN RETURN;
     1230    22307    3              DEV$=KZ$HIPDEV.LNK$;
     1231    22308    3              END;
     1232    22309    2           CALL RLS_CTR;
     1233    22310    2   END RLS_DEV;
     1234    22311
     1235    22312        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:49   
     1236    22313        /**/
     1237    22314        /* RLS_CTR - Release controller context */
     1238    22315        /**/
     1239    22316
     1240    22317    1   RLS_CTR: PROC;
     1241    22318    3           DO CASE (KZ$LINCTX.DSC_LEV);
     1242    22319    3            CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                               */
     1243    22320    3              CALL REALLY_CLR_CTR;
     1244    22321    3            CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                      */
     1245    22322    3              CALL CLR_CTR;
     1246    22323    3              DEV$=KZ$HIPCTR.DEVHD$;
     1247    22324    4              DO WHILE (DEV$~=ADDR(NIL));
     1248    22325    4                 KZ$HIPDEV.CLRD = '0'B;
     1249    22326    4                 DEV$=KZ$HIPDEV.LNK$;
     1250    22327    4                 END;
     1251    22328    3              KZ$LINCTX.FLAGS.DSC='0'B;
     1252    22329    3              RETURN;
     1253    22330    3            END;
     1254    22331    2           IF KZ$LINCTX.CTRHD$=ADDR(NIL) THEN CALL RLS_LINE;
     1255    22332    2   END RLS_CTR;
     1256    22333
     1257    22334        /* RLS_LINE - Release line context */
     1258    22335
     1259    22336    1   RLS_LINE: PROC;
     1260    22337    3           DO CASE (KZ$LINCTX.DSC_LEV);
     1261    22338    3            CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                               */
     1262    22339    3              CALL REALLY_CLR_LINE;
     1263    22340    3            END;
     1264    22341    2   END RLS_LINE;
     1265    22342        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:50   
     1266    22343    1   CLR_DEV: PROC;
     1267    22344    2           KZ$HIPDEV.AWAIT_ENABLE='0'B;
     1268    22345    2           KZ$HIPDEV.THROTL='0'B;
     1269    22346    2           KZ$HIPDEV.OTPBSY='0'B;
     1270    22347    2           KZ$HIPDEV.HLT='0'B;
     1271    22348                /*  OTPBYTES is not reset here:  there still may be some
     1272    22349                    output on the DFR queue.  */
     1273    22350    2           KZ$HIPDEV.DSC='0'B;
     1274    22351    2           KZ$HIPDEV.KBDLCK='1'B;
     1275    22352    2           KZ$HIPDEV.DSC_LATER='0'B;
     1276    22353        /*      KZ$HIPDEV.MUST_SBA='0'B;*/
     1277    22354        /*      KZ$HIPDEV.PRINTER_DOWNS=0;*/
     1278    22355        /*      KZ$HIPCTR.PRINTER_CNC_DONE='0'B;*/
     1279    22356    2           CALL SET_PRO;
     1280    22357    2           IF KZ$HIPDEV.ACTIVE THEN
     1281    22358    2              CALL CNC_DEV;
     1282    22359    2   END;
     1283    22360
     1284    22361    1   CLR_CTR: PROC;
     1285    22362    2           KZ$HIPCTR.TIMED_OUT_ONCE='0'B;
     1286    22363        /*      KZ$HIPCTR.PRINTER_CNC_DONE='0'B;*/
     1287    22364    2   END;
     1288    22365
     1289    22366    1   REALLY_CLR_DEV: PROC;
     1290    22367    2           T$=KZ$HIPCTR.DEVHD$;
     1291    22368    2           P1$=ADDR(NIL);
     1292    22369    3           DO WHILE(T$~=DEV$);
     1293    22370    3              P1$=T$;
     1294    22371    3              T$=T$->KZ$HIPDEV.LNK$;
     1295    22372    3              END;
     1296    22373    2           IF P1$=ADDR(NIL) THEN
     1297    22374    2              KZ$HIPCTR.DEVHD$=KZ$HIPDEV.LNK$;
     1298    22375    2           ELSE
     1299    22376    2              P1$->KZ$HIPDEV.LNK$=KZ$HIPDEV.LNK$;
     1300    22377    2           KZ$LINCTX.OTPDEV$ = ADDR(NIL);
     1301    22378    2           KZ$LINCTX.OTPHD$ = ADDR(NIL);
     1302    22379                %DISABLE(INHLVL=KH_INHLVL);
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:51   
     1303    22383    2           CALL KVB$RLSSYS(SIZEW(KZ$HIPDEV),T$);
     1304    22384                %ENABLE(INHLVL=KH_INHLVL);
     1305    22390    2           KZ@HIPSTT.KHSTT.CTXBYTUTL = KZ@HIPSTT.KHSTT.CTXBYTUTL - SIZEC(KZ$HIPDEV);
     1306    22391    2   END;
     1307    22392
     1308    22393    1   REALLY_CLR_CTR: PROC;
     1309    22394    2           T$=KZ$LINCTX.CTRHD$;
     1310    22395    2           P1$=ADDR(NIL);
     1311    22396    3           DO WHILE(T$~=CTR$);
     1312    22397    3              P1$=T$;
     1313    22398    3              T$=T$->KZ$HIPCTR.LNK$;
     1314    22399    3              END;
     1315    22400    2           IF P1$=ADDR(NIL) THEN
     1316    22401    2              KZ$LINCTX.CTRHD$=KZ$HIPCTR.LNK$;
     1317    22402    2           ELSE
     1318    22403    2              P1$->KZ$HIPCTR.LNK$=KZ$HIPCTR.LNK$;
     1319    22404                %DISABLE(INHLVL=KH_INHLVL);
     1320    22408    2           CALL KVB$RLSSYS(SIZEW(KZ$HIPCTR),T$);
     1321    22409                %ENABLE(INHLVL=KH_INHLVL);
     1322    22415    2           KZ@HIPSTT.KHSTT.CTXBYTUTL = KZ@HIPSTT.KHSTT.CTXBYTUTL - SIZEC(KZ$HIPCTR);
     1323    22416    2   END;
     1324    22417
     1325    22418    1   REALLY_CLR_LINE: PROC;
     1326    22419    3           IF KZ$LINCTX.CTRLST$~=ADDR(NIL) THEN DO;
     1327    22420                   %DISABLE(INHLVL=KH_INHLVL);
     1328    22424    3              CALL KVB$RLSSYS
     1329    22425    3                (((KZ$LINCTX.POLSIZ*6)+5)/2,KZ$LINCTX.CTRLST$);
     1330    22426                   %ENABLE(INHLVL=KH_INHLVL);
     1331    22432    3              KZ$LINCTX.CTRLST$=ADDR(NIL);
     1332    22433    3              END;
     1333    22434    2           KZ$CLMEVENT=KZ_CLMEVENT;
     1334    22435    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_LINDSC;
     1335    22436    2           KZ$CLMEVENT.TERMID$=ADDR(KZ$LINCTX.CHN$->KH$CHN.TERMID);
     1336    22437    2           KZ$CLMEVENT.LINCTX$=LIN$;
     1337    22438                %DISABLE(INHLVL=KH_INHLVL);
     1338    22442    2           CALL KZT_CNCDSC@(KZ$CLMEVENT);
     1339    22443                %ENABLE(INHLVL=KH_INHLVL);
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:52   
     1340    22449    2   END;
     1341    22450        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:53   
     1342    22451        /**/
     1343    22452        /* Disconnect a device */
     1344    22453        /**/
     1345    22454    1   DSC_DEV: PROC(RSN);
     1346    22455    2   DCL RSN UBIN;
     1347    22456    2   DCL DEV1$ PTR;
     1348    22457    2   DCL DEV2$ PTR;
     1349    22458
     1350    22459    3           IF NOT KZ$HIPDEV.ACTIVE AND KZ$HIPDEV.OTPHD$~=ADDR(NIL) THEN DO;
     1351    22460    3              IF KZ$HIPDEV.DFRTL$~=ADDR(NIL) THEN
     1352    22461    3                 KZ$HIPDEV.DFRTL$->KZ$OTPBFR.LNK$=KZ$HIPDEV.OTPHD$;
     1353    22462    3              ELSE
     1354    22463    3                 KZ$HIPDEV.DFRHD$=KZ$HIPDEV.OTPHD$;
     1355    22464    3              KZ$HIPDEV.DFRTL$=KZ$HIPDEV.OTPHD$;
     1356    22465    3              KZ$HIPDEV.OTPHD$=ADDR(NIL);
     1357    22466    3              KZ$HIPDEV.OTPTL$=ADDR(NIL);
     1358    22467    3              KZ$HIPDEV.OTPCNT=0;
     1359    22468    3              KZ$HIPDEV.OTPBSY='0'B;
     1360    22469    3              IF KZ$HIPDEV.ONOTP THEN
     1361    22470    4   UNLINK_DEV_FROM_OUTPUT:DO;
     1362    22471    4                 KZ$HIPDEV.ONOTP='0'B;
     1363    22472    4                 DEV1$=KZ$LINCTX.OTPHD$;
     1364    22473    4                 IF DEV1$=DEV$ THEN
     1365    22474    5                 DO;
     1366    22475    5                    KZ$LINCTX.OTPHD$=KZ$HIPDEV.OTPLNK$;
     1367    22476    5                    KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT-1;
     1368    22477    5                    IF KZ$LINCTX.OTPCNT=0 THEN KZ$LINCTX.OTPTL$=ADDR(NIL);
     1369    22478    5                    END;
     1370    22479    4                 ELSE
     1371    22480    5                 DO WHILE(DEV1$~=ADDR(NIL));
     1372    22481    5                    DEV2$=DEV1$->KZ$HIPDEV.OTPLNK$;
     1373    22482    5                    IF DEV2$=DEV$ THEN
     1374    22483    6                    DO;
     1375    22484    6                       DEV1$->KZ$HIPDEV.OTPLNK$=DEV2$->KZ$HIPDEV.OTPLNK$;
     1376    22485    6                       KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT-1;
     1377    22486    6                       IF DEV1$->KZ$HIPDEV.OTPLNK$=ADDR(NIL) THEN KZ$LINCTX.OTPTL$=
             22486                                DEV1$;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:54   
     1378    22487    6                       DEV1$=ADDR(NIL);
     1379    22488    6                       END;
     1380    22489    5                    ELSE
     1381    22490    5                       DEV1$=DEV2$;
     1382    22491    5                    END /* WHILE */;
     1383    22492    4                 END UNLINK_DEV_FROM_OUTPUT;
     1384    22493    3              END;
     1385    22494        /**/
     1386    22495    3           IF KZ$HIPDEV.HLT THEN DO;
     1387    22496    3              KZ$HIPDEV.HLT='0'B;
     1388    22497    3              IF KZ$HIPDEV.OTPHD$~=ADDR(NIL) THEN
     1389    22498    3                 CALL REQUEUE;
     1390    22499    3              END;
     1391    22500        /**/
     1392    22501    2           CALL DEL_DFRD;   /* Make sure there is no defered process waiting.    */
     1393    22502
     1394    22503    2           IF KZ$HIPDEV.VDI$=ADDR(NIL) THEN
     1395    22504    2              RETURN;                      /* Nothing to disconnect              */
     1396    22505        /**/
     1397    22506    2           CALL ENTER_VDH(KZ$HIPDEV.VDI$, DFRD);
     1398    22507    2           KZ$HIPDEV.DSC.INT='1'B;         /* Disconnect initiated               */
     1399    22508    3           IF DFRD~='1'B THEN DO;          /* NOT DFRD                           */
     1400    22509    3   TELL_VDH:  KZ$HIPDEV.DSC.TOLD_VDH='1'B;
     1401    22510    3              IF NOT KZ$HIPDEV.ACTIVE THEN
     1402    22511    4              DO;
     1403    22512    4                 CALL DEL_DFRD;            /* Delete defered processing          */
     1404    22513    4                 END;
     1405    22514    3              KV$VDH_DSC=KV_VDH_DSC;
     1406    22515    3              KV$VDH_DSC.RSN=RSN;
     1407    22516    3              KV$VDH_DSC.NO_IO=~ KZ$HIPDEV.ACTIVE;
     1408    22517    3              KV$VDH_DSC.ALLSSN='1'B;
     1409    22518    3              CALL KVV$VDI(KV$VDH_DSC);
     1410    22519    3              CALL EXIT_VDH(KZ$HIPDEV.VDI$);
     1411    22520    3              END;
     1412    22521    2           ELSE
     1413    22522    2              KZ$HIPDEV.DFR.DSCI='1'B;     /* Do it later                        */
     1414    22523        /**/
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:55   
     1415    22524    2           RETURN;
     1416    22525
     1417    22526    2   DSC_DEV_CONT: ENTRY(RSN);
     1418    22527
     1419    22528    3           IF KZ$HIPDEV.DFR.DSCI THEN DO;
     1420    22529    3              KZ$HIPDEV.DFR.DSCI='0'B;
     1421    22530    3              CALL ENTER_VDH(KZ$HIPDEV.VDI$,DFRD);
             22530                       /* Already in VDH - make EXIT do nothing */
     1422    22531    3              GOTO TELL_VDH;
     1423    22532    3              END;
     1424    22533    2           RETURN;
     1425    22534        /**/
     1426    22535    2   END DSC_DEV;
     1427    22536        /**/
     1428    22537    1   DSC_DEV_FINAL: PROC;
     1429    22538
     1430    22539    2   DSC_FINAL:
     1431    22540    2           KZ$CLMEVENT=KZ_CLMEVENT;
     1432    22541    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_DEVDSC;
     1433    22542    2           KZ$CLMEVENT.TERMID$=ADDR(KZ$HIPDEV.CHN$->KH$CHN.TERMID);
     1434    22543    2           KZ$CLMEVENT.LINCTX$=LIN$;
     1435    22544                %DISABLE(INHLVL=KH_INHLVL);
     1436    22548    2           CALL KZT_CNCDSC@(KZ$CLMEVENT);
     1437    22549                %ENABLE(INHLVL=KH_INHLVL);
     1438    22555    2           KZ$HIPDEV.DSC.VDH_FINAL='0'B;
     1439    22556    2           KZ$HIPDEV.DSC.DEV_FINAL='0'B;
     1440    22557    2           KV$VDH_EVT=KV_VDH_EVT;
     1441    22558    2           KV$VDH_EVT.ID=%KV_VDH_EVT_ID_RLSVDI;
     1442    22559    2           CALL KVV$VDI(KV$VDH_EVT);
     1443    22560    2           RETURN;
     1444    22561
     1445    22562    2   END DSC_DEV_FINAL;
     1446    22563
     1447    22564        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:56   
     1448    22565        /**/
     1449    22566        /*
     1450    22567              Delete any output or input buffers sitting in the defered chain.
     1451    22568        */
     1452    22569    1   DEL_DFRD:PROC ALTRET;
     1453    22570        /*  Delete all defered buffers on the chain, or ALTRET
     1454    22571            if a buffer is to be deleted that needs VDH and VDH cant be
     1455    22572            entered.
     1456    22573        */
     1457    22574
     1458    22575    3           DO WHILE(KZ$HIPDEV.DFRHD$~=ADDR(NIL));
     1459    22576    3              BFR$=KZ$HIPDEV.DFRHD$;
     1460    22577    3              KZ$HIPDEV.DFRHD$=KZ$OTPBFR.LNK$;
     1461    22578    3              IF KZ$HIPDEV.DFRHD$=ADDR(NIL) THEN
     1462    22579    3                 KZ$HIPDEV.DFRTL$=ADDR(NIL);
     1463    22580    4              DO CASE(KZ$OTPBFR.TYP);
     1464    22581    4               CASE(%KZ#BFRTYP_OTP);
     1465    22582    4                 KZ$OTPBFR.CMPCOD=%KV_CMPCOD_DVCERR;
     1466    22583    4                 CALL RELOTPBFR ALTRET(NOT_RELEASED);
     1467    22584    4               CASE(%KZ#BFRTYP_INP);
     1468    22585    4                 T$=KZ$INPBFR.DATA$;
     1469    22586                      %DISABLE(INHLVL=KH_INHLVL);
     1470    22590    4                 CALL KVB$RLSSYS(KZ$INPBFR.BFR_SIZ,T$);
     1471    22591    4                 T$=BFR$;
     1472    22592    4                 CALL KVB$RLSSYS(SIZEW(KZ$INPBFR),T$);
     1473    22593                      %ENABLE(INHLVL=KH_INHLVL);
     1474    22599    4               END;
     1475    22600    3              END;
     1476    22601    2           RETURN;
     1477    22602    2   NOT_RELEASED:
     1478    22603    2           ALTRETURN /*  INDICATE NO RELEASE YET  */;
     1479    22604    2   END DEL_DFRD;
     1480    22605        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:57   
     1481    22606        /**/
     1482    22607        /**/
     1483    22608        /* Connect a device to VDH */
     1484    22609        /**/
     1485    22610    1   CNC_DEV: PROC ALTRET;
     1486    22611
     1487    22612    2           IF KZ$HIPDEV.VDI$~=ADDR(NIL) THEN
     1488    22613    2              RETURN;                      /* Already have someone going here    */
     1489    22614
     1490    22615    2           KZ$CLMEVENT=KZ_CLMEVENT;
     1491    22616    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_CNCRQS;
     1492    22617    2           KZ$CLMEVENT.CHN$=KZ$HIPDEV.CHN$;
     1493    22618    2           KZ$CLMEVENT.LINCTX$=LIN$;
     1494    22619                %DISABLE(INHLVL=KH_INHLVL);
     1495    22623    2           CALL KZT_CNCDSC@(KZ$CLMEVENT)
     1496    22624    2           WHENALTRETURN
     1497    22625    3           DO;
     1498    22626                   %ENABLE(INHLVL=KH_INHLVL);
     1499    22632    3              KZ$HIPDEV.AWAIT_ENABLE='1'B;
     1500    22633    3              RETURN;
     1501    22634    3              END;
     1502    22635    2           KZ$CLMEVENT=KZ_CLMEVENT;
     1503    22636    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_SUBCNC;
     1504    22637    2           KZ$CLMEVENT.TERMID$=ADDR(KZ$HIPDEV.CHN$->KH$CHN.TERMID);
     1505    22638    2           KZ$CLMEVENT.LINCTX$=LIN$;
     1506    22639    2           CALL KZT_CNCDSC@(KZ$CLMEVENT);
     1507    22640                %ENABLE(INHLVL=KH_INHLVL);
     1508    22646    2           KZ$HIPDEV.AWAIT_ENABLE='0'B;
     1509    22647        /**/
     1510    22648    2           KV$VDH_INT=KV_VDH_INT;
     1511    22649    2           KV$VDH_INT.CHN$=KZ$HIPDEV.CHN$;
     1512    22650    2           KV$VDH_INT.USRCTX$=DEV$;
     1513    22651    2           KV$VDH_INT.USRPRM$=KZH_USRPRM$;
     1514    22652    2           KV$VDH_INT.RCVFLWCTRMAXCRD=KZH_THRTL_INIT;
     1515    22653        /**/
     1516    22654    2           VDH_FLG=0;
     1517    22655    2           CALL ENTER_VDH(ADDR(NIL), DFRD);
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:58   
     1518    22656    2           CALL KVV$INT(KV$VDH_INT)
     1519    22657    2           WHENALTRETURN
     1520    22658    3           DO;
     1521    22659    3              CALL EXIT_VDH(ADDR(NIL));
     1522    22660    3              RETURN;
     1523    22661    3              END;
     1524    22662        /**/
     1525    22663        /*      IF KV$VDH_INT.ABR THEN
     1526    22664                   RETURN;     */
     1527    22665        /**/
     1528    22666    2           P1$=KV$VDH_INT.VDI$;            /* Save VDI$                          */
     1529    22667        /**/
     1530    22668    2           KV$VDH_CNC=KV_VDH_CNC;
     1531    22669        /**/
     1532    22670        /*      KV$VDH_CNC.VDI$=P1$;  */
     1533    22671    3           DO SELECT(KZ$HIPCTR.TYP);
     1534    22672    3              SELECT(7700);
     1535    22673    4              IF KH_PROFILE_ ~=VECTOR(NIL) THEN DO;
     1536    22674    4                 KV$VDH_CNC.PRF_.ADR$=ADDR(KH_PROFILE_)->BVECTOR.ADR$;
     1537    22675    4                 KV$VDH_CNC.PRF_.BYTSIZ=ADDR(KH_PROFILE_)->BVECTOR.BOUND+1;
     1538    22676    4                 END;
     1539    22677    4              ELSE DO;
     1540    22678    4                 KV$VDH_CNC.PRF_.ADR$=ADDR(PRO_ATTR);
     1541    22679    4                 KV$VDH_CNC.PRF_.BYTSIZ=(SIZEC(VLP_TRMATTR)+SIZEC(VLP_TRMCTL)+4);
     1542    22680    4                 END;
     1543    22681    3              SELECT(7804);
     1544    22682    3              KV$VDH_CNC.PRF_.ADR$=ADDR(KH_PROFILE_)->BVECTOR.ADR$;
     1545    22683    3              KV$VDH_CNC.PRF_.BYTSIZ=ADDR(KH_PROFILE_)->BVECTOR.BOUND+1;
     1546    22684    3              END;
     1547    22685    2           %KV_VDI.VDHEVTENB(%KV_VDH_EVT_ID_CMPOTP)='1'B;
     1548    22686    2           %KV_VDI.VDHEVTENB(%KV_VDH_EVT_ID_RQSOTP)='1'B;
     1549    22687    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_DLTOTP)='1'B;
     1550    22688    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_DSC)='1'B;
     1551    22689    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_HLTOTP)='1'B;
     1552    22690    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_LGNACP)='1'B;
     1553    22691    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_LGNRJC)='1'B;
     1554    22692    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_RLSSTR)='1'B;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:59   
     1555    22693    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_RLSVDI)='1'B;
     1556    22694    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_SCH)='1'B;
     1557    22695    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_VDHEXT)='1'B;
     1558    22696    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_ENDSETPRM)='1'B;
     1559    22697    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_INHDLTOTP)='1'B;
     1560    22698    2           KV$VDH_CNC.LINSPD=KZ$HIPDEV.CHN$->KH$CHN.LINSPD;
     1561    22699    2           KV$VDH_CNC.LCLENDPNTID=KZ$HIPDEV.CHN$->KH$CHN.TERMID;
     1562    22700    2           KV$VDH_CNC.LCLENDPNTID.TTYP=%KLTY_TTY#;
     1563    22701        /**/
     1564    22702    2           CALL KVV$VDI(KV$VDH_CNC) ALTRET(CNC_FAIL);
     1565    22703    2           KZ$HIPDEV.ACTIVE='1'B;
     1566    22704        /**/
     1567    22705    2           KZ$HIPDEV.VDI$=P1$;
     1568    22706        /**/
     1569    22707    2           %KV_VDI.USEOTPBFRTRN='0'B;
     1570    22708
     1571    22709        /*   let VDH do repeat characters,attributes,erase,position */
     1572    22710    2           %KV_MRD.CALUSR_OTPRPTCHR='0'B;
     1573    22711    2           %KV_MRD.CALUSR_SETATR='0'B;
     1574    22712    2           %KV_MRD.CALUSR_ERS='0'B;
     1575    22713    2           %KV_MRD.CALUSR_PST='0'B;
     1576    22714    2           %KV_MRD.ERD$ = ADDR(KV_ERD);
     1577    22715
     1578    22716    3           IF KZ$HIPDEV.PRINTER THEN DO;
     1579    22717    3              %KV_MRD.CTNFRM='1'B;         /* Continuous form                    */
     1580    22718    3              %KV_MRD.MINSP_FORPST=255;
     1581    22719    3              END;
     1582    22720    3           ELSE DO;                        /* Display                            */
     1583    22721    3              %KV_MRD.FSTERS='1'B;
     1584    22722    3              %KV_MRD.ATRRQRDSPPST='1'B;
     1585    22723    4              DO SELECT(KZ$HIPCTR.TYP);
     1586    22724    4                 SELECT(7700);
     1587    22725    4                 %KV_VDI.INPUNT=%KV_INPUNT_CHR;
     1588    22726    4                 %KV_MRD.ATRRQRDSPPST='1'B;
     1589    22727    4                 SELECT(7804,7814);
     1590    22728    4                 %KV_VDI.INPUNT=%KV_INPUNT_BLK;
     1591    22729    4                 %KV_MRD.ATRRQRDSPPST='0'B;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:60   
     1592    22730    4                 END /* SELECT ON CONTROLLER TYPE */;
     1593    22731    3              END;
     1594    22732        /**/
     1595    22733    2           CALL EXIT_VDH(ADDR(NIL));
     1596    22734    2           RETURN;
     1597    22735
     1598    22736    2   CNC_FAIL:
     1599    22737    2           KV$VDH_EVT=KV_VDH_EVT;
     1600    22738    2           KV$VDH_EVT.ID=%KV_VDH_EVT_ID_RLSVDI;
     1601    22739    2           CALL KVV$VDI(KV$VDH_EVT);
     1602    22740    2           CALL EXIT_VDH(ADDR(NIL));
     1603    22741    2           KZ$HIPDEV.REACT='1'B;
     1604    22742    2           RETURN;                         /* Connect failed                     */
     1605    22743    2   END CNC_DEV;
     1606    22744
     1607    22745        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:61   
     1608    22746
     1609    22747        /* ERRLOG */
     1610    22748
     1611    22749    1   ERRLOG: PROC(ERROR);
     1612    22750    2   DCL  ERROR UBIN;
     1613    22751        %FPT_WRSYSLOG (STCLASS="  ");
     1614    22846        %FPT_WRSYSLOG (FPTN=FPT@WRSYSLOG, STCLASS=CONSTANT, FCG="KZ", MID="V");
     1615    22941
     1616    22942
     1617    22943    2           FPT_WRSYSLOG=FPT@WRSYSLOG;
     1618    22944    2           FPT_WRSYSLOG.V.TERMID=KZ$LINCTX.LINID;
     1619    22945    2           FPT_WRSYSLOG.V.ERRCODE.ERR#=ERROR;
     1620    22946
     1621    22947    3           DO CASE (ERROR);
     1622    22948    3            CASE (%E$BADADR);
     1623    22949        /*E*  ERROR:       KZH-E$BADADR-3
     1624    22950              MESSAGE:     Undefined Controller/Device number in LINFCN request
     1625    22951              DESCRIPTION: A LINFCN code of DSCTRM, KILL, BLDCTX, ENABL, or POL
     1626    22952                           was received by the HIP device manager, but the controller/
     1627    22953                           device for which the service was requested is undefined.
     1628    22954
     1629    22955                           V0    - Channel number.
     1630    22956                           V1/V2 - Controller/Device number.
     1631    22957                           DATA  - Vector of the KZ$EVENT parameter.  */
     1632    22958
     1633    22959    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_SOFT#;
     1634    22960    3              FPT_WRSYSLOG.V.VALUES(0)=KZ$LINCTX.CHAN;
     1635    22961    3              FPT_WRSYSLOG.V.VALUES(1)=I;
     1636    22962    3              FPT_WRSYSLOG.V.VALUES(2)=J;
     1637    22963    3              FPT_WRSYSLOG.V.VALUES(3)=0;
     1638    22964        /***    FPT_WRSYSLOG.BUF_=VECTOR(KZ$EVENT);          *******/
     1639    22965
     1640    22966
     1641    22967    3            CASE (%E$THRERR);
     1642    22968        /*E*  ERROR:         KZH-E$THRERR-3
     1643    22969              MESSAGE:       Throttling is out of sync.
     1644    22970              DESCRIPTION:   A device's output byte count is non-zero, but no
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:62   
     1645    22971                             output is pending. (or in progress)
     1646    22972
     1647    22973                           V0    - Channel number
     1648    22974                           V1/V2 - Controller/Device numbers
     1649    22975                           V3    - Current Output Byte Count
     1650    22976        */
     1651    22977
     1652    22978    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_SOFT#;
     1653    22979
     1654    22980    4              IF DEV$=ADDR(NIL) OR CTR$=ADDR(NIL) THEN DO;
     1655    22981    4                 FPT_WRSYSLOG.V.VALUES(0)=0;
     1656    22982    4                 FPT_WRSYSLOG.V.VALUES(1)=31;
     1657    22983    4                 FPT_WRSYSLOG.V.VALUES(2)=31;
     1658    22984    4                 FPT_WRSYSLOG.V.VALUES(3)=0;
     1659    22985    4                 END;
     1660    22986    4              ELSE DO;
     1661    22987    4                 FPT_WRSYSLOG.V.VALUES(0)=KZ$HIPDEV.CTR$->KZ$HIPCTR.LIN$->
     1662    22988    4                   KZ$LINCTX.CHAN;
     1663    22989    4                 FPT_WRSYSLOG.V.VALUES(1)=KZ$HIPDEV.CTR$->KZ$HIPCTR.ADR;
     1664    22990    4                 FPT_WRSYSLOG.V.VALUES(2)=KZ$HIPDEV.ADR;
     1665    22991    4                 FPT_WRSYSLOG.V.VALUES(3)=KZ$HIPDEV.OTPBYTES;
     1666    22992    4                 END;
     1667    22993
     1668    22994    3            CASE (%E$NO_MEMORY);
     1669    22995        /*E* ERROR:        KZV-E$NO_MEMORY-6
     1670    22996             MESSAGE:      Insufficient BISYNC MEMory (a NETCON parameter).
     1671    22997             DESCRIPTION:  A KVB call ALTRETed to indicate that BISYNC is out of
     1672    22998                           MEMory.  Since a necessary I/O buffer or device context
     1673    22999                           could not be allocated, the HIP  LINE associated
     1674    23000                           with the request has been disconnected.
     1675    23001                           V0 = Channel number.
     1676    23002                           V1/V2 = Controller/Device numbers.
     1677    23003                           V3 = Size of buffer, in words, which could not be allocated.
     1678    23004        */
     1679    23005    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_LINE_ABORT#;
     1680    23006    3              FPT_WRSYSLOG.V.VALUES(0)=KZ$LINCTX.CHAN;
     1681    23007    4              IF DEV$ ~= ADDR (NIL) THEN DO;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:63   
     1682    23008    4                 FPT_WRSYSLOG.V.VALUES(1)=KZ$HIPDEV.CTR$->KZ$HIPCTR.ADR;
     1683    23009    4                 FPT_WRSYSLOG.V.VALUES(2)=KZ$HIPDEV.ADR;
     1684    23010    4                 END;
     1685    23011    3              FPT_WRSYSLOG.V.VALUES(3)=SZ;
     1686    23012    3            END;                           /*  END CASE                          */
     1687    23013    2           CALL KHA$ERRLOG(FPT_WRSYSLOG);
     1688    23014    2           RETURN;
     1689    23015
     1690    23016    2   END ERRLOG;
     1691    23017        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:64   
     1692    23018        /**/
     1693    23019        /**/
     1694    23020        /* ENTER_VDH - Try to enter VDH */
     1695    23021        /**/
     1696    23022
     1697    23023    1   ENTER_VDH: PROC(VDI$, DFRD);
     1698    23024
     1699    23025    2   DCL DFRD BIT(1) ALIGNED;
     1700    23026    2   DCL VDI$ PTR;
     1701    23027
     1702    23028    3           IF VDH_FLG~=0 THEN DO;
     1703    23029    3              VDH_FLG=VDH_FLG+1;
     1704    23030    3              DFRD='0'B;
     1705    23031    3              RETURN;
     1706    23032    3              END;
     1707    23033
     1708    23034    3           IF VDI$=ADDR(NIL) THEN DO;
     1709    23035                   %KV$USRENT(VDI$="ADDR(NIL)");
             23041    3              KV@USRENT.SVDPTR$ = KV$PTR$;
     1710    23061    3              END;
     1711    23062    3           ELSE DO;
     1712    23063                   %KV$USRENT(VDI$=KZ$HIPDEV.VDI$, DFR$=DFR, SCHRSN=%KV_SCHRSN_DFR1);
             23076    3           KZ$HIPDEV.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             23076                    KZ$HIPDEV.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;
             23077    4           IF NOT KZ$HIPDEV.VDI$->KV$VDI.BSY THEN DO;
             23078    4              KZ$HIPDEV.VDI$->KV$VDI.BSY = '1'B;
             23079    4              KV@USRENT.SVDPTR$ = KV$PTR$;
             23080    4              KV$PTR$ = KZ$HIPDEV.VDI$->KV$VDI.ASNINPPTR$;
             23081    4              END;                         /* ELSE IF ~BSY                       */
             23082    4           ELSE DO;
             23083    4              KZ$HIPDEV.VDI$->KV$VDI.DFR.USR(1) = '1'B;
             23084    4           KZ$HIPDEV.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             23084                    KZ$HIPDEV.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;
             23085    4              GOTO DFR;
             23086    4              END;                         /* END IF                             */
     1713    23089    3              END;
     1714    23090
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:65   
     1715    23091    2           VDH_FLG=1;
     1716    23092    2           DFRD='0'B;
     1717    23093    2           RETURN;
     1718    23094
     1719    23095    2   DFR:
     1720    23096    2           DFRD='1'B;
     1721    23097    2           RETURN;
     1722    23098
     1723    23099    2   END ENTER_VDH;
     1724    23100        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:66   
     1725    23101        /**/
     1726    23102        /**/
     1727    23103        /* EXIT_VDH - Exit VDH if it was entered */
     1728    23104        /**/
     1729    23105    1   EXIT_VDH: PROC(VDI$);
     1730    23106
     1731    23107    2   DCL VDI$ PTR;
     1732    23108
     1733    23109    2           IF VDH_FLG=0 THEN
     1734    23110    2              RETURN;
     1735    23111        /**/
     1736    23112    2           VDH_FLG=VDH_FLG-1;
     1737    23113    2           IF VDH_FLG~=0 THEN
     1738    23114    2              RETURN;
     1739    23115    3           IF VDI$=ADDR(NIL) THEN DO;
     1740    23116                   %KV$USREXT(VDI$="ADDR(NIL)");
             23124    3           KV$PTR$ = KV@USRENT.SVDPTR$;
     1741    23126    3              END;
     1742    23127    3           ELSE DO;
     1743    23128    3              KV$USR_EVT=KV_USR_EVT;
     1744    23129    3              KV$USR_EVT.ID=%KV_USR_EVT_ID_VDHEXT;
     1745    23130    3              CALL KZH$HIP(KV$USR_EVT);
     1746    23131                   %KV$USREXT;
             23137    3           KV$PTR.VDI$->KV$VDI.BSY = '0'B;
             23139    3           KV$PTR$ = KV@USRENT.SVDPTR$;
     1747    23141    3              END;
     1748    23142
     1749    23143        /**/
     1750    23144    2           RETURN;
     1751    23145
     1752    23146    2   END EXIT_VDH;
     1753    23147    1   GIVE_VDH_DATA: PROC;
     1754    23148        /*P* NAME: KV$VDH_DAT has been set up with pointer to data, bytx and bytsiz.
     1755    23149             Do some device specific stuff to data, then give to VDH.
     1756    23150
     1757    23151             Called from straight line path from SYNC line manager, or
     1758    23152             via VDH defered processing via KZH$HIP.
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:67   
     1759    23153        */
     1760    23154
     1761    23155    2           KZ$HIPDEV.VDI$->KV$VDI.UN_KNWPST='1'B;
             23155                    /* I've just lost position on the screen. Tell VDH */
     1762    23156    2           KZ$HIPDEV.VDI$->KV$VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_SKP;
     1763    23157    2           FC1FC2=SUBSTR(KV$VDH_DAT.DAT__.ADR$->BCHARS,KV$VDH_DAT.DAT__.BYTX-3,2);
             23157                    /* FC1 AND FC2 FROM LINK PROTOCOL */
     1764    23158
     1765    23159    3           DO SELECT(CTR$->KZ$HIPCTR.TYP);
     1766    23160    3              SELECT(7700);
     1767    23161        /*         IF KZ$HIPDEV.VDI$->KV$VDI.USRRQSDAT.RED   */
     1768    23162                                           /*   AND KV$PTR.INPCNDPND.TRN       THEN   */
     1769    23163    3              KV$VDH_DAT.DAT__.DATBYTSIZ=KV$VDH_DAT.DAT__.DATBYTSIZ+1;
     1770    23164    3              SELECT(ELSE);
     1771    23165    3           IF (FC1FC2='  ') AND (KZ$HIPDEV.ADR=0) THEN
     1772    23166    4           DO;
     1773    23167    4              IF %KV_MVD.ORG~=%KV#VD_ORG_FORM THEN
     1774    23168    5              DO;                          /*ELIMINATE TRAILING TAB CHARACTERS   */
     1775    23169    6                 DO WHILE((KV$VDH_DAT.DAT__.DATBYTSIZ>0) AND
     1776    23170    6                   SUBSTR(KV$VDH_DAT.DAT__.ADR$->BCHARS,KV$VDH_DAT.DAT__.BYTX+
             23170                            KV$VDH_DAT.DAT__.DATBYTSIZ-1,1)=%BINASC(128+9));
     1777    23171                                                /*  ODD PARITY TAB                    */
     1778    23172    6                    KV$VDH_DAT.DAT__.DATBYTSIZ=KV$VDH_DAT.DAT__.DATBYTSIZ-1;
     1779    23173    6                    END;
     1780    23174    5                 SUBSTR(KV$VDH_DAT.DAT__.ADR$->BCHARS,KV$VDH_DAT.DAT__.BYTX+
     1781    23175    5                   KV$VDH_DAT.DAT__.DATBYTSIZ,1)=
     1782    23176    5                   %BINASC(13);            /*  CARRIAGE RETURN                   */
     1783    23177    5                 END /* NOT FORMS PROGRAM  */;
     1784    23178    4              KV$VDH_DAT.DAT__.DATBYTSIZ=KV$VDH_DAT.DAT__.DATBYTSIZ+1;
     1785    23179    4              END /*  IF FC1FC2='  ' */;
     1786    23180    3              END /*  DO SELECT  */;
     1787    23181
     1788    23182    2           CALL KVV$VDI(KV$VDH_DAT);
     1789    23183    2           KZ$HIPDEV.VDI$->KV$VDI.UN_KNWPST='1'B;
             23183                    /* I've just lost position on the screen. Tell VDH */
     1790    23184    2           KZ$HIPDEV.VDI$->KV$VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_SKP;
     1791    23185    2   END GIVE_VDH_DATA;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:68   
     1792    23186
     1793    23187        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:69   
     1794    23188    1   KZH$DSC_LINE: ENTRY(PARM1) ALTRET;
     1795    23189    1           LIN$=ADDR(LINCTX);
     1796    23190    1           CALL DSC_LINE;
     1797    23191    1           RETURN;
     1798    23192        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:70   
     1799    23193    1   DSC_LINE: PROC;
     1800    23194
     1801    23195    2           KZ$CLMEVENT=KZ_CLMEVENT;
     1802    23196    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_KILLED;
     1803    23197    2           KZ$CLMEVENT.TERMID$=ADDR(KZ$LINCTX.CHN$->KH$CHN.TERMID);
     1804    23198    2           KZ$CLMEVENT.LINCTX$=LIN$;
     1805    23199    2           CALL KZT_CNCDSC@(KZ$CLMEVENT);
     1806    23200    2           RETURN;
     1807    23201
     1808    23202    2   END DSC_LINE;
     1809    23203    1   END KZH$HIPDV;
     1810    23204        %EOD;

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:71   
--  Include file information  --

   KL_SUPER_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   KZ$BSCSTT.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KHC_MAC_C.:E05TOU  is referenced.
   KZ$3270STT.:E05TOU  is referenced.
   KZ_HIPTAB_C.:E05TOU  is referenced.
   KZ_PERR_C.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KV$VDH.:E05TOU  is referenced.
   KZ_3270_C.:E05TOU  is referenced.
   KV$GLBCTX.:E05TOU  is referenced.
   KV$GLB.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV$USR.:E05TOU  is referenced.
   KZ_LIN_C.:E05TOU  is referenced.
   KZ_CLM_E.:E05TOU  is referenced.
   KZ_HIP_C.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   KZ$PROWRT.:E05TOU  is referenced.
   KZ$OTPBFR.:E05TOU  is referenced.
   KZ$INPBFR.:E05TOU  is referenced.
   KZ$HIPDEV.:E05TOU  is referenced.
   KZ$HIPCTR.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:72   
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure KZH$HIPDV.

   Procedure KZH$HIPDV requires 5089 words for executable code.
   Procedure KZH$HIPDV requires 177 words of local(AUTO) storage.

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:73   

 Object Unit name= KZH$HIPDV                                  File name= KZH$HIPDV.:E05TOU
 UTS= JUL 30 '97 02:51:56.16 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Data  even  none     9      9  KZH$HIPDV
    1  RoData even  UTS    299    12B  KZH$HIPDV
    2   Proc  even  none  5089   13E1  KZH$HIPDV
    3  RoData even  none     6      6  KZH$HIPDV

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        2  KZH$HIPDV
     2    648          yes     yes      Std        1  KZH$DFR
     2    6E4          yes     yes      Std        1  KZH$DSC
     2    702          yes     yes      Std        1  KZH$DSC_CONT
     2    720          yes     yes      Std        2  KZH$RELOTPBFR
     2    742          yes     yes      Std        1  KZH$RLSCTX
     2   13A9          yes     yes      Std        1  KZH$DSC_LINE
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:74   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KZH$HIP
 yes     yes           Std       2 KVB$GETSYS
         yes           Std       0 KHI$ENABLE
         yes           Std       1 KHI$DISABLE
 yes     yes           Std       2 KVB$RLSSYS
 yes     yes           Std       1 KVV$VDI
 yes     yes           Std       1 KZH$CMPOTP
 yes     yes           Std       1 KVV$INT
 yes     yes           Std       2 KHA$ERRLOG
                       nStd      0 X6A_AUTO_2
                       nStd      0 X6A_AALT
                       nStd      0 X6A_ARET
                       nStd      0 X6C_ALRZ

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KZ_VDHSTT$                            KZ_INPFNCTBLHED$                      KZ_ASC95
     KZH_USRPRM$                           KV$PTR$                               KZ_HIP_HDR
     KV_VDH_EVT_RQSOTP                     KH_INHLVL                             KZH_THRTL_INIT
     KH_PROFILE_                           KV_USR_EVT                            KV_VDH_CNC
     KV_VDH_DAT                            KV_VDH_DSC                            KV_VDH_EVT
     KV_VDH_INT                            KV_VDH_OTPMRK                         KZ_HIP_BFRSIZ
     KZT_CNCDSC@                      r    G$ROS$
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:75   


        1        1        /*M* KZH$HIPDV - Device manager for HIP devices */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* */
        8        8        /**/
        9        9        KZH$HIPDV: PROC(PARM1,PARM2) ALTRET;

      9   2 000000  D380 0000 0000  xent KZH$HIPDV       LNJ,B5   X6A_AUTO_2
          2 000003       00B1 0002                       DC       177,2

       10       10        /**/
       11       11        /**/
       12       12        /* Include Files */
       13       13        /**/
       14       14        %INCLUDE CP_6_SUBS;
       15      554        %INCLUDE LCP_6;
       16     4833        %INCLUDE KH$CHN;
       17     4955        %INCLUDE KZ$LINCTX;
       18     5575        %INCLUDE KZ$HIPCTR;
       19     5661        %INCLUDE KZ$HIPDEV;
       20     5928        %INCLUDE KZ$INPBFR;
       21     5988        %INCLUDE KZ$OTPBFR;
       22     6089        %INCLUDE KZ$PROWRT;
       23     6214        %INCLUDE KH$STT;
       24     6244        %INCLUDE KZ_HIP_C;
       25     6351        %INCLUDE KZ_CLM_E;
       26     6523        %INCLUDE KZ_LIN_C;
       27     6579        %INCLUDE KV$USR;
       28     6891        %INCLUDE KV_GLB_M;
       29     7013        %INCLUDE KV$GLB;
       30     7432        %INCLUDE KV$GLBCTX;
       31     7877        %INCLUDE KZ_3270_C;
       32     8035        %INCLUDE KV$VDH;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:76   
       33     8466        %INCLUDE KV_GLBCNS_E;
       34     8807        %INCLUDE KV_PRMID_E;
       35     8981        %INCLUDE KZ_PERR_C;
       36     9063        %INCLUDE KZ_HIPTAB_C;
       37     9305        %INCLUDE KZ$3270STT;
       38     9369        %INCLUDE KHC_MAC_C;
       39     9410        %INCLUDE KL_AFCN_C;
       40     9511        %INCLUDE K_ID_E;
       41     9561        %INCLUDE KZ$BSCSTT;
       42     9667        %INCLUDE KL_MACRO_C;
       43    13019        %INCLUDE KL_SUPER_C;
       44    15921
       45    15922
       46    15923        /**/
       47    15924        /* Parameters */
       48    15925        /**/
       49    15926    1   DCL FAKE UBIN;
       50    15927    1   DCL PARM1 CHAR(FAKE);
       51    15928            %KZ$EVENT(STCLASS=REDEF PARM1);
       52    16010            %KZ$HIPDEV(NAME=DEVCTX,STCLASS=REDEF PARM1);
       53    16191            %KZ$LINCTX(NAME=LINCTX,STCLASS=REDEF PARM1);
       54    16622
       55    16623    1   DCL PARM2 CHAR(FAKE);
       56    16624    1   DCL LINRSP REDEF PARM2 UBIN;
       57    16625    1   DCL LINSTAT REDEF PARM2 BIT(16) ALIGNED;
       58    16626    1   DCL OTPBFR$ REDEF PARM2 PTR;
       59    16627    1   DCL PSTAT REDEF PARM2 BIT(16) ALIGNED;
       60    16628    1   DCL PSTATU REDEF PARM2 UBIN;
       61    16629
       62    16630                                                /* EQUS                               */
       63    16631        %KV_PRMID_E;
       64    16787        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:77   
       65    16788        /**/
       66    16789        /* Auto */
       67    16790        /**/
       68    16791    1   DCL KZ_VDHSTT$ PTR SYMREF;
       69    16792    1   DCL LIN$ PTR;
       70    16793    1   DCL CTR$ PTR;
       71    16794    1   DCL DEV$ PTR;
       72    16795    1   DCL PTR$ PTR;
       73    16796    1   DCL T$ PTR;
       74    16797    1   DCL P1$ PTR;
       75    16798    1   DCL SZ UBIN;
       76    16799    1   DCL CNT UBIN;
       77    16800    1   DCL I REDEF CNT UBIN;
       78    16801    1   DCL J UBIN;
       79    16802    1   DCL ISBIN SBIN;
       80    16803    1   DCL K UBIN(5);
       81    16804    1   DCL LOGON_STRING_LENGTH SBIN;
       82    16805    1   DCL FC1FC2 CHAR(2);
       83    16806    1   DCL FC_CHARS(0:1) REDEF FC1FC2 CHAR(1);
       84    16807    1   DCL L UBIN;
       85    16808    1   DCL BFR$ PTR;
       86    16809    1   DCL TBFR$ PTR;
       87    16810    1   DCL STATUS BIT(16);
       88    16811    1   DCL STATUSW REDEF STATUS UBIN;
       89    16812    1   DCL 1 STATUSB REDEF STATUS,
       90    16813    1         2 I UBIN BYTE UNAL,
       91    16814    1         2 J UBIN BYTE UNAL;
       92    16815    1   DCL TCTR$ PTR;
       93    16816    1   DCL TDEV$ PTR;
       94    16817    1   DCL DFRD BIT(1);
       95    16818    1   DCL VDH_FLG UBIN;
       96    16819        %EQU ESC_CHAR=BITASC('1B'X);
       97    16820    1   DCL 1 HALT_MESSAGE STATIC,
       98    16821    1         2 HALT_MSG,
       99    16822    1           3 *  CHAR(0) INIT('(XMIT TO GO)'),
      100    16823    1           3 *(0:4) CHAR(1) INIT( %ESC_CHAR ,'T',' ', %ESC_CHAR ,'U'),
      101    16824    1         2 HLTMSG REDEF HALT_MSG CHAR(17);
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:78   
      102    16825        %KV$USR_EVT (STCLASS=);
      103    16860        %KV$VDH_CNC (STCLASS=);
      104    16952        %KV$VDH_DAT (STCLASS=);
      105    17032        %KV$VDH_DSC (STCLASS=);
      106    17068        %KV$VDH_EVT (STCLASS=);
      107    17103        %KV$VDH_INT (STCLASS=);
      108    17140        %KV$VDH_OTPMRK (STCLASS=);
      109    17202        %KV@USRENT;
      110    17222        %KV_INPOPRX_E;
      111    17234        %KV_VDH_EVT_ID_E;
      112    17240        %KV_CMPCOD_E;
      113    17254        %KV_PHSPSTMOD_E;
      114    17261        %KV_INPUNT_E;
      115    17266        %K#ENTID_E;
      116    17285        %KV$USRPRM;
      117    17336        %KV_DSCRSN_E;
      118    17345        %KV_USR_EVT_ID_E;
      119    17365        %INHIBIT_DCLS;
      120    17377        %KZ$EVENT(FPTN=KZ$CLMEVENT, STCLASS="  ");
      121    17459        %KZ$EVENT(FPTN=KZ_CLMEVENT, STCLASS=CONSTANT);
      122    17541        %KZ$3270STT(STCLASS="BASED(KZ_HIP_HDR.STTBFR$)", NAME=KZ@HIPSTT);
      123    17973        %KV#VD_ORG_E;
      124    17981        %KV_SCHRSN_E;
      125    17988        %KV$STT(STCLASS="BASED(KZ_VDHSTT$)");
      126    18382        %KV_STRTYP_E;
      127    18420
      128    18421        %KL_CONTROLLER;
      129    18570        %KL_LINEDEV;
      130    18719
      131    18720        /**/
      132    18721        /* Constant */
      133    18722        /**/
      134    18723    1   DCL POLADR_B(0:31) BIT(8) CONSTANT INIT(
      135    18724    1       '20'X,'21'X,'22'X,'23'X,'24'X,'25'X,'26'X,'27'X,
      136    18725    1       '28'X,'29'X,'2A'X,'2B'X,'2C'X,'2D'X,'2E'X,'2F'X,
      137    18726    1       '30'X,'31'X,'32'X,'33'X,'34'X,'35'X,'36'X,'37'X,
      138    18727    1       '38'X,'39'X,'3A'X,'3B'X,'3C'X,'3D'X,'3E'X,'3F'X);
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:79   
      139    18728    1   DCL POLADR(0:31) REDEF POLADR_B UBIN BYTE UNAL;
      140    18729        /**/
      141    18730    1   DCL SELADR_B(0:31) BIT(8) CONSTANT INIT(
      142    18731    1       '20'X,'21'X,'22'X,'23'X,'24'X,'25'X,'26'X,'27'X,
      143    18732    1       '28'X,'29'X,'2A'X,'2B'X,'2C'X,'2D'X,'2E'X,'2F'X,
      144    18733    1       '30'X,'31'X,'32'X,'33'X,'34'X,'35'X,'36'X,'37'X,
      145    18734    1       '38'X,'39'X,'3A'X,'3B'X,'3C'X,'3D'X,'3E'X,'3F'X);
      146    18735    1   DCL SELADR(0:31) REDEF SELADR_B UBIN BYTE UNAL;
      147    18736        %KZ$HIPCTR (NAME=KZ_HIPCTR,STCLASS=CONSTANT);
      148    18773        %KZ$HIPDEV (NAME=KZ_HIPDEV,STCLASS=CONSTANT);
      149    18954        %KZ$INPBFR (NAME=KZ_INPBFR,STCLASS=CONSTANT);
      150    18987
      151    18988    1   DCL 1 PRO_ATTR CONSTANT,
      152    18989    1         2 TYP UBIN BYTE UNAL INIT(%KV_PRMID_TRMATTR),
      153    18990    1         2 LNG UBIN BYTE UNAL INIT(SIZEC(VLP_TRMATTR));
      154    18991        %VLP_TRMATTR (STCLASS=CONSTANT,CURSORUP=YES,FCNTBL='CP5');
      155    19029    1   DCL 1 PRO_CTL CONSTANT,
      156    19030    1         2 TYP UBIN BYTE UNAL INIT(%KV_PRMID_TRMCTL),
      157    19031    1         2 LNG UBIN BYTE UNAL INIT(SIZEC(VLP_TRMCTL));
      158    19032        %VLP_TRMCTL (STCLASS=CONSTANT,RETYPOVR=YES,EDITOVR=YES,UPPERCASE=NO);
      159    19072        %KV$USRPRM_INT;
      160    19086        %KV$STREVTENB(STRTYP=KV_STRTYP_MRD);
      161    19091        %KV$STREVTENB(STRTYP=KV_STRTYP_VDI);
      162    19096        %KV$USRPRM(NAME=KZ_USRPRM, STCLASS=CONSTANT,
      163    19097                   USRSBR=KZH$HIP, TRNTBLHEDPTR$=KZ_TRNTBLHED$,
      164    19098                   INPFNCTBLHEDPTR$=KZ_INPFNCTBLHED$  );
      165    19149        %KV$ERD (NAME=KV_ERD,STCLASS=CONSTANT);
      166    19233
      167    19234    1   DCL KZ_TRNTBLHED$ PTR INIT(ADDR(KZ_ASC95)) CONSTANT;
      168    19235    1   DCL KZ_INPFNCTBLHED$ PTR SYMREF;
      169    19236    1   DCL KZ_ASC95 UBIN SYMREF;
      170    19237    1   DCL KZH_USRPRM$ PTR SYMREF;
      171    19238        /**/
      172    19239        %MACRO STAT(VAL='0'B,LOG(YES='1'B,NO='0'B)='0'B,CLR(YES='1'B,NO='0'B)='0'B,
      173    19240                    DWN(YES='1'B,NO='0'B)='0'B,ACT=0,LAST=",",
      174    19241                    NOINIT(YES=1,NO=0)=0);
      175    19242        %IF NOINIT=1;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:80   
      176    19243        %LSET INIT=CHARTEXT('/*');
      177    19244                2 X ALIGNED,
      178    19245                  %ELSE;
      179    19246        %LSET INIT=CHARTEXT('INIT');
      180    19247                  2 *,
      181    19248        %ENDIF;
      182    19249                  3 VAL# BIT(16) %INIT(VAL)%CHARTEXT('/**/'),
      183    19250                  3 LOG# BIT(1) %INIT(LOG)%CHARTEXT('/**/'),
      184    19251                  3 CLR# BIT(1) %INIT(CLR)%CHARTEXT('/**/'),
      185    19252                  3 DWN# BIT(1) %INIT(DWN)%CHARTEXT('/**/'),
      186    19253                  3 * BIT(5) %INIT('0'B)%CHARTEXT('/**/'),
      187    19254                  3 ACT# UBIN BYTE UNAL %INIT(ACT)%CHARTEXT('/**/') LAST
      188    19255        %SET Y#STATSIZ=Y#STATSIZ+1;
      189    19256        %MEND;
      190    19257        /**/
      191    19258        %SET Y#STATSIZ=0;
      192    19259        /**/
      193    19260        %EQU KZ#STAT_DE=1;                      /* Device-end                         */
      194    19261        %EQU KZ#STAT_DSC=2;                     /* Disconnect                         */
      195    19262        %EQU KZ#STAT_RETRY=3;                   /* Retry                              */
      196    19263        %EQU KZ#STAT_CONT=4;                    /* Continue                           */
      197    19264        %EQU KZ#STAT_PAPER=5;                   /* Out of paper                       */
      198    19265    1   DCL 1 STAT_ CONSTANT,
      199    19266        %STAT(VAL='0000'X,ACT=%KZ#STAT_DSC,LOG=YES,DWN=YES);
      200    19282        %STAT(VAL='0200'X,ACT=%KZ#STAT_DE);
      201    19298        %STAT(VAL='0010'X,ACT=%KZ#STAT_DSC,DWN=YES);
      202    19314        %STAT(VAL='0210'X,ACT=%KZ#STAT_PAPER);
      203    19330        %STAT(VAL='0002'X,ACT=%KZ#STAT_DSC,DWN=YES,LOG=YES);
      204    19346        %STAT(VAL='0004'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
      205    19362        %STAT(VAL='0008'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
      206    19378        %STAT(VAL='000C'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
      207    19394        %STAT(VAL='040C'X,ACT=%KZ#STAT_CONT,LOG=YES);
      208    19410        %STAT(VAL='0618'X,ACT=%KZ#STAT_DSC,LOG=YES,DWN=YES);
      209    19426        %STAT(VAL='0418'X,ACT=%KZ#STAT_DSC,LOG=YES,DWN=YES);
      210    19442        %STAT(VAL='0604'X,ACT=%KZ#STAT_CONT,LOG=YES);
      211    19458        %STAT(VAL='0404'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
      212    19474        %STAT(VAL='0204'X,ACT=%KZ#STAT_RETRY,LOG=YES,CLR=YES);
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:81   
      213    19490        %STAT(VAL='0001'X,ACT=%KZ#STAT_RETRY,LOG=YES);
      214    19506        %STAT(VAL='0020'X,ACT=%KZ#STAT_CONT,LOG=YES);
      215    19522        %STAT(VAL='0100'X,ACT=%KZ#STAT_CONT,LOG=YES);
      216    19538        %STAT(VAL='0C00'X,ACT=%KZ#STAT_CONT,LOG=YES);
      217    19554        %STAT(VAL='0E00'X,ACT=%KZ#STAT_CONT,LOG=YES);
      218    19570        %STAT(VAL='0208'X,ACT=%KZ#STAT_CONT,LOG=YES);
      219    19586        %STAT(VAL='0218'X,ACT=%KZ#STAT_DSC,LOG=YES,DWN=YES,LAST=";");
      220    19602    1   DCL 1 STAT(0:%(Y#STATSIZ-1)) REDEF STAT_,
      221    19603        %STAT(LAST=";",NOINIT=YES);
      222    19619
      223    19620
      224    19621        /**/
      225    19622        /* Based Structures */
      226    19623        /**/
      227    19624        %KH$CHN;
      228    19748        %KZ$LINCTX (STCLASS="BASED(LIN$)");
      229    20179        %KZ$HIPCTR (STCLASS="BASED(CTR$)");
      230    20216        %KZ$POLLHIP;                            /*  FOUND IN KZ$HIPCTR INCLUDE FILE   */
      231    20226        %KZ$INPDESC;                            /*  FOUND IN KZ$HIPCTR INCLUDE FILE   */
      232    20231        %KZ$HIPDEV (STCLASS="BASED(DEV$)");
      233    20412        %KZ$INPBFR (STCLASS="BASED(BFR$)");
      234    20445        %KZ$OTPBFR (STCLASS="BASED(BFR$)");
      235    20510        %KZ$CTRLR (STCLASS="BASED(PTR$)");
      236    20534        %KZ$3270DV (STCLASS="BASED(TBFR$)");
      237    20558        %SET GV@INPFNCTBL_NUL=0;
      238    20559        %KV$MRD;
      239    20606        %KV$MVD;
      240    20650        %KV$VDI;
      241    20721        %KV$PTR (STCLASS="BASED(KV$PTR$)");
      242    20764        %KV$OTPMRK (STCLASS=BASED);
      243    20791        %B$TERMINAL_ID(STCLASS=BASED);
      244    20820    1   DCL P$(0:31) PTR BASED ALIGNED;
      245    20821    1   DCL UBYT(0:31) UBIN BYTE CALIGNED BASED;
      246    20822    1   DCL BITS(0:1023) BIT(8) BASED CALIGNED;
      247    20823    1   DCL BIT16(0:1023) BIT(16) BASED ALIGNED;
      248    20824        %KZ$INPDESC(NAME=KZ@INPDESC,STCLASS=AUTO);
      249    20829    1   DCL BCHARS CHAR(32) BASED;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:82   
      250    20830    1   DCL 1 LOGON_STRING BASED,
      251    20831    1         2 * CHAR(LOGON_STRING_LENGTH);
      252    20832    1   DCL 1 WRDS3 BASED ALIGNED,
      253    20833    1         2 *(0:2) UBIN;
      254    20834    1   DCL 1 BVECTOR BASED ALIGNED,
      255    20835    1         2 BOUND UBIN,
      256    20836    1         2 ADR$ PTR;
      257    20837
      258    20838
      259    20839        /**/
      260    20840        /* External Data */
      261    20841        /**/
      262    20842            %KZ_HIP_HDR(STCLASS=SYMREF);
      263    20866            %KV$VDH_EVT(NAME=KV_VDH_EVT_RQSOTP,STCLASS=SYMREF);
      264    20901    1   DCL KH_INHLVL UBIN SYMREF;
      265    20902    1   DCL KZH_THRTL_INIT UBIN SYMREF;
      266    20903    1   DCL KZH_THRTL_UNBLK UBIN SYMREF;
      267    20904    1   DCL KZH_USRPRM UBIN SYMREF;
      268    20905    1   DCL KH_PROFILE_ VECTOR SYMREF;
      269    20906
      270    20907        %EQU Y#ID=0;
      271    20908        %KV$USR_EVT (NAME=KV_USR_EVT,STCLASS=SYMREF);
      272    20943        %KV$VDH_CNC (NAME=KV_VDH_CNC,STCLASS=SYMREF);
      273    21035        %KV$VDH_DAT (NAME=KV_VDH_DAT,STCLASS=SYMREF);
      274    21115        %KV$VDH_DSC (NAME=KV_VDH_DSC,STCLASS=SYMREF);
      275    21151        %KV$VDH_EVT (NAME=KV_VDH_EVT,STCLASS=SYMREF);
      276    21186        %KV$VDH_INT (NAME=KV_VDH_INT,STCLASS=SYMREF);
      277    21223        %KV$VDH_OTPMRK (NAME=KV_VDH_OTPMRK,STCLASS=SYMREF);
      278    21285    1   DCL KZ_HIP_BFRSIZ(0:7) UBIN SYMREF;
      279    21286
      280    21287
      281    21288        /**/
      282    21289        /* External Routines */
      283    21290        /**/
      284    21291    1   DCL KZT_CNCDSC@ EPTR SYMREF;
      285    21292    1   DCL KZH$HIP ENTRY(1) ALTRET;
      286    21293    1   DCL KHA$ERRLOG ENTRY(2) ALTRET;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:83   
      287    21294    1   DCL KZH$CMPOTP ENTRY(1) ALTRET;
      288    21295    1   DCL KVV$INT ENTRY(1) ALTRET;
      289    21296    1   DCL KVB$GETSYS ENTRY(2) ALTRET;
      290    21297    1   DCL KVB$RLSSYS ENTRY(2) ALTRET;
      291    21298    1   DCL KVV$VDI ENTRY(1) ALTRET;
      292    21299
      293    21300
      294    21301        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:84   
      295    21302
      296    21303
      297    21304    1           DEV$=ADDR(NIL);

  21304   2 000005  EB80 0000 0000                       LAB,B6   0
          2 000008  EFC7 000D                            STB,B6   DEV$,AUTO

      298    21305    1           CTR$=ADDR(NIL);

  21305   2 00000A  DB80 0000 0000                       LAB,B5   0
          2 00000D  DFC7 000B                            STB,B5   CTR$,AUTO

      299    21306    1           LIN$=KZ$EVENT.LINCTX$;

  21306   2 00000F  CCC7 0004                            LDB,B4   @PARM1,AUTO
          2 000011  BCC4 0003                            LDB,B3   3,B4
          2 000013  BFC7 0009                            STB,B3   LIN$,AUTO

      300    21307    1           VDH_FLG=0;

  21307   2 000015  8747 0027                            CL       VDH_FLG,AUTO

      301    21308        /**/
      302    21309    2           DO CASE(KZ$EVENT.EVENT);

  21309   2 000017  B804                                 LDR,R3   ,B4
          2 000018  3D18                                 CMV,R3   24
          2 000019  0281 0602                            BGE      s:21768,PREL
          2 00001B  A830 0000 0021  02                   LDR,R2   s:21309+10,R3
          2 00001E  83A0 0000 0039  02                   JMP      SEARCHING,R2
          2 000021       05E3                            DC       s:21768,PREL
          2 000022       0000                            DC       s:21313,PREL
          2 000023       005C                            DC       s:21365,PREL
          2 000024       006E                            DC       s:21382,PREL
          2 000025       00ED                            DC       s:21446,PREL
          2 000026       0213                            DC       s:21518,PREL
          2 000027       05E3                            DC       s:21768,PREL
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:85   
          2 000028       032A                            DC       s:21614,PREL
          2 000029       035D                            DC       s:21631,PREL
          2 00002A       05A5                            DC       s:21748,PREL
          2 00002B       05E3                            DC       s:21768,PREL
          2 00002C       05E3                            DC       s:21768,PREL
          2 00002D       008E                            DC       s:21406,PREL
          2 00002E       009E                            DC       s:21416,PREL
          2 00002F       05E3                            DC       s:21768,PREL
          2 000030       05E3                            DC       s:21768,PREL
          2 000031       05E3                            DC       s:21768,PREL
          2 000032       05E3                            DC       s:21768,PREL
          2 000033       05E3                            DC       s:21768,PREL
          2 000034       05E3                            DC       s:21768,PREL
          2 000035       052F                            DC       s:21720,PREL
          2 000036       05E7                            DC       s:21769,PREL
          2 000037       0252                            DC       s:21547,PREL
          2 000038       0252                            DC       s:21547,PREL

      303    21310        /**/
      304    21311        /* Get output */
      305    21312        /**/
      306    21313    2            CASE(%KZ#LINFCN_GETOTP);

      307    21314        /**/
      308    21315    3   SEARCHING: DO WHILE('1'B); /* Until output is found, or no devices are left   */

  21315   2                              SEARCHING       null
      309    21316    3                 KZ$LINCTX.OTPBFR$=ADDR(NIL);

  21316   2 000039  EB80 0000 0000       SEARCHING       LAB,B6   0
          2 00003C  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 00003E  EFC5 005A                            STB,B6   90,B5

      310    21317    3                 KZ$LINCTX.OTPCTR$=ADDR(NIL);

  21317   2 000040  CB80 0000 0000                       LAB,B4   0
          2 000043  CFC5 005E                            STB,B4   94,B5
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:86   

      311    21318    3                 KZ$LINCTX.OTPDEV$=ADDR(NIL);

  21318   2 000045  BB80 0000 0000                       LAB,B3   0
          2 000048  BFC5 0062                            STB,B3   98,B5

      312    21319    3                 IF KZ$LINCTX.OTPCNT=0 THEN

  21319   2 00004A  E845 004D                            LDR,R6   77,B5
          2 00004C  6981 0004                            BNEZ,R6  s:21321,PREL

      313    21320    3                    ALTRETURN;             /* Nothing to do                      */

  21320   2 00004E  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      314    21321    3                 DEV$=KZ$LINCTX.OTPHD$;

  21321   2 000051  ACC5 0052                            LDB,B2   82,B5
          2 000053  AFC7 000D                            STB,B2   DEV$,AUTO

      315    21322    3                 BFR$=KZ$HIPDEV.OTPHD$;

  21322   2 000055  9CC2 0008                            LDB,B1   8,B2
          2 000057  9FC7 001D                            STB,B1   BFR$,AUTO

      316    21323    3                 CTR$=DEV$->KZ$HIPDEV.CTR$;

  21323   2 000059  ECC2 0002                            LDB,B6   2,B2
          2 00005B  EFC7 000B                            STB,B6   CTR$,AUTO

      317    21324
      318    21325        /* IF DEVICE IS HALTED(NOT HALT-WACK), ITS BUFFER SHOULD NOT BE QUEUED UP */
      319    21326    3                 IF BFR$=ADDR(NIL) THEN ALTRETURN;

  21326   2 00005D  8DC7 001D                            CMN      BFR$,AUTO
          2 00005F  0981 0004                            BNE      s:21327,PREL

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:87   
  21326   2 000061  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      320    21327    3                 IF KZ$HIPDEV.HLT AND (NOT KZ$HIPDEV.HLT.WACK) THEN

  21327   2 000064  82C2 0012                            LB,'00FF'X        18,B2
  21327   2 000066       00FF
          2 000067  0581 0009                            BBF      s:21333,PREL
          2 000069  82C2 0012                            LB,'0080'X        18,B2
          2 00006B       0080
          2 00006C  0501 0004                            BBT      s:21333,PREL

      321    21328        /***BUGBUG:       DO WHILE('1'B); J=0; END;   ********* TEMP *********/
      322    21329    3                    ALTRETURN;

  21329   2 00006E  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      323    21330
      324    21331
      325    21332        /* DELINK DEVICE FROM LINE CONTEXT CHAIN */
      326    21333    3                 KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT-1;

  21333   2 000071  88C5 004D                            DEC      77,B5

      327    21334    3                 IF KZ$LINCTX.OTPCNT=0 THEN

  21334   2 000073  E845 004D                            LDR,R6   77,B5
          2 000075  6981 0006                            BNEZ,R6  s:21336,PREL

      328    21335    3                    KZ$LINCTX.OTPTL$=ADDR(NIL);

  21335   2 000077  EB80 0000 0000                       LAB,B6   0
          2 00007A  EFC5 0054                            STB,B6   84,B5

      329    21336    3                 KZ$LINCTX.OTPHD$=KZ$HIPDEV.OTPLNK$;

  21336   2 00007C  ECC2 001D                            LDB,B6   29,B2
          2 00007E  EFC5 0052                            STB,B6   82,B5
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:88   

      330    21337    3                 KZ$HIPDEV.ONOTP='0'B;

  21337   2 000080  8842 001C                            LBF,'0010'X       28,B2
  21337   2 000082       0010

      331    21338
      332    21339    3                 KZ$LINCTX.OTPBFR$=BFR$;

  21339   2 000083  9FC5 005A                            STB,B1   90,B5

      333    21340    3                 KZ$LINCTX.OTPDEV$=DEV$;

  21340   2 000085  AFC5 0062                            STB,B2   98,B5

      334    21341    3                 KZ$LINCTX.OTPCTR$=CTR$;

  21341   2 000087  ECC7 000B                            LDB,B6   CTR$,AUTO
          2 000089  EFC5 005E                            STB,B6   94,B5

      335    21342    3                 KZ$LINCTX.CURDEV$=DEV$;

  21342   2 00008B  AFC5 0050                            STB,B2   80,B5

      336    21343    3                 KZ$LINCTX.CURCTR$=CTR$;

  21343   2 00008D  EFC5 004E                            STB,B6   78,B5

      337    21344    3                 KZ$HIPDEV.OTPBSY='1'B;

  21344   2 00008F  8942 0012                            LBT,'0400'X       18,B2
  21344   2 000091       0400

      338    21345                      /* The DELETED bit was removed from KZ$OTPBFR for E02:
      339    21346                         see comments in KZ$OTPBFR file.
      340    21347                      IF NOT BFR$->KZ$OTPBFR.DELETED THEN
      341    21348                      DO;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:89   
      342    21349                      */
      343    21350    3                 RETURN;

  21350   2 000092  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      344    21351                      /* Without the DELETED bit, this code will never be
      345    21352                         executed:
      346    21353                         END;
      347    21354        \* OUTPUT HAS BEEN DELETED: THROW AWAY    *\
      348    21355                      CALL UNQRELOTPBFR;
      349    21356                      CALL REQUEUE;
      350    21357                      */
      351    21358    3                 END SEARCHING /* Do forever sends me back to top!*/;

      352    21359        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:90   
      353    21360        /**/
      354    21361        /* Requeue Output */
      355    21362        /**/
      356    21363    2            CASE(%KZ#LINFCN_REQOTP);

      357    21364
      358    21365    2              DEV$=KZ$LINCTX.CURDEV$;

  21365   2 000095  ACC3 0050                            LDB,B2   80,B3
          2 000097  AFC7 000D                            STB,B2   DEV$,AUTO

      359    21366    2              KZ$HIPDEV.OTPBSY='0'B;

  21366   2 000099  8842 0012                            LBF,'0400'X       18,B2
  21366   2 00009B       0400

      360    21367    2              BFR$=KZ$HIPDEV.OTPHD$;

  21367   2 00009C  ECC2 0008                            LDB,B6   8,B2
          2 00009E  EFC7 001D                            STB,B6   BFR$,AUTO

      361    21368    2              KZ$OTPBFR.CMPCOD=/*       TEMP       */0;

  21368   2 0000A0  87C6 0005                            CLH      5,B6

      362    21369    2              CALL REQUEUE;

  21369   2 0000A2  E3C0 0A59                            LNJ,B6   s:0,PREL
          2 0000A4       0001                            DC       s:21369+3,PREL
          2 0000A5  0F81 057A                            B        s:21769,PREL

      363    21370
      364    21371        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:91   
      365    21372        /**/
      366    21373        /* Release Output */
      367    21374        /**/
      368    21375    2            CASE(%KZ#LINFCN_RELOTP);

      369    21376
      370    21377        /*       Unlike the 3270 handler, I explicitly leave
      371    21378                 the output buffer queued up on the device while
      372    21379                 link level I/O is in progress. The RELOTPBFR routine
      373    21380                 has another entry point that will unlink the current
      374    21381                 output buffer */
      375    21382    2              CTR$=KZ$LINCTX.CURCTR$;

  21382   2 0000A7  ACC3 004E                            LDB,B2   78,B3
          2 0000A9  AFC7 000B                            STB,B2   CTR$,AUTO

      376    21383    2              DEV$=KZ$LINCTX.CURDEV$;

  21383   2 0000AB  DCC3 0050                            LDB,B5   80,B3
          2 0000AD  DFC7 000D                            STB,B5   DEV$,AUTO

      377    21384    2              BFR$=KZ$HIPDEV.OTPHD$;

  21384   2 0000AF  ECC5 0008                            LDB,B6   8,B5
          2 0000B1  EFC7 001D                            STB,B6   BFR$,AUTO

      378    21385        /*       COPY HALT REQUEST BITS FROM BUFFER: */
      379    21386    2              KZ$HIPDEV.HLT.PAG=BFR$->KZ$OTPBFR.FLAGS.HALT.PAG#;

  21386   2 0000B3  E846 0002                            LDR,R6   2,B6
          2 0000B5  6002                                 SOL,R6   2
          2 0000B6  EAC5 0012                            SRM,R6,'0020'X    18,B5
          2 0000B8       0020

      380    21387    2              KZ$HIPDEV.HLT.INP=BFR$->KZ$OTPBFR.FLAGS.HALT.INP#;

  21387   2 0000B9  E846 0002                            LDR,R6   2,B6
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:92   
          2 0000BB  6001                                 SOL,R6   1
          2 0000BC  EAC5 0012                            SRM,R6,'0008'X    18,B5
          2 0000BE       0008

      381    21388
      382    21389    2              CALL UNQRELOTPBFR;

  21389   2 0000BF  E3C0 0867                            LNJ,B6   s:0,PREL
          2 0000C1       0001                            DC       s:21393,PREL

      383    21390
      384    21391        /*       If the current device has output pending and is not halted
      385    21392                 then the device will be requed on the device waiting list */
      386    21393    2              CALL REQUEUE;

  21393   2 0000C2  E3C0 0A39                            LNJ,B6   s:0,PREL
          2 0000C4       0001                            DC       s:21393+3,PREL
          2 0000C5  0F81 055A                            B        s:21769,PREL

      387    21394        /**/
      388    21395
      389    21396        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:93   
      390    21397        /**/
      391    21398        /* The link protocol module has decided that its time for
      392    21399           a poll of all active controllers. Make sure a correct list
      393    21400           of controller addresses is present in the MLCP polling
      394    21401           table list 'POLLTBL$'.*/
      395    21402        /**/
      396    21403    2            CASE(%KZ#LINFCN_SPCPOLALL);

      397    21404
      398    21405        /* It is time for a poll. See if the polling list needs rebuilding */
      399    21406    2              KZ$LINCTX.POLLTBL$->KZ$POLLHIP.INDX=0;

  21406   2 0000C7  ACC3 0083                            LDB,B2   131,B3
          2 0000C9  8782                                 CLH      ,B2

      400    21407    2              KZ$LINCTX.POLLTBL$->KZ$POLLHIP.CONTINUE_POLL='0'B;

  21407   2 0000CA  ACC3 0083                            LDB,B2   131,B3
          2 0000CC  8802                                 LBF,'0080'X       ,B2
          2 0000CD       0080

      401    21408    2              CALL REBUILD_POLL_LIST ALTRET(NO_ACTIVE_CONTROLLERS);

  21408   2 0000CE  E3C0 0819                            LNJ,B6   s:0,PREL
          2 0000D0       0004                            DC       s:21407,PREL

      402    21409    2              RETURN;

  21409   2 0000D1  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

  21407   2                              NO_ACTIVE_CONTR*null
      403    21410    2   NO_ACTIVE_CONTROLLERS:;
      404    21411    2              ALTRETURN;

  21411   2 0000D4  C380 0000 0000  xent NO_ACTIVE_CONTR*LNJ,B4   X6A_AALT

      405    21412        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:94   
      406    21413        /**/
      407    21414        /* Get general poll address of next inactive controller */
      408    21415        /**/
      409    21416    2            CASE(%KZ#LINFCN_INACT_CTR);

      410    21417
      411    21418    2   INACT_CTR:
      412    21419    2              KZ$LINCTX.CURDEV$=ADDR(NIL);

  21419   2 0000D7  AB80 0000 0000       INACT_CTR       LAB,B2   0
          2 0000DA  AFC3 0050                            STB,B2   80,B3

      413    21420    2              I=KZ$LINCTX.INACT_CTR;

  21420   2 0000DC  E2C3 006C                            LLH,R6   108,B3
          2 0000DE  EF47 0016                            STR,R6   CNT,AUTO

      414    21421    3              DO UNTIL(I=KZ$LINCTX.INACT_CTR);

      415    21422    4                 IF KZ$LINCTX.POLLST$->UBYT(I)=0 THEN DO;

  21422   2 0000E0  ECC7 0009                            LDB,B6   LIN$,AUTO
          2 0000E2  DCC6 0066                            LDB,B5   102,B6
          2 0000E4  B847 0016                            LDR,R3   CNT,AUTO
          2 0000E6  E2B5                                 LLH,R6   ,B5,R3
          2 0000E7  6981 0029                            BNEZ,R6  s:21434,PREL

      416    21423    4                    CTR$=KZ$LINCTX.CTRLST$->P$(I);

  21423   2 0000E9  CCC6 0068                            LDB,B4   104,B6
          2 0000EB  BCB4                                 LDB,B3   ,B4,R3
          2 0000EC  BFC7 000B                            STB,B3   CTR$,AUTO

      417    21424    4                    KZ$LINCTX.POLADR.CTR=POLADR(KZ$HIPCTR.ADR);

  21424   2 0000EE  A2C3 000A                            LLH,R2   10,B3
          2 0000F0  D2A0 0000 000E  01                   LLH,R5   POLADR_B,R2
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:95   
          2 0000F3  D7C6 0064                            STH,R5   100,B6

      418    21425    4                    KZ$LINCTX.POLADR.DEV=0; /* Just to make it look nice         */

  21425   2 0000F5  8846 0064                            LBF,'00FF'X       100,B6
  21425   2 0000F7       00FF

      419    21426    4                    KZ$LINCTX.CURCTR$=CTR$;

  21426   2 0000F8  BFC6 004E                            STB,B3   78,B6

      420    21427    4                    IF I<KZ$LINCTX.POLSIZ-1 THEN

  21427   2 0000FA  E846 0065                            LDR,R6   101,B6
          2 0000FC  6EFF                                 ADV,R6   -1
          2 0000FD  6801 0009                            BLZ,R6   s:21430,PREL
          2 0000FF  E953                                 CMR,R6   R3
          2 000100  0381 0006                            BLE      s:21430,PREL

      421    21428    4                       KZ$LINCTX.INACT_CTR=I+1;

  21428   2 000102  3E01                                 ADV,R3   1
          2 000103  B7C6 006C                            STH,R3   108,B6
          2 000105  0F81 0003                            B        s:21431,PREL

      422    21429    4                    ELSE
      423    21430    4                       KZ$LINCTX.INACT_CTR=0;

  21430   2 000107  87C6 006C                            CLH      108,B6

      424    21431    4                    KZ$LINCTX.POLX=I;

  21431   2 000109  D847 0016                            LDR,R5   CNT,AUTO
          2 00010B  DAC6 006C                            SRM,R5,'00FF'X    108,B6
          2 00010D       00FF

      425    21432    4                    RETURN;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:96   

  21432   2 00010E  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      426    21433    4                    END;
      427    21434    3                 I=I+1;

  21434   2 000111  8AC7 0016                            INC      CNT,AUTO

      428    21435    3                 IF I>=KZ$LINCTX.POLSIZ THEN /* At end                           */

  21435   2 000113  E847 0016                            LDR,R6   CNT,AUTO
          2 000115  6801 0005                            BLZ,R6   s:21436,PREL
          2 000117  E946 0065                            CMR,R6   101,B6
          2 000119  0801 0003                            BAL      s:21437,PREL

      429    21436    3                    I=0;

  21436   2 00011B  8747 0016                            CL       CNT,AUTO

      430    21437    3                 END;

  21437   2 00011D  E2C6 006C                            LLH,R6   108,B6
          2 00011F  E947 0016                            CMR,R6   CNT,AUTO
          2 000121  0981 FFBE                            BNE      s:21422,PREL

      431    21438        /**/
      432    21439    2              ALTRETURN;

  21439   2 000123  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      433    21440        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:97   
      434    21441        /**/
      435    21442        /* Input */
      436    21443        /**/
      437    21444    2            CASE(%KZ#LINFCN_INP);

      438    21445
      439    21446    2              KZ@HIPSTT.BLKIN=KZ@HIPSTT.BLKIN+1;

  21446   2 000126  AC80 0000 0006  xsym                 LDB,B2   KZ_HIP_HDR+6
          2 000129  8AC2 0029                            INC      41,B2
          2 00012B  8EC2 0028                            CAD      40,B2

      440    21447    2              KZ@HIPSTT.CHRIN=KZ@HIPSTT.CHRIN+KZ$LINCTX.INPDATSIZ;

  21447   2 00012D  F843 0059                            LDR,R7   89,B3
          2 00012F  6C00                                 LDV,R6   0
          2 000130  8442 0024                            AID      36,B2
          2 000132  8D42 0024                            SDI      36,B2

      441    21448
      442    21449        /*       Link protocol level has carefully set up current device */
      443    21450
      444    21451    2              DEV$=KZ$LINCTX.CURDEV$;

  21451   2 000134  9CC3 0050                            LDB,B1   80,B3
          2 000136  9FC7 000D                            STB,B1   DEV$,AUTO

      445    21452    2              CTR$=KZ$HIPDEV.CTR$;

  21452   2 000138  ECC1 0002                            LDB,B6   2,B1
          2 00013A  EFC7 000B                            STB,B6   CTR$,AUTO

      446    21453
      447    21454    2              KZ$HIPDEV.IGN_INP='0'B;

  21454   2 00013C  8841 0012                            LBF,'0100'X       18,B1
  21454   2 00013E       0100
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:98   

      448    21455    3              IF KZ$HIPDEV.HLT.PAG OR KZ$HIPDEV.HLT.INP THEN DO;

  21455   2 00013F  82C1 0012                            LB,'0020'X        18,B1
  21455   2 000141       0020
          2 000142  0501 0006                            BBT      s:21456,PREL
          2 000144  82C1 0012                            LB,'0008'X        18,B1
          2 000146       0008
          2 000147  0581 000F                            BBF      s:21461,PREL

      449    21456    3                 KZ$HIPDEV.HLT.PAG='0'B;

  21456   2 000149  8841 0012                            LBF,'0020'X       18,B1
  21456   2 00014B       0020

      450    21457    3                 KZ$HIPDEV.HLT.INP='0'B;

  21457   2 00014C  8841 0012                            LBF,'0008'X       18,B1
  21457   2 00014E       0008

      451    21458    3                 CALL REQUEUE;

  21458   2 00014F  E3C0 09AC                            LNJ,B6   s:0,PREL
          2 000151       0001                            DC       s:21459,PREL

      452    21459    3                 KZ$HIPDEV.IGN_INP='1'B;

  21459   2 000152  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000154  8946 0012                            LBT,'0100'X       18,B6
          2 000156       0100

      453    21460    3                 END;

      454    21461    2              KZ@INPDESC=ADDR(PSTAT)->KZ$INPDESC;

  21461   2 000157  ECC7 0006                            LDB,B6   @PARM2,AUTO
          2 000159  8C86                                 LDI      ,B6
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:99   
          2 00015A  8D47 0071                            SDI      KZ@INPDESC,AUTO

      455    21462    2              FC1FC2=SUBSTR(KZ$LINCTX.INPBFR$->BCHARS,KZ@INPDESC.BYTX-3,2);

  21462   2 00015C  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 00015E  CCC5 0056                            LDB,B4   86,B5
          2 000160  AB84                                 LAB,B2   ,B4
          2 000161  A847 0071                            LDR,R2   KZ@INPDESC,AUTO
          2 000163  2EFD                                 ADV,R2   -3
          2 000164  6C02                                 LDV,R6   2
          2 000165  BB87                                 LAB,B3   ,AUTO
          2 000166  3C36                                 LDV,R3   54
          2 000167  0008                                 MMM

      456    21463    2              IF KZ$HIPCTR.TYP=7700 THEN

  21463   2 000168  DCC7 000B                            LDB,B5   CTR$,AUTO
          2 00016A  E845 0008                            LDR,R6   8,B5
          2 00016C  E970 1E14                            CMR,R6   7700,IMO
          2 00016E  0981 0031                            BNE      s:21475,PREL

      457    21464    3              DO I=0 TO 1;

  21464   2 000170  8747 0016                            CL       CNT,AUTO

      458    21465    3                 IF FC_CHARS(I)~=' ' THEN

  21465   2 000172  B847 0016                            LDR,R3   CNT,AUTO
          2 000174  3E36                                 ADV,R3   54
          2 000175  E0B7                                 LDH,R6   ,AUTO,R3
          2 000176  6D20                                 CMV,R6   32
          2 000177  0901 0022                            BE       s:21474,PREL

      459    21466    4                 DO;

      460    21467    4                    IF NOT KZ$HIPDEV.DSC THEN

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:100  
  21467   2 000179  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 00017B  82C6 0015                            LB,'00FF'X        21,B6
          2 00017D       00FF
          2 00017E  0501 0004                            BBT      s:21469,PREL

      461    21468    4                       KZ$HIPDEV.IGN_INP='0'B;

  21468   2 000180  8846 0012                            LBF,'0100'X       18,B6
  21468   2 000182       0100

      462    21469    4                    KZ@INPDESC.DATBYTSIZ=KZ@INPDESC.DATBYTSIZ+2;

  21469   2 000183  E847 0072                            LDR,R6   KZ@INPDESC+1,AUTO
          2 000185  6E02                                 ADV,R6   2
          2 000186  EF47 0072                            STR,R6   KZ@INPDESC+1,AUTO

      463    21470    4                    KZ@INPDESC.BYTX=KZ@INPDESC.BYTX-2;

  21470   2 000188  D847 0071                            LDR,R5   KZ@INPDESC,AUTO
          2 00018A  5EFE                                 ADV,R5   -2
          2 00018B  DF47 0071                            STR,R5   KZ@INPDESC,AUTO

      464    21471    4                    CALL INSERT(KZ$LINCTX.INPBFR$->BCHARS,KZ@INPDESC.BYTX,2,

  21471   2 00018D  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 00018F  CCC5 0056                            LDB,B4   86,B5
          2 000191  4C1B                                 LDV,R4   27
          2 000192  B855                                 LDR,R3   R5
          2 000193  C7B4                                 STH,R4   ,B4,R3
          2 000194  A847 0016                            LDR,R2   CNT,AUTO
          2 000196  2E36                                 ADV,R2   54
          2 000197  90A7                                 LDH,R1   ,AUTO,R2
          2 000198  3E01                                 ADV,R3   1
          2 000199  97B4                                 STH,R1   ,B4,R3

      465    21472    4                      %BITASC('1B'X),FC_CHARS(I));
      466    21473    4                    END;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:101  

      467    21474    3                 END;

  21474   2 00019A  8AC7 0016                            INC      CNT,AUTO
          2 00019C  E847 0016                            LDR,R6   CNT,AUTO
          2 00019E  6D01                                 CMV,R6   1
          2 00019F  03D3                                 BLE      s:21465,SPREL

      468    21475    2              IF(NOT KZ$HIPDEV.IGN_INP)AND KZ$HIPDEV.VDI$~=ADDR(NIL)THEN

  21475   2 0001A0  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 0001A2  82C6 0012                            LB,'0100'X        18,B6
          2 0001A4       0100
          2 0001A5  0501 047A                            BBT      s:21769,PREL
          2 0001A7  8DC6 0004                            CMN      4,B6
          2 0001A9  0901 0476                            BE       s:21769,PREL

      469    21476    3   DONT_IGNORE_INPUT:DO;

  21476   2                              DONT_IGNORE_INP*null
      470    21477    3                 CALL ENTER_VDH(KZ$HIPDEV.VDI$,DFRD);

  21477   2 0001AB  DBC7 0026            DONT_IGNORE_INP*LAB,B5   DFRD,AUTO
          2 0001AD  DFC7 0088                            STB,B5   T$+1,AUTO
          2 0001AF  CBC6 0004                            LAB,B4   4,B6
          2 0001B1  CFC7 0086                            STB,B4   @VDI$+2,AUTO
          2 0001B3  E3C0 10D9                            LNJ,B6   s:0,PREL
          2 0001B5       0001                            DC       s:21478,PREL

      471    21478    4                 IF DFRD THEN DO;

  21478   2 0001B6  89C7 0026                            CMZ      DFRD,AUTO
          2 0001B8  0881 006E                            BAGE     s:21503,PREL

      472    21479                         %DISABLE(INHLVL=KH_INHLVL);

  21480   2 0001BA  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:102  
          2 0001BD  EF47 0062                            STR,R6   DISABLE_LEVEL,AUTO

  21481   2 0001BF  EBC7 0062                            LAB,B6   DISABLE_LEVEL,AUTO
          2 0001C1  EFC7 00A4                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 0001C3  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0001C5  CBF0 0100                            LAB,B4   256,IMO
          2 0001C7  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 0001CA       0001                            DC       s:21483,PREL

      473    21483    4                    CALL KVB$GETSYS(SIZEW(KZ$INPBFR),T$) ALTRET(NO_MEMORY);

  21483   2 0001CB  EBF0 0008                            LAB,B6   8,IMO
          2 0001CD  DBC7 0011                            LAB,B5   T$,AUTO
          2 0001CF  DFC7 00A6                            STB,B5   FPT_WRSYSLOG+24,AUTO
          2 0001D1  EFC7 00A4                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 0001D3  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0001D5  CBF0 0200                            LAB,B4   512,IMO
          2 0001D7  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 0001DA       0456                            DC       s:21781,PREL

      474    21484                         %ENABLE(INHLVL=KH_INHLVL);

  21485   2 0001DB  E847 0062                            LDR,R6   DISABLE_LEVEL,AUTO
          2 0001DD  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
          2 0001E0  0901 0007                            BE       s:21490,PREL

  21487   2 0001E2  CBF0 0000                            LAB,B4   0,IMO
          2 0001E4  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 0001E7       0001                            DC       s:21490,PREL

      475    21490    4                    T$->KZ$INPBFR=KZ_INPBFR;

  21490   2 0001E8  AB80 0000 005C  01                   LAB,B2   KZ_INPBFR
          2 0001EB  2C00                                 LDV,R2   0
          2 0001EC  6C10                                 LDV,R6   16
          2 0001ED  BCC7 0011                            LDB,B3   T$,AUTO
          2 0001EF  3C00                                 LDV,R3   0
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:103  
          2 0001F0  0008                                 MMM

      476    21491    4                    T$->KZ$INPBFR.BFR_SIZ=KZ$LINCTX.INPBFRSIZ;

  21491   2 0001F1  ECC7 0011                            LDB,B6   T$,AUTO
          2 0001F3  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 0001F5  E845 0058                            LDR,R6   88,B5
          2 0001F7  EF46 0004                            STR,R6   4,B6

      477    21492    4                    T$->KZ$INPBFR.DATA_SIZ=KZ@INPDESC.DATBYTSIZ;

  21492   2 0001F9  ECC7 0011                            LDB,B6   T$,AUTO
          2 0001FB  E847 0072                            LDR,R6   KZ@INPDESC+1,AUTO
          2 0001FD  EF46 0003                            STR,R6   3,B6

      478    21493    4                    T$->KZ$INPBFR.BYTX=KZ@INPDESC.BYTX;

  21493   2 0001FF  ECC7 0011                            LDB,B6   T$,AUTO
          2 000201  D847 0071                            LDR,R5   KZ@INPDESC,AUTO
          2 000203  DF46 0005                            STR,R5   5,B6

      479    21494    4                    T$->KZ$INPBFR.DATA$=KZ$LINCTX.INPBFR$;

  21494   2 000205  ECC5 0056                            LDB,B6   86,B5
          2 000207  CCC7 0011                            LDB,B4   T$,AUTO
          2 000209  EFC4 0006                            STB,B6   6,B4

      480    21495    4                    IF KZ$HIPDEV.DFRTL$~=ADDR(NIL) THEN

  21495   2 00020B  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 00020D  8DC6 000E                            CMN      14,B6
          2 00020F  0901 0008                            BE       s:21498,PREL

      481    21496    4                       KZ$HIPDEV.DFRTL$->KZ$INPBFR.LNK$=T$;

  21496   2 000211  CCC6 000E                            LDB,B4   14,B6
          2 000213  BCC7 0011                            LDB,B3   T$,AUTO
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:104  
          2 000215  BF84                                 STB,B3   ,B4
          2 000216  0F81 0005                            B        s:21499,PREL

      482    21497    4                    ELSE
      483    21498    4                       KZ$HIPDEV.DFRHD$=T$;

  21498   2 000218  CCC7 0011                            LDB,B4   T$,AUTO
          2 00021A  CFC6 000C                            STB,B4   12,B6

      484    21499    4                    KZ$HIPDEV.DFRTL$=T$;

  21499   2 00021C  CCC7 0011                            LDB,B4   T$,AUTO
          2 00021E  CFC6 000E                            STB,B4   14,B6

      485    21500    4                    KZ$LINCTX.INPBFR$=ADDR(NIL);

  21500   2 000220  BB80 0000 0000                       LAB,B3   0
          2 000223  BFC5 0056                            STB,B3   86,B5

      486    21501    4                    END;

  21501   2 000225  0F81 03FA                            B        s:21769,PREL

      487    21502    4                 ELSE DO;

      488    21503    4                    KV$VDH_DAT=KV_VDH_DAT;

  21503   2 000227  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_DAT
          2 00022A  2C00                                 LDV,R2   0
          2 00022B  6C10                                 LDV,R6   16
          2 00022C  BBC7 0043                            LAB,B3   KV$VDH_DAT,AUTO
          2 00022E  3C00                                 LDV,R3   0
          2 00022F  0008                                 MMM

      489    21504    4                    KV$VDH_DAT.DAT__.ADR$=KZ$LINCTX.INPBFR$;

  21504   2 000230  ECC7 0009                            LDB,B6   LIN$,AUTO
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:105  
          2 000232  DCC6 0056                            LDB,B5   86,B6
          2 000234  DFC7 0044                            STB,B5   KV$VDH_DAT+1,AUTO

      490    21505    4                    KV$VDH_DAT.DAT__.BYTX=KZ@INPDESC.BYTX;

  21505   2 000236  E847 0071                            LDR,R6   KZ@INPDESC,AUTO
          2 000238  EF47 0046                            STR,R6   KV$VDH_DAT+3,AUTO

      491    21506    4                    KV$VDH_DAT.DAT__.DATBYTSIZ=KZ@INPDESC.DATBYTSIZ;

  21506   2 00023A  D847 0072                            LDR,R5   KZ@INPDESC+1,AUTO
          2 00023C  DF47 0047                            STR,R5   KV$VDH_DAT+4,AUTO

      492    21507    4                    CALL GIVE_VDH_DATA;

  21507   2 00023E  E3C0 10F3                            LNJ,B6   s:0,PREL
          2 000240       0001                            DC       s:21509,PREL

      493    21508
      494    21509    4                    CALL EXIT_VDH(KZ$HIPDEV.VDI$);

  21509   2 000241  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000243  DBC6 0004                            LAB,B5   4,B6
          2 000245  DFC7 0084                            STB,B5   TCNT+4,AUTO
          2 000247  E3C0 10A5                            LNJ,B6   s:0,PREL
          2 000249       0001                            DC       s:21511,PREL

      495    21510    4                    END;

      496    21511    3                 END DONT_IGNORE_INPUT;

  21511   2 00024A  0F81 03D5                            B        s:21769,PREL

      497    21512        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:106  
      498    21513        /**/
      499    21514        /* General Poll Time-out */
      500    21515        /**/
      501    21516    2            CASE(%KZ#LINFCN_POLTIMOUT);

      502    21517
      503    21518    2              CTR$=KZ$LINCTX.CURCTR$;

  21518   2 00024C  ACC3 004E                            LDB,B2   78,B3
          2 00024E  AFC7 000B                            STB,B2   CTR$,AUTO

      504    21519    2              IF KZ$LINCTX.POLLST$->UBYT(KZ$HIPCTR.ADR)~=0 THEN

  21519   2 000250  DCC3 0066                            LDB,B5   102,B3
          2 000252  92C2 000A                            LLH,R1   10,B2
          2 000254  E295                                 LLH,R6   ,B5,R1
          2 000255  6901 000E                            BEZ,R6   s:21528,PREL

      505    21520    3   CONTROLLER_NOW_INACTIVE: DO;

  21520   2                              CONTROLLER_NOW_*null
      506    21521
      507    21522    3                 KZ$LINCTX.ACTCTR=KZ$LINCTX.ACTCTR-1;

  21522   2 000257  D2C3 006D            CONTROLLER_NOW_*LLH,R5   109,B3
          2 000259  5EFF                                 ADV,R5   -1
          2 00025A  D7C3 006D                            STH,R5   109,B3

      508    21523    3                 KZ$LINCTX.POLLST$->UBYT(KZ$HIPCTR.ADR)=0;

  21523   2 00025C  B2C2 000A                            LLH,R3   10,B2
          2 00025E  87B5                                 CLH      ,B5,R3

      509    21524    3                 CALL REBUILD_POLL_LIST;

  21524   2 00025F  E3C0 0688                            LNJ,B6   s:0,PREL
          2 000261       0001                            DC       s:21526,PREL
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:107  

      510    21525
      511    21526    3                 END CONTROLLER_NOW_INACTIVE;

  21526   2 000262  0F81 0004                            B        s:21530,PREL

      512    21527    2              ELSE
      513    21528    2                 RETURN /* CONTROLLER WAS NOT INACTIVE, LINK PROTOCOL BUG */;

  21528   2 000264  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      514    21529
      515    21530    2              DEV$=KZ$HIPCTR.DEVHD$;

  21530   2 000267  ECC7 000B                            LDB,B6   CTR$,AUTO
          2 000269  DCC6 0002                            LDB,B5   2,B6
          2 00026B  DFC7 000D                            STB,B5   DEV$,AUTO

      516    21531    3              DO WHILE(DEV$~=ADDR(NIL));

  21531   2 00026D  0F81 0017                            B        s:21537,PREL

      517    21532    4                 IF KZ$HIPDEV.ACTIVE THEN DO;

  21532   2 00026F  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000271  82C6 0012                            LB,'4000'X        18,B6
          2 000273       4000
          2 000274  0581 000B                            BBF      s:21536,PREL

      518    21533    4                    KZ$HIPDEV.ACTIVE='0'B;

  21533   2 000276  8846 0012                            LBF,'4000'X       18,B6
  21533   2 000278       4000

      519    21534    4                    CALL DSC_DEV(%KV_DSCRSN_LINDRP);

  21534   2 000279  DBF0 0001                            LAB,B5   1,IMO
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:108  
          2 00027B  DFC7 0076                            STB,B5   KZ@INPDESC+5,AUTO
          2 00027D  E3C0 0B50                            LNJ,B6   s:0,PREL
          2 00027F       0001                            DC       s:21536,PREL

      520    21535    4                    END;

      521    21536    3                 DEV$=KZ$HIPDEV.LNK$;

  21536   2 000280  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000282  DC86                                 LDB,B5   ,B6
          2 000283  DFC7 000D                            STB,B5   DEV$,AUTO

      522    21537    3                 END;

  21537   2 000285  8DC7 000D                            CMN      DEV$,AUTO
          2 000287  09E8                                 BNE      s:21532,SPREL

      523    21538    2              RETURN;

  21538   2 000288  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      524    21539
      525    21540        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:109  
      526    21541        /**/
      527    21542        /* disconnect channels */
      528    21543        /**/
      529    21544    2            CASE(%KZ#LINFCN_DSCTRM,

      530    21545    2                %KZ#LINFCN_KILL);
      531    21546
      532    21547    3              DO CASE (KZ$EVENT.TERMID$->B$TERMINAL_ID.LEV);

  21547   2 00028B  ACC4 0005                            LDB,B2   5,B4
          2 00028D  9802                                 LDR,R1   ,B2
          2 00028E  9570 00FF                            AND,R1   255,IMO
          2 000290  1D04                                 CMV,R1   4
          2 000291  0281 038E                            BGE      s:21769,PREL
          2 000293  B810 0000 0299  02                   LDR,R3   s:21547+14,R1
          2 000296  83B0 0000 029D  02                   JMP      s:21550,R3
          2 000299       00C4                            DC       s:21599,PREL
          2 00029A       0000                            DC       s:21550,PREL
          2 00029B       0051                            DC       s:21575,PREL
          2 00029C       0093                            DC       s:21594,PREL

      533    21548
      534    21549    3               CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                            */

      535    21550    3                 KZ$LINCTX.DSC_LEV=%TERMINAL_ID_LEV_CHAN#;

  21550   2 00029D  6C01                                 LDV,R6   1
          2 00029E  EAC3 0085                            SRM,R6,'00FF'X    133,B3
          2 0002A0       00FF

      536    21551    3                 CTR$=KZ$LINCTX.CTRHD$;

  21551   2 0002A1  AC83                                 LDB,B2   ,B3
          2 0002A2  AFC7 000B                            STB,B2   CTR$,AUTO

      537    21552    3                 IF CTR$=ADDR(NIL) THEN

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:110  
  21552   2 0002A4  8DC7 000B                            CMN      CTR$,AUTO
          2 0002A6  0981 0006                            BNE      s:21555,PREL

      538    21553    3                    CALL RLS_LINE;

  21553   2 0002A8  E3C0 096C                            LNJ,B6   s:0,PREL
          2 0002AA       0001                            DC       s:21553+3,PREL
          2 0002AB  0F81 0374                            B        s:21769,PREL

      539    21554    3                 ELSE
      540    21555    4                 DO WHILE(CTR$~=ADDR(NIL));

  21555   2 0002AD  0F81 003B                            B        s:21572,PREL

      541    21556    4                    TCTR$=KZ$HIPCTR.LNK$;

  21556   2 0002AF  ECC7 000B                            LDB,B6   CTR$,AUTO
          2 0002B1  DC86                                 LDB,B5   ,B6
          2 0002B2  DFC7 0022                            STB,B5   TCTR$,AUTO

      542    21557    4                    DEV$=KZ$HIPCTR.DEVHD$;

  21557   2 0002B4  CCC6 0002                            LDB,B4   2,B6
          2 0002B6  CFC7 000D                            STB,B4   DEV$,AUTO

      543    21558    4                    IF DEV$=ADDR(NIL) THEN

  21558   2 0002B8  8DC7 000D                            CMN      DEV$,AUTO
          2 0002BA  0981 0006                            BNE      s:21561,PREL

      544    21559    4                       CALL RLS_CTR;

  21559   2 0002BC  E3C0 0914                            LNJ,B6   s:0,PREL
          2 0002BE       0001                            DC       s:21559+3,PREL
          2 0002BF  0F81 0025                            B        s:21571,PREL

      545    21560    4                    ELSE
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:111  
      546    21561    5                    DO WHILE(DEV$~=ADDR(NIL));

  21561   2 0002C1  0F81 0020                            B        s:21570,PREL

      547    21562    5                       TDEV$=KZ$HIPDEV.LNK$;

  21562   2 0002C3  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 0002C5  DC86                                 LDB,B5   ,B6
          2 0002C6  DFC7 0024                            STB,B5   TDEV$,AUTO

      548    21563    6                       IF KZ$HIPDEV.ACTIVE THEN DO;

  21563   2 0002C8  82C6 0012                            LB,'4000'X        18,B6
  21563   2 0002CA       4000
          2 0002CB  0581 000F                            BBF      s:21568,PREL

      549    21564    6                          KZ$HIPDEV.ACTIVE='0'B;

  21564   2 0002CD  8846 0012                            LBF,'4000'X       18,B6
  21564   2 0002CF       4000

      550    21565    6                          CALL DSC_DEV(KZ$LINCTX.DSCRSN);

  21565   2 0002D0  CCC7 0009                            LDB,B4   LIN$,AUTO
          2 0002D2  BBC4 0038                            LAB,B3   56,B4
          2 0002D4  BFC7 0076                            STB,B3   KZ@INPDESC+5,AUTO
          2 0002D6  E3C0 0AF7                            LNJ,B6   s:0,PREL
          2 0002D8       0001                            DC       s:21566,PREL

      551    21566    6                          END;

  21566   2 0002D9  0F81 0004                            B        s:21569,PREL

      552    21567    5                       ELSE
      553    21568    5                          CALL RLS_DEV;

  21568   2 0002DB  E3C0 0882                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:112  
          2 0002DD       0001                            DC       s:21569,PREL

      554    21569    5                       DEV$=TDEV$;

  21569   2 0002DE  ECC7 0024                            LDB,B6   TDEV$,AUTO
          2 0002E0  EFC7 000D                            STB,B6   DEV$,AUTO

      555    21570    5                       END;

  21570   2 0002E2  8DC7 000D                            CMN      DEV$,AUTO
          2 0002E4  09DF                                 BNE      s:21562,SPREL

      556    21571    4                    CTR$=TCTR$;

  21571   2 0002E5  ECC7 0022                            LDB,B6   TCTR$,AUTO
          2 0002E7  EFC7 000B                            STB,B6   CTR$,AUTO

      557    21572    4                    END;

  21572   2 0002E9  8DC7 000B                            CMN      CTR$,AUTO
          2 0002EB  09C4                                 BNE      s:21556,SPREL
          2 0002EC  0F81 0333                            B        s:21769,PREL

      558    21573
      559    21574    3               CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                   */

      560    21575    3                 KZ$LINCTX.DSC_LEV=%TERMINAL_ID_LEV_SUBCHAN#;

  21575   2 0002EE  6C02                                 LDV,R6   2
          2 0002EF  EAC3 0085                            SRM,R6,'00FF'X    133,B3
          2 0002F1       00FF

      561    21576    3                 I=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBDEVICE;

  21576   2 0002F2  ACC4 0005                            LDB,B2   5,B4
          2 0002F4  D842 0002                            LDR,R5   2,B2
          2 0002F6  DF47 0016                            STR,R5   CNT,AUTO
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:113  

      562    21577    3                 CALL FND_CTR ALTRET(NONE);

  21577   2 0002F8  E3C0 0465                            LNJ,B6   s:0,PREL
          2 0002FA       0067                            DC       s:21599,PREL

      563    21578    3                 DEV$=KZ$HIPCTR.DEVHD$;

  21578   2 0002FB  ECC7 000B                            LDB,B6   CTR$,AUTO
          2 0002FD  DCC6 0002                            LDB,B5   2,B6
          2 0002FF  DFC7 000D                            STB,B5   DEV$,AUTO

      564    21579    3                 IF DEV$=ADDR(NIL) THEN

  21579   2 000301  8DC7 000D                            CMN      DEV$,AUTO
          2 000303  0981 0006                            BNE      s:21582,PREL

      565    21580    3                    CALL RLS_CTR;

  21580   2 000305  E3C0 08CB                            LNJ,B6   s:0,PREL
          2 000307       0001                            DC       s:21580+3,PREL
          2 000308  0F81 0317                            B        s:21769,PREL

      566    21581    3                 ELSE
      567    21582    4                 DO WHILE(DEV$~=ADDR(NIL));

  21582   2 00030A  0F81 0020                            B        s:21591,PREL

      568    21583    4                    TDEV$=KZ$HIPDEV.LNK$;

  21583   2 00030C  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 00030E  DC86                                 LDB,B5   ,B6
          2 00030F  DFC7 0024                            STB,B5   TDEV$,AUTO

      569    21584    5                    IF KZ$HIPDEV.ACTIVE THEN DO;

  21584   2 000311  82C6 0012                            LB,'4000'X        18,B6
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:114  
  21584   2 000313       4000
          2 000314  0581 000F                            BBF      s:21589,PREL

      570    21585    5                       KZ$HIPDEV.ACTIVE='0'B;

  21585   2 000316  8846 0012                            LBF,'4000'X       18,B6
  21585   2 000318       4000

      571    21586    5                       CALL DSC_DEV(KZ$LINCTX.DSCRSN);

  21586   2 000319  CCC7 0009                            LDB,B4   LIN$,AUTO
          2 00031B  BBC4 0038                            LAB,B3   56,B4
          2 00031D  BFC7 0076                            STB,B3   KZ@INPDESC+5,AUTO
          2 00031F  E3C0 0AAE                            LNJ,B6   s:0,PREL
          2 000321       0001                            DC       s:21587,PREL

      572    21587    5                       END;

  21587   2 000322  0F81 0004                            B        s:21590,PREL

      573    21588    4                    ELSE
      574    21589    4                       CALL RLS_DEV;

  21589   2 000324  E3C0 0839                            LNJ,B6   s:0,PREL
          2 000326       0001                            DC       s:21590,PREL

      575    21590    4                    DEV$=TDEV$;

  21590   2 000327  ECC7 0024                            LDB,B6   TDEV$,AUTO
          2 000329  EFC7 000D                            STB,B6   DEV$,AUTO

      576    21591    4                    END;

  21591   2 00032B  8DC7 000D                            CMN      DEV$,AUTO
          2 00032D  09DF                                 BNE      s:21583,SPREL
          2 00032E  0F81 02F1                            B        s:21769,PREL

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:115  
      577    21592
      578    21593    3               CASE (%TERMINAL_ID_LEV_SUBSUBCHAN#); /* Device                    */

      579    21594    3                 KZ$LINCTX.DSC_LEV=%TERMINAL_ID_LEV_SUBSUBCHAN#;

  21594   2 000330  6C03                                 LDV,R6   3
          2 000331  EAC3 0085                            SRM,R6,'00FF'X    133,B3
          2 000333       00FF

      580    21595    3                 I=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBDEVICE;

  21595   2 000334  ACC4 0005                            LDB,B2   5,B4
          2 000336  D842 0002                            LDR,R5   2,B2
          2 000338  DF47 0016                            STR,R5   CNT,AUTO

      581    21596    3                 J=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBSUBDEVICE;

  21596   2 00033A  ACC4 0005                            LDB,B2   5,B4
          2 00033C  C842 0003                            LDR,R4   3,B2
          2 00033E  CF47 0017                            STR,R4   J,AUTO

      582    21597    3                 CALL FND_CTR ALTRET(NONE);

  21597   2 000340  E3C0 041D                            LNJ,B6   s:0,PREL
          2 000342       001F                            DC       s:21599,PREL

      583    21598    3                 CALL FND_DEV ALTRET(NONE);

  21598   2 000343  E3C0 0446                            LNJ,B6   s:0,PREL
          2 000345       001C                            DC       s:21599,PREL

      584    21599    4                 IF KZ$HIPDEV.ACTIVE THEN DO;

  21599   2 000346  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000348  82C6 0012                            LB,'4000'X        18,B6
          2 00034A       4000
          2 00034B  0581 0012                            BBF      s:21605,PREL
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:116  

      585    21600    4                    KZ$HIPDEV.ACTIVE='0'B;

  21600   2 00034D  8846 0012                            LBF,'4000'X       18,B6
  21600   2 00034F       4000

      586    21601    4                    KZ$HIPDEV.REACT='1'B;

  21601   2 000350  8946 001C                            LBT,'0040'X       28,B6
  21601   2 000352       0040

      587    21602    4                    CALL DSC_DEV(KZ$LINCTX.DSCRSN);

  21602   2 000353  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 000355  CBC5 0038                            LAB,B4   56,B5
          2 000357  CFC7 0076                            STB,B4   KZ@INPDESC+5,AUTO
          2 000359  E3C0 0A74                            LNJ,B6   s:0,PREL
          2 00035B       0001                            DC       s:21603,PREL

      588    21603    4                    END;

  21603   2 00035C  0F81 0004                            B        s:21599,PREL

      589    21604    3                 ELSE
      590    21605    3                    CALL RLS_DEV;

  21605   2 00035E  E3C0 07FF                            LNJ,B6   s:0,PREL
          2 000360       0001                            DC       s:21599,PREL

  21599   2                              NONE            null
      591    21606    3   NONE:         ;
      592    21607    3               END;

  21607   2 000361  0F81 02BE            NONE            B        s:21769,PREL

      593    21608        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:117  
      594    21609        /**/
      595    21610        /* Controller Present */
      596    21611        /**/
      597    21612    2            CASE(%KZ#LINFCN_NEWCTR);

      598    21613
      599    21614    2              CTR$=KZ$LINCTX.CTRLST$->P$(KZ$LINCTX.POLX);

  21614   2 000363  ACC3 0068                            LDB,B2   104,B3
          2 000365  9843 006C                            LDR,R1   108,B3
          2 000367  9570 00FF                            AND,R1   255,IMO
          2 000369  9C92                                 LDB,B1   ,B2,R1
          2 00036A  9FC7 000B                            STB,B1   CTR$,AUTO

      600    21615    2              KZ$LINCTX.ACTCTR=KZ$LINCTX.ACTCTR+1;

  21615   2 00036C  E2C3 006D                            LLH,R6   109,B3
          2 00036E  6E01                                 ADV,R6   1
          2 00036F  E7C3 006D                            STH,R6   109,B3

      601    21616    2              KZ$LINCTX.POLLST$->UBYT(KZ$LINCTX.POLX)=

  21616   2 000371  DCC3 0066                            LDB,B5   102,B3
          2 000373  B2C1 000A                            LLH,R3   10,B1
          2 000375  E2B0 0000 000E  01                   LLH,R6   POLADR_B,R3
          2 000378  E795                                 STH,R6   ,B5,R1

      602    21617    2                POLADR(KZ$HIPCTR.ADR);
      603    21618    2              CALL REBUILD_POLL_LIST;

  21618   2 000379  E3C0 056E                            LNJ,B6   s:0,PREL
          2 00037B       0001                            DC       s:21619,PREL

      604    21619    2              DEV$=KZ$HIPCTR.DEVHD$;

  21619   2 00037C  ECC7 000B                            LDB,B6   CTR$,AUTO
          2 00037E  DCC6 0002                            LDB,B5   2,B6
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:118  
          2 000380  DFC7 000D                            STB,B5   DEV$,AUTO

      605    21620    3              DO WHILE(DEV$~=ADDR(NIL));

  21620   2 000382  0F81 000E                            B        s:21624,PREL

      606    21621    3                 KZ$HIPDEV.ACTIVE='1'B;

  21621   2 000384  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000386  8946 0012                            LBT,'4000'X       18,B6
          2 000388       4000

      607    21622    3                 CALL CNC_DEV;

  21622   2 000389  E3C0 0C37                            LNJ,B6   s:0,PREL
          2 00038B       0001                            DC       s:21623,PREL

      608    21623    3                 DEV$=KZ$HIPDEV.LNK$;

  21623   2 00038C  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 00038E  DC86                                 LDB,B5   ,B6
          2 00038F  DFC7 000D                            STB,B5   DEV$,AUTO

      609    21624    3                 END;

  21624   2 000391  8DC7 000D                            CMN      DEV$,AUTO
          2 000393  09F1                                 BNE      s:21621,SPREL
          2 000394  0F81 028B                            B        s:21769,PREL

      610    21625        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:119  
      611    21626        /**/
      612    21627        /* Build Controller and Device Context */
      613    21628        /**/
      614    21629    2            CASE(%KZ#LINFCN_BLDCTX);

      615    21630
      616    21631    3              IF KZ_VDHSTT$=ADDR(NIL) THEN DO;

  21631   2 000396  8D80 0000 0000  xsym                 CMN      KZ_VDHSTT$
          2 000399  0981 00C6                            BNE      s:21669,PREL

      617    21632                                                /* INIT VDH STAT BUFFER               */
      618    21633                      %DISABLE(INHLVL=KH_INHLVL);

  21634   2 00039B  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          2 00039E  EF47 0062                            STR,R6   DISABLE_LEVEL,AUTO

  21635   2 0003A0  ABC7 0062                            LAB,B2   DISABLE_LEVEL,AUTO
          2 0003A2  AFC7 00A4                            STB,B2   FPT_WRSYSLOG+22,AUTO
          2 0003A4  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0003A6  CBF0 0100                            LAB,B4   256,IMO
          2 0003A8  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 0003AB       0001                            DC       s:21637,PREL

      619    21637    3                 SZ=SIZEW(KV$STT);

  21637   2 0003AC  E870 0230                            LDR,R6   560,IMO
          2 0003AE  EF47 0015                            STR,R6   SZ,AUTO

      620    21638    3                 CALL KVB$GETSYS(SZ,KZ_VDHSTT$) ALTRET (NO_MEMORY);

  21638   2 0003B0  EB80 0000 0000  xsym                 LAB,B6   KZ_VDHSTT$
          2 0003B3  EFC7 00A6                            STB,B6   FPT_WRSYSLOG+24,AUTO
          2 0003B5  DBC7 0015                            LAB,B5   SZ,AUTO
          2 0003B7  DFC7 00A4                            STB,B5   FPT_WRSYSLOG+22,AUTO
          2 0003B9  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0003BB  CBF0 0200                            LAB,B4   512,IMO
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:120  
          2 0003BD  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 0003C0       0270                            DC       s:21781,PREL

      621    21639    3                 KV$STT='0'B;

  21639   2 0003C1  AB80 0000 0000  03                   LAB,B2   0
          2 0003C4  2C00                                 LDV,R2   0
          2 0003C5  6C01                                 LDV,R6   1
          2 0003C6  BC80 0000 0000  xsym                 LDB,B3   KZ_VDHSTT$
          2 0003C9  3C00                                 LDV,R3   0
          2 0003CA  F870 0460                            LDR,R7   1120,IMO
          2 0003CC  D380 0000 0000  xent                 LNJ,B5   X6C_ALRZ

      622    21640    3                 KV$STT.REQSTATS.FNC=%IGA_REQSTATS;

  21640   2 0003CF  6C24                                 LDV,R6   36
          2 0003D0  EC80 0000 0000  xsym                 LDB,B6   KZ_VDHSTT$
          2 0003D3  E786                                 STH,R6   ,B6

      623    21641    3                 KV$STT.REQSTATS.SLCENT(%KH#ENTID_VDH)='1'B;

  21641   2 0003D4  EC80 0000 0000  xsym                 LDB,B6   KZ_VDHSTT$
          2 0003D7  8946 0012                            LBT,'0020'X       18,B6
          2 0003D9       0020

      624    21642    3                 KV$STT.REQSTATS.SLCENT(%KH#ENTID_PLDVIP)='1'B;

  21642   2 0003DA  8946 0012                            LBT,'0100'X       18,B6
  21642   2 0003DC       0100

      625    21643    3                 KV$STT.REQSTATS.DSPENT(%KH#ENTID_VDH)='1'B;

  21643   2 0003DD  8946 0010                            LBT,'0020'X       16,B6
  21643   2 0003DF       0020

      626    21644
      627    21645                                                /*  INIT HIP STAT BUFFER              */
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:121  
      628    21646    3                 SZ=SIZEW(KZ@HIPSTT);

  21646   2 0003E0  D870 00A6                            LDR,R5   166,IMO
          2 0003E2  DF47 0015                            STR,R5   SZ,AUTO

      629    21647    3                 CALL KVB$GETSYS(SZ,KZ_HIP_HDR.STTBFR$) ALTRET (NO_MEMORY);

  21647   2 0003E4  DB80 0000 0006  xsym                 LAB,B5   KZ_HIP_HDR+6
          2 0003E7  DFC7 00A6                            STB,B5   FPT_WRSYSLOG+24,AUTO
          2 0003E9  CBC7 0015                            LAB,B4   SZ,AUTO
          2 0003EB  CFC7 00A4                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 0003ED  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0003EF  CBF0 0200                            LAB,B4   512,IMO
          2 0003F1  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 0003F4       023C                            DC       s:21781,PREL

      630    21648    3                 KZ@HIPSTT='0'B;

  21648   2 0003F5  AB80 0000 0000  03                   LAB,B2   0
          2 0003F8  2C00                                 LDV,R2   0
          2 0003F9  6C01                                 LDV,R6   1
          2 0003FA  BC80 0000 0006  xsym                 LDB,B3   KZ_HIP_HDR+6
          2 0003FD  3C00                                 LDV,R3   0
          2 0003FE  F870 014C                            LDR,R7   332,IMO
          2 000400  D380 0000 0000  xent                 LNJ,B5   X6C_ALRZ

      631    21649    3                 KZ@HIPSTT.REQSTATS.FNC=%IGA_REQSTATS;

  21649   2 000403  6C24                                 LDV,R6   36
          2 000404  EC80 0000 0006  xsym                 LDB,B6   KZ_HIP_HDR+6
          2 000407  E786                                 STH,R6   ,B6

      632    21650    3                 KZ@HIPSTT.REQSTATS.DSPENT(%KH#ENTID_PLDVIP)='1'B;

  21650   2 000408  EC80 0000 0006  xsym                 LDB,B6   KZ_HIP_HDR+6
          2 00040B  8946 0010                            LBT,'0100'X       16,B6
          2 00040D       0100
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:122  

      633    21651    3                 KZ@HIPSTT.REQSTATS.SLCENT(%KH#ENTID_PLDVIP)='1'B;

  21651   2 00040E  8946 0012                            LBT,'0100'X       18,B6
  21651   2 000410       0100

      634    21652    3                 KZ@HIPSTT.REQSTATS.SLCENT(%KH#ENTID_VDH)='1'B;

  21652   2 000411  8946 0012                            LBT,'0020'X       18,B6
  21652   2 000413       0020

      635    21653    3                 SZ=SIZEW(KV$USRPRM);

  21653   2 000414  5C39                                 LDV,R5   57
          2 000415  DF47 0015                            STR,R5   SZ,AUTO

      636    21654    3                 CALL KVB$GETSYS(SZ, KZH_USRPRM$) ALTRET(NO_MEMORY);

  21654   2 000417  DB80 0000 0000  xsym                 LAB,B5   KZH_USRPRM$
          2 00041A  DFC7 00A6                            STB,B5   FPT_WRSYSLOG+24,AUTO
          2 00041C  CBC7 0015                            LAB,B4   SZ,AUTO
          2 00041E  CFC7 00A4                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 000420  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000422  CBF0 0200                            LAB,B4   512,IMO
          2 000424  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 000427       0209                            DC       s:21781,PREL

      637    21655                      %ENABLE(INHLVL=KH_INHLVL);

  21656   2 000428  E847 0062                            LDR,R6   DISABLE_LEVEL,AUTO
          2 00042A  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
          2 00042D  0901 0007                            BE       s:21661,PREL

  21658   2 00042F  CBF0 0000                            LAB,B4   0,IMO
          2 000431  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 000434       0001                            DC       s:21661,PREL

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:123  
      638    21661    3                 KZH_USRPRM$->KV$USRPRM=KZ_USRPRM;

  21661   2 000435  AB80 0000 0082  01                   LAB,B2   KZ_USRPRM
          2 000438  2C00                                 LDV,R2   0
          2 000439  6C72                                 LDV,R6   114
          2 00043A  BC80 0000 0000  xsym                 LDB,B3   KZH_USRPRM$
          2 00043D  3C00                                 LDV,R3   0
          2 00043E  0008                                 MMM

      639    21662    3                 KZH_USRPRM$->KV$USRPRM.HLTMSG=HALT_MESSAGE.HLTMSG;

  21662   2 00043F  EB80 0000 0000  00                   LAB,B6   HALT_MESSAGE
          2 000442  DC80 0000 0000  xsym                 LDB,B5   KZH_USRPRM$
          2 000445  0021                                 ALR      ;
          2 000446       5106 0000                                ALPHANUM(0,B6,,17),;
          2 000448       D305 0001                                ALPHANUM(1,B5,1,19,FILL)

      640    21663    3                 KZH_USRPRM$->KV$USRPRM.HLTMSGSIZ=LENGTHC(HALT_MESSAGE);

  21663   2 00044A  6C11                                 LDV,R6   17
          2 00044B  437F                                 CSYNC    s:21663,SPREL
          2 00044C  EC80 0000 0000  xsym                 LDB,B6   KZH_USRPRM$
          2 00044F  E7C6 0001                            STH,R6   1,B6

      641    21664    3                 KZH_USRPRM$->KV$USRPRM.INHLVL=KH_INHLVL;

  21664   2 000451  EC80 0000 0000  xsym                 LDB,B6   KZH_USRPRM$
          2 000454  D800 0000 0000  xsym                 LDR,R5   KH_INHLVL
          2 000457  DF06                                 STR,R5   ,B6

      642    21665    3                 KZH_USRPRM$->KV$USRPRM.STT$=KZ_VDHSTT$;

  21665   2 000458  EC80 0000 0000  xsym                 LDB,B6   KZ_VDHSTT$
          2 00045B  DC80 0000 0000  xsym                 LDB,B5   KZH_USRPRM$
          2 00045E  EFC5 0033                            STB,B6   51,B5

      643    21666
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:124  
      644    21667    3                 END;

      645    21668
      646    21669    3              DO CASE (KZ$EVENT.TERMID$->B$TERMINAL_ID.LEV);

  21669   2 000460  ECC7 0004                            LDB,B6   @PARM1,AUTO
          2 000462  DCC6 0005                            LDB,B5   5,B6
          2 000464  B805                                 LDR,R3   ,B5
          2 000465  B570 00FF                            AND,R3   255,IMO
          2 000467  3D04                                 CMV,R3   4
          2 000468  0281 01B7                            BGE      s:21769,PREL
          2 00046A  A830 0000 0470  02                   LDR,R2   s:21669+16,R3
          2 00046D  83A0 0000 0474  02                   JMP      s:21672,R2
          2 000470       00F2                            DC       s:21713,PREL
          2 000471       00F2                            DC       s:21713,PREL
          2 000472       0000                            DC       s:21672,PREL
          2 000473       007E                            DC       s:21692,PREL

      647    21670    3               CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                   */

      648    21671
      649    21672    3                 KZ$LINCTX.POLSIZ=KZ$LINCTX.POLSIZ+1; /* # controllers to poll   */

  21672   2 000474  CCC7 0009                            LDB,B4   LIN$,AUTO
          2 000476  8AC4 0065                            INC      101,B4

      650    21673    3                 CTR$=KZ$LINCTX.CTRHD$;    /* See if CTR already present         */

  21673   2 000478  DC84                                 LDB,B5   ,B4
          2 000479  DFC7 000B                            STB,B5   CTR$,AUTO

      651    21674    4                 DO WHILE(CTR$~=ADDR(NIL));

  21674   2 00047B  0F81 0019                            B        s:21678,PREL

      652    21675    4                    IF KZ$HIPCTR.ADR=KZ$EVENT.CHNCTX$->KL_CONTROLLER.CONT# THEN

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:125  
  21675   2 00047D  ECC7 0004                            LDB,B6   @PARM1,AUTO
          2 00047F  8CC6 0001                            LDI      1,B6
          2 000481  B856                                 LDR,R3   R6
          2 000482  E570 7FFF                            AND,R6   32767,IMO
          2 000484  8D47 00A4                            SDI      FPT_WRSYSLOG+22,AUTO
          2 000486  DCC7 00A4                            LDB,B5   FPT_WRSYSLOG+22,AUTO
          2 000488  304F                                 SOR,R3   15
          2 000489  CCC7 000B                            LDB,B4   CTR$,AUTO
          2 00048B  D2C4 000A                            LLH,R5   10,B4
          2 00048D  3E08                                 ADV,R3   8
          2 00048E  C2B5                                 LLH,R4   ,B5,R3
          2 00048F  D954                                 CMR,R5   R4
          2 000490  0901 000A                            BE       s:21681,PREL

      653    21676    4                       GOTO SETCTR;
      654    21677    4                    CTR$=KZ$HIPCTR.LNK$;

  21677   2 000492  BC84                                 LDB,B3   ,B4
          2 000493  BFC7 000B                            STB,B3   CTR$,AUTO

      655    21678    4                    END;

  21678   2 000495  8DC7 000B                            CMN      CTR$,AUTO
          2 000497  09E6                                 BNE      s:21675,SPREL

      656    21679    3                 CALL BLD_CTR_CTX ALTRET(NO_MEMORY);

  21679   2 000498  E3C0 03CB                            LNJ,B6   s:0,PREL
          2 00049A       0196                            DC       s:21781,PREL

      657    21680    3   SETCTR:
      658    21681    3                 KZ$HIPCTR.ADR=KZ$EVENT.CHNCTX$->KL_CONTROLLER.CONT#;

  21681   2 00049B  ECC7 0004            SETCTR          LDB,B6   @PARM1,AUTO
          2 00049D  8CC6 0001                            LDI      1,B6
          2 00049F  B856                                 LDR,R3   R6
          2 0004A0  E570 7FFF                            AND,R6   32767,IMO
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:126  
          2 0004A2  8D47 00A4                            SDI      FPT_WRSYSLOG+22,AUTO
          2 0004A4  DCC7 00A4                            LDB,B5   FPT_WRSYSLOG+22,AUTO
          2 0004A6  304F                                 SOR,R3   15
          2 0004A7  3E08                                 ADV,R3   8
          2 0004A8  D2B5                                 LLH,R5   ,B5,R3
          2 0004A9  CCC7 000B                            LDB,B4   CTR$,AUTO
          2 0004AB  D7C4 000A                            STH,R5   10,B4

      659    21682    3                 KZ$HIPCTR.ROWS=KZ$EVENT.CHNCTX$->KL_CONTROLLER.ROWS;

  21682   2 0004AD  8CC6 0001                            LDI      1,B6
          2 0004AF  B856                                 LDR,R3   R6
          2 0004B0  E570 7FFF                            AND,R6   32767,IMO
          2 0004B2  8D47 00A4                            SDI      FPT_WRSYSLOG+22,AUTO
          2 0004B4  DCC7 00A4                            LDB,B5   FPT_WRSYSLOG+22,AUTO
          2 0004B6  304F                                 SOR,R3   15
          2 0004B7  3E09                                 ADV,R3   9
          2 0004B8  D2B5                                 LLH,R5   ,B5,R3
          2 0004B9  DAC4 0009                            SRM,R5,'00FF'X    9,B4
          2 0004BB       00FF

      660    21683    3                 KZ$HIPCTR.COLS=KZ$EVENT.CHNCTX$->KL_CONTROLLER.COLUMNS;

  21683   2 0004BC  8CC6 0001                            LDI      1,B6
          2 0004BE  B856                                 LDR,R3   R6
          2 0004BF  E570 7FFF                            AND,R6   32767,IMO
          2 0004C1  8D47 00A4                            SDI      FPT_WRSYSLOG+22,AUTO
          2 0004C3  DCC7 00A4                            LDB,B5   FPT_WRSYSLOG+22,AUTO
          2 0004C5  304F                                 SOR,R3   15
          2 0004C6  3E0A                                 ADV,R3   10
          2 0004C7  D2B5                                 LLH,R5   ,B5,R3
          2 0004C8  D7C4 0009                            STH,R5   9,B4

      661    21684    3                 KZ$HIPCTR.TYP=KZ$EVENT.CHNCTX$->KL_CONTROLLER.TYPE;

  21684   2 0004CA  8CC6 0001                            LDI      1,B6
          2 0004CC  B856                                 LDR,R3   R6
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:127  
          2 0004CD  E570 7FFF                            AND,R6   32767,IMO
          2 0004CF  8D47 00A4                            SDI      FPT_WRSYSLOG+22,AUTO
          2 0004D1  DCC7 00A4                            LDB,B5   FPT_WRSYSLOG+22,AUTO
          2 0004D3  304F                                 SOR,R3   15
          2 0004D4  5C02                                 LDV,R5   2
          2 0004D5  0021                                 ALR      ;
          2 0004D6       4235 0006                                ALPHANUM(6,B5,R3,,2),;
          2 0004D8       4007 00A6                                ALPHANUM(FPT_WRSYSLOG+24,AUTO,,R5,FILL)
          2 0004DA  437F                                 CSYNC    s:21684+15,SPREL
          2 0004DB  C847 00A6                            LDR,R4   FPT_WRSYSLOG+24,AUTO
          2 0004DD  CF44 0008                            STR,R4   8,B4

      662    21685    3                 KZ$HIPCTR.LIN$=LIN$;

  21685   2 0004DF  BCC7 0009                            LDB,B3   LIN$,AUTO
          2 0004E1  BFC4 0004                            STB,B3   4,B4

      663    21686    3                 KZ$HIPCTR.CHN$=KZ$EVENT.CHN$;

  21686   2 0004E3  ACC6 0007                            LDB,B2   7,B6
          2 0004E5  AFC4 0006                            STB,B2   6,B4

      664    21687    3                 KZ$EVENT.CHN$->KH$CHN.TERMID.TTYP = %KLTY_HIP_CONT#;

  21687   2 0004E7  9CC6 0007                            LDB,B1   7,B6
          2 0004E9  6C0C                                 LDV,R6   12
          2 0004EA  E7C1 0012                            STH,R6   18,B1

      665    21688    3                 KZ$EVENT.CHN$->KH$CHN.CTX$ = CTR$;

  21688   2 0004EC  ACC6 0007                            LDB,B2   7,B6
          2 0004EE  CFC2 000C                            STB,B4   12,B2
          2 0004F0  0F81 012F                            B        s:21769,PREL

      666    21689
      667    21690    3               CASE (%TERMINAL_ID_LEV_SUBSUBCHAN#); /* Device                    */

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:128  
      668    21691
      669    21692    3                 I=KZ$EVENT.CHNCTX$->KL_LINEDEV.CONTROLLER#;

  21692   2 0004F2  8CC6 0001                            LDI      1,B6
          2 0004F4  9856                                 LDR,R1   R6
          2 0004F5  E570 7FFF                            AND,R6   32767,IMO
          2 0004F7  8D47 00A4                            SDI      FPT_WRSYSLOG+22,AUTO
          2 0004F9  DCC7 00A4                            LDB,B5   FPT_WRSYSLOG+22,AUTO
          2 0004FB  104F                                 SOR,R1   15
          2 0004FC  1E08                                 ADV,R1   8
          2 0004FD  D295                                 LLH,R5   ,B5,R1
          2 0004FE  DF47 0016                            STR,R5   CNT,AUTO

      670    21693    3                 J=KZ$EVENT.CHNCTX$->KL_LINEDEV.DEVICE#;

  21693   2 000500  8CC6 0001                            LDI      1,B6
          2 000502  B856                                 LDR,R3   R6
          2 000503  E570 7FFF                            AND,R6   32767,IMO
          2 000505  8D47 00A4                            SDI      FPT_WRSYSLOG+22,AUTO
          2 000507  DCC7 00A4                            LDB,B5   FPT_WRSYSLOG+22,AUTO
          2 000509  304F                                 SOR,R3   15
          2 00050A  3E09                                 ADV,R3   9
          2 00050B  C2B5                                 LLH,R4   ,B5,R3
          2 00050C  CF47 0017                            STR,R4   J,AUTO

      671    21694    3                 CALL FND_CTR ALTRET(NO_CTRLR);

  21694   2 00050E  E3C0 024F                            LNJ,B6   s:0,PREL
          2 000510       0056                            DC       s:21713,PREL

      672    21695    3                 DEV$=KZ$HIPCTR.DEVHD$;

  21695   2 000511  ECC7 000B                            LDB,B6   CTR$,AUTO
          2 000513  DCC6 0002                            LDB,B5   2,B6
          2 000515  DFC7 000D                            STB,B5   DEV$,AUTO

      673    21696    4                 DO WHILE(DEV$~=ADDR(NIL));
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:129  

  21696   2 000517  0F81 0019                            B        s:21700,PREL

      674    21697    4                    IF KZ$HIPDEV.ADR=KZ$EVENT.CHNCTX$->KL_LINEDEV.DEVICE# THEN

  21697   2 000519  ECC7 0004                            LDB,B6   @PARM1,AUTO
          2 00051B  8CC6 0001                            LDI      1,B6
          2 00051D  B856                                 LDR,R3   R6
          2 00051E  E570 7FFF                            AND,R6   32767,IMO
          2 000520  8D47 00A4                            SDI      FPT_WRSYSLOG+22,AUTO
          2 000522  DCC7 00A4                            LDB,B5   FPT_WRSYSLOG+22,AUTO
          2 000524  304F                                 SOR,R3   15
          2 000525  CCC7 000D                            LDB,B4   DEV$,AUTO
          2 000527  D2C4 0015                            LLH,R5   21,B4
          2 000529  3E09                                 ADV,R3   9
          2 00052A  C2B5                                 LLH,R4   ,B5,R3
          2 00052B  D954                                 CMR,R5   R4
          2 00052C  0901 000A                            BE       s:21703,PREL

      675    21698    4                       GOTO SETDEV;
      676    21699    4                    DEV$=KZ$HIPDEV.LNK$;

  21699   2 00052E  BC84                                 LDB,B3   ,B4
          2 00052F  BFC7 000D                            STB,B3   DEV$,AUTO

      677    21700    4                    END;

  21700   2 000531  8DC7 000D                            CMN      DEV$,AUTO
          2 000533  09E6                                 BNE      s:21697,SPREL

      678    21701    3                 CALL BLD_DEV_CTX ALTRET(NO_MEMORY);

  21701   2 000534  E3C0 02B7                            LNJ,B6   s:0,PREL
          2 000536       00FA                            DC       s:21781,PREL

      679    21702    3   SETDEV:
      680    21703    3                 KZ$HIPDEV.CHN$=KZ$EVENT.CHN$;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:130  

  21703   2 000537  ECC7 0004            SETDEV          LDB,B6   @PARM1,AUTO
          2 000539  DCC6 0007                            LDB,B5   7,B6
          2 00053B  CCC7 000D                            LDB,B4   DEV$,AUTO
          2 00053D  DFC4 0006                            STB,B5   6,B4

      681    21704    3                 KZ$EVENT.CHN$->KH$CHN.TERMID.TTYP = %KLTY_HIP_LINE#;

  21704   2 00053F  BCC6 0007                            LDB,B3   7,B6
          2 000541  6C0D                                 LDV,R6   13
          2 000542  E7C3 0012                            STH,R6   18,B3

      682    21705    3                 KZ$EVENT.CHN$->KH$CHN.CTX$ = DEV$;

  21705   2 000544  DCC6 0007                            LDB,B5   7,B6
          2 000546  CFC5 000C                            STB,B4   12,B5

      683    21706    3                 IF KZ$HIPCTR.TYP=3276 THEN

  21706   2 000548  DCC7 000B                            LDB,B5   CTR$,AUTO
          2 00054A  D845 0008                            LDR,R5   8,B5
          2 00054C  D970 0CCC                            CMR,R5   3276,IMO
          2 00054E  0981 0006                            BNE      s:21709,PREL

      684    21707    3                    KZ$HIPDEV.EWALT='1'B;

  21707   2 000550  8944 0012                            LBT,'2000'X       18,B4
  21707   2 000552       2000
          2 000553  0F81 0004                            B        s:21710,PREL

      685    21708    3                 ELSE
      686    21709    3                    KZ$HIPDEV.EWALT='0'B;

  21709   2 000555  8844 0012                            LBF,'2000'X       18,B4
  21709   2 000557       2000

      687    21710    3                 KZ$HIPDEV.PRINTER=KZ$HIPDEV.ADR~=0;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:131  

  21710   2 000558  D870 8000                            LDR,R5   -32768,IMO
          2 00055A  C2C4 0015                            LLH,R4   21,B4
          2 00055C  4981 0002                            BNEZ,R4  s:21710+7,PREL
          2 00055E  5C00                                 LDV,R5   0
          2 00055F  5044                                 SOR,R5   4
          2 000560  DAC4 0012                            SRM,R5,'0800'X    18,B4
          2 000562       0800

      688    21711    3                 CALL SET_PRO;

  21711   2 000563  E3C0 0372                            LNJ,B6   s:0,PREL
          2 000565       0001                            DC       s:21713,PREL

      689    21712    3   NO_CTRLR:
      690    21713    3               END;

  21713   2 000566  0F81 00B9            NO_CTRLR        B        s:21769,PREL

      691    21714
      692    21715        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:132  
      693    21716        /* Build Context Complete */
      694    21717
      695    21718    2            CASE(%KZ#LINFCN_CTXCMP);

      696    21719                   %DISABLE(INHLVL=KH_INHLVL);

  21720   2 000568  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          2 00056B  EF47 0062                            STR,R6   DISABLE_LEVEL,AUTO

  21721   2 00056D  ABC7 0062                            LAB,B2   DISABLE_LEVEL,AUTO
          2 00056F  AFC7 00A4                            STB,B2   FPT_WRSYSLOG+22,AUTO
          2 000571  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000573  CBF0 0100                            LAB,B4   256,IMO
          2 000575  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000578       0001                            DC       s:21723,PREL

      697    21723    2              SZ=((KZ$LINCTX.POLSIZ*6)+5)/2;

  21723   2 000579  ECC7 0009                            LDB,B6   LIN$,AUTO
          2 00057B  E846 0065                            LDR,R6   101,B6
          2 00057D  6F06                                 MLV,R6   6
          2 00057E  6E05                                 ADV,R6   5
          2 00057F  E370 0002                            DIV,R6   2,IMO
          2 000581  EF47 0015                            STR,R6   SZ,AUTO

      698    21724    2              CALL KVB$GETSYS(SZ,T$) ALTRET(NO_MEMORY);

  21724   2 000583  DBC7 0011                            LAB,B5   T$,AUTO
          2 000585  DFC7 00A6                            STB,B5   FPT_WRSYSLOG+24,AUTO
          2 000587  CBC7 0015                            LAB,B4   SZ,AUTO
          2 000589  CFC7 00A4                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 00058B  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 00058D  CBF0 0200                            LAB,B4   512,IMO
          2 00058F  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 000592       009E                            DC       s:21781,PREL

      699    21725    2              KZ$LINCTX.CTRLST$=T$;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:133  

  21725   2 000593  ECC7 0011                            LDB,B6   T$,AUTO
          2 000595  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 000597  EFC5 0068                            STB,B6   104,B5

      700    21726    2              KZ$LINCTX.POLLST$=PINCRW(T$,

  21726   2 000599  B845 0065                            LDR,R3   101,B5
          2 00059B  E853                                 LDR,R6   R3
          2 00059C  70F0                                 DAR,R7   16
          2 00059D  7081                                 DOL,R7   1
          2 00059E  8447 0011                            AID      T$,AUTO
          2 0005A0  8D45 0066                            SDI      102,B5

      701    21727    2                KZ$LINCTX.POLSIZ*2);
      702    21728    2              KZ$LINCTX.POLLTBL$=PINCRW(KZ$LINCTX.POLLST$,(KZ$LINCTX.POLSIZ+1)/2);

  21728   2 0005A2  3E01                                 ADV,R3   1
          2 0005A3  B370 0002                            DIV,R3   2,IMO
          2 0005A5  CCC5 0066                            LDB,B4   102,B5
          2 0005A7  BBB4                                 LAB,B3   ,B4,R3
          2 0005A8  BFC5 0083                            STB,B3   131,B5

      703    21729    2              KZ$LINCTX.POLLTBL$->KZ$POLLHIP.REBUILD_POLL='1'B;

  21729   2 0005AA  8903                                 LBT,'0040'X       ,B3
  21729   2 0005AB       0040

      704    21730
      705    21731    2              CTR$=KZ$LINCTX.CTRHD$;

  21731   2 0005AC  EC85                                 LDB,B6   ,B5
          2 0005AD  EFC7 000B                            STB,B6   CTR$,AUTO

      706    21732    3              DO I=0 TO KZ$LINCTX.POLSIZ-1;

  21732   2 0005AF  8747 0016                            CL       CNT,AUTO
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:134  
          2 0005B1  0F81 0014                            B        s:21736+2,PREL

      707    21733    3                 KZ$LINCTX.POLLST$->UBYT(I)=0; /* Make all controllers inactive  */

  21733   2 0005B3  ECC7 0009                            LDB,B6   LIN$,AUTO
          2 0005B5  DCC6 0066                            LDB,B5   102,B6
          2 0005B7  B847 0016                            LDR,R3   CNT,AUTO
          2 0005B9  87B5                                 CLH      ,B5,R3

      708    21734    3                 KZ$LINCTX.CTRLST$->P$(I)=CTR$;

  21734   2 0005BA  DCC6 0068                            LDB,B5   104,B6
          2 0005BC  CCC7 000B                            LDB,B4   CTR$,AUTO
          2 0005BE  B847 0016                            LDR,R3   CNT,AUTO
          2 0005C0  CFB5                                 STB,B4   ,B5,R3

      709    21735    3                 CTR$=KZ$HIPCTR.LNK$;

  21735   2 0005C1  DC84                                 LDB,B5   ,B4
          2 0005C2  DFC7 000B                            STB,B5   CTR$,AUTO

      710    21736    3                 END;

  21736   2 0005C4  8AC7 0016                            INC      CNT,AUTO
          2 0005C6  ECC7 0009                            LDB,B6   LIN$,AUTO
          2 0005C8  E847 0016                            LDR,R6   CNT,AUTO
          2 0005CA  6801 0004                            BLZ,R6   s:21738,PREL
          2 0005CC  E946 0065                            CMR,R6   101,B6
          2 0005CE  0865                                 BAL      s:21733,SPREL

      711    21737                   %ENABLE(INHLVL=KH_INHLVL);

  21738   2 0005CF  D847 0062                            LDR,R5   DISABLE_LEVEL,AUTO
          2 0005D1  D900 0000 0000  xsym                 CMR,R5   KH_INHLVL
          2 0005D4  0901 004B                            BE       s:21769,PREL

  21740   2 0005D6  CBF0 0000                            LAB,B4   0,IMO
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:135  
          2 0005D8  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 0005DB       0001                            DC       s:21741,PREL

  21741   2 0005DC  0F81 0043                            B        s:21769,PREL

      712    21743        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:136  
      713    21744        /* Enable Channels  */
      714    21745
      715    21746    2            CASE(%KZ#LINFCN_ENABL);

      716    21747
      717    21748    3              DO CASE (KZ$EVENT.TERMID$->B$TERMINAL_ID.LEV);

  21748   2 0005DE  ACC4 0005                            LDB,B2   5,B4
          2 0005E0  9802                                 LDR,R1   ,B2
          2 0005E1  9570 00FF                            AND,R1   255,IMO
          2 0005E3  1D04                                 CMV,R1   4
          2 0005E4  0281 003B                            BGE      s:21769,PREL
          2 0005E6  B810 0000 05EC  02                   LDR,R3   s:21748+14,R1
          2 0005E9  83B0 0000 05F0  02                   JMP      s:21755,R3
          2 0005EC       002A                            DC       s:21759,PREL
          2 0005ED       002A                            DC       s:21759,PREL
          2 0005EE       002A                            DC       s:21759,PREL
          2 0005EF       0000                            DC       s:21755,PREL

      718    21749
      719    21750    3               CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                            */

      720    21751
      721    21752    3               CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                   */

      722    21753
      723    21754    3               CASE (%TERMINAL_ID_LEV_SUBSUBCHAN#); /* Device                    */

      724    21755    3                 I=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBDEVICE;

  21755   2 0005F0  E842 0002                            LDR,R6   2,B2
          2 0005F2  EF47 0016                            STR,R6   CNT,AUTO

      725    21756    3                 J=KZ$EVENT.TERMID$->B$TERMINAL_ID.TERM.SUBSUBDEVICE;

  21756   2 0005F4  ACC4 0005                            LDB,B2   5,B4
          2 0005F6  D842 0003                            LDR,R5   3,B2
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:137  
          2 0005F8  DF47 0017                            STR,R5   J,AUTO

      726    21757    3                 CALL FND_CTR ALTRET(NO_WAY);

  21757   2 0005FA  E3C0 0163                            LNJ,B6   s:0,PREL
          2 0005FC       001E                            DC       s:21759,PREL

      727    21758    3                 CALL FND_DEV ALTRET(NO_WAY);

  21758   2 0005FD  E3C0 018C                            LNJ,B6   s:0,PREL
          2 0005FF       001B                            DC       s:21759,PREL

      728    21759    3                 IF KZ$HIPDEV.AWAIT_ENABLE OR

  21759   2 000600  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000602  82C6 001C                            LB,'0008'X        28,B6
          2 000604       0008
          2 000605  0501 0011                            BBT      s:21762,PREL
          2 000607  82C6 0012                            LB,'0800'X        18,B6
          2 000609       0800
          2 00060A  0581 0006                            BBF      s:21759+17,PREL
          2 00060C  82C6 0012                            LB,'4000'X        18,B6
          2 00060E       4000
          2 00060F  0581 0007                            BBF      s:21762,PREL
          2 000611  DCC6 0006                            LDB,B5   6,B6
          2 000613  8285                                 LB,'0004'X        ,B5
          2 000614       0004
          2 000615  0581 0004                            BBF      s:21759,PREL

      729    21760    3                   (KZ$HIPDEV.PRINTER AND NOT KZ$HIPDEV.ACTIVE) OR
      730    21761    3                   KZ$HIPDEV.CHN$->KH$CHN.AUTLGN
      731    21762    3                 THEN CALL CNC_DEV;

  21762   2 000617  E3C0 09A9                            LNJ,B6   s:0,PREL
          2 000619       0001                            DC       s:21759,PREL

  21759   2                              NO_WAY          null
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:138  
      732    21763    3   NO_WAY:       ;
      733    21764    3               END;

  21764   2 00061A  0F81 0005            NO_WAY          B        s:21769,PREL

      734    21765        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:139  
      735    21766    2            CASE(%KZ#LINFCN_DISABL);

      736    21767    2            CASE(ELSE);

      737    21768    2              CALL M$XXX;                  /* Unknown function from line-manager */

  21768   2 00061C  B870 0082                            LDR,R3   130,IMO
          2 00061E  0001                                 MCL
          2 00061F       0000                            DC       s:21768+3,PREL

      738    21769    2            END;                           /* End DO CASE(FCN)                   */

      739    21770        /**/
      740    21771    1   XIT:
      741    21772    1           IF VDH_FLG~=0 THEN

  21772   2 000620  E847 0027            XIT             LDR,R6   VDH_FLG,AUTO
          2 000622  6901 000A                            BEZ,R6   s:21775,PREL

      742    21773    1              CALL EXIT_VDH(KZ$HIPDEV.VDI$);

  21773   2 000624  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000626  DBC6 0004                            LAB,B5   4,B6
          2 000628  DFC7 0084                            STB,B5   TCNT+4,AUTO
          2 00062A  E3C0 0CC2                            LNJ,B6   s:0,PREL
          2 00062C       0001                            DC       s:21775,PREL

      743    21774        /**/
      744    21775    1           RETURN;

  21775   2 00062D  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      745    21776
      746    21777        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:140  
      747    21778    1   NO_MEMORY:
      748    21779        /*  NO_MEMORY - Disconnect the line due to a lack of memory  */
      749    21780                %ENABLE(INHLVL=KH_INHLVL);

  21781   2 000630  E847 0062            NO_MEMORY       LDR,R6   DISABLE_LEVEL,AUTO
          2 000632  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
          2 000635  0901 0007                            BE       s:21786,PREL

  21783   2 000637  CBF0 0000                            LAB,B4   0,IMO
          2 000639  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 00063C       0001                            DC       s:21786,PREL

      750    21786    1           CALL ERRLOG(%E$NO_MEMORY);

  21786   2 00063D  EBF0 00D0                            LAB,B6   208,IMO
          2 00063F  EFC7 008C                            STB,B6   @DFRD+4,AUTO
          2 000641  E3C0 0BA8                            LNJ,B6   s:0,PREL
          2 000643       0001                            DC       s:21787,PREL

      751    21787    1           CALL DSC_LINE;

  21787   2 000644  E3C0 0D73                            LNJ,B6   s:0,PREL
          2 000646       0001                            DC       s:21788,PREL

      752    21788    1           GOTO XIT;

  21788   2 000647  0FD9                                 B        s:21769,SPREL

      753    21789        %EJECT
      754    21790        /**/
      755    21791        /* KZH$DFR - Process deferred items */
      756    21792        /**/
      757    21793
      758    21794    1   KZH$DFR: ENTRY(PARM1) ALTRET;

  21794   2 000648  D380 0000 0000  xent KZH$DFR         LNJ,B5   X6A_AUTO_2
          2 00064B       00B1 0002                       DC       177,2
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:141  

      759    21795
      760    21796    1           DEV$=ADDR(DEVCTX);

  21796   2 00064D  ECC7 0004                            LDB,B6   @PARM1,AUTO
          2 00064F  EFC7 000D                            STB,B6   DEV$,AUTO

      761    21797    1           CTR$=KZ$HIPDEV.CTR$;

  21797   2 000651  DCC6 0002                            LDB,B5   2,B6
          2 000653  DFC7 000B                            STB,B5   CTR$,AUTO

      762    21798    1           LIN$=KZ$HIPCTR.LIN$;

  21798   2 000655  CCC5 0004                            LDB,B4   4,B5
          2 000657  CFC7 0009                            STB,B4   LIN$,AUTO

      763    21799    1           VDH_FLG=1;                      /* Already in VDH                     */

  21799   2 000659  6C01                                 LDV,R6   1
          2 00065A  EF47 0027                            STR,R6   VDH_FLG,AUTO

      764    21800        /**/
      765    21801    2           DO WHILE(KZ$HIPDEV.DFRHD$~=ADDR(NIL));

  21801   2 00065C  0F81 007E                            B        s:21823,PREL

      766    21802    2              BFR$=KZ$HIPDEV.DFRHD$;

  21802   2 00065E  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000660  DCC6 000C                            LDB,B5   12,B6
          2 000662  DFC7 001D                            STB,B5   BFR$,AUTO

      767    21803    2              KZ$HIPDEV.DFRHD$=KZ$OTPBFR.LNK$;

  21803   2 000664  CC85                                 LDB,B4   ,B5
          2 000665  CFC6 000C                            STB,B4   12,B6
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:142  

      768    21804    2              IF KZ$HIPDEV.DFRHD$=ADDR(NIL) THEN

  21804   2 000667  8DC6 000C                            CMN      12,B6
          2 000669  0981 0006                            BNE      s:21806,PREL

      769    21805    2                 KZ$HIPDEV.DFRTL$=ADDR(NIL);

  21805   2 00066B  BB80 0000 0000                       LAB,B3   0
          2 00066E  BFC6 000E                            STB,B3   14,B6

      770    21806    3              DO CASE(KZ$OTPBFR.TYP);

  21806   2 000670  B2C5 0002                            LLH,R3   2,B5
          2 000672  3D03                                 CMV,R3   3
          2 000673  0281 0067                            BGE      s:21823,PREL
          2 000675  A830 0000 067B  02                   LDR,R2   s:21806+11,R3
          2 000678  83A0 0000 067E  02                   JMP      s:21808,R2
          2 00067B       005D                            DC       s:21823,PREL
          2 00067C       0005                            DC       s:21810,PREL
          2 00067D       0000                            DC       s:21808,PREL

      771    21807    3               CASE(%KZ#BFRTYP_OTP);

      772    21808    3                 CALL RELOTPBFR;

  21808   2 00067E  E3C0 02CB                            LNJ,B6   s:0,PREL
          2 000680       0001                            DC       s:21808+3,PREL
          2 000681  0F81 0059                            B        s:21823,PREL

      773    21809    3               CASE(%KZ#BFRTYP_INP);

      774    21810    3                 KV$VDH_DAT=KV_VDH_DAT;

  21810   2 000683  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_DAT
          2 000686  2C00                                 LDV,R2   0
          2 000687  6C10                                 LDV,R6   16
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:143  
          2 000688  BBC7 0043                            LAB,B3   KV$VDH_DAT,AUTO
          2 00068A  3C00                                 LDV,R3   0
          2 00068B  0008                                 MMM

      775    21811    3                 KV$VDH_DAT.DAT__.ADR$=KZ$INPBFR.DATA$;

  21811   2 00068C  ECC7 001D                            LDB,B6   BFR$,AUTO
          2 00068E  DCC6 0006                            LDB,B5   6,B6
          2 000690  DFC7 0044                            STB,B5   KV$VDH_DAT+1,AUTO

      776    21812    3                 KV$VDH_DAT.DAT__.BYTX=KZ$INPBFR.BYTX;

  21812   2 000692  E846 0005                            LDR,R6   5,B6
          2 000694  EF47 0046                            STR,R6   KV$VDH_DAT+3,AUTO

      777    21813    3                 KV$VDH_DAT.DAT__.DATBYTSIZ=KZ$INPBFR.DATA_SIZ;

  21813   2 000696  D846 0003                            LDR,R5   3,B6
          2 000698  DF47 0047                            STR,R5   KV$VDH_DAT+4,AUTO

      778    21814    3                 CALL GIVE_VDH_DATA;

  21814   2 00069A  E3C0 0C97                            LNJ,B6   s:0,PREL
          2 00069C       0001                            DC       s:21815,PREL

      779    21815    3                 KZ@HIPSTT.KHSTT.INPBFRBYTUTL=KZ@HIPSTT.KHSTT.INPBFRBYTUTL-

  21815   2 00069D  EC80 0000 0006  xsym                 LDB,B6   KZ_HIP_HDR+6
          2 0006A0  DCC7 001D                            LDB,B5   BFR$,AUTO
          2 0006A2  F845 0004                            LDR,R7   4,B5
          2 0006A4  6C00                                 LDV,R6   0
          2 0006A5  7081                                 DOL,R7   1
          2 0006A6  8656                                 CPL      R6
          2 0006A7  8657                                 CPL      R7
          2 0006A8  8470 0000 0001                       AID      1,IMO
          2 0006AB  8446 001C                            AID      28,B6
          2 0006AD  8D46 001C                            SDI      28,B6
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:144  

      780    21816    3                   (KZ$INPBFR.BFR_SIZ*2);
      781    21817    3                 T$=KZ$INPBFR.DATA$;

  21817   2 0006AF  CCC5 0006                            LDB,B4   6,B5
          2 0006B1  CFC7 0011                            STB,B4   T$,AUTO

      782    21818    3                 I=KZ$INPBFR.BFR_SIZ;

  21818   2 0006B3  D845 0004                            LDR,R5   4,B5
          2 0006B5  DF47 0016                            STR,R5   CNT,AUTO

      783    21819    3                 CALL KVB$RLSSYS(I,T$);

  21819   2 0006B7  BBC7 0011                            LAB,B3   T$,AUTO
          2 0006B9  BFC7 00A6                            STB,B3   FPT_WRSYSLOG+24,AUTO
          2 0006BB  ABC7 0016                            LAB,B2   CNT,AUTO
          2 0006BD  AFC7 00A4                            STB,B2   FPT_WRSYSLOG+22,AUTO
          2 0006BF  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0006C1  CBF0 0200                            LAB,B4   512,IMO
          2 0006C3  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 0006C6       0001                            DC       s:21820,PREL

      784    21820    3                 T$=BFR$;

  21820   2 0006C7  ECC7 001D                            LDB,B6   BFR$,AUTO
          2 0006C9  EFC7 0011                            STB,B6   T$,AUTO

      785    21821    3                 CALL KVB$RLSSYS(SIZEW(KZ$INPBFR),T$);

  21821   2 0006CB  DBF0 0008                            LAB,B5   8,IMO
          2 0006CD  CBC7 0011                            LAB,B4   T$,AUTO
          2 0006CF  CFC7 00A6                            STB,B4   FPT_WRSYSLOG+24,AUTO
          2 0006D1  DFC7 00A4                            STB,B5   FPT_WRSYSLOG+22,AUTO
          2 0006D3  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0006D5  CBF0 0200                            LAB,B4   512,IMO
          2 0006D7  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:145  
          2 0006DA       0001                            DC       s:21823,PREL

      786    21822    3               END;

      787    21823    2              END;

  21823   2 0006DB  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 0006DD  8DC6 000C                            CMN      12,B6
          2 0006DF  0981 FF7E                            BNE      s:21802,PREL

      788    21824    1           RETURN;

  21824   2 0006E1  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      789    21825
      790    21826        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:146  
      791    21827        /**/
      792    21828        /* KZH$DSC - Disconnect processing */
      793    21829        /**/
      794    21830
      795    21831    1   KZH$DSC: ENTRY(PARM1) ALTRET;

  21831   2 0006E4  D380 0000 0000  xent KZH$DSC         LNJ,B5   X6A_AUTO_2
          2 0006E7       00B1 0002                       DC       177,2

      796    21832
      797    21833    1           DEV$=ADDR(DEVCTX);

  21833   2 0006E9  ECC7 0004                            LDB,B6   @PARM1,AUTO
          2 0006EB  EFC7 000D                            STB,B6   DEV$,AUTO

      798    21834    1           CTR$=KZ$HIPDEV.CTR$;

  21834   2 0006ED  DCC6 0002                            LDB,B5   2,B6
          2 0006EF  DFC7 000B                            STB,B5   CTR$,AUTO

      799    21835    1           LIN$=KZ$HIPCTR.LIN$;

  21835   2 0006F1  CCC5 0004                            LDB,B4   4,B5
          2 0006F3  CFC7 0009                            STB,B4   LIN$,AUTO

      800    21836    1           VDH_FLG=1;                      /* Already in VDH                     */

  21836   2 0006F5  6C01                                 LDV,R6   1
          2 0006F6  EF47 0027                            STR,R6   VDH_FLG,AUTO

      801    21837    1           CALL DSC_DEV(%KV_DSCRSN_PTH);

  21837   2 0006F8  BBF0 0002                            LAB,B3   2,IMO
          2 0006FA  BFC7 0076                            STB,B3   KZ@INPDESC+5,AUTO
          2 0006FC  E3C0 06D1                            LNJ,B6   s:0,PREL
          2 0006FE       0001                            DC       s:21838,PREL

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:147  
      802    21838    1           RETURN;

  21838   2 0006FF  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      803    21839
      804    21840    1   KZH$DSC_CONT: ENTRY(PARM1) ALTRET;

  21840   2 000702  D380 0000 0000  xent KZH$DSC_CONT    LNJ,B5   X6A_AUTO_2
          2 000705       00B1 0002                       DC       177,2

      805    21841
      806    21842    1           DEV$=ADDR(DEVCTX);

  21842   2 000707  ECC7 0004                            LDB,B6   @PARM1,AUTO
          2 000709  EFC7 000D                            STB,B6   DEV$,AUTO

      807    21843    1           CTR$=KZ$HIPDEV.CTR$;

  21843   2 00070B  DCC6 0002                            LDB,B5   2,B6
          2 00070D  DFC7 000B                            STB,B5   CTR$,AUTO

      808    21844    1           LIN$=KZ$HIPCTR.LIN$;

  21844   2 00070F  CCC5 0004                            LDB,B4   4,B5
          2 000711  CFC7 0009                            STB,B4   LIN$,AUTO

      809    21845    1           VDH_FLG=1;                      /* Already in VDH                     */

  21845   2 000713  6C01                                 LDV,R6   1
          2 000714  EF47 0027                            STR,R6   VDH_FLG,AUTO

      810    21846    1           CALL DSC_DEV_CONT(%KV_DSCRSN_PTH);

  21846   2 000716  BBF0 0002                            LAB,B3   2,IMO
          2 000718  BFC7 0076                            STB,B3   KZ@INPDESC+5,AUTO
          2 00071A  E3C0 07A2                            LNJ,B6   s:0,PREL
          2 00071C       0001                            DC       s:21847,PREL
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:148  

      811    21847    1           RETURN;

  21847   2 00071D  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      812    21848
      813    21849        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:149  
      814    21850        /**/
      815    21851        /* KZH$RELOTPBFR - Release an output buffer */
      816    21852        /**/
      817    21853
      818    21854    1   KZH$RELOTPBFR: ENTRY(PARM1,PARM2) ALTRET;

  21854   2 000720  D380 0000 0000  xent KZH$RELOTPBFR   LNJ,B5   X6A_AUTO_2
          2 000723       00B1 0002                       DC       177,2

      819    21855
      820    21856    1           DEV$=ADDR(DEVCTX);

  21856   2 000725  ECC7 0004                            LDB,B6   @PARM1,AUTO
          2 000727  EFC7 000D                            STB,B6   DEV$,AUTO

      821    21857    1           CTR$=KZ$HIPDEV.CTR$;

  21857   2 000729  DCC6 0002                            LDB,B5   2,B6
          2 00072B  DFC7 000B                            STB,B5   CTR$,AUTO

      822    21858    1           LIN$=KZ$HIPCTR.LIN$;

  21858   2 00072D  CCC5 0004                            LDB,B4   4,B5
          2 00072F  CFC7 0009                            STB,B4   LIN$,AUTO

      823    21859    1           VDH_FLG=1;                      /* Already in VDH                     */

  21859   2 000731  6C01                                 LDV,R6   1
          2 000732  EF47 0027                            STR,R6   VDH_FLG,AUTO

      824    21860    1           BFR$=OTPBFR$;

  21860   2 000734  BCC7 0006                            LDB,B3   @PARM2,AUTO
          2 000736  AC83                                 LDB,B2   ,B3
          2 000737  AFC7 001D                            STB,B2   BFR$,AUTO

      825    21861    1           CALL RELOTPBFR;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:150  

  21861   2 000739  E3C0 0210                            LNJ,B6   s:0,PREL
          2 00073B       0001                            DC       s:21862,PREL

      826    21862    1           CALL REQUEUE;

  21862   2 00073C  E3C0 03BF                            LNJ,B6   s:0,PREL
          2 00073E       0001                            DC       s:21863,PREL

      827    21863    1           RETURN;

  21863   2 00073F  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      828    21864
      829    21865        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:151  
      830    21866        /**/
      831    21867        /* KZH$RLSCTX - Release Context */
      832    21868        /**/
      833    21869
      834    21870    1   KZH$RLSCTX: ENTRY(PARM1) ALTRET;

  21870   2 000742  D380 0000 0000  xent KZH$RLSCTX      LNJ,B5   X6A_AUTO_2
          2 000745       00B1 0002                       DC       177,2

      835    21871
      836    21872    1           DEV$=ADDR(DEVCTX);

  21872   2 000747  ECC7 0004                            LDB,B6   @PARM1,AUTO
          2 000749  EFC7 000D                            STB,B6   DEV$,AUTO

      837    21873    1           KZ$HIPDEV.VDI$=ADDR(NIL);

  21873   2 00074B  DB80 0000 0000                       LAB,B5   0
          2 00074E  DFC6 0004                            STB,B5   4,B6

      838    21874    1           CTR$=KZ$HIPDEV.CTR$;

  21874   2 000750  CCC6 0002                            LDB,B4   2,B6
          2 000752  CFC7 000B                            STB,B4   CTR$,AUTO

      839    21875    1           LIN$=KZ$HIPCTR.LIN$;

  21875   2 000754  BCC4 0004                            LDB,B3   4,B4
          2 000756  BFC7 0009                            STB,B3   LIN$,AUTO

      840    21876    1           CALL RLS_DEV;

  21876   2 000758  E3C0 0405                            LNJ,B6   s:0,PREL
          2 00075A       0001                            DC       s:21877,PREL

      841    21877    1           RETURN;

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:152  
  21877   2 00075B  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      842    21878
      843    21879        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:153  
      844    21880        /**/
      845    21881        /* KZH$STATS - Get address and size of stats buffer
      846    21882
      847    21883        KZH$STATS: ENTRY(PARM1,PARM2) ALTRET;
      848    21884
      849    21885                ADDR(PARM1)->P$(0)=ADDR(KZ@HIPSTT);
      850    21886                PARM2=SIZEW(KZ@HIPSTT);
      851    21887                RETURN;                */
      852    21888        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:154  
      853    21889        /**/
      854    21890        /**/
      855    21891        /* Find controller context */
      856    21892        /**/
      857    21893        /**/
      858    21894    1   FND_CTR: PROC ALTRET;

  21894   2 00075E  EFC7 0074            FND_CTR         STB,B6   KZ@INPDESC+3,AUTO

      859    21895        /**/
      860    21896    2           IF I>31 THEN

  21896   2 000760  E847 0016                            LDR,R6   CNT,AUTO
          2 000762  6D1F                                 CMV,R6   31
          2 000763  0381 000C                            BLE      s:21906,PREL

      861    21897    3           DO;                             /* Got a bad controller number        */

      862    21898                       /*   ERROR: KZH-E$BADADR
      863    21899                          MESSAGE: GOT A BAD CTRL/DEV NUMBER.
      864    21900                          R3 = I = CONTROLLER NUM.
      865    21901                          R4 = J = DEVICE NUMBER.
      866    21902                       */
      867    21903    3   ERRDEV:    CALL ERRLOG(%E$BADADR);

  21903   2 000765  EBF0 00CB            ERRDEV          LAB,B6   203,IMO
          2 000767  EFC7 008C                            STB,B6   @DFRD+4,AUTO
          2 000769  E3C0 0A80                            LNJ,B6   s:0,PREL
          2 00076B       0001                            DC       s:21904,PREL

      868    21904    3              ALTRETURN;

  21904   2 00076C  ECC7 0074                            LDB,B6   KZ@INPDESC+3,AUTO
          2 00076E  B806                                 LDR,R3   ,B6
          2 00076F  C3B6                                 LNJ,B4   ,B6,R3

      869    21905    3              END;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:155  
      870    21906    2           CTR$=KZ$LINCTX.CTRHD$;

  21906   2 000770  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 000772  CC85                                 LDB,B4   ,B5
          2 000773  CFC7 000B                            STB,B4   CTR$,AUTO

      871    21907    3           DO WHILE(CTR$~=ADDR(NIL));

  21907   2 000775  0F81 0010                            B        s:21911,PREL

      872    21908    3              IF KZ$HIPCTR.ADR=I THEN

  21908   2 000777  ECC7 000B                            LDB,B6   CTR$,AUTO
          2 000779  E2C6 000A                            LLH,R6   10,B6
          2 00077B  E947 0016                            CMR,R6   CNT,AUTO
          2 00077D  0981 0005                            BNE      s:21910,PREL

      873    21909    3                 RETURN;

  21909   2 00077F  ECC7 0074                            LDB,B6   KZ@INPDESC+3,AUTO
          2 000781  C3C6 0001                            LNJ,B4   1,B6

      874    21910    3              CTR$=KZ$HIPCTR.LNK$;

  21910   2 000783  DC86                                 LDB,B5   ,B6
          2 000784  DFC7 000B                            STB,B5   CTR$,AUTO

      875    21911    3              END;

  21911   2 000786  8DC7 000B                            CMN      CTR$,AUTO
          2 000788  09EF                                 BNE      s:21908,SPREL

      876    21912    2           GOTO ERRDEV;

  21912   2 000789  0FDC                                 B        s:21897,SPREL

      877    21913        /**/
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:156  
      878    21914        /**/
      879    21915        /* Find device context given controller context */
      880    21916        /**/
      881    21917        /**/
      882    21918    2   FND_DEV: ENTRY ALTRET;

  21918   2 00078A  EFC7 0074            FND_DEV         STB,B6   KZ@INPDESC+3,AUTO

      883    21919        /**/
      884    21920    2           IF J>31 THEN

  21920   2 00078C  E847 0017                            LDR,R6   J,AUTO
          2 00078E  6D1F                                 CMV,R6   31
          2 00078F  0356                                 BG       s:21897,SPREL

      885    21921    2              GOTO ERRDEV;
      886    21922    2           DEV$=KZ$HIPCTR.DEVHD$;

  21922   2 000790  DCC7 000B                            LDB,B5   CTR$,AUTO
          2 000792  CCC5 0002                            LDB,B4   2,B5
          2 000794  CFC7 000D                            STB,B4   DEV$,AUTO

      887    21923    3           DO WHILE(DEV$~=ADDR(NIL));

  21923   2 000796  0F81 0010                            B        s:21927,PREL

      888    21924    3              IF KZ$HIPDEV.ADR=J THEN

  21924   2 000798  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 00079A  E2C6 0015                            LLH,R6   21,B6
          2 00079C  E947 0017                            CMR,R6   J,AUTO
          2 00079E  0981 0005                            BNE      s:21926,PREL

      889    21925    3                 RETURN;

  21925   2 0007A0  ECC7 0074                            LDB,B6   KZ@INPDESC+3,AUTO
          2 0007A2  C3C6 0001                            LNJ,B4   1,B6
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:157  

      890    21926    3              DEV$=KZ$HIPDEV.LNK$;

  21926   2 0007A4  DC86                                 LDB,B5   ,B6
          2 0007A5  DFC7 000D                            STB,B5   DEV$,AUTO

      891    21927    3              END;

  21927   2 0007A7  8DC7 000D                            CMN      DEV$,AUTO
          2 0007A9  09EF                                 BNE      s:21924,SPREL

      892    21928    2           GOTO ERRDEV;

  21928   2 0007AA  0F81 FFBA                            B        s:21897,PREL

      893    21929    2   END FND_CTR;
      894    21930        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:158  
      895    21931        /**/
      896    21932        /**/
      897    21933        /* Find device context */
      898    21934        /**/
      899    21935    1   FND_CTX: PROC ALTRET;

  21935   2 0007AC  EFC7 0074            FND_CTX         STB,B6   KZ@INPDESC+3,AUTO

      900    21936        /*N*  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!  *N*/
      901    21937        /*N*                                   NOBODY                               *N*/
      902    21938        /*N*                                   CALLS                                *N*/
      903    21939        /*N*                                   THIS                                 *N*/
      904    21940        /*N*                                   THING!                               *N*/
      905    21941        /*N*  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!  *N*/
      906    21942        /**/
      907    21943    2   DCL P$ PTR;
      908    21944        /**/
      909    21945        /*N* KLUDGE UNTIL PL6 FIXED */
      910    21946    2           STATUS=KZ$LINCTX.INPBFR$->BIT16(0)&'3F3F'X;

  21946   2 0007AE  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 0007B0  CCC5 0056                            LDB,B4   86,B5
          2 0007B2  E804                                 LDR,R6   ,B4
          2 0007B3  E570 3F3F                            AND,R6   16191,IMO
          2 0007B5  EF47 0021                            STR,R6   STATUS,AUTO

      911    21947    2           I=STATUSB.I;

  21947   2 0007B7  D2C7 0021                            LLH,R5   STATUS,AUTO
          2 0007B9  DF47 0016                            STR,R5   CNT,AUTO

      912    21948    2           J=STATUSB.J;

  21948   2 0007BB  C847 0021                            LDR,R4   STATUS,AUTO
          2 0007BD  C570 00FF                            AND,R4   255,IMO
          2 0007BF  CF47 0017                            STR,R4   J,AUTO

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:159  
      913    21949        /**/
      914    21950    2           CALL FND_CTR ALTRET(NO_CTR);

  21950   2 0007C1  E3C0 FF9C                            LNJ,B6   s:0,PREL
          2 0007C3       0014                            DC       s:21958,PREL

      915    21951    2           KZ$LINCTX.CURCTR$=CTR$;

  21951   2 0007C4  ECC7 000B                            LDB,B6   CTR$,AUTO
          2 0007C6  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 0007C8  EFC5 004E                            STB,B6   78,B5

      916    21952    2           CALL FND_DEV ALTRET(BLD_CTX);

  21952   2 0007CA  E3C0 FFBF                            LNJ,B6   s:0,PREL
          2 0007CC       000F                            DC       s:21961,PREL

      917    21953    2           KZ$LINCTX.CURDEV$=DEV$;

  21953   2 0007CD  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 0007CF  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 0007D1  EFC5 0050                            STB,B6   80,B5

      918    21954    2           RETURN;

  21954   2 0007D3  ECC7 0074                            LDB,B6   KZ@INPDESC+3,AUTO
          2 0007D5  C3C6 0001                            LNJ,B4   1,B6

      919    21955        /**/
      920    21956    2   NO_CTR:
      921    21957        /* No such controller - screech */
      922    21958    2           ALTRETURN;

  21958   2 0007D7  ECC7 0074            NO_CTR          LDB,B6   KZ@INPDESC+3,AUTO
          2 0007D9  B806                                 LDR,R3   ,B6
          2 0007DA  C3B6                                 LNJ,B4   ,B6,R3

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:160  
      923    21959        /**/
      924    21960    2   BLD_CTX:
      925    21961    2           CALL BLD_DEV_CTX ALTRET(NOMEM);

  21961   2 0007DB  E3C0 0010            BLD_CTX         LNJ,B6   s:0,PREL
          2 0007DD       000B                            DC       s:21965,PREL

      926    21962    2           KZ$LINCTX.CURDEV$=DEV$;

  21962   2 0007DE  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 0007E0  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 0007E2  EFC5 0050                            STB,B6   80,B5

      927    21963    2           RETURN;

  21963   2 0007E4  ECC7 0074                            LDB,B6   KZ@INPDESC+3,AUTO
          2 0007E6  C3C6 0001                            LNJ,B4   1,B6

      928    21964        /**/
      929    21965    2   NOMEM:  ALTRETURN;

  21965   2 0007E8  ECC7 0074            NOMEM           LDB,B6   KZ@INPDESC+3,AUTO
          2 0007EA  B806                                 LDR,R3   ,B6
          2 0007EB  C3B6                                 LNJ,B4   ,B6,R3

      930    21966        /**/
      931    21967    2   END FND_CTX;
      932    21968        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:161  
      933    21969        /**/
      934    21970        /**/
      935    21971        /* Build device context */
      936    21972        /**/
      937    21973        /**/
      938    21974    1   BLD_DEV_CTX: PROC ALTRET;

  21974   2 0007EC  EFC7 0074            BLD_DEV_CTX     STB,B6   KZ@INPDESC+3,AUTO

      939    21975        /**/
      940    21976                %DISABLE(INHLVL=KH_INHLVL);

  21977   2 0007EE  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          2 0007F1  EF47 0062                            STR,R6   DISABLE_LEVEL,AUTO

  21978   2 0007F3  DBC7 0062                            LAB,B5   DISABLE_LEVEL,AUTO
          2 0007F5  DFC7 00A4                            STB,B5   FPT_WRSYSLOG+22,AUTO
          2 0007F7  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0007F9  CBF0 0100                            LAB,B4   256,IMO
          2 0007FB  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 0007FE       0001                            DC       s:21980,PREL

      941    21980    2           CALL KVB$GETSYS(SIZEW(KZ$HIPDEV),T$) ALTRET(NOMEM);

  21980   2 0007FF  EBF0 0023                            LAB,B6   35,IMO
          2 000801  DBC7 0011                            LAB,B5   T$,AUTO
          2 000803  DFC7 00A6                            STB,B5   FPT_WRSYSLOG+24,AUTO
          2 000805  EFC7 00A4                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 000807  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000809  CBF0 0200                            LAB,B4   512,IMO
          2 00080B  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 00080E       0052                            DC       s:22002,PREL

      942    21981                %ENABLE(INHLVL=KH_INHLVL);

  21982   2 00080F  E847 0062                            LDR,R6   DISABLE_LEVEL,AUTO
          2 000811  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:162  
          2 000814  0901 0007                            BE       s:21987,PREL

  21984   2 000816  CBF0 0000                            LAB,B4   0,IMO
          2 000818  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 00081B       0001                            DC       s:21987,PREL

      943    21987    2           KZ@HIPSTT.KHSTT.CTXBYTUTL = KZ@HIPSTT.KHSTT.CTXBYTUTL + SIZEC(KZ$HIPDEV);

  21987   2 00081C  EC80 0000 0006  xsym                 LDB,B6   KZ_HIP_HDR+6
          2 00081F  8CC6 0020                            LDI      32,B6
          2 000821  8470 0000 0046                       AID      70,IMO
          2 000824  8D46 0020                            SDI      32,B6

      944    21988    2           DEV$=T$;

  21988   2 000826  DCC7 0011                            LDB,B5   T$,AUTO
          2 000828  DFC7 000D                            STB,B5   DEV$,AUTO

      945    21989    2           KZ$LINCTX.CURDEV$=DEV$;

  21989   2 00082A  CCC7 0009                            LDB,B4   LIN$,AUTO
          2 00082C  DFC4 0050                            STB,B5   80,B4

      946    21990    2           KZ$HIPDEV=KZ_HIPDEV;

  21990   2 00082E  AB80 0000 0000  01                   LAB,B2   KZ_CLMEVENT
          2 000831  2C72                                 LDV,R2   114
          2 000832  6C46                                 LDV,R6   70
          2 000833  BB85                                 LAB,B3   ,B5
          2 000834  3C00                                 LDV,R3   0
          2 000835  0008                                 MMM

      947    21991    2           KZ$HIPDEV.CTR$=CTR$;

  21991   2 000836  ECC7 000B                            LDB,B6   CTR$,AUTO
          2 000838  CCC7 000D                            LDB,B4   DEV$,AUTO
          2 00083A  EFC4 0002                            STB,B6   2,B4
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:163  

      948    21992    2           KZ$HIPDEV.ADR=J;

  21992   2 00083C  E847 0017                            LDR,R6   J,AUTO
          2 00083E  E7C4 0015                            STH,R6   21,B4

      949    21993    2           KZ$HIPDEV.ROWS=KZ$HIPCTR.ROWS;

  21993   2 000840  D846 0009                            LDR,R5   9,B6
          2 000842  D570 00FF                            AND,R5   255,IMO
          2 000844  D7C4 0019                            STH,R5   25,B4

      950    21994    2           KZ$HIPDEV.COLS=KZ$HIPCTR.COLS;

  21994   2 000846  D2C6 0009                            LLH,R5   9,B6
          2 000848  DAC4 0019                            SRM,R5,'00FF'X    25,B4
          2 00084A       00FF

      951    21995    2           IF KZ$HIPCTR.TYP=3276 THEN

  21995   2 00084B  D846 0008                            LDR,R5   8,B6
          2 00084D  D970 0CCC                            CMR,R5   3276,IMO
          2 00084F  0981 0004                            BNE      s:21997,PREL

      952    21996    2              KZ$HIPDEV.EWALT='1'B;

  21996   2 000851  8944 0012                            LBT,'2000'X       18,B4
  21996   2 000853       2000

      953    21997    2           KZ$HIPDEV.LNK$=KZ$HIPCTR.DEVHD$;

  21997   2 000854  ACC6 0002                            LDB,B2   2,B6
          2 000856  AF84                                 STB,B2   ,B4

      954    21998    2           KZ$HIPCTR.DEVHD$=DEV$;

  21998   2 000857  CFC6 0002                            STB,B4   2,B6
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:164  

      955    21999    2           CALL SET_PRO;

  21999   2 000859  E3C0 007C                            LNJ,B6   s:0,PREL
          2 00085B       0001                            DC       s:22000,PREL

      956    22000    2           RETURN;

  22000   2 00085C  ECC7 0074                            LDB,B6   KZ@INPDESC+3,AUTO
          2 00085E  C3C6 0001                            LNJ,B4   1,B6

      957    22001        /**/
      958    22002    2   NOMEM:  ALTRETURN;

  22002   2 000860  ECC7 0074            NOMEM           LDB,B6   KZ@INPDESC+3,AUTO
          2 000862  B806                                 LDR,R3   ,B6
          2 000863  C3B6                                 LNJ,B4   ,B6,R3

      959    22003
      960    22004    2   END BLD_DEV_CTX;
      961    22005        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:165  
      962    22006        /**/
      963    22007        /**/
      964    22008        /* Build controller context */
      965    22009        /**/
      966    22010        /**/
      967    22011    1   BLD_CTR_CTX: PROC ALTRET;

  22011   2 000864  EFC7 0074            BLD_CTR_CTX     STB,B6   KZ@INPDESC+3,AUTO

      968    22012        /**/
      969    22013                %DISABLE(INHLVL=KH_INHLVL);

  22014   2 000866  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          2 000869  EF47 0062                            STR,R6   DISABLE_LEVEL,AUTO

  22015   2 00086B  DBC7 0062                            LAB,B5   DISABLE_LEVEL,AUTO
          2 00086D  DFC7 00A4                            STB,B5   FPT_WRSYSLOG+22,AUTO
          2 00086F  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000871  CBF0 0100                            LAB,B4   256,IMO
          2 000873  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000876       0001                            DC       s:22017,PREL

      970    22017    2           CALL KVB$GETSYS(SIZEW(KZ$HIPCTR),T$) ALTRET(NOMEM);

  22017   2 000877  EBF0 000B                            LAB,B6   11,IMO
          2 000879  DBC7 0011                            LAB,B5   T$,AUTO
          2 00087B  DFC7 00A6                            STB,B5   FPT_WRSYSLOG+24,AUTO
          2 00087D  EFC7 00A4                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 00087F  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000881  CBF0 0200                            LAB,B4   512,IMO
          2 000883  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 000886       004C                            DC       s:22039,PREL

      971    22018                %ENABLE(INHLVL=KH_INHLVL);

  22019   2 000887  E847 0062                            LDR,R6   DISABLE_LEVEL,AUTO
          2 000889  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:166  
          2 00088C  0901 0007                            BE       s:22024,PREL

  22021   2 00088E  CBF0 0000                            LAB,B4   0,IMO
          2 000890  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 000893       0001                            DC       s:22024,PREL

      972    22024    2           KZ@HIPSTT.KHSTT.CTXBYTUTL = KZ@HIPSTT.KHSTT.CTXBYTUTL + SIZEC(KZ$HIPCTR);

  22024   2 000894  EC80 0000 0006  xsym                 LDB,B6   KZ_HIP_HDR+6
          2 000897  8CC6 0020                            LDI      32,B6
          2 000899  8470 0000 0016                       AID      22,IMO
          2 00089C  8D46 0020                            SDI      32,B6

      973    22025    2           CTR$=T$;

  22025   2 00089E  DCC7 0011                            LDB,B5   T$,AUTO
          2 0008A0  DFC7 000B                            STB,B5   CTR$,AUTO

      974    22026    2           KZ$HIPCTR=KZ_HIPCTR;

  22026   2 0008A2  AB80 0000 0000  01                   LAB,B2   KZ_CLMEVENT
          2 0008A5  2C5C                                 LDV,R2   92
          2 0008A6  6C16                                 LDV,R6   22
          2 0008A7  BB85                                 LAB,B3   ,B5
          2 0008A8  3C00                                 LDV,R3   0
          2 0008A9  0008                                 MMM

      975    22027    2           P1$=ADDR(NIL);

  22027   2 0008AA  EB80 0000 0000                       LAB,B6   0
          2 0008AD  EFC7 0013                            STB,B6   P1$,AUTO

      976    22028    2           T$=KZ$LINCTX.CTRHD$;

  22028   2 0008AF  CCC7 0009                            LDB,B4   LIN$,AUTO
          2 0008B1  AC84                                 LDB,B2   ,B4
          2 0008B2  AFC7 0011                            STB,B2   T$,AUTO
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:167  

      977    22029    3           DO WHILE(T$~=ADDR(NIL));

  22029   2 0008B4  0F81 0008                            B        s:22032,PREL

      978    22030    3              P1$=T$;

  22030   2 0008B6  ECC7 0011                            LDB,B6   T$,AUTO
          2 0008B8  EFC7 0013                            STB,B6   P1$,AUTO

      979    22031    3              T$=T$->KZ$HIPCTR.LNK$;

  22031   2 0008BA  DC86                                 LDB,B5   ,B6
          2 0008BB  DFC7 0011                            STB,B5   T$,AUTO

      980    22032    3              END;

  22032   2 0008BD  8DC7 0011                            CMN      T$,AUTO
          2 0008BF  09F7                                 BNE      s:22030,SPREL

      981    22033    2           IF P1$~=ADDR(NIL) THEN

  22033   2 0008C0  8DC7 0013                            CMN      P1$,AUTO
          2 0008C2  0901 0006                            BE       s:22036,PREL

      982    22034    2              P1$->KZ$HIPCTR.LNK$=CTR$;

  22034   2 0008C4  DCC7 000B                            LDB,B5   CTR$,AUTO
          2 0008C6  DF86                                 STB,B5   ,B6
          2 0008C7  0F81 0006                            B        s:22037,PREL

      983    22035    2           ELSE
      984    22036    2              KZ$LINCTX.CTRHD$=CTR$;

  22036   2 0008C9  DCC7 000B                            LDB,B5   CTR$,AUTO
          2 0008CB  CCC7 0009                            LDB,B4   LIN$,AUTO
          2 0008CD  DF84                                 STB,B5   ,B4
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:168  

      985    22037    2           RETURN;

  22037   2 0008CE  ECC7 0074                            LDB,B6   KZ@INPDESC+3,AUTO
          2 0008D0  C3C6 0001                            LNJ,B4   1,B6

      986    22038        /**/
      987    22039    2   NOMEM:  ALTRETURN;

  22039   2 0008D2  ECC7 0074            NOMEM           LDB,B6   KZ@INPDESC+3,AUTO
          2 0008D4  B806                                 LDR,R3   ,B6
          2 0008D5  C3B6                                 LNJ,B4   ,B6,R3

      988    22040    2   END BLD_CTR_CTX;
      989    22041        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:169  
      990    22042        /**/
      991    22043        /**/
      992    22044        /* Initialize the PRO field in the dev context */
      993    22045        /**/
      994    22046        /**/
      995    22047    1   SET_PRO: PROC;

  22047   2 0008D6  EFC7 0078            SET_PRO         STB,B6   J+1,AUTO

      996    22048        /**/
      997    22049    2           KZ$HIPDEV.PRO='0'B;

  22049   2 0008D8  DCC7 000D                            LDB,B5   DEV$,AUTO
          2 0008DA  87C5 0011                            CLH      17,B5

      998    22050    2           IF KZ$HIPDEV.EWALT THEN

  22050   2 0008DC  82C5 0012                            LB,'2000'X        18,B5
  22050   2 0008DE       2000
          2 0008DF  0581 0004                            BBF      s:22052,PREL

      999    22051    2              KZ$HIPDEV.PRO.EWALT='1'B;

  22051   2 0008E1  8945 0011                            LBT,'8000'X       17,B5
  22051   2 0008E3       8000

     1000    22052    2           RETURN;

  22052   2 0008E4  ECC7 0078                            LDB,B6   J+1,AUTO
          2 0008E6  C3C6 0001                            LNJ,B4   1,B6

     1001    22053    2   END SET_PRO;
     1002    22054        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:170  
     1003    22055    1   REBUILD_POLL_LIST:PROC ALTRET;

  22055   2 0008E8  EFC7 0074            REBUILD_POLL_LI*STB,B6   KZ@INPDESC+3,AUTO

     1004    22056
     1005    22057    2   DCL I SBIN;
     1006    22058    2   DCL J SBIN;
     1007    22059
     1008    22060        /* The MLCP needs a list of poll addresses in order to
     1009    22061            poll the entire list. When ever a controller connects or
     1010    22062           disconnects, the poll list must be rebuilt */
     1011    22063
     1012    22064    2           KZ$LINCTX.POLLTBL$->KZ$POLLHIP.REBUILD_POLL='0'B;

  22064   2 0008EA  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 0008EC  CCC5 0083                            LDB,B4   131,B5
          2 0008EE  8804                                 LBF,'0040'X       ,B4
          2 0008EF       0040

     1013    22065    2           KZ$LINCTX.POLLTBL$->KZ$POLLHIP.INDX=0;

  22065   2 0008F0  ECC5 0083                            LDB,B6   131,B5
          2 0008F2  8786                                 CLH      ,B6

     1014    22066    2           KZ$LINCTX.POLLTBL$->KZ$POLLHIP.POLLX=0;

  22066   2 0008F3  ECC5 0083                            LDB,B6   131,B5
          2 0008F5  8806                                 LBF,'003F'X       ,B6
          2 0008F6       003F

     1015    22067    2           KZ$LINCTX.POLLTBL$->KZ$POLLHIP.CONTINUE_POLL='1'B;

  22067   2 0008F7  ECC5 0083                            LDB,B6   131,B5
          2 0008F9  8906                                 LBT,'0080'X       ,B6
          2 0008FA       0080

     1016    22068    2           J=0;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:171  

  22068   2 0008FB  8747 0077                            CL       J,AUTO

     1017    22069    3           DO I=0 TO KZ$LINCTX.POLSIZ-1;

  22069   2 0008FD  8747 0076                            CL       I,AUTO
          2 0008FF  0F81 0014                            B        s:22074+2,PREL

     1018    22070    3              IF KZ$LINCTX.POLLST$->UBYT(I)~=0 THEN

  22070   2 000901  ECC7 0009                            LDB,B6   LIN$,AUTO
          2 000903  DCC6 0066                            LDB,B5   102,B6
          2 000905  B847 0076                            LDR,R3   I,AUTO
          2 000907  E2B5                                 LLH,R6   ,B5,R3
          2 000908  6901 0009                            BEZ,R6   s:22074,PREL

     1019    22071    4              DO;

     1020    22072    4                KZ$LINCTX.POLLTBL$->KZ$POLLHIP.POLL_LIST(J)= KZ$LINCTX.POLLST$->UBYT(I
             22072                          ); J=J+1;

  22072   2 00090A  CCC6 0083                            LDB,B4   131,B6
          2 00090C  A847 0077                            LDR,R2   J,AUTO
          2 00090E  2E02                                 ADV,R2   2
          2 00090F  E7A4                                 STH,R6   ,B4,R2

  22072   2 000910  8AC7 0077                            INC      J,AUTO

     1021    22073    4                 END;

     1022    22074    3              END /* DO */;

  22074   2 000912  8AC7 0076                            INC      I,AUTO
          2 000914  ECC7 0009                            LDB,B6   LIN$,AUTO
          2 000916  E847 0076                            LDR,R6   I,AUTO
          2 000918  E946 0065                            CMR,R6   101,B6
          2 00091A  0867                                 BAL      s:22070,SPREL
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:172  

     1023    22075    2           IF J=0 THEN

  22075   2 00091B  D847 0077                            LDR,R5   J,AUTO
          2 00091D  5981 0005                            BNEZ,R5  s:22077,PREL

     1024    22076    2              ALTRETURN;                   /* NO ACTIVE CONTROLLERS EXIST        */

  22076   2 00091F  ECC7 0074                            LDB,B6   KZ@INPDESC+3,AUTO
          2 000921  B806                                 LDR,R3   ,B6
          2 000922  C3B6                                 LNJ,B4   ,B6,R3

     1025    22077    2   END REBUILD_POLL_LIST;

  22077   2 000923  ECC7 0074                            LDB,B6   KZ@INPDESC+3,AUTO
          2 000925  C3C6 0001                            LNJ,B4   1,B6

     1026    22078        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:173  
     1027    22079        /**/
     1028    22080        /* UNQRELOTPBFR - unqueue the head of the current output devices
     1029    22081            output buffer chain, and release the output buffer.
     1030    22082        */
     1031    22083    1   UNQRELOTPBFR: PROC ALTRET;

  22083   2 000927  EFC7 007E            UNQRELOTPBFR    STB,B6   DEV2$+4,AUTO

     1032    22084
     1033    22085    2   DCL OTPBYTES UBIN;
     1034    22086    2   DCL I UBIN;
     1035    22087
     1036    22088    2           DEV$=KZ$LINCTX.CURDEV$;

  22088   2 000929  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 00092B  CCC5 0050                            LDB,B4   80,B5
          2 00092D  CFC7 000D                            STB,B4   DEV$,AUTO

     1037    22089    2           CTR$=KZ$HIPDEV.CTR$;

  22089   2 00092F  BCC4 0002                            LDB,B3   2,B4
          2 000931  BFC7 000B                            STB,B3   CTR$,AUTO

     1038    22090    2           BFR$=KZ$HIPDEV.OTPHD$;

  22090   2 000933  ACC4 0008                            LDB,B2   8,B4
          2 000935  AFC7 001D                            STB,B2   BFR$,AUTO

     1039    22091
     1040    22092    2           KZ$HIPDEV.OTPHD$=BFR$->KZ$OTPBFR.LNK$;

  22092   2 000937  9C82                                 LDB,B1   ,B2
          2 000938  9FC4 0008                            STB,B1   8,B4

     1041    22093    2           KZ$HIPDEV.OTPCNT=KZ$HIPDEV.OTPCNT-1;

  22093   2 00093A  88C4 0010                            DEC      16,B4
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:174  

     1042    22094    2           IF KZ$HIPDEV.OTPCNT=0 THEN

  22094   2 00093C  E844 0010                            LDR,R6   16,B4
          2 00093E  6981 0006                            BNEZ,R6  s:22097,PREL

     1043    22095    2              KZ$HIPDEV.OTPTL$=ADDR(NIL);

  22095   2 000940  EB80 0000 0000                       LAB,B6   0
          2 000943  EFC4 000A                            STB,B6   10,B4

     1044    22096
     1045    22097    2           KZ$HIPDEV.OTPBSY='0'B;

  22097   2 000945  8844 0012                            LBF,'0400'X       18,B4
  22097   2 000947       0400
          2 000948  0F81 0003                            B        s:0+2,PREL

     1046    22098        /**/
     1047    22099        /* RELOTPBFR - Release output buffer chain */
     1048    22100        /**/
     1049    22101    2   RELOTPBFR: ENTRY ALTRET;

  22101   2 00094A  EFC7 007E            RELOTPBFR       STB,B6   DEV2$+4,AUTO
          2 00094C  0F81 0174                            B        s:22215,PREL

     1050    22102        /**/
     1051    22103        /**/
     1052    22104        /* This internal proc is called *only* any of the following conditions hold:
     1053    22105            1) Throttling or output marks exist in buffer
     1054    22106            2) VDH_FLG=1 (we are already in VDH)
     1055    22107            3) Disconnect code is in progress.
     1056    22108        */
     1057    22109    2   VDH_SPECIFIC:PROC ALTRET;

  22109   2 00094E  EFC7 0082            VDH_SPECIFIC    STB,B6   TCNT+2,AUTO

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:175  
     1058    22110
     1059    22111        /**/
     1060    22112    3           CALL ENTER_VDH(KZ$HIPDEV.VDI$, DFRD);

  22112   2 000950  DBC7 0026                            LAB,B5   DFRD,AUTO
          2 000952  DFC7 0088                            STB,B5   T$+1,AUTO
          2 000954  CCC7 000D                            LDB,B4   DEV$,AUTO
          2 000956  BBC4 0004                            LAB,B3   4,B4
          2 000958  BFC7 0086                            STB,B3   @VDI$+2,AUTO
          2 00095A  E3C0 0932                            LNJ,B6   s:0,PREL
          2 00095C       0001                            DC       s:22113,PREL

     1061    22113    4           IF DFRD='1'B THEN DO;           /* Can't get to VDH now               */

  22113   2 00095D  89C7 0026                            CMZ      DFRD,AUTO
          2 00095F  0881 001E                            BAGE     s:22124,PREL

     1062    22114    4              IF KZ$HIPDEV.DFRTL$~=ADDR(NIL) THEN

  22114   2 000961  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000963  8DC6 000E                            CMN      14,B6
          2 000965  0901 0008                            BE       s:22117,PREL

     1063    22115    4                 KZ$HIPDEV.DFRTL$->KZ$OTPBFR.LNK$=BFR$;

  22115   2 000967  DCC6 000E                            LDB,B5   14,B6
          2 000969  CCC7 001D                            LDB,B4   BFR$,AUTO
          2 00096B  CF85                                 STB,B4   ,B5
          2 00096C  0F81 0005                            B        s:22118,PREL

     1064    22116    4              ELSE
     1065    22117    4                 KZ$HIPDEV.DFRHD$=BFR$;

  22117   2 00096E  DCC7 001D                            LDB,B5   BFR$,AUTO
          2 000970  DFC6 000C                            STB,B5   12,B6

     1066    22118    4              KZ$HIPDEV.DFRTL$=BFR$;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:176  

  22118   2 000972  DCC7 001D                            LDB,B5   BFR$,AUTO
          2 000974  DFC6 000E                            STB,B5   14,B6

     1067    22119    4              KZ$OTPBFR.LNK$=ADDR(NIL);

  22119   2 000976  CB80 0000 0000                       LAB,B4   0
          2 000979  CF85                                 STB,B4   ,B5

     1068    22120    4              ALTRETURN;

  22120   2 00097A  ECC7 0082                            LDB,B6   TCNT+2,AUTO
          2 00097C  B806                                 LDR,R3   ,B6
          2 00097D  C3B6                                 LNJ,B4   ,B6,R3

     1069    22121    4              END;
     1070    22122        /**/
     1071    22123        /**/
     1072    22124    4           IF KZ$OTPBFR.MRKCNT~=0 THEN DO; /* Output markers                     */

  22124   2 00097E  ECC7 001D                            LDB,B6   BFR$,AUTO
          2 000980  82C6 0005                            LB,'00FF'X        5,B6
          2 000982       00FF
          2 000983  0581 004A                            BBF      s:22136,PREL

     1073    22125    4              TBFR$=PINCRW(BFR$,KZ_HIP_BFRSIZ(KZ$OTPBFR.BFRSIZ)-

  22125   2 000985  B846 0004                            LDR,R3   4,B6
          2 000987  E846 0005                            LDR,R6   5,B6
          2 000989  E570 00FF                            AND,R6   255,IMO
          2 00098B  6FFD                                 MLV,R6   -3
          2 00098C  EA30 0000 0000  xsym                 ADD,R6   KZ_HIP_BFRSIZ,R3
          2 00098F  A856                                 LDR,R2   R6
          2 000990  DBA6                                 LAB,B5   ,B6,R2
          2 000991  DFC7 001F                            STB,B5   TBFR$,AUTO

     1074    22126    4                SIZEW(KV$OTPMRK)*KZ$OTPBFR.MRKCNT);
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:177  
     1075    22127    5              DO WHILE(KZ$OTPBFR.MRKCNT~=0);

  22127   2 000993  82C6 0005                            LB,'00FF'X        5,B6
  22127   2 000995       00FF
          2 000996  0581 0037                            BBF      s:22136,PREL

     1076    22128    5                 KV$VDH_OTPMRK=KV_VDH_OTPMRK;

  22128   2 000998  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_OTPMRK
          2 00099B  2C00                                 LDV,R2   0
          2 00099C  6C0A                                 LDV,R6   10
          2 00099D  BBC7 005A                            LAB,B3   KV$VDH_OTPMRK,AUTO
          2 00099F  3C00                                 LDV,R3   0
          2 0009A0  0008                                 MMM

     1077    22129    5                 KV$VDH_OTPMRK.DAT=TBFR$->KV$OTPMRK;

  22129   2 0009A1  ACC7 001F                            LDB,B2   TBFR$,AUTO
          2 0009A3  2C00                                 LDV,R2   0
          2 0009A4  6C06                                 LDV,R6   6
          2 0009A5  BBC7 005B                            LAB,B3   KV$VDH_OTPMRK+1,AUTO
          2 0009A7  3C00                                 LDV,R3   0
          2 0009A8  0008                                 MMM

     1078    22130    5                 KV$VDH_OTPMRK.CMPCOD=KZ$OTPBFR.CMPCOD;

  22130   2 0009A9  ECC7 001D                            LDB,B6   BFR$,AUTO
          2 0009AB  E2C6 0005                            LLH,R6   5,B6
          2 0009AD  EF47 005E                            STR,R6   KV$VDH_OTPMRK+4,AUTO

     1079    22131    5                 CALL KVV$VDI(KV$VDH_OTPMRK);

  22131   2 0009AF  DBC7 005A                            LAB,B5   KV$VDH_OTPMRK,AUTO
          2 0009B1  DFC7 00A4                            STB,B5   FPT_WRSYSLOG+22,AUTO
          2 0009B3  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0009B5  CBF0 0100                            LAB,B4   256,IMO
          2 0009B7  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:178  
          2 0009BA       0001                            DC       s:22132,PREL

     1080    22132    5                 TBFR$=PINCRW(TBFR$,SIZEW(KV$OTPMRK));

  22132   2 0009BB  ECC7 001F                            LDB,B6   TBFR$,AUTO
          2 0009BD  DBC6 0003                            LAB,B5   3,B6
          2 0009BF  DFC7 001F                            STB,B5   TBFR$,AUTO

     1081    22133    5                 KZ$OTPBFR.MRKCNT=KZ$OTPBFR.MRKCNT-1;

  22133   2 0009C1  ECC7 001D                            LDB,B6   BFR$,AUTO
          2 0009C3  E846 0005                            LDR,R6   5,B6
          2 0009C5  EA70 00FF                            ADD,R6   255,IMO
          2 0009C7  EAC6 0005                            SRM,R6,'00FF'X    5,B6
          2 0009C9       00FF

     1082    22134    5                 END;

  22134   2 0009CA  82C6 0005                            LB,'00FF'X        5,B6
  22134   2 0009CC       00FF
          2 0009CD  054B                                 BBT      s:22128,SPREL

     1083    22135    4              END;

     1084    22136    3           CALL RLS_BUFFER;

  22136   2 0009CE  E3C0 0057                            LNJ,B6   s:0,PREL
          2 0009D0       0001                            DC       s:22137,PREL

     1085    22137    4           IF KZ$HIPDEV.THROTL THEN DO;

  22137   2 0009D1  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 0009D3  82C6 0012                            LB,'1000'X        18,B6
          2 0009D5       1000
          2 0009D6  0581 0027                            BBF      s:22162,PREL

     1086    22138    4              IF KZ$HIPDEV.PRINTER = '1'B AND KZ$HIPDEV.OTPCNT ~=0 THEN
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:179  

  22138   2 0009D8  82C6 0012                            LB,'0800'X        18,B6
  22138   2 0009DA       0800
          2 0009DB  0581 000A                            BBF      s:22141,PREL
          2 0009DD  E846 0010                            LDR,R6   16,B6
          2 0009DF  6901 0006                            BEZ,R6   s:22141,PREL

     1087    22139    4                 KZ$HIPDEV.THROTL = '1'B;

  22139   2 0009E1  8946 0012                            LBT,'1000'X       18,B6
  22139   2 0009E3       1000
          2 0009E4  0F81 0019                            B        s:22162,PREL

     1088    22140    5              ELSE DO;

     1089    22141    5                 KZ$HIPDEV.THROTL = '0'B;

  22141   2 0009E6  8846 0012                            LBF,'1000'X       18,B6
  22141   2 0009E8       1000

     1090    22142                      %KV$RQSOTP(RQSOTP=YES);
             22154    6           IF NOT KV$PTR.VDI$->KV$VDI.RQSOTP  THEN DO;

  22154   2 0009E9  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          2 0009EC  CC85                                 LDB,B4   ,B5
          2 0009ED  82C4 0019                            LB,'0008'X        25,B4
          2 0009EF       0008
          2 0009F0  0501 000D                            BBT      s:22162,PREL

             22155    6              KV$PTR.VDI$->KV$VDI.RQSOTP = '1'B;

  22155   2 0009F2  8944 0019                            LBT,'0008'X       25,B4
  22155   2 0009F4       0008

             22156    6              CALL KVV$VDI(KV_VDH_EVT_RQSOTP);

  22156   2 0009F5  BB80 0000 0001  03                   LAB,B3   +1
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:180  
          2 0009F8  CBF0 0100                            LAB,B4   256,IMO
          2 0009FA  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 0009FD       0001                            DC       s:22162,PREL

             22157    6              END;                         /* END IF                             */

     1091    22160    5                 END;

     1092    22161    4              END;

     1093    22162    3           IF (KZ$HIPDEV.DONE) AND (KZ$HIPDEV.OTPCNT=0) THEN

  22162   2 0009FE  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000A00  82C6 0012                            LB,'0200'X        18,B6
          2 000A02       0200
          2 000A03  0581 000D                            BBF      s:22165,PREL
          2 000A05  E846 0010                            LDR,R6   16,B6
          2 000A07  6981 0009                            BNEZ,R6  s:22165,PREL

     1094    22163    3              CALL KZH$CMPOTP(KZ$HIPDEV) /* FLUSH OUT LAST BUFFER */;

  22163   2 000A09  BBC7 000D                            LAB,B3   DEV$,AUTO
          2 000A0B  CBF0 0100                            LAB,B4   256,IMO
          2 000A0D  E380 0000 0000  xent                 LNJ,B6   KZH$CMPOTP
          2 000A10       0001                            DC       s:22165,PREL

     1095    22164        /**/
     1096    22165    3           IF KZ$HIPDEV.DSC.VDH_FINAL AND KZ$HIPDEV.OTPHD$=ADDR(NIL)

  22165   2 000A11  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000A13  82C6 0015                            LB,'0020'X        21,B6
          2 000A15       0020
          2 000A16  0581 000B                            BBF      s:22170,PREL
          2 000A18  8DC6 0008                            CMN      8,B6
          2 000A1A  0981 0007                            BNE      s:22170,PREL

     1097    22166    4           THEN DO;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:181  

     1098    22167    4              KZ$HIPDEV.DSC.DEV_FINAL='1'B; /* All output drained                */

  22167   2 000A1C  8946 0015                            LBT,'0010'X       21,B6
  22167   2 000A1E       0010

     1099    22168    4              CALL DSC_DEV_FINAL;

  22168   2 000A1F  E3C0 04B9                            LNJ,B6   s:0,PREL
          2 000A21       0001                            DC       s:22170,PREL

     1100    22169    4              END;

     1101    22170    3   END VDH_SPECIFIC;

  22170   2 000A22  ECC7 0082                            LDB,B6   TCNT+2,AUTO
          2 000A24  C3C6 0001                            LNJ,B4   1,B6

     1102    22171
     1103    22172        /**/
     1104    22173
     1105    22174        /*  This internal procedure is called whether or not VDH
     1106    22175            has to be entered */
     1107    22176
     1108    22177    2   RLS_BUFFER:PROC;

  22177   2 000A26  EFC7 0084            RLS_BUFFER      STB,B6   TCNT+4,AUTO

     1109    22178        /**/
     1110    22179    3   DCL I SBIN;
     1111    22180    3   DCL T$ PTR;
     1112    22181        /**/
     1113    22182    3           IF KZ$OTPBFR.FLAGS.CNT# THEN

  22182   2 000A28  DCC7 001D                            LDB,B5   BFR$,AUTO
          2 000A2A  82C5 0002                            LB,'0020'X        2,B5
          2 000A2C       0020
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:182  
          2 000A2D  0581 0009                            BBF      s:22184,PREL

     1114    22183    3              KZ$HIPDEV.OTPBYTES=KZ$HIPDEV.OTPBYTES-KZ$OTPBFR.DATA_SIZ;

  22183   2 000A2F  CCC7 000D                            LDB,B4   DEV$,AUTO
          2 000A31  E844 0014                            LDR,R6   20,B4
          2 000A33  E245 0003                            SUB,R6   3,B5
          2 000A35  EF44 0014                            STR,R6   20,B4

     1115    22184    3           IF KZ$HIPDEV.OTPBYTES~=0 AND KZ$HIPDEV.OTPHD$=ADDR(NIL) AND

  22184   2 000A37  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000A39  E846 0014                            LDR,R6   20,B6
          2 000A3B  6901 0019                            BEZ,R6   s:22189,PREL
          2 000A3D  8DC6 0008                            CMN      8,B6
          2 000A3F  0981 0015                            BNE      s:22189,PREL
          2 000A41  82C6 0012                            LB,'0400'X        18,B6
          2 000A43       0400
          2 000A44  0501 0010                            BBT      s:22189,PREL
          2 000A46  8DC6 000C                            CMN      12,B6
          2 000A48  0981 000C                            BNE      s:22189,PREL

     1116    22185    4             NOT KZ$HIPDEV.OTPBSY AND KZ$HIPDEV.DFRHD$=ADDR(NIL) THEN DO;

     1117    22186    4              CALL ERRLOG(%E$THRERR);

  22186   2 000A4A  CBF0 00C9                            LAB,B4   201,IMO
          2 000A4C  CFC7 008C                            STB,B4   @DFRD+4,AUTO
          2 000A4E  E3C0 079B                            LNJ,B6   s:0,PREL
          2 000A50       0001                            DC       s:22187,PREL

     1118    22187    4              KZ$HIPDEV.OTPBYTES=0;

  22187   2 000A51  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000A53  8746 0014                            CL       20,B6

     1119    22188    4              END;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:183  

     1120    22189    3           T$=BFR$;

  22189   2 000A55  DCC7 001D                            LDB,B5   BFR$,AUTO
          2 000A57  DFC7 0087                            STB,B5   T$,AUTO

     1121    22190    3           I=KZ_HIP_BFRSIZ(KZ$OTPBFR.BFRSIZ);

  22190   2 000A59  B845 0004                            LDR,R3   4,B5
          2 000A5B  E830 0000 0000  xsym                 LDR,R6   KZ_HIP_BFRSIZ,R3
          2 000A5E  EF47 0086                            STR,R6   I,AUTO

     1122    22191    3           KZ@HIPSTT.OTPBFRSIZ(KZ$OTPBFR.BFRSIZ)=

  22191   2 000A60  B845 0004                            LDR,R3   4,B5
          2 000A62  CC80 0000 0006  xsym                 LDB,B4   KZ_HIP_HDR+6
          2 000A65  BF47 00A4                            STR,R3   FPT_WRSYSLOG+22,AUTO
          2 000A67  3E41                                 ADV,R3   65
          2 000A68  8CB4                                 LDI      ,B4,R3
          2 000A69  8470 FFFF FFFF                       AID      -1,IMO
          2 000A6C  B847 00A4                            LDR,R3   FPT_WRSYSLOG+22,AUTO
          2 000A6E  3E41                                 ADV,R3   65
          2 000A6F  8D34                                 SDI      ,B4,R3

     1123    22192    3             KZ@HIPSTT.OTPBFRSIZ(KZ$OTPBFR.BFRSIZ)-1;
     1124    22193    3           KZ@HIPSTT.KHSTT.OTPBFRBYTUTL = KZ@HIPSTT.KHSTT.OTPBFRBYTUTL - I*2;

  22193   2 000A70  CC80 0000 0006  xsym                 LDB,B4   KZ_HIP_HDR+6
          2 000A73  E847 0086                            LDR,R6   I,AUTO
          2 000A75  70F0                                 DAR,R7   16
          2 000A76  7081                                 DOL,R7   1
          2 000A77  8656                                 CPL      R6
          2 000A78  8657                                 CPL      R7
          2 000A79  8470 0000 0001                       AID      1,IMO
          2 000A7C  8444 001E                            AID      30,B4
          2 000A7E  8D44 001E                            SDI      30,B4

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:184  
     1125    22194    4           IF KZ$OTPBFR.CMPCOD=0 THEN DO;

  22194   2 000A80  D2C5 0005                            LLH,R5   5,B5
          2 000A82  5981 000C                            BNEZ,R5  s:22199,PREL

     1126    22195    4              KZ@HIPSTT.CHROUT=KZ@HIPSTT.CHROUT+KZ$OTPBFR.DATA_SIZ;

  22195   2 000A84  F845 0003                            LDR,R7   3,B5
          2 000A86  6C00                                 LDV,R6   0
          2 000A87  8444 0022                            AID      34,B4
          2 000A89  8D44 0022                            SDI      34,B4

     1127    22196    4              KZ@HIPSTT.BLKOUT=KZ@HIPSTT.BLKOUT+1;

  22196   2 000A8B  8AC4 0027                            INC      39,B4
          2 000A8D  8EC4 0026                            CAD      38,B4

     1128    22197    4              END;

     1129    22198                %DISABLE(INHLVL=KH_INHLVL);

  22199   2 000A8F  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          2 000A92  EF47 0062                            STR,R6   DISABLE_LEVEL,AUTO

  22200   2 000A94  BBC7 0062                            LAB,B3   DISABLE_LEVEL,AUTO
          2 000A96  BFC7 00A4                            STB,B3   FPT_WRSYSLOG+22,AUTO
          2 000A98  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000A9A  CBF0 0100                            LAB,B4   256,IMO
          2 000A9C  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000A9F       0001                            DC       s:22202,PREL

     1130    22202    3           CALL KVB$RLSSYS(I,T$);

  22202   2 000AA0  EBC7 0087                            LAB,B6   T$,AUTO
          2 000AA2  EFC7 00A6                            STB,B6   FPT_WRSYSLOG+24,AUTO
          2 000AA4  DBC7 0086                            LAB,B5   I,AUTO
          2 000AA6  DFC7 00A4                            STB,B5   FPT_WRSYSLOG+22,AUTO
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:185  
          2 000AA8  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000AAA  CBF0 0200                            LAB,B4   512,IMO
          2 000AAC  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 000AAF       0001                            DC       s:22204,PREL

     1131    22203                %ENABLE(INHLVL=KH_INHLVL);

  22204   2 000AB0  E847 0062                            LDR,R6   DISABLE_LEVEL,AUTO
          2 000AB2  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
          2 000AB5  0901 0007                            BE       s:22209,PREL

  22206   2 000AB7  CBF0 0000                            LAB,B4   0,IMO
          2 000AB9  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 000ABC       0001                            DC       s:22209,PREL

     1132    22209    3   END RLS_BUFFER;

  22209   2 000ABD  ECC7 0084                            LDB,B6   TCNT+4,AUTO
          2 000ABF  C3C6 0001                            LNJ,B4   1,B6

     1133    22210
     1134    22211
     1135    22212
     1136    22213        /* Finally, the code that does the actual work:
     1137    22214        */
     1138    22215    2           IF (KZ$OTPBFR.MRKCNT~=0)

  22215   2 000AC1  ECC7 001D                            LDB,B6   BFR$,AUTO
          2 000AC3  82C6 0005                            LB,'00FF'X        5,B6
          2 000AC5       00FF
          2 000AC6  0501 001C                            BBT      s:22221,PREL
          2 000AC8  DCC7 000D                            LDB,B5   DEV$,AUTO
          2 000ACA  82C5 0012                            LB,'1000'X        18,B5
          2 000ACC       1000
          2 000ACD  0501 0015                            BBT      s:22221,PREL
          2 000ACF  82C5 0015                            LB,'00FF'X        21,B5
          2 000AD1       00FF
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:186  
          2 000AD2  0501 0010                            BBT      s:22221,PREL
          2 000AD4  82C5 0012                            LB,'0200'X        18,B5
          2 000AD6       0200
          2 000AD7  0581 0006                            BBF      s:22215+29,PREL
          2 000AD9  E845 0010                            LDR,R6   16,B5
          2 000ADB  6D01                                 CMV,R6   1
          2 000ADC  0381 0006                            BLE      s:22221,PREL
          2 000ADE  E847 0027                            LDR,R6   VDH_FLG,AUTO
          2 000AE0  6D01                                 CMV,R6   1
          2 000AE1  0981 000F                            BNE      s:22226,PREL

     1139    22216    2             OR (KZ$HIPDEV.THROTL)
     1140    22217    2             OR (KZ$HIPDEV.DSC)
     1141    22218    2             OR (KZ$HIPDEV.DONE AND (KZ$HIPDEV.OTPCNT<=1))
     1142    22219    2             OR (VDH_FLG=1) THEN
     1143    22220    3           DO;

     1144    22221    3              CALL VDH_SPECIFIC ALTRET(DEFERRED_BUFFER);

  22221   2 000AE3  E3C0 FE6A                            LNJ,B6   s:0,PREL
          2 000AE5       0013                            DC       s:22222,PREL

     1145    22222    3              CALL EXIT_VDH(KZ$HIPDEV.VDI$);

  22222   2 000AE6  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000AE8  DBC6 0004                            LAB,B5   4,B6
          2 000AEA  DFC7 0084                            STB,B5   TCNT+4,AUTO
          2 000AEC  E3C0 0800                            LNJ,B6   s:0,PREL
          2 000AEE       0001                            DC       s:22223,PREL

     1146    22223    3              END;

  22223   2 000AEF  0F81 0004                            B        s:22228,PREL

     1147    22224    2           ELSE
     1148    22225    3           DO;

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:187  
     1149    22226    3              CALL RLS_BUFFER;

  22226   2 000AF1  E3C0 FF34                            LNJ,B6   s:0,PREL
          2 000AF3       0001                            DC       s:22228,PREL

     1150    22227    3              END;

     1151    22228    2           RETURN /*  BUFFER RELEASED, NORMAL EXIT */;

  22228   2 000AF4  ECC7 007E                            LDB,B6   DEV2$+4,AUTO
          2 000AF6  C3C6 0001                            LNJ,B4   1,B6

  22222   2                              DEFERRED_BUFFER null
     1152    22229    2   DEFERRED_BUFFER:;
     1153    22230        /**/
     1154    22231    2           ALTRETURN /* INDICATE VDH NEEDED, AND CANT ENTER VDH */;

  22231   2 000AF8  ECC7 007E            DEFERRED_BUFFER LDB,B6   DEV2$+4,AUTO
          2 000AFA  B806                                 LDR,R3   ,B6
          2 000AFB  C3B6                                 LNJ,B4   ,B6,R3

     1155    22232        /**/
     1156    22233    2   END UNQRELOTPBFR;
     1157    22234
     1158    22235        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:188  
     1159    22236        /**/
     1160    22237        /**/
     1161    22238        /*       Hook the current device backup upon awaiting output queue
     1162    22239                 if it qualifies..  output queued, not halted, and not already
     1163    22240                 on the list
     1164    22241        */
     1165    22242        /**/
     1166    22243    1   REQUEUE: PROC ALTRET;

  22243   2 000AFC  EFC7 007C            REQUEUE         STB,B6   DEV2$+2,AUTO

     1167    22244    2   DCL TDEV$ PTR;
     1168    22245    2   DCL TCNT SBIN;
     1169    22246        /**/
     1170    22247    2           IF(NOT KZ$HIPDEV.ONOTP)AND(KZ$HIPDEV.OTPCNT~=0)AND

  22247   2 000AFE  DCC7 000D                            LDB,B5   DEV$,AUTO
          2 000B00  82C5 001C                            LB,'0010'X        28,B5
          2 000B02       0010
          2 000B03  0501 0056                            BBT      s:22272,PREL
          2 000B05  E845 0010                            LDR,R6   16,B5
          2 000B07  6901 0052                            BEZ,R6   s:22272,PREL
          2 000B09  82C5 0012                            LB,'00FF'X        18,B5
          2 000B0B       00FF
          2 000B0C  0581 0006                            BBF      s:22250,PREL
          2 000B0E  82C5 0012                            LB,'0080'X        18,B5
          2 000B10       0080
          2 000B11  0581 0048                            BBF      s:22272,PREL

     1171    22248    2             (NOT (KZ$HIPDEV.HLT AND (NOT KZ$HIPDEV.HLT.WACK))) THEN
     1172    22249    3           DO;

     1173    22250    3              TDEV$=KZ$LINCTX.OTPHD$;

  22250   2 000B13  CCC7 0009                            LDB,B4   LIN$,AUTO
          2 000B15  BCC4 0052                            LDB,B3   82,B4
          2 000B17  BFC7 007E                            STB,B3   TDEV$,AUTO
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:189  

     1174    22251    3              TCNT=KZ$LINCTX.OTPCNT;

  22251   2 000B19  D844 004D                            LDR,R5   77,B4
          2 000B1B  DF47 0080                            STR,R5   TCNT,AUTO

     1175    22252
     1176    22253    4   DEBUGGING: DO WHILE((TDEV$~=ADDR(NIL)) AND (TCNT>0));

  22253   2 000B1D  0F81 000D            DEBUGGING       B        s:22258,PREL

     1177    22254
     1178    22255    4                 IF TDEV$=DEV$ THEN EXIT DEBUGGING;

  22255   2 000B1F  ECC7 007E                            LDB,B6   TDEV$,AUTO
          2 000B21  EDC7 000D                            CMB,B6   DEV$,AUTO
          2 000B23  0901 000E                            BE       s:22260,PREL

     1179    22256    4                 TDEV$=TDEV$->KZ$HIPDEV.OTPLNK$;

  22256   2 000B25  DCC6 001D                            LDB,B5   29,B6
          2 000B27  DFC7 007E                            STB,B5   TDEV$,AUTO

     1180    22257    4                 TCNT=TCNT-1;

  22257   2 000B29  88C7 0080                            DEC      TCNT,AUTO

     1181    22258    4                 END DEBUGGING;

  22258   2 000B2B  8DC7 007E                            CMN      TDEV$,AUTO
          2 000B2D  0901 0004                            BE       s:22260,PREL
          2 000B2F  E847 0080                            LDR,R6   TCNT,AUTO
          2 000B31  6A6E                                 BGZ,R6   s:22255,SPREL

     1182    22259
     1183    22260    3              IF (TDEV$~=ADDR(NIL)) OR (TCNT~=0) THEN

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:190  
  22260   2 000B32  8DC7 007E                            CMN      TDEV$,AUTO
          2 000B34  0981 0005                            BNE      s:22261,PREL
          2 000B36  E847 0080                            LDR,R6   TCNT,AUTO
          2 000B38  6901 0005                            BEZ,R6   s:22262,PREL

     1184    22261    3                 ALTRETURN;

  22261   2 000B3A  ECC7 007C                            LDB,B6   DEV2$+2,AUTO
          2 000B3C  B806                                 LDR,R3   ,B6
          2 000B3D  C3B6                                 LNJ,B4   ,B6,R3

     1185    22262    3              KZ$HIPDEV.OTPLNK$=ADDR(NIL);

  22262   2 000B3E  EB80 0000 0000                       LAB,B6   0
          2 000B41  DCC7 000D                            LDB,B5   DEV$,AUTO
          2 000B43  EFC5 001D                            STB,B6   29,B5

     1186    22263    3              IF KZ$LINCTX.OTPCNT=0 THEN

  22263   2 000B45  CCC7 0009                            LDB,B4   LIN$,AUTO
          2 000B47  D844 004D                            LDR,R5   77,B4
          2 000B49  5981 0005                            BNEZ,R5  s:22266,PREL

     1187    22264    3                 KZ$LINCTX.OTPHD$=DEV$;

  22264   2 000B4B  DFC4 0052                            STB,B5   82,B4
          2 000B4D  0F81 0005                            B        s:22267,PREL

     1188    22265    3              ELSE
     1189    22266    3                 KZ$LINCTX.OTPTL$->KZ$HIPDEV.OTPLNK$=DEV$;

  22266   2 000B4F  BCC4 0054                            LDB,B3   84,B4
          2 000B51  DFC3 001D                            STB,B5   29,B3

     1190    22267    3              KZ$LINCTX.OTPTL$=DEV$;

  22267   2 000B53  DFC4 0054                            STB,B5   84,B4
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:191  

     1191    22268    3              KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT+1;

  22268   2 000B55  8AC4 004D                            INC      77,B4

     1192    22269    3              KZ$HIPDEV.ONOTP='1'B;

  22269   2 000B57  8945 001C                            LBT,'0010'X       28,B5
  22269   2 000B59       0010

     1193    22270    3              END;

     1194    22271        /**/
     1195    22272    2           RETURN;

  22272   2 000B5A  ECC7 007C                            LDB,B6   DEV2$+2,AUTO
          2 000B5C  C3C6 0001                            LNJ,B4   1,B6

     1196    22273
     1197    22274    2   END REQUEUE;
     1198    22275        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:192  
     1199    22276        /**/
     1200    22277        /* RLS_DEV - Release Device Context */
     1201    22278        /**/
     1202    22279    1   RLS_DEV: PROC;

  22279   2 000B5E  EFC7 0074            RLS_DEV         STB,B6   KZ@INPDESC+3,AUTO

     1203    22280
     1204    22281    2           IF KZ$HIPDEV.VDI$~=ADDR(NIL) THEN

  22281   2 000B60  DCC7 000D                            LDB,B5   DEV$,AUTO
          2 000B62  8DC5 0004                            CMN      4,B5
          2 000B64  0901 0005                            BE       s:22283,PREL

     1205    22282    2              RETURN;

  22282   2 000B66  ECC7 0074                            LDB,B6   KZ@INPDESC+3,AUTO
          2 000B68  C3C6 0001                            LNJ,B4   1,B6

     1206    22283    3           IF KZ$HIPDEV.REACT THEN DO;

  22283   2 000B6A  82C5 001C                            LB,'0040'X        28,B5
  22283   2 000B6C       0040
          2 000B6D  0581 0007                            BBF      s:22287,PREL

     1207    22284    3              KZ$HIPDEV.REACT='0'B;

  22284   2 000B6F  8845 001C                            LBF,'0040'X       28,B5
  22284   2 000B71       0040

     1208    22285    3              KZ$HIPDEV.ACTIVE='1'B;

  22285   2 000B72  8945 0012                            LBT,'4000'X       18,B5
  22285   2 000B74       4000

     1209    22286    3              END;

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:193  
     1210    22287    3           IF KZ$LINCTX.FLAGS.DSC THEN DO;

  22287   2 000B75  ECC7 0009                            LDB,B6   LIN$,AUTO
          2 000B77  82C6 0034                            LB,'1000'X        52,B6
          2 000B79       1000
          2 000B7A  0581 002F                            BBF      s:22301,PREL

     1211    22288    4              DO CASE (KZ$LINCTX.DSC_LEV);

  22288   2 000B7C  B846 0085                            LDR,R3   133,B6
          2 000B7E  B570 00FF                            AND,R3   255,IMO
          2 000B80  3D04                                 CMV,R3   4
          2 000B81  0281 002F                            BGE      s:22304,PREL
          2 000B83  A830 0000 0B89  02                   LDR,R2   s:22288+13,R3
          2 000B86  83A0 0000 0B8D  02                   JMP      s:22290,R2
          2 000B89       001B                            DC       s:22299,PREL
          2 000B8A       0000                            DC       s:22290,PREL
          2 000B8B       0005                            DC       s:22292,PREL
          2 000B8C       000F                            DC       s:22295,PREL

     1212    22289    4               CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                            */

     1213    22290    4                 CALL REALLY_CLR_DEV;

  22290   2 000B8D  E3C0 00D6                            LNJ,B6   s:0,PREL
          2 000B8F       0001                            DC       s:22290+3,PREL
          2 000B90  0F81 0020                            B        s:22304,PREL

     1214    22291    4               CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                   */

     1215    22292    4                 CALL CLR_DEV;

  22292   2 000B92  E3C0 009C                            LNJ,B6   s:0,PREL
          2 000B94       0001                            DC       s:22293,PREL

     1216    22293    4                 KZ$HIPDEV.CLRD='1'B;

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:194  
  22293   2 000B95  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000B97  8946 001C                            LBT,'0004'X       28,B6
          2 000B99       0004
          2 000B9A  0F81 0016                            B        s:22304,PREL

     1217    22294    4               CASE (%TERMINAL_ID_LEV_SUBSUBCHAN#); /* Device                    */

     1218    22295    4                 CALL CLR_DEV;

  22295   2 000B9C  E3C0 0092                            LNJ,B6   s:0,PREL
          2 000B9E       0001                            DC       s:22296,PREL

     1219    22296    4                 KZ$LINCTX.FLAGS.DSC='0'B;

  22296   2 000B9F  ECC7 0009                            LDB,B6   LIN$,AUTO
          2 000BA1  8846 0034                            LBF,'1000'X       52,B6
          2 000BA3       1000

     1220    22297    4                 RETURN;

  22297   2 000BA4  ECC7 0074                            LDB,B6   KZ@INPDESC+3,AUTO
          2 000BA6  C3C6 0001                            LNJ,B4   1,B6

     1221    22298    4               END;

     1222    22299    3              END;

  22299   2 000BA8  0F81 0008                            B        s:22304,PREL

     1223    22300    3           ELSE DO;

     1224    22301    3              CALL CLR_DEV;

  22301   2 000BAA  E3C0 0084                            LNJ,B6   s:0,PREL
          2 000BAC       0001                            DC       s:22302,PREL

     1225    22302    3              RETURN;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:195  

  22302   2 000BAD  ECC7 0074                            LDB,B6   KZ@INPDESC+3,AUTO
          2 000BAF  C3C6 0001                            LNJ,B4   1,B6

     1226    22303    3              END;
     1227    22304    2           DEV$=KZ$HIPCTR.DEVHD$;

  22304   2 000BB1  ECC7 000B                            LDB,B6   CTR$,AUTO
          2 000BB3  DCC6 0002                            LDB,B5   2,B6
          2 000BB5  DFC7 000D                            STB,B5   DEV$,AUTO

     1228    22305    3           DO WHILE (DEV$~=ADDR(NIL));

  22305   2 000BB7  0F81 000F                            B        s:22308,PREL

     1229    22306    3              IF KZ$HIPDEV.CLRD = '0'B THEN RETURN;

  22306   2 000BB9  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000BBB  82C6 001C                            LB,'0004'X        28,B6
          2 000BBD       0004
          2 000BBE  0501 0005                            BBT      s:22307,PREL

  22306   2 000BC0  ECC7 0074                            LDB,B6   KZ@INPDESC+3,AUTO
          2 000BC2  C3C6 0001                            LNJ,B4   1,B6

     1230    22307    3              DEV$=KZ$HIPDEV.LNK$;

  22307   2 000BC4  DC86                                 LDB,B5   ,B6
          2 000BC5  DFC7 000D                            STB,B5   DEV$,AUTO

     1231    22308    3              END;

  22308   2 000BC7  8DC7 000D                            CMN      DEV$,AUTO
          2 000BC9  09F0                                 BNE      s:22306,SPREL

     1232    22309    2           CALL RLS_CTR;

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:196  
  22309   2 000BCA  E3C0 0006                            LNJ,B6   s:0,PREL
          2 000BCC       0001                            DC       s:22310,PREL

     1233    22310    2   END RLS_DEV;

  22310   2 000BCD  ECC7 0074                            LDB,B6   KZ@INPDESC+3,AUTO
          2 000BCF  C3C6 0001                            LNJ,B4   1,B6

     1234    22311
     1235    22312        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:197  
     1236    22313        /**/
     1237    22314        /* RLS_CTR - Release controller context */
     1238    22315        /**/
     1239    22316
     1240    22317    1   RLS_CTR: PROC;

  22317   2 000BD1  EFC7 0076            RLS_CTR         STB,B6   I,AUTO

     1241    22318    3           DO CASE (KZ$LINCTX.DSC_LEV);

  22318   2 000BD3  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 000BD5  B845 0085                            LDR,R3   133,B5
          2 000BD7  B570 00FF                            AND,R3   255,IMO
          2 000BD9  3D03                                 CMV,R3   3
          2 000BDA  0281 002E                            BGE      s:22331,PREL
          2 000BDC  A830 0000 0BE2  02                   LDR,R2   s:22318+15,R3
          2 000BDF  83A0 0000 0BE5  02                   JMP      s:22320,R2
          2 000BE2       0024                            DC       s:22331,PREL
          2 000BE3       0000                            DC       s:22320,PREL
          2 000BE4       0005                            DC       s:22322,PREL

     1242    22319    3            CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                               */

     1243    22320    3              CALL REALLY_CLR_CTR;

  22320   2 000BE5  E3C0 00F4                            LNJ,B6   s:0,PREL
          2 000BE7       0001                            DC       s:22320+3,PREL
          2 000BE8  0F81 0020                            B        s:22331,PREL

     1244    22321    3            CASE (%TERMINAL_ID_LEV_SUBCHAN#); /* Controller                      */

     1245    22322    3              CALL CLR_CTR;

  22322   2 000BEA  E3C0 006E                            LNJ,B6   s:0,PREL
          2 000BEC       0001                            DC       s:22323,PREL

     1246    22323    3              DEV$=KZ$HIPCTR.DEVHD$;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:198  

  22323   2 000BED  ECC7 000B                            LDB,B6   CTR$,AUTO
          2 000BEF  DCC6 0002                            LDB,B5   2,B6
          2 000BF1  DFC7 000D                            STB,B5   DEV$,AUTO

     1247    22324    4              DO WHILE (DEV$~=ADDR(NIL));

  22324   2 000BF3  0F81 0009                            B        s:22327,PREL

     1248    22325    4                 KZ$HIPDEV.CLRD = '0'B;

  22325   2 000BF5  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000BF7  8846 001C                            LBF,'0004'X       28,B6
          2 000BF9       0004

     1249    22326    4                 DEV$=KZ$HIPDEV.LNK$;

  22326   2 000BFA  DC86                                 LDB,B5   ,B6
          2 000BFB  DFC7 000D                            STB,B5   DEV$,AUTO

     1250    22327    4                 END;

  22327   2 000BFD  8DC7 000D                            CMN      DEV$,AUTO
          2 000BFF  09F6                                 BNE      s:22325,SPREL

     1251    22328    3              KZ$LINCTX.FLAGS.DSC='0'B;

  22328   2 000C00  ECC7 0009                            LDB,B6   LIN$,AUTO
          2 000C02  8846 0034                            LBF,'1000'X       52,B6
          2 000C04       1000

     1252    22329    3              RETURN;

  22329   2 000C05  ECC7 0076                            LDB,B6   I,AUTO
          2 000C07  C3C6 0001                            LNJ,B4   1,B6

     1253    22330    3            END;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:199  

     1254    22331    2           IF KZ$LINCTX.CTRHD$=ADDR(NIL) THEN CALL RLS_LINE;

  22331   2 000C09  ECC7 0009                            LDB,B6   LIN$,AUTO
          2 000C0B  8D86                                 CMN      ,B6
          2 000C0C  0981 0004                            BNE      s:22332,PREL

  22331   2 000C0E  E3C0 0006                            LNJ,B6   s:0,PREL
          2 000C10       0001                            DC       s:22332,PREL

     1255    22332    2   END RLS_CTR;

  22332   2 000C11  ECC7 0076                            LDB,B6   I,AUTO
          2 000C13  C3C6 0001                            LNJ,B4   1,B6

     1256    22333
     1257    22334        /* RLS_LINE - Release line context */
     1258    22335
     1259    22336    1   RLS_LINE: PROC;

  22336   2 000C15  EFC7 0078            RLS_LINE        STB,B6   J+1,AUTO

     1260    22337    3           DO CASE (KZ$LINCTX.DSC_LEV);

  22337   2 000C17  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 000C19  B845 0085                            LDR,R3   133,B5
          2 000C1B  B570 00FF                            AND,R3   255,IMO
          2 000C1D  3D02                                 CMV,R3   2
          2 000C1E  0281 000C                            BGE      s:22341,PREL
          2 000C20  A830 0000 0C26  02                   LDR,R2   s:22337+15,R3
          2 000C23  83A0 0000 0C28  02                   JMP      s:22339,R2
          2 000C26       0003                            DC       s:22341,PREL
          2 000C27       0000                            DC       s:22339,PREL

     1261    22338    3            CASE (%TERMINAL_ID_LEV_CHAN#); /* Line                               */

     1262    22339    3              CALL REALLY_CLR_LINE;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:200  

  22339   2 000C28  E3C0 0119                            LNJ,B6   s:0,PREL
          2 000C2A       0001                            DC       s:22341,PREL

     1263    22340    3            END;

     1264    22341    2   END RLS_LINE;

  22341   2 000C2B  ECC7 0078                            LDB,B6   J+1,AUTO
          2 000C2D  C3C6 0001                            LNJ,B4   1,B6

     1265    22342        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:201  
     1266    22343    1   CLR_DEV: PROC;

  22343   2 000C2F  EFC7 0076            CLR_DEV         STB,B6   I,AUTO

     1267    22344    2           KZ$HIPDEV.AWAIT_ENABLE='0'B;

  22344   2 000C31  DCC7 000D                            LDB,B5   DEV$,AUTO
          2 000C33  8845 001C                            LBF,'0008'X       28,B5
          2 000C35       0008

     1268    22345    2           KZ$HIPDEV.THROTL='0'B;

  22345   2 000C36  8845 0012                            LBF,'1000'X       18,B5
  22345   2 000C38       1000

     1269    22346    2           KZ$HIPDEV.OTPBSY='0'B;

  22346   2 000C39  8845 0012                            LBF,'0400'X       18,B5
  22346   2 000C3B       0400

     1270    22347    2           KZ$HIPDEV.HLT='0'B;

  22347   2 000C3C  8845 0012                            LBF,'00FF'X       18,B5
  22347   2 000C3E       00FF

     1271    22348                /*  OTPBYTES is not reset here:  there still may be some
     1272    22349                    output on the DFR queue.  */
     1273    22350    2           KZ$HIPDEV.DSC='0'B;

  22350   2 000C3F  8845 0015                            LBF,'00FF'X       21,B5
  22350   2 000C41       00FF

     1274    22351    2           KZ$HIPDEV.KBDLCK='1'B;

  22351   2 000C42  8945 001C                            LBT,'0080'X       28,B5
  22351   2 000C44       0080

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:202  
     1275    22352    2           KZ$HIPDEV.DSC_LATER='0'B;

  22352   2 000C45  8845 001C                            LBF,'0020'X       28,B5
  22352   2 000C47       0020

     1276    22353        /*      KZ$HIPDEV.MUST_SBA='0'B;*/
     1277    22354        /*      KZ$HIPDEV.PRINTER_DOWNS=0;*/
     1278    22355        /*      KZ$HIPCTR.PRINTER_CNC_DONE='0'B;*/
     1279    22356    2           CALL SET_PRO;

  22356   2 000C48  E3C0 FC8D                            LNJ,B6   s:0,PREL
          2 000C4A       0001                            DC       s:22357,PREL

     1280    22357    2           IF KZ$HIPDEV.ACTIVE THEN

  22357   2 000C4B  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000C4D  82C6 0012                            LB,'4000'X        18,B6
          2 000C4F       4000
          2 000C50  0581 0004                            BBF      s:22359,PREL

     1281    22358    2              CALL CNC_DEV;

  22358   2 000C52  E3C0 036E                            LNJ,B6   s:0,PREL
          2 000C54       0001                            DC       s:22359,PREL

     1282    22359    2   END;

  22359   2 000C55  ECC7 0076                            LDB,B6   I,AUTO
          2 000C57  C3C6 0001                            LNJ,B4   1,B6

     1283    22360
     1284    22361    1   CLR_CTR: PROC;

  22361   2 000C59  EFC7 0078            CLR_CTR         STB,B6   J+1,AUTO

     1285    22362    2           KZ$HIPCTR.TIMED_OUT_ONCE='0'B;

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:203  
  22362   2 000C5B  DCC7 000B                            LDB,B5   CTR$,AUTO
          2 000C5D  8845 000A                            LBF,'0080'X       10,B5
          2 000C5F       0080

     1286    22363        /*      KZ$HIPCTR.PRINTER_CNC_DONE='0'B;*/
     1287    22364    2   END;

  22364   2 000C60  ECC7 0078                            LDB,B6   J+1,AUTO
          2 000C62  C3C6 0001                            LNJ,B4   1,B6

     1288    22365
     1289    22366    1   REALLY_CLR_DEV: PROC;

  22366   2 000C64  EFC7 0076            REALLY_CLR_DEV  STB,B6   I,AUTO

     1290    22367    2           T$=KZ$HIPCTR.DEVHD$;

  22367   2 000C66  DCC7 000B                            LDB,B5   CTR$,AUTO
          2 000C68  CCC5 0002                            LDB,B4   2,B5
          2 000C6A  CFC7 0011                            STB,B4   T$,AUTO

     1291    22368    2           P1$=ADDR(NIL);

  22368   2 000C6C  BB80 0000 0000                       LAB,B3   0
          2 000C6F  BFC7 0013                            STB,B3   P1$,AUTO

     1292    22369    3           DO WHILE(T$~=DEV$);

  22369   2 000C71  CDC7 000D                            CMB,B4   DEV$,AUTO
          2 000C73  0901 000B                            BE       s:22373,PREL

     1293    22370    3              P1$=T$;

  22370   2 000C75  ECC7 0011                            LDB,B6   T$,AUTO
          2 000C77  EFC7 0013                            STB,B6   P1$,AUTO

     1294    22371    3              T$=T$->KZ$HIPDEV.LNK$;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:204  

  22371   2 000C79  DC86                                 LDB,B5   ,B6
          2 000C7A  DFC7 0011                            STB,B5   T$,AUTO

     1295    22372    3              END;

  22372   2 000C7C  DDC7 000D                            CMB,B5   DEV$,AUTO
          2 000C7E  09F7                                 BNE      s:22370,SPREL

     1296    22373    2           IF P1$=ADDR(NIL) THEN

  22373   2 000C7F  8DC7 0013                            CMN      P1$,AUTO
          2 000C81  0981 000A                            BNE      s:22376,PREL

     1297    22374    2              KZ$HIPCTR.DEVHD$=KZ$HIPDEV.LNK$;

  22374   2 000C83  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000C85  DC86                                 LDB,B5   ,B6
          2 000C86  CCC7 000B                            LDB,B4   CTR$,AUTO
          2 000C88  DFC4 0002                            STB,B5   2,B4
          2 000C8A  0F81 0007                            B        s:22377,PREL

     1298    22375    2           ELSE
     1299    22376    2              P1$->KZ$HIPDEV.LNK$=KZ$HIPDEV.LNK$;

  22376   2 000C8C  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000C8E  DC86                                 LDB,B5   ,B6
          2 000C8F  CCC7 0013                            LDB,B4   P1$,AUTO
          2 000C91  DF84                                 STB,B5   ,B4

     1300    22377    2           KZ$LINCTX.OTPDEV$ = ADDR(NIL);

  22377   2 000C92  DB80 0000 0000                       LAB,B5   0
          2 000C95  CCC7 0009                            LDB,B4   LIN$,AUTO
          2 000C97  DFC4 0062                            STB,B5   98,B4

     1301    22378    2           KZ$LINCTX.OTPHD$ = ADDR(NIL);
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:205  

  22378   2 000C99  BB80 0000 0000                       LAB,B3   0
          2 000C9C  BFC4 0052                            STB,B3   82,B4

     1302    22379                %DISABLE(INHLVL=KH_INHLVL);

  22380   2 000C9E  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          2 000CA1  EF47 0062                            STR,R6   DISABLE_LEVEL,AUTO

  22381   2 000CA3  DBC7 0062                            LAB,B5   DISABLE_LEVEL,AUTO
          2 000CA5  DFC7 00A4                            STB,B5   FPT_WRSYSLOG+22,AUTO
          2 000CA7  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000CA9  CBF0 0100                            LAB,B4   256,IMO
          2 000CAB  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000CAE       0001                            DC       s:22383,PREL

     1303    22383    2           CALL KVB$RLSSYS(SIZEW(KZ$HIPDEV),T$);

  22383   2 000CAF  EBF0 0023                            LAB,B6   35,IMO
          2 000CB1  DBC7 0011                            LAB,B5   T$,AUTO
          2 000CB3  DFC7 00A6                            STB,B5   FPT_WRSYSLOG+24,AUTO
          2 000CB5  EFC7 00A4                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 000CB7  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000CB9  CBF0 0200                            LAB,B4   512,IMO
          2 000CBB  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 000CBE       0001                            DC       s:22385,PREL

     1304    22384                %ENABLE(INHLVL=KH_INHLVL);

  22385   2 000CBF  E847 0062                            LDR,R6   DISABLE_LEVEL,AUTO
          2 000CC1  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
          2 000CC4  0901 0007                            BE       s:22390,PREL

  22387   2 000CC6  CBF0 0000                            LAB,B4   0,IMO
          2 000CC8  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 000CCB       0001                            DC       s:22390,PREL

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:206  
     1305    22390    2           KZ@HIPSTT.KHSTT.CTXBYTUTL = KZ@HIPSTT.KHSTT.CTXBYTUTL - SIZEC(KZ$HIPDEV);

  22390   2 000CCC  EC80 0000 0006  xsym                 LDB,B6   KZ_HIP_HDR+6
          2 000CCF  8CC6 0020                            LDI      32,B6
          2 000CD1  8470 FFFF FFBA                       AID      -70,IMO
          2 000CD4  8D46 0020                            SDI      32,B6

     1306    22391    2   END;

  22391   2 000CD6  ECC7 0076                            LDB,B6   I,AUTO
          2 000CD8  C3C6 0001                            LNJ,B4   1,B6

     1307    22392
     1308    22393    1   REALLY_CLR_CTR: PROC;

  22393   2 000CDA  EFC7 0078            REALLY_CLR_CTR  STB,B6   J+1,AUTO

     1309    22394    2           T$=KZ$LINCTX.CTRHD$;

  22394   2 000CDC  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 000CDE  CC85                                 LDB,B4   ,B5
          2 000CDF  CFC7 0011                            STB,B4   T$,AUTO

     1310    22395    2           P1$=ADDR(NIL);

  22395   2 000CE1  BB80 0000 0000                       LAB,B3   0
          2 000CE4  BFC7 0013                            STB,B3   P1$,AUTO

     1311    22396    3           DO WHILE(T$~=CTR$);

  22396   2 000CE6  CDC7 000B                            CMB,B4   CTR$,AUTO
          2 000CE8  0901 000B                            BE       s:22400,PREL

     1312    22397    3              P1$=T$;

  22397   2 000CEA  ECC7 0011                            LDB,B6   T$,AUTO
          2 000CEC  EFC7 0013                            STB,B6   P1$,AUTO
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:207  

     1313    22398    3              T$=T$->KZ$HIPCTR.LNK$;

  22398   2 000CEE  DC86                                 LDB,B5   ,B6
          2 000CEF  DFC7 0011                            STB,B5   T$,AUTO

     1314    22399    3              END;

  22399   2 000CF1  DDC7 000B                            CMB,B5   CTR$,AUTO
          2 000CF3  09F7                                 BNE      s:22397,SPREL

     1315    22400    2           IF P1$=ADDR(NIL) THEN

  22400   2 000CF4  8DC7 0013                            CMN      P1$,AUTO
          2 000CF6  0981 0009                            BNE      s:22403,PREL

     1316    22401    2              KZ$LINCTX.CTRHD$=KZ$HIPCTR.LNK$;

  22401   2 000CF8  ECC7 000B                            LDB,B6   CTR$,AUTO
          2 000CFA  DC86                                 LDB,B5   ,B6
          2 000CFB  CCC7 0009                            LDB,B4   LIN$,AUTO
          2 000CFD  DF84                                 STB,B5   ,B4
          2 000CFE  0F81 0007                            B        s:22405,PREL

     1317    22402    2           ELSE
     1318    22403    2              P1$->KZ$HIPCTR.LNK$=KZ$HIPCTR.LNK$;

  22403   2 000D00  ECC7 000B                            LDB,B6   CTR$,AUTO
          2 000D02  DC86                                 LDB,B5   ,B6
          2 000D03  CCC7 0013                            LDB,B4   P1$,AUTO
          2 000D05  DF84                                 STB,B5   ,B4

     1319    22404                %DISABLE(INHLVL=KH_INHLVL);

  22405   2 000D06  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          2 000D09  EF47 0062                            STR,R6   DISABLE_LEVEL,AUTO

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:208  
  22406   2 000D0B  DBC7 0062                            LAB,B5   DISABLE_LEVEL,AUTO
          2 000D0D  DFC7 00A4                            STB,B5   FPT_WRSYSLOG+22,AUTO
          2 000D0F  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000D11  CBF0 0100                            LAB,B4   256,IMO
          2 000D13  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000D16       0001                            DC       s:22408,PREL

     1320    22408    2           CALL KVB$RLSSYS(SIZEW(KZ$HIPCTR),T$);

  22408   2 000D17  EBF0 000B                            LAB,B6   11,IMO
          2 000D19  DBC7 0011                            LAB,B5   T$,AUTO
          2 000D1B  DFC7 00A6                            STB,B5   FPT_WRSYSLOG+24,AUTO
          2 000D1D  EFC7 00A4                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 000D1F  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000D21  CBF0 0200                            LAB,B4   512,IMO
          2 000D23  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 000D26       0001                            DC       s:22410,PREL

     1321    22409                %ENABLE(INHLVL=KH_INHLVL);

  22410   2 000D27  E847 0062                            LDR,R6   DISABLE_LEVEL,AUTO
          2 000D29  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
          2 000D2C  0901 0007                            BE       s:22415,PREL

  22412   2 000D2E  CBF0 0000                            LAB,B4   0,IMO
          2 000D30  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 000D33       0001                            DC       s:22415,PREL

     1322    22415    2           KZ@HIPSTT.KHSTT.CTXBYTUTL = KZ@HIPSTT.KHSTT.CTXBYTUTL - SIZEC(KZ$HIPCTR);

  22415   2 000D34  EC80 0000 0006  xsym                 LDB,B6   KZ_HIP_HDR+6
          2 000D37  8CC6 0020                            LDI      32,B6
          2 000D39  8470 FFFF FFEA                       AID      -22,IMO
          2 000D3C  8D46 0020                            SDI      32,B6

     1323    22416    2   END;

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:209  
  22416   2 000D3E  ECC7 0078                            LDB,B6   J+1,AUTO
          2 000D40  C3C6 0001                            LNJ,B4   1,B6

     1324    22417
     1325    22418    1   REALLY_CLR_LINE: PROC;

  22418   2 000D42  EFC7 007A            REALLY_CLR_LINE STB,B6   DEV1$+2,AUTO

     1326    22419    3           IF KZ$LINCTX.CTRLST$~=ADDR(NIL) THEN DO;

  22419   2 000D44  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 000D46  8DC5 0068                            CMN      104,B5
          2 000D48  0901 0040                            BE       s:22434,PREL

     1327    22420                   %DISABLE(INHLVL=KH_INHLVL);

  22421   2 000D4A  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          2 000D4D  EF47 0062                            STR,R6   DISABLE_LEVEL,AUTO

  22422   2 000D4F  CBC7 0062                            LAB,B4   DISABLE_LEVEL,AUTO
          2 000D51  CFC7 00A4                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 000D53  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000D55  CBF0 0100                            LAB,B4   256,IMO
          2 000D57  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000D5A       0001                            DC       s:22424,PREL

     1328    22424    3              CALL KVB$RLSSYS

  22424   2 000D5B  ECC7 0009                            LDB,B6   LIN$,AUTO
          2 000D5D  E846 0065                            LDR,R6   101,B6
          2 000D5F  6F06                                 MLV,R6   6
          2 000D60  6E05                                 ADV,R6   5
          2 000D61  E370 0002                            DIV,R6   2,IMO
          2 000D63  EF47 00A4                            STR,R6   FPT_WRSYSLOG+22,AUTO
          2 000D65  DBC6 0068                            LAB,B5   104,B6
          2 000D67  DFC7 00A7                            STB,B5   FPT_WRSYSLOG+25,AUTO
          2 000D69  CBC7 00A4                            LAB,B4   FPT_WRSYSLOG+22,AUTO
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:210  
          2 000D6B  CFC7 00A5                            STB,B4   FPT_WRSYSLOG+23,AUTO
          2 000D6D  BBC7 00A5                            LAB,B3   FPT_WRSYSLOG+23,AUTO
          2 000D6F  CBF0 0200                            LAB,B4   512,IMO
          2 000D71  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 000D74       0001                            DC       s:22427,PREL

     1329    22425    3                (((KZ$LINCTX.POLSIZ*6)+5)/2,KZ$LINCTX.CTRLST$);
     1330    22426                   %ENABLE(INHLVL=KH_INHLVL);

  22427   2 000D75  E847 0062                            LDR,R6   DISABLE_LEVEL,AUTO
          2 000D77  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
          2 000D7A  0901 0007                            BE       s:22432,PREL

  22429   2 000D7C  CBF0 0000                            LAB,B4   0,IMO
          2 000D7E  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 000D81       0001                            DC       s:22432,PREL

     1331    22432    3              KZ$LINCTX.CTRLST$=ADDR(NIL);

  22432   2 000D82  EB80 0000 0000                       LAB,B6   0
          2 000D85  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 000D87  EFC5 0068                            STB,B6   104,B5

     1332    22433    3              END;

     1333    22434    2           KZ$CLMEVENT=KZ_CLMEVENT;

  22434   2 000D89  AB80 0000 0000  01                   LAB,B2   KZ_CLMEVENT
          2 000D8C  2C00                                 LDV,R2   0
          2 000D8D  6C1C                                 LDV,R6   28
          2 000D8E  BBC7 0063                            LAB,B3   KZ$CLMEVENT,AUTO
          2 000D90  3C00                                 LDV,R3   0
          2 000D91  0008                                 MMM

     1334    22435    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_LINDSC;

  22435   2 000D92  6C0A                                 LDV,R6   10
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:211  
          2 000D93  EF47 0063                            STR,R6   KZ$CLMEVENT,AUTO

     1335    22436    2           KZ$CLMEVENT.TERMID$=ADDR(KZ$LINCTX.CHN$->KH$CHN.TERMID);

  22436   2 000D95  ECC7 0009                            LDB,B6   LIN$,AUTO
          2 000D97  DCC6 0002                            LDB,B5   2,B6
          2 000D99  CBC5 0012                            LAB,B4   18,B5
          2 000D9B  CFC7 0068                            STB,B4   KZ$CLMEVENT+5,AUTO

     1336    22437    2           KZ$CLMEVENT.LINCTX$=LIN$;

  22437   2 000D9D  EFC7 0066                            STB,B6   KZ$CLMEVENT+3,AUTO

     1337    22438                %DISABLE(INHLVL=KH_INHLVL);

  22439   2 000D9F  D800 0000 0000  xsym                 LDR,R5   KH_INHLVL
          2 000DA2  DF47 0062                            STR,R5   DISABLE_LEVEL,AUTO

  22440   2 000DA4  DBC7 0062                            LAB,B5   DISABLE_LEVEL,AUTO
          2 000DA6  DFC7 00A4                            STB,B5   FPT_WRSYSLOG+22,AUTO
          2 000DA8  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000DAA  CBF0 0100                            LAB,B4   256,IMO
          2 000DAC  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000DAF       0001                            DC       s:22442,PREL

     1338    22442    2           CALL KZT_CNCDSC@(KZ$CLMEVENT);

  22442   2 000DB0  EBC7 0063                            LAB,B6   KZ$CLMEVENT,AUTO
          2 000DB2  EFC7 00A4                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 000DB4  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000DB6  9C80 0000 0000  xsym                 LDB,B1   KZT_CNCDSC@
          2 000DB9  CBF0 0100                            LAB,B4   256,IMO
          2 000DBB  E381                                 LNJ,B6   ,B1
          2 000DBC       0001                            DC       s:22444,PREL

     1339    22443                %ENABLE(INHLVL=KH_INHLVL);

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:212  
  22444   2 000DBD  E847 0062                            LDR,R6   DISABLE_LEVEL,AUTO
          2 000DBF  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
          2 000DC2  0901 0007                            BE       s:22449,PREL

  22446   2 000DC4  CBF0 0000                            LAB,B4   0,IMO
          2 000DC6  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 000DC9       0001                            DC       s:22449,PREL

     1340    22449    2   END;

  22449   2 000DCA  ECC7 007A                            LDB,B6   DEV1$+2,AUTO
          2 000DCC  C3C6 0001                            LNJ,B4   1,B6

     1341    22450        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:213  
     1342    22451        /**/
     1343    22452        /* Disconnect a device */
     1344    22453        /**/
     1345    22454    1   DSC_DEV: PROC(RSN);

  22454   2 000DCE  EFC7 0074            DSC_DEV         STB,B6   KZ@INPDESC+3,AUTO

     1346    22455    2   DCL RSN UBIN;
     1347    22456    2   DCL DEV1$ PTR;
     1348    22457    2   DCL DEV2$ PTR;
     1349    22458
     1350    22459    3           IF NOT KZ$HIPDEV.ACTIVE AND KZ$HIPDEV.OTPHD$~=ADDR(NIL) THEN DO;

  22459   2 000DD0  DCC7 000D                            LDB,B5   DEV$,AUTO
          2 000DD2  82C5 0012                            LB,'4000'X        18,B5
          2 000DD4       4000
          2 000DD5  0501 0070                            BBT      s:22495,PREL
          2 000DD7  8DC5 0008                            CMN      8,B5
          2 000DD9  0901 006C                            BE       s:22495,PREL

     1351    22460    3              IF KZ$HIPDEV.DFRTL$~=ADDR(NIL) THEN

  22460   2 000DDB  8DC5 000E                            CMN      14,B5
          2 000DDD  0901 0008                            BE       s:22463,PREL

     1352    22461    3                 KZ$HIPDEV.DFRTL$->KZ$OTPBFR.LNK$=KZ$HIPDEV.OTPHD$;

  22461   2 000DDF  CCC5 000E                            LDB,B4   14,B5
          2 000DE1  BCC5 0008                            LDB,B3   8,B5
          2 000DE3  BF84                                 STB,B3   ,B4
          2 000DE4  0F81 0005                            B        s:22464,PREL

     1353    22462    3              ELSE
     1354    22463    3                 KZ$HIPDEV.DFRHD$=KZ$HIPDEV.OTPHD$;

  22463   2 000DE6  CCC5 0008                            LDB,B4   8,B5
          2 000DE8  CFC5 000C                            STB,B4   12,B5
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:214  

     1355    22464    3              KZ$HIPDEV.DFRTL$=KZ$HIPDEV.OTPHD$;

  22464   2 000DEA  ECC5 0008                            LDB,B6   8,B5
          2 000DEC  EFC5 000E                            STB,B6   14,B5

     1356    22465    3              KZ$HIPDEV.OTPHD$=ADDR(NIL);

  22465   2 000DEE  CB80 0000 0000                       LAB,B4   0
          2 000DF1  CFC5 0008                            STB,B4   8,B5

     1357    22466    3              KZ$HIPDEV.OTPTL$=ADDR(NIL);

  22466   2 000DF3  BB80 0000 0000                       LAB,B3   0
          2 000DF6  BFC5 000A                            STB,B3   10,B5

     1358    22467    3              KZ$HIPDEV.OTPCNT=0;

  22467   2 000DF8  8745 0010                            CL       16,B5

     1359    22468    3              KZ$HIPDEV.OTPBSY='0'B;

  22468   2 000DFA  8845 0012                            LBF,'0400'X       18,B5
  22468   2 000DFC       0400

     1360    22469    3              IF KZ$HIPDEV.ONOTP THEN

  22469   2 000DFD  82C5 001C                            LB,'0010'X        28,B5
  22469   2 000DFF       0010
          2 000E00  0581 0045                            BBF      s:22495,PREL

     1361    22470    4   UNLINK_DEV_FROM_OUTPUT:DO;

  22470   2                              UNLINK_DEV_FROM*null
     1362    22471    4                 KZ$HIPDEV.ONOTP='0'B;

  22471   2 000E02  8845 001C            UNLINK_DEV_FROM*LBF,'0010'X       28,B5
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:215  
  22471   2 000E04       0010

     1363    22472    4                 DEV1$=KZ$LINCTX.OTPHD$;

  22472   2 000E05  ACC7 0009                            LDB,B2   LIN$,AUTO
          2 000E07  9CC2 0052                            LDB,B1   82,B2
          2 000E09  9FC7 0078                            STB,B1   DEV1$,AUTO

     1364    22473    4                 IF DEV1$=DEV$ THEN

  22473   2 000E0B  9DC7 000D                            CMB,B1   DEV$,AUTO
          2 000E0D  0981 0012                            BNE      s:22480,PREL

     1365    22474    5                 DO;

     1366    22475    5                    KZ$LINCTX.OTPHD$=KZ$HIPDEV.OTPLNK$;

  22475   2 000E0F  ECC5 001D                            LDB,B6   29,B5
          2 000E11  EFC2 0052                            STB,B6   82,B2

     1367    22476    5                    KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT-1;

  22476   2 000E13  88C2 004D                            DEC      77,B2

     1368    22477    5                    IF KZ$LINCTX.OTPCNT=0 THEN KZ$LINCTX.OTPTL$=ADDR(NIL);

  22477   2 000E15  E842 004D                            LDR,R6   77,B2
          2 000E17  6981 002E                            BNEZ,R6  s:22495,PREL

  22477   2 000E19  CB80 0000 0000                       LAB,B4   0
          2 000E1C  CFC2 0054                            STB,B4   84,B2

     1369    22478    5                    END;

  22478   2 000E1E  0F81 0027                            B        s:22495,PREL

     1370    22479    4                 ELSE
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:216  
     1371    22480    5                 DO WHILE(DEV1$~=ADDR(NIL));

  22480   2 000E20  0F81 0022                            B        s:22491,PREL

     1372    22481    5                    DEV2$=DEV1$->KZ$HIPDEV.OTPLNK$;

  22481   2 000E22  ECC7 0078                            LDB,B6   DEV1$,AUTO
          2 000E24  DCC6 001D                            LDB,B5   29,B6
          2 000E26  DFC7 007A                            STB,B5   DEV2$,AUTO

     1373    22482    5                    IF DEV2$=DEV$ THEN

  22482   2 000E28  DDC7 000D                            CMB,B5   DEV$,AUTO
          2 000E2A  0981 0016                            BNE      s:22490,PREL

     1374    22483    6                    DO;

     1375    22484    6                       DEV1$->KZ$HIPDEV.OTPLNK$=DEV2$->KZ$HIPDEV.OTPLNK$;

  22484   2 000E2C  CCC5 001D                            LDB,B4   29,B5
          2 000E2E  CFC6 001D                            STB,B4   29,B6

     1376    22485    6                       KZ$LINCTX.OTPCNT=KZ$LINCTX.OTPCNT-1;

  22485   2 000E30  BCC7 0009                            LDB,B3   LIN$,AUTO
          2 000E32  88C3 004D                            DEC      77,B3

     1377    22486    6                       IF DEV1$->KZ$HIPDEV.OTPLNK$=ADDR(NIL) THEN KZ$LINCTX.OTPTL$=
             22486                                DEV1$;

  22486   2 000E34  8DC6 001D                            CMN      29,B6
          2 000E36  0981 0003                            BNE      s:22487,PREL

  22486   2 000E38  EFC3 0054                            STB,B6   84,B3

     1378    22487    6                       DEV1$=ADDR(NIL);

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:217  
  22487   2 000E3A  CB80 0000 0000                       LAB,B4   0
          2 000E3D  CFC7 0078                            STB,B4   DEV1$,AUTO

     1379    22488    6                       END;

  22488   2 000E3F  0F81 0003                            B        s:22491,PREL

     1380    22489    5                    ELSE
     1381    22490    5                       DEV1$=DEV2$;

  22490   2 000E41  DFC7 0078                            STB,B5   DEV1$,AUTO

     1382    22491    5                    END /* WHILE */;

  22491   2 000E43  8DC7 0078                            CMN      DEV1$,AUTO
          2 000E45  09DD                                 BNE      s:22481,SPREL

     1383    22492    4                 END UNLINK_DEV_FROM_OUTPUT;

     1384    22493    3              END;

     1385    22494        /**/
     1386    22495    3           IF KZ$HIPDEV.HLT THEN DO;

  22495   2 000E46  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000E48  82C6 0012                            LB,'00FF'X        18,B6
          2 000E4A       00FF
          2 000E4B  0581 000B                            BBF      s:22501,PREL

     1387    22496    3              KZ$HIPDEV.HLT='0'B;

  22496   2 000E4D  8846 0012                            LBF,'00FF'X       18,B6
  22496   2 000E4F       00FF

     1388    22497    3              IF KZ$HIPDEV.OTPHD$~=ADDR(NIL) THEN

  22497   2 000E50  8DC6 0008                            CMN      8,B6
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:218  
          2 000E52  0901 0004                            BE       s:22501,PREL

     1389    22498    3                 CALL REQUEUE;

  22498   2 000E54  E3C0 FCA7                            LNJ,B6   s:0,PREL
          2 000E56       0001                            DC       s:22501,PREL

     1390    22499    3              END;

     1391    22500        /**/
     1392    22501    2           CALL DEL_DFRD;   /* Make sure there is no defered process waiting.    */

  22501   2 000E57  E3C0 00E7                            LNJ,B6   s:0,PREL
          2 000E59       0001                            DC       s:22503,PREL

     1393    22502
     1394    22503    2           IF KZ$HIPDEV.VDI$=ADDR(NIL) THEN

  22503   2 000E5A  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000E5C  8DC6 0004                            CMN      4,B6
          2 000E5E  0981 0005                            BNE      s:22506,PREL

     1395    22504    2              RETURN;                      /* Nothing to disconnect              */

  22504   2 000E60  ECC7 0074                            LDB,B6   KZ@INPDESC+3,AUTO
          2 000E62  C3C6 0001                            LNJ,B4   1,B6

     1396    22505        /**/
     1397    22506    2           CALL ENTER_VDH(KZ$HIPDEV.VDI$, DFRD);

  22506   2 000E64  DBC7 0026                            LAB,B5   DFRD,AUTO
          2 000E66  DFC7 0088                            STB,B5   T$+1,AUTO
          2 000E68  CBC6 0004                            LAB,B4   4,B6
          2 000E6A  CFC7 0086                            STB,B4   I,AUTO
          2 000E6C  E3C0 0420                            LNJ,B6   s:0,PREL
          2 000E6E       0001                            DC       s:22507,PREL

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:219  
     1398    22507    2           KZ$HIPDEV.DSC.INT='1'B;         /* Disconnect initiated               */

  22507   2 000E6F  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000E71  8946 0015                            LBT,'0080'X       21,B6
          2 000E73       0080

     1399    22508    3           IF DFRD~='1'B THEN DO;          /* NOT DFRD                           */

  22508   2 000E74  89C7 0026                            CMZ      DFRD,AUTO
          2 000E76  0801 003F                            BAL      s:22522,PREL

     1400    22509    3   TELL_VDH:  KZ$HIPDEV.DSC.TOLD_VDH='1'B;

  22509   2 000E78  ECC7 000D            TELL_VDH        LDB,B6   DEV$,AUTO
          2 000E7A  8946 0015                            LBT,'0040'X       21,B6
          2 000E7C       0040

     1401    22510    3              IF NOT KZ$HIPDEV.ACTIVE THEN

  22510   2 000E7D  82C6 0012                            LB,'4000'X        18,B6
  22510   2 000E7F       4000
          2 000E80  0501 0004                            BBT      s:22514,PREL

     1402    22511    4              DO;

     1403    22512    4                 CALL DEL_DFRD;            /* Delete defered processing          */

  22512   2 000E82  E3C0 00BC                            LNJ,B6   s:0,PREL
          2 000E84       0001                            DC       s:22514,PREL

     1404    22513    4                 END;

     1405    22514    3              KV$VDH_DSC=KV_VDH_DSC;

  22514   2 000E85  8C80 0000 0000  xsym                 LDI      KV_VDH_DSC
          2 000E88  8D47 004B                            SDI      KV$VDH_DSC,AUTO

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:220  
     1406    22515    3              KV$VDH_DSC.RSN=RSN;

  22515   2 000E8A  ECC7 0076                            LDB,B6   @RSN,AUTO
          2 000E8C  D806                                 LDR,R5   ,B6
          2 000E8D  DAC7 004B                            SRM,R5,'00FF'X    KV$VDH_DSC,AUTO
          2 000E8F       00FF

     1407    22516    3              KV$VDH_DSC.NO_IO=~ KZ$HIPDEV.ACTIVE;

  22516   2 000E90  DCC7 000D                            LDB,B5   DEV$,AUTO
          2 000E92  D845 0012                            LDR,R5   18,B5
          2 000E94  5001                                 SOL,R5   1
          2 000E95  D570 8000                            AND,R5   -32768,IMO
          2 000E97  D670 8000                            XOR,R5   -32768,IMO
          2 000E99  DAC7 004C                            SRM,R5,'8000'X    KV$VDH_DSC+1,AUTO
          2 000E9B       8000

     1408    22517    3              KV$VDH_DSC.ALLSSN='1'B;

  22517   2 000E9C  8947 004C                            LBT,'4000'X       KV$VDH_DSC+1,AUTO
  22517   2 000E9E       4000

     1409    22518    3              CALL KVV$VDI(KV$VDH_DSC);

  22518   2 000E9F  CBC7 004B                            LAB,B4   KV$VDH_DSC,AUTO
          2 000EA1  CFC7 00A4                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 000EA3  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000EA5  CBF0 0100                            LAB,B4   256,IMO
          2 000EA7  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 000EAA       0001                            DC       s:22519,PREL

     1410    22519    3              CALL EXIT_VDH(KZ$HIPDEV.VDI$);

  22519   2 000EAB  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000EAD  DBC6 0004                            LAB,B5   4,B6
          2 000EAF  DFC7 0084                            STB,B5   TCNT+4,AUTO
          2 000EB1  E3C0 043B                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:221  
          2 000EB3       0001                            DC       s:22520,PREL

     1411    22520    3              END;

  22520   2 000EB4  0F81 0004                            B        s:22524,PREL

     1412    22521    2           ELSE
     1413    22522    2              KZ$HIPDEV.DFR.DSCI='1'B;     /* Do it later                        */

  22522   2 000EB6  8946 0016                            LBT,'8000'X       22,B6
  22522   2 000EB8       8000

     1414    22523        /**/
     1415    22524    2           RETURN;

  22524   2 000EB9  ECC7 0074                            LDB,B6   KZ@INPDESC+3,AUTO
          2 000EBB  C3C6 0001                            LNJ,B4   1,B6

     1416    22525
     1417    22526    2   DSC_DEV_CONT: ENTRY(RSN);

  22526   2 000EBD  EFC7 0074            DSC_DEV_CONT    STB,B6   KZ@INPDESC+3,AUTO

     1418    22527
     1419    22528    3           IF KZ$HIPDEV.DFR.DSCI THEN DO;

  22528   2 000EBF  DCC7 000D                            LDB,B5   DEV$,AUTO
          2 000EC1  89C5 0016                            CMZ      22,B5
          2 000EC3  0881 0011                            BAGE     s:22533,PREL

     1420    22529    3              KZ$HIPDEV.DFR.DSCI='0'B;

  22529   2 000EC5  8845 0016                            LBF,'8000'X       22,B5
  22529   2 000EC7       8000

     1421    22530    3              CALL ENTER_VDH(KZ$HIPDEV.VDI$,DFRD);
             22530                       /* Already in VDH - make EXIT do nothing */
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:222  

  22530   2 000EC8  EBC7 0026                            LAB,B6   DFRD,AUTO
          2 000ECA  EFC7 0088                            STB,B6   T$+1,AUTO
          2 000ECC  CBC5 0004                            LAB,B4   4,B5
          2 000ECE  CFC7 0086                            STB,B4   I,AUTO
          2 000ED0  E3C0 03BC                            LNJ,B6   s:0,PREL
          2 000ED2       0001                            DC       s:22531,PREL

     1422    22531    3              GOTO TELL_VDH;

  22531   2 000ED3  0F81 FFA4                            B        s:22509,PREL

     1423    22532    3              END;
     1424    22533    2           RETURN;

  22533   2 000ED5  ECC7 0074                            LDB,B6   KZ@INPDESC+3,AUTO
          2 000ED7  C3C6 0001                            LNJ,B4   1,B6

     1425    22534        /**/
     1426    22535    2   END DSC_DEV;
     1427    22536        /**/
     1428    22537    1   DSC_DEV_FINAL: PROC;

  22537   2 000ED9  EFC7 0084            DSC_DEV_FINAL   STB,B6   TCNT+4,AUTO

     1429    22538
     1430    22539    2   DSC_FINAL:
     1431    22540    2           KZ$CLMEVENT=KZ_CLMEVENT;

  22540   2 000EDB  AB80 0000 0000  01   DSC_FINAL       LAB,B2   KZ_CLMEVENT
          2 000EDE  2C00                                 LDV,R2   0
          2 000EDF  6C1C                                 LDV,R6   28
          2 000EE0  BBC7 0063                            LAB,B3   KZ$CLMEVENT,AUTO
          2 000EE2  3C00                                 LDV,R3   0
          2 000EE3  0008                                 MMM

     1432    22541    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_DEVDSC;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:223  

  22541   2 000EE4  6C0B                                 LDV,R6   11
          2 000EE5  EF47 0063                            STR,R6   KZ$CLMEVENT,AUTO

     1433    22542    2           KZ$CLMEVENT.TERMID$=ADDR(KZ$HIPDEV.CHN$->KH$CHN.TERMID);

  22542   2 000EE7  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000EE9  DCC6 0006                            LDB,B5   6,B6
          2 000EEB  CBC5 0012                            LAB,B4   18,B5
          2 000EED  CFC7 0068                            STB,B4   KZ$CLMEVENT+5,AUTO

     1434    22543    2           KZ$CLMEVENT.LINCTX$=LIN$;

  22543   2 000EEF  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 000EF1  DFC7 0066                            STB,B5   KZ$CLMEVENT+3,AUTO

     1435    22544                %DISABLE(INHLVL=KH_INHLVL);

  22545   2 000EF3  D800 0000 0000  xsym                 LDR,R5   KH_INHLVL
          2 000EF6  DF47 0062                            STR,R5   DISABLE_LEVEL,AUTO

  22546   2 000EF8  BBC7 0062                            LAB,B3   DISABLE_LEVEL,AUTO
          2 000EFA  BFC7 00A4                            STB,B3   FPT_WRSYSLOG+22,AUTO
          2 000EFC  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000EFE  CBF0 0100                            LAB,B4   256,IMO
          2 000F00  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000F03       0001                            DC       s:22548,PREL

     1436    22548    2           CALL KZT_CNCDSC@(KZ$CLMEVENT);

  22548   2 000F04  EBC7 0063                            LAB,B6   KZ$CLMEVENT,AUTO
          2 000F06  EFC7 00A4                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 000F08  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000F0A  9C80 0000 0000  xsym                 LDB,B1   KZT_CNCDSC@
          2 000F0D  CBF0 0100                            LAB,B4   256,IMO
          2 000F0F  E381                                 LNJ,B6   ,B1
          2 000F10       0001                            DC       s:22550,PREL
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:224  

     1437    22549                %ENABLE(INHLVL=KH_INHLVL);

  22550   2 000F11  E847 0062                            LDR,R6   DISABLE_LEVEL,AUTO
          2 000F13  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
          2 000F16  0901 0007                            BE       s:22555,PREL

  22552   2 000F18  CBF0 0000                            LAB,B4   0,IMO
          2 000F1A  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 000F1D       0001                            DC       s:22555,PREL

     1438    22555    2           KZ$HIPDEV.DSC.VDH_FINAL='0'B;

  22555   2 000F1E  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000F20  8846 0015                            LBF,'0020'X       21,B6
          2 000F22       0020

     1439    22556    2           KZ$HIPDEV.DSC.DEV_FINAL='0'B;

  22556   2 000F23  8846 0015                            LBF,'0010'X       21,B6
  22556   2 000F25       0010

     1440    22557    2           KV$VDH_EVT=KV_VDH_EVT;

  22557   2 000F26  8C80 0000 0000  xsym                 LDI      KV_VDH_EVT
          2 000F29  8D47 004D                            SDI      KV$VDH_EVT,AUTO

     1441    22558    2           KV$VDH_EVT.ID=%KV_VDH_EVT_ID_RLSVDI;

  22558   2 000F2B  5C03                                 LDV,R5   3
          2 000F2C  DAC7 004D                            SRM,R5,'00FF'X    KV$VDH_EVT,AUTO
          2 000F2E       00FF

     1442    22559    2           CALL KVV$VDI(KV$VDH_EVT);

  22559   2 000F2F  DBC7 004D                            LAB,B5   KV$VDH_EVT,AUTO
          2 000F31  DFC7 00A4                            STB,B5   FPT_WRSYSLOG+22,AUTO
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:225  
          2 000F33  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000F35  CBF0 0100                            LAB,B4   256,IMO
          2 000F37  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 000F3A       0001                            DC       s:22560,PREL

     1443    22560    2           RETURN;

  22560   2 000F3B  ECC7 0084                            LDB,B6   TCNT+4,AUTO
          2 000F3D  C3C6 0001                            LNJ,B4   1,B6

     1444    22561
     1445    22562    2   END DSC_DEV_FINAL;
     1446    22563
     1447    22564        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:226  
     1448    22565        /**/
     1449    22566        /*
     1450    22567              Delete any output or input buffers sitting in the defered chain.
     1451    22568        */
     1452    22569    1   DEL_DFRD:PROC ALTRET;

  22569   2 000F3F  EFC7 007C            DEL_DFRD        STB,B6   DEV2$+2,AUTO

     1453    22570        /*  Delete all defered buffers on the chain, or ALTRET
     1454    22571            if a buffer is to be deleted that needs VDH and VDH cant be
     1455    22572            entered.
     1456    22573        */
     1457    22574
     1458    22575    3           DO WHILE(KZ$HIPDEV.DFRHD$~=ADDR(NIL));

  22575   2 000F41  0F81 0071                            B        s:22600,PREL

     1459    22576    3              BFR$=KZ$HIPDEV.DFRHD$;

  22576   2 000F43  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000F45  DCC6 000C                            LDB,B5   12,B6
          2 000F47  DFC7 001D                            STB,B5   BFR$,AUTO

     1460    22577    3              KZ$HIPDEV.DFRHD$=KZ$OTPBFR.LNK$;

  22577   2 000F49  CC85                                 LDB,B4   ,B5
          2 000F4A  CFC6 000C                            STB,B4   12,B6

     1461    22578    3              IF KZ$HIPDEV.DFRHD$=ADDR(NIL) THEN

  22578   2 000F4C  8DC6 000C                            CMN      12,B6
          2 000F4E  0981 0006                            BNE      s:22580,PREL

     1462    22579    3                 KZ$HIPDEV.DFRTL$=ADDR(NIL);

  22579   2 000F50  BB80 0000 0000                       LAB,B3   0
          2 000F53  BFC6 000E                            STB,B3   14,B6
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:227  

     1463    22580    4              DO CASE(KZ$OTPBFR.TYP);

  22580   2 000F55  B2C5 0002                            LLH,R3   2,B5
          2 000F57  3D03                                 CMV,R3   3
          2 000F58  0281 005A                            BGE      s:22600,PREL
          2 000F5A  A830 0000 0F60  02                   LDR,R2   s:22580+11,R3
          2 000F5D  83A0 0000 0F63  02                   JMP      s:22582,R2
          2 000F60       0050                            DC       s:22600,PREL
          2 000F61       0008                            DC       s:22585,PREL
          2 000F62       0000                            DC       s:22582,PREL

     1464    22581    4               CASE(%KZ#BFRTYP_OTP);

     1465    22582    4                 KZ$OTPBFR.CMPCOD=%KV_CMPCOD_DVCERR;

  22582   2 000F63  6C0D                                 LDV,R6   13
          2 000F64  E7C5 0005                            STH,R6   5,B5

     1466    22583    4                 CALL RELOTPBFR ALTRET(NOT_RELEASED);

  22583   2 000F66  E3C0 F9E3                            LNJ,B6   s:0,PREL
          2 000F68       0055                            DC       s:22603,PREL
          2 000F69  0F81 0049                            B        s:22600,PREL

     1467    22584    4               CASE(%KZ#BFRTYP_INP);

     1468    22585    4                 T$=KZ$INPBFR.DATA$;

  22585   2 000F6B  BCC5 0006                            LDB,B3   6,B5
          2 000F6D  BFC7 0011                            STB,B3   T$,AUTO

     1469    22586                      %DISABLE(INHLVL=KH_INHLVL);

  22587   2 000F6F  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          2 000F72  EF47 0062                            STR,R6   DISABLE_LEVEL,AUTO

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:228  
  22588   2 000F74  CBC7 0062                            LAB,B4   DISABLE_LEVEL,AUTO
          2 000F76  CFC7 00A4                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 000F78  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000F7A  CBF0 0100                            LAB,B4   256,IMO
          2 000F7C  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000F7F       0001                            DC       s:22590,PREL

     1470    22590    4                 CALL KVB$RLSSYS(KZ$INPBFR.BFR_SIZ,T$);

  22590   2 000F80  EBC7 0011                            LAB,B6   T$,AUTO
          2 000F82  EFC7 00A6                            STB,B6   FPT_WRSYSLOG+24,AUTO
          2 000F84  DCC7 001D                            LDB,B5   BFR$,AUTO
          2 000F86  CBC5 0004                            LAB,B4   4,B5
          2 000F88  CFC7 00A4                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 000F8A  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000F8C  CBF0 0200                            LAB,B4   512,IMO
          2 000F8E  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 000F91       0001                            DC       s:22591,PREL

     1471    22591    4                 T$=BFR$;

  22591   2 000F92  ECC7 001D                            LDB,B6   BFR$,AUTO
          2 000F94  EFC7 0011                            STB,B6   T$,AUTO

     1472    22592    4                 CALL KVB$RLSSYS(SIZEW(KZ$INPBFR),T$);

  22592   2 000F96  DBF0 0008                            LAB,B5   8,IMO
          2 000F98  CBC7 0011                            LAB,B4   T$,AUTO
          2 000F9A  CFC7 00A6                            STB,B4   FPT_WRSYSLOG+24,AUTO
          2 000F9C  DFC7 00A4                            STB,B5   FPT_WRSYSLOG+22,AUTO
          2 000F9E  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000FA0  CBF0 0200                            LAB,B4   512,IMO
          2 000FA2  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 000FA5       0001                            DC       s:22594,PREL

     1473    22593                      %ENABLE(INHLVL=KH_INHLVL);

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:229  
  22594   2 000FA6  E847 0062                            LDR,R6   DISABLE_LEVEL,AUTO
          2 000FA8  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
          2 000FAB  0901 0007                            BE       s:22600,PREL

  22596   2 000FAD  CBF0 0000                            LAB,B4   0,IMO
          2 000FAF  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 000FB2       0001                            DC       s:22600,PREL

     1474    22599    4               END;

     1475    22600    3              END;

  22600   2 000FB3  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000FB5  8DC6 000C                            CMN      12,B6
          2 000FB7  0981 FF8B                            BNE      s:22576,PREL

     1476    22601    2           RETURN;

  22601   2 000FB9  ECC7 007C                            LDB,B6   DEV2$+2,AUTO
          2 000FBB  C3C6 0001                            LNJ,B4   1,B6

     1477    22602    2   NOT_RELEASED:
     1478    22603    2           ALTRETURN /*  INDICATE NO RELEASE YET  */;

  22603   2 000FBD  ECC7 007C            NOT_RELEASED    LDB,B6   DEV2$+2,AUTO
          2 000FBF  B806                                 LDR,R3   ,B6
          2 000FC0  C3B6                                 LNJ,B4   ,B6,R3

     1479    22604    2   END DEL_DFRD;
     1480    22605        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:230  
     1481    22606        /**/
     1482    22607        /**/
     1483    22608        /* Connect a device to VDH */
     1484    22609        /**/
     1485    22610    1   CNC_DEV: PROC ALTRET;

  22610   2 000FC1  EFC7 0078            CNC_DEV         STB,B6   DEV1$,AUTO

     1486    22611
     1487    22612    2           IF KZ$HIPDEV.VDI$~=ADDR(NIL) THEN

  22612   2 000FC3  DCC7 000D                            LDB,B5   DEV$,AUTO
          2 000FC5  8DC5 0004                            CMN      4,B5
          2 000FC7  0901 0005                            BE       s:22615,PREL

     1488    22613    2              RETURN;                      /* Already have someone going here    */

  22613   2 000FC9  ECC7 0078                            LDB,B6   DEV1$,AUTO
          2 000FCB  C3C6 0001                            LNJ,B4   1,B6

     1489    22614
     1490    22615    2           KZ$CLMEVENT=KZ_CLMEVENT;

  22615   2 000FCD  AB80 0000 0000  01                   LAB,B2   KZ_CLMEVENT
          2 000FD0  2C00                                 LDV,R2   0
          2 000FD1  6C1C                                 LDV,R6   28
          2 000FD2  BBC7 0063                            LAB,B3   KZ$CLMEVENT,AUTO
          2 000FD4  3C00                                 LDV,R3   0
          2 000FD5  0008                                 MMM

     1491    22616    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_CNCRQS;

  22616   2 000FD6  6C0D                                 LDV,R6   13
          2 000FD7  EF47 0063                            STR,R6   KZ$CLMEVENT,AUTO

     1492    22617    2           KZ$CLMEVENT.CHN$=KZ$HIPDEV.CHN$;

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:231  
  22617   2 000FD9  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 000FDB  DCC6 0006                            LDB,B5   6,B6
          2 000FDD  DFC7 006A                            STB,B5   KZ$CLMEVENT+7,AUTO

     1493    22618    2           KZ$CLMEVENT.LINCTX$=LIN$;

  22618   2 000FDF  CCC7 0009                            LDB,B4   LIN$,AUTO
          2 000FE1  CFC7 0066                            STB,B4   KZ$CLMEVENT+3,AUTO

     1494    22619                %DISABLE(INHLVL=KH_INHLVL);

  22620   2 000FE3  D800 0000 0000  xsym                 LDR,R5   KH_INHLVL
          2 000FE6  DF47 0062                            STR,R5   DISABLE_LEVEL,AUTO

  22621   2 000FE8  BBC7 0062                            LAB,B3   DISABLE_LEVEL,AUTO
          2 000FEA  BFC7 00A4                            STB,B3   FPT_WRSYSLOG+22,AUTO
          2 000FEC  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000FEE  CBF0 0100                            LAB,B4   256,IMO
          2 000FF0  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000FF3       0001                            DC       s:22623,PREL

     1495    22623    2           CALL KZT_CNCDSC@(KZ$CLMEVENT)

  22623   2 000FF4  EBC7 0063                            LAB,B6   KZ$CLMEVENT,AUTO
          2 000FF6  EFC7 00A4                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 000FF8  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000FFA  9C80 0000 0000  xsym                 LDB,B1   KZT_CNCDSC@
          2 000FFD  CBF0 0100                            LAB,B4   256,IMO
          2 000FFF  E381                                 LNJ,B6   ,B1
          2 001000       0003                            DC       s:22627,PREL
          2 001001  0F81 0017                            B        s:22635,PREL

     1496    22624    2           WHENALTRETURN
     1497    22625    3           DO;

     1498    22626                   %ENABLE(INHLVL=KH_INHLVL);

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:232  
  22627   2 001003  E847 0062                            LDR,R6   DISABLE_LEVEL,AUTO
          2 001005  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
          2 001008  0901 0007                            BE       s:22632,PREL

  22629   2 00100A  CBF0 0000                            LAB,B4   0,IMO
          2 00100C  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 00100F       0001                            DC       s:22632,PREL

     1499    22632    3              KZ$HIPDEV.AWAIT_ENABLE='1'B;

  22632   2 001010  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 001012  8946 001C                            LBT,'0008'X       28,B6
          2 001014       0008

     1500    22633    3              RETURN;

  22633   2 001015  ECC7 0078                            LDB,B6   DEV1$,AUTO
          2 001017  C3C6 0001                            LNJ,B4   1,B6

     1501    22634    3              END;
     1502    22635    2           KZ$CLMEVENT=KZ_CLMEVENT;

  22635   2 001019  AB80 0000 0000  01                   LAB,B2   KZ_CLMEVENT
          2 00101C  2C00                                 LDV,R2   0
          2 00101D  6C1C                                 LDV,R6   28
          2 00101E  BBC7 0063                            LAB,B3   KZ$CLMEVENT,AUTO
          2 001020  3C00                                 LDV,R3   0
          2 001021  0008                                 MMM

     1503    22636    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_SUBCNC;

  22636   2 001022  6C0C                                 LDV,R6   12
          2 001023  EF47 0063                            STR,R6   KZ$CLMEVENT,AUTO

     1504    22637    2           KZ$CLMEVENT.TERMID$=ADDR(KZ$HIPDEV.CHN$->KH$CHN.TERMID);

  22637   2 001025  ECC7 000D                            LDB,B6   DEV$,AUTO
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:233  
          2 001027  DCC6 0006                            LDB,B5   6,B6
          2 001029  CBC5 0012                            LAB,B4   18,B5
          2 00102B  CFC7 0068                            STB,B4   KZ$CLMEVENT+5,AUTO

     1505    22638    2           KZ$CLMEVENT.LINCTX$=LIN$;

  22638   2 00102D  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 00102F  DFC7 0066                            STB,B5   KZ$CLMEVENT+3,AUTO

     1506    22639    2           CALL KZT_CNCDSC@(KZ$CLMEVENT);

  22639   2 001031  BBC7 0063                            LAB,B3   KZ$CLMEVENT,AUTO
          2 001033  BFC7 00A4                            STB,B3   FPT_WRSYSLOG+22,AUTO
          2 001035  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 001037  9C80 0000 0000  xsym                 LDB,B1   KZT_CNCDSC@
          2 00103A  CBF0 0100                            LAB,B4   256,IMO
          2 00103C  E381                                 LNJ,B6   ,B1
          2 00103D       0001                            DC       s:22641,PREL

     1507    22640                %ENABLE(INHLVL=KH_INHLVL);

  22641   2 00103E  E847 0062                            LDR,R6   DISABLE_LEVEL,AUTO
          2 001040  E900 0000 0000  xsym                 CMR,R6   KH_INHLVL
          2 001043  0901 0007                            BE       s:22646,PREL

  22643   2 001045  CBF0 0000                            LAB,B4   0,IMO
          2 001047  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 00104A       0001                            DC       s:22646,PREL

     1508    22646    2           KZ$HIPDEV.AWAIT_ENABLE='0'B;

  22646   2 00104B  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 00104D  8846 001C                            LBF,'0008'X       28,B6
          2 00104F       0008

     1509    22647        /**/
     1510    22648    2           KV$VDH_INT=KV_VDH_INT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:234  

  22648   2 001050  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_INT
          2 001053  2C00                                 LDV,R2   0
          2 001054  6C16                                 LDV,R6   22
          2 001055  BBC7 004F                            LAB,B3   KV$VDH_INT,AUTO
          2 001057  3C00                                 LDV,R3   0
          2 001058  0008                                 MMM

     1511    22649    2           KV$VDH_INT.CHN$=KZ$HIPDEV.CHN$;

  22649   2 001059  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 00105B  DCC6 0006                            LDB,B5   6,B6
          2 00105D  DFC7 0050                            STB,B5   KV$VDH_INT+1,AUTO

     1512    22650    2           KV$VDH_INT.USRCTX$=DEV$;

  22650   2 00105F  EFC7 0052                            STB,B6   KV$VDH_INT+3,AUTO

     1513    22651    2           KV$VDH_INT.USRPRM$=KZH_USRPRM$;

  22651   2 001061  CC80 0000 0000  xsym                 LDB,B4   KZH_USRPRM$
          2 001064  CFC7 0056                            STB,B4   KV$VDH_INT+7,AUTO

     1514    22652    2           KV$VDH_INT.RCVFLWCTRMAXCRD=KZH_THRTL_INIT;

  22652   2 001066  E800 0000 0000  xsym                 LDR,R6   KZH_THRTL_INIT
          2 001069  EF47 0058                            STR,R6   KV$VDH_INT+9,AUTO

     1515    22653        /**/
     1516    22654    2           VDH_FLG=0;

  22654   2 00106B  8747 0027                            CL       VDH_FLG,AUTO

     1517    22655    2           CALL ENTER_VDH(ADDR(NIL), DFRD);

  22655   2 00106D  BB80 0000 0000                       LAB,B3   0
          2 001070  BFC7 00A9                            STB,B3   FPT_WRSYSLOG+27,AUTO
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:235  
          2 001072  ABC7 0026                            LAB,B2   DFRD,AUTO
          2 001074  AFC7 0088                            STB,B2   T$+1,AUTO
          2 001076  9BC7 00A9                            LAB,B1   FPT_WRSYSLOG+27,AUTO
          2 001078  9FC7 0086                            STB,B1   I,AUTO
          2 00107A  E3C0 0212                            LNJ,B6   s:0,PREL
          2 00107C       0001                            DC       s:22656,PREL

     1518    22656    2           CALL KVV$INT(KV$VDH_INT)

  22656   2 00107D  EBC7 004F                            LAB,B6   KV$VDH_INT,AUTO
          2 00107F  EFC7 00A4                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 001081  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 001083  CBF0 0100                            LAB,B4   256,IMO
          2 001085  E380 0000 0000  xent                 LNJ,B6   KVV$INT
          2 001088       0003                            DC       s:22659,PREL
          2 001089  0F81 0011                            B        s:22666,PREL

     1519    22657    2           WHENALTRETURN
     1520    22658    3           DO;

     1521    22659    3              CALL EXIT_VDH(ADDR(NIL));

  22659   2 00108B  EB80 0000 0000                       LAB,B6   0
          2 00108E  EFC7 00AB                            STB,B6   FPT_WRSYSLOG+29,AUTO
          2 001090  DBC7 00AB                            LAB,B5   FPT_WRSYSLOG+29,AUTO
          2 001092  DFC7 0084                            STB,B5   TCNT+4,AUTO
          2 001094  E3C0 0258                            LNJ,B6   s:0,PREL
          2 001096       0001                            DC       s:22660,PREL

     1522    22660    3              RETURN;

  22660   2 001097  ECC7 0078                            LDB,B6   DEV1$,AUTO
          2 001099  C3C6 0001                            LNJ,B4   1,B6

     1523    22661    3              END;
     1524    22662        /**/
     1525    22663        /*      IF KV$VDH_INT.ABR THEN
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:236  
     1526    22664                   RETURN;     */
     1527    22665        /**/
     1528    22666    2           P1$=KV$VDH_INT.VDI$;            /* Save VDI$                          */

  22666   2 00109B  ECC7 0054                            LDB,B6   KV$VDH_INT+5,AUTO
          2 00109D  EFC7 0013                            STB,B6   P1$,AUTO

     1529    22667        /**/
     1530    22668    2           KV$VDH_CNC=KV_VDH_CNC;

  22668   2 00109F  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_CNC
          2 0010A2  2C00                                 LDV,R2   0
          2 0010A3  6C32                                 LDV,R6   50
          2 0010A4  BB87                                 LAB,B3   ,AUTO
          2 0010A5  3C54                                 LDV,R3   84
          2 0010A6  0008                                 MMM

     1531    22669        /**/
     1532    22670        /*      KV$VDH_CNC.VDI$=P1$;  */
     1533    22671    3           DO SELECT(KZ$HIPCTR.TYP);

  22671   2 0010A7  ECC7 000B                            LDB,B6   CTR$,AUTO
          2 0010A9  E846 0008                            LDR,R6   8,B6
          2 0010AB  E970 1E14                            CMR,R6   7700,IMO
          2 0010AD  0201 0039                            BL       s:22685,PREL
          2 0010AF  0901 0007                            BE       s:22673,PREL
          2 0010B1  E970 1E7C                            CMR,R6   7804,IMO
          2 0010B3  0981 0033                            BNE      s:22685,PREL
          2 0010B5  0F81 0026                            B        s:22682,PREL

     1534    22672    3              SELECT(7700);

     1535    22673    4              IF KH_PROFILE_ ~=VECTOR(NIL) THEN DO;

  22673   2 0010B7  DB80 0000 0000  xsym                 LAB,B5   KH_PROFILE_
          2 0010BA  CB80 0000 0000  03                   LAB,B4   0
          2 0010BD  5C06                                 LDV,R5   6
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:237  
          2 0010BE  0022                                 ACM      ;
          2 0010BF       4605 0000                                ALPHANUM(0,B5,,6,FILL),;
          2 0010C1       4004 0003                                ALPHANUM(3,B4,,R5,FILL)
          2 0010C3  5381 000E                            CBE      s:22678,PREL

     1536    22674    4                 KV$VDH_CNC.PRF_.ADR$=ADDR(KH_PROFILE_)->BVECTOR.ADR$;

  22674   2 0010C5  DC80 0000 0001  xsym                 LDB,B5   KH_PROFILE_+1
          2 0010C8  DFC7 002B                            STB,B5   KV$VDH_CNC+1,AUTO

     1537    22675    4                 KV$VDH_CNC.PRF_.BYTSIZ=ADDR(KH_PROFILE_)->BVECTOR.BOUND+1;

  22675   2 0010CA  E800 0000 0000  xsym                 LDR,R6   KH_PROFILE_
          2 0010CD  6E01                                 ADV,R6   1
          2 0010CE  EF47 002E                            STR,R6   KV$VDH_CNC+4,AUTO

     1538    22676    4                 END;

  22676   2 0010D0  0F81 0016                            B        s:22685,PREL

     1539    22677    4              ELSE DO;

     1540    22678    4                 KV$VDH_CNC.PRF_.ADR$=ADDR(PRO_ATTR);

  22678   2 0010D2  DB80 0000 0064  01                   LAB,B5   PRO_ATTR
          2 0010D5  DFC7 002B                            STB,B5   KV$VDH_CNC+1,AUTO

     1541    22679    4                 KV$VDH_CNC.PRF_.BYTSIZ=(SIZEC(VLP_TRMATTR)+SIZEC(VLP_TRMCTL)+4);

  22679   2 0010D7  6C3C                                 LDV,R6   60
          2 0010D8  EF47 002E                            STR,R6   KV$VDH_CNC+4,AUTO

     1542    22680    4                 END;

  22680   2 0010DA  0F81 000C                            B        s:22685,PREL

     1543    22681    3              SELECT(7804);
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:238  

     1544    22682    3              KV$VDH_CNC.PRF_.ADR$=ADDR(KH_PROFILE_)->BVECTOR.ADR$;

  22682   2 0010DC  DC80 0000 0001  xsym                 LDB,B5   KH_PROFILE_+1
          2 0010DF  DFC7 002B                            STB,B5   KV$VDH_CNC+1,AUTO

     1545    22683    3              KV$VDH_CNC.PRF_.BYTSIZ=ADDR(KH_PROFILE_)->BVECTOR.BOUND+1;

  22683   2 0010E1  E800 0000 0000  xsym                 LDR,R6   KH_PROFILE_
          2 0010E4  6E01                                 ADV,R6   1
          2 0010E5  EF47 002E                            STR,R6   KV$VDH_CNC+4,AUTO

     1546    22684    3              END;

     1547    22685    2           %KV_VDI.VDHEVTENB(%KV_VDH_EVT_ID_CMPOTP)='1'B;

  22685   2 0010E7  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          2 0010EA  CC85                                 LDB,B4   ,B5
          2 0010EB  8944 001F                            LBT,'0008'X       31,B4
          2 0010ED       0008

     1548    22686    2           %KV_VDI.VDHEVTENB(%KV_VDH_EVT_ID_RQSOTP)='1'B;

  22686   2 0010EE  CC85                                 LDB,B4   ,B5
          2 0010EF  8944 001F                            LBT,'0004'X       31,B4
          2 0010F1       0004

     1549    22687    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_DLTOTP)='1'B;

  22687   2 0010F2  CC85                                 LDB,B4   ,B5
          2 0010F3  8944 001E                            LBT,'0010'X       30,B4
          2 0010F5       0010

     1550    22688    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_DSC)='1'B;

  22688   2 0010F6  CC85                                 LDB,B4   ,B5
          2 0010F7  8944 001E                            LBT,'0008'X       30,B4
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:239  
          2 0010F9       0008

     1551    22689    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_HLTOTP)='1'B;

  22689   2 0010FA  CC85                                 LDB,B4   ,B5
          2 0010FB  8944 001E                            LBT,'0001'X       30,B4
          2 0010FD       0001

     1552    22690    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_LGNACP)='1'B;

  22690   2 0010FE  CC85                                 LDB,B4   ,B5
          2 0010FF  8944 001F                            LBT,'8000'X       31,B4
          2 001101       8000

     1553    22691    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_LGNRJC)='1'B;

  22691   2 001102  CC85                                 LDB,B4   ,B5
          2 001103  8944 001F                            LBT,'4000'X       31,B4
          2 001105       4000

     1554    22692    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_RLSSTR)='1'B;

  22692   2 001106  CC85                                 LDB,B4   ,B5
          2 001107  8944 001F                            LBT,'1000'X       31,B4
          2 001109       1000

     1555    22693    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_RLSVDI)='1'B;

  22693   2 00110A  CC85                                 LDB,B4   ,B5
          2 00110B  8944 001F                            LBT,'0100'X       31,B4
          2 00110D       0100

     1556    22694    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_SCH)='1'B;

  22694   2 00110E  CC85                                 LDB,B4   ,B5
          2 00110F  8944 001F                            LBT,'0800'X       31,B4
          2 001111       0800
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:240  

     1557    22695    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_VDHEXT)='1'B;

  22695   2 001112  CC85                                 LDB,B4   ,B5
          2 001113  8944 001F                            LBT,'0200'X       31,B4
          2 001115       0200

     1558    22696    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_ENDSETPRM)='1'B;

  22696   2 001116  CC85                                 LDB,B4   ,B5
          2 001117  8944 001E                            LBT,'0004'X       30,B4
          2 001119       0004

     1559    22697    2           %KV_VDI.USREVTENB(%KV_USR_EVT_ID_INHDLTOTP)='1'B;

  22697   2 00111A  CC85                                 LDB,B4   ,B5
          2 00111B  8944 001F                            LBT,'0040'X       31,B4
          2 00111D       0040

     1560    22698    2           KV$VDH_CNC.LINSPD=KZ$HIPDEV.CHN$->KH$CHN.LINSPD;

  22698   2 00111E  CCC7 000D                            LDB,B4   DEV$,AUTO
          2 001120  ACC4 0006                            LDB,B2   6,B4
          2 001122  E842 0008                            LDR,R6   8,B2
          2 001124  E570 000F                            AND,R6   15,IMO
          2 001126  EAC7 0034                            SRM,R6,'00FF'X    KV$VDH_CNC+10,AUTO
          2 001128       00FF

     1561    22699    2           KV$VDH_CNC.LCLENDPNTID=KZ$HIPDEV.CHN$->KH$CHN.TERMID;

  22699   2 001129  ACC4 0006                            LDB,B2   6,B4
          2 00112B  2C24                                 LDV,R2   36
          2 00112C  6C10                                 LDV,R6   16
          2 00112D  BB87                                 LAB,B3   ,AUTO
          2 00112E  3C6A                                 LDV,R3   106
          2 00112F  0008                                 MMM

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:241  
     1562    22700    2           KV$VDH_CNC.LCLENDPNTID.TTYP=%KLTY_TTY#;

  22700   2 001130  6C02                                 LDV,R6   2
          2 001131  E7C7 0035                            STH,R6   KV$VDH_CNC+11,AUTO

     1563    22701        /**/
     1564    22702    2           CALL KVV$VDI(KV$VDH_CNC) ALTRET(CNC_FAIL);

  22702   2 001133  EBC7 002A                            LAB,B6   KV$VDH_CNC,AUTO
          2 001135  EFC7 00A4                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 001137  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 001139  CBF0 0100                            LAB,B4   256,IMO
          2 00113B  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 00113E       0082                            DC       s:22737,PREL

     1565    22703    2           KZ$HIPDEV.ACTIVE='1'B;

  22703   2 00113F  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 001141  8946 0012                            LBT,'4000'X       18,B6
          2 001143       4000

     1566    22704        /**/
     1567    22705    2           KZ$HIPDEV.VDI$=P1$;

  22705   2 001144  DCC7 0013                            LDB,B5   P1$,AUTO
          2 001146  DFC6 0004                            STB,B5   4,B6

     1568    22706        /**/
     1569    22707    2           %KV_VDI.USEOTPBFRTRN='0'B;

  22707   2 001148  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          2 00114B  BC84                                 LDB,B3   ,B4
          2 00114C  8843 001D                            LBF,'0080'X       29,B3
          2 00114E       0080

     1570    22708
     1571    22709        /*   let VDH do repeat characters,attributes,erase,position */
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:242  
     1572    22710    2           %KV_MRD.CALUSR_OTPRPTCHR='0'B;

  22710   2 00114F  BCC4 0008                            LDB,B3   8,B4
          2 001151  8843 0018                            LBF,'0100'X       24,B3
          2 001153       0100

     1573    22711    2           %KV_MRD.CALUSR_SETATR='0'B;

  22711   2 001154  BCC4 0008                            LDB,B3   8,B4
          2 001156  8843 000C                            LBF,'0020'X       12,B3
          2 001158       0020

     1574    22712    2           %KV_MRD.CALUSR_ERS='0'B;

  22712   2 001159  BCC4 0008                            LDB,B3   8,B4
          2 00115B  8843 000C                            LBF,'0080'X       12,B3
          2 00115D       0080

     1575    22713    2           %KV_MRD.CALUSR_PST='0'B;

  22713   2 00115E  BCC4 0008                            LDB,B3   8,B4
          2 001160  8843 000C                            LBF,'0040'X       12,B3
          2 001162       0040

     1576    22714    2           %KV_MRD.ERD$ = ADDR(KV_ERD);

  22714   2 001163  BCC4 0008                            LDB,B3   8,B4
          2 001165  AB80 0000 00BB  01                   LAB,B2   KV_ERD
          2 001168  AFC3 0008                            STB,B2   8,B3

     1577    22715
     1578    22716    3           IF KZ$HIPDEV.PRINTER THEN DO;

  22716   2 00116A  82C6 0012                            LB,'0800'X        18,B6
  22716   2 00116C       0800
          2 00116D  0581 000D                            BBF      s:22721,PREL

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:243  
     1579    22717    3              %KV_MRD.CTNFRM='1'B;         /* Continuous form                    */

  22717   2 00116F  BCC4 0008                            LDB,B3   8,B4
          2 001171  8943 0018                            LBT,'0800'X       24,B3
          2 001173       0800

     1580    22718    3              %KV_MRD.MINSP_FORPST=255;

  22718   2 001174  BCC4 0008                            LDB,B3   8,B4
          2 001176  8943 000C                            LBT,'FF00'X       12,B3
          2 001178       FF00

     1581    22719    3              END;

  22719   2 001179  0F81 0036                            B        s:22733,PREL

     1582    22720    3           ELSE DO;                        /* Display                            */

     1583    22721    3              %KV_MRD.FSTERS='1'B;

  22721   2 00117B  BCC4 0008                            LDB,B3   8,B4
          2 00117D  8943 0017                            LBT,'0001'X       23,B3
          2 00117F       0001

     1584    22722    3              %KV_MRD.ATRRQRDSPPST='1'B;

  22722   2 001180  BCC4 0008                            LDB,B3   8,B4
          2 001182  8943 0018                            LBT,'8000'X       24,B3
          2 001184       8000

     1585    22723    4              DO SELECT(KZ$HIPCTR.TYP);

  22723   2 001185  BCC7 000B                            LDB,B3   CTR$,AUTO
          2 001187  E843 0008                            LDR,R6   8,B3
          2 001189  E970 1E7C                            CMR,R6   7804,IMO
          2 00118B  0201 0009                            BL       s:22723+16,PREL
          2 00118D  0901 0019                            BE       s:22728,PREL
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:244  
          2 00118F  E970 1E86                            CMR,R6   7814,IMO
          2 001191  0981 001E                            BNE      s:22733,PREL
          2 001193  0F81 0013                            B        s:22728,PREL
          2 001195  E970 1E14                            CMR,R6   7700,IMO
          2 001197  0981 0018                            BNE      s:22733,PREL
          2 001199  0F81 0001                            B        s:22725,PREL

     1586    22724    4                 SELECT(7700);

     1587    22725    4                 %KV_VDI.INPUNT=%KV_INPUNT_CHR;

  22725   2 00119B  AC84                                 LDB,B2   ,B4
          2 00119C  5C20                                 LDV,R5   32
          2 00119D  DAC2 001D                            SRM,R5,'0060'X    29,B2
          2 00119F       0060

     1588    22726    4                 %KV_MRD.ATRRQRDSPPST='1'B;

  22726   2 0011A0  ACC4 0008                            LDB,B2   8,B4
          2 0011A2  8942 0018                            LBT,'8000'X       24,B2
          2 0011A4       8000
          2 0011A5  0F81 000A                            B        s:22733,PREL

     1589    22727    4                 SELECT(7804,7814);

     1590    22728    4                 %KV_VDI.INPUNT=%KV_INPUNT_BLK;

  22728   2 0011A7  AC84                                 LDB,B2   ,B4
          2 0011A8  8942 001D                            LBT,'0060'X       29,B2
          2 0011AA       0060

     1591    22729    4                 %KV_MRD.ATRRQRDSPPST='0'B;

  22729   2 0011AB  ACC4 0008                            LDB,B2   8,B4
          2 0011AD  8842 0018                            LBF,'8000'X       24,B2
          2 0011AF       8000

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:245  
     1592    22730    4                 END /* SELECT ON CONTROLLER TYPE */;

     1593    22731    3              END;

     1594    22732        /**/
     1595    22733    2           CALL EXIT_VDH(ADDR(NIL));

  22733   2 0011B0  BB80 0000 0000                       LAB,B3   0
          2 0011B3  BFC7 00AD                            STB,B3   FPT_WRSYSLOG+31,AUTO
          2 0011B5  ABC7 00AD                            LAB,B2   FPT_WRSYSLOG+31,AUTO
          2 0011B7  AFC7 0084                            STB,B2   TCNT+4,AUTO
          2 0011B9  E3C0 0133                            LNJ,B6   s:0,PREL
          2 0011BB       0001                            DC       s:22734,PREL

     1596    22734    2           RETURN;

  22734   2 0011BC  ECC7 0078                            LDB,B6   DEV1$,AUTO
          2 0011BE  C3C6 0001                            LNJ,B4   1,B6

     1597    22735
     1598    22736    2   CNC_FAIL:
     1599    22737    2           KV$VDH_EVT=KV_VDH_EVT;

  22737   2 0011C0  8C80 0000 0000  xsym CNC_FAIL        LDI      KV_VDH_EVT
          2 0011C3  8D47 004D                            SDI      KV$VDH_EVT,AUTO

     1600    22738    2           KV$VDH_EVT.ID=%KV_VDH_EVT_ID_RLSVDI;

  22738   2 0011C5  5C03                                 LDV,R5   3
          2 0011C6  DAC7 004D                            SRM,R5,'00FF'X    KV$VDH_EVT,AUTO
          2 0011C8       00FF

     1601    22739    2           CALL KVV$VDI(KV$VDH_EVT);

  22739   2 0011C9  EBC7 004D                            LAB,B6   KV$VDH_EVT,AUTO
          2 0011CB  EFC7 00A4                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 0011CD  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:246  
          2 0011CF  CBF0 0100                            LAB,B4   256,IMO
          2 0011D1  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 0011D4       0001                            DC       s:22740,PREL

     1602    22740    2           CALL EXIT_VDH(ADDR(NIL));

  22740   2 0011D5  EB80 0000 0000                       LAB,B6   0
          2 0011D8  EFC7 00AF                            STB,B6   FPT_WRSYSLOG+33,AUTO
          2 0011DA  DBC7 00AF                            LAB,B5   FPT_WRSYSLOG+33,AUTO
          2 0011DC  DFC7 0084                            STB,B5   TCNT+4,AUTO
          2 0011DE  E3C0 010E                            LNJ,B6   s:0,PREL
          2 0011E0       0001                            DC       s:22741,PREL

     1603    22741    2           KZ$HIPDEV.REACT='1'B;

  22741   2 0011E1  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 0011E3  8946 001C                            LBT,'0040'X       28,B6
          2 0011E5       0040

     1604    22742    2           RETURN;                         /* Connect failed                     */

  22742   2 0011E6  ECC7 0078                            LDB,B6   DEV1$,AUTO
          2 0011E8  C3C6 0001                            LNJ,B4   1,B6

     1605    22743    2   END CNC_DEV;
     1606    22744
     1607    22745        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:247  
     1608    22746
     1609    22747        /* ERRLOG */
     1610    22748
     1611    22749    1   ERRLOG: PROC(ERROR);

  22749   2 0011EA  EFC7 008A            ERRLOG          STB,B6   @DFRD+2,AUTO

     1612    22750    2   DCL  ERROR UBIN;
     1613    22751        %FPT_WRSYSLOG (STCLASS="  ");
     1614    22846        %FPT_WRSYSLOG (FPTN=FPT@WRSYSLOG, STCLASS=CONSTANT, FCG="KZ", MID="V");
     1615    22941
     1616    22942
     1617    22943    2           FPT_WRSYSLOG=FPT@WRSYSLOG;

  22943   2 0011EC  AB80 0000 0115  01                   LAB,B2   FPT@WRSYSLOG
          2 0011EF  2C00                                 LDV,R2   0
          2 0011F0  6C2A                                 LDV,R6   42
          2 0011F1  BBC7 008E                            LAB,B3   FPT_WRSYSLOG,AUTO
          2 0011F3  3C00                                 LDV,R3   0
          2 0011F4  0008                                 MMM

     1618    22944    2           FPT_WRSYSLOG.V.TERMID=KZ$LINCTX.LINID;

  22944   2 0011F5  ACC7 0009                            LDB,B2   LIN$,AUTO
          2 0011F7  2C08                                 LDV,R2   8
          2 0011F8  6C10                                 LDV,R6   16
          2 0011F9  BBC7 0096                            LAB,B3   FPT_WRSYSLOG+8,AUTO
          2 0011FB  3C00                                 LDV,R3   0
          2 0011FC  0008                                 MMM

     1619    22945    2           FPT_WRSYSLOG.V.ERRCODE.ERR#=ERROR;

  22945   2 0011FD  ECC7 008C                            LDB,B6   @ERROR,AUTO
          2 0011FF  E806                                 LDR,R6   ,B6
          2 001200  6003                                 SOL,R6   3
          2 001201  EAC7 0095                            SRM,R6,'FFF8'X    FPT_WRSYSLOG+7,AUTO
          2 001203       FFF8
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:248  

     1620    22946
     1621    22947    3           DO CASE (ERROR);

  22947   2 001204  B806                                 LDR,R3   ,B6
          2 001205  BA70 FF37                            ADD,R3   -201,IMO
          2 001207  3D08                                 CMV,R3   8
          2 001208  0281 0074                            BGE      s:23013,PREL
          2 00120A  A830 0000 1210  02                   LDR,R2   s:22947+12,R3
          2 00120D  83A0 0000 1218  02                   JMP      s:22959,R2
          2 001210       0016                            DC       s:22978,PREL
          2 001211       0065                            DC       s:23013,PREL
          2 001212       0000                            DC       s:22959,PREL
          2 001213       0065                            DC       s:23013,PREL
          2 001214       0065                            DC       s:23013,PREL
          2 001215       0065                            DC       s:23013,PREL
          2 001216       0065                            DC       s:23013,PREL
          2 001217       0047                            DC       s:23005,PREL

     1622    22948    3            CASE (%E$BADADR);

     1623    22949        /*E*  ERROR:       KZH-E$BADADR-3
     1624    22950              MESSAGE:     Undefined Controller/Device number in LINFCN request
     1625    22951              DESCRIPTION: A LINFCN code of DSCTRM, KILL, BLDCTX, ENABL, or POL
     1626    22952                           was received by the HIP device manager, but the controller/
     1627    22953                           device for which the service was requested is undefined.
     1628    22954
     1629    22955                           V0    - Channel number.
     1630    22956                           V1/V2 - Controller/Device number.
     1631    22957                           DATA  - Vector of the KZ$EVENT parameter.  */
     1632    22958
     1633    22959    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_SOFT#;

  22959   2 001218  6C03                                 LDV,R6   3
          2 001219  EAC7 0095                            SRM,R6,'0007'X    FPT_WRSYSLOG+7,AUTO
          2 00121B       0007

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:249  
     1634    22960    3              FPT_WRSYSLOG.V.VALUES(0)=KZ$LINCTX.CHAN;

  22960   2 00121C  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 00121E  D845 0033                            LDR,R5   51,B5
          2 001220  DF47 009E                            STR,R5   FPT_WRSYSLOG+16,AUTO

     1635    22961    3              FPT_WRSYSLOG.V.VALUES(1)=I;

  22961   2 001222  C847 0016                            LDR,R4   CNT,AUTO
          2 001224  CF47 009F                            STR,R4   FPT_WRSYSLOG+17,AUTO

     1636    22962    3              FPT_WRSYSLOG.V.VALUES(2)=J;

  22962   2 001226  B847 0017                            LDR,R3   J,AUTO
          2 001228  BF47 00A0                            STR,R3   FPT_WRSYSLOG+18,AUTO

     1637    22963    3              FPT_WRSYSLOG.V.VALUES(3)=0;

  22963   2 00122A  8747 00A1                            CL       FPT_WRSYSLOG+19,AUTO
          2 00122C  0F81 0050                            B        s:23013,PREL

     1638    22964        /***    FPT_WRSYSLOG.BUF_=VECTOR(KZ$EVENT);          *******/
     1639    22965
     1640    22966
     1641    22967    3            CASE (%E$THRERR);

     1642    22968        /*E*  ERROR:         KZH-E$THRERR-3
     1643    22969              MESSAGE:       Throttling is out of sync.
     1644    22970              DESCRIPTION:   A device's output byte count is non-zero, but no
     1645    22971                             output is pending. (or in progress)
     1646    22972
     1647    22973                           V0    - Channel number
     1648    22974                           V1/V2 - Controller/Device numbers
     1649    22975                           V3    - Current Output Byte Count
     1650    22976        */
     1651    22977
     1652    22978    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_SOFT#;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:250  

  22978   2 00122E  6C03                                 LDV,R6   3
          2 00122F  EAC7 0095                            SRM,R6,'0007'X    FPT_WRSYSLOG+7,AUTO
          2 001231       0007

     1653    22979
     1654    22980    4              IF DEV$=ADDR(NIL) OR CTR$=ADDR(NIL) THEN DO;

  22980   2 001232  8DC7 000D                            CMN      DEV$,AUTO
          2 001234  0901 0005                            BE       s:22981,PREL
          2 001236  8DC7 000B                            CMN      CTR$,AUTO
          2 001238  0981 000C                            BNE      s:22987,PREL

     1655    22981    4                 FPT_WRSYSLOG.V.VALUES(0)=0;

  22981   2 00123A  8747 009E                            CL       FPT_WRSYSLOG+16,AUTO

     1656    22982    4                 FPT_WRSYSLOG.V.VALUES(1)=31;

  22982   2 00123C  5C1F                                 LDV,R5   31
          2 00123D  DF47 009F                            STR,R5   FPT_WRSYSLOG+17,AUTO

     1657    22983    4                 FPT_WRSYSLOG.V.VALUES(2)=31;

  22983   2 00123F  DF47 00A0                            STR,R5   FPT_WRSYSLOG+18,AUTO

     1658    22984    4                 FPT_WRSYSLOG.V.VALUES(3)=0;

  22984   2 001241  8747 00A1                            CL       FPT_WRSYSLOG+19,AUTO

     1659    22985    4                 END;

  22985   2 001243  0F81 0039                            B        s:23013,PREL

     1660    22986    4              ELSE DO;

     1661    22987    4                 FPT_WRSYSLOG.V.VALUES(0)=KZ$HIPDEV.CTR$->KZ$HIPCTR.LIN$->
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:251  

  22987   2 001245  DCC7 000D                            LDB,B5   DEV$,AUTO
          2 001247  CCC5 0002                            LDB,B4   2,B5
          2 001249  BCC4 0004                            LDB,B3   4,B4
          2 00124B  D843 0033                            LDR,R5   51,B3
          2 00124D  DF47 009E                            STR,R5   FPT_WRSYSLOG+16,AUTO

     1662    22988    4                   KZ$LINCTX.CHAN;
     1663    22989    4                 FPT_WRSYSLOG.V.VALUES(1)=KZ$HIPDEV.CTR$->KZ$HIPCTR.ADR;

  22989   2 00124F  CCC5 0002                            LDB,B4   2,B5
          2 001251  C2C4 000A                            LLH,R4   10,B4
          2 001253  CF47 009F                            STR,R4   FPT_WRSYSLOG+17,AUTO

     1664    22990    4                 FPT_WRSYSLOG.V.VALUES(2)=KZ$HIPDEV.ADR;

  22990   2 001255  B2C5 0015                            LLH,R3   21,B5
          2 001257  BF47 00A0                            STR,R3   FPT_WRSYSLOG+18,AUTO

     1665    22991    4                 FPT_WRSYSLOG.V.VALUES(3)=KZ$HIPDEV.OTPBYTES;

  22991   2 001259  A845 0014                            LDR,R2   20,B5
          2 00125B  AF47 00A1                            STR,R2   FPT_WRSYSLOG+19,AUTO

     1666    22992    4                 END;

  22992   2 00125D  0F81 001F                            B        s:23013,PREL

     1667    22993
     1668    22994    3            CASE (%E$NO_MEMORY);

     1669    22995        /*E* ERROR:        KZV-E$NO_MEMORY-6
     1670    22996             MESSAGE:      Insufficient BISYNC MEMory (a NETCON parameter).
     1671    22997             DESCRIPTION:  A KVB call ALTRETed to indicate that BISYNC is out of
     1672    22998                           MEMory.  Since a necessary I/O buffer or device context
     1673    22999                           could not be allocated, the HIP  LINE associated
     1674    23000                           with the request has been disconnected.
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:252  
     1675    23001                           V0 = Channel number.
     1676    23002                           V1/V2 = Controller/Device numbers.
     1677    23003                           V3 = Size of buffer, in words, which could not be allocated.
     1678    23004        */
     1679    23005    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_LINE_ABORT#;

  23005   2 00125F  6C06                                 LDV,R6   6
          2 001260  EAC7 0095                            SRM,R6,'0007'X    FPT_WRSYSLOG+7,AUTO
          2 001262       0007

     1680    23006    3              FPT_WRSYSLOG.V.VALUES(0)=KZ$LINCTX.CHAN;

  23006   2 001263  DCC7 0009                            LDB,B5   LIN$,AUTO
          2 001265  D845 0033                            LDR,R5   51,B5
          2 001267  DF47 009E                            STR,R5   FPT_WRSYSLOG+16,AUTO

     1681    23007    4              IF DEV$ ~= ADDR (NIL) THEN DO;

  23007   2 001269  8DC7 000D                            CMN      DEV$,AUTO
          2 00126B  0901 000D                            BE       s:23011,PREL

     1682    23008    4                 FPT_WRSYSLOG.V.VALUES(1)=KZ$HIPDEV.CTR$->KZ$HIPCTR.ADR;

  23008   2 00126D  CCC7 000D                            LDB,B4   DEV$,AUTO
          2 00126F  BCC4 0002                            LDB,B3   2,B4
          2 001271  C2C3 000A                            LLH,R4   10,B3
          2 001273  CF47 009F                            STR,R4   FPT_WRSYSLOG+17,AUTO

     1683    23009    4                 FPT_WRSYSLOG.V.VALUES(2)=KZ$HIPDEV.ADR;

  23009   2 001275  B2C4 0015                            LLH,R3   21,B4
          2 001277  BF47 00A0                            STR,R3   FPT_WRSYSLOG+18,AUTO

     1684    23010    4                 END;

     1685    23011    3              FPT_WRSYSLOG.V.VALUES(3)=SZ;

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:253  
  23011   2 001279  C847 0015                            LDR,R4   SZ,AUTO
          2 00127B  CF47 00A1                            STR,R4   FPT_WRSYSLOG+19,AUTO

     1686    23012    3            END;                           /*  END CASE                          */

     1687    23013    2           CALL KHA$ERRLOG(FPT_WRSYSLOG);

  23013   2 00127D  DBC7 008E                            LAB,B5   FPT_WRSYSLOG,AUTO
          2 00127F  DFC7 00A4                            STB,B5   FPT_WRSYSLOG+22,AUTO
          2 001281  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 001283  CBF0 0100                            LAB,B4   256,IMO
          2 001285  E380 0000 0000  xent                 LNJ,B6   KHA$ERRLOG
          2 001288       0001                            DC       s:23014,PREL

     1688    23014    2           RETURN;

  23014   2 001289  ECC7 008A                            LDB,B6   @DFRD+2,AUTO
          2 00128B  C3C6 0001                            LNJ,B4   1,B6

     1689    23015
     1690    23016    2   END ERRLOG;
     1691    23017        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:254  
     1692    23018        /**/
     1693    23019        /**/
     1694    23020        /* ENTER_VDH - Try to enter VDH */
     1695    23021        /**/
     1696    23022
     1697    23023    1   ENTER_VDH: PROC(VDI$, DFRD);

  23023   2 00128D  EFC7 0084            ENTER_VDH       STB,B6   TCNT+4,AUTO

     1698    23024
     1699    23025    2   DCL DFRD BIT(1) ALIGNED;
     1700    23026    2   DCL VDI$ PTR;
     1701    23027
     1702    23028    3           IF VDH_FLG~=0 THEN DO;

  23028   2 00128F  E847 0027                            LDR,R6   VDH_FLG,AUTO
          2 001291  6901 000A                            BEZ,R6   s:23034,PREL

     1703    23029    3              VDH_FLG=VDH_FLG+1;

  23029   2 001293  8AC7 0027                            INC      VDH_FLG,AUTO

     1704    23030    3              DFRD='0'B;

  23030   2 001295  DCC7 0088                            LDB,B5   @DFRD,AUTO
          2 001297  8705                                 CL       ,B5

     1705    23031    3              RETURN;

  23031   2 001298  ECC7 0084                            LDB,B6   TCNT+4,AUTO
          2 00129A  C3C6 0001                            LNJ,B4   1,B6

     1706    23032    3              END;
     1707    23033
     1708    23034    3           IF VDI$=ADDR(NIL) THEN DO;

  23034   2 00129C  DCC7 0086                            LDB,B5   @VDI$,AUTO
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:255  
          2 00129E  8D85                                 CMN      ,B5
          2 00129F  0981 0008                            BNE      s:23076,PREL

     1709    23035                   %KV$USRENT(VDI$="ADDR(NIL)");
             23041    3              KV@USRENT.SVDPTR$ = KV$PTR$;

  23041   2 0012A1  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          2 0012A4  CFC7 005F                            STB,B4   KV@USRENT,AUTO

     1710    23061    3              END;

  23061   2 0012A6  0F81 0034                            B        s:23091,PREL

     1711    23062    3           ELSE DO;

     1712    23063                   %KV$USRENT(VDI$=KZ$HIPDEV.VDI$, DFR$=DFR, SCHRSN=%KV_SCHRSN_DFR1);
             23076    3           KZ$HIPDEV.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             23076                    KZ$HIPDEV.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;

  23076   2 0012A8  CCC7 000D                            LDB,B4   DEV$,AUTO
          2 0012AA  BCC4 0004                            LDB,B3   4,B4
          2 0012AC  ACC3 0008                            LDB,B2   8,B3
          2 0012AE  9CC2 0033                            LDB,B1   51,B2
          2 0012B0  8AC1 0039                            INC      57,B1
          2 0012B2  8EC1 0038                            CAD      56,B1

             23077    4           IF NOT KZ$HIPDEV.VDI$->KV$VDI.BSY THEN DO;

  23077   2 0012B4  ECC4 0004                            LDB,B6   4,B4
          2 0012B6  82C6 0019                            LB,'0080'X        25,B6
          2 0012B8       0080
          2 0012B9  0501 0012                            BBT      s:23083,PREL

             23078    4              KZ$HIPDEV.VDI$->KV$VDI.BSY = '1'B;

  23078   2 0012BB  8946 0019                            LBT,'0080'X       25,B6
  23078   2 0012BD       0080
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:256  

             23079    4              KV@USRENT.SVDPTR$ = KV$PTR$;

  23079   2 0012BE  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          2 0012C1  EFC7 005F                            STB,B6   KV@USRENT,AUTO

             23080    4              KV$PTR$ = KZ$HIPDEV.VDI$->KV$VDI.ASNINPPTR$;

  23080   2 0012C3  BCC4 0004                            LDB,B3   4,B4
          2 0012C5  ACC3 0006                            LDB,B2   6,B3
          2 0012C7  AF80 0000 0000  xsym                 STB,B2   KV$PTR$

             23081    4              END;                         /* ELSE IF ~BSY                       */

  23081   2 0012CA  0F81 0010                            B        s:23091,PREL

             23082    4           ELSE DO;

             23083    4              KZ$HIPDEV.VDI$->KV$VDI.DFR.USR(1) = '1'B;

  23083   2 0012CC  8946 0018                            LBT,'4000'X       24,B6
  23083   2 0012CE       4000

             23084    4           KZ$HIPDEV.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             23084                   KZ$HIPDEV.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;

  23084   2 0012CF  ECC4 0004                            LDB,B6   4,B4
          2 0012D1  BCC6 0008                            LDB,B3   8,B6
          2 0012D3  ACC3 0033                            LDB,B2   51,B3
          2 0012D5  8AC2 003B                            INC      59,B2
          2 0012D7  8EC2 003A                            CAD      58,B2

             23085    4              GOTO DFR;

  23085   2 0012D9  0F81 000B                            B        s:23096,PREL

             23086    4              END;                         /* END IF                             */
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:257  
     1713    23089    3              END;
     1714    23090
     1715    23091    2           VDH_FLG=1;

  23091   2 0012DB  6C01                                 LDV,R6   1
          2 0012DC  EF47 0027                            STR,R6   VDH_FLG,AUTO

     1716    23092    2           DFRD='0'B;

  23092   2 0012DE  ECC7 0088                            LDB,B6   @DFRD,AUTO
          2 0012E0  8706                                 CL       ,B6

     1717    23093    2           RETURN;

  23093   2 0012E1  ECC7 0084                            LDB,B6   TCNT+4,AUTO
          2 0012E3  C3C6 0001                            LNJ,B4   1,B6

     1718    23094
     1719    23095    2   DFR:
     1720    23096    2           DFRD='1'B;

  23096   2 0012E5  ECC7 0088            DFR             LDB,B6   @DFRD,AUTO
          2 0012E7  8906                                 LBT,'8000'X       ,B6
          2 0012E8       8000

     1721    23097    2           RETURN;

  23097   2 0012E9  ECC7 0084                            LDB,B6   TCNT+4,AUTO
          2 0012EB  C3C6 0001                            LNJ,B4   1,B6

     1722    23098
     1723    23099    2   END ENTER_VDH;
     1724    23100        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:258  
     1725    23101        /**/
     1726    23102        /**/
     1727    23103        /* EXIT_VDH - Exit VDH if it was entered */
     1728    23104        /**/
     1729    23105    1   EXIT_VDH: PROC(VDI$);

  23105   2 0012ED  EFC7 0082            EXIT_VDH        STB,B6   TCNT+2,AUTO

     1730    23106
     1731    23107    2   DCL VDI$ PTR;
     1732    23108
     1733    23109    2           IF VDH_FLG=0 THEN

  23109   2 0012EF  E847 0027                            LDR,R6   VDH_FLG,AUTO
          2 0012F1  6981 0005                            BNEZ,R6  s:23112,PREL

     1734    23110    2              RETURN;

  23110   2 0012F3  ECC7 0082                            LDB,B6   TCNT+2,AUTO
          2 0012F5  C3C6 0001                            LNJ,B4   1,B6

     1735    23111        /**/
     1736    23112    2           VDH_FLG=VDH_FLG-1;

  23112   2 0012F7  88C7 0027                            DEC      VDH_FLG,AUTO

     1737    23113    2           IF VDH_FLG~=0 THEN

  23113   2 0012F9  E847 0027                            LDR,R6   VDH_FLG,AUTO
          2 0012FB  6901 0005                            BEZ,R6   s:23115,PREL

     1738    23114    2              RETURN;

  23114   2 0012FD  ECC7 0082                            LDB,B6   TCNT+2,AUTO
          2 0012FF  C3C6 0001                            LNJ,B4   1,B6

     1739    23115    3           IF VDI$=ADDR(NIL) THEN DO;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:259  

  23115   2 001301  DCC7 0084                            LDB,B5   @VDI$,AUTO
          2 001303  8D85                                 CMN      ,B5
          2 001304  0981 0008                            BNE      s:23128,PREL

     1740    23116                   %KV$USREXT(VDI$="ADDR(NIL)");
             23124    3           KV$PTR$ = KV@USRENT.SVDPTR$;

  23124   2 001306  CCC7 005F                            LDB,B4   KV@USRENT,AUTO
          2 001308  CF80 0000 0000  xsym                 STB,B4   KV$PTR$

     1741    23126    3              END;

  23126   2 00130B  0F81 0022                            B        s:23144,PREL

     1742    23127    3           ELSE DO;

     1743    23128    3              KV$USR_EVT=KV_USR_EVT;

  23128   2 00130D  8C80 0000 0000  xsym                 LDI      KV_USR_EVT
          2 001310  8D47 0028                            SDI      KV$USR_EVT,AUTO

     1744    23129    3              KV$USR_EVT.ID=%KV_USR_EVT_ID_VDHEXT;

  23129   2 001312  5C0E                                 LDV,R5   14
          2 001313  DAC7 0028                            SRM,R5,'007F'X    KV$USR_EVT,AUTO
          2 001315       007F

     1745    23130    3              CALL KZH$HIP(KV$USR_EVT);

  23130   2 001316  CBC7 0028                            LAB,B4   KV$USR_EVT,AUTO
          2 001318  CFC7 00A4                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 00131A  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 00131C  CBF0 0100                            LAB,B4   256,IMO
          2 00131E  E380 0000 0000  xent                 LNJ,B6   KZH$HIP
          2 001321       0001                            DC       s:23137,PREL

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:260  
     1746    23131                   %KV$USREXT;
             23137    3           KV$PTR.VDI$->KV$VDI.BSY = '0'B;

  23137   2 001322  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          2 001325  DC86                                 LDB,B5   ,B6
          2 001326  8845 0019                            LBF,'0080'X       25,B5
          2 001328       0080

             23139    3           KV$PTR$ = KV@USRENT.SVDPTR$;

  23139   2 001329  DCC7 005F                            LDB,B5   KV@USRENT,AUTO
          2 00132B  DF80 0000 0000  xsym                 STB,B5   KV$PTR$

     1747    23141    3              END;

     1748    23142
     1749    23143        /**/
     1750    23144    2           RETURN;

  23144   2 00132E  ECC7 0082                            LDB,B6   TCNT+2,AUTO
          2 001330  C3C6 0001                            LNJ,B4   1,B6

     1751    23145
     1752    23146    2   END EXIT_VDH;
     1753    23147    1   GIVE_VDH_DATA: PROC;

  23147   2 001332  EFC7 0074            GIVE_VDH_DATA   STB,B6   KZ@INPDESC+3,AUTO

     1754    23148        /*P* NAME: KV$VDH_DAT has been set up with pointer to data, bytx and bytsiz.
     1755    23149             Do some device specific stuff to data, then give to VDH.
     1756    23150
     1757    23151             Called from straight line path from SYNC line manager, or
     1758    23152             via VDH defered processing via KZH$HIP.
     1759    23153        */
     1760    23154
     1761    23155    2           KZ$HIPDEV.VDI$->KV$VDI.UN_KNWPST='1'B;
             23155                    /* I've just lost position on the screen. Tell VDH */
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:261  

  23155   2 001334  DCC7 000D                            LDB,B5   DEV$,AUTO
          2 001336  CCC5 0004                            LDB,B4   4,B5
          2 001338  8944 001D                            LBT,'1000'X       29,B4
          2 00133A       1000

     1762    23156    2           KZ$HIPDEV.VDI$->KV$VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_SKP;

  23156   2 00133B  ECC5 0004                            LDB,B6   4,B5
          2 00133D  6C01                                 LDV,R6   1
          2 00133E  EF46 001A                            STR,R6   26,B6

     1763    23157    2           FC1FC2=SUBSTR(KV$VDH_DAT.DAT__.ADR$->BCHARS,KV$VDH_DAT.DAT__.BYTX-3,2);
             23157                    /* FC1 AND FC2 FROM LINK PROTOCOL */

  23157   2 001340  ACC7 0044                            LDB,B2   KV$VDH_DAT+1,AUTO
          2 001342  A847 0046                            LDR,R2   KV$VDH_DAT+3,AUTO
          2 001344  2EFD                                 ADV,R2   -3
          2 001345  6C02                                 LDV,R6   2
          2 001346  BB87                                 LAB,B3   ,AUTO
          2 001347  3C36                                 LDV,R3   54
          2 001348  0008                                 MMM

     1764    23158
     1765    23159    3           DO SELECT(CTR$->KZ$HIPCTR.TYP);

  23159   2 001349  ECC7 000B                            LDB,B6   CTR$,AUTO
          2 00134B  E846 0008                            LDR,R6   8,B6
          2 00134D  E970 1E14                            CMR,R6   7700,IMO
          2 00134F  0981 0007                            BNE      s:23165,PREL
          2 001351  0F81 0001                            B        s:23163,PREL

     1766    23160    3              SELECT(7700);

     1767    23161        /*         IF KZ$HIPDEV.VDI$->KV$VDI.USRRQSDAT.RED   */
     1768    23162                                           /*   AND KV$PTR.INPCNDPND.TRN       THEN   */
     1769    23163    3              KV$VDH_DAT.DAT__.DATBYTSIZ=KV$VDH_DAT.DAT__.DATBYTSIZ+1;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:262  

  23163   2 001353  8AC7 0047                            INC      KV$VDH_DAT+4,AUTO
          2 001355  0F81 0037                            B        s:23182,PREL

     1770    23164    3              SELECT(ELSE);

     1771    23165    3           IF (FC1FC2='  ') AND (KZ$HIPDEV.ADR=0) THEN

  23165   2 001357  DB80 0000 0000  01                   LAB,B5   KZ_CLMEVENT
          2 00135A  0022                                 ACM      ;
          2 00135B       4207 001B                                ALPHANUM(FC1FC2,AUTO,,2,FILL),;
          2 00135D       4205 012A                                ALPHANUM(298,B5,,2,FILL)
          2 00135F  5301 002D                            CBNE     s:23182,PREL
          2 001361  DCC7 000D                            LDB,B5   DEV$,AUTO
          2 001363  D2C5 0015                            LLH,R5   21,B5
          2 001365  5981 0027                            BNEZ,R5  s:23182,PREL

     1772    23166    4           DO;

     1773    23167    4              IF %KV_MVD.ORG~=%KV#VD_ORG_FORM THEN

  23167   2 001367  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          2 00136A  ACC4 0006                            LDB,B2   6,B4
          2 00136C  C2C2 0015                            LLH,R4   21,B2
          2 00136E  4D04                                 CMV,R4   4
          2 00136F  0901 001B                            BE       s:23178,PREL

     1774    23168    5              DO;                          /*ELIMINATE TRAILING TAB CHARACTERS   */

     1775    23169    6                 DO WHILE((KV$VDH_DAT.DAT__.DATBYTSIZ>0) AND

  23169   2 001371  0F81 0003                            B        s:23173,PREL

     1776    23170    6                   SUBSTR(KV$VDH_DAT.DAT__.ADR$->BCHARS,KV$VDH_DAT.DAT__.BYTX+
             23170                            KV$VDH_DAT.DAT__.DATBYTSIZ-1,1)=%BINASC(128+9));
     1777    23171                                                /*  ODD PARITY TAB                    */
     1778    23172    6                    KV$VDH_DAT.DAT__.DATBYTSIZ=KV$VDH_DAT.DAT__.DATBYTSIZ-1;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:263  

  23172   2 001373  88C7 0047                            DEC      KV$VDH_DAT+4,AUTO

     1779    23173    6                    END;

  23173   2 001375  E847 0047                            LDR,R6   KV$VDH_DAT+4,AUTO
          2 001377  6901 000A                            BEZ,R6   s:23174,PREL
          2 001379  EA47 0046                            ADD,R6   KV$VDH_DAT+3,AUTO
          2 00137B  ECC7 0044                            LDB,B6   KV$VDH_DAT+1,AUTO
          2 00137D  B856                                 LDR,R3   R6
          2 00137E  3EFF                                 ADV,R3   -1
          2 00137F  E0B6                                 LDH,R6   ,B6,R3
          2 001380  6D89                                 CMV,R6   -119
          2 001381  0972                                 BE       s:23172,SPREL

     1780    23174    5                 SUBSTR(KV$VDH_DAT.DAT__.ADR$->BCHARS,KV$VDH_DAT.DAT__.BYTX+

  23174   2 001382  E847 0046                            LDR,R6   KV$VDH_DAT+3,AUTO
          2 001384  EA47 0047                            ADD,R6   KV$VDH_DAT+4,AUTO
          2 001386  5C0D                                 LDV,R5   13
          2 001387  ECC7 0044                            LDB,B6   KV$VDH_DAT+1,AUTO
          2 001389  B856                                 LDR,R3   R6
          2 00138A  D7B6                                 STH,R5   ,B6,R3

     1781    23175    5                   KV$VDH_DAT.DAT__.DATBYTSIZ,1)=
     1782    23176    5                   %BINASC(13);            /*  CARRIAGE RETURN                   */
     1783    23177    5                 END /* NOT FORMS PROGRAM  */;

     1784    23178    4              KV$VDH_DAT.DAT__.DATBYTSIZ=KV$VDH_DAT.DAT__.DATBYTSIZ+1;

  23178   2 00138B  8AC7 0047                            INC      KV$VDH_DAT+4,AUTO

     1785    23179    4              END /*  IF FC1FC2='  ' */;

     1786    23180    3              END /*  DO SELECT  */;

     1787    23181
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:264  
     1788    23182    2           CALL KVV$VDI(KV$VDH_DAT);

  23182   2 00138D  EBC7 0043                            LAB,B6   KV$VDH_DAT,AUTO
          2 00138F  EFC7 00A4                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 001391  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 001393  CBF0 0100                            LAB,B4   256,IMO
          2 001395  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 001398       0001                            DC       s:23183,PREL

     1789    23183    2           KZ$HIPDEV.VDI$->KV$VDI.UN_KNWPST='1'B;
             23183                    /* I've just lost position on the screen. Tell VDH */

  23183   2 001399  ECC7 000D                            LDB,B6   DEV$,AUTO
          2 00139B  DCC6 0004                            LDB,B5   4,B6
          2 00139D  8945 001D                            LBT,'1000'X       29,B5
          2 00139F       1000

     1790    23184    2           KZ$HIPDEV.VDI$->KV$VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_SKP;

  23184   2 0013A0  DCC6 0004                            LDB,B5   4,B6
          2 0013A2  6C01                                 LDV,R6   1
          2 0013A3  EF45 001A                            STR,R6   26,B5

     1791    23185    2   END GIVE_VDH_DATA;

  23185   2 0013A5  ECC7 0074                            LDB,B6   KZ@INPDESC+3,AUTO
          2 0013A7  C3C6 0001                            LNJ,B4   1,B6

     1792    23186
     1793    23187        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:265  
     1794    23188    1   KZH$DSC_LINE: ENTRY(PARM1) ALTRET;

  23188   2 0013A9  D380 0000 0000  xent KZH$DSC_LINE    LNJ,B5   X6A_AUTO_2
          2 0013AC       00B1 0002                       DC       177,2

     1795    23189    1           LIN$=ADDR(LINCTX);

  23189   2 0013AE  ECC7 0004                            LDB,B6   @PARM1,AUTO
          2 0013B0  EFC7 0009                            STB,B6   LIN$,AUTO

     1796    23190    1           CALL DSC_LINE;

  23190   2 0013B2  E3C0 0005                            LNJ,B6   s:0,PREL
          2 0013B4       0001                            DC       s:23191,PREL

     1797    23191    1           RETURN;

  23191   2 0013B5  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1798    23192        %EJECT;
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:266  
     1799    23193    1   DSC_LINE: PROC;

  23193   2 0013B8  EFC7 0074            DSC_LINE        STB,B6   KZ@INPDESC+3,AUTO

     1800    23194
     1801    23195    2           KZ$CLMEVENT=KZ_CLMEVENT;

  23195   2 0013BA  AB80 0000 0000  01                   LAB,B2   KZ_CLMEVENT
          2 0013BD  2C00                                 LDV,R2   0
          2 0013BE  6C1C                                 LDV,R6   28
          2 0013BF  BBC7 0063                            LAB,B3   KZ$CLMEVENT,AUTO
          2 0013C1  3C00                                 LDV,R3   0
          2 0013C2  0008                                 MMM

     1802    23196    2           KZ$CLMEVENT.EVENT=%KZ#CLM_EVENT_KILLED;

  23196   2 0013C3  6C07                                 LDV,R6   7
          2 0013C4  EF47 0063                            STR,R6   KZ$CLMEVENT,AUTO

     1803    23197    2           KZ$CLMEVENT.TERMID$=ADDR(KZ$LINCTX.CHN$->KH$CHN.TERMID);

  23197   2 0013C6  ECC7 0009                            LDB,B6   LIN$,AUTO
          2 0013C8  DCC6 0002                            LDB,B5   2,B6
          2 0013CA  CBC5 0012                            LAB,B4   18,B5
          2 0013CC  CFC7 0068                            STB,B4   KZ$CLMEVENT+5,AUTO

     1804    23198    2           KZ$CLMEVENT.LINCTX$=LIN$;

  23198   2 0013CE  EFC7 0066                            STB,B6   KZ$CLMEVENT+3,AUTO

     1805    23199    2           CALL KZT_CNCDSC@(KZ$CLMEVENT);

  23199   2 0013D0  DBC7 0063                            LAB,B5   KZ$CLMEVENT,AUTO
          2 0013D2  DFC7 00A4                            STB,B5   FPT_WRSYSLOG+22,AUTO
          2 0013D4  BBC7 00A4                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0013D6  9C80 0000 0000  xsym                 LDB,B1   KZT_CNCDSC@
          2 0013D9  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:267  
          2 0013DB  E381                                 LNJ,B6   ,B1
          2 0013DC       0001                            DC       s:23200,PREL

     1806    23200    2           RETURN;

  23200   2 0013DD  ECC7 0074                            LDB,B6   KZ@INPDESC+3,AUTO
          2 0013DF  C3C6 0001                            LNJ,B4   1,B6
     1807    23201
     1808    23202    2   END DSC_LINE;
     1809    23203    1   END KZH$HIPDV;
     1810    23204        %EOD;

PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:268  
--  Include file information  --

   KL_SUPER_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   KZ$BSCSTT.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KHC_MAC_C.:E05TOU  is referenced.
   KZ$3270STT.:E05TOU  is referenced.
   KZ_HIPTAB_C.:E05TOU  is referenced.
   KZ_PERR_C.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KV$VDH.:E05TOU  is referenced.
   KZ_3270_C.:E05TOU  is referenced.
   KV$GLBCTX.:E05TOU  is referenced.
   KV$GLB.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV$USR.:E05TOU  is referenced.
   KZ_LIN_C.:E05TOU  is referenced.
   KZ_CLM_E.:E05TOU  is referenced.
   KZ_HIP_C.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   KZ$PROWRT.:E05TOU  is referenced.
   KZ$OTPBFR.:E05TOU  is referenced.
   KZ$INPBFR.:E05TOU  is referenced.
   KZ$HIPDEV.:E05TOU  is referenced.
   KZ$HIPCTR.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:269  
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure KZH$HIPDV.
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:270  

 **** Variables and constants ****

  ****  Section 000  Data  KZH$HIPDV

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(136)   r     1 HALT_MESSAGE

  ****  Section 001 RoData KZH$HIPDV

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

   115-0-0/w STRC(336)   r     1 FPT@WRSYSLOG              BB-0-0/w STRC(728)   r     1 KV_ERD
     0-0-0/w STRC(224)   r     1 KZ_CLMEVENT               2E-0-0/w STRC(176)   r     1 KZ_HIPCTR
    39-0-0/w STRC(560)   r     1 KZ_HIPDEV                 5C-0-0/w STRC(128)   r     1 KZ_INPBFR
    E9-0-0/w PTR         r     1 KZ_TRNTBLHED$             82-0-0/w STRC(912)   r     1 KZ_USRPRM
     E-0-0/b UBIN(8)     r     1 POLADR(0:31)
     E-0-0/b BIT (8)     r     1 POLADR_B(0:31)
    64-0-0/b STRC(16)    r     1 PRO_ATTR                  65-0-0/w STRC(320)   r     1 VLP_TRMATTR
    7A-0-0/w STRC(128)   r     1 VLP_TRMCTL

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    88-0-0/w PTR         r     1 @DFRD                     8C-0-0/w PTR         r     1 @ERROR
     4-0-0/w PTR         r     1 @PARM1                     6-0-0/w PTR         r     1 @PARM2
    76-0-0/w PTR         r     1 @RSN                      86-0-0/w PTR         r     1 @VDI$
    84-0-0/w PTR         r     1 @VDI$                     1D-0-0/w PTR         r     1 BFR$
    16-0-0/w UBIN(16)    r     1 CNT                        B-0-0/w PTR         r     1 CTR$
     D-0-0/w PTR         r     1 DEV$                      78-0-0/w PTR         r     1 DEV1$
    7A-0-0/w PTR         r     1 DEV2$                     *0-0-0/w STRC(560)   r     1 DEVCTX
    26-0-0/b BIT         r     1 DFRD                      *0-0-0/w BIT         r     1 DFRD
    62-0-0/w UBIN(16)    r     1 DISABLE_LEVEL             *0-0-0/w UBIN(16)    r     1 ERROR
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:271  
     8-0-0/w UBIN(16)    r     1 FAKE                      1B-0-0/c CHAR(2)     r     1 FC1FC2
    1B-0-0/c CHAR        r     1 FC_CHARS(0:1)
    8E-0-0/w STRC(336)   r     1 FPT_WRSYSLOG              16-0-0/w UBIN(16)    r     1 I
    76-0-0/w SBIN(16)    r     1 I                         86-0-0/w SBIN(16)    r     1 I
    17-0-0/w UBIN(16)    r     1 J                         77-0-0/w SBIN(16)    r     1 J
    28-0-0/w STRC(32)    r     1 KV$USR_EVT                2A-0-0/w STRC(400)   r     1 KV$VDH_CNC
    43-0-0/w STRC(128)   r     1 KV$VDH_DAT                4B-0-0/w STRC(32)    r     1 KV$VDH_DSC
    4D-0-0/w STRC(32)    r     1 KV$VDH_EVT                4F-0-0/w STRC(176)   r     1 KV$VDH_INT
    5A-0-0/w STRC(80)    r     1 KV$VDH_OTPMRK             5F-0-0/w STRC(32)    r     1 KV@USRENT
    63-0-0/w STRC(224)   r     1 KZ$CLMEVENT               *0-0-0/w STRC(224)   r     1 KZ$EVENT
    71-0-0/w STRC(32)    r     1 KZ@INPDESC                 9-0-0/w PTR         r     1 LIN$
    *0-0-0/w STRC(2192)  r     1 LINCTX                    1A-0-0/w SBIN(16)    r     1 LOGON_STRING_LENGTH
    *0-0-0/w PTR         r     1 OTPBFR$                   13-0-0/w PTR         r     1 P1$
    *0-0-0/w ACHR        r     1 PARM1                     *0-0-0/c ACHR        r     1 PARM2
    *0-0-0/w BIT (16)    r     1 PSTAT                      F-0-0/w PTR         r     1 PTR$
    *0-0-0/w UBIN(16)    r     1 RSN                       21-0-0/b BIT (16)    r     1 STATUS
    21-0-0/b STRC(16)    r     1 STATUSB                   15-0-0/w UBIN(16)    r     1 SZ
    11-0-0/w PTR         r     1 T$                        87-0-0/w PTR         r     1 T$
    1F-0-0/w PTR         r     1 TBFR$                     80-0-0/w SBIN(16)    r     1 TCNT
    22-0-0/w PTR         r     1 TCTR$                     24-0-0/w PTR         r     1 TDEV$
    7E-0-0/w PTR         r     1 TDEV$                     27-0-0/w UBIN(16)    r     1 VDH_FLG
    *0-0-0/w PTR         r     1 VDI$                      *0-0-0/w PTR         r     1 VDI$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN(16)    r     1 KH_INHLVL                  0-0-0/w VECT        r     1 KH_PROFILE_
     0-0-0/w PTR         r     1 KV$PTR$                    0-0-0/w STRC(32)    r     1 KV_USR_EVT
     0-0-0/w STRC(400)   r     1 KV_VDH_CNC                 0-0-0/w STRC(128)   r     1 KV_VDH_DAT
     0-0-0/w STRC(32)    r     1 KV_VDH_DSC                 0-0-0/w STRC(32)    r     1 KV_VDH_EVT
     0-0-0/w STRC(32)    r     1 KV_VDH_EVT_RQSOTP          0-0-0/w STRC(176)   r     1 KV_VDH_INT
     0-0-0/w STRC(80)    r     1 KV_VDH_OTPMRK              0-0-0/w UBIN(16)    r     1 KZH_THRTL_INIT
     0-0-0/w PTR         r     1 KZH_USRPRM$                0-0-0/w EPTR        r     1 KZT_CNCDSC@
     0-0-0/w UBIN(16)    r     1 KZ_ASC95
     0-0-0/w UBIN(16)    r     1 KZ_HIP_BFRSIZ(0:7)
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:272  
     0-0-0/w STRC(272)   r     1 KZ_HIP_HDR                 0-0-0/w PTR         r     1 KZ_INPFNCTBLHED$
     0-0-0/w PTR         r     1 KZ_VDHSTT$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(128)   r     1 B$TERMINAL_ID              0-0-0/c CHAR(32)    r     1 BCHARS
     0-0-0/w BIT (16)    r     1 BIT16(0:1023)              0-0-0/w STRC(48)    r     1 BVECTOR
     0-0-0/w STRC(512)   r     1 KH$CHN                     0-0-0/c STRC(128)   r     1 KL_CONTROLLER
     0-0-0/c STRC(128)   r     1 KL_LINEDEV                 0-0-0/w STRC(512)   r     1 KV$MRD
     0-0-0/w STRC(512)   r     1 KV$MVD                     0-0-0/w STRC(48)    r     1 KV$OTPMRK
     0-0-0/w STRC(480)   r     1 KV$PTR                     0-0-0/w STRC(8960)  r     1 KV$STT
     0-0-0/w STRC(912)   r     1 KV$USRPRM                  0-0-0/w STRC(512)   r     1 KV$VDI
     0-0-0/w ASTR(64)    r     1 KZ$3270DV                  0-0-0/w STRC(176)   r     1 KZ$HIPCTR
     0-0-0/w STRC(560)   r     1 KZ$HIPDEV                  0-0-0/w STRC(128)   r     1 KZ$INPBFR
     0-0-0/w STRC(32)    r     1 KZ$INPDESC                 0-0-0/w STRC(2192)  r     1 KZ$LINCTX
     0-0-0/w STRC(128)   r     1 KZ$OTPBFR                  0-0-0/c STRC(272)   r     1 KZ$POLLHIP
     0-0-0/w STRC(2656)  r     1 KZ@HIPSTT                  0-0-0/w PTR         r     1 P$(0:31)
     0-0-0/c UBIN(8)     r     1 UBYT(0:31)


   Procedure KZH$HIPDV requires 5089 words for executable code.
   Procedure KZH$HIPDV requires 177 words of local(AUTO) storage.
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:273  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:274  
          MINI XREF LISTING

B$TERMINAL_ID.LEV
     20809**DCL     21547>>DOCASE  21669>>DOCASE  21748>>DOCASE
B$TERMINAL_ID.TERM
     20809**DCL     20818--REDEF
B$TERMINAL_ID.TERM.SUBDEVICE
     20815**DCL     21576>>ASSIGN  21595>>ASSIGN  21755>>ASSIGN
B$TERMINAL_ID.TERM.SUBSUBDEVICE
     20815**DCL     21596>>ASSIGN  21756>>ASSIGN
BCHARS
     20829**DCL     21462>>ASSIGN  21471<<CALLBLT 23157>>ASSIGN  23169>>DOWHILE 23174<<ASSIGN
BFR$
     16808**DCL     20423--IMP-PTR 20456--IMP-PTR 21322<<ASSIGN  21326>>IF      21339>>ASSIGN  21367<<ASSIGN
     21368>>ASSIGN  21384<<ASSIGN  21386>>ASSIGN  21387>>ASSIGN  21802<<ASSIGN  21803>>ASSIGN  21806>>DOCASE
     21811>>ASSIGN  21812>>ASSIGN  21813>>ASSIGN  21815>>ASSIGN  21817>>ASSIGN  21818>>ASSIGN  21820>>ASSIGN
     21860<<ASSIGN  22090<<ASSIGN  22092>>ASSIGN  22115>>ASSIGN  22117>>ASSIGN  22118>>ASSIGN  22119>>ASSIGN
     22124>>IF      22125>>ASSIGN  22125>>ASSIGN  22125>>ASSIGN  22127>>DOWHILE 22130>>ASSIGN  22133>>ASSIGN
     22133>>ASSIGN  22182>>IF      22183>>ASSIGN  22189>>ASSIGN  22190>>ASSIGN  22191>>ASSIGN  22191>>ASSIGN
     22194>>IF      22195>>ASSIGN  22215>>IF      22576<<ASSIGN  22577>>ASSIGN  22580>>DOCASE  22582>>ASSIGN
     22585>>ASSIGN  22590>>CALL    22591>>ASSIGN
BIT16
     20823**DCL     21946>>ASSIGN
BLD_CTR_CTX
     22011**PROC    21679--CALL
BLD_CTX IN PROCEDURE FND_CTX
     21961**LABEL   21952--CALLALT
BLD_DEV_CTX
     21974**PROC    21701--CALL    21961--CALL
BVECTOR.ADR$
     20836**DCL     22674>>ASSIGN  22682>>ASSIGN
BVECTOR.BOUND
     20835**DCL     22675>>ASSIGN  22683>>ASSIGN
CLR_CTR
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:275  
     22361**PROC    22322--CALL
CLR_DEV
     22343**PROC    22292--CALL    22295--CALL    22301--CALL
CNC_DEV
     22610**PROC    21622--CALL    21762--CALL    22358--CALL
CNC_FAIL IN PROCEDURE CNC_DEV
     22737**LABEL   22702--CALLALT
CNT
     16799**DCL     16800--REDEF
CTR$
     16793**DCL     20190--IMP-PTR 21305<<ASSIGN  21323<<ASSIGN  21341>>ASSIGN  21343>>ASSIGN  21382<<ASSIGN
     21423<<ASSIGN  21424>>ASSIGN  21426>>ASSIGN  21452<<ASSIGN  21463>>IF      21518<<ASSIGN  21519>>IF
     21523>>ASSIGN  21530>>ASSIGN  21551<<ASSIGN  21552>>IF      21555>>DOWHILE 21556>>ASSIGN  21557>>ASSIGN
     21571<<ASSIGN  21578>>ASSIGN  21614<<ASSIGN  21616>>ASSIGN  21619>>ASSIGN  21673<<ASSIGN  21674>>DOWHILE
     21675>>IF      21677<<ASSIGN  21677>>ASSIGN  21681>>ASSIGN  21682>>ASSIGN  21683>>ASSIGN  21684>>ASSIGN
     21685>>ASSIGN  21686>>ASSIGN  21688>>ASSIGN  21695>>ASSIGN  21706>>IF      21731<<ASSIGN  21734>>ASSIGN
     21735<<ASSIGN  21735>>ASSIGN  21797<<ASSIGN  21798>>ASSIGN  21834<<ASSIGN  21835>>ASSIGN  21843<<ASSIGN
     21844>>ASSIGN  21857<<ASSIGN  21858>>ASSIGN  21874<<ASSIGN  21875>>ASSIGN  21906<<ASSIGN  21907>>DOWHILE
     21908>>IF      21910<<ASSIGN  21910>>ASSIGN  21922>>ASSIGN  21951>>ASSIGN  21991>>ASSIGN  21993>>ASSIGN
     21994>>ASSIGN  21995>>IF      21997>>ASSIGN  21998>>ASSIGN  22025<<ASSIGN  22026>>ASSIGN  22034>>ASSIGN
     22036>>ASSIGN  22089<<ASSIGN  22304>>ASSIGN  22323>>ASSIGN  22362>>ASSIGN  22367>>ASSIGN  22374>>ASSIGN
     22396>>DOWHILE 22401>>ASSIGN  22403>>ASSIGN  22671>>DOSELCT 22723>>DOSELCT 22980>>IF      23159>>DOSELCT
DEBUGGING IN PROCEDURE REQUEUE
     22253**LABEL   22255--EXIT
DEFERRED_BUFFER IN PROCEDURE UNQRELOTPBFR
     22222**LABEL   22221--CALLALT
DEL_DFRD
     22569**PROC    22501--CALL    22512--CALL
DEV$
     16794**DCL     20242--IMP-PTR 21304<<ASSIGN  21321<<ASSIGN  21322>>ASSIGN  21323>>ASSIGN  21327>>IF
     21327>>IF      21336>>ASSIGN  21337>>ASSIGN  21340>>ASSIGN  21342>>ASSIGN  21344>>ASSIGN  21365<<ASSIGN
     21366>>ASSIGN  21367>>ASSIGN  21383<<ASSIGN  21384>>ASSIGN  21386>>ASSIGN  21387>>ASSIGN  21451<<ASSIGN
     21452>>ASSIGN  21454>>ASSIGN  21455>>IF      21455>>IF      21456>>ASSIGN  21457>>ASSIGN  21459>>ASSIGN
     21467>>IF      21468>>ASSIGN  21475>>IF      21475>>IF      21477>>CALL    21495>>IF      21496>>ASSIGN
     21498>>ASSIGN  21499>>ASSIGN  21509>>CALL    21530<<ASSIGN  21531>>DOWHILE 21532>>IF      21533>>ASSIGN
     21536<<ASSIGN  21536>>ASSIGN  21557<<ASSIGN  21558>>IF      21561>>DOWHILE 21562>>ASSIGN  21563>>IF
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:276  
     21564>>ASSIGN  21569<<ASSIGN  21578<<ASSIGN  21579>>IF      21582>>DOWHILE 21583>>ASSIGN  21584>>IF
     21585>>ASSIGN  21590<<ASSIGN  21599>>IF      21600>>ASSIGN  21601>>ASSIGN  21619<<ASSIGN  21620>>DOWHILE
     21621>>ASSIGN  21623<<ASSIGN  21623>>ASSIGN  21695<<ASSIGN  21696>>DOWHILE 21697>>IF      21699<<ASSIGN
     21699>>ASSIGN  21703>>ASSIGN  21705>>ASSIGN  21707>>ASSIGN  21709>>ASSIGN  21710>>ASSIGN  21710>>ASSIGN
     21759>>IF      21759>>IF      21759>>IF      21759>>IF      21773>>CALL    21796<<ASSIGN  21797>>ASSIGN
     21801>>DOWHILE 21802>>ASSIGN  21803>>ASSIGN  21804>>IF      21805>>ASSIGN  21833<<ASSIGN  21834>>ASSIGN
     21842<<ASSIGN  21843>>ASSIGN  21856<<ASSIGN  21857>>ASSIGN  21872<<ASSIGN  21873>>ASSIGN  21874>>ASSIGN
     21922<<ASSIGN  21923>>DOWHILE 21924>>IF      21926<<ASSIGN  21926>>ASSIGN  21953>>ASSIGN  21962>>ASSIGN
     21988<<ASSIGN  21989>>ASSIGN  21990>>ASSIGN  21991>>ASSIGN  21992>>ASSIGN  21993>>ASSIGN  21994>>ASSIGN
     21996>>ASSIGN  21997>>ASSIGN  21998>>ASSIGN  22049>>ASSIGN  22050>>IF      22051>>ASSIGN  22088<<ASSIGN
     22089>>ASSIGN  22090>>ASSIGN  22092>>ASSIGN  22093>>ASSIGN  22093>>ASSIGN  22094>>IF      22095>>ASSIGN
     22097>>ASSIGN  22112>>CALL    22114>>IF      22115>>ASSIGN  22117>>ASSIGN  22118>>ASSIGN  22137>>IF
     22138>>IF      22138>>IF      22139>>ASSIGN  22141>>ASSIGN  22162>>IF      22162>>IF      22163>>CALL
     22165>>IF      22165>>IF      22167>>ASSIGN  22183>>ASSIGN  22183>>ASSIGN  22184>>IF      22184>>IF
     22184>>IF      22184>>IF      22187>>ASSIGN  22215>>IF      22215>>IF      22215>>IF      22215>>IF
     22222>>CALL    22247>>IF      22247>>IF      22247>>IF      22247>>IF      22255>>IF      22262>>ASSIGN
     22264>>ASSIGN  22266>>ASSIGN  22267>>ASSIGN  22269>>ASSIGN  22281>>IF      22283>>IF      22284>>ASSIGN
     22285>>ASSIGN  22293>>ASSIGN  22304<<ASSIGN  22305>>DOWHILE 22306>>IF      22307<<ASSIGN  22307>>ASSIGN
     22323<<ASSIGN  22324>>DOWHILE 22325>>ASSIGN  22326<<ASSIGN  22326>>ASSIGN  22344>>ASSIGN  22345>>ASSIGN
     22346>>ASSIGN  22347>>ASSIGN  22350>>ASSIGN  22351>>ASSIGN  22352>>ASSIGN  22357>>IF      22369>>DOWHILE
     22374>>ASSIGN  22376>>ASSIGN  22459>>IF      22459>>IF      22460>>IF      22461>>ASSIGN  22461>>ASSIGN
     22463>>ASSIGN  22463>>ASSIGN  22464>>ASSIGN  22464>>ASSIGN  22465>>ASSIGN  22466>>ASSIGN  22467>>ASSIGN
     22468>>ASSIGN  22469>>IF      22471>>ASSIGN  22473>>IF      22475>>ASSIGN  22482>>IF      22495>>IF
     22496>>ASSIGN  22497>>IF      22503>>IF      22506>>CALL    22507>>ASSIGN  22509>>ASSIGN  22510>>IF
     22516>>ASSIGN  22519>>CALL    22522>>ASSIGN  22528>>IF      22529>>ASSIGN  22530>>CALL    22542>>ASSIGN
     22555>>ASSIGN  22556>>ASSIGN  22575>>DOWHILE 22576>>ASSIGN  22577>>ASSIGN  22578>>IF      22579>>ASSIGN
     22612>>IF      22617>>ASSIGN  22632>>ASSIGN  22637>>ASSIGN  22646>>ASSIGN  22649>>ASSIGN  22650>>ASSIGN
     22698>>ASSIGN  22699>>ASSIGN  22703>>ASSIGN  22705>>ASSIGN  22716>>IF      22741>>ASSIGN  22980>>IF
     22987>>ASSIGN  22989>>ASSIGN  22990>>ASSIGN  22991>>ASSIGN  23007>>IF      23008>>ASSIGN  23009>>ASSIGN
     23076>>ASSIGN  23076>>ASSIGN  23077>>IF      23078>>ASSIGN  23080>>ASSIGN  23083>>ASSIGN  23084>>ASSIGN
     23084>>ASSIGN  23155>>ASSIGN  23156>>ASSIGN  23165>>IF      23183>>ASSIGN  23184>>ASSIGN
DEV1$ IN PROCEDURE DSC_DEV
     22456**DCL     22472<<ASSIGN  22473>>IF      22480>>DOWHILE 22481>>ASSIGN  22484>>ASSIGN  22486>>IF
     22486>>ASSIGN  22487<<ASSIGN  22490<<ASSIGN
DEV2$ IN PROCEDURE DSC_DEV
     22457**DCL     22481<<ASSIGN  22482>>IF      22484>>ASSIGN  22490>>ASSIGN
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:277  
DEVCTX
     16021**DCL     21796--ASSIGN  21833--ASSIGN  21842--ASSIGN  21856--ASSIGN  21872--ASSIGN
DFR IN PROCEDURE ENTER_VDH
     23096**LABEL   23085--GOTO
DFRD
     16817**DCL     21477<>CALL    21478>>IF      22112<>CALL    22113>>IF      22506<>CALL    22508>>IF
     22530<>CALL    22655<>CALL
DFRD IN PROCEDURE ENTER_VDH
     23025**DCL     23023--PROC    23030<<ASSIGN  23092<<ASSIGN  23096<<ASSIGN
DISABLE_LEVEL
     17375**DCL     21480<<ASSIGN  21481<>CALL    21485>>IF      21634<<ASSIGN  21635<>CALL    21656>>IF
     21720<<ASSIGN  21721<>CALL    21738>>IF      21781>>IF      21977<<ASSIGN  21978<>CALL    21982>>IF
     22014<<ASSIGN  22015<>CALL    22019>>IF      22199<<ASSIGN  22200<>CALL    22204>>IF      22380<<ASSIGN
     22381<>CALL    22385>>IF      22405<<ASSIGN  22406<>CALL    22410>>IF      22421<<ASSIGN  22422<>CALL
     22427>>IF      22439<<ASSIGN  22440<>CALL    22444>>IF      22545<<ASSIGN  22546<>CALL    22550>>IF
     22587<<ASSIGN  22588<>CALL    22594>>IF      22620<<ASSIGN  22621<>CALL    22627>>IF      22641>>IF
DSC_DEV
     22454**PROC    21534--CALL    21565--CALL    21586--CALL    21602--CALL    21837--CALL
DSC_DEV_CONT IN PROCEDURE DSC_DEV
     22526**ENTRY   21846--CALL
DSC_DEV_FINAL
     22537**PROC    22168--CALL
DSC_LINE
     23193**PROC    21787--CALL    23190--CALL
ENTER_VDH
     23023**PROC    21477--CALL    22112--CALL    22506--CALL    22530--CALL    22655--CALL
ERRDEV IN PROCEDURE FND_CTR
     21903**LABEL   21912--GOTO    21921--GOTO    21928--GOTO
ERRLOG
     22749**PROC    21786--CALL    21903--CALL    22186--CALL
ERROR IN PROCEDURE ERRLOG
     22750**DCL     22749--PROC    22945>>ASSIGN  22947>>DOCASE
EXIT_VDH
     23105**PROC    21509--CALL    21773--CALL    22222--CALL    22519--CALL    22659--CALL    22733--CALL
     22740--CALL
FAKE
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:278  
     15926**DCL     15927--IMP-SIZ 16623--IMP-SIZ
FC1FC2
     16805**DCL     16806--REDEF   21462<<ASSIGN  23157<<ASSIGN  23165>>IF
FC_CHARS
     16806**DCL     21465>>IF      21471>>CALLBLT
FND_CTR
     21894**PROC    21577--CALL    21597--CALL    21694--CALL    21757--CALL    21950--CALL
FND_DEV IN PROCEDURE FND_CTR
     21918**ENTRY   21598--CALL    21758--CALL    21952--CALL
FPT@WRSYSLOG IN PROCEDURE ERRLOG
     22859**DCL     22943>>ASSIGN
FPT@WRSYSLOG.V IN PROCEDURE ERRLOG
     22863**DCL     22861--DCLINIT
FPT@WRSYSLOG.V.TERMID.TERM IN PROCEDURE ERRLOG
     22928**DCL     22937--REDEF
FPT_WRSYSLOG IN PROCEDURE ERRLOG
     22764**DCL     22943<<ASSIGN  23013<>CALL
FPT_WRSYSLOG.V.ERRCODE.ERR# IN PROCEDURE ERRLOG
     22812**DCL     22945<<ASSIGN
FPT_WRSYSLOG.V.ERRCODE.SEV IN PROCEDURE ERRLOG
     22813**DCL     22959<<ASSIGN  22978<<ASSIGN  23005<<ASSIGN
FPT_WRSYSLOG.V.TERMID IN PROCEDURE ERRLOG
     22831**DCL     22944<<ASSIGN
FPT_WRSYSLOG.V.TERMID.TERM IN PROCEDURE ERRLOG
     22833**DCL     22842--REDEF
FPT_WRSYSLOG.V.VALUES IN PROCEDURE ERRLOG
     22844**DCL     22960<<ASSIGN  22961<<ASSIGN  22962<<ASSIGN  22963<<ASSIGN  22981<<ASSIGN  22982<<ASSIGN
     22983<<ASSIGN  22984<<ASSIGN  22987<<ASSIGN  22989<<ASSIGN  22990<<ASSIGN  22991<<ASSIGN  23006<<ASSIGN
     23008<<ASSIGN  23009<<ASSIGN  23011<<ASSIGN
GIVE_VDH_DATA
     23147**PROC    21507--CALL    21814--CALL
HALT_MESSAGE
     16820**DCL     21663--ASSIGN
HALT_MESSAGE.HALT_MSG
     16821**DCL     16824--REDEF
HALT_MESSAGE.HLTMSG
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:279  
     16824**DCL     21662>>ASSIGN
I
     16800**DCL     21420<<ASSIGN  21421>>DOUNTIL 21422>>IF      21423>>ASSIGN  21427>>IF      21428>>ASSIGN
     21431>>ASSIGN  21434<<ASSIGN  21434>>ASSIGN  21435>>IF      21436<<ASSIGN  21464<<DOINDEX 21465>>IF
     21471>>CALLBLT 21576<<ASSIGN  21595<<ASSIGN  21692<<ASSIGN  21732<<DOINDEX 21733>>ASSIGN  21734>>ASSIGN
     21755<<ASSIGN  21818<<ASSIGN  21819<>CALL    21896>>IF      21908>>IF      21947<<ASSIGN  22961>>ASSIGN
I IN PROCEDURE REBUILD_POLL_LIST
     22057**DCL     22069<<DOINDEX 22070>>IF      22072>>ASSIGN
I IN PROCEDURE RLS_BUFFER
     22179**DCL     22190<<ASSIGN  22193>>ASSIGN  22202<>CALL
J
     16801**DCL     21596<<ASSIGN  21693<<ASSIGN  21756<<ASSIGN  21920>>IF      21924>>IF      21948<<ASSIGN
     21992>>ASSIGN  22962>>ASSIGN
J IN PROCEDURE REBUILD_POLL_LIST
     22058**DCL     22068<<ASSIGN  22072>>ASSIGN  22072<<ASSIGN  22072>>ASSIGN  22075>>IF
KH$CHN.AUTLGN
     19650**DCL     21759>>IF
KH$CHN.CTX$
     19709**DCL     21688<<ASSIGN  21705<<ASSIGN
KH$CHN.LINSPD
     19693**DCL     22698>>ASSIGN
KH$CHN.TERMID
     19733**DCL     22436--ASSIGN  22542--ASSIGN  22637--ASSIGN  22699>>ASSIGN  23197--ASSIGN
KH$CHN.TERMID.TERM
     19735**DCL     19744--REDEF
KH$CHN.TERMID.TTYP
     19735**DCL     21687<<ASSIGN  21704<<ASSIGN
KHA$ERRLOG
     21293**DCL-ENT 23013--CALL
KHI$DISABLE
     17369**DCL-ENT 21481--CALL    21635--CALL    21721--CALL    21978--CALL    22015--CALL    22200--CALL
     22381--CALL    22406--CALL    22422--CALL    22440--CALL    22546--CALL    22588--CALL    22621--CALL
KHI$ENABLE
     17368**DCL-ENT 21487--CALL    21658--CALL    21740--CALL    21783--CALL    21984--CALL    22021--CALL
     22206--CALL    22387--CALL    22412--CALL    22429--CALL    22446--CALL    22552--CALL    22596--CALL
     22629--CALL    22643--CALL
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:280  
KH_INHLVL
     20901**DCL     21480>>ASSIGN  21485>>IF      21634>>ASSIGN  21656>>IF      21664>>ASSIGN  21720>>ASSIGN
     21738>>IF      21781>>IF      21977>>ASSIGN  21982>>IF      22014>>ASSIGN  22019>>IF      22199>>ASSIGN
     22204>>IF      22380>>ASSIGN  22385>>IF      22405>>ASSIGN  22410>>IF      22421>>ASSIGN  22427>>IF
     22439>>ASSIGN  22444>>IF      22545>>ASSIGN  22550>>IF      22587>>ASSIGN  22594>>IF      22620>>ASSIGN
     22627>>IF      22641>>IF
KH_PROFILE_
     20905**DCL     22673>>IF      22674--ASSIGN  22675--ASSIGN  22682--ASSIGN  22683--ASSIGN
KL_CONTROLLER.COLUMNS
     18561**DCL     21683>>ASSIGN
KL_CONTROLLER.CONT#
     18553**DCL     21675>>IF      21681>>ASSIGN
KL_CONTROLLER.ROWS
     18557**DCL     21682>>ASSIGN
KL_CONTROLLER.TYPE
     18567**DCL     21684>>ASSIGN
KL_LINEDEV.CONTROLLER#
     18700**DCL     21692>>ASSIGN
KL_LINEDEV.DEVICE#
     18703**DCL     21693>>ASSIGN  21697>>IF
KV$MRD.ATRRQRDSPPST
     20593**DCL     22722<<ASSIGN  22726<<ASSIGN  22729<<ASSIGN
KV$MRD.CALUSR_ERS
     20583**DCL     22712<<ASSIGN
KV$MRD.CALUSR_OTPRPTCHR
     20595**DCL     22710<<ASSIGN
KV$MRD.CALUSR_PST
     20583**DCL     22713<<ASSIGN
KV$MRD.CALUSR_SETATR
     20584**DCL     22711<<ASSIGN
KV$MRD.CTNFRM
     20594**DCL     22717<<ASSIGN
KV$MRD.ERD$
     20581**DCL     22714<<ASSIGN
KV$MRD.FSTERS
     20592**DCL     22721<<ASSIGN
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:281  
KV$MRD.MINSP_FORPST
     20583**DCL     22718<<ASSIGN
KV$MVD.ORG
     20633**DCL     23167>>IF
KV$OTPMRK
     20783**DCL     22125--ASSIGN  22129>>ASSIGN  22132--ASSIGN
KV$OTPMRK.ID
     20788**DCL     20788--REDEF   20789--REDEF
KV$PTR.INPCNDPND
     20748**DCL     20757--REDEF   20761--REDEF
KV$PTR.LINLST$
     20744**DCL     20745--REDEF
KV$PTR.MRD$
     20743**DCL     22710>>ASSIGN  22711>>ASSIGN  22712>>ASSIGN  22713>>ASSIGN  22714>>ASSIGN  22717>>ASSIGN
     22718>>ASSIGN  22721>>ASSIGN  22722>>ASSIGN  22726>>ASSIGN  22729>>ASSIGN
KV$PTR.MVD$
     20743**DCL     23167>>IF
KV$PTR.VDI$
     20742**DCL     22154>>IF      22155>>ASSIGN  22685>>ASSIGN  22686>>ASSIGN  22687>>ASSIGN  22688>>ASSIGN
     22689>>ASSIGN  22690>>ASSIGN  22691>>ASSIGN  22692>>ASSIGN  22693>>ASSIGN  22694>>ASSIGN  22695>>ASSIGN
     22696>>ASSIGN  22697>>ASSIGN  22707>>ASSIGN  22725>>ASSIGN  22728>>ASSIGN  23137>>ASSIGN
KV$PTR$
     20736**DCL     20742--IMP-PTR 22154>>IF      22155>>ASSIGN  22685>>ASSIGN  22686>>ASSIGN  22687>>ASSIGN
     22688>>ASSIGN  22689>>ASSIGN  22690>>ASSIGN  22691>>ASSIGN  22692>>ASSIGN  22693>>ASSIGN  22694>>ASSIGN
     22695>>ASSIGN  22696>>ASSIGN  22697>>ASSIGN  22707>>ASSIGN  22710>>ASSIGN  22711>>ASSIGN  22712>>ASSIGN
     22713>>ASSIGN  22714>>ASSIGN  22717>>ASSIGN  22718>>ASSIGN  22721>>ASSIGN  22722>>ASSIGN  22725>>ASSIGN
     22726>>ASSIGN  22728>>ASSIGN  22729>>ASSIGN  23041>>ASSIGN  23079>>ASSIGN  23080<<ASSIGN  23124<<ASSIGN
     23137>>ASSIGN  23139<<ASSIGN  23167>>IF
KV$STT
     18015**DCL     21637--ASSIGN  21639<<ASSIGN
KV$STT.REQSTATS.DSPENT
     18267**DCL     21643<<ASSIGN
KV$STT.REQSTATS.DSPMSK
     18261**DCL     18267--REDEF
KV$STT.REQSTATS.FNC
     18179**DCL     21640<<ASSIGN
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:282  
KV$STT.REQSTATS.SLCENT
     18309**DCL     21641<<ASSIGN  21642<<ASSIGN
KV$STT.REQSTATS.SLCMSK
     18302**DCL     18309--REDEF
KV$STT.USRENTCNT
     18371**DCL     23076<<ASSIGN  23076>>ASSIGN
KV$STT.USRENTDFRCNT
     18372**DCL     23084<<ASSIGN  23084>>ASSIGN
KV$USRPRM
     17306**DCL     21653--ASSIGN  21661<<ASSIGN
KV$USRPRM.HLTMSG
     17307**DCL     21662<<ASSIGN
KV$USRPRM.HLTMSGSIZ
     17306**DCL     21663<<ASSIGN
KV$USRPRM.INHLVL
     17306**DCL     21664<<ASSIGN
KV$USRPRM.STT$
     17333**DCL     21665<<ASSIGN  23076>>ASSIGN  23076>>ASSIGN  23084>>ASSIGN  23084>>ASSIGN
KV$USR_EVT
     16852**DCL     23128<<ASSIGN  23130<>CALL
KV$USR_EVT.ID
     16858**DCL     23129<<ASSIGN
KV$VDH_CNC
     16887**DCL     22668<<ASSIGN  22702<>CALL
KV$VDH_CNC.LCLENDPNTID
     16937**DCL     22699<<ASSIGN
KV$VDH_CNC.LCLENDPNTID.TERM
     16939**DCL     16948--REDEF
KV$VDH_CNC.LCLENDPNTID.TTYP
     16939**DCL     22700<<ASSIGN
KV$VDH_CNC.LINSPD
     16920**DCL     22698<<ASSIGN
KV$VDH_CNC.PRF_.ADR$
     16916**DCL     22674<<ASSIGN  22678<<ASSIGN  22682<<ASSIGN
KV$VDH_CNC.PRF_.BYTSIZ
     16916**DCL     22675<<ASSIGN  22679<<ASSIGN  22683<<ASSIGN
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:283  
KV$VDH_DAT
     16985**DCL     21503<<ASSIGN  21810<<ASSIGN  23182<>CALL
KV$VDH_DAT.DAT__.ADR$
     17021**DCL     21504<<ASSIGN  21811<<ASSIGN  23157>>ASSIGN  23169>>DOWHILE 23174>>ASSIGN
KV$VDH_DAT.DAT__.BYTX
     17021**DCL     21505<<ASSIGN  21812<<ASSIGN  23157>>ASSIGN  23169>>DOWHILE 23174>>ASSIGN
KV$VDH_DAT.DAT__.DATBYTSIZ
     17021**DCL     21506<<ASSIGN  21813<<ASSIGN  23163<<ASSIGN  23163>>ASSIGN  23169>>DOWHILE 23169>>DOWHILE
     23172<<ASSIGN  23172>>ASSIGN  23174>>ASSIGN  23178<<ASSIGN  23178>>ASSIGN
KV$VDH_DSC
     17059**DCL     22514<<ASSIGN  22518<>CALL
KV$VDH_DSC.ALLSSN
     17065**DCL     22517<<ASSIGN
KV$VDH_DSC.NO_IO
     17065**DCL     22516<<ASSIGN
KV$VDH_DSC.RSN
     17065**DCL     22515<<ASSIGN
KV$VDH_EVT
     17095**DCL     22557<<ASSIGN  22559<>CALL    22737<<ASSIGN  22739<>CALL
KV$VDH_EVT.ID
     17101**DCL     22558<<ASSIGN  22738<<ASSIGN
KV$VDH_INT
     17130**DCL     22648<<ASSIGN  22656<>CALL
KV$VDH_INT.CHN$
     17136**DCL     22649<<ASSIGN
KV$VDH_INT.RCVFLWCTRMAXCRD
     17137**DCL     22652<<ASSIGN
KV$VDH_INT.USRCTX$
     17136**DCL     22650<<ASSIGN
KV$VDH_INT.USRPRM$
     17137**DCL     22651<<ASSIGN
KV$VDH_INT.VDI$
     17137**DCL     22666>>ASSIGN
KV$VDH_OTPMRK
     17167**DCL     22128<<ASSIGN  22131<>CALL
KV$VDH_OTPMRK.CMPCOD
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:284  
     17200**DCL     22130<<ASSIGN
KV$VDH_OTPMRK.DAT
     17194**DCL     22129<<ASSIGN
KV$VDH_OTPMRK.DAT.ID
     17197**DCL     17197--REDEF   17198--REDEF
KV$VDI.ASNINPPTR$
     20672**DCL     23080>>ASSIGN
KV$VDI.BSY
     20706**DCL     23077>>IF      23078<<ASSIGN  23137<<ASSIGN
KV$VDI.DFR.USR
     20703**DCL     23083<<ASSIGN
KV$VDI.INPUNT
     20712**DCL     22725<<ASSIGN  22728<<ASSIGN
KV$VDI.OTPCNDPND.PST
     20708**DCL     23156<<ASSIGN  23184<<ASSIGN
KV$VDI.RQSOTP
     20707**DCL     22154>>IF      22155<<ASSIGN
KV$VDI.UN_KNWPST
     20710**DCL     23155<<ASSIGN  23183<<ASSIGN
KV$VDI.USEOTPBFRTRN
     20712**DCL     22707<<ASSIGN
KV$VDI.USREVTENB
     20714**DCL     22687<<ASSIGN  22688<<ASSIGN  22689<<ASSIGN  22690<<ASSIGN  22691<<ASSIGN  22692<<ASSIGN
     22693<<ASSIGN  22694<<ASSIGN  22695<<ASSIGN  22696<<ASSIGN  22697<<ASSIGN
KV$VDI.USRPRM$
     20672**DCL     23076>>ASSIGN  23076>>ASSIGN  23084>>ASSIGN  23084>>ASSIGN
KV$VDI.VDHEVTENB
     20719**DCL     22685<<ASSIGN  22686<<ASSIGN
KV@USRENT.SVDPTR$
     17220**DCL     23041<<ASSIGN  23079<<ASSIGN  23124>>ASSIGN  23139>>ASSIGN
KVB$GETSYS
     21296**DCL-ENT 21483--CALL    21638--CALL    21647--CALL    21654--CALL    21724--CALL    21980--CALL
     22017--CALL
KVB$RLSSYS
     21297**DCL-ENT 21819--CALL    21821--CALL    22202--CALL    22383--CALL    22408--CALL    22424--CALL
     22590--CALL    22592--CALL
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:285  
KVV$INT
     21295**DCL-ENT 22656--CALL
KVV$VDI
     21298**DCL-ENT 22131--CALL    22156--CALL    22518--CALL    22559--CALL    22702--CALL    22739--CALL
     23182--CALL
KV_ERD
     19184**DCL     19193--DCLINIT 22714--ASSIGN
KV_ERD.EXTSRD_CHR
     19227**DCL     19227--REDEF   19228--REDEF
KV_USR_EVT
     20935**DCL     23128>>ASSIGN
KV_VDH_CNC
     20970**DCL     22668>>ASSIGN
KV_VDH_CNC.LCLENDPNTID.TERM
     21022**DCL     21031--REDEF
KV_VDH_DAT
     21068**DCL     21503>>ASSIGN  21810>>ASSIGN
KV_VDH_DSC
     21142**DCL     22514>>ASSIGN
KV_VDH_EVT
     21178**DCL     22557>>ASSIGN  22737>>ASSIGN
KV_VDH_EVT_RQSOTP
     20893**DCL     22156<>CALL
KV_VDH_INT
     21213**DCL     22648>>ASSIGN
KV_VDH_OTPMRK
     21250**DCL     22128>>ASSIGN
KV_VDH_OTPMRK.DAT.ID
     21280**DCL     21280--REDEF   21281--REDEF
KZ$3270DV.LOGON.L
     20555**DCL     20556--IMP-SIZ
KZ$CLMEVENT
     17391**DCL     22434<<ASSIGN  22442<>CALL    22540<<ASSIGN  22548<>CALL    22615<<ASSIGN  22623<>CALL
     22635<<ASSIGN  22639<>CALL    23195<<ASSIGN  23199<>CALL
KZ$CLMEVENT.CHN$
     17404**DCL     22617<<ASSIGN
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:286  
KZ$CLMEVENT.EVENT
     17392**DCL     22435<<ASSIGN  22541<<ASSIGN  22616<<ASSIGN  22636<<ASSIGN  23196<<ASSIGN
KZ$CLMEVENT.LINCTX$
     17398**DCL     22437<<ASSIGN  22543<<ASSIGN  22618<<ASSIGN  22638<<ASSIGN  23198<<ASSIGN
KZ$CLMEVENT.TERMID$
     17401**DCL     22436<<ASSIGN  22542<<ASSIGN  22637<<ASSIGN  23197<<ASSIGN
KZ$EVENT.CHN$
     15955**DCL     21686>>ASSIGN  21687>>ASSIGN  21688>>ASSIGN  21703>>ASSIGN  21704>>ASSIGN  21705>>ASSIGN
KZ$EVENT.CHNCTX$
     15946**DCL     21675>>IF      21681>>ASSIGN  21682>>ASSIGN  21683>>ASSIGN  21684>>ASSIGN  21692>>ASSIGN
     21693>>ASSIGN  21697>>IF
KZ$EVENT.EVENT
     15943**DCL     21309>>DOCASE
KZ$EVENT.LINCTX$
     15949**DCL     21306>>ASSIGN
KZ$EVENT.TERMID$
     15952**DCL     21547>>DOCASE  21576>>ASSIGN  21595>>ASSIGN  21596>>ASSIGN  21669>>DOCASE  21748>>DOCASE
     21755>>ASSIGN  21756>>ASSIGN
KZ$HIPCTR
     20190**DCL     22017--CALL    22024--ASSIGN  22026<<ASSIGN  22408--CALL    22415--ASSIGN
KZ$HIPCTR.ADR
     20206**DCL     21424>>ASSIGN  21519>>IF      21523>>ASSIGN  21616>>ASSIGN  21675>>IF      21681<<ASSIGN
     21908>>IF      22989>>ASSIGN  23008>>ASSIGN
KZ$HIPCTR.CHN$
     20198**DCL     21686<<ASSIGN
KZ$HIPCTR.COLS
     20202**DCL     21683<<ASSIGN  21994>>ASSIGN
KZ$HIPCTR.DEVHD$
     20193**DCL     21530>>ASSIGN  21557>>ASSIGN  21578>>ASSIGN  21619>>ASSIGN  21695>>ASSIGN  21922>>ASSIGN
     21997>>ASSIGN  21998<<ASSIGN  22304>>ASSIGN  22323>>ASSIGN  22367>>ASSIGN  22374<<ASSIGN
KZ$HIPCTR.LIN$
     20196**DCL     21685<<ASSIGN  21798>>ASSIGN  21835>>ASSIGN  21844>>ASSIGN  21858>>ASSIGN  21875>>ASSIGN
     22987>>ASSIGN
KZ$HIPCTR.LNK$
     20191**DCL     21556>>ASSIGN  21677>>ASSIGN  21735>>ASSIGN  21910>>ASSIGN  22031>>ASSIGN  22034<<ASSIGN
     22398>>ASSIGN  22401>>ASSIGN  22403<<ASSIGN  22403>>ASSIGN
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:287  
KZ$HIPCTR.ROWS
     20204**DCL     21682<<ASSIGN  21993>>ASSIGN
KZ$HIPCTR.TIMED_OUT_ONCE
     20211**DCL     22362<<ASSIGN
KZ$HIPCTR.TYP
     20200**DCL     21463>>IF      21684<<ASSIGN  21706>>IF      21995>>IF      22671>>DOSELCT 22723>>DOSELCT
     23159>>DOSELCT
KZ$HIPDEV
     20242**DCL     21980--CALL    21987--ASSIGN  21990<<ASSIGN  22163<>CALL    22383--CALL    22390--ASSIGN
KZ$HIPDEV.ACTIVE
     20290**DCL     21532>>IF      21533<<ASSIGN  21563>>IF      21564<<ASSIGN  21584>>IF      21585<<ASSIGN
     21599>>IF      21600<<ASSIGN  21621<<ASSIGN  21759>>IF      22285<<ASSIGN  22357>>IF      22459>>IF
     22510>>IF      22516>>ASSIGN  22703<<ASSIGN
KZ$HIPDEV.ADR
     20343**DCL     21697>>IF      21710>>ASSIGN  21924>>IF      21992<<ASSIGN  22990>>ASSIGN  23009>>ASSIGN
     23165>>IF
KZ$HIPDEV.AWAIT_ENABLE
     20400**DCL     21759>>IF      22344<<ASSIGN  22632<<ASSIGN  22646<<ASSIGN
KZ$HIPDEV.CHN$
     20249**DCL     21703<<ASSIGN  21759>>IF      22542>>ASSIGN  22617>>ASSIGN  22637>>ASSIGN  22649>>ASSIGN
     22698>>ASSIGN  22699>>ASSIGN
KZ$HIPDEV.CLRD
     20402**DCL     22293<<ASSIGN  22306>>IF      22325<<ASSIGN
KZ$HIPDEV.COLS
     20382**DCL     21994<<ASSIGN
KZ$HIPDEV.CTR$
     20245**DCL     21323>>ASSIGN  21452>>ASSIGN  21797>>ASSIGN  21834>>ASSIGN  21843>>ASSIGN  21857>>ASSIGN
     21874>>ASSIGN  21991<<ASSIGN  22089>>ASSIGN  22987>>ASSIGN  22989>>ASSIGN  23008>>ASSIGN
KZ$HIPDEV.DFR.DSCI
     20367**DCL     22522<<ASSIGN  22528>>IF      22529<<ASSIGN
KZ$HIPDEV.DFRHD$
     20256**DCL     21498<<ASSIGN  21801>>DOWHILE 21802>>ASSIGN  21803<<ASSIGN  21804>>IF      22117<<ASSIGN
     22184>>IF      22463<<ASSIGN  22575>>DOWHILE 22576>>ASSIGN  22577<<ASSIGN  22578>>IF
KZ$HIPDEV.DFRTL$
     20260**DCL     21495>>IF      21496>>ASSIGN  21499<<ASSIGN  21805<<ASSIGN  22114>>IF      22115>>ASSIGN
     22118<<ASSIGN  22460>>IF      22461>>ASSIGN  22464<<ASSIGN  22579<<ASSIGN
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:288  
KZ$HIPDEV.DONE
     20306**DCL     22162>>IF      22215>>IF
KZ$HIPDEV.DSC
     20345**DCL     21467>>IF      22215>>IF      22350<<ASSIGN
KZ$HIPDEV.DSC.DEV_FINAL
     20358**DCL     22167<<ASSIGN  22556<<ASSIGN
KZ$HIPDEV.DSC.INT
     20352**DCL     22507<<ASSIGN
KZ$HIPDEV.DSC.TOLD_VDH
     20354**DCL     22509<<ASSIGN
KZ$HIPDEV.DSC.VDH_FINAL
     20356**DCL     22165>>IF      22555<<ASSIGN
KZ$HIPDEV.DSC_LATER
     20396**DCL     22352<<ASSIGN
KZ$HIPDEV.EWALT
     20294**DCL     21707<<ASSIGN  21709<<ASSIGN  21996<<ASSIGN  22050>>IF
KZ$HIPDEV.HLT
     20315**DCL     21327>>IF      22247>>IF      22347<<ASSIGN  22495>>IF      22496<<ASSIGN
KZ$HIPDEV.HLT.INP
     20330**DCL     21387<<ASSIGN  21455>>IF      21457<<ASSIGN
KZ$HIPDEV.HLT.PAG
     20326**DCL     21386<<ASSIGN  21455>>IF      21456<<ASSIGN
KZ$HIPDEV.HLT.WACK
     20321**DCL     21327>>IF      22247>>IF
KZ$HIPDEV.IGN_INP
     20312**DCL     21454<<ASSIGN  21459<<ASSIGN  21468<<ASSIGN  21475>>IF
KZ$HIPDEV.KBDLCK
     20392**DCL     22351<<ASSIGN
KZ$HIPDEV.LNK$
     20243**DCL     21536>>ASSIGN  21562>>ASSIGN  21583>>ASSIGN  21623>>ASSIGN  21699>>ASSIGN  21926>>ASSIGN
     21997<<ASSIGN  22307>>ASSIGN  22326>>ASSIGN  22371>>ASSIGN  22374>>ASSIGN  22376<<ASSIGN  22376>>ASSIGN
KZ$HIPDEV.ONOTP
     20398**DCL     21337<<ASSIGN  22247>>IF      22269<<ASSIGN  22469>>IF      22471<<ASSIGN
KZ$HIPDEV.OTPBSY
     20302**DCL     21344<<ASSIGN  21366<<ASSIGN  22097<<ASSIGN  22184>>IF      22346<<ASSIGN  22468<<ASSIGN
KZ$HIPDEV.OTPBYTES
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:289  
     20339**DCL     22183<<ASSIGN  22183>>ASSIGN  22184>>IF      22187<<ASSIGN  22991>>ASSIGN
KZ$HIPDEV.OTPCNT
     20262**DCL     22093<<ASSIGN  22093>>ASSIGN  22094>>IF      22138>>IF      22162>>IF      22215>>IF
     22247>>IF      22467<<ASSIGN
KZ$HIPDEV.OTPHD$
     20251**DCL     21322>>ASSIGN  21367>>ASSIGN  21384>>ASSIGN  22090>>ASSIGN  22092<<ASSIGN  22165>>IF
     22184>>IF      22459>>IF      22461>>ASSIGN  22463>>ASSIGN  22464>>ASSIGN  22465<<ASSIGN  22497>>IF
KZ$HIPDEV.OTPLNK$
     20404**DCL     21336>>ASSIGN  22256>>ASSIGN  22262<<ASSIGN  22266<<ASSIGN  22475>>ASSIGN  22481>>ASSIGN
     22484<<ASSIGN  22484>>ASSIGN  22486>>IF
KZ$HIPDEV.OTPTL$
     20254**DCL     22095<<ASSIGN  22466<<ASSIGN
KZ$HIPDEV.PRINTER
     20300**DCL     21710<<ASSIGN  21759>>IF      22138>>IF      22716>>IF
KZ$HIPDEV.PRO
     20264**DCL     22049<<ASSIGN
KZ$HIPDEV.PRO.EWALT
     20269**DCL     22051<<ASSIGN
KZ$HIPDEV.REACT
     20394**DCL     21601<<ASSIGN  22283>>IF      22284<<ASSIGN  22741<<ASSIGN
KZ$HIPDEV.ROWS
     20380**DCL     21993<<ASSIGN
KZ$HIPDEV.THROTL
     20297**DCL     22137>>IF      22139<<ASSIGN  22141<<ASSIGN  22215>>IF      22345<<ASSIGN
KZ$HIPDEV.VDI$
     20247**DCL     21475>>IF      21477<>CALL    21509<>CALL    21773<>CALL    21873<<ASSIGN  22112<>CALL
     22222<>CALL    22281>>IF      22503>>IF      22506<>CALL    22519<>CALL    22530<>CALL    22612>>IF
     22705<<ASSIGN  23076>>ASSIGN  23076>>ASSIGN  23077>>IF      23078>>ASSIGN  23080>>ASSIGN  23083>>ASSIGN
     23084>>ASSIGN  23084>>ASSIGN  23155>>ASSIGN  23156>>ASSIGN  23183>>ASSIGN  23184>>ASSIGN
KZ$INPBFR
     20423**DCL     21483--CALL    21490<<ASSIGN  21821--CALL    22592--CALL
KZ$INPBFR.BFR_SIZ
     20438**DCL     21491<<ASSIGN  21815>>ASSIGN  21818>>ASSIGN  22590<>CALL
KZ$INPBFR.BYTX
     20440**DCL     21493<<ASSIGN  21812>>ASSIGN
KZ$INPBFR.DATA$
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:290  
     20442**DCL     21494<<ASSIGN  21811>>ASSIGN  21817>>ASSIGN  22585>>ASSIGN
KZ$INPBFR.DATA_SIZ
     20436**DCL     21492<<ASSIGN  21813>>ASSIGN
KZ$INPBFR.LNK$
     20424**DCL     21496<<ASSIGN
KZ$INPDESC
     20227**DCL     21461>>ASSIGN
KZ$LINCTX.ACTCTR
     20118**DCL     21522<<ASSIGN  21522>>ASSIGN  21615<<ASSIGN  21615>>ASSIGN
KZ$LINCTX.CHAN
     19850**DCL     22960>>ASSIGN  22987>>ASSIGN  23006>>ASSIGN
KZ$LINCTX.CHN$
     19762**DCL     22436>>ASSIGN  23197>>ASSIGN
KZ$LINCTX.CTRHD$
     19760**DCL     21551>>ASSIGN  21673>>ASSIGN  21731>>ASSIGN  21906>>ASSIGN  22028>>ASSIGN  22036<<ASSIGN
     22331>>IF      22394>>ASSIGN  22401<<ASSIGN
KZ$LINCTX.CTRLST$
     20103**DCL     21423>>ASSIGN  21614>>ASSIGN  21725<<ASSIGN  21734>>ASSIGN  22419>>IF      22424<>CALL
     22432<<ASSIGN
KZ$LINCTX.CURCTR$
     20055**DCL     21343<<ASSIGN  21382>>ASSIGN  21426<<ASSIGN  21518>>ASSIGN  21951<<ASSIGN
KZ$LINCTX.CURDEV$
     20058**DCL     21342<<ASSIGN  21365>>ASSIGN  21383>>ASSIGN  21419<<ASSIGN  21451>>ASSIGN  21953<<ASSIGN
     21962<<ASSIGN  21989<<ASSIGN  22088>>ASSIGN
KZ$LINCTX.DSCRSN
     19930**DCL     21565<>CALL    21586<>CALL    21602<>CALL
KZ$LINCTX.DSC_LEV
     20157**DCL     21550<<ASSIGN  21575<<ASSIGN  21594<<ASSIGN  22288>>DOCASE  22318>>DOCASE  22337>>DOCASE
KZ$LINCTX.FLAGS.DSC
     19867**DCL     22287>>IF      22296<<ASSIGN  22328<<ASSIGN
KZ$LINCTX.INACT_CTR
     20110**DCL     21420>>ASSIGN  21421>>DOUNTIL 21428<<ASSIGN  21430<<ASSIGN
KZ$LINCTX.INPBFR$
     20065**DCL     21462>>ASSIGN  21471>>CALLBLT 21494>>ASSIGN  21500<<ASSIGN  21504>>ASSIGN  21946>>ASSIGN
KZ$LINCTX.INPBFRSIZ
     20067**DCL     21491>>ASSIGN
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:291  
KZ$LINCTX.INPDATSIZ
     20069**DCL     21447>>ASSIGN
KZ$LINCTX.LINID
     19780**DCL     22944>>ASSIGN
KZ$LINCTX.LINID.TERM
     19782**DCL     19791--REDEF
KZ$LINCTX.OTPBFR$
     20071**DCL     21316<<ASSIGN  21339<<ASSIGN
KZ$LINCTX.OTPCNT
     20047**DCL     20050--REDEF   21319>>IF      21333<<ASSIGN  21333>>ASSIGN  21334>>IF      22251>>ASSIGN
     22263>>IF      22268<<ASSIGN  22268>>ASSIGN  22476<<ASSIGN  22476>>ASSIGN  22477>>IF      22485<<ASSIGN
     22485>>ASSIGN
KZ$LINCTX.OTPCTR$
     20077**DCL     21317<<ASSIGN  21341<<ASSIGN
KZ$LINCTX.OTPDEV$
     20084**DCL     21318<<ASSIGN  21340<<ASSIGN  22377<<ASSIGN
KZ$LINCTX.OTPHD$
     20060**DCL     21321>>ASSIGN  21336<<ASSIGN  22250>>ASSIGN  22264<<ASSIGN  22378<<ASSIGN  22472>>ASSIGN
     22475<<ASSIGN
KZ$LINCTX.OTPTL$
     20063**DCL     21335<<ASSIGN  22266>>ASSIGN  22267<<ASSIGN  22477<<ASSIGN  22486<<ASSIGN
KZ$LINCTX.POLADR.CTR
     20091**DCL     21424<<ASSIGN
KZ$LINCTX.POLADR.DEV
     20092**DCL     21425<<ASSIGN
KZ$LINCTX.POLLST$
     20098**DCL     21422>>IF      21519>>IF      21523>>ASSIGN  21616>>ASSIGN  21726<<ASSIGN  21728>>ASSIGN
     21733>>ASSIGN  22070>>IF      22072>>ASSIGN
KZ$LINCTX.POLLTBL$
     20146**DCL     21406>>ASSIGN  21407>>ASSIGN  21728<<ASSIGN  21729>>ASSIGN  22064>>ASSIGN  22065>>ASSIGN
     22066>>ASSIGN  22067>>ASSIGN  22072>>ASSIGN
KZ$LINCTX.POLSIZ
     20093**DCL     20095--REDEF   21427>>IF      21435>>IF      21672<<ASSIGN  21672>>ASSIGN  21723>>ASSIGN
     21726>>ASSIGN  21728>>ASSIGN  21732>>DOINDEX 22069>>DOINDEX 22424>>CALL
KZ$LINCTX.POLX
     20113**DCL     21431<<ASSIGN  21614>>ASSIGN  21616>>ASSIGN
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:292  
KZ$OTPBFR.BFRSIZ
     20499**DCL     22125>>ASSIGN  22190>>ASSIGN  22191>>ASSIGN  22191>>ASSIGN
KZ$OTPBFR.CMPCOD
     20502**DCL     21368<<ASSIGN  22130>>ASSIGN  22194>>IF      22582<<ASSIGN
KZ$OTPBFR.DATA_SIZ
     20497**DCL     22183>>ASSIGN  22195>>ASSIGN
KZ$OTPBFR.FLAGS.CNT#
     20471**DCL     22182>>IF
KZ$OTPBFR.FLAGS.HALT.INP#
     20480**DCL     21387>>ASSIGN
KZ$OTPBFR.FLAGS.HALT.PAG#
     20478**DCL     21386>>ASSIGN
KZ$OTPBFR.LNK$
     20457**DCL     21803>>ASSIGN  22092>>ASSIGN  22115<<ASSIGN  22119<<ASSIGN  22461<<ASSIGN  22577>>ASSIGN
KZ$OTPBFR.MRKCNT
     20504**DCL     22124>>IF      22125>>ASSIGN  22127>>DOWHILE 22133<<ASSIGN  22133>>ASSIGN  22215>>IF
KZ$OTPBFR.TYP
     20459**DCL     21806>>DOCASE  22580>>DOCASE
KZ$POLLHIP.CONTINUE_POLL
     20219**DCL     21407<<ASSIGN  22067<<ASSIGN
KZ$POLLHIP.INDX
     20218**DCL     21406<<ASSIGN  22065<<ASSIGN
KZ$POLLHIP.POLLX
     20221**DCL     22066<<ASSIGN
KZ$POLLHIP.POLL_LIST
     20222**DCL     20223--REDEF   20224--REDEF   22072<<ASSIGN
KZ$POLLHIP.REBUILD_POLL
     20220**DCL     21729<<ASSIGN  22064<<ASSIGN
KZ@HIPSTT
     17561**DCL     21646--ASSIGN  21648<<ASSIGN
KZ@HIPSTT.BLKIN
     17913**DCL     21446<<ASSIGN  21446>>ASSIGN
KZ@HIPSTT.BLKOUT
     17911**DCL     22196<<ASSIGN  22196>>ASSIGN
KZ@HIPSTT.CHRIN
     17909**DCL     21447<<ASSIGN  21447>>ASSIGN
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:293  
KZ@HIPSTT.CHROUT
     17907**DCL     22195<<ASSIGN  22195>>ASSIGN
KZ@HIPSTT.KHSTT.CTXBYTUTL
     17905**DCL     21987<<ASSIGN  21987>>ASSIGN  22024<<ASSIGN  22024>>ASSIGN  22390<<ASSIGN  22390>>ASSIGN
     22415<<ASSIGN  22415>>ASSIGN
KZ@HIPSTT.KHSTT.INPBFRBYTUTL
     17904**DCL     21815<<ASSIGN  21815>>ASSIGN
KZ@HIPSTT.KHSTT.OTPBFRBYTUTL
     17904**DCL     22193<<ASSIGN  22193>>ASSIGN
KZ@HIPSTT.OTPBFRSIZ
     17950**DCL     22191<<ASSIGN  22191>>ASSIGN
KZ@HIPSTT.REQSTATS.DSPENT
     17838**DCL     21650<<ASSIGN
KZ@HIPSTT.REQSTATS.DSPMSK
     17832**DCL     17838--REDEF
KZ@HIPSTT.REQSTATS.FNC
     17750**DCL     21649<<ASSIGN
KZ@HIPSTT.REQSTATS.SLCENT
     17880**DCL     21651<<ASSIGN  21652<<ASSIGN
KZ@HIPSTT.REQSTATS.SLCMSK
     17873**DCL     17880--REDEF
KZ@INPDESC
     20825**DCL     21461<<ASSIGN
KZ@INPDESC.BYTX
     20826**DCL     21462>>ASSIGN  21470<<ASSIGN  21470>>ASSIGN  21471>>CALLBLT 21493>>ASSIGN  21505>>ASSIGN
KZ@INPDESC.DATBYTSIZ
     20827**DCL     21469<<ASSIGN  21469>>ASSIGN  21492>>ASSIGN  21506>>ASSIGN
KZH$CMPOTP
     21294**DCL-ENT 22163--CALL
KZH$HIP
     21292**DCL-ENT 19146--DCLINIT 23130--CALL
KZH_THRTL_INIT
     20902**DCL     22652>>ASSIGN
KZH_USRPRM$
     19237**DCL     21654<>CALL    21661>>ASSIGN  21662>>ASSIGN  21663>>ASSIGN  21664>>ASSIGN  21665>>ASSIGN
     22651>>ASSIGN
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:294  
KZT_CNCDSC@
     21291**DCL     22442>>CALL    22548>>CALL    22623>>CALL    22639>>CALL    23199>>CALL
KZ_ASC95
     19236**DCL     19234--DCLINIT
KZ_CLMEVENT
     17473**DCL     22434>>ASSIGN  22540>>ASSIGN  22615>>ASSIGN  22635>>ASSIGN  23195>>ASSIGN
KZ_HIPCTR
     18747**DCL     22026>>ASSIGN
KZ_HIPDEV
     18784**DCL     21990>>ASSIGN
KZ_HIP_BFRSIZ
     21285**DCL     22125>>ASSIGN  22190>>ASSIGN
KZ_HIP_HDR.STTBFR$
     20858**DCL     17561--IMP-PTR 21446>>ASSIGN  21446>>ASSIGN  21447>>ASSIGN  21447>>ASSIGN  21647<>CALL
     21648>>ASSIGN  21649>>ASSIGN  21650>>ASSIGN  21651>>ASSIGN  21652>>ASSIGN  21815>>ASSIGN  21815>>ASSIGN
     21987>>ASSIGN  21987>>ASSIGN  22024>>ASSIGN  22024>>ASSIGN  22191>>ASSIGN  22191>>ASSIGN  22193>>ASSIGN
     22193>>ASSIGN  22195>>ASSIGN  22195>>ASSIGN  22196>>ASSIGN  22196>>ASSIGN  22390>>ASSIGN  22390>>ASSIGN
     22415>>ASSIGN  22415>>ASSIGN
KZ_INPBFR
     18965**DCL     21490>>ASSIGN
KZ_INPFNCTBLHED$
     19235**DCL     19145--DCLINIT
KZ_TRNTBLHED$
     19234**DCL     19146--DCLINIT
KZ_USRPRM
     19119**DCL     21661>>ASSIGN
KZ_VDHSTT$
     16791**DCL     18015--IMP-PTR 21631>>IF      21638<>CALL    21639>>ASSIGN  21640>>ASSIGN  21641>>ASSIGN
     21642>>ASSIGN  21643>>ASSIGN  21665>>ASSIGN
LIN$
     16792**DCL     19759--IMP-PTR 21306<<ASSIGN  21316>>ASSIGN  21317>>ASSIGN  21318>>ASSIGN  21319>>IF
     21321>>ASSIGN  21333>>ASSIGN  21333>>ASSIGN  21334>>IF      21335>>ASSIGN  21336>>ASSIGN  21339>>ASSIGN
     21340>>ASSIGN  21341>>ASSIGN  21342>>ASSIGN  21343>>ASSIGN  21365>>ASSIGN  21382>>ASSIGN  21383>>ASSIGN
     21406>>ASSIGN  21407>>ASSIGN  21419>>ASSIGN  21420>>ASSIGN  21421>>DOUNTIL 21422>>IF      21423>>ASSIGN
     21424>>ASSIGN  21425>>ASSIGN  21426>>ASSIGN  21427>>IF      21428>>ASSIGN  21430>>ASSIGN  21431>>ASSIGN
     21435>>IF      21447>>ASSIGN  21451>>ASSIGN  21462>>ASSIGN  21471>>CALLBLT 21491>>ASSIGN  21494>>ASSIGN
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:295  
     21500>>ASSIGN  21504>>ASSIGN  21518>>ASSIGN  21519>>IF      21522>>ASSIGN  21522>>ASSIGN  21523>>ASSIGN
     21550>>ASSIGN  21551>>ASSIGN  21565>>CALL    21575>>ASSIGN  21586>>CALL    21594>>ASSIGN  21602>>CALL
     21614>>ASSIGN  21614>>ASSIGN  21615>>ASSIGN  21615>>ASSIGN  21616>>ASSIGN  21616>>ASSIGN  21672>>ASSIGN
     21672>>ASSIGN  21673>>ASSIGN  21685>>ASSIGN  21723>>ASSIGN  21725>>ASSIGN  21726>>ASSIGN  21726>>ASSIGN
     21728>>ASSIGN  21728>>ASSIGN  21728>>ASSIGN  21729>>ASSIGN  21731>>ASSIGN  21732>>DOINDEX 21733>>ASSIGN
     21734>>ASSIGN  21798<<ASSIGN  21835<<ASSIGN  21844<<ASSIGN  21858<<ASSIGN  21875<<ASSIGN  21906>>ASSIGN
     21946>>ASSIGN  21951>>ASSIGN  21953>>ASSIGN  21962>>ASSIGN  21989>>ASSIGN  22028>>ASSIGN  22036>>ASSIGN
     22064>>ASSIGN  22065>>ASSIGN  22066>>ASSIGN  22067>>ASSIGN  22069>>DOINDEX 22070>>IF      22072>>ASSIGN
     22072>>ASSIGN  22088>>ASSIGN  22250>>ASSIGN  22251>>ASSIGN  22263>>IF      22264>>ASSIGN  22266>>ASSIGN
     22267>>ASSIGN  22268>>ASSIGN  22268>>ASSIGN  22287>>IF      22288>>DOCASE  22296>>ASSIGN  22318>>DOCASE
     22328>>ASSIGN  22331>>IF      22337>>DOCASE  22377>>ASSIGN  22378>>ASSIGN  22394>>ASSIGN  22401>>ASSIGN
     22419>>IF      22424>>CALL    22424>>CALL    22432>>ASSIGN  22436>>ASSIGN  22437>>ASSIGN  22472>>ASSIGN
     22475>>ASSIGN  22476>>ASSIGN  22476>>ASSIGN  22477>>IF      22477>>ASSIGN  22485>>ASSIGN  22485>>ASSIGN
     22486>>ASSIGN  22543>>ASSIGN  22618>>ASSIGN  22638>>ASSIGN  22944>>ASSIGN  22960>>ASSIGN  23006>>ASSIGN
     23189<<ASSIGN  23197>>ASSIGN  23198>>ASSIGN
LINCTX
     16202**DCL     23189--ASSIGN
LINCTX.LINID.TERM
     16225**DCL     16234--REDEF
LINCTX.OTPCNT
     16490**DCL     16493--REDEF
LINCTX.POLSIZ
     16536**DCL     16538--REDEF
LOGON_STRING_LENGTH
     16804**DCL     20831--IMP-SIZ
M$XXX
      4792**DCL-ENT 21768--CALL
NOMEM IN PROCEDURE BLD_CTR_CTX
     22039**LABEL   22017--CALLALT
NOMEM IN PROCEDURE BLD_DEV_CTX
     22002**LABEL   21980--CALLALT
NOMEM IN PROCEDURE FND_CTX
     21965**LABEL   21961--CALLALT
NONE
     21599**LABEL   21577--CALLALT 21597--CALLALT 21598--CALLALT
NOT_RELEASED IN PROCEDURE DEL_DFRD
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:296  
     22603**LABEL   22583--CALLALT
NO_ACTIVE_CONTROLLERS
     21407**LABEL   21408--CALLALT
NO_CTR IN PROCEDURE FND_CTX
     21958**LABEL   21950--CALLALT
NO_CTRLR
     21713**LABEL   21694--CALLALT
NO_MEMORY
     21781**LABEL   21483--CALLALT 21638--CALLALT 21647--CALLALT 21654--CALLALT 21679--CALLALT 21701--CALLALT
     21724--CALLALT
NO_WAY
     21759**LABEL   21757--CALLALT 21758--CALLALT
OTPBFR$
     16626**DCL     21860>>ASSIGN
P$
     20820**DCL     21423>>ASSIGN  21614>>ASSIGN  21734<<ASSIGN
P1$
     16797**DCL     22027<<ASSIGN  22030<<ASSIGN  22033>>IF      22034>>ASSIGN  22368<<ASSIGN  22370<<ASSIGN
     22373>>IF      22376>>ASSIGN  22395<<ASSIGN  22397<<ASSIGN  22400>>IF      22403>>ASSIGN  22666<<ASSIGN
     22705>>ASSIGN
PARM1
     15927**DCL         9--PROC    15942--REDEF   16021--REDEF   16202--REDEF   21794--ENTRY   21831--ENTRY
     21840--ENTRY   21854--ENTRY   21870--ENTRY   23188--ENTRY
PARM2
     16623**DCL         9--PROC    16624--REDEF   16625--REDEF   16626--REDEF   16627--REDEF   16628--REDEF
     21854--ENTRY
POLADR
     18728**DCL     21424>>ASSIGN  21616>>ASSIGN
POLADR_B
     18723**DCL     18728--REDEF
PRO_ATTR
     18988**DCL     22678--ASSIGN
PSTAT
     16627**DCL     21461--ASSIGN
PTR$
     16795**DCL     20523--IMP-PTR
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:297  
REALLY_CLR_CTR
     22393**PROC    22320--CALL
REALLY_CLR_DEV
     22366**PROC    22290--CALL
REALLY_CLR_LINE
     22418**PROC    22339--CALL
REBUILD_POLL_LIST
     22055**PROC    21408--CALL    21524--CALL    21618--CALL
RELOTPBFR IN PROCEDURE UNQRELOTPBFR
     22101**ENTRY   21808--CALL    21861--CALL    22583--CALL
REQUEUE
     22243**PROC    21369--CALL    21393--CALL    21458--CALL    21862--CALL    22498--CALL
RLS_BUFFER IN PROCEDURE UNQRELOTPBFR
     22177**PROC    22136--CALL    22226--CALL
RLS_CTR
     22317**PROC    21559--CALL    21580--CALL    22309--CALL
RLS_DEV
     22279**PROC    21568--CALL    21589--CALL    21605--CALL    21876--CALL
RLS_LINE
     22336**PROC    21553--CALL    22331--CALL
RSN IN PROCEDURE DSC_DEV
     22455**DCL     22454--PROC    22515>>ASSIGN  22526--ENTRY
SELADR_B
     18730**DCL     18735--REDEF
SETCTR
     21681**LABEL   21676--GOTO
SETDEV
     21703**LABEL   21698--GOTO
SET_PRO
     22047**PROC    21711--CALL    21999--CALL    22356--CALL
STATUS
     16810**DCL     16811--REDEF   16812--REDEF   21946<<ASSIGN
STATUSB.I
     16813**DCL     21947>>ASSIGN
STATUSB.J
     16814**DCL     21948>>ASSIGN
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:298  
STAT_
     19265**DCL     19602--REDEF
SZ
     16798**DCL     21637<<ASSIGN  21638<>CALL    21646<<ASSIGN  21647<>CALL    21653<<ASSIGN  21654<>CALL
     21723<<ASSIGN  21724<>CALL    23011>>ASSIGN
T$
     16796**DCL     21483<>CALL    21490>>ASSIGN  21491>>ASSIGN  21492>>ASSIGN  21493>>ASSIGN  21494>>ASSIGN
     21496>>ASSIGN  21498>>ASSIGN  21499>>ASSIGN  21724<>CALL    21725>>ASSIGN  21726>>ASSIGN  21817<<ASSIGN
     21819<>CALL    21820<<ASSIGN  21821<>CALL    21980<>CALL    21988>>ASSIGN  22017<>CALL    22025>>ASSIGN
     22028<<ASSIGN  22029>>DOWHILE 22030>>ASSIGN  22031<<ASSIGN  22031>>ASSIGN  22367<<ASSIGN  22369>>DOWHILE
     22370>>ASSIGN  22371<<ASSIGN  22371>>ASSIGN  22383<>CALL    22394<<ASSIGN  22396>>DOWHILE 22397>>ASSIGN
     22398<<ASSIGN  22398>>ASSIGN  22408<>CALL    22585<<ASSIGN  22590<>CALL    22591<<ASSIGN  22592<>CALL
T$ IN PROCEDURE RLS_BUFFER
     22180**DCL     22189<<ASSIGN  22202<>CALL
TBFR$
     16809**DCL     20547--IMP-PTR 22125<<ASSIGN  22129>>ASSIGN  22132<<ASSIGN  22132>>ASSIGN
TCNT IN PROCEDURE REQUEUE
     22245**DCL     22251<<ASSIGN  22253>>DOWHILE 22257<<ASSIGN  22257>>ASSIGN  22260>>IF
TCTR$
     16815**DCL     21556<<ASSIGN  21571>>ASSIGN
TDEV$
     16816**DCL     21562<<ASSIGN  21569>>ASSIGN  21583<<ASSIGN  21590>>ASSIGN
TDEV$ IN PROCEDURE REQUEUE
     22244**DCL     22250<<ASSIGN  22253>>DOWHILE 22255>>IF      22256<<ASSIGN  22256>>ASSIGN  22260>>IF
TELL_VDH IN PROCEDURE DSC_DEV
     22509**LABEL   22531--GOTO
UBYT
     20821**DCL     21422>>IF      21519>>IF      21523<<ASSIGN  21616<<ASSIGN  21733<<ASSIGN  22070>>IF
     22072>>ASSIGN
UNQRELOTPBFR
     22083**PROC    21389--CALL
VDH_FLG
     16818**DCL     21307<<ASSIGN  21772>>IF      21799<<ASSIGN  21836<<ASSIGN  21845<<ASSIGN  21859<<ASSIGN
     22215>>IF      22654<<ASSIGN  23028>>IF      23029<<ASSIGN  23029>>ASSIGN  23091<<ASSIGN  23109>>IF
     23112<<ASSIGN  23112>>ASSIGN  23113>>IF
VDH_SPECIFIC IN PROCEDURE UNQRELOTPBFR
PL6.E3A0      #001=KZH$HIPDV File=KZH$HIPDV.:E05TSI                              WED 07/30/97 02:51 Page:299  
     22109**PROC    22221--CALL
VDI$ IN PROCEDURE ENTER_VDH
     23026**DCL     23023--PROC    23034>>IF
VDI$ IN PROCEDURE EXIT_VDH
     23107**DCL     23105--PROC    23115>>IF
VLP_TRMATTR
     19008**DCL     18990--DCLINIT 22679--ASSIGN
VLP_TRMCTL
     19049**DCL     19031--DCLINIT 22679--ASSIGN
VLP_TRMCTL.BREAKCOUNT
     19060**DCL     19061--REDEF
XIT
     21772**LABEL   21788--GOTO

PL6.E3A0      #002=KZH$HIPINIT File=KZH$HIPDV.:E05TSI                            WED 07/30/97 02:55 Page:300  
     1811        1        /*T***********************************************************/
     1812        2        /*T*                                                         */
     1813        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1814        4        /*T*                                                         */
     1815        5        /*T***********************************************************/
     1816        6        %EJECT;
PL6.E3A0      #002=KZH$HIPINIT File=KZH$HIPDV.:E05TSI                            WED 07/30/97 02:55 Page:301  
     1817        7
     1818        8        KZH$HIPINIT: PROC(HDR_INIT);
     1819        9
     1820       10        %INCLUDE KZ$LINCTX;
     1821      630        %INCLUDE KL_SUPER_C;
     1822     3532
     1823     3533        %KZ$INIT(FPTN=HDR_INIT, STCLASS="  ");
     1824     3555
     1825     3556    1   DCL KZ_HDR$(0:13) PTR BASED;
     1826     3557    1   DCL KZ_HIP_HDR UBIN SYMREF;
     1827     3558    1   DCL KZT_ORDERS@ EPTR SYMREF;
     1828     3559    1   DCL KZT_GO@ EPTR SYMREF;
     1829     3560    1   DCL KZT_CNCDSC@ EPTR SYMREF;
     1830     3561    1   DCL P$ PTR;
     1831     3562
     1832     3563
     1833     3564    1           P$=HDR_INIT.HDR$;
     1834     3565    1           P$->KZ_HDR$(%KLPT_HIP#*2)=ADDR(KZ_HIP_HDR);
     1835     3566    1           KZT_ORDERS@=HDR_INIT.ORDERS;
     1836     3567    1           KZT_CNCDSC@=HDR_INIT.CNCDSC;
     1837     3568    1           KZT_GO@=HDR_INIT.GO;
     1838     3569
     1839     3570    1           RETURN;
     1840     3571
     1841     3572    1   END;

PL6.E3A0      #002=KZH$HIPINIT File=KZH$HIPDV.:E05TSI                            WED 07/30/97 02:55 Page:302  
--  Include file information  --

   KL_SUPER_C.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
      No diagnostics issued in procedure KZH$HIPINIT.

   Procedure KZH$HIPINIT requires 33 words for executable code.
   Procedure KZH$HIPINIT requires 8 words of local(AUTO) storage.

    No errors detected in file KZH$HIPDV.:E05TSI    .

PL6.E3A0      #002=KZH$HIPINIT File=KZH$HIPDV.:E05TSI                            WED 07/30/97 02:55 Page:303  

 Object Unit name= KZH$HIPINIT                                File name= KZH$HIPDV.:E05TOU
 UTS= JUL 30 '97 02:55:22.36 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none    33     21  KZH$HIPINIT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  KZH$HIPINIT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KZ_HIP_HDR                            KZT_ORDERS@                           KZT_GO@
     KZT_CNCDSC@                      r    G$ROS$
PL6.E3A0      #002=KZH$HIPINIT File=KZH$HIPDV.:E05TSI                            WED 07/30/97 02:55 Page:304  


     1811        1        /*T***********************************************************/
     1812        2        /*T*                                                         */
     1813        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1814        4        /*T*                                                         */
     1815        5        /*T***********************************************************/
     1816        6        %EJECT;
PL6.E3A0      #002=KZH$HIPINIT File=KZH$HIPDV.:E05TSI                            WED 07/30/97 02:55 Page:305  
     1817        7
     1818        8        KZH$HIPINIT: PROC(HDR_INIT);

      8   0 000000  D380 0000 0000  xent KZH$HIPINIT     LNJ,B5   X6A_AUTO_1
          0 000003       0008 0001                       DC       8,1

     1819        9
     1820       10        %INCLUDE KZ$LINCTX;
     1821      630        %INCLUDE KL_SUPER_C;
     1822     3532
     1823     3533        %KZ$INIT(FPTN=HDR_INIT, STCLASS="  ");
     1824     3555
     1825     3556    1   DCL KZ_HDR$(0:13) PTR BASED;
     1826     3557    1   DCL KZ_HIP_HDR UBIN SYMREF;
     1827     3558    1   DCL KZT_ORDERS@ EPTR SYMREF;
     1828     3559    1   DCL KZT_GO@ EPTR SYMREF;
     1829     3560    1   DCL KZT_CNCDSC@ EPTR SYMREF;
     1830     3561    1   DCL P$ PTR;
     1831     3562
     1832     3563
     1833     3564    1           P$=HDR_INIT.HDR$;

   3564   0 000005  ECC7 0004                            LDB,B6   @HDR_INIT,AUTO
          0 000007  DC86                                 LDB,B5   ,B6
          0 000008  DFC7 0006                            STB,B5   P$,AUTO

     1834     3565    1           P$->KZ_HDR$(%KLPT_HIP#*2)=ADDR(KZ_HIP_HDR);

   3565   0 00000A  CB80 0000 0000  xsym                 LAB,B4   KZ_HIP_HDR
          0 00000D  CFC5 0018                            STB,B4   24,B5

     1835     3566    1           KZT_ORDERS@=HDR_INIT.ORDERS;

   3566   0 00000F  BCC6 0006                            LDB,B3   6,B6
          0 000011  BF80 0000 0000  xsym                 STB,B3   KZT_ORDERS@

     1836     3567    1           KZT_CNCDSC@=HDR_INIT.CNCDSC;
PL6.E3A0      #002=KZH$HIPINIT File=KZH$HIPDV.:E05TSI                            WED 07/30/97 02:55 Page:306  

   3567   0 000014  ACC6 0004                            LDB,B2   4,B6
          0 000016  AF80 0000 0000  xsym                 STB,B2   KZT_CNCDSC@

     1837     3568    1           KZT_GO@=HDR_INIT.GO;

   3568   0 000019  9CC6 000A                            LDB,B1   10,B6
          0 00001B  9F80 0000 0000  xsym                 STB,B1   KZT_GO@

     1838     3569
     1839     3570    1           RETURN;

   3570   0 00001E  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     1840     3571
     1841     3572    1   END;

PL6.E3A0      #002=KZH$HIPINIT File=KZH$HIPDV.:E05TSI                            WED 07/30/97 02:55 Page:307  
--  Include file information  --

   KL_SUPER_C.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
      No diagnostics issued in procedure KZH$HIPINIT.
PL6.E3A0      #002=KZH$HIPINIT File=KZH$HIPDV.:E05TSI                            WED 07/30/97 02:55 Page:308  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @HDR_INIT                 *0-0-0/w STRC(192)   r     1 HDR_INIT
     6-0-0/w PTR         r     1 P$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w EPTR        r     1 KZT_CNCDSC@                0-0-0/w EPTR        r     1 KZT_GO@
     0-0-0/w EPTR        r     1 KZT_ORDERS@                0-0-0/w UBIN(16)    r     1 KZ_HIP_HDR

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KZ_HDR$(0:13)


   Procedure KZH$HIPINIT requires 33 words for executable code.
   Procedure KZH$HIPINIT requires 8 words of local(AUTO) storage.

    No errors detected in file KZH$HIPDV.:E05TSI    .
PL6.E3A0      #002=KZH$HIPINIT File=KZH$HIPDV.:E05TSI                            WED 07/30/97 02:55 Page:309  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KZH$HIPINIT File=KZH$HIPDV.:E05TSI                            WED 07/30/97 02:55 Page:310  
          MINI XREF LISTING

HDR_INIT
      3547**DCL         8--PROC
HDR_INIT.CNCDSC
      3550**DCL      3567>>ASSIGN
HDR_INIT.GO
      3553**DCL      3568>>ASSIGN
HDR_INIT.HDR$
      3548**DCL      3564>>ASSIGN
HDR_INIT.ORDERS
      3551**DCL      3566>>ASSIGN
KZT_CNCDSC@
      3560**DCL      3567<<ASSIGN
KZT_GO@
      3559**DCL      3568<<ASSIGN
KZT_ORDERS@
      3558**DCL      3566<<ASSIGN
KZ_HDR$
      3556**DCL      3565<<ASSIGN
KZ_HIP_HDR
      3557**DCL      3565--ASSIGN
P$
      3561**DCL      3564<<ASSIGN   3565>>ASSIGN
