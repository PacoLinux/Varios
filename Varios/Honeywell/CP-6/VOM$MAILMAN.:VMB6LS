VERSION B06

PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:1    
        1        1        /*M* VOM$MAILMAN  MAILMANs main procedure section */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
        8        8        /*P*      NAME: VOM$MAILMAN
        9        9                  DESCRIPTION: Performs executive mailing functions for
       10       10                       the CP-6 electronic mail system.  These functions
       11       11                       include:
       12       12                       a) recognition of, and distribution of mail to
       13       13                       remotely connected MAILMEN.
       14       14                       b) local distribution of mail based on the address
       15       15                       list contained in the document.
       16       16                       c) deferred distribution of mail based on originator-
       17       17                       specified distribution time.
       18       18                       d) MAIL system recovery, should an automatic software
       19       19                       recovery occur.
       20       20                       e) distribution and delivery of replies for "return
       21       21                       receipt requested" mail.
       22       22                       f) journalling transactions for audit-trail purposes.
       23       23                       g) automatic forwarding of mail received from one
       24       24                       remote MAILMAN to another remote MAILMAN.
       25       25                       h) local distribution of mail received from remote
       26       26                       MAILMEN.
       27       27                                                                          */
       28       28
       29       29
       30       30        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:2    
       31       31
       32       32
       33       33        VOM$MAILMAN: PROC MAIN;
       34       34        /***** Include files *****/
       35       35          %INCLUDE CP_6_SUBS;
       36      575
       37      576
       38      577          %INCLUDE B_SEGIDS_C;
       39     1116          %INCLUDE VOM_DATA_R;                  /* Also includes CP_6 */
       40     8336          %INCLUDE VM_DATA_R;                   /* Also includes B_MACROS_C */
       41     8767          %INCLUDE VO_SUBS_C;
       42     8818          %INCLUDE B_ERRORS_C;
       43     9945          %F$DCB;
       44    10002          %INCLUDE VM_PERR_C;
       45    10297          %INCLUDE B$JIT;
       46    10900          %INCLUDE XUD_UTS_M;
       47    10982
       48    10983        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:3    
       49    10984        /***** Local data *****/
       50    10985    1   DCL I SBIN STATIC;
       51    10986    1   DCL J SBIN STATIC;
       52    10987    1   DCL K SBIN STATIC;
       53    10988    1   DCL CURRENT_TIME UBIN WORD STATIC;
       54    10989    1   DCL EPASS CHAR(12) STATIC;
       55    10990    1   DCL BIT9(0:11) REDEF EPASS UBIN BYTE UNAL;
       56    10991    1   DCL PASSWORD CHAR(8) STATIC;
       57    10992    1   DCL BIT6(0:11) REDEF PASSWORD UBIN(6) UNAL;
       58    10993
       59    10994        /* The next area is the internal TIME_TABLE for mailman */
       60    10995    1   DCL LAST$ PTR STATIC;
       61    10996    1   DCL FREE$ PTR STATIC SYMDEF INIT (ADDR(NIL));/* Head of free entries */
       62    10997    1   DCL MAX$ PTR STATIC SYMDEF ALIGNED;
       63    10998    1   DCL SEG$ PTR STATIC SYMDEF ALIGNED;
       64    10999
       65    11000    1   DCL TYPE SBIN WORD ALIGNED;
       66    11001    1   DCL KEY_VALUE CHAR(8) CALIGNED;
       67    11002    1   DCL SITENAME CHAR(8) CALIGNED;
       68    11003    1   DCL VOM$DOSEND ENTRY(1);
       69    11004
       70    11005    1   DCL X66_REL_AUTO ENTRY;
       71    11006    1   DCL VMA$ENLARGE_SEGMENT ENTRY(2) ALTRET;
       72    11007    1   DCL VMA$SHRINK_SEGMENT ENTRY(2) ALTRET;
       73    11008    1   DCL VMA$OPEN_ENCL_SEGS ENTRY ALTRET;
       74    11009    1   DCL VMD$GET_HEADER    ENTRY(2) ALTRET;
       75    11010    1   DCL VMD$GET_PROFILE   ENTRY(1) ALTRET;
       76    11011    1   DCL VMA$GET_SITE_NAME ENTRY(4) ALTRET;
       77    11012    1   DCL VMD$PUT_PROFILE   ENTRY(1) ALTRET;
       78    11013    1   DCL VOM$PROCESS ENTRY;
       79    11014    1   DCL ASZ$SCRAMBLE ENTRY(1);
       80    11015
       81    11016             %B$TCB (STCLASS="BASED(B$TCB$)");
       82    11019
       83    11020             %B$ALT;
       84    11028
       85    11029             %EQU_CG;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:4    
       86    11077
       87    11078             %B$CGAURD;
       88    11097              %VM_HEADER;
       89    11226
       90    11227
       91    11228             %VM_PROFILE;
       92    11315
       93    11316             %VM_KEYTYPES;
       94    11337
       95    11338             %VM_BODYKEY;
       96    11358
       97    11359             %VM_ADDTYPES;
       98    11363
       99    11364        %XUD$UTS_ENTRIES;
      100    11396
      101    11397
      102    11398        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:5    
      103    11399                                                /*
      104    11400                                                     Externals
      105    11401                                                                               */
      106    11402
      107    11403    1   DCL MAIL_IN DCB;
      108    11404    1   DCL SITE_IN DCB;
      109    11405
      110    11406    1   DCL MAP_FILE DCB;
      111    11407    1   DCL M$LM DCB;
      112    11408
      113    11409    1   DCL SAVE$ PTR ALIGNED;
      114    11410
      115    11411    1   DCL 1 B_VERSION SYMREF READONLY,
      116    11412    1         2 L UBIN BYTE CALIGNED,
      117    11413    1         2 C CHAR (B_VERSION.L);
      118    11414
      119    11415    1   DCL VOM$XCON ENTRY ASYNC;
      120    11416    1   DCL VOM$EVENT ENTRY ASYNC;
      121    11417    1   DCL VOM$ADDENTRY ENTRY(4);
      122    11418    1   DCL VOM$ADDENTRY_SORTED ENTRY(4);
      123    11419    1   DCL VOM$DELENTRY ENTRY(3);
      124    11420
      125    11421    1   dcl VOM_INIT_CCTIME    char(10) static symdef init(' ');
      126    11422        /*   VOM_INIT_CCTIME is used by the XCON routine VOM$XCON
      127    11423             to determine if there have been two XCON entries within
      128    11424             the last minute.  If there have been, it will not try to
      129    11425             M$LDTRC to itself.   This value is set at initialization
      130    11426             to be the contents of the first ten words of B$JIT.CCBUF.
      131    11427             When MAILMAN.:SYS issues a M$LDTRC to itself, it stuffs
      132    11428             the current date and time into B$JIT.CCBUF.                 */
      133    11429
      134    11430
      135    11431        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:6    
      136    11432        /*  Special symdefs.  These are here rather than VOM_DATA_D/R because
      137    11433            VMM$MESSAGE is in both mail and mailman.  The division between
      138    11434            things in VOM_DATA_D and VM_DATA_D was not done quite right, and
      139    11435            to make a long story short, these things have to be here.
      140    11436        */
      141    11437        %FPT_READ (FPTN=VO_READ_CG, STCLASS="CONSTANT SYMDEF",
      142    11438                  DCB=M$MAIL_COMGROUP,
      143    11439                  BUF=VM_CGBUFFER,
      144    11440                  EVENT = %VOM_READMAIL#,
      145    11441                  WAIT=NO);
      146    11480    1   DCL VO_NEED_READ BIT(1) STATIC SYMDEF INIT ('0'B);
      147    11481    1   DCL VO_PROCESS BIT(1) STATIC SYMDEF INIT('0'B);
      148    11482                                                /*
      149    11483                                                     Fpts
      150    11484                                                                               */
      151    11485
      152    11486                                                /* Buffer gets initialized
      153    11487                                                     to vector(dynamic seg) */
      154    11488
      155    11489             %FPT_XCON      (FPTN=SET_XCON,
      156    11490                                 UENTRY=VOM$XCON);
      157    11504
      158    11505             %FPT_WAIT      (FPTN=WAIT_IT_OUT,
      159    11506                                 UNITS=8464000);
      160    11520
      161    11521                                                /* One whole day */
      162    11522
      163    11523             %FPT_GDS (FPTN=GET_TIME_ENTRY,     /* Get a entry for time */
      164    11524                       SEGSIZE = "SIZEW(TIME_TABLE)",
      165    11525                       RESULTS = TIME_VECTOR,
      166    11526                       FREE = NO);
      167    11542
      168    11543             %VLP_VECTOR (FPTN = TIME_VECTOR);
      169    11558
      170    11559             %FPT_OPEN (FPTN=OPEN_NEXT,
      171    11560                            DCB = MAIL_IN,
      172    11561                       FUN=UPDATE,
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:7    
      173    11562                            NXTF=YES);
      174    11671
      175    11672             %FPT_OPEN (FPTN=OPEN_FIRST,
      176    11673                            DCB=MAIL_IN,
      177    11674                            NAME=FIRST_NAME,
      178    11675                            ACCT=VM_MAIL_ACCT,
      179    11676                            ASN=FILE,
      180    11677                            SETDCB=YES);
      181    11786
      182    11787             %VLP_NAME (FPTN=FIRST_NAME,
      183    11788                            NAME=':MESS');
      184    11815
      185    11816
      186    11817             %FPT_CLOSE  (FPTN=CLOSE_MAILIN_SAVE,
      187    11818                            STCLASS="STATIC SYMDEF",
      188    11819                            DCB=MAIL_IN,
      189    11820                            DISP=SAVE);
      190    11862
      191    11863             %FPT_CLOSE (FPTN=CLOSE_MAILIN_SCRATCH,
      192    11864                            STCLASS="STATIC SYMDEF",
      193    11865                            DCB=MAIL_IN,
      194    11866                            DISP=RELEASE);
      195    11908
      196    11909             %VLP_ERRCODE (FPTN=MYERROR,
      197    11910                            FCG = "'2617'O",
      198    11911                            MID ="'15'O");
      199    11956
      200    11957              %VLP_ERRCODE (FPTN=ERROR);
      201    12002
      202    12003              %FPT_TIME (FPTN=GET_CURRENT,
      203    12004              SOURCE=CLOCK,
      204    12005              DEST=UTS,
      205    12006              TSTAMP=CURRENT_TIME);
      206    12025        %FPT_WRITE(FPTN=WRITE_MAILCG,DCB=M$MAIL_COMGROUP,STCLASS="STATIC SYMDEF",
      207    12026                   STATION=OUTSTATION,
      208    12027                   BUF=VM_CGBUFFER);
      209    12058
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:8    
      210    12059             %FPT_OPEN (FPTN=OPEN_MAIL,
      211    12060                            STCLASS = "STATIC SYMDEF",
      212    12061                            DCB=MAIL_IN,
      213    12062                            ACCT=VM_MAIL_ACCT,
      214    12063                            NAME=MAIL_NAME,
      215    12064                            ACS=DIRECT,
      216    12065                            ORG=KEYED,
      217    12066                            FUN=UPDATE,
      218    12067                            ASN=FILE);
      219    12176
      220    12177             %VLP_NAME (FPTN=MAIL_NAME,STCLASS="STATIC SYMDEF",LEN=31,
      221    12178                        NAME='                        ');
      222    12205
      223    12206             %FPT_EVENT (UENTRY=VOM$EVENT);
      224    12220
      225    12221             %FPT_CLOSE (FPTN=CLOSE_RENAME,
      226    12222                            DCB=MAIL_IN,
      227    12223                            NAME=RENAME_NAME,
      228    12224                            CHGATT=YES);
      229    12266
      230    12267             %VLP_NAME  (FPTN=RENAME_NAME);
      231    12294
      232    12295             %VLP_NAME  (FPTN=FIRST_INTERSYS_FILE,
      233    12296                            NAME=':MOVE');
      234    12323        %VLP_STATION (FPTN=OUTSTATION, STCLASS="STATIC SYMDEF",
      235    12324                      ANYDCB=NO);
      236    12351
      237    12352              %FPT_CLOSE (FPTN=CLOSE_COMGROUP,
      238    12353              DCB=M$MAIL_COMGROUP);
      239    12395
      240    12396
      241    12397        %FPT_PRIV (FPTN=SET_FMSEC,PRIV=%PR_FMSEC#);
      242    12412        %FPT_TRUNC (FPTN=TRUNC_BUFF);
      243    12426
      244    12427    1   DCL TESTMODE BIT(1) STATIC INIT('0'B);
      245    12428
      246    12429        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:9    
      247    12430
      248    12431        /*
      249    12432             ***** Only run in ghost mode ...
      250    12433        */
      251    12434    1       If B$JIT.MODE ~= %M_GHOST# and not TESTMODE
      252    12435    1       then
      253    12436    1           call M$XXX;
      254    12437        /*
      255    12438             ***** Go!!!
      256    12439        */
      257    12440
      258    12441    1       VOM_INIT_CCTIME = substr(B$JIT.CCBUF,,10);
      259    12442    1       CALL M$SPRIV (SET_FMSEC);
      260    12443    1       IF B$JIT.MODE = %M_GHOST# AND B$JIT.PRIV.ACTIVE.JIT
      261    12444    1       THEN
      262    12445    1           B$JIT.OUTPRIO = 7;     /* Set symbiont priority */
      263    12446    1       IF B$JIT.PRIV.ACTIVE.JIT
      264    12447    2       THEN DO;
      265    12448    2           CALL CONCAT (B$JIT.CCBUF, 'MAILMAN ',B_VERSION.C, ' initializing');
      266    12449    2           CALL INDEX (I, '   ', B$JIT.CCBUF);
      267    12450    2           B$JIT.CCARS = I;
      268    12451    2           B$JIT.JOBNAME = ' ';
      269    12452    2       END;
      270    12453    1       CALL VOM$_SETXCON;
      271    12454        /* Scramble and encode the mail move account password */
      272    12455    1       PASSWORD = VO_INTERSYS_PASSWORD;
      273    12456    1       CALL ASZ$SCRAMBLE (PASSWORD);
      274    12457    2       DO I = 0 TO 11;
      275    12458    2           BIT9(I)=BIT6(I)+ASCBIN(' ');
      276    12459    2       END;
      277    12460    1       VO_INTERSYS_EPASS = EPASS;
      278    12461
      279    12462    1       CALL VOM$_GETBUFS;
      280    12463
      281    12464    1       CALL VOM$RECOVER;
      282    12465
      283    12466    1       CALL M$EVENT(FPT_EVENT) ALTRET(WELL_WHAT_NOW);
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:10   
      284    12467    1       CALL VOM$_OPENS;                  /* Go open mail cg */
      285    12468
      286    12469    1       CALL M$TIME (GET_CURRENT);
      287    12470
      288    12471    1       VO_MAILMAN_STARTUP_TIME = CURRENT_TIME;
      289    12472
      290    12473    1       CALL M$READ(VO_READ_CG) ALTRET (WELL_WHAT_NOW);
      291    12474
      292    12475    2       DO WHILE ('1'B); /* FOREVER */;
      293    12476
      294    12477    2           CALL M$TIME (GET_CURRENT);  /* Get current time */
      295    12478
      296    12479    2           IF TIME_HEAD$ ~= ADDR(NIL)
      297    12480    2           THEN
      298    12481    3           DO;
      299    12482    3               CALL XUD$UTS_DIFF_SEC(I,TIME_HEAD$->TIME_TABLE.TSTAMP,CURRENT_TIME);
      300    12483    3               I = MINIMUM(I, 30);
      301    12484    3           END;
      302    12485    2           ELSE
      303    12486    2               I = 30;
      304    12487
      305    12488    2           IF I <= 0
      306    12489    3           THEN DO;
      307    12490
      308    12491    3               CALL VOM$DOSEND(TIME_HEAD$); /* Go send current */
      309    12492
      310    12493    3           END;
      311    12494
      312    12495    3           ELSE DO;
      313    12496
      314    12497    3               IF VO_NEED_READ OR VO_PROCESS
      315    12498    3               THEN
      316    12499    3                   EXIT;
      317    12500
      318    12501    3               CALL X66_REL_AUTO;      /* Release excess memory */
      319    12502    3               CALL VOM$SHRINK_SEGMENT(VM_ADDLIST_);
      320    12503    3               CALL VOM$SHRINK_SEGMENT(VM_ADDREC_);
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:11   
      321    12504    3               CALL VOM$SHRINK_SEGMENT(VM_HEADER_);
      322    12505    3               CALL VOM$SHRINK_SEGMENT(VM_PROFILE_);
      323    12506    3               CALL VOM$SHRINK_SEGMENT(VM_WORK_);
      324    12507    3               CALL VOM$SHRINK_SEGMENT(VM_COPY_);
      325    12508
      326    12509    3               TRUNC_BUFF.V.DCB# = M$MAIL_GLOBAL_NUM; /* Rel. FPOOLs */
      327    12510    3               CALL M$TRUNC(TRUNC_BUFF);
      328    12511    3               TRUNC_BUFF.V.DCB# = M$NODE_NUM;
      329    12512    3               CALL M$TRUNC(TRUNC_BUFF);
      330    12513    3               TRUNC_BUFF.V.DCB# = DCBNUM(M$LM);
      331    12514    3               CALL M$TRUNC(TRUNC_BUFF);
      332    12515    3               WAIT_IT_OUT.V.UNITS# = I;
      333    12516    4               DO INHIBIT;
      334    12517    4                   IF (NOT VO_NEED_READ) AND (NOT VO_PROCESS)
      335    12518    5                   THEN DO;
      336    12519    5                       IF B$JIT.PRIV.ACTIVE.JIT
      337    12520    6                       THEN DO;
      338    12521    6                           CALL CONCAT (B$JIT.CCBUF, 'MAILMAN ',B_VERSION.C, ' idle');
      339    12522    6                           CALL INDEX (I, '   ', B$JIT.CCBUF);
      340    12523    6                           B$JIT.CCARS = I;
      341    12524    6                           B$JIT.JOBNAME = ' ';
      342    12525    6                       END;
      343    12526    5                       CALL M$WAIT(WAIT_IT_OUT);
      344    12527    5                   END;
      345    12528    4               END;
      346    12529    3           END;
      347    12530
      348    12531    3           IF VO_NEED_READ THEN DO;
      349    12532    3               VO_NEED_READ = '0'B;
      350    12533    3               CALL M$READ (VO_READ_CG);
      351    12534    3           END;
      352    12535
      353    12536    2           IF VO_PROCESS THEN CALL VOM$PROCESS;
      354    12537
      355    12538    2           IF VO_INTERSYS_ALLOWED
      356    12539    2           THEN
      357    12540    2               CALL VOM$INTERSYS_RECEIVED;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:12   
      358    12541    2       END;                            /* End forever */
      359    12542    1   WELL_WHAT_NOW: ;
      360    12543    1       CALL M$XXX;
      361    12544
      362    12545        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:13   
      363    12546
      364    12547    1   VOM$_SETXCON: PROC;
      365    12548
      366    12549    2       CALL M$XCON (SET_XCON) ALTRET(XCON0_ALT);
      367    12550    2   XCON0_ALT: ;
      368    12551
      369    12552    2       RETURN;
      370    12553    2   END VOM$_SETXCON;
      371    12554
      372    12555        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:14   
      373    12556
      374    12557    1   VOM$_OPENS: PROC;
      375    12558
      376    12559
      377    12560          %FPT_OPEN      (FPTN=OPEN_COMGROUP,
      378    12561                              DCB=M$MAIL_COMGROUP,
      379    12562                              ASN=COMGROUP,
      380    12563                              SETSTA=MAILMAN_STATION,
      381    12564                              FUN=CREATE,
      382    12565                              EXIST=NEWFILE,
      383    12566                              CTG=YES,
      384    12567                              SHARE=ALL,
      385    12568                              AU=YES,
      386    12569                              IXTNSIZE=30,
      387    12570                              ACCESS=MAILCG_ACCESS,
      388    12571                              ACSVEH=MAILCG_ACSVEH,
      389    12572                              ACCT=VM_MAIL_ACCT,
      390    12573                              NAME=VM_MAILCG_NAME);
      391    12682
      392    12683               %VLP_ATTR (FPTN=MAILCG_ACCESS);
      393    12697               %VLP_ACCESS (NOLIST=YES,EXEC=YES,LAST=";");
      394    12714
      395    12715              %VLP_ATTR (FPTN=MAILCG_ACSVEH);
      396    12729               %VLP_ACSVEH (READ=YES,UPD=YES,WNEW=YES,DELR=YES,VEHICLE='SEND');
      397    12746              %VLP_ACSVEH (READ=YES,UPD=YES,WNEW=YES,DELR=YES,VEHICLE='SEND_TEST');
      398    12763              %VLP_ACSVEH (READ=YES,UPD=YES,WNEW=YES,DELR=YES,VEHICLE='MAIL');
      399    12780              %VLP_ACSVEH (READ=YES,UPD=YES,WNEW=YES,DELR=YES,VEHICLE='MAIL_TEST');
      400    12797              %VLP_ACSVEH (READ=YES,UPD=YES,WNEW=YES,DELR=YES,VEHICLE='MAIL_TEST');
      401    12814              %VLP_ACSVEH (READ=YES,UPD=YES,WNEW=YES,DELR=YES,VEHICLE='MAILMAN',LAST=";");
      402    12831              %VLP_SETSTA (FPTN=MAILMAN_STATION,
      403    12832              STCLASS=CONSTANT,
      404    12833              MYSTATION='MAILMAN');
      405    12861
      406    12862              %FPT_CGCTL    (FPTN=MAIL_CGCTL,
      407    12863              DCB=M$MAIL_COMGROUP,
      408    12864              CGCP=MAILCG_CGCP,
      409    12865              STCLASS=CONSTANT);
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:15   
      410    12888
      411    12889
      412    12890             %VLP_CGCP      (FPTN=MAILCG_CGCP,
      413    12891                                 MINPG=3,
      414    12892                                 TERMCONAU=NO,
      415    12893                                 TERMCONNAU=NO,
      416    12894                                 AUCONTERM=DISCONNECT, /* was activate */
      417    12895                                 AUDCONTERM=DISCONNECT, /* was activate */
      418    12896                                 WAS=YES,
      419    12897                                 RAS=YES,
      420    12898                                 CONMSG=NO,
      421    12899                                 AUCONDCB=DEACTIVATE, /* was nc */
      422    12900                                 AUDCONDCB=DEACTIVATE,
      423    12901                                 SMD=NO,
      424    12902                                 MAXMC=400,
      425    12903                                 DCBCONNAU=NO,
      426    12904                                 DCBCONLGL=YES,
      427    12905                                 TERMCONLGL=NO,
      428    12906                                 SECURE=NO,
      429    12907                                 XSTALGL=YES,
      430    12908                                 XTYPLGL=YES);
      431    12951
      432    12952    2       CALL M$OPEN (OPEN_COMGROUP) ALTRET (CANT_OPEN_MAILCG);
      433    12953    2       CALL M$CGCTL (MAIL_CGCTL) ALTRET(CANT_OPEN_MAILCG);
      434    12954        /*
      435    12955             ***** If unable to find the definition for this site,
      436    12956                   then turn intersystem mail off ...
      437    12957        */
      438    12958    2       KEY_VALUE = '*IAM';
      439    12959    2       CALL VMA$GET_SITE_NAME(KEY_VALUE,VM_SITENAME)
      440    12960    2       WHENALTRETURN
      441    12961    3       DO;
      442    12962    3           VO_INTERSYS_ALLOWED = %NO#;
      443    12963    3       END;
      444    12964
      445    12965    2       RETURN;
      446    12966
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:16   
      447    12967    2   CANT_OPEN_MAILCG:;
      448    12968
      449    12969    2       CALL M$XXX;
      450    12970
      451    12971    2   END VOM$_OPENS;
      452    12972
      453    12973        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:17   
      454    12974    1   VOM$_GETBUFS: PROC;
      455    12975        /*
      456    12976             ***** How data segments are used in mail/send/mailman ...
      457    12977
      458    12978                   Segments used in all modules
      459    12979                   ----------------------------
      460    12980                   VM_ADDLIST
      461    12981                      - used for building new address list (VMA$EXPAND_LIST).
      462    12982
      463    12983                   VM_HEADER
      464    12984                      - used to contain the header of a message.
      465    12985
      466    12986                   VM_PROFILE
      467    12987                      - used to contain the profile of a folder.
      468    12988
      469    12989                   VM_WORK
      470    12990                      - used to contain list and user definitions when
      471    12991                        expanding an address list.
      472    12992
      473    12993                   Segments used by only mail and send
      474    12994                   -----------------------------------
      475    12995                   VM_PARSEAREA
      476    12996                      - used to contain input and parse info (XUR$GETCMD)
      477    12997
      478    12998                   segments used only by mail
      479    12999                   --------------------------
      480    13000                   VM_SELECT
      481    13001                      - used to contain message selection contexts
      482    13002
      483    13003                   segments used only by mailman
      484    13004                   -----------------------------
      485    13005                   VM_ADDREC
      486    13006                      - used to contain address record to be expanded.
      487    13007
      488    13008                   VM_INPUT
      489    13009                      - used to contain input queue.
      490    13010
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:18   
      491    13011                   VM_COPY (redef of VM_SELECT)
      492    13012                      - used to move copies of files around.
      493    13013        */
      494    13014    2       CALL VMA$ENLARGE_SEGMENT(VM_ADDLIST_,1024) ALTRET(E_ENLARGE);
      495    13015    2       CALL VMA$ENLARGE_SEGMENT(VM_ADDREC_,1024) ALTRET(E_ENLARGE);
      496    13016    2       CALL VMA$ENLARGE_SEGMENT(VM_HEADER_,1024) ALTRET(E_ENLARGE);
      497    13017    2       CALL VMA$ENLARGE_SEGMENT(VM_PROFILE_,1024) ALTRET(E_ENLARGE);
      498    13018    2       CALL VMA$ENLARGE_SEGMENT(VM_WORK_,1024) ALTRET(E_ENLARGE);
      499    13019    2       CALL VMA$ENLARGE_SEGMENT(VM_INPUT_,1024) ALTRET(E_ENLARGE);
      500    13020
      501    13021    2       CALL VMA$ENLARGE_SEGMENT(VM_COPY_,1024) ALTRET(E_ENLARGE);
      502    13022
      503    13023    2       CALL VMA$OPEN_ENCL_SEGS ALTRET (E_ENLARGE);
      504    13024
      505    13025
      506    13026    2       TIME_HEAD$ = ADDR(NIL);
      507    13027    2       FREE$ = ADDR(NIL);
      508    13028    2       INTERSYS$ = ADDR(NIL);
      509    13029    2       INTERSYS_HEAD$ = ADDR(NIL);
      510    13030    2       MAX$ = PINCRW(VM_INPUT$, 1024);
      511    13031    2       SEG$ = VM_INPUT$;
      512    13032    2       SEG$->TIME_TABLE.NEXT$ = ADDR(NIL);
      513    13033
      514    13034    2       RETURN;
      515    13035        /**/
      516    13036    2   E_ENLARGE:
      517    13037    2       CALL M$XXX;
      518    13038
      519    13039    2   END VOM$_GETBUFS;
      520    13040        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:19   
      521    13041    1   VOM$RECOVER: PROC;
      522    13042
      523    13043    2   DCL TIME_NEW$ PTR;
      524    13044
      525    13045    2       CALL M$OPEN (OPEN_FIRST) ALTRET (BAD_OPEN); /* Merge file name */
      526    13046
      527    13047    3       DO WHILE ('1'B); /* FOREVER */;                     /* Do until no more files */
      528    13048
      529    13049    3           CALL M$OPEN (OPEN_NEXT) ALTRET(BAD_OPEN);
      530    13050
      531    13051    3           IF SUBSTR(DCBADDR(DCBNUM(MAIL_IN)) -> F$DCB.NAME#.C,0,5)
      532    13052    3             ~= ':MESS'
      533    13053    3           THEN
      534    13054    4           DO;
      535    13055    4               CALL M$CLOSE (CLOSE_MAILIN_SAVE) ALTRET (BAD_OPEN);
      536    13056    4               RETURN;
      537    13057    4           END;
      538    13058
      539    13059    3           CALL VMD$GET_HEADER (0, DCBNUM(MAIL_IN)) ALTRET (BAD_OPEN);
      540    13060        /*
      541    13061             ***** If no delivery time was specified,
      542    13062                   then deliver as soon as possible.
      543    13063                   Therefore, this entry must be added
      544    13064                   to the time queue with the current time ...
      545    13065        */
      546    13066    3           IF VM_HEADER.DELIVERY_DATE = 0
      547    13067    3           THEN
      548    13068    4           DO;
      549    13069    4               CALL M$TIME (GET_CURRENT);
      550    13070    4               VM_HEADER.DELIVERY_DATE = CURRENT_TIME;
      551    13071    4           END;
      552    13072    3           CALL VOM$ADDENTRY_SORTED(TIME$, %NO#, TIME_HEAD$, DCBNUM(MAIL_IN));
      553    13073    3           CALL M$CLOSE (CLOSE_MAILIN_SAVE) ALTRET(BAD_OPEN);
      554    13074    3   CONTINUE: ;
      555    13075    3       END;                            /* End do forever */
      556    13076
      557    13077    2   BAD_OPEN:;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:20   
      558    13078
      559    13079    2       ERROR = B$TCB.ALT$ -> B$ALT.ERR;
      560    13080
      561    13081    2       IF ERROR.ERR# = %E$FDEOF          /* End of file directory */
      562    13082    2       THEN
      563    13083    2           RETURN;
      564    13084
      565    13085    2       CALL M$CLOSE (CLOSE_MAILIN_SCRATCH);
      566    13086    2       GOTO CONTINUE;
      567    13087
      568    13088
      569    13089    2   END VOM$RECOVER;
      570    13090        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:21   
      571    13091
      572    13092    1   VOM$INTERSYS_RECEIVED: PROC;
      573    13093
      574    13094    2       OPEN_FIRST.NAME_ = VECTOR(FIRST_INTERSYS_FILE);
      575    13095                       /* After VOM$RECOVERY is done, OPEN_NEXT is only used below */
      576    13096    2       OPEN_NEXT.V.OPER.TEST#=%YES#;
      577    13097
      578    13098    2       CALL M$OPEN (OPEN_FIRST) ALTRET(BAD_OPEN); /* Start at :MOVE */
      579    13099
      580    13100    3       DO WHILE ('1'B); /* FOREVER */;                     /* Do until no more files */
      581    13101
      582    13102    3           CALL M$OPEN (OPEN_NEXT) ALTRET(BAD_OPEN);
      583    13103
      584    13104    3           IF SUBSTR(DCBADDR(DCBNUM(MAIL_IN))->F$DCB.NAME#.C,0,5) ~= ':MOVE'
      585    13105    3           THEN RETURN;
      586    13106
      587    13107    3           RENAME_NAME = DCBADDR(DCBNUM(MAIL_IN))->F$DCB.NAME#;
      588    13108    3           MAIL_NAME = RENAME_NAME;
      589    13109    3           CALL M$OPEN (OPEN_MAIL) ALTRET(BAD_OPEN);
      590    13110    3           CALL INSERT(RENAME_NAME.NAME#,0,SIZEC(':MESS'),':MESS');
      591    13111    3           CALL M$CLOSE (CLOSE_RENAME) ALTRET(BAD_OPEN);
      592    13112
      593    13113    3           MAIL_NAME = RENAME_NAME;
      594    13114    3           CALL M$OPEN (OPEN_MAIL) ALTRET(BAD_OPEN);
      595    13115    3           CALL VMD$GET_HEADER (0, DCBNUM(MAIL_IN)) ALTRET(BAD_OPEN);
      596    13116        /*
      597    13117             ***** If no delivery time was specified,
      598    13118                   then deliver as soon as possible.
      599    13119                   Therefore, this entry must be added
      600    13120                   to the time queue with the current time ...
      601    13121        */
      602    13122    3           IF VM_HEADER.DELIVERY_DATE = 0
      603    13123    3           THEN
      604    13124    4           DO;
      605    13125    4               CALL M$TIME (GET_CURRENT);
      606    13126    4               VM_HEADER.DELIVERY_DATE = CURRENT_TIME;
      607    13127    4           END;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:22   
      608    13128    3           CALL VOM$ADDENTRY_SORTED(TIME$, %NO#, TIME_HEAD$, DCBNUM(MAIL_IN));
      609    13129    3           CALL M$CLOSE (CLOSE_MAILIN_SAVE) ALTRET(WHO_CARES);
      610    13130    3   CONTINUE: ;
      611    13131    3       END;
      612    13132
      613    13133    2   BAD_OPEN: ;
      614    13134
      615    13135    2       ERROR = B$TCB.ALT$ ->B$ALT.ERR;
      616    13136
      617    13137    2       IF ERROR.ERR# = %E$FDEOF
      618    13138    2       THEN
      619    13139    2           RETURN;
      620    13140
      621    13141    2       CALL M$CLOSE (CLOSE_MAILIN_SAVE) ALTRET (WHO_CARES);
      622    13142    2   WHO_CARES: ;
      623    13143    2       GOTO CONTINUE;
      624    13144    2   END VOM$INTERSYS_RECEIVED;
      625    13145        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:23   
      626    13146    1   VOM$SHRINK_SEGMENT: PROC (VECT_);
      627    13147        /*
      628    13148          ***** Release excess segment space before we go to sleep
      629    13149        */
      630    13150    2   DCL VECT_ VECTOR PARAM;
      631    13151    2   DCL SIZE UBIN;
      632    13152
      633    13153    2       IF VBOUND (VECT_) > 4093
      634    13154    3       THEN DO;
      635    13155    3           SIZE = (VBOUND (VECT_) - 4093) / 4;
      636    13156    3           CALL VMA$SHRINK_SEGMENT (VECT_, SIZE);
      637    13157    3       END;
      638    13158
      639    13159    2       RETURN;
      640    13160
      641    13161    2   END VOM$SHRINK_SEGMENT;
      642    13162
      643    13163    1   END VOM$MAILMAN;
      644    13164        %EOD;

PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:24   
--  Include file information  --

   XUD_UTS_M.:LIB_E05  is referenced.
   B$JIT_C.:LIB_E05  is referenced.
   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
   VM_PERR_C.:VMB6TOU  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   VO_SUBS_C.:VMB6TOU  is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VOM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   B_SEGIDS_C.:LIB_E05  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
      No diagnostics issued in procedure VOM$MAILMAN.

   Procedure VOM$MAILMAN requires 542 words for executable code.
   Procedure VOM$MAILMAN requires 20 words of local(AUTO) storage.

PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:25   

 Object Unit name= VOM$MAILMAN                                File name= VOM$MAILMAN.:VMB6TOU
 UTS= AUG 20 '97 15:31:38.80 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$MAIL_FILE
    2   DCB   even  none     0      0  M$MAIL_CENTRAL
    3   DCB   even  none     0      0  M$MAIL_GLOBAL
    4   DCB   even  none     0      0  M$WORK
    5   DCB   even  none     0      0  M$MAIL_COMGROUP
    6   DCB   even  none     0      0  M$DO
    7   DCB   even  none     0      0  M$LO
    8   DCB   even  none     0      0  M$ME
    9   DCB   even  none     0      0  M$NODE
   10   DCB   even  none     0      0  M$SI
   11   Data  even  none   500    764  VOM$MAILMAN
   12   DCB   even  none     0      0  MAIL_IN
   13   DCB   even  none     0      0  SITE_IN
   14   DCB   even  none     0      0  MAP_FILE
   15   DCB   even  none     0      0  M$LM
   16  RoData even  UTS     92    134  VOM$MAILMAN
   17   Proc  even  none   542   1036  VOM$MAILMAN
   18  RoData even  none    41     51  VOM$MAILMAN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    17      0   yes            yes      Main       0  VOM$MAILMAN
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:26   

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
   11     12  FREE$                             11     13  MAX$
   11     14  SEG$                              11     17  VOM_INIT_CCTIME
   16      0  VO_READ_CG                        11     22  VO_NEED_READ
   11     23  VO_PROCESS                        11    236  CLOSE_MAILIN_SAVE
   11    274  CLOSE_MAILIN_SCRATCH              11    350  WRITE_MAILCG
   11    364  OPEN_MAIL                         11    456  MAIL_NAME
   11    542  OUTSTATION

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes          Async      0 VOM$XCON
         yes          Async      0 VOM$EVENT
 yes     yes           Std       3 XUD$UTS_DIFF_SEC
         yes           Std       0 VOM$PROCESS
         yes           Std       1 ASZ$SCRAMBLE
         yes           Std       0 X66_REL_AUTO
         yes           Std       1 VOM$DOSEND
 yes     yes           Std       4 VMA$GET_SITE_NAME
 yes     yes           Std       2 VMA$ENLARGE_SEGMENT
 yes     yes           Std       0 VMA$OPEN_ENCL_SEGS
 yes     yes           Std       2 VMD$GET_HEADER
         yes           Std       4 VOM$ADDENTRY_SORTED
 yes     yes           Std       2 VMA$SHRINK_SEGMENT
                       nStd      0 X66_MAUTO
                       nStd      0 X66_INDEX
                       nStd      0 X66_MARET
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:27   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  VM_CGBUFFER                           VO_BNWIO
     STATION#                              VO_INTERSYS_ALLOWED                   TIME_HEAD$
     TIME$                                 INTERSYS_HEAD$                        INTERSYS$
r    VO_BUSY_RETRY_MINUTES            r    VO_PACKSET_RETRY_MINUTES         r    VO_MAX_HOLD_HOURS
r    VO_HOG_LIMIT                          VO_MAILMAN_STARTUP_TIME               VO_INTERSYS_PASSWORD
     VO_INTERSYS_EPASS                     VO_INTERSYS_ACCT                      VO_INTERSYS_UNAME
     VO_RETRY_LIMIT_INTERSYSTEM       r    VM_HEADER$                       r    VM_PROFILE$
r    VM_ADDLIST$                      r    VM_ADDREC$                       r    VM_WORK$
r    VM_SELECT$                       r    VM_PARSEAREA$                    r    VM_INPUT$
r    VM_COPY$                              VM_ENCLLIST$                          VM_ENCLREC$
     VM_HEADER_                            VM_HEADER_INIT_                       VM_PROFILE_
     VM_ADDLIST_                           VM_ADDREC_                            VM_WORK_
     VM_SELECT_                            VM_PARSEAREA_                         VM_INPUT_
     VM_COPY_                              VM_ENCLLIST_                          VM_ENCLREC_
     M$MAIL_FILE                           M$MAIL_CENTRAL                        M$MAIL_GLOBAL
     M$WORK                                M$MAIL_COMGROUP                       M$DO
     M$LO                                  M$ME                                  M$NODE
     M$SI                                  M$MAIL_FILE_NUM                       M$MAIL_CENTRAL_NUM
     M$MAIL_GLOBAL_NUM                     M$WORK_NUM                            M$MAIL_COMGROUP_NUM
     M$DO_NUM                              M$ME_NUM                              M$LO_NUM
     M$SI_NUM                              M$NODE_NUM                       r    B$JIT$
r    B$TCB$                                VM_MAIL_ACCT                          VM_NAME_MAP_NAME
     ERRMSG_FID                            VM_SEND_FILE_NAME                     VM_FORWARD_FILE_NAME
     VM_FORWARD_ENCL_NAME                  VM_FORWARD_FILE_PASS                  VM_MAILCG_NAME
     VM_SITENAME                           VM_MAILCG_SETSTA                      MAIL_IN
     SITE_IN                               MAP_FILE                              M$LM
r    B_VERSION
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:28   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID                                 ROSID
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:29   


        1        1        /*M* VOM$MAILMAN  MAILMANs main procedure section */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
        8        8        /*P*      NAME: VOM$MAILMAN
        9        9                  DESCRIPTION: Performs executive mailing functions for
       10       10                       the CP-6 electronic mail system.  These functions
       11       11                       include:
       12       12                       a) recognition of, and distribution of mail to
       13       13                       remotely connected MAILMEN.
       14       14                       b) local distribution of mail based on the address
       15       15                       list contained in the document.
       16       16                       c) deferred distribution of mail based on originator-
       17       17                       specified distribution time.
       18       18                       d) MAIL system recovery, should an automatic software
       19       19                       recovery occur.
       20       20                       e) distribution and delivery of replies for "return
       21       21                       receipt requested" mail.
       22       22                       f) journalling transactions for audit-trail purposes.
       23       23                       g) automatic forwarding of mail received from one
       24       24                       remote MAILMAN to another remote MAILMAN.
       25       25                       h) local distribution of mail received from remote
       26       26                       MAILMEN.
       27       27                                                                          */
       28       28
       29       29
       30       30        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:30   
       31       31
       32       32
       33       33        VOM$MAILMAN: PROC MAIN;

     33 17 000000   000000 700200 xent  VOM$MAILMAN  TSX0  ! X66_MAUTO
        17 000001   000024 000000                    ZERO    20,0

       34       34        /***** Include files *****/
       35       35          %INCLUDE CP_6_SUBS;
       36      575
       37      576
       38      577          %INCLUDE B_SEGIDS_C;
       39     1116          %INCLUDE VOM_DATA_R;                  /* Also includes CP_6 */
       40     8336          %INCLUDE VM_DATA_R;                   /* Also includes B_MACROS_C */
       41     8767          %INCLUDE VO_SUBS_C;
       42     8818          %INCLUDE B_ERRORS_C;
       43     9945          %F$DCB;
       44    10002          %INCLUDE VM_PERR_C;
       45    10297          %INCLUDE B$JIT;
       46    10900          %INCLUDE XUD_UTS_M;
       47    10982
       48    10983        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:31   
       49    10984        /***** Local data *****/
       50    10985    1   DCL I SBIN STATIC;
       51    10986    1   DCL J SBIN STATIC;
       52    10987    1   DCL K SBIN STATIC;
       53    10988    1   DCL CURRENT_TIME UBIN WORD STATIC;
       54    10989    1   DCL EPASS CHAR(12) STATIC;
       55    10990    1   DCL BIT9(0:11) REDEF EPASS UBIN BYTE UNAL;
       56    10991    1   DCL PASSWORD CHAR(8) STATIC;
       57    10992    1   DCL BIT6(0:11) REDEF PASSWORD UBIN(6) UNAL;
       58    10993
       59    10994        /* The next area is the internal TIME_TABLE for mailman */
       60    10995    1   DCL LAST$ PTR STATIC;
       61    10996    1   DCL FREE$ PTR STATIC SYMDEF INIT (ADDR(NIL));/* Head of free entries */
       62    10997    1   DCL MAX$ PTR STATIC SYMDEF ALIGNED;
       63    10998    1   DCL SEG$ PTR STATIC SYMDEF ALIGNED;
       64    10999
       65    11000    1   DCL TYPE SBIN WORD ALIGNED;
       66    11001    1   DCL KEY_VALUE CHAR(8) CALIGNED;
       67    11002    1   DCL SITENAME CHAR(8) CALIGNED;
       68    11003    1   DCL VOM$DOSEND ENTRY(1);
       69    11004
       70    11005    1   DCL X66_REL_AUTO ENTRY;
       71    11006    1   DCL VMA$ENLARGE_SEGMENT ENTRY(2) ALTRET;
       72    11007    1   DCL VMA$SHRINK_SEGMENT ENTRY(2) ALTRET;
       73    11008    1   DCL VMA$OPEN_ENCL_SEGS ENTRY ALTRET;
       74    11009    1   DCL VMD$GET_HEADER    ENTRY(2) ALTRET;
       75    11010    1   DCL VMD$GET_PROFILE   ENTRY(1) ALTRET;
       76    11011    1   DCL VMA$GET_SITE_NAME ENTRY(4) ALTRET;
       77    11012    1   DCL VMD$PUT_PROFILE   ENTRY(1) ALTRET;
       78    11013    1   DCL VOM$PROCESS ENTRY;
       79    11014    1   DCL ASZ$SCRAMBLE ENTRY(1);
       80    11015
       81    11016             %B$TCB (STCLASS="BASED(B$TCB$)");
       82    11019
       83    11020             %B$ALT;
       84    11028
       85    11029             %EQU_CG;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:32   
       86    11077
       87    11078             %B$CGAURD;
       88    11097              %VM_HEADER;
       89    11226
       90    11227
       91    11228             %VM_PROFILE;
       92    11315
       93    11316             %VM_KEYTYPES;
       94    11337
       95    11338             %VM_BODYKEY;
       96    11358
       97    11359             %VM_ADDTYPES;
       98    11363
       99    11364        %XUD$UTS_ENTRIES;
      100    11396
      101    11397
      102    11398        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:33   
      103    11399                                                /*
      104    11400                                                     Externals
      105    11401                                                                               */
      106    11402
      107    11403    1   DCL MAIL_IN DCB;
      108    11404    1   DCL SITE_IN DCB;
      109    11405
      110    11406    1   DCL MAP_FILE DCB;
      111    11407    1   DCL M$LM DCB;
      112    11408
      113    11409    1   DCL SAVE$ PTR ALIGNED;
      114    11410
      115    11411    1   DCL 1 B_VERSION SYMREF READONLY,
      116    11412    1         2 L UBIN BYTE CALIGNED,
      117    11413    1         2 C CHAR (B_VERSION.L);
      118    11414
      119    11415    1   DCL VOM$XCON ENTRY ASYNC;
      120    11416    1   DCL VOM$EVENT ENTRY ASYNC;
      121    11417    1   DCL VOM$ADDENTRY ENTRY(4);
      122    11418    1   DCL VOM$ADDENTRY_SORTED ENTRY(4);
      123    11419    1   DCL VOM$DELENTRY ENTRY(3);
      124    11420
      125    11421    1   dcl VOM_INIT_CCTIME    char(10) static symdef init(' ');
      126    11422        /*   VOM_INIT_CCTIME is used by the XCON routine VOM$XCON
      127    11423             to determine if there have been two XCON entries within
      128    11424             the last minute.  If there have been, it will not try to
      129    11425             M$LDTRC to itself.   This value is set at initialization
      130    11426             to be the contents of the first ten words of B$JIT.CCBUF.
      131    11427             When MAILMAN.:SYS issues a M$LDTRC to itself, it stuffs
      132    11428             the current date and time into B$JIT.CCBUF.                 */
      133    11429
      134    11430
      135    11431        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:34   
      136    11432        /*  Special symdefs.  These are here rather than VOM_DATA_D/R because
      137    11433            VMM$MESSAGE is in both mail and mailman.  The division between
      138    11434            things in VOM_DATA_D and VM_DATA_D was not done quite right, and
      139    11435            to make a long story short, these things have to be here.
      140    11436        */
      141    11437        %FPT_READ (FPTN=VO_READ_CG, STCLASS="CONSTANT SYMDEF",
      142    11438                  DCB=M$MAIL_COMGROUP,
      143    11439                  BUF=VM_CGBUFFER,
      144    11440                  EVENT = %VOM_READMAIL#,
      145    11441                  WAIT=NO);
      146    11480    1   DCL VO_NEED_READ BIT(1) STATIC SYMDEF INIT ('0'B);
      147    11481    1   DCL VO_PROCESS BIT(1) STATIC SYMDEF INIT('0'B);
      148    11482                                                /*
      149    11483                                                     Fpts
      150    11484                                                                               */
      151    11485
      152    11486                                                /* Buffer gets initialized
      153    11487                                                     to vector(dynamic seg) */
      154    11488
      155    11489             %FPT_XCON      (FPTN=SET_XCON,
      156    11490                                 UENTRY=VOM$XCON);
      157    11504
      158    11505             %FPT_WAIT      (FPTN=WAIT_IT_OUT,
      159    11506                                 UNITS=8464000);
      160    11520
      161    11521                                                /* One whole day */
      162    11522
      163    11523             %FPT_GDS (FPTN=GET_TIME_ENTRY,     /* Get a entry for time */
      164    11524                       SEGSIZE = "SIZEW(TIME_TABLE)",
      165    11525                       RESULTS = TIME_VECTOR,
      166    11526                       FREE = NO);
      167    11542
      168    11543             %VLP_VECTOR (FPTN = TIME_VECTOR);
      169    11558
      170    11559             %FPT_OPEN (FPTN=OPEN_NEXT,
      171    11560                            DCB = MAIL_IN,
      172    11561                       FUN=UPDATE,
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:35   
      173    11562                            NXTF=YES);
      174    11671
      175    11672             %FPT_OPEN (FPTN=OPEN_FIRST,
      176    11673                            DCB=MAIL_IN,
      177    11674                            NAME=FIRST_NAME,
      178    11675                            ACCT=VM_MAIL_ACCT,
      179    11676                            ASN=FILE,
      180    11677                            SETDCB=YES);
      181    11786
      182    11787             %VLP_NAME (FPTN=FIRST_NAME,
      183    11788                            NAME=':MESS');
      184    11815
      185    11816
      186    11817             %FPT_CLOSE  (FPTN=CLOSE_MAILIN_SAVE,
      187    11818                            STCLASS="STATIC SYMDEF",
      188    11819                            DCB=MAIL_IN,
      189    11820                            DISP=SAVE);
      190    11862
      191    11863             %FPT_CLOSE (FPTN=CLOSE_MAILIN_SCRATCH,
      192    11864                            STCLASS="STATIC SYMDEF",
      193    11865                            DCB=MAIL_IN,
      194    11866                            DISP=RELEASE);
      195    11908
      196    11909             %VLP_ERRCODE (FPTN=MYERROR,
      197    11910                            FCG = "'2617'O",
      198    11911                            MID ="'15'O");
      199    11956
      200    11957              %VLP_ERRCODE (FPTN=ERROR);
      201    12002
      202    12003              %FPT_TIME (FPTN=GET_CURRENT,
      203    12004              SOURCE=CLOCK,
      204    12005              DEST=UTS,
      205    12006              TSTAMP=CURRENT_TIME);
      206    12025        %FPT_WRITE(FPTN=WRITE_MAILCG,DCB=M$MAIL_COMGROUP,STCLASS="STATIC SYMDEF",
      207    12026                   STATION=OUTSTATION,
      208    12027                   BUF=VM_CGBUFFER);
      209    12058
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:36   
      210    12059             %FPT_OPEN (FPTN=OPEN_MAIL,
      211    12060                            STCLASS = "STATIC SYMDEF",
      212    12061                            DCB=MAIL_IN,
      213    12062                            ACCT=VM_MAIL_ACCT,
      214    12063                            NAME=MAIL_NAME,
      215    12064                            ACS=DIRECT,
      216    12065                            ORG=KEYED,
      217    12066                            FUN=UPDATE,
      218    12067                            ASN=FILE);
      219    12176
      220    12177             %VLP_NAME (FPTN=MAIL_NAME,STCLASS="STATIC SYMDEF",LEN=31,
      221    12178                        NAME='                        ');
      222    12205
      223    12206             %FPT_EVENT (UENTRY=VOM$EVENT);
      224    12220
      225    12221             %FPT_CLOSE (FPTN=CLOSE_RENAME,
      226    12222                            DCB=MAIL_IN,
      227    12223                            NAME=RENAME_NAME,
      228    12224                            CHGATT=YES);
      229    12266
      230    12267             %VLP_NAME  (FPTN=RENAME_NAME);
      231    12294
      232    12295             %VLP_NAME  (FPTN=FIRST_INTERSYS_FILE,
      233    12296                            NAME=':MOVE');
      234    12323        %VLP_STATION (FPTN=OUTSTATION, STCLASS="STATIC SYMDEF",
      235    12324                      ANYDCB=NO);
      236    12351
      237    12352              %FPT_CLOSE (FPTN=CLOSE_COMGROUP,
      238    12353              DCB=M$MAIL_COMGROUP);
      239    12395
      240    12396
      241    12397        %FPT_PRIV (FPTN=SET_FMSEC,PRIV=%PR_FMSEC#);
      242    12412        %FPT_TRUNC (FPTN=TRUNC_BUFF);
      243    12426
      244    12427    1   DCL TESTMODE BIT(1) STATIC INIT('0'B);
      245    12428
      246    12429        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:37   
      247    12430
      248    12431        /*
      249    12432             ***** Only run in ghost mode ...
      250    12433        */
      251    12434    1       If B$JIT.MODE ~= %M_GHOST# and not TESTMODE

  12434 17 000002   000000 470400 xsym               LDP0    B$JIT$
        17 000003   000000 236100                    LDQ     0,,PR0
        17 000004   740000 376003                    ANQ     -16384,DU
        17 000005   100000 116003                    CMPQ    32768,DU
        17 000006   000013 600000 17                 TZE     s:12441
        17 000007   000620 234000 11                 SZN     TESTMODE
        17 000010   000013 604000 17                 TMI     s:12441

      252    12435    1       then
      253    12436    1           call M$XXX;

  12436 17 000011   000003 713400                    CLIMB   3
        17 000012   000000 401760                    pmme    nvectors=0

      254    12437        /*
      255    12438             ***** Go!!!
      256    12439        */
      257    12440
      258    12441    1       VOM_INIT_CCTIME = substr(B$JIT.CCBUF,,10);

  12441 17 000013   000000 470400 xsym               LDP0    B$JIT$
        17 000014   040000 100500                    MLR     fill='040'O
        17 000015   000033 000012                    ADSC9   27,,PR0                  cn=0,n=10
        17 000016   000017 000012 11                 ADSC9   VOM_INIT_CCTIME          cn=0,n=10

      259    12442    1       CALL M$SPRIV (SET_FMSEC);

  12442 17 000017   000610 630400 11                 EPPR0   SET_FMSEC
        17 000020   020012 713400                    CLIMB   8202
        17 000021   400000 401760                    pmme    nvectors=1

PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:38   
      260    12443    1       IF B$JIT.MODE = %M_GHOST# AND B$JIT.PRIV.ACTIVE.JIT

  12443 17 000022   000000 470400 xsym               LDP0    B$JIT$
        17 000023   000000 236100                    LDQ     0,,PR0
        17 000024   740000 376003                    ANQ     -16384,DU
        17 000025   100000 116003                    CMPQ    32768,DU
        17 000026   000034 601000 17                 TNZ     s:12446
        17 000027   000013 236100                    LDQ     11,,PR0
        17 000030   000040 316007                    CANQ    32,DL
        17 000031   000034 600000 17                 TZE     s:12446

      261    12444    1       THEN
      262    12445    1           B$JIT.OUTPRIO = 7;     /* Set symbiont priority */

  12445 17 000032   007000 236007                    LDQ     3584,DL
        17 000033   000022 552110                    STBQ    18,'10'O,PR0

      263    12446    1       IF B$JIT.PRIV.ACTIVE.JIT

  12446 17 000034   000013 236100                    LDQ     11,,PR0
        17 000035   000040 316007                    CANQ    32,DL
        17 000036   000102 600000 17                 TZE     s:12453

      264    12447    2       THEN DO;

      265    12448    2           CALL CONCAT (B$JIT.CCBUF, 'MAILMAN ',B_VERSION.C, ' initializing');

  12448 17 000037   000000 236000 xsym               LDQ     B_VERSION
        17 000040   000033 772000                    QRL     27
        17 000041   000000 620006                    EAX0    0,QL
        17 000042   000116 237000 16                 LDAQ    MAIL_CGCTL+52
        17 000043   000033 755100                    STA     27,,PR0
        17 000044   000034 756100                    STQ     28,,PR0
        17 000045   040100 100440                    MLR     fill='040'O
        17 000046   000000 200010 xsym               ADSC9   B_VERSION                cn=1,n=*X0
        17 000047   000035 000370                    ADSC9   29,,PR0                  cn=0,n=248
        17 000050   000000 636010                    EAQ     0,X0
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:39   
        17 000051   000022 772000                    QRL     18
        17 000052   000370 116007                    CMPQ    248,DL
        17 000053   000064 603000 17                 TRC     s:12449
        17 000054   200016 740100                    STX0    SIZE+2,,AUTO
        17 000055   777407 620010                    EAX0    -249,X0
        17 000056   777777 660003                    ERX0    -1,DU
        17 000057   200016 236100                    LDQ     SIZE+2,,AUTO
        17 000060   000022 772000                    QRL     18
        17 000061   040146 100400                    MLR     fill='040'O
        17 000062   000120 000015 16                 ADSC9   MAIL_CGCTL+54            cn=0,n=13
        17 000063   000035 000010                    ADSC9   29,Q,PR0                 cn=0,n=*X0

      266    12449    2           CALL INDEX (I, '   ', B$JIT.CCBUF);

  12449 17 000064   000000 631400 11                 EPPR1   I
        17 000065   000124 633400 16                 EPPR3   MAIL_CGCTL+58
        17 000066   000003 223003                    LDX3    3,DU
        17 000067   000033 630500                    EPPR0   27,,PR0
        17 000070   000400 220003                    LDX0    256,DU
        17 000071   000000 236003                    LDQ     0,DU
        17 000072   000000 701000 xent               TSX1    X66_INDEX
        17 000073   000000 011000                    NOP     0

      267    12450    2           B$JIT.CCARS = I;

  12450 17 000074   000000 721000 11                 LXL1    I
        17 000075   000000 470400 xsym               LDP0    B$JIT$
        17 000076   000032 741100                    STX1    26,,PR0

      268    12451    2           B$JIT.JOBNAME = ' ';

  12451 17 000077   040100 100400                    MLR     fill='040'O
        17 000100   000000 000001 18                 ADSC9   0                        cn=0,n=1
        17 000101   000156 200037                    ADSC9   110,,PR0                 cn=1,n=31

      269    12452    2       END;

PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:40   
      270    12453    1       CALL VOM$_SETXCON;

  12453 17 000102   000405 701000 17                 TSX1    VOM$_SETXCON
        17 000103   000000 011000                    NOP     0

      271    12454        /* Scramble and encode the mail move account password */
      272    12455    1       PASSWORD = VO_INTERSYS_PASSWORD;

  12455 17 000104   040000 100400                    MLR     fill='040'O
        17 000105   000000 000010 xsym               ADSC9   VO_INTERSYS_PASSWORD     cn=0,n=8
        17 000106   000007 000010 11                 ADSC9   PASSWORD                 cn=0,n=8

      273    12456    1       CALL ASZ$SCRAMBLE (PASSWORD);

  12456 17 000107   000002 630400 18                 EPPR0   2
        17 000110   000001 631400 18                 EPPR1   1
        17 000111   000000 701000 xent               TSX1    ASZ$SCRAMBLE
        17 000112   000000 011000                    NOP     0

      274    12457    2       DO I = 0 TO 11;

  12457 17 000113   000000 450000 11                 STZ     I

      275    12458    2           BIT9(I)=BIT6(I)+ASCBIN(' ');

  12458 17 000114   000000 235000 11                 LDA     I
        17 000115   000117 605000 17                 TPL     s:12458+3
        17 000116   000006 035003                    ADLA    6,DU
        17 000117   000100 101405                    MRL     fill='000'O
        17 000120   000007 020001 11                 ADSC6   PASSWORD,A               cn=0,n=1
        17 000121   200017 020006                    ADSC6   SIZE+3,,AUTO             cn=0,n=6
        17 000122   200017 236100                    LDQ     SIZE+3,,AUTO
        17 000123   000040 036007                    ADLQ    32,DL
        17 000124   200016 756100                    STQ     SIZE+2,,AUTO
        17 000125   000000 235000 11                 LDA     I
        17 000126   000005 101500                    MRL     fill='000'O
        17 000127   200016 000004                    ADSC9   SIZE+2,,AUTO             cn=0,n=4
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:41   
        17 000130   000004 000001 11                 ADSC9   EPASS,A                  cn=0,n=1

      276    12459    2       END;

  12459 17 000131   000000 054000 11                 AOS     I
        17 000132   000000 235000 11                 LDA     I
        17 000133   000013 115007                    CMPA    11,DL
        17 000134   000114 604400 17                 TMOZ    s:12458

      277    12460    1       VO_INTERSYS_EPASS = EPASS;

  12460 17 000135   040000 100400                    MLR     fill='040'O
        17 000136   000004 000014 11                 ADSC9   EPASS                    cn=0,n=12
        17 000137   000000 000014 xsym               ADSC9   VO_INTERSYS_EPASS        cn=0,n=12

      278    12461
      279    12462    1       CALL VOM$_GETBUFS;

  12462 17 000140   000450 701000 17                 TSX1    VOM$_GETBUFS
        17 000141   000000 011000                    NOP     0

      280    12463
      281    12464    1       CALL VOM$RECOVER;

  12464 17 000142   000533 701000 17                 TSX1    VOM$RECOVER
        17 000143   000000 011000                    NOP     0

      282    12465
      283    12466    1       CALL M$EVENT(FPT_EVENT) ALTRET(WELL_WHAT_NOW);

  12466 17 000144   000466 630400 11                 EPPR0   FPT_EVENT
        17 000145   410001 713400                    CLIMB   alt,+4097
        17 000146   400000 401760                    pmme    nvectors=1
        17 000147   000402 702000 17                 TSX2    WELL_WHAT_NOW

      284    12467    1       CALL VOM$_OPENS;                  /* Go open mail cg */

PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:42   
  12467 17 000150   000414 701000 17                 TSX1    VOM$_OPENS
        17 000151   000000 011000                    NOP     0

      285    12468
      286    12469    1       CALL M$TIME (GET_CURRENT);

  12469 17 000152   000334 630400 11                 EPPR0   GET_CURRENT
        17 000153   020004 713400                    CLIMB   8196
        17 000154   402000 401760                    pmme    nvectors=5

      287    12470
      288    12471    1       VO_MAILMAN_STARTUP_TIME = CURRENT_TIME;

  12471 17 000155   000003 235000 11                 LDA     CURRENT_TIME
        17 000156   000000 755000 xsym               STA     VO_MAILMAN_STARTUP_TIME

      289    12472
      290    12473    1       CALL M$READ(VO_READ_CG) ALTRET (WELL_WHAT_NOW);

  12473 17 000157   000000 630400 16                 EPPR0   VO_READ_CG
        17 000160   440000 713400                    CLIMB   alt,read
        17 000161   401400 401760                    pmme    nvectors=4
        17 000162   000402 702000 17                 TSX2    WELL_WHAT_NOW

      291    12474
      292    12475    2       DO WHILE ('1'B); /* FOREVER */;

      293    12476
      294    12477    2           CALL M$TIME (GET_CURRENT);  /* Get current time */

  12477 17 000163   000334 630400 11                 EPPR0   GET_CURRENT
        17 000164   020004 713400                    CLIMB   8196
        17 000165   402000 401760                    pmme    nvectors=5

      295    12478
      296    12479    2           IF TIME_HEAD$ ~= ADDR(NIL)

PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:43   
  12479 17 000166   000000 236000 xsym               LDQ     TIME_HEAD$
        17 000167   000003 116000 18                 CMPQ    3
        17 000170   000212 600000 17                 TZE     s:12486

      297    12480    2           THEN
      298    12481    3           DO;

      299    12482    3               CALL XUD$UTS_DIFF_SEC(I,TIME_HEAD$->TIME_TABLE.TSTAMP,CURRENT_TIME);

  12482 17 000171   000005 236000 18                 LDQ     5
        17 000172   200020 756100                    STQ     SIZE+4,,AUTO
        17 000173   000000 236000 xsym               LDQ     TIME_HEAD$
        17 000174   000002 036003                    ADLQ    2,DU
        17 000175   000006 235000 18                 LDA     6
        17 000176   200016 757100                    STAQ    SIZE+2,,AUTO
        17 000177   200016 630500                    EPPR0   SIZE+2,,AUTO
        17 000200   000004 631400 18                 EPPR1   4
        17 000201   000000 701000 xent               TSX1    XUD$UTS_DIFF_SEC
        17 000202   000000 011000                    NOP     0

      300    12483    3               I = MINIMUM(I, 30);

  12483 17 000203   000036 236007                    LDQ     30,DL
        17 000204   000207 604000 17                 TMI     s:12483+4
        17 000205   000000 116000 11                 CMPQ    I
        17 000206   000210 604400 17                 TMOZ    s:12483+5
        17 000207   000000 236000 11                 LDQ     I
        17 000210   000000 756000 11                 STQ     I

      301    12484    3           END;

  12484 17 000211   000214 710000 17                 TRA     s:12488

      302    12485    2           ELSE
      303    12486    2               I = 30;

  12486 17 000212   000036 235007                    LDA     30,DL
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:44   
        17 000213   000000 755000 11                 STA     I

      304    12487
      305    12488    2           IF I <= 0

  12488 17 000214   000000 235000 11                 LDA     I
        17 000215   000223 605400 17                 TPNZ    s:12497

      306    12489    3           THEN DO;

      307    12490
      308    12491    3               CALL VOM$DOSEND(TIME_HEAD$); /* Go send current */

  12491 17 000216   000007 630400 18                 EPPR0   7
        17 000217   000001 631400 18                 EPPR1   1
        17 000220   000000 701000 xent               TSX1    VOM$DOSEND
        17 000221   000000 011000                    NOP     0

      309    12492
      310    12493    3           END;

  12493 17 000222   000362 710000 17                 TRA     s:12531

      311    12494
      312    12495    3           ELSE DO;

      313    12496
      314    12497    3               IF VO_NEED_READ OR VO_PROCESS

  12497 17 000223   000022 234000 11                 SZN     VO_NEED_READ
        17 000224   000362 604000 17                 TMI     s:12531
        17 000225   000023 234000 11                 SZN     VO_PROCESS
        17 000226   000362 604000 17                 TMI     s:12531

      315    12498    3               THEN
      316    12499    3                   EXIT;
      317    12500
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:45   
      318    12501    3               CALL X66_REL_AUTO;      /* Release excess memory */

  12501 17 000227   000010 631400 18                 EPPR1   8
        17 000230   000000 701000 xent               TSX1    X66_REL_AUTO
        17 000231   000000 011000                    NOP     0

      319    12502    3               CALL VOM$SHRINK_SEGMENT(VM_ADDLIST_);

  12502 17 000232   000011 236000 18                 LDQ     9
        17 000233   200013 756100                    STQ     SAVE$+3,,AUTO
        17 000234   001010 701000 17                 TSX1    VOM$SHRINK_SEGMENT
        17 000235   000000 011000                    NOP     0

      320    12503    3               CALL VOM$SHRINK_SEGMENT(VM_ADDREC_);

  12503 17 000236   000012 236000 18                 LDQ     10
        17 000237   200013 756100                    STQ     SAVE$+3,,AUTO
        17 000240   001010 701000 17                 TSX1    VOM$SHRINK_SEGMENT
        17 000241   000000 011000                    NOP     0

      321    12504    3               CALL VOM$SHRINK_SEGMENT(VM_HEADER_);

  12504 17 000242   000013 236000 18                 LDQ     11
        17 000243   200013 756100                    STQ     SAVE$+3,,AUTO
        17 000244   001010 701000 17                 TSX1    VOM$SHRINK_SEGMENT
        17 000245   000000 011000                    NOP     0

      322    12505    3               CALL VOM$SHRINK_SEGMENT(VM_PROFILE_);

  12505 17 000246   000014 236000 18                 LDQ     12
        17 000247   200013 756100                    STQ     SAVE$+3,,AUTO
        17 000250   001010 701000 17                 TSX1    VOM$SHRINK_SEGMENT
        17 000251   000000 011000                    NOP     0

      323    12506    3               CALL VOM$SHRINK_SEGMENT(VM_WORK_);

  12506 17 000252   000015 236000 18                 LDQ     13
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:46   
        17 000253   200013 756100                    STQ     SAVE$+3,,AUTO
        17 000254   001010 701000 17                 TSX1    VOM$SHRINK_SEGMENT
        17 000255   000000 011000                    NOP     0

      324    12507    3               CALL VOM$SHRINK_SEGMENT(VM_COPY_);

  12507 17 000256   000016 236000 18                 LDQ     14
        17 000257   200013 756100                    STQ     SAVE$+3,,AUTO
        17 000260   001010 701000 17                 TSX1    VOM$SHRINK_SEGMENT
        17 000261   000000 011000                    NOP     0

      325    12508
      326    12509    3               TRUNC_BUFF.V.DCB# = M$MAIL_GLOBAL_NUM; /* Rel. FPOOLs */

  12509 17 000262   000000 720000 xsym               LXL0    M$MAIL_GLOBAL_NUM
        17 000263   000616 740000 11                 STX0    TRUNC_BUFF+2

      327    12510    3               CALL M$TRUNC(TRUNC_BUFF);

  12510 17 000264   000614 630400 11                 EPPR0   TRUNC_BUFF
        17 000265   050003 713400                    CLIMB   20483
        17 000266   400000 401760                    pmme    nvectors=1

      328    12511    3               TRUNC_BUFF.V.DCB# = M$NODE_NUM;

  12511 17 000267   000000 720000 xsym               LXL0    M$NODE_NUM
        17 000270   000616 740000 11                 STX0    TRUNC_BUFF+2

      329    12512    3               CALL M$TRUNC(TRUNC_BUFF);

  12512 17 000271   000614 630400 11                 EPPR0   TRUNC_BUFF
        17 000272   050003 713400                    CLIMB   20483
        17 000273   400000 401760                    pmme    nvectors=1

      330    12513    3               TRUNC_BUFF.V.DCB# = DCBNUM(M$LM);

  12513 17 000274   000000 236007 xsym               LDQ     M$LM,DL
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:47   
        17 000275   000000 620006                    EAX0    0,QL
        17 000276   000616 740000 11                 STX0    TRUNC_BUFF+2

      331    12514    3               CALL M$TRUNC(TRUNC_BUFF);

  12514 17 000277   000614 630400 11                 EPPR0   TRUNC_BUFF
        17 000300   050003 713400                    CLIMB   20483
        17 000301   400000 401760                    pmme    nvectors=1

      332    12515    3               WAIT_IT_OUT.V.UNITS# = I;

  12515 17 000302   000000 235000 11                 LDA     I
        17 000303   000036 755000 11                 STA     WAIT_IT_OUT+4

      333    12516    4               DO INHIBIT;

      334    12517    4                   IF (NOT VO_NEED_READ) AND (NOT VO_PROCESS)

  12517 17 000304   000022 234200 11                 SZN   ! VO_NEED_READ
        17 000305   000362 604200 17                 TMI   ! s:12531
        17 000306   000023 234200 11                 SZN   ! VO_PROCESS
        17 000307   000362 604200 17                 TMI   ! s:12531

      335    12518    5                   THEN DO;

      336    12519    5                       IF B$JIT.PRIV.ACTIVE.JIT

  12519 17 000310   000000 470600 xsym               LDP0  ! B$JIT$
        17 000311   000013 236300                    LDQ   ! 11,,PR0
        17 000312   000040 316207                    CANQ  ! 32,DL
        17 000313   000357 600200 17                 TZE   ! s:12526

      337    12520    6                       THEN DO;

      338    12521    6                           CALL CONCAT (B$JIT.CCBUF, 'MAILMAN ',B_VERSION.C, ' idle');

  12521 17 000314   000000 236200 xsym               LDQ   ! B_VERSION
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:48   
        17 000315   000033 772200                    QRL   ! 27
        17 000316   000000 620206                    EAX0  ! 0,QL
        17 000317   000116 237200 16                 LDAQ  ! MAIL_CGCTL+52
        17 000320   000033 755300                    STA   ! 27,,PR0
        17 000321   000034 756300                    STQ   ! 28,,PR0
        17 000322   040100 100640                    MLR   ! fill='040'O
        17 000323   000000 200010 xsym               ADSC9   B_VERSION                cn=1,n=*X0
        17 000324   000035 000370                    ADSC9   29,,PR0                  cn=0,n=248
        17 000325   000000 636210                    EAQ   ! 0,X0
        17 000326   000022 772200                    QRL   ! 18
        17 000327   000370 116207                    CMPQ  ! 248,DL
        17 000330   000341 603200 17                 TRC   ! s:12522
        17 000331   200016 740300                    STX0  ! SIZE+2,,AUTO
        17 000332   777407 620210                    EAX0  ! -249,X0
        17 000333   777777 660203                    ERX0  ! -1,DU
        17 000334   200016 236300                    LDQ   ! SIZE+2,,AUTO
        17 000335   000022 772200                    QRL   ! 18
        17 000336   040146 100600                    MLR   ! fill='040'O
        17 000337   000125 000005 16                 ADSC9   MAIL_CGCTL+59            cn=0,n=5
        17 000340   000035 000010                    ADSC9   29,Q,PR0                 cn=0,n=*X0

      339    12522    6                           CALL INDEX (I, '   ', B$JIT.CCBUF);

  12522 17 000341   000000 631600 11                 EPPR1 ! I
        17 000342   000124 633600 16                 EPPR3 ! MAIL_CGCTL+58
        17 000343   000003 223203                    LDX3  ! 3,DU
        17 000344   000033 630700                    EPPR0 ! 27,,PR0
        17 000345   000400 220203                    LDX0  ! 256,DU
        17 000346   000000 236203                    LDQ   ! 0,DU
        17 000347   000000 701200 xent               TSX1  ! X66_INDEX
        17 000350   000000 011200                    NOP   ! 0

      340    12523    6                           B$JIT.CCARS = I;

  12523 17 000351   000000 721200 11                 LXL1  ! I
        17 000352   000000 470600 xsym               LDP0  ! B$JIT$
        17 000353   000032 741300                    STX1  ! 26,,PR0
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:49   

      341    12524    6                           B$JIT.JOBNAME = ' ';

  12524 17 000354   040100 100600                    MLR   ! fill='040'O
        17 000355   000000 000001 18                 ADSC9   0                        cn=0,n=1
        17 000356   000156 200037                    ADSC9   110,,PR0                 cn=1,n=31

      342    12525    6                       END;

      343    12526    5                       CALL M$WAIT(WAIT_IT_OUT);

  12526 17 000357   000032 630600 11                 EPPR0 ! WAIT_IT_OUT
        17 000360   020006 713600                    CLIMB ! 8198
        17 000361   400400 401760                    pmme    nvectors=2

      344    12527    5                   END;

      345    12528    4               END;

      346    12529    3           END;

      347    12530
      348    12531    3           IF VO_NEED_READ THEN DO;

  12531 17 000362   000022 234000 11                 SZN     VO_NEED_READ
        17 000363   000370 605000 17                 TPL     s:12536

      349    12532    3               VO_NEED_READ = '0'B;

  12532 17 000364   000022 450000 11                 STZ     VO_NEED_READ

      350    12533    3               CALL M$READ (VO_READ_CG);

  12533 17 000365   000000 630400 16                 EPPR0   VO_READ_CG
        17 000366   040000 713400                    CLIMB   read
        17 000367   401400 401760                    pmme    nvectors=4

PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:50   
      351    12534    3           END;

      352    12535
      353    12536    2           IF VO_PROCESS THEN CALL VOM$PROCESS;

  12536 17 000370   000023 234000 11                 SZN     VO_PROCESS
        17 000371   000375 605000 17                 TPL     s:12538

  12536 17 000372   000010 631400 18                 EPPR1   8
        17 000373   000000 701000 xent               TSX1    VOM$PROCESS
        17 000374   000000 011000                    NOP     0

      354    12537
      355    12538    2           IF VO_INTERSYS_ALLOWED

  12538 17 000375   000000 234000 xsym               SZN     VO_INTERSYS_ALLOWED
        17 000376   000163 605000 17                 TPL     s:12477

      356    12539    2           THEN
      357    12540    2               CALL VOM$INTERSYS_RECEIVED;

  12540 17 000377   000644 701000 17                 TSX1    VOM$INTERSYS_RECEIVED
        17 000400   000000 011000                    NOP     0

      358    12541    2       END;                            /* End forever */

  12541 17 000401   000163 710000 17                 TRA     s:12477

  12532 17 000402                       WELL_WHAT_N* null
      359    12542    1   WELL_WHAT_NOW: ;
      360    12543    1       CALL M$XXX;

  12543 17 000402   000003 713400                    CLIMB   3
        17 000403   000000 401760                    pmme    nvectors=0
        17 000404   001035 710000 17                 TRA     s:13163

      361    12544
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:51   
      362    12545        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:52   
      363    12546
      364    12547    1   VOM$_SETXCON: PROC;

  12547 17 000405   200012 741300       VOM$_SETXCON STX1  ! SAVE$+2,,AUTO

      365    12548
      366    12549    2       CALL M$XCON (SET_XCON) ALTRET(XCON0_ALT);

  12549 17 000406   000024 630400 11                 EPPR0   SET_XCON
        17 000407   410003 713400                    CLIMB   alt,+4099
        17 000410   400400 401760                    pmme    nvectors=2
        17 000411   000412 702000 17                 TSX2    XCON0_ALT

  12549 17 000412                       XCON0_ALT    null
      367    12550    2   XCON0_ALT: ;
      368    12551
      369    12552    2       RETURN;

  12552 17 000412   200012 221300                    LDX1  ! SAVE$+2,,AUTO
        17 000413   000001 702211                    TSX2  ! 1,X1

      370    12553    2   END VOM$_SETXCON;
      371    12554
      372    12555        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:53   
      373    12556
      374    12557    1   VOM$_OPENS: PROC;

  12557 17 000414   200012 741300       VOM$_OPENS   STX1  ! SAVE$+2,,AUTO

      375    12558
      376    12559
      377    12560          %FPT_OPEN      (FPTN=OPEN_COMGROUP,
      378    12561                              DCB=M$MAIL_COMGROUP,
      379    12562                              ASN=COMGROUP,
      380    12563                              SETSTA=MAILMAN_STATION,
      381    12564                              FUN=CREATE,
      382    12565                              EXIST=NEWFILE,
      383    12566                              CTG=YES,
      384    12567                              SHARE=ALL,
      385    12568                              AU=YES,
      386    12569                              IXTNSIZE=30,
      387    12570                              ACCESS=MAILCG_ACCESS,
      388    12571                              ACSVEH=MAILCG_ACSVEH,
      389    12572                              ACCT=VM_MAIL_ACCT,
      390    12573                              NAME=VM_MAILCG_NAME);
      391    12682
      392    12683               %VLP_ATTR (FPTN=MAILCG_ACCESS);
      393    12697               %VLP_ACCESS (NOLIST=YES,EXEC=YES,LAST=";");
      394    12714
      395    12715              %VLP_ATTR (FPTN=MAILCG_ACSVEH);
      396    12729               %VLP_ACSVEH (READ=YES,UPD=YES,WNEW=YES,DELR=YES,VEHICLE='SEND');
      397    12746              %VLP_ACSVEH (READ=YES,UPD=YES,WNEW=YES,DELR=YES,VEHICLE='SEND_TEST');
      398    12763              %VLP_ACSVEH (READ=YES,UPD=YES,WNEW=YES,DELR=YES,VEHICLE='MAIL');
      399    12780              %VLP_ACSVEH (READ=YES,UPD=YES,WNEW=YES,DELR=YES,VEHICLE='MAIL_TEST');
      400    12797              %VLP_ACSVEH (READ=YES,UPD=YES,WNEW=YES,DELR=YES,VEHICLE='MAIL_TEST');
      401    12814              %VLP_ACSVEH (READ=YES,UPD=YES,WNEW=YES,DELR=YES,VEHICLE='MAILMAN',LAST=";");
      402    12831              %VLP_SETSTA (FPTN=MAILMAN_STATION,
      403    12832              STCLASS=CONSTANT,
      404    12833              MYSTATION='MAILMAN');
      405    12861
      406    12862              %FPT_CGCTL    (FPTN=MAIL_CGCTL,
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:54   
      407    12863              DCB=M$MAIL_COMGROUP,
      408    12864              CGCP=MAILCG_CGCP,
      409    12865              STCLASS=CONSTANT);
      410    12888
      411    12889
      412    12890             %VLP_CGCP      (FPTN=MAILCG_CGCP,
      413    12891                                 MINPG=3,
      414    12892                                 TERMCONAU=NO,
      415    12893                                 TERMCONNAU=NO,
      416    12894                                 AUCONTERM=DISCONNECT, /* was activate */
      417    12895                                 AUDCONTERM=DISCONNECT, /* was activate */
      418    12896                                 WAS=YES,
      419    12897                                 RAS=YES,
      420    12898                                 CONMSG=NO,
      421    12899                                 AUCONDCB=DEACTIVATE, /* was nc */
      422    12900                                 AUDCONDCB=DEACTIVATE,
      423    12901                                 SMD=NO,
      424    12902                                 MAXMC=400,
      425    12903                                 DCBCONNAU=NO,
      426    12904                                 DCBCONLGL=YES,
      427    12905                                 TERMCONLGL=NO,
      428    12906                                 SECURE=NO,
      429    12907                                 XSTALGL=YES,
      430    12908                                 XTYPLGL=YES);
      431    12951
      432    12952    2       CALL M$OPEN (OPEN_COMGROUP) ALTRET (CANT_OPEN_MAILCG);

  12952 17 000415   000622 630400 11                 EPPR0   OPEN_COMGROUP
        17 000416   450000 713400                    CLIMB   alt,open
        17 000417   410400 401760                    pmme    nvectors=18
        17 000420   000444 702000 17                 TSX2    CANT_OPEN_MAILCG

      433    12953    2       CALL M$CGCTL (MAIL_CGCTL) ALTRET(CANT_OPEN_MAILCG);

  12953 17 000421   000032 630400 16                 EPPR0   MAIL_CGCTL
        17 000422   500003 713400                    CLIMB   alt,+32771
        17 000423   411400 401760                    pmme    nvectors=20
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:55   
        17 000424   000444 702000 17                 TSX2    CANT_OPEN_MAILCG

      434    12954        /*
      435    12955             ***** If unable to find the definition for this site,
      436    12956                   then turn intersystem mail off ...
      437    12957        */
      438    12958    2       KEY_VALUE = '*IAM';

  12958 17 000425   000127 235000 16                 LDA     MAIL_CGCTL+61
        17 000426   000000 236000 18                 LDQ     0
        17 000427   200004 757100                    STAQ    KEY_VALUE,,AUTO

      439    12959    2       CALL VMA$GET_SITE_NAME(KEY_VALUE,VM_SITENAME)

  12959 17 000430   000020 236000 18                 LDQ     16
        17 000431   200017 756100                    STQ     SIZE+3,,AUTO
        17 000432   200004 630500                    EPPR0   KEY_VALUE,,AUTO
        17 000433   200016 450500                    STP0    SIZE+2,,AUTO
        17 000434   200016 630500                    EPPR0   SIZE+2,,AUTO
        17 000435   000017 631400 18                 EPPR1   15
        17 000436   000000 701000 xent               TSX1    VMA$GET_SITE_NAME
        17 000437   000441 702000 17                 TSX2    s:12962
        17 000440   000442 710000 17                 TRA     s:12965

      440    12960    2       WHENALTRETURN
      441    12961    3       DO;

      442    12962    3           VO_INTERSYS_ALLOWED = %NO#;

  12962 17 000441   000000 450000 xsym               STZ     VO_INTERSYS_ALLOWED

      443    12963    3       END;

      444    12964
      445    12965    2       RETURN;

  12965 17 000442   200012 221300                    LDX1  ! SAVE$+2,,AUTO
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:56   
        17 000443   000001 702211                    TSX2  ! 1,X1

  12958 17 000444                       CANT_OPEN_M* null
      446    12966
      447    12967    2   CANT_OPEN_MAILCG:;
      448    12968
      449    12969    2       CALL M$XXX;

  12969 17 000444   000003 713400                    CLIMB   3
        17 000445   000000 401760                    pmme    nvectors=0

      450    12970
      451    12971    2   END VOM$_OPENS;

  12971 17 000446   200012 221300                    LDX1  ! SAVE$+2,,AUTO
        17 000447   000001 702211                    TSX2  ! 1,X1

      452    12972
      453    12973        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:57   
      454    12974    1   VOM$_GETBUFS: PROC;

  12974 17 000450   200012 741300       VOM$_GETBUFS STX1  ! SAVE$+2,,AUTO

      455    12975        /*
      456    12976             ***** How data segments are used in mail/send/mailman ...
      457    12977
      458    12978                   Segments used in all modules
      459    12979                   ----------------------------
      460    12980                   VM_ADDLIST
      461    12981                      - used for building new address list (VMA$EXPAND_LIST).
      462    12982
      463    12983                   VM_HEADER
      464    12984                      - used to contain the header of a message.
      465    12985
      466    12986                   VM_PROFILE
      467    12987                      - used to contain the profile of a folder.
      468    12988
      469    12989                   VM_WORK
      470    12990                      - used to contain list and user definitions when
      471    12991                        expanding an address list.
      472    12992
      473    12993                   Segments used by only mail and send
      474    12994                   -----------------------------------
      475    12995                   VM_PARSEAREA
      476    12996                      - used to contain input and parse info (XUR$GETCMD)
      477    12997
      478    12998                   segments used only by mail
      479    12999                   --------------------------
      480    13000                   VM_SELECT
      481    13001                      - used to contain message selection contexts
      482    13002
      483    13003                   segments used only by mailman
      484    13004                   -----------------------------
      485    13005                   VM_ADDREC
      486    13006                      - used to contain address record to be expanded.
      487    13007
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:58   
      488    13008                   VM_INPUT
      489    13009                      - used to contain input queue.
      490    13010
      491    13011                   VM_COPY (redef of VM_SELECT)
      492    13012                      - used to move copies of files around.
      493    13013        */
      494    13014    2       CALL VMA$ENLARGE_SEGMENT(VM_ADDLIST_,1024) ALTRET(E_ENLARGE);

  13014 17 000451   000022 630400 18                 EPPR0   18
        17 000452   000017 631400 18                 EPPR1   15
        17 000453   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        17 000454   000527 702000 17                 TSX2    E_ENLARGE

      495    13015    2       CALL VMA$ENLARGE_SEGMENT(VM_ADDREC_,1024) ALTRET(E_ENLARGE);

  13015 17 000455   000024 630400 18                 EPPR0   20
        17 000456   000017 631400 18                 EPPR1   15
        17 000457   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        17 000460   000527 702000 17                 TSX2    E_ENLARGE

      496    13016    2       CALL VMA$ENLARGE_SEGMENT(VM_HEADER_,1024) ALTRET(E_ENLARGE);

  13016 17 000461   000026 630400 18                 EPPR0   22
        17 000462   000017 631400 18                 EPPR1   15
        17 000463   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        17 000464   000527 702000 17                 TSX2    E_ENLARGE

      497    13017    2       CALL VMA$ENLARGE_SEGMENT(VM_PROFILE_,1024) ALTRET(E_ENLARGE);

  13017 17 000465   000030 630400 18                 EPPR0   24
        17 000466   000017 631400 18                 EPPR1   15
        17 000467   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        17 000470   000527 702000 17                 TSX2    E_ENLARGE

      498    13018    2       CALL VMA$ENLARGE_SEGMENT(VM_WORK_,1024) ALTRET(E_ENLARGE);

  13018 17 000471   000032 630400 18                 EPPR0   26
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:59   
        17 000472   000017 631400 18                 EPPR1   15
        17 000473   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        17 000474   000527 702000 17                 TSX2    E_ENLARGE

      499    13019    2       CALL VMA$ENLARGE_SEGMENT(VM_INPUT_,1024) ALTRET(E_ENLARGE);

  13019 17 000475   000034 630400 18                 EPPR0   28
        17 000476   000017 631400 18                 EPPR1   15
        17 000477   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        17 000500   000527 702000 17                 TSX2    E_ENLARGE

      500    13020
      501    13021    2       CALL VMA$ENLARGE_SEGMENT(VM_COPY_,1024) ALTRET(E_ENLARGE);

  13021 17 000501   000036 630400 18                 EPPR0   30
        17 000502   000017 631400 18                 EPPR1   15
        17 000503   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        17 000504   000527 702000 17                 TSX2    E_ENLARGE

      502    13022
      503    13023    2       CALL VMA$OPEN_ENCL_SEGS ALTRET (E_ENLARGE);

  13023 17 000505   000010 631400 18                 EPPR1   8
        17 000506   000000 701000 xent               TSX1    VMA$OPEN_ENCL_SEGS
        17 000507   000527 702000 17                 TSX2    E_ENLARGE

      504    13024
      505    13025
      506    13026    2       TIME_HEAD$ = ADDR(NIL);

  13026 17 000510   000003 236000 18                 LDQ     3
        17 000511   000000 756000 xsym               STQ     TIME_HEAD$

      507    13027    2       FREE$ = ADDR(NIL);

  13027 17 000512   000012 756000 11                 STQ     FREE$

PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:60   
      508    13028    2       INTERSYS$ = ADDR(NIL);

  13028 17 000513   000000 756000 xsym               STQ     INTERSYS$

      509    13029    2       INTERSYS_HEAD$ = ADDR(NIL);

  13029 17 000514   000000 756000 xsym               STQ     INTERSYS_HEAD$

      510    13030    2       MAX$ = PINCRW(VM_INPUT$, 1024);

  13030 17 000515   000000 236000 xsym               LDQ     VM_INPUT$
        17 000516   002000 036003                    ADLQ    1024,DU
        17 000517   000013 756000 11                 STQ     MAX$

      511    13031    2       SEG$ = VM_INPUT$;

  13031 17 000520   000000 236000 xsym               LDQ     VM_INPUT$
        17 000521   000014 756000 11                 STQ     SEG$

      512    13032    2       SEG$->TIME_TABLE.NEXT$ = ADDR(NIL);

  13032 17 000522   000003 236000 18                 LDQ     3
        17 000523   000014 470400 11                 LDP0    SEG$
        17 000524   000000 756100                    STQ     0,,PR0

      513    13033
      514    13034    2       RETURN;

  13034 17 000525   200012 221300                    LDX1  ! SAVE$+2,,AUTO
        17 000526   000001 702211                    TSX2  ! 1,X1

      515    13035        /**/
      516    13036    2   E_ENLARGE:
      517    13037    2       CALL M$XXX;

  13037 17 000527   000003 713400       E_ENLARGE    CLIMB   3
        17 000530   000000 401760                    pmme    nvectors=0
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:61   

      518    13038
      519    13039    2   END VOM$_GETBUFS;

  13039 17 000531   200012 221300                    LDX1  ! SAVE$+2,,AUTO
        17 000532   000001 702211                    TSX2  ! 1,X1

      520    13040        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:62   
      521    13041    1   VOM$RECOVER: PROC;

  13041 17 000533   200012 741300       VOM$RECOVER  STX1  ! SAVE$+2,,AUTO

      522    13042
      523    13043    2   DCL TIME_NEW$ PTR;
      524    13044
      525    13045    2       CALL M$OPEN (OPEN_FIRST) ALTRET (BAD_OPEN); /* Merge file name */

  13045 17 000534   000142 630400 11                 EPPR0   OPEN_FIRST
        17 000535   450000 713400                    CLIMB   alt,open
        17 000536   410400 401760                    pmme    nvectors=18
        17 000537   000626 702000 17                 TSX2    BAD_OPEN

      526    13046
      527    13047    3       DO WHILE ('1'B); /* FOREVER */;                    /* Do until no more files */

      528    13048
      529    13049    3           CALL M$OPEN (OPEN_NEXT) ALTRET(BAD_OPEN);

  13049 17 000540   000050 630400 11                 EPPR0   OPEN_NEXT
        17 000541   450000 713400                    CLIMB   alt,open
        17 000542   410400 401760                    pmme    nvectors=18
        17 000543   000626 702000 17                 TSX2    BAD_OPEN

      530    13050
      531    13051    3           IF SUBSTR(DCBADDR(DCBNUM(MAIL_IN)) -> F$DCB.NAME#.C,0,5)

  13051 17 000544   000000 236007 xsym               LDQ     MAIL_IN,DL
        17 000545   000040 470400 18                 LDP0    32
        17 000546   000000 471500                    LDP1    0,,PR0
        17 000547   100000 473506                    LDP3    0,QL,PR1
        17 000550   040000 106500                    CMPC    fill='040'O
        17 000551   300010 200005                    ADSC9   8,,PR3                   cn=1,n=5
        17 000552   000130 000005 16                 ADSC9   MAIL_CGCTL+62            cn=0,n=5
        17 000553   000562 600000 17                 TZE     s:13059

PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:63   
      532    13052    3             ~= ':MESS'
      533    13053    3           THEN
      534    13054    4           DO;

      535    13055    4               CALL M$CLOSE (CLOSE_MAILIN_SAVE) ALTRET (BAD_OPEN);

  13055 17 000554   000236 630400 11                 EPPR0   CLOSE_MAILIN_SAVE
        17 000555   450001 713400                    CLIMB   alt,close
        17 000556   406000 401760                    pmme    nvectors=13
        17 000557   000626 702000 17                 TSX2    BAD_OPEN

      536    13056    4               RETURN;

  13056 17 000560   200012 221300                    LDX1  ! SAVE$+2,,AUTO
        17 000561   000001 702211                    TSX2  ! 1,X1

      537    13057    4           END;
      538    13058
      539    13059    3           CALL VMD$GET_HEADER (0, DCBNUM(MAIL_IN)) ALTRET (BAD_OPEN);

  13059 17 000562   000000 236007 xsym               LDQ     MAIL_IN,DL
        17 000563   200016 756100                    STQ     SIZE+2,,AUTO
        17 000564   200016 633500                    EPPR3   SIZE+2,,AUTO
        17 000565   200021 453500                    STP3    SIZE+5,,AUTO
        17 000566   000041 236000 18                 LDQ     33
        17 000567   200020 756100                    STQ     SIZE+4,,AUTO
        17 000570   200020 630500                    EPPR0   SIZE+4,,AUTO
        17 000571   000017 631400 18                 EPPR1   15
        17 000572   000000 701000 xent               TSX1    VMD$GET_HEADER
        17 000573   000626 702000 17                 TSX2    BAD_OPEN

      540    13060        /*
      541    13061             ***** If no delivery time was specified,
      542    13062                   then deliver as soon as possible.
      543    13063                   Therefore, this entry must be added
      544    13064                   to the time queue with the current time ...
      545    13065        */
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:64   
      546    13066    3           IF VM_HEADER.DELIVERY_DATE = 0

  13066 17 000574   000000 470400 xsym               LDP0    VM_HEADER$
        17 000575   000002 235100                    LDA     2,,PR0
        17 000576   000605 601000 17                 TNZ     s:13072

      547    13067    3           THEN
      548    13068    4           DO;

      549    13069    4               CALL M$TIME (GET_CURRENT);

  13069 17 000577   000334 630400 11                 EPPR0   GET_CURRENT
        17 000600   020004 713400                    CLIMB   8196
        17 000601   402000 401760                    pmme    nvectors=5

      550    13070    4               VM_HEADER.DELIVERY_DATE = CURRENT_TIME;

  13070 17 000602   000000 470400 xsym               LDP0    VM_HEADER$
        17 000603   000003 235000 11                 LDA     CURRENT_TIME
        17 000604   000002 755100                    STA     2,,PR0

      551    13071    4           END;

      552    13072    3           CALL VOM$ADDENTRY_SORTED(TIME$, %NO#, TIME_HEAD$, DCBNUM(MAIL_IN));

  13072 17 000605   000000 236007 xsym               LDQ     MAIL_IN,DL
        17 000606   200016 756100                    STQ     SIZE+2,,AUTO
        17 000607   200016 631500                    EPPR1   SIZE+2,,AUTO
        17 000610   200023 451500                    STP1    SIZE+7,,AUTO
        17 000611   000007 236000 18                 LDQ     7
        17 000612   200022 756100                    STQ     SIZE+6,,AUTO
        17 000613   000044 237000 18                 LDAQ    36
        17 000614   200020 757100                    STAQ    SIZE+4,,AUTO
        17 000615   200020 630500                    EPPR0   SIZE+4,,AUTO
        17 000616   000042 631400 18                 EPPR1   34
        17 000617   000000 701000 xent               TSX1    VOM$ADDENTRY_SORTED
        17 000620   000000 011000                    NOP     0
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:65   

      553    13073    3           CALL M$CLOSE (CLOSE_MAILIN_SAVE) ALTRET(BAD_OPEN);

  13073 17 000621   000236 630400 11                 EPPR0   CLOSE_MAILIN_SAVE
        17 000622   450001 713400                    CLIMB   alt,close
        17 000623   406000 401760                    pmme    nvectors=13
        17 000624   000626 702000 17                 TSX2    BAD_OPEN

  13066 17 000625                       CONTINUE     null
      554    13074    3   CONTINUE: ;
      555    13075    3       END;                            /* End do forever */

  13075 17 000625   000540 710000 17                 TRA     s:13049

  13072 17 000626                       BAD_OPEN     null
      556    13076
      557    13077    2   BAD_OPEN:;
      558    13078
      559    13079    2       ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  13079 17 000626   000000 470400 xsym               LDP0    B$TCB$
        17 000627   000000 471500                    LDP1    0,,PR0
        17 000630   100102 236100                    LDQ     66,,PR1
        17 000631   000333 756000 11                 STQ     ERROR

      560    13080
      561    13081    2       IF ERROR.ERR# = %E$FDEOF          /* End of file directory */

  13081 17 000632   000333 236000 11                 LDQ     ERROR
        17 000633   377770 376007                    ANQ     131064,DL
        17 000634   001540 116007                    CMPQ    864,DL
        17 000635   000640 601000 17                 TNZ     s:13085

      562    13082    2       THEN
      563    13083    2           RETURN;

  13083 17 000636   200012 221300                    LDX1  ! SAVE$+2,,AUTO
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:66   
        17 000637   000001 702211                    TSX2  ! 1,X1

      564    13084
      565    13085    2       CALL M$CLOSE (CLOSE_MAILIN_SCRATCH);

  13085 17 000640   000274 630400 11                 EPPR0   CLOSE_MAILIN_SCRATCH
        17 000641   050001 713400                    CLIMB   close
        17 000642   406000 401760                    pmme    nvectors=13

      566    13086    2       GOTO CONTINUE;

  13086 17 000643   000625 710000 17                 TRA     CONTINUE

      567    13087
      568    13088
      569    13089    2   END VOM$RECOVER;
      570    13090        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:67   
      571    13091
      572    13092    1   VOM$INTERSYS_RECEIVED: PROC;

  13092 17 000644   200012 741300       VOM$INTERSY* STX1  ! SAVE$+2,,AUTO

      573    13093
      574    13094    2       OPEN_FIRST.NAME_ = VECTOR(FIRST_INTERSYS_FILE);

  13094 17 000645   000046 237000 18                 LDAQ    38
        17 000646   000150 757000 11                 STAQ    OPEN_FIRST+6

      575    13095                       /* After VOM$RECOVERY is done, OPEN_NEXT is only used below */
      576    13096    2       OPEN_NEXT.V.OPER.TEST#=%YES#;

  13096 17 000647   020000 236007                    LDQ     8192,DL
        17 000650   000114 256000 11                 ORSQ    OPEN_NEXT+36

      577    13097
      578    13098    2       CALL M$OPEN (OPEN_FIRST) ALTRET(BAD_OPEN); /* Start at :MOVE */

  13098 17 000651   000142 630400 11                 EPPR0   OPEN_FIRST
        17 000652   450000 713400                    CLIMB   alt,open
        17 000653   410400 401760                    pmme    nvectors=18
        17 000654   000771 702000 17                 TSX2    BAD_OPEN

      579    13099
      580    13100    3       DO WHILE ('1'B); /* FOREVER */;                    /* Do until no more files */

      581    13101
      582    13102    3           CALL M$OPEN (OPEN_NEXT) ALTRET(BAD_OPEN);

  13102 17 000655   000050 630400 11                 EPPR0   OPEN_NEXT
        17 000656   450000 713400                    CLIMB   alt,open
        17 000657   410400 401760                    pmme    nvectors=18
        17 000660   000771 702000 17                 TSX2    BAD_OPEN

      583    13103
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:68   
      584    13104    3           IF SUBSTR(DCBADDR(DCBNUM(MAIL_IN))->F$DCB.NAME#.C,0,5) ~= ':MOVE'

  13104 17 000661   000000 236007 xsym               LDQ     MAIL_IN,DL
        17 000662   000040 470400 18                 LDP0    32
        17 000663   000000 471500                    LDP1    0,,PR0
        17 000664   100000 473506                    LDP3    0,QL,PR1
        17 000665   040000 106500                    CMPC    fill='040'O
        17 000666   300010 200005                    ADSC9   8,,PR3                   cn=1,n=5
        17 000667   000132 000005 16                 ADSC9   MAIL_CGCTL+64            cn=0,n=5
        17 000670   000673 600000 17                 TZE     s:13107

      585    13105    3           THEN RETURN;

  13105 17 000671   200012 221300                    LDX1  ! SAVE$+2,,AUTO
        17 000672   000001 702211                    TSX2  ! 1,X1

      586    13106
      587    13107    3           RENAME_NAME = DCBADDR(DCBNUM(MAIL_IN))->F$DCB.NAME#;

  13107 17 000673   000000 236007 xsym               LDQ     MAIL_IN,DL
        17 000674   100000 473506                    LDP3    0,QL,PR1
        17 000675   000000 100500                    MLR     fill='000'O
        17 000676   300010 000040                    ADSC9   8,,PR3                   cn=0,n=32
        17 000677   000530 000040 11                 ADSC9   RENAME_NAME              cn=0,n=32

      588    13108    3           MAIL_NAME = RENAME_NAME;

  13108 17 000700   000000 100400                    MLR     fill='000'O
        17 000701   000530 000040 11                 ADSC9   RENAME_NAME              cn=0,n=32
        17 000702   000456 000040 11                 ADSC9   MAIL_NAME                cn=0,n=32

      589    13109    3           CALL M$OPEN (OPEN_MAIL) ALTRET(BAD_OPEN);

  13109 17 000703   000364 630400 11                 EPPR0   OPEN_MAIL
        17 000704   450000 713400                    CLIMB   alt,open
        17 000705   410400 401760                    pmme    nvectors=18
        17 000706   000771 702000 17                 TSX2    BAD_OPEN
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:69   

      590    13110    3           CALL INSERT(RENAME_NAME.NAME#,0,SIZEC(':MESS'),':MESS');

  13110 17 000707   040000 100400                    MLR     fill='040'O
        17 000710   000130 000005 16                 ADSC9   MAIL_CGCTL+62            cn=0,n=5
        17 000711   000530 200005 11                 ADSC9   RENAME_NAME              cn=1,n=5

      591    13111    3           CALL M$CLOSE (CLOSE_RENAME) ALTRET(BAD_OPEN);

  13111 17 000712   000472 630400 11                 EPPR0   CLOSE_RENAME
        17 000713   450001 713400                    CLIMB   alt,close
        17 000714   406000 401760                    pmme    nvectors=13
        17 000715   000771 702000 17                 TSX2    BAD_OPEN

      592    13112
      593    13113    3           MAIL_NAME = RENAME_NAME;

  13113 17 000716   000000 100400                    MLR     fill='000'O
        17 000717   000530 000040 11                 ADSC9   RENAME_NAME              cn=0,n=32
        17 000720   000456 000040 11                 ADSC9   MAIL_NAME                cn=0,n=32

      594    13114    3           CALL M$OPEN (OPEN_MAIL) ALTRET(BAD_OPEN);

  13114 17 000721   000364 630400 11                 EPPR0   OPEN_MAIL
        17 000722   450000 713400                    CLIMB   alt,open
        17 000723   410400 401760                    pmme    nvectors=18
        17 000724   000771 702000 17                 TSX2    BAD_OPEN

      595    13115    3           CALL VMD$GET_HEADER (0, DCBNUM(MAIL_IN)) ALTRET(BAD_OPEN);

  13115 17 000725   000000 236007 xsym               LDQ     MAIL_IN,DL
        17 000726   200016 756100                    STQ     SIZE+2,,AUTO
        17 000727   200016 630500                    EPPR0   SIZE+2,,AUTO
        17 000730   200021 450500                    STP0    SIZE+5,,AUTO
        17 000731   000041 236000 18                 LDQ     33
        17 000732   200020 756100                    STQ     SIZE+4,,AUTO
        17 000733   200020 630500                    EPPR0   SIZE+4,,AUTO
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:70   
        17 000734   000017 631400 18                 EPPR1   15
        17 000735   000000 701000 xent               TSX1    VMD$GET_HEADER
        17 000736   000771 702000 17                 TSX2    BAD_OPEN

      596    13116        /*
      597    13117             ***** If no delivery time was specified,
      598    13118                   then deliver as soon as possible.
      599    13119                   Therefore, this entry must be added
      600    13120                   to the time queue with the current time ...
      601    13121        */
      602    13122    3           IF VM_HEADER.DELIVERY_DATE = 0

  13122 17 000737   000000 470400 xsym               LDP0    VM_HEADER$
        17 000740   000002 235100                    LDA     2,,PR0
        17 000741   000750 601000 17                 TNZ     s:13128

      603    13123    3           THEN
      604    13124    4           DO;

      605    13125    4               CALL M$TIME (GET_CURRENT);

  13125 17 000742   000334 630400 11                 EPPR0   GET_CURRENT
        17 000743   020004 713400                    CLIMB   8196
        17 000744   402000 401760                    pmme    nvectors=5

      606    13126    4               VM_HEADER.DELIVERY_DATE = CURRENT_TIME;

  13126 17 000745   000000 470400 xsym               LDP0    VM_HEADER$
        17 000746   000003 235000 11                 LDA     CURRENT_TIME
        17 000747   000002 755100                    STA     2,,PR0

      607    13127    4           END;

      608    13128    3           CALL VOM$ADDENTRY_SORTED(TIME$, %NO#, TIME_HEAD$, DCBNUM(MAIL_IN));

  13128 17 000750   000000 236007 xsym               LDQ     MAIL_IN,DL
        17 000751   200016 756100                    STQ     SIZE+2,,AUTO
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:71   
        17 000752   200016 631500                    EPPR1   SIZE+2,,AUTO
        17 000753   200023 451500                    STP1    SIZE+7,,AUTO
        17 000754   000007 236000 18                 LDQ     7
        17 000755   200022 756100                    STQ     SIZE+6,,AUTO
        17 000756   000044 237000 18                 LDAQ    36
        17 000757   200020 757100                    STAQ    SIZE+4,,AUTO
        17 000760   200020 630500                    EPPR0   SIZE+4,,AUTO
        17 000761   000042 631400 18                 EPPR1   34
        17 000762   000000 701000 xent               TSX1    VOM$ADDENTRY_SORTED
        17 000763   000000 011000                    NOP     0

      609    13129    3           CALL M$CLOSE (CLOSE_MAILIN_SAVE) ALTRET(WHO_CARES);

  13129 17 000764   000236 630400 11                 EPPR0   CLOSE_MAILIN_SAVE
        17 000765   450001 713400                    CLIMB   alt,close
        17 000766   406000 401760                    pmme    nvectors=13
        17 000767   001007 702000 17                 TSX2    WHO_CARES

  13122 17 000770                       CONTINUE     null
      610    13130    3   CONTINUE: ;
      611    13131    3       END;

  13131 17 000770   000655 710000 17                 TRA     s:13102

  13128 17 000771                       BAD_OPEN     null
      612    13132
      613    13133    2   BAD_OPEN: ;
      614    13134
      615    13135    2       ERROR = B$TCB.ALT$ ->B$ALT.ERR;

  13135 17 000771   000000 470400 xsym               LDP0    B$TCB$
        17 000772   000000 471500                    LDP1    0,,PR0
        17 000773   100102 236100                    LDQ     66,,PR1
        17 000774   000333 756000 11                 STQ     ERROR

      616    13136
      617    13137    2       IF ERROR.ERR# = %E$FDEOF
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:72   

  13137 17 000775   000333 236000 11                 LDQ     ERROR
        17 000776   377770 376007                    ANQ     131064,DL
        17 000777   001540 116007                    CMPQ    864,DL
        17 001000   001003 601000 17                 TNZ     s:13141

      618    13138    2       THEN
      619    13139    2           RETURN;

  13139 17 001001   200012 221300                    LDX1  ! SAVE$+2,,AUTO
        17 001002   000001 702211                    TSX2  ! 1,X1

      620    13140
      621    13141    2       CALL M$CLOSE (CLOSE_MAILIN_SAVE) ALTRET (WHO_CARES);

  13141 17 001003   000236 630400 11                 EPPR0   CLOSE_MAILIN_SAVE
        17 001004   450001 713400                    CLIMB   alt,close
        17 001005   406000 401760                    pmme    nvectors=13
        17 001006   001007 702000 17                 TSX2    WHO_CARES

  13137 17 001007                       WHO_CARES    null
      622    13142    2   WHO_CARES: ;
      623    13143    2       GOTO CONTINUE;

  13143 17 001007   000770 710000 17                 TRA     CONTINUE

      624    13144    2   END VOM$INTERSYS_RECEIVED;
      625    13145        %EJECT;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:73   
      626    13146    1   VOM$SHRINK_SEGMENT: PROC (VECT_);

  13146 17 001010   200012 741300       VOM$SHRINK_* STX1  ! SAVE$+2,,AUTO

      627    13147        /*
      628    13148          ***** Release excess segment space before we go to sleep
      629    13149        */
      630    13150    2   DCL VECT_ VECTOR PARAM;
      631    13151    2   DCL SIZE UBIN;
      632    13152
      633    13153    2       IF VBOUND (VECT_) > 4093

  13153 17 001011   200013 470500                    LDP0    @VECT_,,AUTO
        17 001012   000000 236100                    LDQ     0,,PR0
        17 001013   000043 376000 18                 ANQ     35
        17 001014   000050 116000 18                 CMPQ    40
        17 001015   001033 602000 17                 TNC     s:13159

      634    13154    3       THEN DO;

      635    13155    3           SIZE = (VBOUND (VECT_) - 4093) / 4;

  13155 17 001016   000000 236100                    LDQ     0,,PR0
        17 001017   000020 772000                    QRL     16
        17 001020   007775 136007                    SBLQ    4093,DL
        17 001021   000004 506007                    DIV     4,DL
        17 001022   200014 756100                    STQ     SIZE,,AUTO

      636    13156    3           CALL VMA$SHRINK_SEGMENT (VECT_, SIZE);

  13156 17 001023   200014 631500                    EPPR1   SIZE,,AUTO
        17 001024   200017 451500                    STP1    SIZE+3,,AUTO
        17 001025   200013 236100                    LDQ     @VECT_,,AUTO
        17 001026   200016 756100                    STQ     SIZE+2,,AUTO
        17 001027   200016 630500                    EPPR0   SIZE+2,,AUTO
        17 001030   000017 631400 18                 EPPR1   15
        17 001031   000000 701000 xent               TSX1    VMA$SHRINK_SEGMENT
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:74   
        17 001032   000000 011000                    NOP     0

      637    13157    3       END;

      638    13158
      639    13159    2       RETURN;

  13159 17 001033   200012 221300                    LDX1  ! SAVE$+2,,AUTO
        17 001034   000001 702211                    TSX2  ! 1,X1

      640    13160
      641    13161    2   END VOM$SHRINK_SEGMENT;
      642    13162
      643    13163    1   END VOM$MAILMAN;

  13163 17 001035   000000 702200 xent               TSX2  ! X66_MARET

FREE$
 Sect OctLoc
  11     012   000000 006014                                                    ....

VM_BODYKEY
 Sect OctLoc
  11     015   007060 000000   000000 000000                                    .0......

VOM_INIT_CCTIME
 Sect OctLoc
  11     017   040040 040040   040040 040040   040040 ******                              ..

VO_NEED_READ
 Sect OctLoc
  11     022   0***** ******                                                    ....

VO_PROCESS
 Sect OctLoc
  11     023   0***** ******                                                    ....

PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:75   
SET_XCON
 Sect OctLoc
  11     024   000001 777640   000030 006000   000000 177640   000000 006014    ................
  11     030   000000 000000   000000 000000                                    ........

WAIT_IT_OUT
 Sect OctLoc
  11     032   000001 777640   000036 006000   000000 177640   000000 006014    ................
  11     036   000040 223200   000000 000001                                    . ......

GET_TIME_ENTRY
 Sect OctLoc
  11     040   000001 777640   000044 006000   000001 777640   000046 006000    .....$.......&..
  11     044   000600 000021   ****** ******                                    ........

TIME_VECTOR
 Sect OctLoc
  11     046   000000 177640   000000 006014                                    ........

OPEN_NEXT
 Sect OctLoc
  11     050   000025 777640   000114 006000   000000 177640   000000 006014    .....L..........
  11     054   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11     114*  000000 004042   000000 001000   252525 000000   000040 252520    ..."......... ..
  11     120   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
  11     124   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11     130   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
  11     134   040040 040040   000000 000000   000000 000000   000000 000000        ............
  11     140   000000 000000   ****** ******                                    ........

OPEN_FIRST
 Sect OctLoc
  11     142   000025 777640   000206 006000   000000 177640   000000 006014    ................
  11     146   000000 177640   000000 006014   000001 377640   000234 006000    ................
  11     152   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11     166*  000001 777640   000000 006000   000000 177640   000000 006014    ................
  11     172   000000 177640   000000 006014   000000 177640   000000 006014    ................
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:76   
  11     206*  000000 100042   000000 000001   252525 000000   000040 252520    ..@"......... ..
  11     212   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
  11     216   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11     222   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
  11     226   040040 040040   000000 000000   000000 000000   000000 000000        ............
  11     232   000000 000000   ****** ******                                    ........

FIRST_NAME
 Sect OctLoc
  11     234   005072 115105   123123 ******                                    .:MESS..

CLOSE_MAILIN_SAVE
 Sect OctLoc
  11     236   000003 777640   000270 006000   000000 177640   000000 006014    ................
  11     242   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11     266*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
  11     272   000220 000000   000000 000000                                    ........

CLOSE_MAILIN_SCRATCH
 Sect OctLoc
  11     274   000003 777640   000326 006000   000000 177640   000000 006014    ................
  11     300   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11     324*  000000 177640   000000 006014   000000 000001   000000 000040    ...............
  11     330   000220 000000   000000 000000                                    ........

MYERROR
 Sect OctLoc
  11     332   261715 000000                                                    ....

ERROR
 Sect OctLoc
  11     333   000000 000000                                                    ....

GET_CURRENT
 Sect OctLoc
  11     334   000001 777640   000346 006000   000000 177640   000000 006014    ................
  11     340   000000 177640   000000 006014   000000 177640   000000 006014    ................
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:77   
  11     344   000000 777640   000003 006000   000004 000000   ****** ******    ................

WRITE_MAILCG
 Sect OctLoc
  11     350   000003 777640   000360 006000   000000 177640   000000 006014    ................
  11     354   000043 777640   000000 006000   000007 777640   000542 006000    .#..............
  11     360   000000 400400   000000 000000   000000 000000   000000 000000    ................

OPEN_MAIL
 Sect OctLoc
  11     364   000025 777640   000430 006000   000000 177640   000000 006014    ................
  11     370   000000 177640   000000 006014   000007 777640   000456 006000    ................
  11     374   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11     410*  000001 777640   000000 006000   000000 177640   000000 006014    ................
  11     414   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11     430*  000000 000042   000000 001001   252525 002002   000040 252520    ..."......... ..
  11     434   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
  11     440   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11     444   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
  11     450   040040 040040   000000 000000   000000 000000   000000 000000        ............
  11     454   000000 000000   ****** ******                                    ........

MAIL_NAME
 Sect OctLoc
  11     456   030040 040040   040040 040040   040040 040040   040040 040040    .
  11     462   040040 040040   040040 040040   040040 040040   040040 040040

FPT_EVENT
 Sect OctLoc
  11     466   000001 777640   000470 006000   000000 000000   000000 000000    ................

CLOSE_RENAME
 Sect OctLoc
  11     472   000003 777640   000524 006000   000000 177640   000000 006014    ................
  11     476   000000 177640   000000 006014   000007 777640   000530 006000    ................
  11     502   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11     522*  000000 177640   000000 006014   000000 400000   000000 000040    ...............
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:78   
  11     526   000220 000000   000000 000000                                    ........

RENAME_NAME
 Sect OctLoc
  11     530   037040 040040   040040 040040   040040 040040   040040 040040    .
  11     534   040040 040040   040040 040040   040040 040040   040040 040040

FIRST_INTERSYS_FILE
 Sect OctLoc
  11     540   005072 115117   126105 ******                                    .:MOVE..

OUTSTATION
 Sect OctLoc
  11     542   040040 040040   040040 040040   040040 040040   040040 040040
  11     546   001000 000000   000000 000000   000000 000000   000000 000000    ................

CLOSE_COMGROUP
 Sect OctLoc
  11     552   000003 777640   000604 006000   000000 177640   000000 006014    ................
  11     556   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11     602*  000000 177640   000000 006014   000000 000000   000000 000040    ...............
  11     606   000220 000000   000000 000000                                    ........

SET_FMSEC
 Sect OctLoc
  11     610   000001 777640   000612 006000   100000 000000   000000 000000    ........@.......

TRUNC_BUFF
 Sect OctLoc
  11     614   000001 777640   000616 006000   000000 000000   000000 000000    ................

TESTMODE
 Sect OctLoc
  11     620   0***** ******                                                    ....

OPEN_COMGROUP
 Sect OctLoc
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:79   
  11     622   000025 777640   000666 006000   000000 177640   000000 006014    ................
  11     626   000013 777640   000016 006000   000001 777640   000000 006000    ................
  11     632   000000 177640   000000 006014   000003 777640   000714 006000    ................
  11     636   000017 777640   000720 006000   000000 177640   000000 006014    ................
  11     642   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11     646   000001 777640   000000 006000   000000 177640   000000 006014    ................
  11     652   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11     666*  000000 000712   000000 003004   252525 000000   000040 252520    ............. ..
  11     672   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
  11     676   000000 000000   000000 000036   000000 000000   000000 000000    ................
  11     702   251000 622000   000000 000000   000000 000000   111310 000000    ............I...
  11     706   040040 040040   000000 000000   000000 000000   000000 000000        ............
  11     712   000000 000000   ****** ******                                    ........

MAILCG_ACCESS
 Sect OctLoc
  11     714   000000 000003   012000 040040   040040 040040   040040 ******    ......        ..

MAILCG_ACSVEH
 Sect OctLoc
  11     720   000000 000017   740000 004123   105116 104740   000011 123105    .......SEND...SE
  11     724   116104 137124   105123 124740   000004 115101   111114 740000    ND_TEST...MAIL..
  11     730   011115 101111   114137 124105   123124 740000   011115 101111    .MAIL_TEST...MAI
  11     734   114137 124105   123124 740000   007115 101111   114115 101116    L_TEST...MAILMAN

MAILCG_CGCP
 Sect OctLoc
  11     740   040040 040040   040040 040040   040040 040040   040040 040040
  11     744   000003 001001   000046 113177   000012 116735   000000 000620    .....&K...N.....
  11     750   000024 062000   600026 000214   000000 000000   000012 000024    ..2.............
  11     754   000002 ******   000000 000000   000000 000000   000000 000000    ................
  11     760   000000 000000   000000 000000   000000 000000   000000 000000    ................

VO_READ_CG
 Sect OctLoc
  16     000   000005 777640   000010 006000   000000 177640   000000 006014    ................
  16     004   000043 777640   000000 006000   000000 177640   000000 006014    .#..............
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:80   
  16     010   000000 000000   000000 000001   000000 000000   000000 000000    ................
  16     014   000000 000000   000000 000000                                    ........

MAILMAN_STATION
 Sect OctLoc
  16     016   115101 111114   115101 116040   040040 040040   040040 040040    MAILMAN
  16     022   040040 040040   040040 040040   000000 000000   040040 040040            ....
  16     026   040040 040040   040040 040040   040040 040040   000000 000000                ....

MAIL_CGCTL
 Sect OctLoc
  16     032   000013 777640   000102 006000   000000 177640   000000 006014    .....B..........
  16     036   000000 177640   000000 006014   000023 777640   000740 006000    ................
  16     042   000000 177640   000000 006014   000000 177640   000000 006014    ................
  16     102*  000000 000022   000000 000000   000000 0000**   000000 000000    ................
  16     106   000000 000000   000000 000000   000000 000000   000000 000000    ................
  16     112   000000 000000   000000 000000   000000 000000   ****** ******    ................

(unnamed)
 Sect OctLoc
  16     116   115101 111114   115101 116040   040151 156151   164151 141154    MAILMAN  initial
  16     122   151172 151156   147040 040040   040040 040040   040151 144154    izing        idl
  16     126   145040 040040   052111 101115   072115 105123   123040 040040    e   *IAM:MESS
  16     132   072115 117126   105040 040040                                    :MOVE

(unnamed)
 Sect OctLoc
  18     000   040040 040040   000001 000000   000007 006000   000000 006014        ............
  18     004   000003 000000   000003 006000   000000 006000   000000 006000    ................
  18     010   000000 000000   000000 006000   000000 006000   000000 006000    ................
  18     014   000000 006000   000000 006000   000000 006000   000002 000000    ................
  18     020   000000 006000   000000 002000   000000 006000   000021 006000    ................
  18     024   000000 006000   000021 006000   000000 006000   000021 006000    ................
  18     040*  000000 006003   000010 006000   000004 000000   777777 600000    ................
  18     044   000000 006000   000010 006000   000001 377640   000540 006000    ................
  18     050   001777 400000                                                    ....
      644    13164        %EOD;
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:81   

PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:82   
--  Include file information  --

   XUD_UTS_M.:LIB_E05  is referenced.
   B$JIT_C.:LIB_E05  is referenced.
   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
   VM_PERR_C.:VMB6TOU  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   VO_SUBS_C.:VMB6TOU  is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VOM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   B_SEGIDS_C.:LIB_E05  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
      No diagnostics issued in procedure VOM$MAILMAN.
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:83   

 **** Variables and constants ****

  ****  Section 011  Data  VOM$MAILMAN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     7-0-0/c UBIN(6)     r     1 BIT6(0:11)                 4-0-0/c UBIN(9)     r     1 BIT9(0:11)
   552-0-0/d STRC(1080)  r     1 CLOSE_COMGROUP           236-0-0/d STRC(1080)  r     1 CLOSE_MAILIN_SAVE
   274-0-0/d STRC(1080)  r     1 CLOSE_MAILIN_SCRATCH     472-0-0/d STRC(1080)  r     1 CLOSE_RENAME
     3-0-0/w UBIN        r     1 CURRENT_TIME               4-0-0/c CHAR(12)    r     1 EPASS
   333-0-0/w STRC        r     1 ERROR                    540-0-0/c STRC(54)    r     1 FIRST_INTERSYS_FILE
   234-0-0/c STRC(54)    r     1 FIRST_NAME               466-0-0/d STRC(144)   r     1 FPT_EVENT
    12-0-0/w PTR         r     1 FREE$                    334-0-0/d STRC(432)   r     1 GET_CURRENT
    40-0-0/d STRC(216)   r     1 GET_TIME_ENTRY             0-0-0/w SBIN        r     1 I
     1-0-0/w SBIN              1 J                          2-0-0/w SBIN              1 K
    11-0-0/w PTR               1 LAST$                    714-0-0/w STRC(126)   r     1 MAILCG_ACCESS
   720-0-0/w STRC(576)   r     1 MAILCG_ACSVEH            740-0-0/d STRC(720)   r     1 MAILCG_CGCP
   456-0-0/c STRC(288)   r     1 MAIL_NAME                 13-0-0/w PTR         r     1 MAX$
   332-0-0/w STRC              1 MYERROR                  622-0-0/d STRC(2088)  r     1 OPEN_COMGROUP
   142-0-0/d STRC(2088)  r     1 OPEN_FIRST               364-0-0/d STRC(2088)  r     1 OPEN_MAIL
    50-0-0/d STRC(2088)  r     1 OPEN_NEXT                542-0-0/w STRC(288)   r     1 OUTSTATION
     7-0-0/c CHAR(8)     r     1 PASSWORD                 530-0-0/c STRC(288)   r     1 RENAME_NAME
    14-0-0/w PTR         r     1 SEG$                     610-0-0/d STRC(144)   r     1 SET_FMSEC
    24-0-0/d STRC(216)   r     1 SET_XCON                 620-0-0/b BIT         r     1 TESTMODE
    46-0-0/d STRC(72)    r     1 TIME_VECTOR              614-0-0/d STRC(144)   r     1 TRUNC_BUFF
    15-0-0/c STRC(72)          1 VM_BODYKEY                17-0-0/c CHAR(10)    r     1 VOM_INIT_CCTIME
    22-0-0/b BIT         r     1 VO_NEED_READ              23-0-0/b BIT         r     1 VO_PROCESS
    32-0-0/d STRC(216)   r     1 WAIT_IT_OUT              350-0-0/d STRC(432)   r     1 WRITE_MAILCG

  ****  Section 016 RoData VOM$MAILMAN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    16-0-0/w STRC(432)   r     1 MAILMAN_STATION           32-0-0/d STRC(1872)  r     1 MAIL_CGCTL
     0-0-0/d STRC(504)   r     1 VO_READ_CG
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:84   

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    13-0-0/w PTR         r     1 @VECT_                     4-0-0/c CHAR(8)     r     1 KEY_VALUE
    10-0-0/w PTR               1 SAVE$                      6-0-0/c CHAR(8)           1 SITENAME
    14-0-0/w UBIN        r     1 SIZE                      13-0-0/w PTR               1 TIME_NEW$
     3-0-0/w SBIN              1 TYPE                      *0-0-0/d VECT        r     1 VECT_

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$TCB$
     0-0-0/c ASTR(9)     r     1 B_VERSION                  0-0-0/c ASTR(9)     r     1 ERRMSG_FID
     0-0-0/w PTR         r     1 INTERSYS$                  0-0-0/w PTR         r     1 INTERSYS_HEAD$
     0-0-0/w UBIN              1 M$DO_NUM                   0-0-0/w UBIN              1 M$LO_NUM
     0-0-0/w UBIN              1 M$MAIL_CENTRAL_NUM         0-0-0/w UBIN              1 M$MAIL_COMGROUP_NUM
     0-0-0/w UBIN              1 M$MAIL_FILE_NUM            0-0-0/w UBIN        r     1 M$MAIL_GLOBAL_NUM
     0-0-0/w UBIN              1 M$ME_NUM                   0-0-0/w UBIN        r     1 M$NODE_NUM
     0-0-0/w UBIN              1 M$SI_NUM                   0-0-0/w UBIN              1 M$WORK_NUM
     0-0-0/c CHAR(8)           1 STATION#                   0-0-0/w PTR         r     1 TIME$
     0-0-0/w PTR         r     1 TIME_HEAD$                 0-0-0/w PTR               1 VM_ADDLIST$
     0-0-0/d VECT        r     1 VM_ADDLIST_                0-0-0/w PTR               1 VM_ADDREC$
     0-0-0/d VECT        r     1 VM_ADDREC_                 0-0-0/c STRC(1296)  r     1 VM_CGBUFFER
     0-0-0/w PTR               1 VM_COPY$                   0-0-0/d VECT        r     1 VM_COPY_
     0-0-0/w PTR               1 VM_ENCLLIST$               0-0-0/d VECT              1 VM_ENCLLIST_
     0-0-0/w PTR               1 VM_ENCLREC$                0-0-0/d VECT              1 VM_ENCLREC_
     0-0-0/c STRC(270)         1 VM_FORWARD_ENCL_NAME       0-0-0/c STRC(270)         1 VM_FORWARD_FILE_NAME
     0-0-0/c STRC(72)          1 VM_FORWARD_FILE_PASS       0-0-0/w PTR         r     1 VM_HEADER$
     0-0-0/d VECT        r     1 VM_HEADER_                 0-0-0/d VECT              1 VM_HEADER_INIT_
     0-0-0/w PTR         r     1 VM_INPUT$                  0-0-0/d VECT        r     1 VM_INPUT_
     0-0-0/c STRC(72)    r     1 VM_MAILCG_NAME             0-0-0/w STRC(432)         1 VM_MAILCG_SETSTA
     0-0-0/c STRC(72)    r     1 VM_MAIL_ACCT               0-0-0/c STRC(54)          1 VM_NAME_MAP_NAME
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:85   
     0-0-0/w PTR               1 VM_PARSEAREA$              0-0-0/d VECT              1 VM_PARSEAREA_
     0-0-0/w PTR         r     1 VM_PROFILE$                0-0-0/d VECT        r     1 VM_PROFILE_
     0-0-0/w PTR               1 VM_SELECT$                 0-0-0/d VECT              1 VM_SELECT_
     0-0-0/c STRC(288)         1 VM_SEND_FILE_NAME          0-0-0/c CHAR(8)     r     1 VM_SITENAME
     0-0-0/w PTR               1 VM_WORK$                   0-0-0/d VECT        r     1 VM_WORK_
     0-0-0/w STRC(2880)        1 VO_BNWIO
     0-0-0/w UBIN              1 VO_BUSY_RETRY_MINUTES
     0-0-0/w UBIN              1 VO_HOG_LIMIT               0-0-0/c CHAR(8)           1 VO_INTERSYS_ACCT
     0-0-0/b BIT         r     1 VO_INTERSYS_ALLOWED        0-0-0/c CHAR(12)    r     1 VO_INTERSYS_EPASS
     0-0-0/c CHAR(8)     r     1 VO_INTERSYS_PASSWORD       0-0-0/c CHAR(8)           1 VO_INTERSYS_UNAME
     0-0-0/w UBIN        r     1 VO_MAILMAN_STARTUP_TIME
     0-0-0/w UBIN              1 VO_MAX_HOLD_HOURS
     0-0-0/w UBIN              1 VO_PACKSET_RETRY_MINUTES
     0-0-0/w UBIN              1 VO_RETRY_LIMIT_INTERSYSTEM

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/w STRC(144)         1 B$CGAURD
     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/w STRC(540)         1 INTERSYS_INFO
     0-0-0N  NULL        r     1 M$DO                       0-0-0N  NULL        r     1 M$LM
     0-0-0N  NULL        r     1 M$LO                       0-0-0N  NULL        r     1 M$MAIL_CENTRAL
     0-0-0N  NULL        r     1 M$MAIL_COMGROUP            0-0-0N  NULL        r     1 M$MAIL_FILE
     0-0-0N  NULL        r     1 M$MAIL_GLOBAL              0-0-0N  NULL        r     1 M$ME
     0-0-0N  NULL        r     1 M$NODE                     0-0-0N  NULL        r     1 M$SI
     0-0-0N  NULL        r     1 M$UC                       0-0-0N  NULL        r     1 M$WORK
     0-0-0N  NULL        r     1 MAIL_IN                    0-0-0N  NULL        r     1 MAP_FILE
     0-0-0N  NULL        r     1 SITE_IN                    0-0-0/w STRC(612)   r     1 TIME_TABLE
     0-0-0/w STRC(1332)  r     1 VM_HEADER                  0-0-0/w STRC(4068)        1 VM_PROFILE
     0-0-0/c ASTR(9)     r     1 X$STRING


   Procedure VOM$MAILMAN requires 542 words for executable code.
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:86   
   Procedure VOM$MAILMAN requires 20 words of local(AUTO) storage.
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:87   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:88   
          MINI XREF LISTING

ASZ$SCRAMBLE
     11014**DCL-ENT 12456--CALL
B$ALT.CODE
     11022**DCL     11022--REDEF   11023--REDEF   11023--REDEF
B$ALT.ERR
     11023**DCL     13079>>ASSIGN  13135>>ASSIGN
B$ALT.ERR.ERR#
     11024**DCL     11024--REDEF
B$ALT.EVID
     11023**DCL     11023--REDEF   11023--REDEF
B$CGAURD.STATION
     11094**DCL     11094--REDEF
B$JIT.CCARS
     10712**DCL     12450<<ASSIGN  12523<<ASSIGN
B$JIT.CCBUF
     10712**DCL     12441>>ASSIGN  12448<<CALLBLT 12449>>CALLBLT 12521<<CALLBLT 12522>>CALLBLT
B$JIT.CPFLAGS1.SLEAZE
     10718**DCL     10718--REDEF
B$JIT.ERR.MID
     10625**DCL     10625--REDEF
B$JIT.JOBNAME
     10773**DCL     12451<<ASSIGN  12524<<ASSIGN
B$JIT.JRESPEAK
     10786**DCL     10787--REDEF
B$JIT.MODE
     10619**DCL     12434>>IF      12443>>IF
B$JIT.ORIGINATOR_PORT.FROM_CR
     10895**DCL     10895--REDEF   10896--REDEF
B$JIT.OUTPRIO
     10705**DCL     12445<<ASSIGN
B$JIT.PNR
     10799**DCL     10799--REDEF
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:89   
B$JIT.PRIV.ACTIVE.JIT
     10629**DCL     12443>>IF      12446>>IF      12519>>IF
B$JIT.TSLINE
     10893**DCL     10894--REDEF
B$JIT$
      8543**DCL     10619--IMP-PTR 12434>>IF      12441>>ASSIGN  12443>>IF      12443>>IF      12445>>ASSIGN
     12446>>IF      12448>>CALLBLT 12449>>CALLBLT 12450>>ASSIGN  12451>>ASSIGN  12519>>IF      12521>>CALLBLT
     12522>>CALLBLT 12523>>ASSIGN  12524>>ASSIGN
B$TCB.ALT$
     11017**DCL     13079>>ASSIGN  13135>>ASSIGN
B$TCB$
      8544**DCL     11017--IMP-PTR 13079>>ASSIGN  13135>>ASSIGN
BAD_OPEN IN PROCEDURE VOM$INTERSYS_RECEIVED
     13128**LABEL   13098--CALLALT 13102--CALLALT 13109--CALLALT 13111--CALLALT 13114--CALLALT 13115--CALLALT
BAD_OPEN IN PROCEDURE VOM$RECOVER
     13072**LABEL   13045--CALLALT 13049--CALLALT 13055--CALLALT 13059--CALLALT 13073--CALLALT
BIT6
     10992**DCL     12458>>ASSIGN
BIT9
     10990**DCL     12458<<ASSIGN
B_VERSION.C
     11413**DCL     12448>>CALLBLT 12521>>CALLBLT
B_VERSION.L
     11412**DCL     11413--IMP-SIZ 12448>>CALLBLT 12521>>CALLBLT
CANT_OPEN_MAILCG IN PROCEDURE VOM$_OPENS
     12958**LABEL   12952--CALLALT 12953--CALLALT
CLOSE_COMGROUP.SN_
     12376**DCL     12376--REDEF
CLOSE_COMGROUP.UTL_
     12377**DCL     12377--REDEF
CLOSE_COMGROUP.V
     12381**DCL     12376--DCLINIT
CLOSE_COMGROUP.V.EXPIRE#
     12391**DCL     12391--REDEF
CLOSE_COMGROUP.V.TYPE#
     12389**DCL     12389--REDEF
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:90   
CLOSE_COMGROUP.V.XTNSIZE#
     12386**DCL     12386--REDEF   12388--REDEF
CLOSE_MAILIN_SAVE
     11843**DCL     13055<>CALL    13073<>CALL    13129<>CALL    13141<>CALL
CLOSE_MAILIN_SAVE.SN_
     11843**DCL     11843--REDEF
CLOSE_MAILIN_SAVE.UTL_
     11844**DCL     11844--REDEF
CLOSE_MAILIN_SAVE.V
     11848**DCL     11843--DCLINIT
CLOSE_MAILIN_SAVE.V.EXPIRE#
     11858**DCL     11858--REDEF
CLOSE_MAILIN_SAVE.V.TYPE#
     11856**DCL     11856--REDEF
CLOSE_MAILIN_SAVE.V.XTNSIZE#
     11853**DCL     11853--REDEF   11855--REDEF
CLOSE_MAILIN_SCRATCH
     11889**DCL     13085<>CALL
CLOSE_MAILIN_SCRATCH.SN_
     11889**DCL     11889--REDEF
CLOSE_MAILIN_SCRATCH.UTL_
     11890**DCL     11890--REDEF
CLOSE_MAILIN_SCRATCH.V
     11894**DCL     11889--DCLINIT
CLOSE_MAILIN_SCRATCH.V.EXPIRE#
     11904**DCL     11904--REDEF
CLOSE_MAILIN_SCRATCH.V.TYPE#
     11902**DCL     11902--REDEF
CLOSE_MAILIN_SCRATCH.V.XTNSIZE#
     11899**DCL     11899--REDEF   11901--REDEF
CLOSE_RENAME
     12247**DCL     13111<>CALL
CLOSE_RENAME.SN_
     12247**DCL     12247--REDEF
CLOSE_RENAME.UTL_
     12248**DCL     12248--REDEF
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:91   
CLOSE_RENAME.V
     12252**DCL     12247--DCLINIT
CLOSE_RENAME.V.EXPIRE#
     12262**DCL     12262--REDEF
CLOSE_RENAME.V.TYPE#
     12260**DCL     12260--REDEF
CLOSE_RENAME.V.XTNSIZE#
     12257**DCL     12257--REDEF   12259--REDEF
CONTINUE IN PROCEDURE VOM$INTERSYS_RECEIVED
     13122**LABEL   13143--GOTO
CONTINUE IN PROCEDURE VOM$RECOVER
     13066**LABEL   13086--GOTO
CURRENT_TIME
     10988**DCL     12021--DCLINIT 12471>>ASSIGN  12482<>CALL    13070>>ASSIGN  13126>>ASSIGN
EPASS
     10989**DCL     10990--REDEF   12460>>ASSIGN
ERRMSG_FID.L#
      8612**DCL      8612--IMP-SIZ
ERROR
     11969**DCL     13079<<ASSIGN  13135<<ASSIGN
ERROR.ERR#
     11999**DCL     13081>>IF      13137>>IF
E_ENLARGE IN PROCEDURE VOM$_GETBUFS
     13037**LABEL   13014--CALLALT 13015--CALLALT 13016--CALLALT 13017--CALLALT 13018--CALLALT 13019--CALLALT
     13021--CALLALT 13023--CALLALT
F$DCB.ACTPOS
      9978**DCL      9978--REDEF
F$DCB.ARS#
      9952**DCL      9952--REDEF
F$DCB.ATTR
      9971**DCL      9972--REDEF
F$DCB.BORROW
      9986**DCL      9986--REDEF    9986--REDEF    9986--REDEF
F$DCB.DCBNAME.L
     10000**DCL     10000--IMP-SIZ
F$DCB.EOMCHAR#
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:92   
      9956**DCL      9956--REDEF
F$DCB.FLDID
      9981**DCL      9981--REDEF
F$DCB.FORM$
      9975**DCL      9975--REDEF
F$DCB.FSECT
      9991**DCL      9991--REDEF
F$DCB.FSN#
      9968**DCL      9968--REDEF    9968--REDEF    9969--REDEF
F$DCB.HEADER$
      9974**DCL      9974--REDEF
F$DCB.IXTNSIZE#
      9972**DCL      9972--REDEF
F$DCB.LASTSTA$
      9961**DCL      9961--REDEF
F$DCB.LVL
      9987**DCL      9987--REDEF
F$DCB.NAME#
      9962**DCL     13107>>ASSIGN
F$DCB.NAME#.C
      9962**DCL      9962--REDEF   13051>>IF      13104>>IF
F$DCB.NOEOF
      9984**DCL      9984--REDEF
F$DCB.NRECS#
      9973**DCL      9973--REDEF
F$DCB.NRECX
      9992**DCL      9992--REDEF
F$DCB.OHDR
      9984**DCL      9984--REDEF
F$DCB.ORG#
      9967**DCL      9967--REDEF
F$DCB.PRECNO
      9990**DCL      9990--REDEF
F$DCB.RCSZ
      9996**DCL      9996--REDEF
F$DCB.RES#
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:93   
      9963**DCL      9963--REDEF
F$DCB.SETX
      9975**DCL      9975--REDEF
F$DCB.TAB$
      9975**DCL      9975--REDEF
F$DCB.TDA
      9989**DCL      9990--REDEF
F$DCB.WSN#
      9963**DCL      9963--REDEF
FIRST_INTERSYS_FILE
     12321**DCL     13094--ASSIGN
FIRST_NAME
     11813**DCL     11743--DCLINIT
FPT_EVENT
     12217**DCL     12466<>CALL
FPT_EVENT.V
     12217**DCL     12217--DCLINIT
FREE$
     10996**DCL     13027<<ASSIGN
GET_CURRENT
     12017**DCL     12469<>CALL    12477<>CALL    13069<>CALL    13125<>CALL
GET_CURRENT.V
     12021**DCL     12017--DCLINIT
GET_TIME_ENTRY.V
     11537**DCL     11537--DCLINIT
I
     10985**DCL     12449<<CALLBLT 12450>>ASSIGN  12457<<DOINDEX 12458>>ASSIGN  12458>>ASSIGN  12482<>CALL
     12483<<ASSIGN  12483>>ASSIGN  12486<<ASSIGN  12488>>IF      12515>>ASSIGN  12522<<CALLBLT 12523>>ASSIGN
INTERSYS$
      8329**DCL      8334--IMP-PTR 13028<<ASSIGN
INTERSYS_HEAD$
      8328**DCL     13029<<ASSIGN
KEY_VALUE
     11001**DCL     12958<<ASSIGN  12959<>CALL
M$CGCTL
      8161**DCL-ENT 12953--CALL
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:94   
M$CLOSE
      8140**DCL-ENT 13055--CALL    13073--CALL    13085--CALL    13111--CALL    13129--CALL    13141--CALL
M$EVENT
      8195**DCL-ENT 12466--CALL
M$LM
     11407**DCL     12513>>ASSIGN
M$MAIL_GLOBAL_NUM
      8527**DCL     12509>>ASSIGN
M$NODE_NUM
      8540**DCL     12511>>ASSIGN
M$OPEN
      8140**DCL-ENT 12952--CALL    13045--CALL    13049--CALL    13098--CALL    13102--CALL    13109--CALL
     13114--CALL
M$READ
      8141**DCL-ENT 12473--CALL    12533--CALL
M$SPRIV
      8199**DCL-ENT 12442--CALL
M$TIME
      8207**DCL-ENT 12469--CALL    12477--CALL    13069--CALL    13125--CALL
M$TRUNC
      8141**DCL-ENT 12510--CALL    12512--CALL    12514--CALL
M$WAIT
      8198**DCL-ENT 12526--CALL
M$XCON
      8195**DCL-ENT 12549--CALL
M$XXX
      8152**DCL-ENT 12436--CALL    12543--CALL    12969--CALL    13037--CALL
MAILCG_ACCESS IN PROCEDURE VOM$_OPENS
     12694**DCL     12640--DCLINIT
MAILCG_ACCESS.Q IN PROCEDURE VOM$_OPENS
     12695**DCL     12694--DCLINIT
MAILCG_ACSVEH IN PROCEDURE VOM$_OPENS
     12726**DCL     12641--DCLINIT
MAILCG_ACSVEH.Q IN PROCEDURE VOM$_OPENS
     12727**DCL     12726--DCLINIT
MAILCG_CGCP IN PROCEDURE VOM$_OPENS
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:95   
     12920**DCL     12877--DCLINIT
MAILCG_CGCP.DVBYTE.REREAD# IN PROCEDURE VOM$_OPENS
     12934**DCL     12935--REDEF
MAILMAN_STATION IN PROCEDURE VOM$_OPENS
     12845**DCL     12639--DCLINIT
MAIL_CGCTL IN PROCEDURE VOM$_OPENS
     12876**DCL     12953<>CALL
MAIL_CGCTL.V IN PROCEDURE VOM$_OPENS
     12881**DCL     12876--DCLINIT
MAIL_IN
     11403**DCL     13051--IF      13059<>CALL    13072<>CALL    13104--IF      13107--ASSIGN  13115<>CALL
     13128<>CALL
MAIL_NAME
     12203**DCL     12133--DCLINIT 13108<<ASSIGN  13113<<ASSIGN
MAX$
     10997**DCL     13030<<ASSIGN
OPEN_COMGROUP IN PROCEDURE VOM$_OPENS
     12638**DCL     12952<>CALL
OPEN_COMGROUP.ACSVEH_ IN PROCEDURE VOM$_OPENS
     12640**DCL     12641--REDEF
OPEN_COMGROUP.ALTKEYS_ IN PROCEDURE VOM$_OPENS
     12646**DCL     12647--REDEF   12647--REDEF
OPEN_COMGROUP.HDR_ IN PROCEDURE VOM$_OPENS
     12645**DCL     12646--REDEF
OPEN_COMGROUP.TAB_ IN PROCEDURE VOM$_OPENS
     12644**DCL     12645--REDEF
OPEN_COMGROUP.UHL_ IN PROCEDURE VOM$_OPENS
     12638**DCL     12639--REDEF   12639--REDEF
OPEN_COMGROUP.V IN PROCEDURE VOM$_OPENS
     12647**DCL     12638--DCLINIT
OPEN_COMGROUP.V.FSN# IN PROCEDURE VOM$_OPENS
     12678**DCL     12678--REDEF   12678--REDEF
OPEN_COMGROUP.WSN_ IN PROCEDURE VOM$_OPENS
     12644**DCL     12644--REDEF
OPEN_FIRST
     11742**DCL     13045<>CALL    13098<>CALL
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:96   
OPEN_FIRST.ACSVEH_
     11744**DCL     11745--REDEF
OPEN_FIRST.ALTKEYS_
     11750**DCL     11751--REDEF   11751--REDEF
OPEN_FIRST.HDR_
     11749**DCL     11750--REDEF
OPEN_FIRST.NAME_
     11743**DCL     13094<<ASSIGN
OPEN_FIRST.TAB_
     11748**DCL     11749--REDEF
OPEN_FIRST.UHL_
     11742**DCL     11743--REDEF   11743--REDEF
OPEN_FIRST.V
     11751**DCL     11742--DCLINIT
OPEN_FIRST.V.FSN#
     11782**DCL     11782--REDEF   11782--REDEF
OPEN_FIRST.WSN_
     11748**DCL     11748--REDEF
OPEN_MAIL
     12132**DCL     13109<>CALL    13114<>CALL
OPEN_MAIL.ACSVEH_
     12134**DCL     12135--REDEF
OPEN_MAIL.ALTKEYS_
     12140**DCL     12141--REDEF   12141--REDEF
OPEN_MAIL.HDR_
     12139**DCL     12140--REDEF
OPEN_MAIL.TAB_
     12138**DCL     12139--REDEF
OPEN_MAIL.UHL_
     12132**DCL     12133--REDEF   12133--REDEF
OPEN_MAIL.V
     12141**DCL     12132--DCLINIT
OPEN_MAIL.V.FSN#
     12172**DCL     12172--REDEF   12172--REDEF
OPEN_MAIL.WSN_
     12138**DCL     12138--REDEF
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:97   
OPEN_NEXT
     11627**DCL     13049<>CALL    13102<>CALL
OPEN_NEXT.ACSVEH_
     11629**DCL     11630--REDEF
OPEN_NEXT.ALTKEYS_
     11635**DCL     11636--REDEF   11636--REDEF
OPEN_NEXT.HDR_
     11634**DCL     11635--REDEF
OPEN_NEXT.TAB_
     11633**DCL     11634--REDEF
OPEN_NEXT.UHL_
     11627**DCL     11628--REDEF   11628--REDEF
OPEN_NEXT.V
     11636**DCL     11627--DCLINIT
OPEN_NEXT.V.FSN#
     11667**DCL     11667--REDEF   11667--REDEF
OPEN_NEXT.V.OPER.TEST#
     11638**DCL     13096<<ASSIGN
OPEN_NEXT.WSN_
     11633**DCL     11633--REDEF
OUTSTATION
     12336**DCL     12046--DCLINIT
OUTSTATION.MSGIDXT
     12346**DCL     12349--REDEF
PASSWORD
     10991**DCL     10992--REDEF   12455<<ASSIGN  12456<>CALL
RENAME_NAME
     12292**DCL     12249--DCLINIT 13107<<ASSIGN  13108>>ASSIGN  13113>>ASSIGN
RENAME_NAME.NAME#
     12292**DCL     13110<<CALLBLT
SEG$
     10998**DCL     13031<<ASSIGN  13032>>ASSIGN
SET_FMSEC
     12408**DCL     12442<>CALL
SET_FMSEC.V
     12408**DCL     12408--DCLINIT
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:98   
SET_XCON
     11501**DCL     12549<>CALL
SET_XCON.V
     11502**DCL     11501--DCLINIT
SIZE IN PROCEDURE VOM$SHRINK_SEGMENT
     13151**DCL     13155<<ASSIGN  13156<>CALL
TESTMODE
     12427**DCL     12434>>IF
TIME$
      8328**DCL      8332--IMP-PTR 13072<>CALL    13128<>CALL
TIME_HEAD$
      8328**DCL     12479>>IF      12482>>CALL    12491<>CALL    13026<<ASSIGN  13072<>CALL    13128<>CALL
TIME_TABLE
      8332**DCL     11540--DCLINIT
TIME_TABLE.NEXT$
      8332**DCL     13032<<ASSIGN
TIME_TABLE.TSTAMP
      8332**DCL     12482<>CALL
TIME_VECTOR
     11554**DCL     11537--DCLINIT
TIME_VECTOR.W2
     11555**DCL     11556--REDEF
TRUNC_BUFF
     12423**DCL     12510<>CALL    12512<>CALL    12514<>CALL
TRUNC_BUFF.V
     12423**DCL     12423--DCLINIT
TRUNC_BUFF.V.DCB#
     12423**DCL     12509<<ASSIGN  12511<<ASSIGN  12513<<ASSIGN
VECT_ IN PROCEDURE VOM$SHRINK_SEGMENT
     13150**DCL     13146--PROC    13153>>IF      13155>>ASSIGN  13156<>CALL
VMA$ENLARGE_SEGMENT
     11006**DCL-ENT 13014--CALL    13015--CALL    13016--CALL    13017--CALL    13018--CALL    13019--CALL
     13021--CALL
VMA$GET_SITE_NAME
     11011**DCL-ENT 12959--CALL
VMA$OPEN_ENCL_SEGS
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:99   
     11008**DCL-ENT 13023--CALL
VMA$SHRINK_SEGMENT
     11007**DCL-ENT 13156--CALL
VMD$GET_HEADER
     11009**DCL-ENT 13059--CALL    13115--CALL
VM_ADDLIST_
      8490**DCL     12502<>CALL    13014<>CALL
VM_ADDREC_
      8491**DCL     12503<>CALL    13015<>CALL
VM_CGBUFFER
      8222**DCL     11460--DCLINIT 11461--DCLINIT 12045--DCLINIT 12046--DCLINIT
VM_COPY_
      8496**DCL     12507<>CALL    13021<>CALL
VM_HEADER.DELIVERY_DATE
     11112**DCL     13066>>IF      13070<<ASSIGN  13122>>IF      13126<<ASSIGN
VM_HEADER$
      8462**DCL     11107--IMP-PTR 13066>>IF      13070>>ASSIGN  13122>>IF      13126>>ASSIGN
VM_HEADER_
      8487**DCL     12504<>CALL    13016<>CALL
VM_INPUT$
      8476**DCL     13030>>ASSIGN  13031>>ASSIGN
VM_INPUT_
      8495**DCL     13019<>CALL
VM_MAILCG_NAME
      8733**DCL     12639--DCLINIT
VM_MAIL_ACCT
      8558**DCL     11747--DCLINIT 12137--DCLINIT 12643--DCLINIT
VM_PROFILE$
      8464**DCL     11238--IMP-PTR
VM_PROFILE_
      8489**DCL     12505<>CALL    13017<>CALL
VM_SITENAME
      8735**DCL     12959<>CALL
VM_WORK_
      8492**DCL     12506<>CALL    13018<>CALL
VOM$ADDENTRY_SORTED
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:100  
     11418**DCL-ENT 13072--CALL    13128--CALL
VOM$DOSEND
     11003**DCL-ENT 12491--CALL
VOM$EVENT
     11416**DCL-ENT 12217--DCLINIT
VOM$INTERSYS_RECEIVED
     13092**PROC    12540--CALL
VOM$PROCESS
     11013**DCL-ENT 12536--CALL
VOM$RECOVER
     13041**PROC    12464--CALL
VOM$SHRINK_SEGMENT
     13146**PROC    12502--CALL    12503--CALL    12504--CALL    12505--CALL    12506--CALL    12507--CALL
VOM$XCON
     11415**DCL-ENT 11502--DCLINIT
VOM$_GETBUFS
     12974**PROC    12462--CALL
VOM$_OPENS
     12557**PROC    12467--CALL
VOM$_SETXCON
     12547**PROC    12453--CALL
VOM_INIT_CCTIME
     11421**DCL     12441<<ASSIGN
VO_BNWIO.CGPARM.MSGIDXT
      8277**DCL      8280--REDEF
VO_BNWIO.CODE
      8246**DCL      8246--REDEF    8247--REDEF    8247--REDEF
VO_BNWIO.ERR.ERR#
      8248**DCL      8248--REDEF
VO_BNWIO.EVID
      8247**DCL      8247--REDEF    8247--REDEF
VO_INTERSYS_ALLOWED
      8328**DCL     12538>>IF      12962<<ASSIGN
VO_INTERSYS_EPASS
      8331**DCL     12460<<ASSIGN
VO_INTERSYS_PASSWORD
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:101  
      8331**DCL     12455>>ASSIGN
VO_MAILMAN_STARTUP_TIME
      8330**DCL     12471<<ASSIGN
VO_NEED_READ
     11480**DCL     12497>>IF      12517>>IF      12531>>IF      12532<<ASSIGN
VO_PROCESS
     11481**DCL     12497>>IF      12517>>IF      12536>>IF
VO_READ_CG
     11458**DCL     12473<>CALL    12533<>CALL
VO_READ_CG.STATION_
     11461**DCL     11462--REDEF
VO_READ_CG.V
     11462**DCL     11458--DCLINIT
VO_READ_CG.V.DVBYTE.REREAD#
     11473**DCL     11473--REDEF
VO_READ_CG.V.INDX#
     11471**DCL     11471--REDEF
WAIT_IT_OUT
     11517**DCL     12526<>CALL
WAIT_IT_OUT.V
     11518**DCL     11517--DCLINIT
WAIT_IT_OUT.V.UNITS#
     11518**DCL     12515<<ASSIGN
WELL_WHAT_NOW
     12532**LABEL   12466--CALLALT 12473--CALLALT
WHO_CARES IN PROCEDURE VOM$INTERSYS_RECEIVED
     13137**LABEL   13129--CALLALT 13141--CALLALT
WRITE_MAILCG.STATION_
     12046**DCL     12046--REDEF
WRITE_MAILCG.V
     12047**DCL     12044--DCLINIT
WRITE_MAILCG.V.DVBYTE.VFC#
     12053**DCL     12053--REDEF
X$STRING.SIZ
      8458**DCL      8459--IMP-SIZ
X66_REL_AUTO
PL6.E3A0      #001=VOM$MAILMAN File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:31 Page:102  
     11005**DCL-ENT 12501--CALL
XCON0_ALT IN PROCEDURE VOM$_SETXCON
     12549**LABEL   12549--CALLALT
XUD$UTS_DIFF_SEC
     11371**DCL-ENT 12482--CALL

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:103  
      645        1        /*T***********************************************************/
      646        2        /*T*                                                         */
      647        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      648        4        /*T*                                                         */
      649        5        /*T***********************************************************/
      650        6        VOM$DOSEND: PROC(HEAD$);
      651        7        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
      652        8          %INCLUDE B$JIT;
      653      611          %INCLUDE B_ERRORS_C;
      654     1738          %INCLUDE B_SEGIDS_C;
      655     2277          %INCLUDE CP_6_SUBS;
      656     2817          %INCLUDE VOM_DATA_R;                  /* Also includes CP_6 */
      657    10037          %INCLUDE VM_DATA_R;                   /* Also includes B_MACROS_C */
      658    10468          %INCLUDE VO_SUBS_C;
      659    10519          %INCLUDE VM_PERR_C;
      660    10814          %INCLUDE VW_NODEATER_E;
      661    10870          %INCLUDE XUM_MACRO_C;
      662    10897        %INCLUDE B$TABLES_C;
      663    11005        %INCLUDE XUD_UTS_M;
      664    11087             %XUD$UTS_ENTRIES;
      665    11119             %XUD_UTS_EQU;
      666    11130          %B$XL_UPPER(NAME=LOWER_UPPER);
      667    11134        /***** Based system structures *****/
      668    11135          %B$TCB (STCLASS="BASED(B$TCB$)");
      669    11138          %B$ALT;
      670    11146          %F$DCB;
      671    11203        %FPT_READ (FPTN=VO_READ_CG, STCLASS=SYMREF);
      672    11242    1   DCL VO_NEED_READ BIT(1) SYMREF;
      673    11243    1   DCL VO_PROCESS BIT(1) SYMREF;
      674    11244        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:104  
      675    11245        /***** Mail structures *****/
      676    11246          %VM_ADDTYPES;
      677    11250          %VM_KEYTYPES;
      678    11271          %VM_BODYTYPES;
      679    11277          %VM_DELIVERYPHASES;
      680    11289          %VM_USERKEY;
      681    11305          %VM_PROFILE;
      682    11392          %VM_HEADER;
      683    11521          %VM_SITE;
      684    11545          %VM_SEARCH_INFO(STCLASS=STATIC);
      685    11572          %VM_RADDRESS;
      686    11607          %VM_RADDRESS (NAME=INIT_RADDRESS, STCLASS=CONSTANT);
      687    11642          %VM_UADDRESS;
      688    11679          %VM_RADDRESS(NAME=VM$RADDRESS,STCLASS=BASED);
      689    11714          %VM_UADDRESS(NAME=VM$UADDRESS,STCLASS=BASED);
      690    11751          %VM_RADDRESS (NAME=VM_RETURN_ADDRESS,STCLASS=STATIC);
      691    11786          %VM_DELIVERY (STCLASS=AUTO);
      692    11824          %VM_DELIVERY (NAME=INIT_DELIVERY, STCLASS=CONSTANT);
      693    11862          %VM_DELIVERYKEY (STCLASS=AUTO);
      694    11880          %VM_DELIVERYKEY (NAME=INIT_DELIVERYKEY, STCLASS=CONSTANT);
      695    11898          %VM_FOLDER_INFO;
      696    11950          %VM_BODYREC (NAME=VM_BODYREC_ENCODED, STCLASS=AUTO, ERR_FORMAT=YES);
      697    11982          %VM_BODYREC (NAME=VM$BODYREC, STCLASS=BASED, VARYLEN=YES);
      698    12014          %VM_BODYREC (NAME=INIT_ENCODED_ERR_BODYREC, STCLASS=CONSTANT,
      699    12015                       TYP=%VM_BODY_ENCODED_ERR, ERR_FORMAT=YES);
      700    12047          %VM_ADD_HEAD;
      701    12076        /***** Other variables *****/
      702    12077    1   DCL NEXT_USER$ PTR ALIGNED;
      703    12078    1   DCL ADD_TYPE SBIN WORD ALIGNED;
      704    12079    1   DCL SEND_BC BIT(1) ALIGNED;
      705    12080    1   DCL WAIT_FLAG BIT(1) ALIGNED;
      706    12081    1   DCL NEXT$ PTR;
      707    12082    1   DCL PTR2$ PTR;
      708    12083    1   DCL SAVEN$ PTR;
      709    12084    1   DCL SAVEP$ PTR;
      710    12085    1   DCL HEAD$ PTR;
      711    12086    1   DCL COUNT SBIN;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:105  
      712    12087    1   DCL X$ PTR;
      713    12088    1   DCL ADDRESS$ PTR ALIGNED;
      714    12089    1   DCL P_ERR BIT(1) ALIGNED;
      715    12090    1   DCL ERR_FLAG BIT(1) ALIGNED;
      716    12091    1   DCL MAIL_IN DCB;
      717    12092    1   DCL MAIL_OUT DCB;
      718    12093    1   DCL MAIL_FILECOPY DCB;
      719    12094    1   DCL PROCESSING BIT(1) ALIGNED;
      720    12095    1   DCL INTERSYS_ACTIVE BIT(1) ALIGNED;
      721    12096    1   DCL PTR$ PTR ALIGNED;
      722    12097    1   DCL PROCESS_ERROR SBIN WORD ALIGNED;
      723    12098    1   DCL FREE$ PTR SYMREF;
      724    12099    1   DCL MASK BIT(MASK_LEN) BASED;
      725    12100    1   DCL MASK_LEN UBIN WORD STATIC;
      726    12101    1   DCL ANSI_TIME CHAR (8) STATIC;
      727    12102    1   DCL ANSI_DATE CHAR (6) STATIC;
      728    12103    1   DCL ID CHAR (511);
      729    12104    1   DCL SITENAME CHAR (8);
      730    12105    1   DCL STATUS_STRING CHAR (256);
      731    12106    1   DCL SITE_TYPE UBIN;
      732    12107    1   DCL 1 EXTERNAL,
      733    12108    1         2 SITENAME CHAR (8),
      734    12109    1         2 ACCT CHAR (8);
      735    12110    1   DCL 1 DELIVERY,
      736    12111    1         2 L UBIN BYTE CALIGNED,
      737    12112    1         2 C CHAR (507);
      738    12113    1   DCL RETURN_ADDRESS_BUFFER (0:100) UBIN WORD;
      739    12114    1   DCL MESSAGE_NUMBER UBIN;
      740    12115    1   DCL BAD_ADDRESS_COUNT UBIN WORD;
      741    12116    1   DCL HOG_COUNT UBIN WORD;
      742    12117    1   DCL NUM_RECEIPTS UBIN WORD;
      743    12118    1   DCL DELAY_TIME UBIN WORD;
      744    12119    1   DCL UTS_X SBIN WORD;
      745    12120    1   DCL UTS_Y SBIN WORD;
      746    12121    1   DCL SCRATCH$ PTR;
      747    12122        %MACRO DELIVERY_STATUS (NAME=DELIVERY_STATUS, STCLASS=AUTO);
      748    12123        DCL 1 NAME STCLASS,          /* nonzero if mailgram not fully delivered yet */
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:106  
      749    12124              2 BUSY BIT (1),    /* mailbox file or profile busy;  try later */
      750    12125              2 PACKSET_NA BIT (1), /* packset not mounted or unavailable; try later */
      751    12126              2 IO_ERROR BIT (1), /* I/O error on mailbox; reject & report */
      752    12127              2 HOG_LIMIT BIT (1); /* this mailgram is hogging MAILMAN;  requeue */
      753    12128        %MEND;
      754    12129        %DELIVERY_STATUS (NAME=UNDELIVERED);
      755    12136        %DELIVERY_STATUS (NAME=DELIVERY_SUMMARY);
      756    12143          %VLP_NAME (FPTN=BLIND_TEXT,LEN=511,STCLASS=STATIC);
      757    12170        /***** Variablesfor intersystem address lists *****/
      758    12171    1   DCL ITO_HEAD$ PTR STATIC;               /* Ptr to head of internal to list */
      759    12172    1   DCL IBC_HEAD$ PTR STATIC;               /* Ptr to head of internal bc list */
      760    12173    1   DCL IC_HEAD$ PTR STATIC;                /* Ptr to head of internal c list */
      761    12174          %XUM$MCB (NAME=IADDLIST_MCB,STCLASS=STATIC);
      762    12178        /***** Fpts *****/
      763    12179          %XUM$MCB (NAME=HEADER_MCB,STCLASS=STATIC);
      764    12183          %FPT_CLOSE (FPTN=CLOSE_MAILIN_SAVE,
      765    12184                            STCLASS="SYMREF");
      766    12226          %FPT_CLOSE (FPTN=CLOSE_MAILIN_SCRATCH,
      767    12227                            STCLASS="SYMREF");
      768    12269        %VLP_NAME (FPTN=MAIL_NAME, STCLASS=SYMREF, LEN=31);
      769    12296          %FPT_OPEN(FPTN=OPEN_MAIL,STCLASS="SYMREF");
      770    12405          %FPT_CLOSE (FPTN=CLOSE_MAIL_OUT,DCB=MAIL_OUT,DISP=SAVE);
      771    12447          %FPT_CLOSE (FPTN=CLOSE_MAIL_OUT_RELEASE,DCB=MAIL_OUT,DISP=RELEASE);
      772    12489          %FPT_CLOSE (FPTN=RENAME_BAD_FILE,
      773    12490                      DCB=MAIL_IN,
      774    12491                      NAME=NEW_NAME);
      775    12533          %VLP_NAME  (FPTN=NEW_NAME, L=31);
      776    12560          %VLP_ERRCODE (FPTN=ERROR);
      777    12605              %VLP_ERRCODE (FPTN=E_ADDUNKNOWN, FCG="VO",MID="M",
      778    12606              ERR#=%E$ADDUNKNOWN, STCLASS=CONSTANT);
      779    12651        /*E*  ERROR:   VOM-E$ADDUNKNOWN-0
      780    12652              MESSAGE: <> is not a registered user name or a global
      781    12653                       distribution list.
      782    12654        */
      783    12655              %VLP_STATION (FPTN=OUTSTATION, STCLASS="SYMREF");
      784    12682              %FPT_WRITE(FPTN=WRITE_MAILCG,STCLASS="SYMREF",
      785    12683              BUF=VM_CGBUFFER);
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:107  
      786    12714
      787    12715          %VLP_NAME (FPTN=WORK_TEXTC,LEN=511,STCLASS=STATIC);
      788    12742
      789    12743          %FPT_TIME (FPTN=GET_CURRENT,
      790    12744                         SOURCE=CLOCK,
      791    12745                         DEST=UTS,
      792    12746                         TSTAMP=CURRENT_TIME);
      793    12765        %FPT_TIME  (FPTN=GET_ANSI_TIME,
      794    12766                    STCLASS=CONSTANT,
      795    12767                    SOURCE=UTS,
      796    12768                    DEST=ANS,
      797    12769                    TSTAMP=WORK_TIME,
      798    12770                    TIME=ANSI_TIME,
      799    12771                    DATE=ANSI_DATE);
      800    12790        %FPT_WAIT (FPTN=WAIT2, UNITS=2, STCLASS=CONSTANT);
      801    12804
      802    12805        %FPT_ENQ (FPTN=ENQ_PROFILE, STCLASS=CONSTANT,
      803    12806                  DCB=MAIL_OUT,
      804    12807                  SHARE=NONE,
      805    12808                  WAIT=YES,
      806    12809                  RNAME=VM_PRORES,
      807    12810                  WAIT_TIME=2);
      808    12828
      809    12829        %FPT_DEQ (FPTN=DEQ_PROFILE, STCLASS=CONSTANT,
      810    12830                  DCB=MAIL_OUT,
      811    12831                  RNAME=VM_PRORES);
      812    12848
      813    12849        %VM_PRORES (STCLASS=CONSTANT);
      814    12863
      815    12864        %FPT_ENQ (FPTN=ENQ_HEADER, STCLASS=CONSTANT,
      816    12865                  DCB=MAIL_OUT,
      817    12866                  SHARE=NONE,
      818    12867                  WAIT=YES,
      819    12868                  RNAME=VM_HEADRES);
      820    12886
      821    12887        %FPT_DEQ (FPTN=DEQ_HEADER, STCLASS=CONSTANT,
      822    12888                  DCB=MAIL_OUT,
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:108  
      823    12889                  RNAME=VM_HEADRES);
      824    12906
      825    12907        %VM_HEADRES (STCLASS=STATIC);
      826    12921
      827    12922        %FPT_RESCTL    (FPTN=REL_PACK,RPSN=RPSN);
      828    12939
      829    12940        %VLP_RPSN      (FPTN=RPSN,
      830    12941                            DISP=REM,
      831    12942                            N=50);
      832    12957
      833    12958          %VLP_ERRCODE (FPTN=E_INTERSYSILL,FCG="VO",MID="M",
      834    12959                      ERR#=%E$INTERSYSILL,STCLASS=CONSTANT);
      835    13004        /*E* ERROR: VOM-E$INTERSYSILL-0
      836    13005             MESSAGE:Intersystem mail is disabled; can't send to <>
      837    13006        */
      838    13007              %VLP_ERRCODE (FPTN=E_NOMID,FCG="VO",MID="M",
      839    13008              ERR#=%E$NOMID,STCLASS=CONSTANT);
      840    13053        /*E* ERROR: VOM-E$NOMID-0
      841    13054             MESSAGE:No mail folder has been created for <>
      842    13055          */
      843    13056              %VLP_ERRCODE (FPTN=E_WRONGOWNER,FCG="VO",MID="M",
      844    13057              ERR#=%E$WRONGOWNER,STCLASS=CONSTANT);
      845    13102        /*E*    ERROR: VOM-E$WRONGOWNER-0
      846    13103                MESSAGE:Specified folder does not belong to user <>.
      847    13104                        Notify your mail administrator.
      848    13105        */
      849    13106              %VLP_ERRCODE (FPTN=E_PROERR,FCG="VO",MID=M,
      850    13107              ERR#=%E$PROERR,STCLASS=CONSTANT);
      851    13152        /*E*  ERROR: VOM-E$PROERR-0
      852    13153             MESSAGE:The folder for <> is malformed or damaged.
      853    13154                     MAIL can not deliver messages to that folder.
      854    13155        */
      855    13156              %VLP_ERRCODE (FPTN=E_FOLDERFULL,FCG="VO",MID="M",
      856    13157              ERR#=%E$FOLDERFULL,STCLASS=CONSTANT);
      857    13202        /*E*    ERROR: VOM-E$FOLDERFULL-0
      858    13203                MESSAGE:Folder< for <>> is full.
      859    13204        */
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:109  
      860    13205              %VLP_ERRCODE (FPTN=E_DISKSPACE,FCG="VO",MID="M",
      861    13206              ERR#=%E$DISKSPACE,STCLASS=CONSTANT);
      862    13251        /*E*    ERROR: VOM-E$DISKSPACE-0
      863    13252                MESSAGE:Account disk space< for <>> has been exceeded.
      864    13253                         MAIL can not deliver a message.
      865    13254        */
      866    13255              %VLP_ERRCODE (FPTN=E_DELIVERED,FCG="VO",MID="M",
      867    13256              ERR#=%E$DELIVERED,STCLASS=CONSTANT);
      868    13301        /*E*    ERROR: VOM-E$DELIVERED-0
      869    13302                MESSAGE:Delivered %U1 to <>
      870    13303        */
      871    13304              %VLP_ERRCODE (FPTN=E_RRACKED,FCG="VO",MID="M",
      872    13305              ERR#=%E$RRACKED,STCLASS=CONSTANT);
      873    13350        /*E*    ERROR: VOM-E$RRACKED-0
      874    13351                MESSAGE:Return receipt %U1 from <>
      875    13352        */
      876    13353              %VLP_ERRCODE (FPTN=E_ACKED,FCG="VO",MID="M",
      877    13354              ERR#=%E$ACKED,STCLASS=CONSTANT);
      878    13399        /*E*    ERROR: VOM-E$ACKED-0
      879    13400                MESSAGE:Acknowledged %U1 by <>
      880    13401        */
      881    13402              %VLP_ERRCODE (FPTN=E_ANSWERED,FCG="VO",MID="M",
      882    13403              ERR#=%E$ANSWERED,STCLASS=CONSTANT);
      883    13448        /*E*    ERROR: VOM-E$ANSWERED-0
      884    13449                MESSAGE:Answered %U1 by <> %(see #%U2)%
      885    13450        */
      886    13451
      887    13452    1   DCL WORK_TIME UBIN WORD STATIC;
      888    13453    1   DCL CURRENT_TIME UBIN WORD STATIC;
      889    13454        /***** External routines *****/
      890    13455    1   DCL VOM$ADDENTRY ENTRY(4);
      891    13456    1   DCL VOM$ADDENTRY_SORTED ENTRY(4);
      892    13457    1   DCL VOM$DELENTRY ENTRY(3);
      893    13458    1   DCL VMD$GET_HEADER ENTRY(2) ALTRET;
      894    13459    1   DCL VMD$PUT_HEADER ENTRY (2) ALTRET;
      895    13460    1   DCL VMD$GET_DELIVERY ENTRY (3) ALTRET;
      896    13461    1   DCL VMD$GET_DELIVERY_NEXT ENTRY (3) ALTRET;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:110  
      897    13462    1   DCL VMD$PUT_DELIVERY ENTRY (3) ALTRET;
      898    13463    1   DCL VMD$MERGE_DELIVERY ENTRY (3) ALTRET;
      899    13464    1   DCL VMD$DEL_DELIVERY ENTRY (2) ALTRET;
      900    13465    1   DCL VMD$GET_ID ENTRY (3) ALTRET;
      901    13466    1   DCL VMD$GET_SITE ENTRY (2) ALTRET;
      902    13467    1   DCL VMD$PUT_SITE ENTRY (2) ALTRET;
      903    13468    1   DCL VMA$OPEN_FOLDER   ENTRY(5) ALTRET;
      904    13469    1   DCL VMD$GET_BODY ENTRY (7) ALTRET;
      905    13470    1   DCL VMD$PUT_BODY ENTRY (7) ALTRET;
      906    13471    1   DCL VMD$GET_TRACE ENTRY (7) ALTRET;
      907    13472    1   DCL VMD$PUT_TRACE ENTRY (7) ALTRET;
      908    13473    1   DCL VMA$ENLARGE_SEGMENT ENTRY(2) ALTRET;
      909    13474    1   DCL VMA$GET_ADD_RECORD ENTRY(4) ALTRET;
      910    13475    1   DCL VMA$OPEN_GLOBAL ENTRY(1) ALTRET;
      911    13476    1   DCL VMA$GET_NEXT_ENTRY ENTRY(4) ALTRET;
      912    13477    1   DCL VMA$GET_SITE_NAME ENTRY(4) ALTRET;
      913    13478    1   DCL VMA$DEL_ADD_RECORD ENTRY(4) ALTRET;
      914    13479    1   DCL VMA$EXPAND_LIST_FULL ENTRY(5) ALTRET;
      915    13480    1   DCL VMA$GET_LIST ENTRY(3) ALTRET;
      916    13481    1   DCL VMA$ADD_RENTRY ENTRY(6) ALTRET;
      917    13482    1   DCL VMA$ADD_UENTRY ENTRY(6) ALTRET;
      918    13483    1   DCL VMA$PUT_ADD_RECORD ENTRY(4) ALTRET;
      919    13484    1   DCL VMF$MAKE_ADDRESS2 ENTRY(3);
      920    13485    1   DCL VMM$COPY_MESSAGE ENTRY(6) ALTRET;
      921    13486    1   DCL VMM$COPY_MESSAGE_BODY ENTRY (6) ALTRET;
      922    13487    1   DCL VMM$COMBINE_MESSAGE ENTRY (3) ALTRET;
      923    13488    1   DCL VOM$PROCESS ENTRY;
      924    13489    1   DCL X$ALLOCATE ENTRY(1) ALTRET;
      925    13490    1   DCL X$DEALLOCATE ENTRY(1) ALTRET;
      926    13491        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:111  
      927    13492    1   START_UP:;
      928    13493    1       STATUS_STRING = 'Acquiring a mailgram';
      929    13494    1       CALL UPDATE_STATUS;
      930    13495    1       TIME$ = HEAD$;                    /* Point to first entry */
      931    13496    1       SEND_BC = %NO#;
      932    13497    1       BLIND_TEXT.L# = 0;
      933    13498
      934    13499    1       MAIL_NAME = TIME_TABLE.NAME;      /* Get name of file */
      935    13500    1       CALL M$OPEN (OPEN_MAIL) ALTRET(BAD_MAIL);
      936    13501        /*
      937    13502             ***** Try to read the site record.
      938    13503                   If this message came from another system, then
      939    13504                   it should have a record of where it came from.
      940    13505                   Otherwise, the message originated locally ...
      941    13506        */
      942    13507    1       CALL VMD$GET_SITE (VM_SITE,DCBNUM(MAIL_IN))
      943    13508    2       WHENRETURN DO;
      944    13509    2           INTERSYS_ACTIVE = '1'B;
      945    13510    2       END;
      946    13511    1       WHENALTRETURN
      947    13512    2       DO;
      948    13513    2           VM_SITE = '0'B;
      949    13514    2           INTERSYS_ACTIVE = '0'B;
      950    13515    2           VM_SITE.ORIGIN = VM_SITENAME;
      951    13516    2           VM_SITE.NUM_SITES = 0;
      952    13517    2       END;
      953    13518        /*
      954    13519             ***** If RETURN_TO_ORIGIN is set,
      955    13520                   then pretend that this site originated the
      956    13521                   message ...
      957    13522        */
      958    13523    1       IF VM_SITE.FLAGS.RETURN_TO_ORIGIN
      959    13524    1       THEN
      960    13525    2       DO;
      961    13526    2           VM_SITE.FLAGS.RETURN_TO_ORIGIN = %NO#;
      962    13527    2           VM_SITE.ORIGIN = VM_SITENAME;
      963    13528    2           VM_SITE.NUM_SITES = 0;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:112  
      964    13529    2       END;
      965    13530        /*
      966    13531             ***** Now get the message header ...
      967    13532        */
      968    13533    1       CALL REFRESH_INPUT_HEADER ALTRET (BAD_MAIL);
      969    13534    1       IF VM_HEADER.FROM$ ~= ADDR(NIL)
      970    13535    1         AND B$JIT.PRIV.ACTIVE.JIT
      971    13536    1       THEN
      972    13537    1           B$JIT.JOBNAME = VM_HEADER.FROM$ -> X$STRING.TEXT;
      973    13538        /*
      974    13539             ***** If this message has never been seen before, stuff the
      975    13540                   current UTS into the first-seen time field and set the
      976    13541                   delivery phase to "startup".
      977    13542        */
      978    13543    1       IF VM_HEADER.FIRST_DELIVERY = 0
      979    13544    2       THEN DO;
      980    13545    2           CALL M$TIME (GET_CURRENT);
      981    13546    2           VM_HEADER.FIRST_DELIVERY = CURRENT_TIME;
      982    13547    2           VM_HEADER.MISC.PHASE = %VM_PHASE_STARTUP;
      983    13548    2           CALL VMD$PUT_HEADER (0, DCBNUM(MAIL_IN)) ALTRET (BAD_MAIL);
      984    13549    2       END;
      985    13550        /*
      986    13551             ***** Save the return address info ...
      987    13552        */
      988    13553    1       VM_RETURN_ADDRESS = VM_HEADER.RETURN_ADDRESS$ -> VM$RADDRESS;
      989    13554    1       ERR_FLAG = VM_HEADER.STATUS.ERR;
      990    13555
      991    13556    1   PROCESS:
      992    13557    2       DO UNTIL VM_HEADER.MISC.PHASE = %VM_PHASE_FINI;
      993    13558    2           UNDELIVERED = '0'B;
      994    13559    2   ONE_PHASE:
      995    13560    3           DO CASE (VM_HEADER.MISC.PHASE);
      996    13561        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:113  
      997    13562    3           CASE (%VM_PHASE_STARTUP);
      998    13563                 /* Startup.  Assign a message ID if none was assigned by SEND (which
      999    13564                    generally means that this message originated in a pre-B00 mail
     1000    13565                    environment. */
     1001    13566    3               IF VM_HEADER.UNIQUE_ID$ = ADDR(NIL)
     1002    13567    4               THEN DO;
     1003    13568    4                   STATUS_STRING = 'Assigning a message ID';
     1004    13569    4                   CALL UPDATE_STATUS;
     1005    13570    4                   CALL ASSIGN_A_MESSAGE_ID
     1006    13571    5                   WHENRETURN DO;
     1007    13572    5                       CALL VMD$PUT_HEADER (0, DCBNUM(MAIL_IN)) ALTRET (BAD_MAIL);
     1008    13573    5                   END;
     1009    13574    4               END;
     1010    13575        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:114  
     1011    13576    3           CASE (%VM_PHASE_RESOLVE_FC);
     1012    13577                 /* Resolve the File Copy address and write a deliver record into
     1013    13578                    the file. */
     1014    13579    3               IF NOT VM_HEADER.STATUS.FCOPY
     1015    13580    3               THEN
     1016    13581    3                   EXIT ONE_PHASE;
     1017    13582    3               STATUS_STRING = 'Storing file-copy address';
     1018    13583    3               CALL UPDATE_STATUS;
     1019    13584    3               IF VM_HEADER.FILE_FOLDER$ = ADDR(NIL)
     1020    13585    3               THEN
     1021    13586    3                   VM_RADDRESS = VM_RETURN_ADDRESS;
     1022    13587    3               ELSE
     1023    13588    3                   VM_RADDRESS = VM_HEADER.FILE_FOLDER$ -> VM$RADDRESS;
     1024    13589    3               ADD_TYPE = -1;
     1025    13590    3               CALL INIT_DELIVERY_RECORD;
     1026    13591    3               VM_DELIVERY.FLAGS.FC = %YES#;
     1027    13592    3               CALL VMD$PUT_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY, VM_DELIVERY);
     1028    13593        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:115  
     1029    13594    3           CASE (%VM_PHASE_DELIVER_FC);
     1030    13595                 /* Actually deliver the file copy. */
     1031    13596    3               IF NOT VM_HEADER.STATUS.FCOPY
     1032    13597    3               THEN
     1033    13598    3                   EXIT ONE_PHASE;
     1034    13599    3               STATUS_STRING = 'Delivering file copy';
     1035    13600    3               CALL UPDATE_STATUS;
     1036    13601    3               IF VM_HEADER.FILE_FOLDER$ = ADDR(NIL)
     1037    13602    3               THEN
     1038    13603    3                   VM_RADDRESS = VM_RETURN_ADDRESS;
     1039    13604    3               ELSE
     1040    13605    3                   VM_RADDRESS = VM_HEADER.FILE_FOLDER$ -> VM$RADDRESS;
     1041    13606    3               CALL INIT_DELIVERY_RECORD;
     1042    13607    3               CALL VMD$GET_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY, VM_DELIVERY)
             13607                        ALTRET (BAD_MAIL);
     1043    13608    3               VM_HEADER.STATUS.RR = %NO#;
     1044    13609    3               VM_HEADER.STATUS.DR = %NO#;
     1045    13610    3               CALL VOM$SENDIT
     1046    13611    4               WHENRETURN DO;
     1047    13612    4                   ERROR = '0'B;
     1048    13613    4               END;
     1049    13614    4               WHENALTRETURN DO;
     1050    13615    4                   IF UNDELIVERED.BUSY OR UNDELIVERED.PACKSET_NA
     1051    13616    4                   THEN
     1052    13617    4                       EXIT PROCESS;
     1053    13618    4                   CALL REFRESH_INPUT_HEADER ALTRET (BAD_MAIL);
     1054    13619    4                   VM_HEADER.STATUS.FCOPY = %NO#;
     1055    13620    4                   CALL VMD$PUT_HEADER (0, DCBNUM(MAIL_IN)) ALTRET (BAD_MAIL);
     1056    13621    4                   IF VM_RADDRESS.FLAGS.UNDEF# THEN ERROR = E_ADDUNKNOWN;
     1057    13622    4               END;
     1058    13623    3               VM_DELIVERY.ERR = ERROR;
     1059    13624    3               VM_DELIVERY.UTS_OF_DELIVERY = CURRENT_TIME;
     1060    13625    3               VM_DELIVERY.FLAGS.DONE = %YES#;
     1061    13626    3               IF VM_DELIVERY.COUNT = 0
     1062    13627    4               THEN DO;
     1063    13628    4                   WORK_TEXTC.L# = LENGTHC(WORK_TEXTC.NAME#);
     1064    13629    4                   IF VM_RADDRESS.TYPE = %VM_ADD_RESOLVED
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:116  
     1065    13630    4                   THEN
     1066    13631    4                       CALL VMF$MAKE_ADDRESS2 (WORK_TEXTC,VM_RADDRESS,%YES#);
     1067    13632    4                   ELSE
     1068    13633    4                       CALL VMF$MAKE_ADDRESS2 (WORK_TEXTC,VM_UADDRESS,%YES#);
     1069    13634    4                   VM_DELIVERY.COUNT = WORK_TEXTC.L#;
     1070    13635    4                   VM_DELIVERY.TEXT = WORK_TEXTC.NAME#;
     1071    13636    4               END;
     1072    13637    3               CALL VMD$PUT_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY, VM_DELIVERY);
     1073    13638
     1074    13639        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:117  
     1075    13640    3           CASE (%VM_PHASE_RESOLVE_ALL);
     1076    13641                 /* Perform resolution on all addresses in the file. */
     1077    13642    3               STATUS_STRING = 'Expanding address list(s)';
     1078    13643    3               CALL UPDATE_STATUS;
     1079    13644    3               BAD_ADDRESS_COUNT = 0;
     1080    13645        /*
     1081    13646              ***** Clear out any bad-address delivery entries in the file... avoid
     1082    13647                    dups if the system crashes during this phase.
     1083    13648        */
     1084    13649    3               VM_RADDRESS.ACCT = '*';
     1085    13650    3               VM_RADDRESS.FOLDER = ' ';
     1086    13651    3               CALL INIT_DELIVERY_RECORD;
     1087    13652    4   PURGE:      DO WHILE ('1'B); /* FOREVER */;
     1088    13653    4                   CALL VMD$GET_DELIVERY_NEXT (DCBNUM(MAIL_IN), VM_DELIVERYKEY,
             13653                            VM_DELIVERY)
     1089    13654    5                   WHENALTRETURN DO;
     1090    13655    5                       EXIT PURGE;
     1091    13656    5                   END;
     1092    13657    4                   IF VM_DELIVERYKEY.ACCT ~= '*'
     1093    13658    4                   THEN
     1094    13659    4                       EXIT PURGE;
     1095    13660    4                   CALL VMD$DEL_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY);
     1096    13661    4               END PURGE;
     1097    13662    3               ITO_HEAD$ = ADDR(NIL);
     1098    13663    3               IBC_HEAD$ = ADDR(NIL);
     1099    13664    3               IC_HEAD$ = ADDR(NIL);
     1100    13665    3               IADDLIST_MCB.TYPE = 0;
     1101    13666    3               IADDLIST_MCB.MIN_SIZE = SIZEC(VM_RADDRESS);
     1102    13667    3               IADDLIST_MCB.SEGMENT_BASE$ = VM_COPY$;
     1103    13668    3               IADDLIST_MCB.HI_SEGMENT$ = VM_COPY$;
     1104    13669    3               IADDLIST_MCB.WKSZ = (VBOUND(VM_COPY_)+1)/4;
     1105    13670    3               IADDLIST_MCB.FREE_HEAD$ = ADDR(NIL);
     1106    13671
     1107    13672        /*
     1108    13673             ***** Setup the default search list.
     1109    13674                   Therefore, open :MAIL_CENTRAL.:MAIL
     1110    13675                   if it exists. Otherwise, an unregistered system ...
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:118  
     1111    13676        */
     1112    13677    3               IF DCBADDR(M$MAIL_GLOBAL_NUM) -> F$DCB.FCD# = %NO#
     1113    13678    3               THEN                        /* Open it */
     1114    13679    3                   CALL VMA$OPEN_GLOBAL (M$MAIL_GLOBAL_NUM) ALTRET(CANT_OPEN_GLOBAL);
     1115    13680    3               VM_SEARCH_INFO.NUM_ENTRIES = 1;
     1116    13681    3               VM_SEARCH_INFO.DCB#(0) = M$MAIL_GLOBAL_NUM;
     1117    13682    4               DO WHILE ('0'B); /* NEVER */;
     1118    13683    4   CANT_OPEN_GLOBAL:
     1119    13684    4                   VM_SEARCH_INFO.NUM_ENTRIES = 0;
     1120    13685    4               END;
     1121    13686    3               PROCESSING = %YES#;
     1122    13687        /*
     1123    13688             ***** Get the first address record ...
     1124    13689        */
     1125    13690    3               IF VM_HEADER.BLIND$ ~= ADDR(NIL)
     1126    13691    3               THEN
     1127    13692    3                   ADD_TYPE = %VM_TYPE_BC;
     1128    13693    3               ELSE
     1129    13694    3                   IF VM_HEADER.COPY$ ~= ADDR(NIL)
     1130    13695    3                   THEN
     1131    13696    3                       ADD_TYPE = %VM_TYPE_C;
     1132    13697    3                   ELSE
     1133    13698    3                       ADD_TYPE = %VM_TYPE_TO;
     1134    13699    3               CALL GET_ADD_RECORD ALTRET (NEXT_ADD);
     1135    13700        /*
     1136    13701             ***** Loop while there are messages to process ...
     1137    13702        */
     1138    13703    4               DO WHILE(PROCESSING);
     1139    13704    4                   PROCESS_ERROR = %PROCESS;
     1140    13705    5                   DO WHILE ('1'B); /* FOREVER */;
     1141    13706    6                       IF VO_NEED_READ THEN DO;
     1142    13707    6                           VO_NEED_READ = '0'B;
     1143    13708    6                           CALL M$READ (VO_READ_CG);
     1144    13709    6                       END;
     1145    13710    5                       IF VO_PROCESS THEN CALL VOM$PROCESS;
     1146    13711        /*
     1147    13712             ***** Pickup one address out of address record and
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:119  
     1148    13713                   resolve it as necessary before sending message.
     1149    13714                   NOTE: All support routines expect the address to
     1150    13715                   be processed to be contained in VM_RADDRESS or
     1151    13716                   VM_UADDRESS. They will look at VM_RADDRESS.TYPE
     1152    13717                   to determine if the info is stored in resolved
     1153    13718                   or unresolved form. Be careful to follow this convention!!!
     1154    13719        */
     1155    13720    5                       CALL VMA$GET_NEXT_ENTRY(VM_UADDRESS,VM_RADDRESS,PTR$,VM_ADDREC$)
             13720                                ALTRET(NEXT_ADD);
     1156    13721    5                       IF VM_RADDRESS.TYPE = %VM_ADD_UNRESOLVED THEN
     1157    13722    6                       DO;
     1158    13723    6                           PROCESS_ERROR = %PROCESS_UNRESOLVED;
     1159    13724    6                           VM_ADD_HEAD.NUM_ENTRIES = 0;
     1160    13725    6                           VM_ADD_HEAD.FLAGS = %NO#;
     1161    13726    6                           CALL VMA$EXPAND_LIST_FULL(VM_UADDRESS,VM_WORK$,
             13726                                    VM_SEARCH_INFO,0)
     1162    13727    7                           WHENALTRETURN DO;
     1163    13728    7                               ERROR = E_ADDUNKNOWN;
     1164    13729    7                               VM_RADDRESS.ACCT = '*';
     1165    13730    7                               CALL BINCHAR (VM_RADDRESS.FOLDER, BAD_ADDRESS_COUNT);
     1166    13731    7                               BAD_ADDRESS_COUNT = BAD_ADDRESS_COUNT + 1;
     1167    13732    7                               CALL GENERATE_AN_ERROR_ENTRY;
     1168    13733    7                               PROCESS_ERROR = %PROCESS;
     1169    13734    7                               GOTO CONT_PROCESS;
     1170    13735    7                           END;
     1171    13736    6                           NEXT$ = VM_ADD_HEAD.HEAD$;
     1172    13737    7                           DO WHILE ('1'B); /* FOREVER */;
     1173    13738        /*
     1174    13739             ***** Pickup the definition for the specified user.
     1175    13740                   If the user name is nil, then use the account
     1176    13741                   number out of the return address ...
     1177    13742        */
     1178    13743    7                               CALL VMA$GET_NEXT_ENTRY(VM_UADDRESS,VM_RADDRESS,NEXT$,
             13743                                        VM_ADDLIST$) ALTRET(END_LOOP1);
     1179    13744    7                               IF VM_RADDRESS.FLAGS.UNDEF#
     1180    13745    8                               THEN DO;
     1181    13746    8                                   ERROR = E_ADDUNKNOWN;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:120  
     1182    13747    8                                   VM_RADDRESS.ACCT = '*';
     1183    13748    8                                   CALL BINCHAR (VM_RADDRESS.FOLDER, BAD_ADDRESS_COUNT)
             13748                                            ;
     1184    13749    8                                   BAD_ADDRESS_COUNT = BAD_ADDRESS_COUNT + 1;
     1185    13750    8                                   CALL GENERATE_AN_ERROR_ENTRY;
     1186    13751    8                                   GOTO CONT_UNRESOLVED;
     1187    13752    8                               END;
     1188    13753    7                               CALL VMA$GET_SITE_NAME (VM_RADDRESS.SITENAME, SITENAME)
     1189    13754    8                               WHENALTRETURN DO;
     1190    13755    8                                   SITENAME = VM_RADDRESS.SITENAME;
     1191    13756    8                               END;
     1192    13757    7                               IF SITENAME ~= ' '
     1193    13758    7                                 AND SITENAME ~= VM_SITENAME
     1194    13759    8                               THEN DO;
     1195    13760    8                                   CALL QUEUE_INTERSYS
     1196    13761    9                                   WHENALTRETURN DO;
     1197    13762    9                                       VM_RADDRESS.ACCT = '*';
     1198    13763    9                                       CALL BINCHAR (VM_RADDRESS.FOLDER,
             13763                                                BAD_ADDRESS_COUNT);
     1199    13764    9                                       BAD_ADDRESS_COUNT = BAD_ADDRESS_COUNT + 1;
     1200    13765    9                                       CALL GENERATE_AN_ERROR_ENTRY;
     1201    13766    9                                   END;
     1202    13767    8                               END;
     1203    13768    8                               ELSE DO;
     1204    13769    8                                   VM_RADDRESS.SITENAME = SITENAME;
     1205    13770    8                                   CALL INIT_DELIVERY_RECORD;
     1206    13771    8                                   CALL FILL_IN_DELIVERY_RECORD;
     1207    13772    8                                   CALL VMD$MERGE_DELIVERY (DCBNUM(MAIL_IN),
             13772                                            VM_DELIVERYKEY, VM_DELIVERY);
     1208    13773    8                               END;
     1209    13774    7   CONT_UNRESOLVED:            ;
     1210    13775    7                           END;     /* Do forever ... end */
     1211    13776    6   END_LOOP1:              ;
     1212    13777    6                       END;
     1213    13778    6                       ELSE DO;
     1214    13779    6                           CALL VMA$GET_SITE_NAME (VM_RADDRESS.SITENAME, SITENAME)
     1215    13780    7                           WHENALTRETURN DO;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:121  
     1216    13781    7                               SITENAME = VM_RADDRESS.SITENAME;
     1217    13782    7                           END;
     1218    13783    6                           IF SITENAME ~= ' '
     1219    13784    6                             AND SITENAME ~= VM_SITENAME
     1220    13785    7                           THEN DO;
     1221    13786    7                               CALL QUEUE_INTERSYS
     1222    13787    8                               WHENALTRETURN DO;
     1223    13788    8                                   VM_RADDRESS.ACCT = '*';
     1224    13789    8                                   CALL BINCHAR (VM_RADDRESS.FOLDER, BAD_ADDRESS_COUNT)
             13789                                            ;
     1225    13790    8                                   BAD_ADDRESS_COUNT = BAD_ADDRESS_COUNT + 1;
     1226    13791    8                                   CALL GENERATE_AN_ERROR_ENTRY;
     1227    13792    8                               END;
     1228    13793    7                           END;
     1229    13794    7                           ELSE DO;
     1230    13795    7                               VM_RADDRESS.SITENAME = SITENAME;
     1231    13796    7                               CALL INIT_DELIVERY_RECORD;
     1232    13797    7                               CALL FILL_IN_DELIVERY_RECORD;
     1233    13798    7                               CALL VMD$MERGE_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY
             13798                                        , VM_DELIVERY);
     1234    13799    7                           END;
     1235    13800    6                       END;
     1236    13801    5                   END;
     1237    13802
     1238    13803    4   NEXT_ADD:       ;
     1239    13804    4                   IF VM_HEADER.COPY$ ~= ADDR(NIL) AND ADD_TYPE = %VM_TYPE_BC THEN
     1240    13805    5                   DO;
     1241    13806    5                       ADD_TYPE = %VM_TYPE_C;
     1242    13807    5                       CALL GET_ADD_RECORD ALTRET(NEXT_ADD);
     1243    13808    5                   END;
     1244    13809    4                   ELSE
     1245    13810    4                       IF VM_HEADER.TO$ ~= ADDR(NIL) AND ADD_TYPE ~= %VM_TYPE_TO THEN
     1246    13811    5                       DO;
     1247    13812    5                           ADD_TYPE = %VM_TYPE_TO;
     1248    13813    5                           CALL GET_ADD_RECORD ALTRET(NEXT_ADD);
     1249    13814    5                       END;
     1250    13815    4                       ELSE
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:122  
     1251    13816    4                           PROCESSING = %NO#;
     1252    13817    4   CONT_PROCESS:   ;
     1253    13818    4               END;
     1254    13819
     1255    13820    3               IF NOT PROCESSING THEN GOTO CONT_MAIL;
     1256    13821    3               IF PROCESS_ERROR = %PROCESS THEN GOTO CONT_PROCESS;
     1257    13822    3               IF PROCESS_ERROR = %PROCESS_UNRESOLVED THEN GOTO CONT_UNRESOLVED;
     1258    13823    3   CONT_MAIL:  ;
     1259    13824        /*
     1260    13825              ***** Address resolution complete.  Delivery records have been added
     1261    13826                    to the mailgram file for local deliveries (and for names that
     1262    13827                    couldn't be resolved);  there may be some inter-system requests
     1263    13828                    queued up in memory on the INTERSYS_HEAD$ list.
     1264    13829
     1265    13830                    Before shipping the intersystem files, we'll make a special check
     1266    13831                    to see if the sender is a recipient of the mailgram (and isn't
     1267    13832                    the file-copy address if any).  If this is true, then we'll
     1268    13833                    attempt to force delivery of the sender's copy now, and (if
     1269    13834                    successful) turn on the successful-FCOPY flag in the message.
     1270    13835                    This will ensure that any subsequent ERR processing will "know"
     1271    13836                    that the sender has a copy, and will not bother returning
     1272    13837                    copies with the errors.  If the delivery attempt fails, no matter;
     1273    13838                    it will be retried (and any errors logged) during the main
     1274    13839                    delivery phase.
     1275    13840        */
     1276    13841
     1277    13842    3               CALL REFRESH_INPUT_HEADER;
     1278    13843    3               VM_RADDRESS = VM_RETURN_ADDRESS;
     1279    13844    3               CALL INIT_DELIVERY_RECORD;
     1280    13845    3               CALL VMD$GET_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY, VM_DELIVERY)
             13845                        ALTRET (NO_COPY_TO_SENDER);
     1281    13846    3               IF NOT VM_DELIVERY.FLAGS.DONE
     1282    13847    3                 AND NOT VM_HEADER.STATUS.ERR AND NOT VM_HEADER.STATUS.DELIVERY
     1283    13848    4               THEN DO;
     1284    13849    4                   VM_HEADER.STATUS.RR = %NO#;
     1285    13850    4                   VM_HEADER.STATUS.DR = %NO#;
     1286    13851    4                   CALL VOM$SENDIT ALTRET (NO_COPY_TO_SENDER);
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:123  
     1287    13852    4                   CALL REFRESH_INPUT_HEADER;
     1288    13853    4                   VM_HEADER.STATUS.FCOPY = %YES#;
     1289    13854    4                   CALL VMD$PUT_HEADER (0, DCBNUM(MAIL_IN)) ALTRET (NO_COPY_TO_SENDER);
     1290    13855    4                   VM_DELIVERY.UTS_OF_DELIVERY = CURRENT_TIME;
     1291    13856    4                   VM_DELIVERY.ERR = '0'B;
     1292    13857    4                   VM_DELIVERY.FLAGS.DONE = %YES#;
     1293    13858    4                   CALL VMD$PUT_DELIVERY (DCBNUM(MAIL_IN),VM_DELIVERYKEY,VM_DELIVERY);
     1294    13859    4               END;
     1295    13860    3   NO_COPY_TO_SENDER:
     1296    13861        /*
     1297    13862             ***** If this message needs to be transported to
     1298    13863                   any other site, do it now ...
     1299    13864        */
     1300    13865    3               IF INTERSYS_HEAD$ ~= ADDR(NIL)
     1301    13866    3               THEN
     1302    13867    3                   CALL TRANSPORT_INTERSYS('0'B) ALTRET(BAD_MAIL);
     1303    13868
     1304    13869        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:124  
     1305    13870    3           CASE (%VM_PHASE_ERR_SWEEP_1, %VM_PHASE_ERR_SWEEP_2);
     1306    13871                 /* Report any (unreported) errors occurring up to this point. */
     1307    13872    3               IF VM_HEADER.STATUS.BROADCAST
     1308    13873    3                 OR VM_HEADER.STATUS.ERR
     1309    13874    3                 OR VM_HEADER.STATUS.DELIVERY
     1310    13875    3               THEN
     1311    13876    3                   EXIT ONE_PHASE;
     1312    13877    3               VM_DELIVERYKEY = INIT_DELIVERYKEY;
     1313    13878    4               DO WHILE ('1'B); /* FOREVER */;
     1314    13879    4                   STATUS_STRING = 'Looking for accumulated errors...';
     1315    13880    4                   CALL UPDATE_STATUS;
     1316    13881    5                   IF VO_NEED_READ THEN DO;
     1317    13882    5                       VO_NEED_READ = '0'B;
     1318    13883    5                       CALL M$READ (VO_READ_CG);
     1319    13884    5                   END;
     1320    13885    4                   IF VO_PROCESS THEN CALL VOM$PROCESS;
     1321    13886    4                   CALL VMD$GET_DELIVERY_NEXT (DCBNUM(MAIL_IN), VM_DELIVERYKEY,
             13886                            VM_DELIVERY) ALTRET (ERROR_SWEEP_COMPLETE);
     1322    13887    4                   IF (VM_HEADER.MISC.PHASE = %VM_PHASE_ERR_SWEEP_2 OR VM_DELIVERY.
             13887                            FLAGS.DONE)
     1323    13888    4                     AND NOT VM_DELIVERY.FLAGS.REPORTED
     1324    13889    4                     AND VM_DELIVERY.ERR ~= '0'B
     1325    13890    5                   THEN DO;
     1326    13891    5                       STATUS_STRING = 'Creating an error report';
     1327    13892    5                       CALL UPDATE_STATUS;
     1328    13893    5                       ERROR = VM_DELIVERY.ERR;
     1329    13894    5                       WORK_TEXTC.L# = VM_DELIVERY.COUNT;
     1330    13895    5                       WORK_TEXTC.NAME# = VM_DELIVERY.TEXT;
     1331    13896    5                       CALL RETURN_ERROR_MSG;
     1332    13897    5                       VM_DELIVERY.FLAGS.REPORTED = %YES#;
     1333    13898    5                       CALL VMD$PUT_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY,
             13898                                VM_DELIVERY);
     1334    13899    5                   END;
     1335    13900    4               END;
     1336    13901    3   ERROR_SWEEP_COMPLETE: ;
     1337    13902
     1338    13903        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:125  
     1339    13904    3           CASE (%VM_PHASE_CORRECT_FC);
     1340    13905                 /* Correct the flags for the file copy.  The original file copy was
     1341    13906                    delivered with only the "This is a file copy" flag set;  the flags
     1342    13907                    indicating presence of this address on the TO, C, and BC lists were
     1343    13908                    not set correctly 'cause they weren't available.  Check the delivery
     1344    13909                    record for the file copy;  if any of these flags are set, then
     1345    13910                    reopen the file copy mailbox and correct the flags (requeue if
     1346    13911                    the mailbox is busy or on an unmounted packset;  don't requeue if
     1347    13912                    a more exotic I/O error occurs 'cause this would force delivery of
     1348    13913                    all other copies of the mail to be deferred until the file copy
     1349    13914                    mailbox was fixed... too big a price to pay.
     1350    13915                 */
     1351    13916    3               IF NOT VM_HEADER.STATUS.FCOPY
     1352    13917    3               THEN
     1353    13918    3                   EXIT ONE_PHASE;
     1354    13919    3               STATUS_STRING = 'Updating status flags on the file copy';
     1355    13920    3               CALL UPDATE_STATUS;
     1356    13921    3               IF VM_HEADER.FILE_FOLDER$ = ADDR(NIL)
     1357    13922    3               THEN
     1358    13923    3                   VM_RADDRESS = VM_RETURN_ADDRESS;
     1359    13924    3               ELSE
     1360    13925    3                   VM_RADDRESS = VM_HEADER.FILE_FOLDER$ -> VM$RADDRESS;
     1361    13926    3               CALL INIT_DELIVERY_RECORD;
     1362    13927    3               CALL VMD$GET_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY, VM_DELIVERY)
     1363    13928    4               WHENALTRETURN DO;
     1364    13929    4                   EXIT ONE_PHASE;
     1365    13930    4               END;
     1366    13931    3               IF NOT VM_DELIVERY.FLAGS.PRIMARY
     1367    13932    3                 AND NOT VM_DELIVERY.FLAGS.C
     1368    13933    3                 AND NOT VM_DELIVERY.FLAGS.BC
     1369    13934    3               THEN
     1370    13935    3                   EXIT ONE_PHASE;
     1371    13936    3               VM_FOLDER_INFO.FLAGS = %NO#;
     1372    13937    3               CALL VMA$OPEN_FOLDER (VM_FOLDER_INFO, ADDR(VM_RADDRESS), DCBNUM(MAIL_OUT
             13937                        ), %OLDFILE#, %UPDATE#)
     1373    13938    4               WHENALTRETURN DO;
     1374    13939    4                   ERROR = B$TCB.ALT$ -> B$ALT.ERR;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:126  
     1375    13940    5                   DO SELECT (ERROR.ERR#);
     1376    13941    5                       SELECT (%E$FILEBUSY, %E$XCLSET, %E$SETDOWN, %E$NONEWU);
     1377    13942    5                       UNDELIVERED.BUSY = %YES#;
     1378    13943    5                       EXIT PROCESS;
     1379    13944    5                       SELECT (ELSE);
     1380    13945    5                   EXIT ONE_PHASE;
     1381    13946    5                   END;
     1382    13947    4               END;
     1383    13948    3               CALL ENQ_ON_PROFILE
     1384    13949    4               WHENALTRETURN DO;
     1385    13950    5                   CALL M$CLOSE (CLOSE_MAIL_OUT) WHENALTRETURN DO; END;
     1386    13951    4                   EXIT PROCESS;
     1387    13952    4               END;
     1388    13953    3               CALL VMD$GET_ID (VM_HEADER.UNIQUE_ID$ -> X$STRING, DCBNUM(MAIL_OUT),
             13953                        MESSAGE_NUMBER)
     1389    13954    4               WHENALTRETURN DO;
     1390    13955    5                   CALL M$CLOSE (CLOSE_MAIL_OUT) WHENALTRETURN DO; END;
     1391    13956    4                   EXIT ONE_PHASE;
     1392    13957    4               END;
     1393    13958    3               ID = VM_HEADER.UNIQUE_ID$ -> X$STRING.TEXT;
     1394    13959    3               VM_HEADRES.RES# = MESSAGE_NUMBER;
     1395    13960    3               CALL M$ENQ (ENQ_HEADER)
     1396    13961    4               WHENALTRETURN DO;
     1397    13962    4                   CALL M$ERR;
     1398    13963    4               END;
     1399    13964    3               CALL VMD$GET_HEADER (MESSAGE_NUMBER, DCBNUM(MAIL_OUT)) ALTRET (NO_UPDATE
             13964                        );
     1400    13965    3               IF VM_HEADER.UNIQUE_ID$ ~= ADDR(NIL)
     1401    13966    3                 AND VM_HEADER.UNIQUE_ID$ -> X$STRING.TEXT = ID
     1402    13967    4               THEN DO;
     1403    13968    4                   VM_HEADER.STATUS.PRIMARY = VM_DELIVERY.FLAGS.PRIMARY;
     1404    13969    4                   VM_HEADER.STATUS.C = VM_DELIVERY.FLAGS.C;
     1405    13970    4                   VM_HEADER.STATUS.BC = VM_DELIVERY.FLAGS.BC;
     1406    13971    4                   CALL VMD$PUT_HEADER (MESSAGE_NUMBER, DCBNUM(MAIL_OUT)) ALTRET (
             13971                            NO_UPDATE);
     1407    13972    4               END;
     1408    13973    3   NO_UPDATE:
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:127  
     1409    13974    4               CALL M$CLOSE (CLOSE_MAIL_OUT) WHENALTRETURN DO; END;
     1410    13975
     1411    13976        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:128  
     1412    13977    3           CASE (%VM_PHASE_DELIVER_ALL);
     1413    13978                 /* Deliver mail to remaining recipients */
     1414    13979    3               DELIVERY_SUMMARY = '0'B;
     1415    13980    3               VM_DELIVERYKEY = INIT_DELIVERYKEY;
     1416    13981    3               HOG_COUNT = 0;
     1417    13982    4   DELIVER:    DO WHILE ('1'B); /* FOREVER */;
     1418    13983    4                   STATUS_STRING = 'Looking for an undelivered copy';
     1419    13984    4                   CALL UPDATE_STATUS;
     1420    13985    4                   CALL VMD$GET_DELIVERY_NEXT (DCBNUM(MAIL_IN), VM_DELIVERYKEY,
             13985                            VM_DELIVERY)
     1421    13986    5                   WHENALTRETURN DO;
     1422    13987    5                       EXIT DELIVER;
     1423    13988    5                   END;
     1424    13989    4                   IF NOT VM_DELIVERY.FLAGS.DONE
     1425    13990    5                   THEN DO;
     1426    13991    5                       CALL M$TIME (GET_CURRENT);
     1427    13992    5                       IF HOG_COUNT >= VO_HOG_LIMIT
     1428    13993    5                         AND TIME_TABLE.NEXT$ ~= ADDR(NIL)
     1429    13994    5                         AND TIME_TABLE.NEXT$ -> TIME_TABLE.TSTAMP <= CURRENT_TIME
     1430    13995    6                       THEN DO;
     1431    13996    6                           DELIVERY_SUMMARY.HOG_LIMIT = %YES#;
     1432    13997    6                           EXIT DELIVER;
     1433    13998    6                       END;
     1434    13999    5                       CALL REFRESH_INPUT_HEADER;
     1435    14000    5                       VM_RADDRESS = INIT_RADDRESS;
     1436    14001    5                       VM_RADDRESS.ACCT = VM_DELIVERYKEY.ACCT;
     1437    14002    5                       IF VM_DELIVERYKEY.PSID = ' '
     1438    14003    5                       THEN
     1439    14004    5                           VM_RADDRESS.FOLDER = VM_DELIVERYKEY.FOLDER;
     1440    14005    6                       ELSE DO;
     1441    14006    6                           VM_RADDRESS.NOMAD.PSID = VM_DELIVERYKEY.PSID;
     1442    14007    6                           VM_RADDRESS.NOMAD.DELIM = ' ';
     1443    14008    6                           VM_RADDRESS.NOMAD.FOLDER = VM_DELIVERYKEY.FOLDER;
     1444    14009    6                       END;
     1445    14010    5                       WORK_TEXTC.L# = LENGTHC(WORK_TEXTC.NAME#);
     1446    14011    5                       CALL VMF$MAKE_ADDRESS2 (WORK_TEXTC, VM_RADDRESS, %YES#);
     1447    14012    5                       CALL CONCAT (STATUS_STRING, 'Delivering to ',
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:129  
     1448    14013    5                         SUBSTR(WORK_TEXTC.NAME#, 0, WORK_TEXTC.L#));
     1449    14014    5                       CALL UPDATE_STATUS;
     1450    14015    5                       VM_HEADER.STATUS.FCOPY = %NO#;
     1451    14016    5                       IF VM_RADDRESS.ACCT = VM_RETURN_ADDRESS.ACCT
     1452    14017    5                         AND VM_RADDRESS.FOLDER = VM_RETURN_ADDRESS.FOLDER
     1453    14018    5                       THEN
     1454    14019    5                           VM_HEADER.STATUS.RR = %NO#;
     1455    14020    5                       UNDELIVERED = '0'B;
     1456    14021    5                       CALL VOM$SENDIT
     1457    14022    6                       WHENRETURN DO;
     1458    14023    6                           VM_DELIVERY.UTS_OF_DELIVERY = CURRENT_TIME;
     1459    14024    6                           VM_DELIVERY.FLAGS.DONE = %YES#;
     1460    14025    6                           VM_DELIVERY.ERR = '0'B;
     1461    14026    6                           HOG_COUNT = HOG_COUNT + 1;
     1462    14027    6                       END;
     1463    14028    6                       WHENALTRETURN DO;
     1464    14029    6                           DELIVERY_SUMMARY.BUSY = DELIVERY_SUMMARY.BUSY |
     1465    14030    6                             UNDELIVERED.BUSY;
     1466    14031    6                           DELIVERY_SUMMARY.PACKSET_NA = DELIVERY_SUMMARY.PACKSET_NA |
     1467    14032    6                             UNDELIVERED.PACKSET_NA;
     1468    14033    6                           VM_DELIVERY.ERR = ERROR;
     1469    14034    6                           VM_DELIVERY.UTS_OF_DELIVERY = CURRENT_TIME;
     1470    14035    6                           IF UNDELIVERED.IO_ERROR
     1471    14036    7                           THEN DO;
     1472    14037    7                               IF NOT VM_HEADER.STATUS.BROADCAST
     1473    14038    7                                 AND NOT VM_HEADER.STATUS.ERR
     1474    14039    8                               THEN DO;
     1475    14040    8                                   WORK_TEXTC.L# = VM_DELIVERY.COUNT;
     1476    14041    8                                   WORK_TEXTC.NAME# = VM_DELIVERY.TEXT;
     1477    14042    8                                   CALL RETURN_ERROR_MSG;
     1478    14043    8                               END;
     1479    14044    7                               VM_DELIVERY.FLAGS.DONE = %YES#;
     1480    14045    7                               VM_DELIVERY.FLAGS.REPORTED = %YES#;
     1481    14046    7                           END;
     1482    14047    6                       END;
     1483    14048    5                       CALL VMD$PUT_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY,
             14048                                VM_DELIVERY);
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:130  
     1484    14049    5                   END;
     1485    14050    4               END DELIVER;
     1486    14051    3               UNDELIVERED = DELIVERY_SUMMARY;
     1487    14052    3               IF DELIVERY_SUMMARY.HOG_LIMIT
     1488    14053    3               THEN
     1489    14054    3                   EXIT PROCESS; /* requeue & continue after smaller stuff */
     1490    14055    3               IF DELIVERY_SUMMARY.BUSY OR DELIVERY_SUMMARY.PACKSET_NA
     1491    14056    4               THEN DO;
     1492    14057    4                   CALL XUD$UTS_DIFF_25TH (UTS_X, CURRENT_TIME, VM_HEADER.
             14057                            FIRST_DELIVERY);
     1493    14058    4                   UTS_X = UTS_X/%UTS_25TH_HOUR#;
     1494    14059    4                   CALL XUD$UTS_ADJ_25TH (UTS_Y, VO_MAILMAN_STARTUP_TIME, %
             14059                            UTS_25TH_HOUR#);
     1495    14060    4                   IF (UTS_X < VO_MAX_HOLD_HOURS) OR (CURRENT_TIME < UTS_Y) THEN
     1496    14061    4                       EXIT PROCESS; /* requeue later */
     1497    14062    4               END;
     1498    14063
     1499    14064        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:131  
     1500    14065    3           CASE (%VM_PHASE_SEND_RECEIPT);
     1501    14066                /* Return a delivery receipt to the sender, if requested. */
     1502    14067    3               IF NOT VM_HEADER.STATUS.DR
     1503    14068    3               THEN
     1504    14069    3                   EXIT ONE_PHASE;
     1505    14070    3               STATUS_STRING = 'Creating delivery receipt';
     1506    14071    3               CALL UPDATE_STATUS;
     1507    14072        /*
     1508    14073           Create a virgin mailgram file for the delivery 'gram.
     1509    14074        */
     1510    14075    3               CALL CREATE_NEW_MAILGRAM (DCBNUM(MAIL_OUT)) ALTRET (BAD_MAIL);
     1511    14076        /*
     1512    14077           Address the receipt to the sender of the original mail, and no one else.
     1513    14078        */
     1514    14079    3               CALL CONSTRUCT_RETURN_ADDRESS (RETURN_ADDRESS_BUFFER,
     1515    14080    3                 SIZEW(RETURN_ADDRESS_BUFFER), VM_HEADER.RETURN_ADDRESS$ -> VM$RADDRESS
             14080                          )
     1516    14081    3                 ALTRET (BAD_MAIL);
     1517    14082
     1518    14083    3               CALL VMA$PUT_ADD_RECORD (%VM_TYPE_TO, VECTOR(RETURN_ADDRESS_BUFFER),
     1519    14084    3                 DCBNUM(MAIL_OUT));
     1520    14085        /*
     1521    14086           Flip around the header fields so that the DELIVERY packet points back to
     1522    14087           the original mailgram.
     1523    14088        */
     1524    14089    3               VM_HEADER.REFERS_TO_ID$ = VM_HEADER.UNIQUE_ID$;
     1525    14090    3               VM_HEADER.UNIQUE_ID$ = ADDR(NIL);
     1526    14091    3               VM_HEADER.STATUS.FCOPY = %NO#;
     1527    14092    3               VM_HEADER.STATUS.RR = %NO#;
     1528    14093    3               VM_HEADER.STATUS.DR = %NO#;
     1529    14094    3               VM_HEADER.STATUS.DELIVERY = %YES#;
     1530    14095    3               VM_HEADER.DELIVERY_DATE = CURRENT_TIME;
     1531    14096    3               VM_HEADER.FIRST_DELIVERY = 0;
     1532    14097        /*
     1533    14098           Scan through the delivery records;  emit one encoded mailgram-body record
     1534    14099           for each successfully-delivered copy of the mailgram.
     1535    14100        */
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:132  
     1536    14101    3               NUM_RECEIPTS = 0;
     1537    14102    3               VM_DELIVERYKEY = INIT_DELIVERYKEY;
     1538    14103    4               DO WHILE ('1'B); /* FOREVER */;
     1539    14104    5                   IF VO_NEED_READ THEN DO;
     1540    14105    5                       VO_NEED_READ = '0'B;
     1541    14106    5                       CALL M$READ (VO_READ_CG);
     1542    14107    5                   END;
     1543    14108    4                   IF VO_PROCESS THEN CALL VOM$PROCESS;
     1544    14109    4                   CALL VMD$GET_DELIVERY_NEXT (DCBNUM(MAIL_IN), VM_DELIVERYKEY,
             14109                            VM_DELIVERY) ALTRET (RECEIPTS_DONE);
     1545    14110    4                   IF VM_DELIVERY.FLAGS.DONE AND NOT VM_DELIVERY.FLAGS.FC
     1546    14111    4                     AND (VM_DELIVERY.ERR = '0'B OR VM_HEADER.STATUS.BROADCAST)
     1547    14112    5                   THEN DO;
     1548    14113    5                       VM_BODYREC_ENCODED = INIT_ENCODED_ERR_BODYREC;
     1549    14114    5                       IF VM_DELIVERY.ERR = '0'B
     1550    14115    5                       THEN
     1551    14116    5                           VM_BODYREC_ENCODED.VALUE.DATA.ERR = E_DELIVERED;
     1552    14117    5                       ELSE
     1553    14118    5                           VM_BODYREC_ENCODED.VALUE.DATA.ERR = VM_DELIVERY.ERR;
     1554    14119    5                       VM_BODYREC_ENCODED.VALUE.DATA.UTS = VM_DELIVERY.UTS_OF_DELIVERY;
     1555    14120    5                       DELIVERY.L = VM_DELIVERY.COUNT;
     1556    14121    5                       DELIVERY.C = VM_DELIVERY.TEXT;
     1557    14122    5                       VM_BODYREC_ENCODED.VALUE.DATA.STUFF = DELIVERY;
     1558    14123    5                       VM_BODYREC_ENCODED.VALUE.DATA.STUFF.PIECE (VM_DELIVERY.COUNT+1)
             14123                                = 0;
     1559    14124    5                       COUNT = LENGTHC (VM_BODYREC_ENCODED) -
     1560    14125    5                         LENGTHC(VM_BODYREC_ENCODED.VALUE.DATA.STUFF) +
     1561    14126    5                         VM_DELIVERY.COUNT + 2;
     1562    14127    5                       VM_BODYREC_ENCODED.VALUE.COUNT = COUNT;
     1563    14128    5                       CALL VMD$PUT_BODY (0, DCBNUM(MAIL_OUT), NUM_RECEIPTS, COUNT, ,
             14128                                VM_BODYREC_ENCODED) ALTRET (OOPS);
     1564    14129    5                       NUM_RECEIPTS = NUM_RECEIPTS + 1;
     1565    14130    5                   END;
     1566    14131    4               END;
     1567    14132    3   RECEIPTS_DONE:
     1568    14133    3               IF NUM_RECEIPTS > 0
     1569    14134    4               THEN DO;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:133  
     1570    14135    4                   VM_HEADER.NUM_RECORDS = NUM_RECEIPTS;
     1571    14136    4                   CALL VMD$PUT_HEADER (0, DCBNUM(MAIL_OUT)) ALTRET (OOPS);
     1572    14137    5                   CALL M$CLOSE (CLOSE_MAIL_OUT) WHENALTRETURN DO; END;
     1573    14138    4                   CALL VOM$ADDENTRY_SORTED (SCRATCH$, %NO#, TIME_HEAD$, DCBNUM(
             14138                            MAIL_OUT));
     1574    14139    4               END;
     1575    14140    4               ELSE DO;
     1576    14141    5   OOPS:           CALL M$CLOSE (CLOSE_MAIL_OUT_RELEASE) WHENALTRETURN DO; END;
     1577    14142    4               END;
     1578    14143
     1579    14144        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:134  
     1580    14145    3           CASE (%VM_PHASE_FINI);
     1581    14146                 /* Done.  No action. */
     1582    14147    3               STATUS_STRING = 'Delivery completed';
     1583    14148    3               CALL UPDATE_STATUS;
     1584    14149    3           END ONE_PHASE;
     1585    14150        /*
     1586    14151              At this point, we should reread the header and update the delivery
     1587    14152              phase.
     1588    14153        */
     1589    14154    2           CALL REFRESH_INPUT_HEADER ALTRET (BAD_MAIL);
     1590    14155    2           VM_HEADER.MISC.PHASE = MINIMUM (VM_HEADER.MISC.PHASE + 1, %VM_PHASE_FINI);
     1591    14156    2           CALL VMD$PUT_HEADER (0, DCBNUM(MAIL_IN)) ALTRET (BAD_MAIL);
     1592    14157    2       END PROCESS;
     1593    14158        /*
     1594    14159              ***** Release as many packsets as we can manage once we exit from the
     1595    14160                    main process loop.
     1596    14161        */
     1597    14162    1       CALL M$DISPRES (REL_PACK) ALTRET (RELEASED);
     1598    14163    1       CALL M$RELRES (REL_PACK) ALTRET (RELEASED);
     1599    14164    1   RELEASED: ;
     1600    14165
     1601    14166        /*
     1602    14167              ***** Delete this mailgram from the time chain.  If the flags indicating
     1603    14168                    "delivery not yet complete" are set, calculate a redelivery time
     1604    14169                    and put it back on the time chain;  otherwise, release the file.
     1605    14170        */
     1606    14171    1       CALL VOM$DELENTRY (TIME$,%NO#,TIME_HEAD$);
     1607    14172    1       IF UNDELIVERED.BUSY OR UNDELIVERED.PACKSET_NA OR UNDELIVERED.HOG_LIMIT
     1608    14173    2       THEN DO;
     1609    14174    2           IF UNDELIVERED.HOG_LIMIT
     1610    14175    2           THEN
     1611    14176    2               DELAY_TIME = 0;
     1612    14177    2           ELSE
     1613    14178    2               IF UNDELIVERED.BUSY
     1614    14179    2               THEN
     1615    14180    2                   DELAY_TIME = VO_BUSY_RETRY_MINUTES;
     1616    14181    2               ELSE
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:135  
     1617    14182    2                   DELAY_TIME = VO_PACKSET_RETRY_MINUTES;
     1618    14183    2           CALL M$TIME (GET_CURRENT);
     1619    14184    2           CALL REFRESH_INPUT_HEADER;
     1620    14185    2           CALL XUD$UTS_ADJ_25TH (VM_HEADER.DELIVERY_DATE, CURRENT_TIME, DELAY_TIME * %
             14185                    UTS_25TH_MIN#);
     1621    14186    2           CALL VMD$PUT_HEADER (0, DCBNUM(MAIL_IN));
     1622    14187    2           CALL VOM$ADDENTRY_SORTED (TIME$, %NO#, TIME_HEAD$, DCBNUM(MAIL_IN));
     1623    14188    2           CALL M$CLOSE (CLOSE_MAILIN_SAVE)
     1624    14189    3           WHENALTRETURN DO;
     1625    14190    3           END;
     1626    14191    2       END;
     1627    14192    1       ELSE
     1628    14193    1           CALL M$CLOSE (CLOSE_MAILIN_SCRATCH);
     1629    14194    1       RETURN;
     1630    14195        /**/
     1631    14196    1   BAD_MAIL:;
     1632    14197    1       ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     1633    14198    1       NEW_NAME = DCBADDR(DCBNUM(MAIL_IN)) -> F$DCB.NAME#;
     1634    14199    1       SUBSTR(NEW_NAME.NAME#,1,4)='DEAD';
     1635    14200    1       CALL M$CLOSE (RENAME_BAD_FILE) ALTRET (RENAME_DIDNT_WORK);
     1636    14201    1   RENAME_DIDNT_WORK: ;
     1637    14202    1       CALL M$DISPRES (REL_PACK) ALTRET (TOSS_IT);
     1638    14203    1       CALL M$RELRES (REL_PACK) ALTRET (TOSS_IT);
     1639    14204    1   TOSS_IT:
     1640    14205    2       CALL M$CLOSE (CLOSE_MAILIN_SCRATCH) WHENALTRETURN DO; END;
     1641    14206    1       CALL VOM$DELENTRY(TIME$,%NO#,TIME_HEAD$);
     1642    14207    1       RETURN;
     1643    14208        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:136  
     1644    14209    1   REFRESH_INPUT_HEADER: PROC ALTRET;
     1645    14210
     1646    14211    2       CALL VMD$GET_HEADER (0, DCBNUM(MAIL_IN))
     1647    14212    3       WHENALTRETURN DO;
     1648    14213    3           ALTRETURN;
     1649    14214    3       END;
     1650    14215
     1651    14216        /*
     1652    14217             ***** Setup HEADER_MCB ...
     1653    14218                   NOTE: After every call to X$ALLOCATE or X$DEALLOCATE
     1654    14219                   it is important that VM_HEADER.NEXT$ and FREE$ be
     1655    14220                   updated from HEADER_MCB.HI_SEGMENT$ and FREE_HEAD$ ...
     1656    14221        */
     1657    14222    2       HEADER_MCB.TYPE = 0;
     1658    14223    2       HEADER_MCB.MIN_SIZE = 12;
     1659    14224    2       HEADER_MCB.SEGMENT_BASE$ = VM_HEADER$;
     1660    14225    2       HEADER_MCB.HI_SEGMENT$ = VM_HEADER.NEXT$;
     1661    14226    2       HEADER_MCB.FREE_HEAD$ = VM_HEADER.FREE$;
     1662    14227    2       HEADER_MCB.WKSZ = (VBOUND(VM_HEADER_)+1)/4;
     1663    14228
     1664    14229    2       RETURN;
     1665    14230
     1666    14231    2   END REFRESH_INPUT_HEADER;
     1667    14232        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:137  
     1668    14233    1   ASSIGN_A_MESSAGE_ID: PROC ALTRET;
     1669    14234
     1670    14235        /*
     1671    14236             ***** Construct a unique-ID string for this message, and put it
     1672    14237                   in the header.  The strings take the form:
     1673    14238
     1674    14239                 <yymmdd.hhmmssss@CP6>
     1675    14240
     1676    14241                   This code is executed when MAILMAN first processes any message
     1677    14242                   that does not already have a unique ID;  such messages may include
     1678    14243                   MAILMAN-generated packets such as ERRs and DELIVs, as well as
     1679    14244                   intersystem messages that originate in pre-B00 mail environments.
     1680    14245        */
     1681    14246
     1682    14247    2       WORK_TIME = VM_HEADER.CREATION_DATE;
     1683    14248    2       CALL M$TIME (GET_ANSI_TIME);
     1684    14249    2       CALL CONCAT (ID, '<', ANSI_DATE, '.', ANSI_TIME, '@CP6>');
     1685    14250    2       CALL INDEX (COUNT, ' ', ID);
     1686    14251    2       HEADER_MCB.SIZE = COUNT + 1;
     1687    14252    2       HEADER_MCB.TYPE = 0;
     1688    14253    2       HEADER_MCB.MIN_SIZE = 3;
     1689    14254    2       HEADER_MCB.SEGMENT_BASE$ = VM_HEADER$;
     1690    14255    2       HEADER_MCB.HI_SEGMENT$ = VM_HEADER.NEXT$;
     1691    14256    2       HEADER_MCB.FREE_HEAD$ = VM_HEADER.FREE$;
     1692    14257    2       HEADER_MCB.WKSZ = (VBOUND(VM_HEADER_)+1)/4;
     1693    14258    2       CALL X$ALLOCATE (HEADER_MCB) ALTRET (E_ALLOCATE);
     1694    14259    2       VM_HEADER.NEXT$ = PINCRW(HEADER_MCB.HI_SEGMENT$,1);
     1695    14260    2       VM_HEADER.UNIQUE_ID$ = HEADER_MCB.ADDRESS$;
     1696    14261    2       VM_HEADER.UNIQUE_ID$ -> X$STRING.SIZ = COUNT;
     1697    14262    2       VM_HEADER.UNIQUE_ID$ -> X$STRING.TEXT = ID;
     1698    14263
     1699    14264    2       RETURN;
     1700    14265
     1701    14266    2   E_ALLOCATE: ALTRETURN;
     1702    14267
     1703    14268    2   END ASSIGN_A_MESSAGE_ID;
     1704    14269        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:138  
     1705    14270    1   UPDATE_STATUS: PROC;
     1706    14271
     1707    14272    2   DCL I SBIN;
     1708    14273
     1709    14274    2       IF NOT B$JIT.PRIV.ACTIVE.JIT
     1710    14275    2       THEN
     1711    14276    2           RETURN;
     1712    14277
     1713    14278    2       CALL INDEX (I, '  ', STATUS_STRING);
     1714    14279    2       B$JIT.CCBUF = STATUS_STRING;
     1715    14280    2       B$JIT.CCARS = I;
     1716    14281
     1717    14282    2       RETURN;
     1718    14283
     1719    14284    2   END UPDATE_STATUS;
     1720    14285        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:139  
     1721    14286    1   GET_ADD_RECORD: PROC ALTRET;
     1722    14287                            /* If this message originated off-site, then only look for
     1723    14288                               the intersys keys. */
     1724    14289    2       PTR$ = ADDR(NIL);
     1725    14290    2       IF INTERSYS_ACTIVE
     1726    14291    3       THEN DO;
     1727    14292    3           ADD_TYPE = ADD_TYPE+1;
     1728    14293    3           CALL VMA$GET_ADD_RECORD (ADD_TYPE,VM_ADDREC_,DCBNUM(MAIL_IN))
     1729    14294    4           WHENALTRETURN DO;
     1730    14295    4               ADD_TYPE = ADD_TYPE-1;
     1731    14296    4               ALTRETURN;
     1732    14297    4           END;
     1733    14298    3           ADD_TYPE = ADD_TYPE-1;
     1734    14299    3       END;
     1735    14300    3       ELSE DO;
     1736    14301    3           CALL VMA$GET_ADD_RECORD (ADD_TYPE,VM_ADDREC_,DCBNUM(MAIL_IN))
     1737    14302    4           WHENALTRETURN DO;
     1738    14303    4               ALTRETURN;
     1739    14304    4           END;
     1740    14305    3       END;
     1741    14306    2       PTR$ = VM_ADDREC$ -> VM_ADD_HEAD.HEAD$;
     1742    14307    2       RETURN;
     1743    14308    2   END GET_ADD_RECORD;
     1744    14309        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:140  
     1745    14310    1   INIT_DELIVERY_RECORD: PROC;
     1746    14311
     1747    14312        /*I*  NAME:    INIT_DELIVERY_RECORD
     1748    14313              CALL:    CALL INIT_DELIVERY_RECORD;
     1749    14314              INPUT:   Global VM_RADDRESS.
     1750    14315              OUTPUT:  Global VM_DELIVERY record initialized;
     1751    14316                       global VM_DELIVERYKEY record initialized.
     1752    14317              DESCRIPTION: Given a resolved address, INIT_DELIVERY_RECORD creates the
     1753    14318                           appropriate delivery-record information.
     1754    14319        */
     1755    14320
     1756    14321
     1757    14322    2       VM_DELIVERY = INIT_DELIVERY;
     1758    14323
     1759    14324    3       DO CASE (ADD_TYPE);
     1760    14325
     1761    14326    3       CASE (%VM_TYPE_TO); VM_DELIVERY.FLAGS.PRIMARY = %YES#;
     1762    14327    3       CASE (%VM_TYPE_C); VM_DELIVERY.FLAGS.C = %YES#;
     1763    14328    3       CASE (%VM_TYPE_BC); VM_DELIVERY.FLAGS.BC = %YES#;
     1764    14329
     1765    14330    3       END;
     1766    14331
     1767    14332    2       VM_DELIVERYKEY = INIT_DELIVERYKEY;
     1768    14333
     1769    14334    2       VM_DELIVERYKEY.ACCT = VM_RADDRESS.ACCT;
     1770    14335
     1771    14336    2       IF VM_RADDRESS.NOMAD.DELIM = ' ' AND VM_RADDRESS.NOMAD.PSID ~= ' '
     1772    14337    3       THEN DO;
     1773    14338    3           VM_DELIVERYKEY.PSID = VM_RADDRESS.NOMAD.PSID;
     1774    14339    3           VM_DELIVERYKEY.FOLDER = VM_RADDRESS.NOMAD.FOLDER;
     1775    14340    3       END;
     1776    14341    2       ELSE
     1777    14342    2           VM_DELIVERYKEY.FOLDER = VM_RADDRESS.FOLDER;
     1778    14343
     1779    14344    2       IF VM_DELIVERYKEY.FOLDER = ' '
     1780    14345    2       THEN
     1781    14346    2           VM_DELIVERYKEY.FOLDER = 'CENTRAL';
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:141  
     1782    14347
     1783    14348    2       RETURN;
     1784    14349
     1785    14350    2   END INIT_DELIVERY_RECORD;
     1786    14351        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:142  
     1787    14352    1   FILL_IN_DELIVERY_RECORD: PROC;
     1788    14353
     1789    14354        /*I*  NAME:    FILL_IN_DELIVERY_RECORD
     1790    14355              CALL:    CALL FILL_IN_DELIVERY_RECORD;
     1791    14356              INPUT:   Global VM_RADDRESS and VM_UADDRESS;
     1792    14357                       global VM_DELIVERY.
     1793    14358              OUTPUT:  User name filled into VM_DELIVERY.
     1794    14359
     1795    14360              DESCRIPTION: Given an unresolved address, FILL_IN_DELIVERY_RECORD copies
     1796    14361                           the user-name information, if any, into the delivery record.
     1797    14362        */
     1798    14363
     1799    14364    2       WORK_TEXTC.L# = LENGTHC(WORK_TEXTC.NAME#);
     1800    14365
     1801    14366    2       IF VM_RADDRESS.TYPE = %VM_ADD_UNRESOLVED
     1802    14367    2       THEN
     1803    14368    2           CALL VMF$MAKE_ADDRESS2 (WORK_TEXTC,VM_RADDRESS,%YES#);
     1804    14369    2       ELSE
     1805    14370    2           CALL VMF$MAKE_ADDRESS2 (WORK_TEXTC,VM_UADDRESS,%YES#);
     1806    14371
     1807    14372    2       VM_DELIVERY.COUNT = WORK_TEXTC.L#;
     1808    14373    2       VM_DELIVERY.TEXT = WORK_TEXTC.NAME#;
     1809    14374
     1810    14375    2       RETURN;
     1811    14376
     1812    14377    2   END FILL_IN_DELIVERY_RECORD;
     1813    14378        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:143  
     1814    14379    1   GENERATE_AN_ERROR_ENTRY: PROC;
     1815    14380
     1816    14381    2       CALL INIT_DELIVERY_RECORD;
     1817    14382    2       WORK_TEXTC.L# = LENGTHC(WORK_TEXTC.NAME#);
     1818    14383    2       IF VM_RADDRESS.TYPE = %VM_ADD_RESOLVED
     1819    14384    2       THEN
     1820    14385    2           CALL VMF$MAKE_ADDRESS2 (WORK_TEXTC,VM_RADDRESS,%YES#);
     1821    14386    2       ELSE
     1822    14387    2           CALL VMF$MAKE_ADDRESS2 (WORK_TEXTC,VM_UADDRESS,%YES#);
     1823    14388    2       VM_DELIVERY.COUNT = WORK_TEXTC.L#;
     1824    14389    2       VM_DELIVERY.TEXT = WORK_TEXTC.NAME#;
     1825    14390    2       VM_DELIVERY.UTS_OF_DELIVERY = CURRENT_TIME;
     1826    14391    2       VM_DELIVERY.FLAGS.DONE = %YES#;
     1827    14392    2       VM_DELIVERY.ERR = ERROR;
     1828    14393    2       CALL VMD$PUT_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY, VM_DELIVERY);
     1829    14394
     1830    14395    2       RETURN;
     1831    14396
     1832    14397    2   END GENERATE_AN_ERROR_ENTRY;
     1833    14398        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:144  
     1834    14399    1   RETURN_ERROR_MSG: PROC ALTRET;
     1835    14400        /*
     1836    14401             ***** This routine expects error and WORK_TEXTC to
     1837    14402                   be setup upon entry to this routine. WORK_TEXTC
     1838    14403                   will be returned as the address that caused the
     1839    14404                   error stored in error ...
     1840    14405        */
     1841    14406
     1842    14407    2   DCL SET_FCOPY_FLAG BIT (1);
     1843    14408
     1844    14409    2       SET_FCOPY_FLAG = %NO#;
     1845    14410    2       CALL REFRESH_INPUT_HEADER;
     1846    14411    2       HEADER_MCB.SIZE = WORK_TEXTC.L# + 1;
     1847    14412    2       CALL X$ALLOCATE (HEADER_MCB)
     1848    14413    2       WHENALTRETURN
     1849    14414    3       DO;
     1850    14415    3           CALL VMA$ENLARGE_SEGMENT (VM_HEADER_,1024) ALTRET(BAD_MAIL);
     1851    14416    3           HEADER_MCB.WKSZ = (VBOUND(VM_HEADER_)+1)/4;
     1852    14417    3           CALL X$ALLOCATE (HEADER_MCB) ALTRET(BAD_MAIL);
     1853    14418    3       END;
     1854    14419    2       VM_HEADER.BAD_ADDRESS$ = HEADER_MCB.ADDRESS$;
     1855    14420    2       VM_HEADER.BAD_ADDRESS$ -> X$STRING.SIZ = WORK_TEXTC.L#;
     1856    14421    2       VM_HEADER.BAD_ADDRESS$ -> X$STRING.TEXT = WORK_TEXTC.NAME#;
     1857    14422    2       VM_HEADER.ERROR = ERROR;
     1858    14423    2       VM_HEADER.NEXT$ = HEADER_MCB.HI_SEGMENT$;
     1859    14424    2       VM_HEADER.FREE$ = HEADER_MCB.FREE_HEAD$;
     1860    14425    2       VM_HEADER.STATUS.ERR = %YES#;
     1861    14426    2       VM_HEADER.STATUS.RR = %NO#;
     1862    14427    2       VM_HEADER.STATUS.DR = %NO#;
     1863    14428    2       VM_HEADER.DELIVERY_DATE = CURRENT_TIME;
     1864    14429    2       VM_HEADER.FIRST_DELIVERY = 0;
     1865    14430        /*
     1866    14431           Create a virgin mailgram file for the ERR packet.
     1867    14432        */
     1868    14433    2       CALL CREATE_NEW_MAILGRAM (DCBNUM(MAIL_OUT)) ALTRET (BAD_MAIL);
     1869    14434        /*
     1870    14435           Address the ERR to the sender of the original mail, and no one else.
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:145  
     1871    14436        */
     1872    14437    2       CALL CONSTRUCT_RETURN_ADDRESS (RETURN_ADDRESS_BUFFER,
     1873    14438    2         SIZEW(RETURN_ADDRESS_BUFFER), VM_HEADER.RETURN_ADDRESS$ -> VM$RADDRESS)
     1874    14439    2         ALTRET (BAD_MAIL);
     1875    14440    2       CALL VMA$PUT_ADD_RECORD (%VM_TYPE_TO, VECTOR(RETURN_ADDRESS_BUFFER),
     1876    14441    2         DCBNUM(MAIL_OUT));
     1877    14442        /*
     1878    14443           If a file copy was requested by the sender, and successfully delivered,
     1879    14444           then send an empty-bodied ERR mailgram referencing the unique-ID of the
     1880    14445           original, and with no ID of its own.  If a file copy was not delivered,
     1881    14446           then return this mailgram to its sender with an ERR token attached,
     1882    14447           and with the unique-ID set up to make the ERR (with body) appear as if
     1883    14448           it were a direct copy of the original.
     1884    14449        */
     1885    14450    2       IF VM_HEADER.STATUS.FCOPY
     1886    14451    3       THEN DO;
     1887    14452    3           VM_HEADER.REFERS_TO_ID$ = VM_HEADER.UNIQUE_ID$;
     1888    14453    3           VM_HEADER.UNIQUE_ID$ = ADDR(NIL);
     1889    14454    3           VM_HEADER.STATUS.FCOPY = %NO#;
     1890    14455    3           CALL VMD$PUT_HEADER (0, DCBNUM(MAIL_OUT));
     1891    14456    3       END;
     1892    14457    3       ELSE DO;
     1893    14458    3           SET_FCOPY_FLAG = %YES#;
     1894    14459    3           CALL VMM$COPY_MESSAGE_BODY (0,0,DCBNUM(MAIL_IN),DCBNUM(MAIL_OUT),0,0);
     1895    14460    3       END;
     1896    14461    2       CALL VOM$ADDENTRY_SORTED (SCRATCH$, %NO#, TIME_HEAD$, DCBNUM(MAIL_OUT));
     1897    14462    2       CALL M$CLOSE (CLOSE_MAIL_OUT) ALTRET (BAD_MAIL);
     1898    14463    2   BAD_MAIL:
     1899    14464    2       CALL REFRESH_INPUT_HEADER;
     1900    14465        /*
     1901    14466           If we just sent an ERR-with-body back to the sender, then set the FCOPY
     1902    14467           bit in the mailgram's header & rewrite it to the file, so that this doesn't
     1903    14468           happen more than once (per system).
     1904    14469        */
     1905    14470    2       IF SET_FCOPY_FLAG
     1906    14471    3       THEN DO;
     1907    14472    3           VM_HEADER.STATUS.FCOPY = %YES#;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:146  
     1908    14473    3           CALL VMD$PUT_HEADER (0, DCBNUM(MAIL_IN));
     1909    14474    3       END;
     1910    14475    2   END RETURN_ERROR_MSG;
     1911    14476        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:147  
     1912    14477    1   CREATE_NEW_MAILGRAM: PROC (DCB#) ALTRET;
     1913    14478        /*I*  NAME:    CREATE_NEW_MAILGRAM
     1914    14479              CALL:    CALL CREATE_NEW_MAILGRAM (dcb#);
     1915    14480              DESCRIPTION: Opens a new, empty mailgram file through the specified DCB.
     1916    14481                       The name is generated via the standard time-based algorithm.
     1917    14482        */
     1918    14483
     1919    14484    2   DCL DCB# UBIN WORD;
     1920    14485
     1921    14486          %FPT_OPEN(FPTN=CREATE_SEND,ACS=DIRECT,
     1922    14487                    ASN=FILE,
     1923    14488                    ACCT=VM_MAIL_ACCT,
     1924    14489                    NAME=SEND_NAME,
     1925    14490                    SCRUB=YES,
     1926    14491                    ORG=KEYED,
     1927    14492                    FUN=CREATE,
     1928    14493                    EXIST=ERROR);
     1929    14602
     1930    14603          %VLP_NAME (FPTN=SEND_NAME,LEN=31,NAME='                         ');
     1931    14630
     1932    14631    2   DCL SEND_STRING CHAR (26);
     1933    14632
     1934    14633    2   MAKE_FILENAME:
     1935    14634    2       CALL M$TIME(GET_CURRENT);
     1936    14635    2       CALL BINCHAR(SEND_STRING, CURRENT_TIME);
     1937    14636    2       CALL CONCAT(SEND_NAME.NAME#,':MESS',SEND_STRING);
     1938    14637    2       SEND_NAME.L# = SIZEC(SEND_NAME.NAME#);
     1939    14638    2       CREATE_SEND.V.DCB# = DCB#;
     1940    14639    2       CALL M$OPEN(CREATE_SEND)
     1941    14640    3       WHENALTRETURN DO;
     1942    14641    3           IF B$TCB.ALT$ -> B$ALT.ERR.ERR# = %E$CREATERR
     1943    14642    4           THEN DO;
     1944    14643    4               CALL M$WAIT (WAIT2);
     1945    14644    4               GOTO MAKE_FILENAME;
     1946    14645    4           END;
     1947    14646    3           ALTRETURN;
     1948    14647    3       END;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:148  
     1949    14648
     1950    14649    2       RETURN;
     1951    14650
     1952    14651    2   END CREATE_NEW_MAILGRAM;
     1953    14652        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:149  
     1954    14653    1   CONSTRUCT_RETURN_ADDRESS: PROC (BUFFER, BUFSIZE, ADDRESS) ALTRET;
     1955    14654
     1956    14655        /*I*  NAME: CONSTRUCT_RETURN_ADDRESS
     1957    14656              CALL: CALL CONSTRUCT_RETURN_ADDRESS (buffer, buffer_size, address)
     1958    14657                          ALTRET (not_enough_space);
     1959    14658              INPUT: "buffer" is a scratch memory area;
     1960    14659                     "buffer_size" is the LENGTHW(buffer);
     1961    14660                     "address" is a VM_RADDRESS structure containing a valid mail
     1962    14661                          address.
     1963    14662              OUTPUT:  BUFFER will contain an address structure that can be written
     1964    14663                          to a mailgram as a "TO", "C", or "BC" record.
     1965    14664              DESCRIPTION: This proc may be used to encapsulate a VM_RADDRESS structure
     1966    14665                          with the necessary VM_ADD_HEAD structure in an arbitrary
     1967    14666                          buffer in memory.  Pointers placed within the structures
     1968    14667                          reflect the assumption that the resulting structure will be
     1969    14668                          read into the segment currently allocated in VM_ADDREC_.
     1970    14669        */
     1971    14670
     1972    14671    2   DCL BUFFER (0:0) UBIN WORD;
     1973    14672    2   DCL BUFSIZE UBIN WORD;
     1974    14673        %VM_RADDRESS (NAME=ADDRESS, STCLASS=PARAM);
     1975    14708
     1976    14709        %VM_RADDRESS (NAME=VM_RADDRESS, STCLASS=BASED);
     1977    14744        %VM_ADD_HEAD (NAME=VM_ADD_HEAD, STCLASS=BASED);
     1978    14773        %VM_ADD_HEAD (NAME=INIT_ADD_HEAD, STCLASS=CONSTANT);
     1979    14802
     1980    14803    2   DCL REAL_HEAD$ PTR;
     1981    14804    2   DCL FAKE_HEAD$ PTR;
     1982    14805    2   DCL REAL_ADDRESS$ PTR;
     1983    14806    2   DCL FAKE_ADDRESS$ PTR;
     1984    14807    2   DCL BLOCKSIZE UBIN WORD BASED;
     1985    14808
     1986    14809    2       IF BUFSIZE < SIZEW(VM_RADDRESS) + SIZEW(VM_ADD_HEAD) + 5
     1987    14810    2       THEN
     1988    14811    2           ALTRETURN;
     1989    14812
     1990    14813    2       REAL_HEAD$ = ADDR(BUFFER);
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:150  
     1991    14814    2       FAKE_HEAD$ = VBASE(VM_ADDREC_);
     1992    14815
     1993    14816    2       REAL_ADDRESS$ = PINCRW(REAL_HEAD$, SIZEW(VM_ADD_HEAD));
     1994    14817    2       FAKE_ADDRESS$ = PINCRW(FAKE_HEAD$, SIZEW(VM_ADD_HEAD));
     1995    14818
     1996    14819    2       REAL_HEAD$ -> VM_ADD_HEAD = INIT_ADD_HEAD;
     1997    14820    2       REAL_HEAD$ -> VM_ADD_HEAD.NUM_ENTRIES = 1;
     1998    14821    2       REAL_HEAD$ -> VM_ADD_HEAD.HEAD$ = FAKE_ADDRESS$;
     1999    14822    2       REAL_HEAD$ -> VM_ADD_HEAD.NEXT$ = PINCRW(FAKE_ADDRESS$, SIZEW(VM_RADDRESS));
     2000    14823    2       REAL_HEAD$ -> VM_ADD_HEAD.ADDRESS_SIZE = SIZEW(VM_RADDRESS) +
     2001    14824    2         SIZEW(VM_ADD_HEAD) + 5;
     2002    14825
     2003    14826    2       PINCRW(REAL_ADDRESS$, -1) -> BLOCKSIZE = SIZEW(VM_RADDRESS);
     2004    14827
     2005    14828    2       REAL_ADDRESS$ -> VM_RADDRESS = ADDRESS;
     2006    14829    2       REAL_ADDRESS$ -> VM_RADDRESS.NEXT$ = ADDR(NIL);
     2007    14830    2       REAL_ADDRESS$ -> VM_RADDRESS.PREV$ = ADDR(NIL);
     2008    14831
     2009    14832    2       RETURN;
     2010    14833
     2011    14834    2   END CONSTRUCT_RETURN_ADDRESS;
     2012    14835        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:151  
     2013    14836    1   ENQ_ON_PROFILE: PROC ALTRET;
     2014    14837
     2015    14838                            /* Enq the profile.  Time out every two seconds to look for
     2016    14839                               comgroup activity.  If 10 seconds elapse, assume that the
     2017    14840                               mailbox is somehow being locked out by a malicious
     2018    14841                               (or disconnected) user; altreturn.
     2019    14842                            */
     2020    14843
     2021    14844    2   DCL I SBIN;
     2022    14845
     2023    14846    2       I = 10;
     2024    14847    3       DO UNTIL I <= 0;
     2025    14848    3           CALL M$ENQ (ENQ_PROFILE)
     2026    14849    4           WHENRETURN DO;
     2027    14850    4               RETURN;
     2028    14851    4           END;
     2029    14852    4           WHENALTRETURN DO;
     2030    14853    4               ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     2031    14854    4               IF ERROR.ERR# ~= %E$TIMELIMIT
     2032    14855    4               THEN
     2033    14856    4                   CALL M$ERR;     /* Should never happen */
     2034    14857    5               ELSE DO;
     2035    14858    5                   IF VO_NEED_READ
     2036    14859    6                   THEN DO;
     2037    14860    6                       VO_NEED_READ = '0'B;
     2038    14861    6                       CALL M$READ (VO_READ_CG);
     2039    14862    6                   END;
     2040    14863    5                   IF VO_PROCESS
     2041    14864    5                   THEN
     2042    14865    5                       CALL VOM$PROCESS;
     2043    14866    5               END;
     2044    14867    4               I = I - 2;
     2045    14868    4           END;
     2046    14869    3       END;
     2047    14870    2       ALTRETURN;
     2048    14871    2   END ENQ_ON_PROFILE;
     2049    14872        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:152  
     2050    14873    1   QUEUE_INTERSYS: PROC ALTRET;
     2051    14874
     2052    14875    2       IF NOT VO_INTERSYS_ALLOWED
     2053    14876    3       THEN DO;
     2054    14877    3           ERROR = E_INTERSYSILL;
     2055    14878    3           ALTRETURN;
     2056    14879    3       END;
     2057    14880
     2058    14881    2       CALL BUILD_INTERSYS_LIST
     2059    14882    3       WHENALTRETURN DO;
     2060    14883    3           ALTRETURN;
     2061    14884    3       END;
     2062    14885
     2063    14886    2       RETURN;
     2064    14887
     2065    14888    2   END QUEUE_INTERSYS;
     2066    14889
     2067    14890        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:153  
     2068    14891    1   VOM$SENDIT: PROC ALTRET;
     2069    14892    2   DCL DLOCK_SEND BIT(1);
     2070    14893
     2071    14894
     2072    14895    2   DCL TYPE SBIN;
     2073    14896    2   DCL I SBIN WORD;
     2074    14897    2   DCL J SBIN WORD;
     2075    14898    2   DCL FORWARD BIT (1);
     2076    14899    2   DCL ANOTHER_USER BIT(1) ALIGNED;
     2077    14900    2   DCL COMBINED BIT (1);
     2078    14901    2   DCL SEND_CURR$ PTR ALIGNED;
     2079    14902    2   DCL TIME_CURR$ PTR ALIGNED;
     2080    14903    2   DCL SAVED_FLAGS BIT (36);
     2081    14904        /***** External routines *****/
     2082    14905    2   DCL VMA$GET_ADD_RECORD ENTRY(4) ALTRET;
     2083    14906    2   DCL VMA$PUT_ADD_RECORD ENTRY(4) ALTRET;
     2084    14907    2   DCL VMA$OPEN_FOLDER   ENTRY(5) ALTRET;
     2085    14908    2   DCL VMD$GET_PROFILE   ENTRY(1) ALTRET;
     2086    14909    2   DCL VMD$PUT_PROFILE   ENTRY(1) ALTRET;
     2087    14910    2   DCL VMD$PUT_HEADER ENTRY(2) ALTRET;
     2088    14911    2   DCL VMM$COPY_MESSAGE ENTRY(6) ALTRET;
     2089    14912        %FPT_WRITE(FPTN=WRITE_MAILCG,STCLASS="SYMREF",
     2090    14913                   BUF=VM_CGBUFFER);
     2091    14944
     2092    14945        %FPT_CLOSE (FPTN=CLOSE_MAIL_FILECOPY,
     2093    14946                    STCLASS=CONSTANT,
     2094    14947                    DCB=MAIL_FILECOPY,
     2095    14948                    DISP=SAVE);
     2096    14990
     2097    14991        %VM_FOLDER_INFO (NAME=FILE_FOLDER_INFO, STCLASS=AUTO);
     2098    15043
     2099    15044    2       CALL M$TIME(GET_CURRENT);
     2100    15045
     2101    15046    2       TIME_CURR$ = TIME$;
     2102    15047        /*
     2103    15048             ***** Deliver the message ...
     2104    15049        */
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:154  
     2105    15050    2   GO_ON:;
     2106    15051    2       VM_FOLDER_INFO.FLAGS = %NO#;
     2107    15052    2       CALL VMA$OPEN_FOLDER (VM_FOLDER_INFO,ADDR(VM_RADDRESS),DCBNUM(MAIL_OUT),
     2108    15053    2         %OLDFILE#,%UPDATE#)
     2109    15054    3       WHENALTRETURN DO;
     2110    15055    3           ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     2111    15056    4           DO SELECT (ERROR.ERR#);
     2112    15057    4               SELECT (%E$NOFILE);
     2113    15058    4               ERROR = E_NOMID;
     2114    15059    4               UNDELIVERED.IO_ERROR = %YES#;
     2115    15060    4               SELECT (%E$FILEBUSY);
     2116    15061    4               UNDELIVERED.BUSY = %YES#;
     2117    15062    4               SELECT (%E$FD, %E$FDIO, %E$PAD, %E$PADIO, %E$FIT, %E$FITIO, %E$BADFIT,
     2118    15063    4                 %E$GP, %E$GPIO, %E$MAD, %E$MADIO, %E$NONEWU, %E$BADVOL,
     2119    15064    4                 %E$XCLSET, %E$SETDOWN, %E$DUPSN, %E$SPLITRES);
     2120    15065    4               UNDELIVERED.PACKSET_NA = %YES#;
     2121    15066    4               SELECT (ELSE);
     2122    15067    4           UNDELIVERED.IO_ERROR = %YES#;
     2123    15068    4           END;
     2124    15069    3       ALTRETURN;
     2125    15070    3       END;
     2126    15071    2       CALL ENQ_ON_PROFILE
     2127    15072    3       WHENALTRETURN DO;
     2128    15073    4           CALL M$CLOSE (CLOSE_MAIL_OUT) WHENALTRETURN DO; END;
     2129    15074    3           UNDELIVERED.BUSY = %YES#;
     2130    15075    3           ALTRETURN;
     2131    15076    3       END;
     2132    15077    2       CALL VMD$GET_PROFILE(DCBNUM(MAIL_OUT))
     2133    15078    3       WHENALTRETURN DO;
     2134    15079    3           ERROR = E_PROERR;
     2135    15080    3           GOTO ERROR_RETURN;
     2136    15081    3       END;
     2137    15082        /*
     2138    15083              ***** Try combining this mailgram with another one.
     2139    15084        */
     2140    15085    2       IF (VM_HEADER.STATUS.ACK OR VM_HEADER.STATUS.ANSWER OR VM_HEADER.STATUS.RRACK
     2141    15086    2         OR VM_HEADER.STATUS.ERR OR VM_HEADER.STATUS.DELIVERY)
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:155  
     2142    15087    2         AND VM_HEADER.REFERS_TO_ID$ ~= ADDR(NIL)
     2143    15088    2       THEN
     2144    15089    3   UPDATE_ORIGINAL: DO;
     2145    15090    3           SAVED_FLAGS = VM_HEADER.STATUS;
     2146    15091    3           COMBINED = %NO#;
     2147    15092        /*
     2148    15093           This folder may have a separate file folder associated with it.
     2149    15094           If so, then a copy of the original message (referred to by the one
     2150    15095           currently being delivered) might exist in the file folder as well as
     2151    15096           in this folder.  The file-folder copy must be updated.
     2152    15097        */
     2153    15098    3           IF VM_PROFILE.FILE_FOLDER$ ~= ADDR(NIL)
     2154    15099    3             AND VM_PROFILE.FILE_FOLDER$ -> VM$RADDRESS ~= VM_RADDRESS
     2155    15100    3           THEN
     2156    15101    4   UPDATE_FILE_COPY: DO;
     2157    15102    4               FILE_FOLDER_INFO.FLAGS = '0'B;
     2158    15103    4               CALL VMA$OPEN_FOLDER (FILE_FOLDER_INFO,VM_PROFILE.FILE_FOLDER$,
     2159    15104    4                 DCBNUM(MAIL_FILECOPY), %OLDFILE#,%UPDATE#)
     2160    15105    5               WHENALTRETURN DO;
     2161    15106    5                   CALL XUD$UTS_DIFF_25TH (UTS_X, CURRENT_TIME,VM_HEADER.FIRST_DELIVERY
             15106                            );
     2162    15107    5                   UTS_X = UTS_X/%UTS_25TH_HOUR#;
     2163    15108    5                   CALL XUD$UTS_ADJ_25TH (UTS_Y, VO_MAILMAN_STARTUP_TIME, %
             15108                            UTS_25TH_HOUR#);
     2164    15109    5                   IF B$TCB.ALT$ -> B$ALT.ERR.ERR# = %E$FILEBUSY AND (UTS_X < MAXIMUM (
             15109                            VO_MAX_HOLD_HOURS / 2, 1) OR CURRENT_TIME < UTS_Y)
     2165    15110    6                   THEN DO;
     2166    15111    6                       UNDELIVERED.BUSY = %YES#;
     2167    15112    7                       CALL M$CLOSE (CLOSE_MAIL_OUT) WHENALTRETURN DO; END;
     2168    15113    6                       ALTRETURN;
     2169    15114    6                   END;
     2170    15115    5                   EXIT UPDATE_FILE_COPY;
     2171    15116    5               END;
     2172    15117    4               CALL VMD$GET_PROFILE (DCBNUM(MAIL_FILECOPY))
     2173    15118    5               WHENALTRETURN DO;
     2174    15119    6                   CALL M$CLOSE (CLOSE_MAIL_FILECOPY) WHENALTRETURN DO; END;
     2175    15120    5                   EXIT UPDATE_FILE_COPY;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:156  
     2176    15121    5               END;
     2177    15122    4               CALL VMM$COMBINE_MESSAGE (DCBNUM(MAIL_IN), 0, DCBNUM(MAIL_FILECOPY))
     2178    15123    5               WHENRETURN DO;
     2179    15124    5                   COMBINED = %YES#;
     2180    15125    5               END;
     2181    15126    4               CALL REFRESH_INPUT_HEADER;
     2182    15127    4               VM_HEADER.STATUS = SAVED_FLAGS;
     2183    15128    5               CALL M$CLOSE (CLOSE_MAIL_FILECOPY) WHENALTRETURN DO; END;
     2184    15129    4           END UPDATE_FILE_COPY;
     2185    15130    3           CALL VMD$GET_PROFILE(DCBNUM(MAIL_OUT))
     2186    15131    4           WHENALTRETURN DO;
     2187    15132    4               ERROR = E_PROERR;
     2188    15133    4               GOTO ERROR_RETURN;
     2189    15134    4           END;
     2190    15135    3           CALL VMM$COMBINE_MESSAGE (DCBNUM(MAIL_IN), 0, DCBNUM(MAIL_OUT))
     2191    15136    4           WHENRETURN DO;
     2192    15137    4               COMBINED = %YES#;
     2193    15138    4           END;
     2194    15139    3           CALL REFRESH_INPUT_HEADER;
     2195    15140    3           VM_HEADER.STATUS = SAVED_FLAGS;
     2196    15141    3           IF COMBINED AND VM_PROFILE.OPT.COMBINE
     2197    15142    3             AND (VM_HEADER.STATUS.ACK OR VM_HEADER.STATUS.RRACK
     2198    15143    3             OR VM_HEADER.STATUS.DELIVERY
     2199    15144    3             OR (VM_HEADER.STATUS.ERR AND NOT VM_HEADER.STATUS.FCOPY))
     2200    15145    4           THEN DO;
     2201    15146    4               CALL M$CLOSE (CLOSE_MAIL_OUT);
     2202    15147    4               RETURN;
     2203    15148    4           END;
     2204    15149    3       END UPDATE_ORIGINAL;
     2205    15150        /*
     2206    15151             ***** Update the profile ...
     2207    15152        */
     2208    15153    2   USER_OK:
     2209    15154    2       VM_PROFILE.NUM_MESSAGES = VM_PROFILE.NUM_MESSAGES + 1;
     2210    15155    2       VM_PROFILE.HI_MESSAGE_NUMBER = VM_PROFILE.HI_MESSAGE_NUMBER + 1;
     2211    15156    2       VM_PROFILE.NUM_NEW_MESSAGES = VM_PROFILE.NUM_NEW_MESSAGES + 1;
     2212    15157    2       CALL VMD$PUT_PROFILE(DCBNUM(MAIL_OUT)) ALTRET(BAD_MAIL);
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:157  
     2213    15158    2       VM_HEADER.DELIVERY_DATE = CURRENT_TIME;
     2214    15159        /*
     2215    15160             ***** Delete the return address info (security) ...
     2216    15161        */
     2217    15162    2       IF VM_HEADER.RETURN_ADDRESS$ ~= ADDR(NIL)
     2218    15163    2       THEN
     2219    15164    3       DO;                          /* Delete it */
     2220    15165    3           MASK_LEN = SIZEB(VM_RETURN_ADDRESS);
     2221    15166    3           VM_HEADER.RETURN_ADDRESS$ -> MASK = %NO#;
     2222    15167    3           HEADER_MCB.ADDRESS$ = VM_HEADER.RETURN_ADDRESS$;
     2223    15168    3           CALL X$DEALLOCATE (HEADER_MCB) ALTRET(E_ALLOCATE);
     2224    15169    3           VM_HEADER.RETURN_ADDRESS$ = ADDR(NIL);
     2225    15170    3           VM_HEADER.NEXT$ = HEADER_MCB.HI_SEGMENT$;
     2226    15171    3           VM_HEADER.FREE$ = HEADER_MCB.FREE_HEAD$;
     2227    15172    3       END;                       /* Delete it */
     2228    15173        /*
     2229    15174             ***** Delete the blind-copy address info if the recipient isn't on the
     2230    15175                   BC distribution and isn't the file copy.
     2231    15176        */
     2232    15177    2       IF VM_HEADER.BLIND$ ~= ADDR(NIL) AND NOT VM_DELIVERY.FLAGS.BC
     2233    15178    2         AND NOT VM_DELIVERY.FLAGS.FC
     2234    15179    2       THEN
     2235    15180    3       DO;                          /* Delete it */
     2236    15181    3           VM_HEADER.BLIND$ -> X$STRING = '0'B;
     2237    15182    3           HEADER_MCB.ADDRESS$ = VM_HEADER.BLIND$;
     2238    15183    3           CALL X$DEALLOCATE (HEADER_MCB) ALTRET(E_ALLOCATE);
     2239    15184    3           VM_HEADER.BLIND$ = ADDR(NIL);
     2240    15185    3           VM_HEADER.NEXT$ = HEADER_MCB.HI_SEGMENT$;
     2241    15186    3           VM_HEADER.FREE$ = HEADER_MCB.FREE_HEAD$;
     2242    15187    3       END;                       /* Delete it */
     2243    15188        /*
     2244    15189             ***** Stuff the message into the folder,
     2245    15190                   unless the folder is already full.
     2246    15191                   If so, then stuff the header, and
     2247    15192                   return an error to the sender ...
     2248    15193                   NOTE: Do not try to send an error message to
     2249    15194                   the original sender of the message if the error
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:158  
     2250    15195                   is on that folder. Just override the granule
     2251    15196                   limit checking.
     2252    15197        */
     2253    15198    2       VM_HEADER.STATUS.FCOPY = VM_DELIVERY.FLAGS.FC;
     2254    15199    2       VM_HEADER.STATUS.PRIMARY = VM_DELIVERY.FLAGS.PRIMARY;
     2255    15200    2       VM_HEADER.STATUS.C = VM_DELIVERY.FLAGS.C;
     2256    15201    2       VM_HEADER.STATUS.BC = VM_DELIVERY.FLAGS.BC;
     2257    15202    2       IF VM_FOLDER_INFO.UGRANS > VM_PROFILE.GRANULES
     2258    15203    2         AND VM_PROFILE.GRANULES > 0
     2259    15204    2         AND NOT(VM_FOLDER_INFO.FOLDER = VM_RETURN_ADDRESS.FOLDER
     2260    15205    2         AND VM_FOLDER_INFO.ACCT = VM_RETURN_ADDRESS.ACCT
     2261    15206    2         AND VM_FOLDER_INFO.SITENAME = VM_RETURN_ADDRESS.SITENAME)
     2262    15207    2       THEN                            /* It is already full */
     2263    15208    3       DO;
     2264    15209    3           VM_HEADER.STATUS.ERR = %YES#;
     2265    15210    3           VM_HEADER.STATUS.RR = %NO#;
     2266    15211    3           VM_HEADER.ERROR = E_FOLDERFULL;
     2267    15212    3           CALL VMD$PUT_HEADER (VM_PROFILE.HI_MESSAGE_NUMBER,
     2268    15213    3             DCBNUM(MAIL_OUT)) ALTRET(E_HEADER);
     2269    15214    3           ERROR = E_FOLDERFULL;
     2270    15215    3           GOTO ERROR_RETURN;
     2271    15216    3       END;
     2272    15217    3       ELSE DO;
     2273    15218    3           VM_HEADRES.RES# = VM_PROFILE.HI_MESSAGE_NUMBER;
     2274    15219    4           CALL M$ENQ (ENQ_HEADER) WHENALTRETURN DO;
     2275    15220    4               CALL M$ERR;
     2276    15221    4           END;
     2277    15222                       /* Mail *MUST* enq the header with WAITTIME=0, else deadlocks
     2278    15223                          will occur. */
     2279    15224    3           CALL VMD$PUT_HEADER (VM_PROFILE.HI_MESSAGE_NUMBER,DCBNUM(MAIL_OUT))
     2280    15225    3             ALTRET(E_HEADER);
     2281    15226    4           CALL M$DEQ (DEQ_PROFILE) WHENALTRETURN DO; END;
     2282    15227    3           IF VM_HEADER.STATUS.BROADCAST
     2283    15228    3           THEN
     2284    15229    3               CALL VMM$COPY_MESSAGE_BODY (0, VM_PROFILE.HI_MESSAGE_NUMBER,
     2285    15230    3                 DCBNUM(MAIL_IN), DCBNUM(MAIL_OUT), 0, 0) ALTRET (E_COPY);
     2286    15231    3           ELSE
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:159  
     2287    15232    3               CALL VMM$COPY_MESSAGE (0, VM_PROFILE.HI_MESSAGE_NUMBER,
     2288    15233    3                 DCBNUM(MAIL_IN), DCBNUM(MAIL_OUT), 0, 0) ALTRET (E_COPY);
     2289    15234    3           IF NOT VM_DELIVERY.FLAGS.BC AND NOT VM_DELIVERY.FLAGS.FC
     2290    15235    3           THEN
     2291    15236    3               CALL VMA$DEL_ADD_RECORD (%VM_TYPE_BC, VECTOR(NIL), DCBNUM(MAIL_OUT),
     2292    15237    3                 VM_PROFILE.HI_MESSAGE_NUMBER);
     2293    15238    4           CALL M$DEQ (DEQ_HEADER) WHENALTRETURN DO;
     2294    15239    4           END;
     2295    15240    3       END;
     2296    15241    2       CALL M$CLOSE (CLOSE_MAIL_OUT) ALTRET(BAD_MAIL);
     2297    15242
     2298    15243
     2299    15244
     2300    15245    2   WE_TRIED: ;
     2301    15246    2   CONTINUE: ;
     2302    15247    2       RETURN;
     2303    15248        /*
     2304    15249             ***** Problem writing message into destination folder so attempt
     2305    15250             ***** to notify user by posting error in header. However when
     2306    15251             ***** out of disk space to the point where even the header can't
     2307    15252             ***** be written, increment the lost message count in the profile record.
     2308    15253        */
     2309    15254    2   E_COPY:
     2310    15255    2       ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     2311    15256    2       VM_HEADER.STATUS.ERR = %YES#;
     2312    15257    2       VM_HEADER.STATUS.RR = %NO#;
     2313    15258    2       IF ERROR.ERR# = %E$ACGRANS
     2314    15259    2       THEN
     2315    15260    2           VM_HEADER.ERROR = E_DISKSPACE; /* Output better err. msge. */
     2316    15261    2       CALL VMD$PUT_HEADER (VM_PROFILE.HI_MESSAGE_NUMBER,DCBNUM(MAIL_OUT))
     2317    15262    2         ALTRET(E_HEADER);
     2318    15263    3       DO WHILE ('0'B);
     2319    15264    3   E_HEADER:
     2320    15265    3           VM_PROFILE.NUM_MESSAGES = VM_PROFILE.NUM_MESSAGES - 1;
     2321    15266    3           VM_PROFILE.HI_MESSAGE_NUMBER = VM_PROFILE.HI_MESSAGE_NUMBER - 1;
     2322    15267    3           VM_PROFILE.NUM_NEW_MESSAGES = VM_PROFILE.NUM_NEW_MESSAGES - 1;
     2323    15268    3           VM_PROFILE.NUM_LOST = VM_PROFILE.NUM_LOST + 1;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:160  
     2324    15269    3           CALL VMD$PUT_PROFILE(DCBNUM(MAIL_OUT)) ALTRET(BAD_MAIL);
     2325    15270    3   BAD_MAIL: ;
     2326    15271    3           ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     2327    15272    3       END;
     2328    15273        /**/
     2329    15274    3       DO WHILE ('0'B); /* NEVER */;
     2330    15275    3   E_ALLOCATE:
     2331    15276    3           ERROR = HEADER_MCB.ERR;
     2332    15277    3       END;                            /* Do never ... end */
     2333    15278    2   ERROR_RETURN:
     2334    15279    3       CALL M$DEQ (DEQ_PROFILE) WHENALTRETURN DO;
     2335    15280    3       END;
     2336    15281    3       CALL M$DEQ (DEQ_HEADER) WHENALTRETURN DO;
     2337    15282    3       END;
     2338    15283    2       CALL M$CLOSE (CLOSE_MAIL_OUT) ALTRET(DONT_CARE);
     2339    15284    2   DONT_CARE: ;
     2340    15285    2       ALTRETURN;
     2341    15286    2   END VOM$SENDIT;
     2342    15287        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:161  
     2343    15288        /*********************************************************************/
     2344    15289        /*F*    NAME:        TRANSPORT_INTERSYS
     2345    15290                PURPOSE:     To interface with transport facilities.
     2346    15291                DESCRIPTION: This routine will cause the current message
     2347    15292                             file to be transported to as many sites as
     2348    15293                             are specified in the INTERSYS_INFO list.
     2349    15294        */
     2350    15295        /*********************************************************************/
     2351    15296    1   TRANSPORT_INTERSYS: PROC(ONE) ALTRET;
     2352    15297    2   DCL ONE BIT(1) ALIGNED;            /* If set, process only top chain entry */
     2353    15298    2   DCL VOM$MOVE ENTRY (3) ALTRET;
     2354    15299          %VM_BODYREC (STCLASS=STATIC,VARYLEN=NO);
     2355    15331          %VM_CGBUFFER (NAME=VM_CGOUT);
     2356    15362           %VM_SITE (NAME=VM_SITE_T);
     2357    15386
     2358    15387             %VLP_ERRCODE (FPTN=MYERROR,
     2359    15388                            FCG = "VO",
     2360    15389                            MID ="M");
     2361    15434
     2362    15435              %VLP_NAME (FPTN=MOVE_NAME, L=31);
     2363    15462
     2364    15463             %FPT_OPEN (FPTN=OPEN_MAIL_CREATE,
     2365    15464                            NAME=MOVE_NAME,
     2366    15465                            ACCT=VM_MAIL_ACCT,
     2367    15466                            DCB=MAIL_OUT,
     2368    15467                            ASN=FILE,
     2369    15468                            FUN=CREATE,
     2370    15469                       SCRUB=YES,
     2371    15470                            ACS=DIRECT,
     2372    15471                            ORG=KEYED);
     2373    15580
     2374    15581        %FPT_CLOSE (FPTN=CLOSE_MAIL,DCB=MAIL_OUT,DISP=SAVE);
     2375    15623        %FPT_ACTIVATE (FPTN=CANCEL_READ, STCLASS=CONSTANT,
     2376    15624                  DCB=M$MAIL_COMGROUP,
     2377    15625                  STATION=MYSTATION,
     2378    15626                  ABTREAD=%TYC_EOF);
     2379    15649        %VLP_STATION (FPTN=MYSTATION,STATION='MAILMAN', STCLASS=CONSTANT);
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:162  
     2380    15676              %FPT_OLAY (STCLASS=STATIC,
     2381    15677              ONAME=OV_NAME);
     2382    15693        %VLP_NAME (FPTN=OV_NAME, STCLASS=CONSTANT,
     2383    15694                  NAME='VOM$MOVE');
     2384    15721
     2385    15722        %VLP_STATION (FPTN=OUTSTATION, STCLASS="SYMREF");
     2386    15749    2   DCL INDX SBIN WORD STATIC;
     2387    15750    2   DCL PREFIX CHAR (5);
     2388    15751    2   DCL ACCT CHAR (8);
     2389    15752    2   DCL NODE CHAR (8);
     2390    15753        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:163  
     2391    15754        /*
     2392    15755             ***** Create one xeq file for each foreign system
     2393    15756                   that the message must be moved to ...
     2394    15757        */
     2395    15758    3       DO WHILE (INTERSYS_HEAD$ ~= ADDR(NIL));
     2396    15759    3           INTERSYS$ = INTERSYS_HEAD$;
     2397    15760    3           OPEN_MAIL_CREATE.ACCT_ = VECTOR (VM_MAIL_ACCT);
     2398    15761    3           OPEN_MAIL_CREATE.V.FUN# = %CREATE#;
     2399    15762    3           OPEN_MAIL_CREATE.V.DELETE# = %NO#;
     2400    15763    3           MOVE_NAME.NAME# = ':XMIT';
     2401    15764    3           CALL CONCAT (STATUS_STRING, 'Beaming mail to ', INTERSYS_INFO.SITENAME);
     2402    15765    3           CALL UPDATE_STATUS;
     2403    15766        /*
     2404    15767             ***** Read the site-info record so we can figure out where the
     2405    15768                   mail file should be placed.
     2406    15769        */
     2407    15770    3           CALL VMA$GET_SITE_NAME(INTERSYS_INFO.SITENAME, SITENAME, SITE_TYPE, EXTERNAL
             15770                    ) ALTRET (E_PMME);
     2408    15771    3           CALL INSERT (MOVE_NAME.NAME#, 5, , INTERSYS_INFO.NAME);
     2409    15772    3           CALL INDEX (INDX, ' ', MOVE_NAME.NAME#);
     2410    15773    3           MOVE_NAME.L# = INDX;
     2411    15774        /*
     2412    15775             ***** Create the :MOVE file ...
     2413    15776        */
     2414    15777    3           CALL M$OPEN (OPEN_MAIL_CREATE) ALTRET(E_PMME);
     2415    15778        /*
     2416    15779             ***** Restore the return address
     2417    15780                   receiving mailman may need it ...
     2418    15781        */
     2419    15782    3           IF VM_HEADER.RETURN_ADDRESS$ = ADDR(NIL)
     2420    15783    3           THEN
     2421    15784    4           DO;                    /* Restore it */
     2422    15785    4               HEADER_MCB.SIZE = SIZEC(VM_RETURN_ADDRESS);
     2423    15786    4               CALL X$ALLOCATE (HEADER_MCB)
     2424    15787    4               WHENALTRETURN
     2425    15788    5               DO;
     2426    15789    5                   CALL VMA$ENLARGE_SEGMENT (VM_HEADER_,1024) ALTRET(E_PMME);
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:164  
     2427    15790    5                   HEADER_MCB.WKSZ = (VBOUND(VM_HEADER_)+1)/4;
     2428    15791    5                   CALL X$ALLOCATE (HEADER_MCB) ALTRET(E_ALLOCATE);
     2429    15792    5               END;
     2430    15793    4               VM_HEADER.RETURN_ADDRESS$ = HEADER_MCB.ADDRESS$;
     2431    15794    4               VM_HEADER.RETURN_ADDRESS$ -> VM$RADDRESS = VM_RETURN_ADDRESS;
     2432    15795    4               VM_HEADER.NEXT$ = HEADER_MCB.HI_SEGMENT$;
     2433    15796    4               VM_HEADER.FREE$ = HEADER_MCB.FREE_HEAD$;
     2434    15797    4           END;                  /* Restore it */
     2435    15798        /*
     2436    15799             ***** Now create the internal address lists for this
     2437    15800                   site. Only addresses recognized as belonging
     2438    15801                   to the receiving site must be included so as
     2439    15802                   to avoid multiple messages to one receiver ...
     2440    15803        */
     2441    15804        /*   If this is an error reporting message, don't bother building
     2442    15805             any of the address lists.  Just use VM_RADDRESS which has already
     2443    15806             been set to VM_RETURN_ADDRESS by a previous routine.
     2444    15807        */
     2445    15808    3           IF ONE THEN
     2446    15809    3               CALL BUILD_ADD_LIST (ADDR(VM_RADDRESS), %VM_TYPE_ITO);
     2447    15810    4           ELSE DO;
     2448    15811    4               IF ITO_HEAD$ ~= ADDR(NIL)
     2449    15812    4               THEN
     2450    15813    4                   CALL BUILD_ADD_LIST (ITO_HEAD$,%VM_TYPE_ITO);
     2451    15814    4               IF IBC_HEAD$ ~= ADDR(NIL)
     2452    15815    4               THEN
     2453    15816    5               DO;
     2454    15817    5                   CALL BUILD_ADD_LIST (IBC_HEAD$,%VM_TYPE_IBC);
     2455    15818        /*
     2456    15819             ***** If there is blind copy info, restore it ...
     2457    15820        */
     2458    15821    5                   IF BLIND_TEXT.L# ~= 0
     2459    15822    5                     AND VM_ADD_HEAD.NUM_ENTRIES > 0
     2460    15823    5                   THEN
     2461    15824    6                   DO; /* Restore BLIND$ */
     2462    15825    6                       HEADER_MCB.SIZE = BLIND_TEXT.L# + 1;
     2463    15826    6                       CALL X$ALLOCATE (HEADER_MCB)
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:165  
     2464    15827    6                       WHENALTRETURN
     2465    15828    7                       DO;
     2466    15829    7                           CALL VMA$ENLARGE_SEGMENT (VM_HEADER_,1024) ALTRET(E_PMME);
     2467    15830    7                           HEADER_MCB.WKSZ = (VBOUND(VM_HEADER_)+1)/4;
     2468    15831    7                           CALL X$ALLOCATE (HEADER_MCB) ALTRET(E_ALLOCATE);
     2469    15832    7                       END;
     2470    15833    6                       VM_HEADER.BLIND$ = HEADER_MCB.ADDRESS$;
     2471    15834    6                       VM_HEADER.NEXT$ = HEADER_MCB.HI_SEGMENT$;
     2472    15835    6                       VM_HEADER.FREE$ = HEADER_MCB.FREE_HEAD$;
     2473    15836    6                       VM_HEADER.BLIND$ -> X$STRING.SIZ = BLIND_TEXT.L#;
     2474    15837    6                       VM_HEADER.BLIND$ -> X$STRING.TEXT = BLIND_TEXT.NAME#;
     2475    15838    6                   END; /* Restore BLIND$ */
     2476    15839    5                   IF BLIND_TEXT.L# ~= 0
     2477    15840    5                     AND VM_ADD_HEAD.NUM_ENTRIES = 0
     2478    15841    5                     AND VM_HEADER.BLIND$ ~= ADDR(NIL)
     2479    15842    5                   THEN /* Don't pass nfo to this site */
     2480    15843    6                   DO;
     2481    15844    6                       VM_HEADER.BLIND$ -> X$STRING.TEXT = ' ';
     2482    15845    6                       HEADER_MCB.ADDRESS$ = VM_HEADER.BLIND$;
     2483    15846    6                       CALL X$DEALLOCATE (HEADER_MCB);
     2484    15847    6                       VM_HEADER.BLIND$ = ADDR(NIL);
     2485    15848    6                       VM_HEADER.NEXT$ = HEADER_MCB.HI_SEGMENT$;
     2486    15849    6                       VM_HEADER.FREE$ = HEADER_MCB.FREE_HEAD$;
     2487    15850    6                   END;
     2488    15851    5               END;
     2489    15852    4               IF IC_HEAD$ ~= ADDR(NIL)
     2490    15853    4               THEN
     2491    15854    4                   CALL BUILD_ADD_LIST (IC_HEAD$,%VM_TYPE_IC);
     2492    15855        /*
     2493    15856             ***** Record where this message came from,
     2494    15857                   and where it is going so that the
     2495    15858                   receiving system will not try to send the
     2496    15859                   message back to this system.
     2497    15860                   NOTE: There is an exception. When it is
     2498    15861                   necessary to send a message back to the
     2499    15862                   original sender (answer), the flag RETURN_TO_ORIGIN
     2500    15863                   should be set. This is only used when this is
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:166  
     2501    15864                   the first mailman to process this message
     2502    15865                   (i.e. NUM_SITES = 0).
     2503    15866        */
     2504    15867        /*
     2505    15868             ***** Determine if RETURN_TO_ORIGIN should be set ...
     2506    15869        */
     2507    15870    4               IF VM_HEADER.STATUS.ANS_TO
     2508    15871    4               THEN
     2509    15872    5               DO;
     2510    15873        /*****      IF NOT VM_HEADER.STATUS.FCOPY
     2511    15874                    THEN *****/
     2512    15875    5                   VM_SITE.FLAGS.RETURN_TO_ORIGIN = %YES#;
     2513    15876    5                   VM_HEADER.STATUS.ANS_TO = %NO#;
     2514    15877    5               END;
     2515    15878    4           END;                  /* Not one */
     2516    15879        /*
     2517    15880             ***** Now copy the message file to the :MOVE file ...
     2518    15881        */
     2519    15882    3           CALL VMM$COPY_MESSAGE (0,0,DCBNUM(MAIL_IN),DCBNUM(MAIL_OUT),0,0);
     2520    15883        /*
     2521    15884             ***** Search for loops in address resolution ...
     2522    15885        */
     2523    15886    3           IF VM_SITE.NUM_SITES > 1
     2524    15887    3             AND NOT ONE /* If one (error return) we're going home, don't test */
     2525    15888    3           THEN
     2526    15889    4           DO;
     2527    15890    4               IF VM_SITE.ORIGIN = INTERSYS_INFO.SITENAME THEN GOTO LOOP_ADDRESS;
     2528    15891    5               DO INDX = 0 TO VM_SITE.NUM_SITES - 1;
     2529    15892    5                   IF VM_SITE.RECEIVER_SITE(INDX) = INTERSYS_INFO.SITENAME
     2530    15893    5                   THEN      /* Loop detected */
     2531    15894    6                   DO;
     2532    15895    6   LOOP_ADDRESS:
     2533    15896                                                /* Report error */
     2534    15897    6                       CLOSE_MAIL.V.DISP# = %SCRATCH#;
     2535    15898    6                       CALL M$CLOSE (CLOSE_MAIL)
     2536    15899    6                       WHENALTRETURN
     2537    15900    7                       DO;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:167  
     2538    15901    7                           CLOSE_MAIL.V.DISP# = %SAVE#;
     2539    15902    7                       END;
     2540    15903    6                       CALL VOM$DELENTRY (INTERSYS$,%NO#,INTERSYS_HEAD$);
     2541    15904    6                       CLOSE_MAIL.V.DISP# = %SAVE#;
     2542    15905    6                       RETURN;
     2543    15906    6                   END;
     2544    15907    5               END;             /* Do indx = ... end */
     2545    15908    4           END;
     2546    15909        /*
     2547    15910             ***** Now add the current site ...
     2548    15911        */
     2549    15912                       /* The old version updated VM_SITE.  Changed to update and write
     2550    15913                          VM_SITE_T 4/12/83.  This should allow both multiple branches
     2551    15914                          and error return mail. */
     2552    15915    3           VM_SITE_T = VM_SITE;
     2553    15916    3           VM_SITE_T.RECEIVER_SITE(VM_SITE_T.NUM_SITES) = INTERSYS_INFO.SITENAME;
     2554    15917    3           VM_SITE_T.NUM_SITES = VM_SITE_T.NUM_SITES + 1;
     2555    15918    3           CALL VMD$PUT_SITE (VM_SITE_T,DCBNUM(MAIL_OUT)) ALTRET (E_PMME);
     2556    15919    3           CALL M$CLOSE (CLOSE_MAIL) ALTRET(E_PMME);
     2557    15920    3           IF SITE_TYPE = %N_EXTERNAL#
     2558    15921    4           THEN DO;
     2559    15922    4               PREFIX = ':MESS';
     2560    15923    4               ACCT = EXTERNAL.ACCT;
     2561    15924    4               NODE = EXTERNAL.SITENAME;
     2562    15925    4           END;
     2563    15926    4           ELSE DO;
     2564    15927    4               PREFIX = ':MOVE';
     2565    15928    4               ACCT = VM_MAIL_ACCT.ACCT#;
     2566    15929    4               NODE = INTERSYS_INFO.SITENAME;
     2567    15930    4           END;
     2568    15931        /* VOM$MOVE is in an overlay to save space, beam is about 12K.
     2569    15932           Since olays can not be done with nowait io pending, cancel the
     2570    15933           comgroup read (if any); */
     2571    15934    3           IF NOT VO_NEED_READ
     2572    15935    3           THEN CALL M$ACTIVATE (CANCEL_READ); /* VOM_EVENT will set flag again */
     2573    15936    3           FPT_OLAY.V.FLGS.CANCEL# = %NO#;
     2574    15937    4           CALL M$OLAY(FPT_OLAY) WHENALTRETURN DO;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:168  
     2575    15938    4               CALL M$XXX;
     2576    15939    4           END;
     2577    15940    3           IF B$JIT.PRIV.ACTIVE.JIT
     2578    15941    3           THEN
     2579    15942    3               B$JIT.JOBNAME = 'Mail';
     2580    15943    3           CALL VOM$MOVE (PREFIX, ACCT, NODE)
     2581    15944    4           WHENRETURN DO;
     2582    15945    4               OPEN_MAIL_CREATE.V.FUN# = %UPDATE#;
     2583    15946    4               OPEN_MAIL_CREATE.V.DELETE# = %YES#;
     2584    15947    5               CALL M$OPEN (OPEN_MAIL_CREATE) WHENALTRETURN DO;
     2585    15948    5               END;
     2586    15949    4               OPEN_MAIL_CREATE.V.FUN# = %CREATE#;
     2587    15950    4               OPEN_MAIL_CREATE.V.DELETE# = %NO#;
     2588    15951    4           END;
     2589    15952    3           IF VM_HEADER.FROM$ ~= ADDR(NIL)
     2590    15953    3             AND B$JIT.PRIV.ACTIVE.JIT
     2591    15954    3           THEN
     2592    15955    3               B$JIT.JOBNAME = VM_HEADER.FROM$ -> X$STRING.TEXT;
     2593    15956    3           IF NOT VO_NEED_READ
     2594    15957    3           THEN CALL M$ACTIVATE (CANCEL_READ); /* VOM_EVENT will set flag again */
     2595    15958    3           FPT_OLAY.V.FLGS.CANCEL# = %YES#;
     2596    15959    4           CALL M$OLAY(FPT_OLAY) WHENALTRETURN DO;
     2597    15960    4               CALL M$XXX;
     2598    15961    4           END;
     2599    15962    3           CALL VOM$DELENTRY (INTERSYS$, %NO#, INTERSYS_HEAD$);
     2600    15963    3           IF ONE THEN RETURN;    /* Do only one entry (error reporting) */
     2601    15964    3       END;                            /* Do while ... end */
     2602    15965    2       RETURN;
     2603    15966        /**/
     2604    15967    2   E_ALLOCATE:
     2605    15968    2       ERROR = HEADER_MCB.ERR;
     2606    15969    2       ALTRETURN;
     2607    15970        /**/
     2608    15971    2   E_PMME:
     2609    15972    2       ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     2610    15973    2       ALTRETURN;
     2611    15974        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:169  
     2612    15975    2   BUILD_ADD_LIST: PROC (HEAD$,TYPE);
     2613    15976        /***** Parameters *****/
     2614    15977    3   DCL HEAD$ PTR;
     2615    15978    3   DCL TYPE UBIN WORD;
     2616    15979    3   DCL SITENAME CHAR (8);
     2617    15980    3   DCL PTR$ PTR STATIC;
     2618    15981          %VM_RADDRESS (NAME=VM$RADDRESS,STCLASS="BASED(PTR$)");
     2619    16016          %VM_UADDRESS (NAME=VM$UADDRESS,STCLASS="BASED(PTR$)");
     2620    16053        /*
     2621    16054             ***** Create an address record of the specified type
     2622    16055                   which contains only addresses to be delivered by
     2623    16056                   the mailman at the site specified in INTERSYS_INFO ...
     2624    16057        */
     2625    16058    3       VM_ADD_HEAD.NUM_ENTRIES = 0;
     2626    16059    3       PTR$ = HEAD$;
     2627    16060    4       DO WHILE (PTR$ ~= ADDR(NIL));
     2628    16061    4           CALL VMA$GET_SITE_NAME (VM$RADDRESS.SITENAME, SITENAME);
     2629    16062    4           IF SITENAME = INTERSYS_INFO.SITENAME
     2630    16063    4           THEN
     2631    16064    5           DO;                    /* Found one */
     2632    16065    5               IF VM$RADDRESS.TYPE = %VM_ADD_RESOLVED
     2633    16066    5               THEN
     2634    16067    6               DO;
     2635    16068    6                   CALL VMA$ADD_RENTRY (VM$RADDRESS.ACCT,
     2636    16069    6                     VM$RADDRESS.FOLDER,VM$RADDRESS.PASS,VM$RADDRESS.SITENAME,
     2637    16070    6                     %NO#,VM$RADDRESS.NAME_KEY) ALTRET(E_ADD);
     2638    16071    6               END;
     2639    16072    5               ELSE
     2640    16073    6               DO;
     2641    16074    6                   CALL VMA$ADD_UENTRY (VM$UADDRESS.USER_NAME,
     2642    16075    6                     VM$UADDRESS.FOLDER,VM$UADDRESS.PASS,VM$UADDRESS.SITENAME,
     2643    16076    6                     %NO#,VM$UADDRESS.NAME_KEY) ALTRET(E_ADD);
     2644    16077    6               END;
     2645    16078    5           END;
     2646    16079    4           PTR$ = PTR$ -> VM$RADDRESS.NEXT$;
     2647    16080    4       END;                            /* Do while ... end */
     2648    16081        /*
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:170  
     2649    16082             ***** Now write it ...
     2650    16083        */
     2651    16084    3       IF VM_ADD_HEAD.NUM_ENTRIES > 0
     2652    16085    3       THEN
     2653    16086    3           CALL VMA$PUT_ADD_RECORD (TYPE,VM_ADDLIST_,DCBNUM(MAIL_OUT));
     2654    16087    3       RETURN;
     2655    16088        /**/
     2656    16089    3   E_ADD:
     2657    16090    3       RETURN;                           /* ????? */
     2658    16091    3   END BUILD_ADD_LIST;
     2659    16092    2   END TRANSPORT_INTERSYS;
     2660    16093        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:171  
     2661    16094        /*********************************************************************/
     2662    16095        /*F*
     2663    16096             NAME:        BUILD_INTERSYS_LIST
     2664    16097             PURPOSE:     To create the INTERSYS_INFO list.
     2665    16098             DESCRIPTION: This routine will create a list of all
     2666    16099                          non-local sites which must receive a copy
     2667    16100                          of the messaae currently being processed.
     2668    16101        */
     2669    16102        /*********************************************************************/
     2670    16103    1   BUILD_INTERSYS_LIST: PROC ALTRET;
     2671    16104        /***** Local variables *****/
     2672    16105    2   DCL KEY_VALUE CHAR(8) CALIGNED;
     2673    16106    2   DCL INDX SBIN WORD STATIC;
     2674    16107    2   DCL INDX1 UBIN;
     2675    16108    2   DCL SITENAME CHAR(8) CALIGNED;
     2676    16109        /***** Error codes *****/
     2677    16110          %VLP_ERRCODE (FPTN=E_BADSITE,FCG="VO",MID="M",
     2678    16111                        ERR#=%E$BADSITE,STCLASS=CONSTANT);
     2679    16156        /*E* ERROR: VOM-E$BADSITE-0
     2680    16157             MESSAGE: The site specified in the address is not defined
     2681    16158        */
     2682    16159        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:172  
     2683    16160        /**/
     2684    16161    2       CALL XLATE (KEY_VALUE, LOWER_UPPER, VM_RADDRESS.SITENAME);
     2685    16162    2       IF KEY_VALUE = VM_SITENAME
     2686    16163    2       THEN                            /* Don't send to this site */
     2687    16164    2           RETURN;
     2688    16165        /*
     2689    16166             ***** Check that this site exists ...
     2690    16167        */
     2691    16168    2       CALL VMA$GET_SITE_NAME(KEY_VALUE,SITENAME) ALTRET(NO_SITE);
     2692    16169        /*
     2693    16170             ***** Search the list. If already defined then
     2694    16171                   don't define again ...
     2695    16172        */
     2696    16173    2       INTERSYS$ = INTERSYS_HEAD$;
     2697    16174    3       DO WHILE (INTERSYS$ ~= ADDR(NIL));
     2698    16175    3           IF INTERSYS_INFO.SITENAME = SITENAME
     2699    16176    3             AND NOT VM_HEADER.STATUS.ERR /* do it anyway if error */
     2700    16177    3           THEN                       /* Already defined */
     2701    16178    3               GOTO ADD_ADDRESS;
     2702    16179    3           INTERSYS$ = INTERSYS_INFO.NEXT$;
     2703    16180    3       END;                            /* Do while ... end */
     2704    16181        /*
     2705    16182             ***** Add it to the list ...
     2706    16183        */
     2707    16184    2       CALL VOM$ADDENTRY (INTERSYS$,%NO#,INTERSYS_HEAD$);
     2708    16185    2       INTERSYS_INFO.SITENAME = SITENAME;
     2709    16186    2       CALL M$TIME(GET_CURRENT);
     2710    16187    2       CALL BINCHAR (INTERSYS_INFO.NAME,CURRENT_TIME);
     2711    16188    2       CALL INDEX(INDX1,' ',SUBSTR(VM_SITENAME,0,4));
     2712    16189    2       CALL INSERT(INTERSYS_INFO.NAME,0,INDX1,VM_SITENAME);
     2713    16190    2       CALL INDEX(INDX,' ',SUBSTR(SITENAME,0,4));
     2714    16191    2       CALL INSERT (INTERSYS_INFO.NAME,INDX1,INDX+1,':',SITENAME);
     2715    16192        /*
     2716    16193             ***** Copy this address to the appropriate list
     2717    16194                   so that it can be written into the :XMIT file
     2718    16195                   for use by the receiving mailman ...
     2719    16196        */
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:173  
     2720    16197    2   ADD_ADDRESS:
     2721    16198    2       IF VM_RADDRESS.TYPE = %VM_ADD_RESOLVED
     2722    16199    2       THEN
     2723    16200    2           IADDLIST_MCB.SIZE = SIZEC(VM_RADDRESS);
     2724    16201    2       ELSE
     2725    16202    3       DO;
     2726    16203    3           IADDLIST_MCB.SIZE = SIZEC(VM_UADDRESS) -
     2727    16204    3             SIZEC(VM_UADDRESS.USER_NAME.TEXT) + VM_UADDRESS.USER_NAME.COUNT;
     2728    16205    3       END;
     2729    16206    2       CALL X$ALLOCATE (IADDLIST_MCB)
     2730    16207    2       WHENALTRETURN
     2731    16208    3       DO;
     2732    16209    3           CALL VMA$ENLARGE_SEGMENT (VM_COPY_,1024) ALTRET(E_PMME);
     2733    16210    3           IADDLIST_MCB.WKSZ = (VBOUND(VM_COPY_)+1)/4;
     2734    16211    3           CALL X$ALLOCATE (IADDLIST_MCB) ALTRET(E_ALLOCATE);
     2735    16212    3       END;
     2736    16213    2       IADDLIST_MCB.ADDRESS$ -> VM$RADDRESS.FOLDER = VM_RADDRESS.FOLDER;
     2737    16214    2       IADDLIST_MCB.ADDRESS$ -> VM$RADDRESS.PASS = VM_RADDRESS.PASS;
     2738    16215    2       IADDLIST_MCB.ADDRESS$ -> VM$RADDRESS.SITENAME = VM_RADDRESS.SITENAME;
     2739    16216    2       IADDLIST_MCB.ADDRESS$ -> VM$RADDRESS.TYPE = VM_RADDRESS.TYPE;
     2740    16217    2       IF VM_RADDRESS.TYPE = %VM_ADD_RESOLVED
     2741    16218    2       THEN
     2742    16219    2           IADDLIST_MCB.ADDRESS$ -> VM$RADDRESS.ACCT = VM_RADDRESS.ACCT;
     2743    16220    2       ELSE
     2744    16221    3       DO;
     2745    16222    3           IADDLIST_MCB.ADDRESS$ -> VM$UADDRESS.USER_NAME.COUNT =
     2746    16223    3             VM_UADDRESS.USER_NAME.COUNT;
     2747    16224    3           CALL INSERT (IADDLIST_MCB.ADDRESS$ -> VM$UADDRESS.USER_NAME.TEXT,
     2748    16225    3             0,VM_UADDRESS.USER_NAME.COUNT,
     2749    16226    3             VM_UADDRESS.USER_NAME.TEXT);
     2750    16227    3       END;
     2751    16228    3       DO CASE (ADD_TYPE);
     2752    16229    3       CASE (%VM_TYPE_TO);
     2753    16230    3           IADDLIST_MCB.ADDRESS$ -> VM$RADDRESS.NEXT$ = ITO_HEAD$;
     2754    16231    3           ITO_HEAD$ = IADDLIST_MCB.ADDRESS$;
     2755    16232    3       CASE (%VM_TYPE_BC);
     2756    16233    3           IADDLIST_MCB.ADDRESS$ -> VM$RADDRESS.NEXT$ = IBC_HEAD$;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:174  
     2757    16234    3           IBC_HEAD$ = IADDLIST_MCB.ADDRESS$;
     2758    16235    3       CASE (%VM_TYPE_C);
     2759    16236    3           IADDLIST_MCB.ADDRESS$ -> VM$RADDRESS.NEXT$ = IC_HEAD$;
     2760    16237    3           IC_HEAD$ = IADDLIST_MCB.ADDRESS$;
     2761    16238    3       END;                             /* Do case ... end */
     2762    16239    2       RETURN;
     2763    16240        /**/
     2764    16241    2   NO_SITE: ;
     2765    16242    2       ERROR = E_BADSITE;
     2766    16243    2       ALTRETURN;
     2767    16244        /**/
     2768    16245    2   E_ALLOCATE:
     2769    16246    2       ERROR = IADDLIST_MCB.ERR;
     2770    16247    2       ALTRETURN;
     2771    16248        /**/
     2772    16249    2   E_PMME:
     2773    16250    2       ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     2774    16251    2       ALTRETURN;
     2775    16252    2   END BUILD_INTERSYS_LIST;
     2776    16253    1   END VOM$DOSEND;
     2777    16254        %EOD;

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:175  
--  Include file information  --

   XUD_UTS_M.:LIB_E05  is referenced.
   B$TABLES_C.:LIB_E05  cannot be made into a system file and is referenced.
   XUM_MACRO_C.:LIB_E05  is referenced.
   VW_NODEATER_E.:VMB6TOU  is referenced.
   VM_PERR_C.:VMB6TOU  is referenced.
   VO_SUBS_C.:VMB6TOU  is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VOM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   B_SEGIDS_C.:LIB_E05  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   B$JIT_C.:LIB_E05  is referenced.
   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VOM$DOSEND.

   Procedure VOM$DOSEND requires 3468 words for executable code.
   Procedure VOM$DOSEND requires 712 words of local(AUTO) storage.

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:176  

 Object Unit name= VOM$DOSEND                                 File name= VOM$MAILMAN.:VMB6TOU
 UTS= AUG 20 '97 15:32:27.32 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$MAIL_FILE
    2   DCB   even  none     0      0  M$MAIL_CENTRAL
    3   DCB   even  none     0      0  M$MAIL_GLOBAL
    4   DCB   even  none     0      0  M$WORK
    5   DCB   even  none     0      0  M$MAIL_COMGROUP
    6   DCB   even  none     0      0  M$DO
    7   DCB   even  none     0      0  M$LO
    8   DCB   even  none     0      0  M$ME
    9   DCB   even  none     0      0  M$NODE
   10   DCB   even  none     0      0  M$SI
   11   Data  even  none  1285   2405  VOM$DOSEND
   12  RoData even  UTS    404    624  VOM$DOSEND
   13   DCB   even  none     0      0  MAIL_IN
   14   DCB   even  none     0      0  MAIL_OUT
   15   DCB   even  none     0      0  MAIL_FILECOPY
   16   Proc  even  none  3468   6614  VOM$DOSEND
   17  RoData even  none    99    143  VOM$DOSEND

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    16      0   yes            yes      Std        1  VOM$DOSEND
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:177  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes          ~proc      0 B_POINTER
 yes     yes           Std       3 VMD$GET_DELIVERY
 yes     yes           Std       2 VMD$GET_HEADER
 yes     yes           Std       3 XUD$UTS_DIFF_25TH
         yes           Std       4 VOM$ADDENTRY_SORTED
 yes     yes           Std       4 VMA$GET_NEXT_ENTRY
 yes     yes           Std       2 VMD$PUT_HEADER
         yes           Std       0 VOM$PROCESS
 yes     yes           Std       5 VMA$EXPAND_LIST_FULL
 yes     yes           Std       3 XUD$UTS_ADJ_25TH
 yes     yes           Std       3 VMD$MERGE_DELIVERY
 yes     yes           Std       1 VMA$OPEN_GLOBAL
 yes     yes           Std       3 VMD$GET_ID
 yes     yes           Std       7 VMD$PUT_BODY
 yes     yes           Std       3 VMD$PUT_DELIVERY
 yes     yes           Std       2 VMD$DEL_DELIVERY
 yes     yes           Std       5 VMA$OPEN_FOLDER
 yes     yes           Std       2 VMD$GET_SITE
         yes           Std       3 VMF$MAKE_ADDRESS2
 yes     yes           Std       3 VMD$GET_DELIVERY_NEXT
 yes     yes           Std       4 VMA$PUT_ADD_RECORD
         yes           Std       3 VOM$DELENTRY
 yes     yes           Std       4 VMA$GET_SITE_NAME
 yes     yes           Std       1 X$ALLOCATE
 yes     yes           Std       4 VMA$GET_ADD_RECORD
 yes     yes           Std       2 VMA$ENLARGE_SEGMENT
 yes     yes           Std       6 VMM$COPY_MESSAGE_BODY
 yes     yes           Std       1 VMD$GET_PROFILE
 yes     yes           Std       1 X$DEALLOCATE
 yes     yes           Std       5 VMA$OPEN_FOLDER
 yes     yes           Std       2 VMD$PUT_HEADER
 yes     yes           Std       3 VMM$COMBINE_MESSAGE
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:178  
 yes     yes           Std       1 VMD$PUT_PROFILE
 yes     yes           Std       4 VMA$DEL_ADD_RECORD
 yes     yes           Std       6 VMM$COPY_MESSAGE
 yes     yes           Std       3 VOM$MOVE
 yes     yes           Std       6 VMM$COPY_MESSAGE
 yes     yes           Std       2 VMD$PUT_SITE
 yes     yes           Std       6 VMA$ADD_RENTRY
 yes     yes           Std       6 VMA$ADD_UENTRY
         yes           Std       4 VOM$ADDENTRY
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  VM_CGBUFFER                           VO_BNWIO
     STATION#                              VO_INTERSYS_ALLOWED                   TIME_HEAD$
     TIME$                                 INTERSYS_HEAD$                        INTERSYS$
r    VO_BUSY_RETRY_MINUTES            r    VO_PACKSET_RETRY_MINUTES         r    VO_MAX_HOLD_HOURS
r    VO_HOG_LIMIT                          VO_MAILMAN_STARTUP_TIME               VO_INTERSYS_PASSWORD
     VO_INTERSYS_EPASS                     VO_INTERSYS_ACCT                      VO_INTERSYS_UNAME
     VO_RETRY_LIMIT_INTERSYSTEM       r    VM_HEADER$                       r    VM_PROFILE$
r    VM_ADDLIST$                      r    VM_ADDREC$                       r    VM_WORK$
r    VM_SELECT$                       r    VM_PARSEAREA$                    r    VM_INPUT$
r    VM_COPY$                              VM_ENCLLIST$                          VM_ENCLREC$
     VM_HEADER_                            VM_HEADER_INIT_                       VM_PROFILE_
     VM_ADDLIST_                           VM_ADDREC_                            VM_WORK_
     VM_SELECT_                            VM_PARSEAREA_                         VM_INPUT_
     VM_COPY_                              VM_ENCLLIST_                          VM_ENCLREC_
     M$MAIL_FILE                           M$MAIL_CENTRAL                        M$MAIL_GLOBAL
     M$WORK                                M$MAIL_COMGROUP                       M$DO
     M$LO                                  M$ME                                  M$NODE
     M$SI                                  M$MAIL_FILE_NUM                       M$MAIL_CENTRAL_NUM
     M$MAIL_GLOBAL_NUM                     M$WORK_NUM                            M$MAIL_COMGROUP_NUM
     M$DO_NUM                              M$ME_NUM                              M$LO_NUM
     M$SI_NUM                              M$NODE_NUM                       r    B$JIT$
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:179  
r    B$TCB$                                VM_MAIL_ACCT                          VM_NAME_MAP_NAME
     ERRMSG_FID                            VM_SEND_FILE_NAME                     VM_FORWARD_FILE_NAME
     VM_FORWARD_ENCL_NAME                  VM_FORWARD_FILE_PASS                  VM_MAILCG_NAME
     VM_SITENAME                           VM_MAILCG_SETSTA                 r    B$XL_UPPER$
     VO_READ_CG                            VO_NEED_READ                          VO_PROCESS
     MAIL_IN                               MAIL_OUT                              MAIL_FILECOPY
     FREE$                                 CLOSE_MAILIN_SAVE                     CLOSE_MAILIN_SCRATCH
     MAIL_NAME                             OPEN_MAIL                             OUTSTATION
     WRITE_MAILCG                          WRITE_MAILCG                          OUTSTATION

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID                                 ROSID
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:180  


      645        1        /*T***********************************************************/
      646        2        /*T*                                                         */
      647        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      648        4        /*T*                                                         */
      649        5        /*T***********************************************************/
      650        6        VOM$DOSEND: PROC(HEAD$);

      6 16 000000   000000 700200 xent  VOM$DOSEND   TSX0  ! X66_AUTO_1
        16 000001   001310 000001                    ZERO    712,1

      651        7        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
      652        8          %INCLUDE B$JIT;
      653      611          %INCLUDE B_ERRORS_C;
      654     1738          %INCLUDE B_SEGIDS_C;
      655     2277          %INCLUDE CP_6_SUBS;
      656     2817          %INCLUDE VOM_DATA_R;                  /* Also includes CP_6 */
      657    10037          %INCLUDE VM_DATA_R;                   /* Also includes B_MACROS_C */
      658    10468          %INCLUDE VO_SUBS_C;
      659    10519          %INCLUDE VM_PERR_C;
      660    10814          %INCLUDE VW_NODEATER_E;
      661    10870          %INCLUDE XUM_MACRO_C;
      662    10897        %INCLUDE B$TABLES_C;
      663    11005        %INCLUDE XUD_UTS_M;
      664    11087             %XUD$UTS_ENTRIES;
      665    11119             %XUD_UTS_EQU;
      666    11130          %B$XL_UPPER(NAME=LOWER_UPPER);
      667    11134        /***** Based system structures *****/
      668    11135          %B$TCB (STCLASS="BASED(B$TCB$)");
      669    11138          %B$ALT;
      670    11146          %F$DCB;
      671    11203        %FPT_READ (FPTN=VO_READ_CG, STCLASS=SYMREF);
      672    11242    1   DCL VO_NEED_READ BIT(1) SYMREF;
      673    11243    1   DCL VO_PROCESS BIT(1) SYMREF;
      674    11244        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:181  
      675    11245        /***** Mail structures *****/
      676    11246          %VM_ADDTYPES;
      677    11250          %VM_KEYTYPES;
      678    11271          %VM_BODYTYPES;
      679    11277          %VM_DELIVERYPHASES;
      680    11289          %VM_USERKEY;
      681    11305          %VM_PROFILE;
      682    11392          %VM_HEADER;
      683    11521          %VM_SITE;
      684    11545          %VM_SEARCH_INFO(STCLASS=STATIC);
      685    11572          %VM_RADDRESS;
      686    11607          %VM_RADDRESS (NAME=INIT_RADDRESS, STCLASS=CONSTANT);
      687    11642          %VM_UADDRESS;
      688    11679          %VM_RADDRESS(NAME=VM$RADDRESS,STCLASS=BASED);
      689    11714          %VM_UADDRESS(NAME=VM$UADDRESS,STCLASS=BASED);
      690    11751          %VM_RADDRESS (NAME=VM_RETURN_ADDRESS,STCLASS=STATIC);
      691    11786          %VM_DELIVERY (STCLASS=AUTO);
      692    11824          %VM_DELIVERY (NAME=INIT_DELIVERY, STCLASS=CONSTANT);
      693    11862          %VM_DELIVERYKEY (STCLASS=AUTO);
      694    11880          %VM_DELIVERYKEY (NAME=INIT_DELIVERYKEY, STCLASS=CONSTANT);
      695    11898          %VM_FOLDER_INFO;
      696    11950          %VM_BODYREC (NAME=VM_BODYREC_ENCODED, STCLASS=AUTO, ERR_FORMAT=YES);
      697    11982          %VM_BODYREC (NAME=VM$BODYREC, STCLASS=BASED, VARYLEN=YES);
      698    12014          %VM_BODYREC (NAME=INIT_ENCODED_ERR_BODYREC, STCLASS=CONSTANT,
      699    12015                       TYP=%VM_BODY_ENCODED_ERR, ERR_FORMAT=YES);
      700    12047          %VM_ADD_HEAD;
      701    12076        /***** Other variables *****/
      702    12077    1   DCL NEXT_USER$ PTR ALIGNED;
      703    12078    1   DCL ADD_TYPE SBIN WORD ALIGNED;
      704    12079    1   DCL SEND_BC BIT(1) ALIGNED;
      705    12080    1   DCL WAIT_FLAG BIT(1) ALIGNED;
      706    12081    1   DCL NEXT$ PTR;
      707    12082    1   DCL PTR2$ PTR;
      708    12083    1   DCL SAVEN$ PTR;
      709    12084    1   DCL SAVEP$ PTR;
      710    12085    1   DCL HEAD$ PTR;
      711    12086    1   DCL COUNT SBIN;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:182  
      712    12087    1   DCL X$ PTR;
      713    12088    1   DCL ADDRESS$ PTR ALIGNED;
      714    12089    1   DCL P_ERR BIT(1) ALIGNED;
      715    12090    1   DCL ERR_FLAG BIT(1) ALIGNED;
      716    12091    1   DCL MAIL_IN DCB;
      717    12092    1   DCL MAIL_OUT DCB;
      718    12093    1   DCL MAIL_FILECOPY DCB;
      719    12094    1   DCL PROCESSING BIT(1) ALIGNED;
      720    12095    1   DCL INTERSYS_ACTIVE BIT(1) ALIGNED;
      721    12096    1   DCL PTR$ PTR ALIGNED;
      722    12097    1   DCL PROCESS_ERROR SBIN WORD ALIGNED;
      723    12098    1   DCL FREE$ PTR SYMREF;
      724    12099    1   DCL MASK BIT(MASK_LEN) BASED;
      725    12100    1   DCL MASK_LEN UBIN WORD STATIC;
      726    12101    1   DCL ANSI_TIME CHAR (8) STATIC;
      727    12102    1   DCL ANSI_DATE CHAR (6) STATIC;
      728    12103    1   DCL ID CHAR (511);
      729    12104    1   DCL SITENAME CHAR (8);
      730    12105    1   DCL STATUS_STRING CHAR (256);
      731    12106    1   DCL SITE_TYPE UBIN;
      732    12107    1   DCL 1 EXTERNAL,
      733    12108    1         2 SITENAME CHAR (8),
      734    12109    1         2 ACCT CHAR (8);
      735    12110    1   DCL 1 DELIVERY,
      736    12111    1         2 L UBIN BYTE CALIGNED,
      737    12112    1         2 C CHAR (507);
      738    12113    1   DCL RETURN_ADDRESS_BUFFER (0:100) UBIN WORD;
      739    12114    1   DCL MESSAGE_NUMBER UBIN;
      740    12115    1   DCL BAD_ADDRESS_COUNT UBIN WORD;
      741    12116    1   DCL HOG_COUNT UBIN WORD;
      742    12117    1   DCL NUM_RECEIPTS UBIN WORD;
      743    12118    1   DCL DELAY_TIME UBIN WORD;
      744    12119    1   DCL UTS_X SBIN WORD;
      745    12120    1   DCL UTS_Y SBIN WORD;
      746    12121    1   DCL SCRATCH$ PTR;
      747    12122        %MACRO DELIVERY_STATUS (NAME=DELIVERY_STATUS, STCLASS=AUTO);
      748    12123        DCL 1 NAME STCLASS,          /* nonzero if mailgram not fully delivered yet */
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:183  
      749    12124              2 BUSY BIT (1),    /* mailbox file or profile busy;  try later */
      750    12125              2 PACKSET_NA BIT (1), /* packset not mounted or unavailable; try later */
      751    12126              2 IO_ERROR BIT (1), /* I/O error on mailbox; reject & report */
      752    12127              2 HOG_LIMIT BIT (1); /* this mailgram is hogging MAILMAN;  requeue */
      753    12128        %MEND;
      754    12129        %DELIVERY_STATUS (NAME=UNDELIVERED);
      755    12136        %DELIVERY_STATUS (NAME=DELIVERY_SUMMARY);
      756    12143          %VLP_NAME (FPTN=BLIND_TEXT,LEN=511,STCLASS=STATIC);
      757    12170        /***** Variablesfor intersystem address lists *****/
      758    12171    1   DCL ITO_HEAD$ PTR STATIC;               /* Ptr to head of internal to list */
      759    12172    1   DCL IBC_HEAD$ PTR STATIC;               /* Ptr to head of internal bc list */
      760    12173    1   DCL IC_HEAD$ PTR STATIC;                /* Ptr to head of internal c list */
      761    12174          %XUM$MCB (NAME=IADDLIST_MCB,STCLASS=STATIC);
      762    12178        /***** Fpts *****/
      763    12179          %XUM$MCB (NAME=HEADER_MCB,STCLASS=STATIC);
      764    12183          %FPT_CLOSE (FPTN=CLOSE_MAILIN_SAVE,
      765    12184                            STCLASS="SYMREF");
      766    12226          %FPT_CLOSE (FPTN=CLOSE_MAILIN_SCRATCH,
      767    12227                            STCLASS="SYMREF");
      768    12269        %VLP_NAME (FPTN=MAIL_NAME, STCLASS=SYMREF, LEN=31);
      769    12296          %FPT_OPEN(FPTN=OPEN_MAIL,STCLASS="SYMREF");
      770    12405          %FPT_CLOSE (FPTN=CLOSE_MAIL_OUT,DCB=MAIL_OUT,DISP=SAVE);
      771    12447          %FPT_CLOSE (FPTN=CLOSE_MAIL_OUT_RELEASE,DCB=MAIL_OUT,DISP=RELEASE);
      772    12489          %FPT_CLOSE (FPTN=RENAME_BAD_FILE,
      773    12490                      DCB=MAIL_IN,
      774    12491                      NAME=NEW_NAME);
      775    12533          %VLP_NAME  (FPTN=NEW_NAME, L=31);
      776    12560          %VLP_ERRCODE (FPTN=ERROR);
      777    12605              %VLP_ERRCODE (FPTN=E_ADDUNKNOWN, FCG="VO",MID="M",
      778    12606              ERR#=%E$ADDUNKNOWN, STCLASS=CONSTANT);
      779    12651        /*E*  ERROR:   VOM-E$ADDUNKNOWN-0
      780    12652              MESSAGE: <> is not a registered user name or a global
      781    12653                       distribution list.
      782    12654        */
      783    12655              %VLP_STATION (FPTN=OUTSTATION, STCLASS="SYMREF");
      784    12682              %FPT_WRITE(FPTN=WRITE_MAILCG,STCLASS="SYMREF",
      785    12683              BUF=VM_CGBUFFER);
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:184  
      786    12714
      787    12715          %VLP_NAME (FPTN=WORK_TEXTC,LEN=511,STCLASS=STATIC);
      788    12742
      789    12743          %FPT_TIME (FPTN=GET_CURRENT,
      790    12744                         SOURCE=CLOCK,
      791    12745                         DEST=UTS,
      792    12746                         TSTAMP=CURRENT_TIME);
      793    12765        %FPT_TIME  (FPTN=GET_ANSI_TIME,
      794    12766                    STCLASS=CONSTANT,
      795    12767                    SOURCE=UTS,
      796    12768                    DEST=ANS,
      797    12769                    TSTAMP=WORK_TIME,
      798    12770                    TIME=ANSI_TIME,
      799    12771                    DATE=ANSI_DATE);
      800    12790        %FPT_WAIT (FPTN=WAIT2, UNITS=2, STCLASS=CONSTANT);
      801    12804
      802    12805        %FPT_ENQ (FPTN=ENQ_PROFILE, STCLASS=CONSTANT,
      803    12806                  DCB=MAIL_OUT,
      804    12807                  SHARE=NONE,
      805    12808                  WAIT=YES,
      806    12809                  RNAME=VM_PRORES,
      807    12810                  WAIT_TIME=2);
      808    12828
      809    12829        %FPT_DEQ (FPTN=DEQ_PROFILE, STCLASS=CONSTANT,
      810    12830                  DCB=MAIL_OUT,
      811    12831                  RNAME=VM_PRORES);
      812    12848
      813    12849        %VM_PRORES (STCLASS=CONSTANT);
      814    12863
      815    12864        %FPT_ENQ (FPTN=ENQ_HEADER, STCLASS=CONSTANT,
      816    12865                  DCB=MAIL_OUT,
      817    12866                  SHARE=NONE,
      818    12867                  WAIT=YES,
      819    12868                  RNAME=VM_HEADRES);
      820    12886
      821    12887        %FPT_DEQ (FPTN=DEQ_HEADER, STCLASS=CONSTANT,
      822    12888                  DCB=MAIL_OUT,
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:185  
      823    12889                  RNAME=VM_HEADRES);
      824    12906
      825    12907        %VM_HEADRES (STCLASS=STATIC);
      826    12921
      827    12922        %FPT_RESCTL    (FPTN=REL_PACK,RPSN=RPSN);
      828    12939
      829    12940        %VLP_RPSN      (FPTN=RPSN,
      830    12941                            DISP=REM,
      831    12942                            N=50);
      832    12957
      833    12958          %VLP_ERRCODE (FPTN=E_INTERSYSILL,FCG="VO",MID="M",
      834    12959                      ERR#=%E$INTERSYSILL,STCLASS=CONSTANT);
      835    13004        /*E* ERROR: VOM-E$INTERSYSILL-0
      836    13005             MESSAGE:Intersystem mail is disabled; can't send to <>
      837    13006        */
      838    13007              %VLP_ERRCODE (FPTN=E_NOMID,FCG="VO",MID="M",
      839    13008              ERR#=%E$NOMID,STCLASS=CONSTANT);
      840    13053        /*E* ERROR: VOM-E$NOMID-0
      841    13054             MESSAGE:No mail folder has been created for <>
      842    13055          */
      843    13056              %VLP_ERRCODE (FPTN=E_WRONGOWNER,FCG="VO",MID="M",
      844    13057              ERR#=%E$WRONGOWNER,STCLASS=CONSTANT);
      845    13102        /*E*    ERROR: VOM-E$WRONGOWNER-0
      846    13103                MESSAGE:Specified folder does not belong to user <>.
      847    13104                        Notify your mail administrator.
      848    13105        */
      849    13106              %VLP_ERRCODE (FPTN=E_PROERR,FCG="VO",MID=M,
      850    13107              ERR#=%E$PROERR,STCLASS=CONSTANT);
      851    13152        /*E*  ERROR: VOM-E$PROERR-0
      852    13153             MESSAGE:The folder for <> is malformed or damaged.
      853    13154                     MAIL can not deliver messages to that folder.
      854    13155        */
      855    13156              %VLP_ERRCODE (FPTN=E_FOLDERFULL,FCG="VO",MID="M",
      856    13157              ERR#=%E$FOLDERFULL,STCLASS=CONSTANT);
      857    13202        /*E*    ERROR: VOM-E$FOLDERFULL-0
      858    13203                MESSAGE:Folder< for <>> is full.
      859    13204        */
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:186  
      860    13205              %VLP_ERRCODE (FPTN=E_DISKSPACE,FCG="VO",MID="M",
      861    13206              ERR#=%E$DISKSPACE,STCLASS=CONSTANT);
      862    13251        /*E*    ERROR: VOM-E$DISKSPACE-0
      863    13252                MESSAGE:Account disk space< for <>> has been exceeded.
      864    13253                         MAIL can not deliver a message.
      865    13254        */
      866    13255              %VLP_ERRCODE (FPTN=E_DELIVERED,FCG="VO",MID="M",
      867    13256              ERR#=%E$DELIVERED,STCLASS=CONSTANT);
      868    13301        /*E*    ERROR: VOM-E$DELIVERED-0
      869    13302                MESSAGE:Delivered %U1 to <>
      870    13303        */
      871    13304              %VLP_ERRCODE (FPTN=E_RRACKED,FCG="VO",MID="M",
      872    13305              ERR#=%E$RRACKED,STCLASS=CONSTANT);
      873    13350        /*E*    ERROR: VOM-E$RRACKED-0
      874    13351                MESSAGE:Return receipt %U1 from <>
      875    13352        */
      876    13353              %VLP_ERRCODE (FPTN=E_ACKED,FCG="VO",MID="M",
      877    13354              ERR#=%E$ACKED,STCLASS=CONSTANT);
      878    13399        /*E*    ERROR: VOM-E$ACKED-0
      879    13400                MESSAGE:Acknowledged %U1 by <>
      880    13401        */
      881    13402              %VLP_ERRCODE (FPTN=E_ANSWERED,FCG="VO",MID="M",
      882    13403              ERR#=%E$ANSWERED,STCLASS=CONSTANT);
      883    13448        /*E*    ERROR: VOM-E$ANSWERED-0
      884    13449                MESSAGE:Answered %U1 by <> %(see #%U2)%
      885    13450        */
      886    13451
      887    13452    1   DCL WORK_TIME UBIN WORD STATIC;
      888    13453    1   DCL CURRENT_TIME UBIN WORD STATIC;
      889    13454        /***** External routines *****/
      890    13455    1   DCL VOM$ADDENTRY ENTRY(4);
      891    13456    1   DCL VOM$ADDENTRY_SORTED ENTRY(4);
      892    13457    1   DCL VOM$DELENTRY ENTRY(3);
      893    13458    1   DCL VMD$GET_HEADER ENTRY(2) ALTRET;
      894    13459    1   DCL VMD$PUT_HEADER ENTRY (2) ALTRET;
      895    13460    1   DCL VMD$GET_DELIVERY ENTRY (3) ALTRET;
      896    13461    1   DCL VMD$GET_DELIVERY_NEXT ENTRY (3) ALTRET;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:187  
      897    13462    1   DCL VMD$PUT_DELIVERY ENTRY (3) ALTRET;
      898    13463    1   DCL VMD$MERGE_DELIVERY ENTRY (3) ALTRET;
      899    13464    1   DCL VMD$DEL_DELIVERY ENTRY (2) ALTRET;
      900    13465    1   DCL VMD$GET_ID ENTRY (3) ALTRET;
      901    13466    1   DCL VMD$GET_SITE ENTRY (2) ALTRET;
      902    13467    1   DCL VMD$PUT_SITE ENTRY (2) ALTRET;
      903    13468    1   DCL VMA$OPEN_FOLDER   ENTRY(5) ALTRET;
      904    13469    1   DCL VMD$GET_BODY ENTRY (7) ALTRET;
      905    13470    1   DCL VMD$PUT_BODY ENTRY (7) ALTRET;
      906    13471    1   DCL VMD$GET_TRACE ENTRY (7) ALTRET;
      907    13472    1   DCL VMD$PUT_TRACE ENTRY (7) ALTRET;
      908    13473    1   DCL VMA$ENLARGE_SEGMENT ENTRY(2) ALTRET;
      909    13474    1   DCL VMA$GET_ADD_RECORD ENTRY(4) ALTRET;
      910    13475    1   DCL VMA$OPEN_GLOBAL ENTRY(1) ALTRET;
      911    13476    1   DCL VMA$GET_NEXT_ENTRY ENTRY(4) ALTRET;
      912    13477    1   DCL VMA$GET_SITE_NAME ENTRY(4) ALTRET;
      913    13478    1   DCL VMA$DEL_ADD_RECORD ENTRY(4) ALTRET;
      914    13479    1   DCL VMA$EXPAND_LIST_FULL ENTRY(5) ALTRET;
      915    13480    1   DCL VMA$GET_LIST ENTRY(3) ALTRET;
      916    13481    1   DCL VMA$ADD_RENTRY ENTRY(6) ALTRET;
      917    13482    1   DCL VMA$ADD_UENTRY ENTRY(6) ALTRET;
      918    13483    1   DCL VMA$PUT_ADD_RECORD ENTRY(4) ALTRET;
      919    13484    1   DCL VMF$MAKE_ADDRESS2 ENTRY(3);
      920    13485    1   DCL VMM$COPY_MESSAGE ENTRY(6) ALTRET;
      921    13486    1   DCL VMM$COPY_MESSAGE_BODY ENTRY (6) ALTRET;
      922    13487    1   DCL VMM$COMBINE_MESSAGE ENTRY (3) ALTRET;
      923    13488    1   DCL VOM$PROCESS ENTRY;
      924    13489    1   DCL X$ALLOCATE ENTRY(1) ALTRET;
      925    13490    1   DCL X$DEALLOCATE ENTRY(1) ALTRET;

  13490 16 000002                       START_UP     null
      926    13491        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:188  
      927    13492    1   START_UP:;
      928    13493    1       STATUS_STRING = 'Acquiring a mailgram';

  13493 16 000002   040100 100400                    MLR     fill='040'O
        16 000003   000464 000024 12                 ADSC9   E_BADSITE+1              cn=0,n=20
        16 000004   200462 000400                    ADSC9   STATUS_STRING,,AUTO      cn=0,n=256

      929    13494    1       CALL UPDATE_STATUS;

  13494 16 000005   003114 701000 16                 TSX1    UPDATE_STATUS
        16 000006   000000 011000                    NOP     0

      930    13495    1       TIME$ = HEAD$;                    /* Point to first entry */

  13495 16 000007   200003 470500                    LDP0    @HEAD$,,AUTO
        16 000010   000000 236100                    LDQ     0,,PR0
        16 000011   000000 756000 xsym               STQ     TIME$

      931    13496    1       SEND_BC = %NO#;

  13496 16 000012   200241 450100                    STZ     SEND_BC,,AUTO

      932    13497    1       BLIND_TEXT.L# = 0;

  13497 16 000013   000000 236003                    LDQ     0,DU
        16 000014   000506 552040 11                 STBQ    BLIND_TEXT,'40'O

      933    13498
      934    13499    1       MAIL_NAME = TIME_TABLE.NAME;      /* Get name of file */

  13499 16 000015   000000 471400 xsym               LDP1    TIME$
        16 000016   000000 100500                    MLR     fill='000'O
        16 000017   100006 200040                    ADSC9   6,,PR1                   cn=1,n=32
        16 000020   000000 000040 xsym               ADSC9   MAIL_NAME                cn=0,n=32

      935    13500    1       CALL M$OPEN (OPEN_MAIL) ALTRET(BAD_MAIL);

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:189  
  13500 16 000021   000000 630400 xsym               EPPR0   OPEN_MAIL
        16 000022   450000 713400                    CLIMB   alt,open
        16 000023   410400 401760                    pmme    nvectors=18
        16 000024   002706 702000 16                 TSX2    BAD_MAIL

      936    13501        /*
      937    13502             ***** Try to read the site record.
      938    13503                   If this message came from another system, then
      939    13504                   it should have a record of where it came from.
      940    13505                   Otherwise, the message originated locally ...
      941    13506        */
      942    13507    1       CALL VMD$GET_SITE (VM_SITE,DCBNUM(MAIL_IN))

  13507 16 000025   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 000026   201272 756100                    STQ     I+1,,AUTO
        16 000027   201272 630500                    EPPR0   I+1,,AUTO
        16 000030   201275 450500                    STP0    I+4,,AUTO
        16 000031   000001 236000 17                 LDQ     1
        16 000032   201274 756100                    STQ     I+3,,AUTO
        16 000033   201274 630500                    EPPR0   I+3,,AUTO
        16 000034   000000 631400 17                 EPPR1   0
        16 000035   000000 701000 xent               TSX1    VMD$GET_SITE
        16 000036   000042 702000 16                 TSX2    s:13513

      943    13508    2       WHENRETURN DO;

      944    13509    2           INTERSYS_ACTIVE = '1'B;

  13509 16 000037   400000 236003                    LDQ     -131072,DU
        16 000040   200255 756100                    STQ     INTERSYS_ACTIVE,,AUTO

      945    13510    2       END;

  13510 16 000041   000052 710000 16                 TRA     s:13523

      946    13511    1       WHENALTRETURN
      947    13512    2       DO;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:190  

      948    13513    2           VM_SITE = '0'B;

  13513 16 000042   000000 100400                    MLR     fill='000'O
        16 000043   000002 000001 17                 ADSC9   2                        cn=0,n=1
        16 000044   000063 000340 11                 ADSC9   VM_SITE                  cn=0,n=224

      949    13514    2           INTERSYS_ACTIVE = '0'B;

  13514 16 000045   200255 450100                    STZ     INTERSYS_ACTIVE,,AUTO

      950    13515    2           VM_SITE.ORIGIN = VM_SITENAME;

  13515 16 000046   040000 100400                    MLR     fill='040'O
        16 000047   000000 000010 xsym               ADSC9   VM_SITENAME              cn=0,n=8
        16 000050   000065 000010 11                 ADSC9   VM_SITE+2                cn=0,n=8

      951    13516    2           VM_SITE.NUM_SITES = 0;

  13516 16 000051   000064 450000 11                 STZ     VM_SITE+1

      952    13517    2       END;

      953    13518        /*
      954    13519             ***** If RETURN_TO_ORIGIN is set,
      955    13520                   then pretend that this site originated the
      956    13521                   message ...
      957    13522        */
      958    13523    1       IF VM_SITE.FLAGS.RETURN_TO_ORIGIN

  13523 16 000052   000063 234000 11                 SZN     VM_SITE
        16 000053   000062 605000 16                 TPL     s:13533

      959    13524    1       THEN
      960    13525    2       DO;

      961    13526    2           VM_SITE.FLAGS.RETURN_TO_ORIGIN = %NO#;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:191  

  13526 16 000054   000003 236000 17                 LDQ     3
        16 000055   000063 356000 11                 ANSQ    VM_SITE

      962    13527    2           VM_SITE.ORIGIN = VM_SITENAME;

  13527 16 000056   040000 100400                    MLR     fill='040'O
        16 000057   000000 000010 xsym               ADSC9   VM_SITENAME              cn=0,n=8
        16 000060   000065 000010 11                 ADSC9   VM_SITE+2                cn=0,n=8

      963    13528    2           VM_SITE.NUM_SITES = 0;

  13528 16 000061   000064 450000 11                 STZ     VM_SITE+1

      964    13529    2       END;

      965    13530        /*
      966    13531             ***** Now get the message header ...
      967    13532        */
      968    13533    1       CALL REFRESH_INPUT_HEADER ALTRET (BAD_MAIL);

  13533 16 000062   002752 701000 16                 TSX1    REFRESH_INPUT_HEADER
        16 000063   002706 702000 16                 TSX2    BAD_MAIL

      969    13534    1       IF VM_HEADER.FROM$ ~= ADDR(NIL)

  13534 16 000064   000000 470400 xsym               LDP0    VM_HEADER$
        16 000065   000023 236100                    LDQ     19,,PR0
        16 000066   000004 116000 17                 CMPQ    4
        16 000067   000104 600000 16                 TZE     s:13543
        16 000070   000000 471400 xsym               LDP1    B$JIT$
        16 000071   100013 236100                    LDQ     11,,PR1
        16 000072   000040 316007                    CANQ    32,DL
        16 000073   000104 600000 16                 TZE     s:13543

      970    13535    1         AND B$JIT.PRIV.ACTIVE.JIT
      971    13536    1       THEN
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:192  
      972    13537    1           B$JIT.JOBNAME = VM_HEADER.FROM$ -> X$STRING.TEXT;

  13537 16 000074   000023 473500                    LDP3    19,,PR0
        16 000075   000100 101500                    MRL     fill='000'O
        16 000076   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        16 000077   201272 000002                    ADSC9   I+1,,AUTO                cn=0,n=2
        16 000100   201272 220100                    LDX0    I+1,,AUTO
        16 000101   040100 100540                    MLR     fill='040'O
        16 000102   300000 200010                    ADSC9   0,,PR3                   cn=1,n=*X0
        16 000103   100156 200037                    ADSC9   110,,PR1                 cn=1,n=31

      973    13538        /*
      974    13539             ***** If this message has never been seen before, stuff the
      975    13540                   current UTS into the first-seen time field and set the
      976    13541                   delivery phase to "startup".
      977    13542        */
      978    13543    1       IF VM_HEADER.FIRST_DELIVERY = 0

  13543 16 000104   000003 235100                    LDA     3,,PR0
        16 000105   000130 601000 16                 TNZ     s:13553

      979    13544    2       THEN DO;

      980    13545    2           CALL M$TIME (GET_CURRENT);

  13545 16 000106   001300 630400 11                 EPPR0   GET_CURRENT
        16 000107   020004 713400                    CLIMB   8196
        16 000110   402000 401760                    pmme    nvectors=5

      981    13546    2           VM_HEADER.FIRST_DELIVERY = CURRENT_TIME;

  13546 16 000111   000000 470400 xsym               LDP0    VM_HEADER$
        16 000112   001657 235000 11                 LDA     CURRENT_TIME
        16 000113   000003 755100                    STA     3,,PR0

      982    13547    2           VM_HEADER.MISC.PHASE = %VM_PHASE_STARTUP;

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:193  
  13547 16 000114   000005 236000 17                 LDQ     5
        16 000115   000013 356100                    ANSQ    11,,PR0

      983    13548    2           CALL VMD$PUT_HEADER (0, DCBNUM(MAIL_IN)) ALTRET (BAD_MAIL);

  13548 16 000116   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 000117   201272 756100                    STQ     I+1,,AUTO
        16 000120   201272 631500                    EPPR1   I+1,,AUTO
        16 000121   201275 451500                    STP1    I+4,,AUTO
        16 000122   000006 236000 17                 LDQ     6
        16 000123   201274 756100                    STQ     I+3,,AUTO
        16 000124   201274 630500                    EPPR0   I+3,,AUTO
        16 000125   000000 631400 17                 EPPR1   0
        16 000126   000000 701000 xent               TSX1    VMD$PUT_HEADER
        16 000127   002706 702000 16                 TSX2    BAD_MAIL

      984    13549    2       END;

      985    13550        /*
      986    13551             ***** Save the return address info ...
      987    13552        */
      988    13553    1       VM_RETURN_ADDRESS = VM_HEADER.RETURN_ADDRESS$ -> VM$RADDRESS;

  13553 16 000130   000000 470400 xsym               LDP0    VM_HEADER$
        16 000131   000026 471500                    LDP1    22,,PR0
        16 000132   000000 100500                    MLR     fill='000'O
        16 000133   100000 000117                    ADSC9   0,,PR1                   cn=0,n=79
        16 000134   000346 000117 11                 ADSC9   VM_RETURN_ADDRESS        cn=0,n=79

      989    13554    1       ERR_FLAG = VM_HEADER.STATUS.ERR;

  13554 16 000135   000012 236100                    LDQ     10,,PR0
        16 000136   400000 376003                    ANQ     -131072,DU
        16 000137   200253 756100                    STQ     ERR_FLAG,,AUTO

      990    13555
      991    13556    1   PROCESS:
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:194  
      992    13557    2       DO UNTIL VM_HEADER.MISC.PHASE = %VM_PHASE_FINI;

  13557 16 000140                       PROCESS      null
      993    13558    2           UNDELIVERED = '0'B;

  13558 16 000140   201143 450100                    STZ     UNDELIVERED,,AUTO

      994    13559    2   ONE_PHASE:
      995    13560    3           DO CASE (VM_HEADER.MISC.PHASE);

  13560 16 000141   000000 470400 xsym  ONE_PHASE    LDP0    VM_HEADER$
        16 000142   000013 236100                    LDQ     11,,PR0
        16 000143   000040 772000                    QRL     32
        16 000144   000012 116007                    CMPQ    10,DL
        16 000145   000147 602006 16                 TNC     ONE_PHASE+6,QL
        16 000146   002527 710000 16                 TRA     s:14154
        16 000147   000161 710000 16                 TRA     s:13566
        16 000150   000206 710000 16                 TRA     s:13579
        16 000151   000255 710000 16                 TRA     s:13596
        16 000152   000432 710000 16                 TRA     s:13642
        16 000153   001400 710000 16                 TRA     s:13916
        16 000154   001260 710000 16                 TRA     s:13872
        16 000155   001702 710000 16                 TRA     s:13979
        16 000156   001260 710000 16                 TRA     s:13872
        16 000157   002224 710000 16                 TRA     s:14067
        16 000160   002522 710000 16                 TRA     s:14147

      996    13561        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:195  
      997    13562    3           CASE (%VM_PHASE_STARTUP);

      998    13563                 /* Startup.  Assign a message ID if none was assigned by SEND (which
      999    13564                    generally means that this message originated in a pre-B00 mail
     1000    13565                    environment. */
     1001    13566    3               IF VM_HEADER.UNIQUE_ID$ = ADDR(NIL)

  13566 16 000161   000032 236100                    LDQ     26,,PR0
        16 000162   000004 116000 17                 CMPQ    4
        16 000163   002527 601000 16                 TNZ     s:14154

     1002    13567    4               THEN DO;

     1003    13568    4                   STATUS_STRING = 'Assigning a message ID';

  13568 16 000164   040100 100400                    MLR     fill='040'O
        16 000165   000471 000026 12                 ADSC9   E_BADSITE+6              cn=0,n=22
        16 000166   200462 000400                    ADSC9   STATUS_STRING,,AUTO      cn=0,n=256

     1004    13569    4                   CALL UPDATE_STATUS;

  13569 16 000167   003114 701000 16                 TSX1    UPDATE_STATUS
        16 000170   000000 011000                    NOP     0

     1005    13570    4                   CALL ASSIGN_A_MESSAGE_ID

  13570 16 000171   003011 701000 16                 TSX1    ASSIGN_A_MESSAGE_ID
        16 000172   000205 702000 16                 TSX2    s:13574

     1006    13571    5                   WHENRETURN DO;

     1007    13572    5                       CALL VMD$PUT_HEADER (0, DCBNUM(MAIL_IN)) ALTRET (BAD_MAIL);

  13572 16 000173   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 000174   201272 756100                    STQ     I+1,,AUTO
        16 000175   201272 630500                    EPPR0   I+1,,AUTO
        16 000176   201275 450500                    STP0    I+4,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:196  
        16 000177   000006 236000 17                 LDQ     6
        16 000200   201274 756100                    STQ     I+3,,AUTO
        16 000201   201274 630500                    EPPR0   I+3,,AUTO
        16 000202   000000 631400 17                 EPPR1   0
        16 000203   000000 701000 xent               TSX1    VMD$PUT_HEADER
        16 000204   002706 702000 16                 TSX2    BAD_MAIL

     1008    13573    5                   END;

     1009    13574    4               END;

  13574 16 000205   002527 710000 16                 TRA     s:14154

     1010    13575        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:197  
     1011    13576    3           CASE (%VM_PHASE_RESOLVE_FC);

     1012    13577                 /* Resolve the File Copy address and write a deliver record into
     1013    13578                    the file. */
     1014    13579    3               IF NOT VM_HEADER.STATUS.FCOPY

  13579 16 000206   000012 236100                    LDQ     10,,PR0
        16 000207   000200 316003                    CANQ    128,DU
        16 000210   002527 600000 16                 TZE     s:14154

     1015    13580    3               THEN
     1016    13581    3                   EXIT ONE_PHASE;
     1017    13582    3               STATUS_STRING = 'Storing file-copy address';

  13582 16 000211   040100 100400                    MLR     fill='040'O
        16 000212   000477 000031 12                 ADSC9   E_BADSITE+12             cn=0,n=25
        16 000213   200462 000400                    ADSC9   STATUS_STRING,,AUTO      cn=0,n=256

     1018    13583    3               CALL UPDATE_STATUS;

  13583 16 000214   003114 701000 16                 TSX1    UPDATE_STATUS
        16 000215   000000 011000                    NOP     0

     1019    13584    3               IF VM_HEADER.FILE_FOLDER$ = ADDR(NIL)

  13584 16 000216   000000 470400 xsym               LDP0    VM_HEADER$
        16 000217   000022 236100                    LDQ     18,,PR0
        16 000220   000004 116000 17                 CMPQ    4
        16 000221   000226 601000 16                 TNZ     s:13588

     1020    13585    3               THEN
     1021    13586    3                   VM_RADDRESS = VM_RETURN_ADDRESS;

  13586 16 000222   000000 100400                    MLR     fill='000'O
        16 000223   000346 000117 11                 ADSC9   VM_RETURN_ADDRESS        cn=0,n=79
        16 000224   000216 000117 11                 ADSC9   VM_RADDRESS              cn=0,n=79
        16 000225   000232 710000 16                 TRA     s:13589
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:198  

     1022    13587    3               ELSE
     1023    13588    3                   VM_RADDRESS = VM_HEADER.FILE_FOLDER$ -> VM$RADDRESS;

  13588 16 000226   000022 471500                    LDP1    18,,PR0
        16 000227   000000 100500                    MLR     fill='000'O
        16 000230   100000 000117                    ADSC9   0,,PR1                   cn=0,n=79
        16 000231   000216 000117 11                 ADSC9   VM_RADDRESS              cn=0,n=79

     1024    13589    3               ADD_TYPE = -1;

  13589 16 000232   000001 335007                    LCA     1,DL
        16 000233   200240 755100                    STA     ADD_TYPE,,AUTO

     1025    13590    3               CALL INIT_DELIVERY_RECORD;

  13590 16 000234   003215 701000 16                 TSX1    INIT_DELIVERY_RECORD
        16 000235   000000 011000                    NOP     0

     1026    13591    3               VM_DELIVERY.FLAGS.FC = %YES#;

  13591 16 000236   010000 236003                    LDQ     4096,DU
        16 000237   200005 256100                    ORSQ    VM_DELIVERY+1,,AUTO

     1027    13592    3               CALL VMD$PUT_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY, VM_DELIVERY);

  13592 16 000240   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 000241   201272 756100                    STQ     I+1,,AUTO
        16 000242   200004 630500                    EPPR0   VM_DELIVERY,,AUTO
        16 000243   201275 450500                    STP0    I+4,,AUTO
        16 000244   200107 631500                    EPPR1   VM_DELIVERYKEY,,AUTO
        16 000245   201274 451500                    STP1    I+3,,AUTO
        16 000246   201272 633500                    EPPR3   I+1,,AUTO
        16 000247   201273 453500                    STP3    I+2,,AUTO
        16 000250   201273 630500                    EPPR0   I+2,,AUTO
        16 000251   000007 631400 17                 EPPR1   7
        16 000252   000000 701000 xent               TSX1    VMD$PUT_DELIVERY
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:199  
        16 000253   000000 011000                    NOP     0
        16 000254   002527 710000 16                 TRA     s:14154

     1028    13593        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:200  
     1029    13594    3           CASE (%VM_PHASE_DELIVER_FC);

     1030    13595                 /* Actually deliver the file copy. */
     1031    13596    3               IF NOT VM_HEADER.STATUS.FCOPY

  13596 16 000255   000012 236100                    LDQ     10,,PR0
        16 000256   000200 316003                    CANQ    128,DU
        16 000257   002527 600000 16                 TZE     s:14154

     1032    13597    3               THEN
     1033    13598    3                   EXIT ONE_PHASE;
     1034    13599    3               STATUS_STRING = 'Delivering file copy';

  13599 16 000260   040100 100400                    MLR     fill='040'O
        16 000261   000506 000024 12                 ADSC9   E_BADSITE+19             cn=0,n=20
        16 000262   200462 000400                    ADSC9   STATUS_STRING,,AUTO      cn=0,n=256

     1035    13600    3               CALL UPDATE_STATUS;

  13600 16 000263   003114 701000 16                 TSX1    UPDATE_STATUS
        16 000264   000000 011000                    NOP     0

     1036    13601    3               IF VM_HEADER.FILE_FOLDER$ = ADDR(NIL)

  13601 16 000265   000000 470400 xsym               LDP0    VM_HEADER$
        16 000266   000022 236100                    LDQ     18,,PR0
        16 000267   000004 116000 17                 CMPQ    4
        16 000270   000275 601000 16                 TNZ     s:13605

     1037    13602    3               THEN
     1038    13603    3                   VM_RADDRESS = VM_RETURN_ADDRESS;

  13603 16 000271   000000 100400                    MLR     fill='000'O
        16 000272   000346 000117 11                 ADSC9   VM_RETURN_ADDRESS        cn=0,n=79
        16 000273   000216 000117 11                 ADSC9   VM_RADDRESS              cn=0,n=79
        16 000274   000301 710000 16                 TRA     s:13606

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:201  
     1039    13604    3               ELSE
     1040    13605    3                   VM_RADDRESS = VM_HEADER.FILE_FOLDER$ -> VM$RADDRESS;

  13605 16 000275   000022 471500                    LDP1    18,,PR0
        16 000276   000000 100500                    MLR     fill='000'O
        16 000277   100000 000117                    ADSC9   0,,PR1                   cn=0,n=79
        16 000300   000216 000117 11                 ADSC9   VM_RADDRESS              cn=0,n=79

     1041    13606    3               CALL INIT_DELIVERY_RECORD;

  13606 16 000301   003215 701000 16                 TSX1    INIT_DELIVERY_RECORD
        16 000302   000000 011000                    NOP     0

     1042    13607    3               CALL VMD$GET_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY, VM_DELIVERY)
             13607                        ALTRET (BAD_MAIL);

  13607 16 000303   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 000304   201272 756100                    STQ     I+1,,AUTO
        16 000305   200004 630500                    EPPR0   VM_DELIVERY,,AUTO
        16 000306   201275 450500                    STP0    I+4,,AUTO
        16 000307   200107 631500                    EPPR1   VM_DELIVERYKEY,,AUTO
        16 000310   201274 451500                    STP1    I+3,,AUTO
        16 000311   201272 633500                    EPPR3   I+1,,AUTO
        16 000312   201273 453500                    STP3    I+2,,AUTO
        16 000313   201273 630500                    EPPR0   I+2,,AUTO
        16 000314   000007 631400 17                 EPPR1   7
        16 000315   000000 701000 xent               TSX1    VMD$GET_DELIVERY
        16 000316   002706 702000 16                 TSX2    BAD_MAIL

     1043    13608    3               VM_HEADER.STATUS.RR = %NO#;

  13608 16 000317   000000 470400 xsym               LDP0    VM_HEADER$
        16 000320   000010 236000 17                 LDQ     8
        16 000321   000012 356100                    ANSQ    10,,PR0

     1044    13609    3               VM_HEADER.STATUS.DR = %NO#;

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:202  
  13609 16 000322   000011 236000 17                 LDQ     9
        16 000323   000012 356100                    ANSQ    10,,PR0

     1045    13610    3               CALL VOM$SENDIT

  13610 16 000324   004074 701000 16                 TSX1    VOM$SENDIT
        16 000325   000330 702000 16                 TSX2    s:13615

     1046    13611    4               WHENRETURN DO;

     1047    13612    4                   ERROR = '0'B;

  13612 16 000326   001076 450000 11                 STZ     ERROR

     1048    13613    4               END;

  13613 16 000327   000360 710000 16                 TRA     s:13623

     1049    13614    4               WHENALTRETURN DO;

     1050    13615    4                   IF UNDELIVERED.BUSY OR UNDELIVERED.PACKSET_NA

  13615 16 000330   201143 234100                    SZN     UNDELIVERED,,AUTO
        16 000331   002564 604000 16                 TMI     s:14162
        16 000332   201143 236100                    LDQ     UNDELIVERED,,AUTO
        16 000333   200000 316003                    CANQ    65536,DU
        16 000334   002564 601000 16                 TNZ     s:14162

     1051    13616    4                   THEN
     1052    13617    4                       EXIT PROCESS;
     1053    13618    4                   CALL REFRESH_INPUT_HEADER ALTRET (BAD_MAIL);

  13618 16 000335   002752 701000 16                 TSX1    REFRESH_INPUT_HEADER
        16 000336   002706 702000 16                 TSX2    BAD_MAIL

     1054    13619    4                   VM_HEADER.STATUS.FCOPY = %NO#;

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:203  
  13619 16 000337   000000 470400 xsym               LDP0    VM_HEADER$
        16 000340   000012 236000 17                 LDQ     10
        16 000341   000012 356100                    ANSQ    10,,PR0

     1055    13620    4                   CALL VMD$PUT_HEADER (0, DCBNUM(MAIL_IN)) ALTRET (BAD_MAIL);

  13620 16 000342   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 000343   201272 756100                    STQ     I+1,,AUTO
        16 000344   201272 631500                    EPPR1   I+1,,AUTO
        16 000345   201275 451500                    STP1    I+4,,AUTO
        16 000346   000006 236000 17                 LDQ     6
        16 000347   201274 756100                    STQ     I+3,,AUTO
        16 000350   201274 630500                    EPPR0   I+3,,AUTO
        16 000351   000000 631400 17                 EPPR1   0
        16 000352   000000 701000 xent               TSX1    VMD$PUT_HEADER
        16 000353   002706 702000 16                 TSX2    BAD_MAIL

     1056    13621    4                   IF VM_RADDRESS.FLAGS.UNDEF# THEN ERROR = E_ADDUNKNOWN;

  13621 16 000354   000220 234000 11                 SZN     VM_RADDRESS+2
        16 000355   000360 605000 16                 TPL     s:13623

  13621 16 000356   000257 236000 12                 LDQ     E_ADDUNKNOWN
        16 000357   001076 756000 11                 STQ     ERROR

     1057    13622    4               END;

     1058    13623    3               VM_DELIVERY.ERR = ERROR;

  13623 16 000360   001076 236000 11                 LDQ     ERROR
        16 000361   200006 756100                    STQ     VM_DELIVERY+2,,AUTO

     1059    13624    3               VM_DELIVERY.UTS_OF_DELIVERY = CURRENT_TIME;

  13624 16 000362   001657 235000 11                 LDA     CURRENT_TIME
        16 000363   200004 755100                    STA     VM_DELIVERY,,AUTO

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:204  
     1060    13625    3               VM_DELIVERY.FLAGS.DONE = %YES#;

  13625 16 000364   400000 236003                    LDQ     -131072,DU
        16 000365   200005 256100                    ORSQ    VM_DELIVERY+1,,AUTO

     1061    13626    3               IF VM_DELIVERY.COUNT = 0

  13626 16 000366   200007 236100                    LDQ     VM_DELIVERY+3,,AUTO
        16 000367   777000 316003                    CANQ    -512,DU
        16 000370   000415 601000 16                 TNZ     s:13637

     1062    13627    4               THEN DO;

     1063    13628    4                   WORK_TEXTC.L# = LENGTHC(WORK_TEXTC.NAME#);

  13628 16 000371   777000 236003                    LDQ     -512,DU
        16 000372   001077 552040 11                 STBQ    WORK_TEXTC,'40'O

     1064    13629    4                   IF VM_RADDRESS.TYPE = %VM_ADD_RESOLVED

  13629 16 000373   000220 236000 11                 LDQ     VM_RADDRESS+2
        16 000374   000777 376003                    ANQ     511,DU
        16 000375   000001 116003                    CMPQ    1,DU
        16 000376   000404 601000 16                 TNZ     s:13633

     1065    13630    4                   THEN
     1066    13631    4                       CALL VMF$MAKE_ADDRESS2 (WORK_TEXTC,VM_RADDRESS,%YES#);

  13631 16 000377   000014 630400 17                 EPPR0   12
        16 000400   000007 631400 17                 EPPR1   7
        16 000401   000000 701000 xent               TSX1    VMF$MAKE_ADDRESS2
        16 000402   000000 011000                    NOP     0
        16 000403   000410 710000 16                 TRA     s:13634

     1067    13632    4                   ELSE
     1068    13633    4                       CALL VMF$MAKE_ADDRESS2 (WORK_TEXTC,VM_UADDRESS,%YES#);

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:205  
  13633 16 000404   000017 630400 17                 EPPR0   15
        16 000405   000007 631400 17                 EPPR1   7
        16 000406   000000 701000 xent               TSX1    VMF$MAKE_ADDRESS2
        16 000407   000000 011000                    NOP     0

     1069    13634    4                   VM_DELIVERY.COUNT = WORK_TEXTC.L#;

  13634 16 000410   001077 236000 11                 LDQ     WORK_TEXTC
        16 000411   200007 552140                    STBQ    VM_DELIVERY+3,'40'O,AUTO

     1070    13635    4                   VM_DELIVERY.TEXT = WORK_TEXTC.NAME#;

  13635 16 000412   040100 100400                    MLR     fill='040'O
        16 000413   001077 200377 11                 ADSC9   WORK_TEXTC               cn=1,n=255
        16 000414   200007 200377                    ADSC9   VM_DELIVERY+3,,AUTO      cn=1,n=255

     1071    13636    4               END;

     1072    13637    3               CALL VMD$PUT_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY, VM_DELIVERY);

  13637 16 000415   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 000416   201272 756100                    STQ     I+1,,AUTO
        16 000417   200004 630500                    EPPR0   VM_DELIVERY,,AUTO
        16 000420   201275 450500                    STP0    I+4,,AUTO
        16 000421   200107 631500                    EPPR1   VM_DELIVERYKEY,,AUTO
        16 000422   201274 451500                    STP1    I+3,,AUTO
        16 000423   201272 633500                    EPPR3   I+1,,AUTO
        16 000424   201273 453500                    STP3    I+2,,AUTO
        16 000425   201273 630500                    EPPR0   I+2,,AUTO
        16 000426   000007 631400 17                 EPPR1   7
        16 000427   000000 701000 xent               TSX1    VMD$PUT_DELIVERY
        16 000430   000000 011000                    NOP     0
        16 000431   002527 710000 16                 TRA     s:14154

     1073    13638
     1074    13639        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:206  
     1075    13640    3           CASE (%VM_PHASE_RESOLVE_ALL);

     1076    13641                 /* Perform resolution on all addresses in the file. */
     1077    13642    3               STATUS_STRING = 'Expanding address list(s)';

  13642 16 000432   040100 100400                    MLR     fill='040'O
        16 000433   000513 000031 12                 ADSC9   E_BADSITE+24             cn=0,n=25
        16 000434   200462 000400                    ADSC9   STATUS_STRING,,AUTO      cn=0,n=256

     1078    13643    3               CALL UPDATE_STATUS;

  13643 16 000435   003114 701000 16                 TSX1    UPDATE_STATUS
        16 000436   000000 011000                    NOP     0

     1079    13644    3               BAD_ADDRESS_COUNT = 0;

  13644 16 000437   201134 450100                    STZ     BAD_ADDRESS_COUNT,,AUTO

     1080    13645        /*
     1081    13646              ***** Clear out any bad-address delivery entries in the file... avoid
     1082    13647                    dups if the system crashes during this phase.
     1083    13648        */
     1084    13649    3               VM_RADDRESS.ACCT = '*';

  13649 16 000440   040000 100400                    MLR     fill='040'O
        16 000441   000022 000001 17                 ADSC9   18                       cn=0,n=1
        16 000442   000237 600010 11                 ADSC9   VM_RADDRESS+17           cn=3,n=8

     1085    13650    3               VM_RADDRESS.FOLDER = ' ';

  13650 16 000443   040000 100400                    MLR     fill='040'O
        16 000444   000023 000001 17                 ADSC9   19                       cn=0,n=1
        16 000445   000225 400031 11                 ADSC9   VM_RADDRESS+7            cn=2,n=25

     1086    13651    3               CALL INIT_DELIVERY_RECORD;

  13651 16 000446   003215 701000 16                 TSX1    INIT_DELIVERY_RECORD
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:207  
        16 000447   000000 011000                    NOP     0

     1087    13652    4   PURGE:      DO WHILE ('1'B); /* FOREVER */;

  13652 16 000450                       PURGE        null
     1088    13653    4                   CALL VMD$GET_DELIVERY_NEXT (DCBNUM(MAIL_IN), VM_DELIVERYKEY,
             13653                            VM_DELIVERY)

  13653 16 000450   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 000451   201272 756100                    STQ     I+1,,AUTO
        16 000452   200004 630500                    EPPR0   VM_DELIVERY,,AUTO
        16 000453   201275 450500                    STP0    I+4,,AUTO
        16 000454   200107 631500                    EPPR1   VM_DELIVERYKEY,,AUTO
        16 000455   201274 451500                    STP1    I+3,,AUTO
        16 000456   201272 633500                    EPPR3   I+1,,AUTO
        16 000457   201273 453500                    STP3    I+2,,AUTO
        16 000460   201273 630500                    EPPR0   I+2,,AUTO
        16 000461   000007 631400 17                 EPPR1   7
        16 000462   000000 701000 xent               TSX1    VMD$GET_DELIVERY_NEXT
        16 000463   000465 702000 16                 TSX2    s:13655
        16 000464   000466 710000 16                 TRA     s:13657

     1089    13654    5                   WHENALTRETURN DO;

     1090    13655    5                       EXIT PURGE;

  13655 16 000465   000505 710000 16                 TRA     s:13662

     1091    13656    5                   END;
     1092    13657    4                   IF VM_DELIVERYKEY.ACCT ~= '*'

  13657 16 000466   040000 106500                    CMPC    fill='040'O
        16 000467   200111 000010                    ADSC9   VM_DELIVERYKEY+2,,AUTO   cn=0,n=8
        16 000470   000022 000001 17                 ADSC9   18                       cn=0,n=1
        16 000471   000505 601000 16                 TNZ     s:13662

     1093    13658    4                   THEN
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:208  
     1094    13659    4                       EXIT PURGE;
     1095    13660    4                   CALL VMD$DEL_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY);

  13660 16 000472   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 000473   201272 756100                    STQ     I+1,,AUTO
        16 000474   200107 630500                    EPPR0   VM_DELIVERYKEY,,AUTO
        16 000475   201275 450500                    STP0    I+4,,AUTO
        16 000476   201272 631500                    EPPR1   I+1,,AUTO
        16 000477   201274 451500                    STP1    I+3,,AUTO
        16 000500   201274 630500                    EPPR0   I+3,,AUTO
        16 000501   000000 631400 17                 EPPR1   0
        16 000502   000000 701000 xent               TSX1    VMD$DEL_DELIVERY
        16 000503   000000 011000                    NOP     0

     1096    13661    4               END PURGE;

  13661 16 000504   000450 710000 16                 TRA     PURGE

     1097    13662    3               ITO_HEAD$ = ADDR(NIL);

  13662 16 000505   000004 236000 17                 LDQ     4
        16 000506   000706 756000 11                 STQ     ITO_HEAD$

     1098    13663    3               IBC_HEAD$ = ADDR(NIL);

  13663 16 000507   000707 756000 11                 STQ     IBC_HEAD$

     1099    13664    3               IC_HEAD$ = ADDR(NIL);

  13664 16 000510   000710 756000 11                 STQ     IC_HEAD$

     1100    13665    3               IADDLIST_MCB.TYPE = 0;

  13665 16 000511   000716 450000 11                 STZ     IADDLIST_MCB+5

     1101    13666    3               IADDLIST_MCB.MIN_SIZE = SIZEC(VM_RADDRESS);

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:209  
  13666 16 000512   000120 235007                    LDA     80,DL
        16 000513   000720 755000 11                 STA     IADDLIST_MCB+7

     1102    13667    3               IADDLIST_MCB.SEGMENT_BASE$ = VM_COPY$;

  13667 16 000514   000000 236000 xsym               LDQ     VM_COPY$
        16 000515   000713 756000 11                 STQ     IADDLIST_MCB+2

     1103    13668    3               IADDLIST_MCB.HI_SEGMENT$ = VM_COPY$;

  13668 16 000516   000714 756000 11                 STQ     IADDLIST_MCB+3

     1104    13669    3               IADDLIST_MCB.WKSZ = (VBOUND(VM_COPY_)+1)/4;

  13669 16 000517   000000 236000 xsym               LDQ     VM_COPY_
        16 000520   000020 772000                    QRL     16
        16 000521   000001 036007                    ADLQ    1,DL
        16 000522   000002 772000                    QRL     2
        16 000523   000715 756000 11                 STQ     IADDLIST_MCB+4

     1105    13670    3               IADDLIST_MCB.FREE_HEAD$ = ADDR(NIL);

  13670 16 000524   000004 236000 17                 LDQ     4
        16 000525   000712 756000 11                 STQ     IADDLIST_MCB+1

     1106    13671
     1107    13672        /*
     1108    13673             ***** Setup the default search list.
     1109    13674                   Therefore, open :MAIL_CENTRAL.:MAIL
     1110    13675                   if it exists. Otherwise, an unregistered system ...
     1111    13676        */
     1112    13677    3               IF DCBADDR(M$MAIL_GLOBAL_NUM) -> F$DCB.FCD# = %NO#

  13677 16 000526   000024 470400 17                 LDP0    20
        16 000527   000000 471500                    LDP1    0,,PR0
        16 000530   000000 720000 xsym               LXL0    M$MAIL_GLOBAL_NUM
        16 000531   100000 473510                    LDP3    0,X0,PR1
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:210  
        16 000532   300031 236100                    LDQ     25,,PR3
        16 000533   020000 316007                    CANQ    8192,DL
        16 000534   000541 601000 16                 TNZ     s:13680

     1113    13678    3               THEN                        /* Open it */
     1114    13679    3                   CALL VMA$OPEN_GLOBAL (M$MAIL_GLOBAL_NUM) ALTRET(CANT_OPEN_GLOBAL);

  13679 16 000535   000026 630400 17                 EPPR0   22
        16 000536   000025 631400 17                 EPPR1   21
        16 000537   000000 701000 xent               TSX1    VMA$OPEN_GLOBAL
        16 000540   000546 702000 16                 TSX2    CANT_OPEN_GLOBAL

     1115    13680    3               VM_SEARCH_INFO.NUM_ENTRIES = 1;

  13680 16 000541   000001 235007                    LDA     1,DL
        16 000542   000153 755000 11                 STA     VM_SEARCH_INFO

     1116    13681    3               VM_SEARCH_INFO.DCB#(0) = M$MAIL_GLOBAL_NUM;

  13681 16 000543   000000 236000 xsym               LDQ     M$MAIL_GLOBAL_NUM
        16 000544   000154 756000 11                 STQ     VM_SEARCH_INFO+1

     1117    13682    4               DO WHILE ('0'B); /* NEVER */;

  13682 16 000545   000547 710000 16                 TRA     s:13686

     1118    13683    4   CANT_OPEN_GLOBAL:
     1119    13684    4                   VM_SEARCH_INFO.NUM_ENTRIES = 0;

  13684 16 000546   000153 450000 11    CANT_OPEN_G* STZ     VM_SEARCH_INFO

     1120    13685    4               END;

     1121    13686    3               PROCESSING = %YES#;

  13686 16 000547   400000 236003                    LDQ     -131072,DU
        16 000550   200254 756100                    STQ     PROCESSING,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:211  

     1122    13687        /*
     1123    13688             ***** Get the first address record ...
     1124    13689        */
     1125    13690    3               IF VM_HEADER.BLIND$ ~= ADDR(NIL)

  13690 16 000551   000000 470400 xsym               LDP0    VM_HEADER$
        16 000552   000020 236100                    LDQ     16,,PR0
        16 000553   000004 116000 17                 CMPQ    4
        16 000554   000560 600000 16                 TZE     s:13694

     1126    13691    3               THEN
     1127    13692    3                   ADD_TYPE = %VM_TYPE_BC;

  13692 16 000555   000040 235007                    LDA     32,DL
        16 000556   200240 755100                    STA     ADD_TYPE,,AUTO
        16 000557   000570 710000 16                 TRA     s:13699

     1128    13693    3               ELSE
     1129    13694    3                   IF VM_HEADER.COPY$ ~= ADDR(NIL)

  13694 16 000560   000021 236100                    LDQ     17,,PR0
        16 000561   000004 116000 17                 CMPQ    4
        16 000562   000566 600000 16                 TZE     s:13698

     1130    13695    3                   THEN
     1131    13696    3                       ADD_TYPE = %VM_TYPE_C;

  13696 16 000563   000030 235007                    LDA     24,DL
        16 000564   200240 755100                    STA     ADD_TYPE,,AUTO
        16 000565   000570 710000 16                 TRA     s:13699

     1132    13697    3                   ELSE
     1133    13698    3                       ADD_TYPE = %VM_TYPE_TO;

  13698 16 000566   000020 235007                    LDA     16,DL
        16 000567   200240 755100                    STA     ADD_TYPE,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:212  

     1134    13699    3               CALL GET_ADD_RECORD ALTRET (NEXT_ADD);

  13699 16 000570   003137 701000 16                 TSX1    GET_ADD_RECORD
        16 000571   001107 702000 16                 TSX2    NEXT_ADD

     1135    13700        /*
     1136    13701             ***** Loop while there are messages to process ...
     1137    13702        */
     1138    13703    4               DO WHILE(PROCESSING);

  13703 16 000572   200254 234100                    SZN     PROCESSING,,AUTO
        16 000573   001141 605000 16                 TPL     s:13820

     1139    13704    4                   PROCESS_ERROR = %PROCESS;

  13704 16 000574   000001 235007                    LDA     1,DL
        16 000575   200257 755100                    STA     PROCESS_ERROR,,AUTO

     1140    13705    5                   DO WHILE ('1'B); /* FOREVER */;

     1141    13706    6                       IF VO_NEED_READ THEN DO;

  13706 16 000576   000000 234000 xsym               SZN     VO_NEED_READ
        16 000577   000604 605000 16                 TPL     s:13710

     1142    13707    6                           VO_NEED_READ = '0'B;

  13707 16 000600   000000 450000 xsym               STZ     VO_NEED_READ

     1143    13708    6                           CALL M$READ (VO_READ_CG);

  13708 16 000601   000000 630400 xsym               EPPR0   VO_READ_CG
        16 000602   040000 713400                    CLIMB   read
        16 000603   401400 401760                    pmme    nvectors=4

     1144    13709    6                       END;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:213  

     1145    13710    5                       IF VO_PROCESS THEN CALL VOM$PROCESS;

  13710 16 000604   000000 234000 xsym               SZN     VO_PROCESS
        16 000605   000611 605000 16                 TPL     s:13720

  13710 16 000606   000002 631400 17                 EPPR1   2
        16 000607   000000 701000 xent               TSX1    VOM$PROCESS
        16 000610   000000 011000                    NOP     0

     1146    13711        /*
     1147    13712             ***** Pickup one address out of address record and
     1148    13713                   resolve it as necessary before sending message.
     1149    13714                   NOTE: All support routines expect the address to
     1150    13715                   be processed to be contained in VM_RADDRESS or
     1151    13716                   VM_UADDRESS. They will look at VM_RADDRESS.TYPE
     1152    13717                   to determine if the info is stored in resolved
     1153    13718                   or unresolved form. Be careful to follow this convention!!!
     1154    13719        */
     1155    13720    5                      CALL VMA$GET_NEXT_ENTRY(VM_UADDRESS,VM_RADDRESS,PTR$,VM_ADDREC$)
             13720                                ALTRET(NEXT_ADD);

  13720 16 000611   000030 236000 17                 LDQ     24
        16 000612   201275 756100                    STQ     I+4,,AUTO
        16 000613   200256 630500                    EPPR0   PTR$,,AUTO
        16 000614   201274 450500                    STP0    I+3,,AUTO
        16 000615   000032 237000 17                 LDAQ    26
        16 000616   201272 757100                    STAQ    I+1,,AUTO
        16 000617   201272 630500                    EPPR0   I+1,,AUTO
        16 000620   000027 631400 17                 EPPR1   23
        16 000621   000000 701000 xent               TSX1    VMA$GET_NEXT_ENTRY
        16 000622   001107 702000 16                 TSX2    NEXT_ADD

     1156    13721    5                       IF VM_RADDRESS.TYPE = %VM_ADD_UNRESOLVED THEN

  13721 16 000623   000220 236000 11                 LDQ     VM_RADDRESS+2
        16 000624   000777 376003                    ANQ     511,DU
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:214  
        16 000625   000002 116003                    CMPQ    2,DU
        16 000626   001016 601000 16                 TNZ     s:13779

     1157    13722    6                       DO;

     1158    13723    6                           PROCESS_ERROR = %PROCESS_UNRESOLVED;

  13723 16 000627   000003 235007                    LDA     3,DL
        16 000630   200257 755100                    STA     PROCESS_ERROR,,AUTO

     1159    13724    6                           VM_ADD_HEAD.NUM_ENTRIES = 0;

  13724 16 000631   000000 470400 xsym               LDP0    VM_ADDLIST$
        16 000632   000001 450100                    STZ     1,,PR0

     1160    13725    6                           VM_ADD_HEAD.FLAGS = %NO#;

  13725 16 000633   000002 450100                    STZ     2,,PR0

     1161    13726    6                           CALL VMA$EXPAND_LIST_FULL(VM_UADDRESS,VM_WORK$,
             13726                                    VM_SEARCH_INFO,0)

  13726 16 000634   000034 630400 17                 EPPR0   28
        16 000635   000027 631400 17                 EPPR1   23
        16 000636   000000 701000 xent               TSX1    VMA$EXPAND_LIST_FULL
        16 000637   000641 702000 16                 TSX2    s:13728
        16 000640   000664 710000 16                 TRA     s:13736

     1162    13727    7                           WHENALTRETURN DO;

     1163    13728    7                               ERROR = E_ADDUNKNOWN;

  13728 16 000641   000257 236000 12                 LDQ     E_ADDUNKNOWN
        16 000642   001076 756000 11                 STQ     ERROR

     1164    13729    7                               VM_RADDRESS.ACCT = '*';

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:215  
  13729 16 000643   040000 100400                    MLR     fill='040'O
        16 000644   000022 000001 17                 ADSC9   18                       cn=0,n=1
        16 000645   000237 600010 11                 ADSC9   VM_RADDRESS+17           cn=3,n=8

     1165    13730    7                               CALL BINCHAR (VM_RADDRESS.FOLDER, BAD_ADDRESS_COUNT);

  13730 16 000646   201134 235100                    LDA     BAD_ADDRESS_COUNT,,AUTO
        16 000647   000044 773000                    LRL     36
        16 000650   201272 757100                    STAQ    I+1,,AUTO
        16 000651   000000 301500                    BTD
        16 000652   201272 000010                    NDSC9   I+1,,AUTO                cn=0,s=lsgnf,sf=0,n=8
        16 000653   000225 430031 11                 NDSC9   VM_RADDRESS+7            cn=2,s=nosgn,sf=0,n=25

     1166    13731    7                               BAD_ADDRESS_COUNT = BAD_ADDRESS_COUNT + 1;

  13731 16 000654   201134 235100                    LDA     BAD_ADDRESS_COUNT,,AUTO
        16 000655   000001 035007                    ADLA    1,DL
        16 000656   201134 755100                    STA     BAD_ADDRESS_COUNT,,AUTO

     1167    13732    7                               CALL GENERATE_AN_ERROR_ENTRY;

  13732 16 000657   003346 701000 16                 TSX1    GENERATE_AN_ERROR_ENTRY
        16 000660   000000 011000                    NOP     0

     1168    13733    7                               PROCESS_ERROR = %PROCESS;

  13733 16 000661   000001 235007                    LDA     1,DL
        16 000662   200257 755100                    STA     PROCESS_ERROR,,AUTO

     1169    13734    7                               GOTO CONT_PROCESS;

  13734 16 000663   001137 710000 16                 TRA     CONT_PROCESS

     1170    13735    7                           END;
     1171    13736    6                           NEXT$ = VM_ADD_HEAD.HEAD$;

  13736 16 000664   000000 470400 xsym               LDP0    VM_ADDLIST$
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:216  
        16 000665   000003 236100                    LDQ     3,,PR0
        16 000666   200243 756100                    STQ     NEXT$,,AUTO

     1172    13737    7                           DO WHILE ('1'B); /* FOREVER */;

     1173    13738        /*
     1174    13739             ***** Pickup the definition for the specified user.
     1175    13740                   If the user name is nil, then use the account
     1176    13741                   number out of the return address ...
     1177    13742        */
     1178    13743    7                               CALL VMA$GET_NEXT_ENTRY(VM_UADDRESS,VM_RADDRESS,NEXT$,
             13743                                        VM_ADDLIST$) ALTRET(END_LOOP1);

  13743 16 000667   000040 236000 17                 LDQ     32
        16 000670   201275 756100                    STQ     I+4,,AUTO
        16 000671   200243 630500                    EPPR0   NEXT$,,AUTO
        16 000672   201274 450500                    STP0    I+3,,AUTO
        16 000673   000032 237000 17                 LDAQ    26
        16 000674   201272 757100                    STAQ    I+1,,AUTO
        16 000675   201272 630500                    EPPR0   I+1,,AUTO
        16 000676   000027 631400 17                 EPPR1   23
        16 000677   000000 701000 xent               TSX1    VMA$GET_NEXT_ENTRY
        16 000700   001015 702000 16                 TSX2    END_LOOP1

     1179    13744    7                               IF VM_RADDRESS.FLAGS.UNDEF#

  13744 16 000701   000220 234000 11                 SZN     VM_RADDRESS+2
        16 000702   000724 605000 16                 TPL     s:13753

     1180    13745    8                               THEN DO;

     1181    13746    8                                   ERROR = E_ADDUNKNOWN;

  13746 16 000703   000257 236000 12                 LDQ     E_ADDUNKNOWN
        16 000704   001076 756000 11                 STQ     ERROR

     1182    13747    8                                   VM_RADDRESS.ACCT = '*';
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:217  

  13747 16 000705   040000 100400                    MLR     fill='040'O
        16 000706   000022 000001 17                 ADSC9   18                       cn=0,n=1
        16 000707   000237 600010 11                 ADSC9   VM_RADDRESS+17           cn=3,n=8

     1183    13748    8                                  CALL BINCHAR (VM_RADDRESS.FOLDER, BAD_ADDRESS_COUNT)
             13748                                            ;

  13748 16 000710   201134 235100                    LDA     BAD_ADDRESS_COUNT,,AUTO
        16 000711   000044 773000                    LRL     36
        16 000712   201272 757100                    STAQ    I+1,,AUTO
        16 000713   000000 301500                    BTD
        16 000714   201272 000010                    NDSC9   I+1,,AUTO                cn=0,s=lsgnf,sf=0,n=8
        16 000715   000225 430031 11                 NDSC9   VM_RADDRESS+7            cn=2,s=nosgn,sf=0,n=25

     1184    13749    8                                   BAD_ADDRESS_COUNT = BAD_ADDRESS_COUNT + 1;

  13749 16 000716   201134 235100                    LDA     BAD_ADDRESS_COUNT,,AUTO
        16 000717   000001 035007                    ADLA    1,DL
        16 000720   201134 755100                    STA     BAD_ADDRESS_COUNT,,AUTO

     1185    13750    8                                   CALL GENERATE_AN_ERROR_ENTRY;

  13750 16 000721   003346 701000 16                 TSX1    GENERATE_AN_ERROR_ENTRY
        16 000722   000000 011000                    NOP     0

     1186    13751    8                                   GOTO CONT_UNRESOLVED;

  13751 16 000723   001014 710000 16                 TRA     CONT_UNRESOLVED

     1187    13752    8                               END;
     1188    13753    7                               CALL VMA$GET_SITE_NAME (VM_RADDRESS.SITENAME, SITENAME)

  13753 16 000724   200460 630500                    EPPR0   SITENAME,,AUTO
        16 000725   201273 450500                    STP0    I+2,,AUTO
        16 000726   000041 236000 17                 LDQ     33
        16 000727   201272 756100                    STQ     I+1,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:218  
        16 000730   201272 630500                    EPPR0   I+1,,AUTO
        16 000731   000000 631400 17                 EPPR1   0
        16 000732   000000 701000 xent               TSX1    VMA$GET_SITE_NAME
        16 000733   000735 702000 16                 TSX2    s:13755
        16 000734   000740 710000 16                 TRA     s:13757

     1189    13754    8                               WHENALTRETURN DO;

     1190    13755    8                                   SITENAME = VM_RADDRESS.SITENAME;

  13755 16 000735   040100 100400                    MLR     fill='040'O
        16 000736   000235 600010 11                 ADSC9   VM_RADDRESS+15           cn=3,n=8
        16 000737   200460 000010                    ADSC9   SITENAME,,AUTO           cn=0,n=8

     1191    13756    8                               END;

     1192    13757    7                               IF SITENAME ~= ' '

  13757 16 000740   200460 237100                    LDAQ    SITENAME,,AUTO
        16 000741   000042 117000 17                 CMPAQ   34
        16 000742   000771 600000 16                 TZE     s:13769
        16 000743   040000 106500                    CMPC    fill='040'O
        16 000744   200460 000010                    ADSC9   SITENAME,,AUTO           cn=0,n=8
        16 000745   000000 000010 xsym               ADSC9   VM_SITENAME              cn=0,n=8
        16 000746   000771 600000 16                 TZE     s:13769

     1193    13758    7                                 AND SITENAME ~= VM_SITENAME
     1194    13759    8                               THEN DO;

     1195    13760    8                                   CALL QUEUE_INTERSYS

  13760 16 000747   004057 701000 16                 TSX1    QUEUE_INTERSYS
        16 000750   000752 702000 16                 TSX2    s:13762
        16 000751   000770 710000 16                 TRA     s:13767

     1196    13761    9                                   WHENALTRETURN DO;

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:219  
     1197    13762    9                                       VM_RADDRESS.ACCT = '*';

  13762 16 000752   040000 100400                    MLR     fill='040'O
        16 000753   000022 000001 17                 ADSC9   18                       cn=0,n=1
        16 000754   000237 600010 11                 ADSC9   VM_RADDRESS+17           cn=3,n=8

     1198    13763    9                                       CALL BINCHAR (VM_RADDRESS.FOLDER,
             13763                                                BAD_ADDRESS_COUNT);

  13763 16 000755   201134 235100                    LDA     BAD_ADDRESS_COUNT,,AUTO
        16 000756   000044 773000                    LRL     36
        16 000757   201272 757100                    STAQ    I+1,,AUTO
        16 000760   000000 301500                    BTD
        16 000761   201272 000010                    NDSC9   I+1,,AUTO                cn=0,s=lsgnf,sf=0,n=8
        16 000762   000225 430031 11                 NDSC9   VM_RADDRESS+7            cn=2,s=nosgn,sf=0,n=25

     1199    13764    9                                       BAD_ADDRESS_COUNT = BAD_ADDRESS_COUNT + 1;

  13764 16 000763   201134 235100                    LDA     BAD_ADDRESS_COUNT,,AUTO
        16 000764   000001 035007                    ADLA    1,DL
        16 000765   201134 755100                    STA     BAD_ADDRESS_COUNT,,AUTO

     1200    13765    9                                       CALL GENERATE_AN_ERROR_ENTRY;

  13765 16 000766   003346 701000 16                 TSX1    GENERATE_AN_ERROR_ENTRY
        16 000767   000000 011000                    NOP     0

     1201    13766    9                                   END;

     1202    13767    8                               END;

  13767 16 000770   001014 710000 16                 TRA     CONT_UNRESOLVED

     1203    13768    8                               ELSE DO;

     1204    13769    8                                   VM_RADDRESS.SITENAME = SITENAME;

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:220  
  13769 16 000771   040000 100500                    MLR     fill='040'O
        16 000772   200460 000010                    ADSC9   SITENAME,,AUTO           cn=0,n=8
        16 000773   000235 600010 11                 ADSC9   VM_RADDRESS+15           cn=3,n=8

     1205    13770    8                                   CALL INIT_DELIVERY_RECORD;

  13770 16 000774   003215 701000 16                 TSX1    INIT_DELIVERY_RECORD
        16 000775   000000 011000                    NOP     0

     1206    13771    8                                   CALL FILL_IN_DELIVERY_RECORD;

  13771 16 000776   003317 701000 16                 TSX1    FILL_IN_DELIVERY_RECORD
        16 000777   000000 011000                    NOP     0

     1207    13772    8                                   CALL VMD$MERGE_DELIVERY (DCBNUM(MAIL_IN),
             13772                                            VM_DELIVERYKEY, VM_DELIVERY);

  13772 16 001000   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 001001   201272 756100                    STQ     I+1,,AUTO
        16 001002   200004 630500                    EPPR0   VM_DELIVERY,,AUTO
        16 001003   201275 450500                    STP0    I+4,,AUTO
        16 001004   200107 631500                    EPPR1   VM_DELIVERYKEY,,AUTO
        16 001005   201274 451500                    STP1    I+3,,AUTO
        16 001006   201272 633500                    EPPR3   I+1,,AUTO
        16 001007   201273 453500                    STP3    I+2,,AUTO
        16 001010   201273 630500                    EPPR0   I+2,,AUTO
        16 001011   000007 631400 17                 EPPR1   7
        16 001012   000000 701000 xent               TSX1    VMD$MERGE_DELIVERY
        16 001013   000000 011000                    NOP     0

     1208    13773    8                               END;

  13769 16 001014                       CONT_UNRESO* null
     1209    13774    7   CONT_UNRESOLVED:            ;
     1210    13775    7                           END;     /* Do forever ... end */

  13775 16 001014   000667 710000 16                 TRA     s:13743
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:221  

  13772 16 001015                       END_LOOP1    null
     1211    13776    6   END_LOOP1:              ;
     1212    13777    6                       END;

  13777 16 001015   000576 710000 16                 TRA     s:13706

     1213    13778    6                       ELSE DO;

     1214    13779    6                           CALL VMA$GET_SITE_NAME (VM_RADDRESS.SITENAME, SITENAME)

  13779 16 001016   200460 630500                    EPPR0   SITENAME,,AUTO
        16 001017   201273 450500                    STP0    I+2,,AUTO
        16 001020   000041 236000 17                 LDQ     33
        16 001021   201272 756100                    STQ     I+1,,AUTO
        16 001022   201272 630500                    EPPR0   I+1,,AUTO
        16 001023   000000 631400 17                 EPPR1   0
        16 001024   000000 701000 xent               TSX1    VMA$GET_SITE_NAME
        16 001025   001027 702000 16                 TSX2    s:13781
        16 001026   001032 710000 16                 TRA     s:13783

     1215    13780    7                           WHENALTRETURN DO;

     1216    13781    7                               SITENAME = VM_RADDRESS.SITENAME;

  13781 16 001027   040100 100400                    MLR     fill='040'O
        16 001030   000235 600010 11                 ADSC9   VM_RADDRESS+15           cn=3,n=8
        16 001031   200460 000010                    ADSC9   SITENAME,,AUTO           cn=0,n=8

     1217    13782    7                           END;

     1218    13783    6                           IF SITENAME ~= ' '

  13783 16 001032   200460 237100                    LDAQ    SITENAME,,AUTO
        16 001033   000042 117000 17                 CMPAQ   34
        16 001034   001063 600000 16                 TZE     s:13795
        16 001035   040000 106500                    CMPC    fill='040'O
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:222  
        16 001036   200460 000010                    ADSC9   SITENAME,,AUTO           cn=0,n=8
        16 001037   000000 000010 xsym               ADSC9   VM_SITENAME              cn=0,n=8
        16 001040   001063 600000 16                 TZE     s:13795

     1219    13784    6                             AND SITENAME ~= VM_SITENAME
     1220    13785    7                           THEN DO;

     1221    13786    7                               CALL QUEUE_INTERSYS

  13786 16 001041   004057 701000 16                 TSX1    QUEUE_INTERSYS
        16 001042   001044 702000 16                 TSX2    s:13788
        16 001043   001062 710000 16                 TRA     s:13793

     1222    13787    8                               WHENALTRETURN DO;

     1223    13788    8                                   VM_RADDRESS.ACCT = '*';

  13788 16 001044   040000 100400                    MLR     fill='040'O
        16 001045   000022 000001 17                 ADSC9   18                       cn=0,n=1
        16 001046   000237 600010 11                 ADSC9   VM_RADDRESS+17           cn=3,n=8

     1224    13789    8                                  CALL BINCHAR (VM_RADDRESS.FOLDER, BAD_ADDRESS_COUNT)
             13789                                            ;

  13789 16 001047   201134 235100                    LDA     BAD_ADDRESS_COUNT,,AUTO
        16 001050   000044 773000                    LRL     36
        16 001051   201272 757100                    STAQ    I+1,,AUTO
        16 001052   000000 301500                    BTD
        16 001053   201272 000010                    NDSC9   I+1,,AUTO                cn=0,s=lsgnf,sf=0,n=8
        16 001054   000225 430031 11                 NDSC9   VM_RADDRESS+7            cn=2,s=nosgn,sf=0,n=25

     1225    13790    8                                   BAD_ADDRESS_COUNT = BAD_ADDRESS_COUNT + 1;

  13790 16 001055   201134 235100                    LDA     BAD_ADDRESS_COUNT,,AUTO
        16 001056   000001 035007                    ADLA    1,DL
        16 001057   201134 755100                    STA     BAD_ADDRESS_COUNT,,AUTO

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:223  
     1226    13791    8                                   CALL GENERATE_AN_ERROR_ENTRY;

  13791 16 001060   003346 701000 16                 TSX1    GENERATE_AN_ERROR_ENTRY
        16 001061   000000 011000                    NOP     0

     1227    13792    8                               END;

     1228    13793    7                           END;

  13793 16 001062   000576 710000 16                 TRA     s:13706

     1229    13794    7                           ELSE DO;

     1230    13795    7                               VM_RADDRESS.SITENAME = SITENAME;

  13795 16 001063   040000 100500                    MLR     fill='040'O
        16 001064   200460 000010                    ADSC9   SITENAME,,AUTO           cn=0,n=8
        16 001065   000235 600010 11                 ADSC9   VM_RADDRESS+15           cn=3,n=8

     1231    13796    7                               CALL INIT_DELIVERY_RECORD;

  13796 16 001066   003215 701000 16                 TSX1    INIT_DELIVERY_RECORD
        16 001067   000000 011000                    NOP     0

     1232    13797    7                               CALL FILL_IN_DELIVERY_RECORD;

  13797 16 001070   003317 701000 16                 TSX1    FILL_IN_DELIVERY_RECORD
        16 001071   000000 011000                    NOP     0

     1233    13798    7                              CALL VMD$MERGE_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY
             13798                                        , VM_DELIVERY);

  13798 16 001072   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 001073   201272 756100                    STQ     I+1,,AUTO
        16 001074   200004 630500                    EPPR0   VM_DELIVERY,,AUTO
        16 001075   201275 450500                    STP0    I+4,,AUTO
        16 001076   200107 631500                    EPPR1   VM_DELIVERYKEY,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:224  
        16 001077   201274 451500                    STP1    I+3,,AUTO
        16 001100   201272 633500                    EPPR3   I+1,,AUTO
        16 001101   201273 453500                    STP3    I+2,,AUTO
        16 001102   201273 630500                    EPPR0   I+2,,AUTO
        16 001103   000007 631400 17                 EPPR1   7
        16 001104   000000 701000 xent               TSX1    VMD$MERGE_DELIVERY
        16 001105   000000 011000                    NOP     0

     1234    13799    7                           END;

     1235    13800    6                       END;

     1236    13801    5                   END;

  13801 16 001106   000576 710000 16                 TRA     s:13706

  13790 16 001107                       NEXT_ADD     null
     1237    13802
     1238    13803    4   NEXT_ADD:       ;
     1239    13804    4                   IF VM_HEADER.COPY$ ~= ADDR(NIL) AND ADD_TYPE = %VM_TYPE_BC THEN

  13804 16 001107   000000 470400 xsym               LDP0    VM_HEADER$
        16 001110   000021 236100                    LDQ     17,,PR0
        16 001111   000004 116000 17                 CMPQ    4
        16 001112   001123 600000 16                 TZE     s:13810
        16 001113   200240 235100                    LDA     ADD_TYPE,,AUTO
        16 001114   000040 115007                    CMPA    32,DL
        16 001115   001123 601000 16                 TNZ     s:13810

     1240    13805    5                   DO;

     1241    13806    5                       ADD_TYPE = %VM_TYPE_C;

  13806 16 001116   000030 235007                    LDA     24,DL
        16 001117   200240 755100                    STA     ADD_TYPE,,AUTO

     1242    13807    5                       CALL GET_ADD_RECORD ALTRET(NEXT_ADD);
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:225  

  13807 16 001120   003137 701000 16                 TSX1    GET_ADD_RECORD
        16 001121   001107 702000 16                 TSX2    NEXT_ADD

     1243    13808    5                   END;

  13808 16 001122   001137 710000 16                 TRA     CONT_PROCESS

     1244    13809    4                   ELSE
     1245    13810    4                       IF VM_HEADER.TO$ ~= ADDR(NIL) AND ADD_TYPE ~= %VM_TYPE_TO THEN

  13810 16 001123   000031 236100                    LDQ     25,,PR0
        16 001124   000004 116000 17                 CMPQ    4
        16 001125   001136 600000 16                 TZE     s:13816
        16 001126   200240 235100                    LDA     ADD_TYPE,,AUTO
        16 001127   000020 115007                    CMPA    16,DL
        16 001130   001136 600000 16                 TZE     s:13816

     1246    13811    5                       DO;

     1247    13812    5                           ADD_TYPE = %VM_TYPE_TO;

  13812 16 001131   000020 235007                    LDA     16,DL
        16 001132   200240 755100                    STA     ADD_TYPE,,AUTO

     1248    13813    5                           CALL GET_ADD_RECORD ALTRET(NEXT_ADD);

  13813 16 001133   003137 701000 16                 TSX1    GET_ADD_RECORD
        16 001134   001107 702000 16                 TSX2    NEXT_ADD

     1249    13814    5                       END;

  13814 16 001135   001137 710000 16                 TRA     CONT_PROCESS

     1250    13815    4                       ELSE
     1251    13816    4                           PROCESSING = %NO#;

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:226  
  13816 16 001136   200254 450100                    STZ     PROCESSING,,AUTO

  13813 16 001137                       CONT_PROCESS null
     1252    13817    4   CONT_PROCESS:   ;
     1253    13818    4               END;

  13818 16 001137   200254 234100                    SZN     PROCESSING,,AUTO
        16 001140   000574 604000 16                 TMI     s:13704

     1254    13819
     1255    13820    3               IF NOT PROCESSING THEN GOTO CONT_MAIL;

  13820 16 001141   001147 605000 16                 TPL     CONT_MAIL

     1256    13821    3               IF PROCESS_ERROR = %PROCESS THEN GOTO CONT_PROCESS;

  13821 16 001142   200257 235100                    LDA     PROCESS_ERROR,,AUTO
        16 001143   000001 115007                    CMPA    1,DL
        16 001144   001137 600000 16                 TZE     CONT_PROCESS

     1257    13822    3               IF PROCESS_ERROR = %PROCESS_UNRESOLVED THEN GOTO CONT_UNRESOLVED;

  13822 16 001145   000003 115007                    CMPA    3,DL
        16 001146   001014 600000 16                 TZE     CONT_UNRESOLVED

  13822 16 001147                       CONT_MAIL    null
     1258    13823    3   CONT_MAIL:  ;
     1259    13824        /*
     1260    13825              ***** Address resolution complete.  Delivery records have been added
     1261    13826                    to the mailgram file for local deliveries (and for names that
     1262    13827                    couldn't be resolved);  there may be some inter-system requests
     1263    13828                    queued up in memory on the INTERSYS_HEAD$ list.
     1264    13829
     1265    13830                    Before shipping the intersystem files, we'll make a special check
     1266    13831                    to see if the sender is a recipient of the mailgram (and isn't
     1267    13832                    the file-copy address if any).  If this is true, then we'll
     1268    13833                    attempt to force delivery of the sender's copy now, and (if
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:227  
     1269    13834                    successful) turn on the successful-FCOPY flag in the message.
     1270    13835                    This will ensure that any subsequent ERR processing will "know"
     1271    13836                    that the sender has a copy, and will not bother returning
     1272    13837                    copies with the errors.  If the delivery attempt fails, no matter;
     1273    13838                    it will be retried (and any errors logged) during the main
     1274    13839                    delivery phase.
     1275    13840        */
     1276    13841
     1277    13842    3               CALL REFRESH_INPUT_HEADER;

  13842 16 001147   002752 701000 16                 TSX1    REFRESH_INPUT_HEADER
        16 001150   000000 011000                    NOP     0

     1278    13843    3               VM_RADDRESS = VM_RETURN_ADDRESS;

  13843 16 001151   000000 100400                    MLR     fill='000'O
        16 001152   000346 000117 11                 ADSC9   VM_RETURN_ADDRESS        cn=0,n=79
        16 001153   000216 000117 11                 ADSC9   VM_RADDRESS              cn=0,n=79

     1279    13844    3               CALL INIT_DELIVERY_RECORD;

  13844 16 001154   003215 701000 16                 TSX1    INIT_DELIVERY_RECORD
        16 001155   000000 011000                    NOP     0

     1280    13845    3               CALL VMD$GET_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY, VM_DELIVERY)
             13845                        ALTRET (NO_COPY_TO_SENDER);

  13845 16 001156   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 001157   201272 756100                    STQ     I+1,,AUTO
        16 001160   200004 630500                    EPPR0   VM_DELIVERY,,AUTO
        16 001161   201275 450500                    STP0    I+4,,AUTO
        16 001162   200107 631500                    EPPR1   VM_DELIVERYKEY,,AUTO
        16 001163   201274 451500                    STP1    I+3,,AUTO
        16 001164   201272 633500                    EPPR3   I+1,,AUTO
        16 001165   201273 453500                    STP3    I+2,,AUTO
        16 001166   201273 630500                    EPPR0   I+2,,AUTO
        16 001167   000007 631400 17                 EPPR1   7
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:228  
        16 001170   000000 701000 xent               TSX1    VMD$GET_DELIVERY
        16 001171   001250 702000 16                 TSX2    NO_COPY_TO_SENDER

     1281    13846    3               IF NOT VM_DELIVERY.FLAGS.DONE

  13846 16 001172   200005 234100                    SZN     VM_DELIVERY+1,,AUTO
        16 001173   001250 604000 16                 TMI     NO_COPY_TO_SENDER
        16 001174   000000 470400 xsym               LDP0    VM_HEADER$
        16 001175   000012 234100                    SZN     10,,PR0
        16 001176   001250 604000 16                 TMI     NO_COPY_TO_SENDER
        16 001177   000012 236100                    LDQ     10,,PR0
        16 001200   000002 316003                    CANQ    2,DU
        16 001201   001250 601000 16                 TNZ     NO_COPY_TO_SENDER

     1282    13847    3                 AND NOT VM_HEADER.STATUS.ERR AND NOT VM_HEADER.STATUS.DELIVERY
     1283    13848    4               THEN DO;

     1284    13849    4                   VM_HEADER.STATUS.RR = %NO#;

  13849 16 001202   000010 236000 17                 LDQ     8
        16 001203   000012 356100                    ANSQ    10,,PR0

     1285    13850    4                   VM_HEADER.STATUS.DR = %NO#;

  13850 16 001204   000011 236000 17                 LDQ     9
        16 001205   000012 356100                    ANSQ    10,,PR0

     1286    13851    4                   CALL VOM$SENDIT ALTRET (NO_COPY_TO_SENDER);

  13851 16 001206   004074 701000 16                 TSX1    VOM$SENDIT
        16 001207   001250 702000 16                 TSX2    NO_COPY_TO_SENDER

     1287    13852    4                   CALL REFRESH_INPUT_HEADER;

  13852 16 001210   002752 701000 16                 TSX1    REFRESH_INPUT_HEADER
        16 001211   000000 011000                    NOP     0

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:229  
     1288    13853    4                   VM_HEADER.STATUS.FCOPY = %YES#;

  13853 16 001212   000000 470400 xsym               LDP0    VM_HEADER$
        16 001213   000200 236003                    LDQ     128,DU
        16 001214   000012 256100                    ORSQ    10,,PR0

     1289    13854    4                  CALL VMD$PUT_HEADER (0, DCBNUM(MAIL_IN)) ALTRET (NO_COPY_TO_SENDER);

  13854 16 001215   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 001216   201272 756100                    STQ     I+1,,AUTO
        16 001217   201272 631500                    EPPR1   I+1,,AUTO
        16 001220   201275 451500                    STP1    I+4,,AUTO
        16 001221   000006 236000 17                 LDQ     6
        16 001222   201274 756100                    STQ     I+3,,AUTO
        16 001223   201274 630500                    EPPR0   I+3,,AUTO
        16 001224   000000 631400 17                 EPPR1   0
        16 001225   000000 701000 xent               TSX1    VMD$PUT_HEADER
        16 001226   001250 702000 16                 TSX2    NO_COPY_TO_SENDER

     1290    13855    4                   VM_DELIVERY.UTS_OF_DELIVERY = CURRENT_TIME;

  13855 16 001227   001657 235000 11                 LDA     CURRENT_TIME
        16 001230   200004 755100                    STA     VM_DELIVERY,,AUTO

     1291    13856    4                   VM_DELIVERY.ERR = '0'B;

  13856 16 001231   200006 450100                    STZ     VM_DELIVERY+2,,AUTO

     1292    13857    4                   VM_DELIVERY.FLAGS.DONE = %YES#;

  13857 16 001232   400000 236003                    LDQ     -131072,DU
        16 001233   200005 256100                    ORSQ    VM_DELIVERY+1,,AUTO

     1293    13858    4                   CALL VMD$PUT_DELIVERY (DCBNUM(MAIL_IN),VM_DELIVERYKEY,VM_DELIVERY);

  13858 16 001234   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 001235   201272 756100                    STQ     I+1,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:230  
        16 001236   200004 630500                    EPPR0   VM_DELIVERY,,AUTO
        16 001237   201275 450500                    STP0    I+4,,AUTO
        16 001240   200107 631500                    EPPR1   VM_DELIVERYKEY,,AUTO
        16 001241   201274 451500                    STP1    I+3,,AUTO
        16 001242   201272 633500                    EPPR3   I+1,,AUTO
        16 001243   201273 453500                    STP3    I+2,,AUTO
        16 001244   201273 630500                    EPPR0   I+2,,AUTO
        16 001245   000007 631400 17                 EPPR1   7
        16 001246   000000 701000 xent               TSX1    VMD$PUT_DELIVERY
        16 001247   000000 011000                    NOP     0

     1294    13859    4               END;

     1295    13860    3   NO_COPY_TO_SENDER:
     1296    13861        /*
     1297    13862             ***** If this message needs to be transported to
     1298    13863                   any other site, do it now ...
     1299    13864        */
     1300    13865    3               IF INTERSYS_HEAD$ ~= ADDR(NIL)

  13865 16 001250   000000 236000 xsym  NO_COPY_TO_* LDQ     INTERSYS_HEAD$
        16 001251   000004 116000 17                 CMPQ    4
        16 001252   002527 600000 16                 TZE     s:14154

     1301    13866    3               THEN
     1302    13867    3                   CALL TRANSPORT_INTERSYS('0'B) ALTRET(BAD_MAIL);

  13867 16 001253   000006 236000 17                 LDQ     6
        16 001254   201147 756100                    STQ     DELIVERY_SUMMARY+3,,AUTO
        16 001255   005314 701000 16                 TSX1    TRANSPORT_INTERSYS
        16 001256   002706 702000 16                 TSX2    BAD_MAIL
        16 001257   002527 710000 16                 TRA     s:14154

     1303    13868
     1304    13869        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:231  
     1305    13870    3           CASE (%VM_PHASE_ERR_SWEEP_1, %VM_PHASE_ERR_SWEEP_2);

     1306    13871                 /* Report any (unreported) errors occurring up to this point. */
     1307    13872    3               IF VM_HEADER.STATUS.BROADCAST

  13872 16 001260   000012 236100                    LDQ     10,,PR0
        16 001261   000001 316003                    CANQ    1,DU
        16 001262   002527 601000 16                 TNZ     s:14154
        16 001263   000012 234100                    SZN     10,,PR0
        16 001264   002527 604000 16                 TMI     s:14154
        16 001265   000002 316003                    CANQ    2,DU
        16 001266   002527 601000 16                 TNZ     s:14154

     1308    13873    3                 OR VM_HEADER.STATUS.ERR
     1309    13874    3                 OR VM_HEADER.STATUS.DELIVERY
     1310    13875    3               THEN
     1311    13876    3                   EXIT ONE_PHASE;
     1312    13877    3               VM_DELIVERYKEY = INIT_DELIVERYKEY;

  13877 16 001267   000100 100400                    MLR     fill='000'O
        16 001270   000127 000051 12                 ADSC9   INIT_DELIVERYKEY         cn=0,n=41
        16 001271   200107 000051                    ADSC9   VM_DELIVERYKEY,,AUTO     cn=0,n=41

     1313    13878    4               DO WHILE ('1'B); /* FOREVER */;

     1314    13879    4                   STATUS_STRING = 'Looking for accumulated errors...';

  13879 16 001272   040100 100400                    MLR     fill='040'O
        16 001273   000522 000041 12                 ADSC9   E_BADSITE+31             cn=0,n=33
        16 001274   200462 000400                    ADSC9   STATUS_STRING,,AUTO      cn=0,n=256

     1315    13880    4                   CALL UPDATE_STATUS;

  13880 16 001275   003114 701000 16                 TSX1    UPDATE_STATUS
        16 001276   000000 011000                    NOP     0

     1316    13881    5                   IF VO_NEED_READ THEN DO;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:232  

  13881 16 001277   000000 234000 xsym               SZN     VO_NEED_READ
        16 001300   001305 605000 16                 TPL     s:13885

     1317    13882    5                       VO_NEED_READ = '0'B;

  13882 16 001301   000000 450000 xsym               STZ     VO_NEED_READ

     1318    13883    5                       CALL M$READ (VO_READ_CG);

  13883 16 001302   000000 630400 xsym               EPPR0   VO_READ_CG
        16 001303   040000 713400                    CLIMB   read
        16 001304   401400 401760                    pmme    nvectors=4

     1319    13884    5                   END;

     1320    13885    4                   IF VO_PROCESS THEN CALL VOM$PROCESS;

  13885 16 001305   000000 234000 xsym               SZN     VO_PROCESS
        16 001306   001312 605000 16                 TPL     s:13886

  13885 16 001307   000002 631400 17                 EPPR1   2
        16 001310   000000 701000 xent               TSX1    VOM$PROCESS
        16 001311   000000 011000                    NOP     0

     1321    13886    4                   CALL VMD$GET_DELIVERY_NEXT (DCBNUM(MAIL_IN), VM_DELIVERYKEY,
             13886                            VM_DELIVERY) ALTRET (ERROR_SWEEP_COMPLETE);

  13886 16 001312   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 001313   201272 756100                    STQ     I+1,,AUTO
        16 001314   200004 630500                    EPPR0   VM_DELIVERY,,AUTO
        16 001315   201275 450500                    STP0    I+4,,AUTO
        16 001316   200107 631500                    EPPR1   VM_DELIVERYKEY,,AUTO
        16 001317   201274 451500                    STP1    I+3,,AUTO
        16 001320   201272 633500                    EPPR3   I+1,,AUTO
        16 001321   201273 453500                    STP3    I+2,,AUTO
        16 001322   201273 630500                    EPPR0   I+2,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:233  
        16 001323   000007 631400 17                 EPPR1   7
        16 001324   000000 701000 xent               TSX1    VMD$GET_DELIVERY_NEXT
        16 001325   001377 702000 16                 TSX2    ERROR_SWEEP_COMPLETE

     1322    13887    4                   IF (VM_HEADER.MISC.PHASE = %VM_PHASE_ERR_SWEEP_2 OR VM_DELIVERY.
             13887                            FLAGS.DONE)

  13887 16 001326   000000 470400 xsym               LDP0    VM_HEADER$
        16 001327   000013 236100                    LDQ     11,,PR0
        16 001330   740000 376003                    ANQ     -16384,DU
        16 001331   340000 116003                    CMPQ    114688,DU
        16 001332   001335 600000 16                 TZE     s:13887+7
        16 001333   200005 234100                    SZN     VM_DELIVERY+1,,AUTO
        16 001334   001272 605000 16                 TPL     s:13879
        16 001335   200005 236100                    LDQ     VM_DELIVERY+1,,AUTO
        16 001336   200000 316003                    CANQ    65536,DU
        16 001337   001272 601000 16                 TNZ     s:13879
        16 001340   200006 235100                    LDA     VM_DELIVERY+2,,AUTO
        16 001341   001272 600000 16                 TZE     s:13879

     1323    13888    4                     AND NOT VM_DELIVERY.FLAGS.REPORTED
     1324    13889    4                     AND VM_DELIVERY.ERR ~= '0'B
     1325    13890    5                   THEN DO;

     1326    13891    5                       STATUS_STRING = 'Creating an error report';

  13891 16 001342   040100 100400                    MLR     fill='040'O
        16 001343   000533 000030 12                 ADSC9   E_BADSITE+40             cn=0,n=24
        16 001344   200462 000400                    ADSC9   STATUS_STRING,,AUTO      cn=0,n=256

     1327    13892    5                       CALL UPDATE_STATUS;

  13892 16 001345   003114 701000 16                 TSX1    UPDATE_STATUS
        16 001346   000000 011000                    NOP     0

     1328    13893    5                       ERROR = VM_DELIVERY.ERR;

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:234  
  13893 16 001347   200006 236100                    LDQ     VM_DELIVERY+2,,AUTO
        16 001350   001076 756000 11                 STQ     ERROR

     1329    13894    5                       WORK_TEXTC.L# = VM_DELIVERY.COUNT;

  13894 16 001351   200007 236100                    LDQ     VM_DELIVERY+3,,AUTO
        16 001352   001077 552040 11                 STBQ    WORK_TEXTC,'40'O

     1330    13895    5                       WORK_TEXTC.NAME# = VM_DELIVERY.TEXT;

  13895 16 001353   040000 100500                    MLR     fill='040'O
        16 001354   200007 200377                    ADSC9   VM_DELIVERY+3,,AUTO      cn=1,n=255
        16 001355   001077 200777 11                 ADSC9   WORK_TEXTC               cn=1,n=511

     1331    13896    5                       CALL RETURN_ERROR_MSG;

  13896 16 001356   003421 701000 16                 TSX1    RETURN_ERROR_MSG
        16 001357   000000 011000                    NOP     0

     1332    13897    5                       VM_DELIVERY.FLAGS.REPORTED = %YES#;

  13897 16 001360   200000 236003                    LDQ     65536,DU
        16 001361   200005 256100                    ORSQ    VM_DELIVERY+1,,AUTO

     1333    13898    5                       CALL VMD$PUT_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY,
             13898                                VM_DELIVERY);

  13898 16 001362   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 001363   201272 756100                    STQ     I+1,,AUTO
        16 001364   200004 630500                    EPPR0   VM_DELIVERY,,AUTO
        16 001365   201275 450500                    STP0    I+4,,AUTO
        16 001366   200107 631500                    EPPR1   VM_DELIVERYKEY,,AUTO
        16 001367   201274 451500                    STP1    I+3,,AUTO
        16 001370   201272 633500                    EPPR3   I+1,,AUTO
        16 001371   201273 453500                    STP3    I+2,,AUTO
        16 001372   201273 630500                    EPPR0   I+2,,AUTO
        16 001373   000007 631400 17                 EPPR1   7
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:235  
        16 001374   000000 701000 xent               TSX1    VMD$PUT_DELIVERY
        16 001375   000000 011000                    NOP     0

     1334    13899    5                   END;

     1335    13900    4               END;

  13900 16 001376   001272 710000 16                 TRA     s:13879

  13894 16 001377   002527 710000 16    ERROR_SWEEP* TRA     s:14154

     1336    13901    3   ERROR_SWEEP_COMPLETE: ;
     1337    13902
     1338    13903        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:236  
     1339    13904    3           CASE (%VM_PHASE_CORRECT_FC);

     1340    13905                 /* Correct the flags for the file copy.  The original file copy was
     1341    13906                    delivered with only the "This is a file copy" flag set;  the flags
     1342    13907                    indicating presence of this address on the TO, C, and BC lists were
     1343    13908                    not set correctly 'cause they weren't available.  Check the delivery
     1344    13909                    record for the file copy;  if any of these flags are set, then
     1345    13910                    reopen the file copy mailbox and correct the flags (requeue if
     1346    13911                    the mailbox is busy or on an unmounted packset;  don't requeue if
     1347    13912                    a more exotic I/O error occurs 'cause this would force delivery of
     1348    13913                    all other copies of the mail to be deferred until the file copy
     1349    13914                    mailbox was fixed... too big a price to pay.
     1350    13915                 */
     1351    13916    3               IF NOT VM_HEADER.STATUS.FCOPY

  13916 16 001400   000012 236100                    LDQ     10,,PR0
        16 001401   000200 316003                    CANQ    128,DU
        16 001402   002527 600000 16                 TZE     s:14154

     1352    13917    3               THEN
     1353    13918    3                   EXIT ONE_PHASE;
     1354    13919    3               STATUS_STRING = 'Updating status flags on the file copy';

  13919 16 001403   040100 100400                    MLR     fill='040'O
        16 001404   000541 000046 12                 ADSC9   E_BADSITE+46             cn=0,n=38
        16 001405   200462 000400                    ADSC9   STATUS_STRING,,AUTO      cn=0,n=256

     1355    13920    3               CALL UPDATE_STATUS;

  13920 16 001406   003114 701000 16                 TSX1    UPDATE_STATUS
        16 001407   000000 011000                    NOP     0

     1356    13921    3               IF VM_HEADER.FILE_FOLDER$ = ADDR(NIL)

  13921 16 001410   000000 470400 xsym               LDP0    VM_HEADER$
        16 001411   000022 236100                    LDQ     18,,PR0
        16 001412   000004 116000 17                 CMPQ    4
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:237  
        16 001413   001420 601000 16                 TNZ     s:13925

     1357    13922    3               THEN
     1358    13923    3                   VM_RADDRESS = VM_RETURN_ADDRESS;

  13923 16 001414   000000 100400                    MLR     fill='000'O
        16 001415   000346 000117 11                 ADSC9   VM_RETURN_ADDRESS        cn=0,n=79
        16 001416   000216 000117 11                 ADSC9   VM_RADDRESS              cn=0,n=79
        16 001417   001424 710000 16                 TRA     s:13926

     1359    13924    3               ELSE
     1360    13925    3                   VM_RADDRESS = VM_HEADER.FILE_FOLDER$ -> VM$RADDRESS;

  13925 16 001420   000022 471500                    LDP1    18,,PR0
        16 001421   000000 100500                    MLR     fill='000'O
        16 001422   100000 000117                    ADSC9   0,,PR1                   cn=0,n=79
        16 001423   000216 000117 11                 ADSC9   VM_RADDRESS              cn=0,n=79

     1361    13926    3               CALL INIT_DELIVERY_RECORD;

  13926 16 001424   003215 701000 16                 TSX1    INIT_DELIVERY_RECORD
        16 001425   000000 011000                    NOP     0

     1362    13927    3               CALL VMD$GET_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY, VM_DELIVERY)

  13927 16 001426   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 001427   201272 756100                    STQ     I+1,,AUTO
        16 001430   200004 630500                    EPPR0   VM_DELIVERY,,AUTO
        16 001431   201275 450500                    STP0    I+4,,AUTO
        16 001432   200107 631500                    EPPR1   VM_DELIVERYKEY,,AUTO
        16 001433   201274 451500                    STP1    I+3,,AUTO
        16 001434   201272 633500                    EPPR3   I+1,,AUTO
        16 001435   201273 453500                    STP3    I+2,,AUTO
        16 001436   201273 630500                    EPPR0   I+2,,AUTO
        16 001437   000007 631400 17                 EPPR1   7
        16 001440   000000 701000 xent               TSX1    VMD$GET_DELIVERY
        16 001441   001443 702000 16                 TSX2    s:13929
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:238  
        16 001442   001444 710000 16                 TRA     s:13931

     1363    13928    4               WHENALTRETURN DO;

     1364    13929    4                   EXIT ONE_PHASE;

  13929 16 001443   002527 710000 16                 TRA     s:14154

     1365    13930    4               END;
     1366    13931    3               IF NOT VM_DELIVERY.FLAGS.PRIMARY

  13931 16 001444   200005 236100                    LDQ     VM_DELIVERY+1,,AUTO
        16 001445   100000 316003                    CANQ    32768,DU
        16 001446   001453 601000 16                 TNZ     s:13936
        16 001447   040000 316003                    CANQ    16384,DU
        16 001450   001453 601000 16                 TNZ     s:13936
        16 001451   020000 316003                    CANQ    8192,DU
        16 001452   002527 600000 16                 TZE     s:14154

     1367    13932    3                 AND NOT VM_DELIVERY.FLAGS.C
     1368    13933    3                 AND NOT VM_DELIVERY.FLAGS.BC
     1369    13934    3               THEN
     1370    13935    3                   EXIT ONE_PHASE;
     1371    13936    3               VM_FOLDER_INFO.FLAGS = %NO#;

  13936 16 001453   000415 450000 11                 STZ     VM_FOLDER_INFO+19

     1372    13937    3              CALL VMA$OPEN_FOLDER (VM_FOLDER_INFO, ADDR(VM_RADDRESS), DCBNUM(MAIL_OUT
             13937                        ), %OLDFILE#, %UPDATE#)

  13937 16 001454   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 001455   201273 756100                    STQ     I+2,,AUTO
        16 001456   000015 236000 17                 LDQ     13
        16 001457   201272 756100                    STQ     I+1,,AUTO
        16 001460   201273 235100                    LDA     I+2,,AUTO
        16 001461   201274 755100                    STA     I+3,,AUTO
        16 001462   000050 237000 17                 LDAQ    40
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:239  
        16 001463   201300 757100                    STAQ    I+7,,AUTO
        16 001464   201274 630500                    EPPR0   I+3,,AUTO
        16 001465   201277 450500                    STP0    I+6,,AUTO
        16 001466   201272 631500                    EPPR1   I+1,,AUTO
        16 001467   201276 451500                    STP1    I+5,,AUTO
        16 001470   000047 236000 17                 LDQ     39
        16 001471   201275 756100                    STQ     I+4,,AUTO
        16 001472   201275 630500                    EPPR0   I+4,,AUTO
        16 001473   000044 631400 17                 EPPR1   36
        16 001474   000000 701000 xent               TSX1    VMA$OPEN_FOLDER
        16 001475   001477 702000 16                 TSX2    s:13939
        16 001476   001534 710000 16                 TRA     s:13948

     1373    13938    4               WHENALTRETURN DO;

     1374    13939    4                   ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  13939 16 001477   000000 470400 xsym               LDP0    B$TCB$
        16 001500   000000 471500                    LDP1    0,,PR0
        16 001501   100102 236100                    LDQ     66,,PR1
        16 001502   001076 756000 11                 STQ     ERROR

     1375    13940    5                   DO SELECT (ERROR.ERR#);

  13940 16 001503   001076 236000 11                 LDQ     ERROR
        16 001504   000003 772000                    QRL     3
        16 001505   037777 376007                    ANQ     16383,DL
        16 001506   000217 116007                    CMPQ    143,DL
        16 001507   001515 602000 16                 TNC     s:13940+10
        16 001510   001530 600000 16                 TZE     s:13942
        16 001511   000003 736000                    QLS     3
        16 001512   002200 116007                    CMPQ    1152,DL
        16 001513   001533 601000 16                 TNZ     s:13945
        16 001514   001530 710000 16                 TRA     s:13942
        16 001515   001076 236000 11                 LDQ     ERROR
        16 001516   000003 772000                    QRL     3
        16 001517   037777 376007                    ANQ     16383,DL
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:240  
        16 001520   000155 116007                    CMPQ    109,DL
        16 001521   001524 602000 16                 TNC     s:13940+17
        16 001522   001530 600000 16                 TZE     s:13942
        16 001523   001533 710000 16                 TRA     s:13945
        16 001524   000003 736000                    QLS     3
        16 001525   001520 116007                    CMPQ    848,DL
        16 001526   001533 601000 16                 TNZ     s:13945
        16 001527   001530 710000 16                 TRA     s:13942

     1376    13941    5                       SELECT (%E$FILEBUSY, %E$XCLSET, %E$SETDOWN, %E$NONEWU);

     1377    13942    5                       UNDELIVERED.BUSY = %YES#;

  13942 16 001530   400000 236003                    LDQ     -131072,DU
        16 001531   201143 256100                    ORSQ    UNDELIVERED,,AUTO

     1378    13943    5                       EXIT PROCESS;

  13943 16 001532   002564 710000 16                 TRA     s:14162

     1379    13944    5                       SELECT (ELSE);

     1380    13945    5                   EXIT ONE_PHASE;

  13945 16 001533   002527 710000 16                 TRA     s:14154

     1381    13946    5                   END;

     1382    13947    4               END;
     1383    13948    3               CALL ENQ_ON_PROFILE

  13948 16 001534   004013 701000 16                 TSX1    ENQ_ON_PROFILE
        16 001535   001537 702000 16                 TSX2    s:13950
        16 001536   001545 710000 16                 TRA     s:13953

     1384    13949    4               WHENALTRETURN DO;

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:241  
     1385    13950    5                   CALL M$CLOSE (CLOSE_MAIL_OUT) WHENALTRETURN DO; END;

  13950 16 001537   000734 630400 11                 EPPR0   CLOSE_MAIL_OUT
        16 001540   450001 713400                    CLIMB   alt,close
        16 001541   406000 401760                    pmme    nvectors=13
        16 001542   001544 702000 16                 TSX2    s:13951
        16 001543   001544 710000 16                 TRA     s:13951

     1386    13951    4                   EXIT PROCESS;

  13951 16 001544   002564 710000 16                 TRA     s:14162

     1387    13952    4               END;
     1388    13953    3               CALL VMD$GET_ID (VM_HEADER.UNIQUE_ID$ -> X$STRING, DCBNUM(MAIL_OUT),
             13953                        MESSAGE_NUMBER)

  13953 16 001545   000000 470400 xsym               LDP0    VM_HEADER$
        16 001546   000032 471500                    LDP1    26,,PR0
        16 001547   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 001550   201272 756100                    STQ     I+1,,AUTO
        16 001551   201133 633500                    EPPR3   MESSAGE_NUMBER,,AUTO
        16 001552   201275 453500                    STP3    I+4,,AUTO
        16 001553   201272 634500                    EPPR4   I+1,,AUTO
        16 001554   201274 454500                    STP4    I+3,,AUTO
        16 001555   201273 451500                    STP1    I+2,,AUTO
        16 001556   201273 630500                    EPPR0   I+2,,AUTO
        16 001557   000007 631400 17                 EPPR1   7
        16 001560   000000 701000 xent               TSX1    VMD$GET_ID
        16 001561   001563 702000 16                 TSX2    s:13955
        16 001562   001571 710000 16                 TRA     s:13958

     1389    13954    4               WHENALTRETURN DO;

     1390    13955    5                   CALL M$CLOSE (CLOSE_MAIL_OUT) WHENALTRETURN DO; END;

  13955 16 001563   000734 630400 11                 EPPR0   CLOSE_MAIL_OUT
        16 001564   450001 713400                    CLIMB   alt,close
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:242  
        16 001565   406000 401760                    pmme    nvectors=13
        16 001566   001570 702000 16                 TSX2    s:13956
        16 001567   001570 710000 16                 TRA     s:13956

     1391    13956    4                   EXIT ONE_PHASE;

  13956 16 001570   002527 710000 16                 TRA     s:14154

     1392    13957    4               END;
     1393    13958    3               ID = VM_HEADER.UNIQUE_ID$ -> X$STRING.TEXT;

  13958 16 001571   000000 470400 xsym               LDP0    VM_HEADER$
        16 001572   000032 471500                    LDP1    26,,PR0
        16 001573   000100 101500                    MRL     fill='000'O
        16 001574   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        16 001575   201272 000002                    ADSC9   I+1,,AUTO                cn=0,n=2
        16 001576   201272 220100                    LDX0    I+1,,AUTO
        16 001577   040100 100540                    MLR     fill='040'O
        16 001600   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0
        16 001601   200260 000777                    ADSC9   ID,,AUTO                 cn=0,n=511

     1394    13959    3               VM_HEADRES.RES# = MESSAGE_NUMBER;

  13959 16 001602   000000 100500                    MLR     fill='000'O
        16 001603   201133 000004                    ADSC9   MESSAGE_NUMBER,,AUTO     cn=0,n=4
        16 001604   001314 200004 11                 ADSC9   VM_HEADRES               cn=1,n=4

     1395    13960    3               CALL M$ENQ (ENQ_HEADER)

  13960 16 001605   000326 630400 12                 EPPR0   ENQ_HEADER
        16 001606   420002 713400                    CLIMB   alt,+8194
        16 001607   401000 401760                    pmme    nvectors=3
        16 001610   001612 702000 16                 TSX2    s:13962
        16 001611   001614 710000 16                 TRA     s:13964

     1396    13961    4               WHENALTRETURN DO;

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:243  
     1397    13962    4                   CALL M$ERR;

  13962 16 001612   000002 713400                    CLIMB   err
        16 001613   000000 401760                    pmme    nvectors=0

     1398    13963    4               END;

     1399    13964    3              CALL VMD$GET_HEADER (MESSAGE_NUMBER, DCBNUM(MAIL_OUT)) ALTRET (NO_UPDATE
             13964                        );

  13964 16 001614   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 001615   201272 756100                    STQ     I+1,,AUTO
        16 001616   201272 630500                    EPPR0   I+1,,AUTO
        16 001617   201275 450500                    STP0    I+4,,AUTO
        16 001620   201133 631500                    EPPR1   MESSAGE_NUMBER,,AUTO
        16 001621   201274 451500                    STP1    I+3,,AUTO
        16 001622   201274 630500                    EPPR0   I+3,,AUTO
        16 001623   000000 631400 17                 EPPR1   0
        16 001624   000000 701000 xent               TSX1    VMD$GET_HEADER
        16 001625   001674 702000 16                 TSX2    NO_UPDATE

     1400    13965    3               IF VM_HEADER.UNIQUE_ID$ ~= ADDR(NIL)

  13965 16 001626   000000 470400 xsym               LDP0    VM_HEADER$
        16 001627   000032 236100                    LDQ     26,,PR0
        16 001630   000004 116000 17                 CMPQ    4
        16 001631   001674 600000 16                 TZE     NO_UPDATE
        16 001632   000032 471500                    LDP1    26,,PR0
        16 001633   000100 101500                    MRL     fill='000'O
        16 001634   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        16 001635   201272 000002                    ADSC9   I+1,,AUTO                cn=0,n=2
        16 001636   201272 220100                    LDX0    I+1,,AUTO
        16 001637   040100 106540                    CMPC    fill='040'O
        16 001640   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0
        16 001641   200260 000777                    ADSC9   ID,,AUTO                 cn=0,n=511
        16 001642   001674 601000 16                 TNZ     NO_UPDATE

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:244  
     1401    13966    3                 AND VM_HEADER.UNIQUE_ID$ -> X$STRING.TEXT = ID
     1402    13967    4               THEN DO;

     1403    13968    4                   VM_HEADER.STATUS.PRIMARY = VM_DELIVERY.FLAGS.PRIMARY;

  13968 16 001643   200005 236100                    LDQ     VM_DELIVERY+1,,AUTO
        16 001644   000020 772000                    QRL     16
        16 001645   000012 676100                    ERQ     10,,PR0
        16 001646   400000 376007                    ANQ     -131072,DL
        16 001647   000012 656100                    ERSQ    10,,PR0

     1404    13969    4                   VM_HEADER.STATUS.C = VM_DELIVERY.FLAGS.C;

  13969 16 001650   200005 236100                    LDQ     VM_DELIVERY+1,,AUTO
        16 001651   000020 772000                    QRL     16
        16 001652   000012 676100                    ERQ     10,,PR0
        16 001653   200000 376007                    ANQ     65536,DL
        16 001654   000012 656100                    ERSQ    10,,PR0

     1405    13970    4                   VM_HEADER.STATUS.BC = VM_DELIVERY.FLAGS.BC;

  13970 16 001655   200005 236100                    LDQ     VM_DELIVERY+1,,AUTO
        16 001656   000020 772000                    QRL     16
        16 001657   000012 676100                    ERQ     10,,PR0
        16 001660   100000 376007                    ANQ     32768,DL
        16 001661   000012 656100                    ERSQ    10,,PR0

     1406    13971    4                   CALL VMD$PUT_HEADER (MESSAGE_NUMBER, DCBNUM(MAIL_OUT)) ALTRET (
             13971                            NO_UPDATE);

  13971 16 001662   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 001663   201272 756100                    STQ     I+1,,AUTO
        16 001664   201272 631500                    EPPR1   I+1,,AUTO
        16 001665   201275 451500                    STP1    I+4,,AUTO
        16 001666   201133 633500                    EPPR3   MESSAGE_NUMBER,,AUTO
        16 001667   201274 453500                    STP3    I+3,,AUTO
        16 001670   201274 630500                    EPPR0   I+3,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:245  
        16 001671   000000 631400 17                 EPPR1   0
        16 001672   000000 701000 xent               TSX1    VMD$PUT_HEADER
        16 001673   001674 702000 16                 TSX2    NO_UPDATE

     1407    13972    4               END;

     1408    13973    3   NO_UPDATE:
     1409    13974    4               CALL M$CLOSE (CLOSE_MAIL_OUT) WHENALTRETURN DO; END;

  13974 16 001674   000734 630400 11    NO_UPDATE    EPPR0   CLOSE_MAIL_OUT
        16 001675   450001 713400                    CLIMB   alt,close
        16 001676   406000 401760                    pmme    nvectors=13
        16 001677   001701 702000 16                 TSX2    s:13974
        16 001700   001701 710000 16                 TRA     s:13974

  13974 16 001701   002527 710000 16                 TRA     s:14154

     1410    13975
     1411    13976        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:246  
     1412    13977    3           CASE (%VM_PHASE_DELIVER_ALL);

     1413    13978                 /* Deliver mail to remaining recipients */
     1414    13979    3               DELIVERY_SUMMARY = '0'B;

  13979 16 001702   201144 450100                    STZ     DELIVERY_SUMMARY,,AUTO

     1415    13980    3               VM_DELIVERYKEY = INIT_DELIVERYKEY;

  13980 16 001703   000100 100400                    MLR     fill='000'O
        16 001704   000127 000051 12                 ADSC9   INIT_DELIVERYKEY         cn=0,n=41
        16 001705   200107 000051                    ADSC9   VM_DELIVERYKEY,,AUTO     cn=0,n=41

     1416    13981    3               HOG_COUNT = 0;

  13981 16 001706   201135 450100                    STZ     HOG_COUNT,,AUTO

     1417    13982    4   DELIVER:    DO WHILE ('1'B); /* FOREVER */;

  13982 16 001707                       DELIVER      null
     1418    13983    4                   STATUS_STRING = 'Looking for an undelivered copy';

  13983 16 001707   040100 100400                    MLR     fill='040'O
        16 001710   000553 000037 12                 ADSC9   E_BADSITE+56             cn=0,n=31
        16 001711   200462 000400                    ADSC9   STATUS_STRING,,AUTO      cn=0,n=256

     1419    13984    4                   CALL UPDATE_STATUS;

  13984 16 001712   003114 701000 16                 TSX1    UPDATE_STATUS
        16 001713   000000 011000                    NOP     0

     1420    13985    4                   CALL VMD$GET_DELIVERY_NEXT (DCBNUM(MAIL_IN), VM_DELIVERYKEY,
             13985                            VM_DELIVERY)

  13985 16 001714   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 001715   201272 756100                    STQ     I+1,,AUTO
        16 001716   200004 630500                    EPPR0   VM_DELIVERY,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:247  
        16 001717   201275 450500                    STP0    I+4,,AUTO
        16 001720   200107 631500                    EPPR1   VM_DELIVERYKEY,,AUTO
        16 001721   201274 451500                    STP1    I+3,,AUTO
        16 001722   201272 633500                    EPPR3   I+1,,AUTO
        16 001723   201273 453500                    STP3    I+2,,AUTO
        16 001724   201273 630500                    EPPR0   I+2,,AUTO
        16 001725   000007 631400 17                 EPPR1   7
        16 001726   000000 701000 xent               TSX1    VMD$GET_DELIVERY_NEXT
        16 001727   001731 702000 16                 TSX2    s:13987
        16 001730   001732 710000 16                 TRA     s:13989

     1421    13986    5                   WHENALTRETURN DO;

     1422    13987    5                       EXIT DELIVER;

  13987 16 001731   002151 710000 16                 TRA     s:14051

     1423    13988    5                   END;
     1424    13989    4                   IF NOT VM_DELIVERY.FLAGS.DONE

  13989 16 001732   200005 234100                    SZN     VM_DELIVERY+1,,AUTO
        16 001733   001707 604000 16                 TMI     DELIVER

     1425    13990    5                   THEN DO;

     1426    13991    5                       CALL M$TIME (GET_CURRENT);

  13991 16 001734   001300 630400 11                 EPPR0   GET_CURRENT
        16 001735   020004 713400                    CLIMB   8196
        16 001736   402000 401760                    pmme    nvectors=5

     1427    13992    5                       IF HOG_COUNT >= VO_HOG_LIMIT

  13992 16 001737   201135 236100                    LDQ     HOG_COUNT,,AUTO
        16 001740   000000 116000 xsym               CMPQ    VO_HOG_LIMIT
        16 001741   001755 602000 16                 TNC     s:13999
        16 001742   000000 470400 xsym               LDP0    TIME$
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:248  
        16 001743   000000 236100                    LDQ     0,,PR0
        16 001744   000004 116000 17                 CMPQ    4
        16 001745   001755 600000 16                 TZE     s:13999
        16 001746   000000 471500                    LDP1    0,,PR0
        16 001747   001657 236000 11                 LDQ     CURRENT_TIME
        16 001750   100002 116100                    CMPQ    2,,PR1
        16 001751   001755 602000 16                 TNC     s:13999

     1428    13993    5                         AND TIME_TABLE.NEXT$ ~= ADDR(NIL)
     1429    13994    5                         AND TIME_TABLE.NEXT$ -> TIME_TABLE.TSTAMP <= CURRENT_TIME
     1430    13995    6                       THEN DO;

     1431    13996    6                           DELIVERY_SUMMARY.HOG_LIMIT = %YES#;

  13996 16 001752   040000 236003                    LDQ     16384,DU
        16 001753   201144 256100                    ORSQ    DELIVERY_SUMMARY,,AUTO

     1432    13997    6                           EXIT DELIVER;

  13997 16 001754   002151 710000 16                 TRA     s:14051

     1433    13998    6                       END;
     1434    13999    5                       CALL REFRESH_INPUT_HEADER;

  13999 16 001755   002752 701000 16                 TSX1    REFRESH_INPUT_HEADER
        16 001756   000000 011000                    NOP     0

     1435    14000    5                       VM_RADDRESS = INIT_RADDRESS;

  14000 16 001757   000000 100400                    MLR     fill='000'O
        16 001760   000000 000117 12                 ADSC9   INIT_RADDRESS            cn=0,n=79
        16 001761   000216 000117 11                 ADSC9   VM_RADDRESS              cn=0,n=79

     1436    14001    5                       VM_RADDRESS.ACCT = VM_DELIVERYKEY.ACCT;

  14001 16 001762   040000 100500                    MLR     fill='040'O
        16 001763   200111 000010                    ADSC9   VM_DELIVERYKEY+2,,AUTO   cn=0,n=8
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:249  
        16 001764   000237 600010 11                 ADSC9   VM_RADDRESS+17           cn=3,n=8

     1437    14002    5                       IF VM_DELIVERYKEY.PSID = ' '

  14002 16 001765   040000 106500                    CMPC    fill='040'O
        16 001766   200107 400006                    ADSC9   VM_DELIVERYKEY,,AUTO     cn=2,n=6
        16 001767   000023 000001 17                 ADSC9   19                       cn=0,n=1
        16 001770   001775 601000 16                 TNZ     s:14006

     1438    14003    5                       THEN
     1439    14004    5                           VM_RADDRESS.FOLDER = VM_DELIVERYKEY.FOLDER;

  14004 16 001771   040000 100500                    MLR     fill='040'O
        16 001772   200113 000031                    ADSC9   VM_DELIVERYKEY+4,,AUTO   cn=0,n=25
        16 001773   000225 400031 11                 ADSC9   VM_RADDRESS+7            cn=2,n=25
        16 001774   002005 710000 16                 TRA     s:14010

     1440    14005    6                       ELSE DO;

     1441    14006    6                           VM_RADDRESS.NOMAD.PSID = VM_DELIVERYKEY.PSID;

  14006 16 001775   040000 100500                    MLR     fill='040'O
        16 001776   200107 400006                    ADSC9   VM_DELIVERYKEY,,AUTO     cn=2,n=6
        16 001777   000232 200006 11                 ADSC9   VM_RADDRESS+12           cn=1,n=6

     1442    14007    6                           VM_RADDRESS.NOMAD.DELIM = ' ';

  14007 16 002000   040000 236003                    LDQ     16384,DU
        16 002001   000232 552040 11                 STBQ    VM_RADDRESS+12,'40'O

     1443    14008    6                           VM_RADDRESS.NOMAD.FOLDER = VM_DELIVERYKEY.FOLDER;

  14008 16 002002   040000 100500                    MLR     fill='040'O
        16 002003   200113 000022                    ADSC9   VM_DELIVERYKEY+4,,AUTO   cn=0,n=18
        16 002004   000225 400022 11                 ADSC9   VM_RADDRESS+7            cn=2,n=18

     1444    14009    6                       END;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:250  

     1445    14010    5                       WORK_TEXTC.L# = LENGTHC(WORK_TEXTC.NAME#);

  14010 16 002005   777000 236003                    LDQ     -512,DU
        16 002006   001077 552040 11                 STBQ    WORK_TEXTC,'40'O

     1446    14011    5                       CALL VMF$MAKE_ADDRESS2 (WORK_TEXTC, VM_RADDRESS, %YES#);

  14011 16 002007   000014 630400 17                 EPPR0   12
        16 002010   000007 631400 17                 EPPR1   7
        16 002011   000000 701000 xent               TSX1    VMF$MAKE_ADDRESS2
        16 002012   000000 011000                    NOP     0

     1447    14012    5                       CALL CONCAT (STATUS_STRING, 'Delivering to ',

  14012 16 002013   001077 236000 11                 LDQ     WORK_TEXTC
        16 002014   000033 772000                    QRL     27
        16 002015   040100 100400                    MLR     fill='040'O
        16 002016   000563 000016 12                 ADSC9   E_BADSITE+64             cn=0,n=14
        16 002017   200462 000016                    ADSC9   STATUS_STRING,,AUTO      cn=0,n=14
        16 002020   000000 620006                    EAX0    0,QL
        16 002021   040100 100440                    MLR     fill='040'O
        16 002022   001077 200010 11                 ADSC9   WORK_TEXTC               cn=1,n=*X0
        16 002023   200465 400362                    ADSC9   STATUS_STRING+3,,AUTO    cn=2,n=242

     1448    14013    5                         SUBSTR(WORK_TEXTC.NAME#, 0, WORK_TEXTC.L#));
     1449    14014    5                       CALL UPDATE_STATUS;

  14014 16 002024   003114 701000 16                 TSX1    UPDATE_STATUS
        16 002025   000000 011000                    NOP     0

     1450    14015    5                       VM_HEADER.STATUS.FCOPY = %NO#;

  14015 16 002026   000000 470400 xsym               LDP0    VM_HEADER$
        16 002027   000012 236000 17                 LDQ     10
        16 002030   000012 356100                    ANSQ    10,,PR0

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:251  
     1451    14016    5                       IF VM_RADDRESS.ACCT = VM_RETURN_ADDRESS.ACCT

  14016 16 002031   040000 106400                    CMPC    fill='040'O
        16 002032   000237 600010 11                 ADSC9   VM_RADDRESS+17           cn=3,n=8
        16 002033   000367 600010 11                 ADSC9   VM_RETURN_ADDRESS+17     cn=3,n=8
        16 002034   002043 601000 16                 TNZ     s:14020
        16 002035   040000 106400                    CMPC    fill='040'O
        16 002036   000225 400031 11                 ADSC9   VM_RADDRESS+7            cn=2,n=25
        16 002037   000355 400031 11                 ADSC9   VM_RETURN_ADDRESS+7      cn=2,n=25
        16 002040   002043 601000 16                 TNZ     s:14020

     1452    14017    5                         AND VM_RADDRESS.FOLDER = VM_RETURN_ADDRESS.FOLDER
     1453    14018    5                       THEN
     1454    14019    5                           VM_HEADER.STATUS.RR = %NO#;

  14019 16 002041   000010 236000 17                 LDQ     8
        16 002042   000012 356100                    ANSQ    10,,PR0

     1455    14020    5                       UNDELIVERED = '0'B;

  14020 16 002043   201143 450100                    STZ     UNDELIVERED,,AUTO

     1456    14021    5                       CALL VOM$SENDIT

  14021 16 002044   004074 701000 16                 TSX1    VOM$SENDIT
        16 002045   002057 702000 16                 TSX2    s:14029

     1457    14022    6                       WHENRETURN DO;

     1458    14023    6                           VM_DELIVERY.UTS_OF_DELIVERY = CURRENT_TIME;

  14023 16 002046   001657 235000 11                 LDA     CURRENT_TIME
        16 002047   200004 755100                    STA     VM_DELIVERY,,AUTO

     1459    14024    6                           VM_DELIVERY.FLAGS.DONE = %YES#;

  14024 16 002050   400000 236003                    LDQ     -131072,DU
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:252  
        16 002051   200005 256100                    ORSQ    VM_DELIVERY+1,,AUTO

     1460    14025    6                           VM_DELIVERY.ERR = '0'B;

  14025 16 002052   200006 450100                    STZ     VM_DELIVERY+2,,AUTO

     1461    14026    6                           HOG_COUNT = HOG_COUNT + 1;

  14026 16 002053   201135 235100                    LDA     HOG_COUNT,,AUTO
        16 002054   000001 035007                    ADLA    1,DL
        16 002055   201135 755100                    STA     HOG_COUNT,,AUTO

     1462    14027    6                       END;

  14027 16 002056   002134 710000 16                 TRA     s:14048

     1463    14028    6                       WHENALTRETURN DO;

     1464    14029    6                           DELIVERY_SUMMARY.BUSY = DELIVERY_SUMMARY.BUSY |

  14029 16 002057   201143 236100                    LDQ     UNDELIVERED,,AUTO
        16 002060   400000 376003                    ANQ     -131072,DU
        16 002061   201272 756100                    STQ     I+1,,AUTO
        16 002062   201144 236100                    LDQ     DELIVERY_SUMMARY,,AUTO
        16 002063   400000 376003                    ANQ     -131072,DU
        16 002064   201272 276100                    ORQ     I+1,,AUTO
        16 002065   201144 676100                    ERQ     DELIVERY_SUMMARY,,AUTO
        16 002066   400000 376003                    ANQ     -131072,DU
        16 002067   201144 656100                    ERSQ    DELIVERY_SUMMARY,,AUTO

     1465    14030    6                             UNDELIVERED.BUSY;
     1466    14031    6                           DELIVERY_SUMMARY.PACKSET_NA = DELIVERY_SUMMARY.PACKSET_NA |

  14031 16 002070   201143 236100                    LDQ     UNDELIVERED,,AUTO
        16 002071   000001 736000                    QLS     1
        16 002072   400000 376003                    ANQ     -131072,DU
        16 002073   201272 756100                    STQ     I+1,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:253  
        16 002074   201144 236100                    LDQ     DELIVERY_SUMMARY,,AUTO
        16 002075   000001 736000                    QLS     1
        16 002076   400000 376003                    ANQ     -131072,DU
        16 002077   201272 276100                    ORQ     I+1,,AUTO
        16 002100   000001 772000                    QRL     1
        16 002101   201144 676100                    ERQ     DELIVERY_SUMMARY,,AUTO
        16 002102   200000 376003                    ANQ     65536,DU
        16 002103   201144 656100                    ERSQ    DELIVERY_SUMMARY,,AUTO

     1467    14032    6                             UNDELIVERED.PACKSET_NA;
     1468    14033    6                           VM_DELIVERY.ERR = ERROR;

  14033 16 002104   001076 236000 11                 LDQ     ERROR
        16 002105   200006 756100                    STQ     VM_DELIVERY+2,,AUTO

     1469    14034    6                           VM_DELIVERY.UTS_OF_DELIVERY = CURRENT_TIME;

  14034 16 002106   001657 235000 11                 LDA     CURRENT_TIME
        16 002107   200004 755100                    STA     VM_DELIVERY,,AUTO

     1470    14035    6                           IF UNDELIVERED.IO_ERROR

  14035 16 002110   201143 236100                    LDQ     UNDELIVERED,,AUTO
        16 002111   100000 316003                    CANQ    32768,DU
        16 002112   002134 600000 16                 TZE     s:14048

     1471    14036    7                           THEN DO;

     1472    14037    7                               IF NOT VM_HEADER.STATUS.BROADCAST

  14037 16 002113   000000 470400 xsym               LDP0    VM_HEADER$
        16 002114   000012 236100                    LDQ     10,,PR0
        16 002115   000001 316003                    CANQ    1,DU
        16 002116   002130 601000 16                 TNZ     s:14044
        16 002117   000012 234100                    SZN     10,,PR0
        16 002120   002130 604000 16                 TMI     s:14044

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:254  
     1473    14038    7                                 AND NOT VM_HEADER.STATUS.ERR
     1474    14039    8                               THEN DO;

     1475    14040    8                                   WORK_TEXTC.L# = VM_DELIVERY.COUNT;

  14040 16 002121   200007 236100                    LDQ     VM_DELIVERY+3,,AUTO
        16 002122   001077 552040 11                 STBQ    WORK_TEXTC,'40'O

     1476    14041    8                                   WORK_TEXTC.NAME# = VM_DELIVERY.TEXT;

  14041 16 002123   040000 100500                    MLR     fill='040'O
        16 002124   200007 200377                    ADSC9   VM_DELIVERY+3,,AUTO      cn=1,n=255
        16 002125   001077 200777 11                 ADSC9   WORK_TEXTC               cn=1,n=511

     1477    14042    8                                   CALL RETURN_ERROR_MSG;

  14042 16 002126   003421 701000 16                 TSX1    RETURN_ERROR_MSG
        16 002127   000000 011000                    NOP     0

     1478    14043    8                               END;

     1479    14044    7                               VM_DELIVERY.FLAGS.DONE = %YES#;

  14044 16 002130   400000 236003                    LDQ     -131072,DU
        16 002131   200005 256100                    ORSQ    VM_DELIVERY+1,,AUTO

     1480    14045    7                               VM_DELIVERY.FLAGS.REPORTED = %YES#;

  14045 16 002132   200000 236003                    LDQ     65536,DU
        16 002133   200005 256100                    ORSQ    VM_DELIVERY+1,,AUTO

     1481    14046    7                           END;

     1482    14047    6                       END;

     1483    14048    5                       CALL VMD$PUT_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY,
             14048                                VM_DELIVERY);
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:255  

  14048 16 002134   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 002135   201272 756100                    STQ     I+1,,AUTO
        16 002136   200004 630500                    EPPR0   VM_DELIVERY,,AUTO
        16 002137   201275 450500                    STP0    I+4,,AUTO
        16 002140   200107 631500                    EPPR1   VM_DELIVERYKEY,,AUTO
        16 002141   201274 451500                    STP1    I+3,,AUTO
        16 002142   201272 633500                    EPPR3   I+1,,AUTO
        16 002143   201273 453500                    STP3    I+2,,AUTO
        16 002144   201273 630500                    EPPR0   I+2,,AUTO
        16 002145   000007 631400 17                 EPPR1   7
        16 002146   000000 701000 xent               TSX1    VMD$PUT_DELIVERY
        16 002147   000000 011000                    NOP     0

     1484    14049    5                   END;

     1485    14050    4               END DELIVER;

  14050 16 002150   001707 710000 16                 TRA     DELIVER

     1486    14051    3               UNDELIVERED = DELIVERY_SUMMARY;

  14051 16 002151   201144 236100                    LDQ     DELIVERY_SUMMARY,,AUTO
        16 002152   740000 376003                    ANQ     -16384,DU
        16 002153   201143 756100                    STQ     UNDELIVERED,,AUTO

     1487    14052    3               IF DELIVERY_SUMMARY.HOG_LIMIT

  14052 16 002154   201144 236100                    LDQ     DELIVERY_SUMMARY,,AUTO
        16 002155   040000 316003                    CANQ    16384,DU
        16 002156   002564 601000 16                 TNZ     s:14162

     1488    14053    3               THEN
     1489    14054    3                   EXIT PROCESS; /* requeue & continue after smaller stuff */
     1490    14055    3               IF DELIVERY_SUMMARY.BUSY OR DELIVERY_SUMMARY.PACKSET_NA

  14055 16 002157   201144 234100                    SZN     DELIVERY_SUMMARY,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:256  
        16 002160   002163 604000 16                 TMI     s:14057
        16 002161   200000 316003                    CANQ    65536,DU
        16 002162   002527 600000 16                 TZE     s:14154

     1491    14056    4               THEN DO;

     1492    14057    4                   CALL XUD$UTS_DIFF_25TH (UTS_X, CURRENT_TIME, VM_HEADER.
             14057                            FIRST_DELIVERY);

  14057 16 002163   000000 236000 xsym               LDQ     VM_HEADER$
        16 002164   000003 036003                    ADLQ    3,DU
        16 002165   201274 756100                    STQ     I+3,,AUTO
        16 002166   000052 236000 17                 LDQ     42
        16 002167   201273 756100                    STQ     I+2,,AUTO
        16 002170   201140 630500                    EPPR0   UTS_X,,AUTO
        16 002171   201272 450500                    STP0    I+1,,AUTO
        16 002172   201272 630500                    EPPR0   I+1,,AUTO
        16 002173   000007 631400 17                 EPPR1   7
        16 002174   000000 701000 xent               TSX1    XUD$UTS_DIFF_25TH
        16 002175   000000 011000                    NOP     0

     1493    14058    4                   UTS_X = UTS_X/%UTS_25TH_HOUR#;

  14058 16 002176   201140 236100                    LDQ     UTS_X,,AUTO
        16 002177   257620 506007                    DIV     90000,DL
        16 002200   201140 756100                    STQ     UTS_X,,AUTO

     1494    14059    4                   CALL XUD$UTS_ADJ_25TH (UTS_Y, VO_MAILMAN_STARTUP_TIME, %
             14059                            UTS_25TH_HOUR#);

  14059 16 002201   000054 236000 17                 LDQ     44
        16 002202   201274 756100                    STQ     I+3,,AUTO
        16 002203   000055 236000 17                 LDQ     45
        16 002204   201273 756100                    STQ     I+2,,AUTO
        16 002205   201141 630500                    EPPR0   UTS_Y,,AUTO
        16 002206   201272 450500                    STP0    I+1,,AUTO
        16 002207   201272 630500                    EPPR0   I+1,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:257  
        16 002210   000007 631400 17                 EPPR1   7
        16 002211   000000 701000 xent               TSX1    XUD$UTS_ADJ_25TH
        16 002212   000000 011000                    NOP     0

     1495    14060    4                   IF (UTS_X < VO_MAX_HOLD_HOURS) OR (CURRENT_TIME < UTS_Y) THEN

  14060 16 002213   201140 236100                    LDQ     UTS_X,,AUTO
        16 002214   002564 604000 16                 TMI     s:14162
        16 002215   000000 116000 xsym               CMPQ    VO_MAX_HOLD_HOURS
        16 002216   002564 602000 16                 TNC     s:14162
        16 002217   001657 236000 11                 LDQ     CURRENT_TIME
        16 002220   002223 604000 16                 TMI     s:14062
        16 002221   201141 116100                    CMPQ    UTS_Y,,AUTO
        16 002222   002564 604000 16                 TMI     s:14162

     1496    14061    4                       EXIT PROCESS; /* requeue later */
     1497    14062    4               END;

  14062 16 002223   002527 710000 16                 TRA     s:14154

     1498    14063
     1499    14064        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:258  
     1500    14065    3           CASE (%VM_PHASE_SEND_RECEIPT);

     1501    14066                /* Return a delivery receipt to the sender, if requested. */
     1502    14067    3               IF NOT VM_HEADER.STATUS.DR

  14067 16 002224   000012 236100                    LDQ     10,,PR0
        16 002225   000004 316003                    CANQ    4,DU
        16 002226   002527 600000 16                 TZE     s:14154

     1503    14068    3               THEN
     1504    14069    3                   EXIT ONE_PHASE;
     1505    14070    3               STATUS_STRING = 'Creating delivery receipt';

  14070 16 002227   040100 100400                    MLR     fill='040'O
        16 002230   000567 000031 12                 ADSC9   E_BADSITE+68             cn=0,n=25
        16 002231   200462 000400                    ADSC9   STATUS_STRING,,AUTO      cn=0,n=256

     1506    14071    3               CALL UPDATE_STATUS;

  14071 16 002232   003114 701000 16                 TSX1    UPDATE_STATUS
        16 002233   000000 011000                    NOP     0

     1507    14072        /*
     1508    14073           Create a virgin mailgram file for the delivery 'gram.
     1509    14074        */
     1510    14075    3               CALL CREATE_NEW_MAILGRAM (DCBNUM(MAIL_OUT)) ALTRET (BAD_MAIL);

  14075 16 002234   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 002235   201305 756100                    STQ     I+12,,AUTO
        16 002236   201305 630500                    EPPR0   I+12,,AUTO
        16 002237   201151 450500                    STP0    PREFIX+1,,AUTO
        16 002240   003673 701000 16                 TSX1    CREATE_NEW_MAILGRAM
        16 002241   002706 702000 16                 TSX2    BAD_MAIL

     1511    14076        /*
     1512    14077           Address the receipt to the sender of the original mail, and no one else.
     1513    14078        */
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:259  
     1514    14079    3               CALL CONSTRUCT_RETURN_ADDRESS (RETURN_ADDRESS_BUFFER,

  14079 16 002242   000000 470400 xsym               LDP0    VM_HEADER$
        16 002243   000026 471500                    LDP1    22,,PR0
        16 002244   201153 451500                    STP1    ACCT+1,,AUTO
        16 002245   000057 236000 17                 LDQ     47
        16 002246   201152 756100                    STQ     KEY_VALUE+1,,AUTO
        16 002247   200766 633500                    EPPR3   RETURN_ADDRESS_BUFFER,,AUTO
        16 002250   201151 453500                    STP3    PREFIX+1,,AUTO
        16 002251   003743 701000 16                 TSX1    CONSTRUCT_RETURN_ADDRESS
        16 002252   002706 702000 16                 TSX2    BAD_MAIL

     1515    14080    3                SIZEW(RETURN_ADDRESS_BUFFER), VM_HEADER.RETURN_ADDRESS$ -> VM$RADDRESS
             14080                          )
     1516    14081    3                 ALTRET (BAD_MAIL);
     1517    14082
     1518    14083    3               CALL VMA$PUT_ADD_RECORD (%VM_TYPE_TO, VECTOR(RETURN_ADDRESS_BUFFER),

  14083 16 002253   000060 235000 17                 LDA     48
        16 002254   201272 452500                    STP2    I+1,,AUTO
        16 002255   201272 236100                    LDQ     I+1,,AUTO
        16 002256   000766 036003                    ADLQ    502,DU
        16 002257   201274 757100                    STAQ    I+3,,AUTO
        16 002260   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 002261   201300 756100                    STQ     I+7,,AUTO
        16 002262   201274 237100                    LDAQ    I+3,,AUTO
        16 002263   201276 757100                    STAQ    I+5,,AUTO
        16 002264   201300 235100                    LDA     I+7,,AUTO
        16 002265   201301 755100                    STA     I+8,,AUTO
        16 002266   201301 630500                    EPPR0   I+8,,AUTO
        16 002267   201304 450500                    STP0    I+11,,AUTO
        16 002270   201276 631500                    EPPR1   I+5,,AUTO
        16 002271   201303 451500                    STP1    I+10,,AUTO
        16 002272   000062 236000 17                 LDQ     50
        16 002273   201302 756100                    STQ     I+9,,AUTO
        16 002274   201302 630500                    EPPR0   I+9,,AUTO
        16 002275   000007 631400 17                 EPPR1   7
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:260  
        16 002276   000000 701000 xent               TSX1    VMA$PUT_ADD_RECORD
        16 002277   000000 011000                    NOP     0

     1519    14084    3                 DCBNUM(MAIL_OUT));
     1520    14085        /*
     1521    14086           Flip around the header fields so that the DELIVERY packet points back to
     1522    14087           the original mailgram.
     1523    14088        */
     1524    14089    3               VM_HEADER.REFERS_TO_ID$ = VM_HEADER.UNIQUE_ID$;

  14089 16 002300   000000 470400 xsym               LDP0    VM_HEADER$
        16 002301   000032 236100                    LDQ     26,,PR0
        16 002302   000033 756100                    STQ     27,,PR0

     1525    14090    3               VM_HEADER.UNIQUE_ID$ = ADDR(NIL);

  14090 16 002303   000004 236000 17                 LDQ     4
        16 002304   000032 756100                    STQ     26,,PR0

     1526    14091    3               VM_HEADER.STATUS.FCOPY = %NO#;

  14091 16 002305   000012 236000 17                 LDQ     10
        16 002306   000012 356100                    ANSQ    10,,PR0

     1527    14092    3               VM_HEADER.STATUS.RR = %NO#;

  14092 16 002307   000010 236000 17                 LDQ     8
        16 002310   000012 356100                    ANSQ    10,,PR0

     1528    14093    3               VM_HEADER.STATUS.DR = %NO#;

  14093 16 002311   000011 236000 17                 LDQ     9
        16 002312   000012 356100                    ANSQ    10,,PR0

     1529    14094    3               VM_HEADER.STATUS.DELIVERY = %YES#;

  14094 16 002313   000002 236003                    LDQ     2,DU
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:261  
        16 002314   000012 256100                    ORSQ    10,,PR0

     1530    14095    3               VM_HEADER.DELIVERY_DATE = CURRENT_TIME;

  14095 16 002315   001657 235000 11                 LDA     CURRENT_TIME
        16 002316   000002 755100                    STA     2,,PR0

     1531    14096    3               VM_HEADER.FIRST_DELIVERY = 0;

  14096 16 002317   000003 450100                    STZ     3,,PR0

     1532    14097        /*
     1533    14098           Scan through the delivery records;  emit one encoded mailgram-body record
     1534    14099           for each successfully-delivered copy of the mailgram.
     1535    14100        */
     1536    14101    3               NUM_RECEIPTS = 0;

  14101 16 002320   201136 450100                    STZ     NUM_RECEIPTS,,AUTO

     1537    14102    3               VM_DELIVERYKEY = INIT_DELIVERYKEY;

  14102 16 002321   000100 100400                    MLR     fill='000'O
        16 002322   000127 000051 12                 ADSC9   INIT_DELIVERYKEY         cn=0,n=41
        16 002323   200107 000051                    ADSC9   VM_DELIVERYKEY,,AUTO     cn=0,n=41

     1538    14103    4               DO WHILE ('1'B); /* FOREVER */;

     1539    14104    5                   IF VO_NEED_READ THEN DO;

  14104 16 002324   000000 234000 xsym               SZN     VO_NEED_READ
        16 002325   002332 605000 16                 TPL     s:14108

     1540    14105    5                       VO_NEED_READ = '0'B;

  14105 16 002326   000000 450000 xsym               STZ     VO_NEED_READ

     1541    14106    5                       CALL M$READ (VO_READ_CG);
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:262  

  14106 16 002327   000000 630400 xsym               EPPR0   VO_READ_CG
        16 002330   040000 713400                    CLIMB   read
        16 002331   401400 401760                    pmme    nvectors=4

     1542    14107    5                   END;

     1543    14108    4                   IF VO_PROCESS THEN CALL VOM$PROCESS;

  14108 16 002332   000000 234000 xsym               SZN     VO_PROCESS
        16 002333   002337 605000 16                 TPL     s:14109

  14108 16 002334   000002 631400 17                 EPPR1   2
        16 002335   000000 701000 xent               TSX1    VOM$PROCESS
        16 002336   000000 011000                    NOP     0

     1544    14109    4                   CALL VMD$GET_DELIVERY_NEXT (DCBNUM(MAIL_IN), VM_DELIVERYKEY,
             14109                            VM_DELIVERY) ALTRET (RECEIPTS_DONE);

  14109 16 002337   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 002340   201272 756100                    STQ     I+1,,AUTO
        16 002341   200004 630500                    EPPR0   VM_DELIVERY,,AUTO
        16 002342   201275 450500                    STP0    I+4,,AUTO
        16 002343   200107 631500                    EPPR1   VM_DELIVERYKEY,,AUTO
        16 002344   201274 451500                    STP1    I+3,,AUTO
        16 002345   201272 633500                    EPPR3   I+1,,AUTO
        16 002346   201273 453500                    STP3    I+2,,AUTO
        16 002347   201273 630500                    EPPR0   I+2,,AUTO
        16 002350   000007 631400 17                 EPPR1   7
        16 002351   000000 701000 xent               TSX1    VMD$GET_DELIVERY_NEXT
        16 002352   002452 702000 16                 TSX2    RECEIPTS_DONE

     1545    14110    4                   IF VM_DELIVERY.FLAGS.DONE AND NOT VM_DELIVERY.FLAGS.FC

  14110 16 002353   200005 234100                    SZN     VM_DELIVERY+1,,AUTO
        16 002354   002324 605000 16                 TPL     s:14104
        16 002355   200005 236100                    LDQ     VM_DELIVERY+1,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:263  
        16 002356   010000 316003                    CANQ    4096,DU
        16 002357   002324 601000 16                 TNZ     s:14104
        16 002360   200006 235100                    LDA     VM_DELIVERY+2,,AUTO
        16 002361   002366 600000 16                 TZE     s:14113
        16 002362   000000 470400 xsym               LDP0    VM_HEADER$
        16 002363   000012 236100                    LDQ     10,,PR0
        16 002364   000001 316003                    CANQ    1,DU
        16 002365   002324 600000 16                 TZE     s:14104

     1546    14111    4                     AND (VM_DELIVERY.ERR = '0'B OR VM_HEADER.STATUS.BROADCAST)
     1547    14112    5                   THEN DO;

     1548    14113    5                       VM_BODYREC_ENCODED = INIT_ENCODED_ERR_BODYREC;

  14113 16 002366   000100 100400                    MLR     fill='000'O
        16 002367   000142 000464 12                 ADSC9   INIT_ENCODED_ERR_BODYREC cn=0,n=308
        16 002370   200122 000464                    ADSC9   VM_BODYREC_ENCODED,,AUTO cn=0,n=308

     1549    14114    5                       IF VM_DELIVERY.ERR = '0'B

  14114 16 002371   000000 115003                    CMPA    0,DU
        16 002372   002376 601000 16                 TNZ     s:14118

     1550    14115    5                       THEN
     1551    14116    5                           VM_BODYREC_ENCODED.VALUE.DATA.ERR = E_DELIVERED;

  14116 16 002373   000356 236000 12                 LDQ     E_DELIVERED
        16 002374   200124 756100                    STQ     VM_BODYREC_ENCODED+2,,AUTO
        16 002375   002400 710000 16                 TRA     s:14119

     1552    14117    5                       ELSE
     1553    14118    5                           VM_BODYREC_ENCODED.VALUE.DATA.ERR = VM_DELIVERY.ERR;

  14118 16 002376   200006 236100                    LDQ     VM_DELIVERY+2,,AUTO
        16 002377   200124 756100                    STQ     VM_BODYREC_ENCODED+2,,AUTO

     1554    14119    5                      VM_BODYREC_ENCODED.VALUE.DATA.UTS = VM_DELIVERY.UTS_OF_DELIVERY;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:264  

  14119 16 002400   200004 235100                    LDA     VM_DELIVERY,,AUTO
        16 002401   200125 755100                    STA     VM_BODYREC_ENCODED+3,,AUTO

     1555    14120    5                       DELIVERY.L = VM_DELIVERY.COUNT;

  14120 16 002402   200007 236100                    LDQ     VM_DELIVERY+3,,AUTO
        16 002403   200567 552140                    STBQ    DELIVERY,'40'O,AUTO

     1556    14121    5                       DELIVERY.C = VM_DELIVERY.TEXT;

  14121 16 002404   040100 100500                    MLR     fill='040'O
        16 002405   200007 200377                    ADSC9   VM_DELIVERY+3,,AUTO      cn=1,n=255
        16 002406   200567 200773                    ADSC9   DELIVERY,,AUTO           cn=1,n=507

     1557    14122    5                       VM_BODYREC_ENCODED.VALUE.DATA.STUFF = DELIVERY;

  14122 16 002407   000100 100500                    MLR     fill='000'O
        16 002410   200567 000444                    ADSC9   DELIVERY,,AUTO           cn=0,n=292
        16 002411   200126 000444                    ADSC9   VM_BODYREC_ENCODED+4,,AUTO cn=0,n=292

     1558    14123    5                       VM_BODYREC_ENCODED.VALUE.DATA.STUFF.PIECE (VM_DELIVERY.COUNT+1)
             14123                                = 0;

  14123 16 002412   200007 236100                    LDQ     VM_DELIVERY+3,,AUTO
        16 002413   000033 772000                    QRL     27
        16 002414   000106 101400                    MRL     fill='000'O
        16 002415   000002 000004 17                 ADSC9   2                        cn=0,n=4
        16 002416   200126 200001                    ADSC9   VM_BODYREC_ENCODED+4,Q,AUTO cn=1,n=1

     1559    14124    5                       COUNT = LENGTHC (VM_BODYREC_ENCODED) -

  14124 16 002417   200007 236100                    LDQ     VM_DELIVERY+3,,AUTO
        16 002420   000033 772000                    QRL     27
        16 002421   000022 036007                    ADLQ    18,DL
        16 002422   200247 756100                    STQ     COUNT,,AUTO

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:265  
     1560    14125    5                         LENGTHC(VM_BODYREC_ENCODED.VALUE.DATA.STUFF) +
     1561    14126    5                         VM_DELIVERY.COUNT + 2;
     1562    14127    5                       VM_BODYREC_ENCODED.VALUE.COUNT = COUNT;

  14127 16 002423   200123 756100                    STQ     VM_BODYREC_ENCODED+1,,AUTO

     1563    14128    5                       CALL VMD$PUT_BODY (0, DCBNUM(MAIL_OUT), NUM_RECEIPTS, COUNT, ,
             14128                                VM_BODYREC_ENCODED) ALTRET (OOPS);

  14128 16 002424   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 002425   201272 756100                    STQ     I+1,,AUTO
        16 002426   200122 630500                    EPPR0   VM_BODYREC_ENCODED,,AUTO
        16 002427   201301 450500                    STP0    I+8,,AUTO
        16 002430   000004 236000 17                 LDQ     4
        16 002431   201300 756100                    STQ     I+7,,AUTO
        16 002432   200247 631500                    EPPR1   COUNT,,AUTO
        16 002433   201277 451500                    STP1    I+6,,AUTO
        16 002434   201136 633500                    EPPR3   NUM_RECEIPTS,,AUTO
        16 002435   201276 453500                    STP3    I+5,,AUTO
        16 002436   201272 634500                    EPPR4   I+1,,AUTO
        16 002437   201275 454500                    STP4    I+4,,AUTO
        16 002440   000006 236000 17                 LDQ     6
        16 002441   201274 756100                    STQ     I+3,,AUTO
        16 002442   201274 630500                    EPPR0   I+3,,AUTO
        16 002443   000063 631400 17                 EPPR1   51
        16 002444   000000 701000 xent               TSX1    VMD$PUT_BODY
        16 002445   002514 702000 16                 TSX2    OOPS

     1564    14129    5                       NUM_RECEIPTS = NUM_RECEIPTS + 1;

  14129 16 002446   201136 235100                    LDA     NUM_RECEIPTS,,AUTO
        16 002447   000001 035007                    ADLA    1,DL
        16 002450   201136 755100                    STA     NUM_RECEIPTS,,AUTO

     1565    14130    5                   END;

     1566    14131    4               END;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:266  

  14131 16 002451   002324 710000 16                 TRA     s:14104

     1567    14132    3   RECEIPTS_DONE:
     1568    14133    3               IF NUM_RECEIPTS > 0

  14133 16 002452   201136 235100       RECEIPTS_DO* LDA     NUM_RECEIPTS,,AUTO
        16 002453   002514 600000 16                 TZE     OOPS

     1569    14134    4               THEN DO;

     1570    14135    4                   VM_HEADER.NUM_RECORDS = NUM_RECEIPTS;

  14135 16 002454   000000 470400 xsym               LDP0    VM_HEADER$
        16 002455   000011 755100                    STA     9,,PR0

     1571    14136    4                   CALL VMD$PUT_HEADER (0, DCBNUM(MAIL_OUT)) ALTRET (OOPS);

  14136 16 002456   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 002457   201272 756100                    STQ     I+1,,AUTO
        16 002460   201272 631500                    EPPR1   I+1,,AUTO
        16 002461   201275 451500                    STP1    I+4,,AUTO
        16 002462   000006 236000 17                 LDQ     6
        16 002463   201274 756100                    STQ     I+3,,AUTO
        16 002464   201274 630500                    EPPR0   I+3,,AUTO
        16 002465   000000 631400 17                 EPPR1   0
        16 002466   000000 701000 xent               TSX1    VMD$PUT_HEADER
        16 002467   002514 702000 16                 TSX2    OOPS

     1572    14137    5                   CALL M$CLOSE (CLOSE_MAIL_OUT) WHENALTRETURN DO; END;

  14137 16 002470   000734 630400 11                 EPPR0   CLOSE_MAIL_OUT
        16 002471   450001 713400                    CLIMB   alt,close
        16 002472   406000 401760                    pmme    nvectors=13
        16 002473   002475 702000 16                 TSX2    s:14138
        16 002474   002475 710000 16                 TRA     s:14138

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:267  
     1573    14138    4                   CALL VOM$ADDENTRY_SORTED (SCRATCH$, %NO#, TIME_HEAD$, DCBNUM(
             14138                            MAIL_OUT));

  14138 16 002475   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 002476   201272 756100                    STQ     I+1,,AUTO
        16 002477   201272 630500                    EPPR0   I+1,,AUTO
        16 002500   201277 450500                    STP0    I+6,,AUTO
        16 002501   000064 236000 17                 LDQ     52
        16 002502   201276 756100                    STQ     I+5,,AUTO
        16 002503   000006 236000 17                 LDQ     6
        16 002504   201275 756100                    STQ     I+4,,AUTO
        16 002505   201142 631500                    EPPR1   SCRATCH$,,AUTO
        16 002506   201274 451500                    STP1    I+3,,AUTO
        16 002507   201274 630500                    EPPR0   I+3,,AUTO
        16 002510   000027 631400 17                 EPPR1   23
        16 002511   000000 701000 xent               TSX1    VOM$ADDENTRY_SORTED
        16 002512   000000 011000                    NOP     0

     1574    14139    4               END;

  14139 16 002513   002527 710000 16                 TRA     s:14154

     1575    14140    4               ELSE DO;

     1576    14141    5   OOPS:           CALL M$CLOSE (CLOSE_MAIL_OUT_RELEASE) WHENALTRETURN DO; END;

  14141 16 002514   000772 630400 11    OOPS         EPPR0   CLOSE_MAIL_OUT_RELEASE
        16 002515   450001 713400                    CLIMB   alt,close
        16 002516   406000 401760                    pmme    nvectors=13
        16 002517   002521 702000 16                 TSX2    s:14142
        16 002520   002521 710000 16                 TRA     s:14142

     1577    14142    4               END;

  14142 16 002521   002527 710000 16                 TRA     s:14154

     1578    14143
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:268  
     1579    14144        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:269  
     1580    14145    3           CASE (%VM_PHASE_FINI);

     1581    14146                 /* Done.  No action. */
     1582    14147    3               STATUS_STRING = 'Delivery completed';

  14147 16 002522   040100 100400                    MLR     fill='040'O
        16 002523   000576 000022 12                 ADSC9   E_BADSITE+75             cn=0,n=18
        16 002524   200462 000400                    ADSC9   STATUS_STRING,,AUTO      cn=0,n=256

     1583    14148    3               CALL UPDATE_STATUS;

  14148 16 002525   003114 701000 16                 TSX1    UPDATE_STATUS
        16 002526   000000 011000                    NOP     0

     1584    14149    3           END ONE_PHASE;

     1585    14150        /*
     1586    14151              At this point, we should reread the header and update the delivery
     1587    14152              phase.
     1588    14153        */
     1589    14154    2           CALL REFRESH_INPUT_HEADER ALTRET (BAD_MAIL);

  14154 16 002527   002752 701000 16                 TSX1    REFRESH_INPUT_HEADER
        16 002530   002706 702000 16                 TSX2    BAD_MAIL

     1590    14155    2           VM_HEADER.MISC.PHASE = MINIMUM (VM_HEADER.MISC.PHASE + 1, %VM_PHASE_FINI);

  14155 16 002531   000000 470400 xsym               LDP0    VM_HEADER$
        16 002532   000013 236100                    LDQ     11,,PR0
        16 002533   000040 772000                    QRL     32
        16 002534   000001 036007                    ADLQ    1,DL
        16 002535   000011 116007                    CMPQ    9,DL
        16 002536   002541 602000 16                 TNC     s:14155+8
        16 002537   002541 600000 16                 TZE     s:14155+8
        16 002540   000011 236007                    LDQ     9,DL
        16 002541   000040 736000                    QLS     32
        16 002542   000013 676100                    ERQ     11,,PR0
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:270  
        16 002543   740000 376003                    ANQ     -16384,DU
        16 002544   000013 656100                    ERSQ    11,,PR0

     1591    14156    2           CALL VMD$PUT_HEADER (0, DCBNUM(MAIL_IN)) ALTRET (BAD_MAIL);

  14156 16 002545   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 002546   201272 756100                    STQ     I+1,,AUTO
        16 002547   201272 631500                    EPPR1   I+1,,AUTO
        16 002550   201275 451500                    STP1    I+4,,AUTO
        16 002551   000006 236000 17                 LDQ     6
        16 002552   201274 756100                    STQ     I+3,,AUTO
        16 002553   201274 630500                    EPPR0   I+3,,AUTO
        16 002554   000000 631400 17                 EPPR1   0
        16 002555   000000 701000 xent               TSX1    VMD$PUT_HEADER
        16 002556   002706 702000 16                 TSX2    BAD_MAIL

     1592    14157    2       END PROCESS;

  14157 16 002557   000000 470400 xsym               LDP0    VM_HEADER$
        16 002560   000013 236100                    LDQ     11,,PR0
        16 002561   740000 376003                    ANQ     -16384,DU
        16 002562   440000 116003                    CMPQ    -114688,DU
        16 002563   000140 601000 16                 TNZ     PROCESS

     1593    14158        /*
     1594    14159              ***** Release as many packsets as we can manage once we exit from the
     1595    14160                    main process loop.
     1596    14161        */
     1597    14162    1       CALL M$DISPRES (REL_PACK) ALTRET (RELEASED);

  14162 16 002564   001316 630400 11                 EPPR0   REL_PACK
        16 002565   550002 713400                    CLIMB   alt,+53250
        16 002566   402400 401760                    pmme    nvectors=6
        16 002567   002574 702000 16                 TSX2    RELEASED

     1598    14163    1       CALL M$RELRES (REL_PACK) ALTRET (RELEASED);

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:271  
  14163 16 002570   001316 630400 11                 EPPR0   REL_PACK
        16 002571   550003 713400                    CLIMB   alt,+53251
        16 002572   402400 401760                    pmme    nvectors=6
        16 002573   002574 702000 16                 TSX2    RELEASED

  14163 16 002574                       RELEASED     null
     1599    14164    1   RELEASED: ;
     1600    14165
     1601    14166        /*
     1602    14167              ***** Delete this mailgram from the time chain.  If the flags indicating
     1603    14168                    "delivery not yet complete" are set, calculate a redelivery time
     1604    14169                    and put it back on the time chain;  otherwise, release the file.
     1605    14170        */
     1606    14171    1       CALL VOM$DELENTRY (TIME$,%NO#,TIME_HEAD$);

  14171 16 002574   000065 630400 17                 EPPR0   53
        16 002575   000007 631400 17                 EPPR1   7
        16 002576   000000 701000 xent               TSX1    VOM$DELENTRY
        16 002577   000000 011000                    NOP     0

     1607    14172    1       IF UNDELIVERED.BUSY OR UNDELIVERED.PACKSET_NA OR UNDELIVERED.HOG_LIMIT

  14172 16 002600   201143 234100                    SZN     UNDELIVERED,,AUTO
        16 002601   002607 604000 16                 TMI     s:14174
        16 002602   201143 236100                    LDQ     UNDELIVERED,,AUTO
        16 002603   200000 316003                    CANQ    65536,DU
        16 002604   002607 601000 16                 TNZ     s:14174
        16 002605   040000 316003                    CANQ    16384,DU
        16 002606   002702 600000 16                 TZE     s:14193

     1608    14173    2       THEN DO;

     1609    14174    2           IF UNDELIVERED.HOG_LIMIT

  14174 16 002607   201143 236100                    LDQ     UNDELIVERED,,AUTO
        16 002610   040000 316003                    CANQ    16384,DU
        16 002611   002614 600000 16                 TZE     s:14178
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:272  

     1610    14175    2           THEN
     1611    14176    2               DELAY_TIME = 0;

  14176 16 002612   201137 450100                    STZ     DELAY_TIME,,AUTO
        16 002613   002623 710000 16                 TRA     s:14183

     1612    14177    2           ELSE
     1613    14178    2               IF UNDELIVERED.BUSY

  14178 16 002614   201143 234100                    SZN     UNDELIVERED,,AUTO
        16 002615   002621 605000 16                 TPL     s:14182

     1614    14179    2               THEN
     1615    14180    2                   DELAY_TIME = VO_BUSY_RETRY_MINUTES;

  14180 16 002616   000000 235000 xsym               LDA     VO_BUSY_RETRY_MINUTES
        16 002617   201137 755100                    STA     DELAY_TIME,,AUTO
        16 002620   002623 710000 16                 TRA     s:14183

     1616    14181    2               ELSE
     1617    14182    2                   DELAY_TIME = VO_PACKSET_RETRY_MINUTES;

  14182 16 002621   000000 235000 xsym               LDA     VO_PACKSET_RETRY_MINUTES
        16 002622   201137 755100                    STA     DELAY_TIME,,AUTO

     1618    14183    2           CALL M$TIME (GET_CURRENT);

  14183 16 002623   001300 630400 11                 EPPR0   GET_CURRENT
        16 002624   020004 713400                    CLIMB   8196
        16 002625   402000 401760                    pmme    nvectors=5

     1619    14184    2           CALL REFRESH_INPUT_HEADER;

  14184 16 002626   002752 701000 16                 TSX1    REFRESH_INPUT_HEADER
        16 002627   000000 011000                    NOP     0

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:273  
     1620    14185    2          CALL XUD$UTS_ADJ_25TH (VM_HEADER.DELIVERY_DATE, CURRENT_TIME, DELAY_TIME * %
             14185                    UTS_25TH_MIN#);

  14185 16 002630   201137 236100                    LDQ     DELAY_TIME,,AUTO
        16 002631   002734 402007                    MPY     1500,DL
        16 002632   201272 756100                    STQ     I+1,,AUTO
        16 002633   201272 630500                    EPPR0   I+1,,AUTO
        16 002634   201275 450500                    STP0    I+4,,AUTO
        16 002635   000052 236000 17                 LDQ     42
        16 002636   201274 756100                    STQ     I+3,,AUTO
        16 002637   000000 236000 xsym               LDQ     VM_HEADER$
        16 002640   000002 036003                    ADLQ    2,DU
        16 002641   201273 756100                    STQ     I+2,,AUTO
        16 002642   201273 630500                    EPPR0   I+2,,AUTO
        16 002643   000007 631400 17                 EPPR1   7
        16 002644   000000 701000 xent               TSX1    XUD$UTS_ADJ_25TH
        16 002645   000000 011000                    NOP     0

     1621    14186    2           CALL VMD$PUT_HEADER (0, DCBNUM(MAIL_IN));

  14186 16 002646   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 002647   201272 756100                    STQ     I+1,,AUTO
        16 002650   201272 630500                    EPPR0   I+1,,AUTO
        16 002651   201275 450500                    STP0    I+4,,AUTO
        16 002652   000006 236000 17                 LDQ     6
        16 002653   201274 756100                    STQ     I+3,,AUTO
        16 002654   201274 630500                    EPPR0   I+3,,AUTO
        16 002655   000000 631400 17                 EPPR1   0
        16 002656   000000 701000 xent               TSX1    VMD$PUT_HEADER
        16 002657   000000 011000                    NOP     0

     1622    14187    2           CALL VOM$ADDENTRY_SORTED (TIME$, %NO#, TIME_HEAD$, DCBNUM(MAIL_IN));

  14187 16 002660   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 002661   201272 756100                    STQ     I+1,,AUTO
        16 002662   201272 630500                    EPPR0   I+1,,AUTO
        16 002663   201277 450500                    STP0    I+6,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:274  
        16 002664   000064 236000 17                 LDQ     52
        16 002665   201276 756100                    STQ     I+5,,AUTO
        16 002666   000070 237000 17                 LDAQ    56
        16 002667   201274 757100                    STAQ    I+3,,AUTO
        16 002670   201274 630500                    EPPR0   I+3,,AUTO
        16 002671   000027 631400 17                 EPPR1   23
        16 002672   000000 701000 xent               TSX1    VOM$ADDENTRY_SORTED
        16 002673   000000 011000                    NOP     0

     1623    14188    2           CALL M$CLOSE (CLOSE_MAILIN_SAVE)

  14188 16 002674   000000 630400 xsym               EPPR0   CLOSE_MAILIN_SAVE
        16 002675   450001 713400                    CLIMB   alt,close
        16 002676   406000 401760                    pmme    nvectors=13
        16 002677   002701 702000 16                 TSX2    s:14191
        16 002700   002701 710000 16                 TRA     s:14191

     1624    14189    3           WHENALTRETURN DO;

     1625    14190    3           END;

     1626    14191    2       END;

  14191 16 002701   002705 710000 16                 TRA     s:14194

     1627    14192    1       ELSE
     1628    14193    1           CALL M$CLOSE (CLOSE_MAILIN_SCRATCH);

  14193 16 002702   000000 630400 xsym               EPPR0   CLOSE_MAILIN_SCRATCH
        16 002703   050001 713400                    CLIMB   close
        16 002704   406000 401760                    pmme    nvectors=13

     1629    14194    1       RETURN;

  14194 16 002705   000000 702200 xent               TSX2  ! X66_ARET

  14193 16 002706                       BAD_MAIL     null
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:275  
     1630    14195        /**/
     1631    14196    1   BAD_MAIL:;
     1632    14197    1       ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  14197 16 002706   000000 470400 xsym               LDP0    B$TCB$
        16 002707   000000 471500                    LDP1    0,,PR0
        16 002710   100102 236100                    LDQ     66,,PR1
        16 002711   001076 756000 11                 STQ     ERROR

     1633    14198    1       NEW_NAME = DCBADDR(DCBNUM(MAIL_IN)) -> F$DCB.NAME#;

  14198 16 002712   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 002713   000024 473400 17                 LDP3    20
        16 002714   300000 474500                    LDP4    0,,PR3
        16 002715   400000 475506                    LDP5    0,QL,PR4
        16 002716   000000 100500                    MLR     fill='000'O
        16 002717   500010 000040                    ADSC9   8,,PR5                   cn=0,n=32
        16 002720   001066 000040 11                 ADSC9   NEW_NAME                 cn=0,n=32

     1634    14199    1       SUBSTR(NEW_NAME.NAME#,1,4)='DEAD';

  14199 16 002721   040000 100400                    MLR     fill='040'O
        16 002722   000603 000004 12                 ADSC9   E_BADSITE+80             cn=0,n=4
        16 002723   001066 400004 11                 ADSC9   NEW_NAME                 cn=2,n=4

     1635    14200    1       CALL M$CLOSE (RENAME_BAD_FILE) ALTRET (RENAME_DIDNT_WORK);

  14200 16 002724   001030 630400 11                 EPPR0   RENAME_BAD_FILE
        16 002725   450001 713400                    CLIMB   alt,close
        16 002726   406000 401760                    pmme    nvectors=13
        16 002727   002730 702000 16                 TSX2    RENAME_DIDNT_WORK

  14199 16 002730                       RENAME_DIDN* null
     1636    14201    1   RENAME_DIDNT_WORK: ;
     1637    14202    1       CALL M$DISPRES (REL_PACK) ALTRET (TOSS_IT);

  14202 16 002730   001316 630400 11                 EPPR0   REL_PACK
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:276  
        16 002731   550002 713400                    CLIMB   alt,+53250
        16 002732   402400 401760                    pmme    nvectors=6
        16 002733   002740 702000 16                 TSX2    TOSS_IT

     1638    14203    1       CALL M$RELRES (REL_PACK) ALTRET (TOSS_IT);

  14203 16 002734   001316 630400 11                 EPPR0   REL_PACK
        16 002735   550003 713400                    CLIMB   alt,+53251
        16 002736   402400 401760                    pmme    nvectors=6
        16 002737   002740 702000 16                 TSX2    TOSS_IT

     1639    14204    1   TOSS_IT:
     1640    14205    2       CALL M$CLOSE (CLOSE_MAILIN_SCRATCH) WHENALTRETURN DO; END;

  14205 16 002740   000000 630400 xsym  TOSS_IT      EPPR0   CLOSE_MAILIN_SCRATCH
        16 002741   450001 713400                    CLIMB   alt,close
        16 002742   406000 401760                    pmme    nvectors=13
        16 002743   002745 702000 16                 TSX2    s:14206
        16 002744   002745 710000 16                 TRA     s:14206

     1641    14206    1       CALL VOM$DELENTRY(TIME$,%NO#,TIME_HEAD$);

  14206 16 002745   000065 630400 17                 EPPR0   53
        16 002746   000007 631400 17                 EPPR1   7
        16 002747   000000 701000 xent               TSX1    VOM$DELENTRY
        16 002750   000000 011000                    NOP     0

     1642    14207    1       RETURN;

  14207 16 002751   000000 702200 xent               TSX2  ! X66_ARET

     1643    14208        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:277  
     1644    14209    1   REFRESH_INPUT_HEADER: PROC ALTRET;

  14209 16 002752   201270 741300       REFRESH_INP* STX1  ! SITENAME+71,,AUTO

     1645    14210
     1646    14211    2       CALL VMD$GET_HEADER (0, DCBNUM(MAIL_IN))

  14211 16 002753   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 002754   201272 756100                    STQ     I+1,,AUTO
        16 002755   201272 630500                    EPPR0   I+1,,AUTO
        16 002756   201275 450500                    STP0    I+4,,AUTO
        16 002757   000006 236000 17                 LDQ     6
        16 002760   201274 756100                    STQ     I+3,,AUTO
        16 002761   201274 630500                    EPPR0   I+3,,AUTO
        16 002762   000000 631400 17                 EPPR1   0
        16 002763   000000 701000 xent               TSX1    VMD$GET_HEADER
        16 002764   002766 702000 16                 TSX2    s:14213
        16 002765   002770 710000 16                 TRA     s:14222

     1647    14212    3       WHENALTRETURN DO;

     1648    14213    3           ALTRETURN;

  14213 16 002766   201270 221300                    LDX1  ! SITENAME+71,,AUTO
        16 002767   000000 702211                    TSX2  ! 0,X1

     1649    14214    3       END;
     1650    14215
     1651    14216        /*
     1652    14217             ***** Setup HEADER_MCB ...
     1653    14218                   NOTE: After every call to X$ALLOCATE or X$DEALLOCATE
     1654    14219                   it is important that VM_HEADER.NEXT$ and FREE$ be
     1655    14220                   updated from HEADER_MCB.HI_SEGMENT$ and FREE_HEAD$ ...
     1656    14221        */
     1657    14222    2       HEADER_MCB.TYPE = 0;

  14222 16 002770   000727 450000 11                 STZ     HEADER_MCB+5
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:278  

     1658    14223    2       HEADER_MCB.MIN_SIZE = 12;

  14223 16 002771   000014 235007                    LDA     12,DL
        16 002772   000731 755000 11                 STA     HEADER_MCB+7

     1659    14224    2       HEADER_MCB.SEGMENT_BASE$ = VM_HEADER$;

  14224 16 002773   000000 236000 xsym               LDQ     VM_HEADER$
        16 002774   000724 756000 11                 STQ     HEADER_MCB+2

     1660    14225    2       HEADER_MCB.HI_SEGMENT$ = VM_HEADER.NEXT$;

  14225 16 002775   000000 470400 xsym               LDP0    VM_HEADER$
        16 002776   000016 236100                    LDQ     14,,PR0
        16 002777   000725 756000 11                 STQ     HEADER_MCB+3

     1661    14226    2       HEADER_MCB.FREE_HEAD$ = VM_HEADER.FREE$;

  14226 16 003000   000015 236100                    LDQ     13,,PR0
        16 003001   000723 756000 11                 STQ     HEADER_MCB+1

     1662    14227    2       HEADER_MCB.WKSZ = (VBOUND(VM_HEADER_)+1)/4;

  14227 16 003002   000000 236000 xsym               LDQ     VM_HEADER_
        16 003003   000020 772000                    QRL     16
        16 003004   000001 036007                    ADLQ    1,DL
        16 003005   000002 772000                    QRL     2
        16 003006   000726 756000 11                 STQ     HEADER_MCB+4

     1663    14228
     1664    14229    2       RETURN;

  14229 16 003007   201270 221300                    LDX1  ! SITENAME+71,,AUTO
        16 003010   000001 702211                    TSX2  ! 1,X1

     1665    14230
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:279  
     1666    14231    2   END REFRESH_INPUT_HEADER;
     1667    14232        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:280  
     1668    14233    1   ASSIGN_A_MESSAGE_ID: PROC ALTRET;

  14233 16 003011   201146 741300       ASSIGN_A_ME* STX1  ! DELIVERY_SUMMARY+2,,AUTO

     1669    14234
     1670    14235        /*
     1671    14236             ***** Construct a unique-ID string for this message, and put it
     1672    14237                   in the header.  The strings take the form:
     1673    14238
     1674    14239                 <yymmdd.hhmmssss@CP6>
     1675    14240
     1676    14241                   This code is executed when MAILMAN first processes any message
     1677    14242                   that does not already have a unique ID;  such messages may include
     1678    14243                   MAILMAN-generated packets such as ERRs and DELIVs, as well as
     1679    14244                   intersystem messages that originate in pre-B00 mail environments.
     1680    14245        */
     1681    14246
     1682    14247    2       WORK_TIME = VM_HEADER.CREATION_DATE;

  14247 16 003012   000000 470400 xsym               LDP0    VM_HEADER$
        16 003013   000001 235100                    LDA     1,,PR0
        16 003014   001656 755000 11                 STA     WORK_TIME

     1683    14248    2       CALL M$TIME (GET_ANSI_TIME);

  14248 16 003015   000260 630400 12                 EPPR0   GET_ANSI_TIME
        16 003016   020004 713400                    CLIMB   8196
        16 003017   402000 401760                    pmme    nvectors=5

     1684    14249    2       CALL CONCAT (ID, '<', ANSI_DATE, '.', ANSI_TIME, '@CP6>');

  14249 16 003020   074000 236003                    LDQ     30720,DU
        16 003021   200260 756100                    STQ     ID,,AUTO
        16 003022   040100 100400                    MLR     fill='040'O
        16 003023   000504 000006 11                 ADSC9   ANSI_DATE                cn=0,n=6
        16 003024   200260 200006                    ADSC9   ID,,AUTO                 cn=1,n=6
        16 003025   000056 236007                    LDQ     46,DL
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:281  
        16 003026   200261 552104                    STBQ    ID+1,'04'O,AUTO
        16 003027   000502 237000 11                 LDAQ    ANSI_TIME
        16 003030   200262 757100                    STAQ    ID+2,,AUTO
        16 003031   040100 100400                    MLR     fill='040'O
        16 003032   000604 000005 12                 ADSC9   E_BADSITE+81             cn=0,n=5
        16 003033   200264 000757                    ADSC9   ID+4,,AUTO               cn=0,n=495

     1685    14250    2       CALL INDEX (COUNT, ' ', ID);

  14250 16 003034   000000 124500                    SCM     mask='000'O
        16 003035   200260 000777                    ADSC9   ID,,AUTO                 cn=0,n=511
        16 003036   000023 000001 17                 ADSC9   19                       cn=0,n=1
        16 003037   200247 000100                    ARG     COUNT,,AUTO

     1686    14251    2       HEADER_MCB.SIZE = COUNT + 1;

  14251 16 003040   200247 235100                    LDA     COUNT,,AUTO
        16 003041   000001 035007                    ADLA    1,DL
        16 003042   000730 755000 11                 STA     HEADER_MCB+6

     1687    14252    2       HEADER_MCB.TYPE = 0;

  14252 16 003043   000727 450000 11                 STZ     HEADER_MCB+5

     1688    14253    2       HEADER_MCB.MIN_SIZE = 3;

  14253 16 003044   000003 236007                    LDQ     3,DL
        16 003045   000731 756000 11                 STQ     HEADER_MCB+7

     1689    14254    2       HEADER_MCB.SEGMENT_BASE$ = VM_HEADER$;

  14254 16 003046   000000 236000 xsym               LDQ     VM_HEADER$
        16 003047   000724 756000 11                 STQ     HEADER_MCB+2

     1690    14255    2       HEADER_MCB.HI_SEGMENT$ = VM_HEADER.NEXT$;

  14255 16 003050   000000 470400 xsym               LDP0    VM_HEADER$
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:282  
        16 003051   000016 236100                    LDQ     14,,PR0
        16 003052   000725 756000 11                 STQ     HEADER_MCB+3

     1691    14256    2       HEADER_MCB.FREE_HEAD$ = VM_HEADER.FREE$;

  14256 16 003053   000015 236100                    LDQ     13,,PR0
        16 003054   000723 756000 11                 STQ     HEADER_MCB+1

     1692    14257    2       HEADER_MCB.WKSZ = (VBOUND(VM_HEADER_)+1)/4;

  14257 16 003055   000000 236000 xsym               LDQ     VM_HEADER_
        16 003056   000020 772000                    QRL     16
        16 003057   000001 036007                    ADLQ    1,DL
        16 003060   000002 772000                    QRL     2
        16 003061   000726 756000 11                 STQ     HEADER_MCB+4

     1693    14258    2       CALL X$ALLOCATE (HEADER_MCB) ALTRET (E_ALLOCATE);

  14258 16 003062   000072 630400 17                 EPPR0   58
        16 003063   000025 631400 17                 EPPR1   21
        16 003064   000000 701000 xent               TSX1    X$ALLOCATE
        16 003065   003112 702000 16                 TSX2    E_ALLOCATE

     1694    14259    2       VM_HEADER.NEXT$ = PINCRW(HEADER_MCB.HI_SEGMENT$,1);

  14259 16 003066   000725 236000 11                 LDQ     HEADER_MCB+3
        16 003067   000001 036003                    ADLQ    1,DU
        16 003070   000000 470400 xsym               LDP0    VM_HEADER$
        16 003071   000016 756100                    STQ     14,,PR0

     1695    14260    2       VM_HEADER.UNIQUE_ID$ = HEADER_MCB.ADDRESS$;

  14260 16 003072   000722 236000 11                 LDQ     HEADER_MCB
        16 003073   000032 756100                    STQ     26,,PR0

     1696    14261    2       VM_HEADER.UNIQUE_ID$ -> X$STRING.SIZ = COUNT;

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:283  
  14261 16 003074   000032 471500                    LDP1    26,,PR0
        16 003075   000100 101500                    MRL     fill='000'O
        16 003076   200247 000004                    ADSC9   COUNT,,AUTO              cn=0,n=4
        16 003077   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1

     1697    14262    2       VM_HEADER.UNIQUE_ID$ -> X$STRING.TEXT = ID;

  14262 16 003100   000032 471500                    LDP1    26,,PR0
        16 003101   000100 101500                    MRL     fill='000'O
        16 003102   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        16 003103   201272 000002                    ADSC9   I+1,,AUTO                cn=0,n=2
        16 003104   201272 220100                    LDX0    I+1,,AUTO
        16 003105   040140 100500                    MLR     fill='040'O
        16 003106   200260 000777                    ADSC9   ID,,AUTO                 cn=0,n=511
        16 003107   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0

     1698    14263
     1699    14264    2       RETURN;

  14264 16 003110   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 003111   000001 702211                    TSX2  ! 1,X1

     1700    14265
     1701    14266    2   E_ALLOCATE: ALTRETURN;

  14266 16 003112   201146 221300       E_ALLOCATE   LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 003113   000000 702211                    TSX2  ! 0,X1

     1702    14267
     1703    14268    2   END ASSIGN_A_MESSAGE_ID;
     1704    14269        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:284  
     1705    14270    1   UPDATE_STATUS: PROC;

  14270 16 003114   201156 741300       UPDATE_STAT* STX1  ! COMBINED+1,,AUTO

     1706    14271
     1707    14272    2   DCL I SBIN;
     1708    14273
     1709    14274    2       IF NOT B$JIT.PRIV.ACTIVE.JIT

  14274 16 003115   000000 470400 xsym               LDP0    B$JIT$
        16 003116   000013 236100                    LDQ     11,,PR0
        16 003117   000040 316007                    CANQ    32,DL
        16 003120   003122 601000 16                 TNZ     s:14278

     1710    14275    2       THEN
     1711    14276    2           RETURN;

  14276 16 003121   000001 702211                    TSX2  ! 1,X1

     1712    14277
     1713    14278    2       CALL INDEX (I, '  ', STATUS_STRING);

  14278 16 003122   000000 120500                    SCD
        16 003123   200462 000400                    ADSC9   STATUS_STRING,,AUTO      cn=0,n=256
        16 003124   000606 000002 12                 ADSC9   E_BADSITE+83             cn=0,n=2
        16 003125   201157 000100                    ARG     I,,AUTO
        16 003126   003130 607000 16                 TTF     s:14279
        16 003127   201157 054100                    AOS     I,,AUTO

     1714    14279    2       B$JIT.CCBUF = STATUS_STRING;

  14279 16 003130   040100 100500                    MLR     fill='040'O
        16 003131   200462 000400                    ADSC9   STATUS_STRING,,AUTO      cn=0,n=256
        16 003132   000033 000400                    ADSC9   27,,PR0                  cn=0,n=256

     1715    14280    2       B$JIT.CCARS = I;

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:285  
  14280 16 003133   201157 720100                    LXL0    I,,AUTO
        16 003134   000032 740100                    STX0    26,,PR0

     1716    14281
     1717    14282    2       RETURN;

  14282 16 003135   201156 221300                    LDX1  ! COMBINED+1,,AUTO
        16 003136   000001 702211                    TSX2  ! 1,X1

     1718    14283
     1719    14284    2   END UPDATE_STATUS;
     1720    14285        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:286  
     1721    14286    1   GET_ADD_RECORD: PROC ALTRET;

  14286 16 003137   201146 741300       GET_ADD_REC* STX1  ! DELIVERY_SUMMARY+2,,AUTO

     1722    14287                            /* If this message originated off-site, then only look for
     1723    14288                               the intersys keys. */
     1724    14289    2       PTR$ = ADDR(NIL);

  14289 16 003140   000004 236000 17                 LDQ     4
        16 003141   200256 756100                    STQ     PTR$,,AUTO

     1725    14290    2       IF INTERSYS_ACTIVE

  14290 16 003142   200255 234100                    SZN     INTERSYS_ACTIVE,,AUTO
        16 003143   003171 605000 16                 TPL     s:14301

     1726    14291    3       THEN DO;

     1727    14292    3           ADD_TYPE = ADD_TYPE+1;

  14292 16 003144   200240 054100                    AOS     ADD_TYPE,,AUTO

     1728    14293    3           CALL VMA$GET_ADD_RECORD (ADD_TYPE,VM_ADDREC_,DCBNUM(MAIL_IN))

  14293 16 003145   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 003146   201272 756100                    STQ     I+1,,AUTO
        16 003147   201272 630500                    EPPR0   I+1,,AUTO
        16 003150   201275 450500                    STP0    I+4,,AUTO
        16 003151   000073 236000 17                 LDQ     59
        16 003152   201274 756100                    STQ     I+3,,AUTO
        16 003153   200240 631500                    EPPR1   ADD_TYPE,,AUTO
        16 003154   201273 451500                    STP1    I+2,,AUTO
        16 003155   201273 630500                    EPPR0   I+2,,AUTO
        16 003156   000007 631400 17                 EPPR1   7
        16 003157   000000 701000 xent               TSX1    VMA$GET_ADD_RECORD
        16 003160   003162 702000 16                 TSX2    s:14295
        16 003161   003166 710000 16                 TRA     s:14298
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:287  

     1729    14294    4           WHENALTRETURN DO;

     1730    14295    4               ADD_TYPE = ADD_TYPE-1;

  14295 16 003162   000001 336007                    LCQ     1,DL
        16 003163   200240 056100                    ASQ     ADD_TYPE,,AUTO

     1731    14296    4               ALTRETURN;

  14296 16 003164   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 003165   000000 702211                    TSX2  ! 0,X1

     1732    14297    4           END;
     1733    14298    3           ADD_TYPE = ADD_TYPE-1;

  14298 16 003166   000001 336007                    LCQ     1,DL
        16 003167   200240 056100                    ASQ     ADD_TYPE,,AUTO

     1734    14299    3       END;

  14299 16 003170   003210 710000 16                 TRA     s:14306

     1735    14300    3       ELSE DO;

     1736    14301    3           CALL VMA$GET_ADD_RECORD (ADD_TYPE,VM_ADDREC_,DCBNUM(MAIL_IN))

  14301 16 003171   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 003172   201272 756100                    STQ     I+1,,AUTO
        16 003173   201272 630500                    EPPR0   I+1,,AUTO
        16 003174   201275 450500                    STP0    I+4,,AUTO
        16 003175   000073 236000 17                 LDQ     59
        16 003176   201274 756100                    STQ     I+3,,AUTO
        16 003177   200240 631500                    EPPR1   ADD_TYPE,,AUTO
        16 003200   201273 451500                    STP1    I+2,,AUTO
        16 003201   201273 630500                    EPPR0   I+2,,AUTO
        16 003202   000007 631400 17                 EPPR1   7
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:288  
        16 003203   000000 701000 xent               TSX1    VMA$GET_ADD_RECORD
        16 003204   003206 702000 16                 TSX2    s:14303
        16 003205   003210 710000 16                 TRA     s:14306

     1737    14302    4           WHENALTRETURN DO;

     1738    14303    4               ALTRETURN;

  14303 16 003206   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 003207   000000 702211                    TSX2  ! 0,X1

     1739    14304    4           END;
     1740    14305    3       END;

     1741    14306    2       PTR$ = VM_ADDREC$ -> VM_ADD_HEAD.HEAD$;

  14306 16 003210   000000 470400 xsym               LDP0    VM_ADDREC$
        16 003211   000003 236100                    LDQ     3,,PR0
        16 003212   200256 756100                    STQ     PTR$,,AUTO

     1742    14307    2       RETURN;

  14307 16 003213   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 003214   000001 702211                    TSX2  ! 1,X1

     1743    14308    2   END GET_ADD_RECORD;
     1744    14309        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:289  
     1745    14310    1   INIT_DELIVERY_RECORD: PROC;

  14310 16 003215   201150 741300       INIT_DELIVE* STX1  ! @ONE+1,,AUTO

     1746    14311
     1747    14312        /*I*  NAME:    INIT_DELIVERY_RECORD
     1748    14313              CALL:    CALL INIT_DELIVERY_RECORD;
     1749    14314              INPUT:   Global VM_RADDRESS.
     1750    14315              OUTPUT:  Global VM_DELIVERY record initialized;
     1751    14316                       global VM_DELIVERYKEY record initialized.
     1752    14317              DESCRIPTION: Given a resolved address, INIT_DELIVERY_RECORD creates the
     1753    14318                           appropriate delivery-record information.
     1754    14319        */
     1755    14320
     1756    14321
     1757    14322    2       VM_DELIVERY = INIT_DELIVERY;

  14322 16 003216   000100 100400                    MLR     fill='000'O
        16 003217   000024 000414 12                 ADSC9   INIT_DELIVERY            cn=0,n=268
        16 003220   200004 000414                    ADSC9   VM_DELIVERY,,AUTO        cn=0,n=268

     1758    14323
     1759    14324    3       DO CASE (ADD_TYPE);

  14324 16 003221   200240 235100                    LDA     ADD_TYPE,,AUTO
        16 003222   000020 135007                    SBLA    16,DL
        16 003223   000021 115007                    CMPA    17,DL
        16 003224   003226 602005 16                 TNC     s:14324+5,AL
        16 003225   003257 710000 16                 TRA     s:14332
        16 003226   003247 710000 16                 TRA     s:14326
        16 003227   003257 710000 16                 TRA     s:14332
        16 003230   003257 710000 16                 TRA     s:14332
        16 003231   003257 710000 16                 TRA     s:14332
        16 003232   003257 710000 16                 TRA     s:14332
        16 003233   003257 710000 16                 TRA     s:14332
        16 003234   003257 710000 16                 TRA     s:14332
        16 003235   003257 710000 16                 TRA     s:14332
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:290  
        16 003236   003252 710000 16                 TRA     s:14327
        16 003237   003257 710000 16                 TRA     s:14332
        16 003240   003257 710000 16                 TRA     s:14332
        16 003241   003257 710000 16                 TRA     s:14332
        16 003242   003257 710000 16                 TRA     s:14332
        16 003243   003257 710000 16                 TRA     s:14332
        16 003244   003257 710000 16                 TRA     s:14332
        16 003245   003257 710000 16                 TRA     s:14332
        16 003246   003255 710000 16                 TRA     s:14328

     1760    14325
     1761    14326    3       CASE (%VM_TYPE_TO); VM_DELIVERY.FLAGS.PRIMARY = %YES#;

  14326 16 003247   100000 236003                    LDQ     32768,DU
        16 003250   200005 256100                    ORSQ    VM_DELIVERY+1,,AUTO
        16 003251   003257 710000 16                 TRA     s:14332

     1762    14327    3       CASE (%VM_TYPE_C); VM_DELIVERY.FLAGS.C = %YES#;

  14327 16 003252   040000 236003                    LDQ     16384,DU
        16 003253   200005 256100                    ORSQ    VM_DELIVERY+1,,AUTO
        16 003254   003257 710000 16                 TRA     s:14332

     1763    14328    3       CASE (%VM_TYPE_BC); VM_DELIVERY.FLAGS.BC = %YES#;

  14328 16 003255   020000 236003                    LDQ     8192,DU
        16 003256   200005 256100                    ORSQ    VM_DELIVERY+1,,AUTO

     1764    14329
     1765    14330    3       END;

     1766    14331
     1767    14332    2       VM_DELIVERYKEY = INIT_DELIVERYKEY;

  14332 16 003257   000100 100400                    MLR     fill='000'O
        16 003260   000127 000051 12                 ADSC9   INIT_DELIVERYKEY         cn=0,n=41
        16 003261   200107 000051                    ADSC9   VM_DELIVERYKEY,,AUTO     cn=0,n=41
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:291  

     1768    14333
     1769    14334    2       VM_DELIVERYKEY.ACCT = VM_RADDRESS.ACCT;

  14334 16 003262   040100 100400                    MLR     fill='040'O
        16 003263   000237 600010 11                 ADSC9   VM_RADDRESS+17           cn=3,n=8
        16 003264   200111 000010                    ADSC9   VM_DELIVERYKEY+2,,AUTO   cn=0,n=8

     1770    14335
     1771    14336    2       IF VM_RADDRESS.NOMAD.DELIM = ' ' AND VM_RADDRESS.NOMAD.PSID ~= ' '

  14336 16 003265   000232 236000 11                 LDQ     VM_RADDRESS+12
        16 003266   777000 376003                    ANQ     -512,DU
        16 003267   040000 116003                    CMPQ    16384,DU
        16 003270   003304 601000 16                 TNZ     s:14342
        16 003271   040000 106400                    CMPC    fill='040'O
        16 003272   000232 200006 11                 ADSC9   VM_RADDRESS+12           cn=1,n=6
        16 003273   000023 000001 17                 ADSC9   19                       cn=0,n=1
        16 003274   003304 600000 16                 TZE     s:14342

     1772    14337    3       THEN DO;

     1773    14338    3           VM_DELIVERYKEY.PSID = VM_RADDRESS.NOMAD.PSID;

  14338 16 003275   040100 100400                    MLR     fill='040'O
        16 003276   000232 200006 11                 ADSC9   VM_RADDRESS+12           cn=1,n=6
        16 003277   200107 400006                    ADSC9   VM_DELIVERYKEY,,AUTO     cn=2,n=6

     1774    14339    3           VM_DELIVERYKEY.FOLDER = VM_RADDRESS.NOMAD.FOLDER;

  14339 16 003300   040100 100400                    MLR     fill='040'O
        16 003301   000225 400022 11                 ADSC9   VM_RADDRESS+7            cn=2,n=18
        16 003302   200113 000031                    ADSC9   VM_DELIVERYKEY+4,,AUTO   cn=0,n=25

     1775    14340    3       END;

  14340 16 003303   003307 710000 16                 TRA     s:14344
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:292  

     1776    14341    2       ELSE
     1777    14342    2           VM_DELIVERYKEY.FOLDER = VM_RADDRESS.FOLDER;

  14342 16 003304   040100 100400                    MLR     fill='040'O
        16 003305   000225 400031 11                 ADSC9   VM_RADDRESS+7            cn=2,n=25
        16 003306   200113 000031                    ADSC9   VM_DELIVERYKEY+4,,AUTO   cn=0,n=25

     1778    14343
     1779    14344    2       IF VM_DELIVERYKEY.FOLDER = ' '

  14344 16 003307   040000 106500                    CMPC    fill='040'O
        16 003310   200113 000031                    ADSC9   VM_DELIVERYKEY+4,,AUTO   cn=0,n=25
        16 003311   000023 000001 17                 ADSC9   19                       cn=0,n=1
        16 003312   003316 601000 16                 TNZ     s:14348

     1780    14345    2       THEN
     1781    14346    2           VM_DELIVERYKEY.FOLDER = 'CENTRAL';

  14346 16 003313   040100 100400                    MLR     fill='040'O
        16 003314   000607 000007 12                 ADSC9   E_BADSITE+84             cn=0,n=7
        16 003315   200113 000031                    ADSC9   VM_DELIVERYKEY+4,,AUTO   cn=0,n=25

     1782    14347
     1783    14348    2       RETURN;

  14348 16 003316   000001 702211                    TSX2  ! 1,X1

     1784    14349
     1785    14350    2   END INIT_DELIVERY_RECORD;
     1786    14351        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:293  
     1787    14352    1   FILL_IN_DELIVERY_RECORD: PROC;

  14352 16 003317   201146 741300       FILL_IN_DEL* STX1  ! DELIVERY_SUMMARY+2,,AUTO

     1788    14353
     1789    14354        /*I*  NAME:    FILL_IN_DELIVERY_RECORD
     1790    14355              CALL:    CALL FILL_IN_DELIVERY_RECORD;
     1791    14356              INPUT:   Global VM_RADDRESS and VM_UADDRESS;
     1792    14357                       global VM_DELIVERY.
     1793    14358              OUTPUT:  User name filled into VM_DELIVERY.
     1794    14359
     1795    14360              DESCRIPTION: Given an unresolved address, FILL_IN_DELIVERY_RECORD copies
     1796    14361                           the user-name information, if any, into the delivery record.
     1797    14362        */
     1798    14363
     1799    14364    2       WORK_TEXTC.L# = LENGTHC(WORK_TEXTC.NAME#);

  14364 16 003320   777000 236003                    LDQ     -512,DU
        16 003321   001077 552040 11                 STBQ    WORK_TEXTC,'40'O

     1800    14365
     1801    14366    2       IF VM_RADDRESS.TYPE = %VM_ADD_UNRESOLVED

  14366 16 003322   000220 236000 11                 LDQ     VM_RADDRESS+2
        16 003323   000777 376003                    ANQ     511,DU
        16 003324   000002 116003                    CMPQ    2,DU
        16 003325   003333 601000 16                 TNZ     s:14370

     1802    14367    2       THEN
     1803    14368    2           CALL VMF$MAKE_ADDRESS2 (WORK_TEXTC,VM_RADDRESS,%YES#);

  14368 16 003326   000014 630400 17                 EPPR0   12
        16 003327   000007 631400 17                 EPPR1   7
        16 003330   000000 701000 xent               TSX1    VMF$MAKE_ADDRESS2
        16 003331   000000 011000                    NOP     0
        16 003332   003337 710000 16                 TRA     s:14372

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:294  
     1804    14369    2       ELSE
     1805    14370    2           CALL VMF$MAKE_ADDRESS2 (WORK_TEXTC,VM_UADDRESS,%YES#);

  14370 16 003333   000017 630400 17                 EPPR0   15
        16 003334   000007 631400 17                 EPPR1   7
        16 003335   000000 701000 xent               TSX1    VMF$MAKE_ADDRESS2
        16 003336   000000 011000                    NOP     0

     1806    14371
     1807    14372    2       VM_DELIVERY.COUNT = WORK_TEXTC.L#;

  14372 16 003337   001077 236000 11                 LDQ     WORK_TEXTC
        16 003340   200007 552140                    STBQ    VM_DELIVERY+3,'40'O,AUTO

     1808    14373    2       VM_DELIVERY.TEXT = WORK_TEXTC.NAME#;

  14373 16 003341   040100 100400                    MLR     fill='040'O
        16 003342   001077 200377 11                 ADSC9   WORK_TEXTC               cn=1,n=255
        16 003343   200007 200377                    ADSC9   VM_DELIVERY+3,,AUTO      cn=1,n=255

     1809    14374
     1810    14375    2       RETURN;

  14375 16 003344   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 003345   000001 702211                    TSX2  ! 1,X1

     1811    14376
     1812    14377    2   END FILL_IN_DELIVERY_RECORD;
     1813    14378        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:295  
     1814    14379    1   GENERATE_AN_ERROR_ENTRY: PROC;

  14379 16 003346   201146 741300       GENERATE_AN* STX1  ! DELIVERY_SUMMARY+2,,AUTO

     1815    14380
     1816    14381    2       CALL INIT_DELIVERY_RECORD;

  14381 16 003347   003215 701000 16                 TSX1    INIT_DELIVERY_RECORD
        16 003350   000000 011000                    NOP     0

     1817    14382    2       WORK_TEXTC.L# = LENGTHC(WORK_TEXTC.NAME#);

  14382 16 003351   777000 236003                    LDQ     -512,DU
        16 003352   001077 552040 11                 STBQ    WORK_TEXTC,'40'O

     1818    14383    2       IF VM_RADDRESS.TYPE = %VM_ADD_RESOLVED

  14383 16 003353   000220 236000 11                 LDQ     VM_RADDRESS+2
        16 003354   000777 376003                    ANQ     511,DU
        16 003355   000001 116003                    CMPQ    1,DU
        16 003356   003364 601000 16                 TNZ     s:14387

     1819    14384    2       THEN
     1820    14385    2           CALL VMF$MAKE_ADDRESS2 (WORK_TEXTC,VM_RADDRESS,%YES#);

  14385 16 003357   000014 630400 17                 EPPR0   12
        16 003360   000007 631400 17                 EPPR1   7
        16 003361   000000 701000 xent               TSX1    VMF$MAKE_ADDRESS2
        16 003362   000000 011000                    NOP     0
        16 003363   003370 710000 16                 TRA     s:14388

     1821    14386    2       ELSE
     1822    14387    2           CALL VMF$MAKE_ADDRESS2 (WORK_TEXTC,VM_UADDRESS,%YES#);

  14387 16 003364   000017 630400 17                 EPPR0   15
        16 003365   000007 631400 17                 EPPR1   7
        16 003366   000000 701000 xent               TSX1    VMF$MAKE_ADDRESS2
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:296  
        16 003367   000000 011000                    NOP     0

     1823    14388    2       VM_DELIVERY.COUNT = WORK_TEXTC.L#;

  14388 16 003370   001077 236000 11                 LDQ     WORK_TEXTC
        16 003371   200007 552140                    STBQ    VM_DELIVERY+3,'40'O,AUTO

     1824    14389    2       VM_DELIVERY.TEXT = WORK_TEXTC.NAME#;

  14389 16 003372   040100 100400                    MLR     fill='040'O
        16 003373   001077 200377 11                 ADSC9   WORK_TEXTC               cn=1,n=255
        16 003374   200007 200377                    ADSC9   VM_DELIVERY+3,,AUTO      cn=1,n=255

     1825    14390    2       VM_DELIVERY.UTS_OF_DELIVERY = CURRENT_TIME;

  14390 16 003375   001657 235000 11                 LDA     CURRENT_TIME
        16 003376   200004 755100                    STA     VM_DELIVERY,,AUTO

     1826    14391    2       VM_DELIVERY.FLAGS.DONE = %YES#;

  14391 16 003377   400000 236003                    LDQ     -131072,DU
        16 003400   200005 256100                    ORSQ    VM_DELIVERY+1,,AUTO

     1827    14392    2       VM_DELIVERY.ERR = ERROR;

  14392 16 003401   001076 236000 11                 LDQ     ERROR
        16 003402   200006 756100                    STQ     VM_DELIVERY+2,,AUTO

     1828    14393    2       CALL VMD$PUT_DELIVERY (DCBNUM(MAIL_IN), VM_DELIVERYKEY, VM_DELIVERY);

  14393 16 003403   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 003404   201272 756100                    STQ     I+1,,AUTO
        16 003405   200004 630500                    EPPR0   VM_DELIVERY,,AUTO
        16 003406   201275 450500                    STP0    I+4,,AUTO
        16 003407   200107 631500                    EPPR1   VM_DELIVERYKEY,,AUTO
        16 003410   201274 451500                    STP1    I+3,,AUTO
        16 003411   201272 633500                    EPPR3   I+1,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:297  
        16 003412   201273 453500                    STP3    I+2,,AUTO
        16 003413   201273 630500                    EPPR0   I+2,,AUTO
        16 003414   000007 631400 17                 EPPR1   7
        16 003415   000000 701000 xent               TSX1    VMD$PUT_DELIVERY
        16 003416   000000 011000                    NOP     0

     1829    14394
     1830    14395    2       RETURN;

  14395 16 003417   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 003420   000001 702211                    TSX2  ! 1,X1

     1831    14396
     1832    14397    2   END GENERATE_AN_ERROR_ENTRY;
     1833    14398        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:298  
     1834    14399    1   RETURN_ERROR_MSG: PROC ALTRET;

  14399 16 003421   201146 741300       RETURN_ERRO* STX1  ! DELIVERY_SUMMARY+2,,AUTO

     1835    14400        /*
     1836    14401             ***** This routine expects error and WORK_TEXTC to
     1837    14402                   be setup upon entry to this routine. WORK_TEXTC
     1838    14403                   will be returned as the address that caused the
     1839    14404                   error stored in error ...
     1840    14405        */
     1841    14406
     1842    14407    2   DCL SET_FCOPY_FLAG BIT (1);
     1843    14408
     1844    14409    2       SET_FCOPY_FLAG = %NO#;

  14409 16 003422   201147 450100                    STZ     SET_FCOPY_FLAG,,AUTO

     1845    14410    2       CALL REFRESH_INPUT_HEADER;

  14410 16 003423   002752 701000 16                 TSX1    REFRESH_INPUT_HEADER
        16 003424   000000 011000                    NOP     0

     1846    14411    2       HEADER_MCB.SIZE = WORK_TEXTC.L# + 1;

  14411 16 003425   001077 236000 11                 LDQ     WORK_TEXTC
        16 003426   000033 772000                    QRL     27
        16 003427   000001 036007                    ADLQ    1,DL
        16 003430   000730 756000 11                 STQ     HEADER_MCB+6

     1847    14412    2       CALL X$ALLOCATE (HEADER_MCB)

  14412 16 003431   000072 630400 17                 EPPR0   58
        16 003432   000025 631400 17                 EPPR1   21
        16 003433   000000 701000 xent               TSX1    X$ALLOCATE
        16 003434   003436 702000 16                 TSX2    s:14415
        16 003435   003453 710000 16                 TRA     s:14419

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:299  
     1848    14413    2       WHENALTRETURN
     1849    14414    3       DO;

     1850    14415    3           CALL VMA$ENLARGE_SEGMENT (VM_HEADER_,1024) ALTRET(BAD_MAIL);

  14415 16 003436   000075 630400 17                 EPPR0   61
        16 003437   000000 631400 17                 EPPR1   0
        16 003440   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        16 003441   003650 702000 16                 TSX2    BAD_MAIL

     1851    14416    3           HEADER_MCB.WKSZ = (VBOUND(VM_HEADER_)+1)/4;

  14416 16 003442   000000 236000 xsym               LDQ     VM_HEADER_
        16 003443   000020 772000                    QRL     16
        16 003444   000001 036007                    ADLQ    1,DL
        16 003445   000002 772000                    QRL     2
        16 003446   000726 756000 11                 STQ     HEADER_MCB+4

     1852    14417    3           CALL X$ALLOCATE (HEADER_MCB) ALTRET(BAD_MAIL);

  14417 16 003447   000072 630400 17                 EPPR0   58
        16 003450   000025 631400 17                 EPPR1   21
        16 003451   000000 701000 xent               TSX1    X$ALLOCATE
        16 003452   003650 702000 16                 TSX2    BAD_MAIL

     1853    14418    3       END;

     1854    14419    2       VM_HEADER.BAD_ADDRESS$ = HEADER_MCB.ADDRESS$;

  14419 16 003453   000722 236000 11                 LDQ     HEADER_MCB
        16 003454   000000 470400 xsym               LDP0    VM_HEADER$
        16 003455   000017 756100                    STQ     15,,PR0

     1855    14420    2       VM_HEADER.BAD_ADDRESS$ -> X$STRING.SIZ = WORK_TEXTC.L#;

  14420 16 003456   000017 471500                    LDP1    15,,PR0
        16 003457   000100 100400                    MLR     fill='000'O
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:300  
        16 003460   001077 000001 11                 ADSC9   WORK_TEXTC               cn=0,n=1
        16 003461   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1

     1856    14421    2       VM_HEADER.BAD_ADDRESS$ -> X$STRING.TEXT = WORK_TEXTC.NAME#;

  14421 16 003462   000017 471500                    LDP1    15,,PR0
        16 003463   000100 101500                    MRL     fill='000'O
        16 003464   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        16 003465   201272 000002                    ADSC9   I+1,,AUTO                cn=0,n=2
        16 003466   201272 220100                    LDX0    I+1,,AUTO
        16 003467   040140 100400                    MLR     fill='040'O
        16 003470   001077 200777 11                 ADSC9   WORK_TEXTC               cn=1,n=511
        16 003471   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0

     1857    14422    2       VM_HEADER.ERROR = ERROR;

  14422 16 003472   001076 236000 11                 LDQ     ERROR
        16 003473   000014 756100                    STQ     12,,PR0

     1858    14423    2       VM_HEADER.NEXT$ = HEADER_MCB.HI_SEGMENT$;

  14423 16 003474   000725 236000 11                 LDQ     HEADER_MCB+3
        16 003475   000016 756100                    STQ     14,,PR0

     1859    14424    2       VM_HEADER.FREE$ = HEADER_MCB.FREE_HEAD$;

  14424 16 003476   000723 236000 11                 LDQ     HEADER_MCB+1
        16 003477   000015 756100                    STQ     13,,PR0

     1860    14425    2       VM_HEADER.STATUS.ERR = %YES#;

  14425 16 003500   400000 236003                    LDQ     -131072,DU
        16 003501   000012 256100                    ORSQ    10,,PR0

     1861    14426    2       VM_HEADER.STATUS.RR = %NO#;

  14426 16 003502   000010 236000 17                 LDQ     8
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:301  
        16 003503   000012 356100                    ANSQ    10,,PR0

     1862    14427    2       VM_HEADER.STATUS.DR = %NO#;

  14427 16 003504   000011 236000 17                 LDQ     9
        16 003505   000012 356100                    ANSQ    10,,PR0

     1863    14428    2       VM_HEADER.DELIVERY_DATE = CURRENT_TIME;

  14428 16 003506   001657 235000 11                 LDA     CURRENT_TIME
        16 003507   000002 755100                    STA     2,,PR0

     1864    14429    2       VM_HEADER.FIRST_DELIVERY = 0;

  14429 16 003510   000003 450100                    STZ     3,,PR0

     1865    14430        /*
     1866    14431           Create a virgin mailgram file for the ERR packet.
     1867    14432        */
     1868    14433    2       CALL CREATE_NEW_MAILGRAM (DCBNUM(MAIL_OUT)) ALTRET (BAD_MAIL);

  14433 16 003511   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 003512   201306 756100                    STQ     I+13,,AUTO
        16 003513   201306 631500                    EPPR1   I+13,,AUTO
        16 003514   201151 451500                    STP1    PREFIX+1,,AUTO
        16 003515   003673 701000 16                 TSX1    CREATE_NEW_MAILGRAM
        16 003516   003650 702000 16                 TSX2    BAD_MAIL

     1869    14434        /*
     1870    14435           Address the ERR to the sender of the original mail, and no one else.
     1871    14436        */
     1872    14437    2       CALL CONSTRUCT_RETURN_ADDRESS (RETURN_ADDRESS_BUFFER,

  14437 16 003517   000000 470400 xsym               LDP0    VM_HEADER$
        16 003520   000026 471500                    LDP1    22,,PR0
        16 003521   201153 451500                    STP1    ACCT+1,,AUTO
        16 003522   000057 236000 17                 LDQ     47
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:302  
        16 003523   201152 756100                    STQ     KEY_VALUE+1,,AUTO
        16 003524   200766 633500                    EPPR3   RETURN_ADDRESS_BUFFER,,AUTO
        16 003525   201151 453500                    STP3    PREFIX+1,,AUTO
        16 003526   003743 701000 16                 TSX1    CONSTRUCT_RETURN_ADDRESS
        16 003527   003650 702000 16                 TSX2    BAD_MAIL

     1873    14438    2         SIZEW(RETURN_ADDRESS_BUFFER), VM_HEADER.RETURN_ADDRESS$ -> VM$RADDRESS)
     1874    14439    2         ALTRET (BAD_MAIL);
     1875    14440    2       CALL VMA$PUT_ADD_RECORD (%VM_TYPE_TO, VECTOR(RETURN_ADDRESS_BUFFER),

  14440 16 003530   000060 235000 17                 LDA     48
        16 003531   201272 452500                    STP2    I+1,,AUTO
        16 003532   201272 236100                    LDQ     I+1,,AUTO
        16 003533   000766 036003                    ADLQ    502,DU
        16 003534   201274 757100                    STAQ    I+3,,AUTO
        16 003535   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 003536   201300 756100                    STQ     I+7,,AUTO
        16 003537   201274 237100                    LDAQ    I+3,,AUTO
        16 003540   201276 757100                    STAQ    I+5,,AUTO
        16 003541   201300 235100                    LDA     I+7,,AUTO
        16 003542   201301 755100                    STA     I+8,,AUTO
        16 003543   201301 630500                    EPPR0   I+8,,AUTO
        16 003544   201304 450500                    STP0    I+11,,AUTO
        16 003545   201276 631500                    EPPR1   I+5,,AUTO
        16 003546   201303 451500                    STP1    I+10,,AUTO
        16 003547   000062 236000 17                 LDQ     50
        16 003550   201302 756100                    STQ     I+9,,AUTO
        16 003551   201302 630500                    EPPR0   I+9,,AUTO
        16 003552   000007 631400 17                 EPPR1   7
        16 003553   000000 701000 xent               TSX1    VMA$PUT_ADD_RECORD
        16 003554   000000 011000                    NOP     0

     1876    14441    2         DCBNUM(MAIL_OUT));
     1877    14442        /*
     1878    14443           If a file copy was requested by the sender, and successfully delivered,
     1879    14444           then send an empty-bodied ERR mailgram referencing the unique-ID of the
     1880    14445           original, and with no ID of its own.  If a file copy was not delivered,
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:303  
     1881    14446           then return this mailgram to its sender with an ERR token attached,
     1882    14447           and with the unique-ID set up to make the ERR (with body) appear as if
     1883    14448           it were a direct copy of the original.
     1884    14449        */
     1885    14450    2       IF VM_HEADER.STATUS.FCOPY

  14450 16 003555   000000 470400 xsym               LDP0    VM_HEADER$
        16 003556   000012 236100                    LDQ     10,,PR0
        16 003557   000200 316003                    CANQ    128,DU
        16 003560   003602 600000 16                 TZE     s:14458

     1886    14451    3       THEN DO;

     1887    14452    3           VM_HEADER.REFERS_TO_ID$ = VM_HEADER.UNIQUE_ID$;

  14452 16 003561   000032 236100                    LDQ     26,,PR0
        16 003562   000033 756100                    STQ     27,,PR0

     1888    14453    3           VM_HEADER.UNIQUE_ID$ = ADDR(NIL);

  14453 16 003563   000004 236000 17                 LDQ     4
        16 003564   000032 756100                    STQ     26,,PR0

     1889    14454    3           VM_HEADER.STATUS.FCOPY = %NO#;

  14454 16 003565   000012 236000 17                 LDQ     10
        16 003566   000012 356100                    ANSQ    10,,PR0

     1890    14455    3           CALL VMD$PUT_HEADER (0, DCBNUM(MAIL_OUT));

  14455 16 003567   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 003570   201272 756100                    STQ     I+1,,AUTO
        16 003571   201272 631500                    EPPR1   I+1,,AUTO
        16 003572   201275 451500                    STP1    I+4,,AUTO
        16 003573   000006 236000 17                 LDQ     6
        16 003574   201274 756100                    STQ     I+3,,AUTO
        16 003575   201274 630500                    EPPR0   I+3,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:304  
        16 003576   000000 631400 17                 EPPR1   0
        16 003577   000000 701000 xent               TSX1    VMD$PUT_HEADER
        16 003600   000000 011000                    NOP     0

     1891    14456    3       END;

  14456 16 003601   003626 710000 16                 TRA     s:14461

     1892    14457    3       ELSE DO;

     1893    14458    3           SET_FCOPY_FLAG = %YES#;

  14458 16 003602   400000 236003                    LDQ     -131072,DU
        16 003603   201147 756100                    STQ     SET_FCOPY_FLAG,,AUTO

     1894    14459    3           CALL VMM$COPY_MESSAGE_BODY (0,0,DCBNUM(MAIL_IN),DCBNUM(MAIL_OUT),0,0);

  14459 16 003604   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 003605   201272 756100                    STQ     I+1,,AUTO
        16 003606   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 003607   201272 235100                    LDA     I+1,,AUTO
        16 003610   201273 755100                    STA     I+2,,AUTO
        16 003611   201274 756100                    STQ     I+3,,AUTO
        16 003612   000100 237000 17                 LDAQ    64
        16 003613   201302 757100                    STAQ    I+9,,AUTO
        16 003614   201274 631500                    EPPR1   I+3,,AUTO
        16 003615   201301 451500                    STP1    I+8,,AUTO
        16 003616   201273 633500                    EPPR3   I+2,,AUTO
        16 003617   201300 453500                    STP3    I+7,,AUTO
        16 003620   000100 237000 17                 LDAQ    64
        16 003621   201276 757100                    STAQ    I+5,,AUTO
        16 003622   201276 630500                    EPPR0   I+5,,AUTO
        16 003623   000063 631400 17                 EPPR1   51
        16 003624   000000 701000 xent               TSX1    VMM$COPY_MESSAGE_BODY
        16 003625   000000 011000                    NOP     0

     1895    14460    3       END;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:305  

     1896    14461    2       CALL VOM$ADDENTRY_SORTED (SCRATCH$, %NO#, TIME_HEAD$, DCBNUM(MAIL_OUT));

  14461 16 003626   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 003627   201272 756100                    STQ     I+1,,AUTO
        16 003630   201272 630500                    EPPR0   I+1,,AUTO
        16 003631   201277 450500                    STP0    I+6,,AUTO
        16 003632   000064 236000 17                 LDQ     52
        16 003633   201276 756100                    STQ     I+5,,AUTO
        16 003634   000006 236000 17                 LDQ     6
        16 003635   201275 756100                    STQ     I+4,,AUTO
        16 003636   201142 631500                    EPPR1   SCRATCH$,,AUTO
        16 003637   201274 451500                    STP1    I+3,,AUTO
        16 003640   201274 630500                    EPPR0   I+3,,AUTO
        16 003641   000027 631400 17                 EPPR1   23
        16 003642   000000 701000 xent               TSX1    VOM$ADDENTRY_SORTED
        16 003643   000000 011000                    NOP     0

     1897    14462    2       CALL M$CLOSE (CLOSE_MAIL_OUT) ALTRET (BAD_MAIL);

  14462 16 003644   000734 630400 11                 EPPR0   CLOSE_MAIL_OUT
        16 003645   450001 713400                    CLIMB   alt,close
        16 003646   406000 401760                    pmme    nvectors=13
        16 003647   003650 702000 16                 TSX2    BAD_MAIL

     1898    14463    2   BAD_MAIL:
     1899    14464    2       CALL REFRESH_INPUT_HEADER;

  14464 16 003650   002752 701000 16    BAD_MAIL     TSX1    REFRESH_INPUT_HEADER
        16 003651   000000 011000                    NOP     0

     1900    14465        /*
     1901    14466           If we just sent an ERR-with-body back to the sender, then set the FCOPY
     1902    14467           bit in the mailgram's header & rewrite it to the file, so that this doesn't
     1903    14468           happen more than once (per system).
     1904    14469        */
     1905    14470    2       IF SET_FCOPY_FLAG
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:306  

  14470 16 003652   201147 234100                    SZN     SET_FCOPY_FLAG,,AUTO
        16 003653   003671 605000 16                 TPL     s:14475

     1906    14471    3       THEN DO;

     1907    14472    3           VM_HEADER.STATUS.FCOPY = %YES#;

  14472 16 003654   000000 470400 xsym               LDP0    VM_HEADER$
        16 003655   000200 236003                    LDQ     128,DU
        16 003656   000012 256100                    ORSQ    10,,PR0

     1908    14473    3           CALL VMD$PUT_HEADER (0, DCBNUM(MAIL_IN));

  14473 16 003657   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 003660   201272 756100                    STQ     I+1,,AUTO
        16 003661   201272 631500                    EPPR1   I+1,,AUTO
        16 003662   201275 451500                    STP1    I+4,,AUTO
        16 003663   000006 236000 17                 LDQ     6
        16 003664   201274 756100                    STQ     I+3,,AUTO
        16 003665   201274 630500                    EPPR0   I+3,,AUTO
        16 003666   000000 631400 17                 EPPR1   0
        16 003667   000000 701000 xent               TSX1    VMD$PUT_HEADER
        16 003670   000000 011000                    NOP     0

     1909    14474    3       END;

     1910    14475    2   END RETURN_ERROR_MSG;

  14475 16 003671   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 003672   000001 702211                    TSX2  ! 1,X1

     1911    14476        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:307  
     1912    14477    1   CREATE_NEW_MAILGRAM: PROC (DCB#) ALTRET;

  14477 16 003673   201150 741300       CREATE_NEW_* STX1  ! @ONE+1,,AUTO

     1913    14478        /*I*  NAME:    CREATE_NEW_MAILGRAM
     1914    14479              CALL:    CALL CREATE_NEW_MAILGRAM (dcb#);
     1915    14480              DESCRIPTION: Opens a new, empty mailgram file through the specified DCB.
     1916    14481                       The name is generated via the standard time-based algorithm.
     1917    14482        */
     1918    14483
     1919    14484    2   DCL DCB# UBIN WORD;
     1920    14485
     1921    14486          %FPT_OPEN(FPTN=CREATE_SEND,ACS=DIRECT,
     1922    14487                    ASN=FILE,
     1923    14488                    ACCT=VM_MAIL_ACCT,
     1924    14489                    NAME=SEND_NAME,
     1925    14490                    SCRUB=YES,
     1926    14491                    ORG=KEYED,
     1927    14492                    FUN=CREATE,
     1928    14493                    EXIST=ERROR);
     1929    14602
     1930    14603          %VLP_NAME (FPTN=SEND_NAME,LEN=31,NAME='                         ');
     1931    14630
     1932    14631    2   DCL SEND_STRING CHAR (26);
     1933    14632
     1934    14633    2   MAKE_FILENAME:
     1935    14634    2       CALL M$TIME(GET_CURRENT);

  14634 16 003674   001300 630400 11    MAKE_FILENA* EPPR0   GET_CURRENT
        16 003675   020004 713400                    CLIMB   8196
        16 003676   402000 401760                    pmme    nvectors=5

     1936    14635    2       CALL BINCHAR(SEND_STRING, CURRENT_TIME);

  14635 16 003677   001657 235000 11                 LDA     CURRENT_TIME
        16 003700   000044 773000                    LRL     36
        16 003701   201272 757100                    STAQ    I+1,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:308  
        16 003702   000100 301500                    BTD
        16 003703   201272 000010                    NDSC9   I+1,,AUTO                cn=0,s=lsgnf,sf=0,n=8
        16 003704   201152 030032                    NDSC9   SEND_STRING,,AUTO        cn=0,s=nosgn,sf=0,n=26

     1937    14636    2       CALL CONCAT(SEND_NAME.NAME#,':MESS',SEND_STRING);

  14636 16 003705   040000 100400                    MLR     fill='040'O
        16 003706   000611 000005 12                 ADSC9   E_BADSITE+86             cn=0,n=5
        16 003707   001752 200005 11                 ADSC9   SEND_NAME                cn=1,n=5
        16 003710   040000 100500                    MLR     fill='040'O
        16 003711   201152 000032                    ADSC9   SEND_STRING,,AUTO        cn=0,n=26
        16 003712   001753 400032 11                 ADSC9   SEND_NAME+1              cn=2,n=26

     1938    14637    2       SEND_NAME.L# = SIZEC(SEND_NAME.NAME#);

  14637 16 003713   037000 236003                    LDQ     15872,DU
        16 003714   001752 552040 11                 STBQ    SEND_NAME,'40'O

     1939    14638    2       CREATE_SEND.V.DCB# = DCB#;

  14638 16 003715   201151 470500                    LDP0    @DCB#,,AUTO
        16 003716   000000 720100                    LXL0    0,,PR0
        16 003717   001724 740000 11                 STX0    CREATE_SEND+36

     1940    14639    2       CALL M$OPEN(CREATE_SEND)

  14639 16 003720   001660 630400 11                 EPPR0   CREATE_SEND
        16 003721   450000 713400                    CLIMB   alt,open
        16 003722   410400 401760                    pmme    nvectors=18
        16 003723   003725 702000 16                 TSX2    s:14641
        16 003724   003741 710000 16                 TRA     s:14649

     1941    14640    3       WHENALTRETURN DO;

     1942    14641    3           IF B$TCB.ALT$ -> B$ALT.ERR.ERR# = %E$CREATERR

  14641 16 003725   000000 470400 xsym               LDP0    B$TCB$
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:309  
        16 003726   000000 471500                    LDP1    0,,PR0
        16 003727   100102 236100                    LDQ     66,,PR1
        16 003730   377770 376007                    ANQ     131064,DL
        16 003731   001560 116007                    CMPQ    880,DL
        16 003732   003737 601000 16                 TNZ     s:14646

     1943    14642    4           THEN DO;

     1944    14643    4               CALL M$WAIT (WAIT2);

  14643 16 003733   000274 630400 12                 EPPR0   WAIT2
        16 003734   020006 713400                    CLIMB   8198
        16 003735   400400 401760                    pmme    nvectors=2

     1945    14644    4               GOTO MAKE_FILENAME;

  14644 16 003736   003674 710000 16                 TRA     MAKE_FILENAME

     1946    14645    4           END;
     1947    14646    3           ALTRETURN;

  14646 16 003737   201150 221300                    LDX1  ! @ONE+1,,AUTO
        16 003740   000000 702211                    TSX2  ! 0,X1

     1948    14647    3       END;
     1949    14648
     1950    14649    2       RETURN;

  14649 16 003741   201150 221300                    LDX1  ! @ONE+1,,AUTO
        16 003742   000001 702211                    TSX2  ! 1,X1

     1951    14650
     1952    14651    2   END CREATE_NEW_MAILGRAM;
     1953    14652        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:310  
     1954    14653    1   CONSTRUCT_RETURN_ADDRESS: PROC (BUFFER, BUFSIZE, ADDRESS) ALTRET;

  14653 16 003743   201150 741300       CONSTRUCT_R* STX1  ! @ONE+1,,AUTO

     1955    14654
     1956    14655        /*I*  NAME: CONSTRUCT_RETURN_ADDRESS
     1957    14656              CALL: CALL CONSTRUCT_RETURN_ADDRESS (buffer, buffer_size, address)
     1958    14657                          ALTRET (not_enough_space);
     1959    14658              INPUT: "buffer" is a scratch memory area;
     1960    14659                     "buffer_size" is the LENGTHW(buffer);
     1961    14660                     "address" is a VM_RADDRESS structure containing a valid mail
     1962    14661                          address.
     1963    14662              OUTPUT:  BUFFER will contain an address structure that can be written
     1964    14663                          to a mailgram as a "TO", "C", or "BC" record.
     1965    14664              DESCRIPTION: This proc may be used to encapsulate a VM_RADDRESS structure
     1966    14665                          with the necessary VM_ADD_HEAD structure in an arbitrary
     1967    14666                          buffer in memory.  Pointers placed within the structures
     1968    14667                          reflect the assumption that the resulting structure will be
     1969    14668                          read into the segment currently allocated in VM_ADDREC_.
     1970    14669        */
     1971    14670
     1972    14671    2   DCL BUFFER (0:0) UBIN WORD;
     1973    14672    2   DCL BUFSIZE UBIN WORD;
     1974    14673        %VM_RADDRESS (NAME=ADDRESS, STCLASS=PARAM);
     1975    14708
     1976    14709        %VM_RADDRESS (NAME=VM_RADDRESS, STCLASS=BASED);
     1977    14744        %VM_ADD_HEAD (NAME=VM_ADD_HEAD, STCLASS=BASED);
     1978    14773        %VM_ADD_HEAD (NAME=INIT_ADD_HEAD, STCLASS=CONSTANT);
     1979    14802
     1980    14803    2   DCL REAL_HEAD$ PTR;
     1981    14804    2   DCL FAKE_HEAD$ PTR;
     1982    14805    2   DCL REAL_ADDRESS$ PTR;
     1983    14806    2   DCL FAKE_ADDRESS$ PTR;
     1984    14807    2   DCL BLOCKSIZE UBIN WORD BASED;
     1985    14808
     1986    14809    2       IF BUFSIZE < SIZEW(VM_RADDRESS) + SIZEW(VM_ADD_HEAD) + 5

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:311  
  14809 16 003744   201152 470500                    LDP0    @BUFSIZE,,AUTO
        16 003745   000000 235100                    LDA     0,,PR0
        16 003746   000040 115007                    CMPA    32,DL
        16 003747   003751 603000 16                 TRC     s:14813

     1987    14810    2       THEN
     1988    14811    2           ALTRETURN;

  14811 16 003750   000000 702211                    TSX2  ! 0,X1

     1989    14812
     1990    14813    2       REAL_HEAD$ = ADDR(BUFFER);

  14813 16 003751   201151 236100                    LDQ     @BUFFER,,AUTO
        16 003752   201154 756100                    STQ     REAL_HEAD$,,AUTO

     1991    14814    2       FAKE_HEAD$ = VBASE(VM_ADDREC_);

  14814 16 003753   000001 236000 xsym               LDQ     VM_ADDREC_+1
        16 003754   201155 756100                    STQ     FAKE_HEAD$,,AUTO

     1992    14815
     1993    14816    2       REAL_ADDRESS$ = PINCRW(REAL_HEAD$, SIZEW(VM_ADD_HEAD));

  14816 16 003755   201154 236100                    LDQ     REAL_HEAD$,,AUTO
        16 003756   000007 036003                    ADLQ    7,DU
        16 003757   201156 756100                    STQ     REAL_ADDRESS$,,AUTO

     1994    14817    2       FAKE_ADDRESS$ = PINCRW(FAKE_HEAD$, SIZEW(VM_ADD_HEAD));

  14817 16 003760   201155 236100                    LDQ     FAKE_HEAD$,,AUTO
        16 003761   000007 036003                    ADLQ    7,DU
        16 003762   201157 756100                    STQ     FAKE_ADDRESS$,,AUTO

     1995    14818
     1996    14819    2       REAL_HEAD$ -> VM_ADD_HEAD = INIT_ADD_HEAD;

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:312  
  14819 16 003763   201154 471500                    LDP1    REAL_HEAD$,,AUTO
        16 003764   000100 100400                    MLR     fill='000'O
        16 003765   000362 000034 12                 ADSC9   INIT_ADD_HEAD            cn=0,n=28
        16 003766   100000 000034                    ADSC9   0,,PR1                   cn=0,n=28

     1997    14820    2       REAL_HEAD$ -> VM_ADD_HEAD.NUM_ENTRIES = 1;

  14820 16 003767   000001 235007                    LDA     1,DL
        16 003770   100001 755100                    STA     1,,PR1

     1998    14821    2       REAL_HEAD$ -> VM_ADD_HEAD.HEAD$ = FAKE_ADDRESS$;

  14821 16 003771   100003 756100                    STQ     3,,PR1

     1999    14822    2       REAL_HEAD$ -> VM_ADD_HEAD.NEXT$ = PINCRW(FAKE_ADDRESS$, SIZEW(VM_RADDRESS));

  14822 16 003772   000024 036003                    ADLQ    20,DU
        16 003773   100005 756100                    STQ     5,,PR1

     2000    14823    2       REAL_HEAD$ -> VM_ADD_HEAD.ADDRESS_SIZE = SIZEW(VM_RADDRESS) +

  14823 16 003774   000040 235007                    LDA     32,DL
        16 003775   100000 755100                    STA     0,,PR1

     2001    14824    2         SIZEW(VM_ADD_HEAD) + 5;
     2002    14825
     2003    14826    2       PINCRW(REAL_ADDRESS$, -1) -> BLOCKSIZE = SIZEW(VM_RADDRESS);

  14826 16 003776   000024 235007                    LDA     20,DL
        16 003777   201156 473500                    LDP3    REAL_ADDRESS$,,AUTO
        16 004000   377777 755100                    STA     -1,,PR3

     2004    14827
     2005    14828    2       REAL_ADDRESS$ -> VM_RADDRESS = ADDRESS;

  14828 16 004001   201153 474500                    LDP4    @ADDRESS,,AUTO
        16 004002   000100 100500                    MLR     fill='000'O
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:313  
        16 004003   400000 000117                    ADSC9   0,,PR4                   cn=0,n=79
        16 004004   300000 000117                    ADSC9   0,,PR3                   cn=0,n=79

     2006    14829    2       REAL_ADDRESS$ -> VM_RADDRESS.NEXT$ = ADDR(NIL);

  14829 16 004005   000004 236000 17                 LDQ     4
        16 004006   300000 756100                    STQ     0,,PR3

     2007    14830    2       REAL_ADDRESS$ -> VM_RADDRESS.PREV$ = ADDR(NIL);

  14830 16 004007   000004 236000 17                 LDQ     4
        16 004010   300001 756100                    STQ     1,,PR3

     2008    14831
     2009    14832    2       RETURN;

  14832 16 004011   201150 221300                    LDX1  ! @ONE+1,,AUTO
        16 004012   000001 702211                    TSX2  ! 1,X1

     2010    14833
     2011    14834    2   END CONSTRUCT_RETURN_ADDRESS;
     2012    14835        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:314  
     2013    14836    1   ENQ_ON_PROFILE: PROC ALTRET;

  14836 16 004013   201270 741300       ENQ_ON_PROF* STX1  ! SITENAME+71,,AUTO

     2014    14837
     2015    14838                            /* Enq the profile.  Time out every two seconds to look for
     2016    14839                               comgroup activity.  If 10 seconds elapse, assume that the
     2017    14840                               mailbox is somehow being locked out by a malicious
     2018    14841                               (or disconnected) user; altreturn.
     2019    14842                            */
     2020    14843
     2021    14844    2   DCL I SBIN;
     2022    14845
     2023    14846    2       I = 10;

  14846 16 004014   000012 235007                    LDA     10,DL
        16 004015   201271 755100                    STA     I,,AUTO

     2024    14847    3       DO UNTIL I <= 0;

     2025    14848    3           CALL M$ENQ (ENQ_PROFILE)

  14848 16 004016   000302 630400 12                 EPPR0   ENQ_PROFILE
        16 004017   420002 713400                    CLIMB   alt,+8194
        16 004020   401000 401760                    pmme    nvectors=3
        16 004021   004024 702000 16                 TSX2    s:14853

     2026    14849    4           WHENRETURN DO;

     2027    14850    4               RETURN;

  14850 16 004022   201270 221300                    LDX1  ! SITENAME+71,,AUTO
        16 004023   000001 702211                    TSX2  ! 1,X1

     2028    14851    4           END;
     2029    14852    4           WHENALTRETURN DO;

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:315  
     2030    14853    4               ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  14853 16 004024   000000 470400 xsym               LDP0    B$TCB$
        16 004025   000000 471500                    LDP1    0,,PR0
        16 004026   100102 236100                    LDQ     66,,PR1
        16 004027   001076 756000 11                 STQ     ERROR

     2031    14854    4               IF ERROR.ERR# ~= %E$TIMELIMIT

  14854 16 004030   001076 236000 11                 LDQ     ERROR
        16 004031   377770 376007                    ANQ     131064,DL
        16 004032   014420 116007                    CMPQ    6416,DL
        16 004033   004037 600000 16                 TZE     s:14858

     2032    14855    4               THEN
     2033    14856    4                   CALL M$ERR;     /* Should never happen */

  14856 16 004034   000002 713400                    CLIMB   err
        16 004035   000000 401760                    pmme    nvectors=0
        16 004036   004052 710000 16                 TRA     s:14867

     2034    14857    5               ELSE DO;

     2035    14858    5                   IF VO_NEED_READ

  14858 16 004037   000000 234000 xsym               SZN     VO_NEED_READ
        16 004040   004045 605000 16                 TPL     s:14863

     2036    14859    6                   THEN DO;

     2037    14860    6                       VO_NEED_READ = '0'B;

  14860 16 004041   000000 450000 xsym               STZ     VO_NEED_READ

     2038    14861    6                       CALL M$READ (VO_READ_CG);

  14861 16 004042   000000 630400 xsym               EPPR0   VO_READ_CG
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:316  
        16 004043   040000 713400                    CLIMB   read
        16 004044   401400 401760                    pmme    nvectors=4

     2039    14862    6                   END;

     2040    14863    5                   IF VO_PROCESS

  14863 16 004045   000000 234000 xsym               SZN     VO_PROCESS
        16 004046   004052 605000 16                 TPL     s:14867

     2041    14864    5                   THEN
     2042    14865    5                       CALL VOM$PROCESS;

  14865 16 004047   000002 631400 17                 EPPR1   2
        16 004050   000000 701000 xent               TSX1    VOM$PROCESS
        16 004051   000000 011000                    NOP     0

     2043    14866    5               END;

     2044    14867    4               I = I - 2;

  14867 16 004052   000002 336007                    LCQ     2,DL
        16 004053   201271 056100                    ASQ     I,,AUTO

     2045    14868    4           END;

     2046    14869    3       END;

  14869 16 004054   004016 605400 16                 TPNZ    s:14848

     2047    14870    2       ALTRETURN;

  14870 16 004055   201270 221300                    LDX1  ! SITENAME+71,,AUTO
        16 004056   000000 702211                    TSX2  ! 0,X1

     2048    14871    2   END ENQ_ON_PROFILE;
     2049    14872        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:317  
     2050    14873    1   QUEUE_INTERSYS: PROC ALTRET;

  14873 16 004057   201146 741300       QUEUE_INTER* STX1  ! DELIVERY_SUMMARY+2,,AUTO

     2051    14874
     2052    14875    2       IF NOT VO_INTERSYS_ALLOWED

  14875 16 004060   000000 234000 xsym               SZN     VO_INTERSYS_ALLOWED
        16 004061   004065 604000 16                 TMI     s:14881

     2053    14876    3       THEN DO;

     2054    14877    3           ERROR = E_INTERSYSILL;

  14877 16 004062   000350 236000 12                 LDQ     E_INTERSYSILL
        16 004063   001076 756000 11                 STQ     ERROR

     2055    14878    3           ALTRETURN;

  14878 16 004064   000000 702211                    TSX2  ! 0,X1

     2056    14879    3       END;
     2057    14880
     2058    14881    2       CALL BUILD_INTERSYS_LIST

  14881 16 004065   006311 701000 16                 TSX1    BUILD_INTERSYS_LIST
        16 004066   004070 702000 16                 TSX2    s:14883
        16 004067   004072 710000 16                 TRA     s:14886

     2059    14882    3       WHENALTRETURN DO;

     2060    14883    3           ALTRETURN;

  14883 16 004070   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 004071   000000 702211                    TSX2  ! 0,X1

     2061    14884    3       END;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:318  
     2062    14885
     2063    14886    2       RETURN;

  14886 16 004072   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 004073   000001 702211                    TSX2  ! 1,X1

     2064    14887
     2065    14888    2   END QUEUE_INTERSYS;
     2066    14889
     2067    14890        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:319  
     2068    14891    1   VOM$SENDIT: PROC ALTRET;

  14891 16 004074   201146 741300       VOM$SENDIT   STX1  ! DELIVERY_SUMMARY+2,,AUTO

     2069    14892    2   DCL DLOCK_SEND BIT(1);
     2070    14893
     2071    14894
     2072    14895    2   DCL TYPE SBIN;
     2073    14896    2   DCL I SBIN WORD;
     2074    14897    2   DCL J SBIN WORD;
     2075    14898    2   DCL FORWARD BIT (1);
     2076    14899    2   DCL ANOTHER_USER BIT(1) ALIGNED;
     2077    14900    2   DCL COMBINED BIT (1);
     2078    14901    2   DCL SEND_CURR$ PTR ALIGNED;
     2079    14902    2   DCL TIME_CURR$ PTR ALIGNED;
     2080    14903    2   DCL SAVED_FLAGS BIT (36);
     2081    14904        /***** External routines *****/
     2082    14905    2   DCL VMA$GET_ADD_RECORD ENTRY(4) ALTRET;
     2083    14906    2   DCL VMA$PUT_ADD_RECORD ENTRY(4) ALTRET;
     2084    14907    2   DCL VMA$OPEN_FOLDER   ENTRY(5) ALTRET;
     2085    14908    2   DCL VMD$GET_PROFILE   ENTRY(1) ALTRET;
     2086    14909    2   DCL VMD$PUT_PROFILE   ENTRY(1) ALTRET;
     2087    14910    2   DCL VMD$PUT_HEADER ENTRY(2) ALTRET;
     2088    14911    2   DCL VMM$COPY_MESSAGE ENTRY(6) ALTRET;
     2089    14912        %FPT_WRITE(FPTN=WRITE_MAILCG,STCLASS="SYMREF",
     2090    14913                   BUF=VM_CGBUFFER);
     2091    14944
     2092    14945        %FPT_CLOSE (FPTN=CLOSE_MAIL_FILECOPY,
     2093    14946                    STCLASS=CONSTANT,
     2094    14947                    DCB=MAIL_FILECOPY,
     2095    14948                    DISP=SAVE);
     2096    14990
     2097    14991        %VM_FOLDER_INFO (NAME=FILE_FOLDER_INFO, STCLASS=AUTO);
     2098    15043
     2099    15044    2       CALL M$TIME(GET_CURRENT);

  15044 16 004075   001300 630400 11                 EPPR0   GET_CURRENT
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:320  
        16 004076   020004 713400                    CLIMB   8196
        16 004077   402000 401760                    pmme    nvectors=5

     2100    15045
     2101    15046    2       TIME_CURR$ = TIME$;

  15046 16 004100   000000 236000 xsym               LDQ     TIME$
        16 004101   201157 756100                    STQ     TIME_CURR$,,AUTO

  15046 16 004102                       GO_ON        null
     2102    15047        /*
     2103    15048             ***** Deliver the message ...
     2104    15049        */
     2105    15050    2   GO_ON:;
     2106    15051    2       VM_FOLDER_INFO.FLAGS = %NO#;

  15051 16 004102   000415 450000 11                 STZ     VM_FOLDER_INFO+19

     2107    15052    2       CALL VMA$OPEN_FOLDER (VM_FOLDER_INFO,ADDR(VM_RADDRESS),DCBNUM(MAIL_OUT),

  15052 16 004103   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 004104   201273 756100                    STQ     I+2,,AUTO
        16 004105   000015 236000 17                 LDQ     13
        16 004106   201272 756100                    STQ     I+1,,AUTO
        16 004107   201273 235100                    LDA     I+2,,AUTO
        16 004110   201274 755100                    STA     I+3,,AUTO
        16 004111   000050 237000 17                 LDAQ    40
        16 004112   201300 757100                    STAQ    I+7,,AUTO
        16 004113   201274 630500                    EPPR0   I+3,,AUTO
        16 004114   201277 450500                    STP0    I+6,,AUTO
        16 004115   201272 631500                    EPPR1   I+1,,AUTO
        16 004116   201276 451500                    STP1    I+5,,AUTO
        16 004117   000047 236000 17                 LDQ     39
        16 004120   201275 756100                    STQ     I+4,,AUTO
        16 004121   201275 630500                    EPPR0   I+4,,AUTO
        16 004122   000044 631400 17                 EPPR1   36
        16 004123   000000 701000 xent               TSX1    VMA$OPEN_FOLDER
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:321  
        16 004124   004126 702000 16                 TSX2    s:15055
        16 004125   004300 710000 16                 TRA     s:15071

     2108    15053    2         %OLDFILE#,%UPDATE#)
     2109    15054    3       WHENALTRETURN DO;

     2110    15055    3           ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  15055 16 004126   000000 470400 xsym               LDP0    B$TCB$
        16 004127   000000 471500                    LDP1    0,,PR0
        16 004130   100102 236100                    LDQ     66,,PR1
        16 004131   001076 756000 11                 STQ     ERROR

     2111    15056    4           DO SELECT (ERROR.ERR#);

  15056 16 004132   001076 236000 11                 LDQ     ERROR
        16 004133   000003 772000                    QRL     3
        16 004134   037777 376007                    ANQ     16383,DL
        16 004135   000061 116007                    CMPQ    49,DL
        16 004136   004224 602000 16                 TNC     s:15056+58
        16 004137   004271 600000 16                 TZE     s:15065
        16 004140   000155 116007                    CMPQ    109,DL
        16 004141   004175 602000 16                 TNC     s:15056+35
        16 004142   004266 600000 16                 TZE     s:15061
        16 004143   000221 116007                    CMPQ    145,DL
        16 004144   004156 602000 16                 TNC     s:15056+20
        16 004145   004271 600000 16                 TZE     s:15065
        16 004146   000257 116007                    CMPQ    175,DL
        16 004147   004152 602000 16                 TNC     s:15056+16
        16 004150   004271 600000 16                 TZE     s:15065
        16 004151   004274 710000 16                 TRA     s:15067
        16 004152   000003 736000                    QLS     3
        16 004153   002220 116007                    CMPQ    1168,DL
        16 004154   004274 601000 16                 TNZ     s:15067
        16 004155   004271 710000 16                 TRA     s:15065
        16 004156   001076 236000 11                 LDQ     ERROR
        16 004157   000003 772000                    QRL     3
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:322  
        16 004160   037777 376007                    ANQ     16383,DL
        16 004161   000217 116007                    CMPQ    143,DL
        16 004162   004170 602000 16                 TNC     s:15056+30
        16 004163   004271 600000 16                 TZE     s:15065
        16 004164   000003 736000                    QLS     3
        16 004165   002200 116007                    CMPQ    1152,DL
        16 004166   004274 601000 16                 TNZ     s:15067
        16 004167   004271 710000 16                 TRA     s:15065
        16 004170   001076 236000 11                 LDQ     ERROR
        16 004171   377770 376007                    ANQ     131064,DL
        16 004172   001610 116007                    CMPQ    904,DL
        16 004173   004274 601000 16                 TNZ     s:15067
        16 004174   004261 710000 16                 TRA     s:15058
        16 004175   001076 236000 11                 LDQ     ERROR
        16 004176   000003 772000                    QRL     3
        16 004177   037777 376007                    ANQ     16383,DL
        16 004200   000063 116007                    CMPQ    51,DL
        16 004201   004217 602000 16                 TNC     s:15056+53
        16 004202   004271 600000 16                 TZE     s:15065
        16 004203   000152 116007                    CMPQ    106,DL
        16 004204   004212 602000 16                 TNC     s:15056+48
        16 004205   004271 600000 16                 TZE     s:15065
        16 004206   000003 736000                    QLS     3
        16 004207   001530 116007                    CMPQ    856,DL
        16 004210   004274 601000 16                 TNZ     s:15067
        16 004211   004271 710000 16                 TRA     s:15065
        16 004212   001076 236000 11                 LDQ     ERROR
        16 004213   377770 376007                    ANQ     131064,DL
        16 004214   000640 116007                    CMPQ    416,DL
        16 004215   004274 601000 16                 TNZ     s:15067
        16 004216   004271 710000 16                 TRA     s:15065
        16 004217   001076 236000 11                 LDQ     ERROR
        16 004220   377770 376007                    ANQ     131064,DL
        16 004221   000620 116007                    CMPQ    400,DL
        16 004222   004274 601000 16                 TNZ     s:15067
        16 004223   004271 710000 16                 TRA     s:15065
        16 004224   001076 236000 11                 LDQ     ERROR
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:323  
        16 004225   000003 772000                    QRL     3
        16 004226   037777 376007                    ANQ     16383,DL
        16 004227   000053 116007                    CMPQ    43,DL
        16 004230   004246 602000 16                 TNC     s:15056+76
        16 004231   004271 600000 16                 TZE     s:15065
        16 004232   000055 116007                    CMPQ    45,DL
        16 004233   004241 602000 16                 TNC     s:15056+71
        16 004234   004271 600000 16                 TZE     s:15065
        16 004235   000003 736000                    QLS     3
        16 004236   000600 116007                    CMPQ    384,DL
        16 004237   004274 601000 16                 TNZ     s:15067
        16 004240   004271 710000 16                 TRA     s:15065
        16 004241   001076 236000 11                 LDQ     ERROR
        16 004242   377770 376007                    ANQ     131064,DL
        16 004243   000540 116007                    CMPQ    352,DL
        16 004244   004274 601000 16                 TNZ     s:15067
        16 004245   004271 710000 16                 TRA     s:15065
        16 004246   001076 236000 11                 LDQ     ERROR
        16 004247   000003 772000                    QRL     3
        16 004250   037777 376007                    ANQ     16383,DL
        16 004251   000052 116007                    CMPQ    42,DL
        16 004252   004255 602000 16                 TNC     s:15056+83
        16 004253   004271 600000 16                 TZE     s:15065
        16 004254   004274 710000 16                 TRA     s:15067
        16 004255   000003 736000                    QLS     3
        16 004256   000510 116007                    CMPQ    328,DL
        16 004257   004274 601000 16                 TNZ     s:15067
        16 004260   004271 710000 16                 TRA     s:15065

     2112    15057    4               SELECT (%E$NOFILE);

     2113    15058    4               ERROR = E_NOMID;

  15058 16 004261   000351 236000 12                 LDQ     E_NOMID
        16 004262   001076 756000 11                 STQ     ERROR

     2114    15059    4               UNDELIVERED.IO_ERROR = %YES#;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:324  

  15059 16 004263   100000 236003                    LDQ     32768,DU
        16 004264   201143 256100                    ORSQ    UNDELIVERED,,AUTO
        16 004265   004276 710000 16                 TRA     s:15069

     2115    15060    4               SELECT (%E$FILEBUSY);

     2116    15061    4               UNDELIVERED.BUSY = %YES#;

  15061 16 004266   400000 236003                    LDQ     -131072,DU
        16 004267   201143 256100                    ORSQ    UNDELIVERED,,AUTO
        16 004270   004276 710000 16                 TRA     s:15069

     2117    15062    4               SELECT (%E$FD, %E$FDIO, %E$PAD, %E$PADIO, %E$FIT, %E$FITIO, %E$BADFIT,

     2118    15063    4                 %E$GP, %E$GPIO, %E$MAD, %E$MADIO, %E$NONEWU, %E$BADVOL,
     2119    15064    4                 %E$XCLSET, %E$SETDOWN, %E$DUPSN, %E$SPLITRES);
     2120    15065    4               UNDELIVERED.PACKSET_NA = %YES#;

  15065 16 004271   200000 236003                    LDQ     65536,DU
        16 004272   201143 256100                    ORSQ    UNDELIVERED,,AUTO
        16 004273   004276 710000 16                 TRA     s:15069

     2121    15066    4               SELECT (ELSE);

     2122    15067    4           UNDELIVERED.IO_ERROR = %YES#;

  15067 16 004274   100000 236003                    LDQ     32768,DU
        16 004275   201143 256100                    ORSQ    UNDELIVERED,,AUTO

     2123    15068    4           END;

     2124    15069    3       ALTRETURN;

  15069 16 004276   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 004277   000000 702211                    TSX2  ! 0,X1

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:325  
     2125    15070    3       END;
     2126    15071    2       CALL ENQ_ON_PROFILE

  15071 16 004300   004013 701000 16                 TSX1    ENQ_ON_PROFILE
        16 004301   004303 702000 16                 TSX2    s:15073
        16 004302   004314 710000 16                 TRA     s:15077

     2127    15072    3       WHENALTRETURN DO;

     2128    15073    4           CALL M$CLOSE (CLOSE_MAIL_OUT) WHENALTRETURN DO; END;

  15073 16 004303   000734 630400 11                 EPPR0   CLOSE_MAIL_OUT
        16 004304   450001 713400                    CLIMB   alt,close
        16 004305   406000 401760                    pmme    nvectors=13
        16 004306   004310 702000 16                 TSX2    s:15074
        16 004307   004310 710000 16                 TRA     s:15074

     2129    15074    3           UNDELIVERED.BUSY = %YES#;

  15074 16 004310   400000 236003                    LDQ     -131072,DU
        16 004311   201143 256100                    ORSQ    UNDELIVERED,,AUTO

     2130    15075    3           ALTRETURN;

  15075 16 004312   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 004313   000000 702211                    TSX2  ! 0,X1

     2131    15076    3       END;
     2132    15077    2       CALL VMD$GET_PROFILE(DCBNUM(MAIL_OUT))

  15077 16 004314   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 004315   201272 756100                    STQ     I+1,,AUTO
        16 004316   201272 630500                    EPPR0   I+1,,AUTO
        16 004317   201273 450500                    STP0    I+2,,AUTO
        16 004320   201273 630500                    EPPR0   I+2,,AUTO
        16 004321   000025 631400 17                 EPPR1   21
        16 004322   000000 701000 xent               TSX1    VMD$GET_PROFILE
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:326  
        16 004323   004325 702000 16                 TSX2    s:15079
        16 004324   004330 710000 16                 TRA     s:15085

     2133    15078    3       WHENALTRETURN DO;

     2134    15079    3           ERROR = E_PROERR;

  15079 16 004325   000353 236000 12                 LDQ     E_PROERR
        16 004326   001076 756000 11                 STQ     ERROR

     2135    15080    3           GOTO ERROR_RETURN;

  15080 16 004327   005274 710000 16                 TRA     ERROR_RETURN

     2136    15081    3       END;
     2137    15082        /*
     2138    15083              ***** Try combining this mailgram with another one.
     2139    15084        */
     2140    15085    2       IF (VM_HEADER.STATUS.ACK OR VM_HEADER.STATUS.ANSWER OR VM_HEADER.STATUS.RRACK

  15085 16 004330   000000 470400 xsym               LDP0    VM_HEADER$
        16 004331   000012 236100                    LDQ     10,,PR0
        16 004332   100000 316003                    CANQ    32768,DU
        16 004333   004344 601000 16                 TNZ     s:15085+12
        16 004334   200000 316003                    CANQ    65536,DU
        16 004335   004344 601000 16                 TNZ     s:15085+12
        16 004336   020000 316007                    CANQ    8192,DL
        16 004337   004344 601000 16                 TNZ     s:15085+12
        16 004340   000012 234100                    SZN     10,,PR0
        16 004341   004344 604000 16                 TMI     s:15085+12
        16 004342   000002 316003                    CANQ    2,DU
        16 004343   004635 600000 16                 TZE     USER_OK
        16 004344   000033 236100                    LDQ     27,,PR0
        16 004345   000004 116000 17                 CMPQ    4
        16 004346   004635 600000 16                 TZE     USER_OK

     2141    15086    2         OR VM_HEADER.STATUS.ERR OR VM_HEADER.STATUS.DELIVERY)
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:327  
     2142    15087    2         AND VM_HEADER.REFERS_TO_ID$ ~= ADDR(NIL)
     2143    15088    2       THEN
     2144    15089    3   UPDATE_ORIGINAL: DO;

  15089 16 004347                       UPDATE_ORIG* null
     2145    15090    3           SAVED_FLAGS = VM_HEADER.STATUS;

  15090 16 004347   000012 236100                    LDQ     10,,PR0
        16 004350   201160 756100                    STQ     SAVED_FLAGS,,AUTO

     2146    15091    3           COMBINED = %NO#;

  15091 16 004351   201155 450100                    STZ     COMBINED,,AUTO

     2147    15092        /*
     2148    15093           This folder may have a separate file folder associated with it.
     2149    15094           If so, then a copy of the original message (referred to by the one
     2150    15095           currently being delivered) might exist in the file folder as well as
     2151    15096           in this folder.  The file-folder copy must be updated.
     2152    15097        */
     2153    15098    3           IF VM_PROFILE.FILE_FOLDER$ ~= ADDR(NIL)

  15098 16 004352   000000 471400 xsym               LDP1    VM_PROFILE$
        16 004353   100114 236100                    LDQ     76,,PR1
        16 004354   000004 116000 17                 CMPQ    4
        16 004355   004544 600000 16                 TZE     s:15130
        16 004356   100114 473500                    LDP3    76,,PR1
        16 004357   000000 106500                    CMPC    fill='000'O
        16 004360   300000 000117                    ADSC9   0,,PR3                   cn=0,n=79
        16 004361   000216 000117 11                 ADSC9   VM_RADDRESS              cn=0,n=79
        16 004362   004544 600000 16                 TZE     s:15130

     2154    15099    3             AND VM_PROFILE.FILE_FOLDER$ -> VM$RADDRESS ~= VM_RADDRESS
     2155    15100    3           THEN
     2156    15101    4   UPDATE_FILE_COPY: DO;

  15101 16 004363                       UPDATE_FILE* null
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:328  
     2157    15102    4               FILE_FOLDER_INFO.FLAGS = '0'B;

  15102 16 004363   201204 450100                    STZ     SITENAME+19,,AUTO

     2158    15103    4               CALL VMA$OPEN_FOLDER (FILE_FOLDER_INFO,VM_PROFILE.FILE_FOLDER$,

  15103 16 004364   000000 236007 xsym               LDQ     MAIL_FILECOPY,DL
        16 004365   201272 756100                    STQ     I+1,,AUTO
        16 004366   000050 237000 17                 LDAQ    40
        16 004367   201276 757100                    STAQ    I+5,,AUTO
        16 004370   201272 633500                    EPPR3   I+1,,AUTO
        16 004371   201275 453500                    STP3    I+4,,AUTO
        16 004372   000000 236000 xsym               LDQ     VM_PROFILE$
        16 004373   000114 036003                    ADLQ    76,DU
        16 004374   201274 756100                    STQ     I+3,,AUTO
        16 004375   201161 634500                    EPPR4   FILE_FOLDER_INFO,,AUTO
        16 004376   201273 454500                    STP4    I+2,,AUTO
        16 004377   201273 630500                    EPPR0   I+2,,AUTO
        16 004400   000044 631400 17                 EPPR1   36
        16 004401   000000 701000 xent               TSX1    VMA$OPEN_FOLDER
        16 004402   004404 702000 16                 TSX2    s:15106
        16 004403   004471 710000 16                 TRA     s:15117

     2159    15104    4                 DCBNUM(MAIL_FILECOPY), %OLDFILE#,%UPDATE#)
     2160    15105    5               WHENALTRETURN DO;

     2161    15106    5                  CALL XUD$UTS_DIFF_25TH (UTS_X, CURRENT_TIME,VM_HEADER.FIRST_DELIVERY
             15106                            );

  15106 16 004404   000000 236000 xsym               LDQ     VM_HEADER$
        16 004405   000003 036003                    ADLQ    3,DU
        16 004406   201274 756100                    STQ     I+3,,AUTO
        16 004407   000052 236000 17                 LDQ     42
        16 004410   201273 756100                    STQ     I+2,,AUTO
        16 004411   201140 630500                    EPPR0   UTS_X,,AUTO
        16 004412   201272 450500                    STP0    I+1,,AUTO
        16 004413   201272 630500                    EPPR0   I+1,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:329  
        16 004414   000007 631400 17                 EPPR1   7
        16 004415   000000 701000 xent               TSX1    XUD$UTS_DIFF_25TH
        16 004416   000000 011000                    NOP     0

     2162    15107    5                   UTS_X = UTS_X/%UTS_25TH_HOUR#;

  15107 16 004417   201140 236100                    LDQ     UTS_X,,AUTO
        16 004420   257620 506007                    DIV     90000,DL
        16 004421   201140 756100                    STQ     UTS_X,,AUTO

     2163    15108    5                   CALL XUD$UTS_ADJ_25TH (UTS_Y, VO_MAILMAN_STARTUP_TIME, %
             15108                            UTS_25TH_HOUR#);

  15108 16 004422   000054 236000 17                 LDQ     44
        16 004423   201274 756100                    STQ     I+3,,AUTO
        16 004424   000055 236000 17                 LDQ     45
        16 004425   201273 756100                    STQ     I+2,,AUTO
        16 004426   201141 630500                    EPPR0   UTS_Y,,AUTO
        16 004427   201272 450500                    STP0    I+1,,AUTO
        16 004430   201272 630500                    EPPR0   I+1,,AUTO
        16 004431   000007 631400 17                 EPPR1   7
        16 004432   000000 701000 xent               TSX1    XUD$UTS_ADJ_25TH
        16 004433   000000 011000                    NOP     0

     2164    15109    5                  IF B$TCB.ALT$ -> B$ALT.ERR.ERR# = %E$FILEBUSY AND (UTS_X < MAXIMUM (
             15109                            VO_MAX_HOLD_HOURS / 2, 1) OR CURRENT_TIME < UTS_Y)

  15109 16 004434   000000 470400 xsym               LDP0    B$TCB$
        16 004435   000000 471500                    LDP1    0,,PR0
        16 004436   100102 236100                    LDQ     66,,PR1
        16 004437   377770 376007                    ANQ     131064,DL
        16 004440   001550 116007                    CMPQ    872,DL
        16 004441   004470 601000 16                 TNZ     s:15115
        16 004442   000000 236000 xsym               LDQ     VO_MAX_HOLD_HOURS
        16 004443   000001 772000                    QRL     1
        16 004444   000001 116007                    CMPQ    1,DL
        16 004445   004447 603000 16                 TRC     s:15109+11
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:330  
        16 004446   000001 236007                    LDQ     1,DL
        16 004447   000000 116003                    CMPQ    0,DU
        16 004450   004457 604000 16                 TMI     s:15111
        16 004451   201140 116100                    CMPQ    UTS_X,,AUTO
        16 004452   004457 605400 16                 TPNZ    s:15111
        16 004453   001657 236000 11                 LDQ     CURRENT_TIME
        16 004454   004470 604000 16                 TMI     s:15115
        16 004455   201141 116100                    CMPQ    UTS_Y,,AUTO
        16 004456   004470 605000 16                 TPL     s:15115

     2165    15110    6                   THEN DO;

     2166    15111    6                       UNDELIVERED.BUSY = %YES#;

  15111 16 004457   400000 236003                    LDQ     -131072,DU
        16 004460   201143 256100                    ORSQ    UNDELIVERED,,AUTO

     2167    15112    7                       CALL M$CLOSE (CLOSE_MAIL_OUT) WHENALTRETURN DO; END;

  15112 16 004461   000734 630400 11                 EPPR0   CLOSE_MAIL_OUT
        16 004462   450001 713400                    CLIMB   alt,close
        16 004463   406000 401760                    pmme    nvectors=13
        16 004464   004466 702000 16                 TSX2    s:15113
        16 004465   004466 710000 16                 TRA     s:15113

     2168    15113    6                       ALTRETURN;

  15113 16 004466   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 004467   000000 702211                    TSX2  ! 0,X1

     2169    15114    6                   END;
     2170    15115    5                   EXIT UPDATE_FILE_COPY;

  15115 16 004470   004544 710000 16                 TRA     s:15130

     2171    15116    5               END;
     2172    15117    4               CALL VMD$GET_PROFILE (DCBNUM(MAIL_FILECOPY))
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:331  

  15117 16 004471   000000 236007 xsym               LDQ     MAIL_FILECOPY,DL
        16 004472   201272 756100                    STQ     I+1,,AUTO
        16 004473   201272 630500                    EPPR0   I+1,,AUTO
        16 004474   201273 450500                    STP0    I+2,,AUTO
        16 004475   201273 630500                    EPPR0   I+2,,AUTO
        16 004476   000025 631400 17                 EPPR1   21
        16 004477   000000 701000 xent               TSX1    VMD$GET_PROFILE
        16 004500   004502 702000 16                 TSX2    s:15119
        16 004501   004510 710000 16                 TRA     s:15122

     2173    15118    5               WHENALTRETURN DO;

     2174    15119    6                   CALL M$CLOSE (CLOSE_MAIL_FILECOPY) WHENALTRETURN DO; END;

  15119 16 004502   000372 630400 12                 EPPR0   CLOSE_MAIL_FILECOPY
        16 004503   450001 713400                    CLIMB   alt,close
        16 004504   406000 401760                    pmme    nvectors=13
        16 004505   004507 702000 16                 TSX2    s:15120
        16 004506   004507 710000 16                 TRA     s:15120

     2175    15120    5                   EXIT UPDATE_FILE_COPY;

  15120 16 004507   004544 710000 16                 TRA     s:15130

     2176    15121    5               END;
     2177    15122    4               CALL VMM$COMBINE_MESSAGE (DCBNUM(MAIL_IN), 0, DCBNUM(MAIL_FILECOPY))

  15122 16 004510   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 004511   201272 756100                    STQ     I+1,,AUTO
        16 004512   000000 236007 xsym               LDQ     MAIL_FILECOPY,DL
        16 004513   201272 235100                    LDA     I+1,,AUTO
        16 004514   201273 755100                    STA     I+2,,AUTO
        16 004515   201274 756100                    STQ     I+3,,AUTO
        16 004516   201274 630500                    EPPR0   I+3,,AUTO
        16 004517   201277 450500                    STP0    I+6,,AUTO
        16 004520   000006 236000 17                 LDQ     6
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:332  
        16 004521   201276 756100                    STQ     I+5,,AUTO
        16 004522   201273 631500                    EPPR1   I+2,,AUTO
        16 004523   201275 451500                    STP1    I+4,,AUTO
        16 004524   201275 630500                    EPPR0   I+4,,AUTO
        16 004525   000007 631400 17                 EPPR1   7
        16 004526   000000 701000 xent               TSX1    VMM$COMBINE_MESSAGE
        16 004527   004532 702000 16                 TSX2    s:15126

     2178    15123    5               WHENRETURN DO;

     2179    15124    5                   COMBINED = %YES#;

  15124 16 004530   400000 236003                    LDQ     -131072,DU
        16 004531   201155 756100                    STQ     COMBINED,,AUTO

     2180    15125    5               END;

     2181    15126    4               CALL REFRESH_INPUT_HEADER;

  15126 16 004532   002752 701000 16                 TSX1    REFRESH_INPUT_HEADER
        16 004533   000000 011000                    NOP     0

     2182    15127    4               VM_HEADER.STATUS = SAVED_FLAGS;

  15127 16 004534   201160 236100                    LDQ     SAVED_FLAGS,,AUTO
        16 004535   000000 470400 xsym               LDP0    VM_HEADER$
        16 004536   000012 756100                    STQ     10,,PR0

     2183    15128    5               CALL M$CLOSE (CLOSE_MAIL_FILECOPY) WHENALTRETURN DO; END;

  15128 16 004537   000372 630400 12                 EPPR0   CLOSE_MAIL_FILECOPY
        16 004540   450001 713400                    CLIMB   alt,close
        16 004541   406000 401760                    pmme    nvectors=13
        16 004542   004544 702000 16                 TSX2    s:15130
        16 004543   004544 710000 16                 TRA     s:15130

     2184    15129    4           END UPDATE_FILE_COPY;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:333  

     2185    15130    3           CALL VMD$GET_PROFILE(DCBNUM(MAIL_OUT))

  15130 16 004544   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 004545   201272 756100                    STQ     I+1,,AUTO
        16 004546   201272 630500                    EPPR0   I+1,,AUTO
        16 004547   201273 450500                    STP0    I+2,,AUTO
        16 004550   201273 630500                    EPPR0   I+2,,AUTO
        16 004551   000025 631400 17                 EPPR1   21
        16 004552   000000 701000 xent               TSX1    VMD$GET_PROFILE
        16 004553   004555 702000 16                 TSX2    s:15132
        16 004554   004560 710000 16                 TRA     s:15135

     2186    15131    4           WHENALTRETURN DO;

     2187    15132    4               ERROR = E_PROERR;

  15132 16 004555   000353 236000 12                 LDQ     E_PROERR
        16 004556   001076 756000 11                 STQ     ERROR

     2188    15133    4               GOTO ERROR_RETURN;

  15133 16 004557   005274 710000 16                 TRA     ERROR_RETURN

     2189    15134    4           END;
     2190    15135    3           CALL VMM$COMBINE_MESSAGE (DCBNUM(MAIL_IN), 0, DCBNUM(MAIL_OUT))

  15135 16 004560   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 004561   201272 756100                    STQ     I+1,,AUTO
        16 004562   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 004563   201272 235100                    LDA     I+1,,AUTO
        16 004564   201273 755100                    STA     I+2,,AUTO
        16 004565   201274 756100                    STQ     I+3,,AUTO
        16 004566   201274 630500                    EPPR0   I+3,,AUTO
        16 004567   201277 450500                    STP0    I+6,,AUTO
        16 004570   000006 236000 17                 LDQ     6
        16 004571   201276 756100                    STQ     I+5,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:334  
        16 004572   201273 631500                    EPPR1   I+2,,AUTO
        16 004573   201275 451500                    STP1    I+4,,AUTO
        16 004574   201275 630500                    EPPR0   I+4,,AUTO
        16 004575   000007 631400 17                 EPPR1   7
        16 004576   000000 701000 xent               TSX1    VMM$COMBINE_MESSAGE
        16 004577   004602 702000 16                 TSX2    s:15139

     2191    15136    4           WHENRETURN DO;

     2192    15137    4               COMBINED = %YES#;

  15137 16 004600   400000 236003                    LDQ     -131072,DU
        16 004601   201155 756100                    STQ     COMBINED,,AUTO

     2193    15138    4           END;

     2194    15139    3           CALL REFRESH_INPUT_HEADER;

  15139 16 004602   002752 701000 16                 TSX1    REFRESH_INPUT_HEADER
        16 004603   000000 011000                    NOP     0

     2195    15140    3           VM_HEADER.STATUS = SAVED_FLAGS;

  15140 16 004604   201160 236100                    LDQ     SAVED_FLAGS,,AUTO
        16 004605   000000 470400 xsym               LDP0    VM_HEADER$
        16 004606   000012 756100                    STQ     10,,PR0

     2196    15141    3           IF COMBINED AND VM_PROFILE.OPT.COMBINE

  15141 16 004607   201155 234100                    SZN     COMBINED,,AUTO
        16 004610   004635 605000 16                 TPL     USER_OK
        16 004611   000000 471400 xsym               LDP1    VM_PROFILE$
        16 004612   100000 236100                    LDQ     0,,PR1
        16 004613   000002 316007                    CANQ    2,DL
        16 004614   004635 600000 16                 TZE     USER_OK
        16 004615   000012 236100                    LDQ     10,,PR0
        16 004616   100000 316003                    CANQ    32768,DU
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:335  
        16 004617   004630 601000 16                 TNZ     s:15146
        16 004620   020000 316007                    CANQ    8192,DL
        16 004621   004630 601000 16                 TNZ     s:15146
        16 004622   000002 316003                    CANQ    2,DU
        16 004623   004630 601000 16                 TNZ     s:15146
        16 004624   000012 234100                    SZN     10,,PR0
        16 004625   004635 605000 16                 TPL     USER_OK
        16 004626   000200 316003                    CANQ    128,DU
        16 004627   004635 601000 16                 TNZ     USER_OK

     2197    15142    3             AND (VM_HEADER.STATUS.ACK OR VM_HEADER.STATUS.RRACK
     2198    15143    3             OR VM_HEADER.STATUS.DELIVERY
     2199    15144    3             OR (VM_HEADER.STATUS.ERR AND NOT VM_HEADER.STATUS.FCOPY))
     2200    15145    4           THEN DO;

     2201    15146    4               CALL M$CLOSE (CLOSE_MAIL_OUT);

  15146 16 004630   000734 630400 11                 EPPR0   CLOSE_MAIL_OUT
        16 004631   050001 713400                    CLIMB   close
        16 004632   406000 401760                    pmme    nvectors=13

     2202    15147    4               RETURN;

  15147 16 004633   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 004634   000001 702211                    TSX2  ! 1,X1

     2203    15148    4           END;
     2204    15149    3       END UPDATE_ORIGINAL;
     2205    15150        /*
     2206    15151             ***** Update the profile ...
     2207    15152        */
     2208    15153    2   USER_OK:
     2209    15154    2       VM_PROFILE.NUM_MESSAGES = VM_PROFILE.NUM_MESSAGES + 1;

  15154 16 004635   000000 471400 xsym  USER_OK      LDP1    VM_PROFILE$
        16 004636   100005 235100                    LDA     5,,PR1
        16 004637   000001 035007                    ADLA    1,DL
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:336  
        16 004640   100005 755100                    STA     5,,PR1

     2210    15155    2       VM_PROFILE.HI_MESSAGE_NUMBER = VM_PROFILE.HI_MESSAGE_NUMBER + 1;

  15155 16 004641   100011 235100                    LDA     9,,PR1
        16 004642   000001 035007                    ADLA    1,DL
        16 004643   100011 755100                    STA     9,,PR1

     2211    15156    2       VM_PROFILE.NUM_NEW_MESSAGES = VM_PROFILE.NUM_NEW_MESSAGES + 1;

  15156 16 004644   100006 235100                    LDA     6,,PR1
        16 004645   000001 035007                    ADLA    1,DL
        16 004646   100006 755100                    STA     6,,PR1

     2212    15157    2       CALL VMD$PUT_PROFILE(DCBNUM(MAIL_OUT)) ALTRET(BAD_MAIL);

  15157 16 004647   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 004650   201272 756100                    STQ     I+1,,AUTO
        16 004651   201272 633500                    EPPR3   I+1,,AUTO
        16 004652   201273 453500                    STP3    I+2,,AUTO
        16 004653   201273 630500                    EPPR0   I+2,,AUTO
        16 004654   000025 631400 17                 EPPR1   21
        16 004655   000000 701000 xent               TSX1    VMD$PUT_PROFILE
        16 004656   005265 702000 16                 TSX2    BAD_MAIL

     2213    15158    2       VM_HEADER.DELIVERY_DATE = CURRENT_TIME;

  15158 16 004657   000000 470400 xsym               LDP0    VM_HEADER$
        16 004660   001657 235000 11                 LDA     CURRENT_TIME
        16 004661   000002 755100                    STA     2,,PR0

     2214    15159        /*
     2215    15160             ***** Delete the return address info (security) ...
     2216    15161        */
     2217    15162    2       IF VM_HEADER.RETURN_ADDRESS$ ~= ADDR(NIL)

  15162 16 004662   000026 236100                    LDQ     22,,PR0
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:337  
        16 004663   000004 116000 17                 CMPQ    4
        16 004664   004711 600000 16                 TZE     s:15177

     2218    15163    2       THEN
     2219    15164    3       DO;                          /* Delete it */

     2220    15165    3           MASK_LEN = SIZEB(VM_RETURN_ADDRESS);

  15165 16 004665   001320 235007                    LDA     720,DL
        16 004666   000501 755000 11                 STA     MASK_LEN

     2221    15166    3           VM_HEADER.RETURN_ADDRESS$ -> MASK = %NO#;

  15166 16 004667   000026 471500                    LDP1    22,,PR0
        16 004670   000000 620005                    EAX0    0,AL
        16 004671   003140 060400                    CSL     bolr='003'O
        16 004672   000002 000001 17                 BDSC    2                        by=0,bit=0,n=1
        16 004673   100000 000010                    BDSC    0,,PR1                   by=0,bit=0,n=*X0

     2222    15167    3           HEADER_MCB.ADDRESS$ = VM_HEADER.RETURN_ADDRESS$;

  15167 16 004674   000026 236100                    LDQ     22,,PR0
        16 004675   000722 756000 11                 STQ     HEADER_MCB

     2223    15168    3           CALL X$DEALLOCATE (HEADER_MCB) ALTRET(E_ALLOCATE);

  15168 16 004676   000072 630400 17                 EPPR0   58
        16 004677   000025 631400 17                 EPPR1   21
        16 004700   000000 701000 xent               TSX1    X$DEALLOCATE
        16 004701   005272 702000 16                 TSX2    E_ALLOCATE

     2224    15169    3           VM_HEADER.RETURN_ADDRESS$ = ADDR(NIL);

  15169 16 004702   000004 236000 17                 LDQ     4
        16 004703   000000 470400 xsym               LDP0    VM_HEADER$
        16 004704   000026 756100                    STQ     22,,PR0

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:338  
     2225    15170    3           VM_HEADER.NEXT$ = HEADER_MCB.HI_SEGMENT$;

  15170 16 004705   000725 236000 11                 LDQ     HEADER_MCB+3
        16 004706   000016 756100                    STQ     14,,PR0

     2226    15171    3           VM_HEADER.FREE$ = HEADER_MCB.FREE_HEAD$;

  15171 16 004707   000723 236000 11                 LDQ     HEADER_MCB+1
        16 004710   000015 756100                    STQ     13,,PR0

     2227    15172    3       END;                       /* Delete it */

     2228    15173        /*
     2229    15174             ***** Delete the blind-copy address info if the recipient isn't on the
     2230    15175                   BC distribution and isn't the file copy.
     2231    15176        */
     2232    15177    2       IF VM_HEADER.BLIND$ ~= ADDR(NIL) AND NOT VM_DELIVERY.FLAGS.BC

  15177 16 004711   000020 236100                    LDQ     16,,PR0
        16 004712   000004 116000 17                 CMPQ    4
        16 004713   004747 600000 16                 TZE     s:15198
        16 004714   200005 236100                    LDQ     VM_DELIVERY+1,,AUTO
        16 004715   020000 316003                    CANQ    8192,DU
        16 004716   004747 601000 16                 TNZ     s:15198
        16 004717   010000 316003                    CANQ    4096,DU
        16 004720   004747 601000 16                 TNZ     s:15198

     2233    15178    2         AND NOT VM_DELIVERY.FLAGS.FC
     2234    15179    2       THEN
     2235    15180    3       DO;                          /* Delete it */

     2236    15181    3           VM_HEADER.BLIND$ -> X$STRING = '0'B;

  15181 16 004721   000020 471500                    LDP1    16,,PR0
        16 004722   000100 101500                    MRL     fill='000'O
        16 004723   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        16 004724   201272 000002                    ADSC9   I+1,,AUTO                cn=0,n=2
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:339  
        16 004725   201272 220100                    LDX0    I+1,,AUTO
        16 004726   000001 621010                    EAX1    1,X0
        16 004727   000140 100400                    MLR     fill='000'O
        16 004730   000002 000001 17                 ADSC9   2                        cn=0,n=1
        16 004731   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1

     2237    15182    3           HEADER_MCB.ADDRESS$ = VM_HEADER.BLIND$;

  15182 16 004732   000020 236100                    LDQ     16,,PR0
        16 004733   000722 756000 11                 STQ     HEADER_MCB

     2238    15183    3           CALL X$DEALLOCATE (HEADER_MCB) ALTRET(E_ALLOCATE);

  15183 16 004734   000072 630400 17                 EPPR0   58
        16 004735   000025 631400 17                 EPPR1   21
        16 004736   000000 701000 xent               TSX1    X$DEALLOCATE
        16 004737   005272 702000 16                 TSX2    E_ALLOCATE

     2239    15184    3           VM_HEADER.BLIND$ = ADDR(NIL);

  15184 16 004740   000004 236000 17                 LDQ     4
        16 004741   000000 470400 xsym               LDP0    VM_HEADER$
        16 004742   000020 756100                    STQ     16,,PR0

     2240    15185    3           VM_HEADER.NEXT$ = HEADER_MCB.HI_SEGMENT$;

  15185 16 004743   000725 236000 11                 LDQ     HEADER_MCB+3
        16 004744   000016 756100                    STQ     14,,PR0

     2241    15186    3           VM_HEADER.FREE$ = HEADER_MCB.FREE_HEAD$;

  15186 16 004745   000723 236000 11                 LDQ     HEADER_MCB+1
        16 004746   000015 756100                    STQ     13,,PR0

     2242    15187    3       END;                       /* Delete it */

     2243    15188        /*
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:340  
     2244    15189             ***** Stuff the message into the folder,
     2245    15190                   unless the folder is already full.
     2246    15191                   If so, then stuff the header, and
     2247    15192                   return an error to the sender ...
     2248    15193                   NOTE: Do not try to send an error message to
     2249    15194                   the original sender of the message if the error
     2250    15195                   is on that folder. Just override the granule
     2251    15196                   limit checking.
     2252    15197        */
     2253    15198    2       VM_HEADER.STATUS.FCOPY = VM_DELIVERY.FLAGS.FC;

  15198 16 004747   200005 236100                    LDQ     VM_DELIVERY+1,,AUTO
        16 004750   000005 772000                    QRL     5
        16 004751   000012 676100                    ERQ     10,,PR0
        16 004752   000200 376003                    ANQ     128,DU
        16 004753   000012 656100                    ERSQ    10,,PR0

     2254    15199    2       VM_HEADER.STATUS.PRIMARY = VM_DELIVERY.FLAGS.PRIMARY;

  15199 16 004754   200005 236100                    LDQ     VM_DELIVERY+1,,AUTO
        16 004755   000020 772000                    QRL     16
        16 004756   000012 676100                    ERQ     10,,PR0
        16 004757   400000 376007                    ANQ     -131072,DL
        16 004760   000012 656100                    ERSQ    10,,PR0

     2255    15200    2       VM_HEADER.STATUS.C = VM_DELIVERY.FLAGS.C;

  15200 16 004761   200005 236100                    LDQ     VM_DELIVERY+1,,AUTO
        16 004762   000020 772000                    QRL     16
        16 004763   000012 676100                    ERQ     10,,PR0
        16 004764   200000 376007                    ANQ     65536,DL
        16 004765   000012 656100                    ERSQ    10,,PR0

     2256    15201    2       VM_HEADER.STATUS.BC = VM_DELIVERY.FLAGS.BC;

  15201 16 004766   200005 236100                    LDQ     VM_DELIVERY+1,,AUTO
        16 004767   000020 772000                    QRL     16
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:341  
        16 004770   000012 676100                    ERQ     10,,PR0
        16 004771   100000 376007                    ANQ     32768,DL
        16 004772   000012 656100                    ERSQ    10,,PR0

     2257    15202    2       IF VM_FOLDER_INFO.UGRANS > VM_PROFILE.GRANULES

  15202 16 004773   000000 471400 xsym               LDP1    VM_PROFILE$
        16 004774   100012 236100                    LDQ     10,,PR1
        16 004775   000414 116000 11                 CMPQ    VM_FOLDER_INFO+18
        16 004776   005041 603000 16                 TRC     s:15218
        16 004777   000000 116003                    CMPQ    0,DU
        16 005000   005041 600000 16                 TZE     s:15218
        16 005001   040000 106400                    CMPC    fill='040'O
        16 005002   000375 400031 11                 ADSC9   VM_FOLDER_INFO+3         cn=2,n=25
        16 005003   000355 400031 11                 ADSC9   VM_RETURN_ADDRESS+7      cn=2,n=25
        16 005004   005015 601000 16                 TNZ     s:15209
        16 005005   040000 106400                    CMPC    fill='040'O
        16 005006   000373 400010 11                 ADSC9   VM_FOLDER_INFO+1         cn=2,n=8
        16 005007   000367 600010 11                 ADSC9   VM_RETURN_ADDRESS+17     cn=3,n=8
        16 005010   005015 601000 16                 TNZ     s:15209
        16 005011   040000 106400                    CMPC    fill='040'O
        16 005012   000405 600010 11                 ADSC9   VM_FOLDER_INFO+11        cn=3,n=8
        16 005013   000365 600010 11                 ADSC9   VM_RETURN_ADDRESS+15     cn=3,n=8
        16 005014   005041 600000 16                 TZE     s:15218

     2258    15203    2         AND VM_PROFILE.GRANULES > 0
     2259    15204    2         AND NOT(VM_FOLDER_INFO.FOLDER = VM_RETURN_ADDRESS.FOLDER
     2260    15205    2         AND VM_FOLDER_INFO.ACCT = VM_RETURN_ADDRESS.ACCT
     2261    15206    2         AND VM_FOLDER_INFO.SITENAME = VM_RETURN_ADDRESS.SITENAME)
     2262    15207    2       THEN                            /* It is already full */
     2263    15208    3       DO;

     2264    15209    3           VM_HEADER.STATUS.ERR = %YES#;

  15209 16 005015   400000 236003                    LDQ     -131072,DU
        16 005016   000012 256100                    ORSQ    10,,PR0

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:342  
     2265    15210    3           VM_HEADER.STATUS.RR = %NO#;

  15210 16 005017   000010 236000 17                 LDQ     8
        16 005020   000012 356100                    ANSQ    10,,PR0

     2266    15211    3           VM_HEADER.ERROR = E_FOLDERFULL;

  15211 16 005021   000354 236000 12                 LDQ     E_FOLDERFULL
        16 005022   000014 756100                    STQ     12,,PR0

     2267    15212    3           CALL VMD$PUT_HEADER (VM_PROFILE.HI_MESSAGE_NUMBER,

  15212 16 005023   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 005024   201272 756100                    STQ     I+1,,AUTO
        16 005025   201272 633500                    EPPR3   I+1,,AUTO
        16 005026   201275 453500                    STP3    I+4,,AUTO
        16 005027   000000 236000 xsym               LDQ     VM_PROFILE$
        16 005030   000011 036003                    ADLQ    9,DU
        16 005031   201274 756100                    STQ     I+3,,AUTO
        16 005032   201274 630500                    EPPR0   I+3,,AUTO
        16 005033   000000 631400 17                 EPPR1   0
        16 005034   000000 701000 xent               TSX1    VMD$PUT_HEADER
        16 005035   005240 702000 16                 TSX2    E_HEADER

     2268    15213    3             DCBNUM(MAIL_OUT)) ALTRET(E_HEADER);
     2269    15214    3           ERROR = E_FOLDERFULL;

  15214 16 005036   000354 236000 12                 LDQ     E_FOLDERFULL
        16 005037   001076 756000 11                 STQ     ERROR

     2270    15215    3           GOTO ERROR_RETURN;

  15215 16 005040   005274 710000 16                 TRA     ERROR_RETURN

     2271    15216    3       END;
     2272    15217    3       ELSE DO;

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:343  
     2273    15218    3           VM_HEADRES.RES# = VM_PROFILE.HI_MESSAGE_NUMBER;

  15218 16 005041   000000 100500                    MLR     fill='000'O
        16 005042   100011 000004                    ADSC9   9,,PR1                   cn=0,n=4
        16 005043   001314 200004 11                 ADSC9   VM_HEADRES               cn=1,n=4

     2274    15219    4           CALL M$ENQ (ENQ_HEADER) WHENALTRETURN DO;

  15219 16 005044   000326 630400 12                 EPPR0   ENQ_HEADER
        16 005045   420002 713400                    CLIMB   alt,+8194
        16 005046   401000 401760                    pmme    nvectors=3
        16 005047   005051 702000 16                 TSX2    s:15220
        16 005050   005053 710000 16                 TRA     s:15224

     2275    15220    4               CALL M$ERR;

  15220 16 005051   000002 713400                    CLIMB   err
        16 005052   000000 401760                    pmme    nvectors=0

     2276    15221    4           END;

     2277    15222                       /* Mail *MUST* enq the header with WAITTIME=0, else deadlocks
     2278    15223                          will occur. */
     2279    15224    3           CALL VMD$PUT_HEADER (VM_PROFILE.HI_MESSAGE_NUMBER,DCBNUM(MAIL_OUT))

  15224 16 005053   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 005054   201272 756100                    STQ     I+1,,AUTO
        16 005055   201272 630500                    EPPR0   I+1,,AUTO
        16 005056   201275 450500                    STP0    I+4,,AUTO
        16 005057   000000 236000 xsym               LDQ     VM_PROFILE$
        16 005060   000011 036003                    ADLQ    9,DU
        16 005061   201274 756100                    STQ     I+3,,AUTO
        16 005062   201274 630500                    EPPR0   I+3,,AUTO
        16 005063   000000 631400 17                 EPPR1   0
        16 005064   000000 701000 xent               TSX1    VMD$PUT_HEADER
        16 005065   005240 702000 16                 TSX2    E_HEADER

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:344  
     2280    15225    3             ALTRET(E_HEADER);
     2281    15226    4           CALL M$DEQ (DEQ_PROFILE) WHENALTRETURN DO; END;

  15226 16 005066   000314 630400 12                 EPPR0   DEQ_PROFILE
        16 005067   420003 713400                    CLIMB   alt,+8195
        16 005070   401000 401760                    pmme    nvectors=3
        16 005071   005073 702000 16                 TSX2    s:15227
        16 005072   005073 710000 16                 TRA     s:15227

     2282    15227    3           IF VM_HEADER.STATUS.BROADCAST

  15227 16 005073   000000 470400 xsym               LDP0    VM_HEADER$
        16 005074   000012 236100                    LDQ     10,,PR0
        16 005075   000001 316003                    CANQ    1,DU
        16 005076   005124 600000 16                 TZE     s:15232

     2283    15228    3           THEN
     2284    15229    3               CALL VMM$COPY_MESSAGE_BODY (0, VM_PROFILE.HI_MESSAGE_NUMBER,

  15229 16 005077   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 005100   201272 756100                    STQ     I+1,,AUTO
        16 005101   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 005102   201272 235100                    LDA     I+1,,AUTO
        16 005103   201273 755100                    STA     I+2,,AUTO
        16 005104   201274 756100                    STQ     I+3,,AUTO
        16 005105   000100 237000 17                 LDAQ    64
        16 005106   201302 757100                    STAQ    I+9,,AUTO
        16 005107   201274 631500                    EPPR1   I+3,,AUTO
        16 005110   201301 451500                    STP1    I+8,,AUTO
        16 005111   201273 633500                    EPPR3   I+2,,AUTO
        16 005112   201300 453500                    STP3    I+7,,AUTO
        16 005113   000000 236000 xsym               LDQ     VM_PROFILE$
        16 005114   000011 036003                    ADLQ    9,DU
        16 005115   000006 235000 17                 LDA     6
        16 005116   201276 757100                    STAQ    I+5,,AUTO
        16 005117   201276 630500                    EPPR0   I+5,,AUTO
        16 005120   000063 631400 17                 EPPR1   51
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:345  
        16 005121   000000 701000 xent               TSX1    VMM$COPY_MESSAGE_BODY
        16 005122   005205 702000 16                 TSX2    E_COPY
        16 005123   005150 710000 16                 TRA     s:15234

     2285    15230    3                 DCBNUM(MAIL_IN), DCBNUM(MAIL_OUT), 0, 0) ALTRET (E_COPY);
     2286    15231    3           ELSE
     2287    15232    3               CALL VMM$COPY_MESSAGE (0, VM_PROFILE.HI_MESSAGE_NUMBER,

  15232 16 005124   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 005125   201272 756100                    STQ     I+1,,AUTO
        16 005126   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 005127   201272 235100                    LDA     I+1,,AUTO
        16 005130   201273 755100                    STA     I+2,,AUTO
        16 005131   201274 756100                    STQ     I+3,,AUTO
        16 005132   000100 237000 17                 LDAQ    64
        16 005133   201302 757100                    STAQ    I+9,,AUTO
        16 005134   201274 631500                    EPPR1   I+3,,AUTO
        16 005135   201301 451500                    STP1    I+8,,AUTO
        16 005136   201273 633500                    EPPR3   I+2,,AUTO
        16 005137   201300 453500                    STP3    I+7,,AUTO
        16 005140   000000 236000 xsym               LDQ     VM_PROFILE$
        16 005141   000011 036003                    ADLQ    9,DU
        16 005142   000006 235000 17                 LDA     6
        16 005143   201276 757100                    STAQ    I+5,,AUTO
        16 005144   201276 630500                    EPPR0   I+5,,AUTO
        16 005145   000063 631400 17                 EPPR1   51
        16 005146   000000 701000 xent               TSX1    VMM$COPY_MESSAGE
        16 005147   005205 702000 16                 TSX2    E_COPY

     2288    15233    3                 DCBNUM(MAIL_IN), DCBNUM(MAIL_OUT), 0, 0) ALTRET (E_COPY);
     2289    15234    3           IF NOT VM_DELIVERY.FLAGS.BC AND NOT VM_DELIVERY.FLAGS.FC

  15234 16 005150   200005 236100                    LDQ     VM_DELIVERY+1,,AUTO
        16 005151   020000 316003                    CANQ    8192,DU
        16 005152   005172 601000 16                 TNZ     s:15238
        16 005153   010000 316003                    CANQ    4096,DU
        16 005154   005172 601000 16                 TNZ     s:15238
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:346  

     2290    15235    3           THEN
     2291    15236    3               CALL VMA$DEL_ADD_RECORD (%VM_TYPE_BC, VECTOR(NIL), DCBNUM(MAIL_OUT),

  15236 16 005155   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 005156   201272 756100                    STQ     I+1,,AUTO
        16 005157   000000 236000 xsym               LDQ     VM_PROFILE$
        16 005160   000011 036003                    ADLQ    9,DU
        16 005161   201277 756100                    STQ     I+6,,AUTO
        16 005162   201272 630500                    EPPR0   I+1,,AUTO
        16 005163   201276 450500                    STP0    I+5,,AUTO
        16 005164   000106 237000 17                 LDAQ    70
        16 005165   201274 757100                    STAQ    I+3,,AUTO
        16 005166   201274 630500                    EPPR0   I+3,,AUTO
        16 005167   000027 631400 17                 EPPR1   23
        16 005170   000000 701000 xent               TSX1    VMA$DEL_ADD_RECORD
        16 005171   000000 011000                    NOP     0

     2292    15237    3                 VM_PROFILE.HI_MESSAGE_NUMBER);
     2293    15238    4           CALL M$DEQ (DEQ_HEADER) WHENALTRETURN DO;

  15238 16 005172   000340 630400 12                 EPPR0   DEQ_HEADER
        16 005173   420003 713400                    CLIMB   alt,+8195
        16 005174   401000 401760                    pmme    nvectors=3
        16 005175   005177 702000 16                 TSX2    s:15241
        16 005176   005177 710000 16                 TRA     s:15241

     2294    15239    4           END;

     2295    15240    3       END;

     2296    15241    2       CALL M$CLOSE (CLOSE_MAIL_OUT) ALTRET(BAD_MAIL);

  15241 16 005177   000734 630400 11                 EPPR0   CLOSE_MAIL_OUT
        16 005200   450001 713400                    CLIMB   alt,close
        16 005201   406000 401760                    pmme    nvectors=13
        16 005202   005265 702000 16                 TSX2    BAD_MAIL
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:347  

  15241 16 005203                       WE_TRIED     null
  15241 16 005203                       CONTINUE     null
     2297    15242
     2298    15243
     2299    15244
     2300    15245    2   WE_TRIED: ;
     2301    15246    2   CONTINUE: ;
     2302    15247    2       RETURN;

  15247 16 005203   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 005204   000001 702211                    TSX2  ! 1,X1

     2303    15248        /*
     2304    15249             ***** Problem writing message into destination folder so attempt
     2305    15250             ***** to notify user by posting error in header. However when
     2306    15251             ***** out of disk space to the point where even the header can't
     2307    15252             ***** be written, increment the lost message count in the profile record.
     2308    15253        */
     2309    15254    2   E_COPY:
     2310    15255    2       ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  15255 16 005205   000000 470400 xsym  E_COPY       LDP0    B$TCB$
        16 005206   000000 471500                    LDP1    0,,PR0
        16 005207   100102 236100                    LDQ     66,,PR1
        16 005210   001076 756000 11                 STQ     ERROR

     2311    15256    2       VM_HEADER.STATUS.ERR = %YES#;

  15256 16 005211   000000 473400 xsym               LDP3    VM_HEADER$
        16 005212   400000 236003                    LDQ     -131072,DU
        16 005213   300012 256100                    ORSQ    10,,PR3

     2312    15257    2       VM_HEADER.STATUS.RR = %NO#;

  15257 16 005214   000010 236000 17                 LDQ     8
        16 005215   300012 356100                    ANSQ    10,,PR3
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:348  

     2313    15258    2       IF ERROR.ERR# = %E$ACGRANS

  15258 16 005216   001076 236000 11                 LDQ     ERROR
        16 005217   377770 376007                    ANQ     131064,DL
        16 005220   002160 116007                    CMPQ    1136,DL
        16 005221   005224 601000 16                 TNZ     s:15261

     2314    15259    2       THEN
     2315    15260    2           VM_HEADER.ERROR = E_DISKSPACE; /* Output better err. msge. */

  15260 16 005222   000355 236000 12                 LDQ     E_DISKSPACE
        16 005223   300014 756100                    STQ     12,,PR3

     2316    15261    2       CALL VMD$PUT_HEADER (VM_PROFILE.HI_MESSAGE_NUMBER,DCBNUM(MAIL_OUT))

  15261 16 005224   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 005225   201272 756100                    STQ     I+1,,AUTO
        16 005226   201272 631500                    EPPR1   I+1,,AUTO
        16 005227   201275 451500                    STP1    I+4,,AUTO
        16 005230   000000 236000 xsym               LDQ     VM_PROFILE$
        16 005231   000011 036003                    ADLQ    9,DU
        16 005232   201274 756100                    STQ     I+3,,AUTO
        16 005233   201274 630500                    EPPR0   I+3,,AUTO
        16 005234   000000 631400 17                 EPPR1   0
        16 005235   000000 701000 xent               TSX1    VMD$PUT_HEADER
        16 005236   005240 702000 16                 TSX2    E_HEADER

     2317    15262    2         ALTRET(E_HEADER);
     2318    15263    3       DO WHILE ('0'B);

  15263 16 005237   005271 710000 16                 TRA     s:15274

     2319    15264    3   E_HEADER:
     2320    15265    3           VM_PROFILE.NUM_MESSAGES = VM_PROFILE.NUM_MESSAGES - 1;

  15265 16 005240   000000 470400 xsym  E_HEADER     LDP0    VM_PROFILE$
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:349  
        16 005241   000005 235100                    LDA     5,,PR0
        16 005242   000001 135007                    SBLA    1,DL
        16 005243   000005 755100                    STA     5,,PR0

     2321    15266    3           VM_PROFILE.HI_MESSAGE_NUMBER = VM_PROFILE.HI_MESSAGE_NUMBER - 1;

  15266 16 005244   000011 235100                    LDA     9,,PR0
        16 005245   000001 135007                    SBLA    1,DL
        16 005246   000011 755100                    STA     9,,PR0

     2322    15267    3           VM_PROFILE.NUM_NEW_MESSAGES = VM_PROFILE.NUM_NEW_MESSAGES - 1;

  15267 16 005247   000006 235100                    LDA     6,,PR0
        16 005250   000001 135007                    SBLA    1,DL
        16 005251   000006 755100                    STA     6,,PR0

     2323    15268    3           VM_PROFILE.NUM_LOST = VM_PROFILE.NUM_LOST + 1;

  15268 16 005252   000141 235100                    LDA     97,,PR0
        16 005253   000001 035007                    ADLA    1,DL
        16 005254   000141 755100                    STA     97,,PR0

     2324    15269    3           CALL VMD$PUT_PROFILE(DCBNUM(MAIL_OUT)) ALTRET(BAD_MAIL);

  15269 16 005255   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 005256   201272 756100                    STQ     I+1,,AUTO
        16 005257   201272 631500                    EPPR1   I+1,,AUTO
        16 005260   201273 451500                    STP1    I+2,,AUTO
        16 005261   201273 630500                    EPPR0   I+2,,AUTO
        16 005262   000025 631400 17                 EPPR1   21
        16 005263   000000 701000 xent               TSX1    VMD$PUT_PROFILE
        16 005264   005265 702000 16                 TSX2    BAD_MAIL

  15268 16 005265                       BAD_MAIL     null
     2325    15270    3   BAD_MAIL: ;
     2326    15271    3           ERROR = B$TCB.ALT$ -> B$ALT.ERR;

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:350  
  15271 16 005265   000000 470400 xsym               LDP0    B$TCB$
        16 005266   000000 471500                    LDP1    0,,PR0
        16 005267   100102 236100                    LDQ     66,,PR1
        16 005270   001076 756000 11                 STQ     ERROR

     2327    15272    3       END;

     2328    15273        /**/
     2329    15274    3       DO WHILE ('0'B); /* NEVER */;

  15274 16 005271   005274 710000 16                 TRA     ERROR_RETURN

     2330    15275    3   E_ALLOCATE:
     2331    15276    3           ERROR = HEADER_MCB.ERR;

  15276 16 005272   000732 236000 11    E_ALLOCATE   LDQ     HEADER_MCB+8
        16 005273   001076 756000 11                 STQ     ERROR

     2332    15277    3       END;                            /* Do never ... end */

     2333    15278    2   ERROR_RETURN:
     2334    15279    3       CALL M$DEQ (DEQ_PROFILE) WHENALTRETURN DO;

  15279 16 005274   000314 630400 12    ERROR_RETURN EPPR0   DEQ_PROFILE
        16 005275   420003 713400                    CLIMB   alt,+8195
        16 005276   401000 401760                    pmme    nvectors=3
        16 005277   005301 702000 16                 TSX2    s:15281
        16 005300   005301 710000 16                 TRA     s:15281

     2335    15280    3       END;

     2336    15281    3       CALL M$DEQ (DEQ_HEADER) WHENALTRETURN DO;

  15281 16 005301   000340 630400 12                 EPPR0   DEQ_HEADER
        16 005302   420003 713400                    CLIMB   alt,+8195
        16 005303   401000 401760                    pmme    nvectors=3
        16 005304   005306 702000 16                 TSX2    s:15283
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:351  
        16 005305   005306 710000 16                 TRA     s:15283

     2337    15282    3       END;

     2338    15283    2       CALL M$CLOSE (CLOSE_MAIL_OUT) ALTRET(DONT_CARE);

  15283 16 005306   000734 630400 11                 EPPR0   CLOSE_MAIL_OUT
        16 005307   450001 713400                    CLIMB   alt,close
        16 005310   406000 401760                    pmme    nvectors=13
        16 005311   005312 702000 16                 TSX2    DONT_CARE

  15274 16 005312                       DONT_CARE    null
     2339    15284    2   DONT_CARE: ;
     2340    15285    2       ALTRETURN;

  15285 16 005312   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 005313   000000 702211                    TSX2  ! 0,X1

     2341    15286    2   END VOM$SENDIT;
     2342    15287        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:352  
     2343    15288        /*********************************************************************/
     2344    15289        /*F*    NAME:        TRANSPORT_INTERSYS
     2345    15290                PURPOSE:     To interface with transport facilities.
     2346    15291                DESCRIPTION: This routine will cause the current message
     2347    15292                             file to be transported to as many sites as
     2348    15293                             are specified in the INTERSYS_INFO list.
     2349    15294        */
     2350    15295        /*********************************************************************/
     2351    15296    1   TRANSPORT_INTERSYS: PROC(ONE) ALTRET;

  15296 16 005314   201146 741300       TRANSPORT_I* STX1  ! DELIVERY_SUMMARY+2,,AUTO

     2352    15297    2   DCL ONE BIT(1) ALIGNED;            /* If set, process only top chain entry */
     2353    15298    2   DCL VOM$MOVE ENTRY (3) ALTRET;
     2354    15299          %VM_BODYREC (STCLASS=STATIC,VARYLEN=NO);
     2355    15331          %VM_CGBUFFER (NAME=VM_CGOUT);
     2356    15362           %VM_SITE (NAME=VM_SITE_T);
     2357    15386
     2358    15387             %VLP_ERRCODE (FPTN=MYERROR,
     2359    15388                            FCG = "VO",
     2360    15389                            MID ="M");
     2361    15434
     2362    15435              %VLP_NAME (FPTN=MOVE_NAME, L=31);
     2363    15462
     2364    15463             %FPT_OPEN (FPTN=OPEN_MAIL_CREATE,
     2365    15464                            NAME=MOVE_NAME,
     2366    15465                            ACCT=VM_MAIL_ACCT,
     2367    15466                            DCB=MAIL_OUT,
     2368    15467                            ASN=FILE,
     2369    15468                            FUN=CREATE,
     2370    15469                       SCRUB=YES,
     2371    15470                            ACS=DIRECT,
     2372    15471                            ORG=KEYED);
     2373    15580
     2374    15581        %FPT_CLOSE (FPTN=CLOSE_MAIL,DCB=MAIL_OUT,DISP=SAVE);
     2375    15623        %FPT_ACTIVATE (FPTN=CANCEL_READ, STCLASS=CONSTANT,
     2376    15624                  DCB=M$MAIL_COMGROUP,
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:353  
     2377    15625                  STATION=MYSTATION,
     2378    15626                  ABTREAD=%TYC_EOF);
     2379    15649        %VLP_STATION (FPTN=MYSTATION,STATION='MAILMAN', STCLASS=CONSTANT);
     2380    15676              %FPT_OLAY (STCLASS=STATIC,
     2381    15677              ONAME=OV_NAME);
     2382    15693        %VLP_NAME (FPTN=OV_NAME, STCLASS=CONSTANT,
     2383    15694                  NAME='VOM$MOVE');
     2384    15721
     2385    15722        %VLP_STATION (FPTN=OUTSTATION, STCLASS="SYMREF");
     2386    15749    2   DCL INDX SBIN WORD STATIC;
     2387    15750    2   DCL PREFIX CHAR (5);
     2388    15751    2   DCL ACCT CHAR (8);
     2389    15752    2   DCL NODE CHAR (8);
     2390    15753        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:354  
     2391    15754        /*
     2392    15755             ***** Create one xeq file for each foreign system
     2393    15756                   that the message must be moved to ...
     2394    15757        */
     2395    15758    3       DO WHILE (INTERSYS_HEAD$ ~= ADDR(NIL));

  15758 16 005315   006137 710000 16                 TRA     s:15964

     2396    15759    3           INTERSYS$ = INTERSYS_HEAD$;

  15759 16 005316   000000 236000 xsym               LDQ     INTERSYS_HEAD$
        16 005317   000000 756000 xsym               STQ     INTERSYS$

     2397    15760    3           OPEN_MAIL_CREATE.ACCT_ = VECTOR (VM_MAIL_ACCT);

  15760 16 005320   000110 237000 17                 LDAQ    72
        16 005321   002270 757000 11                 STAQ    OPEN_MAIL_CREATE+20

     2398    15761    3           OPEN_MAIL_CREATE.V.FUN# = %CREATE#;

  15761 16 005322   003000 236007                    LDQ     1536,DL
        16 005323   002311 552010 11                 STBQ    OPEN_MAIL_CREATE+37,'10'O

     2399    15762    3           OPEN_MAIL_CREATE.V.DELETE# = %NO#;

  15762 16 005324   000105 236000 17                 LDQ     69
        16 005325   002310 356000 11                 ANSQ    OPEN_MAIL_CREATE+36

     2400    15763    3           MOVE_NAME.NAME# = ':XMIT';

  15763 16 005326   040000 100400                    MLR     fill='040'O
        16 005327   000613 000005 12                 ADSC9   E_BADSITE+88             cn=0,n=5
        16 005330   002234 200037 11                 ADSC9   MOVE_NAME                cn=1,n=31

     2401    15764    3           CALL CONCAT (STATUS_STRING, 'Beaming mail to ', INTERSYS_INFO.SITENAME);

  15764 16 005331   040100 100400                    MLR     fill='040'O
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:355  
        16 005332   000615 000020 12                 ADSC9   E_BADSITE+90             cn=0,n=16
        16 005333   200462 000020                    ADSC9   STATUS_STRING,,AUTO      cn=0,n=16
        16 005334   000000 470400 xsym               LDP0    INTERSYS$
        16 005335   040100 100500                    MLR     fill='040'O
        16 005336   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
        16 005337   200466 000360                    ADSC9   STATUS_STRING+4,,AUTO    cn=0,n=240

     2402    15765    3           CALL UPDATE_STATUS;

  15765 16 005340   003114 701000 16                 TSX1    UPDATE_STATUS
        16 005341   000000 011000                    NOP     0

     2403    15766        /*
     2404    15767             ***** Read the site-info record so we can figure out where the
     2405    15768                   mail file should be placed.
     2406    15769        */
     2407    15770    3          CALL VMA$GET_SITE_NAME(INTERSYS_INFO.SITENAME, SITENAME, SITE_TYPE, EXTERNAL
             15770                    ) ALTRET (E_PMME);

  15770 16 005342   200563 630500                    EPPR0   EXTERNAL,,AUTO
        16 005343   201275 450500                    STP0    I+4,,AUTO
        16 005344   200562 631500                    EPPR1   SITE_TYPE,,AUTO
        16 005345   201274 451500                    STP1    I+3,,AUTO
        16 005346   200460 633500                    EPPR3   SITENAME,,AUTO
        16 005347   201273 453500                    STP3    I+2,,AUTO
        16 005350   000000 236000 xsym               LDQ     INTERSYS$
        16 005351   000002 036003                    ADLQ    2,DU
        16 005352   201272 756100                    STQ     I+1,,AUTO
        16 005353   201272 630500                    EPPR0   I+1,,AUTO
        16 005354   000027 631400 17                 EPPR1   23
        16 005355   000000 701000 xent               TSX1    VMA$GET_SITE_NAME
        16 005356   006150 702000 16                 TSX2    E_PMME

     2408    15771    3           CALL INSERT (MOVE_NAME.NAME#, 5, , INTERSYS_INFO.NAME);

  15771 16 005357   000000 470400 xsym               LDP0    INTERSYS$
        16 005360   040000 100500                    MLR     fill='040'O
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:356  
        16 005361   000004 000023                    ADSC9   4,,PR0                   cn=0,n=19
        16 005362   002235 400032 11                 ADSC9   MOVE_NAME+1              cn=2,n=26

     2409    15772    3           CALL INDEX (INDX, ' ', MOVE_NAME.NAME#);

  15772 16 005363   000000 124400                    SCM     mask='000'O
        16 005364   002234 200037 11                 ADSC9   MOVE_NAME                cn=1,n=31
        16 005365   000023 000001 17                 ADSC9   19                       cn=0,n=1
        16 005366   002402 000000 11                 ARG     INDX

     2410    15773    3           MOVE_NAME.L# = INDX;

  15773 16 005367   002402 236000 11                 LDQ     INDX
        16 005370   000033 736000                    QLS     27
        16 005371   002234 552040 11                 STBQ    MOVE_NAME,'40'O

     2411    15774        /*
     2412    15775             ***** Create the :MOVE file ...
     2413    15776        */
     2414    15777    3           CALL M$OPEN (OPEN_MAIL_CREATE) ALTRET(E_PMME);

  15777 16 005372   002244 630400 11                 EPPR0   OPEN_MAIL_CREATE
        16 005373   450000 713400                    CLIMB   alt,open
        16 005374   410400 401760                    pmme    nvectors=18
        16 005375   006150 702000 16                 TSX2    E_PMME

     2415    15778        /*
     2416    15779             ***** Restore the return address
     2417    15780                   receiving mailman may need it ...
     2418    15781        */
     2419    15782    3           IF VM_HEADER.RETURN_ADDRESS$ = ADDR(NIL)

  15782 16 005376   000000 470400 xsym               LDP0    VM_HEADER$
        16 005377   000026 236100                    LDQ     22,,PR0
        16 005400   000004 116000 17                 CMPQ    4
        16 005401   005441 601000 16                 TNZ     s:15808

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:357  
     2420    15783    3           THEN
     2421    15784    4           DO;                    /* Restore it */

     2422    15785    4               HEADER_MCB.SIZE = SIZEC(VM_RETURN_ADDRESS);

  15785 16 005402   000120 235007                    LDA     80,DL
        16 005403   000730 755000 11                 STA     HEADER_MCB+6

     2423    15786    4               CALL X$ALLOCATE (HEADER_MCB)

  15786 16 005404   000072 630400 17                 EPPR0   58
        16 005405   000025 631400 17                 EPPR1   21
        16 005406   000000 701000 xent               TSX1    X$ALLOCATE
        16 005407   005411 702000 16                 TSX2    s:15789
        16 005410   005426 710000 16                 TRA     s:15793

     2424    15787    4               WHENALTRETURN
     2425    15788    5               DO;

     2426    15789    5                   CALL VMA$ENLARGE_SEGMENT (VM_HEADER_,1024) ALTRET(E_PMME);

  15789 16 005411   000075 630400 17                 EPPR0   61
        16 005412   000000 631400 17                 EPPR1   0
        16 005413   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        16 005414   006150 702000 16                 TSX2    E_PMME

     2427    15790    5                   HEADER_MCB.WKSZ = (VBOUND(VM_HEADER_)+1)/4;

  15790 16 005415   000000 236000 xsym               LDQ     VM_HEADER_
        16 005416   000020 772000                    QRL     16
        16 005417   000001 036007                    ADLQ    1,DL
        16 005420   000002 772000                    QRL     2
        16 005421   000726 756000 11                 STQ     HEADER_MCB+4

     2428    15791    5                   CALL X$ALLOCATE (HEADER_MCB) ALTRET(E_ALLOCATE);

  15791 16 005422   000072 630400 17                 EPPR0   58
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:358  
        16 005423   000025 631400 17                 EPPR1   21
        16 005424   000000 701000 xent               TSX1    X$ALLOCATE
        16 005425   006144 702000 16                 TSX2    E_ALLOCATE

     2429    15792    5               END;

     2430    15793    4               VM_HEADER.RETURN_ADDRESS$ = HEADER_MCB.ADDRESS$;

  15793 16 005426   000722 236000 11                 LDQ     HEADER_MCB
        16 005427   000000 470400 xsym               LDP0    VM_HEADER$
        16 005430   000026 756100                    STQ     22,,PR0

     2431    15794    4               VM_HEADER.RETURN_ADDRESS$ -> VM$RADDRESS = VM_RETURN_ADDRESS;

  15794 16 005431   000026 471500                    LDP1    22,,PR0
        16 005432   000100 100400                    MLR     fill='000'O
        16 005433   000346 000117 11                 ADSC9   VM_RETURN_ADDRESS        cn=0,n=79
        16 005434   100000 000117                    ADSC9   0,,PR1                   cn=0,n=79

     2432    15795    4               VM_HEADER.NEXT$ = HEADER_MCB.HI_SEGMENT$;

  15795 16 005435   000725 236000 11                 LDQ     HEADER_MCB+3
        16 005436   000016 756100                    STQ     14,,PR0

     2433    15796    4               VM_HEADER.FREE$ = HEADER_MCB.FREE_HEAD$;

  15796 16 005437   000723 236000 11                 LDQ     HEADER_MCB+1
        16 005440   000015 756100                    STQ     13,,PR0

     2434    15797    4           END;                  /* Restore it */

     2435    15798        /*
     2436    15799             ***** Now create the internal address lists for this
     2437    15800                   site. Only addresses recognized as belonging
     2438    15801                   to the receiving site must be included so as
     2439    15802                   to avoid multiple messages to one receiver ...
     2440    15803        */
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:359  
     2441    15804        /*   If this is an error reporting message, don't bother building
     2442    15805             any of the address lists.  Just use VM_RADDRESS which has already
     2443    15806             been set to VM_RETURN_ADDRESS by a previous routine.
     2444    15807        */
     2445    15808    3           IF ONE THEN

  15808 16 005441   201147 471500                    LDP1    @ONE,,AUTO
        16 005442   100000 234100                    SZN     0,,PR1
        16 005443   005455 605000 16                 TPL     s:15811

     2446    15809    3               CALL BUILD_ADD_LIST (ADDR(VM_RADDRESS), %VM_TYPE_ITO);

  15809 16 005444   000015 236000 17                 LDQ     13
        16 005445   201307 756100                    STQ     I+14,,AUTO
        16 005446   000113 236000 17                 LDQ     75
        16 005447   201160 756100                    STQ     SAVED_FLAGS,,AUTO
        16 005450   201307 633500                    EPPR3   I+14,,AUTO
        16 005451   201157 453500                    STP3    TIME_CURR$,,AUTO
        16 005452   006156 701000 16                 TSX1    BUILD_ADD_LIST
        16 005453   000000 011000                    NOP     0
        16 005454   005636 710000 16                 TRA     s:15882

     2447    15810    4           ELSE DO;

     2448    15811    4               IF ITO_HEAD$ ~= ADDR(NIL)

  15811 16 005455   000706 236000 11                 LDQ     ITO_HEAD$
        16 005456   000004 116000 17                 CMPQ    4
        16 005457   005466 600000 16                 TZE     s:15814

     2449    15812    4               THEN
     2450    15813    4                   CALL BUILD_ADD_LIST (ITO_HEAD$,%VM_TYPE_ITO);

  15813 16 005460   000113 236000 17                 LDQ     75
        16 005461   201160 756100                    STQ     SAVED_FLAGS,,AUTO
        16 005462   000114 236000 17                 LDQ     76
        16 005463   201157 756100                    STQ     TIME_CURR$,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:360  
        16 005464   006156 701000 16                 TSX1    BUILD_ADD_LIST
        16 005465   000000 011000                    NOP     0

     2451    15814    4               IF IBC_HEAD$ ~= ADDR(NIL)

  15814 16 005466   000707 236000 11                 LDQ     IBC_HEAD$
        16 005467   000004 116000 17                 CMPQ    4
        16 005470   005615 600000 16                 TZE     s:15852

     2452    15815    4               THEN
     2453    15816    5               DO;

     2454    15817    5                   CALL BUILD_ADD_LIST (IBC_HEAD$,%VM_TYPE_IBC);

  15817 16 005471   000116 236000 17                 LDQ     78
        16 005472   201160 756100                    STQ     SAVED_FLAGS,,AUTO
        16 005473   000117 236000 17                 LDQ     79
        16 005474   201157 756100                    STQ     TIME_CURR$,,AUTO
        16 005475   006156 701000 16                 TSX1    BUILD_ADD_LIST
        16 005476   000000 011000                    NOP     0

     2455    15818        /*
     2456    15819             ***** If there is blind copy info, restore it ...
     2457    15820        */
     2458    15821    5                   IF BLIND_TEXT.L# ~= 0

  15821 16 005477   000506 236000 11                 LDQ     BLIND_TEXT
        16 005500   777000 316003                    CANQ    -512,DU
        16 005501   005556 600000 16                 TZE     s:15839
        16 005502   000000 470400 xsym               LDP0    VM_ADDLIST$
        16 005503   000001 235100                    LDA     1,,PR0
        16 005504   005556 600000 16                 TZE     s:15839

     2459    15822    5                     AND VM_ADD_HEAD.NUM_ENTRIES > 0
     2460    15823    5                   THEN
     2461    15824    6                   DO; /* Restore BLIND$ */

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:361  
     2462    15825    6                       HEADER_MCB.SIZE = BLIND_TEXT.L# + 1;

  15825 16 005505   000506 236000 11                 LDQ     BLIND_TEXT
        16 005506   000033 772000                    QRL     27
        16 005507   000001 036007                    ADLQ    1,DL
        16 005510   000730 756000 11                 STQ     HEADER_MCB+6

     2463    15826    6                       CALL X$ALLOCATE (HEADER_MCB)

  15826 16 005511   000072 630400 17                 EPPR0   58
        16 005512   000025 631400 17                 EPPR1   21
        16 005513   000000 701000 xent               TSX1    X$ALLOCATE
        16 005514   005516 702000 16                 TSX2    s:15829
        16 005515   005533 710000 16                 TRA     s:15833

     2464    15827    6                       WHENALTRETURN
     2465    15828    7                       DO;

     2466    15829    7                           CALL VMA$ENLARGE_SEGMENT (VM_HEADER_,1024) ALTRET(E_PMME);

  15829 16 005516   000075 630400 17                 EPPR0   61
        16 005517   000000 631400 17                 EPPR1   0
        16 005520   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        16 005521   006150 702000 16                 TSX2    E_PMME

     2467    15830    7                           HEADER_MCB.WKSZ = (VBOUND(VM_HEADER_)+1)/4;

  15830 16 005522   000000 236000 xsym               LDQ     VM_HEADER_
        16 005523   000020 772000                    QRL     16
        16 005524   000001 036007                    ADLQ    1,DL
        16 005525   000002 772000                    QRL     2
        16 005526   000726 756000 11                 STQ     HEADER_MCB+4

     2468    15831    7                           CALL X$ALLOCATE (HEADER_MCB) ALTRET(E_ALLOCATE);

  15831 16 005527   000072 630400 17                 EPPR0   58
        16 005530   000025 631400 17                 EPPR1   21
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:362  
        16 005531   000000 701000 xent               TSX1    X$ALLOCATE
        16 005532   006144 702000 16                 TSX2    E_ALLOCATE

     2469    15832    7                       END;

     2470    15833    6                       VM_HEADER.BLIND$ = HEADER_MCB.ADDRESS$;

  15833 16 005533   000722 236000 11                 LDQ     HEADER_MCB
        16 005534   000000 470400 xsym               LDP0    VM_HEADER$
        16 005535   000020 756100                    STQ     16,,PR0

     2471    15834    6                       VM_HEADER.NEXT$ = HEADER_MCB.HI_SEGMENT$;

  15834 16 005536   000725 236000 11                 LDQ     HEADER_MCB+3
        16 005537   000016 756100                    STQ     14,,PR0

     2472    15835    6                       VM_HEADER.FREE$ = HEADER_MCB.FREE_HEAD$;

  15835 16 005540   000723 236000 11                 LDQ     HEADER_MCB+1
        16 005541   000015 756100                    STQ     13,,PR0

     2473    15836    6                       VM_HEADER.BLIND$ -> X$STRING.SIZ = BLIND_TEXT.L#;

  15836 16 005542   000020 471500                    LDP1    16,,PR0
        16 005543   000100 100400                    MLR     fill='000'O
        16 005544   000506 000001 11                 ADSC9   BLIND_TEXT               cn=0,n=1
        16 005545   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1

     2474    15837    6                       VM_HEADER.BLIND$ -> X$STRING.TEXT = BLIND_TEXT.NAME#;

  15837 16 005546   000020 471500                    LDP1    16,,PR0
        16 005547   000100 101500                    MRL     fill='000'O
        16 005550   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        16 005551   201272 000002                    ADSC9   I+1,,AUTO                cn=0,n=2
        16 005552   201272 220100                    LDX0    I+1,,AUTO
        16 005553   040140 100400                    MLR     fill='040'O
        16 005554   000506 200777 11                 ADSC9   BLIND_TEXT               cn=1,n=511
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:363  
        16 005555   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0

     2475    15838    6                   END; /* Restore BLIND$ */

     2476    15839    5                   IF BLIND_TEXT.L# ~= 0

  15839 16 005556   000506 236000 11                 LDQ     BLIND_TEXT
        16 005557   777000 316003                    CANQ    -512,DU
        16 005560   005615 600000 16                 TZE     s:15852
        16 005561   000000 470400 xsym               LDP0    VM_ADDLIST$
        16 005562   000001 235100                    LDA     1,,PR0
        16 005563   005615 601000 16                 TNZ     s:15852
        16 005564   000000 471400 xsym               LDP1    VM_HEADER$
        16 005565   100020 236100                    LDQ     16,,PR1
        16 005566   000004 116000 17                 CMPQ    4
        16 005567   005615 600000 16                 TZE     s:15852

     2477    15840    5                     AND VM_ADD_HEAD.NUM_ENTRIES = 0
     2478    15841    5                     AND VM_HEADER.BLIND$ ~= ADDR(NIL)
     2479    15842    5                   THEN /* Don't pass nfo to this site */
     2480    15843    6                   DO;

     2481    15844    6                       VM_HEADER.BLIND$ -> X$STRING.TEXT = ' ';

  15844 16 005570   100020 473500                    LDP3    16,,PR1
        16 005571   000100 101500                    MRL     fill='000'O
        16 005572   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        16 005573   201272 000002                    ADSC9   I+1,,AUTO                cn=0,n=2
        16 005574   201272 220100                    LDX0    I+1,,AUTO
        16 005575   040140 100400                    MLR     fill='040'O
        16 005576   000023 000001 17                 ADSC9   19                       cn=0,n=1
        16 005577   300000 200010                    ADSC9   0,,PR3                   cn=1,n=*X0

     2482    15845    6                       HEADER_MCB.ADDRESS$ = VM_HEADER.BLIND$;

  15845 16 005600   100020 236100                    LDQ     16,,PR1
        16 005601   000722 756000 11                 STQ     HEADER_MCB
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:364  

     2483    15846    6                       CALL X$DEALLOCATE (HEADER_MCB);

  15846 16 005602   000072 630400 17                 EPPR0   58
        16 005603   000025 631400 17                 EPPR1   21
        16 005604   000000 701000 xent               TSX1    X$DEALLOCATE
        16 005605   000000 011000                    NOP     0

     2484    15847    6                       VM_HEADER.BLIND$ = ADDR(NIL);

  15847 16 005606   000004 236000 17                 LDQ     4
        16 005607   000000 470400 xsym               LDP0    VM_HEADER$
        16 005610   000020 756100                    STQ     16,,PR0

     2485    15848    6                       VM_HEADER.NEXT$ = HEADER_MCB.HI_SEGMENT$;

  15848 16 005611   000725 236000 11                 LDQ     HEADER_MCB+3
        16 005612   000016 756100                    STQ     14,,PR0

     2486    15849    6                       VM_HEADER.FREE$ = HEADER_MCB.FREE_HEAD$;

  15849 16 005613   000723 236000 11                 LDQ     HEADER_MCB+1
        16 005614   000015 756100                    STQ     13,,PR0

     2487    15850    6                   END;

     2488    15851    5               END;

     2489    15852    4               IF IC_HEAD$ ~= ADDR(NIL)

  15852 16 005615   000710 236000 11                 LDQ     IC_HEAD$
        16 005616   000004 116000 17                 CMPQ    4
        16 005617   005626 600000 16                 TZE     s:15870

     2490    15853    4               THEN
     2491    15854    4                   CALL BUILD_ADD_LIST (IC_HEAD$,%VM_TYPE_IC);

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:365  
  15854 16 005620   000121 236000 17                 LDQ     81
        16 005621   201160 756100                    STQ     SAVED_FLAGS,,AUTO
        16 005622   000122 236000 17                 LDQ     82
        16 005623   201157 756100                    STQ     TIME_CURR$,,AUTO
        16 005624   006156 701000 16                 TSX1    BUILD_ADD_LIST
        16 005625   000000 011000                    NOP     0

     2492    15855        /*
     2493    15856             ***** Record where this message came from,
     2494    15857                   and where it is going so that the
     2495    15858                   receiving system will not try to send the
     2496    15859                   message back to this system.
     2497    15860                   NOTE: There is an exception. When it is
     2498    15861                   necessary to send a message back to the
     2499    15862                   original sender (answer), the flag RETURN_TO_ORIGIN
     2500    15863                   should be set. This is only used when this is
     2501    15864                   the first mailman to process this message
     2502    15865                   (i.e. NUM_SITES = 0).
     2503    15866        */
     2504    15867        /*
     2505    15868             ***** Determine if RETURN_TO_ORIGIN should be set ...
     2506    15869        */
     2507    15870    4               IF VM_HEADER.STATUS.ANS_TO

  15870 16 005626   000000 470400 xsym               LDP0    VM_HEADER$
        16 005627   000012 236100                    LDQ     10,,PR0
        16 005630   000010 316003                    CANQ    8,DU
        16 005631   005636 600000 16                 TZE     s:15882

     2508    15871    4               THEN
     2509    15872    5               DO;

     2510    15873        /*****      IF NOT VM_HEADER.STATUS.FCOPY
     2511    15874                    THEN *****/
     2512    15875    5                   VM_SITE.FLAGS.RETURN_TO_ORIGIN = %YES#;

  15875 16 005632   400000 236003                    LDQ     -131072,DU
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:366  
        16 005633   000063 256000 11                 ORSQ    VM_SITE

     2513    15876    5                   VM_HEADER.STATUS.ANS_TO = %NO#;

  15876 16 005634   000123 236000 17                 LDQ     83
        16 005635   000012 356100                    ANSQ    10,,PR0

     2514    15877    5               END;

     2515    15878    4           END;                  /* Not one */

     2516    15879        /*
     2517    15880             ***** Now copy the message file to the :MOVE file ...
     2518    15881        */
     2519    15882    3           CALL VMM$COPY_MESSAGE (0,0,DCBNUM(MAIL_IN),DCBNUM(MAIL_OUT),0,0);

  15882 16 005636   000000 236007 xsym               LDQ     MAIL_IN,DL
        16 005637   201272 756100                    STQ     I+1,,AUTO
        16 005640   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 005641   201272 235100                    LDA     I+1,,AUTO
        16 005642   201273 755100                    STA     I+2,,AUTO
        16 005643   201274 756100                    STQ     I+3,,AUTO
        16 005644   000100 237000 17                 LDAQ    64
        16 005645   201302 757100                    STAQ    I+9,,AUTO
        16 005646   201274 630500                    EPPR0   I+3,,AUTO
        16 005647   201301 450500                    STP0    I+8,,AUTO
        16 005650   201273 631500                    EPPR1   I+2,,AUTO
        16 005651   201300 451500                    STP1    I+7,,AUTO
        16 005652   000100 237000 17                 LDAQ    64
        16 005653   201276 757100                    STAQ    I+5,,AUTO
        16 005654   201276 630500                    EPPR0   I+5,,AUTO
        16 005655   000063 631400 17                 EPPR1   51
        16 005656   000000 701000 xent               TSX1    VMM$COPY_MESSAGE
        16 005657   000000 011000                    NOP     0

     2520    15883        /*
     2521    15884             ***** Search for loops in address resolution ...
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:367  
     2522    15885        */
     2523    15886    3           IF VM_SITE.NUM_SITES > 1

  15886 16 005660   000064 235000 11                 LDA     VM_SITE+1
        16 005661   000002 115007                    CMPA    2,DL
        16 005662   005732 602000 16                 TNC     s:15915
        16 005663   201147 470500                    LDP0    @ONE,,AUTO
        16 005664   000000 234100                    SZN     0,,PR0
        16 005665   005732 604000 16                 TMI     s:15915

     2524    15887    3             AND NOT ONE /* If one (error return) we're going home, don't test */
     2525    15888    3           THEN
     2526    15889    4           DO;

     2527    15890    4               IF VM_SITE.ORIGIN = INTERSYS_INFO.SITENAME THEN GOTO LOOP_ADDRESS;

  15890 16 005666   000000 471400 xsym               LDP1    INTERSYS$
        16 005667   040100 106400                    CMPC    fill='040'O
        16 005670   000065 000010 11                 ADSC9   VM_SITE+2                cn=0,n=8
        16 005671   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8
        16 005672   005704 600000 16                 TZE     LOOP_ADDRESS

     2528    15891    5               DO INDX = 0 TO VM_SITE.NUM_SITES - 1;

  15891 16 005673   002402 450000 11                 STZ     INDX
        16 005674   005726 710000 16                 TRA     s:15907+1

     2529    15892    5                   IF VM_SITE.RECEIVER_SITE(INDX) = INTERSYS_INFO.SITENAME

  15892 16 005675   002402 235000 11                 LDA     INDX
        16 005676   000003 735000                    ALS     3
        16 005677   000000 470400 xsym               LDP0    INTERSYS$
        16 005700   040100 106405                    CMPC    fill='040'O
        16 005701   000067 000010 11                 ADSC9   VM_SITE+4,A              cn=0,n=8
        16 005702   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
        16 005703   005725 601000 16                 TNZ     s:15907

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:368  
     2530    15893    5                   THEN      /* Loop detected */
     2531    15894    6                   DO;

     2532    15895    6   LOOP_ADDRESS:
     2533    15896                                                /* Report error */
     2534    15897    6                       CLOSE_MAIL.V.DISP# = %SCRATCH#;

  15897 16 005704   000001 236007       LOOP_ADDRESS LDQ     1,DL
        16 005705   002370 552004 11                 STBQ    CLOSE_MAIL+26,'04'O

     2535    15898    6                       CALL M$CLOSE (CLOSE_MAIL)

  15898 16 005706   002336 630400 11                 EPPR0   CLOSE_MAIL
        16 005707   450001 713400                    CLIMB   alt,close
        16 005710   406000 401760                    pmme    nvectors=13
        16 005711   005713 702000 16                 TSX2    s:15901
        16 005712   005715 710000 16                 TRA     s:15903

     2536    15899    6                       WHENALTRETURN
     2537    15900    7                       DO;

     2538    15901    7                           CLOSE_MAIL.V.DISP# = %SAVE#;

  15901 16 005713   000002 236007                    LDQ     2,DL
        16 005714   002370 552004 11                 STBQ    CLOSE_MAIL+26,'04'O

     2539    15902    7                       END;

     2540    15903    6                       CALL VOM$DELENTRY (INTERSYS$,%NO#,INTERSYS_HEAD$);

  15903 16 005715   000124 630400 17                 EPPR0   84
        16 005716   000007 631400 17                 EPPR1   7
        16 005717   000000 701000 xent               TSX1    VOM$DELENTRY
        16 005720   000000 011000                    NOP     0

     2541    15904    6                       CLOSE_MAIL.V.DISP# = %SAVE#;

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:369  
  15904 16 005721   000002 236007                    LDQ     2,DL
        16 005722   002370 552004 11                 STBQ    CLOSE_MAIL+26,'04'O

     2542    15905    6                       RETURN;

  15905 16 005723   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 005724   000001 702211                    TSX2  ! 1,X1

     2543    15906    6                   END;
     2544    15907    5               END;             /* Do indx = ... end */

  15907 16 005725   002402 054000 11                 AOS     INDX
        16 005726   002402 236000 11                 LDQ     INDX
        16 005727   005675 604000 16                 TMI     s:15892
        16 005730   000064 116000 11                 CMPQ    VM_SITE+1
        16 005731   005675 602000 16                 TNC     s:15892

     2545    15908    4           END;

     2546    15909        /*
     2547    15910             ***** Now add the current site ...
     2548    15911        */
     2549    15912                       /* The old version updated VM_SITE.  Changed to update and write
     2550    15913                          VM_SITE_T 4/12/83.  This should allow both multiple branches
     2551    15914                          and error return mail. */
     2552    15915    3           VM_SITE_T = VM_SITE;

  15915 16 005732   000000 100400                    MLR     fill='000'O
        16 005733   000063 000340 11                 ADSC9   VM_SITE                  cn=0,n=224
        16 005734   002143 000340 11                 ADSC9   VM_SITE_T                cn=0,n=224

     2553    15916    3           VM_SITE_T.RECEIVER_SITE(VM_SITE_T.NUM_SITES) = INTERSYS_INFO.SITENAME;

  15916 16 005735   002144 235000 11                 LDA     VM_SITE_T+1
        16 005736   000001 735000                    ALS     1
        16 005737   000002 735000                    ALS     2
        16 005740   000000 470400 xsym               LDP0    INTERSYS$
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:370  
        16 005741   040005 100500                    MLR     fill='040'O
        16 005742   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
        16 005743   002147 000010 11                 ADSC9   VM_SITE_T+4,A            cn=0,n=8

     2554    15917    3           VM_SITE_T.NUM_SITES = VM_SITE_T.NUM_SITES + 1;

  15917 16 005744   002144 235000 11                 LDA     VM_SITE_T+1
        16 005745   000001 035007                    ADLA    1,DL
        16 005746   002144 755000 11                 STA     VM_SITE_T+1

     2555    15918    3           CALL VMD$PUT_SITE (VM_SITE_T,DCBNUM(MAIL_OUT)) ALTRET (E_PMME);

  15918 16 005747   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 005750   201272 756100                    STQ     I+1,,AUTO
        16 005751   201272 631500                    EPPR1   I+1,,AUTO
        16 005752   201275 451500                    STP1    I+4,,AUTO
        16 005753   000127 236000 17                 LDQ     87
        16 005754   201274 756100                    STQ     I+3,,AUTO
        16 005755   201274 630500                    EPPR0   I+3,,AUTO
        16 005756   000000 631400 17                 EPPR1   0
        16 005757   000000 701000 xent               TSX1    VMD$PUT_SITE
        16 005760   006150 702000 16                 TSX2    E_PMME

     2556    15919    3           CALL M$CLOSE (CLOSE_MAIL) ALTRET(E_PMME);

  15919 16 005761   002336 630400 11                 EPPR0   CLOSE_MAIL
        16 005762   450001 713400                    CLIMB   alt,close
        16 005763   406000 401760                    pmme    nvectors=13
        16 005764   006150 702000 16                 TSX2    E_PMME

     2557    15920    3           IF SITE_TYPE = %N_EXTERNAL#

  15920 16 005765   200562 235100                    LDA     SITE_TYPE,,AUTO
        16 005766   000157 115007                    CMPA    111,DL
        16 005767   006002 601000 16                 TNZ     s:15927

     2558    15921    4           THEN DO;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:371  

     2559    15922    4               PREFIX = ':MESS';

  15922 16 005770   040100 100400                    MLR     fill='040'O
        16 005771   000611 000005 12                 ADSC9   E_BADSITE+86             cn=0,n=5
        16 005772   201150 000005                    ADSC9   PREFIX,,AUTO             cn=0,n=5

     2560    15923    4               ACCT = EXTERNAL.ACCT;

  15923 16 005773   040100 100500                    MLR     fill='040'O
        16 005774   200565 000010                    ADSC9   EXTERNAL+2,,AUTO         cn=0,n=8
        16 005775   201152 000010                    ADSC9   ACCT,,AUTO               cn=0,n=8

     2561    15924    4               NODE = EXTERNAL.SITENAME;

  15924 16 005776   040100 100500                    MLR     fill='040'O
        16 005777   200563 000010                    ADSC9   EXTERNAL,,AUTO           cn=0,n=8
        16 006000   201154 000010                    ADSC9   NODE,,AUTO               cn=0,n=8

     2562    15925    4           END;

  15925 16 006001   006014 710000 16                 TRA     s:15934

     2563    15926    4           ELSE DO;

     2564    15927    4               PREFIX = ':MOVE';

  15927 16 006002   040100 100400                    MLR     fill='040'O
        16 006003   000621 000005 12                 ADSC9   E_BADSITE+94             cn=0,n=5
        16 006004   201150 000005                    ADSC9   PREFIX,,AUTO             cn=0,n=5

     2565    15928    4               ACCT = VM_MAIL_ACCT.ACCT#;

  15928 16 006005   040100 100400                    MLR     fill='040'O
        16 006006   000000 000010 xsym               ADSC9   VM_MAIL_ACCT             cn=0,n=8
        16 006007   201152 000010                    ADSC9   ACCT,,AUTO               cn=0,n=8

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:372  
     2566    15929    4               NODE = INTERSYS_INFO.SITENAME;

  15929 16 006010   000000 470400 xsym               LDP0    INTERSYS$
        16 006011   040100 100500                    MLR     fill='040'O
        16 006012   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
        16 006013   201154 000010                    ADSC9   NODE,,AUTO               cn=0,n=8

     2567    15930    4           END;

     2568    15931        /* VOM$MOVE is in an overlay to save space, beam is about 12K.
     2569    15932           Since olays can not be done with nowait io pending, cancel the
     2570    15933           comgroup read (if any); */
     2571    15934    3           IF NOT VO_NEED_READ

  15934 16 006014   000000 234000 xsym               SZN     VO_NEED_READ
        16 006015   006021 604000 16                 TMI     s:15936

     2572    15935    3           THEN CALL M$ACTIVATE (CANCEL_READ); /* VOM_EVENT will set flag again */

  15935 16 006016   000430 630400 12                 EPPR0   CANCEL_READ
        16 006017   100000 713400                    CLIMB   32768
        16 006020   401400 401760                    pmme    nvectors=4

     2573    15936    3           FPT_OLAY.V.FLGS.CANCEL# = %NO#;

  15936 16 006021   000130 236000 17                 LDQ     88
        16 006022   002400 356000 11                 ANSQ    FPT_OLAY+4

     2574    15937    4           CALL M$OLAY(FPT_OLAY) WHENALTRETURN DO;

  15937 16 006023   002374 630400 11                 EPPR0   FPT_OLAY
        16 006024   400004 713400                    CLIMB   alt,+4
        16 006025   400400 401760                    pmme    nvectors=2
        16 006026   006030 702000 16                 TSX2    s:15938
        16 006027   006032 710000 16                 TRA     s:15940

     2575    15938    4               CALL M$XXX;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:373  

  15938 16 006030   000003 713400                    CLIMB   3
        16 006031   000000 401760                    pmme    nvectors=0

     2576    15939    4           END;

     2577    15940    3           IF B$JIT.PRIV.ACTIVE.JIT

  15940 16 006032   000000 470400 xsym               LDP0    B$JIT$
        16 006033   000013 236100                    LDQ     11,,PR0
        16 006034   000040 316007                    CANQ    32,DL
        16 006035   006041 600000 16                 TZE     s:15943

     2578    15941    3           THEN
     2579    15942    3               B$JIT.JOBNAME = 'Mail';

  15942 16 006036   040100 100400                    MLR     fill='040'O
        16 006037   000623 000004 12                 ADSC9   E_BADSITE+96             cn=0,n=4
        16 006040   000156 200037                    ADSC9   110,,PR0                 cn=1,n=31

     2580    15943    3           CALL VOM$MOVE (PREFIX, ACCT, NODE)

  15943 16 006041   201154 631500                    EPPR1   NODE,,AUTO
        16 006042   201274 451500                    STP1    I+3,,AUTO
        16 006043   201152 633500                    EPPR3   ACCT,,AUTO
        16 006044   201273 453500                    STP3    I+2,,AUTO
        16 006045   201150 634500                    EPPR4   PREFIX,,AUTO
        16 006046   201272 454500                    STP4    I+1,,AUTO
        16 006047   201272 630500                    EPPR0   I+1,,AUTO
        16 006050   000007 631400 17                 EPPR1   7
        16 006051   000000 701000 xent               TSX1    VOM$MOVE
        16 006052   006070 702000 16                 TSX2    s:15952

     2581    15944    4           WHENRETURN DO;

     2582    15945    4               OPEN_MAIL_CREATE.V.FUN# = %UPDATE#;

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:374  
  15945 16 006053   001000 236007                    LDQ     512,DL
        16 006054   002311 552010 11                 STBQ    OPEN_MAIL_CREATE+37,'10'O

     2583    15946    4               OPEN_MAIL_CREATE.V.DELETE# = %YES#;

  15946 16 006055   040000 236007                    LDQ     16384,DL
        16 006056   002310 256000 11                 ORSQ    OPEN_MAIL_CREATE+36

     2584    15947    5               CALL M$OPEN (OPEN_MAIL_CREATE) WHENALTRETURN DO;

  15947 16 006057   002244 630400 11                 EPPR0   OPEN_MAIL_CREATE
        16 006060   450000 713400                    CLIMB   alt,open
        16 006061   410400 401760                    pmme    nvectors=18
        16 006062   006064 702000 16                 TSX2    s:15949
        16 006063   006064 710000 16                 TRA     s:15949

     2585    15948    5               END;

     2586    15949    4               OPEN_MAIL_CREATE.V.FUN# = %CREATE#;

  15949 16 006064   003000 236007                    LDQ     1536,DL
        16 006065   002311 552010 11                 STBQ    OPEN_MAIL_CREATE+37,'10'O

     2587    15950    4               OPEN_MAIL_CREATE.V.DELETE# = %NO#;

  15950 16 006066   000105 236000 17                 LDQ     69
        16 006067   002310 356000 11                 ANSQ    OPEN_MAIL_CREATE+36

     2588    15951    4           END;

     2589    15952    3           IF VM_HEADER.FROM$ ~= ADDR(NIL)

  15952 16 006070   000000 470400 xsym               LDP0    VM_HEADER$
        16 006071   000023 236100                    LDQ     19,,PR0
        16 006072   000004 116000 17                 CMPQ    4
        16 006073   006110 600000 16                 TZE     s:15956
        16 006074   000000 471400 xsym               LDP1    B$JIT$
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:375  
        16 006075   100013 236100                    LDQ     11,,PR1
        16 006076   000040 316007                    CANQ    32,DL
        16 006077   006110 600000 16                 TZE     s:15956

     2590    15953    3             AND B$JIT.PRIV.ACTIVE.JIT
     2591    15954    3           THEN
     2592    15955    3               B$JIT.JOBNAME = VM_HEADER.FROM$ -> X$STRING.TEXT;

  15955 16 006100   000023 473500                    LDP3    19,,PR0
        16 006101   000100 101500                    MRL     fill='000'O
        16 006102   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        16 006103   201272 000002                    ADSC9   I+1,,AUTO                cn=0,n=2
        16 006104   201272 220100                    LDX0    I+1,,AUTO
        16 006105   040100 100540                    MLR     fill='040'O
        16 006106   300000 200010                    ADSC9   0,,PR3                   cn=1,n=*X0
        16 006107   100156 200037                    ADSC9   110,,PR1                 cn=1,n=31

     2593    15956    3           IF NOT VO_NEED_READ

  15956 16 006110   000000 234000 xsym               SZN     VO_NEED_READ
        16 006111   006115 604000 16                 TMI     s:15958

     2594    15957    3           THEN CALL M$ACTIVATE (CANCEL_READ); /* VOM_EVENT will set flag again */

  15957 16 006112   000430 630400 12                 EPPR0   CANCEL_READ
        16 006113   100000 713400                    CLIMB   32768
        16 006114   401400 401760                    pmme    nvectors=4

     2595    15958    3           FPT_OLAY.V.FLGS.CANCEL# = %YES#;

  15958 16 006115   001000 236003                    LDQ     512,DU
        16 006116   002400 256000 11                 ORSQ    FPT_OLAY+4

     2596    15959    4           CALL M$OLAY(FPT_OLAY) WHENALTRETURN DO;

  15959 16 006117   002374 630400 11                 EPPR0   FPT_OLAY
        16 006120   400004 713400                    CLIMB   alt,+4
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:376  
        16 006121   400400 401760                    pmme    nvectors=2
        16 006122   006124 702000 16                 TSX2    s:15960
        16 006123   006126 710000 16                 TRA     s:15962

     2597    15960    4               CALL M$XXX;

  15960 16 006124   000003 713400                    CLIMB   3
        16 006125   000000 401760                    pmme    nvectors=0

     2598    15961    4           END;

     2599    15962    3           CALL VOM$DELENTRY (INTERSYS$, %NO#, INTERSYS_HEAD$);

  15962 16 006126   000124 630400 17                 EPPR0   84
        16 006127   000007 631400 17                 EPPR1   7
        16 006130   000000 701000 xent               TSX1    VOM$DELENTRY
        16 006131   000000 011000                    NOP     0

     2600    15963    3           IF ONE THEN RETURN;    /* Do only one entry (error reporting) */

  15963 16 006132   201147 470500                    LDP0    @ONE,,AUTO
        16 006133   000000 234100                    SZN     0,,PR0
        16 006134   006137 605000 16                 TPL     s:15964

  15963 16 006135   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 006136   000001 702211                    TSX2  ! 1,X1

     2601    15964    3       END;                            /* Do while ... end */

  15964 16 006137   000000 236000 xsym               LDQ     INTERSYS_HEAD$
        16 006140   000004 116000 17                 CMPQ    4
        16 006141   005316 601000 16                 TNZ     s:15759

     2602    15965    2       RETURN;

  15965 16 006142   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 006143   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:377  

     2603    15966        /**/
     2604    15967    2   E_ALLOCATE:
     2605    15968    2       ERROR = HEADER_MCB.ERR;

  15968 16 006144   000732 236000 11    E_ALLOCATE   LDQ     HEADER_MCB+8
        16 006145   001076 756000 11                 STQ     ERROR

     2606    15969    2       ALTRETURN;

  15969 16 006146   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 006147   000000 702211                    TSX2  ! 0,X1

     2607    15970        /**/
     2608    15971    2   E_PMME:
     2609    15972    2       ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  15972 16 006150   000000 470400 xsym  E_PMME       LDP0    B$TCB$
        16 006151   000000 471500                    LDP1    0,,PR0
        16 006152   100102 236100                    LDQ     66,,PR1
        16 006153   001076 756000 11                 STQ     ERROR

     2610    15973    2       ALTRETURN;

  15973 16 006154   201146 221300                    LDX1  ! DELIVERY_SUMMARY+2,,AUTO
        16 006155   000000 702211                    TSX2  ! 0,X1

     2611    15974        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:378  
     2612    15975    2   BUILD_ADD_LIST: PROC (HEAD$,TYPE);

  15975 16 006156   201156 741300       BUILD_ADD_L* STX1  ! SEND_CURR$,,AUTO

     2613    15976        /***** Parameters *****/
     2614    15977    3   DCL HEAD$ PTR;
     2615    15978    3   DCL TYPE UBIN WORD;
     2616    15979    3   DCL SITENAME CHAR (8);
     2617    15980    3   DCL PTR$ PTR STATIC;
     2618    15981          %VM_RADDRESS (NAME=VM$RADDRESS,STCLASS="BASED(PTR$)");
     2619    16016          %VM_UADDRESS (NAME=VM$UADDRESS,STCLASS="BASED(PTR$)");
     2620    16053        /*
     2621    16054             ***** Create an address record of the specified type
     2622    16055                   which contains only addresses to be delivered by
     2623    16056                   the mailman at the site specified in INTERSYS_INFO ...
     2624    16057        */
     2625    16058    3       VM_ADD_HEAD.NUM_ENTRIES = 0;

  16058 16 006157   000000 470400 xsym               LDP0    VM_ADDLIST$
        16 006160   000001 450100                    STZ     1,,PR0

     2626    16059    3       PTR$ = HEAD$;

  16059 16 006161   201157 471500                    LDP1    @HEAD$,,AUTO
        16 006162   100000 236100                    LDQ     0,,PR1
        16 006163   002403 756000 11                 STQ     PTR$

     2627    16060    4       DO WHILE (PTR$ ~= ADDR(NIL));

  16060 16 006164   006264 710000 16                 TRA     s:16080

     2628    16061    4           CALL VMA$GET_SITE_NAME (VM$RADDRESS.SITENAME, SITENAME);

  16061 16 006165   201161 630500                    EPPR0   SITENAME,,AUTO
        16 006166   201273 450500                    STP0    I+2,,AUTO
        16 006167   002403 236000 11                 LDQ     PTR$
        16 006170   000131 036000 17                 ADLQ    89
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:379  
        16 006171   201272 756100                    STQ     I+1,,AUTO
        16 006172   201272 630500                    EPPR0   I+1,,AUTO
        16 006173   000000 631400 17                 EPPR1   0
        16 006174   000000 701000 xent               TSX1    VMA$GET_SITE_NAME
        16 006175   000000 011000                    NOP     0

     2629    16062    4           IF SITENAME = INTERSYS_INFO.SITENAME

  16062 16 006176   000000 470400 xsym               LDP0    INTERSYS$
        16 006177   040100 106500                    CMPC    fill='040'O
        16 006200   201161 000010                    ADSC9   SITENAME,,AUTO           cn=0,n=8
        16 006201   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
        16 006202   006261 601000 16                 TNZ     s:16079

     2630    16063    4           THEN
     2631    16064    5           DO;                    /* Found one */

     2632    16065    5               IF VM$RADDRESS.TYPE = %VM_ADD_RESOLVED

  16065 16 006203   002403 471400 11                 LDP1    PTR$
        16 006204   100002 236100                    LDQ     2,,PR1
        16 006205   000777 376003                    ANQ     511,DU
        16 006206   000001 116003                    CMPQ    1,DU
        16 006207   006235 601000 16                 TNZ     s:16074

     2633    16066    5               THEN
     2634    16067    6               DO;

     2635    16068    6                   CALL VMA$ADD_RENTRY (VM$RADDRESS.ACCT,

  16068 16 006210   002403 236000 11                 LDQ     PTR$
        16 006211   000132 036000 17                 ADLQ    90
        16 006212   000006 235000 17                 LDA     6
        16 006213   201276 757100                    STAQ    I+5,,AUTO
        16 006214   002403 236000 11                 LDQ     PTR$
        16 006215   000131 036000 17                 ADLQ    89
        16 006216   201275 756100                    STQ     I+4,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:380  
        16 006217   002403 236000 11                 LDQ     PTR$
        16 006220   000133 036000 17                 ADLQ    91
        16 006221   201274 756100                    STQ     I+3,,AUTO
        16 006222   002403 236000 11                 LDQ     PTR$
        16 006223   000134 036000 17                 ADLQ    92
        16 006224   201273 756100                    STQ     I+2,,AUTO
        16 006225   002403 236000 11                 LDQ     PTR$
        16 006226   000135 036000 17                 ADLQ    93
        16 006227   201272 756100                    STQ     I+1,,AUTO
        16 006230   201272 630500                    EPPR0   I+1,,AUTO
        16 006231   000063 631400 17                 EPPR1   51
        16 006232   000000 701000 xent               TSX1    VMA$ADD_RENTRY
        16 006233   006307 702000 16                 TSX2    E_ADD

     2636    16069    6                     VM$RADDRESS.FOLDER,VM$RADDRESS.PASS,VM$RADDRESS.SITENAME,
     2637    16070    6                     %NO#,VM$RADDRESS.NAME_KEY) ALTRET(E_ADD);
     2638    16071    6               END;

  16071 16 006234   006261 710000 16                 TRA     s:16079

     2639    16072    5               ELSE
     2640    16073    6               DO;

     2641    16074    6                   CALL VMA$ADD_UENTRY (VM$UADDRESS.USER_NAME,

  16074 16 006235   002403 236000 11                 LDQ     PTR$
        16 006236   000132 036000 17                 ADLQ    90
        16 006237   000006 235000 17                 LDA     6
        16 006240   201276 757100                    STAQ    I+5,,AUTO
        16 006241   002403 236000 11                 LDQ     PTR$
        16 006242   000131 036000 17                 ADLQ    89
        16 006243   201275 756100                    STQ     I+4,,AUTO
        16 006244   002403 236000 11                 LDQ     PTR$
        16 006245   000133 036000 17                 ADLQ    91
        16 006246   201274 756100                    STQ     I+3,,AUTO
        16 006247   002403 236000 11                 LDQ     PTR$
        16 006250   000134 036000 17                 ADLQ    92
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:381  
        16 006251   201273 756100                    STQ     I+2,,AUTO
        16 006252   002403 236000 11                 LDQ     PTR$
        16 006253   000135 036000 17                 ADLQ    93
        16 006254   201272 756100                    STQ     I+1,,AUTO
        16 006255   201272 630500                    EPPR0   I+1,,AUTO
        16 006256   000063 631400 17                 EPPR1   51
        16 006257   000000 701000 xent               TSX1    VMA$ADD_UENTRY
        16 006260   006307 702000 16                 TSX2    E_ADD

     2642    16075    6                     VM$UADDRESS.FOLDER,VM$UADDRESS.PASS,VM$UADDRESS.SITENAME,
     2643    16076    6                     %NO#,VM$UADDRESS.NAME_KEY) ALTRET(E_ADD);
     2644    16077    6               END;

     2645    16078    5           END;

     2646    16079    4           PTR$ = PTR$ -> VM$RADDRESS.NEXT$;

  16079 16 006261   002403 470400 11                 LDP0    PTR$
        16 006262   000000 236100                    LDQ     0,,PR0
        16 006263   002403 756000 11                 STQ     PTR$

     2647    16080    4       END;                            /* Do while ... end */

  16080 16 006264   000004 116000 17                 CMPQ    4
        16 006265   006165 601000 16                 TNZ     s:16061

     2648    16081        /*
     2649    16082             ***** Now write it ...
     2650    16083        */
     2651    16084    3       IF VM_ADD_HEAD.NUM_ENTRIES > 0

  16084 16 006266   000000 470400 xsym               LDP0    VM_ADDLIST$
        16 006267   000001 235100                    LDA     1,,PR0
        16 006270   006305 600000 16                 TZE     s:16087

     2652    16085    3       THEN
     2653    16086    3           CALL VMA$PUT_ADD_RECORD (TYPE,VM_ADDLIST_,DCBNUM(MAIL_OUT));
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:382  

  16086 16 006271   000000 236007 xsym               LDQ     MAIL_OUT,DL
        16 006272   201272 756100                    STQ     I+1,,AUTO
        16 006273   201272 631500                    EPPR1   I+1,,AUTO
        16 006274   201275 451500                    STP1    I+4,,AUTO
        16 006275   000136 236000 17                 LDQ     94
        16 006276   201274 756100                    STQ     I+3,,AUTO
        16 006277   201160 236100                    LDQ     @TYPE,,AUTO
        16 006300   201273 756100                    STQ     I+2,,AUTO
        16 006301   201273 630500                    EPPR0   I+2,,AUTO
        16 006302   000007 631400 17                 EPPR1   7
        16 006303   000000 701000 xent               TSX1    VMA$PUT_ADD_RECORD
        16 006304   000000 011000                    NOP     0

     2654    16087    3       RETURN;

  16087 16 006305   201156 221300                    LDX1  ! SEND_CURR$,,AUTO
        16 006306   000001 702211                    TSX2  ! 1,X1

     2655    16088        /**/
     2656    16089    3   E_ADD:
     2657    16090    3       RETURN;                           /* ????? */

  16090 16 006307   201156 221300       E_ADD        LDX1  ! SEND_CURR$,,AUTO
        16 006310   000001 702211                    TSX2  ! 1,X1

     2658    16091    3   END BUILD_ADD_LIST;
     2659    16092    2   END TRANSPORT_INTERSYS;
     2660    16093        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:383  
     2661    16094        /*********************************************************************/
     2662    16095        /*F*
     2663    16096             NAME:        BUILD_INTERSYS_LIST
     2664    16097             PURPOSE:     To create the INTERSYS_INFO list.
     2665    16098             DESCRIPTION: This routine will create a list of all
     2666    16099                          non-local sites which must receive a copy
     2667    16100                          of the messaae currently being processed.
     2668    16101        */
     2669    16102        /*********************************************************************/
     2670    16103    1   BUILD_INTERSYS_LIST: PROC ALTRET;

  16103 16 006311   201150 741300       BUILD_INTER* STX1  ! PREFIX,,AUTO

     2671    16104        /***** Local variables *****/
     2672    16105    2   DCL KEY_VALUE CHAR(8) CALIGNED;
     2673    16106    2   DCL INDX SBIN WORD STATIC;
     2674    16107    2   DCL INDX1 UBIN;
     2675    16108    2   DCL SITENAME CHAR(8) CALIGNED;
     2676    16109        /***** Error codes *****/
     2677    16110          %VLP_ERRCODE (FPTN=E_BADSITE,FCG="VO",MID="M",
     2678    16111                        ERR#=%E$BADSITE,STCLASS=CONSTANT);
     2679    16156        /*E* ERROR: VOM-E$BADSITE-0
     2680    16157             MESSAGE: The site specified in the address is not defined
     2681    16158        */
     2682    16159        %EJECT;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:384  
     2683    16160        /**/
     2684    16161    2       CALL XLATE (KEY_VALUE, LOWER_UPPER, VM_RADDRESS.SITENAME);

  16161 16 006312   000000 470400 xsym               LDP0    B$XL_UPPER$
        16 006313   040100 160400                    MVT     fill='040'O
        16 006314   000235 600010 11                 ADSC9   VM_RADDRESS+15           cn=3,n=8
        16 006315   201151 000010                    ADSC9   KEY_VALUE,,AUTO          cn=0,n=8
        16 006316   000000 000100                    ARG     0,,PR0

     2685    16162    2       IF KEY_VALUE = VM_SITENAME

  16162 16 006317   040000 106500                    CMPC    fill='040'O
        16 006320   201151 000010                    ADSC9   KEY_VALUE,,AUTO          cn=0,n=8
        16 006321   000000 000010 xsym               ADSC9   VM_SITENAME              cn=0,n=8
        16 006322   006324 601000 16                 TNZ     s:16168

     2686    16163    2       THEN                            /* Don't send to this site */
     2687    16164    2           RETURN;

  16164 16 006323   000001 702211                    TSX2  ! 1,X1

     2688    16165        /*
     2689    16166             ***** Check that this site exists ...
     2690    16167        */
     2691    16168    2       CALL VMA$GET_SITE_NAME(KEY_VALUE,SITENAME) ALTRET(NO_SITE);

  16168 16 006324   201154 631500                    EPPR1   SITENAME,,AUTO
        16 006325   201273 451500                    STP1    I+2,,AUTO
        16 006326   201151 633500                    EPPR3   KEY_VALUE,,AUTO
        16 006327   201272 453500                    STP3    I+1,,AUTO
        16 006330   201272 630500                    EPPR0   I+1,,AUTO
        16 006331   000000 631400 17                 EPPR1   0
        16 006332   000000 701000 xent               TSX1    VMA$GET_SITE_NAME
        16 006333   006576 702000 16                 TSX2    NO_SITE

     2692    16169        /*
     2693    16170             ***** Search the list. If already defined then
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:385  
     2694    16171                   don't define again ...
     2695    16172        */
     2696    16173    2       INTERSYS$ = INTERSYS_HEAD$;

  16173 16 006334   000000 236000 xsym               LDQ     INTERSYS_HEAD$
        16 006335   000000 756000 xsym               STQ     INTERSYS$

     2697    16174    3       DO WHILE (INTERSYS$ ~= ADDR(NIL));

  16174 16 006336   006351 710000 16                 TRA     s:16180

     2698    16175    3           IF INTERSYS_INFO.SITENAME = SITENAME

  16175 16 006337   000000 470400 xsym               LDP0    INTERSYS$
        16 006340   040100 106500                    CMPC    fill='040'O
        16 006341   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
        16 006342   201154 000010                    ADSC9   SITENAME,,AUTO           cn=0,n=8
        16 006343   006347 601000 16                 TNZ     s:16179
        16 006344   000000 471400 xsym               LDP1    VM_HEADER$
        16 006345   100012 234100                    SZN     10,,PR1
        16 006346   006427 605000 16                 TPL     ADD_ADDRESS

     2699    16176    3             AND NOT VM_HEADER.STATUS.ERR /* do it anyway if error */
     2700    16177    3           THEN                       /* Already defined */
     2701    16178    3               GOTO ADD_ADDRESS;
     2702    16179    3           INTERSYS$ = INTERSYS_INFO.NEXT$;

  16179 16 006347   000000 236100                    LDQ     0,,PR0
        16 006350   000000 756000 xsym               STQ     INTERSYS$

     2703    16180    3       END;                            /* Do while ... end */

  16180 16 006351   000004 116000 17                 CMPQ    4
        16 006352   006337 601000 16                 TNZ     s:16175

     2704    16181        /*
     2705    16182             ***** Add it to the list ...
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:386  
     2706    16183        */
     2707    16184    2       CALL VOM$ADDENTRY (INTERSYS$,%NO#,INTERSYS_HEAD$);

  16184 16 006353   000124 630400 17                 EPPR0   84
        16 006354   000007 631400 17                 EPPR1   7
        16 006355   000000 701000 xent               TSX1    VOM$ADDENTRY
        16 006356   000000 011000                    NOP     0

     2708    16185    2       INTERSYS_INFO.SITENAME = SITENAME;

  16185 16 006357   000000 470400 xsym               LDP0    INTERSYS$
        16 006360   201154 237100                    LDAQ    SITENAME,,AUTO
        16 006361   000002 755100                    STA     2,,PR0
        16 006362   000003 756100                    STQ     3,,PR0

     2709    16186    2       CALL M$TIME(GET_CURRENT);

  16186 16 006363   001300 630400 11                 EPPR0   GET_CURRENT
        16 006364   020004 713400                    CLIMB   8196
        16 006365   402000 401760                    pmme    nvectors=5

     2710    16187    2       CALL BINCHAR (INTERSYS_INFO.NAME,CURRENT_TIME);

  16187 16 006366   001657 235000 11                 LDA     CURRENT_TIME
        16 006367   000044 773000                    LRL     36
        16 006370   201272 757100                    STAQ    I+1,,AUTO
        16 006371   000000 470400 xsym               LDP0    INTERSYS$
        16 006372   000100 301500                    BTD
        16 006373   201272 000010                    NDSC9   I+1,,AUTO                cn=0,s=lsgnf,sf=0,n=8
        16 006374   000004 030023                    NDSC9   4,,PR0                   cn=0,s=nosgn,sf=0,n=19

     2711    16188    2       CALL INDEX(INDX1,' ',SUBSTR(VM_SITENAME,0,4));

  16188 16 006375   000000 124400                    SCM     mask='000'O
        16 006376   000000 000004 xsym               ADSC9   VM_SITENAME              cn=0,n=4
        16 006377   000023 000001 17                 ADSC9   19                       cn=0,n=1
        16 006400   201153 000100                    ARG     INDX1,,AUTO
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:387  

     2712    16189    2       CALL INSERT(INTERSYS_INFO.NAME,0,INDX1,VM_SITENAME);

  16189 16 006401   201153 720100                    LXL0    INDX1,,AUTO
        16 006402   040140 100400                    MLR     fill='040'O
        16 006403   000000 000010 xsym               ADSC9   VM_SITENAME              cn=0,n=8
        16 006404   000004 000010                    ADSC9   4,,PR0                   cn=0,n=*X0

     2713    16190    2       CALL INDEX(INDX,' ',SUBSTR(SITENAME,0,4));

  16190 16 006405   000000 124500                    SCM     mask='000'O
        16 006406   201154 000004                    ADSC9   SITENAME,,AUTO           cn=0,n=4
        16 006407   000023 000001 17                 ADSC9   19                       cn=0,n=1
        16 006410   002404 000000 11                 ARG     INDX

     2714    16191    2       CALL INSERT (INTERSYS_INFO.NAME,INDX1,INDX+1,':',SITENAME);

  16191 16 006411   002404 721000 11                 LXL1    INDX
        16 006412   000001 622011                    EAX2    1,X1
        16 006413   201153 235100                    LDA     INDX1,,AUTO
        16 006414   040145 100400                    MLR     fill='040'O
        16 006415   000137 000001 17                 ADSC9   95                       cn=0,n=1
        16 006416   000004 000012                    ADSC9   4,A,PR0                  cn=0,n=*X2
        16 006417   002404 236000 11                 LDQ     INDX
        16 006420   000000 116003                    CMPQ    0,DU
        16 006421   006427 604400 16                 TMOZ    ADD_ADDRESS
        16 006422   000000 470400 xsym               LDP0    INTERSYS$
        16 006423   000000 623006                    EAX3    0,QL
        16 006424   040145 100500                    MLR     fill='040'O
        16 006425   201154 000010                    ADSC9   SITENAME,,AUTO           cn=0,n=8
        16 006426   000004 200013                    ADSC9   4,A,PR0                  cn=1,n=*X3

     2715    16192        /*
     2716    16193             ***** Copy this address to the appropriate list
     2717    16194                   so that it can be written into the :XMIT file
     2718    16195                   for use by the receiving mailman ...
     2719    16196        */
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:388  
     2720    16197    2   ADD_ADDRESS:
     2721    16198    2       IF VM_RADDRESS.TYPE = %VM_ADD_RESOLVED

  16198 16 006427   000220 236000 11    ADD_ADDRESS  LDQ     VM_RADDRESS+2
        16 006430   000777 376003                    ANQ     511,DU
        16 006431   000001 116003                    CMPQ    1,DU
        16 006432   006436 601000 16                 TNZ     s:16203

     2722    16199    2       THEN
     2723    16200    2           IADDLIST_MCB.SIZE = SIZEC(VM_RADDRESS);

  16200 16 006433   000120 235007                    LDA     80,DL
        16 006434   000717 755000 11                 STA     IADDLIST_MCB+6
        16 006435   006442 710000 16                 TRA     s:16206

     2724    16201    2       ELSE
     2725    16202    3       DO;

     2726    16203    3           IADDLIST_MCB.SIZE = SIZEC(VM_UADDRESS) -

  16203 16 006436   000263 236000 11                 LDQ     VM_UADDRESS+17
        16 006437   000777 376007                    ANQ     511,DL
        16 006440   000110 036007                    ADLQ    72,DL
        16 006441   000717 756000 11                 STQ     IADDLIST_MCB+6

     2727    16204    3             SIZEC(VM_UADDRESS.USER_NAME.TEXT) + VM_UADDRESS.USER_NAME.COUNT;
     2728    16205    3       END;

     2729    16206    2       CALL X$ALLOCATE (IADDLIST_MCB)

  16206 16 006442   000140 630400 17                 EPPR0   96
        16 006443   000025 631400 17                 EPPR1   21
        16 006444   000000 701000 xent               TSX1    X$ALLOCATE
        16 006445   006447 702000 16                 TSX2    s:16209
        16 006446   006464 710000 16                 TRA     s:16213

     2730    16207    2       WHENALTRETURN
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:389  
     2731    16208    3       DO;

     2732    16209    3           CALL VMA$ENLARGE_SEGMENT (VM_COPY_,1024) ALTRET(E_PMME);

  16209 16 006447   000141 630400 17                 EPPR0   97
        16 006450   000000 631400 17                 EPPR1   0
        16 006451   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        16 006452   006606 702000 16                 TSX2    E_PMME

     2733    16210    3           IADDLIST_MCB.WKSZ = (VBOUND(VM_COPY_)+1)/4;

  16210 16 006453   000000 236000 xsym               LDQ     VM_COPY_
        16 006454   000020 772000                    QRL     16
        16 006455   000001 036007                    ADLQ    1,DL
        16 006456   000002 772000                    QRL     2
        16 006457   000715 756000 11                 STQ     IADDLIST_MCB+4

     2734    16211    3           CALL X$ALLOCATE (IADDLIST_MCB) ALTRET(E_ALLOCATE);

  16211 16 006460   000140 630400 17                 EPPR0   96
        16 006461   000025 631400 17                 EPPR1   21
        16 006462   000000 701000 xent               TSX1    X$ALLOCATE
        16 006463   006602 702000 16                 TSX2    E_ALLOCATE

     2735    16212    3       END;

     2736    16213    2       IADDLIST_MCB.ADDRESS$ -> VM$RADDRESS.FOLDER = VM_RADDRESS.FOLDER;

  16213 16 006464   000711 470400 11                 LDP0    IADDLIST_MCB
        16 006465   040100 100400                    MLR     fill='040'O
        16 006466   000225 400031 11                 ADSC9   VM_RADDRESS+7            cn=2,n=25
        16 006467   000007 400031                    ADSC9   7,,PR0                   cn=2,n=25

     2737    16214    2       IADDLIST_MCB.ADDRESS$ -> VM$RADDRESS.PASS = VM_RADDRESS.PASS;

  16214 16 006470   000711 470400 11                 LDP0    IADDLIST_MCB
        16 006471   040100 100400                    MLR     fill='040'O
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:390  
        16 006472   000233 600010 11                 ADSC9   VM_RADDRESS+13           cn=3,n=8
        16 006473   000015 600010                    ADSC9   13,,PR0                  cn=3,n=8

     2738    16215    2       IADDLIST_MCB.ADDRESS$ -> VM$RADDRESS.SITENAME = VM_RADDRESS.SITENAME;

  16215 16 006474   000711 470400 11                 LDP0    IADDLIST_MCB
        16 006475   040100 100400                    MLR     fill='040'O
        16 006476   000235 600010 11                 ADSC9   VM_RADDRESS+15           cn=3,n=8
        16 006477   000017 600010                    ADSC9   15,,PR0                  cn=3,n=8

     2739    16216    2       IADDLIST_MCB.ADDRESS$ -> VM$RADDRESS.TYPE = VM_RADDRESS.TYPE;

  16216 16 006500   000711 470400 11                 LDP0    IADDLIST_MCB
        16 006501   000220 236000 11                 LDQ     VM_RADDRESS+2
        16 006502   000002 552120                    STBQ    2,'20'O,PR0

     2740    16217    2       IF VM_RADDRESS.TYPE = %VM_ADD_RESOLVED

  16217 16 006503   000220 236000 11                 LDQ     VM_RADDRESS+2
        16 006504   000777 376003                    ANQ     511,DU
        16 006505   000001 116003                    CMPQ    1,DU
        16 006506   006514 601000 16                 TNZ     s:16222

     2741    16218    2       THEN
     2742    16219    2           IADDLIST_MCB.ADDRESS$ -> VM$RADDRESS.ACCT = VM_RADDRESS.ACCT;

  16219 16 006507   000711 470400 11                 LDP0    IADDLIST_MCB
        16 006510   040100 100400                    MLR     fill='040'O
        16 006511   000237 600010 11                 ADSC9   VM_RADDRESS+17           cn=3,n=8
        16 006512   000021 600010                    ADSC9   17,,PR0                  cn=3,n=8
        16 006513   006525 710000 16                 TRA     s:16228

     2743    16220    2       ELSE
     2744    16221    3       DO;

     2745    16222    3           IADDLIST_MCB.ADDRESS$ -> VM$UADDRESS.USER_NAME.COUNT =

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:391  
  16222 16 006514   000711 470400 11                 LDP0    IADDLIST_MCB
        16 006515   000263 236000 11                 LDQ     VM_UADDRESS+17
        16 006516   000021 552104                    STBQ    17,'04'O,PR0

     2746    16223    3             VM_UADDRESS.USER_NAME.COUNT;
     2747    16224    3           CALL INSERT (IADDLIST_MCB.ADDRESS$ -> VM$UADDRESS.USER_NAME.TEXT,

  16224 16 006517   000263 720000 11                 LXL0    VM_UADDRESS+17
        16 006520   000777 360003                    ANX0    511,DU
        16 006521   000711 470400 11                 LDP0    IADDLIST_MCB
        16 006522   040140 100400                    MLR     fill='040'O
        16 006523   000264 000310 11                 ADSC9   VM_UADDRESS+18           cn=0,n=200
        16 006524   000022 000010                    ADSC9   18,,PR0                  cn=0,n=*X0

     2748    16225    3             0,VM_UADDRESS.USER_NAME.COUNT,
     2749    16226    3             VM_UADDRESS.USER_NAME.TEXT);
     2750    16227    3       END;

     2751    16228    3       DO CASE (ADD_TYPE);

  16228 16 006525   200240 235100                    LDA     ADD_TYPE,,AUTO
        16 006526   000020 135007                    SBLA    16,DL
        16 006527   000021 115007                    CMPA    17,DL
        16 006530   006532 602005 16                 TNC     s:16228+5,AL
        16 006531   006574 710000 16                 TRA     s:16239
        16 006532   006553 710000 16                 TRA     s:16230
        16 006533   006574 710000 16                 TRA     s:16239
        16 006534   006574 710000 16                 TRA     s:16239
        16 006535   006574 710000 16                 TRA     s:16239
        16 006536   006574 710000 16                 TRA     s:16239
        16 006537   006574 710000 16                 TRA     s:16239
        16 006540   006574 710000 16                 TRA     s:16239
        16 006541   006574 710000 16                 TRA     s:16239
        16 006542   006567 710000 16                 TRA     s:16236
        16 006543   006574 710000 16                 TRA     s:16239
        16 006544   006574 710000 16                 TRA     s:16239
        16 006545   006574 710000 16                 TRA     s:16239
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:392  
        16 006546   006574 710000 16                 TRA     s:16239
        16 006547   006574 710000 16                 TRA     s:16239
        16 006550   006574 710000 16                 TRA     s:16239
        16 006551   006574 710000 16                 TRA     s:16239
        16 006552   006561 710000 16                 TRA     s:16233

     2752    16229    3       CASE (%VM_TYPE_TO);

     2753    16230    3           IADDLIST_MCB.ADDRESS$ -> VM$RADDRESS.NEXT$ = ITO_HEAD$;

  16230 16 006553   000706 236000 11                 LDQ     ITO_HEAD$
        16 006554   000711 470400 11                 LDP0    IADDLIST_MCB
        16 006555   000000 756100                    STQ     0,,PR0

     2754    16231    3           ITO_HEAD$ = IADDLIST_MCB.ADDRESS$;

  16231 16 006556   000711 236000 11                 LDQ     IADDLIST_MCB
        16 006557   000706 756000 11                 STQ     ITO_HEAD$
        16 006560   006574 710000 16                 TRA     s:16239

     2755    16232    3       CASE (%VM_TYPE_BC);

     2756    16233    3           IADDLIST_MCB.ADDRESS$ -> VM$RADDRESS.NEXT$ = IBC_HEAD$;

  16233 16 006561   000707 236000 11                 LDQ     IBC_HEAD$
        16 006562   000711 470400 11                 LDP0    IADDLIST_MCB
        16 006563   000000 756100                    STQ     0,,PR0

     2757    16234    3           IBC_HEAD$ = IADDLIST_MCB.ADDRESS$;

  16234 16 006564   000711 236000 11                 LDQ     IADDLIST_MCB
        16 006565   000707 756000 11                 STQ     IBC_HEAD$
        16 006566   006574 710000 16                 TRA     s:16239

     2758    16235    3       CASE (%VM_TYPE_C);

     2759    16236    3           IADDLIST_MCB.ADDRESS$ -> VM$RADDRESS.NEXT$ = IC_HEAD$;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:393  

  16236 16 006567   000710 236000 11                 LDQ     IC_HEAD$
        16 006570   000711 470400 11                 LDP0    IADDLIST_MCB
        16 006571   000000 756100                    STQ     0,,PR0

     2760    16237    3           IC_HEAD$ = IADDLIST_MCB.ADDRESS$;

  16237 16 006572   000711 236000 11                 LDQ     IADDLIST_MCB
        16 006573   000710 756000 11                 STQ     IC_HEAD$

     2761    16238    3       END;                             /* Do case ... end */

     2762    16239    2       RETURN;

  16239 16 006574   201150 221300                    LDX1  ! PREFIX,,AUTO
        16 006575   000001 702211                    TSX2  ! 1,X1

  16235 16 006576                       NO_SITE      null
     2763    16240        /**/
     2764    16241    2   NO_SITE: ;
     2765    16242    2       ERROR = E_BADSITE;

  16242 16 006576   000463 236000 12                 LDQ     E_BADSITE
        16 006577   001076 756000 11                 STQ     ERROR

     2766    16243    2       ALTRETURN;

  16243 16 006600   201150 221300                    LDX1  ! PREFIX,,AUTO
        16 006601   000000 702211                    TSX2  ! 0,X1

     2767    16244        /**/
     2768    16245    2   E_ALLOCATE:
     2769    16246    2       ERROR = IADDLIST_MCB.ERR;

  16246 16 006602   000721 236000 11    E_ALLOCATE   LDQ     IADDLIST_MCB+8
        16 006603   001076 756000 11                 STQ     ERROR

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:394  
     2770    16247    2       ALTRETURN;

  16247 16 006604   201150 221300                    LDX1  ! PREFIX,,AUTO
        16 006605   000000 702211                    TSX2  ! 0,X1

     2771    16248        /**/
     2772    16249    2   E_PMME:
     2773    16250    2       ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  16250 16 006606   000000 470400 xsym  E_PMME       LDP0    B$TCB$
        16 006607   000000 471500                    LDP1    0,,PR0
        16 006610   100102 236100                    LDQ     66,,PR1
        16 006611   001076 756000 11                 STQ     ERROR

     2774    16251    2       ALTRETURN;

  16251 16 006612   201150 221300                    LDX1  ! PREFIX,,AUTO
        16 006613   000000 702211                    TSX2  ! 0,X1

VM_USERKEY
 Sect OctLoc
  11     000   311120 ******   ****** ******   ****** ******   ****** ******    .P..............
  11     060*  ****** ******   ****** ******   ****** ******                    ............

VM_SITE
 Sect OctLoc
  11     063   000000 000000   000000 000000   040040 040040   040040 040040    ........
  11     147*  ****** ******   ****** ******   ****** ******   ****** ******    ................

VM_SEARCH_INFO
 Sect OctLoc
  11     153   ****** ******   000000 000000   000000 000000   000000 000000    ................
  11     157   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11     213*  000000 000000   000000 000000   00**** ******                    ............

VM_RADDRESS
 Sect OctLoc
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:395  
  11     216   000000 006014   000000 006014   000001 040040   040040 040040    ..........
  11     222   040040 040040   040040 040040   040040 040040   040040 040040
  11     236*  040040 040040   040040 040040   040040 040040   040040 040***                   .

VM_UADDRESS
 Sect OctLoc
  11     242   000000 006014   000000 006014   000002 040040   040040 040040    ..........
  11     246   040040 040040   040040 040040   040040 040040   040040 040040
  11     262*  040040 040040   040040 040000   040040 040040   040040 040040           .
  11     266   040040 040040   040040 040040   040040 040040   040040 040040
  11     342*  040040 040040   040040 040040   040040 040040   040040 040040

VM_RETURN_ADDRESS
 Sect OctLoc
  11     346   000000 006014   000000 006014   000001 040040   040040 040040    ..........
  11     352   040040 040040   040040 040040   040040 040040   040040 040040
  11     366*  040040 040040   040040 040040   040040 040040   040040 040***                   .

VM_FOLDER_INFO
 Sect OctLoc
  11     372   040040 040040   040040 040040   040040 040040   040040 040040
  11     406*  040040 040040   040040 040***   000000 000000   000000 000000           .........
  11     412   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11     416   000040 040040   040040 040040   040040 040040   040040 040040    .
  11     422   040040 040040   040040 040040   040040 040040   040040 040040
  11     476*  040040 040040   040040 040040   040*** ******                             ...

BLIND_TEXT
 Sect OctLoc
  11     506   037040 040040   040040 040040   040040 040040   040040 040040    .
  11     512   040040 040040   040040 040040   040040 040040   040040 040040
  11     702*  040040 040040   040040 040040   040040 040040   040040 040040

IADDLIST_MCB
 Sect OctLoc
  11     711   ****** ******   ****** ******   ****** ******   ****** ******    ................

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:396  
HEADER_MCB
 Sect OctLoc
  11     722   ****** ******   ****** ******   ****** ******   ****** ******    ................

CLOSE_MAIL_OUT
 Sect OctLoc
  11     734   000003 777640   000766 006000   000000 177640   000000 006014    ................
  11     740   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11     764*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
  11     770   000220 000000   000000 000000                                    ........

CLOSE_MAIL_OUT_RELEASE
 Sect OctLoc
  11     772   000003 777640   001024 006000   000000 177640   000000 006014    ................
  11     776   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    1022*  000000 177640   000000 006014   000000 000001   000000 000040    ...............
  11    1026   000220 000000   000000 000000                                    ........

RENAME_BAD_FILE
 Sect OctLoc
  11    1030   000003 777640   001062 006000   000000 177640   000000 006014    .....2..........
  11    1034   000000 177640   000000 006014   000007 777640   001066 006000    .............6..
  11    1040   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    1060*  000000 177640   000000 006014   000000 000000   000000 000040    ...............
  11    1064   000220 000000   000000 000000                                    ........

NEW_NAME
 Sect OctLoc
  11    1066   037040 040040   040040 040040   040040 040040   040040 040040    .
  11    1072   040040 040040   040040 040040   040040 040040   040040 040040

ERROR
 Sect OctLoc
  11    1076   000000 000000                                                    ....

WORK_TEXTC
 Sect OctLoc
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:397  
  11    1077   037040 040040   040040 040040   040040 040040   040040 040040    .
  11    1103   040040 040040   040040 040040   040040 040040   040040 040040
  11    1273*  040040 040040   040040 040040   040040 040040   040040 040040

GET_CURRENT
 Sect OctLoc
  11    1300   000001 777640   001312 006000   000000 177640   000000 006014    ................
  11    1304   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    1310   000000 777640   001657 006000   000004 000000   ****** ******    ................

VM_HEADRES
 Sect OctLoc
  11    1314   004000 000000   000*** ******                                    ........

REL_PACK
 Sect OctLoc
  11    1316   000005 777640   001332 006000   000000 177640   000000 006014    ................
  11    1322   000000 177640   000000 006014   000315 777640   001340 006000    ................
  11    1326   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    1332   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11    1336   000000 000000   000000 000000                                    ........

RPSN
 Sect OctLoc
  11    1340   000000 000062   000000 000000   040040 040040   040040 001002    ...2....      ..
  11    1344   000000 000000   000000 000000   040040 040040   040040 000002    ........      ..
  11    1654*  000000 000000   000000 000000                                    ........

CREATE_SEND
 Sect OctLoc
  11    1660   000025 777640   001724 006000   000000 177640   000000 006014    ................
  11    1664   000000 177640   000000 006014   000007 777640   001752 006000    ................
  11    1670   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    1704*  000001 777640   000000 006000   000000 177640   000000 006014    ................
  11    1710   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    1724*  000000 400242   000000 003001   252525 002002   000040 252520    ............. ..
  11    1730   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:398  
  11    1734   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11    1740   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
  11    1744   040040 040040   000000 000000   000000 000000   000000 000000        ............
  11    1750   000000 000000   ****** ******                                    ........

SEND_NAME
 Sect OctLoc
  11    1752   031040 040040   040040 040040   040040 040040   040040 040040    .
  11    1756   040040 040040   040040 040040   040040 040040   040040 040040

VM_BODYREC
 Sect OctLoc
  11    1762   001000 000000   ****** ******   ****** ******   ****** ******    ................
  11    2076*  ****** ******                                                    ....

VM_CGOUT
 Sect OctLoc
  11    2077   040040 040040   040040 040040   000000 000000   000040 040040            .....
  11    2103   040040 040040   040040 040040   040040 040040   040040 040040
  11    2107   040040 040040   040040 000000   040040 040040   040040 040040          ..
  11    2113   040040 040040   040040 040040   040040 040040   040040 040040
  11    2117   040040 040040   040040 040040   000040 040040   040040 040040            .
  11    2123   040040 040040   040040 040040   040040 040040   040040 040040
  11    2127   040040 040040   040040 040040   ****** ******   040040 040040            ....
  11    2133   040040 040040   040040 040040   040040 040040   040040 040040
  11    2137   040040 040040   040040 040040   040040 040040   040040 040040

VM_SITE_T
 Sect OctLoc
  11    2143   000000 000000   000000 000000   040040 040040   040040 040040    ........
  11    2227*  ****** ******   ****** ******   ****** ******   ****** ******    ................

MYERROR
 Sect OctLoc
  11    2233   261715 000000                                                    ....

MOVE_NAME
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:399  
 Sect OctLoc
  11    2234   037040 040040   040040 040040   040040 040040   040040 040040    .
  11    2240   040040 040040   040040 040040   040040 040040   040040 040040

OPEN_MAIL_CREATE
 Sect OctLoc
  11    2244   000025 777640   002310 006000   000000 177640   000000 006014    ................
  11    2250   000000 177640   000000 006014   000007 777640   002234 006000    ................
  11    2254   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    2270*  000001 777640   000000 006000   000000 177640   000000 006014    ................
  11    2274   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    2310*  000000 400042   000000 003001   252525 002002   000040 252520    ..."......... ..
  11    2314   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
  11    2320   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11    2324   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
  11    2330   040040 040040   000000 000000   000000 000000   000000 000000        ............
  11    2334   000000 000000   ****** ******                                    ........

CLOSE_MAIL
 Sect OctLoc
  11    2336   000003 777640   002370 006000   000000 177640   000000 006014    ................
  11    2342   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11    2366*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
  11    2372   000220 000000   000000 000000                                    ........

FPT_OLAY
 Sect OctLoc
  11    2374   000002 177640   000460 006000   000001 777640   002400 006000    ................
  11    2400   000000 000000   000000 000000                                    ........

INIT_RADDRESS
 Sect OctLoc
  12     000   000000 006014   000000 006014   000001 040040   040040 040040    ..........
  12     004   040040 040040   040040 040040   040040 040040   040040 040040
  12     020*  040040 040040   040040 040040   040040 040040   040040 040***                   .

INIT_DELIVERY
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:400  
 Sect OctLoc
  12     024   000000 000000   000000 000000   000000 000000   000040 040040    .............
  12     030   040040 040040   040040 040040   040040 040040   040040 040040
  12     124*  040040 040040   040040 040040   040040 040040

INIT_DELIVERYKEY
 Sect OctLoc
  12     127   050011 040040   040040 040040   040040 040040   040040 040040    (.
  12     133   040040 040040   040040 040040   040040 040040   040040 040040
  12     137   040040 040040   040040 040040   040*** ******                             ...

INIT_ENCODED_ERR_BODYREC
 Sect OctLoc
  12     142   003000 000000   ****** ******   ****** ******   ****** ******    ................
  12     256*  ****** ******                                                    ....

E_ADDUNKNOWN
 Sect OctLoc
  12     257   261715 013030                                                    ....

GET_ANSI_TIME
 Sect OctLoc
  12     260   000001 777640   000272 006000   000001 377640   000504 006000    ................
  12     264   000001 777640   000502 006000   000000 177640   000000 006014    ................
  12     270   000000 777640   001656 006000   004002 000000   ****** ******    ................

WAIT2
 Sect OctLoc
  12     274   000001 777640   000300 006000   000000 177640   000000 006014    ................
  12     300   000000 000002   000000 000001                                    ........

ENQ_PROFILE
 Sect OctLoc
  12     302   000003 777640   000310 006000   000001 777640   000324 006000    ................
  12     306   000000 177640   000000 006014   000000 540000   000000 000002    ................
  12     312   000000 000000   000000 000000                                    ........

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:401  
DEQ_PROFILE
 Sect OctLoc
  12     314   000001 777640   000322 006000   000001 777640   000324 006000    ................
  12     320   000000 177640   000000 006014   000000 400000   000000 000000    ................

VM_PRORES
 Sect OctLoc
  12     324   007120 122117   106111 114105                                    .PROFILE

ENQ_HEADER
 Sect OctLoc
  12     326   000003 777640   000334 006000   000001 177640   001314 006000    ................
  12     332   000000 177640   000000 006014   000000 540000   777777 777777    ................
  12     336   000000 000000   000000 000000                                    ........

DEQ_HEADER
 Sect OctLoc
  12     340   000001 777640   000346 006000   000001 177640   001314 006000    ................
  12     344   000000 177640   000000 006014   000000 400000   000000 000000    ................

E_INTERSYSILL
 Sect OctLoc
  12     350   261715 013000                                                    ....

E_NOMID
 Sect OctLoc
  12     351   261715 012750                                                    ....

E_WRONGOWNER
 Sect OctLoc
  12     352   261715 013010                                                    ....

E_PROERR
 Sect OctLoc
  12     353   261715 013040                                                    ...

E_FOLDERFULL
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:402  
 Sect OctLoc
  12     354   261715 013020                                                    ....

E_DISKSPACE
 Sect OctLoc
  12     355   261715 013050                                                    ...(

E_DELIVERED
 Sect OctLoc
  12     356   261715 013060                                                    ...0

E_RRACKED
 Sect OctLoc
  12     357   261715 013110                                                    ...H

E_ACKED
 Sect OctLoc
  12     360   261715 013070                                                    ...8

E_ANSWERED
 Sect OctLoc
  12     361   261715 013100                                                    ...@

INIT_ADD_HEAD
 Sect OctLoc
  12     362   000000 000000   000000 000000   000000 000000   000000 006014    ................
  12     366   000000 006014   000000 006014   ****** ******                    ............

CLOSE_MAIL_FILECOPY
 Sect OctLoc
  12     372   000003 777640   000424 006000   000000 177640   000000 006014    ................
  12     376   000000 177640   000000 006014   000000 177640   000000 006014    ................
  12     422*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
  12     426   000220 000000   000000 000000                                    ........

CANCEL_READ
 Sect OctLoc
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:403  
  12     430   000007 777640   000440 006000   000007 777640   000450 006000    ................
  12     434   000000 177640   000000 006014   000000 177640   000000 006014    ................
  12     440   000000 000000   004000 000000   000000 000000   000000 000000    ................
  12     444   040040 040040   000000 000000   000000 000000   000000 000000        ............

MYSTATION
 Sect OctLoc
  12     450   115101 111114   115101 116040   040040 040040   040040 040040    MAILMAN
  12     454   001000 000000   000000 000000   000000 000000   000000 000000    ................

OV_NAME
 Sect OctLoc
  12     460   010126 117115   044115 117126   105*** ******                    .VOM$MOVE...

E_BADSITE
 Sect OctLoc
  12     463   261715 012770                                                    ....

(unnamed)
 Sect OctLoc
  12     464   101143 161165   151162 151156   147040 141040   155141 151154    Acquiring a mail
  12     470   147162 141155   101163 163151   147156 151156   147040 141040    gramAssigning a
  12     474   155145 163163   141147 145040   111104 040040   123164 157162    message ID  Stor
  12     500   151156 147040   146151 154145   055143 157160   171040 141144    ing file-copy ad
  12     504   144162 145163   163040 040040   104145 154151   166145 162151    dress   Deliveri
  12     510   156147 040146   151154 145040   143157 160171   105170 160141    ng file copyExpa
  12     514   156144 151156   147040 141144   144162 145163   163040 154151    nding address li
  12     520   163164 050163   051040 040040   114157 157153   151156 147040    st(s)   Looking
  12     524   146157 162040   141143 143165   155165 154141   164145 144040    for accumulated
  12     530   145162 162157   162163 056056   056040 040040   103162 145141    errors...   Crea
  12     534   164151 156147   040141 156040   145162 162157   162040 162145    ting an error re
  12     540   160157 162164   125160 144141   164151 156147   040163 164141    portUpdating sta
  12     544   164165 163040   146154 141147   163040 157156   040164 150145    tus flags on the
  12     550   040146 151154   145040 143157   160171 040040   114157 157153     file copy  Look
  12     554   151156 147040   146157 162040   141156 040165   156144 145154    ing for an undel
  12     560   151166 145162   145144 040143   157160 171040   104145 154151    ivered copy Deli
  12     564   166145 162151   156147 040164   157040 040040   103162 145141    vering to   Crea
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:404  
  12     570   164151 156147   040144 145154   151166 145162   171040 162145    ting delivery re
  12     574   143145 151160   164040 040040   104145 154151   166145 162171    ceipt   Delivery
  12     600   040143 157155   160154 145164   145144 040040   104105 101104     completed  DEAD
  12     604   100103 120066   076040 040040   040040 040040   103105 116124    @CP6>       CENT
  12     610   122101 114040   072115 105123   123040 040040   072130 115111    RAL :MESS   :XMI
  12     614   124040 040040   102145 141155   151156 147040   155141 151154    T   Beaming mail
  12     620   040164 157040   072115 117126   105040 040040   115141 151154     to :MOVE   Mail

(unnamed)
 Sect OctLoc
  17     000   000002 000000   000063 006000   000000 000000   377777 777777    .....3..........
  17     004   000000 006014   037777 777777   000002 006000   000003 000000    ................
  17     010   757777 777777   777773 777777   777577 777777   400000 000000    ................
  17     014   001077 006000   000216 006000   000013 006000   001077 006000    .?...........?..
  17     020   000242 006000   000013 006000   052040 040040   040040 040040    ........*
  17     024   000000 006003   000001 000000   000000 006000   000004 000000    ................
  17     030   000000 006000   000000 000000   000242 006000   000216 006000    ................
  17     034   000242 006000   000000 006000   000153 006000   000002 006000    .........k......
  17     040   000000 006000   000235 606000   040040 040040   040040 040040    ........
  17     044   000005 000000   000000 000002   000000 000001   000372 006000    ................
  17     050   000045 006000   000046 006000   001657 006000   000000 257620    .%...&..........
  17     054   000053 006000   000000 006000   000000 000145   000056 006000    .+.........e....
  17     060   000144 777640   000000 000020   000061 006000   000006 000000    .d.......1......
  17     064   000000 006000   000000 006000   000002 006000   000000 006000    ................
  17     070   000000 006000   000002 006000   000722 006000   000000 006000    ................
  17     074   000000 002000   000000 006000   000074 006000   000000 000000    .........<......
  17     100   000002 006000   000002 006000   000000 177640   000000 006014    ................
  17     104   000000 000040   777777 737777   000104 006000   000102 006000    ... .....D...B..
  17     110   000001 777640   000000 006000   000000 000021   000112 006000    .............J..
  17     114   000706 006000   000000 000041   000115 006000   000707 006000    .......!.M......
  17     120   000000 000031   000120 006000   000710 006000   777767 777777    .....P..........
  17     124   000000 006000   000002 006000   000000 006000   002143 006000    .............c..
  17     130   776777 777777   000017 600000   000002 400000   000015 600000    ................
  17     134   000007 400000   000021 600000   000000 006000   072040 040040    ............:
  17     140   000711 006000   000000 006000   000074 006000                    .........<..
     2775    16252    2   END BUILD_INTERSYS_LIST;
     2776    16253    1   END VOM$DOSEND;
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:405  
     2777    16254        %EOD;

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:406  
--  Include file information  --

   XUD_UTS_M.:LIB_E05  is referenced.
   B$TABLES_C.:LIB_E05  cannot be made into a system file and is referenced.
   XUM_MACRO_C.:LIB_E05  is referenced.
   VW_NODEATER_E.:VMB6TOU  is referenced.
   VM_PERR_C.:VMB6TOU  is referenced.
   VO_SUBS_C.:VMB6TOU  is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VOM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   B_SEGIDS_C.:LIB_E05  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   B$JIT_C.:LIB_E05  is referenced.
   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VOM$DOSEND.
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:407  

 **** Variables and constants ****

  ****  Section 011  Data  VOM$DOSEND

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   504-0-0/c CHAR(6)     r     1 ANSI_DATE                502-0-0/c CHAR(8)     r     1 ANSI_TIME
   506-0-0/c STRC(4608)  r     1 BLIND_TEXT              2336-0-0/d STRC(1080)  r     1 CLOSE_MAIL
   734-0-0/d STRC(1080)  r     1 CLOSE_MAIL_OUT
   772-0-0/d STRC(1080)  r     1 CLOSE_MAIL_OUT_RELEASE
  1660-0-0/d STRC(2088)  r     1 CREATE_SEND             1657-0-0/w UBIN        r     1 CURRENT_TIME
  1076-0-0/w STRC        r     1 ERROR                   2374-0-0/d STRC(216)   r     1 FPT_OLAY
  1300-0-0/d STRC(432)   r     1 GET_CURRENT              722-0-0/w STRC(324)   r     1 HEADER_MCB
   711-0-0/w STRC(324)   r     1 IADDLIST_MCB             707-0-0/w PTR         r     1 IBC_HEAD$
   710-0-0/w PTR         r     1 IC_HEAD$                2402-0-0/w SBIN        r     1 INDX
  2404-0-0/w SBIN        r     1 INDX                     706-0-0/w PTR         r     1 ITO_HEAD$
   501-0-0/w UBIN        r     1 MASK_LEN                2234-0-0/c STRC(288)   r     1 MOVE_NAME
  2233-0-0/w STRC              1 MYERROR                 1066-0-0/c STRC(288)   r     1 NEW_NAME
  2244-0-0/d STRC(2088)  r     1 OPEN_MAIL_CREATE        2403-0-0/w PTR         r     1 PTR$
  1316-0-0/d STRC(648)   r     1 REL_PACK                1030-0-0/d STRC(1080)  r     1 RENAME_BAD_FILE
  1340-0-0/d STRC(7416)  r     1 RPSN                    1752-0-0/c STRC(288)   r     1 SEND_NAME
  1762-0-0/w STRC(2772)        1 VM_BODYREC              2077-0-0/c STRC(1296)        1 VM_CGOUT
   372-0-0/w STRC(2529)  r     1 VM_FOLDER_INFO          1314-0-0/c STRC(45)    r     1 VM_HEADRES
   216-0-0/w STRC(711)   r     1 VM_RADDRESS              346-0-0/w STRC(711)   r     1 VM_RETURN_ADDRESS
   153-0-0/w STRC(1260)  r     1 VM_SEARCH_INFO            63-0-0/w STRC(2016)  r     1 VM_SITE
  2143-0-0/w STRC(2016)  r     1 VM_SITE_T                242-0-0/w STRC(2448)  r     1 VM_UADDRESS
     0-0-0/c STRC(1818)        1 VM_USERKEY              1077-0-0/c STRC(4608)  r     1 WORK_TEXTC
  1656-0-0/w UBIN        r     1 WORK_TIME

  ****  Section 012 RoData VOM$DOSEND

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   430-0-0/d STRC(576)   r     1 CANCEL_READ              372-0-0/d STRC(1080)  r     1 CLOSE_MAIL_FILECOPY
   340-0-0/d STRC(288)   r     1 DEQ_HEADER               314-0-0/d STRC(288)   r     1 DEQ_PROFILE
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:408  
   326-0-0/d STRC(360)   r     1 ENQ_HEADER               302-0-0/d STRC(360)   r     1 ENQ_PROFILE
   360-0-0/w STRC              1 E_ACKED                  257-0-0/w STRC        r     1 E_ADDUNKNOWN
   361-0-0/w STRC              1 E_ANSWERED               463-0-0/w STRC        r     1 E_BADSITE
   356-0-0/w STRC        r     1 E_DELIVERED              355-0-0/w STRC        r     1 E_DISKSPACE
   354-0-0/w STRC        r     1 E_FOLDERFULL             350-0-0/w STRC        r     1 E_INTERSYSILL
   351-0-0/w STRC        r     1 E_NOMID                  353-0-0/w STRC        r     1 E_PROERR
   357-0-0/w STRC              1 E_RRACKED                352-0-0/w STRC              1 E_WRONGOWNER
   260-0-0/d STRC(432)   r     1 GET_ANSI_TIME            362-0-0/w STRC(252)   r     1 INIT_ADD_HEAD
    24-0-0/w STRC(2412)  r     1 INIT_DELIVERY            127-0-0/c STRC(369)   r     1 INIT_DELIVERYKEY
   142-0-0/w STRC(2772)  r     1 INIT_ENCODED_ERR_BODYREC
     0-0-0/w STRC(711)   r     1 INIT_RADDRESS            450-0-0/w STRC(288)   r     1 MYSTATION
   460-0-0/c STRC(81)    r     1 OV_NAME                  324-0-0/c STRC(72)    r     1 VM_PRORES
   274-0-0/d STRC(216)   r     1 WAIT2

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

  1153-0-0/w PTR         r     1 @ADDRESS                1151-0-0/w PTR         r     1 @BUFFER
  1152-0-0/w PTR         r     1 @BUFSIZE                1151-0-0/w PTR         r     1 @DCB#
     3-0-0/w PTR         r     1 @HEAD$                  1157-0-0/w PTR         r     1 @HEAD$
  1147-0-0/w PTR         r     1 @ONE                    1160-0-0/w PTR         r     1 @TYPE
  1152-0-0/c CHAR(8)     r     1 ACCT                      *0-0-0/w STRC(711)   r     1 ADDRESS
   251-0-0/w PTR               1 ADDRESS$                 240-0-0/w SBIN        r     1 ADD_TYPE
  1154-0-0/w BIT               1 ANOTHER_USER            1134-0-0/w UBIN        r     1 BAD_ADDRESS_COUNT
    *0-0-0/w UBIN        r     1 BUFFER(0:0)               *0-0-0/w UBIN        r     1 BUFSIZE
  1155-0-0/b BIT         r     1 COMBINED                 247-0-0/w SBIN        r     1 COUNT
    *0-0-0/w UBIN        r     1 DCB#                    1137-0-0/w UBIN        r     1 DELAY_TIME
   567-0-0/c STRC(4572)  r     1 DELIVERY                1144-0-0/b STRC(4)     r     1 DELIVERY_SUMMARY
  1147-0-0/b BIT               1 DLOCK_SEND               253-0-0/w BIT         r     1 ERR_FLAG
   563-0-0/c STRC(144)   r     1 EXTERNAL                1157-0-0/w PTR         r     1 FAKE_ADDRESS$
  1155-0-0/w PTR         r     1 FAKE_HEAD$              1161-0-0/w STRC(2529)  r     1 FILE_FOLDER_INFO
  1153-0-0/b BIT               1 FORWARD                   *0-0-0/w PTR         r     1 HEAD$
    *0-0-0/w PTR         r     1 HEAD$                   1135-0-0/w UBIN        r     1 HOG_COUNT
  1157-0-0/w SBIN        r     1 I                       1271-0-0/w SBIN        r     1 I
  1151-0-0/w SBIN              1 I                        260-0-0/c CHAR(511)   r     1 ID
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:409  
  1153-0-0/w UBIN        r     1 INDX1                    255-0-0/w BIT         r     1 INTERSYS_ACTIVE
  1152-0-0/w SBIN              1 J                       1151-0-0/c CHAR(8)     r     1 KEY_VALUE
  1133-0-0/w UBIN        r     1 MESSAGE_NUMBER           243-0-0/w PTR         r     1 NEXT$
   237-0-0/w PTR               1 NEXT_USER$              1154-0-0/c CHAR(8)     r     1 NODE
  1136-0-0/w UBIN        r     1 NUM_RECEIPTS              *0-0-0/w BIT         r     1 ONE
  1150-0-0/c CHAR(5)     r     1 PREFIX                   254-0-0/w BIT         r     1 PROCESSING
   257-0-0/w SBIN        r     1 PROCESS_ERROR            256-0-0/w PTR         r     1 PTR$
   244-0-0/w PTR               1 PTR2$                    252-0-0/w BIT               1 P_ERR
  1156-0-0/w PTR         r     1 REAL_ADDRESS$           1154-0-0/w PTR         r     1 REAL_HEAD$
   766-0-0/w UBIN        r     1 RETURN_ADDRESS_BUFFER(0:100)
  1160-0-0/b BIT         r     1 SAVED_FLAGS              245-0-0/w PTR               1 SAVEN$
   246-0-0/w PTR               1 SAVEP$                  1142-0-0/w PTR         r     1 SCRATCH$
   241-0-0/w BIT         r     1 SEND_BC                 1156-0-0/w PTR               1 SEND_CURR$
  1152-0-0/c CHAR(26)    r     1 SEND_STRING             1147-0-0/b BIT         r     1 SET_FCOPY_FLAG
   460-0-0/c CHAR(8)     r     1 SITENAME                1161-0-0/c CHAR(8)     r     1 SITENAME
  1154-0-0/c CHAR(8)     r     1 SITENAME                 562-0-0/w UBIN        r     1 SITE_TYPE
   462-0-0/c CHAR(256)   r     1 STATUS_STRING           1157-0-0/w PTR         r     1 TIME_CURR$
  1150-0-0/w SBIN              1 TYPE                      *0-0-0/w UBIN        r     1 TYPE
  1143-0-0/b STRC(4)     r     1 UNDELIVERED             1140-0-0/w SBIN        r     1 UTS_X
  1141-0-0/w SBIN        r     1 UTS_Y                    122-0-0/w STRC(2772)  r     1 VM_BODYREC_ENCODED
     4-0-0/w STRC(2412)  r     1 VM_DELIVERY              107-0-0/c STRC(369)   r     1 VM_DELIVERYKEY
   242-0-0/w BIT               1 WAIT_FLAG                250-0-0/w PTR               1 X$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$TCB$
     0-0-0/w PTR         r     1 B$XL_UPPER$                0-0-0/d STRC(1080)  r     1 CLOSE_MAILIN_SAVE
     0-0-0/d STRC(1080)  r     1 CLOSE_MAILIN_SCRATCH       0-0-0/c ASTR(9)     r     1 ERRMSG_FID
     0-0-0/w PTR               1 FREE$                      0-0-0/w PTR         r     1 INTERSYS$
     0-0-0/w PTR         r     1 INTERSYS_HEAD$             0-0-0/w UBIN              1 M$DO_NUM
     0-0-0/w UBIN              1 M$LO_NUM                   0-0-0/w UBIN              1 M$MAIL_CENTRAL_NUM
     0-0-0/w UBIN              1 M$MAIL_COMGROUP_NUM        0-0-0/w UBIN              1 M$MAIL_FILE_NUM
     0-0-0/w UBIN        r     1 M$MAIL_GLOBAL_NUM          0-0-0/w UBIN              1 M$ME_NUM
     0-0-0/w UBIN              1 M$NODE_NUM                 0-0-0/w UBIN              1 M$SI_NUM
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:410  
     0-0-0/w UBIN              1 M$WORK_NUM                 0-0-0/c STRC(288)   r     1 MAIL_NAME
     0-0-0/d STRC(2088)  r     1 OPEN_MAIL                  0-0-0/w STRC(288)         1 OUTSTATION
     0-0-0/w STRC(288)         1 OUTSTATION                 0-0-0/c CHAR(8)           1 STATION#
     0-0-0/w PTR         r     1 TIME$                      0-0-0/w PTR         r     1 TIME_HEAD$
     0-0-0/w PTR         r     1 VM_ADDLIST$                0-0-0/d VECT        r     1 VM_ADDLIST_
     0-0-0/w PTR         r     1 VM_ADDREC$                 0-0-0/d VECT        r     1 VM_ADDREC_
     0-0-0/c STRC(1296)        1 VM_CGBUFFER                0-0-0/w PTR         r     1 VM_COPY$
     0-0-0/d VECT        r     1 VM_COPY_                   0-0-0/w PTR               1 VM_ENCLLIST$
     0-0-0/d VECT              1 VM_ENCLLIST_               0-0-0/w PTR               1 VM_ENCLREC$
     0-0-0/d VECT              1 VM_ENCLREC_                0-0-0/c STRC(270)         1 VM_FORWARD_ENCL_NAME
     0-0-0/c STRC(270)         1 VM_FORWARD_FILE_NAME       0-0-0/c STRC(72)          1 VM_FORWARD_FILE_PASS
     0-0-0/w PTR         r     1 VM_HEADER$                 0-0-0/d VECT        r     1 VM_HEADER_
     0-0-0/d VECT              1 VM_HEADER_INIT_            0-0-0/w PTR               1 VM_INPUT$
     0-0-0/d VECT              1 VM_INPUT_                  0-0-0/c STRC(72)          1 VM_MAILCG_NAME
     0-0-0/w STRC(432)         1 VM_MAILCG_SETSTA           0-0-0/c STRC(72)    r     1 VM_MAIL_ACCT
     0-0-0/c STRC(54)          1 VM_NAME_MAP_NAME           0-0-0/w PTR               1 VM_PARSEAREA$
     0-0-0/d VECT              1 VM_PARSEAREA_              0-0-0/w PTR         r     1 VM_PROFILE$
     0-0-0/d VECT              1 VM_PROFILE_                0-0-0/w PTR               1 VM_SELECT$
     0-0-0/d VECT              1 VM_SELECT_                 0-0-0/c STRC(288)         1 VM_SEND_FILE_NAME
     0-0-0/c CHAR(8)     r     1 VM_SITENAME                0-0-0/w PTR         r     1 VM_WORK$
     0-0-0/d VECT              1 VM_WORK_                   0-0-0/w STRC(2880)        1 VO_BNWIO
     0-0-0/w UBIN        r     1 VO_BUSY_RETRY_MINUTES
     0-0-0/w UBIN        r     1 VO_HOG_LIMIT               0-0-0/c CHAR(8)           1 VO_INTERSYS_ACCT
     0-0-0/b BIT         r     1 VO_INTERSYS_ALLOWED        0-0-0/c CHAR(12)          1 VO_INTERSYS_EPASS
     0-0-0/c CHAR(8)           1 VO_INTERSYS_PASSWORD       0-0-0/c CHAR(8)           1 VO_INTERSYS_UNAME
     0-0-0/w UBIN        r     1 VO_MAILMAN_STARTUP_TIME
     0-0-0/w UBIN        r     1 VO_MAX_HOLD_HOURS          0-0-0/b BIT         r     1 VO_NEED_READ
     0-0-0/w UBIN        r     1 VO_PACKSET_RETRY_MINUTES
     0-0-0/b BIT         r     1 VO_PROCESS                 0-0-0/d STRC(504)   r     1 VO_READ_CG
     0-0-0/w UBIN              1 VO_RETRY_LIMIT_INTERSYSTEM
     0-0-0/d STRC(432)         1 WRITE_MAILCG               0-0-0/d STRC(432)         1 WRITE_MAILCG

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:411  
     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w STRC(144)   r     1 B$TCB                      0-0-0/w UBIN        r     1 BLOCKSIZE
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/w STRC(540)   r     1 INTERSYS_INFO
     0-0-0/d STRC(4608)  r     1 LOWER_UPPER                0-0-0N  NULL        r     1 M$DO
     0-0-0N  NULL        r     1 M$LO                       0-0-0N  NULL        r     1 M$MAIL_CENTRAL
     0-0-0N  NULL        r     1 M$MAIL_COMGROUP            0-0-0N  NULL        r     1 M$MAIL_FILE
     0-0-0N  NULL        r     1 M$MAIL_GLOBAL              0-0-0N  NULL        r     1 M$ME
     0-0-0N  NULL        r     1 M$NODE                     0-0-0N  NULL        r     1 M$SI
     0-0-0N  NULL        r     1 M$UC                       0-0-0N  NULL        r     1 M$WORK
     0-0-0N  NULL        r     1 MAIL_FILECOPY              0-0-0N  NULL        r     1 MAIL_IN
     0-0-0N  NULL        r     1 MAIL_OUT                   0-0-0/b ABIT        r     1 MASK
     0-0-0/w STRC(612)   r     1 TIME_TABLE                 0-0-0/w ASTR(72)    r     1 VM$BODYREC
     0-0-0/w STRC(711)   r     1 VM$RADDRESS                0-0-0/w STRC(711)   r     1 VM$RADDRESS
     0-0-0/w STRC(2448)  r     1 VM$UADDRESS                0-0-0/w STRC(2448)  r     1 VM$UADDRESS
     0-0-0/w STRC(252)   r     1 VM_ADD_HEAD                0-0-0/w STRC(252)   r     1 VM_ADD_HEAD
     0-0-0/w STRC(1332)  r     1 VM_HEADER                  0-0-0/w STRC(4068)  r     1 VM_PROFILE
     0-0-0/w STRC(711)   r     1 VM_RADDRESS                0-0-0/c ASTR(9)     r     1 X$STRING


   Procedure VOM$DOSEND requires 3468 words for executable code.
   Procedure VOM$DOSEND requires 712 words of local(AUTO) storage.
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:412  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:413  
          MINI XREF LISTING

ACCT IN PROCEDURE TRANSPORT_INTERSYS
     15751**DCL     15923<<ASSIGN  15928<<ASSIGN  15943<>CALL
ADDRESS IN PROCEDURE CONSTRUCT_RETURN_ADDRESS
     14683**DCL     14653--PROC    14828>>ASSIGN
ADDRESS.FOLDER IN PROCEDURE CONSTRUCT_RETURN_ADDRESS
     14698**DCL     14699--REDEF
ADD_ADDRESS IN PROCEDURE BUILD_INTERSYS_LIST
     16198**LABEL   16178--GOTO
ADD_TYPE
     12078**DCL     13589<<ASSIGN  13692<<ASSIGN  13696<<ASSIGN  13698<<ASSIGN  13804>>IF      13806<<ASSIGN
     13810>>IF      13812<<ASSIGN  14292<<ASSIGN  14292>>ASSIGN  14293<>CALL    14295<<ASSIGN  14295>>ASSIGN
     14298<<ASSIGN  14298>>ASSIGN  14301<>CALL    14324>>DOCASE  16228>>DOCASE
ANSI_DATE
     12102**DCL     12782--DCLINIT 12783--DCLINIT 14249>>CALLBLT
ANSI_TIME
     12101**DCL     12784--DCLINIT 12785--DCLINIT 14249>>CALLBLT
ASSIGN_A_MESSAGE_ID
     14233**PROC    13570--CALL
B$ALT.CODE
     11140**DCL     11140--REDEF   11141--REDEF   11141--REDEF
B$ALT.ERR
     11141**DCL     13939>>ASSIGN  14197>>ASSIGN  14853>>ASSIGN  15055>>ASSIGN  15255>>ASSIGN  15271>>ASSIGN
     15972>>ASSIGN  16250>>ASSIGN
B$ALT.ERR.ERR#
     11142**DCL     11142--REDEF   14641>>IF      15109>>IF
B$ALT.EVID
     11141**DCL     11141--REDEF   11141--REDEF
B$JIT.CCARS
       423**DCL     14280<<ASSIGN
B$JIT.CCBUF
       423**DCL     14279<<ASSIGN
B$JIT.CPFLAGS1.SLEAZE
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:414  
       429**DCL       429--REDEF
B$JIT.ERR.MID
       336**DCL       336--REDEF
B$JIT.JOBNAME
       484**DCL     13537<<ASSIGN  15942<<ASSIGN  15955<<ASSIGN
B$JIT.JRESPEAK
       497**DCL       498--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
       606**DCL       606--REDEF     607--REDEF
B$JIT.PNR
       510**DCL       510--REDEF
B$JIT.PRIV.ACTIVE.JIT
       340**DCL     13534>>IF      14274>>IF      15940>>IF      15952>>IF
B$JIT.TSLINE
       604**DCL       605--REDEF
B$JIT$
     10244**DCL       330--IMP-PTR 13534>>IF      13537>>ASSIGN  14274>>IF      14279>>ASSIGN  14280>>ASSIGN
     15940>>IF      15942>>ASSIGN  15952>>IF      15955>>ASSIGN
B$TCB.ALT$
     11136**DCL     13939>>ASSIGN  14197>>ASSIGN  14641>>IF      14853>>ASSIGN  15055>>ASSIGN  15109>>IF
     15255>>ASSIGN  15271>>ASSIGN  15972>>ASSIGN  16250>>ASSIGN
B$TCB$
     10245**DCL     11136--IMP-PTR 13939>>ASSIGN  14197>>ASSIGN  14641>>IF      14853>>ASSIGN  15055>>ASSIGN
     15109>>IF      15255>>ASSIGN  15271>>ASSIGN  15972>>ASSIGN  16250>>ASSIGN
B$XL_UPPER$
     11131**DCL     11132--IMP-PTR 16161>>CALLBLT
BAD_ADDRESS_COUNT
     12115**DCL     13644<<ASSIGN  13730>>CALLBLT 13731<<ASSIGN  13731>>ASSIGN  13748>>CALLBLT 13749<<ASSIGN
     13749>>ASSIGN  13763>>CALLBLT 13764<<ASSIGN  13764>>ASSIGN  13789>>CALLBLT 13790<<ASSIGN  13790>>ASSIGN
BAD_MAIL
     14193**LABEL   13500--CALLALT 13533--CALLALT 13548--CALLALT 13572--CALLALT 13607--CALLALT 13618--CALLALT
     13620--CALLALT 13867--CALLALT 14075--CALLALT 14079--CALLALT 14154--CALLALT 14156--CALLALT
BAD_MAIL IN PROCEDURE RETURN_ERROR_MSG
     14464**LABEL   14415--CALLALT 14417--CALLALT 14433--CALLALT 14437--CALLALT 14462--CALLALT
BAD_MAIL IN PROCEDURE VOM$SENDIT
     15268**LABEL   15157--CALLALT 15241--CALLALT 15269--CALLALT
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:415  
BLIND_TEXT.L#
     12168**DCL     13497<<ASSIGN  15821>>IF      15825>>ASSIGN  15836>>ASSIGN  15839>>IF
BLIND_TEXT.NAME#
     12168**DCL     15837>>ASSIGN
BLOCKSIZE IN PROCEDURE CONSTRUCT_RETURN_ADDRESS
     14807**DCL     14826<<ASSIGN
BUFFER IN PROCEDURE CONSTRUCT_RETURN_ADDRESS
     14671**DCL     14653--PROC    14813--ASSIGN
BUFSIZE IN PROCEDURE CONSTRUCT_RETURN_ADDRESS
     14672**DCL     14653--PROC    14809>>IF
BUILD_ADD_LIST IN PROCEDURE TRANSPORT_INTERSYS
     15975**PROC    15809--CALL    15813--CALL    15817--CALL    15854--CALL
BUILD_INTERSYS_LIST
     16103**PROC    14881--CALL
CANCEL_READ IN PROCEDURE TRANSPORT_INTERSYS
     15637**DCL     15935<>CALL    15957<>CALL
CANCEL_READ.V IN PROCEDURE TRANSPORT_INTERSYS
     15638**DCL     15637--DCLINIT
CANCEL_READ.V.DVBYTE.REREAD# IN PROCEDURE TRANSPORT_INTERSYS
     15640**DCL     15640--REDEF
CANT_OPEN_GLOBAL
     13684**LABEL   13679--CALLALT
CLOSE_MAIL IN PROCEDURE TRANSPORT_INTERSYS
     15604**DCL     15898<>CALL    15919<>CALL
CLOSE_MAIL.SN_ IN PROCEDURE TRANSPORT_INTERSYS
     15604**DCL     15604--REDEF
CLOSE_MAIL.UTL_ IN PROCEDURE TRANSPORT_INTERSYS
     15605**DCL     15605--REDEF
CLOSE_MAIL.V IN PROCEDURE TRANSPORT_INTERSYS
     15609**DCL     15604--DCLINIT
CLOSE_MAIL.V.DISP# IN PROCEDURE TRANSPORT_INTERSYS
     15613**DCL     15897<<ASSIGN  15901<<ASSIGN  15904<<ASSIGN
CLOSE_MAIL.V.EXPIRE# IN PROCEDURE TRANSPORT_INTERSYS
     15619**DCL     15619--REDEF
CLOSE_MAIL.V.TYPE# IN PROCEDURE TRANSPORT_INTERSYS
     15617**DCL     15617--REDEF
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:416  
CLOSE_MAIL.V.XTNSIZE# IN PROCEDURE TRANSPORT_INTERSYS
     15614**DCL     15614--REDEF   15616--REDEF
CLOSE_MAILIN_SAVE
     12207**DCL     14188<>CALL
CLOSE_MAILIN_SAVE.SN_
     12207**DCL     12207--REDEF
CLOSE_MAILIN_SAVE.UTL_
     12208**DCL     12208--REDEF
CLOSE_MAILIN_SAVE.V.EXPIRE#
     12222**DCL     12222--REDEF
CLOSE_MAILIN_SAVE.V.TYPE#
     12220**DCL     12220--REDEF
CLOSE_MAILIN_SAVE.V.XTNSIZE#
     12217**DCL     12217--REDEF   12219--REDEF
CLOSE_MAILIN_SCRATCH
     12250**DCL     14193<>CALL    14205<>CALL
CLOSE_MAILIN_SCRATCH.SN_
     12250**DCL     12250--REDEF
CLOSE_MAILIN_SCRATCH.UTL_
     12251**DCL     12251--REDEF
CLOSE_MAILIN_SCRATCH.V.EXPIRE#
     12265**DCL     12265--REDEF
CLOSE_MAILIN_SCRATCH.V.TYPE#
     12263**DCL     12263--REDEF
CLOSE_MAILIN_SCRATCH.V.XTNSIZE#
     12260**DCL     12260--REDEF   12262--REDEF
CLOSE_MAIL_FILECOPY IN PROCEDURE VOM$SENDIT
     14971**DCL     15119<>CALL    15128<>CALL
CLOSE_MAIL_FILECOPY.SN_ IN PROCEDURE VOM$SENDIT
     14971**DCL     14971--REDEF
CLOSE_MAIL_FILECOPY.UTL_ IN PROCEDURE VOM$SENDIT
     14972**DCL     14972--REDEF
CLOSE_MAIL_FILECOPY.V IN PROCEDURE VOM$SENDIT
     14976**DCL     14971--DCLINIT
CLOSE_MAIL_FILECOPY.V.EXPIRE# IN PROCEDURE VOM$SENDIT
     14986**DCL     14986--REDEF
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:417  
CLOSE_MAIL_FILECOPY.V.TYPE# IN PROCEDURE VOM$SENDIT
     14984**DCL     14984--REDEF
CLOSE_MAIL_FILECOPY.V.XTNSIZE# IN PROCEDURE VOM$SENDIT
     14981**DCL     14981--REDEF   14983--REDEF
CLOSE_MAIL_OUT
     12428**DCL     13950<>CALL    13955<>CALL    13974<>CALL    14137<>CALL    14462<>CALL    15073<>CALL
     15112<>CALL    15146<>CALL    15241<>CALL    15283<>CALL
CLOSE_MAIL_OUT.SN_
     12428**DCL     12428--REDEF
CLOSE_MAIL_OUT.UTL_
     12429**DCL     12429--REDEF
CLOSE_MAIL_OUT.V
     12433**DCL     12428--DCLINIT
CLOSE_MAIL_OUT.V.EXPIRE#
     12443**DCL     12443--REDEF
CLOSE_MAIL_OUT.V.TYPE#
     12441**DCL     12441--REDEF
CLOSE_MAIL_OUT.V.XTNSIZE#
     12438**DCL     12438--REDEF   12440--REDEF
CLOSE_MAIL_OUT_RELEASE
     12470**DCL     14141<>CALL
CLOSE_MAIL_OUT_RELEASE.SN_
     12470**DCL     12470--REDEF
CLOSE_MAIL_OUT_RELEASE.UTL_
     12471**DCL     12471--REDEF
CLOSE_MAIL_OUT_RELEASE.V
     12475**DCL     12470--DCLINIT
CLOSE_MAIL_OUT_RELEASE.V.EXPIRE#
     12485**DCL     12485--REDEF
CLOSE_MAIL_OUT_RELEASE.V.TYPE#
     12483**DCL     12483--REDEF
CLOSE_MAIL_OUT_RELEASE.V.XTNSIZE#
     12480**DCL     12480--REDEF   12482--REDEF
COMBINED IN PROCEDURE VOM$SENDIT
     14900**DCL     15091<<ASSIGN  15124<<ASSIGN  15137<<ASSIGN  15141>>IF
CONSTRUCT_RETURN_ADDRESS
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:418  
     14653**PROC    14079--CALL    14437--CALL
CONT_MAIL
     13822**LABEL   13820--GOTO
CONT_PROCESS
     13813**LABEL   13734--GOTO    13821--GOTO
CONT_UNRESOLVED
     13769**LABEL   13751--GOTO    13822--GOTO
COUNT
     12086**DCL     14124<<ASSIGN  14127>>ASSIGN  14128<>CALL    14250<<CALLBLT 14251>>ASSIGN  14261>>ASSIGN
CREATE_NEW_MAILGRAM
     14477**PROC    14075--CALL    14433--CALL
CREATE_SEND IN PROCEDURE CREATE_NEW_MAILGRAM
     14558**DCL     14639<>CALL
CREATE_SEND.ACSVEH_ IN PROCEDURE CREATE_NEW_MAILGRAM
     14560**DCL     14561--REDEF
CREATE_SEND.ALTKEYS_ IN PROCEDURE CREATE_NEW_MAILGRAM
     14566**DCL     14567--REDEF   14567--REDEF
CREATE_SEND.HDR_ IN PROCEDURE CREATE_NEW_MAILGRAM
     14565**DCL     14566--REDEF
CREATE_SEND.TAB_ IN PROCEDURE CREATE_NEW_MAILGRAM
     14564**DCL     14565--REDEF
CREATE_SEND.UHL_ IN PROCEDURE CREATE_NEW_MAILGRAM
     14558**DCL     14559--REDEF   14559--REDEF
CREATE_SEND.V IN PROCEDURE CREATE_NEW_MAILGRAM
     14567**DCL     14558--DCLINIT
CREATE_SEND.V.DCB# IN PROCEDURE CREATE_NEW_MAILGRAM
     14567**DCL     14638<<ASSIGN
CREATE_SEND.V.FSN# IN PROCEDURE CREATE_NEW_MAILGRAM
     14598**DCL     14598--REDEF   14598--REDEF
CREATE_SEND.WSN_ IN PROCEDURE CREATE_NEW_MAILGRAM
     14564**DCL     14564--REDEF
CURRENT_TIME
     13453**DCL     12761--DCLINIT 13546>>ASSIGN  13624>>ASSIGN  13855>>ASSIGN  13992>>IF      14023>>ASSIGN
     14034>>ASSIGN  14057<>CALL    14060>>IF      14095>>ASSIGN  14185<>CALL    14390>>ASSIGN  14428>>ASSIGN
     14635>>CALLBLT 15106<>CALL    15109>>IF      15158>>ASSIGN  16187>>CALLBLT
DCB# IN PROCEDURE CREATE_NEW_MAILGRAM
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:419  
     14484**DCL     14477--PROC    14638>>ASSIGN
DELAY_TIME
     12118**DCL     14176<<ASSIGN  14180<<ASSIGN  14182<<ASSIGN  14185>>CALL
DELIVER
     13982**LABEL   13987--EXIT    13997--EXIT
DELIVERY
     12110**DCL     14122>>ASSIGN
DELIVERY.C
     12112**DCL     14121<<ASSIGN
DELIVERY.L
     12111**DCL     14120<<ASSIGN
DELIVERY_SUMMARY
     12137**DCL     13979<<ASSIGN  14051>>ASSIGN
DELIVERY_SUMMARY.BUSY
     12138**DCL     14029<<ASSIGN  14029>>ASSIGN  14055>>IF
DELIVERY_SUMMARY.HOG_LIMIT
     12141**DCL     13996<<ASSIGN  14052>>IF
DELIVERY_SUMMARY.PACKSET_NA
     12139**DCL     14031<<ASSIGN  14031>>ASSIGN  14055>>IF
DEQ_HEADER
     12900**DCL     15238<>CALL    15281<>CALL
DEQ_HEADER.V
     12901**DCL     12900--DCLINIT
DEQ_PROFILE
     12842**DCL     15226<>CALL    15279<>CALL
DEQ_PROFILE.V
     12843**DCL     12842--DCLINIT
DONT_CARE IN PROCEDURE VOM$SENDIT
     15274**LABEL   15283--CALLALT
END_LOOP1
     13772**LABEL   13743--CALLALT
ENQ_HEADER
     12879**DCL     13960<>CALL    15219<>CALL
ENQ_HEADER.V
     12880**DCL     12879--DCLINIT
ENQ_ON_PROFILE
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:420  
     14836**PROC    13948--CALL    15071--CALL
ENQ_PROFILE
     12821**DCL     14848<>CALL
ENQ_PROFILE.V
     12822**DCL     12821--DCLINIT
ERRMSG_FID.L#
     10313**DCL     10313--IMP-SIZ
ERROR
     12572**DCL     13612<<ASSIGN  13621<<ASSIGN  13623>>ASSIGN  13728<<ASSIGN  13746<<ASSIGN  13893<<ASSIGN
     13939<<ASSIGN  14033>>ASSIGN  14197<<ASSIGN  14392>>ASSIGN  14422>>ASSIGN  14853<<ASSIGN  14877<<ASSIGN
     15055<<ASSIGN  15058<<ASSIGN  15079<<ASSIGN  15132<<ASSIGN  15214<<ASSIGN  15255<<ASSIGN  15271<<ASSIGN
     15276<<ASSIGN  15968<<ASSIGN  15972<<ASSIGN  16242<<ASSIGN  16246<<ASSIGN  16250<<ASSIGN
ERROR.ERR#
     12602**DCL     13940>>DOSELCT 14854>>IF      15056>>DOSELCT 15258>>IF
ERROR_RETURN IN PROCEDURE VOM$SENDIT
     15279**LABEL   15080--GOTO    15133--GOTO    15215--GOTO
ERROR_SWEEP_COMPLETE
     13894**LABEL   13886--CALLALT
ERR_FLAG
     12090**DCL     13554<<ASSIGN
EXTERNAL
     12107**DCL     15770<>CALL
EXTERNAL.ACCT
     12109**DCL     15923>>ASSIGN
EXTERNAL.SITENAME
     12108**DCL     15924>>ASSIGN
E_ADD IN PROCEDURE BUILD_ADD_LIST
     16090**LABEL   16068--CALLALT 16074--CALLALT
E_ADDUNKNOWN
     12618**DCL     13621>>ASSIGN  13728>>ASSIGN  13746>>ASSIGN
E_ALLOCATE IN PROCEDURE ASSIGN_A_MESSAGE_ID
     14266**LABEL   14258--CALLALT
E_ALLOCATE IN PROCEDURE BUILD_INTERSYS_LIST
     16246**LABEL   16211--CALLALT
E_ALLOCATE IN PROCEDURE TRANSPORT_INTERSYS
     15968**LABEL   15791--CALLALT 15831--CALLALT
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:421  
E_ALLOCATE IN PROCEDURE VOM$SENDIT
     15276**LABEL   15168--CALLALT 15183--CALLALT
E_BADSITE IN PROCEDURE BUILD_INTERSYS_LIST
     16123**DCL     16242>>ASSIGN
E_COPY IN PROCEDURE VOM$SENDIT
     15255**LABEL   15229--CALLALT 15232--CALLALT
E_DELIVERED
     13268**DCL     14116>>ASSIGN
E_DISKSPACE
     13218**DCL     15260>>ASSIGN
E_FOLDERFULL
     13169**DCL     15211>>ASSIGN  15214>>ASSIGN
E_HEADER IN PROCEDURE VOM$SENDIT
     15265**LABEL   15212--CALLALT 15224--CALLALT 15261--CALLALT
E_INTERSYSILL
     12971**DCL     14877>>ASSIGN
E_NOMID
     13020**DCL     15058>>ASSIGN
E_PMME IN PROCEDURE BUILD_INTERSYS_LIST
     16250**LABEL   16209--CALLALT
E_PMME IN PROCEDURE TRANSPORT_INTERSYS
     15972**LABEL   15770--CALLALT 15777--CALLALT 15789--CALLALT 15829--CALLALT 15918--CALLALT 15919--CALLALT
E_PROERR
     13119**DCL     15079>>ASSIGN  15132>>ASSIGN
F$DCB.ACTPOS
     11179**DCL     11179--REDEF
F$DCB.ARS#
     11153**DCL     11153--REDEF
F$DCB.ATTR
     11172**DCL     11173--REDEF
F$DCB.BORROW
     11187**DCL     11187--REDEF   11187--REDEF   11187--REDEF
F$DCB.DCBNAME.L
     11201**DCL     11201--IMP-SIZ
F$DCB.EOMCHAR#
     11157**DCL     11157--REDEF
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:422  
F$DCB.FCD#
     11166**DCL     13677>>IF
F$DCB.FLDID
     11182**DCL     11182--REDEF
F$DCB.FORM$
     11176**DCL     11176--REDEF
F$DCB.FSECT
     11192**DCL     11192--REDEF
F$DCB.FSN#
     11169**DCL     11169--REDEF   11169--REDEF   11170--REDEF
F$DCB.HEADER$
     11175**DCL     11175--REDEF
F$DCB.IXTNSIZE#
     11173**DCL     11173--REDEF
F$DCB.LASTSTA$
     11162**DCL     11162--REDEF
F$DCB.LVL
     11188**DCL     11188--REDEF
F$DCB.NAME#
     11163**DCL     14198>>ASSIGN
F$DCB.NAME#.C
     11163**DCL     11163--REDEF
F$DCB.NOEOF
     11185**DCL     11185--REDEF
F$DCB.NRECS#
     11174**DCL     11174--REDEF
F$DCB.NRECX
     11193**DCL     11193--REDEF
F$DCB.OHDR
     11185**DCL     11185--REDEF
F$DCB.ORG#
     11168**DCL     11168--REDEF
F$DCB.PRECNO
     11191**DCL     11191--REDEF
F$DCB.RCSZ
     11197**DCL     11197--REDEF
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:423  
F$DCB.RES#
     11164**DCL     11164--REDEF
F$DCB.SETX
     11176**DCL     11176--REDEF
F$DCB.TAB$
     11176**DCL     11176--REDEF
F$DCB.TDA
     11190**DCL     11191--REDEF
F$DCB.WSN#
     11164**DCL     11164--REDEF
FAKE_ADDRESS$ IN PROCEDURE CONSTRUCT_RETURN_ADDRESS
     14806**DCL     14817<<ASSIGN  14821>>ASSIGN  14822>>ASSIGN
FAKE_HEAD$ IN PROCEDURE CONSTRUCT_RETURN_ADDRESS
     14804**DCL     14814<<ASSIGN  14817>>ASSIGN
FILE_FOLDER_INFO IN PROCEDURE VOM$SENDIT
     15001**DCL     15103<>CALL
FILE_FOLDER_INFO.FLAGS IN PROCEDURE VOM$SENDIT
     15024**DCL     15102<<ASSIGN
FILL_IN_DELIVERY_RECORD
     14352**PROC    13771--CALL    13797--CALL
FPT_OLAY IN PROCEDURE TRANSPORT_INTERSYS
     15688**DCL     15937<>CALL    15959<>CALL
FPT_OLAY.V IN PROCEDURE TRANSPORT_INTERSYS
     15689**DCL     15688--DCLINIT
FPT_OLAY.V.FLGS.CANCEL# IN PROCEDURE TRANSPORT_INTERSYS
     15690**DCL     15936<<ASSIGN  15958<<ASSIGN
GENERATE_AN_ERROR_ENTRY
     14379**PROC    13732--CALL    13750--CALL    13765--CALL    13791--CALL
GET_ADD_RECORD
     14286**PROC    13699--CALL    13807--CALL    13813--CALL
GET_ANSI_TIME
     12782**DCL     14248<>CALL
GET_ANSI_TIME.V
     12786**DCL     12782--DCLINIT
GET_CURRENT
     12757**DCL     13545<>CALL    13991<>CALL    14183<>CALL    14634<>CALL    15044<>CALL    16186<>CALL
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:424  
GET_CURRENT.V
     12761**DCL     12757--DCLINIT
HEAD$
     12085**DCL         6--PROC    13495>>ASSIGN
HEAD$ IN PROCEDURE BUILD_ADD_LIST
     15977**DCL     15975--PROC    16059>>ASSIGN
HEADER_MCB
     12180**DCL     14258<>CALL    14412<>CALL    14417<>CALL    15168<>CALL    15183<>CALL    15786<>CALL
     15791<>CALL    15826<>CALL    15831<>CALL    15846<>CALL
HEADER_MCB.ADDRESS$
     12180**DCL     14260>>ASSIGN  14419>>ASSIGN  15167<<ASSIGN  15182<<ASSIGN  15793>>ASSIGN  15833>>ASSIGN
     15845<<ASSIGN
HEADER_MCB.ERR
     12181**DCL     15276>>ASSIGN  15968>>ASSIGN
HEADER_MCB.FREE_HEAD$
     12180**DCL     14226<<ASSIGN  14256<<ASSIGN  14424>>ASSIGN  15171>>ASSIGN  15186>>ASSIGN  15796>>ASSIGN
     15835>>ASSIGN  15849>>ASSIGN
HEADER_MCB.HI_SEGMENT$
     12180**DCL     14225<<ASSIGN  14255<<ASSIGN  14259>>ASSIGN  14423>>ASSIGN  15170>>ASSIGN  15185>>ASSIGN
     15795>>ASSIGN  15834>>ASSIGN  15848>>ASSIGN
HEADER_MCB.MIN_SIZE
     12181**DCL     14223<<ASSIGN  14253<<ASSIGN
HEADER_MCB.SEGMENT_BASE$
     12180**DCL     14224<<ASSIGN  14254<<ASSIGN
HEADER_MCB.SIZE
     12180**DCL     14251<<ASSIGN  14411<<ASSIGN  15785<<ASSIGN  15825<<ASSIGN
HEADER_MCB.TYPE
     12180**DCL     14222<<ASSIGN  14252<<ASSIGN
HEADER_MCB.WKSZ
     12180**DCL     14227<<ASSIGN  14257<<ASSIGN  14416<<ASSIGN  15790<<ASSIGN  15830<<ASSIGN
HOG_COUNT
     12116**DCL     13981<<ASSIGN  13992>>IF      14026<<ASSIGN  14026>>ASSIGN
I IN PROCEDURE ENQ_ON_PROFILE
     14844**DCL     14846<<ASSIGN  14847>>DOUNTIL 14867<<ASSIGN  14867>>ASSIGN
I IN PROCEDURE UPDATE_STATUS
     14272**DCL     14278<<CALLBLT 14280>>ASSIGN
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:425  
IADDLIST_MCB
     12175**DCL     16206<>CALL    16211<>CALL
IADDLIST_MCB.ADDRESS$
     12175**DCL     16213>>ASSIGN  16214>>ASSIGN  16215>>ASSIGN  16216>>ASSIGN  16219>>ASSIGN  16222>>ASSIGN
     16224>>CALLBLT 16230>>ASSIGN  16231>>ASSIGN  16233>>ASSIGN  16234>>ASSIGN  16236>>ASSIGN  16237>>ASSIGN
IADDLIST_MCB.ERR
     12176**DCL     16246>>ASSIGN
IADDLIST_MCB.FREE_HEAD$
     12175**DCL     13670<<ASSIGN
IADDLIST_MCB.HI_SEGMENT$
     12175**DCL     13668<<ASSIGN
IADDLIST_MCB.MIN_SIZE
     12176**DCL     13666<<ASSIGN
IADDLIST_MCB.SEGMENT_BASE$
     12175**DCL     13667<<ASSIGN
IADDLIST_MCB.SIZE
     12175**DCL     16200<<ASSIGN  16203<<ASSIGN
IADDLIST_MCB.TYPE
     12175**DCL     13665<<ASSIGN
IADDLIST_MCB.WKSZ
     12175**DCL     13669<<ASSIGN  16210<<ASSIGN
IBC_HEAD$
     12172**DCL     13663<<ASSIGN  15814>>IF      15817<>CALL    16233>>ASSIGN  16234<<ASSIGN
IC_HEAD$
     12173**DCL     13664<<ASSIGN  15852>>IF      15854<>CALL    16236>>ASSIGN  16237<<ASSIGN
ID
     12103**DCL     13958<<ASSIGN  13965>>IF      14249<<CALLBLT 14250>>CALLBLT 14262>>ASSIGN
INDX IN PROCEDURE BUILD_INTERSYS_LIST
     16106**DCL     16190<<CALLBLT 16191>>CALLBLT
INDX IN PROCEDURE TRANSPORT_INTERSYS
     15749**DCL     15772<<CALLBLT 15773>>ASSIGN  15891<<DOINDEX 15892>>IF
INDX1 IN PROCEDURE BUILD_INTERSYS_LIST
     16107**DCL     16188<<CALLBLT 16189>>CALLBLT 16191>>CALLBLT
INIT_ADD_HEAD IN PROCEDURE CONSTRUCT_RETURN_ADDRESS
     14783**DCL     14819>>ASSIGN
INIT_DELIVERY
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:426  
     11834**DCL     14322>>ASSIGN
INIT_DELIVERYKEY
     11890**DCL     13877>>ASSIGN  13980>>ASSIGN  14102>>ASSIGN  14332>>ASSIGN
INIT_DELIVERY_RECORD
     14310**PROC    13590--CALL    13606--CALL    13651--CALL    13770--CALL    13796--CALL    13844--CALL
     13926--CALL    14381--CALL
INIT_ENCODED_ERR_BODYREC
     12025**DCL     14113>>ASSIGN
INIT_RADDRESS
     11617**DCL     14000>>ASSIGN
INIT_RADDRESS.FOLDER
     11632**DCL     11633--REDEF
INTERSYS$
     10030**DCL     10035--IMP-PTR 15759<<ASSIGN  15764>>CALLBLT 15770>>CALL    15771>>CALLBLT 15890>>IF
     15892>>IF      15903<>CALL    15916>>ASSIGN  15929>>ASSIGN  15962<>CALL    16062>>IF      16173<<ASSIGN
     16174>>DOWHILE 16175>>IF      16179<<ASSIGN  16179>>ASSIGN  16184<>CALL    16185>>ASSIGN  16187>>CALLBLT
     16189>>CALLBLT 16191>>CALLBLT
INTERSYS_ACTIVE
     12095**DCL     13509<<ASSIGN  13514<<ASSIGN  14290>>IF
INTERSYS_HEAD$
     10029**DCL     13865>>IF      15758>>DOWHILE 15759>>ASSIGN  15903<>CALL    15962<>CALL    16173>>ASSIGN
     16184<>CALL
INTERSYS_INFO.NAME
     10035**DCL     15771>>CALLBLT 16187<<CALLBLT 16189<<CALLBLT 16191<<CALLBLT
INTERSYS_INFO.NEXT$
     10035**DCL     16179>>ASSIGN
INTERSYS_INFO.SITENAME
     10035**DCL     15764>>CALLBLT 15770<>CALL    15890>>IF      15892>>IF      15916>>ASSIGN  15929>>ASSIGN
     16062>>IF      16175>>IF      16185<<ASSIGN
ITO_HEAD$
     12171**DCL     13662<<ASSIGN  15811>>IF      15813<>CALL    16230>>ASSIGN  16231<<ASSIGN
KEY_VALUE IN PROCEDURE BUILD_INTERSYS_LIST
     16105**DCL     16161<<CALLBLT 16162>>IF      16168<>CALL
LOOP_ADDRESS IN PROCEDURE TRANSPORT_INTERSYS
     15897**LABEL   15890--GOTO
LOWER_UPPER
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:427  
     11132**DCL     16161>>CALLBLT
M$ACTIVATE
      9861**DCL-ENT 15935--CALL    15957--CALL
M$CLOSE
      9841**DCL-ENT 13950--CALL    13955--CALL    13974--CALL    14137--CALL    14141--CALL    14188--CALL
     14193--CALL    14200--CALL    14205--CALL    14462--CALL    15073--CALL    15112--CALL    15119--CALL
     15128--CALL    15146--CALL    15241--CALL    15283--CALL    15898--CALL    15919--CALL
M$DEQ
      9908**DCL-ENT 15226--CALL    15238--CALL    15279--CALL    15281--CALL
M$DISPRES
      9848**DCL-ENT 14162--CALL    14202--CALL
M$ENQ
      9907**DCL-ENT 13960--CALL    14848--CALL    15219--CALL
M$ERR
      9853**DCL-ENT 13962--CALL    14856--CALL    15220--CALL
M$MAIL_GLOBAL_NUM
     10228**DCL     13677--IF      13679<>CALL    13681>>ASSIGN
M$OLAY
      9853**DCL-ENT 15937--CALL    15959--CALL
M$OPEN
      9841**DCL-ENT 13500--CALL    14639--CALL    15777--CALL    15947--CALL
M$READ
      9842**DCL-ENT 13708--CALL    13883--CALL    14106--CALL    14861--CALL
M$RELRES
      9848**DCL-ENT 14163--CALL    14203--CALL
M$TIME
      9908**DCL-ENT 13545--CALL    13991--CALL    14183--CALL    14248--CALL    14634--CALL    15044--CALL
     16186--CALL
M$WAIT
      9899**DCL-ENT 14643--CALL
M$XXX
      9853**DCL-ENT 15938--CALL    15960--CALL
MAIL_FILECOPY
     12093**DCL     15103<>CALL    15117<>CALL    15122<>CALL
MAIL_IN
     12091**DCL     13507<>CALL    13548<>CALL    13572<>CALL    13592<>CALL    13607<>CALL    13620<>CALL
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:428  
     13637<>CALL    13653<>CALL    13660<>CALL    13772<>CALL    13798<>CALL    13845<>CALL    13854<>CALL
     13858<>CALL    13886<>CALL    13898<>CALL    13927<>CALL    13985<>CALL    14048<>CALL    14109<>CALL
     14156<>CALL    14186<>CALL    14187<>CALL    14198--ASSIGN  14211<>CALL    14293<>CALL    14301<>CALL
     14393<>CALL    14459<>CALL    14473<>CALL    15122<>CALL    15135<>CALL    15229<>CALL    15232<>CALL
     15882<>CALL
MAIL_NAME
     12294**DCL     13499<<ASSIGN
MAIL_OUT
     12092**DCL     13937<>CALL    13953<>CALL    13964<>CALL    13971<>CALL    14075<>CALL    14083<>CALL
     14128<>CALL    14136<>CALL    14138<>CALL    14433<>CALL    14440<>CALL    14455<>CALL    14459<>CALL
     14461<>CALL    15052<>CALL    15077<>CALL    15130<>CALL    15135<>CALL    15157<>CALL    15212<>CALL
     15224<>CALL    15229<>CALL    15232<>CALL    15236<>CALL    15261<>CALL    15269<>CALL    15882<>CALL
     15918<>CALL    16086<>CALL
MAKE_FILENAME IN PROCEDURE CREATE_NEW_MAILGRAM
     14634**LABEL   14644--GOTO
MASK
     12099**DCL     15166<<ASSIGN
MASK_LEN
     12100**DCL     12099--IMP-SIZ 15165<<ASSIGN  15166>>ASSIGN
MESSAGE_NUMBER
     12114**DCL     13953<>CALL    13959>>ASSIGN  13964<>CALL    13971<>CALL
MOVE_NAME IN PROCEDURE TRANSPORT_INTERSYS
     15460**DCL     15537--DCLINIT
MOVE_NAME.L# IN PROCEDURE TRANSPORT_INTERSYS
     15460**DCL     15773<<ASSIGN
MOVE_NAME.NAME# IN PROCEDURE TRANSPORT_INTERSYS
     15460**DCL     15763<<ASSIGN  15771<<CALLBLT 15772>>CALLBLT
MYSTATION IN PROCEDURE TRANSPORT_INTERSYS
     15661**DCL     15637--DCLINIT
MYSTATION.MSGIDXT IN PROCEDURE TRANSPORT_INTERSYS
     15671**DCL     15674--REDEF
NEW_NAME
     12558**DCL     12516--DCLINIT 14198<<ASSIGN
NEW_NAME.NAME#
     12558**DCL     14199<<ASSIGN
NEXT$
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:429  
     12081**DCL     13736<<ASSIGN  13743<>CALL
NEXT_ADD
     13790**LABEL   13699--CALLALT 13720--CALLALT 13807--CALLALT 13813--CALLALT
NODE IN PROCEDURE TRANSPORT_INTERSYS
     15752**DCL     15924<<ASSIGN  15929<<ASSIGN  15943<>CALL
NO_COPY_TO_SENDER
     13865**LABEL   13845--CALLALT 13851--CALLALT 13854--CALLALT
NO_SITE IN PROCEDURE BUILD_INTERSYS_LIST
     16235**LABEL   16168--CALLALT
NO_UPDATE
     13974**LABEL   13964--CALLALT 13971--CALLALT
NUM_RECEIPTS
     12117**DCL     14101<<ASSIGN  14128<>CALL    14129<<ASSIGN  14129>>ASSIGN  14133>>IF      14135>>ASSIGN
ONE IN PROCEDURE TRANSPORT_INTERSYS
     15297**DCL     15296--PROC    15808>>IF      15886>>IF      15963>>IF
ONE_PHASE
     13560**LABEL   13581--EXIT    13598--EXIT    13876--EXIT    13918--EXIT    13929--EXIT    13935--EXIT
     13945--EXIT    13956--EXIT    14069--EXIT
OOPS
     14141**LABEL   14128--CALLALT 14136--CALLALT
OPEN_MAIL
     12361**DCL     13500<>CALL
OPEN_MAIL.ACSVEH_
     12363**DCL     12364--REDEF
OPEN_MAIL.ALTKEYS_
     12369**DCL     12370--REDEF   12370--REDEF
OPEN_MAIL.HDR_
     12368**DCL     12369--REDEF
OPEN_MAIL.TAB_
     12367**DCL     12368--REDEF
OPEN_MAIL.UHL_
     12361**DCL     12362--REDEF   12362--REDEF
OPEN_MAIL.V.FSN#
     12401**DCL     12401--REDEF   12401--REDEF
OPEN_MAIL.WSN_
     12367**DCL     12367--REDEF
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:430  
OPEN_MAIL_CREATE IN PROCEDURE TRANSPORT_INTERSYS
     15536**DCL     15777<>CALL    15947<>CALL
OPEN_MAIL_CREATE.ACCT_ IN PROCEDURE TRANSPORT_INTERSYS
     15540**DCL     15760<<ASSIGN
OPEN_MAIL_CREATE.ACSVEH_ IN PROCEDURE TRANSPORT_INTERSYS
     15538**DCL     15539--REDEF
OPEN_MAIL_CREATE.ALTKEYS_ IN PROCEDURE TRANSPORT_INTERSYS
     15544**DCL     15545--REDEF   15545--REDEF
OPEN_MAIL_CREATE.HDR_ IN PROCEDURE TRANSPORT_INTERSYS
     15543**DCL     15544--REDEF
OPEN_MAIL_CREATE.TAB_ IN PROCEDURE TRANSPORT_INTERSYS
     15542**DCL     15543--REDEF
OPEN_MAIL_CREATE.UHL_ IN PROCEDURE TRANSPORT_INTERSYS
     15536**DCL     15537--REDEF   15537--REDEF
OPEN_MAIL_CREATE.V IN PROCEDURE TRANSPORT_INTERSYS
     15545**DCL     15536--DCLINIT
OPEN_MAIL_CREATE.V.DELETE# IN PROCEDURE TRANSPORT_INTERSYS
     15547**DCL     15762<<ASSIGN  15946<<ASSIGN  15950<<ASSIGN
OPEN_MAIL_CREATE.V.FSN# IN PROCEDURE TRANSPORT_INTERSYS
     15576**DCL     15576--REDEF   15576--REDEF
OPEN_MAIL_CREATE.V.FUN# IN PROCEDURE TRANSPORT_INTERSYS
     15555**DCL     15761<<ASSIGN  15945<<ASSIGN  15949<<ASSIGN
OPEN_MAIL_CREATE.WSN_ IN PROCEDURE TRANSPORT_INTERSYS
     15542**DCL     15542--REDEF
OUTSTATION.MSGIDXT
     12677**DCL     12680--REDEF
OUTSTATION.MSGIDXT IN PROCEDURE TRANSPORT_INTERSYS
     15744**DCL     15747--REDEF
OV_NAME IN PROCEDURE TRANSPORT_INTERSYS
     15719**DCL     15688--DCLINIT
PREFIX IN PROCEDURE TRANSPORT_INTERSYS
     15750**DCL     15922<<ASSIGN  15927<<ASSIGN  15943<>CALL
PROCESS
     13557**LABEL   13617--EXIT    13943--EXIT    13951--EXIT    14054--EXIT    14061--EXIT
PROCESSING
     12094**DCL     13686<<ASSIGN  13703>>DOWHILE 13816<<ASSIGN  13820>>IF
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:431  
PROCESS_ERROR
     12097**DCL     13704<<ASSIGN  13723<<ASSIGN  13733<<ASSIGN  13821>>IF      13822>>IF
PTR$
     12096**DCL     13720<>CALL    14289<<ASSIGN  14306<<ASSIGN
PTR$ IN PROCEDURE BUILD_ADD_LIST
     15980**DCL     15991--IMP-PTR 16026--IMP-PTR 16059<<ASSIGN  16060>>DOWHILE 16061>>CALL    16065>>IF
     16068>>CALL    16068>>CALL    16068>>CALL    16068>>CALL    16068>>CALL    16074>>CALL    16074>>CALL
     16074>>CALL    16074>>CALL    16074>>CALL    16079<<ASSIGN  16079>>ASSIGN
PURGE
     13652**LABEL   13655--EXIT    13659--EXIT
QUEUE_INTERSYS
     14873**PROC    13760--CALL    13786--CALL
REAL_ADDRESS$ IN PROCEDURE CONSTRUCT_RETURN_ADDRESS
     14805**DCL     14816<<ASSIGN  14826>>ASSIGN  14828>>ASSIGN  14829>>ASSIGN  14830>>ASSIGN
REAL_HEAD$ IN PROCEDURE CONSTRUCT_RETURN_ADDRESS
     14803**DCL     14813<<ASSIGN  14816>>ASSIGN  14819>>ASSIGN  14820>>ASSIGN  14821>>ASSIGN  14822>>ASSIGN
     14823>>ASSIGN
RECEIPTS_DONE
     14133**LABEL   14109--CALLALT
REFRESH_INPUT_HEADER
     14209**PROC    13533--CALL    13618--CALL    13842--CALL    13852--CALL    13999--CALL    14154--CALL
     14184--CALL    14410--CALL    14464--CALL    15126--CALL    15139--CALL
RELEASED
     14163**LABEL   14162--CALLALT 14163--CALLALT
REL_PACK
     12933**DCL     14162<>CALL    14163<>CALL    14202<>CALL    14203<>CALL
REL_PACK.V
     12935**DCL     12933--DCLINIT
RENAME_BAD_FILE
     12514**DCL     14200<>CALL
RENAME_BAD_FILE.SN_
     12514**DCL     12514--REDEF
RENAME_BAD_FILE.UTL_
     12515**DCL     12515--REDEF
RENAME_BAD_FILE.V
     12519**DCL     12514--DCLINIT
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:432  
RENAME_BAD_FILE.V.EXPIRE#
     12529**DCL     12529--REDEF
RENAME_BAD_FILE.V.TYPE#
     12527**DCL     12527--REDEF
RENAME_BAD_FILE.V.XTNSIZE#
     12524**DCL     12524--REDEF   12526--REDEF
RENAME_DIDNT_WORK
     14199**LABEL   14200--CALLALT
RETURN_ADDRESS_BUFFER
     12113**DCL     14079<>CALL    14079--CALL    14083--CALL    14437<>CALL    14437--CALL    14440--CALL
RETURN_ERROR_MSG
     14399**PROC    13896--CALL    14042--CALL
RPSN
     12953**DCL     12934--DCLINIT
SAVED_FLAGS IN PROCEDURE VOM$SENDIT
     14903**DCL     15090<<ASSIGN  15127>>ASSIGN  15140>>ASSIGN
SCRATCH$
     12121**DCL     14138<>CALL    14461<>CALL
SEND_BC
     12079**DCL     13496<<ASSIGN
SEND_NAME IN PROCEDURE CREATE_NEW_MAILGRAM
     14628**DCL     14559--DCLINIT
SEND_NAME.L# IN PROCEDURE CREATE_NEW_MAILGRAM
     14628**DCL     14637<<ASSIGN
SEND_NAME.NAME# IN PROCEDURE CREATE_NEW_MAILGRAM
     14628**DCL     14636<<CALLBLT 14637--ASSIGN
SEND_STRING IN PROCEDURE CREATE_NEW_MAILGRAM
     14631**DCL     14635<<CALLBLT 14636>>CALLBLT
SET_FCOPY_FLAG IN PROCEDURE RETURN_ERROR_MSG
     14407**DCL     14409<<ASSIGN  14458<<ASSIGN  14470>>IF
SITENAME
     12104**DCL     13753<>CALL    13755<<ASSIGN  13757>>IF      13757>>IF      13769>>ASSIGN  13779<>CALL
     13781<<ASSIGN  13783>>IF      13783>>IF      13795>>ASSIGN  15770<>CALL
SITENAME IN PROCEDURE BUILD_ADD_LIST
     15979**DCL     16061<>CALL    16062>>IF
SITENAME IN PROCEDURE BUILD_INTERSYS_LIST
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:433  
     16108**DCL     16168<>CALL    16175>>IF      16185>>ASSIGN  16190>>CALLBLT 16191>>CALLBLT
SITE_TYPE
     12106**DCL     15770<>CALL    15920>>IF
STATUS_STRING
     12105**DCL     13493<<ASSIGN  13568<<ASSIGN  13582<<ASSIGN  13599<<ASSIGN  13642<<ASSIGN  13879<<ASSIGN
     13891<<ASSIGN  13919<<ASSIGN  13983<<ASSIGN  14012<<CALLBLT 14070<<ASSIGN  14147<<ASSIGN  14278>>CALLBLT
     14279>>ASSIGN  15764<<CALLBLT
TIME$
     10029**DCL     10033--IMP-PTR 13495<<ASSIGN  13499>>ASSIGN  13992>>IF      13992>>IF      14171<>CALL
     14187<>CALL    14206<>CALL    15046>>ASSIGN
TIME_CURR$ IN PROCEDURE VOM$SENDIT
     14902**DCL     15046<<ASSIGN
TIME_HEAD$
     10029**DCL     14138<>CALL    14171<>CALL    14187<>CALL    14206<>CALL    14461<>CALL
TIME_TABLE.NAME
     10034**DCL     13499>>ASSIGN
TIME_TABLE.NEXT$
     10033**DCL     13992>>IF      13992>>IF
TIME_TABLE.TSTAMP
     10033**DCL     13992>>IF
TOSS_IT
     14205**LABEL   14202--CALLALT 14203--CALLALT
TRANSPORT_INTERSYS
     15296**PROC    13867--CALL
TYPE IN PROCEDURE BUILD_ADD_LIST
     15978**DCL     15975--PROC    16086<>CALL
UNDELIVERED
     12130**DCL     13558<<ASSIGN  14020<<ASSIGN  14051<<ASSIGN
UNDELIVERED.BUSY
     12131**DCL     13615>>IF      13942<<ASSIGN  14029>>ASSIGN  14172>>IF      14178>>IF      15061<<ASSIGN
     15074<<ASSIGN  15111<<ASSIGN
UNDELIVERED.HOG_LIMIT
     12134**DCL     14172>>IF      14174>>IF
UNDELIVERED.IO_ERROR
     12133**DCL     14035>>IF      15059<<ASSIGN  15067<<ASSIGN
UNDELIVERED.PACKSET_NA
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:434  
     12132**DCL     13615>>IF      14031>>ASSIGN  14172>>IF      15065<<ASSIGN
UPDATE_FILE_COPY IN PROCEDURE VOM$SENDIT
     15101**LABEL   15115--EXIT    15120--EXIT
UPDATE_STATUS
     14270**PROC    13494--CALL    13569--CALL    13583--CALL    13600--CALL    13643--CALL    13880--CALL
     13892--CALL    13920--CALL    13984--CALL    14014--CALL    14071--CALL    14148--CALL    15765--CALL
UTS_X
     12119**DCL     14057<>CALL    14058<<ASSIGN  14058>>ASSIGN  14060>>IF      15106<>CALL    15107<<ASSIGN
     15107>>ASSIGN  15109>>IF
UTS_Y
     12120**DCL     14059<>CALL    14060>>IF      15108<>CALL    15109>>IF
VM$BODYREC.VALUE.COUNT
     11998**DCL     12008--IMP-SIZ
VM$RADDRESS
     11689**DCL     13553>>ASSIGN  13588>>ASSIGN  13605>>ASSIGN  13925>>ASSIGN  14079<>CALL    14437<>CALL
     15098>>IF      15794<<ASSIGN
VM$RADDRESS.ACCT
     11712**DCL     16219<<ASSIGN
VM$RADDRESS.FOLDER
     11704**DCL     11705--REDEF   16213<<ASSIGN
VM$RADDRESS.NEXT$
     11690**DCL     16230<<ASSIGN  16233<<ASSIGN  16236<<ASSIGN
VM$RADDRESS.PASS
     11709**DCL     16214<<ASSIGN
VM$RADDRESS.SITENAME
     11711**DCL     16215<<ASSIGN
VM$RADDRESS.TYPE
     11701**DCL     16216<<ASSIGN
VM$RADDRESS.ACCT IN PROCEDURE BUILD_ADD_LIST
     16014**DCL     16068<>CALL
VM$RADDRESS.FOLDER IN PROCEDURE BUILD_ADD_LIST
     16006**DCL     16007--REDEF   16068<>CALL
VM$RADDRESS.NAME_KEY IN PROCEDURE BUILD_ADD_LIST
     16004**DCL     16068<>CALL
VM$RADDRESS.NEXT$ IN PROCEDURE BUILD_ADD_LIST
     15992**DCL     16079>>ASSIGN
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:435  
VM$RADDRESS.PASS IN PROCEDURE BUILD_ADD_LIST
     16011**DCL     16068<>CALL
VM$RADDRESS.SITENAME IN PROCEDURE BUILD_ADD_LIST
     16013**DCL     16061<>CALL    16068<>CALL
VM$RADDRESS.TYPE IN PROCEDURE BUILD_ADD_LIST
     16003**DCL     16065>>IF
VM$UADDRESS.FOLDER
     11739**DCL     11740--REDEF
VM$UADDRESS.USER_NAME.COUNT
     11748**DCL     16222<<ASSIGN
VM$UADDRESS.USER_NAME.TEXT
     11749**DCL     16224<<CALLBLT
VM$UADDRESS.FOLDER IN PROCEDURE BUILD_ADD_LIST
     16041**DCL     16042--REDEF   16074<>CALL
VM$UADDRESS.NAME_KEY IN PROCEDURE BUILD_ADD_LIST
     16039**DCL     16074<>CALL
VM$UADDRESS.PASS IN PROCEDURE BUILD_ADD_LIST
     16046**DCL     16074<>CALL
VM$UADDRESS.SITENAME IN PROCEDURE BUILD_ADD_LIST
     16048**DCL     16074<>CALL
VM$UADDRESS.USER_NAME IN PROCEDURE BUILD_ADD_LIST
     16049**DCL     16074<>CALL
VMA$ADD_RENTRY
     13481**DCL-ENT 16068--CALL
VMA$ADD_UENTRY
     13482**DCL-ENT 16074--CALL
VMA$DEL_ADD_RECORD
     13478**DCL-ENT 15236--CALL
VMA$ENLARGE_SEGMENT
     13473**DCL-ENT 14415--CALL    15789--CALL    15829--CALL    16209--CALL
VMA$EXPAND_LIST_FULL
     13479**DCL-ENT 13726--CALL
VMA$GET_ADD_RECORD
     13474**DCL-ENT 14293--CALL    14301--CALL
VMA$GET_NEXT_ENTRY
     13476**DCL-ENT 13720--CALL    13743--CALL
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:436  
VMA$GET_SITE_NAME
     13477**DCL-ENT 13753--CALL    13779--CALL    15770--CALL    16061--CALL    16168--CALL
VMA$OPEN_FOLDER
     13468**DCL-ENT 13937--CALL
VMA$OPEN_FOLDER IN PROCEDURE VOM$SENDIT
     14907**DCL-ENT 15052--CALL    15103--CALL
VMA$OPEN_GLOBAL
     13475**DCL-ENT 13679--CALL
VMA$PUT_ADD_RECORD
     13483**DCL-ENT 14083--CALL    14440--CALL    16086--CALL
VMD$DEL_DELIVERY
     13464**DCL-ENT 13660--CALL
VMD$GET_DELIVERY
     13460**DCL-ENT 13607--CALL    13845--CALL    13927--CALL
VMD$GET_DELIVERY_NEXT
     13461**DCL-ENT 13653--CALL    13886--CALL    13985--CALL    14109--CALL
VMD$GET_HEADER
     13458**DCL-ENT 13964--CALL    14211--CALL
VMD$GET_ID
     13465**DCL-ENT 13953--CALL
VMD$GET_PROFILE IN PROCEDURE VOM$SENDIT
     14908**DCL-ENT 15077--CALL    15117--CALL    15130--CALL
VMD$GET_SITE
     13466**DCL-ENT 13507--CALL
VMD$MERGE_DELIVERY
     13463**DCL-ENT 13772--CALL    13798--CALL
VMD$PUT_BODY
     13470**DCL-ENT 14128--CALL
VMD$PUT_DELIVERY
     13462**DCL-ENT 13592--CALL    13637--CALL    13858--CALL    13898--CALL    14048--CALL    14393--CALL
VMD$PUT_HEADER
     13459**DCL-ENT 13548--CALL    13572--CALL    13620--CALL    13854--CALL    13971--CALL    14136--CALL
     14156--CALL    14186--CALL    14455--CALL    14473--CALL
VMD$PUT_HEADER IN PROCEDURE VOM$SENDIT
     14910**DCL-ENT 15212--CALL    15224--CALL    15261--CALL
VMD$PUT_PROFILE IN PROCEDURE VOM$SENDIT
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:437  
     14909**DCL-ENT 15157--CALL    15269--CALL
VMD$PUT_SITE
     13467**DCL-ENT 15918--CALL
VMF$MAKE_ADDRESS2
     13484**DCL-ENT 13631--CALL    13633--CALL    14011--CALL    14368--CALL    14370--CALL    14385--CALL
     14387--CALL
VMM$COMBINE_MESSAGE
     13487**DCL-ENT 15122--CALL    15135--CALL
VMM$COPY_MESSAGE
     13485**DCL-ENT 15882--CALL
VMM$COPY_MESSAGE IN PROCEDURE VOM$SENDIT
     14911**DCL-ENT 15232--CALL
VMM$COPY_MESSAGE_BODY
     13486**DCL-ENT 14459--CALL    15229--CALL
VM_ADDLIST$
     10167**DCL     12057--IMP-PTR 13724>>ASSIGN  13725>>ASSIGN  13736>>ASSIGN  13743<>CALL    15821>>IF
     15839>>IF      16058>>ASSIGN  16084>>IF
VM_ADDLIST_
     10191**DCL     16086<>CALL
VM_ADDREC$
     10169**DCL     13720<>CALL    14306>>ASSIGN
VM_ADDREC_
     10192**DCL     14293<>CALL    14301<>CALL    14814>>ASSIGN
VM_ADD_HEAD.FLAGS
     12062**DCL     13725<<ASSIGN
VM_ADD_HEAD.HEAD$
     12067**DCL     13736>>ASSIGN  14306>>ASSIGN
VM_ADD_HEAD.NUM_ENTRIES
     12060**DCL     13724<<ASSIGN  15821>>IF      15839>>IF      16058<<ASSIGN  16084>>IF
VM_ADD_HEAD IN PROCEDURE CONSTRUCT_RETURN_ADDRESS
     14754**DCL     14809--IF      14816--ASSIGN  14817--ASSIGN  14819<<ASSIGN  14823--ASSIGN
VM_ADD_HEAD.ADDRESS_SIZE IN PROCEDURE CONSTRUCT_RETURN_ADDRESS
     14755**DCL     14823<<ASSIGN
VM_ADD_HEAD.HEAD$ IN PROCEDURE CONSTRUCT_RETURN_ADDRESS
     14764**DCL     14821<<ASSIGN
VM_ADD_HEAD.NEXT$ IN PROCEDURE CONSTRUCT_RETURN_ADDRESS
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:438  
     14768**DCL     14822<<ASSIGN
VM_ADD_HEAD.NUM_ENTRIES IN PROCEDURE CONSTRUCT_RETURN_ADDRESS
     14757**DCL     14820<<ASSIGN
VM_BODYREC_ENCODED
     11960**DCL     14113<<ASSIGN  14124--ASSIGN  14128<>CALL
VM_BODYREC_ENCODED.VALUE.COUNT
     11966**DCL     14127<<ASSIGN
VM_BODYREC_ENCODED.VALUE.DATA.ERR
     11970**DCL     14116<<ASSIGN  14118<<ASSIGN
VM_BODYREC_ENCODED.VALUE.DATA.STUFF
     11972**DCL     14122<<ASSIGN  14124--ASSIGN
VM_BODYREC_ENCODED.VALUE.DATA.STUFF.PIECE
     11973**DCL     14123<<ASSIGN
VM_BODYREC_ENCODED.VALUE.DATA.UTS
     11971**DCL     14119<<ASSIGN
VM_COPY$
     10180**DCL     13667>>ASSIGN  13668>>ASSIGN
VM_COPY_
     10197**DCL     13669>>ASSIGN  16209<>CALL    16210>>ASSIGN
VM_DELIVERY
     11796**DCL     13592<>CALL    13607<>CALL    13637<>CALL    13653<>CALL    13772<>CALL    13798<>CALL
     13845<>CALL    13858<>CALL    13886<>CALL    13898<>CALL    13927<>CALL    13985<>CALL    14048<>CALL
     14109<>CALL    14322<<ASSIGN  14393<>CALL
VM_DELIVERY.COUNT
     11815**DCL     13626>>IF      13634<<ASSIGN  13894>>ASSIGN  14040>>ASSIGN  14120>>ASSIGN  14123>>ASSIGN
     14124>>ASSIGN  14372<<ASSIGN  14388<<ASSIGN
VM_DELIVERY.ERR
     11813**DCL     13623<<ASSIGN  13856<<ASSIGN  13887>>IF      13893>>ASSIGN  14025<<ASSIGN  14033<<ASSIGN
     14110>>IF      14114>>IF      14118>>ASSIGN  14392<<ASSIGN
VM_DELIVERY.FLAGS.BC
     11808**DCL     13931>>IF      13970>>ASSIGN  14328<<ASSIGN  15177>>IF      15201>>ASSIGN  15234>>IF
VM_DELIVERY.FLAGS.C
     11806**DCL     13931>>IF      13969>>ASSIGN  14327<<ASSIGN  15200>>ASSIGN
VM_DELIVERY.FLAGS.DONE
     11800**DCL     13625<<ASSIGN  13846>>IF      13857<<ASSIGN  13887>>IF      13989>>IF      14024<<ASSIGN
     14044<<ASSIGN  14110>>IF      14391<<ASSIGN
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:439  
VM_DELIVERY.FLAGS.FC
     11810**DCL     13591<<ASSIGN  14110>>IF      15177>>IF      15198>>ASSIGN  15234>>IF
VM_DELIVERY.FLAGS.PRIMARY
     11804**DCL     13931>>IF      13968>>ASSIGN  14326<<ASSIGN  15199>>ASSIGN
VM_DELIVERY.FLAGS.REPORTED
     11802**DCL     13887>>IF      13897<<ASSIGN  14045<<ASSIGN
VM_DELIVERY.TEXT
     11820**DCL     13635<<ASSIGN  13895>>ASSIGN  14041>>ASSIGN  14121>>ASSIGN  14373<<ASSIGN  14389<<ASSIGN
VM_DELIVERY.UTS_OF_DELIVERY
     11797**DCL     13624<<ASSIGN  13855<<ASSIGN  14023<<ASSIGN  14034<<ASSIGN  14119>>ASSIGN  14390<<ASSIGN
VM_DELIVERYKEY
     11872**DCL     13592<>CALL    13607<>CALL    13637<>CALL    13653<>CALL    13660<>CALL    13772<>CALL
     13798<>CALL    13845<>CALL    13858<>CALL    13877<<ASSIGN  13886<>CALL    13898<>CALL    13927<>CALL
     13980<<ASSIGN  13985<>CALL    14048<>CALL    14102<<ASSIGN  14109<>CALL    14332<<ASSIGN  14393<>CALL
VM_DELIVERYKEY.ACCT
     11877**DCL     13657>>IF      14001>>ASSIGN  14334<<ASSIGN
VM_DELIVERYKEY.FOLDER
     11878**DCL     14004>>ASSIGN  14008>>ASSIGN  14339<<ASSIGN  14342<<ASSIGN  14344>>IF      14346<<ASSIGN
VM_DELIVERYKEY.PSID
     11876**DCL     14002>>IF      14006>>ASSIGN  14338<<ASSIGN
VM_FOLDER_INFO
     11908**DCL     13937<>CALL    15052<>CALL
VM_FOLDER_INFO.ACCT
     11911**DCL     15202>>IF
VM_FOLDER_INFO.FLAGS
     11931**DCL     13936<<ASSIGN  15051<<ASSIGN
VM_FOLDER_INFO.FOLDER
     11913**DCL     15202>>IF
VM_FOLDER_INFO.SITENAME
     11917**DCL     15202>>IF
VM_FOLDER_INFO.UGRANS
     11929**DCL     15202>>IF
VM_HEADER.BAD_ADDRESS$
     11486**DCL     14419<<ASSIGN  14420>>ASSIGN  14421>>ASSIGN  14421>>ASSIGN
VM_HEADER.BLIND$
     11488**DCL     13690>>IF      15177>>IF      15181>>ASSIGN  15181>>ASSIGN  15182>>ASSIGN  15184<<ASSIGN
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:440  
     15833<<ASSIGN  15836>>ASSIGN  15837>>ASSIGN  15837>>ASSIGN  15839>>IF      15844>>ASSIGN  15844>>ASSIGN
     15845>>ASSIGN  15847<<ASSIGN
VM_HEADER.COPY$
     11490**DCL     13694>>IF      13804>>IF
VM_HEADER.CREATION_DATE
     11405**DCL     14247>>ASSIGN
VM_HEADER.DELIVERY_DATE
     11407**DCL     14095<<ASSIGN  14185<>CALL    14428<<ASSIGN  15158<<ASSIGN
VM_HEADER.ERROR
     11475**DCL     14422<<ASSIGN  15211<<ASSIGN  15260<<ASSIGN
VM_HEADER.FILE_FOLDER$
     11492**DCL     13584>>IF      13588>>ASSIGN  13601>>IF      13605>>ASSIGN  13921>>IF      13925>>ASSIGN
VM_HEADER.FIRST_DELIVERY
     11409**DCL     13543>>IF      13546<<ASSIGN  14057<>CALL    14096<<ASSIGN  14429<<ASSIGN  15106<>CALL
VM_HEADER.FREE$
     11482**DCL     14226>>ASSIGN  14256>>ASSIGN  14424<<ASSIGN  15171<<ASSIGN  15186<<ASSIGN  15796<<ASSIGN
     15835<<ASSIGN  15849<<ASSIGN
VM_HEADER.FROM$
     11494**DCL     13534>>IF      13537>>ASSIGN  13537>>ASSIGN  15952>>IF      15955>>ASSIGN  15955>>ASSIGN
VM_HEADER.MISC.PHASE
     11471**DCL     13547<<ASSIGN  13557>>DOUNTIL 13560>>DOCASE  13887>>IF      14155<<ASSIGN  14155>>ASSIGN
VM_HEADER.NEXT$
     11484**DCL     14225>>ASSIGN  14255>>ASSIGN  14259<<ASSIGN  14423<<ASSIGN  15170<<ASSIGN  15185<<ASSIGN
     15795<<ASSIGN  15834<<ASSIGN  15848<<ASSIGN
VM_HEADER.NUM_RECORDS
     11413**DCL     14135<<ASSIGN
VM_HEADER.REFERS_TO_ID$
     11510**DCL     14089<<ASSIGN  14452<<ASSIGN  15085>>IF
VM_HEADER.RETURN_ADDRESS$
     11500**DCL     13553>>ASSIGN  14079>>CALL    14437>>CALL    15162>>IF      15166>>ASSIGN  15167>>ASSIGN
     15169<<ASSIGN  15782>>IF      15793<<ASSIGN  15794>>ASSIGN
VM_HEADER.STATUS
     11415**DCL     15090>>ASSIGN  15127<<ASSIGN  15140<<ASSIGN
VM_HEADER.STATUS.ACK
     11421**DCL     15085>>IF      15141>>IF
VM_HEADER.STATUS.ANSWER
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:441  
     11419**DCL     15085>>IF
VM_HEADER.STATUS.ANS_TO
     11447**DCL     15870>>IF      15876<<ASSIGN
VM_HEADER.STATUS.BC
     11459**DCL     13970<<ASSIGN  15201<<ASSIGN
VM_HEADER.STATUS.BROADCAST
     11453**DCL     13872>>IF      14037>>IF      14110>>IF      15227>>IF
VM_HEADER.STATUS.C
     11457**DCL     13969<<ASSIGN  15200<<ASSIGN
VM_HEADER.STATUS.DELIVERY
     11451**DCL     13846>>IF      13872>>IF      14094<<ASSIGN  15085>>IF      15141>>IF
VM_HEADER.STATUS.DR
     11449**DCL     13609<<ASSIGN  13850<<ASSIGN  14067>>IF      14093<<ASSIGN  14427<<ASSIGN
VM_HEADER.STATUS.ERR
     11416**DCL     13554>>ASSIGN  13846>>IF      13872>>IF      14037>>IF      14425<<ASSIGN  15085>>IF
     15141>>IF      15209<<ASSIGN  15256<<ASSIGN  16175>>IF
VM_HEADER.STATUS.FCOPY
     11439**DCL     13579>>IF      13596>>IF      13619<<ASSIGN  13853<<ASSIGN  13916>>IF      14015<<ASSIGN
     14091<<ASSIGN  14450>>IF      14454<<ASSIGN  14472<<ASSIGN  15141>>IF      15198<<ASSIGN
VM_HEADER.STATUS.PRIMARY
     11455**DCL     13968<<ASSIGN  15199<<ASSIGN
VM_HEADER.STATUS.RR
     11425**DCL     13608<<ASSIGN  13849<<ASSIGN  14019<<ASSIGN  14092<<ASSIGN  14426<<ASSIGN  15210<<ASSIGN
     15257<<ASSIGN
VM_HEADER.STATUS.RRACK
     11463**DCL     15085>>IF      15141>>IF
VM_HEADER.TO$
     11506**DCL     13810>>IF
VM_HEADER.UNIQUE_ID$
     11508**DCL     13566>>IF      13953>>CALL    13953>>CALL    13958>>ASSIGN  13958>>ASSIGN  13965>>IF
     13965>>IF      13965>>IF      14089>>ASSIGN  14090<<ASSIGN  14260<<ASSIGN  14261>>ASSIGN  14262>>ASSIGN
     14262>>ASSIGN  14452>>ASSIGN  14453<<ASSIGN
VM_HEADER$
     10163**DCL     11402--IMP-PTR 13534>>IF      13537>>ASSIGN  13537>>ASSIGN  13543>>IF      13546>>ASSIGN
     13547>>ASSIGN  13553>>ASSIGN  13554>>ASSIGN  13557>>DOUNTIL 13560>>DOCASE  13566>>IF      13579>>IF
     13584>>IF      13588>>ASSIGN  13596>>IF      13601>>IF      13605>>ASSIGN  13608>>ASSIGN  13609>>ASSIGN
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:442  
     13619>>ASSIGN  13690>>IF      13694>>IF      13804>>IF      13810>>IF      13846>>IF      13846>>IF
     13849>>ASSIGN  13850>>ASSIGN  13853>>ASSIGN  13872>>IF      13872>>IF      13872>>IF      13887>>IF
     13916>>IF      13921>>IF      13925>>ASSIGN  13953>>CALL    13953>>CALL    13958>>ASSIGN  13958>>ASSIGN
     13965>>IF      13965>>IF      13965>>IF      13968>>ASSIGN  13969>>ASSIGN  13970>>ASSIGN  14015>>ASSIGN
     14019>>ASSIGN  14037>>IF      14037>>IF      14057>>CALL    14067>>IF      14079>>CALL    14089>>ASSIGN
     14089>>ASSIGN  14090>>ASSIGN  14091>>ASSIGN  14092>>ASSIGN  14093>>ASSIGN  14094>>ASSIGN  14095>>ASSIGN
     14096>>ASSIGN  14110>>IF      14135>>ASSIGN  14155>>ASSIGN  14155>>ASSIGN  14185>>CALL    14224>>ASSIGN
     14225>>ASSIGN  14226>>ASSIGN  14247>>ASSIGN  14254>>ASSIGN  14255>>ASSIGN  14256>>ASSIGN  14259>>ASSIGN
     14260>>ASSIGN  14261>>ASSIGN  14262>>ASSIGN  14262>>ASSIGN  14419>>ASSIGN  14420>>ASSIGN  14421>>ASSIGN
     14421>>ASSIGN  14422>>ASSIGN  14423>>ASSIGN  14424>>ASSIGN  14425>>ASSIGN  14426>>ASSIGN  14427>>ASSIGN
     14428>>ASSIGN  14429>>ASSIGN  14437>>CALL    14450>>IF      14452>>ASSIGN  14452>>ASSIGN  14453>>ASSIGN
     14454>>ASSIGN  14472>>ASSIGN  15085>>IF      15085>>IF      15085>>IF      15085>>IF      15085>>IF
     15085>>IF      15090>>ASSIGN  15106>>CALL    15127>>ASSIGN  15140>>ASSIGN  15141>>IF      15141>>IF
     15141>>IF      15141>>IF      15141>>IF      15158>>ASSIGN  15162>>IF      15166>>ASSIGN  15167>>ASSIGN
     15169>>ASSIGN  15170>>ASSIGN  15171>>ASSIGN  15177>>IF      15181>>ASSIGN  15181>>ASSIGN  15182>>ASSIGN
     15184>>ASSIGN  15185>>ASSIGN  15186>>ASSIGN  15198>>ASSIGN  15199>>ASSIGN  15200>>ASSIGN  15201>>ASSIGN
     15209>>ASSIGN  15210>>ASSIGN  15211>>ASSIGN  15227>>IF      15256>>ASSIGN  15257>>ASSIGN  15260>>ASSIGN
     15782>>IF      15793>>ASSIGN  15794>>ASSIGN  15795>>ASSIGN  15796>>ASSIGN  15833>>ASSIGN  15834>>ASSIGN
     15835>>ASSIGN  15836>>ASSIGN  15837>>ASSIGN  15837>>ASSIGN  15839>>IF      15844>>ASSIGN  15844>>ASSIGN
     15845>>ASSIGN  15847>>ASSIGN  15848>>ASSIGN  15849>>ASSIGN  15870>>IF      15876>>ASSIGN  15952>>IF
     15955>>ASSIGN  15955>>ASSIGN  16175>>IF
VM_HEADER_
     10188**DCL     14227>>ASSIGN  14257>>ASSIGN  14415<>CALL    14416>>ASSIGN  15789<>CALL    15790>>ASSIGN
     15829<>CALL    15830>>ASSIGN
VM_HEADRES
     12917**DCL     12879--DCLINIT 12900--DCLINIT
VM_HEADRES.RES#
     12919**DCL     13959<<ASSIGN  15218<<ASSIGN
VM_MAIL_ACCT
     10259**DCL     14563--DCLINIT 15541--DCLINIT 15760--ASSIGN
VM_MAIL_ACCT.ACCT#
     10259**DCL     15928>>ASSIGN
VM_PROFILE.FILE_FOLDER$
     11368**DCL     15098>>IF      15098>>IF      15103<>CALL
VM_PROFILE.GRANULES
     11362**DCL     15202>>IF      15202>>IF
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:443  
VM_PROFILE.HI_MESSAGE_NUMBER
     11360**DCL     15155<<ASSIGN  15155>>ASSIGN  15212<>CALL    15218>>ASSIGN  15224<>CALL    15229<>CALL
     15232<>CALL    15236<>CALL    15261<>CALL    15266<<ASSIGN  15266>>ASSIGN
VM_PROFILE.NUM_LOST
     11385**DCL     15268<<ASSIGN  15268>>ASSIGN
VM_PROFILE.NUM_MESSAGES
     11352**DCL     15154<<ASSIGN  15154>>ASSIGN  15265<<ASSIGN  15265>>ASSIGN
VM_PROFILE.NUM_NEW_MESSAGES
     11354**DCL     15156<<ASSIGN  15156>>ASSIGN  15267<<ASSIGN  15267>>ASSIGN
VM_PROFILE.OPT.COMBINE
     11333**DCL     15141>>IF
VM_PROFILE$
     10165**DCL     11315--IMP-PTR 15098>>IF      15098>>IF      15103>>CALL    15141>>IF      15154>>ASSIGN
     15154>>ASSIGN  15155>>ASSIGN  15155>>ASSIGN  15156>>ASSIGN  15156>>ASSIGN  15202>>IF      15202>>IF
     15212>>CALL    15218>>ASSIGN  15224>>CALL    15229>>CALL    15232>>CALL    15236>>CALL    15261>>CALL
     15265>>ASSIGN  15265>>ASSIGN  15266>>ASSIGN  15266>>ASSIGN  15267>>ASSIGN  15267>>ASSIGN  15268>>ASSIGN
     15268>>ASSIGN
VM_PRORES
     12859**DCL     12821--DCLINIT 12842--DCLINIT
VM_RADDRESS
     11582**DCL     13586<<ASSIGN  13588<<ASSIGN  13603<<ASSIGN  13605<<ASSIGN  13631<>CALL    13666--ASSIGN
     13720<>CALL    13743<>CALL    13843<<ASSIGN  13923<<ASSIGN  13925<<ASSIGN  13937--CALL    14000<<ASSIGN
     14011<>CALL    14368<>CALL    14385<>CALL    15052--CALL    15098>>IF      15809--CALL    16200--ASSIGN
VM_RADDRESS.ACCT
     11605**DCL     13649<<ASSIGN  13729<<ASSIGN  13747<<ASSIGN  13762<<ASSIGN  13788<<ASSIGN  14001<<ASSIGN
     14016>>IF      14334>>ASSIGN  16219>>ASSIGN
VM_RADDRESS.FLAGS.UNDEF#
     11588**DCL     13621>>IF      13744>>IF
VM_RADDRESS.FOLDER
     11597**DCL     11598--REDEF   13650<<ASSIGN  13730<<CALLBLT 13748<<CALLBLT 13763<<CALLBLT 13789<<CALLBLT
     14004<<ASSIGN  14016>>IF      14342>>ASSIGN  16213>>ASSIGN
VM_RADDRESS.NOMAD.DELIM
     11600**DCL     14007<<ASSIGN  14336>>IF
VM_RADDRESS.NOMAD.FOLDER
     11599**DCL     14008<<ASSIGN  14339>>ASSIGN
VM_RADDRESS.NOMAD.PSID
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:444  
     11601**DCL     14006<<ASSIGN  14336>>IF      14338>>ASSIGN
VM_RADDRESS.PASS
     11602**DCL     16214>>ASSIGN
VM_RADDRESS.SITENAME
     11604**DCL     13753<>CALL    13755>>ASSIGN  13769<<ASSIGN  13779<>CALL    13781>>ASSIGN  13795<<ASSIGN
     16161>>CALLBLT 16215>>ASSIGN
VM_RADDRESS.TYPE
     11594**DCL     13629>>IF      13721>>IF      14366>>IF      14383>>IF      16198>>IF      16216>>ASSIGN
     16217>>IF
VM_RADDRESS IN PROCEDURE CONSTRUCT_RETURN_ADDRESS
     14719**DCL     14809--IF      14822--ASSIGN  14823--ASSIGN  14826--ASSIGN  14828<<ASSIGN
VM_RADDRESS.FOLDER IN PROCEDURE CONSTRUCT_RETURN_ADDRESS
     14734**DCL     14735--REDEF
VM_RADDRESS.NEXT$ IN PROCEDURE CONSTRUCT_RETURN_ADDRESS
     14720**DCL     14829<<ASSIGN
VM_RADDRESS.PREV$ IN PROCEDURE CONSTRUCT_RETURN_ADDRESS
     14722**DCL     14830<<ASSIGN
VM_RETURN_ADDRESS
     11761**DCL     13553<<ASSIGN  13586>>ASSIGN  13603>>ASSIGN  13843>>ASSIGN  13923>>ASSIGN  15165--ASSIGN
     15785--ASSIGN  15794>>ASSIGN
VM_RETURN_ADDRESS.ACCT
     11784**DCL     14016>>IF      15202>>IF
VM_RETURN_ADDRESS.FOLDER
     11776**DCL     11777--REDEF   14016>>IF      15202>>IF
VM_RETURN_ADDRESS.SITENAME
     11783**DCL     15202>>IF
VM_SEARCH_INFO
     11555**DCL     13726<>CALL
VM_SEARCH_INFO.DCB#
     11558**DCL     13681<<ASSIGN
VM_SEARCH_INFO.NUM_ENTRIES
     11556**DCL     13680<<ASSIGN  13684<<ASSIGN
VM_SITE
     11531**DCL     13507<>CALL    13513<<ASSIGN  15915>>ASSIGN
VM_SITE.FLAGS.RETURN_TO_ORIGIN
     11533**DCL     13523>>IF      13526<<ASSIGN  15875<<ASSIGN
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:445  
VM_SITE.NUM_SITES
     11537**DCL     13516<<ASSIGN  13528<<ASSIGN  15886>>IF      15891>>DOINDEX
VM_SITE.ORIGIN
     11539**DCL     13515<<ASSIGN  13527<<ASSIGN  15890>>IF
VM_SITE.RECEIVER_SITE
     11541**DCL     15892>>IF
VM_SITENAME
     10436**DCL     13515>>ASSIGN  13527>>ASSIGN  13757>>IF      13783>>IF      16162>>IF      16188>>CALLBLT
     16189>>CALLBLT
VM_SITE_T IN PROCEDURE TRANSPORT_INTERSYS
     15372**DCL     15915<<ASSIGN  15918<>CALL
VM_SITE_T.NUM_SITES IN PROCEDURE TRANSPORT_INTERSYS
     15378**DCL     15916>>ASSIGN  15917<<ASSIGN  15917>>ASSIGN
VM_SITE_T.RECEIVER_SITE IN PROCEDURE TRANSPORT_INTERSYS
     15382**DCL     15916<<ASSIGN
VM_UADDRESS
     11652**DCL     13633<>CALL    13720<>CALL    13726<>CALL    13743<>CALL    14370<>CALL    14387<>CALL
     16203--ASSIGN
VM_UADDRESS.FOLDER
     11667**DCL     11668--REDEF
VM_UADDRESS.USER_NAME.COUNT
     11676**DCL     16203>>ASSIGN  16222>>ASSIGN  16224>>CALLBLT
VM_UADDRESS.USER_NAME.TEXT
     11677**DCL     16203--ASSIGN  16224>>CALLBLT
VM_WORK$
     10171**DCL     13726<>CALL
VOM$ADDENTRY
     13455**DCL-ENT 16184--CALL
VOM$ADDENTRY_SORTED
     13456**DCL-ENT 14138--CALL    14187--CALL    14461--CALL
VOM$DELENTRY
     13457**DCL-ENT 14171--CALL    14206--CALL    15903--CALL    15962--CALL
VOM$MOVE IN PROCEDURE TRANSPORT_INTERSYS
     15298**DCL-ENT 15943--CALL
VOM$PROCESS
     13488**DCL-ENT 13710--CALL    13885--CALL    14108--CALL    14865--CALL
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:446  
VOM$SENDIT
     14891**PROC    13610--CALL    13851--CALL    14021--CALL
VO_BNWIO.CGPARM.MSGIDXT
      9978**DCL      9981--REDEF
VO_BNWIO.CODE
      9947**DCL      9947--REDEF    9948--REDEF    9948--REDEF
VO_BNWIO.ERR.ERR#
      9949**DCL      9949--REDEF
VO_BNWIO.EVID
      9948**DCL      9948--REDEF    9948--REDEF
VO_BUSY_RETRY_MINUTES
     10030**DCL     14180>>ASSIGN
VO_HOG_LIMIT
     10031**DCL     13992>>IF
VO_INTERSYS_ALLOWED
     10029**DCL     14875>>IF
VO_MAILMAN_STARTUP_TIME
     10031**DCL     14059<>CALL    15108<>CALL
VO_MAX_HOLD_HOURS
     10031**DCL     14060>>IF      15109>>IF
VO_NEED_READ
     11242**DCL     13706>>IF      13707<<ASSIGN  13881>>IF      13882<<ASSIGN  14104>>IF      14105<<ASSIGN
     14858>>IF      14860<<ASSIGN  15934>>IF      15956>>IF
VO_PACKSET_RETRY_MINUTES
     10030**DCL     14182>>ASSIGN
VO_PROCESS
     11243**DCL     13710>>IF      13885>>IF      14108>>IF      14863>>IF
VO_READ_CG
     11220**DCL     13708<>CALL    13883<>CALL    14106<>CALL    14861<>CALL
VO_READ_CG.STATION_
     11223**DCL     11224--REDEF
VO_READ_CG.V.DVBYTE.REREAD#
     11235**DCL     11235--REDEF
VO_READ_CG.V.INDX#
     11233**DCL     11233--REDEF
WAIT2
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:447  
     12801**DCL     14643<>CALL
WAIT2.V
     12802**DCL     12801--DCLINIT
WORK_TEXTC
     12740**DCL     13631<>CALL    13633<>CALL    14011<>CALL    14368<>CALL    14370<>CALL    14385<>CALL
     14387<>CALL
WORK_TEXTC.L#
     12740**DCL     13628<<ASSIGN  13634>>ASSIGN  13894<<ASSIGN  14010<<ASSIGN  14012>>CALLBLT 14040<<ASSIGN
     14364<<ASSIGN  14372>>ASSIGN  14382<<ASSIGN  14388>>ASSIGN  14411>>ASSIGN  14420>>ASSIGN
WORK_TEXTC.NAME#
     12740**DCL     13628--ASSIGN  13635>>ASSIGN  13895<<ASSIGN  14010--ASSIGN  14012>>CALLBLT 14041<<ASSIGN
     14364--ASSIGN  14373>>ASSIGN  14382--ASSIGN  14389>>ASSIGN  14421>>ASSIGN
WORK_TIME
     13452**DCL     12786--DCLINIT 14247<<ASSIGN
WRITE_MAILCG.STATION_
     12702**DCL     12702--REDEF
WRITE_MAILCG.V.DVBYTE.VFC#
     12709**DCL     12709--REDEF
WRITE_MAILCG.STATION_ IN PROCEDURE VOM$SENDIT
     14932**DCL     14932--REDEF
WRITE_MAILCG.V.DVBYTE.VFC# IN PROCEDURE VOM$SENDIT
     14939**DCL     14939--REDEF
X$ALLOCATE
     13489**DCL-ENT 14258--CALL    14412--CALL    14417--CALL    15786--CALL    15791--CALL    15826--CALL
     15831--CALL    16206--CALL    16211--CALL
X$DEALLOCATE
     13490**DCL-ENT 15168--CALL    15183--CALL    15846--CALL
X$STRING
     10158**DCL     13953<>CALL    15181<<ASSIGN
X$STRING.SIZ
     10159**DCL     10160--IMP-SIZ 13537>>ASSIGN  13953>>CALL    13958>>ASSIGN  13965>>IF      14261<<ASSIGN
     14262>>ASSIGN  14420<<ASSIGN  14421>>ASSIGN  15181>>ASSIGN  15836<<ASSIGN  15837>>ASSIGN  15844>>ASSIGN
     15955>>ASSIGN
X$STRING.TEXT
     10160**DCL     13537>>ASSIGN  13958>>ASSIGN  13965>>IF      14262<<ASSIGN  14421<<ASSIGN  15837<<ASSIGN
     15844<<ASSIGN  15955>>ASSIGN
PL6.E3A0      #002=VOM$DOSEND File=VOM$MAILMAN.:VMB6TSI                          WED 08/20/97 15:32 Page:448  
XUD$UTS_ADJ_25TH
     11112**DCL-ENT 14059--CALL    14185--CALL    15108--CALL
XUD$UTS_DIFF_25TH
     11100**DCL-ENT 14057--CALL    15106--CALL

PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:449  
     2778        1        /*T***********************************************************/
     2779        2        /*T*                                                         */
     2780        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2781        4        /*T*                                                         */
     2782        5        /*T***********************************************************/
     2783        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
     2784        7
     2785        8        VOM$XCON: PROC ASYNC;
     2786        9    1   DCL LADC_FLAG BIT(1) CONSTANT SYMDEF INIT('0'B);
     2787       10                       /* LADC_FLAG will cause save files to be built if turned on */
     2788       11    1   DCL 1 NAME STATIC,
     2789       12    1         2 * UBIN(9) INIT(18) UNAL,
     2790       13    1         2 * CHAR(4) INIT('SAVE'),
     2791       14    1         2 A,
     2792       15    1           3 DATE CHAR(6),
     2793       16    1           3 TIME CHAR(8),
     2794       17    1         2 ANS REDEF A CHAR(14),
     2795       18    1         2 B REDEF A,
     2796       19    1           3 COMP CHAR(10),
     2797       20    1           3 * CHAR(4);
     2798       21    1   DCL 1 CMD STATIC,
     2799       22    1         2 * UBIN(9) INIT(10) UNAL,
     2800       23    1         2 TEXT CHAR(10);
     2801       24    1   DCL 1 MESS3 STATIC,
     2802       25    1         2 * CHAR(0) INIT('SAVE file is: '),
     2803       26    1         2 ANS CHAR(14);
     2804       27    1   DCL ALIB_CMD CHAR(0) STATIC INIT('PMD TCB,AUTO,DCB');
     2805       28    1   DCL MESS1 CHAR(0) CONSTANT INIT('MAILMAN aborting!!');
     2806       29    1   DCL MESS2 CHAR(0) CONSTANT INIT('SAVE build failed, PMD issued.');
     2807       30    1   DCL MESS4 CHAR(0) CONSTANT INIT('Can''t LDTRC');
     2808       31    1   DCL MESS5 CHAR(0) CONSTANT INIT(
                31            'MAILMAN BLEW UP TWICE IN SAME MINUTE, CAN''T RESTART');
     2809       32    1   DCL MAIL_IN DCB;
     2810       33    1   DCL ERROR_FROM_STACK BIT (36) STATIC;
     2811       34        %INCLUDE CP_6;
     2812     5593        %INCLUDE CP_6_SUBS;
     2813     6133        %INCLUDE VO_SUBS_C;
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:450  
     2814     6184        %INCLUDE VM_DATA_R;
     2815     6615        %INCLUDE VM_PERR_C;
     2816     6910             %B$TCB (STCLASS="BASED(B$TCB$)");
     2817     6913
     2818     6914              %F$DCB;
     2819     6971
     2820     6972        %B$XCON;
     2821     6982        %INCLUDE B$JIT;
     2822     7585
     2823     7586
     2824     7587        %FPT_TIME (FPTN=FPT_TIME, STCLASS=CONSTANT,
     2825     7588                  DATE=NAME.A.DATE,
     2826     7589                  TIME=NAME.A.TIME,
     2827     7590                  DEST=ANS);
     2828     7609        %FPT_KEYIN (FPTN=FPT_KEYIN, STCLASS=STATIC);
     2829     7628        %FPT_SAVE (FPTN=FPT_SAVE, STCLASS=CONSTANT,
     2830     7629                  ACCT=MAILACCT,
     2831     7630                  NAME=NAME);
     2832     7644        %FPT_ALIB (FPTN=FPT_ALIB, STCLASS=CONSTANT,
     2833     7645                  LIBNAME=DELTA_NAME,
     2834     7646                  CMD=ALIB_CMD,
     2835     7647                  DLIB=YES,
     2836     7648                  RETRN=YES);
     2837     7665        %VLP_NAME (FPTN=DELTA_NAME, STCLASS=CONSTANT,
     2838     7666                  NAME='DELTA');
     2839     7693        %FPT_CLOSE (FPTN=RENAME_BAD_FILE,
     2840     7694                    DCB=MAIL_IN,
     2841     7695                    CHGATT=YES,
     2842     7696                    NAME=NEW_NAME);
     2843     7738        %VLP_NAME  (FPTN=NEW_NAME, L=31);
     2844     7765        %FPT_XCON (STCLASS=CONSTANT);
     2845     7779        %FPT_SCREECH  (STCLASS=CONSTANT,
     2846     7780                       JERR=ERROR_FROM_STACK,
     2847     7781                       SCODE=MAILMAN_SNAPSHOT,
     2848     7782                       SCREECHID=SCREECH_ID);
     2849     7796        %VLP_SCODE    (FPTN=MAILMAN_SNAPSHOT, STCLASS=CONSTANT,
     2850     7797                       FCG=VO, MID=M, CODE=%E$MAILMAN_SNAP, SEV=SEV_SNAP,
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:451  
     2851     7798                       CFUS=YES, CUSR=YES, DDSEG=YES, ENQ=YES, FMBUF=YES, ISEG=YES,
     2852     7799                       ROSEG=YES);
     2853     7860        /*E*    ERROR:  VOM-E$MAILMAN_SNAP-0
     2854     7861                MESSAGE:  MAILMAN has snapped because his exit control
     2855     7862                         routine has been entered.  MAILMAN will attempt
     2856     7863                         to restart by renaming the offending mailgram
     2857     7864                         (if there is one) and M$LDTRC to himself.  If
     2858     7865                         XCON is entered twice in the same minute,
     2859     7866                         MAILMAN must be restarted manually (thru GOOSE)
     2860     7867                         after determining the reason for the aborts.
     2861     7868        */
     2862     7869        %VLP_NAME     (FPTN=SCREECH_ID);
     2863     7896        %FPT_LDEV (CONTINUE=NO, STREAMNAME='LP01', STCLASS=CONSTANT);
     2864     7921        %FPT_LDTRC (FPTN=VM_LDTRC_MAILMAN,
     2865     7922                    STCLASS="CONSTANT SYMDEF",
     2866     7923                    CMD=CMD,
     2867     7924                    NAME=VM_MAILMAN_RUNAME,
     2868     7925                    ACCT=VM_MAILMAN_RUACCT);
     2869     7943        %VLP_NAME (FPTN=VM_MAILMAN_RUNAME,
     2870     7944                   NAME='MAILMAN',
     2871     7945                   LEN=31,
     2872     7946                   STCLASS="CONSTANT SYMDEF");
     2873     7973        %VLP_ACCT (FPTN=VM_MAILMAN_RUACCT,
     2874     7974                   ACCT=':SYS',
     2875     7975                   STCLASS="CONSTANT SYMDEF");
     2876     7988        %VLP_ACCT (FPTN=MAILACCT,
     2877     7989             ACCT=':MAIL ',
     2878     7990             STCLASS=CONSTANT);
     2879     8003
     2880     8004    1   dcl VOM_INIT_CCTIME char(10) symref;
     2881     8005
     2882     8006
     2883     8007
     2884     8008        %FPT_CLOSE (FPTN=CLOSE_MAILCG,
     2885     8009                       DCB=M$MAIL_COMGROUP,
     2886     8010                       DISP=SAVE);
     2887     8052        %FPT_CLOSE (FPTN=CLOSE_SITE,
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:452  
     2888     8053                       DCB=M$NODE,
     2889     8054                       DISP=SAVE);
     2890     8096
     2891     8097
     2892     8098             %FPT_WAIT (FPTN=WAIT_AWHILE,
     2893     8099                            UNITS=60);
     2894     8113
     2895     8114        %FPT_XCON (FPTN=RESET_XCON);
     2896     8128
     2897     8129
     2898     8130
     2899     8131    1       IF B$TCB.STK$ -> B$XCON.RNST.OPXXX
     2900     8132    2       THEN DO;
     2901     8133    2           CALL M$XCON (RESET_XCON);
     2902     8134    2           CALL M$EXIT;
     2903     8135    2       END;
     2904     8136    1       IF DCBADDR(M$NODE_NUM) ->F$DCB.FCD# THEN
     2905     8137    1           CALL M$CLOSE(CLOSE_SITE) ALTRET(CONT_ON);
     2906     8138
     2907     8139    1       IF B$TCB.STK$ -> B$XCON.RNST.OPERR
     2908     8140    2       THEN DO;
     2909     8141    2           CALL M$XCON (RESET_XCON);
     2910     8142    2           CALL M$LDTRC (VM_LDTRC_MAILMAN) ALTRET(OOPS);
     2911     8143    2       END;
     2912     8144
     2913     8145    1   CONT_ON:;
     2914     8146    1       IF B$JIT.MODE = %M_GHOST# AND B$JIT.PRIV.ACTIVE.EXMM
     2915     8147    2       THEN DO;
     2916     8148    2           ERROR_FROM_STACK = B$TCB.STK$ -> B$XCON.ERR;
     2917     8149    3           CALL M$SCREECH (FPT_SCREECH) WHENALTRETURN DO; END;
     2918     8150    2       END;
     2919     8151    1       FPT_KEYIN.MESS_ = VECTOR(MESS1);
     2920     8152    1       CALL M$KEYIN (FPT_KEYIN);
     2921     8153    1       CALL M$TIME (FPT_TIME);
     2922     8154    1       IF LADC_FLAG
     2923     8155    2       THEN DO;
     2924     8156    2           CALL M$SAVE (FPT_SAVE)
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:453  
     2925     8157    3           WHENRETURN DO;
     2926     8158    3               MESS3.ANS = NAME.ANS;
     2927     8159    3               FPT_KEYIN.MESS_ = VECTOR(MESS3);
     2928     8160    3               CALL M$KEYIN (FPT_KEYIN);
     2929     8161    3           END;
     2930     8162    3           WHENALTRETURN DO;
     2931     8163    3               FPT_KEYIN.MESS_ = VECTOR(MESS2);
     2932     8164    3               CALL M$ALIB (FPT_ALIB);
     2933     8165    3           END;
     2934     8166    2       END;                       /* If ladc */
     2935     8167    1       IF DCBADDR(DCBNUM(MAIL_IN)) -> F$DCB.FCD#
     2936     8168    2       THEN DO;
     2937     8169    2           NEW_NAME = DCBADDR(DCBNUM(MAIL_IN)) -> F$DCB.NAME#;
     2938     8170    2           SUBSTR(NEW_NAME.NAME#,1,4)='DEAD';
     2939     8171    2           CALL M$CLOSE (RENAME_BAD_FILE) ALTRET (RENAME_DIDNT_WORK);
     2940     8172    2   RENAME_DIDNT_WORK: ;
     2941     8173    2       END;
     2942     8174    1       CALL M$XCON (RESET_XCON);
     2943     8175    1       IF VOM_INIT_CCTIME = NAME.B.COMP
     2944     8176    2       THEN DO;                   /* Blew up twice in a row, don't restart */
     2945     8177    2           FPT_KEYIN.MESS_ = VECTOR(MESS5);
     2946     8178    2           CALL M$KEYIN (FPT_KEYIN);
     2947     8179    2           CALL M$XXX;
     2948     8180    2       END;
     2949     8181    2       ELSE DO;
     2950     8182    2           CMD.TEXT = NAME.B.COMP;
     2951     8183    2           CALL M$LDTRC (VM_LDTRC_MAILMAN) ALTRET(OOPS);
     2952     8184    2       END;
     2953     8185    1   OOPS:
     2954     8186    1       FPT_KEYIN.MESS_ = VECTOR(MESS4);
     2955     8187    1       CALL M$KEYIN (FPT_KEYIN);
     2956     8188    1       ALIB_CMD='DU $LS15->0 '' MAILMAN TCB ''';
     2957     8189    1       CALL M$ALIB;
     2958     8190    1       CALL M$LDEV (FPT_LDEV) ALTRET(L1);
     2959     8191    1   L1: CALL M$XXX;
     2960     8192    1   END VOM$XCON;
     2961     8193        %EOD;
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:454  

PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:455  
--  Include file information  --

   B$JIT_C.:LIB_E05  is referenced.
   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
   VM_PERR_C.:VMB6TOU  is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   VO_SUBS_C.:VMB6TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VOM$XCON.

   Procedure VOM$XCON requires 137 words for executable code.
   Procedure VOM$XCON requires 4 words of local(AUTO) storage.

PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:456  

 Object Unit name= VOM$XCON                                   File name= VOM$MAILMAN.:VMB6TOU
 UTS= AUG 20 '97 15:34:08.12 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS    132    204  VOM$XCON
    1   Data  even  none   152    230  VOM$XCON
    2   DCB   even  none     0      0  MAIL_IN
    3   DCB   even  none     0      0  M$UC
    4   DCB   even  none     0      0  M$MAIL_FILE
    5   DCB   even  none     0      0  M$MAIL_CENTRAL
    6   DCB   even  none     0      0  M$MAIL_GLOBAL
    7   DCB   even  none     0      0  M$WORK
    8   DCB   even  none     0      0  M$MAIL_COMGROUP
    9   DCB   even  none     0      0  M$DO
   10   DCB   even  none     0      0  M$LO
   11   DCB   even  none     0      0  M$ME
   12   DCB   even  none     0      0  M$NODE
   13   DCB   even  none     0      0  M$SI
   14   Proc  even  none   137    211  VOM$XCON
   15  RoData even  none    12     14  VOM$XCON

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    14      0   yes            yes     Async       0  VOM$XCON
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:457  

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      0  LADC_FLAG                          0    140  VM_LDTRC_MAILMAN
    0    160  VM_MAILMAN_RUNAME                  0    170  VM_MAILMAN_RUACCT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AAUTO
                       nStd      0 X66_AARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     MAIL_IN                               M$UC                             r    VM_HEADER$
r    VM_PROFILE$                      r    VM_ADDLIST$                      r    VM_ADDREC$
r    VM_WORK$                         r    VM_SELECT$                       r    VM_PARSEAREA$
r    VM_INPUT$                        r    VM_COPY$                              VM_ENCLLIST$
     VM_ENCLREC$                           VM_HEADER_                            VM_HEADER_INIT_
     VM_PROFILE_                           VM_ADDLIST_                           VM_ADDREC_
     VM_WORK_                              VM_SELECT_                            VM_PARSEAREA_
     VM_INPUT_                             VM_COPY_                              VM_ENCLLIST_
     VM_ENCLREC_                           M$MAIL_FILE                           M$MAIL_CENTRAL
     M$MAIL_GLOBAL                         M$WORK                                M$MAIL_COMGROUP
     M$DO                                  M$LO                                  M$ME
     M$NODE                                M$SI                                  M$MAIL_FILE_NUM
     M$MAIL_CENTRAL_NUM                    M$MAIL_GLOBAL_NUM                     M$WORK_NUM
     M$MAIL_COMGROUP_NUM                   M$DO_NUM                              M$ME_NUM
     M$LO_NUM                              M$SI_NUM                              M$NODE_NUM
r    B$JIT$                           r    B$TCB$                                VM_MAIL_ACCT
     VM_NAME_MAP_NAME                      ERRMSG_FID                            VM_SEND_FILE_NAME
     VM_FORWARD_FILE_NAME                  VM_FORWARD_ENCL_NAME                  VM_FORWARD_FILE_PASS
     VM_MAILCG_NAME                        VM_SITENAME                           VM_MAILCG_SETSTA
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:458  
     VOM_INIT_CCTIME

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:459  


     2778        1        /*T***********************************************************/
     2779        2        /*T*                                                         */
     2780        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2781        4        /*T*                                                         */
     2782        5        /*T***********************************************************/
     2783        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
     2784        7
     2785        8        VOM$XCON: PROC ASYNC;

      8 14 000000   000000 700200 xent  VOM$XCON     TSX0  ! X66_AAUTO
        14 000001   000004 000000                    ZERO    4,0

     2786        9    1   DCL LADC_FLAG BIT(1) CONSTANT SYMDEF INIT('0'B);
     2787       10                       /* LADC_FLAG will cause save files to be built if turned on */
     2788       11    1   DCL 1 NAME STATIC,
     2789       12    1         2 * UBIN(9) INIT(18) UNAL,
     2790       13    1         2 * CHAR(4) INIT('SAVE'),
     2791       14    1         2 A,
     2792       15    1           3 DATE CHAR(6),
     2793       16    1           3 TIME CHAR(8),
     2794       17    1         2 ANS REDEF A CHAR(14),
     2795       18    1         2 B REDEF A,
     2796       19    1           3 COMP CHAR(10),
     2797       20    1           3 * CHAR(4);
     2798       21    1   DCL 1 CMD STATIC,
     2799       22    1         2 * UBIN(9) INIT(10) UNAL,
     2800       23    1         2 TEXT CHAR(10);
     2801       24    1   DCL 1 MESS3 STATIC,
     2802       25    1         2 * CHAR(0) INIT('SAVE file is: '),
     2803       26    1         2 ANS CHAR(14);
     2804       27    1   DCL ALIB_CMD CHAR(0) STATIC INIT('PMD TCB,AUTO,DCB');
     2805       28    1   DCL MESS1 CHAR(0) CONSTANT INIT('MAILMAN aborting!!');
     2806       29    1   DCL MESS2 CHAR(0) CONSTANT INIT('SAVE build failed, PMD issued.');
     2807       30    1   DCL MESS4 CHAR(0) CONSTANT INIT('Can''t LDTRC');
     2808       31    1   DCL MESS5 CHAR(0) CONSTANT INIT(
                31            'MAILMAN BLEW UP TWICE IN SAME MINUTE, CAN''T RESTART');
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:460  
     2809       32    1   DCL MAIL_IN DCB;
     2810       33    1   DCL ERROR_FROM_STACK BIT (36) STATIC;
     2811       34        %INCLUDE CP_6;
     2812     5593        %INCLUDE CP_6_SUBS;
     2813     6133        %INCLUDE VO_SUBS_C;
     2814     6184        %INCLUDE VM_DATA_R;
     2815     6615        %INCLUDE VM_PERR_C;
     2816     6910             %B$TCB (STCLASS="BASED(B$TCB$)");
     2817     6913
     2818     6914              %F$DCB;
     2819     6971
     2820     6972        %B$XCON;
     2821     6982        %INCLUDE B$JIT;
     2822     7585
     2823     7586
     2824     7587        %FPT_TIME (FPTN=FPT_TIME, STCLASS=CONSTANT,
     2825     7588                  DATE=NAME.A.DATE,
     2826     7589                  TIME=NAME.A.TIME,
     2827     7590                  DEST=ANS);
     2828     7609        %FPT_KEYIN (FPTN=FPT_KEYIN, STCLASS=STATIC);
     2829     7628        %FPT_SAVE (FPTN=FPT_SAVE, STCLASS=CONSTANT,
     2830     7629                  ACCT=MAILACCT,
     2831     7630                  NAME=NAME);
     2832     7644        %FPT_ALIB (FPTN=FPT_ALIB, STCLASS=CONSTANT,
     2833     7645                  LIBNAME=DELTA_NAME,
     2834     7646                  CMD=ALIB_CMD,
     2835     7647                  DLIB=YES,
     2836     7648                  RETRN=YES);
     2837     7665        %VLP_NAME (FPTN=DELTA_NAME, STCLASS=CONSTANT,
     2838     7666                  NAME='DELTA');
     2839     7693        %FPT_CLOSE (FPTN=RENAME_BAD_FILE,
     2840     7694                    DCB=MAIL_IN,
     2841     7695                    CHGATT=YES,
     2842     7696                    NAME=NEW_NAME);
     2843     7738        %VLP_NAME  (FPTN=NEW_NAME, L=31);
     2844     7765        %FPT_XCON (STCLASS=CONSTANT);
     2845     7779        %FPT_SCREECH  (STCLASS=CONSTANT,
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:461  
     2846     7780                       JERR=ERROR_FROM_STACK,
     2847     7781                       SCODE=MAILMAN_SNAPSHOT,
     2848     7782                       SCREECHID=SCREECH_ID);
     2849     7796        %VLP_SCODE    (FPTN=MAILMAN_SNAPSHOT, STCLASS=CONSTANT,
     2850     7797                       FCG=VO, MID=M, CODE=%E$MAILMAN_SNAP, SEV=SEV_SNAP,
     2851     7798                       CFUS=YES, CUSR=YES, DDSEG=YES, ENQ=YES, FMBUF=YES, ISEG=YES,
     2852     7799                       ROSEG=YES);
     2853     7860        /*E*    ERROR:  VOM-E$MAILMAN_SNAP-0
     2854     7861                MESSAGE:  MAILMAN has snapped because his exit control
     2855     7862                         routine has been entered.  MAILMAN will attempt
     2856     7863                         to restart by renaming the offending mailgram
     2857     7864                         (if there is one) and M$LDTRC to himself.  If
     2858     7865                         XCON is entered twice in the same minute,
     2859     7866                         MAILMAN must be restarted manually (thru GOOSE)
     2860     7867                         after determining the reason for the aborts.
     2861     7868        */
     2862     7869        %VLP_NAME     (FPTN=SCREECH_ID);
     2863     7896        %FPT_LDEV (CONTINUE=NO, STREAMNAME='LP01', STCLASS=CONSTANT);
     2864     7921        %FPT_LDTRC (FPTN=VM_LDTRC_MAILMAN,
     2865     7922                    STCLASS="CONSTANT SYMDEF",
     2866     7923                    CMD=CMD,
     2867     7924                    NAME=VM_MAILMAN_RUNAME,
     2868     7925                    ACCT=VM_MAILMAN_RUACCT);
     2869     7943        %VLP_NAME (FPTN=VM_MAILMAN_RUNAME,
     2870     7944                   NAME='MAILMAN',
     2871     7945                   LEN=31,
     2872     7946                   STCLASS="CONSTANT SYMDEF");
     2873     7973        %VLP_ACCT (FPTN=VM_MAILMAN_RUACCT,
     2874     7974                   ACCT=':SYS',
     2875     7975                   STCLASS="CONSTANT SYMDEF");
     2876     7988        %VLP_ACCT (FPTN=MAILACCT,
     2877     7989             ACCT=':MAIL ',
     2878     7990             STCLASS=CONSTANT);
     2879     8003
     2880     8004    1   dcl VOM_INIT_CCTIME char(10) symref;
     2881     8005
     2882     8006
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:462  
     2883     8007
     2884     8008        %FPT_CLOSE (FPTN=CLOSE_MAILCG,
     2885     8009                       DCB=M$MAIL_COMGROUP,
     2886     8010                       DISP=SAVE);
     2887     8052        %FPT_CLOSE (FPTN=CLOSE_SITE,
     2888     8053                       DCB=M$NODE,
     2889     8054                       DISP=SAVE);
     2890     8096
     2891     8097
     2892     8098             %FPT_WAIT (FPTN=WAIT_AWHILE,
     2893     8099                            UNITS=60);
     2894     8113
     2895     8114        %FPT_XCON (FPTN=RESET_XCON);
     2896     8128
     2897     8129
     2898     8130
     2899     8131    1       IF B$TCB.STK$ -> B$XCON.RNST.OPXXX

   8131 14 000002   000000 470400 xsym               LDP0    B$TCB$
        14 000003   000001 471500                    LDP1    1,,PR0
        14 000004   100101 234100                    SZN     65,,PR1
        14 000005   000013 605000 14                 TPL     s:8136

     2900     8132    2       THEN DO;

     2901     8133    2           CALL M$XCON (RESET_XCON);

   8133 14 000006   000222 630400 1                  EPPR0   RESET_XCON
        14 000007   010003 713400                    CLIMB   4099
        14 000010   400400 401760                    pmme    nvectors=2

     2902     8134    2           CALL M$EXIT;

   8134 14 000011   000001 713400                    CLIMB   exit
        14 000012   000000 401760                    pmme    nvectors=0

     2903     8135    2       END;
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:463  

     2904     8136    1       IF DCBADDR(M$NODE_NUM) ->F$DCB.FCD# THEN

   8136 14 000013   000000 470400 15                 LDP0    0
        14 000014   000000 471500                    LDP1    0,,PR0
        14 000015   000000 720000 xsym               LXL0    M$NODE_NUM
        14 000016   100000 473510                    LDP3    0,X0,PR1
        14 000017   300031 236100                    LDQ     25,,PR3
        14 000020   020000 316007                    CANQ    8192,DL
        14 000021   000026 600000 14                 TZE     s:8139

     2905     8137    1           CALL M$CLOSE(CLOSE_SITE) ALTRET(CONT_ON);

   8137 14 000022   000156 630400 1                  EPPR0   CLOSE_SITE
        14 000023   450001 713400                    CLIMB   alt,close
        14 000024   406000 401760                    pmme    nvectors=13
        14 000025   000042 702000 14                 TSX2    CONT_ON

     2906     8138
     2907     8139    1       IF B$TCB.STK$ -> B$XCON.RNST.OPERR

   8139 14 000026   000000 470400 xsym               LDP0    B$TCB$
        14 000027   000001 471500                    LDP1    1,,PR0
        14 000030   100101 236100                    LDQ     65,,PR1
        14 000031   020000 316003                    CANQ    8192,DU
        14 000032   000042 600000 14                 TZE     CONT_ON

     2908     8140    2       THEN DO;

     2909     8141    2           CALL M$XCON (RESET_XCON);

   8141 14 000033   000222 630400 1                  EPPR0   RESET_XCON
        14 000034   010003 713400                    CLIMB   4099
        14 000035   400400 401760                    pmme    nvectors=2

     2910     8142    2           CALL M$LDTRC (VM_LDTRC_MAILMAN) ALTRET(OOPS);

PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:464  
   8142 14 000036   000140 630400 0                  EPPR0   VM_LDTRC_MAILMAN
        14 000037   400006 713400                    CLIMB   alt,+6
        14 000040   403000 401760                    pmme    nvectors=7
        14 000041   000170 702000 14                 TSX2    OOPS

     2911     8143    2       END;

   8139 14 000042                       CONT_ON      null
     2912     8144
     2913     8145    1   CONT_ON:;
     2914     8146    1       IF B$JIT.MODE = %M_GHOST# AND B$JIT.PRIV.ACTIVE.EXMM

   8146 14 000042   000000 470400 xsym               LDP0    B$JIT$
        14 000043   000000 236100                    LDQ     0,,PR0
        14 000044   740000 376003                    ANQ     -16384,DU
        14 000045   100000 116003                    CMPQ    32768,DU
        14 000046   000063 601000 14                 TNZ     s:8151
        14 000047   000013 236100                    LDQ     11,,PR0
        14 000050   000002 316007                    CANQ    2,DL
        14 000051   000063 600000 14                 TZE     s:8151

     2915     8147    2       THEN DO;

     2916     8148    2           ERROR_FROM_STACK = B$TCB.STK$ -> B$XCON.ERR;

   8148 14 000052   000000 471400 xsym               LDP1    B$TCB$
        14 000053   100001 473500                    LDP3    1,,PR1
        14 000054   300102 236100                    LDQ     66,,PR3
        14 000055   000023 756000 1                  STQ     ERROR_FROM_STACK

     2917     8149    3           CALL M$SCREECH (FPT_SCREECH) WHENALTRETURN DO; END;

   8149 14 000056   000104 630400 0                  EPPR0   FPT_SCREECH
        14 000057   400013 713400                    CLIMB   alt,+11
        14 000060   401000 401760                    pmme    nvectors=3
        14 000061   000063 702000 14                 TSX2    s:8151
        14 000062   000063 710000 14                 TRA     s:8151
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:465  

     2918     8150    2       END;

     2919     8151    1       FPT_KEYIN.MESS_ = VECTOR(MESS1);

   8151 14 000063   000002 237000 15                 LDAQ    2
        14 000064   000026 757000 1                  STAQ    FPT_KEYIN+2

     2920     8152    1       CALL M$KEYIN (FPT_KEYIN);

   8152 14 000065   000024 630400 1                  EPPR0   FPT_KEYIN
        14 000066   120000 713400                    CLIMB   40960
        14 000067   401400 401760                    pmme    nvectors=4

     2921     8153    1       CALL M$TIME (FPT_TIME);

   8153 14 000070   000036 630400 0                  EPPR0   FPT_TIME
        14 000071   020004 713400                    CLIMB   8196
        14 000072   402000 401760                    pmme    nvectors=5

     2922     8154    1       IF LADC_FLAG

   8154 14 000073   000000 234000 0                  SZN     LADC_FLAG
        14 000074   000117 605000 14                 TPL     s:8167

     2923     8155    2       THEN DO;

     2924     8156    2           CALL M$SAVE (FPT_SAVE)

   8156 14 000075   000052 630400 0                  EPPR0   FPT_SAVE
        14 000076   400017 713400                    CLIMB   alt,+15
        14 000077   401400 401760                    pmme    nvectors=4
        14 000100   000112 702000 14                 TSX2    s:8163

     2925     8157    3           WHENRETURN DO;

     2926     8158    3               MESS3.ANS = NAME.ANS;
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:466  

   8158 14 000101   040000 100400                    MLR     fill='040'O
        14 000102   000001 200016 1                  ADSC9   NAME+1                   cn=1,n=14
        14 000103   000013 400016 1                  ADSC9   MESS3+3                  cn=2,n=14

     2927     8159    3               FPT_KEYIN.MESS_ = VECTOR(MESS3);

   8159 14 000104   000004 237000 15                 LDAQ    4
        14 000105   000026 757000 1                  STAQ    FPT_KEYIN+2

     2928     8160    3               CALL M$KEYIN (FPT_KEYIN);

   8160 14 000106   000024 630400 1                  EPPR0   FPT_KEYIN
        14 000107   120000 713400                    CLIMB   40960
        14 000110   401400 401760                    pmme    nvectors=4

     2929     8161    3           END;

   8161 14 000111   000117 710000 14                 TRA     s:8167

     2930     8162    3           WHENALTRETURN DO;

     2931     8163    3               FPT_KEYIN.MESS_ = VECTOR(MESS2);

   8163 14 000112   000006 237000 15                 LDAQ    6
        14 000113   000026 757000 1                  STAQ    FPT_KEYIN+2

     2932     8164    3               CALL M$ALIB (FPT_ALIB);

   8164 14 000114   000062 630400 0                  EPPR0   FPT_ALIB
        14 000115   000007 713400                    CLIMB   7
        14 000116   401400 401760                    pmme    nvectors=4

     2933     8165    3           END;

     2934     8166    2       END;                       /* If ladc */

PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:467  
     2935     8167    1       IF DCBADDR(DCBNUM(MAIL_IN)) -> F$DCB.FCD#

   8167 14 000117   000000 236007 xsym               LDQ     MAIL_IN,DL
        14 000120   000000 470400 15                 LDP0    0
        14 000121   000000 471500                    LDP1    0,,PR0
        14 000122   100000 473506                    LDP3    0,QL,PR1
        14 000123   300031 236100                    LDQ     25,,PR3
        14 000124   020000 316007                    CANQ    8192,DL
        14 000125   000142 600000 14                 TZE     RENAME_DIDNT_WORK

     2936     8168    2       THEN DO;

     2937     8169    2           NEW_NAME = DCBADDR(DCBNUM(MAIL_IN)) -> F$DCB.NAME#;

   8169 14 000126   000000 236007 xsym               LDQ     MAIL_IN,DL
        14 000127   100000 473506                    LDP3    0,QL,PR1
        14 000130   000000 100500                    MLR     fill='000'O
        14 000131   300010 000040                    ADSC9   8,,PR3                   cn=0,n=32
        14 000132   000100 000040 1                  ADSC9   NEW_NAME                 cn=0,n=32

     2938     8170    2           SUBSTR(NEW_NAME.NAME#,1,4)='DEAD';

   8170 14 000133   040000 100400                    MLR     fill='040'O
        14 000134   000174 000004 0                  ADSC9   MAILACCT+2               cn=0,n=4
        14 000135   000100 400004 1                  ADSC9   NEW_NAME                 cn=2,n=4

     2939     8171    2           CALL M$CLOSE (RENAME_BAD_FILE) ALTRET (RENAME_DIDNT_WORK);

   8171 14 000136   000042 630400 1                  EPPR0   RENAME_BAD_FILE
        14 000137   450001 713400                    CLIMB   alt,close
        14 000140   406000 401760                    pmme    nvectors=13
        14 000141   000142 702000 14                 TSX2    RENAME_DIDNT_WORK

   8170 14 000142                       RENAME_DIDN* null
     2940     8172    2   RENAME_DIDNT_WORK: ;
     2941     8173    2       END;

PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:468  
     2942     8174    1       CALL M$XCON (RESET_XCON);

   8174 14 000142   000222 630400 1                  EPPR0   RESET_XCON
        14 000143   010003 713400                    CLIMB   4099
        14 000144   400400 401760                    pmme    nvectors=2

     2943     8175    1       IF VOM_INIT_CCTIME = NAME.B.COMP

   8175 14 000145   040000 106400                    CMPC    fill='040'O
        14 000146   000000 000012 xsym               ADSC9   VOM_INIT_CCTIME          cn=0,n=10
        14 000147   000001 200012 1                  ADSC9   NAME+1                   cn=1,n=10
        14 000150   000161 601000 14                 TNZ     s:8182

     2944     8176    2       THEN DO;                   /* Blew up twice in a row, don't restart */

     2945     8177    2           FPT_KEYIN.MESS_ = VECTOR(MESS5);

   8177 14 000151   000010 237000 15                 LDAQ    8
        14 000152   000026 757000 1                  STAQ    FPT_KEYIN+2

     2946     8178    2           CALL M$KEYIN (FPT_KEYIN);

   8178 14 000153   000024 630400 1                  EPPR0   FPT_KEYIN
        14 000154   120000 713400                    CLIMB   40960
        14 000155   401400 401760                    pmme    nvectors=4

     2947     8179    2           CALL M$XXX;

   8179 14 000156   000003 713400                    CLIMB   3
        14 000157   000000 401760                    pmme    nvectors=0

     2948     8180    2       END;

   8180 14 000160   000170 710000 14                 TRA     OOPS

     2949     8181    2       ELSE DO;

PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:469  
     2950     8182    2           CMD.TEXT = NAME.B.COMP;

   8182 14 000161   040000 100400                    MLR     fill='040'O
        14 000162   000001 200012 1                  ADSC9   NAME+1                   cn=1,n=10
        14 000163   000005 200012 1                  ADSC9   CMD                      cn=1,n=10

     2951     8183    2           CALL M$LDTRC (VM_LDTRC_MAILMAN) ALTRET(OOPS);

   8183 14 000164   000140 630400 0                  EPPR0   VM_LDTRC_MAILMAN
        14 000165   400006 713400                    CLIMB   alt,+6
        14 000166   403000 401760                    pmme    nvectors=7
        14 000167   000170 702000 14                 TSX2    OOPS

     2952     8184    2       END;

     2953     8185    1   OOPS:
     2954     8186    1       FPT_KEYIN.MESS_ = VECTOR(MESS4);

   8186 14 000170   000012 237000 15    OOPS         LDAQ    10
        14 000171   000026 757000 1                  STAQ    FPT_KEYIN+2

     2955     8187    1       CALL M$KEYIN (FPT_KEYIN);

   8187 14 000172   000024 630400 1                  EPPR0   FPT_KEYIN
        14 000173   120000 713400                    CLIMB   40960
        14 000174   401400 401760                    pmme    nvectors=4

     2956     8188    1       ALIB_CMD='DU $LS15->0 '' MAILMAN TCB ''';

   8188 14 000175   040000 100400                    MLR     fill='040'O
        14 000176   000175 000020 0                  ADSC9   MAILACCT+3               cn=0,n=16
        14 000177   000017 000020 1                  ADSC9   ALIB_CMD                 cn=0,n=16

     2957     8189    1       CALL M$ALIB;

   8189 14 000200   000007 713400                    CLIMB   7
        14 000201   000000 401760                    pmme    nvectors=0
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:470  

     2958     8190    1       CALL M$LDEV (FPT_LDEV) ALTRET(L1);

   8190 14 000202   000114 630400 0                  EPPR0   FPT_LDEV
        14 000203   460004 713400                    CLIMB   alt,+24580
        14 000204   403000 401760                    pmme    nvectors=7
        14 000205   000206 702000 14                 TSX2    L1

     2959     8191    1   L1: CALL M$XXX;

   8191 14 000206   000003 713400       L1           CLIMB   3
        14 000207   000000 401760                    pmme    nvectors=0

     2960     8192    1   END VOM$XCON;

   8192 14 000210   000000 702200 xent               TSX2  ! X66_AARET

LADC_FLAG
 Sect OctLoc
   0     000   0***** ******                                                    ....

MESS1
 Sect OctLoc
   0     001   115101 111114   115101 116040   141142 157162   164151 156147    MAILMAN aborting
   0     005   041041 ******                                                    !!..

MESS2
 Sect OctLoc
   0     006   123101 126105   040142 165151   154144 040146   141151 154145    SAVE build faile
   0     012   144054 040120   115104 040151   163163 165145   144056 ******    d, PMD issued...

MESS4
 Sect OctLoc
   0     016   103141 156047   164040 114104   124122 103***                    Can't LDTRC.

MESS5
 Sect OctLoc
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:471  
   0     021   115101 111114   115101 116040   102114 105127   040125 120040    MAILMAN BLEW UP
   0     025   124127 111103   105040 111116   040123 101115   105040 115111    TWICE IN SAME MI
   0     031   116125 124105   054040 103101   116047 124040   122105 123124    NUTE, CAN'T REST
   0     035   101122 124***                                                    ART.

FPT_TIME
 Sect OctLoc
   0     036   000001 777640   000050 006000   000001 377640   000001 206000    .....(..........
   0     042   000001 777640   000002 606000   000000 177640   000000 006014    ................
   0     046   000000 177640   000000 006014   000002 000000   ****** ******    ................

FPT_SAVE
 Sect OctLoc
   0     052   000004 577640   000000 006000   000001 777640   000172 006000    .............z..
   0     056   000000 177640   000000 006014   000000 177640   000000 006014    ................

FPT_ALIB
 Sect OctLoc
   0     062   000001 377640   000074 006000   000003 777640   000017 006000    .....<..........
   0     066   000000 177640   000000 006014   000001 777640   000072 006000    .............:..
   0     072   600000 000000   000000 000000                                    ........

DELTA_NAME
 Sect OctLoc
   0     074   005104 105114   124101 ******                                    .DELTA..

FPT_XCON
 Sect OctLoc
   0     076   000001 777640   000102 006000   000000 177640   000000 006014    .....B..........
   0     102   000000 000000   000000 000000                                    ........

FPT_SCREECH
 Sect OctLoc
   0     104   000001 777640   000112 006000   000000 777640   000023 006000    .....J..........
   0     110   000007 777640   000110 006000                                    .....H..

MAILMAN_SNAPSHOT
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:472  
 Sect OctLoc
   0     112   261715 414345   240000 103600                                    ......C.

FPT_LDEV
 Sect OctLoc
   0     114   000005 777640   000132 006000   000000 177640   000000 006014    .....Z..........
   0     120   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0     130*  000000 177640   000000 006014   114120 060061   000000 040040    ........LP01..
   0     134   000000 000000   000000 200111   040040 040040   000040 040000    .......I    .  .

VM_LDTRC_MAILMAN
 Sect OctLoc
   0     140   000007 777640   000160 006000   000001 777640   000170 006000    .....p.......x..
   0     144   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0     150   000002 577640   000005 006000   000000 177640   000000 006014    ................
   0     154   000001 777640   000156 006000   400000 000000   000000 000000    .....n..........

VM_MAILMAN_RUNAME
 Sect OctLoc
   0     160   007115 101111   114115 101116   040040 040040   040040 040040    .MAILMAN
   0     164   040040 040040   040040 040040   040040 040040   040040 040040

VM_MAILMAN_RUACCT
 Sect OctLoc
   0     170   072123 131123   040040 040040                                    :SYS

MAILACCT
 Sect OctLoc
   0     172   072115 101111   114040 040040                                    :MAIL

(unnamed)
 Sect OctLoc
   0     174   104105 101104   104125 040044   114123 061065   055076 060040    DEADDU $LS15->0
   0     200   047040 115101   111114 115101   116040 124103   102040 047040    ' MAILMAN TCB '

NAME
 Sect OctLoc
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:473  
   1     000   022123 101126   105*** ******   ****** ******   ****** ******    .SAVE...........
   1     004   ****** ******                                                    ....

CMD
 Sect OctLoc
   1     005   012*** ******   ****** ******   ****** ******                    ............

MESS3
 Sect OctLoc
   1     010   123101 126105   040146 151154   145040 151163   072040 ******    SAVE file is: ..
   1     014   ****** ******   ****** ******   ****** ******                    ............

ALIB_CMD
 Sect OctLoc
   1     017   120115 104040   124103 102054   101125 124117   054104 103102    PMD TCB,AUTO,DCB

FPT_KEYIN
 Sect OctLoc
   1     024   000005 777640   000034 006000   000000 17764*   000000 006014    ................
   1     030   000000 17764*   000000 006014   000000 177640   000000 006014    ................
   1     034   040040 040040   040040 040040   000000 000000   400000 000000            ........
   1     040   000000 000000   000000 000000                                    ........

RENAME_BAD_FILE
 Sect OctLoc
   1     042   000003 777640   000074 006000   000000 177640   000000 006014    .....<..........
   1     046   000000 177640   000000 006014   000007 777640   000100 006000    .............@..
   1     052   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     072*  000000 177640   000000 006014   000000 400000   000000 000040    ...............
   1     076   000220 000000   000000 000000                                    ........

NEW_NAME
 Sect OctLoc
   1     100   037040 040040   040040 040040   040040 040040   040040 040040    .
   1     104   040040 040040   040040 040040   040040 040040   040040 040040

SCREECH_ID
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:474  
 Sect OctLoc
   1     110   037040 040040   040040 040040   040040 040040   040040 040040    .
   1     114   040040 040040   040040 040040   040040 040040   040040 040040

CLOSE_MAILCG
 Sect OctLoc
   1     120   000003 777640   000152 006000   000000 177640   000000 006014    .....j..........
   1     124   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     150*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   1     154   000220 000000   000000 000000                                    ........

CLOSE_SITE
 Sect OctLoc
   1     156   000003 777640   000210 006000   000000 177640   000000 006014    ................
   1     162   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     206*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   1     212   000220 000000   000000 000000                                    ........

WAIT_AWHILE
 Sect OctLoc
   1     214   000001 777640   000220 006000   000000 177640   000000 006014    ................
   1     220   000000 000074   000000 000001                                    ...<....

RESET_XCON
 Sect OctLoc
   1     222   000001 777640   000226 006000   000000 177640   000000 006014    ................
   1     226   000000 000000   000000 000000                                    ........

(unnamed)
 Sect OctLoc
  15     000   000000 006003   000000 000000   000004 377640   000001 006000    ................
  15     004   000006 777640   000010 006000   000007 377640   000006 006000    ................
  15     010   000014 577640   000021 006000   000002 577640   000016 006000    ................
     2961     8193        %EOD;

PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:475  
--  Include file information  --

   B$JIT_C.:LIB_E05  is referenced.
   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
   VM_PERR_C.:VMB6TOU  is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   VO_SUBS_C.:VMB6TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VOM$XCON.
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:476  

 **** Variables and constants ****

  ****  Section 000 RoData VOM$XCON

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    74-0-0/c STRC(54)    r     1 DELTA_NAME                62-0-0/d STRC(360)   r     1 FPT_ALIB
   114-0-0/d STRC(720)   r     1 FPT_LDEV                  52-0-0/d STRC(288)   r     1 FPT_SAVE
   104-0-0/d STRC(216)   r     1 FPT_SCREECH               36-0-0/d STRC(432)   r     1 FPT_TIME
    76-0-0/d STRC(216)   r     1 FPT_XCON                   0-0-0/b BIT         r     1 LADC_FLAG
   172-0-0/c STRC(72)    r     1 MAILACCT                 112-0-0/d STRC(72)    r     1 MAILMAN_SNAPSHOT
     1-0-0/c CHAR(18)    r     1 MESS1                      6-0-0/c CHAR(30)    r     1 MESS2
    16-0-0/c CHAR(11)    r     1 MESS4                     21-0-0/c CHAR(51)    r     1 MESS5
   140-0-0/d STRC(576)   r     1 VM_LDTRC_MAILMAN         170-0-0/c STRC(72)    r     1 VM_MAILMAN_RUACCT
   160-0-0/c STRC(288)   r     1 VM_MAILMAN_RUNAME

  ****  Section 001  Data  VOM$XCON

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    17-0-0/c CHAR(16)    r     1 ALIB_CMD                 120-0-0/d STRC(1080)  r     1 CLOSE_MAILCG
   156-0-0/d STRC(1080)  r     1 CLOSE_SITE                 5-0-0/c STRC(99)    r     1 CMD
    23-0-0/b BIT         r     1 ERROR_FROM_STACK          24-0-0/d STRC(504)   r     1 FPT_KEYIN
    10-0-0/c STRC(252)   r     1 MESS3                      0-0-0/c STRC(171)   r     1 NAME
   100-0-0/c STRC(288)   r     1 NEW_NAME                  42-0-0/d STRC(1080)  r     1 RENAME_BAD_FILE
   222-0-0/d STRC(216)   r     1 RESET_XCON               110-0-0/c STRC(288)   r     1 SCREECH_ID
   214-0-0/d STRC(216)   r     1 WAIT_AWHILE

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$TCB$
     0-0-0/c ASTR(9)     r     1 ERRMSG_FID                 0-0-0/w UBIN              1 M$DO_NUM
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:477  
     0-0-0/w UBIN              1 M$LO_NUM                   0-0-0/w UBIN              1 M$MAIL_CENTRAL_NUM
     0-0-0/w UBIN              1 M$MAIL_COMGROUP_NUM        0-0-0/w UBIN              1 M$MAIL_FILE_NUM
     0-0-0/w UBIN              1 M$MAIL_GLOBAL_NUM          0-0-0/w UBIN              1 M$ME_NUM
     0-0-0/w UBIN        r     1 M$NODE_NUM                 0-0-0/w UBIN              1 M$SI_NUM
     0-0-0/w UBIN              1 M$WORK_NUM                 0-0-0/w PTR               1 VM_ADDLIST$
     0-0-0/d VECT              1 VM_ADDLIST_                0-0-0/w PTR               1 VM_ADDREC$
     0-0-0/d VECT              1 VM_ADDREC_                 0-0-0/w PTR               1 VM_COPY$
     0-0-0/d VECT              1 VM_COPY_                   0-0-0/w PTR               1 VM_ENCLLIST$
     0-0-0/d VECT              1 VM_ENCLLIST_               0-0-0/w PTR               1 VM_ENCLREC$
     0-0-0/d VECT              1 VM_ENCLREC_                0-0-0/c STRC(270)         1 VM_FORWARD_ENCL_NAME
     0-0-0/c STRC(270)         1 VM_FORWARD_FILE_NAME       0-0-0/c STRC(72)          1 VM_FORWARD_FILE_PASS
     0-0-0/w PTR               1 VM_HEADER$                 0-0-0/d VECT              1 VM_HEADER_
     0-0-0/d VECT              1 VM_HEADER_INIT_            0-0-0/w PTR               1 VM_INPUT$
     0-0-0/d VECT              1 VM_INPUT_                  0-0-0/c STRC(72)          1 VM_MAILCG_NAME
     0-0-0/w STRC(432)         1 VM_MAILCG_SETSTA           0-0-0/c STRC(72)          1 VM_MAIL_ACCT
     0-0-0/c STRC(54)          1 VM_NAME_MAP_NAME           0-0-0/w PTR               1 VM_PARSEAREA$
     0-0-0/d VECT              1 VM_PARSEAREA_              0-0-0/w PTR               1 VM_PROFILE$
     0-0-0/d VECT              1 VM_PROFILE_                0-0-0/w PTR               1 VM_SELECT$
     0-0-0/d VECT              1 VM_SELECT_                 0-0-0/c STRC(288)         1 VM_SEND_FILE_NAME
     0-0-0/c CHAR(8)           1 VM_SITENAME                0-0-0/w PTR               1 VM_WORK$
     0-0-0/d VECT              1 VM_WORK_                   0-0-0/c CHAR(10)    r     1 VOM_INIT_CCTIME

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/w STRC(2448)  r     1 B$XCON                     0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0N  NULL        r     1 M$DO                       0-0-0N  NULL        r     1 M$LO
     0-0-0N  NULL        r     1 M$MAIL_CENTRAL             0-0-0N  NULL        r     1 M$MAIL_COMGROUP
     0-0-0N  NULL        r     1 M$MAIL_FILE                0-0-0N  NULL        r     1 M$MAIL_GLOBAL
     0-0-0N  NULL        r     1 M$ME                       0-0-0N  NULL        r     1 M$NODE
     0-0-0N  NULL        r     1 M$SI                       0-0-0N  NULL        r     1 M$UC
     0-0-0N  NULL        r     1 M$WORK                     0-0-0N  NULL        r     1 MAIL_IN
     0-0-0/c ASTR(9)     r     1 X$STRING

PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:478  

   Procedure VOM$XCON requires 137 words for executable code.
   Procedure VOM$XCON requires 4 words of local(AUTO) storage.
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:479  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:480  
          MINI XREF LISTING

ALIB_CMD
        27**DCL      7659--DCLINIT  8188<<ASSIGN
B$JIT.CPFLAGS1.SLEAZE
      7403**DCL      7403--REDEF
B$JIT.ERR.MID
      7310**DCL      7310--REDEF
B$JIT.JRESPEAK
      7471**DCL      7472--REDEF
B$JIT.MODE
      7304**DCL      8146>>IF
B$JIT.ORIGINATOR_PORT.FROM_CR
      7580**DCL      7580--REDEF    7581--REDEF
B$JIT.PNR
      7484**DCL      7484--REDEF
B$JIT.PRIV.ACTIVE.EXMM
      7314**DCL      8146>>IF
B$JIT.TSLINE
      7578**DCL      7579--REDEF
B$JIT$
      6391**DCL      7304--IMP-PTR  8146>>IF       8146>>IF
B$TCB.STK$
      6911**DCL      8131>>IF       8139>>IF       8148>>ASSIGN
B$TCB$
      6392**DCL      6911--IMP-PTR  8131>>IF       8139>>IF       8148>>ASSIGN
B$XCON.ERR
      6979**DCL      8148>>ASSIGN
B$XCON.ERR.ERR#
      6979**DCL      6979--REDEF
B$XCON.LIMIT.MEM
      6977**DCL      6977--REDEF
B$XCON.RNST.OPERR
      6975**DCL      8139>>IF
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:481  
B$XCON.RNST.OPXXX
      6974**DCL      8131>>IF
CLOSE_MAILCG.SN_
      8033**DCL      8033--REDEF
CLOSE_MAILCG.UTL_
      8034**DCL      8034--REDEF
CLOSE_MAILCG.V
      8038**DCL      8033--DCLINIT
CLOSE_MAILCG.V.EXPIRE#
      8048**DCL      8048--REDEF
CLOSE_MAILCG.V.TYPE#
      8046**DCL      8046--REDEF
CLOSE_MAILCG.V.XTNSIZE#
      8043**DCL      8043--REDEF    8045--REDEF
CLOSE_SITE
      8077**DCL      8137<>CALL
CLOSE_SITE.SN_
      8077**DCL      8077--REDEF
CLOSE_SITE.UTL_
      8078**DCL      8078--REDEF
CLOSE_SITE.V
      8082**DCL      8077--DCLINIT
CLOSE_SITE.V.EXPIRE#
      8092**DCL      8092--REDEF
CLOSE_SITE.V.TYPE#
      8090**DCL      8090--REDEF
CLOSE_SITE.V.XTNSIZE#
      8087**DCL      8087--REDEF    8089--REDEF
CMD
        21**DCL      7939--DCLINIT
CMD.TEXT
        23**DCL      8182<<ASSIGN
CONT_ON
      8139**LABEL    8137--CALLALT
DELTA_NAME
      7691**DCL      7659--DCLINIT
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:482  
ERRMSG_FID.L#
      6460**DCL      6460--IMP-SIZ
ERROR_FROM_STACK
        33**DCL      7793--DCLINIT  8148<<ASSIGN
F$DCB.ACTPOS
      6947**DCL      6947--REDEF
F$DCB.ARS#
      6921**DCL      6921--REDEF
F$DCB.ATTR
      6940**DCL      6941--REDEF
F$DCB.BORROW
      6955**DCL      6955--REDEF    6955--REDEF    6955--REDEF
F$DCB.DCBNAME.L
      6969**DCL      6969--IMP-SIZ
F$DCB.EOMCHAR#
      6925**DCL      6925--REDEF
F$DCB.FCD#
      6934**DCL      8136>>IF       8167>>IF
F$DCB.FLDID
      6950**DCL      6950--REDEF
F$DCB.FORM$
      6944**DCL      6944--REDEF
F$DCB.FSECT
      6960**DCL      6960--REDEF
F$DCB.FSN#
      6937**DCL      6937--REDEF    6937--REDEF    6938--REDEF
F$DCB.HEADER$
      6943**DCL      6943--REDEF
F$DCB.IXTNSIZE#
      6941**DCL      6941--REDEF
F$DCB.LASTSTA$
      6930**DCL      6930--REDEF
F$DCB.LVL
      6956**DCL      6956--REDEF
F$DCB.NAME#
      6931**DCL      8169>>ASSIGN
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:483  
F$DCB.NAME#.C
      6931**DCL      6931--REDEF
F$DCB.NOEOF
      6953**DCL      6953--REDEF
F$DCB.NRECS#
      6942**DCL      6942--REDEF
F$DCB.NRECX
      6961**DCL      6961--REDEF
F$DCB.OHDR
      6953**DCL      6953--REDEF
F$DCB.ORG#
      6936**DCL      6936--REDEF
F$DCB.PRECNO
      6959**DCL      6959--REDEF
F$DCB.RCSZ
      6965**DCL      6965--REDEF
F$DCB.RES#
      6932**DCL      6932--REDEF
F$DCB.SETX
      6944**DCL      6944--REDEF
F$DCB.TAB$
      6944**DCL      6944--REDEF
F$DCB.TDA
      6958**DCL      6959--REDEF
F$DCB.WSN#
      6932**DCL      6932--REDEF
FPT_ALIB
      7659**DCL      8164<>CALL
FPT_ALIB.V
      7660**DCL      7660--DCLINIT
FPT_KEYIN
      7620**DCL      8152<>CALL     8160<>CALL     8178<>CALL     8187<>CALL
FPT_KEYIN.MESS_
      7620**DCL      8151<<ASSIGN   8159<<ASSIGN   8163<<ASSIGN   8177<<ASSIGN   8186<<ASSIGN
FPT_KEYIN.V
      7623**DCL      7620--DCLINIT
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:484  
FPT_LDEV
      7908**DCL      8190<>CALL
FPT_LDEV.V
      7910**DCL      7908--DCLINIT
FPT_SAVE
      7641**DCL      8156<>CALL
FPT_SCREECH
      7793**DCL      8149<>CALL
FPT_TIME
      7601**DCL      8153<>CALL
FPT_TIME.V
      7605**DCL      7601--DCLINIT
FPT_XCON.V
      7777**DCL      7776--DCLINIT
L1
      8191**LABEL    8190--CALLALT
LADC_FLAG
         9**DCL      8154>>IF
M$ALIB
      5534**DCL-ENT  8164--CALL     8189--CALL
M$CLOSE
      5521**DCL-ENT  8137--CALL     8171--CALL
M$EXIT
      5533**DCL-ENT  8134--CALL
M$KEYIN
      5526**DCL-ENT  8152--CALL     8160--CALL     8178--CALL     8187--CALL
M$LDEV
      5521**DCL-ENT  8190--CALL
M$LDTRC
      5534**DCL-ENT  8142--CALL     8183--CALL
M$NODE_NUM
      6388**DCL      8136--IF
M$SAVE
      5536**DCL-ENT  8156--CALL
M$SCREECH
      5535**DCL-ENT  8149--CALL
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:485  
M$TIME
      5588**DCL-ENT  8153--CALL
M$XCON
      5576**DCL-ENT  8133--CALL     8141--CALL     8174--CALL
M$XXX
      5533**DCL-ENT  8179--CALL     8191--CALL
MAILACCT
      8001**DCL      7641--DCLINIT
MAILMAN_SNAPSHOT
      7814**DCL      7793--DCLINIT
MAIL_IN
        32**DCL      8167--IF       8169--ASSIGN
MESS1
        28**DCL      8151--ASSIGN
MESS2
        29**DCL      8163--ASSIGN
MESS3
        24**DCL      8159--ASSIGN
MESS3.ANS
        26**DCL      8158<<ASSIGN
MESS4
        30**DCL      8186--ASSIGN
MESS5
        31**DCL      8177--ASSIGN
NAME
        11**DCL      7641--DCLINIT
NAME.A
        14**DCL        17--REDEF      18--REDEF
NAME.A.DATE
        15**DCL      7601--DCLINIT  7602--DCLINIT
NAME.A.TIME
        16**DCL      7603--DCLINIT  7604--DCLINIT
NAME.ANS
        17**DCL      8158>>ASSIGN
NAME.B.COMP
        19**DCL      8175>>IF       8182>>ASSIGN
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:486  
NEW_NAME
      7763**DCL      7721--DCLINIT  8169<<ASSIGN
NEW_NAME.NAME#
      7763**DCL      8170<<ASSIGN
OOPS
      8186**LABEL    8142--CALLALT  8183--CALLALT
RENAME_BAD_FILE
      7719**DCL      8171<>CALL
RENAME_BAD_FILE.SN_
      7719**DCL      7719--REDEF
RENAME_BAD_FILE.UTL_
      7720**DCL      7720--REDEF
RENAME_BAD_FILE.V
      7724**DCL      7719--DCLINIT
RENAME_BAD_FILE.V.EXPIRE#
      7734**DCL      7734--REDEF
RENAME_BAD_FILE.V.TYPE#
      7732**DCL      7732--REDEF
RENAME_BAD_FILE.V.XTNSIZE#
      7729**DCL      7729--REDEF    7731--REDEF
RENAME_DIDNT_WORK
      8170**LABEL    8171--CALLALT
RESET_XCON
      8125**DCL      8133<>CALL     8141<>CALL     8174<>CALL
RESET_XCON.V
      8126**DCL      8125--DCLINIT
SCREECH_ID
      7894**DCL      7794--DCLINIT
VM_LDTRC_MAILMAN
      7938**DCL      8142<>CALL     8183<>CALL
VM_LDTRC_MAILMAN.V
      7940**DCL      7940--DCLINIT
VM_MAILMAN_RUACCT
      7986**DCL      7938--DCLINIT
VM_MAILMAN_RUNAME
      7971**DCL      7938--DCLINIT
PL6.E3A0      #003=VOM$XCON File=VOM$MAILMAN.:VMB6TSI                            WED 08/20/97 15:34 Page:487  
VOM_INIT_CCTIME
      8004**DCL      8175>>IF
WAIT_AWHILE.V
      8111**DCL      8110--DCLINIT
X$STRING.SIZ
      6306**DCL      6307--IMP-SIZ

PL6.E3A0      #004=VOM$EVENT File=VOM$MAILMAN.:VMB6TSI                           WED 08/20/97 15:34 Page:488  
     2962        1        /*T***********************************************************/
     2963        2        /*T*                                                         */
     2964        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2965        4        /*T*                                                         */
     2966        5        /*T***********************************************************/
     2967        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
     2968        7        VOM$EVENT: PROC ASYNC;
     2969        8
     2970        9        %INCLUDE CP_6_SUBS;
     2971      549        %INCLUDE VO_SUBS_C;
     2972      600        %INCLUDE VOM_DATA_R;                    /* Also includes CP_6 */
     2973     7820        %INCLUDE VM_DATA_R;
     2974     8251    1   DCL VO_NEED_READ BIT(1) SYMREF;
     2975     8252    1   DCL VO_PROCESS BIT(1) SYMREF;
     2976     8253             %B$TCB (STCLASS="BASED(B$TCB$)");
     2977     8256             %B$NWIO (STCLASS="BASED(STK$)");
     2978     8341
     2979     8342
     2980     8343    1   DCL STK$ PTR;
     2981     8344
     2982     8345    1   DCL VOM$PROCESS ENTRY;
     2983     8346    1       STK$ = B$TCB.STK$;
     2984     8347
     2985     8348    1       IF B$NWIO.EVID = %VOM_READMAIL# AND B$NWIO.TYC ~= %TYC_EOF
     2986     8349    1       THEN
     2987     8350    2       DO;
     2988     8351    2           VO_BNWIO = B$NWIO;
     2989     8352    2           VO_PROCESS = '1'B;
     2990     8353    2       END;
     2991     8354    1       ELSE VO_NEED_READ = '1'B;     /* Set flag to read from comgroup
     2992     8355                                                 once we're out of the async routine */
     2993     8356    1       RETURN;
     2994     8357    1   END VOM$EVENT;
     2995     8358        %EOD;

PL6.E3A0      #004=VOM$EVENT File=VOM$MAILMAN.:VMB6TSI                           WED 08/20/97 15:34 Page:489  
--  Include file information  --

   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VOM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   VO_SUBS_C.:VMB6TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
      No diagnostics issued in procedure VOM$EVENT.

   Procedure VOM$EVENT requires 21 words for executable code.
   Procedure VOM$EVENT requires 4 words of local(AUTO) storage.

PL6.E3A0      #004=VOM$EVENT File=VOM$MAILMAN.:VMB6TSI                           WED 08/20/97 15:34 Page:490  

 Object Unit name= VOM$EVENT                                  File name= VOM$MAILMAN.:VMB6TOU
 UTS= AUG 20 '97 15:34:37.84 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$MAIL_FILE
    2   DCB   even  none     0      0  M$MAIL_CENTRAL
    3   DCB   even  none     0      0  M$MAIL_GLOBAL
    4   DCB   even  none     0      0  M$WORK
    5   DCB   even  none     0      0  M$MAIL_COMGROUP
    6   DCB   even  none     0      0  M$DO
    7   DCB   even  none     0      0  M$LO
    8   DCB   even  none     0      0  M$ME
    9   DCB   even  none     0      0  M$NODE
   10   DCB   even  none     0      0  M$SI
   11  RoData even  UTS      1      1  VOM$EVENT
   12   Proc  even  none    21     25  VOM$EVENT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    12      0   yes            yes     Async       0  VOM$EVENT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AAUTO
                       nStd      0 X66_AARET
PL6.E3A0      #004=VOM$EVENT File=VOM$MAILMAN.:VMB6TSI                           WED 08/20/97 15:34 Page:491  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  VM_CGBUFFER                           VO_BNWIO
     STATION#                              VO_INTERSYS_ALLOWED                   TIME_HEAD$
     TIME$                                 INTERSYS_HEAD$                        INTERSYS$
r    VO_BUSY_RETRY_MINUTES            r    VO_PACKSET_RETRY_MINUTES         r    VO_MAX_HOLD_HOURS
r    VO_HOG_LIMIT                          VO_MAILMAN_STARTUP_TIME               VO_INTERSYS_PASSWORD
     VO_INTERSYS_EPASS                     VO_INTERSYS_ACCT                      VO_INTERSYS_UNAME
     VO_RETRY_LIMIT_INTERSYSTEM       r    VM_HEADER$                       r    VM_PROFILE$
r    VM_ADDLIST$                      r    VM_ADDREC$                       r    VM_WORK$
r    VM_SELECT$                       r    VM_PARSEAREA$                    r    VM_INPUT$
r    VM_COPY$                              VM_ENCLLIST$                          VM_ENCLREC$
     VM_HEADER_                            VM_HEADER_INIT_                       VM_PROFILE_
     VM_ADDLIST_                           VM_ADDREC_                            VM_WORK_
     VM_SELECT_                            VM_PARSEAREA_                         VM_INPUT_
     VM_COPY_                              VM_ENCLLIST_                          VM_ENCLREC_
     M$MAIL_FILE                           M$MAIL_CENTRAL                        M$MAIL_GLOBAL
     M$WORK                                M$MAIL_COMGROUP                       M$DO
     M$LO                                  M$ME                                  M$NODE
     M$SI                                  M$MAIL_FILE_NUM                       M$MAIL_CENTRAL_NUM
     M$MAIL_GLOBAL_NUM                     M$WORK_NUM                            M$MAIL_COMGROUP_NUM
     M$DO_NUM                              M$ME_NUM                              M$LO_NUM
     M$SI_NUM                              M$NODE_NUM                       r    B$JIT$
r    B$TCB$                                VM_MAIL_ACCT                          VM_NAME_MAP_NAME
     ERRMSG_FID                            VM_SEND_FILE_NAME                     VM_FORWARD_FILE_NAME
     VM_FORWARD_ENCL_NAME                  VM_FORWARD_FILE_PASS                  VM_MAILCG_NAME
     VM_SITENAME                           VM_MAILCG_SETSTA                      VO_NEED_READ
     VO_PROCESS
PL6.E3A0      #004=VOM$EVENT File=VOM$MAILMAN.:VMB6TSI                           WED 08/20/97 15:34 Page:492  


     2962        1        /*T***********************************************************/
     2963        2        /*T*                                                         */
     2964        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2965        4        /*T*                                                         */
     2966        5        /*T***********************************************************/
     2967        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
     2968        7        VOM$EVENT: PROC ASYNC;

      7 12 000000   000000 700200 xent  VOM$EVENT    TSX0  ! X66_AAUTO
        12 000001   000004 000000                    ZERO    4,0

     2969        8
     2970        9        %INCLUDE CP_6_SUBS;
     2971      549        %INCLUDE VO_SUBS_C;
     2972      600        %INCLUDE VOM_DATA_R;                    /* Also includes CP_6 */
     2973     7820        %INCLUDE VM_DATA_R;
     2974     8251    1   DCL VO_NEED_READ BIT(1) SYMREF;
     2975     8252    1   DCL VO_PROCESS BIT(1) SYMREF;
     2976     8253             %B$TCB (STCLASS="BASED(B$TCB$)");
     2977     8256             %B$NWIO (STCLASS="BASED(STK$)");
     2978     8341
     2979     8342
     2980     8343    1   DCL STK$ PTR;
     2981     8344
     2982     8345    1   DCL VOM$PROCESS ENTRY;
     2983     8346    1       STK$ = B$TCB.STK$;

   8346 12 000002   000000 470400 xsym               LDP0    B$TCB$
        12 000003   000001 236100                    LDQ     1,,PR0
        12 000004   200003 756100                    STQ     STK$,,AUTO

     2984     8347
     2985     8348    1       IF B$NWIO.EVID = %VOM_READMAIL# AND B$NWIO.TYC ~= %TYC_EOF

   8348 12 000005   200003 471500                    LDP1    STK$,,AUTO
        12 000006   100101 235100                    LDA     65,,PR1
PL6.E3A0      #004=VOM$EVENT File=VOM$MAILMAN.:VMB6TSI                           WED 08/20/97 15:34 Page:493  
        12 000007   000001 115007                    CMPA    1,DL
        12 000010   000022 601000 12                 TNZ     s:8354
        12 000011   100104 236100                    LDQ     68,,PR1
        12 000012   000000 116000 11                 CMPQ    0
        12 000013   000022 600000 12                 TZE     s:8354

     2986     8349    1       THEN
     2987     8350    2       DO;

     2988     8351    2           VO_BNWIO = B$NWIO;

   8351 12 000014   000000 100500                    MLR     fill='000'O
        12 000015   100000 000500                    ADSC9   0,,PR1                   cn=0,n=320
        12 000016   000000 000500 xsym               ADSC9   VO_BNWIO                 cn=0,n=320

     2989     8352    2           VO_PROCESS = '1'B;

   8352 12 000017   400000 236003                    LDQ     -131072,DU
        12 000020   000000 756000 xsym               STQ     VO_PROCESS

     2990     8353    2       END;

   8353 12 000021   000024 710000 12                 TRA     s:8356

     2991     8354    1       ELSE VO_NEED_READ = '1'B;     /* Set flag to read from comgroup

   8354 12 000022   400000 236003                    LDQ     -131072,DU
        12 000023   000000 756000 xsym               STQ     VO_NEED_READ

     2992     8355                                                 once we're out of the async routine */
     2993     8356    1       RETURN;

   8356 12 000024   000000 702200 xent               TSX2  ! X66_AARET

(unnamed)
 Sect OctLoc
  11     000   004000 000000                                                    ....
PL6.E3A0      #004=VOM$EVENT File=VOM$MAILMAN.:VMB6TSI                           WED 08/20/97 15:34 Page:494  
     2994     8357    1   END VOM$EVENT;
     2995     8358        %EOD;

PL6.E3A0      #004=VOM$EVENT File=VOM$MAILMAN.:VMB6TSI                           WED 08/20/97 15:34 Page:495  
--  Include file information  --

   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VOM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   VO_SUBS_C.:VMB6TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
      No diagnostics issued in procedure VOM$EVENT.
PL6.E3A0      #004=VOM$EVENT File=VOM$MAILMAN.:VMB6TSI                           WED 08/20/97 15:34 Page:496  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 STK$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR               1 B$JIT$                     0-0-0/w PTR         r     1 B$TCB$
     0-0-0/c ASTR(9)     r     1 ERRMSG_FID                 0-0-0/w PTR         r     1 INTERSYS$
     0-0-0/w PTR               1 INTERSYS_HEAD$             0-0-0/w UBIN              1 M$DO_NUM
     0-0-0/w UBIN              1 M$LO_NUM                   0-0-0/w UBIN              1 M$MAIL_CENTRAL_NUM
     0-0-0/w UBIN              1 M$MAIL_COMGROUP_NUM        0-0-0/w UBIN              1 M$MAIL_FILE_NUM
     0-0-0/w UBIN              1 M$MAIL_GLOBAL_NUM          0-0-0/w UBIN              1 M$ME_NUM
     0-0-0/w UBIN              1 M$NODE_NUM                 0-0-0/w UBIN              1 M$SI_NUM
     0-0-0/w UBIN              1 M$WORK_NUM                 0-0-0/c CHAR(8)           1 STATION#
     0-0-0/w PTR         r     1 TIME$                      0-0-0/w PTR               1 TIME_HEAD$
     0-0-0/w PTR               1 VM_ADDLIST$                0-0-0/d VECT              1 VM_ADDLIST_
     0-0-0/w PTR               1 VM_ADDREC$                 0-0-0/d VECT              1 VM_ADDREC_
     0-0-0/c STRC(1296)        1 VM_CGBUFFER                0-0-0/w PTR               1 VM_COPY$
     0-0-0/d VECT              1 VM_COPY_                   0-0-0/w PTR               1 VM_ENCLLIST$
     0-0-0/d VECT              1 VM_ENCLLIST_               0-0-0/w PTR               1 VM_ENCLREC$
     0-0-0/d VECT              1 VM_ENCLREC_                0-0-0/c STRC(270)         1 VM_FORWARD_ENCL_NAME
     0-0-0/c STRC(270)         1 VM_FORWARD_FILE_NAME       0-0-0/c STRC(72)          1 VM_FORWARD_FILE_PASS
     0-0-0/w PTR               1 VM_HEADER$                 0-0-0/d VECT              1 VM_HEADER_
     0-0-0/d VECT              1 VM_HEADER_INIT_            0-0-0/w PTR               1 VM_INPUT$
     0-0-0/d VECT              1 VM_INPUT_                  0-0-0/c STRC(72)          1 VM_MAILCG_NAME
     0-0-0/w STRC(432)         1 VM_MAILCG_SETSTA           0-0-0/c STRC(72)          1 VM_MAIL_ACCT
     0-0-0/c STRC(54)          1 VM_NAME_MAP_NAME           0-0-0/w PTR               1 VM_PARSEAREA$
     0-0-0/d VECT              1 VM_PARSEAREA_              0-0-0/w PTR               1 VM_PROFILE$
     0-0-0/d VECT              1 VM_PROFILE_                0-0-0/w PTR               1 VM_SELECT$
PL6.E3A0      #004=VOM$EVENT File=VOM$MAILMAN.:VMB6TSI                           WED 08/20/97 15:34 Page:497  
     0-0-0/d VECT              1 VM_SELECT_                 0-0-0/c STRC(288)         1 VM_SEND_FILE_NAME
     0-0-0/c CHAR(8)           1 VM_SITENAME                0-0-0/w PTR               1 VM_WORK$
     0-0-0/d VECT              1 VM_WORK_                   0-0-0/w STRC(2880)  r     1 VO_BNWIO
     0-0-0/w UBIN              1 VO_BUSY_RETRY_MINUTES
     0-0-0/w UBIN              1 VO_HOG_LIMIT               0-0-0/c CHAR(8)           1 VO_INTERSYS_ACCT
     0-0-0/b BIT               1 VO_INTERSYS_ALLOWED        0-0-0/c CHAR(12)          1 VO_INTERSYS_EPASS
     0-0-0/c CHAR(8)           1 VO_INTERSYS_PASSWORD       0-0-0/c CHAR(8)           1 VO_INTERSYS_UNAME
     0-0-0/w UBIN              1 VO_MAILMAN_STARTUP_TIME
     0-0-0/w UBIN              1 VO_MAX_HOLD_HOURS          0-0-0/b BIT         r     1 VO_NEED_READ
     0-0-0/w UBIN              1 VO_PACKSET_RETRY_MINUTES
     0-0-0/b BIT         r     1 VO_PROCESS
     0-0-0/w UBIN              1 VO_RETRY_LIMIT_INTERSYSTEM

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2880)  r     1 B$NWIO                     0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/w STRC(540)         1 INTERSYS_INFO              0-0-0N  NULL        r     1 M$DO
     0-0-0N  NULL        r     1 M$LO                       0-0-0N  NULL        r     1 M$MAIL_CENTRAL
     0-0-0N  NULL        r     1 M$MAIL_COMGROUP            0-0-0N  NULL        r     1 M$MAIL_FILE
     0-0-0N  NULL        r     1 M$MAIL_GLOBAL              0-0-0N  NULL        r     1 M$ME
     0-0-0N  NULL        r     1 M$NODE                     0-0-0N  NULL        r     1 M$SI
     0-0-0N  NULL        r     1 M$UC                       0-0-0N  NULL        r     1 M$WORK
     0-0-0/w STRC(612)         1 TIME_TABLE                 0-0-0/c ASTR(9)     r     1 X$STRING


   Procedure VOM$EVENT requires 21 words for executable code.
   Procedure VOM$EVENT requires 4 words of local(AUTO) storage.
PL6.E3A0      #004=VOM$EVENT File=VOM$MAILMAN.:VMB6TSI                           WED 08/20/97 15:34 Page:498  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=VOM$EVENT File=VOM$MAILMAN.:VMB6TSI                           WED 08/20/97 15:34 Page:499  
          MINI XREF LISTING

B$NWIO
      8259**DCL      8351>>ASSIGN
B$NWIO.CGPARM.MSGIDXT
      8290**DCL      8293--REDEF
B$NWIO.CODE
      8259**DCL      8259--REDEF    8260--REDEF    8260--REDEF
B$NWIO.ERR.ERR#
      8261**DCL      8261--REDEF
B$NWIO.EVID
      8260**DCL      8260--REDEF    8260--REDEF    8348>>IF
B$NWIO.TYC
      8266**DCL      8348>>IF
B$TCB.STK$
      8254**DCL      8346>>ASSIGN
B$TCB$
      8028**DCL      8254--IMP-PTR  8346>>ASSIGN
ERRMSG_FID.L#
      8096**DCL      8096--IMP-SIZ
INTERSYS$
      7813**DCL      7818--IMP-PTR
STK$
      8343**DCL      8259--IMP-PTR  8346<<ASSIGN   8348>>IF       8348>>IF       8351>>ASSIGN
TIME$
      7812**DCL      7816--IMP-PTR
VO_BNWIO
      7730**DCL      8351<<ASSIGN
VO_BNWIO.CGPARM.MSGIDXT
      7761**DCL      7764--REDEF
VO_BNWIO.CODE
      7730**DCL      7730--REDEF    7731--REDEF    7731--REDEF
VO_BNWIO.ERR.ERR#
      7732**DCL      7732--REDEF
PL6.E3A0      #004=VOM$EVENT File=VOM$MAILMAN.:VMB6TSI                           WED 08/20/97 15:34 Page:500  
VO_BNWIO.EVID
      7731**DCL      7731--REDEF    7731--REDEF
VO_NEED_READ
      8251**DCL      8354<<ASSIGN
VO_PROCESS
      8252**DCL      8352<<ASSIGN
X$STRING.SIZ
      7942**DCL      7943--IMP-SIZ

PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:501  
     2996        1        /*T***********************************************************/
     2997        2        /*T*                                                         */
     2998        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2999        4        /*T*                                                         */
     3000        5        /*T***********************************************************/
     3001        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
     3002        7        VOM$PROCESS: PROC;
     3003        8          %INCLUDE B_ERRORS_C;
     3004     1135          %INCLUDE CP_6_SUBS;
     3005     1675          %INCLUDE VOM_DATA_R;                  /* Also includes CP_6 */
     3006     8895          %INCLUDE VO_SUBS_C;
     3007     8946          %INCLUDE VM_DATA_R;
     3008     9377
     3009     9378        %VLP_NAME (FPTN=MAIL_NAME,STCLASS="SYMREF",LEN=31);
     3010     9405        %VLP_STATION (FPTN=OUTSTATION, STCLASS="SYMREF");
     3011     9432              %EQU_CG;
     3012     9480        %FPT_WRITE(FPTN=WRITE_MAILCG,STCLASS="SYMREF",
     3013     9481                   BUF=VM_CGBUFFER);
     3014     9512             %FPT_READ      (FPTN=READ_MAILCG,
     3015     9513                                 DCB=M$MAIL_COMGROUP,
     3016     9514                                 BUF=VM_CGBUFFER,
     3017     9515                                 EVENT = %VOM_READMAIL#,
     3018     9516             WAIT=NO);
     3019     9555             %B$TCB (STCLASS="BASED(B$TCB$)");
     3020     9558
     3021     9559             %B$ALT;
     3022     9567             %VLP_ERRCODE (FPTN=ERROR);
     3023     9612              %FPT_OPEN(FPTN=CREATE_SEND,ACS=DIRECT,
     3024     9613              ASN=FILE,
     3025     9614              ACCT=VM_MAIL_ACCT,
     3026     9615              ACCESS=SEND_ACCESS,
     3027     9616              ACSVEH=SEND_ACSVEH,
     3028     9617              NAME=SEND_NAME,
     3029     9618              SCRUB=YES,
     3030     9619              ORG=KEYED,
     3031     9620              DCB=CREATE_DCB,
     3032     9621              FUN=CREATE,
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:502  
     3033     9622              EXIST=ERROR);
     3034     9731
     3035     9732          %VLP_ATTR (FPTN=SEND_ACCESS);
     3036     9746          %VLP_ACCESS (NOLIST=YES,EXEC=YES,LAST=";");
     3037     9763
     3038     9764              %VLP_ATTR (FPTN=SEND_ACSVEH);
     3039     9778          %VLP_ACSVEH (READ=YES,UPD=YES,WNEW=YES,DELR=YES,VEHICLE='SEND_TEST');
     3040     9795              %VLP_ACSVEH (READ=YES,UPD=YES,WNEW=YES,DELR=YES,VEHICLE='SEND',LAST=";");
     3041     9812
     3042     9813              %VLP_NAME (FPTN=SEND_NAME,LEN=25,NAME='                         ');
     3043     9840
     3044     9841          %FPT_CLOSE(FPTN=CLOSE_SEND,DCB=CREATE_DCB,DISP=SAVE);
     3045     9883
     3046     9884        %FPT_CLOSE (FPTN=CLOSE_CREATE_REL, STCLASS=CONSTANT,
     3047     9885                  DISP=RELEASE,
     3048     9886                  DCB=CREATE_DCB);
     3049     9928
     3050     9929          %VM_HEADER;
     3051    10058        %VM_HEADER (NAME=HEADTEMP, STCLASS=AUTO);
     3052    10187        %VM_KEYTYPES;
     3053    10208        %VM_INFOKEY (NAME=HEADKEY,TYP=%VM_TYPE_HEAD,STCLASS=CONSTANT);
     3054    10225        %FPT_READ (FPTN=READHEAD, STCLASS=STATIC,
     3055    10226                  DCB=CREATE_DCB,
     3056    10227                  KEY=HEADKEY,
     3057    10228                  KEYS=YES);
     3058    10267
     3059    10268          %FPT_TIME (FPTN=GET_CURRENT,
     3060    10269                         SOURCE=CLOCK,
     3061    10270                         DEST=UTS,
     3062    10271                         TSTAMP=CURRENT_TIME);
     3063    10290
     3064    10291          %FPT_XCON (FPTN=RESET_XCON);
     3065    10305
     3066    10306    1   DCL CURRENT_TIME UBIN WORD STATIC;
     3067    10307    1   DCL J UBIN;
     3068    10308    1   DCL CREATE_DCB DCB;
     3069    10309    1   DCL PTR$ PTR;
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:503  
     3070    10310    1   DCL I SBIN WORD;
     3071    10311    1   DCL SEND_STRING CHAR(20);
     3072    10312    1   DCL VMD$GET_HEADER ENTRY(2) ALTRET;
     3073    10313    1   DCL VOM$ADDENTRY  ENTRY(4);
     3074    10314    1   DCL VOM$ADDENTRY_SORTED ENTRY(4);
     3075    10315    1   DCL VOM$DELENTRY ENTRY(3);
     3076    10316    1   DCL NOTIFY$MAILCG ENTRY(1);
     3077    10317    1   DCL FIND$FOLDER ENTRY(4) ALTRET;
     3078    10318    1   DCL SAVE$ PTR ALIGNED;
     3079    10319    1   DCL VOM$DOSEND ENTRY(1);
     3080    10320    1   DCL ANOTHER_USER BIT(1) ALIGNED;
     3081    10321    1   DCL VO_PROCESS BIT(1) SYMREF;
     3082    10322    1   DCL VO_NEED_READ BIT(1) SYMREF;
     3083    10323
     3084    10324    1       VO_PROCESS = '0'B;
     3085    10325    1       VO_NEED_READ = '1'B;
     3086    10326
     3087    10327
     3088    10328
     3089    10329    1       IF VO_BNWIO.CGPARM.MSGTYP# = '*AUEV' /* Admin event */
     3090    10330    1       THEN
     3091    10331    2       DO;
     3092    10332    2       END;
     3093    10333    1       ELSE
     3094    10334    2       DO;
     3095    10335    3           DO CASE (VM_CGBUFFER.COMMAND); /* Do particular function */
     3096    10336
     3097    10337    3           CASE(%VO_KILL_MAILMAN#);
     3098    10338    3               CALL M$XCON (RESET_XCON) ALTRET(E_XCON);
     3099    10339    3   E_XCON:
     3100    10340    3               CALL M$XXX;
     3101    10341    3           CASE (%VO_SEND#);
     3102    10342
     3103    10343    3               SEND_NAME = VM_CGBUFFER.FILE_NAME;
     3104    10344    3               CREATE_SEND.V.FUN# = %IN#;
     3105    10345    3               CALL M$OPEN (CREATE_SEND) ALTRET(BAD_OPEN);
     3106    10346    3               READHEAD.BUF_ = VECTOR(HEADTEMP);
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:504  
     3107    10347    4               CALL M$READ (READHEAD) WHENALTRETURN DO;
     3108    10348    4                   IF B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$LD THEN GOTO BAD_OPEN;
     3109    10349    4               END;
     3110    10350        /*
     3111    10351             ***** If no delivery time was specified,
     3112    10352                   then deliver as soon as possible.
     3113    10353                   Therefore, this entry must be added
     3114    10354                   to the time queue with the current time ...
     3115    10355        */
     3116    10356    3               IF HEADTEMP.DELIVERY_DATE = 0
     3117    10357    3               THEN
     3118    10358    4               DO;
     3119    10359    4                   CALL M$TIME (GET_CURRENT);
     3120    10360    4                   HEADTEMP.DELIVERY_DATE = CURRENT_TIME;
     3121    10361    4               END;
     3122    10362    3               J = VM_HEADER.DELIVERY_DATE; /* switch for addentry */
     3123    10363    3               VM_HEADER.DELIVERY_DATE = HEADTEMP.DELIVERY_DATE;
     3124    10364    3               CALL VOM$ADDENTRY_SORTED(PTR$,%NO#,TIME_HEAD$,DCBNUM(CREATE_DCB));
     3125    10365    3               VM_HEADER.DELIVERY_DATE = J;
     3126    10366    3               CALL M$CLOSE (CLOSE_SEND) ALTRET(WHO_CARES);
     3127    10367    3           CASE (%VO_SEND_FID#);
     3128    10368    3               CALL M$TIME(GET_CURRENT);
     3129    10369    3               CALL BINCHAR(SEND_STRING, CURRENT_TIME);
     3130    10370    3               CALL CONCAT(SEND_NAME.NAME#,':MESS',SEND_STRING);
     3131    10371    3               SEND_NAME.L# = SIZEC(SEND_NAME.NAME#);
     3132    10372    3               CREATE_SEND.V.FUN# = %CREATE#;
     3133    10373    3               CALL M$OPEN(CREATE_SEND) ALTRET(BUILD_ERROR);
     3134    10374    3               CALL M$CLOSE(CLOSE_SEND) ALTRET(BUILD_ERROR);
     3135    10375    3               VM_CGBUFFER.FILE_NAME = SEND_NAME;
     3136    10376    3               VM_CGBUFFER.COMMAND = %VO_BUILD_SEND#;
     3137    10377    3               OUTSTATION.STATION# = VM_CGBUFFER.STATION#;
     3138    10378    3               CALL M$WRITE(WRITE_MAILCG) ALTRET(BUILD_ERROR);
     3139    10379    4               DO WHILE(%NO#);
     3140    10380    4   BUILD_ERROR:    ;
     3141    10381    4                   VM_CGBUFFER.COMMAND = %VO_CREATE_ERROR#;
     3142    10382    4                   VM_CGBUFFER.ERROR = B$TCB.ALT$ -> B$ALT.ERR;
     3143    10383    4                   OUTSTATION.STATION# = VM_CGBUFFER.STATION#;
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:505  
     3144    10384    5                   CALL M$WRITE(WRITE_MAILCG) WHENALTRETURN DO;
     3145    10385    5                   END;
     3146    10386    4               END;             /* Do while */
     3147    10387    3           CASE(ELSE);
     3148    10388                                 /* Send writes with VO_DUMMY to see if mailman is up */
     3149    10389    3           END;                   /* End do case */
     3150    10390    2   CONTINUE: ;
     3151    10391    2       END;                       /* End not au event */
     3152    10392    1   WHO_CARES:;
     3153    10393    1       RETURN;
     3154    10394
     3155    10395    1   BAD_OPEN:;
     3156    10396    1       CALL M$CLOSE (CLOSE_CREATE_REL) ALTRET(WHO_CARES);
     3157    10397    1       GOTO CONTINUE;
     3158    10398
     3159    10399    1   END VOM$PROCESS;
     3160    10400        %EOD;

PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:506  
--  Include file information  --

   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   VO_SUBS_C.:VMB6TOU  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VOM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
      No diagnostics issued in procedure VOM$PROCESS.

   Procedure VOM$PROCESS requires 150 words for executable code.
   Procedure VOM$PROCESS requires 56 words of local(AUTO) storage.

PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:507  

 Object Unit name= VOM$PROCESS                                File name= VOM$MAILMAN.:VMB6TOU
 UTS= AUG 20 '97 15:34:54.32 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$MAIL_FILE
    2   DCB   even  none     0      0  M$MAIL_CENTRAL
    3   DCB   even  none     0      0  M$MAIL_GLOBAL
    4   DCB   even  none     0      0  M$WORK
    5   DCB   even  none     0      0  M$MAIL_COMGROUP
    6   DCB   even  none     0      0  M$DO
    7   DCB   even  none     0      0  M$LO
    8   DCB   even  none     0      0  M$ME
    9   DCB   even  none     0      0  M$NODE
   10   DCB   even  none     0      0  M$SI
   11   Data  even  none   155    233  VOM$PROCESS
   12  RoData even  UTS     36     44  VOM$PROCESS
   13   DCB   even  none     0      0  CREATE_DCB
   14   Proc  even  none   150    226  VOM$PROCESS
   15  RoData even  none     5      5  VOM$PROCESS

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    14      0   yes            yes      Std        0  VOM$PROCESS
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:508  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       4 VOM$ADDENTRY_SORTED
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  VM_CGBUFFER                           VO_BNWIO
     STATION#                              VO_INTERSYS_ALLOWED                   TIME_HEAD$
     TIME$                                 INTERSYS_HEAD$                        INTERSYS$
r    VO_BUSY_RETRY_MINUTES            r    VO_PACKSET_RETRY_MINUTES         r    VO_MAX_HOLD_HOURS
r    VO_HOG_LIMIT                          VO_MAILMAN_STARTUP_TIME               VO_INTERSYS_PASSWORD
     VO_INTERSYS_EPASS                     VO_INTERSYS_ACCT                      VO_INTERSYS_UNAME
     VO_RETRY_LIMIT_INTERSYSTEM       r    VM_HEADER$                       r    VM_PROFILE$
r    VM_ADDLIST$                      r    VM_ADDREC$                       r    VM_WORK$
r    VM_SELECT$                       r    VM_PARSEAREA$                    r    VM_INPUT$
r    VM_COPY$                              VM_ENCLLIST$                          VM_ENCLREC$
     VM_HEADER_                            VM_HEADER_INIT_                       VM_PROFILE_
     VM_ADDLIST_                           VM_ADDREC_                            VM_WORK_
     VM_SELECT_                            VM_PARSEAREA_                         VM_INPUT_
     VM_COPY_                              VM_ENCLLIST_                          VM_ENCLREC_
     M$MAIL_FILE                           M$MAIL_CENTRAL                        M$MAIL_GLOBAL
     M$WORK                                M$MAIL_COMGROUP                       M$DO
     M$LO                                  M$ME                                  M$NODE
     M$SI                                  M$MAIL_FILE_NUM                       M$MAIL_CENTRAL_NUM
     M$MAIL_GLOBAL_NUM                     M$WORK_NUM                            M$MAIL_COMGROUP_NUM
     M$DO_NUM                              M$ME_NUM                              M$LO_NUM
     M$SI_NUM                              M$NODE_NUM                       r    B$JIT$
r    B$TCB$                                VM_MAIL_ACCT                          VM_NAME_MAP_NAME
     ERRMSG_FID                            VM_SEND_FILE_NAME                     VM_FORWARD_FILE_NAME
     VM_FORWARD_ENCL_NAME                  VM_FORWARD_FILE_PASS                  VM_MAILCG_NAME
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:509  
     VM_SITENAME                           VM_MAILCG_SETSTA                      MAIL_NAME
     OUTSTATION                            WRITE_MAILCG                          CREATE_DCB
     VO_PROCESS                            VO_NEED_READ

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:510  


     2996        1        /*T***********************************************************/
     2997        2        /*T*                                                         */
     2998        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2999        4        /*T*                                                         */
     3000        5        /*T***********************************************************/
     3001        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
     3002        7        VOM$PROCESS: PROC;

      7 14 000000   000000 700200 xent  VOM$PROCESS  TSX0  ! X66_AUTO_0
        14 000001   000070 000000                    ZERO    56,0

     3003        8          %INCLUDE B_ERRORS_C;
     3004     1135          %INCLUDE CP_6_SUBS;
     3005     1675          %INCLUDE VOM_DATA_R;                  /* Also includes CP_6 */
     3006     8895          %INCLUDE VO_SUBS_C;
     3007     8946          %INCLUDE VM_DATA_R;
     3008     9377
     3009     9378        %VLP_NAME (FPTN=MAIL_NAME,STCLASS="SYMREF",LEN=31);
     3010     9405        %VLP_STATION (FPTN=OUTSTATION, STCLASS="SYMREF");
     3011     9432              %EQU_CG;
     3012     9480        %FPT_WRITE(FPTN=WRITE_MAILCG,STCLASS="SYMREF",
     3013     9481                   BUF=VM_CGBUFFER);
     3014     9512             %FPT_READ      (FPTN=READ_MAILCG,
     3015     9513                                 DCB=M$MAIL_COMGROUP,
     3016     9514                                 BUF=VM_CGBUFFER,
     3017     9515                                 EVENT = %VOM_READMAIL#,
     3018     9516             WAIT=NO);
     3019     9555             %B$TCB (STCLASS="BASED(B$TCB$)");
     3020     9558
     3021     9559             %B$ALT;
     3022     9567             %VLP_ERRCODE (FPTN=ERROR);
     3023     9612              %FPT_OPEN(FPTN=CREATE_SEND,ACS=DIRECT,
     3024     9613              ASN=FILE,
     3025     9614              ACCT=VM_MAIL_ACCT,
     3026     9615              ACCESS=SEND_ACCESS,
     3027     9616              ACSVEH=SEND_ACSVEH,
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:511  
     3028     9617              NAME=SEND_NAME,
     3029     9618              SCRUB=YES,
     3030     9619              ORG=KEYED,
     3031     9620              DCB=CREATE_DCB,
     3032     9621              FUN=CREATE,
     3033     9622              EXIST=ERROR);
     3034     9731
     3035     9732          %VLP_ATTR (FPTN=SEND_ACCESS);
     3036     9746          %VLP_ACCESS (NOLIST=YES,EXEC=YES,LAST=";");
     3037     9763
     3038     9764              %VLP_ATTR (FPTN=SEND_ACSVEH);
     3039     9778          %VLP_ACSVEH (READ=YES,UPD=YES,WNEW=YES,DELR=YES,VEHICLE='SEND_TEST');
     3040     9795              %VLP_ACSVEH (READ=YES,UPD=YES,WNEW=YES,DELR=YES,VEHICLE='SEND',LAST=";");
     3041     9812
     3042     9813              %VLP_NAME (FPTN=SEND_NAME,LEN=25,NAME='                         ');
     3043     9840
     3044     9841          %FPT_CLOSE(FPTN=CLOSE_SEND,DCB=CREATE_DCB,DISP=SAVE);
     3045     9883
     3046     9884        %FPT_CLOSE (FPTN=CLOSE_CREATE_REL, STCLASS=CONSTANT,
     3047     9885                  DISP=RELEASE,
     3048     9886                  DCB=CREATE_DCB);
     3049     9928
     3050     9929          %VM_HEADER;
     3051    10058        %VM_HEADER (NAME=HEADTEMP, STCLASS=AUTO);
     3052    10187        %VM_KEYTYPES;
     3053    10208        %VM_INFOKEY (NAME=HEADKEY,TYP=%VM_TYPE_HEAD,STCLASS=CONSTANT);
     3054    10225        %FPT_READ (FPTN=READHEAD, STCLASS=STATIC,
     3055    10226                  DCB=CREATE_DCB,
     3056    10227                  KEY=HEADKEY,
     3057    10228                  KEYS=YES);
     3058    10267
     3059    10268          %FPT_TIME (FPTN=GET_CURRENT,
     3060    10269                         SOURCE=CLOCK,
     3061    10270                         DEST=UTS,
     3062    10271                         TSTAMP=CURRENT_TIME);
     3063    10290
     3064    10291          %FPT_XCON (FPTN=RESET_XCON);
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:512  
     3065    10305
     3066    10306    1   DCL CURRENT_TIME UBIN WORD STATIC;
     3067    10307    1   DCL J UBIN;
     3068    10308    1   DCL CREATE_DCB DCB;
     3069    10309    1   DCL PTR$ PTR;
     3070    10310    1   DCL I SBIN WORD;
     3071    10311    1   DCL SEND_STRING CHAR(20);
     3072    10312    1   DCL VMD$GET_HEADER ENTRY(2) ALTRET;
     3073    10313    1   DCL VOM$ADDENTRY  ENTRY(4);
     3074    10314    1   DCL VOM$ADDENTRY_SORTED ENTRY(4);
     3075    10315    1   DCL VOM$DELENTRY ENTRY(3);
     3076    10316    1   DCL NOTIFY$MAILCG ENTRY(1);
     3077    10317    1   DCL FIND$FOLDER ENTRY(4) ALTRET;
     3078    10318    1   DCL SAVE$ PTR ALIGNED;
     3079    10319    1   DCL VOM$DOSEND ENTRY(1);
     3080    10320    1   DCL ANOTHER_USER BIT(1) ALIGNED;
     3081    10321    1   DCL VO_PROCESS BIT(1) SYMREF;
     3082    10322    1   DCL VO_NEED_READ BIT(1) SYMREF;
     3083    10323
     3084    10324    1       VO_PROCESS = '0'B;

  10324 14 000002   000000 450000 xsym               STZ     VO_PROCESS

     3085    10325    1       VO_NEED_READ = '1'B;

  10325 14 000003   400000 236003                    LDQ     -131072,DU
        14 000004   000000 756000 xsym               STQ     VO_NEED_READ

     3086    10326
     3087    10327
     3088    10328
     3089    10329    1       IF VO_BNWIO.CGPARM.MSGTYP# = '*AUEV' /* Admin event */

  10329 14 000005   040000 106400                    CMPC    fill='040'O
        14 000006   000111 000010 xsym               ADSC9   VO_BNWIO+73              cn=0,n=8
        14 000007   000040 000005 12                 ADSC9   HEADKEY+2                cn=0,n=5
        14 000010   000012 601000 14                 TNZ     s:10335
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:513  

     3090    10330    1       THEN
     3091    10331    2       DO;

     3092    10332    2       END;

  10332 14 000011   000220 710000 14                 TRA     CONTINUE

     3093    10333    1       ELSE
     3094    10334    2       DO;

     3095    10335    3           DO CASE (VM_CGBUFFER.COMMAND); /* Do particular function */

  10335 14 000012   000002 235000 xsym               LDA     VM_CGBUFFER+2
        14 000013   000004 135007                    SBLA    4,DL
        14 000014   000010 115007                    CMPA    8,DL
        14 000015   000017 602005 14                 TNC     s:10335+5,AL
        14 000016   000220 710000 14                 TRA     CONTINUE
        14 000017   000036 710000 14                 TRA     s:10343
        14 000020   000131 710000 14                 TRA     s:10368
        14 000021   000220 710000 14                 TRA     CONTINUE
        14 000022   000220 710000 14                 TRA     CONTINUE
        14 000023   000220 710000 14                 TRA     CONTINUE
        14 000024   000220 710000 14                 TRA     CONTINUE
        14 000025   000220 710000 14                 TRA     CONTINUE
        14 000026   000027 710000 14                 TRA     s:10338

     3096    10336
     3097    10337    3           CASE(%VO_KILL_MAILMAN#);

     3098    10338    3               CALL M$XCON (RESET_XCON) ALTRET(E_XCON);

  10338 14 000027   000224 630400 11                 EPPR0   RESET_XCON
        14 000030   410003 713400                    CLIMB   alt,+4099
        14 000031   400400 401760                    pmme    nvectors=2
        14 000032   000033 702000 14                 TSX2    E_XCON

PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:514  
     3099    10339    3   E_XCON:
     3100    10340    3               CALL M$XXX;

  10340 14 000033   000003 713400       E_XCON       CLIMB   3
        14 000034   000000 401760                    pmme    nvectors=0
        14 000035   000220 710000 14                 TRA     CONTINUE

     3101    10341    3           CASE (%VO_SEND#);

     3102    10342
     3103    10343    3               SEND_NAME = VM_CGBUFFER.FILE_NAME;

  10343 14 000036   000000 100400                    MLR     fill='000'O
        14 000037   000022 000032 xsym               ADSC9   VM_CGBUFFER+18           cn=0,n=26
        14 000040   000124 000032 11                 ADSC9   SEND_NAME                cn=0,n=26

     3104    10344    3               CREATE_SEND.V.FUN# = %IN#;

  10344 14 000041   002000 236007                    LDQ     1024,DL
        14 000042   000065 552010 11                 STBQ    CREATE_SEND+37,'10'O

     3105    10345    3               CALL M$OPEN (CREATE_SEND) ALTRET(BAD_OPEN);

  10345 14 000043   000020 630400 11                 EPPR0   CREATE_SEND
        14 000044   450000 713400                    CLIMB   alt,open
        14 000045   410400 401760                    pmme    nvectors=18
        14 000046   000221 702000 14                 TSX2    BAD_OPEN

     3106    10346    3               READHEAD.BUF_ = VECTOR(HEADTEMP);

  10346 14 000047   000000 235000 15                 LDA     0
        14 000050   200062 452500                    STP2    ANOTHER_USER+1,,AUTO
        14 000051   200062 236100                    LDQ     ANOTHER_USER+1,,AUTO
        14 000052   000003 036003                    ADLQ    3,DU
        14 000053   000176 757000 11                 STAQ    READHEAD+4

     3107    10347    4               CALL M$READ (READHEAD) WHENALTRETURN DO;
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:515  

  10347 14 000054   000172 630400 11                 EPPR0   READHEAD
        14 000055   440000 713400                    CLIMB   alt,read
        14 000056   401400 401760                    pmme    nvectors=4
        14 000057   000061 702000 14                 TSX2    s:10348
        14 000060   000067 710000 14                 TRA     s:10356

     3108    10348    4                   IF B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$LD THEN GOTO BAD_OPEN;

  10348 14 000061   000000 470400 xsym               LDP0    B$TCB$
        14 000062   000000 471500                    LDP1    0,,PR0
        14 000063   100102 236100                    LDQ     66,,PR1
        14 000064   377770 376007                    ANQ     131064,DL
        14 000065   000070 116007                    CMPQ    56,DL
        14 000066   000221 601000 14                 TNZ     BAD_OPEN

     3109    10349    4               END;

     3110    10350        /*
     3111    10351             ***** If no delivery time was specified,
     3112    10352                   then deliver as soon as possible.
     3113    10353                   Therefore, this entry must be added
     3114    10354                   to the time queue with the current time ...
     3115    10355        */
     3116    10356    3               IF HEADTEMP.DELIVERY_DATE = 0

  10356 14 000067   200005 235100                    LDA     HEADTEMP+2,,AUTO
        14 000070   000076 601000 14                 TNZ     s:10362

     3117    10357    3               THEN
     3118    10358    4               DO;

     3119    10359    4                   CALL M$TIME (GET_CURRENT);

  10359 14 000071   000210 630400 11                 EPPR0   GET_CURRENT
        14 000072   020004 713400                    CLIMB   8196
        14 000073   402000 401760                    pmme    nvectors=5
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:516  

     3120    10360    4                   HEADTEMP.DELIVERY_DATE = CURRENT_TIME;

  10360 14 000074   000232 235000 11                 LDA     CURRENT_TIME
        14 000075   200005 755100                    STA     HEADTEMP+2,,AUTO

     3121    10361    4               END;

     3122    10362    3               J = VM_HEADER.DELIVERY_DATE; /* switch for addentry */

  10362 14 000076   000000 470400 xsym               LDP0    VM_HEADER$
        14 000077   000002 235100                    LDA     2,,PR0
        14 000100   200050 755100                    STA     J,,AUTO

     3123    10363    3               VM_HEADER.DELIVERY_DATE = HEADTEMP.DELIVERY_DATE;

  10363 14 000101   200005 236100                    LDQ     HEADTEMP+2,,AUTO
        14 000102   000002 756100                    STQ     2,,PR0

     3124    10364    3               CALL VOM$ADDENTRY_SORTED(PTR$,%NO#,TIME_HEAD$,DCBNUM(CREATE_DCB));

  10364 14 000103   000000 236007 xsym               LDQ     CREATE_DCB,DL
        14 000104   200062 756100                    STQ     ANOTHER_USER+1,,AUTO
        14 000105   200062 631500                    EPPR1   ANOTHER_USER+1,,AUTO
        14 000106   200067 451500                    STP1    ANOTHER_USER+6,,AUTO
        14 000107   000003 236000 15                 LDQ     3
        14 000110   200066 756100                    STQ     ANOTHER_USER+5,,AUTO
        14 000111   000004 236000 15                 LDQ     4
        14 000112   200065 756100                    STQ     ANOTHER_USER+4,,AUTO
        14 000113   200051 633500                    EPPR3   PTR$,,AUTO
        14 000114   200064 453500                    STP3    ANOTHER_USER+3,,AUTO
        14 000115   200064 630500                    EPPR0   ANOTHER_USER+3,,AUTO
        14 000116   000001 631400 15                 EPPR1   1
        14 000117   000000 701000 xent               TSX1    VOM$ADDENTRY_SORTED
        14 000120   000000 011000                    NOP     0

     3125    10365    3               VM_HEADER.DELIVERY_DATE = J;
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:517  

  10365 14 000121   000000 470400 xsym               LDP0    VM_HEADER$
        14 000122   200050 235100                    LDA     J,,AUTO
        14 000123   000002 755100                    STA     2,,PR0

     3126    10366    3               CALL M$CLOSE (CLOSE_SEND) ALTRET(WHO_CARES);

  10366 14 000124   000134 630400 11                 EPPR0   CLOSE_SEND
        14 000125   450001 713400                    CLIMB   alt,close
        14 000126   406000 401760                    pmme    nvectors=13
        14 000127   000220 702000 14                 TSX2    CONTINUE
        14 000130   000220 710000 14                 TRA     CONTINUE

     3127    10367    3           CASE (%VO_SEND_FID#);

     3128    10368    3               CALL M$TIME(GET_CURRENT);

  10368 14 000131   000210 630400 11                 EPPR0   GET_CURRENT
        14 000132   020004 713400                    CLIMB   8196
        14 000133   402000 401760                    pmme    nvectors=5

     3129    10369    3               CALL BINCHAR(SEND_STRING, CURRENT_TIME);

  10369 14 000134   000232 235000 11                 LDA     CURRENT_TIME
        14 000135   000044 773000                    LRL     36
        14 000136   200062 757100                    STAQ    ANOTHER_USER+1,,AUTO
        14 000137   000100 301500                    BTD
        14 000140   200062 000010                    NDSC9   ANOTHER_USER+1,,AUTO     cn=0,s=lsgnf,sf=0,n=8
        14 000141   200053 030024                    NDSC9   SEND_STRING,,AUTO        cn=0,s=nosgn,sf=0,n=20

     3130    10370    3               CALL CONCAT(SEND_NAME.NAME#,':MESS',SEND_STRING);

  10370 14 000142   040000 100400                    MLR     fill='040'O
        14 000143   000042 000005 12                 ADSC9   HEADKEY+4                cn=0,n=5
        14 000144   000124 200005 11                 ADSC9   SEND_NAME                cn=1,n=5
        14 000145   040000 100500                    MLR     fill='040'O
        14 000146   200053 000024                    ADSC9   SEND_STRING,,AUTO        cn=0,n=20
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:518  
        14 000147   000125 400024 11                 ADSC9   SEND_NAME+1              cn=2,n=20

     3131    10371    3               SEND_NAME.L# = SIZEC(SEND_NAME.NAME#);

  10371 14 000150   031000 236003                    LDQ     12800,DU
        14 000151   000124 552040 11                 STBQ    SEND_NAME,'40'O

     3132    10372    3               CREATE_SEND.V.FUN# = %CREATE#;

  10372 14 000152   003000 236007                    LDQ     1536,DL
        14 000153   000065 552010 11                 STBQ    CREATE_SEND+37,'10'O

     3133    10373    3               CALL M$OPEN(CREATE_SEND) ALTRET(BUILD_ERROR);

  10373 14 000154   000020 630400 11                 EPPR0   CREATE_SEND
        14 000155   450000 713400                    CLIMB   alt,open
        14 000156   410400 401760                    pmme    nvectors=18
        14 000157   000201 702000 14                 TSX2    BUILD_ERROR

     3134    10374    3               CALL M$CLOSE(CLOSE_SEND) ALTRET(BUILD_ERROR);

  10374 14 000160   000134 630400 11                 EPPR0   CLOSE_SEND
        14 000161   450001 713400                    CLIMB   alt,close
        14 000162   406000 401760                    pmme    nvectors=13
        14 000163   000201 702000 14                 TSX2    BUILD_ERROR

     3135    10375    3               VM_CGBUFFER.FILE_NAME = SEND_NAME;

  10375 14 000164   000000 100400                    MLR     fill='000'O
        14 000165   000124 000032 11                 ADSC9   SEND_NAME                cn=0,n=26
        14 000166   000022 000040 xsym               ADSC9   VM_CGBUFFER+18           cn=0,n=32

     3136    10376    3               VM_CGBUFFER.COMMAND = %VO_BUILD_SEND#;

  10376 14 000167   000006 235007                    LDA     6,DL
        14 000170   000002 755000 xsym               STA     VM_CGBUFFER+2

PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:519  
     3137    10377    3               OUTSTATION.STATION# = VM_CGBUFFER.STATION#;

  10377 14 000171   040000 100400                    MLR     fill='040'O
        14 000172   000000 000010 xsym               ADSC9   VM_CGBUFFER              cn=0,n=8
        14 000173   000000 000010 xsym               ADSC9   OUTSTATION               cn=0,n=8

     3138    10378    3               CALL M$WRITE(WRITE_MAILCG) ALTRET(BUILD_ERROR);

  10378 14 000174   000000 630400 xsym               EPPR0   WRITE_MAILCG
        14 000175   440001 713400                    CLIMB   alt,write
        14 000176   401400 401760                    pmme    nvectors=4
        14 000177   000201 702000 14                 TSX2    BUILD_ERROR

     3139    10379    4               DO WHILE(%NO#);

  10379 14 000200   000220 710000 14                 TRA     CONTINUE

  10378 14 000201                       BUILD_ERROR  null
     3140    10380    4   BUILD_ERROR:    ;
     3141    10381    4                   VM_CGBUFFER.COMMAND = %VO_CREATE_ERROR#;

  10381 14 000201   000007 235007                    LDA     7,DL
        14 000202   000002 755000 xsym               STA     VM_CGBUFFER+2

     3142    10382    4                   VM_CGBUFFER.ERROR = B$TCB.ALT$ -> B$ALT.ERR;

  10382 14 000203   000000 470400 xsym               LDP0    B$TCB$
        14 000204   000000 471500                    LDP1    0,,PR0
        14 000205   100102 236100                    LDQ     66,,PR1
        14 000206   000032 756000 xsym               STQ     VM_CGBUFFER+26

     3143    10383    4                   OUTSTATION.STATION# = VM_CGBUFFER.STATION#;

  10383 14 000207   040000 100400                    MLR     fill='040'O
        14 000210   000000 000010 xsym               ADSC9   VM_CGBUFFER              cn=0,n=8
        14 000211   000000 000010 xsym               ADSC9   OUTSTATION               cn=0,n=8

PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:520  
     3144    10384    5                   CALL M$WRITE(WRITE_MAILCG) WHENALTRETURN DO;

  10384 14 000212   000000 630400 xsym               EPPR0   WRITE_MAILCG
        14 000213   440001 713400                    CLIMB   alt,write
        14 000214   401400 401760                    pmme    nvectors=4
        14 000215   000217 702000 14                 TSX2    s:10386
        14 000216   000217 710000 14                 TRA     s:10386

     3145    10385    5                   END;

     3146    10386    4               END;             /* Do while */

  10386 14 000217   000220 710000 14                 TRA     CONTINUE

     3147    10387    3           CASE(ELSE);

     3148    10388                                 /* Send writes with VO_DUMMY to see if mailman is up */
     3149    10389    3           END;                   /* End do case */

  10387 14 000220                       CONTINUE     null
     3150    10390    2   CONTINUE: ;
     3151    10391    2       END;                       /* End not au event */

  10383 14 000220                       WHO_CARES    null
     3152    10392    1   WHO_CARES:;
     3153    10393    1       RETURN;

  10393 14 000220   000000 702200 xent               TSX2  ! X66_ARET

  10383 14 000221                       BAD_OPEN     null
     3154    10394
     3155    10395    1   BAD_OPEN:;
     3156    10396    1       CALL M$CLOSE (CLOSE_CREATE_REL) ALTRET(WHO_CARES);

  10396 14 000221   000000 630400 12                 EPPR0   CLOSE_CREATE_REL
        14 000222   450001 713400                    CLIMB   alt,close
        14 000223   406000 401760                    pmme    nvectors=13
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:521  
        14 000224   000220 702000 14                 TSX2    CONTINUE

     3157    10397    1       GOTO CONTINUE;

  10397 14 000225   000220 710000 14                 TRA     CONTINUE

READ_MAILCG
 Sect OctLoc
  11     000   000005 777640   000010 006000   000000 177640   000000 006014    ................
  11     004   000043 777640   000000 006000   000000 177640   000000 006014    .#..............
  11     010   000000 000000   000000 000001   000000 000000   000000 000000    ................
  11     014   000000 000000   000000 000000                                    ........

ERROR
 Sect OctLoc
  11     016   000000 000000                                                    ....

CREATE_SEND
 Sect OctLoc
  11     020   000025 777640   000064 006000   000000 177640   000000 006014    .....4..........
  11     024   000000 177640   000000 006014   000006 377640   000124 006000    .............T..
  11     030   000000 177640   000000 006014   000003 777640   000112 006000    .............J..
  11     034   000005 777640   000116 006000   000000 177640   000000 006014    .....N..........
  11     040   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11     044   000001 777640   000000 006000   000000 177640   000000 006014    ................
  11     050   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11     064*  000000 400242   000000 003001   252525 002002   000040 252520    ............. ..
  11     070   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
  11     074   000000 000000   000000 000000   000000 000000   000000 000000    ................
  11     100   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
  11     104   040040 040040   000000 000000   000000 000000   000000 000000        ............
  11     110   000000 000000   ****** ******                                    ........

SEND_ACCESS
 Sect OctLoc
  11     112   000000 000003   012000 040040   040040 040040   040040 ******    ......        ..

PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:522  
SEND_ACSVEH
 Sect OctLoc
  11     116   000000 000005   740000 011123   105116 104137   124105 123124    .......SEND_TEST
  11     122   740000 004123   105116 104***                                    ...SEND.

SEND_NAME
 Sect OctLoc
  11     124   031040 040040   040040 040040   040040 040040   040040 040040    .
  11     130   040040 040040   040040 040040   040040 ******                              ..

CLOSE_SEND
 Sect OctLoc
  11     134   000003 777640   000166 006000   000000 177640   000000 006014    .....v..........
  11     140   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11     164*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
  11     170   000220 000000   000000 000000                                    ........

READHEAD
 Sect OctLoc
  11     172   000005 777640   000202 006000   000001 377640   000036 006000    ................
  11     176   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11     202   000000 600000   000000 000000   000000 000000   000000 000000    ................
  11     206   000000 000000   000000 000000                                    ........

GET_CURRENT
 Sect OctLoc
  11     210   000001 777640   000222 006000   000000 177640   000000 006014    ................
  11     214   000000 177640   000000 006014   000000 177640   000000 006014    ................
  11     220   000000 777640   000232 006000   000004 000000   ****** ******    ................

RESET_XCON
 Sect OctLoc
  11     224   000001 777640   000230 006000   000000 177640   000000 006014    ................
  11     230   000000 000000   000000 000000                                    ........

CLOSE_CREATE_REL
 Sect OctLoc
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:523  
  12     000   000003 777640   000032 006000   000000 177640   000000 006014    ................
  12     004   000000 177640   000000 006014   000000 177640   000000 006014    ................
  12     030*  000000 177640   000000 006014   000000 000001   000000 000040    ...............
  12     034   000220 000000   000000 000000                                    ........

HEADKEY
 Sect OctLoc
  12     036   005010 000000   000000 ******                                    ........

(unnamed)
 Sect OctLoc
  12     040   052101 125105   126040 040040   072115 105123   123040 040040    *AUEV   :MESS

(unnamed)
 Sect OctLoc
  15     000   000044 777640   000004 000000   000000 000000   000000 006000    .$..............
  15     004   000002 006000                                                    ....
     3158    10398
     3159    10399    1   END VOM$PROCESS;
     3160    10400        %EOD;

PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:524  
--  Include file information  --

   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   VO_SUBS_C.:VMB6TOU  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VOM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
      No diagnostics issued in procedure VOM$PROCESS.
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:525  

 **** Variables and constants ****

  ****  Section 011  Data  VOM$PROCESS

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   134-0-0/d STRC(1080)  r     1 CLOSE_SEND                20-0-0/d STRC(2088)  r     1 CREATE_SEND
   232-0-0/w UBIN        r     1 CURRENT_TIME              16-0-0/w STRC              1 ERROR
   210-0-0/d STRC(432)   r     1 GET_CURRENT              172-0-0/d STRC(504)   r     1 READHEAD
     0-0-0/d STRC(504)   r     1 READ_MAILCG              224-0-0/d STRC(216)   r     1 RESET_XCON
   112-0-0/w STRC(126)   r     1 SEND_ACCESS              116-0-0/w STRC(207)   r     1 SEND_ACSVEH
   124-0-0/c STRC(234)   r     1 SEND_NAME

  ****  Section 012 RoData VOM$PROCESS

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(1080)  r     1 CLOSE_CREATE_REL          36-0-0/c STRC(54)    r     1 HEADKEY

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    61-0-0/w BIT               1 ANOTHER_USER               3-0-0/w STRC(1332)  r     1 HEADTEMP
    52-0-0/w SBIN              1 I                         50-0-0/w UBIN        r     1 J
    51-0-0/w PTR         r     1 PTR$                      60-0-0/w PTR               1 SAVE$
    53-0-0/c CHAR(20)    r     1 SEND_STRING

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR               1 B$JIT$                     0-0-0/w PTR         r     1 B$TCB$
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:526  
     0-0-0/c ASTR(9)     r     1 ERRMSG_FID                 0-0-0/w PTR         r     1 INTERSYS$
     0-0-0/w PTR               1 INTERSYS_HEAD$             0-0-0/w UBIN              1 M$DO_NUM
     0-0-0/w UBIN              1 M$LO_NUM                   0-0-0/w UBIN              1 M$MAIL_CENTRAL_NUM
     0-0-0/w UBIN              1 M$MAIL_COMGROUP_NUM        0-0-0/w UBIN              1 M$MAIL_FILE_NUM
     0-0-0/w UBIN              1 M$MAIL_GLOBAL_NUM          0-0-0/w UBIN              1 M$ME_NUM
     0-0-0/w UBIN              1 M$NODE_NUM                 0-0-0/w UBIN              1 M$SI_NUM
     0-0-0/w UBIN              1 M$WORK_NUM                 0-0-0/c STRC(288)         1 MAIL_NAME
     0-0-0/w STRC(288)   r     1 OUTSTATION                 0-0-0/c CHAR(8)           1 STATION#
     0-0-0/w PTR         r     1 TIME$                      0-0-0/w PTR         r     1 TIME_HEAD$
     0-0-0/w PTR               1 VM_ADDLIST$                0-0-0/d VECT              1 VM_ADDLIST_
     0-0-0/w PTR               1 VM_ADDREC$                 0-0-0/d VECT              1 VM_ADDREC_
     0-0-0/c STRC(1296)  r     1 VM_CGBUFFER                0-0-0/w PTR               1 VM_COPY$
     0-0-0/d VECT              1 VM_COPY_                   0-0-0/w PTR               1 VM_ENCLLIST$
     0-0-0/d VECT              1 VM_ENCLLIST_               0-0-0/w PTR               1 VM_ENCLREC$
     0-0-0/d VECT              1 VM_ENCLREC_                0-0-0/c STRC(270)         1 VM_FORWARD_ENCL_NAME
     0-0-0/c STRC(270)         1 VM_FORWARD_FILE_NAME       0-0-0/c STRC(72)          1 VM_FORWARD_FILE_PASS
     0-0-0/w PTR         r     1 VM_HEADER$                 0-0-0/d VECT              1 VM_HEADER_
     0-0-0/d VECT              1 VM_HEADER_INIT_            0-0-0/w PTR               1 VM_INPUT$
     0-0-0/d VECT              1 VM_INPUT_                  0-0-0/c STRC(72)          1 VM_MAILCG_NAME
     0-0-0/w STRC(432)         1 VM_MAILCG_SETSTA           0-0-0/c STRC(72)    r     1 VM_MAIL_ACCT
     0-0-0/c STRC(54)          1 VM_NAME_MAP_NAME           0-0-0/w PTR               1 VM_PARSEAREA$
     0-0-0/d VECT              1 VM_PARSEAREA_              0-0-0/w PTR               1 VM_PROFILE$
     0-0-0/d VECT              1 VM_PROFILE_                0-0-0/w PTR               1 VM_SELECT$
     0-0-0/d VECT              1 VM_SELECT_                 0-0-0/c STRC(288)         1 VM_SEND_FILE_NAME
     0-0-0/c CHAR(8)           1 VM_SITENAME                0-0-0/w PTR               1 VM_WORK$
     0-0-0/d VECT              1 VM_WORK_                   0-0-0/w STRC(2880)  r     1 VO_BNWIO
     0-0-0/w UBIN              1 VO_BUSY_RETRY_MINUTES
     0-0-0/w UBIN              1 VO_HOG_LIMIT               0-0-0/c CHAR(8)           1 VO_INTERSYS_ACCT
     0-0-0/b BIT               1 VO_INTERSYS_ALLOWED        0-0-0/c CHAR(12)          1 VO_INTERSYS_EPASS
     0-0-0/c CHAR(8)           1 VO_INTERSYS_PASSWORD       0-0-0/c CHAR(8)           1 VO_INTERSYS_UNAME
     0-0-0/w UBIN              1 VO_MAILMAN_STARTUP_TIME
     0-0-0/w UBIN              1 VO_MAX_HOLD_HOURS          0-0-0/b BIT         r     1 VO_NEED_READ
     0-0-0/w UBIN              1 VO_PACKSET_RETRY_MINUTES
     0-0-0/b BIT         r     1 VO_PROCESS
     0-0-0/w UBIN              1 VO_RETRY_LIMIT_INTERSYSTEM
     0-0-0/d STRC(432)   r     1 WRITE_MAILCG

PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:527  
  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0N  NULL        r     1 CREATE_DCB                 0-0-0/w STRC(540)         1 INTERSYS_INFO
     0-0-0N  NULL        r     1 M$DO                       0-0-0N  NULL        r     1 M$LO
     0-0-0N  NULL        r     1 M$MAIL_CENTRAL             0-0-0N  NULL        r     1 M$MAIL_COMGROUP
     0-0-0N  NULL        r     1 M$MAIL_FILE                0-0-0N  NULL        r     1 M$MAIL_GLOBAL
     0-0-0N  NULL        r     1 M$ME                       0-0-0N  NULL        r     1 M$NODE
     0-0-0N  NULL        r     1 M$SI                       0-0-0N  NULL        r     1 M$UC
     0-0-0N  NULL        r     1 M$WORK                     0-0-0/w STRC(612)         1 TIME_TABLE
     0-0-0/w STRC(1332)  r     1 VM_HEADER                  0-0-0/c ASTR(9)     r     1 X$STRING


   Procedure VOM$PROCESS requires 150 words for executable code.
   Procedure VOM$PROCESS requires 56 words of local(AUTO) storage.
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:528  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:529  
          MINI XREF LISTING

B$ALT.CODE
      9561**DCL      9561--REDEF    9562--REDEF    9562--REDEF
B$ALT.ERR
      9562**DCL     10382>>ASSIGN
B$ALT.ERR.CODE
      9563**DCL     10348>>IF
B$ALT.ERR.ERR#
      9563**DCL      9563--REDEF
B$ALT.EVID
      9562**DCL      9562--REDEF    9562--REDEF
B$TCB.ALT$
      9556**DCL     10348>>IF      10382>>ASSIGN
B$TCB$
      9154**DCL      9556--IMP-PTR 10348>>IF      10382>>ASSIGN
BAD_OPEN
     10383**LABEL   10345--CALLALT 10348--GOTO
BUILD_ERROR
     10378**LABEL   10373--CALLALT 10374--CALLALT 10378--CALLALT
CLOSE_CREATE_REL
      9909**DCL     10396<>CALL
CLOSE_CREATE_REL.SN_
      9909**DCL      9909--REDEF
CLOSE_CREATE_REL.UTL_
      9910**DCL      9910--REDEF
CLOSE_CREATE_REL.V
      9914**DCL      9909--DCLINIT
CLOSE_CREATE_REL.V.EXPIRE#
      9924**DCL      9924--REDEF
CLOSE_CREATE_REL.V.TYPE#
      9922**DCL      9922--REDEF
CLOSE_CREATE_REL.V.XTNSIZE#
      9919**DCL      9919--REDEF    9921--REDEF
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:530  
CLOSE_SEND
      9864**DCL     10366<>CALL    10374<>CALL
CLOSE_SEND.SN_
      9864**DCL      9864--REDEF
CLOSE_SEND.UTL_
      9865**DCL      9865--REDEF
CLOSE_SEND.V
      9869**DCL      9864--DCLINIT
CLOSE_SEND.V.EXPIRE#
      9879**DCL      9879--REDEF
CLOSE_SEND.V.TYPE#
      9877**DCL      9877--REDEF
CLOSE_SEND.V.XTNSIZE#
      9874**DCL      9874--REDEF    9876--REDEF
CONTINUE
     10387**LABEL   10397--GOTO
CREATE_DCB
     10308**DCL     10364<>CALL
CREATE_SEND
      9687**DCL     10345<>CALL    10373<>CALL
CREATE_SEND.ACSVEH_
      9689**DCL      9690--REDEF
CREATE_SEND.ALTKEYS_
      9695**DCL      9696--REDEF    9696--REDEF
CREATE_SEND.HDR_
      9694**DCL      9695--REDEF
CREATE_SEND.TAB_
      9693**DCL      9694--REDEF
CREATE_SEND.UHL_
      9687**DCL      9688--REDEF    9688--REDEF
CREATE_SEND.V
      9696**DCL      9687--DCLINIT
CREATE_SEND.V.FSN#
      9727**DCL      9727--REDEF    9727--REDEF
CREATE_SEND.V.FUN#
      9706**DCL     10344<<ASSIGN  10372<<ASSIGN
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:531  
CREATE_SEND.WSN_
      9693**DCL      9693--REDEF
CURRENT_TIME
     10306**DCL     10286--DCLINIT 10360>>ASSIGN  10369>>CALLBLT
ERRMSG_FID.L#
      9222**DCL      9222--IMP-SIZ
E_XCON
     10340**LABEL   10338--CALLALT
GET_CURRENT
     10282**DCL     10359<>CALL    10368<>CALL
GET_CURRENT.V
     10286**DCL     10282--DCLINIT
HEADKEY
     10218**DCL     10245--DCLINIT 10246--DCLINIT
HEADTEMP
     10068**DCL     10346--ASSIGN
HEADTEMP.DELIVERY_DATE
     10073**DCL     10356>>IF      10360<<ASSIGN  10363>>ASSIGN
INTERSYS$
      8888**DCL      8893--IMP-PTR
J
     10307**DCL     10362<<ASSIGN  10365>>ASSIGN
M$CLOSE
      8699**DCL-ENT 10366--CALL    10374--CALL    10396--CALL
M$OPEN
      8699**DCL-ENT 10345--CALL    10373--CALL
M$READ
      8700**DCL-ENT 10347--CALL
M$TIME
      8766**DCL-ENT 10359--CALL    10368--CALL
M$WRITE
      8700**DCL-ENT 10378--CALL    10384--CALL
M$XCON
      8754**DCL-ENT 10338--CALL
M$XXX
      8711**DCL-ENT 10340--CALL
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:532  
OUTSTATION.MSGIDXT
      9427**DCL      9430--REDEF
OUTSTATION.STATION#
      9421**DCL     10377<<ASSIGN  10383<<ASSIGN
PTR$
     10309**DCL     10364<>CALL
READHEAD
     10245**DCL     10347<>CALL
READHEAD.BUF_
     10247**DCL     10346<<ASSIGN
READHEAD.STATION_
     10248**DCL     10249--REDEF
READHEAD.V
     10249**DCL     10245--DCLINIT
READHEAD.V.DVBYTE.REREAD#
     10260**DCL     10260--REDEF
READHEAD.V.INDX#
     10258**DCL     10258--REDEF
READ_MAILCG.STATION_
      9536**DCL      9537--REDEF
READ_MAILCG.V
      9537**DCL      9533--DCLINIT
READ_MAILCG.V.DVBYTE.REREAD#
      9548**DCL      9548--REDEF
READ_MAILCG.V.INDX#
      9546**DCL      9546--REDEF
RESET_XCON
     10302**DCL     10338<>CALL
RESET_XCON.V
     10303**DCL     10302--DCLINIT
SEND_ACCESS
      9743**DCL      9689--DCLINIT
SEND_ACCESS.Q
      9744**DCL      9743--DCLINIT
SEND_ACSVEH
      9775**DCL      9690--DCLINIT
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:533  
SEND_ACSVEH.Q
      9776**DCL      9775--DCLINIT
SEND_NAME
      9838**DCL      9688--DCLINIT 10343<<ASSIGN  10375>>ASSIGN
SEND_NAME.L#
      9838**DCL     10371<<ASSIGN
SEND_NAME.NAME#
      9838**DCL     10370<<CALLBLT 10371--ASSIGN
SEND_STRING
     10311**DCL     10369<<CALLBLT 10370>>CALLBLT
TIME$
      8887**DCL      8891--IMP-PTR
TIME_HEAD$
      8887**DCL     10364<>CALL
VM_CGBUFFER
      8781**DCL      9535--DCLINIT  9536--DCLINIT
VM_CGBUFFER.COMMAND
      8783**DCL     10335>>DOCASE  10376<<ASSIGN  10381<<ASSIGN
VM_CGBUFFER.ERROR
      8793**DCL     10382<<ASSIGN
VM_CGBUFFER.FILE_NAME
      8790**DCL     10343>>ASSIGN  10375<<ASSIGN
VM_CGBUFFER.STATION#
      8782**DCL     10377>>ASSIGN  10383>>ASSIGN
VM_HEADER.DELIVERY_DATE
      9944**DCL     10362>>ASSIGN  10363<<ASSIGN  10365<<ASSIGN
VM_HEADER$
      9072**DCL      9939--IMP-PTR 10362>>ASSIGN  10363>>ASSIGN  10365>>ASSIGN
VM_MAIL_ACCT
      9168**DCL      9692--DCLINIT
VOM$ADDENTRY_SORTED
     10314**DCL-ENT 10364--CALL
VO_BNWIO.CGPARM.MSGIDXT
      8836**DCL      8839--REDEF
VO_BNWIO.CGPARM.MSGTYP#
      8830**DCL     10329>>IF
PL6.E3A0      #005=VOM$PROCESS File=VOM$MAILMAN.:VMB6TSI                         WED 08/20/97 15:34 Page:534  
VO_BNWIO.CODE
      8805**DCL      8805--REDEF    8806--REDEF    8806--REDEF
VO_BNWIO.ERR.ERR#
      8807**DCL      8807--REDEF
VO_BNWIO.EVID
      8806**DCL      8806--REDEF    8806--REDEF
VO_NEED_READ
     10322**DCL     10325<<ASSIGN
VO_PROCESS
     10321**DCL     10324<<ASSIGN
WHO_CARES
     10383**LABEL   10366--CALLALT 10396--CALLALT
WRITE_MAILCG
      9498**DCL     10378<>CALL    10384<>CALL
WRITE_MAILCG.STATION_
      9500**DCL      9500--REDEF
WRITE_MAILCG.V.DVBYTE.VFC#
      9507**DCL      9507--REDEF
X$STRING.SIZ
      9068**DCL      9069--IMP-SIZ

PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:535  
     3161        1        /*T***********************************************************/
     3162        2        /*T*                                                         */
     3163        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     3164        4        /*T*                                                         */
     3165        5        /*T***********************************************************/
     3166        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
     3167        7        VOM$ADDENTRY: PROC (PTR$, LOGON_FLAG, CHAIN$, DCB#);
     3168        8
     3169        9          %INCLUDE VOM_DATA_R;                  /* Also includes CP_6 */
     3170     7229          %INCLUDE CP_6_SUBS;
     3171     7769          %INCLUDE VM_DATA_R;
     3172     8200          %INCLUDE VO_SUBS_C;
     3173     8251          %INCLUDE B_ERRORS_C;
     3174     9378          %F$DCB;
     3175     9435            %VM_HEADER;
     3176     9564
     3177     9565    1   DCL DCB# UBIN;
     3178     9566    1   DCL PRIOR$ PTR;
     3179     9567    1   DCL NEXT$  PTR;
     3180     9568    1   DCL X$ PTR;
     3181     9569    1   DCL PTR$ PTR;
     3182     9570    1   DCL NEW$ PTR;
     3183     9571    1   DCL LINK1$ PTR;
     3184     9572    1   DCL LINK2$ PTR;
     3185     9573    1   DCL CHAIN$ PTR;
     3186     9574    1   DCL VMA$ENLARGE_SEGMENT ENTRY(2) ALTRET;
     3187     9575    1   DCL FREE$ PTR SYMREF;
     3188     9576    1   DCL SEG$ PTR SYMREF;
     3189     9577    1   DCL MAX$ PTR SYMREF;
     3190     9578    1   DCL SAVEN$ PTR;
     3191     9579    1   DCL SAVEP$ PTR;
     3192     9580    1   DCL LOGON_FLAG BIT(1);
     3193     9581    1   DCL 1 STR BASED,
     3194     9582    1         2 NEXT$ PTR UNAL,
     3195     9583    1         2 PRIOR$ PTR UNAL,
     3196     9584    1         2 SORT_VALUE UBIN WORD UNAL;
     3197     9585
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:536  
     3198     9586    1   DCL CURR$ PTR ALIGNED;
     3199     9587
     3200     9588    1       IF FREE$ = ADDR(NIL) THEN
     3201     9589    2       DO;
     3202     9590    2           CURR$ = SEG$;
     3203     9591    2           SEG$ = PINCRW(SEG$, SIZEW(TIME_TABLE));
     3204     9592    2           SEG$->STR.NEXT$ = ADDR(NIL);
     3205     9593    2           IF PINCRC(SEG$, SIZEC(TIME_TABLE)) >= MAX$
     3206     9594    2           THEN
     3207     9595    3           DO;
     3208     9596    3               CALL VMA$ENLARGE_SEGMENT(VM_INPUT_,1024) ALTRET(NO_MEMORY);
     3209     9597    3               MAX$ = PINCRW(MAX$, 1024);
     3210     9598
     3211     9599    3           END;
     3212     9600    2       END;
     3213     9601    1       ELSE
     3214     9602    2       DO;
     3215     9603    2           CURR$ = FREE$;
     3216     9604    2           FREE$ = CURR$->TIME_TABLE.NEXT$;
     3217     9605    2       END;
     3218     9606    1       IF LOGON_FLAG THEN GOTO CONT_ENTRY;
     3219     9607
     3220     9608
     3221     9609    1       IF CHAIN$ = ADDR(NIL)
     3222     9610    1       THEN
     3223     9611    2       DO;
     3224     9612    2           CURR$ -> TIME_TABLE.PRIOR$ = ADDR(NIL);
     3225     9613    2           CURR$ -> TIME_TABLE.NEXT$ = ADDR(NIL);
     3226     9614    2           CHAIN$ = CURR$;
     3227     9615    2           GOTO CONT_ENTRY;
     3228     9616    2       END;
     3229     9617        /*
     3230     9618             LINK1$ -> node with value just larger than desired.
     3231     9619             LINK2$ -> node with value just smaller than deisred.
     3232     9620        */
     3233     9621    1       LINK1$ = CHAIN$;                  /* Start at head of chain */
     3234     9622    1       LINK2$ = ADDR(NIL);
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:537  
     3235     9623        /*
     3236     9624             ***** Go down chain ...
     3237     9625        */
     3238     9626    2       DO WHILE (LINK1$ ~= ADDR(NIL));
     3239     9627    2           LINK2$ = LINK1$;
     3240     9628    2           LINK1$ = LINK1$ -> TIME_TABLE.NEXT$;
     3241     9629    2       END;
     3242     9630    1       CURR$ -> TIME_TABLE.NEXT$ = LINK1$;
     3243     9631    1       CURR$ -> TIME_TABLE.PRIOR$ = LINK2$;
     3244     9632    1       IF LINK1$ ~= ADDR(NIL)
     3245     9633    1       THEN
     3246     9634    1           LINK1$ -> TIME_TABLE.PRIOR$ = CURR$;
     3247     9635    1       IF LINK2$ ~= ADDR(NIL)
     3248     9636    1       THEN
     3249     9637    1           LINK2$ -> TIME_TABLE.NEXT$ = CURR$;
     3250     9638    1   CONT_ENTRY:;
     3251     9639    1       PTR$ = CURR$;
     3252     9640    1       RETURN;
     3253     9641    1   NO_MEMORY: ;
     3254     9642    1       RETURN;
     3255     9643        %EJECT;
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:538  
     3256     9644    1   VOM$ADDENTRY_SORTED: ENTRY (PTR$, LOGON_FLAG, CHAIN$, DCB#);
     3257     9645    1       IF FREE$ = ADDR(NIL) THEN
     3258     9646    2       DO;
     3259     9647    2           CURR$ = SEG$;
     3260     9648    2           SEG$ = PINCRW(SEG$, SIZEW(TIME_TABLE));
     3261     9649    2           SEG$->STR.NEXT$ = ADDR(NIL);
     3262     9650    2           IF PINCRC(SEG$, SIZEC(TIME_TABLE)) >= MAX$
     3263     9651    2           THEN
     3264     9652    3           DO;
     3265     9653    3               CALL VMA$ENLARGE_SEGMENT(VM_INPUT_,1024) ALTRET(NO_MEMORY);
     3266     9654    3               MAX$ = PINCRW(MAX$, 1024);
     3267     9655
     3268     9656    3           END;
     3269     9657    2       END;
     3270     9658    1       ELSE
     3271     9659    2       DO;
     3272     9660    2           CURR$ = FREE$;
     3273     9661    2           FREE$ = CURR$->TIME_TABLE.NEXT$;
     3274     9662    2       END;
     3275     9663    1       IF CHAIN$ = ADDR(NIL)
     3276     9664    1       THEN
     3277     9665    2       DO;
     3278     9666    2           CURR$ -> TIME_TABLE.PRIOR$ = ADDR(NIL);
     3279     9667    2           CURR$ -> TIME_TABLE.NEXT$ = ADDR(NIL);
     3280     9668    2           CHAIN$ = CURR$;
     3281     9669    2           GOTO INIT_TIME_INFO;
     3282     9670    2       END;
     3283     9671        /*
     3284     9672             ***** New head ?
     3285     9673        */
     3286     9674    1       IF VM_HEADER.DELIVERY_DATE < CHAIN$ -> TIME_TABLE.TSTAMP
     3287     9675    1       THEN                            /* Yes, replace */
     3288     9676    2       DO;
     3289     9677    2           CURR$ -> TIME_TABLE.PRIOR$ = ADDR(NIL);
     3290     9678    2           CURR$ -> TIME_TABLE.NEXT$ = CHAIN$;
     3291     9679    2           CHAIN$ -> TIME_TABLE.PRIOR$ = CURR$;
     3292     9680    2           CHAIN$ = CURR$;
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:539  
     3293     9681    2           GOTO INIT_TIME_INFO;
     3294     9682    2       END;
     3295     9683        /*
     3296     9684             LINK1$ -> node with value just larger than desired.
     3297     9685             LINK2$ -> node with value just smaller than deisred.
     3298     9686        */
     3299     9687    1       LINK1$ = CHAIN$;                  /* Start at head of chain */
     3300     9688    1       LINK2$ = ADDR(NIL);
     3301     9689        /*
     3302     9690             ***** Go down chain ...
     3303     9691        */
     3304     9692    2       DO WHILE (LINK1$ ~= ADDR(NIL));
     3305     9693    2           IF LINK1$ -> TIME_TABLE.TSTAMP >
     3306     9694    2             VM_HEADER.DELIVERY_DATE
     3307     9695    2           THEN
     3308     9696    2               GOTO FOUND_IT;
     3309     9697    2           LINK2$ = LINK1$;
     3310     9698    2           LINK1$ = LINK1$ -> TIME_TABLE.NEXT$;
     3311     9699    2       END;
     3312     9700    1   FOUND_IT:
     3313     9701    1       CURR$ -> TIME_TABLE.NEXT$ = LINK1$;
     3314     9702    1       CURR$ -> TIME_TABLE.PRIOR$ = LINK2$;
     3315     9703    1       IF LINK1$ ~= ADDR(NIL)
     3316     9704    1       THEN
     3317     9705    1           LINK1$ -> TIME_TABLE.PRIOR$ = CURR$;
     3318     9706    1       IF LINK2$ ~= ADDR(NIL)
     3319     9707    1       THEN
     3320     9708    1           LINK2$ -> TIME_TABLE.NEXT$ = CURR$;
     3321     9709        /*
     3322     9710             ***** TIME_TABLE init.
     3323     9711        */
     3324     9712    1   INIT_TIME_INFO:
     3325     9713    1       PTR$ = CURR$;
     3326     9714    1       PTR$ -> TIME_TABLE.NAME = DCBADDR(DCB#)->F$DCB.NAME#;
     3327     9715    1       PTR$ -> TIME_TABLE.TSTAMP = VM_HEADER.DELIVERY_DATE;
     3328     9716    1       PTR$ -> TIME_TABLE.COUNT = 0;
     3329     9717    1       GOTO CONT_ENTRY;
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:540  
     3330     9718        %EJECT;
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:541  
     3331     9719    1   VOM$DELENTRY: ENTRY (PTR$, LOGON_FLAG, CHAIN$);
     3332     9720
     3333     9721    1       SAVEN$ = PTR$->STR.NEXT$;
     3334     9722    1       SAVEP$ = PTR$->STR.PRIOR$;
     3335     9723    1       IF SAVEN$ ~= ADDR(NIL) THEN
     3336     9724    1           SAVEN$->STR.PRIOR$ = SAVEP$;
     3337     9725    1       IF SAVEP$ ~= ADDR(NIL) THEN
     3338     9726    1           SAVEP$->STR.NEXT$ = SAVEN$;
     3339     9727    1       IF (SAVEP$ = ADDR(NIL)) AND
     3340     9728    1         (SAVEN$ = ADDR(NIL)) THEN CHAIN$ = ADDR(NIL);
     3341     9729
     3342     9730    1       PTR$->STR.NEXT$ = FREE$;
     3343     9731    1       FREE$ = PTR$;
     3344     9732    1       IF CHAIN$ = PTR$ THEN
     3345     9733    1           CHAIN$ = SAVEN$;
     3346     9734
     3347     9735    1       RETURN;
     3348     9736    1   END VOM$ADDENTRY;

PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:542  
--  Include file information  --

   B_ERRORS_C.:LIB_E05  is referenced.
   VO_SUBS_C.:VMB6TOU  is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VOM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VOM$ADDENTRY.

   Procedure VOM$ADDENTRY requires 237 words for executable code.
   Procedure VOM$ADDENTRY requires 18 words of local(AUTO) storage.

    No errors detected in file VOM$MAILMAN.:VMB6TSI    .

PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:543  

 Object Unit name= VOM$ADDENTRY                               File name= VOM$MAILMAN.:VMB6TOU
 UTS= AUG 20 '97 15:35:32.88 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$MAIL_FILE
    2   DCB   even  none     0      0  M$MAIL_CENTRAL
    3   DCB   even  none     0      0  M$MAIL_GLOBAL
    4   DCB   even  none     0      0  M$WORK
    5   DCB   even  none     0      0  M$MAIL_COMGROUP
    6   DCB   even  none     0      0  M$DO
    7   DCB   even  none     0      0  M$LO
    8   DCB   even  none     0      0  M$ME
    9   DCB   even  none     0      0  M$NODE
   10   DCB   even  none     0      0  M$SI
   11   Proc  even  none   237    355  VOM$ADDENTRY
   12  RoData even  none     7      7  VOM$ADDENTRY

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    11      0   yes            yes      Std        4  VOM$ADDENTRY
    11    120                  yes      Std        4  VOM$ADDENTRY_SORTED
    11    300                  yes      Std        3  VOM$DELENTRY
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:544  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 VMA$ENLARGE_SEGMENT
                       nStd      0 X66_AUTO_4
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  VM_CGBUFFER                           VO_BNWIO
     STATION#                              VO_INTERSYS_ALLOWED                   TIME_HEAD$
     TIME$                                 INTERSYS_HEAD$                        INTERSYS$
r    VO_BUSY_RETRY_MINUTES            r    VO_PACKSET_RETRY_MINUTES         r    VO_MAX_HOLD_HOURS
r    VO_HOG_LIMIT                          VO_MAILMAN_STARTUP_TIME               VO_INTERSYS_PASSWORD
     VO_INTERSYS_EPASS                     VO_INTERSYS_ACCT                      VO_INTERSYS_UNAME
     VO_RETRY_LIMIT_INTERSYSTEM       r    VM_HEADER$                       r    VM_PROFILE$
r    VM_ADDLIST$                      r    VM_ADDREC$                       r    VM_WORK$
r    VM_SELECT$                       r    VM_PARSEAREA$                    r    VM_INPUT$
r    VM_COPY$                              VM_ENCLLIST$                          VM_ENCLREC$
     VM_HEADER_                            VM_HEADER_INIT_                       VM_PROFILE_
     VM_ADDLIST_                           VM_ADDREC_                            VM_WORK_
     VM_SELECT_                            VM_PARSEAREA_                         VM_INPUT_
     VM_COPY_                              VM_ENCLLIST_                          VM_ENCLREC_
     M$MAIL_FILE                           M$MAIL_CENTRAL                        M$MAIL_GLOBAL
     M$WORK                                M$MAIL_COMGROUP                       M$DO
     M$LO                                  M$ME                                  M$NODE
     M$SI                                  M$MAIL_FILE_NUM                       M$MAIL_CENTRAL_NUM
     M$MAIL_GLOBAL_NUM                     M$WORK_NUM                            M$MAIL_COMGROUP_NUM
     M$DO_NUM                              M$ME_NUM                              M$LO_NUM
     M$SI_NUM                              M$NODE_NUM                       r    B$JIT$
r    B$TCB$                                VM_MAIL_ACCT                          VM_NAME_MAP_NAME
     ERRMSG_FID                            VM_SEND_FILE_NAME                     VM_FORWARD_FILE_NAME
     VM_FORWARD_ENCL_NAME                  VM_FORWARD_FILE_PASS                  VM_MAILCG_NAME
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:545  
     VM_SITENAME                           VM_MAILCG_SETSTA                      FREE$
     SEG$                                  MAX$

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ROSID                                 ISSID
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:546  


     3161        1        /*T***********************************************************/
     3162        2        /*T*                                                         */
     3163        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     3164        4        /*T*                                                         */
     3165        5        /*T***********************************************************/
     3166        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
     3167        7        VOM$ADDENTRY: PROC (PTR$, LOGON_FLAG, CHAIN$, DCB#);

      7 11 000000   000000 700200 xent  VOM$ADDENTRY TSX0  ! X66_AUTO_4
        11 000001   000022 000004                    ZERO    18,4

     3168        8
     3169        9          %INCLUDE VOM_DATA_R;                  /* Also includes CP_6 */
     3170     7229          %INCLUDE CP_6_SUBS;
     3171     7769          %INCLUDE VM_DATA_R;
     3172     8200          %INCLUDE VO_SUBS_C;
     3173     8251          %INCLUDE B_ERRORS_C;
     3174     9378          %F$DCB;
     3175     9435            %VM_HEADER;
     3176     9564
     3177     9565    1   DCL DCB# UBIN;
     3178     9566    1   DCL PRIOR$ PTR;
     3179     9567    1   DCL NEXT$  PTR;
     3180     9568    1   DCL X$ PTR;
     3181     9569    1   DCL PTR$ PTR;
     3182     9570    1   DCL NEW$ PTR;
     3183     9571    1   DCL LINK1$ PTR;
     3184     9572    1   DCL LINK2$ PTR;
     3185     9573    1   DCL CHAIN$ PTR;
     3186     9574    1   DCL VMA$ENLARGE_SEGMENT ENTRY(2) ALTRET;
     3187     9575    1   DCL FREE$ PTR SYMREF;
     3188     9576    1   DCL SEG$ PTR SYMREF;
     3189     9577    1   DCL MAX$ PTR SYMREF;
     3190     9578    1   DCL SAVEN$ PTR;
     3191     9579    1   DCL SAVEP$ PTR;
     3192     9580    1   DCL LOGON_FLAG BIT(1);
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:547  
     3193     9581    1   DCL 1 STR BASED,
     3194     9582    1         2 NEXT$ PTR UNAL,
     3195     9583    1         2 PRIOR$ PTR UNAL,
     3196     9584    1         2 SORT_VALUE UBIN WORD UNAL;
     3197     9585
     3198     9586    1   DCL CURR$ PTR ALIGNED;
     3199     9587
     3200     9588    1       IF FREE$ = ADDR(NIL) THEN

   9588 11 000002   000000 236000 xsym               LDQ     FREE$
        11 000003   000000 116000 12                 CMPQ    0
        11 000004   000033 601000 11                 TNZ     s:9603

     3201     9589    2       DO;

     3202     9590    2           CURR$ = SEG$;

   9590 11 000005   000000 236000 xsym               LDQ     SEG$
        11 000006   200017 756100                    STQ     CURR$,,AUTO

     3203     9591    2           SEG$ = PINCRW(SEG$, SIZEW(TIME_TABLE));

   9591 11 000007   000021 036003                    ADLQ    17,DU
        11 000010   000000 756000 xsym               STQ     SEG$

     3204     9592    2           SEG$->STR.NEXT$ = ADDR(NIL);

   9592 11 000011   000000 236000 12                 LDQ     0
        11 000012   200020 756100                    STQ     CURR$+1,,AUTO
        11 000013   000000 470400 xsym               LDP0    SEG$
        11 000014   003100 060500                    CSL     bolr='003'O
        11 000015   200020 000044                    BDSC    CURR$+1,,AUTO            by=0,bit=0,n=36
        11 000016   000000 000044                    BDSC    0,,PR0                   by=0,bit=0,n=36

     3205     9593    2           IF PINCRC(SEG$, SIZEC(TIME_TABLE)) >= MAX$

   9593 11 000017   000000 236000 xsym               LDQ     SEG$
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:548  
        11 000020   000021 036003                    ADLQ    17,DU
        11 000021   000000 116000 xsym               CMPQ    MAX$
        11 000022   000037 602000 11                 TNC     s:9606

     3206     9594    2           THEN
     3207     9595    3           DO;

     3208     9596    3               CALL VMA$ENLARGE_SEGMENT(VM_INPUT_,1024) ALTRET(NO_MEMORY);

   9596 11 000023   000003 630400 12                 EPPR0   3
        11 000024   000001 631400 12                 EPPR1   1
        11 000025   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        11 000026   000117 702000 11                 TSX2    NO_MEMORY

     3209     9597    3               MAX$ = PINCRW(MAX$, 1024);

   9597 11 000027   000000 236000 xsym               LDQ     MAX$
        11 000030   002000 036003                    ADLQ    1024,DU
        11 000031   000000 756000 xsym               STQ     MAX$

     3210     9598
     3211     9599    3           END;

     3212     9600    2       END;

   9600 11 000032   000037 710000 11                 TRA     s:9606

     3213     9601    1       ELSE
     3214     9602    2       DO;

     3215     9603    2           CURR$ = FREE$;

   9603 11 000033   200017 756100                    STQ     CURR$,,AUTO

     3216     9604    2           FREE$ = CURR$->TIME_TABLE.NEXT$;

   9604 11 000034   200017 470500                    LDP0    CURR$,,AUTO
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:549  
        11 000035   000000 236100                    LDQ     0,,PR0
        11 000036   000000 756000 xsym               STQ     FREE$

     3217     9605    2       END;

     3218     9606    1       IF LOGON_FLAG THEN GOTO CONT_ENTRY;

   9606 11 000037   200004 470500                    LDP0    @LOGON_FLAG,,AUTO
        11 000040   000000 066500                    CMPB    filb='1'B
        11 000041   000000 000001                    BDSC    0,,PR0                   by=0,bit=0,n=1
        11 000042   000005 000022 12                 BDSC    5                        by=0,bit=0,n=18
        11 000043   000113 601000 11                 TNZ     CONT_ENTRY

     3219     9607
     3220     9608
     3221     9609    1       IF CHAIN$ = ADDR(NIL)

   9609 11 000044   200005 471500                    LDP1    @CHAIN$,,AUTO
        11 000045   100000 236100                    LDQ     0,,PR1
        11 000046   000000 116000 12                 CMPQ    0
        11 000047   000057 601000 11                 TNZ     s:9621

     3222     9610    1       THEN
     3223     9611    2       DO;

     3224     9612    2           CURR$ -> TIME_TABLE.PRIOR$ = ADDR(NIL);

   9612 11 000050   000000 236000 12                 LDQ     0
        11 000051   200017 473500                    LDP3    CURR$,,AUTO
        11 000052   300001 756100                    STQ     1,,PR3

     3225     9613    2           CURR$ -> TIME_TABLE.NEXT$ = ADDR(NIL);

   9613 11 000053   300000 756100                    STQ     0,,PR3

     3226     9614    2           CHAIN$ = CURR$;

PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:550  
   9614 11 000054   200017 236100                    LDQ     CURR$,,AUTO
        11 000055   100000 756100                    STQ     0,,PR1

     3227     9615    2           GOTO CONT_ENTRY;

   9615 11 000056   000113 710000 11                 TRA     CONT_ENTRY

     3228     9616    2       END;
     3229     9617        /*
     3230     9618             LINK1$ -> node with value just larger than desired.
     3231     9619             LINK2$ -> node with value just smaller than deisred.
     3232     9620        */
     3233     9621    1       LINK1$ = CHAIN$;                  /* Start at head of chain */

   9621 11 000057   200013 756100                    STQ     LINK1$,,AUTO

     3234     9622    1       LINK2$ = ADDR(NIL);

   9622 11 000060   000000 236000 12                 LDQ     0
        11 000061   200014 756100                    STQ     LINK2$,,AUTO

     3235     9623        /*
     3236     9624             ***** Go down chain ...
     3237     9625        */
     3238     9626    2       DO WHILE (LINK1$ ~= ADDR(NIL));

   9626 11 000062   000070 710000 11                 TRA     s:9629

     3239     9627    2           LINK2$ = LINK1$;

   9627 11 000063   200013 236100                    LDQ     LINK1$,,AUTO
        11 000064   200014 756100                    STQ     LINK2$,,AUTO

     3240     9628    2           LINK1$ = LINK1$ -> TIME_TABLE.NEXT$;

   9628 11 000065   200013 470500                    LDP0    LINK1$,,AUTO
        11 000066   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:551  
        11 000067   200013 756100                    STQ     LINK1$,,AUTO

     3241     9629    2       END;

   9629 11 000070   200013 236100                    LDQ     LINK1$,,AUTO
        11 000071   000000 116000 12                 CMPQ    0
        11 000072   000063 601000 11                 TNZ     s:9627

     3242     9630    1       CURR$ -> TIME_TABLE.NEXT$ = LINK1$;

   9630 11 000073   200017 470500                    LDP0    CURR$,,AUTO
        11 000074   000000 756100                    STQ     0,,PR0

     3243     9631    1       CURR$ -> TIME_TABLE.PRIOR$ = LINK2$;

   9631 11 000075   200014 236100                    LDQ     LINK2$,,AUTO
        11 000076   000001 756100                    STQ     1,,PR0

     3244     9632    1       IF LINK1$ ~= ADDR(NIL)

   9632 11 000077   200013 236100                    LDQ     LINK1$,,AUTO
        11 000100   000000 116000 12                 CMPQ    0
        11 000101   000105 600000 11                 TZE     s:9635

     3245     9633    1       THEN
     3246     9634    1           LINK1$ -> TIME_TABLE.PRIOR$ = CURR$;

   9634 11 000102   200017 236100                    LDQ     CURR$,,AUTO
        11 000103   200013 471500                    LDP1    LINK1$,,AUTO
        11 000104   100001 756100                    STQ     1,,PR1

     3247     9635    1       IF LINK2$ ~= ADDR(NIL)

   9635 11 000105   200014 236100                    LDQ     LINK2$,,AUTO
        11 000106   000000 116000 12                 CMPQ    0
        11 000107   000113 600000 11                 TZE     CONT_ENTRY

PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:552  
     3248     9636    1       THEN
     3249     9637    1           LINK2$ -> TIME_TABLE.NEXT$ = CURR$;

   9637 11 000110   200017 236100                    LDQ     CURR$,,AUTO
        11 000111   200014 471500                    LDP1    LINK2$,,AUTO
        11 000112   100000 756100                    STQ     0,,PR1

   9635 11 000113                       CONT_ENTRY   null
     3250     9638    1   CONT_ENTRY:;
     3251     9639    1       PTR$ = CURR$;

   9639 11 000113   200017 236100                    LDQ     CURR$,,AUTO
        11 000114   200003 470500                    LDP0    @PTR$,,AUTO
        11 000115   000000 756100                    STQ     0,,PR0

     3252     9640    1       RETURN;

   9640 11 000116   000000 702200 xent               TSX2  ! X66_ARET

   9639 11 000117                       NO_MEMORY    null
     3253     9641    1   NO_MEMORY: ;
     3254     9642    1       RETURN;

   9642 11 000117   000000 702200 xent               TSX2  ! X66_ARET

     3255     9643        %EJECT;
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:553  
     3256     9644    1   VOM$ADDENTRY_SORTED: ENTRY (PTR$, LOGON_FLAG, CHAIN$, DCB#);

   9644 11 000120   000000 700200 xent  VOM$ADDENTR* TSX0  ! X66_AUTO_4
        11 000121   000022 000004                    ZERO    18,4

     3257     9645    1       IF FREE$ = ADDR(NIL) THEN

   9645 11 000122   000000 236000 xsym               LDQ     FREE$
        11 000123   000000 116000 12                 CMPQ    0
        11 000124   000153 601000 11                 TNZ     s:9660

     3258     9646    2       DO;

     3259     9647    2           CURR$ = SEG$;

   9647 11 000125   000000 236000 xsym               LDQ     SEG$
        11 000126   200017 756100                    STQ     CURR$,,AUTO

     3260     9648    2           SEG$ = PINCRW(SEG$, SIZEW(TIME_TABLE));

   9648 11 000127   000021 036003                    ADLQ    17,DU
        11 000130   000000 756000 xsym               STQ     SEG$

     3261     9649    2           SEG$->STR.NEXT$ = ADDR(NIL);

   9649 11 000131   000000 236000 12                 LDQ     0
        11 000132   200020 756100                    STQ     CURR$+1,,AUTO
        11 000133   000000 470400 xsym               LDP0    SEG$
        11 000134   003100 060500                    CSL     bolr='003'O
        11 000135   200020 000044                    BDSC    CURR$+1,,AUTO            by=0,bit=0,n=36
        11 000136   000000 000044                    BDSC    0,,PR0                   by=0,bit=0,n=36

     3262     9650    2           IF PINCRC(SEG$, SIZEC(TIME_TABLE)) >= MAX$

   9650 11 000137   000000 236000 xsym               LDQ     SEG$
        11 000140   000021 036003                    ADLQ    17,DU
        11 000141   000000 116000 xsym               CMPQ    MAX$
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:554  
        11 000142   000157 602000 11                 TNC     s:9663

     3263     9651    2           THEN
     3264     9652    3           DO;

     3265     9653    3               CALL VMA$ENLARGE_SEGMENT(VM_INPUT_,1024) ALTRET(NO_MEMORY);

   9653 11 000143   000003 630400 12                 EPPR0   3
        11 000144   000001 631400 12                 EPPR1   1
        11 000145   000000 701000 xent               TSX1    VMA$ENLARGE_SEGMENT
        11 000146   000117 702000 11                 TSX2    NO_MEMORY

     3266     9654    3               MAX$ = PINCRW(MAX$, 1024);

   9654 11 000147   000000 236000 xsym               LDQ     MAX$
        11 000150   002000 036003                    ADLQ    1024,DU
        11 000151   000000 756000 xsym               STQ     MAX$

     3267     9655
     3268     9656    3           END;

     3269     9657    2       END;

   9657 11 000152   000157 710000 11                 TRA     s:9663

     3270     9658    1       ELSE
     3271     9659    2       DO;

     3272     9660    2           CURR$ = FREE$;

   9660 11 000153   200017 756100                    STQ     CURR$,,AUTO

     3273     9661    2           FREE$ = CURR$->TIME_TABLE.NEXT$;

   9661 11 000154   200017 470500                    LDP0    CURR$,,AUTO
        11 000155   000000 236100                    LDQ     0,,PR0
        11 000156   000000 756000 xsym               STQ     FREE$
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:555  

     3274     9662    2       END;

     3275     9663    1       IF CHAIN$ = ADDR(NIL)

   9663 11 000157   200005 470500                    LDP0    @CHAIN$,,AUTO
        11 000160   000000 236100                    LDQ     0,,PR0
        11 000161   000000 116000 12                 CMPQ    0
        11 000162   000172 601000 11                 TNZ     s:9674

     3276     9664    1       THEN
     3277     9665    2       DO;

     3278     9666    2           CURR$ -> TIME_TABLE.PRIOR$ = ADDR(NIL);

   9666 11 000163   000000 236000 12                 LDQ     0
        11 000164   200017 471500                    LDP1    CURR$,,AUTO
        11 000165   100001 756100                    STQ     1,,PR1

     3279     9667    2           CURR$ -> TIME_TABLE.NEXT$ = ADDR(NIL);

   9667 11 000166   100000 756100                    STQ     0,,PR1

     3280     9668    2           CHAIN$ = CURR$;

   9668 11 000167   200017 236100                    LDQ     CURR$,,AUTO
        11 000170   000000 756100                    STQ     0,,PR0

     3281     9669    2           GOTO INIT_TIME_INFO;

   9669 11 000171   000253 710000 11                 TRA     INIT_TIME_INFO

     3282     9670    2       END;
     3283     9671        /*
     3284     9672             ***** New head ?
     3285     9673        */
     3286     9674    1       IF VM_HEADER.DELIVERY_DATE < CHAIN$ -> TIME_TABLE.TSTAMP
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:556  

   9674 11 000172   000000 471500                    LDP1    0,,PR0
        11 000173   000000 473400 xsym               LDP3    VM_HEADER$
        11 000174   300002 236100                    LDQ     2,,PR3
        11 000175   100002 116100                    CMPQ    2,,PR1
        11 000176   000211 603000 11                 TRC     s:9687

     3287     9675    1       THEN                            /* Yes, replace */
     3288     9676    2       DO;

     3289     9677    2           CURR$ -> TIME_TABLE.PRIOR$ = ADDR(NIL);

   9677 11 000177   000000 236000 12                 LDQ     0
        11 000200   200017 474500                    LDP4    CURR$,,AUTO
        11 000201   400001 756100                    STQ     1,,PR4

     3290     9678    2           CURR$ -> TIME_TABLE.NEXT$ = CHAIN$;

   9678 11 000202   000000 236100                    LDQ     0,,PR0
        11 000203   400000 756100                    STQ     0,,PR4

     3291     9679    2           CHAIN$ -> TIME_TABLE.PRIOR$ = CURR$;

   9679 11 000204   000000 471500                    LDP1    0,,PR0
        11 000205   200017 236100                    LDQ     CURR$,,AUTO
        11 000206   100001 756100                    STQ     1,,PR1

     3292     9680    2           CHAIN$ = CURR$;

   9680 11 000207   000000 756100                    STQ     0,,PR0

     3293     9681    2           GOTO INIT_TIME_INFO;

   9681 11 000210   000253 710000 11                 TRA     INIT_TIME_INFO

     3294     9682    2       END;
     3295     9683        /*
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:557  
     3296     9684             LINK1$ -> node with value just larger than desired.
     3297     9685             LINK2$ -> node with value just smaller than deisred.
     3298     9686        */
     3299     9687    1       LINK1$ = CHAIN$;                  /* Start at head of chain */

   9687 11 000211   000000 236100                    LDQ     0,,PR0
        11 000212   200013 756100                    STQ     LINK1$,,AUTO

     3300     9688    1       LINK2$ = ADDR(NIL);

   9688 11 000213   000000 236000 12                 LDQ     0
        11 000214   200014 756100                    STQ     LINK2$,,AUTO

     3301     9689        /*
     3302     9690             ***** Go down chain ...
     3303     9691        */
     3304     9692    2       DO WHILE (LINK1$ ~= ADDR(NIL));

   9692 11 000215   000227 710000 11                 TRA     s:9699

     3305     9693    2           IF LINK1$ -> TIME_TABLE.TSTAMP >

   9693 11 000216   000000 470400 xsym               LDP0    VM_HEADER$
        11 000217   200013 471500                    LDP1    LINK1$,,AUTO
        11 000220   000002 236100                    LDQ     2,,PR0
        11 000221   100002 116100                    CMPQ    2,,PR1
        11 000222   000232 602000 11                 TNC     FOUND_IT

     3306     9694    2             VM_HEADER.DELIVERY_DATE
     3307     9695    2           THEN
     3308     9696    2               GOTO FOUND_IT;
     3309     9697    2           LINK2$ = LINK1$;

   9697 11 000223   200013 236100                    LDQ     LINK1$,,AUTO
        11 000224   200014 756100                    STQ     LINK2$,,AUTO

     3310     9698    2           LINK1$ = LINK1$ -> TIME_TABLE.NEXT$;
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:558  

   9698 11 000225   100000 236100                    LDQ     0,,PR1
        11 000226   200013 756100                    STQ     LINK1$,,AUTO

     3311     9699    2       END;

   9699 11 000227   200013 236100                    LDQ     LINK1$,,AUTO
        11 000230   000000 116000 12                 CMPQ    0
        11 000231   000216 601000 11                 TNZ     s:9693

     3312     9700    1   FOUND_IT:
     3313     9701    1       CURR$ -> TIME_TABLE.NEXT$ = LINK1$;

   9701 11 000232   200013 236100       FOUND_IT     LDQ     LINK1$,,AUTO
        11 000233   200017 470500                    LDP0    CURR$,,AUTO
        11 000234   000000 756100                    STQ     0,,PR0

     3314     9702    1       CURR$ -> TIME_TABLE.PRIOR$ = LINK2$;

   9702 11 000235   200014 236100                    LDQ     LINK2$,,AUTO
        11 000236   000001 756100                    STQ     1,,PR0

     3315     9703    1       IF LINK1$ ~= ADDR(NIL)

   9703 11 000237   200013 236100                    LDQ     LINK1$,,AUTO
        11 000240   000000 116000 12                 CMPQ    0
        11 000241   000245 600000 11                 TZE     s:9706

     3316     9704    1       THEN
     3317     9705    1           LINK1$ -> TIME_TABLE.PRIOR$ = CURR$;

   9705 11 000242   200017 236100                    LDQ     CURR$,,AUTO
        11 000243   200013 471500                    LDP1    LINK1$,,AUTO
        11 000244   100001 756100                    STQ     1,,PR1

     3318     9706    1       IF LINK2$ ~= ADDR(NIL)

PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:559  
   9706 11 000245   200014 236100                    LDQ     LINK2$,,AUTO
        11 000246   000000 116000 12                 CMPQ    0
        11 000247   000253 600000 11                 TZE     INIT_TIME_INFO

     3319     9707    1       THEN
     3320     9708    1           LINK2$ -> TIME_TABLE.NEXT$ = CURR$;

   9708 11 000250   200017 236100                    LDQ     CURR$,,AUTO
        11 000251   200014 471500                    LDP1    LINK2$,,AUTO
        11 000252   100000 756100                    STQ     0,,PR1

     3321     9709        /*
     3322     9710             ***** TIME_TABLE init.
     3323     9711        */
     3324     9712    1   INIT_TIME_INFO:
     3325     9713    1       PTR$ = CURR$;

   9713 11 000253   200017 236100       INIT_TIME_I* LDQ     CURR$,,AUTO
        11 000254   200003 470500                    LDP0    @PTR$,,AUTO
        11 000255   000000 756100                    STQ     0,,PR0

     3326     9714    1       PTR$ -> TIME_TABLE.NAME = DCBADDR(DCB#)->F$DCB.NAME#;

   9714 11 000256   000000 471500                    LDP1    0,,PR0
        11 000257   000006 473400 12                 LDP3    6
        11 000260   300000 474500                    LDP4    0,,PR3
        11 000261   200006 475500                    LDP5    @DCB#,,AUTO
        11 000262   500000 720100                    LXL0    0,,PR5
        11 000263   400000 476510                    LDP6    0,X0,PR4
        11 000264   000100 100500                    MLR     fill='000'O
        11 000265   600010 000040                    ADSC9   8,,PR6                   cn=0,n=32
        11 000266   100006 200040                    ADSC9   6,,PR1                   cn=1,n=32

     3327     9715    1       PTR$ -> TIME_TABLE.TSTAMP = VM_HEADER.DELIVERY_DATE;

   9715 11 000267   000000 471500                    LDP1    0,,PR0
        11 000270   000000 476400 xsym               LDP6    VM_HEADER$
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:560  
        11 000271   600002 235100                    LDA     2,,PR6
        11 000272   100002 755100                    STA     2,,PR1

     3328     9716    1       PTR$ -> TIME_TABLE.COUNT = 0;

   9716 11 000273   000000 471500                    LDP1    0,,PR0
        11 000274   000100 100400                    MLR     fill='000'O
        11 000275   000005 000004 12                 ADSC9   5                        cn=0,n=4
        11 000276   100005 200004                    ADSC9   5,,PR1                   cn=1,n=4

     3329     9717    1       GOTO CONT_ENTRY;

   9717 11 000277   000113 710000 11                 TRA     CONT_ENTRY

     3330     9718        %EJECT;
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:561  
     3331     9719    1   VOM$DELENTRY: ENTRY (PTR$, LOGON_FLAG, CHAIN$);

   9719 11 000300   000000 700200 xent  VOM$DELENTRY TSX0  ! X66_AUTO_4
        11 000301   000022 000004                    ZERO    18,4

     3332     9720
     3333     9721    1       SAVEN$ = PTR$->STR.NEXT$;

   9721 11 000302   200003 470500                    LDP0    @PTR$,,AUTO
        11 000303   000000 471500                    LDP1    0,,PR0
        11 000304   003100 060500                    CSL     bolr='003'O
        11 000305   100000 000044                    BDSC    0,,PR1                   by=0,bit=0,n=36
        11 000306   200015 000044                    BDSC    SAVEN$,,AUTO             by=0,bit=0,n=36

     3334     9722    1       SAVEP$ = PTR$->STR.PRIOR$;

   9722 11 000307   003100 060500                    CSL     bolr='003'O
        11 000310   100001 000044                    BDSC    1,,PR1                   by=0,bit=0,n=36
        11 000311   200016 000044                    BDSC    SAVEP$,,AUTO             by=0,bit=0,n=36

     3335     9723    1       IF SAVEN$ ~= ADDR(NIL) THEN

   9723 11 000312   200015 236100                    LDQ     SAVEN$,,AUTO
        11 000313   000000 116000 12                 CMPQ    0
        11 000314   000321 600000 11                 TZE     s:9725

     3336     9724    1           SAVEN$->STR.PRIOR$ = SAVEP$;

   9724 11 000315   200015 473500                    LDP3    SAVEN$,,AUTO
        11 000316   003100 060500                    CSL     bolr='003'O
        11 000317   200016 000044                    BDSC    SAVEP$,,AUTO             by=0,bit=0,n=36
        11 000320   300001 000044                    BDSC    1,,PR3                   by=0,bit=0,n=36

     3337     9725    1       IF SAVEP$ ~= ADDR(NIL) THEN

   9725 11 000321   200016 236100                    LDQ     SAVEP$,,AUTO
        11 000322   000000 116000 12                 CMPQ    0
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:562  
        11 000323   000330 600000 11                 TZE     s:9727

     3338     9726    1           SAVEP$->STR.NEXT$ = SAVEN$;

   9726 11 000324   200016 471500                    LDP1    SAVEP$,,AUTO
        11 000325   003100 060500                    CSL     bolr='003'O
        11 000326   200015 000044                    BDSC    SAVEN$,,AUTO             by=0,bit=0,n=36
        11 000327   100000 000044                    BDSC    0,,PR1                   by=0,bit=0,n=36

     3339     9727    1       IF (SAVEP$ = ADDR(NIL)) AND

   9727 11 000330   000000 116000 12                 CMPQ    0
        11 000331   000340 601000 11                 TNZ     s:9730
        11 000332   200015 236100                    LDQ     SAVEN$,,AUTO
        11 000333   000000 116000 12                 CMPQ    0
        11 000334   000340 601000 11                 TNZ     s:9730

     3340     9728    1         (SAVEN$ = ADDR(NIL)) THEN CHAIN$ = ADDR(NIL);

   9728 11 000335   000000 236000 12                 LDQ     0
        11 000336   200005 471500                    LDP1    @CHAIN$,,AUTO
        11 000337   100000 756100                    STQ     0,,PR1

     3341     9729
     3342     9730    1       PTR$->STR.NEXT$ = FREE$;

   9730 11 000340   000000 471500                    LDP1    0,,PR0
        11 000341   003100 060400                    CSL     bolr='003'O
        11 000342   000000 000044 xsym               BDSC    FREE$                    by=0,bit=0,n=36
        11 000343   100000 000044                    BDSC    0,,PR1                   by=0,bit=0,n=36

     3343     9731    1       FREE$ = PTR$;

   9731 11 000344   000000 236100                    LDQ     0,,PR0
        11 000345   000000 756000 xsym               STQ     FREE$

     3344     9732    1       IF CHAIN$ = PTR$ THEN
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:563  

   9732 11 000346   200005 471500                    LDP1    @CHAIN$,,AUTO
        11 000347   100000 236100                    LDQ     0,,PR1
        11 000350   000000 116100                    CMPQ    0,,PR0
        11 000351   000354 601000 11                 TNZ     s:9735

     3345     9733    1           CHAIN$ = SAVEN$;

   9733 11 000352   200015 236100                    LDQ     SAVEN$,,AUTO
        11 000353   100000 756100                    STQ     0,,PR1

     3346     9734
     3347     9735    1       RETURN;

   9735 11 000354   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
  12     000   000000 006014   000002 000000   000000 002000   000000 006000    ................
  12     004   000002 006000   000000 000000   000000 006003                    ............
     3348     9736    1   END VOM$ADDENTRY;

PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:564  
--  Include file information  --

   B_ERRORS_C.:LIB_E05  is referenced.
   VO_SUBS_C.:VMB6TOU  is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VOM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VOM$ADDENTRY.
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:565  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     5-0-0/w PTR         r     1 @CHAIN$                    6-0-0/w PTR         r     1 @DCB#
     4-0-0/w PTR         r     1 @LOGON_FLAG                3-0-0/w PTR         r     1 @PTR$
    *0-0-0/w PTR         r     1 CHAIN$                    17-0-0/w PTR         r     1 CURR$
    *0-0-0/w UBIN        r     1 DCB#                      13-0-0/w PTR         r     1 LINK1$
    14-0-0/w PTR         r     1 LINK2$                    *0-0-0/b BIT         r     1 LOGON_FLAG
    12-0-0/w PTR               1 NEW$                      10-0-0/w PTR               1 NEXT$
     7-0-0/w PTR               1 PRIOR$                    *0-0-0/w PTR         r     1 PTR$
    15-0-0/w PTR         r     1 SAVEN$                    16-0-0/w PTR         r     1 SAVEP$
    11-0-0/w PTR               1 X$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR               1 B$JIT$                     0-0-0/w PTR               1 B$TCB$
     0-0-0/c ASTR(9)     r     1 ERRMSG_FID                 0-0-0/w PTR         r     1 FREE$
     0-0-0/w PTR         r     1 INTERSYS$                  0-0-0/w PTR               1 INTERSYS_HEAD$
     0-0-0/w UBIN              1 M$DO_NUM                   0-0-0/w UBIN              1 M$LO_NUM
     0-0-0/w UBIN              1 M$MAIL_CENTRAL_NUM         0-0-0/w UBIN              1 M$MAIL_COMGROUP_NUM
     0-0-0/w UBIN              1 M$MAIL_FILE_NUM            0-0-0/w UBIN              1 M$MAIL_GLOBAL_NUM
     0-0-0/w UBIN              1 M$ME_NUM                   0-0-0/w UBIN              1 M$NODE_NUM
     0-0-0/w UBIN              1 M$SI_NUM                   0-0-0/w UBIN              1 M$WORK_NUM
     0-0-0/w PTR         r     1 MAX$                       0-0-0/w PTR         r     1 SEG$
     0-0-0/c CHAR(8)           1 STATION#                   0-0-0/w PTR         r     1 TIME$
     0-0-0/w PTR               1 TIME_HEAD$                 0-0-0/w PTR               1 VM_ADDLIST$
     0-0-0/d VECT              1 VM_ADDLIST_                0-0-0/w PTR               1 VM_ADDREC$
     0-0-0/d VECT              1 VM_ADDREC_                 0-0-0/c STRC(1296)        1 VM_CGBUFFER
     0-0-0/w PTR               1 VM_COPY$                   0-0-0/d VECT              1 VM_COPY_
     0-0-0/w PTR               1 VM_ENCLLIST$               0-0-0/d VECT              1 VM_ENCLLIST_
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:566  
     0-0-0/w PTR               1 VM_ENCLREC$                0-0-0/d VECT              1 VM_ENCLREC_
     0-0-0/c STRC(270)         1 VM_FORWARD_ENCL_NAME       0-0-0/c STRC(270)         1 VM_FORWARD_FILE_NAME
     0-0-0/c STRC(72)          1 VM_FORWARD_FILE_PASS       0-0-0/w PTR         r     1 VM_HEADER$
     0-0-0/d VECT              1 VM_HEADER_                 0-0-0/d VECT              1 VM_HEADER_INIT_
     0-0-0/w PTR               1 VM_INPUT$                  0-0-0/d VECT        r     1 VM_INPUT_
     0-0-0/c STRC(72)          1 VM_MAILCG_NAME             0-0-0/w STRC(432)         1 VM_MAILCG_SETSTA
     0-0-0/c STRC(72)          1 VM_MAIL_ACCT               0-0-0/c STRC(54)          1 VM_NAME_MAP_NAME
     0-0-0/w PTR               1 VM_PARSEAREA$              0-0-0/d VECT              1 VM_PARSEAREA_
     0-0-0/w PTR               1 VM_PROFILE$                0-0-0/d VECT              1 VM_PROFILE_
     0-0-0/w PTR               1 VM_SELECT$                 0-0-0/d VECT              1 VM_SELECT_
     0-0-0/c STRC(288)         1 VM_SEND_FILE_NAME          0-0-0/c CHAR(8)           1 VM_SITENAME
     0-0-0/w PTR               1 VM_WORK$                   0-0-0/d VECT              1 VM_WORK_
     0-0-0/w STRC(2880)        1 VO_BNWIO
     0-0-0/w UBIN              1 VO_BUSY_RETRY_MINUTES
     0-0-0/w UBIN              1 VO_HOG_LIMIT               0-0-0/c CHAR(8)           1 VO_INTERSYS_ACCT
     0-0-0/b BIT               1 VO_INTERSYS_ALLOWED        0-0-0/c CHAR(12)          1 VO_INTERSYS_EPASS
     0-0-0/c CHAR(8)           1 VO_INTERSYS_PASSWORD       0-0-0/c CHAR(8)           1 VO_INTERSYS_UNAME
     0-0-0/w UBIN              1 VO_MAILMAN_STARTUP_TIME
     0-0-0/w UBIN              1 VO_MAX_HOLD_HOURS
     0-0-0/w UBIN              1 VO_PACKSET_RETRY_MINUTES
     0-0-0/w UBIN              1 VO_RETRY_LIMIT_INTERSYSTEM

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/w STRC(540)         1 INTERSYS_INFO
     0-0-0N  NULL        r     1 M$DO                       0-0-0N  NULL        r     1 M$LO
     0-0-0N  NULL        r     1 M$MAIL_CENTRAL             0-0-0N  NULL        r     1 M$MAIL_COMGROUP
     0-0-0N  NULL        r     1 M$MAIL_FILE                0-0-0N  NULL        r     1 M$MAIL_GLOBAL
     0-0-0N  NULL        r     1 M$ME                       0-0-0N  NULL        r     1 M$NODE
     0-0-0N  NULL        r     1 M$SI                       0-0-0N  NULL        r     1 M$UC
     0-0-0N  NULL        r     1 M$WORK                     0-0-0/b STRC(108)   r     1 STR
     0-0-0/w STRC(612)   r     1 TIME_TABLE                 0-0-0/w STRC(1332)  r     1 VM_HEADER
     0-0-0/c ASTR(9)     r     1 X$STRING

PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:567  

   Procedure VOM$ADDENTRY requires 237 words for executable code.
   Procedure VOM$ADDENTRY requires 18 words of local(AUTO) storage.

    No errors detected in file VOM$MAILMAN.:VMB6TSI    .
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:568  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:569  
          MINI XREF LISTING

CHAIN$
      9573**DCL         7--PROC     9609>>IF       9614<<ASSIGN   9621>>ASSIGN   9644--ENTRY    9663>>IF
      9668<<ASSIGN   9674>>IF       9678>>ASSIGN   9679>>ASSIGN   9680<<ASSIGN   9687>>ASSIGN   9719--ENTRY
      9728<<ASSIGN   9732>>IF       9733<<ASSIGN
CONT_ENTRY
      9635**LABEL    9606--GOTO     9615--GOTO     9717--GOTO
CURR$
      9586**DCL      9590<<ASSIGN   9603<<ASSIGN   9604>>ASSIGN   9612>>ASSIGN   9613>>ASSIGN   9614>>ASSIGN
      9630>>ASSIGN   9631>>ASSIGN   9634>>ASSIGN   9637>>ASSIGN   9639>>ASSIGN   9647<<ASSIGN   9660<<ASSIGN
      9661>>ASSIGN   9666>>ASSIGN   9667>>ASSIGN   9668>>ASSIGN   9677>>ASSIGN   9678>>ASSIGN   9679>>ASSIGN
      9680>>ASSIGN   9701>>ASSIGN   9702>>ASSIGN   9705>>ASSIGN   9708>>ASSIGN   9713>>ASSIGN
DCB#
      9565**DCL         7--PROC     9644--ENTRY    9714--ASSIGN
ERRMSG_FID.L#
      8045**DCL      8045--IMP-SIZ
F$DCB.ACTPOS
      9411**DCL      9411--REDEF
F$DCB.ARS#
      9385**DCL      9385--REDEF
F$DCB.ATTR
      9404**DCL      9405--REDEF
F$DCB.BORROW
      9419**DCL      9419--REDEF    9419--REDEF    9419--REDEF
F$DCB.DCBNAME.L
      9433**DCL      9433--IMP-SIZ
F$DCB.EOMCHAR#
      9389**DCL      9389--REDEF
F$DCB.FLDID
      9414**DCL      9414--REDEF
F$DCB.FORM$
      9408**DCL      9408--REDEF
F$DCB.FSECT
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:570  
      9424**DCL      9424--REDEF
F$DCB.FSN#
      9401**DCL      9401--REDEF    9401--REDEF    9402--REDEF
F$DCB.HEADER$
      9407**DCL      9407--REDEF
F$DCB.IXTNSIZE#
      9405**DCL      9405--REDEF
F$DCB.LASTSTA$
      9394**DCL      9394--REDEF
F$DCB.LVL
      9420**DCL      9420--REDEF
F$DCB.NAME#
      9395**DCL      9714>>ASSIGN
F$DCB.NAME#.C
      9395**DCL      9395--REDEF
F$DCB.NOEOF
      9417**DCL      9417--REDEF
F$DCB.NRECS#
      9406**DCL      9406--REDEF
F$DCB.NRECX
      9425**DCL      9425--REDEF
F$DCB.OHDR
      9417**DCL      9417--REDEF
F$DCB.ORG#
      9400**DCL      9400--REDEF
F$DCB.PRECNO
      9423**DCL      9423--REDEF
F$DCB.RCSZ
      9429**DCL      9429--REDEF
F$DCB.RES#
      9396**DCL      9396--REDEF
F$DCB.SETX
      9408**DCL      9408--REDEF
F$DCB.TAB$
      9408**DCL      9408--REDEF
F$DCB.TDA
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:571  
      9422**DCL      9423--REDEF
F$DCB.WSN#
      9396**DCL      9396--REDEF
FOUND_IT
      9701**LABEL    9696--GOTO
FREE$
      9575**DCL      9588>>IF       9603>>ASSIGN   9604<<ASSIGN   9645>>IF       9660>>ASSIGN   9661<<ASSIGN
      9730>>ASSIGN   9731<<ASSIGN
INIT_TIME_INFO
      9713**LABEL    9669--GOTO     9681--GOTO
INTERSYS$
      7222**DCL      7227--IMP-PTR
LINK1$
      9571**DCL      9621<<ASSIGN   9626>>DOWHILE  9627>>ASSIGN   9628<<ASSIGN   9628>>ASSIGN   9630>>ASSIGN
      9632>>IF       9634>>ASSIGN   9687<<ASSIGN   9692>>DOWHILE  9693>>IF       9697>>ASSIGN   9698<<ASSIGN
      9698>>ASSIGN   9701>>ASSIGN   9703>>IF       9705>>ASSIGN
LINK2$
      9572**DCL      9622<<ASSIGN   9627<<ASSIGN   9631>>ASSIGN   9635>>IF       9637>>ASSIGN   9688<<ASSIGN
      9697<<ASSIGN   9702>>ASSIGN   9706>>IF       9708>>ASSIGN
LOGON_FLAG
      9580**DCL         7--PROC     9606>>IF       9644--ENTRY    9719--ENTRY
MAX$
      9577**DCL      9593>>IF       9597<<ASSIGN   9597>>ASSIGN   9650>>IF       9654<<ASSIGN   9654>>ASSIGN
NO_MEMORY
      9639**LABEL    9596--CALLALT  9653--CALLALT
PTR$
      9569**DCL         7--PROC     9639<<ASSIGN   9644--ENTRY    9713<<ASSIGN   9714>>ASSIGN   9715>>ASSIGN
      9716>>ASSIGN   9719--ENTRY    9721>>ASSIGN   9722>>ASSIGN   9730>>ASSIGN   9731>>ASSIGN   9732>>IF
SAVEN$
      9578**DCL      9721<<ASSIGN   9723>>IF       9724>>ASSIGN   9726>>ASSIGN   9727>>IF       9733>>ASSIGN
SAVEP$
      9579**DCL      9722<<ASSIGN   9724>>ASSIGN   9725>>IF       9726>>ASSIGN   9727>>IF
SEG$
      9576**DCL      9590>>ASSIGN   9591<<ASSIGN   9591>>ASSIGN   9592>>ASSIGN   9593>>IF       9647>>ASSIGN
      9648<<ASSIGN   9648>>ASSIGN   9649>>ASSIGN   9650>>IF
STR.NEXT$
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:572  
      9582**DCL      9592<<ASSIGN   9649<<ASSIGN   9721>>ASSIGN   9726<<ASSIGN   9730<<ASSIGN
STR.PRIOR$
      9583**DCL      9722>>ASSIGN   9724<<ASSIGN
TIME$
      7221**DCL      7225--IMP-PTR
TIME_TABLE
      7225**DCL      9591--ASSIGN   9593--IF       9648--ASSIGN   9650--IF
TIME_TABLE.COUNT
      7226**DCL      9716<<ASSIGN
TIME_TABLE.NAME
      7226**DCL      9714<<ASSIGN
TIME_TABLE.NEXT$
      7225**DCL      9604>>ASSIGN   9613<<ASSIGN   9628>>ASSIGN   9630<<ASSIGN   9637<<ASSIGN   9661>>ASSIGN
      9667<<ASSIGN   9678<<ASSIGN   9698>>ASSIGN   9701<<ASSIGN   9708<<ASSIGN
TIME_TABLE.PRIOR$
      7225**DCL      9612<<ASSIGN   9631<<ASSIGN   9634<<ASSIGN   9666<<ASSIGN   9677<<ASSIGN   9679<<ASSIGN
      9702<<ASSIGN   9705<<ASSIGN
TIME_TABLE.TSTAMP
      7225**DCL      9674>>IF       9693>>IF       9715<<ASSIGN
VMA$ENLARGE_SEGMENT
      9574**DCL-ENT  9596--CALL     9653--CALL
VM_HEADER.DELIVERY_DATE
      9450**DCL      9674>>IF       9693>>IF       9715>>ASSIGN
VM_HEADER$
      7895**DCL      9445--IMP-PTR  9674>>IF       9693>>IF       9715>>ASSIGN
VM_INPUT_
      7928**DCL      9596<>CALL     9653<>CALL
VO_BNWIO.CGPARM.MSGIDXT
      7170**DCL      7173--REDEF
VO_BNWIO.CODE
      7139**DCL      7139--REDEF    7140--REDEF    7140--REDEF
VO_BNWIO.ERR.ERR#
      7141**DCL      7141--REDEF
VO_BNWIO.EVID
      7140**DCL      7140--REDEF    7140--REDEF
X$STRING.SIZ
PL6.E3A0      #006=VOM$ADDENTRY File=VOM$MAILMAN.:VMB6TSI                        WED 08/20/97 15:35 Page:573  
      7891**DCL      7892--IMP-SIZ
