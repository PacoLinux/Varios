VERSION E05

PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:1    
        1        1        /*M* SST$SSFTCB: MOVE SS FRAME TO TCB.       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        SST$SSFTCB: PROC(IC,ECC,ECINFO,SSFPTR$,TCBPTR$,HR_SIZE) ALTRET;
        8        8        %PLIST;
        9        9    1   DCL   IC SBIN;                          /*INSTRUCTION COUNTER FOR SS FRAME*/
       10       10    1   DCL   ECC UBIN(36);                     /* EXCEPTION COND CODE                */
       11       11    1   DCL   ECINFO (0:1) UBIN(36);            /* EXCEPTION COND INFO PTR            */
       12       12    1   DCL   SSFPTR$ PTR;                      /* SS FRAME POINTER                   */
       13       13    1   DCL   TCBPTR$ PTR;                      /* TCB POINTER                        */
       14       14    1   DCL   HR_SIZE UBIN;                     /* HIST REG SIZE (FROM SSU$DELTAGO)   */
       15       15        /*                                                                    */
       16       16    1   DCL   B$USERLS$ PTR SYMREF;
       17       17    1   DCL   B$CPLS$ PTR SYMREF;
       18       18    1   DCL   B$DBLS$ PTR SYMREF;
       19       19    1   DCL   B$ASLLS$ PTR SYMREF;
       20       20        /*                                                                    */
       21       21    1   DCL   TCB$ PTR;                         /* TEMP TCB POINTER                   */
       22       22    1   DCL   SSF$ PTR;                         /* TEMP SS FRAME POINTER              */
       23       23    1   DCL   STK$ PTR;                         /* TEMP STACK POINTER                 */
       24       24    1   DCL   D$ PTR;
       25       25    1   DCL   P UBIN;
       26       26    1   DCL   N UBIN;
       27       27    1   DCL   K UBIN;
       28       28    1   DCL OFF SBIN;
       29       29    1   DCL   EXCSZ UBIN(36);                   /* EXC COND INFO BLOCK SIZE           */
       30       30    1   DCL   FRAME64 (0:63) UBIN BASED;        /* ECC STACK FRAME                    */
       31       31    1   DCL   FRAMEV CHAR(K) BASED;             /* ECC COND INFO BLOCK                */
       32       32    1   DCL 1 EVFRM BASED,
       33       33    1         2 *(0:63) UBIN(36),
       34       34    1         2 DMAIN UBIN(18) UNAL,
       35       35    1         2 CODE UBIN(18) UNAL;
       36       36    1   DCL 1 TCB BASED ALIGNED,                /* TCB                                */
       37       37    1         2 ALTFR BIT(36) UNAL,             /* ALTRET FRAME PTR                   */
PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:2    
       38       38    1         2 CRFR UBIN(18) UNAL,             /* CUR STACK FRAME PTR                */
       39       39    1         2 SD UBIN(18) UNAL,
       40       40    1         2 UNUSZ UBIN(18) UNAL,            /* UNUSED STACK SPACE                 */
       41       41    1         2 CRSZ UBIN(18) UNAL;             /* CURRENT FRAME SIZE                 */
       42       42    1   DCL 1 B$TCB$ BASED ALIGNED,
       43       43    1         2 ALT$ PTR,
       44       44    1         2 STK$ PTR;
       45       45
       46       46    1   DCL 1 ECCFR ALIGNED BASED,              /* ECC FRAME                          */
       47       47    1         2 PRVSZ UBIN(18) UNAL,            /* PREVIOUS FRAME SIZE                */
       48       48    1         2 ECCODE UBIN(18) UNAL,           /* EXCEPTIONAL CONDITION CODE         */
       49       49    1         2 * BIT(36) UNAL,
       50       50    1         2 * BIT(72) UNAL,
       51       51    1         2 ICADR UBIN(18) UNAL,            /* INSTRUCTION COUNTER                */
       52       52    1         2 * BIT(18) UNAL;
       53       53        %INCLUDE B$SS;
       54      232        %INCLUDE B_ULSMAC_C;
       55     1341        %INCLUDE B_SEGIDS_C;
       56     1880        %B_USRULS (FPTN=B$ULS,STCLASS=BASED);
       57     2079        %INCLUDE B$USER;
       58     2295        %B$USERREFS;
       59     2299        %INCLUDE U$JIT_C;
       60     2798        %INCLUDE UE_CP6;
       61     3489        %SUB_ECCDELTA;
       62     3526        %SUB_EXC;
       63     3573    1   DCL B$JIT$ PTR SYMREF;
       64     3574        %SUB B$JIT=B$JIT$->B$JIT;
       65     3575        %EJECT;
PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:3    
       66     3576    1           SSF$=SSFPTR$;
       67     3577    1           TCB$=TCBPTR$;
       68     3578    1           OFF=-2; /* For B$DO (not DOCONT) we PINCR back 2 words */
       69     3579    1           IF ECC >= %ECC_TCBFULL# THEN STK$=PINCRW(TCB$,4); /* PTR TO ALTRET FRAME */
       70     3580    2           ELSE DO;
       71     3581    2                 IF TCB$->TCB.UNUSZ < 68+ECINFO(3) THEN GOTO ALTRT;
       72     3582    2                 STK$=PINCRW(TCB$,TCB$->TCB.CRFR+TCB$->TCB.CRSZ);
       73     3583    2              END;
       74     3584        /*                                                                    */
       75     3585    1           STK$->FRAME64=SSF$->FRAME64;
       76     3586        /*                                                                   */
       77     3587    1           D$=ADDR(ECINFO(0));
       78     3588    1           P=64;
       79     3589    1           EXCSZ=ECINFO(3)+4;
       80     3590    2           DO WHILE (EXCSZ > 0);
       81     3591    2              IF ECC = %ECC_EVENT# AND EXCSZ > SIZEW(B$DOCONT.ECCINFO)
       82     3592    3              THEN DO;
       83     3593    3                 N=SIZEW(B$DOCONT.ECCINFO);
       84     3594    3                 K=N;
       85     3595    3                 END;
       86     3596    3              ELSE DO;
       87     3597    3                 N=EXCSZ;
       88     3598    3                 K=N;
       89     3599    3                 IF ADDR(HR_SIZE)~=ADDR(NIL) AND  ECINFO(3)=0
       90     3600    4                 THEN DO;
       91     3601    4                    IF TCB$->TCB.UNUSZ >= 68+HR_SIZE
       92     3602    4                    THEN K=K+HR_SIZE;
       93     3603    4                    END;
       94     3604    3                 END;
       95     3605        /*                                                                            */
       96     3606    2              K=K*4;
       97     3607    2              PINCRW(STK$,P)->FRAMEV=D$->FRAMEV;
       98     3608        /*                                                                            */
       99     3609    2              P=P+N;
      100     3610    2              EXCSZ=EXCSZ-N;
      101     3611    2              IF ECC = %ECC_EVENT# AND EXCSZ > 0 THEN
      102     3612    3                 DO;
PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:4    
      103     3613    3                    D$=PINCRW(D$,OFF);
      104     3614                          /* FROM NOW ON (B$DOCONT) WE PINCR BACK 3 WORDS */
      105     3615    3                    OFF = (SIZEW(B$DOCONT.ECCINFO)-SIZEW(B$DO));
      106     3616    3                    D$=PINCRW(D$->B$DO.LNK$,(SIZEW(B$DO)-SIZEW(B$DOCONT.ECCINFO)));
      107     3617    3                 END;
      108     3618    2           END;
      109     3619    1           IF ECC = %ECC_EVENT# THEN STK$->EVFRM.DMAIN=0; /* CLEAR UPPER HALF OF CODE*/
      110     3620    1           IF IC ~= -1 THEN SSF$->ECCFR.ICADR=IC; /* INSTRUCTION COUNTER         */
      111     3621    1           SSF$->B$SS.IR.MIR = '0'B;
      112     3622    1           SSF$->B$SS.CPUREQ = '0'B;
      113     3623    1           SSF$->B$SS.IS_SEGID = %ISSID;
      114     3624    2           DO CASE(SSF$->B$SS.ISR.WSR);    /* INITIALIZE ISR FROM CURRENT LSEG   */
      115     3625    2            CASE(4);                       /* COMMAND PROCESSOR                  */
      116     3626    2              SSF$->B$SS.ISR=B$CPLS$->B$ULS.IS; /*                               */
      117     3627    2            CASE(5);                       /* DEBUGGER                           */
      118     3628    2              SSF$->B$SS.ISR=B$DBLS$->B$ULS.IS; /*                               */
      119     3629    2            CASE(6);                       /* SPECIAL LIBRARY                    */
      120     3630    2              SSF$->B$SS.ISR=B$ASLLS$->B$ULS.IS; /*                              */
      121     3631    2            CASE(7);                       /* USER                               */
      122     3632    2              SSF$->B$SS.ISR=B$USERLS$->B$ULS.IS; /*                             */
      123     3633    2            END;                           /* END ISR INITIALIZATION CASES       */
      124     3634    1           STK$->ECCFR.ECCODE=ECC;         /* EXC CODE TO ECCFRAME               */
      125     3635    2           IF ECC >= %ECC_TCBFULL# THEN DO;
      126     3636    2                 STK$->ECCFR.PRVSZ=0;      /* INDICATE USED                      */
      127     3637    2                 RETURN;
      128     3638    2              END;
      129     3639    1           TCB$->B$TCB$.STK$=PINCRW(TCB$->B$TCB$.STK$,TCB$->TCB.CRSZ);
      130     3640    1           STK$->ECCFR.PRVSZ=TCB$->TCB.CRSZ; /* PREV FR SIZE TO ECCFRAME         */
      131     3641    1           TCB$->TCB.CRSZ=68+ECINFO(3);    /* CUR SIZE TO TCB CONTROL WORD       */
      132     3642    1           TCB$->TCB.UNUSZ=TCB$->TCB.UNUSZ-68-ECINFO(3); /* UNUSED SIZE          */
      133     3643    1            B$JIT.ERR='0'B;
      134     3644    1           RETURN;
      135     3645    1   ALTRT:  ;
      136     3646    1           B$JIT.ERR=BINBIT(ECINFO(2),36);
      137     3647    1           ALTRETURN;
      138     3648                            /* CHANGE ALTRETURN TO CALL TO ABORTM WHEN XCON IS READY*/
      139     3649    1   END;
PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:5    

PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:6    
--  Include file information  --

   UE_CP6.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   U$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B_ULSMAC_C.:E05TOU  is referenced.
   B$SS.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure SST$SSFTCB.

   Procedure SST$SSFTCB requires 194 words for executable code.
   Procedure SST$SSFTCB requires 20 words of local(AUTO) storage.

    No errors detected in file SST$SSFTCB.:E05TSI    .

PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:7    

 Object Unit name= SST$SSFTCB                                 File name= SST$SSFTCB.:E05TOU
 UTS= JUL 30 '97 05:59:34.80 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none   194    302  SST$SSFTCB
    1  RoData even  none     2      2  SST$SSFTCB

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        6  SST$SSFTCB

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_N
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$USERLS$                             B$CPLS$                               B$DBLS$
     B$ASLLS$                              B$JIT$                                B_VECTNIL
PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:8    


        1        1        /*M* SST$SSFTCB: MOVE SS FRAME TO TCB.       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        SST$SSFTCB: PROC(IC,ECC,ECINFO,SSFPTR$,TCBPTR$,HR_SIZE) ALTRET;

      7  0 000000   000000 700200 xent  SST$SSFTCB   TSX0  ! X66_AUTO_N
         0 000001   000024 000006                    ZERO    20,6

        8        8        %PLIST;
        9        9    1   DCL   IC SBIN;                          /*INSTRUCTION COUNTER FOR SS FRAME*/
       10       10    1   DCL   ECC UBIN(36);                     /* EXCEPTION COND CODE                */
       11       11    1   DCL   ECINFO (0:1) UBIN(36);            /* EXCEPTION COND INFO PTR            */
       12       12    1   DCL   SSFPTR$ PTR;                      /* SS FRAME POINTER                   */
       13       13    1   DCL   TCBPTR$ PTR;                      /* TCB POINTER                        */
       14       14    1   DCL   HR_SIZE UBIN;                     /* HIST REG SIZE (FROM SSU$DELTAGO)   */
       15       15        /*                                                                    */
       16       16    1   DCL   B$USERLS$ PTR SYMREF;
       17       17    1   DCL   B$CPLS$ PTR SYMREF;
       18       18    1   DCL   B$DBLS$ PTR SYMREF;
       19       19    1   DCL   B$ASLLS$ PTR SYMREF;
       20       20        /*                                                                    */
       21       21    1   DCL   TCB$ PTR;                         /* TEMP TCB POINTER                   */
       22       22    1   DCL   SSF$ PTR;                         /* TEMP SS FRAME POINTER              */
       23       23    1   DCL   STK$ PTR;                         /* TEMP STACK POINTER                 */
       24       24    1   DCL   D$ PTR;
       25       25    1   DCL   P UBIN;
       26       26    1   DCL   N UBIN;
       27       27    1   DCL   K UBIN;
       28       28    1   DCL OFF SBIN;
       29       29    1   DCL   EXCSZ UBIN(36);                   /* EXC COND INFO BLOCK SIZE           */
       30       30    1   DCL   FRAME64 (0:63) UBIN BASED;        /* ECC STACK FRAME                    */
       31       31    1   DCL   FRAMEV CHAR(K) BASED;             /* ECC COND INFO BLOCK                */
       32       32    1   DCL 1 EVFRM BASED,
PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:9    
       33       33    1         2 *(0:63) UBIN(36),
       34       34    1         2 DMAIN UBIN(18) UNAL,
       35       35    1         2 CODE UBIN(18) UNAL;
       36       36    1   DCL 1 TCB BASED ALIGNED,                /* TCB                                */
       37       37    1         2 ALTFR BIT(36) UNAL,             /* ALTRET FRAME PTR                   */
       38       38    1         2 CRFR UBIN(18) UNAL,             /* CUR STACK FRAME PTR                */
       39       39    1         2 SD UBIN(18) UNAL,
       40       40    1         2 UNUSZ UBIN(18) UNAL,            /* UNUSED STACK SPACE                 */
       41       41    1         2 CRSZ UBIN(18) UNAL;             /* CURRENT FRAME SIZE                 */
       42       42    1   DCL 1 B$TCB$ BASED ALIGNED,
       43       43    1         2 ALT$ PTR,
       44       44    1         2 STK$ PTR;
       45       45
       46       46    1   DCL 1 ECCFR ALIGNED BASED,              /* ECC FRAME                          */
       47       47    1         2 PRVSZ UBIN(18) UNAL,            /* PREVIOUS FRAME SIZE                */
       48       48    1         2 ECCODE UBIN(18) UNAL,           /* EXCEPTIONAL CONDITION CODE         */
       49       49    1         2 * BIT(36) UNAL,
       50       50    1         2 * BIT(72) UNAL,
       51       51    1         2 ICADR UBIN(18) UNAL,            /* INSTRUCTION COUNTER                */
       52       52    1         2 * BIT(18) UNAL;
       53       53        %INCLUDE B$SS;
       54      232        %INCLUDE B_ULSMAC_C;
       55     1341        %INCLUDE B_SEGIDS_C;
       56     1880        %B_USRULS (FPTN=B$ULS,STCLASS=BASED);
       57     2079        %INCLUDE B$USER;
       58     2295        %B$USERREFS;
       59     2299        %INCLUDE U$JIT_C;
       60     2798        %INCLUDE UE_CP6;
       61     3489        %SUB_ECCDELTA;
       62     3526        %SUB_EXC;
       63     3573    1   DCL B$JIT$ PTR SYMREF;
       64     3574        %SUB B$JIT=B$JIT$->B$JIT;
       65     3575        %EJECT;
PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:10   
       66     3576    1           SSF$=SSFPTR$;

   3576  0 000002   200006 470500                    LDP0    @SSFPTR$,,AUTO
         0 000003   000000 236100                    LDQ     0,,PR0
         0 000004   200012 756100                    STQ     SSF$,,AUTO

       67     3577    1           TCB$=TCBPTR$;

   3577  0 000005   200007 471500                    LDP1    @TCBPTR$,,AUTO
         0 000006   100000 236100                    LDQ     0,,PR1
         0 000007   200011 756100                    STQ     TCB$,,AUTO

       68     3578    1           OFF=-2; /* For B$DO (not DOCONT) we PINCR back 2 words */

   3578  0 000010   000002 335007                    LCA     2,DL
         0 000011   200020 755100                    STA     OFF,,AUTO

       69     3579    1           IF ECC >= %ECC_TCBFULL# THEN STK$=PINCRW(TCB$,4); /* PTR TO ALTRET FRAME */

   3579  0 000012   200004 473500                    LDP3    @ECC,,AUTO
         0 000013   300000 235100                    LDA     0,,PR3
         0 000014   000142 115007                    CMPA    98,DL
         0 000015   000021 602000 0                  TNC     s:3581

   3579  0 000016   000004 036003                    ADLQ    4,DU
         0 000017   200013 756100                    STQ     STK$,,AUTO
         0 000020   000043 710000 0                  TRA     s:3585

       70     3580    2           ELSE DO;

       71     3581    2                 IF TCB$->TCB.UNUSZ < 68+ECINFO(3) THEN GOTO ALTRT;

   3581  0 000021   200005 474500                    LDP4    @ECINFO,,AUTO
         0 000022   400003 235100                    LDA     3,,PR4
         0 000023   000104 035007                    ADLA    68,DL
         0 000024   200022 755100                    STA     EXCSZ+1,,AUTO
         0 000025   200011 475500                    LDP5    TCB$,,AUTO
PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:11   
         0 000026   500002 236100                    LDQ     2,,PR5
         0 000027   000022 772000                    QRL     18
         0 000030   200022 116100                    CMPQ    EXCSZ+1,,AUTO
         0 000031   000276 602000 0                  TNC     ALTRT

       72     3582    2                 STK$=PINCRW(TCB$,TCB$->TCB.CRFR+TCB$->TCB.CRSZ);

   3582  0 000032   500002 236100                    LDQ     2,,PR5
         0 000033   777777 376007                    ANQ     -1,DL
         0 000034   200022 756100                    STQ     EXCSZ+1,,AUTO
         0 000035   500001 236100                    LDQ     1,,PR5
         0 000036   000022 772000                    QRL     18
         0 000037   200022 036100                    ADLQ    EXCSZ+1,,AUTO
         0 000040   000022 736000                    QLS     18
         0 000041   200011 036100                    ADLQ    TCB$,,AUTO
         0 000042   200013 756100                    STQ     STK$,,AUTO

       73     3583    2              END;

       74     3584        /*                                                                    */
       75     3585    1           STK$->FRAME64=SSF$->FRAME64;

   3585  0 000043   200012 474500                    LDP4    SSF$,,AUTO
         0 000044   200013 475500                    LDP5    STK$,,AUTO
         0 000045   000100 100500                    MLR     fill='000'O
         0 000046   400000 000400                    ADSC9   0,,PR4                   cn=0,n=256
         0 000047   500000 000400                    ADSC9   0,,PR5                   cn=0,n=256

       76     3586        /*                                                                   */
       77     3587    1           D$=ADDR(ECINFO(0));

   3587  0 000050   200005 236100                    LDQ     @ECINFO,,AUTO
         0 000051   200014 756100                    STQ     D$,,AUTO

       78     3588    1           P=64;

   3588  0 000052   000100 235007                    LDA     64,DL
PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:12   
         0 000053   200015 755100                    STA     P,,AUTO

       79     3589    1           EXCSZ=ECINFO(3)+4;

   3589  0 000054   200005 476500                    LDP6    @ECINFO,,AUTO
         0 000055   600003 235100                    LDA     3,,PR6
         0 000056   000004 035007                    ADLA    4,DL
         0 000057   200021 755100                    STA     EXCSZ,,AUTO

       80     3590    2           DO WHILE (EXCSZ > 0);

   3590  0 000060   000164 600000 0                  TZE     s:3619

       81     3591    2              IF ECC = %ECC_EVENT# AND EXCSZ > SIZEW(B$DOCONT.ECCINFO)

   3591  0 000061   200004 470500                    LDP0    @ECC,,AUTO
         0 000062   000000 235100                    LDA     0,,PR0
         0 000063   000001 115007                    CMPA    1,DL
         0 000064   000074 601000 0                  TNZ     s:3597
         0 000065   200021 236100                    LDQ     EXCSZ,,AUTO
         0 000066   000012 116007                    CMPQ    10,DL
         0 000067   000074 602000 0                  TNC     s:3597

       82     3592    3              THEN DO;

       83     3593    3                 N=SIZEW(B$DOCONT.ECCINFO);

   3593  0 000070   000011 235007                    LDA     9,DL
         0 000071   200016 755100                    STA     N,,AUTO

       84     3594    3                 K=N;

   3594  0 000072   200017 755100                    STA     K,,AUTO

       85     3595    3                 END;

   3595  0 000073   000121 710000 0                  TRA     s:3606
PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:13   

       86     3596    3              ELSE DO;

       87     3597    3                 N=EXCSZ;

   3597  0 000074   200021 236100                    LDQ     EXCSZ,,AUTO
         0 000075   200016 756100                    STQ     N,,AUTO

       88     3598    3                 K=N;

   3598  0 000076   200017 756100                    STQ     K,,AUTO

       89     3599    3                 IF ADDR(HR_SIZE)~=ADDR(NIL) AND  ECINFO(3)=0

   3599  0 000077   200010 236100                    LDQ     @HR_SIZE,,AUTO
         0 000100   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000101   000121 600000 0                  TZE     s:3606
         0 000102   200005 471500                    LDP1    @ECINFO,,AUTO
         0 000103   100003 235100                    LDA     3,,PR1
         0 000104   000121 601000 0                  TNZ     s:3606

       90     3600    4                 THEN DO;

       91     3601    4                    IF TCB$->TCB.UNUSZ >= 68+HR_SIZE

   3601  0 000105   200010 473500                    LDP3    @HR_SIZE,,AUTO
         0 000106   300000 235100                    LDA     0,,PR3
         0 000107   000104 035007                    ADLA    68,DL
         0 000110   200022 755100                    STA     EXCSZ+1,,AUTO
         0 000111   200011 474500                    LDP4    TCB$,,AUTO
         0 000112   400002 236100                    LDQ     2,,PR4
         0 000113   000022 772000                    QRL     18
         0 000114   200022 116100                    CMPQ    EXCSZ+1,,AUTO
         0 000115   000121 602000 0                  TNC     s:3606

       92     3602    4                    THEN K=K+HR_SIZE;

PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:14   
   3602  0 000116   200017 236100                    LDQ     K,,AUTO
         0 000117   300000 036100                    ADLQ    0,,PR3
         0 000120   200017 756100                    STQ     K,,AUTO

       93     3603    4                    END;

       94     3604    3                 END;

       95     3605        /*                                                                            */
       96     3606    2              K=K*4;

   3606  0 000121   200017 235100                    LDA     K,,AUTO
         0 000122   000002 735000                    ALS     2
         0 000123   200017 755100                    STA     K,,AUTO

       97     3607    2              PINCRW(STK$,P)->FRAMEV=D$->FRAMEV;

   3607  0 000124   200015 236100                    LDQ     P,,AUTO
         0 000125   000002 736000                    QLS     2
         0 000126   200014 471500                    LDP1    D$,,AUTO
         0 000127   000000 620005                    EAX0    0,AL
         0 000130   200013 473500                    LDP3    STK$,,AUTO
         0 000131   200017 721100                    LXL1    K,,AUTO
         0 000132   040146 100540                    MLR     fill='040'O
         0 000133   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         0 000134   300000 000011                    ADSC9   0,Q,PR3                  cn=0,n=*X1

       98     3608        /*                                                                            */
       99     3609    2              P=P+N;

   3609  0 000135   200015 236100                    LDQ     P,,AUTO
         0 000136   200016 036100                    ADLQ    N,,AUTO
         0 000137   200015 756100                    STQ     P,,AUTO

      100     3610    2              EXCSZ=EXCSZ-N;

   3610  0 000140   200021 236100                    LDQ     EXCSZ,,AUTO
PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:15   
         0 000141   200016 136100                    SBLQ    N,,AUTO
         0 000142   200021 756100                    STQ     EXCSZ,,AUTO

      101     3611    2              IF ECC = %ECC_EVENT# AND EXCSZ > 0 THEN

   3611  0 000143   000000 235100                    LDA     0,,PR0
         0 000144   000001 115007                    CMPA    1,DL
         0 000145   000162 601000 0                  TNZ     s:3618
         0 000146   000000 116003                    CMPQ    0,DU
         0 000147   000162 600000 0                  TZE     s:3618

      102     3612    3                 DO;

      103     3613    3                    D$=PINCRW(D$,OFF);

   3613  0 000150   200020 236100                    LDQ     OFF,,AUTO
         0 000151   000022 736000                    QLS     18
         0 000152   200014 036100                    ADLQ    D$,,AUTO
         0 000153   200014 756100                    STQ     D$,,AUTO

      104     3614                          /* FROM NOW ON (B$DOCONT) WE PINCR BACK 3 WORDS */
      105     3615    3                    OFF = (SIZEW(B$DOCONT.ECCINFO)-SIZEW(B$DO));

   3615  0 000154   000003 335007                    LCA     3,DL
         0 000155   200020 755100                    STA     OFF,,AUTO

      106     3616    3                    D$=PINCRW(D$->B$DO.LNK$,(SIZEW(B$DO)-SIZEW(B$DOCONT.ECCINFO)));

   3616  0 000156   200014 471500                    LDP1    D$,,AUTO
         0 000157   100000 236100                    LDQ     0,,PR1
         0 000160   000003 036003                    ADLQ    3,DU
         0 000161   200014 756100                    STQ     D$,,AUTO

      107     3617    3                 END;

      108     3618    2           END;

PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:16   
   3618  0 000162   200021 235100                    LDA     EXCSZ,,AUTO
         0 000163   000061 601000 0                  TNZ     s:3591

      109     3619    1          IF ECC = %ECC_EVENT# THEN STK$->EVFRM.DMAIN=0; /* CLEAR UPPER HALF OF CODE*/

   3619  0 000164   200004 470500                    LDP0    @ECC,,AUTO
         0 000165   000000 235100                    LDA     0,,PR0
         0 000166   000001 115007                    CMPA    1,DL
         0 000167   000173 601000 0                  TNZ     s:3620

   3619  0 000170   000000 220003                    LDX0    0,DU
         0 000171   200013 471500                    LDP1    STK$,,AUTO
         0 000172   100100 740100                    STX0    64,,PR1

      110     3620    1           IF IC ~= -1 THEN SSF$->ECCFR.ICADR=IC; /* INSTRUCTION COUNTER         */

   3620  0 000173   200003 471500                    LDP1    @IC,,AUTO
         0 000174   100000 235100                    LDA     0,,PR1
         0 000175   000027 115000 xsym               CMPA    B_VECTNIL+23
         0 000176   000202 600000 0                  TZE     s:3621

   3620  0 000177   100000 720100                    LXL0    0,,PR1
         0 000200   200012 473500                    LDP3    SSF$,,AUTO
         0 000201   300004 740100                    STX0    4,,PR3

      111     3621    1           SSF$->B$SS.IR.MIR = '0'B;

   3621  0 000202   200012 473500                    LDP3    SSF$,,AUTO
         0 000203   000000 236000 1                  LDQ     0
         0 000204   300004 356100                    ANSQ    4,,PR3

      112     3622    1           SSF$->B$SS.CPUREQ = '0'B;

   3622  0 000205   000001 236000 1                  LDQ     1
         0 000206   300006 356100                    ANSQ    6,,PR3

      113     3623    1           SSF$->B$SS.IS_SEGID = %ISSID;
PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:17   

   3623  0 000207   006000 236007                    LDQ     3072,DL
         0 000210   300005 752103                    STCQ    5,'03'O,PR3

      114     3624    2           DO CASE(SSF$->B$SS.ISR.WSR);    /* INITIALIZE ISR FROM CURRENT LSEG   */

   3624  0 000211   300010 236100                    LDQ     8,,PR3
         0 000212   000004 772000                    QRL     4
         0 000213   000007 376007                    ANQ     7,DL
         0 000214   000004 136007                    SBLQ    4,DL
         0 000215   000004 116007                    CMPQ    4,DL
         0 000216   000220 602006 0                  TNC     s:3624+7,QL
         0 000217   000243 710000 0                  TRA     s:3634
         0 000220   000224 710000 0                  TRA     s:3626
         0 000221   000230 710000 0                  TRA     s:3628
         0 000222   000234 710000 0                  TRA     s:3630
         0 000223   000240 710000 0                  TRA     s:3632

      115     3625    2            CASE(4);                       /* COMMAND PROCESSOR                  */

      116     3626    2              SSF$->B$SS.ISR=B$CPLS$->B$ULS.IS; /*                               */

   3626  0 000224   000000 474400 xsym               LDP4    B$CPLS$
         0 000225   400000 237100                    LDAQ    0,,PR4
         0 000226   300010 757100                    STAQ    8,,PR3
         0 000227   000243 710000 0                  TRA     s:3634

      117     3627    2            CASE(5);                       /* DEBUGGER                           */

      118     3628    2              SSF$->B$SS.ISR=B$DBLS$->B$ULS.IS; /*                               */

   3628  0 000230   000000 474400 xsym               LDP4    B$DBLS$
         0 000231   400000 237100                    LDAQ    0,,PR4
         0 000232   300010 757100                    STAQ    8,,PR3
         0 000233   000243 710000 0                  TRA     s:3634

      119     3629    2            CASE(6);                       /* SPECIAL LIBRARY                    */
PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:18   

      120     3630    2              SSF$->B$SS.ISR=B$ASLLS$->B$ULS.IS; /*                              */

   3630  0 000234   000000 474400 xsym               LDP4    B$ASLLS$
         0 000235   400000 237100                    LDAQ    0,,PR4
         0 000236   300010 757100                    STAQ    8,,PR3
         0 000237   000243 710000 0                  TRA     s:3634

      121     3631    2            CASE(7);                       /* USER                               */

      122     3632    2              SSF$->B$SS.ISR=B$USERLS$->B$ULS.IS; /*                             */

   3632  0 000240   000000 474400 xsym               LDP4    B$USERLS$
         0 000241   400000 237100                    LDAQ    0,,PR4
         0 000242   300010 757100                    STAQ    8,,PR3

      123     3633    2            END;                           /* END ISR INITIALIZATION CASES       */

      124     3634    1           STK$->ECCFR.ECCODE=ECC;         /* EXC CODE TO ECCFRAME               */

   3634  0 000243   000000 720100                    LXL0    0,,PR0
         0 000244   200013 474500                    LDP4    STK$,,AUTO
         0 000245   400000 440100                    SXL0    0,,PR4

      125     3635    2           IF ECC >= %ECC_TCBFULL# THEN DO;

   3635  0 000246   000000 235100                    LDA     0,,PR0
         0 000247   000142 115007                    CMPA    98,DL
         0 000250   000254 602000 0                  TNC     s:3639

      126     3636    2                 STK$->ECCFR.PRVSZ=0;      /* INDICATE USED                      */

   3636  0 000251   000000 221003                    LDX1    0,DU
         0 000252   400000 741100                    STX1    0,,PR4

      127     3637    2                 RETURN;

PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:19   
   3637  0 000253   000000 702200 xent               TSX2  ! X66_ARET

      128     3638    2              END;
      129     3639    1           TCB$->B$TCB$.STK$=PINCRW(TCB$->B$TCB$.STK$,TCB$->TCB.CRSZ);

   3639  0 000254   200011 475500                    LDP5    TCB$,,AUTO
         0 000255   500002 721100                    LXL1    2,,PR5
         0 000256   500001 476500                    LDP6    1,,PR5
         0 000257   600000 637511                    EPPR7   0,X1,PR6
         0 000260   500001 457500                    STP7    1,,PR5

      130     3640    1           STK$->ECCFR.PRVSZ=TCB$->TCB.CRSZ; /* PREV FR SIZE TO ECCFRAME         */

   3640  0 000261   400000 741100                    STX1    0,,PR4

      131     3641    1           TCB$->TCB.CRSZ=68+ECINFO(3);    /* CUR SIZE TO TCB CONTROL WORD       */

   3641  0 000262   200005 476500                    LDP6    @ECINFO,,AUTO
         0 000263   600003 720100                    LXL0    3,,PR6
         0 000264   000104 622010                    EAX2    68,X0
         0 000265   500002 442100                    SXL2    2,,PR5

      132     3642    1           TCB$->TCB.UNUSZ=TCB$->TCB.UNUSZ-68-ECINFO(3); /* UNUSED SIZE          */

   3642  0 000266   500002 236100                    LDQ     2,,PR5
         0 000267   000022 772000                    QRL     18
         0 000270   600003 136100                    SBLQ    3,,PR6
         0 000271   777674 620006                    EAX0    -68,QL
         0 000272   500002 740100                    STX0    2,,PR5

      133     3643    1            B$JIT.ERR='0'B;

   3643  0 000273   000000 477400 xsym               LDP7    B$JIT$
         0 000274   700012 450100                    STZ     10,,PR7

      134     3644    1           RETURN;

PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:20   
   3644  0 000275   000000 702200 xent               TSX2  ! X66_ARET

   3643  0 000276                       ALTRT        null
      135     3645    1   ALTRT:  ;
      136     3646    1           B$JIT.ERR=BINBIT(ECINFO(2),36);

   3646  0 000276   400002 236100                    LDQ     2,,PR4
         0 000277   000000 476400 xsym               LDP6    B$JIT$
         0 000300   600012 756100                    STQ     10,,PR6

      137     3647    1           ALTRETURN;

   3647  0 000301   000000 702200 xent               TSX2  ! X66_AALT

(unnamed)
 Sect OctLoc
   1     000   777777 777737   777777 377777                                    ........
      138     3648                            /* CHANGE ALTRETURN TO CALL TO ABORTM WHEN XCON IS READY*/
      139     3649    1   END;

PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:21   
--  Include file information  --

   UE_CP6.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   U$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B_ULSMAC_C.:E05TOU  is referenced.
   B$SS.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure SST$SSFTCB.
PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:22   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @ECC                       5-0-0/w PTR         r     1 @ECINFO
    10-0-0/w PTR         r     1 @HR_SIZE                   3-0-0/w PTR         r     1 @IC
     6-0-0/w PTR         r     1 @SSFPTR$                   7-0-0/w PTR         r     1 @TCBPTR$
    14-0-0/w PTR         r     1 D$                        *0-0-0/w UBIN        r     1 ECC
    *0-0-0/w UBIN        r     1 ECINFO(0:1)               21-0-0/w UBIN        r     1 EXCSZ
    *0-0-0/w UBIN        r     1 HR_SIZE                   *0-0-0/w SBIN        r     1 IC
    17-0-0/w UBIN        r     1 K                         16-0-0/w UBIN        r     1 N
    20-0-0/w SBIN        r     1 OFF                       15-0-0/w UBIN        r     1 P
    12-0-0/w PTR         r     1 SSF$                      *0-0-0/w PTR         r     1 SSFPTR$
    13-0-0/w PTR         r     1 STK$                      11-0-0/w PTR         r     1 TCB$
    *0-0-0/w PTR         r     1 TCBPTR$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$ASLLS$                   0-0-0/w PTR         r     1 B$CPLS$
     0-0-0/w PTR         r     1 B$DBLS$                    0-0-0/w PTR         r     1 B$JIT$
     0-0-0/w PTR         r     1 B$USERLS$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(396)   r     1 B$DO                       0-0-0/d STRC(432)   r     1 B$DOCONT
     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d STRC(2304)  r     1 B$SS
     0-0-0/w STRC(72)    r     1 B$TCB$                     0-0-0/d STRC(2592)  r     1 B$ULS
     0-0-0/w STRC(180)   r     1 ECCFR                      0-0-0/w STRC(2340)  r     1 EVFRM
PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:23   
     0-0-0/w UBIN        r     1 FRAME64(0:63)              0-0-0/c ACHR        r     1 FRAMEV
     0-0-0/w STRC(108)   r     1 TCB


   Procedure SST$SSFTCB requires 194 words for executable code.
   Procedure SST$SSFTCB requires 20 words of local(AUTO) storage.

    No errors detected in file SST$SSFTCB.:E05TSI    .
PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:24   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:25   
          MINI XREF LISTING

ALTRT
      3643**LABEL    3581--GOTO
B$ASLLS$
        19**DCL      3630>>ASSIGN
B$CPLS$
        17**DCL      3626>>ASSIGN
B$DBLS$
        18**DCL      3628>>ASSIGN
B$DO
      2214**DCL      3615--ASSIGN   3616--ASSIGN
B$DO.ECCINFO
      2230**DCL      2231--REDEF
B$DO.LNK$
      2215**DCL      3616>>ASSIGN
B$DOCONT.ECCINFO
      2247**DCL      3591--IF       3593--ASSIGN   3615--ASSIGN   3616--ASSIGN
B$JIT.CPFLAGS1.SLEAZE
      2720**DCL      2720--REDEF
B$JIT.ERR
      2626**DCL      3643<<ASSIGN   3646<<ASSIGN
B$JIT.ERR.MID
      2627**DCL      2627--REDEF
B$JIT$
      3573**DCL      2621--IMP-PTR  3643>>ASSIGN   3646>>ASSIGN
B$SS.CPUREQ
       101**DCL      3622<<ASSIGN
B$SS.IR.MIR
        86**DCL      3621<<ASSIGN
B$SS.ISR
       107**DCL      3626<<ASSIGN   3628<<ASSIGN   3630<<ASSIGN   3632<<ASSIGN
B$SS.ISR.WSR
       110**DCL      3624>>DOCASE
PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:26   
B$SS.IS_SEGID
        98**DCL      3623<<ASSIGN
B$SS.RVA
       105**DCL       106--REDEF
B$TCB$.STK$
        44**DCL      3639<<ASSIGN   3639>>ASSIGN
B$U.MISC
      2209**DCL      2210--REDEF
B$ULS.IS
      1898**DCL      3626>>ASSIGN   3628>>ASSIGN   3630>>ASSIGN   3632>>ASSIGN
B$USER.MISC
      2285**DCL      2286--REDEF
B$USERLS$
        16**DCL      3632>>ASSIGN
D$
        24**DCL      3587<<ASSIGN   3607>>ASSIGN   3613<<ASSIGN   3613>>ASSIGN   3616<<ASSIGN   3616>>ASSIGN
ECC
        10**DCL         7--PROC     3579>>IF       3591>>IF       3611>>IF       3619>>IF       3634>>ASSIGN
      3635>>IF
ECCFR.ECCODE
        48**DCL      3634<<ASSIGN
ECCFR.ICADR
        51**DCL      3620<<ASSIGN
ECCFR.PRVSZ
        47**DCL      3636<<ASSIGN   3640<<ASSIGN
ECINFO
        11**DCL         7--PROC     3581>>IF       3587--ASSIGN   3589>>ASSIGN   3599>>IF       3641>>ASSIGN
      3642>>ASSIGN   3646>>ASSIGN
EVFRM.DMAIN
        34**DCL      3619<<ASSIGN
EXCSZ
        29**DCL      3589<<ASSIGN   3590>>DOWHILE  3591>>IF       3597>>ASSIGN   3610<<ASSIGN   3610>>ASSIGN
      3611>>IF
FRAME64
        30**DCL      3585<<ASSIGN   3585>>ASSIGN
FRAMEV
PL6.E3A0      #001=SST$SSFTCB File=SST$SSFTCB.:E05TSI                            WED 07/30/97 05:59 Page:27   
        31**DCL      3607<<ASSIGN   3607>>ASSIGN
HR_SIZE
        14**DCL         7--PROC     3599--IF       3601>>IF       3602>>ASSIGN
IC
         9**DCL         7--PROC     3620>>IF       3620>>ASSIGN
K
        27**DCL        31--IMP-SIZ  3594<<ASSIGN   3598<<ASSIGN   3602<<ASSIGN   3602>>ASSIGN   3606<<ASSIGN
      3606>>ASSIGN   3607>>ASSIGN   3607>>ASSIGN
N
        26**DCL      3593<<ASSIGN   3594>>ASSIGN   3597<<ASSIGN   3598>>ASSIGN   3609>>ASSIGN   3610>>ASSIGN
OFF
        28**DCL      3578<<ASSIGN   3613>>ASSIGN   3615<<ASSIGN
P
        25**DCL      3588<<ASSIGN   3607>>ASSIGN   3609<<ASSIGN   3609>>ASSIGN
SSF$
        22**DCL      3576<<ASSIGN   3585>>ASSIGN   3620>>ASSIGN   3621>>ASSIGN   3622>>ASSIGN   3623>>ASSIGN
      3624>>DOCASE   3626>>ASSIGN   3628>>ASSIGN   3630>>ASSIGN   3632>>ASSIGN
SSFPTR$
        12**DCL         7--PROC     3576>>ASSIGN
STK$
        23**DCL      3579<<ASSIGN   3582<<ASSIGN   3585>>ASSIGN   3607>>ASSIGN   3619>>ASSIGN   3634>>ASSIGN
      3636>>ASSIGN   3640>>ASSIGN
TCB.CRFR
        38**DCL      3582>>ASSIGN
TCB.CRSZ
        41**DCL      3582>>ASSIGN   3639>>ASSIGN   3640>>ASSIGN   3641<<ASSIGN
TCB.UNUSZ
        40**DCL      3581>>IF       3601>>IF       3642<<ASSIGN   3642>>ASSIGN
TCB$
        21**DCL      3577<<ASSIGN   3579>>ASSIGN   3581>>IF       3582>>ASSIGN   3582>>ASSIGN   3582>>ASSIGN
      3601>>IF       3639>>ASSIGN   3639>>ASSIGN   3639>>ASSIGN   3640>>ASSIGN   3641>>ASSIGN   3642>>ASSIGN
      3642>>ASSIGN
TCBPTR$
        13**DCL         7--PROC     3577>>ASSIGN
