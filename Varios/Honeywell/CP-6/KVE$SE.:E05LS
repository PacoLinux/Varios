VERSION E05

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:1    
        1        1        /*M* KVE$SE - Various bits of code used to support screen editor mode.       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
        8        8        KVE$SE: PROC(PRM_INPOPR_DUMMY) ALTRET;
        9        9
       10       10        %INCLUDE LCP_6;
       11      201 S      %INCLUDE KV$GLB;
       12      202 S      %INCLUDE KV$GLBCTX;
       13      203        %INCLUDE KV$INPFNC;
       14      762        %KV_INPPRC_E;
       15      814 S      %INCLUDE KV$INT;
       16      815 S      %INCLUDE KV$USR;
       17      816 S      %INCLUDE KV$SND;
       18      817        %KV_SND_FNC_E;
       19      833 S      %INCLUDE KV$VDH;
       20      834 S      %INCLUDE KV$VDO;
       21      835        %KV_DATCTRCHRTYP_E;
       22      841        %KV_VDOVLP_E;
       23      855        %INCLUDE KV$VDP;
       24     1013        %INCLUDE F_ERRORS_C;
       25     1253        %INCLUDE KV_ERRORS_C;
       26     1313 S      %INCLUDE KV_GLBCNS_E;
       27     1314        %KV#DATMOD_E;
       28     1320        %KV#VD_ORG_E;
       29     1328        %KV_PHSPSTMOD_E;
       30     1335        %KV_STRTYP_E;
       31     1373        %KV_USR_EVT_ID_E;
       32     1393        %KV$MRD;
       33     1440        %KV$MVD;
       34     1484        %KV$PTR;
       35     1527        %KV$RCR (STCLASS="BASED(Y@RCR$)");
       36     1557        %EQU KV_RCR=CHARTEXT('KV$RCR');
       37     1558        %KV$RCRLST (STCLASS="BASED(Y@RCRLST$)");
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:2    
       38     1594        %EQU KV_RCRLST=CHARTEXT('KV$RCRLST');
       39     1595        %KV$RCVVDO (NAME=KV_RCVVDO, STCLASS="BASED(KV$RCVVDO$)");
       40     1736    1   DCL KV$RCVVDO$ PTR SYMREF;
       41     1737        %KV$SRD (STCLASS="BASED(Y@SRD$)");
       42     2012        %EQU KV_SRD = CHARTEXT('KV$SRD');
       43     2013        %KV$SSN (STCLASS="BASED(Y@SSN$)");
       44     2092        %EQU KV_SSN=CHARTEXT('KV$SSN');
       45     2093        %KV$STR (STCLASS="BASED(Y@STR$)");
       46     2180        %EQU KV_STR=CHARTEXT('KV$STR');
       47     2181        %KV$TITLE;
       48     2229        %KV$VDI;
       49     2300        %KV$VDOVLP;
       50     2336        %KV$VDOVLP_ERR;
       51     2433
       52     2434        /*
       53     2435           ENTREFS
       54     2436        */
       55     2437    1   DCL KVI$EDTX_TO_VRTCLM ENTRY(1);
       56     2438    1   DCL KVI$PRGRED ENTRY;
       57     2439    1   DCL KVI$RE_DSPINP ENTRY;
       58     2440    1   DCL KVI$RQSDAT ENTRY(1);
       59     2441    1   DCL KVI$SHFDSPPST ENTRY(1);
       60     2442    1   DCL KVI$SHFTO_DFL ENTRY;
       61     2443    1   DCL KVI$TRMRED_VDH_DAT ENTRY(1);
       62     2444    1   DCL KVM$SND ENTRY(1) ALTRET;
       63     2445    1   DCL KVO$ERSTO_ENDOF_INP ENTRY;
       64     2446    1   DCL KVO$ERSTO_ENDOF_SRD ENTRY;
       65     2447    1   DCL KVO$OTPLCL ENTRY(1);
       66     2448    1   DCL KVO$PST ENTRY(1);
       67     2449    1   DCL KVS$GETBFR ENTRY(1) ALTRET;
       68     2450    1   DCL KVS$GETREDBFR ENTRY(1) ALTRET;
       69     2451    1   DCL KVS$RLSBFR ENTRY(1) ALTRET;
       70     2452    1   DCL KVV$CALUSR ENTRY(1) ALTRET;
       71     2453    1   DCL KVV$CALUSR_EVT ENTRY(1) ALTRET;
       72     2454    1   DCL KVV$CALUSR_PST ENTRY ALTRET;
       73     2455    1   DCL KVV$VDIINT ENTRY(1) ALTRET;
       74     2456    1   DCL KV_VDH_PST_VRT SBIN SYMREF;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:3    
       75     2457    1   DCL KV_VDH_PST_HOM SBIN SYMREF;
       76     2458        /* Local storage */
       77     2459    1   DCL Y@RCRLST$ PTR;
       78     2460    1   DCL Y@KEY$ PTR;
       79     2461    1   DCL Y@RCR$ PTR;
       80     2462    1   DCL Y@SRD$ PTR;
       81     2463    1   DCL Y@SSN$ PTR;
       82     2464    1   DCL Y@STR$ PTR;
       83     2465    1   DCL Y@KEYCMP SBIN;
       84     2466    1   DCL Y@KEYCMPU REDEF Y@KEYCMP UBIN;
       85     2467    1   DCL Y@REDLIN REDEF Y@KEYCMP SBIN;
       86     2468    1   DCL Y@KEYLNG SBIN;
       87     2469    1   DCL Y@SRHHI SBIN;
       88     2470    1   DCL Y@DLTRCR REDEF Y@SRHHI SBIN;
       89     2471    1   DCL Y@VRTLIN REDEF Y@SRHHI SBIN;
       90     2472    1   DCL Y@KEYINC REDEF Y@SRHHI UBIN;
       91     2473    1   DCL Y@SRHLO SBIN;
       92     2474    1   DCL Y@BFRSIZ REDEF Y@SRHLO SBIN;
       93     2475    1   DCL Y@SRHCUR SBIN;
       94     2476    1   DCL Y@TMP32 UBIN(32);
       95     2477    1   DCL 1 Y@TMP32B REDEF Y@TMP32,
       96     2478    1          2 TOP SBIN,
       97     2479    1          2 BTM SBIN;
       98     2480    1   DCL Y@VRTSCRMRG SBIN;
       99     2481    1   DCL Y@VRTSCRSHF SBIN;
      100     2482    1   DCL Y@LINCNT SBIN;
      101     2483        %KV$USR_PST (NAME=KV_USR_PST, STCLASS=SYMREF);
      102     2553        %KV$USR_PST (NAME=KV@USR_PST, STCLASS=AUTO);
      103     2623        %KV$USR_RQSDAT (NAME=KV@USR_RQSDAT, STCLASS=AUTO);
      104     2686        %KV$USR_RQSDAT (NAME=KV_USR_RQSDAT, STCLASS=SYMREF);
      105     2749    1   DCL KV_VDH_DAT UBIN SYMREF;
      106     2750        %KV$VDH_GETBFR (NAME=KV@VDH_GETBFR, STCLASS=AUTO);
      107     2815        %KV$VDH_OTPLCL (NAME=KV@VDH_OTPLCL, STCLASS=AUTO);
      108     2888        %KV$VDH_OTPLCL (NAME=Y_VDH_OTPLCL, STCLASS=CONSTANT, NO_WRAP=YES);
      109     2961        %KV$VDH_GETBFR (NAME=Y_VDH_GETBFR, STCLASS=CONSTANT, STRTYP=%KV_STRTYP_RCR);
      110     3026    1   DCL Y_LTLKEY UBIN(32) CONSTANT INIT(0);
      111     3027    1   DCL Y_BIGKEY SBIN(32) CONSTANT INIT(-1);
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:4    
      112     3028        /*
      113     3029           Handy based stuff.
      114     3030        */
      115     3031    1   DCL CHARS CHAR(8) BASED;
      116     3032    1   DCL KEYU1 BASED ALIGNED UBIN(8);
      117     3033    1   DCL KEYU2 BASED ALIGNED UBIN;
      118     3034    1   DCL KEYU3 BASED ALIGNED UBIN(24);
      119     3035    1   DCL KEYU4 BASED ALIGNED UBIN(32);
      120     3036    1   DCL RCR_BYT(0:0) BASED CALIGNED SBIN BYTE;
      121     3037        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:5    
      122     3038        /*
      123     3039           Parameter(s)
      124     3040        */
      125     3041        %KV$INPOPR (NAME=PRM_INPOPR, STCLASS=PARAM);
      126     3140        %KV$USR_RQSDAT (NAME=PRM_RQSDAT, STCLASS="REDEF PRM_INPOPR_DUMMY");
      127     3203    1   DCL PRM_STRID REDEF PRM_INPOPR_DUMMY UBIN;
      128     3204        %KV$VDH_DAT (NAME=PRM_VDH_DAT, STCLASS=REDEF PRM_INPOPR_DUMMY);
      129     3284    1   DCL 1 PRM_FND REDEF PRM_INPOPR_DUMMY,
      130     3285    1          2 BYT SBIN BYTE CALIGNED,
      131     3286    1          2 ID SBIN BYTE CALIGNED,
      132     3287    1          2 RVRDRC BIT(1);
      133     3288    1   DCL KV_CMPCOD_TO_ERR# (0:0) UBIN SYMREF;
      134     3289        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:6    
      135     3290        /*I* NAME: Y$SETUP.
      136     3291             DESCRIPTION: Loads up a bunch of stuff from KV$RCRLST into AUTO variables.
      137     3292             Computes some of them - like vertical scrolling parameters.
      138     3293        */
      139     3294    1   Y$SETUP: PROC;
      140     3295    2      Y@SSN$ = KV$PTR.SSN$;
      141     3296    2      Y@RCRLST$ = KV$PTR.LINLST$;
      142     3297    2      Y@STR$ = KV$PTR.STR$;
      143     3298    2      Y@SRD$ = KV$PTR.SRD$;
      144     3299    2      Y@SRHCUR = %KV_RCRLST.CRTRCR;
      145     3300    2      IF Y@SRHCUR>=0 AND Y@SRHCUR<%KV_RCRLST.RCRCNT
      146     3301    2      THEN Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);
      147     3302    2      Y@REDLIN = Y@SRHCUR;
      148     3303    2      Y@KEYLNG = %KV_RCRLST.KEYLNG;
      149     3304    2      Y@VRTSCRMRG = %KV_RCRLST.VRTSCRMRG;
      150     3305    2      IF Y@VRTSCRMRG>=%G_SCROLL_CENTER#
      151     3306    2      THEN Y@VRTSCRMRG = (Y@VRTSCRMRG-%G_SCROLL_CENTER#)*%KV_SRD.LNG/100;
      152     3307    2      IF Y@VRTSCRMRG*2>%KV_SRD.LNG THEN Y@VRTSCRMRG = %KV_SRD.LNG/3;
      153     3308    2      IF Y@VRTSCRMRG*3>%KV_RCRLST.MAXRCR THEN Y@VRTSCRMRG = %KV_RCRLST.MAXRCR/3;
      154     3309    2      Y@VRTSCRSHF = %KV_RCRLST.VRTSCRSHF;
      155     3310    2      IF Y@VRTSCRSHF>%G_SCROLL_CENTER#
      156     3311    2      THEN Y@VRTSCRSHF =
      157     3312    2        (Y@VRTSCRSHF-%G_SCROLL_CENTER#)*%KV_SRD.LNG/100+Y@VRTSCRMRG;
      158     3313    2      ELSE IF Y@VRTSCRSHF=%G_SCROLL_CENTER# THEN Y@VRTSCRSHF = %KV_SRD.LNG/2;
      159     3314    2      ELSE Y@VRTSCRSHF = Y@VRTSCRSHF+Y@VRTSCRMRG;
      160     3315    2      IF Y@VRTSCRSHF>%KV_SRD.LNG THEN Y@VRTSCRSHF = %KV_SRD.LNG;
      161     3316        /*
      162     3317           Now, since the computation happens when we've actually moved to MRG-1,
      163     3318           decrement the result to compensate for that.
      164     3319        */
      165     3320    2      IF Y@VRTSCRSHF~=0 THEN Y@VRTSCRSHF = Y@VRTSCRSHF-1;
      166     3321    2      RETURN;
      167     3322    2   END Y$SETUP;
      168     3323        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:7    
      169     3324        /*F* NAME: KVE$ACTRED
      170     3325             DESCRIPTION: Called when an activation character is entered in
      171     3326             editor mode.  Any editing activity is terminated.
      172     3327        */
      173     3328    1   KVE$ACTRED: ENTRY(PRM_INPOPR_DUMMY) ALTRET;
      174     3329
      175     3330    1      IF %KV_VDI.RE_DSPINP THEN CALL KVI$RE_DSPINP;
      176     3331    1      CALL Y$SETUP;
      177     3332    1      %KV_STR.RE_REDCLM = %KV_SSN.REDBFR.EDTLOWX+1;
      178     3333    2      IF PRM_VDH_DAT.DATCTRCHRTYP~=%KV_DATCTRCHRTYP_NON THEN DO;
      179     3334    2         %KV_RCRLST.ACTCHR = '1'B;
      180     3335    2         %KV_RCRLST.DATCTRCHR = ASCBIN(PRM_VDH_DAT.DATCTRCHR);
      181     3336    2         %KV_RCRLST.SAMDAT = '0'B;
      182     3337    2         CALL Y$UPDRCR ALTRET(ABRRED);     /* Always send the record along.      */
      183     3338    2         IF %KV_RCRLST.SNDRCR<0 THEN %KV_RCRLST.ACTCHR = '0'B;
      184     3339    2         GOTO ABRRED;
      185     3340    2      END;
      186     3341    1      IF PRM_VDH_DAT.CMPCOD=0 AND %KV_STR.WRDWRP AND %KV_STR.WRDWRPCLM>11
      187     3342    1        AND %KV_SSN.REDBFR.NXTX>=%KV_SSN.REDBFR.EDTLOWX
      188     3343    2        AND %KV_STR.RE_REDCLM>%KV_STR.WRDWRPCLM THEN DO;
      189     3344        /*
      190     3345           We have the word-wrap stiuation.  Turn it into a split.
      191     3346        */
      192     3347    2         Y@LINCNT = 2;                     /* Wordwrap once.                     */
      193     3348    2         %KV_RCRLST.DFRCNT = 0;
      194     3349    2         GOTO SPLIT_ONE;
      195     3350    2      END;
      196     3351    1      %KV_STR.ERR.COD = KV_CMPCOD_TO_ERR#(PRM_VDH_DAT.CMPCOD);
      197     3352    1      CALL Y$UPDRCRSND ALTRET(ABRRED);     /* Always send the record along.      */
      198     3353    1      GOTO ABRRED;
      199     3354        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:8    
      200     3355        /*F* NAME: KVE$DLTALLRCR
      201     3356             DESCRIPTION: Reduces the record set to none.
      202     3357        */
      203     3358    1   KVE$DLTALLRCR: ENTRY ALTRET;
      204     3359
      205     3360    1      CALL Y$SETUP;
      206     3361    1      Y@SRHCUR = %KV_RCRLST.RCRCNT;
      207     3362    1      %KV_RCRLST.BOF = '0'B;
      208     3363    1      %KV_RCRLST.EOF = '0'B;
      209     3364    1      %KV_RCRLST.ACTCHR = '0'B;
      210     3365    1      %KV_RCRLST.SNDRQR = '0'B;
      211     3366    1      %KV_RCRLST.RCRNEDSNT = '0'B;
      212     3367    1      %KV_RCRLST.PRTLSTRCR = '0'B;
      213     3368    1      %KV_RCRLST.NO_CTX = '0'B;
      214     3369    1      %KV_RCRLST.EOFDSP = '0'B;
      215     3370    1      %KV_RCRLST.DFROPR = 0;
      216     3371    1      %KV_RCRLST.SNDRCR = -1;
      217     3372    1      %KV_RCRLST.CRTRCR = %KV_RCRLST.FRSRCR;
      218     3373    1      %KV_STR.RE_REDCLM = 1;
      219     3374    1      KV@VDH_GETBFR = Y_VDH_GETBFR;
      220     3375    2      DO WHILE Y@SRHCUR>0;
      221     3376    2         Y@SRHCUR = Y@SRHCUR-1;
      222     3377    2         CALL Y$DLTRCR;
      223     3378    2      END;
      224     3379    1      RETURN;
      225     3380        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:9    
      226     3381        /*F* NAME: KVE$DSPALL
      227     3382             ENTRY: KVE$DSPUPD
      228     3383             DESCRIPTION: Does whatever is required to get what is supposed to
      229     3384             be on the screen out there. DSPALL assumes the screen is cleared.
      230     3385             DSPUPD updates an already displayed screen.
      231     3386        */
      232     3387    1   KVE$DSPALL: ENTRY ALTRET;
      233     3388
      234     3389    1      CALL Y$SETUP;
      235     3390    1      IF %KV_SSN.REDSTRID=%KV_STR.ID
      236     3391    1      THEN %KV_RCRLST.HRZSCROFS = %KV_SSN.REDBFR.DSPLOWX;
      237     3392    1      %KV_RCRLST.LSTRCR = -2;
      238     3393    1      %KV_RCRLST.PRTLSTRCR = '0'B;
      239     3394    1      %KV_RCRLST.EOFDSP = '0'B;
      240     3395    1      CALL Y$DSPALL;
      241     3396    1      RETURN;
      242     3397
      243     3398    1   KVE$DSPUPD: ENTRY ALTRET;
      244     3399
      245     3400    1      CALL Y$SETUP;
      246     3401    1      CALL Y$DSPALL;
      247     3402    1      RETURN;
      248     3403
      249     3404        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:10   
      250     3405    1   Y$DSPALL: PROC;
      251     3406    2   DCL Y@BTMHOL SBIN;
      252     3407    2   DCL Y@ORGVRTCLM SBIN;
      253     3408
      254     3409    2      KV@VDH_OTPLCL = Y_VDH_OTPLCL;
      255     3410    2      KV@VDH_OTPLCL.BFR_.BYTX = -1;
      256     3411    2      KV@USR_PST = KV_USR_PST;
      257     3412    2      KV@USR_PST.PHSPSTMOD = %KV_PHSPSTMOD_VRTSCR;
      258     3413    2      Y@BTMHOL = 0;
      259     3414    2      Y@ORGVRTCLM = %KV_MVD.VRTCLM;
      260     3415    2      IF %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_BLN THEN CALL KVV$CALUSR_PST;
      261     3416    2      Y@VRTLIN = 0;
      262     3417    2      Y@SRHCUR = %KV_RCRLST.FRSRCR;
      263     3418    2      KV@VDH_GETBFR = Y_VDH_GETBFR;
      264     3419    2      Y@REDLIN = -1;
      265     3420    2      %KV_SRD.PAGEHALT = '0'B;
      266     3421    2      %KV_SRD.WRPPAG = '0'B;
      267     3422    2      %KV_SRD.FLDEND = %KV_SRD.BTMRHT;
      268     3423    2      %KV_SRD.HI_NONBLN = %KV_SRD.BTMRHT;
      269     3424    2      %KV_SRD.CRT.CLM = 0;
      270     3425    2      IF %KV_RCRLST.VRTSCRCNT~=0
      271     3426    2      THEN IF %KV_RCRLST.VRTSCRCNT<%KV_SRD.LNG
      272     3427    3        AND %KV_RCRLST.VRTSCRCNT>-%KV_SRD.LNG THEN DO;
      273     3428    3         KV@USR_PST.PHSPST = %KV_SRD.TOPLFT;
      274     3429    3         KV@USR_PST.SCRCNT = %KV_RCRLST.VRTSCRCNT;
      275     3430    3         IF KV@USR_PST.SCRCNT<0 THEN Y@BTMHOL = -KV@USR_PST.SCRCNT;
      276     3431    4         ELSE DO;
      277     3432    4            %KV_RCRLST.PRTLSTRCR = '0'B;
      278     3433    4            %KV_RCRLST.EOFDSP = '0'B;
      279     3434    4         END;
      280     3435    3         CALL KVV$CALUSR (KV@USR_PST);
      281     3436    3         KV@USR_PST.SCRCNT = 0;
      282     3437    3      END;
      283     3438    2      ELSE %KV_RCRLST.LSTRCR = -1;
      284     3439    2      ELSE IF NOT %KV_SRD.VRTSCR AND %KV_VDI.RE_DSPINP
      285     3440    2      THEN IF %KV_MVD.FRMSCNINH THEN KV@USR_PST.PHSPST.LIN = -1;
      286     3441    2      ELSE KV@USR_PST.PHSPST.LIN = 0;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:11   
      287     3442        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:12   
      288     3443    2      IF %KV_RCRLST.RCRCNT~=0 THEN
      289     3444    3   DSPLOP: DO WHILE '1'B;
      290     3445    3         Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);
      291     3446    4         IF Y@SRHCUR=%KV_RCRLST.CRTRCR THEN DO;
      292     3447    4            Y@REDLIN = Y@VRTLIN;
      293     3448    4            IF Y@ORGVRTCLM>%KV_RCR.LINCNT*%KV_SRD.WDT+1
      294     3449        /*
      295     3450           This one musta got extended by RE_REDCLM.  Make sure it gets displayed
      296     3451        */
      297     3452    4            THEN %KV_RCR.UPD = '1'B;
      298     3453    4         END;
      299     3454    4         IF %KV_RCR.RCRBYTSIZ<0 OR %KV_RCR.LINCNT<0 THEN DO;
      300     3455        /*
      301     3456           A (perhaps partially) deleted record. remove it from the screen.
      302     3457        */
      303     3458    4            IF %KV_RCR.LINCNT<0 AND %KV_RCR.RCRBYTSIZ<0
      304     3459    4            THEN %KV_RCR.LINCNT = -%KV_RCR.LINCNT;
      305     3460    4            Y@BFRSIZ = %KV_RCR.LINCNT;
      306     3461    5            IF Y@BFRSIZ<0 THEN DO;
      307     3462        /*
      308     3463           Compute how many blanklines follow the actual record text.
      309     3464        */
      310     3465    5               IF %KV_RCR.RCRBYTSIZ=0 AND %KV_RCR.NEW THEN %KV_RCR.LINCNT = 0;
      311     3466    5               ELSE %KV_RCR.LINCNT =
      312     3467    5                 MAXIMUM ((%KV_RCR.RCRBYTSIZ+%KV_SRD.WDT-1)/%KV_SRD.WDT, 1);
      313     3468    5               Y@BFRSIZ = -%KV_RCR.LINCNT-Y@BFRSIZ;
      314     3469    5            END;
      315     3470    4            ELSE %KV_RCR.LINCNT = 0;       /* Gone ones no longer take space     */
      316     3471    5            IF NOT %KV_SRD.VRTSCR THEN DO;
      317     3472    5               IF Y@BFRSIZ=0 THEN EXIT;    /* Nothing to do                      */
      318     3473    5               %KV_RCRLST.EOFDSP = '0'B;
      319     3474    5               %KV_RCRLST.LSTRCR = Y@SRHCUR-1;
      320     3475    5               %KV_RCRLST.PRTLSTRCR = '0'B;
      321     3476    5            END; ELSE IF Y@SRHCUR<=%KV_RCRLST.LSTRCR THEN DO;
      322     3477    5               IF KV@USR_PST.SCRCNT>0 THEN KV@USR_PST.SCRCNT = 0;
      323     3478    5               KV@USR_PST.SCRCNT = KV@USR_PST.SCRCNT-Y@BFRSIZ;
      324     3479    5               Y@BTMHOL = Y@BTMHOL+Y@BFRSIZ;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:13   
      325     3480    5               KV@USR_PST.PHSPST.LIN = Y@VRTLIN+%KV_SRD.TOPLFT.LIN+%KV_RCR.LINCNT;
      326     3481    6               DO;
      327     3482    6                  IF Y@SRHCUR+1<%KV_RCRLST.RCRCNT
      328     3483    6                  THEN IF %KV_RCRLST.RCR$(Y@SRHCUR+1)->KV$RCR.RCRBYTSIZ<0
      329     3484    6                  THEN EXIT; ELSE;
      330     3485    6                  ELSE IF NOT %KV_RCRLST.EOFDSP THEN EXIT;
      331     3486    6                  IF KV@USR_PST.SCRCNT=0 THEN EXIT;
      332     3487        /*
      333     3488           Just accumulate the whole size for a string of deleted ones.
      334     3489           If they're all gone, we'll just erase at the bottom.
      335     3490        */
      336     3491    6                  IF KV@USR_PST.PHSPST.LIN<%KV_SRD.BTMRHT.LIN
      337     3492    6                  THEN CALL KVV$CALUSR (KV@USR_PST);
      338     3493    6                  ELSE Y@BTMHOL = 0;
      339     3494    6                  KV@USR_PST.SCRCNT = 0;
      340     3495    6               END;
      341     3496    5            END;
      342     3497    4            IF %KV_RCR.RCRBYTSIZ>=0 THEN EXIT; /* only partially deleted         */
      343     3498    4            CALL Y$DLTRCRRLS;
      344     3499    4            IF Y@BFRSIZ~=0 THEN GOTO DSPLOP;
      345     3500    5            IF KV@VDH_OTPLCL.BFR_.BYTX<0 OR %KV_SRD.VRTSCR THEN DO;
      346     3501    5               IF %KV_RCRLST.EOFDSP THEN EXIT DSPLOP;
      347     3502    5   Y$ERS_THE_REST:;
      348     3503    5               KV@VDH_OTPLCL.BFR_.BYTX = 0;
      349     3504    5               %KV_SRD.CRTVRTLINPHSLIN = Y@VRTLIN+%KV_SRD.TOPLFT.LIN;
      350     3505    5               IF %KV_SRD.CRT.LIN~=%KV_SRD.CRTVRTLINPHSLIN
      351     3506    6                 OR %KV_SRD.CRT.CLM~=%KV_SRD.TOPLFT.CLM THEN DO;
      352     3507    6                  %KV_SRD.CRT.LIN = %KV_SRD.CRTVRTLINPHSLIN;
      353     3508    6                  %KV_SRD.CRT.CLM = %KV_SRD.TOPLFT.CLM;
      354     3509    6                  %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_SKP;
      355     3510    6               END;
      356     3511    6               IF KV@USR_PST.PHSPST.LIN<=0 THEN DO;
      357     3512    6                  IF KV@USR_PST.PHSPST.LIN=0
      358     3513    6                  THEN CALL KVV$CALUSR_EVT (%KV_USR_EVT_ID_DLTOTP);
      359     3514    6                  %KV_SRD.UNKPST = '0'B;
      360     3515    6                  KV@USR_PST.PHSPST.LIN = -1;
      361     3516    6               END;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:14   
      362     3517    6               ELSE DO;
      363     3518    6                  %KV_SRD.HI_NONBLN = %KV_SRD.BTMRHT;
      364     3519    6                  CALL KVO$ERSTO_ENDOF_SRD;
      365     3520    6               END;
      366     3521    5            END;
      367     3522    4            IF NOT %KV_RCRLST.EOF THEN EXIT DSPLOP;
      368     3523    4            Y@SRHCUR = Y@SRHCUR-1;
      369     3524    4            Y@RCR$ = PINCRW(ADDR(Y_LTLKEY),-1);
      370     3525    4            GOTO NXTLIN;                   /* Put out the EOF marker if needed   */
      371     3526    4         END;
      372     3527        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:15   
      373     3528    3         IF %KV_RCR.UPD OR Y@SRHCUR>%KV_RCRLST.LSTRCR
      374     3529    3           OR Y@VRTLIN<%KV_RCRLST.VRTSCRCNT
      375     3530    3           OR Y@SRHCUR=%KV_RCRLST.LSTRCR AND %KV_RCRLST.PRTLSTRCR AND Y@BTMHOL>0
      376     3531    4           OR Y@VRTLIN+%KV_RCR.LINCNT>%KV_SRD.LNG-Y@BTMHOL THEN DO;
      377     3532    4            IF %KV_RCR.NEW THEN IF %KV_RCRLST.CRTRCR~=Y@SRHCUR THEN EXIT;
      378     3533        /* Don't display the "EOF" record unless we're on it,
      379     3534           so that the EOF marker doesn't show the phantom record */
      380     3535    5            IF KV@USR_PST.PHSPST.LIN<=0 AND %KV_RCR.DSP THEN DO;
      381     3536    5               IF KV@USR_PST.PHSPST.LIN=0
      382     3537    5               THEN CALL KVV$CALUSR_EVT (%KV_USR_EVT_ID_DLTOTP);
      383     3538    5               %KV_SRD.UNKPST = '0'B;
      384     3539    5               KV@USR_PST.PHSPST.LIN= -1;
      385     3540    5               GOTO NXTLIN;
      386     3541    5            END;
      387     3542    4            %KV_RCR.DSP = '1'B;
      388     3543    4            KV@VDH_OTPLCL.BFR_.ADR$ = ADDR(%KV_RCR);
      389     3544    4            KV@VDH_OTPLCL.BFR_.BYTSIZ = %KV_RCR.RCRBYTSIZ-%KV_RCRLST.HRZSCROFS;
      390     3545    4            %KV_MVD.VRTCLM = 1;
      391     3546    4            %KV_SRD.CRTVRTLINPHSLIN = Y@VRTLIN+%KV_SRD.TOPLFT.LIN;
      392     3547    4            %KV_SRD.VRTPSTOK = '1'B;
      393     3548    5            IF %KV_SRD.VRTSCR AND %KV_RCRLST.FRSRCR<=%KV_RCRLST.LSTRCR THEN DO;
      394     3549    5               %KV_SRD.FLDEND.LIN = %KV_SRD.CRTVRTLINPHSLIN+%KV_RCR.LINCNT-1;
      395     3550    5               %KV_SRD.HI_NONBLN.LIN = %KV_SRD.BTMRHT.LIN-Y@BTMHOL;
      396     3551    5               %KV_SRD.HI_NONBLN.CLM = %KV_SRD.BTMRHT.CLM;
      397     3552    6               IF %KV_SRD.FLDEND.LIN>=%KV_SRD.HI_NONBLN.LIN THEN DO;
      398     3553    6                  %KV_SRD.FLDEND.LIN = %KV_SRD.BTMRHT.LIN;
      399     3554    6                  %KV_RCRLST.PRTLSTRCR = '0'B;
      400     3555    6               END;
      401     3556    5               ELSE %KV_SRD.HI_NONBLN.LIN = %KV_SRD.FLDEND.LIN;
      402     3557    5               IF Y@VRTLIN<%KV_RCRLST.VRTSCRCNT
      403     3558    5               THEN %KV_SRD.HI_NONBLN.LIN = %KV_SRD.CRTVRTLINPHSLIN-1;
      404     3559    6               IF %KV_RCR.LINCNT=0 THEN DO;
      405     3560        /*
      406     3561           A new record, make room for it.
      407     3562        */
      408     3563    6                  KV@USR_PST.PHSPST.LIN = %KV_SRD.CRTVRTLINPHSLIN;
      409     3564    6                  Y@SRHLO = %KV_SRD.BTMRHT.LIN-%KV_SRD.CRTVRTLINPHSLIN;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:16   
      410     3565    6                  IF Y@SRHCUR<%KV_RCRLST.LSTRCR
      411     3566    6                  THEN Y@SRHLO = MINIMUM (Y@SRHLO,
      412     3567    6                    MAXIMUM ((%KV_RCR.RCRBYTSIZ-1)/%KV_SRD.WDT, 0));
      413     3568    6                  %KV_SRD.FLDEND.LIN = KV@USR_PST.PHSPST.LIN+Y@SRHLO;
      414     3569    6                  Y@SRHLO = Y@SRHLO+1;
      415     3570    6                  %KV_RCR.LINCNT = Y@SRHLO;
      416     3571    7                  IF Y@SRHLO>Y@BTMHOL THEN DO;
      417     3572    7                     Y@BTMHOL = 0;
      418     3573    7                     %KV_RCRLST.PRTLSTRCR = '0'B;
      419     3574    7                     %KV_RCRLST.EOFDSP = '0'B;
      420     3575    7                  END;
      421     3576    6                  ELSE Y@BTMHOL = Y@BTMHOL-Y@SRHLO;
      422     3577    7                  IF %KV_SRD.FLDEND.LIN<%KV_SRD.BTMRHT.LIN THEN DO;
      423     3578    7                     KV@USR_PST.SCRCNT = Y@SRHLO;
      424     3579    7                     CALL KVV$CALUSR (KV@USR_PST);
      425     3580    7                  END;
      426     3581    6                  ELSE %KV_SRD.HI_NONBLN.LIN = %KV_SRD.FLDEND.LIN;
      427     3582    6               END;
      428     3583    5            END;
      429     3584    4            IF %KV_SRD.CRT.LIN~=%KV_SRD.CRTVRTLINPHSLIN
      430     3585    5              OR %KV_SRD.CRT.CLM~=%KV_SRD.TOPLFT.CLM THEN DO;
      431     3586    5               %KV_SRD.CRT.LIN = %KV_SRD.CRTVRTLINPHSLIN;
      432     3587    5               %KV_SRD.CRT.CLM = %KV_SRD.TOPLFT.CLM;
      433     3588    5               %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_SKP;
      434     3589    5               CALL KVV$CALUSR_PST;
      435     3590    5            END;
      436     3591    4            IF KV@VDH_OTPLCL.BFR_.BYTX<0 AND %KV_RCRLST.LSTRCR>-2
      437     3592        /* Erase the rest: if this is the first update on a non-blank screen ... */
      438     3593    4              AND (%KV_RCRLST.FRSRCR>%KV_RCRLST.LSTRCR
      439     3594        /* and either a) e.g. the window changed, making a repaint needed, ... */
      440     3595    4              OR NOT %KV_SRD.VRTSCR
      441     3596        /* or b) we can't shift lines around so the rest always needs repainintg ... */
      442     3597    4              AND (NOT %KV_RCR.NEW
      443     3598        /* unless it's a new record ... */
      444     3599    4              OR Y@SRHCUR+1<%KV_RCRLST.RCRCNT
      445     3600        /* at the bottom of the screen (the "eof" record) ... */
      446     3601    4              OR %KV_RCRLST.EOFDSP))
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:17   
      447     3602        /* with no EOF marker to display. */
      448     3603    5            THEN DO;
      449     3604    5               CALL KVO$ERSTO_ENDOF_SRD;
      450     3605    5               %KV_RCRLST.LSTRCR = 0;
      451     3606    5               %KV_RCRLST.PRTLSTRCR = '0'B;
      452     3607    5               %KV_RCRLST.EOFDSP = '0'B;
      453     3608    5            END;
      454     3609    4            KV@VDH_OTPLCL.BFR_.BYTX =
      455     3610    4              Y@KEYLNG+LENGTHV(KV$RCR)+%KV_RCRLST.HRZSCROFS;
      456     3611    4            IF Y@SRHCUR=%KV_RCRLST.CRTRCR AND %KV_SSN.REDSTRID=%KV_STR.ID
      457     3612    5              AND %KV_SSN.REDBFR__.ADR$~=ADDR(NIL) THEN DO;
      458     3613    5               KV@VDH_OTPLCL.BFR_.ADR$ = %KV_SSN.REDBFR__.ADR$;
      459     3614    5               KV@VDH_OTPLCL.BFR_.BYTX = %KV_SSN.REDBFR.DSPLOWX;
      460     3615    5               KV@VDH_OTPLCL.BFR_.BYTSIZ =
      461     3616    5                 %KV_SSN.REDBFR__.DATBYTSIZ-%KV_SSN.REDBFR.DSPLOWX;
      462     3617    5            END;
      463     3618    4            Y@SRHLO = KV@VDH_OTPLCL.BFR_.BYTSIZ;
      464     3619    4   OTPLCL:  IF Y@SRHLO>0 THEN CALL KVO$OTPLCL (KV@VDH_OTPLCL);
      465     3620    4            IF %KV_SRD.CRT_PST<=%KV_SRD.HI_NONBLN_PST
      466     3621    4            THEN CALL KVO$ERSTO_ENDOF_INP;
      467     3622    4            IF KV@VDH_OTPLCL.BFR_.BYTSIZ~=Y@SRHLO AND NOT %KV_MVD.HRZSCR
      468     3623        /*
      469     3624           The record would have wrapped if that were allowed. Note that it
      470     3625           can't be editted without scrolling it fully onto the screen.
      471     3626        */
      472     3627    5            THEN IF %KV_SRD.FLDEND.LIN<%KV_SRD.BTMRHT.LIN THEN DO;
      473     3628    5               Y@SRHLO = MINIMUM((KV@VDH_OTPLCL.BFR_.BYTSIZ-1)/%KV_SRD.WDT+1,
      474     3629    5                 %KV_SRD.BTMRHT.LIN-%KV_SRD.FLDEND.LIN);
      475     3630    5               KV@USR_PST.PHSPST.LIN = %KV_SRD.FLDEND.LIN+1;
      476     3631    5               KV@USR_PST.SCRCNT = Y@SRHLO;
      477     3632    5               %KV_SRD.FLDEND.LIN = %KV_SRD.FLDEND.LIN+Y@SRHLO;
      478     3633    5               %KV_RCR.LINCNT = %KV_RCR.LINCNT+Y@SRHLO;
      479     3634    5               IF %KV_SRD.FLDEND.LIN<%KV_SRD.BTMRHT.LIN
      480     3635    5               THEN CALL KVV$CALUSR (KV@USR_PST);
      481     3636    5               ELSE %KV_SRD.HI_NONBLN = %KV_SRD.FLDEND;
      482     3637    5               Y@SRHLO = KV@VDH_OTPLCL.BFR_.BYTSIZ;
      483     3638    5               GOTO OTPLCL;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:18   
      484     3639    5            END;
      485     3640    5            ELSE IF Y@SRHLO>0 THEN DO;
      486     3641    5               %KV_RCR.DSP = '0'B;
      487     3642    5               %KV_RCRLST.PRTLSTRCR = '1'B;
      488     3643    5               %KV_RCRLST.LSTRCR = 0;
      489     3644    5            END;
      490     3645    4            IF %KV_SRD.CRT.CLM=%KV_SRD.TOPLFT.CLM
      491     3646    4              AND %KV_SRD.CRT.LIN>%KV_SRD.CRTVRTLINPHSLIN
      492     3647    4            THEN %KV_SRD.CRT.LIN = %KV_SRD.CRT.LIN-1;
      493     3648    4            Y@SRHLO = %KV_SRD.CRT.LIN-%KV_SRD.CRTVRTLINPHSLIN+1;
      494     3649    4            IF Y@SRHLO<%KV_RCR.LINCNT
      495     3650    5              AND %KV_SRD.FLDEND.LIN<%KV_SRD.BTMRHT.LIN THEN DO;
      496     3651    5               KV@USR_PST.PHSPST.LIN = Y@SRHLO+%KV_SRD.CRTVRTLINPHSLIN;
      497     3652    5               KV@USR_PST.SCRCNT = KV@USR_PST.PHSPST.LIN-%KV_SRD.FLDEND.LIN-1;
      498     3653    5               Y@BTMHOL = Y@BTMHOL-KV@USR_PST.SCRCNT;
      499     3654    5               CALL KVV$CALUSR (KV@USR_PST);
      500     3655    5            END;
      501     3656    4            %KV_RCR.LINCNT = Y@SRHLO;
      502     3657    4            %KV_RCR.UPD = '0'B;
      503     3658    4         END;
      504     3659    3   NXTLIN:;
      505     3660    3         Y@VRTLIN = Y@VRTLIN+%KV_RCR.LINCNT;
      506     3661    3         Y@SRHCUR = Y@SRHCUR+1;
      507     3662    4         IF Y@VRTLIN>=%KV_SRD.LNG OR Y@SRHCUR>=%KV_RCRLST.RCRCNT THEN DO;
      508     3663    5            IF Y@VRTLIN>%KV_SRD.LNG THEN DO;
      509     3664    5               %KV_RCR.LINCNT = %KV_RCR.LINCNT+%KV_SRD.LNG-Y@VRTLIN;
      510     3665    5               %KV_RCRLST.PRTLSTRCR = '1'B;
      511     3666    5               %KV_RCRLST.EOFDSP = '0'B;
      512     3667    5            END;
      513     3668    5            ELSE IF Y@VRTLIN<%KV_SRD.LNG AND %KV_RCRLST.EOF THEN DO;
      514     3669    5               IF %KV_RCRLST.EOFDSP THEN EXIT;
      515     3670    5               KV@VDH_OTPLCL.BFR_.ADR$ = %KV_MVD.DCBHDN$;
      516     3671    5               IF KV@VDH_OTPLCL.BFR_.ADR$=ADDR(NIL) THEN EXIT;
      517     3672    5               KV@VDH_OTPLCL.BFR_.BYTSIZ =
      518     3673    5                 KV@VDH_OTPLCL.BFR_.ADR$->KV$TITLE.TXTSIZ;
      519     3674    5               IF KV@VDH_OTPLCL.BFR_.BYTSIZ=0 THEN EXIT;
      520     3675    5               %KV_RCRLST.EOFDSP = '1'B;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:19   
      521     3676    5               %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.TOPLFT.LIN+Y@VRTLIN;
      522     3677    5               IF %KV_SRD.CRT.LIN~=%KV_SRD.CRTVRTLINPHSLIN
      523     3678    6                 OR %KV_SRD.CRT.CLM~=%KV_SRD.TOPLFT.CLM THEN DO;
      524     3679    6                  %KV_SRD.CRT.LIN = %KV_SRD.CRTVRTLINPHSLIN;
      525     3680    6                  %KV_SRD.CRT.CLM = %KV_SRD.TOPLFT.CLM;
      526     3681    6                  %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_SKP;
      527     3682    6                  CALL KVV$CALUSR_PST;
      528     3683    6               END;
      529     3684    5               IF NOT %KV_SRD.VRTSCR AND KV@VDH_OTPLCL.BFR_.BYTX<0
      530     3685    5               THEN CALL KVO$ERSTO_ENDOF_SRD;
      531     3686    5               KV@VDH_OTPLCL.BFR_.BYTX = 13;
      532     3687    5               CALL KVO$OTPLCL (KV@VDH_OTPLCL);
      533     3688    4            END; ELSE %KV_RCRLST.EOFDSP = '0'B;
      534     3689    4            EXIT DSPLOP;
      535     3690    4         END;
      536     3691    3      END;
      537     3692    2      %KV_RCRLST.VRTSCRCNT = 0;
      538     3693    2      %KV_SRD.CRT = %KV_SRD.TOPLFT;
      539     3694    2      %KV_MVD.VRTCLM = Y@ORGVRTCLM;
      540     3695    3      IF Y@REDLIN>=0 THEN DO;
      541     3696    3         %KV_SRD.CRTVRTLINPHSLIN = Y@REDLIN+%KV_SRD.TOPLFT.LIN;
      542     3697    3         %KV_SRD.FLDEND.LIN = %KV_SRD.CRTVRTLINPHSLIN+
      543     3698    3           %KV_RCRLST.RCR$(%KV_RCRLST.CRTRCR)->KV$RCR.LINCNT-1;
      544     3699    3         %KV_SRD.HI_NONBLN = %KV_SRD.FLDEND;
      545     3700    3         IF %KV_SSN.REDSTRID~=%KV_STR.ID THEN EXIT;
      546     3701    4         IF NOT %KV_SRD.VRTSCR THEN DO;
      547     3702    4            IF KV@USR_PST.PHSPST.LIN<0 THEN %KV_MVD.FRMSCNINH = '1'B;
      548     3703    4            IF %KV_VDI.RE_DSPINP THEN EXIT;
      549     3704    4            %KV_VDI.RE_DSPINP = '1'B;
      550     3705    4            %KV_VDI.RE_DSPLOWX = %KV_SSN.REDBFR.NXTX;
      551     3706    4         END;
      552     3707    3         IF %KV_MVD.HRZSCR AND Y@ORGVRTCLM-%KV_SRD.PRMVRTCLM<=%KV_MVD.HRZSCRMRG
      553     3708    3           AND %KV_SSN.REDBFR.DSPLOWX~=0 THEN CALL KVI$SHFDSPPST(0);
      554     3709    3         ELSE IF %KV_MVD.HRZSCR AND Y@ORGVRTCLM+%KV_MVD.HRZSCRMRG>%KV_MVD.WDT
      555     3710    3         THEN CALL KVI$SHFDSPPST;
      556     3711    4         ELSE DO;
      557     3712    4            %KV_RCRLST.LSTRCR = Y@SRHCUR-1;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:20   
      558     3713    4            CALL KVO$PST (KV_VDH_PST_VRT);
      559     3714    4         END;
      560     3715    3      END;
      561     3716        /*
      562     3717           If the screen is blanked, don't delete any output for a bit.
      563     3718        */
      564     3719    3      IF %KV_RCRLST.RCRCNT=0 THEN DO;
      565     3720    3         IF %KV_RCRLST.LSTRCR = -1 AND KV@VDH_OTPLCL.BFR_.BYTX<0
      566     3721    3         THEN GOTO Y$ERS_THE_REST;
      567     3722    3         Y@SRHCUR = -1;
      568     3723    3      END;
      569     3724    2      %KV_RCRLST.LSTRCR = Y@SRHCUR-1;
      570     3725    3      IF %KV_RCRLST.DLTRCREXS THEN DO;
      571     3726    3         %KV_RCRLST.DLTRCREXS = '0'B;
      572     3727    3         Y@SRHCUR = 0;
      573     3728    4         DO WHILE '1'B;
      574     3729    4            IF Y@SRHCUR=%KV_RCRLST.FRSRCR AND %KV_RCRLST.LSTRCR>%KV_RCRLST.FRSRCR
      575     3730    4            THEN Y@SRHCUR = %KV_RCRLST.LSTRCR+1;
      576     3731    4            IF Y@SRHCUR>=%KV_RCRLST.RCRCNT THEN EXIT;
      577     3732    4            Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);
      578     3733    4            IF %KV_RCR.RCRBYTSIZ<0 THEN CALL Y$DLTRCRRLS;
      579     3734    4            ELSE Y@SRHCUR = Y@SRHCUR+1;
      580     3735    4         END;
      581     3736    3      END;
      582     3737    2      RETURN;
      583     3738    2   END Y$DSPALL;
      584     3739        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:21   
      585     3740        /*F* NAME: KVE$FIXHRZSCR.
      586     3741             DESCRIPTION: Called by KVP$PRM when HRZSCR changes, to fix up the
      587     3742             linecounts and redisplay the screen.
      588     3743        */
      589     3744    1   KVE$FIXHRZSCR: ENTRY ALTRET;
      590     3745
      591     3746    1      CALL Y$SETUP;
      592     3747    1      %KV_RCRLST.LSTRCR = %KV_RCRLST.FRSRCR-1;
      593     3748    1      Y@SRHCUR = 0;
      594     3749    2      DO WHILE Y@SRHCUR<%KV_RCRLST.RCRCNT;
      595     3750    2         Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);
      596     3751    3         IF %KV_RCR.RCRBYTSIZ<0 THEN DO;
      597     3752    3            KV@VDH_GETBFR = Y_VDH_GETBFR;
      598     3753    3            CALL Y$DLTRCRRLS;
      599     3754    3         END; ELSE DO;
      600     3755    3            IF %KV_MVD.HRZSCR THEN %KV_RCR.LINCNT = 1;
      601     3756    3            ELSE %KV_RCR.LINCNT =
      602     3757    3              MAXIMUM ((%KV_RCR.RCRBYTSIZ+%KV_SRD.WDT-1)/%KV_SRD.WDT, 1);
      603     3758    3            Y@SRHCUR = Y@SRHCUR+1;
      604     3759    3         END;
      605     3760    2      END;
      606     3761    1      IF NOT %KV_MVD.HRZSCR THEN %KV_RCRLST.HRZSCROFS = 0;
      607     3762    1      RETURN;
      608     3763        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:22   
      609     3764        /*F* NAME: KVE$INCFLD.
      610     3765             DESCRIPTION: Called by KVO$PST when attempting to position below
      611     3766             FLDEND LIN (extending the record beyond its former line count).
      612     3767             Horizontal scrolling obviously off. Slides lower data down to make
      613     3768             room, or upper data up if already at the bottom of the window.
      614     3769        */
      615     3770    1   KVE$INCFLD: ENTRY ALTRET;
      616     3771
      617     3772    1      CALL Y$SETUP;
      618     3773    1      %KV_RCR.LINCNT = %KV_RCR.LINCNT+1;
      619     3774    2      IF %KV_SRD.CRT.LIN<=%KV_SRD.BTMRHT.LIN THEN DO;
      620     3775        /*
      621     3776           We don't need to scroll everything up, just make a hole for this record.
      622     3777        */
      623     3778    3         IF %KV_SRD.VRTSCR AND %KV_SRD.CRT.LIN<%KV_SRD.BTMRHT.LIN THEN DO;
      624     3779    3            KV@USR_PST = KV_USR_PST;
      625     3780    3            KV@USR_PST.PHSPSTMOD = %KV_PHSPSTMOD_VRTSCR;
      626     3781    3            KV@USR_PST.SCRCNT = 1;
      627     3782    3            KV@USR_PST.PHSPST.LIN = %KV_SRD.CRT.LIN;
      628     3783    3            CALL KVV$CALUSR (KV@USR_PST);
      629     3784    3         END; ELSE DO;
      630     3785    3            %KV_RCRLST.EOFDSP = '0'B;
      631     3786    3            %KV_SRD.FLDEND.LIN = %KV_SRD.FLDEND.LIN+1;
      632     3787    3            %KV_SRD.HI_NONBLN = %KV_SRD.FLDEND;
      633     3788    3            %KV_SRD.CRT.CLM = %KV_SRD.TOPLFT.CLM;
      634     3789    3            CALL KVO$ERSTO_ENDOF_INP;
      635     3790    3            %KV_RCRLST.LSTRCR = %KV_RCRLST.CRTRCR;
      636     3791    3         END;
      637     3792    2      END; ELSE DO;
      638     3793        /*
      639     3794           Scroll off the first record, if that's not this one.
      640     3795        */
      641     3796    2         IF %KV_RCRLST.CRTRCR<=%KV_RCRLST.FRSRCR THEN GOTO ERR_LD;
      642     3797    2         IF NOT %KV_SRD.VRTSCR THEN %KV_RCRLST.LSTRCR = -1;
      643     3798    2         ELSE %KV_RCRLST.VRTSCRCNT =
      644     3799    2           -%KV_RCRLST.RCR$(%KV_RCRLST.FRSRCR)->KV$RCR.LINCNT;
      645     3800    2         %KV_RCRLST.FRSRCR = %KV_RCRLST.FRSRCR+1;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:23   
      646     3801    2      END;
      647     3802    1      CALL Y$DSPALL;
      648     3803    1      RETURN;
      649     3804        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:24   
      650     3805        /*F* NAME: KVE$INPOPR
      651     3806             DESCRIPTION: Interprets screen-editor-specific input function
      652     3807             operators.  Altreturns if not a SE function.
      653     3808             Caller must insure that MVD is ORG=SE.
      654     3809        */
      655     3810    1   KVE$INPOPR: ENTRY(PRM_INPOPR_DUMMY) ALTRET;
      656     3811
      657     3812    1      IF %KV_MVD.ORG~=%KV#VD_ORG_SE THEN RETURN;
      658     3813    1      CALL Y$SETUP;
      659     3814    1      Y@DLTRCR = KV$PTR.INPCNDPND.OPRX;
      660     3815    1      IF Y@DLTRCR<=0 OR Y@DLTRCR>%KV_RCRLST.MAXRCR THEN Y@DLTRCR = 1;
      661     3816    1      %KV_RCRLST.DFRCNT = 0;
      662     3817    1      %KV_STR.RE_REDCLM = %KV_SSN.REDBFR.EDTLOWX+1;
      663     3818    1      IF %KV_VDI.RE_DSPINP AND NOT %KV_MVD.FRMSCNINH
      664     3819    1      THEN IF %KV_VDI.RE_DSPLOWX<%KV_SSN.REDBFR.NXTX
      665     3820    1      THEN CALL KVI$RE_DSPINP;
      666     3821    1      Y@SRHLO = PRM_FND.BYT;               /* Char to search for if FNDPSTCHR    */
      667     3822    1      Y@LINCNT = PRM_INPOPR.ID;
      668     3823    1      KV@USR_RQSDAT.RE_RED = '0'B;
      669     3824    2   INPOPR: DO CASE Y@LINCNT;
      670     3825    2      CASE ELSE;
      671     3826    2         ALTRETURN;
      672     3827    2      CASE %KV_INPPRC_SE_UP, %KV_INPPRC_PSTLFT;
      673     3828    2         IF Y@SRHCUR=0 AND %KV_RCRLST.BOF THEN GOTO INPOPR_EXIT;
      674     3829    2         Y@DLTRCR = -Y@DLTRCR;
      675     3830    3         IF Y@LINCNT=%KV_INPPRC_PSTLFT THEN DO;
      676     3831    3            %KV_STR.RE_REDCLM = 0;
      677     3832    3            Y@DLTRCR = -1;
      678     3833    3         END;
      679     3834    2         GOTO SETEDTRHT;
      680     3835        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:25   
      681     3836    2      CASE %KV_INPPRC_SE_DWN, %KV_INPPRC_PSTRHT, %KV_INPPRC_TAB;
      682     3837    2         IF %KV_RCRLST.EOF AND Y@SRHCUR+1=%KV_RCRLST.RCRCNT
      683     3838    2         THEN IF %KV_SSN.REDBFR.EDTLOWX~=0 OR %KV_SSN.REDONL
      684     3839    2           OR Y@LINCNT~=%KV_INPPRC_SE_DWN THEN GOTO INPOPR_EXIT;
      685     3840    3         ELSE DO;
      686     3841    3            %KV_SSN.REDBFR.EDTLOWX = %KV_SSN.REDBFR.NXTX;
      687     3842    3            %KV_STR.RE_REDCLM = %KV_SSN.REDBFR.EDTLOWX+1;
      688     3843    3            Y@LINCNT = 0;                  /* Normal split                       */
      689     3844    3            GOTO SPLIT_ONE;
      690     3845    3         END;
      691     3846    3         IF Y@LINCNT~=%KV_INPPRC_SE_DWN THEN DO;
      692     3847    3            %KV_STR.RE_REDCLM = 1;
      693     3848    3            Y@DLTRCR = 1;
      694     3849    3         END;
      695     3850    2         GOTO SETEDTRHT;
      696     3851
      697     3852    2      CASE %KV_INPPRC_SE_CRSHOM;
      698     3853    2         IF %KV_RCRLST.FRSRCR=%KV_RCRLST.LSTRCR THEN GOTO INPOPR_EXIT;
      699     3854    2         IF KV$PTR.INPCNDPND.OPRX=1
      700     3855    2         THEN Y@DLTRCR = (%KV_RCRLST.FRSRCR+%KV_RCRLST.LSTRCR+1)/2;
      701     3856    2         ELSE IF KV$PTR.INPCNDPND.OPRX<1 THEN Y@DLTRCR = %KV_RCRLST.FRSRCR;
      702     3857    2         ELSE Y@DLTRCR = %KV_RCRLST.LSTRCR;
      703     3858    2         Y@DLTRCR = Y@DLTRCR-Y@SRHCUR;
      704     3859    2         IF Y@DLTRCR=0 THEN GOTO INPOPR_EXIT;
      705     3860    2         ELSE GOTO SETEDTRHT;
      706     3861        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:26   
      707     3862    2      CASE %KV_INPPRC_FNDPSTCHR, %KV_INPPRC_FNDPSTWRD;
      708     3863    3         IF NOT %KV_MVD.EDTRHT\PRM_FND.RVRDRC THEN DO;
      709     3864    3            Y@DLTRCR = -1;
      710     3865    3            IF Y@SRHCUR=0 THEN ALTRETURN;
      711     3866    3         END;
      712     3867    2         ELSE IF Y@SRHCUR=%KV_RCRLST.RCRCNT-1 THEN ALTRETURN;
      713     3868    2   SRHNXT:;
      714     3869    2         Y@KEY$ = %KV_RCRLST.RCR$(Y@SRHCUR+Y@DLTRCR);
      715     3870    2         Y@TMP32B.TOP = Y@KEYLNG+LENGTHV(KV$RCR);
      716     3871    2         Y@TMP32B.BTM = Y@KEY$->KV$RCR.RCRBYTSIZ+Y@TMP32B.TOP;
      717     3872    3         IF Y@DLTRCR>0 THEN DO;
      718     3873    3            Y@TMP32B.TOP = Y@TMP32B.BTM-1;
      719     3874    3            Y@TMP32B.BTM = Y@KEYLNG+LENGTHV(KV$RCR)-1;
      720     3875    3         END;
      721     3876    3         IF Y@LINCNT=%KV_INPPRC_FNDPSTWRD THEN DO WHILE '1'B;
      722     3877    4            IF Y@DLTRCR>0 THEN DO UNTIL Y@LINCNT=0;
      723     3878    4               Y@TMP32B.BTM = Y@TMP32B.BTM+1;
      724     3879    4               IF Y@KEY$->RCR_BYT(Y@TMP32B.BTM)~=ASCBIN(' ') THEN GOTO CHRFND;
      725     3880    5               IF Y@TMP32B.BTM>Y@TMP32B.TOP THEN DO;
      726     3881    5                  Y@TMP32B.BTM = Y@TMP32B.BTM+1;
      727     3882    5                  Y@LINCNT = 0;
      728     3883    5               END;
      729     3884    4            END;
      730     3885    3            Y@TMP32B.BTM = Y@TMP32B.BTM-1;
      731     3886    3            IF Y@TMP32B.BTM<Y@TMP32B.TOP THEN Y@LINCNT = 0;
      732     3887    3            IF Y@TMP32B.BTM>=Y@TMP32B.TOP
      733     3888    3              AND Y@KEY$->RCR_BYT(Y@TMP32B.BTM)~=ASCBIN(' ') THEN Y@LINCNT = 0;
      734     3889    4            ELSE IF Y@LINCNT=0 THEN DO;
      735     3890    4               %KV_STR.RE_REDCLM = Y@TMP32B.BTM-Y@TMP32B.TOP+2;
      736     3891    4               GOTO SETEDTRHT;
      737     3892    4            END;
      738     3893    3         END;
      739     3894    3         ELSE DO UNTIL Y@KEY$->RCR_BYT(Y@TMP32B.BTM)=Y@SRHLO;
      740     3895    4            IF Y@TMP32B.TOP=Y@TMP32B.BTM THEN DO;
      741     3896    4               IF Y@DLTRCR>0 THEN Y@DLTRCR = Y@DLTRCR+1;
      742     3897    4               ELSE Y@DLTRCR = Y@DLTRCR-1;
      743     3898    4               IF Y@SRHCUR+Y@DLTRCR=%KV_RCRLST.RCRCNT OR Y@SRHCUR+Y@DLTRCR<0
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:27   
      744     3899    4               THEN ALTRETURN;
      745     3900    4               GOTO SRHNXT;
      746     3901    4            END;
      747     3902    3            IF Y@DLTRCR>0 THEN Y@TMP32B.BTM = Y@TMP32B.BTM+1;
      748     3903    3            ELSE Y@TMP32B.BTM = Y@TMP32B.BTM-1;
      749     3904    3         END;
      750     3905    2   CHRFND:;
      751     3906    2         %KV_STR.RE_REDCLM = Y@TMP32B.BTM-Y@KEYLNG-LENGTHV(KV$RCR)+1;
      752     3907    2   SETEDTRHT:;
      753     3908    2         IF Y@DLTRCR>0 THEN %KV_MVD.EDTRHT = '1'B;
      754     3909    2         ELSE %KV_MVD.EDTRHT = '0'B;
      755     3910    2   NXTRCR:;
      756     3911    2         %KV_RCRLST.CRTRCR = Y@SRHCUR+Y@DLTRCR;
      757     3912    2         CALL Y$UPDRCR ALTRET(ABRRED);
      758     3913        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:28   
      759     3914    2      CASE %KV_INPPRC_JOIN, %KV_INPPRC_DEL, %KV_INPPRC_DELLFT;
      760     3915    2         IF %KV_SSN.REDBFR.EDTLOWX=0 AND %KV_SSN.REDBFR__.DATBYTSIZ~=0
      761     3916    2         THEN Y@SRHCUR = Y@SRHCUR-1;
      762     3917    2         ELSE IF %KV_SSN.REDBFR.EDTLOWX<%KV_SSN.REDBFR.NXTX THEN RETURN;
      763     3918    2         IF Y@SRHCUR<0 OR Y@SRHCUR+1>=%KV_RCRLST.RCRCNT
      764     3919    2           AND (NOT %KV_RCRLST.EOF OR %KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.NEW
      765     3920    2           OR %KV_SSN.REDBFR.NXTX>0) THEN RETURN;
      766     3921    3         IF %KV_SSN.REDBFR.EDTLOWX>%KV_SSN.REDBFR.NXTX THEN DO;
      767     3922    3            %KV_SSN.REDBFR.EDTLOWX = %KV_SSN.REDBFR.NXTX;
      768     3923    3            %KV_STR.RE_REDCLM = %KV_SSN.REDBFR.EDTLOWX+1;
      769     3924    3            %KV_SSN.REDBFR__.DATBYTSIZ = %KV_SSN.REDBFR.NXTX;
      770     3925    3         END;
      771     3926    2         Y@KEY$ = %KV_RCRLST.RCR$(Y@SRHCUR);
      772     3927        /*
      773     3928           We have one possibly updated record to join to an adjacent one.
      774     3929           Insure that no data is lost by deleting before the data in the
      775     3930           deleted record has been sent in the combined record.
      776     3931        */
      777     3932    3         IF %KV_SSN.REDBFR__.DATBYTSIZ=0 THEN DO;
      778     3933        /*
      779     3934           A simple case. The possibly updated record has no data to be lost.
      780     3935           Just delete this record and position to the next one (down).
      781     3936        */
      782     3937    3            Y@KEY$->KV$RCR.RCRBYTSIZ = -1;
      783     3938    3            %KV_RCRLST.CRTRCR = %KV_RCRLST.CRTRCR+1;
      784     3939    3            Y@SRHCUR = Y@SRHCUR-1;
      785     3940    3            GOTO JOIN_DONE;
      786     3941    3         END;
      787     3942    2         Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR+1);
      788     3943    3         IF Y@SRHCUR=%KV_RCRLST.CRTRCR AND %KV_RCR.RCRBYTSIZ=0 THEN DO;
      789     3944        /*
      790     3945           The possibly updated record has all the joint data. Send it first
      791     3946           if updated.
      792     3947        */
      793     3948    3            CALL Y$UPDRCR ALTRET(ABRRED);
      794     3949    2         END; ELSE IF Y@SRHCUR~=%KV_RCRLST.CRTRCR
      795     3950    3           AND Y@KEY$->KV$RCR.RCRBYTSIZ=0 THEN DO;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:29   
      796     3951        /*
      797     3952           The possibly updated record has all the joint data, but the wrong key.
      798     3953           Shuffle things around a bit.
      799     3954        */
      800     3955    3            Y@BFRSIZ = Y@KEYLNG+LENGTHV(KV$RCR)+%KV_SSN.REDBFR__.DATBYTSIZ;
      801     3956    3            IF Y@KEY$->KV$RCR.STRBYTSIZ<Y@BFRSIZ
      802     3957    4              AND %KV_RCR.STRBYTSIZ>=Y@BFRSIZ THEN DO;
      803     3958        /*
      804     3959           Switching the RCRBFRs would save allocating a new one. Do it.
      805     3960        */
      806     3961    4               %KV_RCR.RCRBYTSIZ = 0;      /* Force writing the record.          */
      807     3962    4               SUBSTR(Y@KEY$->KV$RCR.TXT,Y@KEYLNG,Y@KEYLNG) =
      808     3963    4                 SUBSTR(%KV_RCR.TXT,0,Y@KEYLNG);
      809     3964    4               SUBSTR(%KV_RCR.TXT,0,Y@KEYLNG) =
      810     3965    4                 SUBSTR(Y@KEY$->KV$RCR.TXT,0,Y@KEYLNG);
      811     3966    4               SUBSTR(Y@KEY$->KV$RCR.TXT,0,Y@KEYLNG) =
      812     3967    4                 SUBSTR(Y@KEY$->KV$RCR.TXT,Y@KEYLNG,Y@KEYLNG);
      813     3968    4               %KV_RCRLST.RCR$(Y@SRHCUR) = Y@RCR$;
      814     3969    4               %KV_RCRLST.RCR$(Y@SRHCUR+1) = Y@KEY$;
      815     3970    4            END;
      816     3971    3            CALL Y$UPDRCR ALTRET(ABRRED);
      817     3972        /*
      818     3973           Display it in the right place.
      819     3974        */
      820     3975    3            %KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.UPD = '1'B;
      821     3976    3         END; ELSE DO;
      822     3977        /*
      823     3978           Both records have data in them. package it up.
      824     3979        */
      825     3980    3            SUBSTR(ADDR(KV@VDH_OTPLCL)->CHARS,0,Y@KEYLNG) =
      826     3981    3              SUBSTR(Y@KEY$->KV$RCR.TXT,0,Y@KEYLNG);
      827     3982    3            Y@BFRSIZ = Y@KEYLNG+LENGTHV(KV$RCR)+%KV_SSN.REDBFR__.DATBYTSIZ;
      828     3983    3            IF %KV_RCRLST.TXTEDT THEN Y@BFRSIZ = Y@BFRSIZ+2;
      829     3984    4            IF Y@SRHCUR=%KV_RCRLST.CRTRCR THEN DO;
      830     3985    4               Y@BFRSIZ = Y@BFRSIZ+%KV_RCR.RCRBYTSIZ;
      831     3986    4               Y@KEY$ = Y@RCR$;
      832     3987    4            END; ELSE DO;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:30   
      833     3988    4               %KV_STR.RE_REDCLM = Y@KEY$->KV$RCR.RCRBYTSIZ+1;
      834     3989    4               Y@BFRSIZ = Y@BFRSIZ+Y@KEY$->KV$RCR.RCRBYTSIZ;
      835     3990    4               Y@KEY$->KV$RCR.NEW = %KV_RCR.NEW;
      836     3991    4               SUBSTR(Y@KEY$->KV$RCR.TXT,0,Y@KEYLNG) =
      837     3992    4                 SUBSTR(%KV_RCR.TXT,0,Y@KEYLNG);
      838     3993    4               %KV_RCRLST.RCR$(Y@SRHCUR) = Y@RCR$;
      839     3994    4               %KV_RCRLST.RCR$(Y@SRHCUR+1) = Y@KEY$;
      840     3995    4            END;
      841     3996    3            Y@DLTRCR = Y@SRHCUR;
      842     3997    3            CALL Y$GETRCRBFR;
      843     3998    3            Y@BFRSIZ = %KV_SSN.REDBFR__.DATBYTSIZ;
      844     3999    3            IF %KV_SSN.REDBFR.EDTLOWX=0
      845     4000    3            THEN Y@DLTRCR = Y@KEYLNG+%KV_RCR.RCRBYTSIZ-Y@BFRSIZ;
      846     4001    3            ELSE Y@DLTRCR = Y@KEYLNG;
      847     4002    3            SUBSTR(%KV_RCR.TXT,Y@DLTRCR,Y@BFRSIZ) =
      848     4003    3              SUBSTR(%KV_SSN.REDBFR__.ADR$->CHARS,%KV_SSN.REDBFR__.BYTX,Y@BFRSIZ);
      849     4004    3            Y@BFRSIZ = Y@KEY$->KV$RCR.RCRBYTSIZ;
      850     4005    3            IF Y@KEYLNG~=Y@DLTRCR THEN Y@DLTRCR = Y@KEYLNG;
      851     4006    3            ELSE Y@DLTRCR = Y@KEYLNG+%KV_RCR.RCRBYTSIZ-Y@BFRSIZ;
      852     4007    3            SUBSTR(%KV_RCR.TXT,Y@DLTRCR,Y@BFRSIZ) =
      853     4008    3              SUBSTR(Y@KEY$->KV$RCR.TXT,Y@KEYLNG,Y@BFRSIZ);
      854     4009    4            IF %KV_RCRLST.TXTEDT THEN DO;
      855     4010    4               IF Y@DLTRCR=Y@KEYLNG THEN Y@DLTRCR = Y@DLTRCR+Y@BFRSIZ+2;
      856     4011    4               Y@LINCNT = Y@DLTRCR-2;
      857     4012    4               SUBSTR(%KV_RCR.TXT,Y@LINCNT,1) = ' ';
      858     4013    4               SUBSTR(%KV_RCR.TXT,Y@LINCNT+1,1) = ' ';
      859     4014    5               DO WHILE SUBSTR(%KV_RCR.TXT,Y@DLTRCR,1)=' ';
      860     4015    5                  IF Y@DLTRCR-Y@KEYLNG=%KV_RCR.RCRBYTSIZ THEN EXIT;
      861     4016    5                  Y@DLTRCR = Y@DLTRCR+1;
      862     4017    5               END;
      863     4018    5               DO UNTIL SUBSTR(%KV_RCR.TXT,Y@LINCNT,1)~=' ';
      864     4019    5                  Y@LINCNT = Y@LINCNT-1;
      865     4020    5                  IF Y@LINCNT=Y@KEYLNG THEN EXIT;
      866     4021    5               END;
      867     4022    5               IF SUBSTR(%KV_RCR.TXT,Y@LINCNT,1)=' ' THEN DO;
      868     4023    5                  IF %KV_STR.AUTTABCLM>1
      869     4024    5                  THEN Y@LINCNT = Y@LINCNT+%KV_STR.AUTTABCLM-1;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:31   
      870     4025    4               END; ELSE IF (SUBSTR(%KV_RCR.TXT,Y@LINCNT,1)='.'
      871     4026    4                 OR SUBSTR(%KV_RCR.TXT,Y@LINCNT,1)='!'
      872     4027    4                 OR SUBSTR(%KV_RCR.TXT,Y@LINCNT,1)='?')
      873     4028    4                 AND NOT %KV_RCRLST.ONESPCEDT
      874     4029    4               THEN Y@LINCNT = Y@LINCNT+3;
      875     4030    4               ELSE Y@LINCNT = Y@LINCNT+2;
      876     4031    4               IF Y@DLTRCR<=Y@LINCNT THEN EXIT;
      877     4032    4               Y@BFRSIZ = %KV_RCR.RCRBYTSIZ-Y@DLTRCR+Y@KEYLNG;
      878     4033    4               %KV_STR.RE_REDCLM = Y@LINCNT-Y@KEYLNG+1;
      879     4034    4               %KV_RCR.RCRBYTSIZ = %KV_RCR.RCRBYTSIZ+Y@LINCNT-Y@DLTRCR;
      880     4035    4               SUBSTR(%KV_RCR.TXT,Y@LINCNT,Y@BFRSIZ) =
      881     4036    4                 SUBSTR(%KV_RCR.TXT,Y@DLTRCR,Y@BFRSIZ);
      882     4037    4            END;
      883     4038    3            %KV_RCRLST.SNDRCR = Y@SRHCUR;
      884     4039    3            IF %KV_STR.SNDMAXNMBRCR~=0 THEN CALL Y$SNDRCR;
      885     4040    3         END;
      886     4041    2         Y@KEY$ = %KV_RCRLST.RCR$(Y@SRHCUR+1);
      887     4042    2         Y@KEY$->KV$RCR.RCRBYTSIZ = -1;
      888     4043    2         %KV_RCRLST.CRTRCR = Y@SRHCUR;
      889     4044        /*E*  ERROR: KVE-E$RECORD_DELETED-0
      890     4045              MESSAGE:A normal join operation caused this record to disappear.
      891     4046        */
      892     4047    2   JOIN_DONE:;
      893     4048    2         %KV_RCRLST.DLTRCREXS = '1'B;
      894     4049    2         IF Y@KEY$->KV$RCR.NEW THEN EXIT;  /* No need to report this one         */
      895     4050    2         IF %KV_RCRLST.SNDRCR>=0 THEN %KV_RCRLST.SNDRQR.DLT = '1'B;
      896     4051    2         ELSE %KV_RCRLST.SNDRCR = Y@SRHCUR+1;
      897     4052    2         IF %KV_STR.SNDMAXNMBRCR~=0 THEN CALL Y$SNDRCR;
      898     4053        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:32   
      899     4054    2      CASE %KV_INPPRC_SPLIT;
      900     4055    3         IF %KV_SSN.REDBFR.EDTLOWX>%KV_SSN.REDBFR.NXTX THEN DO;
      901     4056    3            %KV_SSN.REDBFR.EDTLOWX = %KV_SSN.REDBFR.NXTX;
      902     4057    3            %KV_STR.RE_REDCLM = %KV_SSN.REDBFR.EDTLOWX+1;
      903     4058    3            %KV_SSN.REDBFR__.DATBYTSIZ = %KV_SSN.REDBFR.NXTX;
      904     4059    3         END;
      905     4060    3         IF Y@DLTRCR=1 AND %KV_RCRLST.DFRCNT=0 THEN DO;
      906     4061    3            Y@DLTRCR = MAXIMUM (0,KV$PTR.INPCNDPND.OPRX);
      907     4062    3            IF Y@DLTRCR=0 THEN EXIT;
      908     4063    3            %KV_RCRLST.DFRCNT = %KV_RCRLST.LSTRCR-%KV_RCRLST.CRTRCR+1;
      909     4064    3         END;
      910     4065    2         Y@LINCNT = Y@DLTRCR;
      911     4066    2         IF Y@LINCNT>0 AND %KV_STR.WRDWRPCLM<12 THEN GOTO INPOPR_EXIT;
      912     4067    2   SPLIT_ONE:;
      913     4068    3         IF Y@LINCNT>0 THEN DO;
      914     4069        /*
      915     4070           Find the spot to split the line at.
      916     4071        */
      917     4072    3            Y@DLTRCR = %KV_STR.WRDWRPCLM;
      918     4073    3            Y@KEY$ = %KV_SSN.REDBFR__.ADR$;
      919     4074    4            IF Y@DLTRCR<%KV_SSN.REDBFR.NXTX THEN DO;
      920     4075    4               %KV_STR.RE_REDCLM = %KV_SSN.REDBFR.NXTX+1;
      921     4076    5               DO UNTIL Y@DLTRCR<0;
      922     4077    5                  IF SUBSTR(Y@KEY$->CHARS,Y@DLTRCR,1)=' ' THEN EXIT;
      923     4078    5                  Y@DLTRCR = Y@DLTRCR-1;
      924     4079    5               END;
      925     4080    4               IF Y@DLTRCR<%KV_STR.WRDWRPCLM/2 OR Y@DLTRCR<%KV_STR.AUTTABCLM
      926     4081    4               THEN Y@DLTRCR = %KV_STR.WRDWRPCLM;
      927     4082    4               ELSE Y@DLTRCR = Y@DLTRCR+1;
      928     4083    4               %KV_SSN.REDBFR.EDTLOWX = Y@DLTRCR;
      929     4084    4               IF Y@LINCNT=1 AND %KV_RCRLST.DFRCNT>0
      930     4085    4               THEN %KV_RCRLST.DFROPR = %KV_INPPRC_SPLIT;
      931     4086    4            END; ELSE DO;
      932     4087        /*
      933     4088           The current one's too short - see if we can get anything from the next one.
      934     4089        */
      935     4090    4               IF %KV_RCRLST.CRTRCR+1=%KV_RCRLST.RCRCNT OR %KV_RCRLST.DFRCNT=1
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:33   
      936     4091    4               THEN GOTO INPOPR_EXIT;
      937     4092    5               DO WHILE %KV_SSN.REDBFR__.BFRBYTSIZ<Y@DLTRCR+1;
      938     4093    6                  CALL KVS$GETREDBFR WHENALTRETURN DO;
      939     4094    6                     %KV_STR.ERR.COD = %E$CANTGETCTX;
      940     4095    6                     CALL Y$UPDRCRSND;
      941     4096    6                     GOTO ABRRED;
      942     4097    6                  END;
      943     4098    5                  Y@KEY$ = %KV_SSN.REDBFR__.ADR$;
      944     4099    5               END;
      945     4100    4               Y@SRHLO = %KV_SSN.REDBFR.NXTX;
      946     4101    5               DO WHILE Y@SRHLO>0;
      947     4102    5                  Y@SRHLO = Y@SRHLO-1;
      948     4103    5                  IF SUBSTR(Y@KEY$->CHARS,Y@SRHLO,1)~=' ' THEN EXIT;
      949     4104    5               END;
      950     4105    4               SUBSTR(Y@KEY$->CHARS,Y@SRHLO+1,1) = ' ';
      951     4106    4               SUBSTR(Y@KEY$->CHARS,Y@SRHLO+2,1) = ' ';
      952     4107    4               IF Y@SRHLO>=0 THEN IF (SUBSTR(Y@KEY$->CHARS,Y@SRHLO,1)='!'
      953     4108    4                 OR SUBSTR(Y@KEY$->CHARS,Y@SRHLO,1)='?'
      954     4109    4                 OR SUBSTR(Y@KEY$->CHARS,Y@SRHLO,1)='.')
      955     4110    4                 AND NOT %KV_RCRLST.ONESPCEDT
      956     4111    4               THEN Y@SRHLO = Y@SRHLO+3;
      957     4112    4               ELSE Y@SRHLO = Y@SRHLO+2;
      958     4113    5               ELSE DO;                    /* Start at autotab column            */
      959     4114    5                  Y@SRHLO = MAXIMUM (1,%KV_STR.AUTTABCLM)-1;
      960     4115    5                  SUBSTR(Y@KEY$->CHARS,0,Y@SRHLO) = ' ';
      961     4116    5               END;
      962     4117    4               Y@DLTRCR = Y@DLTRCR-Y@SRHLO; /* Space available                   */
      963     4118    4               Y@KEY$ = %KV_RCRLST.RCR$(%KV_RCRLST.CRTRCR+1);
      964     4119    4               Y@REDLIN = 0;
      965     4120    5               DO WHILE '1'B;
      966     4121    5                  IF SUBSTR(Y@KEY$->KV$RCR.TXT,Y@REDLIN+Y@KEYLNG,1)~=' ' THEN EXIT;
      967     4122    5                  IF Y@REDLIN>=Y@KEY$->KV$RCR.RCRBYTSIZ THEN EXIT;
      968     4123    5                  Y@REDLIN = Y@REDLIN+1;
      969     4124    5               END;
      970     4125    4               IF Y@REDLIN>=Y@KEY$->KV$RCR.RCRBYTSIZ
      971     4126    4                 OR Y@REDLIN~=%KV_STR.AUTTABCLM-1
      972     4127    4                 AND (Y@REDLIN~=0 OR %KV_STR.AUTTABCLM~=0) THEN GOTO INPOPR_EXIT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:34   
      973     4128        /*
      974     4129           The next one starts at autotab.  See if a word ends before DLTRCR more bytes.
      975     4130        */
      976     4131    4               Y@DLTRCR = MINIMUM(Y@KEY$->KV$RCR.RCRBYTSIZ, Y@REDLIN+Y@DLTRCR);
      977     4132    4               IF Y@DLTRCR<Y@KEY$->KV$RCR.RCRBYTSIZ
      978     4133    5               THEN DO WHILE Y@DLTRCR>Y@REDLIN;
      979     4134    5                  IF SUBSTR(Y@KEY$->KV$RCR.TXT,Y@DLTRCR+Y@KEYLNG,1)=' ' THEN EXIT;
      980     4135    5                  Y@DLTRCR = Y@DLTRCR-1;
      981     4136    5               END;
      982     4137    4               %KV_STR.RE_REDCLM = 1;
      983     4138    5               IF %KV_RCRLST.DFRCNT>1 THEN DO;
      984     4139    5                  %KV_RCRLST.DFRCNT = %KV_RCRLST.DFRCNT-1;
      985     4140    5                  %KV_RCRLST.DFROPR = %KV_INPPRC_SPLIT;
      986     4141    5               END;
      987     4142    5               IF Y@DLTRCR<=Y@REDLIN THEN DO;
      988     4143        /*
      989     4144           Y@DLTRCR may be 1 or 2 less, because of the space insertion for !?. above.
      990     4145        */
      991     4146        /* Nothing to do - the next word is too big */
      992     4147    5                  Y@REDLIN = Y@SRHCUR;
      993     4148    5                  %KV_RCRLST.CRTRCR = %KV_RCRLST.CRTRCR+1;
      994     4149    5                  CALL Y$UPDRCR ALTRET(ABRRED);
      995     4150    5                  EXIT INPOPR;
      996     4151    5               END;
      997     4152    4               Y@DLTRCR = Y@DLTRCR-Y@REDLIN;
      998     4153    4               SUBSTR(%KV_SSN.REDBFR__.ADR$->CHARS,Y@SRHLO,Y@DLTRCR) =
      999     4154    4                 SUBSTR(Y@KEY$->KV$RCR.TXT,Y@REDLIN+Y@KEYLNG,Y@DLTRCR);
     1000     4155    4               %KV_SSN.REDBFR.NXTX = Y@SRHLO+Y@DLTRCR;
     1001     4156    4               Y@SRHLO = Y@DLTRCR+Y@REDLIN;
     1002     4157    5               DO UNTIL SUBSTR(Y@KEY$->KV$RCR.TXT,Y@SRHLO+Y@KEYLNG,1)~=' ';
     1003     4158    5                  IF Y@SRHLO>=Y@KEY$->KV$RCR.RCRBYTSIZ THEN EXIT;
     1004     4159    5                  Y@SRHLO = Y@SRHLO+1;
     1005     4160    5               END;
     1006     4161    5               IF Y@SRHLO<Y@KEY$->KV$RCR.RCRBYTSIZ THEN DO;
     1007     4162    5                  Y@DLTRCR = Y@KEY$->KV$RCR.RCRBYTSIZ-Y@SRHLO;
     1008     4163    5                  SUBSTR(Y@KEY$->KV$RCR.TXT,Y@REDLIN+Y@KEYLNG,Y@DLTRCR) =
     1009     4164    5                    SUBSTR(Y@KEY$->KV$RCR.TXT,Y@SRHLO+Y@KEYLNG,Y@DLTRCR);
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:35   
     1010     4165    5                  Y@KEY$->KV$RCR.RCRBYTSIZ = Y@REDLIN+Y@DLTRCR;
     1011     4166    5                  Y@KEY$->KV$RCR.UPD = '1'B;
     1012     4167    5                  Y@KEY$->KV$RCR.NEW = '1'B;
     1013     4168    5                  %KV_RCRLST.CRTRCR = %KV_RCRLST.CRTRCR+1;
     1014     4169    5                  CALL Y$UPDRCRSND ALTRET(ABRRED);
     1015     4170    5               END; ELSE DO;
     1016     4171    5                  Y@KEY$->KV$RCR.RCRBYTSIZ = -1;
     1017     4172    5                  Y@KEY$->KV$RCR.NEW = '0'B;
     1018     4173    5                  CALL Y$UPDRCRSND ALTRET(ABRRED);
     1019     4174    5                  %KV_RCRLST.SNDRCR = Y@SRHCUR+1;
     1020     4175    5                  IF %KV_STR.SNDMAXNMBRCR>0 THEN CALL Y$SNDRCR;
     1021     4176    5               END;
     1022     4177    4               %KV_RCR.UPD = '1'B;
     1023     4178    4               Y@REDLIN = Y@SRHCUR;
     1024     4179    4               EXIT INPOPR;
     1025     4180    4            END;
     1026     4181    3         END;
     1027     4182    2         Y@KEYINC = %KV_RCRLST.KEYINC;
     1028     4183    2         IF Y@KEYINC=65535 THEN Y@KEYINC = 0;
     1029     4184    2         Y@KEY$ = ADDR(Y_BIGKEY);
     1030     4185    3         IF Y@SRHCUR+1=%KV_RCRLST.RCRCNT THEN DO;
     1031     4186    3            IF NOT %KV_RCRLST.EOF
     1032     4187    3              OR NOT %KV_RCRLST.ESYAPP AND %KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.NEW
     1033     4188    3              AND %KV_SSN.REDBFR.NXTX=0
     1034     4189    3            THEN GOTO INPOPR_EXIT;
     1035     4190    3         END; ELSE DO;
     1036     4191    3            Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR+1);
     1037     4192    3            IF NOT %KV_RCR.NEW OR Y@SRHCUR+2<%KV_RCRLST.RCRCNT
     1038     4193    3              OR NOT %KV_RCRLST.EOF
     1039     4194    3            THEN Y@KEY$ = ADDR(%KV_RCR.TXT);
     1040     4195    3         END;
     1041     4196    2         CALL Y$CMPKEY;
     1042     4197    2         IF Y@KEYLNG>2 THEN IF Y@TMP32B.TOP~=0 THEN Y@KEYCMP = -1;
     1043     4198    2         ELSE Y@KEYCMP = Y@TMP32B.BTM;
     1044     4199    2         Y@SRHLO = 2;                      /* Cycle tracker for 521 algorithm    */
     1045     4200    3         DO WHILE Y@KEYINC>=Y@KEYCMPU;
     1046     4201    4            DO CASE %KV_RCRLST.KEYTYP;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:36   
     1047     4202    4            CASE ELSE;
     1048     4203    4               Y@KEYINC = 0;
     1049     4204    4            CASE %G_KEYTYPE_BINHLF#;
     1050     4205    4               Y@KEYINC = Y@KEYCMPU/2;
     1051     4206    4            CASE %G_KEYTYPE_BIN10#;
     1052     4207    4               Y@KEYINC = Y@KEYINC/10;
     1053     4208    4            CASE %G_KEYTYPE_BIN521#;
     1054     4209    4               Y@SRHLO = Y@SRHLO-1;
     1055     4210    5               IF Y@SRHLO = 0 THEN DO;
     1056     4211    5                  Y@SRHLO = 3;
     1057     4212    5                  Y@KEYINC = Y@KEYINC*2/5;
     1058     4213    5               END;
     1059     4214    4               ELSE Y@KEYINC = Y@KEYINC/2;
     1060     4215    4            END;
     1061     4216    3         END;
     1062     4217    2         Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);
     1063     4218    2         Y@KEY$ = ADDR(%KV_RCR.TXT);
     1064     4219    2         CALL Y$INCKEY;
     1065     4220    3         IF Y@KEYINC=0 THEN DO;
     1066     4221    3            %KV_STR.RE_REDCLM = %KV_SSN.REDBFR.EDTLOWX+1;
     1067     4222    3            %KV_STR.ERR.COD = %E$INSERT_NO_ROOM;
     1068     4223    3            IF Y@LINCNT>0 THEN %KV_RCRLST.ACTCHR = '1'B;
     1069     4224    3            %KV_RCRLST.DATCTRCHR = ASCBIN(' ');
     1070     4225    3            CALL Y$UPDRCRSND;
     1071     4226    3            IF %KV_RCRLST.SNDRCR<0 THEN %KV_RCRLST.ACTCHR = '0'B;
     1072     4227    3            GOTO ABRRED;
     1073     4228         /*E*  ERROR:KVE-E$INSERT_NO_ROOM-0
     1074     4229                 MESSAGE:Insert attempted but couldn't be done by the system.
     1075     4230                 MESSAGE1:It was not possible to choose a key before the next record
     1076     4231                          conforming to the restraints imposed by KEYTYPE and KEYINCR.
     1077     4232                          The accompanying record is the desired "splitee".
     1078     4233           */
     1079     4234    3         END;
     1080     4235    2         Y@KEY$ = Y@RCR$;                  /* Save split record pointer          */
     1081     4236    2         Y@SRHCUR = Y@SRHCUR+1;
     1082     4237    2         Y@DLTRCR = %KV_RCRLST.RCRCNT-1;
     1083     4238    2         IF Y@SRHCUR~=Y@DLTRCR OR NOT %KV_RCRLST.EOF
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:37   
     1084     4239    2           OR NOT %KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.NEW
     1085     4240    2         THEN IF %KV_RCRLST.RCRCNT<%KV_RCRLST.MAXRCR THEN Y@DLTRCR = -1;
     1086     4241    2         ELSE IF Y@SRHCUR>Y@DLTRCR OR Y@SRHCUR=Y@DLTRCR AND %KV_RCRLST.EOF
     1087     4242    2         THEN Y@DLTRCR = 0;
     1088     4243    2         ELSE %KV_RCRLST.EOF = '0'B;
     1089     4244    2         IF %KV_STR.AUTTABCLM>1
     1090     4245    2         THEN IF Y@LINCNT>0
     1091     4246    2           OR %KV_SSN.REDBFR.NXTX>%KV_SSN.REDBFR.EDTLOWX AND %KV_RCRLST.TXTEDT
     1092     4247    2         THEN Y@KEYLNG = Y@KEYLNG+%KV_STR.AUTTABCLM-1;
     1093     4248        /* Bump KEYLNG to get the data into a large enough buffer where it belongs */
     1094     4249    2         Y@BFRSIZ = Y@KEYLNG+LENGTHV(KV$RCR)+
     1095     4250    2           %KV_SSN.REDBFR.NXTX-%KV_SSN.REDBFR.EDTLOWX;
     1096     4251    2         CALL Y$GETRCRBFR ALTRET(ABRRED);
     1097     4252    2         %KV_RCR.LINCNT = 0;
     1098     4253    2         Y@BFRSIZ = %KV_RCR.RCRBYTSIZ;
     1099     4254    3         IF Y@BFRSIZ~=0 THEN DO;
     1100     4255        /*
     1101     4256        Send the new record only if there's data in it.
     1102     4257        */
     1103     4258    3            SUBSTR(%KV_RCR.TXT,Y@KEYLNG,Y@BFRSIZ) = SUBSTR
     1104     4259    3              (%KV_SSN.REDBFR__.ADR$->CHARS,%KV_SSN.REDBFR.EDTLOWX,Y@BFRSIZ);
     1105     4260    3            IF Y@LINCNT>0 OR %KV_RCRLST.TXTEDT
     1106     4261        /* Make sure the record doesn't start with any blanks */
     1107     4262    4            THEN DO WHILE Y@BFRSIZ>1 AND SUBSTR(%KV_RCR.TXT,Y@KEYLNG,1)=' ';
     1108     4263    4               Y@BFRSIZ = Y@BFRSIZ-1;
     1109     4264    4               SUBSTR(%KV_RCR.TXT,Y@KEYLNG,Y@BFRSIZ)=
     1110     4265    4                 SUBSTR(%KV_RCR.TXT,Y@KEYLNG+1,Y@BFRSIZ);
     1111     4266    4               %KV_RCR.RCRBYTSIZ = %KV_RCR.RCRBYTSIZ-1;
     1112     4267    4               IF Y@LINCNT>0 THEN %KV_STR.RE_REDCLM = %KV_STR.RE_REDCLM-1;
     1113     4268    4            END;
     1114     4269    4            IF Y@KEYLNG~=%KV_RCRLST.KEYLNG THEN DO;
     1115     4270        /* Put in the autotab spaces. */
     1116     4271    4               Y@KEYLNG = %KV_RCRLST.KEYLNG;
     1117     4272    4               IF Y@LINCNT>0
     1118     4273    4               THEN %KV_STR.RE_REDCLM = %KV_STR.RE_REDCLM+%KV_STR.AUTTABCLM-1;
     1119     4274    4               %KV_RCR.RCRBYTSIZ = %KV_RCR.RCRBYTSIZ+%KV_STR.AUTTABCLM-1;
     1120     4275    4               SUBSTR(%KV_RCR.TXT,Y@KEYLNG,%KV_STR.AUTTABCLM-1) = ' ';
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:38   
     1121     4276    4            END;
     1122     4277    4            IF Y@LINCNT>0 THEN DO;
     1123     4278        /* This split is due to word-wrap. Position to the new part, and dont send it */
     1124     4279    4               CALL KVI$EDTX_TO_VRTCLM (%KV_MVD.VRTCLM); /* Prepare to erase     */
     1125     4280    4               CALL KVO$PST (KV_VDH_PST_VRT);
     1126     4281    4               %KV_RCR.NEW = '1'B;
     1127     4282    4               %KV_STR.RE_REDCLM = %KV_STR.RE_REDCLM-%KV_SSN.REDBFR.EDTLOWX;
     1128     4283    4               %KV_RCRLST.CRTRCR = Y@SRHCUR;
     1129     4284    4            END; ELSE DO;
     1130     4285    4               %KV_RCRLST.SNDRCR = Y@SRHCUR;
     1131     4286    4               IF %KV_STR.SNDMAXNMBRCR~=0 THEN CALL Y$SNDRCR;
     1132     4287    4               Y@KEY$ = ADDR(NIL);         /* Remember to stay here.             */
     1133     4288    4            END;
     1134     4289    3            CALL KVO$ERSTO_ENDOF_INP;      /* Erase the shifted part             */
     1135     4290    3         END;
     1136     4291    3         ELSE DO;
     1137     4292        /*
     1138     4293        Position to the empty record.
     1139     4294        */
     1140     4295    3            %KV_RCR.NEW = '1'B;
     1141     4296    3            %KV_STR.RE_REDCLM = MAXIMUM(1,%KV_STR.AUTTABCLM);
     1142     4297    3            Y@KEYLNG = %KV_RCRLST.KEYLNG;
     1143     4298    3            %KV_RCRLST.CRTRCR = Y@SRHCUR;
     1144     4299    3         END;
     1145     4300    2         %KV_SSN.REDBFR.NXTX = %KV_SSN.REDBFR.EDTLOWX;
     1146     4301    2         %KV_SSN.REDBFR.INSMODX = %KV_SSN.REDBFR.EDTLOWX;
     1147     4302    2         %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.EDTLOWX;
     1148     4303    2         %KV_SSN.REDBFR__.DATBYTSIZ = %KV_SSN.REDBFR.EDTLOWX;
     1149     4304    2         Y@SRHCUR = Y@SRHCUR-1;
     1150     4305    2         Y@REDLIN = Y@SRHCUR;
     1151     4306    2         Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);
     1152     4307    3         IF %KV_STR.SNDMAXNMBRCR~=0 AND Y@KEY$=ADDR(NIL) THEN DO;
     1153     4308        /*N* MAXNMBRCR~=0 should be SNDRCR<0 */
     1154     4309        /*
     1155     4310        We can still edit. Stay on this record.
     1156     4311        */
     1157     4312    3            CALL Y$DSPALL;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:39   
     1158     4313    3   INPOPR_EXIT:;
     1159     4314    3            IF KV@USR_RQSDAT.RE_RED THEN CALL KVV$VDIINT(KV_VDH_DAT);
     1160     4315        /* Now is the time for typeahead if we got here from Y$ENBRED */
     1161     4316    3            RETURN;
     1162     4317    3         END;
     1163     4318    2         CALL Y$UPDRCR ALTRET(ABRRED);
     1164     4319    2      END /* CASE */;
     1165     4320        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:40   
     1166     4321    1      IF %KV_RCRLST.TXTEDT AND %KV_STR.RE_REDCLM<%KV_STR.AUTTABCLM
     1167     4322    1        AND %KV_STR.RE_REDCLM>0
     1168     4323    1      THEN %KV_STR.RE_REDCLM = %KV_STR.AUTTABCLM;
     1169     4324    1      KV@USR_RQSDAT = KV_USR_RQSDAT;
     1170     4325    1      KV@USR_RQSDAT.MAXRCRBYTSIZ = %KV_STR.MAXRCRBYTSIZ;
     1171     4326    2      IF %KV_RCRLST.SNDRCR<0 AND NOT %KV_RCRLST.SNDRQR THEN DO;
     1172     4327        /*
     1173     4328           We can allow more editing.  Place the cursor appropriately.
     1174     4329        */
     1175     4330    3         CALL Y$CHKSCR WHENRETURN DO;
     1176     4331    3            GOTO Y$ENBRED;
     1177     4332    3         END;
     1178     4333    2         IF %KV_STR.SNDMAXNMBRCR~=0 THEN CALL Y$SNDNEED;
     1179     4334    2      END; ELSE IF Y@REDLIN~=%KV_RCRLST.CRTRCR AND %KV_RCRLST.DFROPR=0 THEN DO;
     1180     4335    2         %KV_RCRLST.DFROPR = %KV_INPPRC_SE_DWN;
     1181     4336    2         %KV_RCRLST.DFRCNT = %KV_RCRLST.CRTRCR-Y@REDLIN;
     1182     4337    2         %KV_RCRLST.CRTRCR = Y@REDLIN;
     1183     4338    2      END;
     1184     4339    1   ABRRED:;
     1185     4340    1      CALL KVI$PRGRED;
     1186     4341    1      CALL KVI$TRMRED_VDH_DAT;
     1187     4342    1      IF %KV_SRD.PRKCRS THEN CALL KVO$PST (KV_VDH_PST_HOM);
     1188     4343    1      RETURN;
     1189     4344        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:41   
     1190     4345    1   KVE$INSREC: ENTRY ALTRET;
     1191     4346        /*F* NAME: KVE$INSREC.
     1192     4347             DESCRIPTION: Called by the protocol receiver as a result of a
     1193     4348             VDO_DAT, to put a new (or updated) record into the editor context.
     1194     4349             The record is described by KV_RCVVDO. In particular .OTPLCL and
     1195     4350             .VDOVLP_KEY$.
     1196     4351        */
     1197     4352
     1198     4353    1      CALL Y$SETUP;
     1199     4354    1      Y@KEY$ = PINCRW(KV_RCVVDO.VDOVLP_KEY$,SIZEW(KV$VDOVLP));
     1200     4355    2      IF KV_RCVVDO.VDOVLP_ERR$~=ADDR(NIL) THEN DO;
     1201     4356    3         IF KV_RCVVDO.VDOVLP_ERR$->KV$VDOVLP_ERR.ERRCODE.ERR#=%E$EOF THEN DO;
     1202     4357    3            IF %KV_RCRLST.DATCTRCHR>=0 THEN %KV_RCRLST.EOF = '1'B;
     1203     4358    3            ELSE IF %KV_RCRLST.RCRNEDSNT THEN %KV_RCRLST.BOF = '1'B;
     1204     4359    3            %KV_RCRLST.RCRNEDSNT = '0'B;
     1205     4360    3            %KV_RCRLST.EOFDSP = '0'B;
     1206     4361    3            RETURN;
     1207     4362    3         END;
     1208     4363    2         IF KV_RCVVDO.OTPLCL.BFR_.ADR$~=ADDR(NIL)
     1209     4364    2         THEN Y@KEY$ = KV_RCVVDO.OTPLCL.BFR_.ADR$;
     1210     4365    2         IF %KV_RCRLST.RCRCNT=0 THEN RETURN;
     1211     4366    3         CALL Y$FNDKEY WHENRETURN DO;
     1212     4367    3            Y@SRHCUR = Y@SRHCUR-1;
     1213     4368    3         END;
     1214     4369    2         Y@KEY$ = PINCRW(KV_RCVVDO.VDOVLP_KEY$, SIZEW(KV$VDOVLP));
     1215     4370    2         KV@VDH_GETBFR = Y_VDH_GETBFR;
     1216     4371    3         DO WHILE Y@SRHCUR>=0;
     1217     4372        /*
     1218     4373           Delete until the current record key is smaller than the start key.
     1219     4374        */
     1220     4375    3            CALL Y$CMPKEY;
     1221     4376    3            IF Y@KEYCMP>0 THEN EXIT;
     1222     4377    3            CALL Y$DLTRCR;
     1223     4378    3            IF Y@SRHCUR+1>=%KV_RCRLST.RCRCNT THEN %KV_RCRLST.EOF = '0'B;
     1224     4379         /* 6EDIT deletes the last record just to make sure it is in sync */
     1225     4380         /* It's still in the file, so EOF shouldn't be set. */
     1226     4381    3            Y@SRHCUR = Y@SRHCUR-1;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:42   
     1227     4382    3         END;
     1228     4383    2         RETURN;
     1229     4384    2      END;
     1230     4385    2      CALL Y$FNDKEY WHENRETURN DO;
     1231     4386        /*
     1232     4387           The record has a new key.  Check for insertion or extension.
     1233     4388        */
     1234     4389    3         IF %KV_RCRLST.RCRCNT=%KV_RCRLST.MAXRCR THEN DO;
     1235     4390        /*
     1236     4391           The context is full, pick a record to discard.
     1237     4392        */
     1238     4393    3            %KV_RCRLST.EOF = '0'B;         /* Last going away, or write past it  */
     1239     4394    3            IF Y@KEYCMP>0 THEN Y@DLTRCR = 0;
     1240     4395    3            ELSE Y@DLTRCR = %KV_RCRLST.RCRCNT-1;
     1241     4396    3         END;
     1242     4397    3         ELSE DO;
     1243     4398    4            IF %KV_RCRLST.RCRCNT=0 THEN DO;
     1244     4399    4               %KV_RCRLST.CRTRCR = 0;
     1245     4400    4               %KV_STR.RE_REDCLM = 1;
     1246     4401    4            END;
     1247     4402    3            Y@DLTRCR = -1;
     1248     4403    3         END;
     1249     4404        /*
     1250     4405           Re-use a deleted record if it's still on the screen.
     1251     4406        */
     1252     4407    2         IF Y@SRHCUR>0
     1253     4408    3         THEN IF %KV_RCRLST.RCR$(Y@SRHCUR-1)->KV$RCR.RCRBYTSIZ<0 THEN DO;
     1254     4409    3            Y@SRHCUR = Y@SRHCUR-1;
     1255     4410    3            Y@DLTRCR = Y@SRHCUR;
     1256     4411    3         END;
     1257     4412    2         IF Y@SRHCUR<%KV_RCRLST.RCRCNT AND Y@SRHCUR~=Y@DLTRCR
     1258     4413    2         THEN IF %KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.RCRBYTSIZ<0
     1259     4414    2         THEN Y@DLTRCR = Y@SRHCUR;
     1260     4415    2      END;
     1261     4416    2      WHENALTRETURN DO;
     1262     4417        /*
     1263     4418           Replace existing record.
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:43   
     1264     4419        */
     1265     4420    2         Y@DLTRCR = Y@SRHCUR;
     1266     4421    2      END;
     1267     4422
     1268     4423    1      Y@BFRSIZ = Y@KEYLNG+LENGTHV(KV$RCR)+KV_RCVVDO.OTPLCL.BFR_.BYTSIZ;
     1269     4424    2      IF Y@SRHCUR=Y@DLTRCR THEN DO;
     1270     4425        /*
     1271     4426           Check for identical replacement.  The screen may already be ok.
     1272     4427        */
     1273     4428    2         Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);
     1274     4429    2         IF %KV_RCR.RCRBYTSIZ<0
     1275     4430    2           AND %KV_RCR.RCRBYTSIZ+KV_RCVVDO.OTPLCL.BFR_.BYTSIZ=0
     1276     4431    2         THEN IF SUBSTR(%KV_RCR.TXT,Y@KEYLNG,KV_RCVVDO.OTPLCL.BFR_.BYTSIZ)=
     1277     4432    2           SUBSTR(KV_RCVVDO.OTPLCL.BFR_.ADR$->CHARS,KV_RCVVDO.OTPLCL.BFR_.BYTX,
     1278     4433    2           KV_RCVVDO.OTPLCL.BFR_.BYTSIZ) THEN GOTO USE_DLTRCR;
     1279     4434    2      END;
     1280     4435    1      CALL Y$GETRCRBFR ALTRET(ABRRED);
     1281     4436    1      %KV_RCR.DSP = '0'B;
     1282     4437    2      IF %KV_RCRLST.RCRNEDSNT THEN DO;
     1283     4438    2         IF %KV_RCRLST.DATCTRCHR>0 AND Y@KEYCMP>0
     1284     4439    2         THEN %KV_RCRLST.DATCTRCHR = %KV_RCRLST.DATCTRCHR-1;
     1285     4440    2         ELSE IF %KV_RCRLST.DATCTRCHR<0 AND Y@KEYCMP<0
     1286     4441    2         THEN %KV_RCRLST.DATCTRCHR = %KV_RCRLST.DATCTRCHR+1;
     1287     4442    2         IF %KV_RCRLST.DATCTRCHR=0 THEN %KV_RCRLST.RCRNEDSNT = '0'B;
     1288     4443    2      END;
     1289     4444    1   USE_DLTRCR:;
     1290     4445        /*
     1291     4446           Put in the data and key.
     1292     4447        */
     1293     4448    1      SUBSTR(%KV_RCR.TXT,0,Y@KEYLNG) = SUBSTR(Y@KEY$->CHARS,0,Y@KEYLNG);
     1294     4449    1      %KV_RCR.RCRBYTSIZ = KV_RCVVDO.OTPLCL.BFR_.BYTSIZ;
     1295     4450    1      SUBSTR(%KV_RCR.TXT,Y@KEYLNG,%KV_RCR.RCRBYTSIZ) =
     1296     4451    1        SUBSTR(KV_RCVVDO.OTPLCL.BFR_.ADR$->CHARS,
     1297     4452    1        KV_RCVVDO.OTPLCL.BFR_.BYTX, %KV_RCR.RCRBYTSIZ);
     1298     4453    1      RETURN;
     1299     4454        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:44   
     1300     4455    1   KVE$PST: ENTRY ALTRET;
     1301     4456        /*F* NAME: KVE$PST.
     1302     4457             DESCRITION: Performs the record selection portion of the M$SINPUT
     1303     4458             function for the screen editor.
     1304     4459        */
     1305     4460    1      CALL Y$SETUP;
     1306     4461    1      Y@KEY$ = PINCRW(KV_RCVVDO.VDOVLP_KEY$,SIZEW(KV$VDOVLP));
     1307     4462    2      CALL Y$FNDKEY WHENRETURN DO;
     1308     4463    2   PST_NOKEY: IF KV_RCVVDO.VDOVLP_MRK$~=ADDR(NIL)
     1309     4464    2         THEN %KV_STR.ERR.COD = %E$NOKEY;
     1310     4465    2      END; WHENALTRETURN DO;
     1311     4466    2         IF %KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.RCRBYTSIZ<0
     1312     4467    2         THEN GOTO PST_NOKEY;
     1313     4468    2      END;
     1314     4469    2      DO WHILE Y@SRHCUR<%KV_RCRLST.RCRCNT;
     1315     4470    2         IF %KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.RCRBYTSIZ>=0 THEN EXIT;
     1316     4471    2         Y@SRHCUR = Y@SRHCUR+1;
     1317     4472    2      END;
     1318     4473    1      IF Y@SRHCUR=%KV_RCRLST.RCRCNT AND NOT %KV_RCRLST.EOF
     1319     4474    1        OR Y@SRHCUR=%KV_RCRLST.CRTRCR THEN RETURN;
     1320     4475    1      %KV_RCRLST.DFRCNT = Y@SRHCUR-%KV_RCRLST.CRTRCR;
     1321     4476    1      %KV_RCRLST.DFROPR = %KV_INPPRC_SE_DWN;
     1322     4477    1      RETURN;
     1323     4478        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:45   
     1324     4479    1   KVE$RE_DSPSE: ENTRY ALTRET;
     1325     4480        /*F* NAME: KVE$RE_DSPSE.
     1326     4481             DESCRIPTION: For non-scrolling terminals, only new records are dispayed
     1327     4482             until there is no typeahead. This code fixes up the screen when the
     1328     4483             typeahead stops.
     1329     4484        */
     1330     4485
     1331     4486    1      CALL Y$SETUP;
     1332     4487    1      %KV_RCRLST.LSTRCR = -1;
     1333     4488    1      %KV_VDI.RE_DSPINP = '0'B;
     1334     4489    1      CALL Y$DSPALL;
     1335     4490    1      %KV_MVD.FRMSCNINH = '0'B;
     1336     4491    1      IF %KV_SSN.REDRQSPND THEN IF %KV_SSN.REDBFR.NXTX>%KV_VDI.RE_DSPLOWX
     1337     4492    1      THEN ALTRETURN;
     1338     4493    1      ELSE %KV_VDI.RE_DSPINP = '1'B;
     1339     4494    1      RETURN;
     1340     4495        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:46   
     1341     4496    1   KVE$RQSDAT: ENTRY(PRM_INPOPR_DUMMY) ALTRET;
     1342     4497        /*f* NAME: KVE$RQSDAT.
     1343     4498             DESCRIPTION: Initiates a read operation for a screen editor device.
     1344     4499             Makes sure there's no record waiting to go, that the image is correct
     1345     4500             and gets the cursor to the proper place.
     1346     4501        */
     1347     4502
     1348     4503    1      CALL Y$SETUP;
     1349     4504    2      IF %KV_RCRLST.SNDRCR<0 AND %KV_RCRLST.NO_CTX THEN DO;
     1350     4505    2         %KV_RCRLST.SNDRCR=%KV_RCRLST.RCRCNT;
     1351     4506    2         %KV_STR.ERR.COD=%E$CANTGETCTX;
     1352     4507    2         CALL Y$SNDRCR;
     1353     4508    2         GOTO ABRRED;
     1354     4509    2      END;
     1355     4510    2      IF %KV_RCRLST.SNDRCR>=0 THEN DO;
     1356     4511    2         CALL Y$SNDRCR;
     1357     4512    2         GOTO ABRRED;
     1358     4513    2      END;
     1359     4514    2      ELSE IF %KV_RCRLST.SNDRQR THEN DO;
     1360     4515    2         %KV_RCRLST.SNDRCR = %KV_RCRLST.CRTRCR;
     1361     4516    2         IF %KV_RCRLST.SNDRQR.DLT THEN %KV_RCRLST.SNDRCR = %KV_RCRLST.SNDRCR+1;
     1362     4517    2         CALL Y$SNDRCR;
     1363     4518    2         %KV_RCRLST.SNDRQR = '0'B;
     1364     4519    2         GOTO ABRRED;
     1365     4520    2      END;
     1366     4521    2      IF %KV_RCRLST.ACTCHR THEN DO;
     1367     4522        /*
     1368     4523           Stop reading on activation characters.
     1369     4524        */
     1370     4525    2         %KV_RCRLST.ACTCHR = '0'B;
     1371     4526    2         GOTO ABRRED;
     1372     4527    2      END;
     1373     4528    2      IF %KV_RCRLST.DFROPR=%KV_INPPRC_SE_DWN THEN DO;
     1374     4529    2         %KV_RCRLST.CRTRCR = %KV_RCRLST.CRTRCR+%KV_RCRLST.DFRCNT;
     1375     4530    2         %KV_RCRLST.DFROPR = -1;      /* Don't double-compensate when deleting   */
     1376     4531    2      END;
     1377     4532    1      IF %KV_RCRLST.DLTRCREXS THEN CALL Y$DSPALL;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:47   
     1378     4533    1      Y@REDLIN = %KV_RCRLST.CRTRCR;
     1379     4534    2      IF %KV_RCRLST.DFROPR<0 THEN DO;
     1380     4535    2         Y@REDLIN = -%KV_RCRLST.DFRCNT*256+Y@REDLIN; /* Only direction matters   */
     1381     4536    2         %KV_RCRLST.DFROPR = 0;
     1382     4537    2      END;
     1383     4538
     1384     4539    1      IF %KV_RCRLST.RCRCNT<%KV_RCRLST.FRSRCR
     1385     4540    1      THEN %KV_RCRLST.FRSRCR = %KV_RCRLST.RCRCNT;
     1386     4541    1      IF %KV_RCRLST.RCRCNT<%KV_RCRLST.LSTRCR
     1387     4542    1      THEN %KV_RCRLST.LSTRCR = %KV_RCRLST.RCRCNT-1;
     1388     4543    2      DO;
     1389     4544    2         IF Y@REDLIN<=%KV_RCRLST.LSTRCR
     1390     4545    2           AND Y@REDLIN>=%KV_RCRLST.FRSRCR THEN EXIT;
     1391     4546    2         Y@REDLIN = %KV_RCRLST.FRSRCR;
     1392     4547        /*
     1393     4548           Get a more accurate value in CRTVRTLINPHSLIN if it could be wrong
     1394     4549        */
     1395     4550    2         %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.TOPLFT.LIN;
     1396     4551    2         Y@SRHHI = %KV_SRD.CRTVRTLINPHSLIN+Y@VRTSCRMRG;
     1397     4552    3         DO WHILE Y@REDLIN<%KV_RCRLST.RCRCNT;
     1398     4553    3            IF %KV_SRD.CRTVRTLINPHSLIN>=Y@SRHHI THEN EXIT;
     1399     4554    3            CALL Y$LINCNT (%KV_RCRLST.RCR$(Y@REDLIN)->KV$RCR);
     1400     4555    3            %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRTVRTLINPHSLIN+Y@LINCNT;
     1401     4556    3            Y@REDLIN = Y@REDLIN+1;
     1402     4557    3         END;
     1403     4558    2      END;
     1404     4559
     1405     4560    2      CALL Y$CHKSCR WHENALTRETURN DO;
     1406     4561    2         IF %KV_RCRLST.RCRNEDSNT THEN EXIT;
     1407     4562    2         IF %KV_STR.SNDMAXNMBRCR~=0 THEN CALL Y$SNDNEED;
     1408     4563        /*E*  ERROR: KVE-E$RECORDS_NEEDED-0
     1409     4564              MESSAGE:The FEP needs records to continue screen-editing.
     1410     4565        */
     1411     4566    2         RETURN;
     1412     4567    2      END;
     1413     4568    2      IF %KV_RCRLST.RCRNEDSNT THEN DO;
     1414     4569        /*
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:48   
     1415     4570           Got a read while still needing records. Must be all the records.
     1416     4571        */
     1417     4572    2         %KV_RCRLST.EOF = '1'B;
     1418     4573    2         %KV_RCRLST.BOF = '1'B;
     1419     4574    2         %KV_RCRLST.RCRNEDSNT = '0'B;
     1420     4575    2      END;
     1421     4576    1      IF %KV_SSN.REDRQSPND THEN RETURN;
     1422     4577    1      KV@USR_RQSDAT = PRM_RQSDAT;
     1423     4578        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:49   
     1424     4579    1   Y$ENBRED:;
     1425     4580        /*N* TEMP UNTIL I FIGGER HOW TO DEAL WITH OTHER STREAM READS INTERRUPTING */
     1426     4581    2      IF %KV_STR.SNDMAXNMBRCR=0 THEN DO;
     1427     4582    2         CALL KVI$PRGRED;
     1428     4583    2         CALL KVI$TRMRED_VDH_DAT;
     1429     4584    2         RETURN;
     1430     4585    2      END;
     1431     4586    1      IF %KV_RCRLST.CRTRCR>=%KV_RCRLST.RCRCNT
     1432     4587    2      THEN IF %KV_RCRLST.KEYINC=65535 THEN DO;
     1433     4588    3         IF %KV_RCRLST.RCRCNT=0 THEN DO;
     1434     4589    3            %KV_STR.ERR.COD = %E$INSERT_NO_ROOM;
     1435     4590    3            CALL Y$SNDRCR;
     1436     4591    3            GOTO ABRRED;
     1437     4592    3         END;
     1438     4593    2         %KV_RCRLST.CRTRCR = %KV_RCRLST.RCRCNT-1;
     1439     4594    2         %KV_STR.RE_REDCLM = 0;
     1440     4595    2      END; ELSE DO;
     1441     4596        /*
     1442     4597           Make a temp record to start an empty file.
     1443     4598        */
     1444     4599    2         IF %KV_RCRLST.RCRCNT=0 AND KV_RCVVDO.VDOVLP_KEY$~=ADDR(NIL)
     1445     4600    2         THEN ADDR(KV@VDH_OTPLCL)->KEYU4 =
     1446     4601    2           PINCRW(KV_RCVVDO.VDOVLP_KEY$,SIZEW(KV$VDOVLP))->KEYU4;
     1447     4602    3         ELSE DO;
     1448     4603    3            IF %KV_RCRLST.RCRCNT=0 THEN Y@KEY$ = ADDR(Y_LTLKEY);
     1449     4604    3            ELSE Y@KEY$ = ADDR(%KV_RCRLST.RCR$(%KV_RCRLST.RCRCNT-1)->KV$RCR.TXT);
     1450     4605    3            Y@KEYINC = %KV_RCRLST.KEYINC;
     1451     4606    3            IF Y@KEYINC=65535 THEN Y@KEYINC = 0;
     1452     4607    3            CALL Y$INCKEY;
     1453     4608    3         END;
     1454     4609    2         Y@SRHCUR = %KV_RCRLST.RCRCNT;
     1455     4610    2         %KV_RCRLST.CRTRCR = Y@SRHCUR;
     1456     4611    2         IF Y@SRHCUR<%KV_RCRLST.MAXRCR THEN Y@DLTRCR = -1;
     1457     4612    2         ELSE Y@DLTRCR = 0;
     1458     4613    2         %KV_STR.RE_REDCLM = 1;
     1459     4614    2         Y@BFRSIZ = LENGTHV(KV$RCR)+Y@KEYLNG;
     1460     4615    2         CALL Y$GETRCRBFR ALTRET(ABRRED);
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:50   
     1461     4616    2         %KV_RCR.LINCNT = 0;
     1462     4617    2         %KV_RCR.NEW = '1'B;
     1463     4618    2         %KV_SSN.REDBFR__.DATBYTSIZ = 0;   /* Dont display the wrong record      */
     1464     4619    2         CALL Y$DSPALL;
     1465     4620    2      END;
     1466     4621    1      Y@RCR$ = %KV_RCRLST.RCR$(%KV_RCRLST.CRTRCR);
     1467     4622    1      KV@USR_RQSDAT.BFR_.ADR$ = ADDR(%KV_RCR);
     1468     4623    1      KV@USR_RQSDAT.BFR_.BYTSIZ = %KV_RCR.RCRBYTSIZ;
     1469     4624    1      KV@USR_RQSDAT.BFR_.BYTX = Y@KEYLNG+LENGTHV(KV$RCR);
     1470     4625    1      KV@USR_RQSDAT.RE_RED = '1'B;
     1471     4626    1      IF %KV_STR.AUTTABCLM>KV@USR_RQSDAT.BFR_.BYTSIZ
     1472     4627    1      THEN IF %KV_RCRLST.TXTEDT OR %KV_RCR.NEW AND %KV_RCR.RCRBYTSIZ=0
     1473     4628    1      THEN %KV_STR.RE_REDCLM = %KV_STR.AUTTABCLM;
     1474     4629    2      IF NOT %KV_MVD.HRZSCR THEN DO;
     1475     4630    2         IF KV@USR_RQSDAT.MAXRCRBYTSIZ>%KV_SRD.LNG*%KV_SRD.WDT
     1476     4631    2         THEN KV@USR_RQSDAT.MAXRCRBYTSIZ = %KV_SRD.LNG*%KV_SRD.WDT;
     1477     4632    2         IF KV@USR_RQSDAT.BFR_.BYTSIZ<=KV@USR_RQSDAT.MAXRCRBYTSIZ THEN EXIT;
     1478     4633    2   ERR_LD:; /* KVE$INCFLD could report E$LD if spaceinsert is off */
     1479     4634        /* Cannot possibly edit this record. Abort the read. */
     1480     4635    2         %KV_STR.ERR.COD = %E$LD;
     1481     4636        /*E*  ERROR:KVE-E$LD-0
     1482     4637              MESSAGE:Record too large to edit.
     1483     4638        */
     1484     4639    2         %KV_RCRLST.SNDRCR = %KV_RCRLST.CRTRCR;
     1485     4640    2         IF %KV_STR.SNDMAXNMBRCR~=0 THEN CALL Y$SNDRCR;
     1486     4641    2         GOTO ABRRED;
     1487     4642    2      END;
     1488     4643    1      %KV_SRD.PRMVRTCLM = 0;
     1489     4644    1      IF %KV_MVD.HRZSCR THEN %KV_SSN.REDBFR.DSPLOWX = %KV_RCRLST.HRZSCROFS;
     1490     4645    1      IF %KV_MVD.FRMSCNINH THEN %KV_VDI.RE_DSPINP = '1'B;
     1491     4646    1      KV@VDH_OTPLCL.NO_WRAP = %KV_VDI.RE_DSPINP;
     1492     4647    1      KV$PTR.INPCNDPND.OPRX = 0;
     1493     4648    1      IF %KV_RCRLST.DFROPR~=0 THEN %KV_VDI.USRRQSDAT.RED = '1'B;
     1494     4649        /* Don't process typeahead for a deferred operator. */
     1495     4650    1      CALL KVI$RQSDAT (KV@USR_RQSDAT);
     1496     4651    2      IF KV@VDH_OTPLCL.NO_WRAP THEN DO;
     1497     4652    2         %KV_VDI.RE_DSPINP = '1'B;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:51   
     1498     4653    2         %KV_VDI.RE_DSPLOWX = KV@USR_RQSDAT.BFR_.BYTSIZ;
     1499     4654    2      END;
     1500     4655    1      IF NOT %KV_SSN.REDRQSPND THEN RETURN;
     1501     4656    2      IF %KV_RCRLST.DFROPR~=0 THEN DO;
     1502     4657    2         Y@LINCNT = %KV_RCRLST.DFROPR;
     1503     4658    2         Y@DLTRCR = %KV_RCRLST.DFRCNT;
     1504     4659    2         %KV_RCRLST.DFROPR = 0;
     1505     4660    2         IF Y@LINCNT=%KV_INPPRC_SPLIT THEN Y@DLTRCR = 1;
     1506     4661    2         CALL Y$SETUP;
     1507     4662    2         GOTO INPOPR;
     1508     4663    2      END;
     1509     4664    2      DO WHILE '1'B;
     1510     4665    2         KV@USR_RQSDAT.RE_RED = %KV_SRD.VRTPSTOK;
     1511     4666        /*
     1512     4667           VRTPSTOK must be preserved so that typed-ahead input works properly
     1513     4668           (RE_DSPINP in particular).
     1514     4669        */
     1515     4670    2         CALL Y$DSPALL;
     1516     4671    2         %KV_SRD.VRTPSTOK = KV@USR_RQSDAT.RE_RED;
     1517     4672    2         IF %KV_RCRLST.PRTLSTRCR AND %KV_RCRLST.CRTRCR=%KV_RCRLST.LSTRCR
     1518     4673    3           OR %KV_RCRLST.CRTRCR>%KV_RCRLST.LSTRCR THEN DO;
     1519     4674    3            %KV_RCRLST.VRTSCRCNT =
     1520     4675    3              -%KV_RCRLST.RCR$(%KV_RCRLST.FRSRCR)->KV$RCR.LINCNT;
     1521     4676    3            IF NOT %KV_SRD.VRTSCR THEN %KV_RCRLST.LSTRCR = %KV_RCRLST.FRSRCR;
     1522     4677    3            %KV_RCRLST.FRSRCR = %KV_RCRLST.FRSRCR+1;
     1523     4678    3         END;
     1524     4679    2         ELSE EXIT;
     1525     4680    2      END;
     1526     4681    1      RETURN;
     1527     4682        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:52   
     1528     4683    1   KVE$SCRALL: ENTRY ALTRET;
     1529     4684        /*F* NAME: KVE$SCRALL
     1530     4685             PURPOSE: Slides the rest of the records to where the cursor one is.
     1531     4686        */
     1532     4687    1      CALL Y$SETUP;
     1533     4688    1      Y@KEYLNG = Y@KEYLNG+LENGTHV(KV$RCR); /* More useful this way here          */
     1534     4689    1      Y@DLTRCR = %KV_RCRLST.HRZSCROFS-%KV_SSN.REDBFR.DSPLOWX;
     1535     4690    1      IF Y@DLTRCR=0 THEN RETURN;
     1536     4691    1      %KV_RCRLST.HRZSCROFS = %KV_SSN.REDBFR.DSPLOWX;
     1537     4692    1      KV@VDH_OTPLCL = Y_VDH_OTPLCL;
     1538     4693    1      KV@USR_PST = KV_USR_PST;
     1539     4694    1      KV@USR_PST.PHSPST = %KV_SRD.TOPLFT;
     1540     4695    1      KV@USR_PST.PHSPSTMOD = %KV_PHSPSTMOD_HRZSCR;
     1541     4696    1      KV@USR_PST.SCRCNT = Y@DLTRCR;
     1542     4697    1      IF Y@DLTRCR>25 OR Y@DLTRCR<-25 THEN KV@USR_PST.SCRCNT = 0;
     1543     4698    1      ELSE IF Y@DLTRCR<0 THEN Y@DLTRCR = -%KV_SRD.WDT-Y@DLTRCR;
     1544     4699    1      Y@SRHCUR = %KV_RCRLST.FRSRCR;
     1545     4700    2      DO WHILE '1'B;
     1546     4701    2         IF KV@USR_PST.PHSPST.LIN>%KV_SRD.BTMRHT.LIN
     1547     4702    2           OR Y@SRHCUR>=%KV_RCRLST.RCRCNT THEN EXIT;
     1548     4703    3         IF Y@SRHCUR~=%KV_RCRLST.CRTRCR THEN DO;
     1549     4704    3            Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);
     1550     4705    3            KV@VDH_OTPLCL.BFR_.ADR$ = Y@RCR$;
     1551     4706    3            KV@VDH_OTPLCL.BFR_.BYTX = %KV_RCRLST.HRZSCROFS+Y@KEYLNG;
     1552     4707    3            IF %KV_RCR.RCRBYTSIZ>%KV_RCRLST.HRZSCROFS
     1553     4708    3            THEN KV@VDH_OTPLCL.BFR_.BYTSIZ = %KV_RCR.RCRBYTSIZ-%KV_RCRLST.HRZSCROFS;
     1554     4709    3            ELSE KV@VDH_OTPLCL.BFR_.BYTSIZ = 0;
     1555     4710    4            IF %KV_MRD.HRZSCR AND %KV_RCR.ONE_2_1 AND KV@USR_PST.SCRCNT~=0 THEN DO;
     1556     4711    4               CALL KVV$CALUSR (KV@USR_PST);
     1557     4712    4               Y@SRHLO = Y@DLTRCR;         /* Can't need to erase after OTPLCL   */
     1558     4713    5               IF Y@DLTRCR<0 THEN DO;
     1559     4714    5                  KV@VDH_OTPLCL.BFR_.BYTX = KV@VDH_OTPLCL.BFR_.BYTX-Y@DLTRCR;
     1560     4715    5                  IF KV@VDH_OTPLCL.BFR_.BYTSIZ+Y@DLTRCR>0
     1561     4716    5                  THEN KV@VDH_OTPLCL.BFR_.BYTSIZ =
     1562     4717    5                    KV@VDH_OTPLCL.BFR_.BYTSIZ+Y@DLTRCR;
     1563     4718    5                  ELSE KV@VDH_OTPLCL.BFR_.BYTSIZ = 0;
     1564     4719    4               END; ELSE IF KV@VDH_OTPLCL.BFR_.BYTSIZ>Y@DLTRCR
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:53   
     1565     4720    4               THEN KV@VDH_OTPLCL.BFR_.BYTSIZ = Y@DLTRCR;
     1566     4721    4            END; ELSE DO;
     1567     4722    4               %KV_SRD.CRT = KV@USR_PST.PHSPST;
     1568     4723    4               Y@SRHLO = %KV_SRD.CRT.CLM-%KV_SRD.TOPLFT.CLM;
     1569     4724    4               %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_SKP;
     1570     4725    4            END;
     1571     4726    3            %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRT.LIN;
     1572     4727    3            %KV_SRD.FLDEND.LIN = %KV_SRD.CRT.LIN;
     1573     4728    3            %KV_SRD.HI_NONBLN = %KV_SRD.FLDEND;
     1574     4729    3            %KV_MVD.VRTCLM = 1;
     1575     4730    3            %KV_SRD.VRTPSTOK = '1'B;
     1576     4731    3            IF KV@VDH_OTPLCL.BFR_.BYTSIZ~=0
     1577     4732    3            THEN CALL KVO$OTPLCL (KV@VDH_OTPLCL);
     1578     4733        /* Use EL0 if it works here */
     1579     4734    3            IF %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_BLN
     1580     4735    3            THEN %KV_SRD.CRT.CLM = %KV_MRD.DVCCLM;
     1581     4736    3            IF %KV_SRD.CRT.CLM<=%KV_SRD.FLDEND.CLM AND Y@SRHLO=0
     1582     4737        /*
     1583     4738           Erase the rest of the line if we didn't OTPLCL all the way,
     1584     4739           we didn't shift using ICH/DCH,
     1585     4740           and we're shifting left or had a bunch of blanks at the end.
     1586     4741        */
     1587     4742    3              AND (Y@DLTRCR<0 OR %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_BLN)
     1588     4743    3            THEN CALL KVO$ERSTO_ENDOF_INP;
     1589     4744    3         END;
     1590     4745    2         KV@USR_PST.PHSPST.LIN = KV@USR_PST.PHSPST.LIN+1;
     1591     4746    2         Y@SRHCUR = Y@SRHCUR+1;
     1592     4747    2      END;
     1593     4748    1      %KV_SRD.CRTVRTLINPHSLIN =
     1594     4749    1        %KV_SRD.TOPLFT.LIN+%KV_RCRLST.CRTRCR-%KV_RCRLST.FRSRCR;
     1595     4750    1      %KV_SRD.FLDEND.LIN = %KV_SRD.CRTVRTLINPHSLIN;
     1596     4751    1      %KV_SRD.HI_NONBLN.LIN = %KV_SRD.CRTVRTLINPHSLIN;
     1597     4752    1      RETURN;
     1598     4753        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:54   
     1599     4754        /*I* NAME: Y$CHKSCR
     1600     4755          Checks to make sure the desired record is within the scrolling
     1601     4756          margins, on the screen, and in the record set.  The desired record
     1602     4757          is indicated by RCRLST.CRTRCR,  the previous one in Y@REDLIN.
     1603     4758          RETURNs if all is well.
     1604     4759        */
     1605     4760
     1606     4761    1   Y$CHKSCR: PROC ALTRET;
     1607     4762
     1608     4763    3      IF %KV_RCRLST.DFROPR=0 THEN DO;
     1609     4764    3         %KV_RCRLST.DFRCNT = 0;
     1610     4765    4         IF %KV_RCRLST.CRTRCR<0 THEN DO;
     1611     4766    4            IF NOT %KV_RCRLST.BOF THEN %KV_RCRLST.DFRCNT = %KV_RCRLST.CRTRCR;
     1612     4767    4            %KV_RCRLST.CRTRCR = 0;
     1613     4768    4         END; ELSE IF %KV_RCRLST.CRTRCR>=%KV_RCRLST.RCRCNT THEN DO;
     1614     4769    5            IF NOT %KV_RCRLST.EOF AND %KV_RCRLST.RCRCNT>0 THEN DO;
     1615     4770    5               %KV_RCRLST.DFRCNT = %KV_RCRLST.CRTRCR-%KV_RCRLST.RCRCNT+1;
     1616     4771    5               %KV_RCRLST.CRTRCR = %KV_RCRLST.CRTRCR-%KV_RCRLST.DFRCNT;
     1617     4772    5            END; ELSE DO;
     1618     4773    5               %KV_RCRLST.CRTRCR = %KV_RCRLST.RCRCNT;
     1619     4774    5               IF %KV_RCRLST.CRTRCR>0
     1620     4775    5               THEN IF %KV_RCRLST.RCR$(%KV_RCRLST.CRTRCR-1)->KV$RCR.NEW
     1621     4776    5               THEN %KV_RCRLST.CRTRCR = %KV_RCRLST.CRTRCR-1;
     1622     4777    5            END;
     1623     4778    4         END;
     1624     4779    3         IF %KV_RCRLST.DFRCNT~=0 THEN %KV_RCRLST.DFROPR = %KV_INPPRC_SE_DWN;
     1625     4780    3      END;
     1626     4781
     1627     4782    2      Y@SRHLO = 0;
     1628     4783    3      IF Y@REDLIN>%KV_RCRLST.CRTRCR THEN DO;
     1629     4784        /*
     1630     4785        We're moving up the screen.  Check to see if we should scroll.
     1631     4786        */
     1632     4787    4         DO UNTIL Y@REDLIN=%KV_RCRLST.CRTRCR;
     1633     4788    4            IF Y@REDLIN=0 THEN EXIT;
     1634     4789    4            Y@REDLIN = Y@REDLIN-1;
     1635     4790    4            CALL Y$LINCNT (%KV_RCRLST.RCR$(Y@REDLIN)->KV$RCR);
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:55   
     1636     4791    4            %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRTVRTLINPHSLIN-Y@LINCNT;
     1637     4792    4         END;
     1638     4793    3         IF %KV_SRD.CRTVRTLINPHSLIN<%KV_SRD.TOPLFT.LIN+Y@VRTSCRMRG
     1639     4794    3         THEN %KV_RCRLST.SCRDN = '1'B;
     1640     4795    3      END;
     1641     4796    3      ELSE IF Y@REDLIN<%KV_RCRLST.CRTRCR THEN DO;
     1642     4797        /*
     1643     4798        Going down the screen. Ditto.
     1644     4799        */
     1645     4800    4         DO WHILE Y@REDLIN<%KV_RCRLST.RCRCNT;
     1646     4801    4            CALL Y$LINCNT (%KV_RCRLST.RCR$(Y@REDLIN)->KV$RCR);
     1647     4802    4            %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRTVRTLINPHSLIN+Y@LINCNT;
     1648     4803    4            Y@REDLIN = Y@REDLIN+1;
     1649     4804    4            IF Y@REDLIN = %KV_RCRLST.CRTRCR THEN EXIT;
     1650     4805    4         END;
     1651     4806    3         IF %KV_SRD.CRTVRTLINPHSLIN>%KV_SRD.BTMRHT.LIN-Y@VRTSCRMRG
     1652     4807    3         THEN %KV_RCRLST.SCRUP = '1'B;
     1653     4808    3      END;
     1654     4809    3      IF %KV_RCRLST.SCRDN THEN DO WHILE '1'B;
     1655     4810    3         IF %KV_SRD.CRTVRTLINPHSLIN>=%KV_SRD.TOPLFT.LIN+Y@VRTSCRSHF
     1656     4811    3           OR %KV_RCRLST.FRSRCR=0 AND %KV_RCRLST.BOF
     1657     4812    3         THEN %KV_RCRLST.SCRDN = '0'B;
     1658     4813    3         IF NOT %KV_RCRLST.SCRDN OR %KV_RCRLST.FRSRCR=0 THEN EXIT;
     1659     4814    3         %KV_RCRLST.FRSRCR = %KV_RCRLST.FRSRCR-1;
     1660     4815    3         CALL Y$LINCNT (%KV_RCRLST.RCR$(%KV_RCRLST.FRSRCR)->KV$RCR);
     1661     4816    3         Y@SRHLO = Y@SRHLO+Y@LINCNT;
     1662     4817    3         %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRTVRTLINPHSLIN+Y@LINCNT;
     1663     4818    3      END;
     1664     4819    3      IF %KV_RCRLST.SCRUP THEN DO WHILE '1'B;
     1665     4820    3         IF %KV_SRD.CRTVRTLINPHSLIN<=%KV_SRD.BTMRHT.LIN-Y@VRTSCRSHF
     1666     4821    3           OR %KV_RCRLST.EOF AND %KV_RCRLST.LSTRCR+1=%KV_RCRLST.RCRCNT
     1667     4822    3         THEN %KV_RCRLST.SCRUP = '0'B;
     1668     4823    3         IF NOT %KV_RCRLST.SCRUP OR %KV_RCRLST.FRSRCR>=%KV_RCRLST.RCRCNT THEN EXIT;
     1669     4824    3   Y$SCRUP:;
     1670     4825    3         CALL Y$LINCNT (%KV_RCRLST.RCR$(%KV_RCRLST.FRSRCR)->KV$RCR);
     1671     4826    3         Y@SRHLO = Y@SRHLO-Y@LINCNT;
     1672     4827    3         %KV_RCRLST.FRSRCR = %KV_RCRLST.FRSRCR+1;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:56   
     1673     4828    3         %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRTVRTLINPHSLIN-Y@LINCNT;
     1674     4829    3      END;
     1675     4830        /*
     1676     4831           Make sure the desired record is all displayed.
     1677     4832        */
     1678     4833    3      IF %KV_RCRLST.CRTRCR<%KV_RCRLST.RCRCNT AND %KV_RCRLST.CRTRCR>=0 THEN DO;
     1679     4834    3         Y@RCR$ = %KV_RCRLST.RCR$(%KV_RCRLST.CRTRCR);
     1680     4835    3         IF %KV_RCRLST.CRTRCR>%KV_RCRLST.LSTRCR
     1681     4836    3           OR %KV_RCRLST.CRTRCR=%KV_RCRLST.LSTRCR AND %KV_RCRLST.PRTLSTRCR
     1682     4837    3         THEN %KV_RCR.UPD = '1'B;          /* Recalculate if RCR.LINCNT is wrong */
     1683     4838    3         CALL Y$LINCNT (%KV_RCR);
     1684     4839    3         Y@REDLIN = Y@LINCNT-1;
     1685     4840    3         IF %KV_SRD.CRTVRTLINPHSLIN+Y@REDLIN<=%KV_SRD.BTMRHT.LIN
     1686     4841    3           OR %KV_RCRLST.FRSRCR>=%KV_RCRLST.CRTRCR THEN EXIT;
     1687     4842    3         %KV_RCRLST.SCRUP = '1'B;
     1688     4843    3         %KV_RCRLST.SCRDN = '0'B;
     1689     4844    3         GOTO Y$SCRUP;
     1690     4845    3      END;
     1691     4846        /*
     1692     4847           Figure what the last record on the screen will be, too.
     1693     4848        */
     1694     4849    2      Y@REDLIN = %KV_SRD.CRTVRTLINPHSLIN;
     1695     4850    2      Y@SRHHI = %KV_RCRLST.CRTRCR;
     1696     4851    3   FNDBTM: DO WHILE Y@REDLIN<=%KV_SRD.BTMRHT.LIN;
     1697     4852    4         IF Y@SRHHI<%KV_RCRLST.RCRCNT THEN DO;
     1698     4853    4            CALL Y$LINCNT(%KV_RCRLST.RCR$(Y@SRHHI)->KV$RCR);
     1699     4854    4            Y@REDLIN = Y@REDLIN+Y@LINCNT;
     1700     4855    3         END; ELSE IF %KV_RCRLST.EOF AND %KV_RCRLST.FRSRCR>0 AND %KV_SRD.VRTSCR
     1701     4856    3           AND %KV_SRD.LNG-Y@VRTSCRSHF>1
     1702     4857    4           AND Y@REDLIN<%KV_SRD.BTMRHT.LIN THEN DO;
     1703     4858        /*
     1704     4859           Try to leave only the bottom line empty for the EOF record if its easy
     1705     4860        */
     1706     4861    4            CALL Y$LINCNT (%KV_RCRLST.RCR$(%KV_RCRLST.FRSRCR-1)->KV$RCR);
     1707     4862    4            IF %KV_SRD.BTMRHT.LIN-%KV_SRD.CRTVRTLINPHSLIN<=Y@LINCNT
     1708     4863    4            THEN EXIT FNDBTM;
     1709     4864    4            %KV_RCRLST.FRSRCR = %KV_RCRLST.FRSRCR-1;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:57   
     1710     4865    4            Y@REDLIN = Y@REDLIN+Y@LINCNT;
     1711     4866    4            %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRTVRTLINPHSLIN+Y@LINCNT;
     1712     4867    4            Y@SRHLO = Y@SRHLO+Y@LINCNT;
     1713     4868    3         END; ELSE EXIT;         /* Can't fill the screen - ask for more records */
     1714     4869    3         Y@SRHHI = Y@SRHHI+1;
     1715     4870    3      END;
     1716     4871    2      IF Y@SRHLO~=0 THEN IF %KV_SRD.VRTSCR
     1717     4872    2      THEN %KV_RCRLST.VRTSCRCNT = %KV_RCRLST.VRTSCRCNT+Y@SRHLO;
     1718     4873    2      ELSE %KV_RCRLST.LSTRCR = -1;
     1719     4874
     1720     4875    2      IF %KV_RCRLST.MAXRCR-%KV_RCRLST.RCRCNT>=%KV_RCRLST.SPRCNT
     1721     4876    2        AND (NOT %KV_RCRLST.BOF OR NOT %KV_RCRLST.EOF)
     1722     4877    2        OR %KV_RCRLST.DFROPR=%KV_INPPRC_SE_DWN
     1723     4878    2        OR %KV_RCRLST.SCRDN
     1724     4879    2        OR %KV_RCRLST.CRTRCR=0 AND NOT %KV_RCRLST.BOF
     1725     4880    2        OR NOT %KV_RCRLST.EOF AND (Y@REDLIN<=%KV_SRD.BTMRHT.LIN
     1726     4881    2        OR %KV_RCRLST.CRTRCR+1>=%KV_RCRLST.RCRCNT)
     1727     4882    2      THEN ALTRETURN;
     1728     4883    2      RETURN;
     1729     4884    2   END Y$CHKSCR;
     1730     4885        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:58   
     1731     4886        /*I* NAME: Y$LINCNT
     1732     4887          Puts the real line count for the parameter record into Y@LINCNT.
     1733     4888        */
     1734     4889
     1735     4890    1   Y$LINCNT: PROC(Y$RCR) ALTRET;
     1736     4891
     1737     4892        %KV$RCR (NAME=Y$RCR, STCLASS=PARAM);
     1738     4922
     1739     4923    2      Y@LINCNT = Y$RCR.LINCNT;
     1740     4924    2      IF Y$RCR.RCRBYTSIZ<0 THEN Y@LINCNT=0;
     1741     4925    2      ELSE IF Y@LINCNT<=0 OR Y$RCR.UPD THEN IF %KV_MVD.HRZSCR THEN Y@LINCNT=1;
     1742     4926    2      ELSE Y@LINCNT = MAXIMUM ((Y$RCR.RCRBYTSIZ+%KV_SRD.WDT-1)/%KV_SRD.WDT,1);
     1743     4927    2      RETURN;
     1744     4928    2   END Y$LINCNT;
     1745     4929        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:59   
     1746     4930        /*I* NAME: Y$CMPKEY
     1747     4931             Compares keys of KV$RCR for record # in Y@SRHCUR versus key at
     1748     4932             Y@KEY$. Returns Y@KEYCMP >0 if KEY$ greater, <0 is less, 0 if equal.
     1749     4933             ALTRETURNs if equal.
     1750     4934        */
     1751     4935
     1752     4936    1   Y$CMPKEY: PROC ALTRET;
     1753     4937
     1754     4938    3      DO CASE Y@KEYLNG;
     1755     4939    3      CASE 1;
     1756     4940    3         Y@KEYCMP = Y@KEY$->KEYU1-
     1757     4941    3           ADDR(%KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.TXT)->KEYU1;
     1758     4942    3      CASE 2;
     1759     4943    3         Y@KEYCMP = Y@KEY$->KEYU2-
     1760     4944    3           ADDR(%KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.TXT)->KEYU2;
     1761     4945    3      CASE 3;
     1762     4946    3         Y@TMP32 = ADDR(%KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.TXT)->KEYU3;
     1763     4947    3         Y@TMP32 = Y@KEY$->KEYU3-Y@TMP32;
     1764     4948    3         GOTO LONGKEY;
     1765     4949    3      CASE 4;
     1766     4950    3         Y@TMP32 = Y@KEY$->KEYU4-
     1767     4951    3           ADDR(%KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.TXT)->KEYU4;
     1768     4952    3   LONGKEY:;
     1769     4953    3         IF Y@TMP32B.TOP~=0 THEN Y@KEYCMP = Y@TMP32B.TOP;
     1770     4954    3         ELSE IF Y@TMP32B.BTM<0 THEN Y@KEYCMP = 1;
     1771     4955    3         ELSE Y@KEYCMP = Y@TMP32B.BTM;
     1772     4956    3      END;
     1773     4957    2      IF Y@KEYCMP~=0 THEN RETURN;
     1774     4958    2      ALTRETURN;
     1775     4959    2   END Y$CMPKEY;
     1776     4960        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:60   
     1777     4961        /*I* NAME: Y$DLTRCR
     1778     4962             Description: Releases the KV$RCR at Y@SRHCUR if it isn't on the
     1779     4963             screen.  Marks it for erasure and release if it is.
     1780     4964        */
     1781     4965    1   Y$DLTRCR: PROC;
     1782     4966
     1783     4967    2      Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);
     1784     4968    2      IF %KV_RCR.RCRBYTSIZ<0 OR %KV_RCR.LINCNT~=0
     1785     4969    3        AND Y@SRHCUR>=%KV_RCRLST.FRSRCR AND Y@SRHCUR<=%KV_RCRLST.LSTRCR THEN DO;
     1786     4970    3         %KV_RCRLST.DLTRCREXS = '1'B;
     1787     4971    3         IF %KV_RCR.RCRBYTSIZ>0 THEN %KV_RCR.RCRBYTSIZ = -%KV_RCR.RCRBYTSIZ;
     1788     4972    3         ELSE %KV_RCR.RCRBYTSIZ = -1;
     1789     4973    3         Y@BFRSIZ = 0;
     1790     4974    3         RETURN;
     1791     4975    3      END;
     1792     4976    2   Y$DLTRCRRLS: ENTRY;
     1793     4977    2      %KV_RCRLST.RCRCNT = %KV_RCRLST.RCRCNT-1;
     1794     4978    2      IF Y@SRHCUR<%KV_RCRLST.FRSRCR THEN %KV_RCRLST.FRSRCR = %KV_RCRLST.FRSRCR-1;
     1795     4979    2      IF Y@SRHCUR<=%KV_RCRLST.LSTRCR THEN %KV_RCRLST.LSTRCR = %KV_RCRLST.LSTRCR-1;
     1796     4980    2      IF Y@SRHCUR=%KV_RCRLST.SNDRCR THEN %KV_RCRLST.SNDRCR = -1;
     1797     4981    2      IF Y@SRHCUR<%KV_RCRLST.SNDRCR THEN %KV_RCRLST.SNDRCR = %KV_RCRLST.SNDRCR-1;
     1798     4982    2      Y@BFRSIZ = %KV_RCRLST.CRTRCR;
     1799     4983    2      IF %KV_RCRLST.DFROPR=%KV_INPPRC_SE_DWN
     1800     4984    2      THEN Y@BFRSIZ = Y@BFRSIZ+%KV_RCRLST.DFRCNT;
     1801     4985    2      IF Y@SRHCUR<Y@BFRSIZ THEN %KV_RCRLST.CRTRCR = %KV_RCRLST.CRTRCR-1;
     1802     4986    2      Y@BFRSIZ = 4*(%KV_RCRLST.RCRCNT-Y@SRHCUR);
     1803     4987    2      IF Y@BFRSIZ~=0
     1804     4988    2      THEN SUBSTR(ADDR(%KV_RCRLST.RCR$(Y@SRHCUR))->CHARS,0,Y@BFRSIZ) =
     1805     4989    2        SUBSTR(ADDR(%KV_RCRLST.RCR$(Y@SRHCUR+1))->CHARS,0,Y@BFRSIZ);
     1806     4990    2      KV@VDH_GETBFR.BFR$ = ADDR(%KV_RCR);
     1807     4991    2      KV@VDH_GETBFR.BYTSIZ = %KV_RCR.STRBYTSIZ;
     1808     4992    2      CALL KVS$RLSBFR (KV@VDH_GETBFR);
     1809     4993    2      RETURN;
     1810     4994    2   END Y$DLTRCR;
     1811     4995        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:61   
     1812     4996        /*I* NAME: Y$FNDKEY
     1813     4997             Sets Y@SRHCUR to index the KV$RCRLST.RCR$ pointing to the record
     1814     4998             equal to or immediately following that whose key is at KEY$.
     1815     4999             ALTRETURNs if EQUAL. Y@KEYCMP>0 only if Y@SRHCUR=RCRLST.RCRCNT.
     1816     5000        */
     1817     5001
     1818     5002    1   Y$FNDKEY: PROC ALTRET;
     1819     5003
     1820     5004    2      Y@SRHHI = %KV_RCRLST.RCRCNT-1;
     1821     5005    2      Y@SRHLO = 0;
     1822     5006    2      Y@SRHCUR = Y@SRHHI;
     1823     5007    3      IF Y@SRHCUR>=0 THEN CALL Y$CMPKEY WHENALTRETURN DO;
     1824     5008    3   RETALT: ALTRETURN;
     1825     5009    3      END;
     1826     5010    2      ELSE Y@KEYCMP = 1;
     1827     5011    3      IF Y@KEYCMP>0 THEN DO;
     1828     5012    3         Y@SRHCUR = Y@SRHCUR+1;
     1829     5013    3         RETURN;
     1830     5014    3      END;
     1831     5015    2      Y@SRHCUR = Y@SRHLO;
     1832     5016    2      CALL Y$CMPKEY ALTRET(RETALT);
     1833     5017    2      IF Y@KEYCMP<0 THEN RETURN;
     1834     5018    3      DO WHILE Y@SRHHI-Y@SRHLO>1;
     1835     5019    3         Y@SRHCUR = (Y@SRHHI+Y@SRHLO)/2;
     1836     5020    3         CALL Y$CMPKEY ALTRET(RETALT);
     1837     5021    3         IF Y@KEYCMP>0 THEN Y@SRHLO = Y@SRHCUR;
     1838     5022    3         ELSE Y@SRHHI=Y@SRHCUR;
     1839     5023    3      END;
     1840     5024    2      Y@SRHCUR = Y@SRHHI;
     1841     5025    2      Y@KEYCMP = -1;
     1842     5026    2   END;
     1843     5027        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:62   
     1844     5028        /*I* NAME: Y$GETRCRBFR.
     1845     5029             Allocates a KV$RCR at least Y@BFRSIZ bytes big, or reuses the one
     1846     5030             used by RCR$(Y@DLTRCR). IT is released if not used. Any shuffling
     1847     5031             of RCR$ pointers is performed, and scrolling information is computed.
     1848     5032        */
     1849     5033
     1850     5034    1   Y$GETRCRBFR: PROC ALTRET;
     1851     5035
     1852     5036    2      KV@VDH_GETBFR = Y_VDH_GETBFR;
     1853     5037    3      IF Y@DLTRCR~=-1 THEN DO;
     1854     5038    3         Y@RCR$ = %KV_RCRLST.RCR$(Y@DLTRCR);
     1855     5039    3         KV@VDH_GETBFR.BFR$ = Y@RCR$;
     1856     5040    3         Y@TMP32B.TOP = %KV_RCR.LINCNT;    /* Save old record size.              */
     1857     5041    3         %KV_RCRLST.RCR$(Y@DLTRCR) = ADDR(NIL);
     1858     5042    3         IF %KV_RCR.STRBYTSIZ<Y@BFRSIZ OR %KV_RCR.STRBYTSIZ>Y@BFRSIZ*2
     1859     5043    4           AND Y@BFRSIZ>32 THEN DO;
     1860     5044        /*
     1861     5045           The old one is insufficient. Just release it.
     1862     5046        */
     1863     5047    4            KV@VDH_GETBFR.BYTSIZ = %KV_RCR.STRBYTSIZ;
     1864     5048    4            CALL KVS$RLSBFR (KV@VDH_GETBFR);
     1865     5049    4            KV@VDH_GETBFR.BFR$ = ADDR(NIL);
     1866     5050    4         END;
     1867     5051    3      END;
     1868     5052    3      IF KV@VDH_GETBFR.BFR$=ADDR(NIL) THEN DO;
     1869     5053        /*
     1870     5054           Need a buffer. Get one.
     1871     5055        */
     1872     5056    3         KV@VDH_GETBFR.BYTSIZ = Y@BFRSIZ;
     1873     5057    4         CALL KVS$GETBFR (KV@VDH_GETBFR) WHENALTRETURN DO;
     1874     5058    4            %KV_RCRLST.NO_CTX = '1'B;
     1875     5059    4            %KV_STR.ERR.COD = %E$CANTGETCTX;
     1876     5060    4            IF %KV_RCRLST.SNDRCR<0 THEN %KV_RCRLST.SNDRCR=%KV_RCRLST.RCRCNT;
     1877     5061    4            IF %KV_STR.SNDMAXNMBRCR>0 THEN CALL Y$SNDRCR;
     1878     5062    4            ALTRETURN; END;
     1879     5063    3         Y@RCR$ = KV@VDH_GETBFR.BFR$;
     1880     5064    3         %KV_RCR.STRBYTSIZ = KV@VDH_GETBFR.BYTSIZ;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:63   
     1881     5065    3      END;
     1882     5066    2      ADDR(%KV_RCR.TXT)->KEYU4 = ADDR(KV@VDH_OTPLCL)->KEYU4;
     1883     5067    2      %KV_RCR.UPD = '1'B;
     1884     5068    2      %KV_RCR.ONE_2_1 = '1'B;
     1885     5069    2      %KV_RCR.NEW = '0'B;
     1886     5070    2      %KV_RCR.RCRBYTSIZ = Y@BFRSIZ-Y@KEYLNG-LENGTHV(KV$RCR);
     1887     5071    2      IF Y@SRHCUR=Y@DLTRCR THEN %KV_RCR.LINCNT = Y@TMP32B.TOP;
     1888     5072    3      ELSE DO;
     1889     5073        /*
     1890     5074           This is a new record key.  Shuffle the pointers if necessary.
     1891     5075        */
     1892     5076    3         IF Y@SRHCUR<=%KV_RCRLST.FRSRCR OR Y@SRHCUR>%KV_RCRLST.LSTRCR
     1893     5077    3         THEN IF %KV_MVD.HRZSCR THEN %KV_RCR.LINCNT = 1;
     1894     5078    3         ELSE %KV_RCR.LINCNT = MAXIMUM
     1895     5079    3           ((%KV_RCR.RCRBYTSIZ-1+%KV_SRD.WDT)/%KV_SRD.WDT,1);
     1896     5080    3         ELSE %KV_RCR.LINCNT = 0;
     1897     5081    3         Y@BFRSIZ = %KV_RCRLST.CRTRCR;
     1898     5082    3         IF %KV_RCRLST.DFROPR=%KV_INPPRC_SE_DWN
     1899     5083    3         THEN Y@BFRSIZ = Y@BFRSIZ+%KV_RCRLST.DFRCNT;
     1900     5084    4         IF Y@DLTRCR=0 THEN DO;
     1901     5085        /*
     1902     5086           Pushed first one off.
     1903     5087        */
     1904     5088    4            Y@SRHCUR = Y@SRHCUR-1;
     1905     5089    4            IF %KV_RCRLST.FRSRCR>0
     1906     5090    4            THEN %KV_RCRLST.FRSRCR = %KV_RCRLST.FRSRCR-1;
     1907     5091    4            ELSE IF NOT %KV_SRD.VRTSCR THEN %KV_RCRLST.LSTRCR = -1;
     1908     5092    4            ELSE %KV_RCRLST.VRTSCRCNT = %KV_RCRLST.VRTSCRCNT-Y@TMP32B.TOP;
     1909     5093    4            IF %KV_RCRLST.LSTRCR>=0
     1910     5094    4            THEN %KV_RCRLST.LSTRCR = %KV_RCRLST.LSTRCR-1;
     1911     5095    4            %KV_RCRLST.SNDRCR = %KV_RCRLST.SNDRCR-1;
     1912     5096    4            IF Y@BFRSIZ>0
     1913     5097    4            THEN %KV_RCRLST.CRTRCR = %KV_RCRLST.CRTRCR-1;
     1914     5098    4            %KV_RCRLST.BOF = '0'B;
     1915     5099    4            Y@BFRSIZ = %KV_RCRLST.RCRCNT*4-4;
     1916     5100    4            SUBSTR(ADDR(%KV_RCRLST.RCR$)->CHARS,0,Y@BFRSIZ) =
     1917     5101    4              SUBSTR(ADDR(%KV_RCRLST.RCR$(1))->CHARS,0,Y@BFRSIZ);
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:64   
     1918     5102    4         END;
     1919     5103    3         ELSE IF Y@SRHCUR=%KV_RCRLST.RCRCNT
     1920     5104        /*
     1921     5105           Adding to the end of incomplete set.
     1922     5106        */
     1923     5107    3         THEN %KV_RCRLST.RCRCNT = %KV_RCRLST.RCRCNT+1;
     1924     5108    4         ELSE DO;
     1925     5109        /*
     1926     5110           Inserting somewhere in the middle.
     1927     5111        */
     1928     5112    4            IF Y@DLTRCR<0 THEN %KV_RCRLST.RCRCNT = %KV_RCRLST.RCRCNT+1;
     1929     5113    4            ELSE %KV_RCRLST.EOF = '0'B;
     1930     5114    4            IF Y@SRHCUR<=%KV_RCRLST.FRSRCR
     1931     5115    4            THEN %KV_RCRLST.FRSRCR = %KV_RCRLST.FRSRCR+1;
     1932     5116    4            IF Y@SRHCUR<=%KV_RCRLST.LSTRCR
     1933     5117    4            THEN %KV_RCRLST.LSTRCR = %KV_RCRLST.LSTRCR+1;
     1934     5118    4            IF Y@SRHCUR<=%KV_RCRLST.SNDRCR
     1935     5119    4            THEN %KV_RCRLST.SNDRCR = %KV_RCRLST.SNDRCR+1;
     1936     5120    4            IF Y@SRHCUR<=Y@BFRSIZ OR Y@BFRSIZ<0
     1937     5121    4            THEN %KV_RCRLST.CRTRCR = %KV_RCRLST.CRTRCR+1;
     1938     5122    5            DO Y@BFRSIZ = %KV_RCRLST.RCRCNT-2 DOWNTO Y@SRHCUR;
     1939     5123    5               %KV_RCRLST.RCR$(Y@BFRSIZ+1) = %KV_RCRLST.RCR$(Y@BFRSIZ);
     1940     5124    5            END;
     1941     5125    4         END;
     1942     5126    3      END;
     1943     5127    2      %KV_RCRLST.RCR$(Y@SRHCUR) = KV@VDH_GETBFR.BFR$;
     1944     5128    2      RETURN;
     1945     5129    2   END Y$GETRCRBFR;
     1946     5130        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:65   
     1947     5131        /*I* NAME: Y$INCKEY.
     1948     5132             DESCRIPTION: Increments the key at Y@KEY$ by Y@KEYINC and stores
     1949     5133             the result at KV@VDH_OTPLCL.  If the incrementation wrapped, Y@KEYINC
     1950     5134             is zeroed.
     1951     5135        */
     1952     5136    1   Y$INCKEY: PROC;
     1953     5137
     1954     5138    3      DO CASE Y@KEYLNG;
     1955     5139    3      CASE 1;
     1956     5140    3         ADDR(KV@VDH_OTPLCL)->KEYU1 = Y@KEY$->KEYU1+Y@KEYINC;
     1957     5141    3         IF ADDR(KV@VDH_OTPLCL)->KEYU1<=Y@KEY$->KEYU1 THEN Y@KEYINC = 0;
     1958     5142    3      CASE 2;
     1959     5143    3         ADDR(KV@VDH_OTPLCL)->KEYU2 = Y@KEY$->KEYU2+Y@KEYINC;
     1960     5144    3         IF ADDR(KV@VDH_OTPLCL)->KEYU2<=Y@KEY$->KEYU2 THEN Y@KEYINC = 0;
     1961     5145    3      CASE 3;
     1962     5146        /*N* PL6 should be able to do this in one statement, but it can't */
     1963     5147    3         ADDR(KV@VDH_OTPLCL)->KEYU4 = Y@KEY$->KEYU3+Y@KEYINC;
     1964     5148    3         ADDR(KV@VDH_OTPLCL)->KEYU3 = ADDR(KV@VDH_OTPLCL)->KEYU4;
     1965     5149    3         IF ADDR(KV@VDH_OTPLCL)->KEYU3<=Y@KEY$->KEYU3 THEN Y@KEYINC = 0;
     1966     5150    3      CASE 4;
     1967     5151    3         ADDR(KV@VDH_OTPLCL)->KEYU4 = Y@KEY$->KEYU4+Y@KEYINC;
     1968     5152    3         IF ADDR(KV@VDH_OTPLCL)->KEYU4<=Y@KEY$->KEYU4 THEN Y@KEYINC = 0;
     1969     5153    3      END;
     1970     5154    2      RETURN;
     1971     5155    2   END Y$INCKEY;
     1972     5156        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:66   
     1973     5157        /*I* NAME: Y$SNDNEED.
     1974     5158             Altreturns a RQSDAT with E$RECORDS_NEEDED and proper values for
     1975     5159             KEY and count.
     1976     5160        */
     1977     5161    1   Y$SNDNEED: PROC;
     1978     5162
     1979     5163        %KV$VDOVLP_ERR (NAME=Y_ERR, STCLASS=CONSTANT, FCG=KV, MID=E, MON='1'B);
     1980     5260        %KV$VDOVLP_ERR (NAME=Y@ERR, STCLASS=AUTO);
     1981     5357        %KV$SND_DAT (NAME=KV_SND_DAT, STCLASS=SYMREF);
     1982     5476        %KV$SND_DAT (NAME=KV@SND_DAT, STCLASS=AUTO);
     1983     5595        %KV$VDOVLP_KEY (NAME=Y_KEY, STCLASS=CONSTANT);
     1984     5645
     1985     5646    2      KV@SND_DAT = KV_SND_DAT;
     1986     5647    2      %KV_STR.ERR.COD = %E$RECORDS_NEEDED;
     1987     5648    2      KV@SND_DAT.DATCTRCHRTYP = %KV_DATCTRCHRTYP_CNT;
     1988     5649    2      %KV_RCRLST.RCRNEDSNT = '1'B;
     1989     5650    2      IF %KV_RCRLST.MAXRCR>%KV_RCRLST.RCRCNT
     1990     5651    2      THEN %KV_RCRLST.DATCTRCHR = %KV_RCRLST.MAXRCR-%KV_RCRLST.RCRCNT;
     1991     5652    2      ELSE %KV_RCRLST.DATCTRCHR = MINIMUM (%KV_RCRLST.MAXRCR/4,
     1992     5653    2        %KV_RCRLST.MAXRCR-%KV_SRD.LNG-1);
     1993     5654    3      IF %KV_RCRLST.RCRCNT~=0 THEN DO;
     1994     5655        /*
     1995     5656           Figgerout which way to go.
     1996     5657        */
     1997     5658    3         IF MAXIMUM(%KV_RCRLST.CRTRCR,%KV_RCRLST.FRSRCR)+%KV_RCRLST.CRTRCR>=
     1998     5659    4           %KV_RCRLST.RCRCNT AND NOT %KV_RCRLST.EOF OR %KV_RCRLST.BOF THEN DO;
     1999     5660    4            Y@RCR$ = %KV_RCRLST.RCR$(%KV_RCRLST.RCRCNT-1);
     2000     5661    4            IF %KV_RCR.NEW THEN IF %KV_RCRLST.RCRCNT=1 THEN GOTO SUBCOMMON;
     2001     5662    4            ELSE Y@RCR$ = %KV_RCRLST.RCR$(%KV_RCRLST.RCRCNT-2);
     2002     5663    4         END; ELSE DO;
     2003     5664    4            %KV_RCRLST.DATCTRCHR = -%KV_RCRLST.DATCTRCHR;
     2004     5665    4            Y@RCR$ = %KV_RCRLST.RCR$(0);
     2005     5666    4         END;
     2006     5667    3         KV@SND_DAT.VDOVLP.KEY$ = ADDR(KV@VDH_OTPLCL); /* HANDY BUFFER SPACE     */
     2007     5668    3      END;
     2008     5669    2      ELSE IF %KV_RCRLST.EOF THEN %KV_RCRLST.DATCTRCHR = -%KV_RCRLST.DATCTRCHR;
     2009     5670    2      GOTO SUBCOMMON;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:67   
     2010     5671
     2011     5672    2   Y$SNDRCR: ENTRY;
     2012     5673
     2013     5674    2      KV@SND_DAT = KV_SND_DAT;
     2014     5675    3      IF %KV_RCRLST.SNDRCR<0 OR %KV_RCRLST.SNDRCR>=%KV_RCRLST.RCRCNT THEN DO;
     2015     5676        /*E* ERROR: KVE-E$FREC-E
     2016     5677             MESSAGE:Protocol error - record may be lost.
     2017     5678             MESSAGE1:Record insertions have lost an updated record
     2018     5679                      by pushing it out of the VDH cache.  The program should
     2019     5680                      only do insertions after an activation character.
     2020     5681        */
     2021     5682    3         IF %KV_STR.ERR.COD=0 THEN %KV_STR.ERR.COD = %E$FREC;
     2022     5683    3         %KV_RCRLST.SNDRCR = -1;
     2023     5684    3         GOTO SUBCOMMON;
     2024     5685    3      END;
     2025     5686    2      Y@RCR$ = %KV_RCRLST.RCR$(%KV_RCRLST.SNDRCR);
     2026     5687    2      %KV_RCRLST.SNDRCR = -1;
     2027     5688    3      IF %KV_RCR.RCRBYTSIZ>=0 THEN DO;
     2028     5689    3         KV@SND_DAT.DAT__.DATBYTSIZ = %KV_RCR.RCRBYTSIZ;
     2029     5690    3         KV@SND_DAT.DAT__.ADR$ = Y@RCR$;
     2030     5691    3         KV@SND_DAT.DAT__.BYTX = LENGTHV(KV$RCR)+%KV_RCRLST.KEYLNG;
     2031     5692    4         IF %KV_RCRLST.ACTCHR THEN DO;
     2032     5693    4            KV@SND_DAT.DATCTRCHRTYP = %KV_DATCTRCHRTYP_ACT;
     2033     5694    4            IF %KV_RCRLST.SAMDAT THEN KV@SND_DAT.DATMOD = %KV#DATMOD_TRN;
     2034     5695    4         END;
     2035     5696    3         ELSE IF %KV_STR.ERR.COD=0 THEN EXIT;
     2036     5697    3         KV@SND_DAT.ACTPOS = %KV_STR.RE_REDCLM;
     2037     5698    3      END;
     2038     5699    2      ELSE %KV_STR.ERR.COD = %E$RECORD_DELETED;
     2039     5700    2      KV@SND_DAT.VDOVLP.KEY$ = ADDR(KV@VDH_OTPLCL);
     2040     5701    2   SUBCOMMON:;
     2041     5702    3      IF %KV_STR.ERR.COD~=0 THEN DO;
     2042     5703    3         KV@SND_DAT.VDOVLP.ERR$ = ADDR(Y@ERR);
     2043     5704    3         Y@ERR = Y_ERR;
     2044     5705    3         Y@ERR.ERRCODE.ERR# = %KV_STR.ERR.COD;
     2045     5706    3         %KV_STR.ERR.COD = 0;
     2046     5707    3      END;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:68   
     2047     5708    2      KV@SND_DAT.DATCTRCHR = BINASC(%KV_RCRLST.DATCTRCHR);
     2048     5709    3      IF KV@SND_DAT.VDOVLP.KEY$~=ADDR(NIL) THEN DO;
     2049     5710    3         ADDR(KV@VDH_OTPLCL)->KV$VDOVLP = Y_KEY;
     2050     5711    3         ADDR(KV@VDH_OTPLCL)->KV$VDOVLP.BYTSIZ = %KV_RCRLST.KEYLNG;
     2051     5712    3         PINCRW(ADDR(KV@VDH_OTPLCL),SIZEW(KV$VDOVLP))->KEYU4 =
     2052     5713    3           ADDR(%KV_RCR.TXT)->KEYU4;
     2053     5714    3      END;
     2054     5715    2      CALL KVM$SND (KV@SND_DAT);
     2055     5716    2      RETURN;
     2056     5717    2   END Y$SNDNEED;
     2057     5718        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:69   
     2058     5719        /*I* NAME: Y$UPDRCR.
     2059     5720             DESCRIPTION: Compares SSN.REDBFR__ with RCR at Y@SRHCUR, and updates
     2060     5721             RCR is different, sending the record if possible, else saving tha
     2061     5722             need in RCRLST.SNDRCR.
     2062     5723        */
     2063     5724    1   Y$UPDRCR: PROC ALTRET;
     2064     5725
     2065     5726    2      Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);
     2066     5727    2      Y@BFRSIZ = %KV_SSN.REDBFR.NXTX;
     2067     5728    2      IF (%KV_RCR.RCRBYTSIZ=Y@BFRSIZ OR NOT %KV_SSN.BP AND
     2068     5729    3        %KV_RCR.RCRBYTSIZ<Y@BFRSIZ) AND NOT %KV_RCR.NEW THEN DO;
     2069     5730    3         IF SUBSTR(%KV_RCR.TXT,Y@KEYLNG,%KV_RCR.RCRBYTSIZ)=
     2070     5731    3           SUBSTR(%KV_SSN.REDBFR__.ADR$->CHARS,0,Y@BFRSIZ)
     2071     5732    3         THEN GOTO Y@CHK_ACTCHR;
     2072     5733    3      END;
     2073     5734    2      ELSE IF Y@BFRSIZ=0 AND %KV_RCR.NEW AND %KV_RCRLST.EOF
     2074     5735    3        AND Y@SRHCUR+1=%KV_RCRLST.RCRCNT THEN DO;
     2075     5736    3         %KV_RCR.RCRBYTSIZ = 0;
     2076     5737    3         %KV_RCR.LINCNT = -%KV_RCR.LINCNT;
     2077     5738    3         %KV_RCR.UPD = '1'B;
     2078     5739    3   Y@CHK_ACTCHR:;
     2079     5740    3         IF NOT %KV_RCRLST.ACTCHR THEN GOTO Y@UN_SCR;
     2080     5741    3         %KV_RCRLST.SAMDAT = '1'B;         /* Tell the Host it's not updated     */
     2081     5742    3         GOTO Y@SNDRCR;
     2082     5743    3      END;
     2083     5744    2   Y$UPDRCRSND: ENTRY ALTRET;
     2084     5745    2      %KV_RCR.RCRBYTSIZ = %KV_SSN.REDBFR.NXTX;
     2085     5746    2      Y@BFRSIZ = %KV_RCR.RCRBYTSIZ+Y@KEYLNG+LENGTHV(KV$RCR);
     2086     5747    3      IF Y@BFRSIZ>%KV_RCR.STRBYTSIZ THEN DO;
     2087     5748    3         Y@DLTRCR = Y@SRHCUR;
     2088     5749    3         SUBSTR(ADDR(KV@VDH_OTPLCL)->CHARS,0,Y@KEYLNG) =
     2089     5750    3           SUBSTR(%KV_RCR.TXT,0,Y@KEYLNG);
     2090     5751    4         CALL Y$GETRCRBFR WHENALTRETURN DO;
     2091     5752    4            ALTRETURN;
     2092     5753    4         END;
     2093     5754    3         %KV_RCR.UPD = '0'B;
     2094     5755    3         %KV_RCR.DSP = '1'B;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:70   
     2095     5756    3         %KV_RCR.ONE_2_1 = %KV_SSN.CLMIS_BYTX;
     2096     5757    3      END;
     2097     5758    2      %KV_RCR.NEW = '0'B;
     2098     5759    2      SUBSTR(%KV_RCR.TXT,Y@KEYLNG,%KV_RCR.RCRBYTSIZ) =
     2099     5760    2        SUBSTR(%KV_SSN.REDBFR__.ADR$->CHARS,0,%KV_RCR.RCRBYTSIZ);
     2100     5761    2   Y@SNDRCR:;
     2101     5762    2      IF %KV_RCRLST.SNDRCR<0 THEN %KV_RCRLST.SNDRCR = Y@SRHCUR;
     2102     5763    2      ELSE %KV_RCRLST.SNDRQR.INS = '1'B;   /* an insert needed two writes        */
     2103     5764    2      IF %KV_STR.SNDMAXNMBRCR~=0 THEN CALL Y$SNDRCR;
     2104     5765    2   Y@UN_SCR:;
     2105     5766    3      IF %KV_SSN.REDBFR.DSPLOWX~=%KV_RCRLST.HRZSCROFS THEN DO;
     2106     5767    3         %KV_VDI.RE_DSPINP = '0'B;
     2107     5768    3         CALL KVI$SHFTO_DFL;
     2108     5769    3      END;
     2109     5770    2      IF %KV_RCR.ONE_2_1 AND %KV_RCR.LINCNT>
     2110     5771    2        MAXIMUM ((%KV_RCR.RCRBYTSIZ+%KV_SRD.WDT-1)/%KV_SRD.WDT, 1)
     2111     5772    2      THEN %KV_RCR.LINCNT = -%KV_RCR.LINCNT;
     2112     5773    2      RETURN;
     2113     5774    2   END Y$UPDRCR;
     2114     5775    1   END;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:71   
--  Include file information  --

   KV_ERRORS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   KV$VDP.:E05TOU  is referenced.
   KV$INPFNC.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KVE$SE.

   Procedure KVE$SE requires 7995 words for executable code.
   Procedure KVE$SE requires 90 words of local(AUTO) storage.

    No errors detected in file KVE$SE.:E05TSI    .

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:72   

 Object Unit name= KVE$SE                                     File name= KVE$SE.:E05TOU
 UTS= JUL 30 '97 01:56:16.72 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS     24     18  KVE$SE
    1   Proc  even  none  7995   1F3B  KVE$SE
    2  RoData even  none    12      C  KVE$SE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  KVE$SE
     1     8C          yes     yes      Std        1  KVE$ACTRED
     1     F9          yes     yes      Std        0  KVE$DLTALLRCR
     1    144          yes     yes      Std        0  KVE$DSPALL
     1    16E          yes     yes      Std        0  KVE$DSPUPD
     1    74B          yes     yes      Std        0  KVE$FIXHRZSCR
     1    7B0          yes     yes      Std        0  KVE$INCFLD
     1    831          yes     yes      Std        1  KVE$INPOPR
     1   1174          yes     yes      Std        0  KVE$INSREC
     1   12CC          yes     yes      Std        0  KVE$PST
     1   132C          yes     yes      Std        0  KVE$RE_DSPSE
     1   1364          yes     yes      Std        1  KVE$RQSDAT
     1   1605          yes     yes      Std        0  KVE$SCRALL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:73   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 KVI$RE_DSPINP
         yes           Std       1 KVI$EDTX_TO_VRTCLM
         yes           Std       1 KVI$RQSDAT
 yes     yes           Std       1 KVV$CALUSR
 yes     yes           Std       1 KVS$GETREDBFR
         yes           Std       0 KVI$PRGRED
         yes           Std       0 KVO$ERSTO_ENDOF_INP
 yes     yes           Std       1 KVV$VDIINT
         yes           Std       1 KVO$OTPLCL
         yes           Std       1 KVO$PST
         yes           Std       1 KVI$TRMRED_VDH_DAT
 yes     yes           Std       0 KVV$CALUSR_PST
         yes           Std       0 KVO$ERSTO_ENDOF_SRD
 yes     yes           Std       1 KVV$CALUSR_EVT
         yes           Std       1 KVI$SHFDSPPST
 yes     yes           Std       1 KVS$RLSBFR
 yes     yes           Std       1 KVS$GETBFR
 yes     yes           Std       1 KVM$SND
         yes           Std       0 KVI$SHFTO_DFL
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET
                       nStd      0 X6A_AALT
                       nStd      0 X6C_ACM
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:74   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KV$PTR$                               KV$RCVVDO$                            KV_VDH_PST_VRT
     KV_VDH_PST_HOM                        KV_USR_PST                            KV_USR_RQSDAT
     KV_VDH_DAT                            KV_CMPCOD_TO_ERR#                     KV_SND_DAT
r    G$ROS$
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:75   


        1        1        /*M* KVE$SE - Various bits of code used to support screen editor mode.       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
        8        8        KVE$SE: PROC(PRM_INPOPR_DUMMY) ALTRET;

      8   1 000000  D380 0000 0000  xent KVE$SE          LNJ,B5   X6A_AUTO_1
          1 000003       005A 0001                       DC       90,1
          1 000005  0F81 0084                            B        s:3321+4,PREL

        9        9
       10       10        %INCLUDE LCP_6;
       11      201 S      %INCLUDE KV$GLB;
       12      202 S      %INCLUDE KV$GLBCTX;
       13      203        %INCLUDE KV$INPFNC;
       14      762        %KV_INPPRC_E;
       15      814 S      %INCLUDE KV$INT;
       16      815 S      %INCLUDE KV$USR;
       17      816 S      %INCLUDE KV$SND;
       18      817        %KV_SND_FNC_E;
       19      833 S      %INCLUDE KV$VDH;
       20      834 S      %INCLUDE KV$VDO;
       21      835        %KV_DATCTRCHRTYP_E;
       22      841        %KV_VDOVLP_E;
       23      855        %INCLUDE KV$VDP;
       24     1013        %INCLUDE F_ERRORS_C;
       25     1253        %INCLUDE KV_ERRORS_C;
       26     1313 S      %INCLUDE KV_GLBCNS_E;
       27     1314        %KV#DATMOD_E;
       28     1320        %KV#VD_ORG_E;
       29     1328        %KV_PHSPSTMOD_E;
       30     1335        %KV_STRTYP_E;
       31     1373        %KV_USR_EVT_ID_E;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:76   
       32     1393        %KV$MRD;
       33     1440        %KV$MVD;
       34     1484        %KV$PTR;
       35     1527        %KV$RCR (STCLASS="BASED(Y@RCR$)");
       36     1557        %EQU KV_RCR=CHARTEXT('KV$RCR');
       37     1558        %KV$RCRLST (STCLASS="BASED(Y@RCRLST$)");
       38     1594        %EQU KV_RCRLST=CHARTEXT('KV$RCRLST');
       39     1595        %KV$RCVVDO (NAME=KV_RCVVDO, STCLASS="BASED(KV$RCVVDO$)");
       40     1736    1   DCL KV$RCVVDO$ PTR SYMREF;
       41     1737        %KV$SRD (STCLASS="BASED(Y@SRD$)");
       42     2012        %EQU KV_SRD = CHARTEXT('KV$SRD');
       43     2013        %KV$SSN (STCLASS="BASED(Y@SSN$)");
       44     2092        %EQU KV_SSN=CHARTEXT('KV$SSN');
       45     2093        %KV$STR (STCLASS="BASED(Y@STR$)");
       46     2180        %EQU KV_STR=CHARTEXT('KV$STR');
       47     2181        %KV$TITLE;
       48     2229        %KV$VDI;
       49     2300        %KV$VDOVLP;
       50     2336        %KV$VDOVLP_ERR;
       51     2433
       52     2434        /*
       53     2435           ENTREFS
       54     2436        */
       55     2437    1   DCL KVI$EDTX_TO_VRTCLM ENTRY(1);
       56     2438    1   DCL KVI$PRGRED ENTRY;
       57     2439    1   DCL KVI$RE_DSPINP ENTRY;
       58     2440    1   DCL KVI$RQSDAT ENTRY(1);
       59     2441    1   DCL KVI$SHFDSPPST ENTRY(1);
       60     2442    1   DCL KVI$SHFTO_DFL ENTRY;
       61     2443    1   DCL KVI$TRMRED_VDH_DAT ENTRY(1);
       62     2444    1   DCL KVM$SND ENTRY(1) ALTRET;
       63     2445    1   DCL KVO$ERSTO_ENDOF_INP ENTRY;
       64     2446    1   DCL KVO$ERSTO_ENDOF_SRD ENTRY;
       65     2447    1   DCL KVO$OTPLCL ENTRY(1);
       66     2448    1   DCL KVO$PST ENTRY(1);
       67     2449    1   DCL KVS$GETBFR ENTRY(1) ALTRET;
       68     2450    1   DCL KVS$GETREDBFR ENTRY(1) ALTRET;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:77   
       69     2451    1   DCL KVS$RLSBFR ENTRY(1) ALTRET;
       70     2452    1   DCL KVV$CALUSR ENTRY(1) ALTRET;
       71     2453    1   DCL KVV$CALUSR_EVT ENTRY(1) ALTRET;
       72     2454    1   DCL KVV$CALUSR_PST ENTRY ALTRET;
       73     2455    1   DCL KVV$VDIINT ENTRY(1) ALTRET;
       74     2456    1   DCL KV_VDH_PST_VRT SBIN SYMREF;
       75     2457    1   DCL KV_VDH_PST_HOM SBIN SYMREF;
       76     2458        /* Local storage */
       77     2459    1   DCL Y@RCRLST$ PTR;
       78     2460    1   DCL Y@KEY$ PTR;
       79     2461    1   DCL Y@RCR$ PTR;
       80     2462    1   DCL Y@SRD$ PTR;
       81     2463    1   DCL Y@SSN$ PTR;
       82     2464    1   DCL Y@STR$ PTR;
       83     2465    1   DCL Y@KEYCMP SBIN;
       84     2466    1   DCL Y@KEYCMPU REDEF Y@KEYCMP UBIN;
       85     2467    1   DCL Y@REDLIN REDEF Y@KEYCMP SBIN;
       86     2468    1   DCL Y@KEYLNG SBIN;
       87     2469    1   DCL Y@SRHHI SBIN;
       88     2470    1   DCL Y@DLTRCR REDEF Y@SRHHI SBIN;
       89     2471    1   DCL Y@VRTLIN REDEF Y@SRHHI SBIN;
       90     2472    1   DCL Y@KEYINC REDEF Y@SRHHI UBIN;
       91     2473    1   DCL Y@SRHLO SBIN;
       92     2474    1   DCL Y@BFRSIZ REDEF Y@SRHLO SBIN;
       93     2475    1   DCL Y@SRHCUR SBIN;
       94     2476    1   DCL Y@TMP32 UBIN(32);
       95     2477    1   DCL 1 Y@TMP32B REDEF Y@TMP32,
       96     2478    1          2 TOP SBIN,
       97     2479    1          2 BTM SBIN;
       98     2480    1   DCL Y@VRTSCRMRG SBIN;
       99     2481    1   DCL Y@VRTSCRSHF SBIN;
      100     2482    1   DCL Y@LINCNT SBIN;
      101     2483        %KV$USR_PST (NAME=KV_USR_PST, STCLASS=SYMREF);
      102     2553        %KV$USR_PST (NAME=KV@USR_PST, STCLASS=AUTO);
      103     2623        %KV$USR_RQSDAT (NAME=KV@USR_RQSDAT, STCLASS=AUTO);
      104     2686        %KV$USR_RQSDAT (NAME=KV_USR_RQSDAT, STCLASS=SYMREF);
      105     2749    1   DCL KV_VDH_DAT UBIN SYMREF;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:78   
      106     2750        %KV$VDH_GETBFR (NAME=KV@VDH_GETBFR, STCLASS=AUTO);
      107     2815        %KV$VDH_OTPLCL (NAME=KV@VDH_OTPLCL, STCLASS=AUTO);
      108     2888        %KV$VDH_OTPLCL (NAME=Y_VDH_OTPLCL, STCLASS=CONSTANT, NO_WRAP=YES);
      109     2961        %KV$VDH_GETBFR (NAME=Y_VDH_GETBFR, STCLASS=CONSTANT, STRTYP=%KV_STRTYP_RCR);
      110     3026    1   DCL Y_LTLKEY UBIN(32) CONSTANT INIT(0);
      111     3027    1   DCL Y_BIGKEY SBIN(32) CONSTANT INIT(-1);
      112     3028        /*
      113     3029           Handy based stuff.
      114     3030        */
      115     3031    1   DCL CHARS CHAR(8) BASED;
      116     3032    1   DCL KEYU1 BASED ALIGNED UBIN(8);
      117     3033    1   DCL KEYU2 BASED ALIGNED UBIN;
      118     3034    1   DCL KEYU3 BASED ALIGNED UBIN(24);
      119     3035    1   DCL KEYU4 BASED ALIGNED UBIN(32);
      120     3036    1   DCL RCR_BYT(0:0) BASED CALIGNED SBIN BYTE;
      121     3037        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:79   
      122     3038        /*
      123     3039           Parameter(s)
      124     3040        */
      125     3041        %KV$INPOPR (NAME=PRM_INPOPR, STCLASS=PARAM);
      126     3140        %KV$USR_RQSDAT (NAME=PRM_RQSDAT, STCLASS="REDEF PRM_INPOPR_DUMMY");
      127     3203    1   DCL PRM_STRID REDEF PRM_INPOPR_DUMMY UBIN;
      128     3204        %KV$VDH_DAT (NAME=PRM_VDH_DAT, STCLASS=REDEF PRM_INPOPR_DUMMY);
      129     3284    1   DCL 1 PRM_FND REDEF PRM_INPOPR_DUMMY,
      130     3285    1          2 BYT SBIN BYTE CALIGNED,
      131     3286    1          2 ID SBIN BYTE CALIGNED,
      132     3287    1          2 RVRDRC BIT(1);
      133     3288    1   DCL KV_CMPCOD_TO_ERR# (0:0) UBIN SYMREF;
      134     3289        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:80   
      135     3290        /*I* NAME: Y$SETUP.
      136     3291             DESCRIPTION: Loads up a bunch of stuff from KV$RCRLST into AUTO variables.
      137     3292             Computes some of them - like vertical scrolling parameters.
      138     3293        */
      139     3294    1   Y$SETUP: PROC;

   3294   1 000007  EFC7 0036            Y$SETUP         STB,B6   KV@VDH_OTPLCL+5,AUTO

      140     3295    2      Y@SSN$ = KV$PTR.SSN$;

   3295   1 000009  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 00000C  CCC5 0002                            LDB,B4   2,B5
          1 00000E  CFC7 000E                            STB,B4   Y@SSN$,AUTO

      141     3296    2      Y@RCRLST$ = KV$PTR.LINLST$;

   3296   1 000010  BCC5 000E                            LDB,B3   14,B5
          1 000012  BFC7 0006                            STB,B3   Y@RCRLST$,AUTO

      142     3297    2      Y@STR$ = KV$PTR.STR$;

   3297   1 000014  ACC5 0004                            LDB,B2   4,B5
          1 000016  AFC7 0010                            STB,B2   Y@STR$,AUTO

      143     3298    2      Y@SRD$ = KV$PTR.SRD$;

   3298   1 000018  9CC5 000A                            LDB,B1   10,B5
          1 00001A  9FC7 000C                            STB,B1   Y@SRD$,AUTO

      144     3299    2      Y@SRHCUR = %KV_RCRLST.CRTRCR;

   3299   1 00001C  E843 0006                            LDR,R6   6,B3
          1 00001E  EF47 0016                            STR,R6   Y@SRHCUR,AUTO

      145     3300    2      IF Y@SRHCUR>=0 AND Y@SRHCUR<%KV_RCRLST.RCRCNT

   3300   1 000020  6801 000A                            BLZ,R6   s:3302,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:81   
          1 000022  E943 0001                            CMR,R6   1,B3
          1 000024  0881 0006                            BAGE     s:3302,PREL

      146     3301    2      THEN Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);

   3301   1 000026  B856                                 LDR,R3   R6
          1 000027  3E08                                 ADV,R3   8
          1 000028  ECB3                                 LDB,B6   ,B3,R3
          1 000029  EFC7 000A                            STB,B6   Y@RCR$,AUTO

      147     3302    2      Y@REDLIN = Y@SRHCUR;

   3302   1 00002B  EF47 0012                            STR,R6   Y@KEYCMP,AUTO

      148     3303    2      Y@KEYLNG = %KV_RCRLST.KEYLNG;

   3303   1 00002D  D2C3 000B                            LLH,R5   11,B3
          1 00002F  DF47 0013                            STR,R5   Y@KEYLNG,AUTO

      149     3304    2      Y@VRTSCRMRG = %KV_RCRLST.VRTSCRMRG;

   3304   1 000031  C2C3 0009                            LLH,R4   9,B3
          1 000033  CF47 0019                            STR,R4   Y@VRTSCRMRG,AUTO

      150     3305    2      IF Y@VRTSCRMRG>=%G_SCROLL_CENTER#

   3305   1 000035  4D7F                                 CMV,R4   127
          1 000036  0801 0009                            BAL      s:3307,PREL

      151     3306    2      THEN Y@VRTSCRMRG = (Y@VRTSCRMRG-%G_SCROLL_CENTER#)*%KV_SRD.LNG/100;

   3306   1 000038  4E81                                 ADV,R4   -127
          1 000039  B2C1 000E                            LLH,R3   14,B1
          1 00003B  CB53                                 MUL,R4   R3
          1 00003C  C370 0064                            DIV,R4   100,IMO
          1 00003E  CF47 0019                            STR,R4   Y@VRTSCRMRG,AUTO

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:82   
      152     3307    2      IF Y@VRTSCRMRG*2>%KV_SRD.LNG THEN Y@VRTSCRMRG = %KV_SRD.LNG/3;

   3307   1 000040  4001                                 SOL,R4   1
          1 000041  B2C1 000E                            LLH,R3   14,B1
          1 000043  C953                                 CMR,R4   R3
          1 000044  0A81 0005                            BALE     s:3308,PREL

   3307   1 000046  B370 0003                            DIV,R3   3,IMO
          1 000048  BF47 0019                            STR,R3   Y@VRTSCRMRG,AUTO

      153     3308    2      IF Y@VRTSCRMRG*3>%KV_RCRLST.MAXRCR THEN Y@VRTSCRMRG = %KV_RCRLST.MAXRCR/3;

   3308   1 00004A  C847 0019                            LDR,R4   Y@VRTSCRMRG,AUTO
          1 00004C  4F03                                 MLV,R4   3
          1 00004D  C943 0002                            CMR,R4   2,B3
          1 00004F  0A81 0007                            BALE     s:3309,PREL

   3308   1 000051  B843 0002                            LDR,R3   2,B3
          1 000053  B370 0003                            DIV,R3   3,IMO
          1 000055  BF47 0019                            STR,R3   Y@VRTSCRMRG,AUTO

      154     3309    2      Y@VRTSCRSHF = %KV_RCRLST.VRTSCRSHF;

   3309   1 000057  C843 0009                            LDR,R4   9,B3
          1 000059  C570 00FF                            AND,R4   255,IMO
          1 00005B  CF47 001A                            STR,R4   Y@VRTSCRSHF,AUTO

      155     3310    2      IF Y@VRTSCRSHF>%G_SCROLL_CENTER#

   3310   1 00005D  4D7F                                 CMV,R4   127
          1 00005E  0A81 000D                            BALE     s:3313,PREL

      156     3311    2      THEN Y@VRTSCRSHF =

   3311   1 000060  4E81                                 ADV,R4   -127
          1 000061  B2C1 000E                            LLH,R3   14,B1
          1 000063  CB53                                 MUL,R4   R3
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:83   
          1 000064  C370 0064                            DIV,R4   100,IMO
          1 000066  CA47 0019                            ADD,R4   Y@VRTSCRMRG,AUTO
          1 000068  CF47 001A                            STR,R4   Y@VRTSCRSHF,AUTO
          1 00006A  0F81 000F                            B        s:3315,PREL

      157     3312    2        (Y@VRTSCRSHF-%G_SCROLL_CENTER#)*%KV_SRD.LNG/100+Y@VRTSCRMRG;
      158     3313    2      ELSE IF Y@VRTSCRSHF=%G_SCROLL_CENTER# THEN Y@VRTSCRSHF = %KV_SRD.LNG/2;

   3313   1 00006C  0981 0009                            BNE      s:3314,PREL

   3313   1 00006E  B2C1 000E                            LLH,R3   14,B1
          1 000070  3041                                 SOR,R3   1
          1 000071  C853                                 LDR,R4   R3
          1 000072  CF47 001A                            STR,R4   Y@VRTSCRSHF,AUTO
          1 000074  0F81 0005                            B        s:3315,PREL

      159     3314    2      ELSE Y@VRTSCRSHF = Y@VRTSCRSHF+Y@VRTSCRMRG;

   3314   1 000076  CA47 0019                            ADD,R4   Y@VRTSCRMRG,AUTO
          1 000078  CF47 001A                            STR,R4   Y@VRTSCRSHF,AUTO

      160     3315    2      IF Y@VRTSCRSHF>%KV_SRD.LNG THEN Y@VRTSCRSHF = %KV_SRD.LNG;

   3315   1 00007A  B2C1 000E                            LLH,R3   14,B1
          1 00007C  B954                                 CMR,R3   R4
          1 00007D  0881 0004                            BAGE     s:3320,PREL

   3315   1 00007F  C853                                 LDR,R4   R3
          1 000080  CF47 001A                            STR,R4   Y@VRTSCRSHF,AUTO

      161     3316        /*
      162     3317           Now, since the computation happens when we've actually moved to MRG-1,
      163     3318           decrement the result to compensate for that.
      164     3319        */
      165     3320    2      IF Y@VRTSCRSHF~=0 THEN Y@VRTSCRSHF = Y@VRTSCRSHF-1;

   3320   1 000082  4901 0003                            BEZ,R4   s:3321,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:84   

   3320   1 000084  88C7 001A                            DEC      Y@VRTSCRSHF,AUTO

      166     3321    2      RETURN;

   3321   1 000086  ECC7 0036                            LDB,B6   KV@VDH_OTPLCL+5,AUTO
          1 000088  C3C6 0001                            LNJ,B4   1,B6
          1 00008A  0F81 0006                            B        s:3330,PREL

      167     3322    2   END Y$SETUP;
      168     3323        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:85   
      169     3324        /*F* NAME: KVE$ACTRED
      170     3325             DESCRIPTION: Called when an activation character is entered in
      171     3326             editor mode.  Any editing activity is terminated.
      172     3327        */
      173     3328    1   KVE$ACTRED: ENTRY(PRM_INPOPR_DUMMY) ALTRET;

   3328   1 00008C  D380 0000 0000  xent KVE$ACTRED      LNJ,B5   X6A_AUTO_1
          1 00008F       005A 0001                       DC       90,1

      174     3329
      175     3330    1      IF %KV_VDI.RE_DSPINP THEN CALL KVI$RE_DSPINP;

   3330   1 000091  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000094  DC86                                 LDB,B5   ,B6
          1 000095  82C5 0019                            LB,'0010'X        25,B5
          1 000097       0010
          1 000098  0581 0007                            BBF      s:3331,PREL

   3330   1 00009A  CBF0 0000                            LAB,B4   0,IMO
          1 00009C  E380 0000 0000  xent                 LNJ,B6   KVI$RE_DSPINP
          1 00009F       0001                            DC       s:3331,PREL

      176     3331    1      CALL Y$SETUP;

   3331   1 0000A0  E3C0 FF66                            LNJ,B6   s:0,PREL
          1 0000A2       0001                            DC       s:3332,PREL

      177     3332    1      %KV_STR.RE_REDCLM = %KV_SSN.REDBFR.EDTLOWX+1;

   3332   1 0000A3  ECC7 0010                            LDB,B6   Y@STR$,AUTO
          1 0000A5  DCC7 000E                            LDB,B5   Y@SSN$,AUTO
          1 0000A7  E845 002B                            LDR,R6   43,B5
          1 0000A9  6E01                                 ADV,R6   1
          1 0000AA  EF46 0012                            STR,R6   18,B6

      178     3333    2      IF PRM_VDH_DAT.DATCTRCHRTYP~=%KV_DATCTRCHRTYP_NON THEN DO;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:86   
   3333   1 0000AC  CCC7 0004                            LDB,B4   @PRM_INPOPR_DUMMY,AUTO
          1 0000AE  8284                                 LB,'0030'X        ,B4
          1 0000AF       0030
          1 0000B0  0581 001D                            BBF      s:3341,PREL

      179     3334    2         %KV_RCRLST.ACTCHR = '1'B;

   3334   1 0000B2  BCC7 0006                            LDB,B3   Y@RCRLST$,AUTO
          1 0000B4  8943 000C                            LBT,'0008'X       12,B3
          1 0000B6       0008

      180     3335    2         %KV_RCRLST.DATCTRCHR = ASCBIN(PRM_VDH_DAT.DATCTRCHR);

   3335   1 0000B7  E844 0007                            LDR,R6   7,B4
          1 0000B9  E570 00FF                            AND,R6   255,IMO
          1 0000BB  E7C3 000C                            STH,R6   12,B3

      181     3336    2         %KV_RCRLST.SAMDAT = '0'B;

   3336   1 0000BD  8843 000D                            LBF,'0004'X       13,B3
   3336   1 0000BF       0004

      182     3337    2         CALL Y$UPDRCR ALTRET(ABRRED);     /* Always send the record along.      */

   3337   1 0000C0  E3C0 1D83                            LNJ,B6   s:0,PREL
          1 0000C2       1093                            DC       s:4338,PREL

      183     3338    2         IF %KV_RCRLST.SNDRCR<0 THEN %KV_RCRLST.ACTCHR = '0'B;

   3338   1 0000C3  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 0000C5  E846 0007                            LDR,R6   7,B6
          1 0000C7  6881 0004                            BGEZ,R6  s:3339,PREL

   3338   1 0000C9  8846 000C                            LBF,'0008'X       12,B6
   3338   1 0000CB       0008

      184     3339    2         GOTO ABRRED;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:87   

   3339   1 0000CC  0F81 1088                            B        s:4338,PREL

      185     3340    2      END;
      186     3341    1      IF PRM_VDH_DAT.CMPCOD=0 AND %KV_STR.WRDWRP AND %KV_STR.WRDWRPCLM>11

   3341   1 0000CE  D2C4 0007                            LLH,R5   7,B4
          1 0000D0  5981 001D                            BNEZ,R5  s:3351,PREL
          1 0000D2  82C6 001E                            LB,'0040'X        30,B6
          1 0000D4       0040
          1 0000D5  0581 0018                            BBF      s:3351,PREL
          1 0000D7  C2C6 001D                            LLH,R4   29,B6
          1 0000D9  4D0B                                 CMV,R4   11
          1 0000DA  0381 0013                            BLE      s:3351,PREL
          1 0000DC  B845 002A                            LDR,R3   42,B5
          1 0000DE  B945 002B                            CMR,R3   43,B5
          1 0000E0  0801 000D                            BAL      s:3351,PREL
          1 0000E2  C956                                 CMR,R4   R6
          1 0000E3  0281 000A                            BGE      s:3351,PREL

      187     3342    1        AND %KV_SSN.REDBFR.NXTX>=%KV_SSN.REDBFR.EDTLOWX
      188     3343    2        AND %KV_STR.RE_REDCLM>%KV_STR.WRDWRPCLM THEN DO;

      189     3344        /*
      190     3345           We have the word-wrap stiuation.  Turn it into a split.
      191     3346        */
      192     3347    2         Y@LINCNT = 2;                     /* Wordwrap once.                     */

   3347   1 0000E5  2C02                                 LDV,R2   2
          1 0000E6  AF47 001B                            STR,R2   Y@LINCNT,AUTO

      193     3348    2         %KV_RCRLST.DFRCNT = 0;

   3348   1 0000E8  BCC7 0006                            LDB,B3   Y@RCRLST$,AUTO
          1 0000EA  87C3 000D                            CLH      13,B3

      194     3349    2         GOTO SPLIT_ONE;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:88   

   3349   1 0000EC  0F81 0BBD                            B        s:4066,PREL

      195     3350    2      END;
      196     3351    1      %KV_STR.ERR.COD = KV_CMPCOD_TO_ERR#(PRM_VDH_DAT.CMPCOD);

   3351   1 0000EE  B855                                 LDR,R3   R5
          1 0000EF  C830 0000 0000  xsym                 LDR,R4   KV_CMPCOD_TO_ERR#,R3
          1 0000F2  CF46 0013                            STR,R4   19,B6

      197     3352    1      CALL Y$UPDRCRSND ALTRET(ABRRED);     /* Always send the record along.      */

   3352   1 0000F4  E3C0 1DB3                            LNJ,B6   s:0,PREL
          1 0000F6       105F                            DC       s:4338,PREL

      198     3353    1      GOTO ABRRED;

   3353   1 0000F7  0F81 105D                            B        s:4338,PREL

      199     3354        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:89   
      200     3355        /*F* NAME: KVE$DLTALLRCR
      201     3356             DESCRIPTION: Reduces the record set to none.
      202     3357        */
      203     3358    1   KVE$DLTALLRCR: ENTRY ALTRET;

   3358   1 0000F9  D380 0000 0000  xent KVE$DLTALLRCR   LNJ,B5   X6A_AUTO_1
          1 0000FC       005A 0001                       DC       90,1

      204     3359
      205     3360    1      CALL Y$SETUP;

   3360   1 0000FE  E3C0 FF08                            LNJ,B6   s:0,PREL
          1 000100       0001                            DC       s:3361,PREL

      206     3361    1      Y@SRHCUR = %KV_RCRLST.RCRCNT;

   3361   1 000101  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 000103  E846 0001                            LDR,R6   1,B6
          1 000105  EF47 0016                            STR,R6   Y@SRHCUR,AUTO

      207     3362    1      %KV_RCRLST.BOF = '0'B;

   3362   1 000107  8846 000C                            LBF,'0020'X       12,B6
   3362   1 000109       0020

      208     3363    1      %KV_RCRLST.EOF = '0'B;

   3363   1 00010A  8846 000C                            LBF,'0040'X       12,B6
   3363   1 00010C       0040

      209     3364    1      %KV_RCRLST.ACTCHR = '0'B;

   3364   1 00010D  8846 000C                            LBF,'0008'X       12,B6
   3364   1 00010F       0008

      210     3365    1      %KV_RCRLST.SNDRQR = '0'B;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:90   
   3365   1 000110  8846 000C                            LBF,'0006'X       12,B6
   3365   1 000112       0006

      211     3366    1      %KV_RCRLST.RCRNEDSNT = '0'B;

   3366   1 000113  8846 000C                            LBF,'0080'X       12,B6
   3366   1 000115       0080

      212     3367    1      %KV_RCRLST.PRTLSTRCR = '0'B;

   3367   1 000116  8846 000C                            LBF,'0010'X       12,B6
   3367   1 000118       0010

      213     3368    1      %KV_RCRLST.NO_CTX = '0'B;

   3368   1 000119  8846 000D                            LBF,'0008'X       13,B6
   3368   1 00011B       0008

      214     3369    1      %KV_RCRLST.EOFDSP = '0'B;

   3369   1 00011C  8846 000D                            LBF,'0010'X       13,B6
   3369   1 00011E       0010

      215     3370    1      %KV_RCRLST.DFROPR = 0;

   3370   1 00011F  87C6 000E                            CLH      14,B6

      216     3371    1      %KV_RCRLST.SNDRCR = -1;

   3371   1 000121  8946 0007                            LBT,'FFFF'X       7,B6
   3371   1 000123       FFFF

      217     3372    1      %KV_RCRLST.CRTRCR = %KV_RCRLST.FRSRCR;

   3372   1 000124  D846 0004                            LDR,R5   4,B6
          1 000126  DF46 0006                            STR,R5   6,B6

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:91   
      218     3373    1      %KV_STR.RE_REDCLM = 1;

   3373   1 000128  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 00012A  4C01                                 LDV,R4   1
          1 00012B  CF45 0012                            STR,R4   18,B5

      219     3374    1      KV@VDH_GETBFR = Y_VDH_GETBFR;

   3374   1 00012D  AB80 0000 0000  00                   LAB,B2   Y_VDH_OTPLCL
          1 000130  2C0A                                 LDV,R2   10
          1 000131  6C16                                 LDV,R6   22
          1 000132  BB87                                 LAB,B3   ,AUTO
          1 000133  3C4C                                 LDV,R3   76
          1 000134  0008                                 MMM

      220     3375    2      DO WHILE Y@SRHCUR>0;

   3375   1 000135  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 000137  6A81 0009                            BLEZ,R6  s:3379,PREL

      221     3376    2         Y@SRHCUR = Y@SRHCUR-1;

   3376   1 000139  88C7 0016                            DEC      Y@SRHCUR,AUTO

      222     3377    2         CALL Y$DLTRCR;

   3377   1 00013B  E3C0 191B                            LNJ,B6   s:0,PREL
          1 00013D       0001                            DC       s:3378,PREL

      223     3378    2      END;

   3378   1 00013E  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 000140  6A79                                 BGZ,R6   s:3376,SPREL

      224     3379    1      RETURN;

   3379   1 000141  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:92   

      225     3380        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:93   
      226     3381        /*F* NAME: KVE$DSPALL
      227     3382             ENTRY: KVE$DSPUPD
      228     3383             DESCRIPTION: Does whatever is required to get what is supposed to
      229     3384             be on the screen out there. DSPALL assumes the screen is cleared.
      230     3385             DSPUPD updates an already displayed screen.
      231     3386        */
      232     3387    1   KVE$DSPALL: ENTRY ALTRET;

   3387   1 000144  D380 0000 0000  xent KVE$DSPALL      LNJ,B5   X6A_AUTO_1
          1 000147       005A 0001                       DC       90,1

      233     3388
      234     3389    1      CALL Y$SETUP;

   3389   1 000149  E3C0 FEBD                            LNJ,B6   s:0,PREL
          1 00014B       0001                            DC       s:3390,PREL

      235     3390    1      IF %KV_SSN.REDSTRID=%KV_STR.ID

   3390   1 00014C  ECC7 000E                            LDB,B6   Y@SSN$,AUTO
          1 00014E  E2C6 0038                            LLH,R6   56,B6
          1 000150  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 000152  D2C5 001C                            LLH,R5   28,B5
          1 000154  E955                                 CMR,R6   R5
          1 000155  0981 0007                            BNE      s:3392,PREL

      236     3391    1      THEN %KV_RCRLST.HRZSCROFS = %KV_SSN.REDBFR.DSPLOWX;

   3391   1 000157  CCC7 0006                            LDB,B4   Y@RCRLST$,AUTO
          1 000159  C846 002F                            LDR,R4   47,B6
          1 00015B  CF44 0003                            STR,R4   3,B4

      237     3392    1      %KV_RCRLST.LSTRCR = -2;

   3392   1 00015D  CCC7 0006                            LDB,B4   Y@RCRLST$,AUTO
          1 00015F  6CFE                                 LDV,R6   -2
          1 000160  EF44 0005                            STR,R6   5,B4
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:94   

      238     3393    1      %KV_RCRLST.PRTLSTRCR = '0'B;

   3393   1 000162  8844 000C                            LBF,'0010'X       12,B4
   3393   1 000164       0010

      239     3394    1      %KV_RCRLST.EOFDSP = '0'B;

   3394   1 000165  8844 000D                            LBF,'0010'X       13,B4
   3394   1 000167       0010

      240     3395    1      CALL Y$DSPALL;

   3395   1 000168  E3C0 0013                            LNJ,B6   s:0,PREL
          1 00016A       0001                            DC       s:3396,PREL

      241     3396    1      RETURN;

   3396   1 00016B  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      242     3397
      243     3398    1   KVE$DSPUPD: ENTRY ALTRET;

   3398   1 00016E  D380 0000 0000  xent KVE$DSPUPD      LNJ,B5   X6A_AUTO_1
          1 000171       005A 0001                       DC       90,1

      244     3399
      245     3400    1      CALL Y$SETUP;

   3400   1 000173  E3C0 FE93                            LNJ,B6   s:0,PREL
          1 000175       0001                            DC       s:3401,PREL

      246     3401    1      CALL Y$DSPALL;

   3401   1 000176  E3C0 0005                            LNJ,B6   s:0,PREL
          1 000178       0001                            DC       s:3402,PREL

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:95   
      247     3402    1      RETURN;

   3402   1 000179  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      248     3403
      249     3404        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:96   
      250     3405    1   Y$DSPALL: PROC;

   3405   1 00017C  EFC7 0036            Y$DSPALL        STB,B6   KV@VDH_OTPLCL+5,AUTO

      251     3406    2   DCL Y@BTMHOL SBIN;
      252     3407    2   DCL Y@ORGVRTCLM SBIN;
      253     3408
      254     3409    2      KV@VDH_OTPLCL = Y_VDH_OTPLCL;

   3409   1 00017E  AB80 0000 0000  00                   LAB,B2   Y_VDH_OTPLCL
          1 000181  2C00                                 LDV,R2   0
          1 000182  6C0A                                 LDV,R6   10
          1 000183  BB87                                 LAB,B3   ,AUTO
          1 000184  3C62                                 LDV,R3   98
          1 000185  0008                                 MMM

      255     3410    2      KV@VDH_OTPLCL.BFR_.BYTX = -1;

   3410   1 000186  8947 0034                            LBT,'FFFF'X       KV@VDH_OTPLCL+3,AUTO
   3410   1 000188       FFFF

      256     3411    2      KV@USR_PST = KV_USR_PST;

   3411   1 000189  AB80 0000 0000  xsym                 LAB,B2   KV_USR_PST
          1 00018C  2C00                                 LDV,R2   0
          1 00018D  6C08                                 LDV,R6   8
          1 00018E  BB87                                 LAB,B3   ,AUTO
          1 00018F  3C38                                 LDV,R3   56
          1 000190  0008                                 MMM

      257     3412    2      KV@USR_PST.PHSPSTMOD = %KV_PHSPSTMOD_VRTSCR;

   3412   1 000191  6C04                                 LDV,R6   4
          1 000192  E7C7 001F                            STH,R6   KV@USR_PST+3,AUTO

      258     3413    2      Y@BTMHOL = 0;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:97   
   3413   1 000194  8747 0038                            CL       Y@BTMHOL,AUTO

      259     3414    2      Y@ORGVRTCLM = %KV_MVD.VRTCLM;

   3414   1 000196  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000199  DCC6 0006                            LDB,B5   6,B6
          1 00019B  D845 001B                            LDR,R5   27,B5
          1 00019D  DF47 0039                            STR,R5   Y@ORGVRTCLM,AUTO

      260     3415    2      IF %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_BLN THEN CALL KVV$CALUSR_PST;

   3415   1 00019F  CC86                                 LDB,B4   ,B6
          1 0001A0  C844 001A                            LDR,R4   26,B4
          1 0001A2  4D02                                 CMV,R4   2
          1 0001A3  0981 0007                            BNE      s:3416,PREL

   3415   1 0001A5  CBF0 0000                            LAB,B4   0,IMO
          1 0001A7  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_PST
          1 0001AA       0001                            DC       s:3416,PREL

      261     3416    2      Y@VRTLIN = 0;

   3416   1 0001AB  8747 0014                            CL       Y@SRHHI,AUTO

      262     3417    2      Y@SRHCUR = %KV_RCRLST.FRSRCR;

   3417   1 0001AD  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 0001AF  E846 0004                            LDR,R6   4,B6
          1 0001B1  EF47 0016                            STR,R6   Y@SRHCUR,AUTO

      263     3418    2      KV@VDH_GETBFR = Y_VDH_GETBFR;

   3418   1 0001B3  AB80 0000 0000  00                   LAB,B2   Y_VDH_OTPLCL
          1 0001B6  2C0A                                 LDV,R2   10
          1 0001B7  6C16                                 LDV,R6   22
          1 0001B8  BB87                                 LAB,B3   ,AUTO
          1 0001B9  3C4C                                 LDV,R3   76
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:98   
          1 0001BA  0008                                 MMM

      264     3419    2      Y@REDLIN = -1;

   3419   1 0001BB  8947 0012                            LBT,'FFFF'X       Y@KEYCMP,AUTO
   3419   1 0001BD       FFFF

      265     3420    2      %KV_SRD.PAGEHALT = '0'B;

   3420   1 0001BE  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 0001C0  8846 000E                            LBF,'0020'X       14,B6
          1 0001C2       0020

      266     3421    2      %KV_SRD.WRPPAG = '0'B;

   3421   1 0001C3  8846 000E                            LBF,'0001'X       14,B6
   3421   1 0001C5       0001

      267     3422    2      %KV_SRD.FLDEND = %KV_SRD.BTMRHT;

   3422   1 0001C6  8CC6 000B                            LDI      11,B6
          1 0001C8  8D46 0010                            SDI      16,B6

      268     3423    2      %KV_SRD.HI_NONBLN = %KV_SRD.BTMRHT;

   3423   1 0001CA  8D46 0017                            SDI      23,B6

      269     3424    2      %KV_SRD.CRT.CLM = 0;

   3424   1 0001CC  8746 0016                            CL       22,B6

      270     3425    2      IF %KV_RCRLST.VRTSCRCNT~=0

   3425   1 0001CE  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 0001D0  D0C5 000A                            LDH,R5   10,B5
          1 0001D2  5901 003A                            BEZ,R5   s:3439,PREL

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:99   
      271     3426    2      THEN IF %KV_RCRLST.VRTSCRCNT<%KV_SRD.LNG

   3426   1 0001D4  C2C6 000E                            LLH,R4   14,B6
          1 0001D6  D954                                 CMR,R5   R4
          1 0001D7  0881 0030                            BAGE     s:3438,PREL
          1 0001D9  8254                                 NEG      R4
          1 0001DA  D954                                 CMR,R5   R4
          1 0001DB  0A81 002C                            BALE     s:3438,PREL

      272     3427    3        AND %KV_RCRLST.VRTSCRCNT>-%KV_SRD.LNG THEN DO;

      273     3428    3         KV@USR_PST.PHSPST = %KV_SRD.TOPLFT;

   3428   1 0001DD  8CC6 0009                            LDI      9,B6
          1 0001DF  8D47 001D                            SDI      KV@USR_PST+1,AUTO

      274     3429    3         KV@USR_PST.SCRCNT = %KV_RCRLST.VRTSCRCNT;

   3429   1 0001E1  D0C5 000A                            LDH,R5   10,B5
          1 0001E3  DAC7 001F                            SRM,R5,'00FF'X    KV@USR_PST+3,AUTO
          1 0001E5       00FF

      275     3430    3         IF KV@USR_PST.SCRCNT<0 THEN Y@BTMHOL = -KV@USR_PST.SCRCNT;

   3430   1 0001E6  D847 001F                            LDR,R5   KV@USR_PST+3,AUTO
          1 0001E8  5008                                 SOL,R5   8
          1 0001E9  5068                                 SAR,R5   8
          1 0001EA  5881 0006                            BGEZ,R5  s:3432,PREL

   3430   1 0001EC  8255                                 NEG      R5
          1 0001ED  DF47 0038                            STR,R5   Y@BTMHOL,AUTO
          1 0001EF  0F81 0007                            B        s:3435,PREL

      276     3431    4         ELSE DO;

      277     3432    4            %KV_RCRLST.PRTLSTRCR = '0'B;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:100  
   3432   1 0001F1  8845 000C                            LBF,'0010'X       12,B5
   3432   1 0001F3       0010

      278     3433    4            %KV_RCRLST.EOFDSP = '0'B;

   3433   1 0001F4  8845 000D                            LBF,'0010'X       13,B5
   3433   1 0001F6       0010

      279     3434    4         END;

      280     3435    3         CALL KVV$CALUSR (KV@USR_PST);

   3435   1 0001F7  CBC7 001C                            LAB,B4   KV@USR_PST,AUTO
          1 0001F9  CFC7 0056                            STB,B4   KV@SND_DAT+23,AUTO
          1 0001FB  BBC7 0056                            LAB,B3   KV@SND_DAT+23,AUTO
          1 0001FD  CBF0 0100                            LAB,B4   256,IMO
          1 0001FF  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          1 000202       0001                            DC       s:3436,PREL

      281     3436    3         KV@USR_PST.SCRCNT = 0;

   3436   1 000203  8847 001F                            LBF,'00FF'X       KV@USR_PST+3,AUTO
   3436   1 000205       00FF

      282     3437    3      END;

   3437   1 000206  0F81 0022                            B        s:3443,PREL

      283     3438    2      ELSE %KV_RCRLST.LSTRCR = -1;

   3438   1 000208  8945 0005                            LBT,'FFFF'X       5,B5
   3438   1 00020A       FFFF
          1 00020B  0F81 001D                            B        s:3443,PREL

      284     3439    2      ELSE IF NOT %KV_SRD.VRTSCR AND %KV_VDI.RE_DSPINP

   3439   1 00020D  82C6 001D                            LB,'4000'X        29,B6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:101  
   3439   1 00020F       4000
          1 000210  0501 0018                            BBT      s:3443,PREL
          1 000212  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 000215  AC84                                 LDB,B2   ,B4
          1 000216  82C2 0019                            LB,'0010'X        25,B2
          1 000218       0010
          1 000219  0581 000F                            BBF      s:3443,PREL

      285     3440    2      THEN IF %KV_MVD.FRMSCNINH THEN KV@USR_PST.PHSPST.LIN = -1;

   3440   1 00021B  9CC4 0006                            LDB,B1   6,B4
          1 00021D  82C1 0016                            LB,'0010'X        22,B1
          1 00021F       0010
          1 000220  0581 0006                            BBF      s:3441,PREL

   3440   1 000222  8947 001D                            LBT,'FFFF'X       KV@USR_PST+1,AUTO
   3440   1 000224       FFFF
          1 000225  0F81 0003                            B        s:3443,PREL

      286     3441    2      ELSE KV@USR_PST.PHSPST.LIN = 0;

   3441   1 000227  8747 001D                            CL       KV@USR_PST+1,AUTO

      287     3442        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:102  
      288     3443    2      IF %KV_RCRLST.RCRCNT~=0 THEN

   3443   1 000229  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 00022B  E846 0001                            LDR,R6   1,B6
          1 00022D  6901 0443                            BEZ,R6   s:3692,PREL

      289     3444    3   DSPLOP: DO WHILE '1'B;

   3444   1                              DSPLOP          null
      290     3445    3         Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);

   3445   1 00022F  ECC7 0006            DSPLOP          LDB,B6   Y@RCRLST$,AUTO
          1 000231  B847 0016                            LDR,R3   Y@SRHCUR,AUTO
          1 000233  3E08                                 ADV,R3   8
          1 000234  DCB6                                 LDB,B5   ,B6,R3
          1 000235  DFC7 000A                            STB,B5   Y@RCR$,AUTO

      291     3446    4         IF Y@SRHCUR=%KV_RCRLST.CRTRCR THEN DO;

   3446   1 000237  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 000239  E946 0006                            CMR,R6   6,B6
          1 00023B  0981 0013                            BNE      s:3454,PREL

      292     3447    4            Y@REDLIN = Y@VRTLIN;

   3447   1 00023D  D847 0014                            LDR,R5   Y@SRHHI,AUTO
          1 00023F  DF47 0012                            STR,R5   Y@KEYCMP,AUTO

      293     3448    4            IF Y@ORGVRTCLM>%KV_RCR.LINCNT*%KV_SRD.WDT+1

   3448   1 000241  CCC7 000C                            LDB,B4   Y@SRD$,AUTO
          1 000243  C0C5 0002                            LDH,R4   2,B5
          1 000245  CB44 000D                            MUL,R4   13,B4
          1 000247  4E01                                 ADV,R4   1
          1 000248  C947 0039                            CMR,R4   Y@ORGVRTCLM,AUTO
          1 00024A  0881 0004                            BAGE     s:3454,PREL

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:103  
      294     3449        /*
      295     3450           This one musta got extended by RE_REDCLM.  Make sure it gets displayed
      296     3451        */
      297     3452    4            THEN %KV_RCR.UPD = '1'B;

   3452   1 00024C  8945 0002                            LBT,'0040'X       2,B5
   3452   1 00024E       0040

      298     3453    4         END;

      299     3454    4         IF %KV_RCR.RCRBYTSIZ<0 OR %KV_RCR.LINCNT<0 THEN DO;

   3454   1 00024F  D845 0001                            LDR,R5   1,B5
          1 000251  5801 0005                            BLZ,R5   s:3458,PREL
          1 000253  C0C5 0002                            LDH,R4   2,B5
          1 000255  4881 010D                            BGEZ,R4  s:3528,PREL

      300     3455        /*
      301     3456           A (perhaps partially) deleted record. remove it from the screen.
      302     3457        */
      303     3458    4            IF %KV_RCR.LINCNT<0 AND %KV_RCR.RCRBYTSIZ<0

   3458   1 000257  C0C5 0002                            LDH,R4   2,B5
          1 000259  4881 0006                            BGEZ,R4  s:3460,PREL
          1 00025B  5881 0004                            BGEZ,R5  s:3460,PREL

      304     3459    4            THEN %KV_RCR.LINCNT = -%KV_RCR.LINCNT;

   3459   1 00025D  8254                                 NEG      R4
          1 00025E  C7C5 0002                            STH,R4   2,B5

      305     3460    4            Y@BFRSIZ = %KV_RCR.LINCNT;

   3460   1 000260  C0C5 0002                            LDH,R4   2,B5
          1 000262  CF47 0015                            STR,R4   Y@SRHLO,AUTO

      306     3461    5            IF Y@BFRSIZ<0 THEN DO;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:104  

   3461   1 000264  4881 0023                            BGEZ,R4  s:3470,PREL

      307     3462        /*
      308     3463           Compute how many blanklines follow the actual record text.
      309     3464        */
      310     3465    5               IF %KV_RCR.RCRBYTSIZ=0 AND %KV_RCR.NEW THEN %KV_RCR.LINCNT = 0;

   3465   1 000266  5981 000A                            BNEZ,R5  s:3466,PREL
          1 000268  82C5 0002                            LB,'0020'X        2,B5
          1 00026A       0020
          1 00026B  0581 0005                            BBF      s:3466,PREL

   3465   1 00026D  87C5 0002                            CLH      2,B5
          1 00026F  0F81 000F                            B        s:3468,PREL

      311     3466    5               ELSE %KV_RCR.LINCNT =

   3466   1 000271  CCC7 000C                            LDB,B4   Y@SRD$,AUTO
          1 000273  DA44 000D                            ADD,R5   13,B4
          1 000275  5EFF                                 ADV,R5   -1
          1 000276  D344 000D                            DIV,R5   13,B4
          1 000278  D970 0001                            CMR,R5   1,IMO
          1 00027A  0881 0002                            BAGE     s:3466+12,PREL
          1 00027C  5C01                                 LDV,R5   1
          1 00027D  D7C5 0002                            STH,R5   2,B5

      312     3467    5                 MAXIMUM ((%KV_RCR.RCRBYTSIZ+%KV_SRD.WDT-1)/%KV_SRD.WDT, 1);
      313     3468    5               Y@BFRSIZ = -%KV_RCR.LINCNT-Y@BFRSIZ;

   3468   1 00027F  D0C5 0002                            LDH,R5   2,B5
          1 000281  DA54                                 ADD,R5   R4
          1 000282  C855                                 LDR,R4   R5
          1 000283  8254                                 NEG      R4
          1 000284  CF47 0015                            STR,R4   Y@SRHLO,AUTO

      314     3469    5            END;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:105  

   3469   1 000286  0F81 0003                            B        s:3471,PREL

      315     3470    4            ELSE %KV_RCR.LINCNT = 0;       /* Gone ones no longer take space     */

   3470   1 000288  87C5 0002                            CLH      2,B5

      316     3471    5            IF NOT %KV_SRD.VRTSCR THEN DO;

   3471   1 00028A  CCC7 000C                            LDB,B4   Y@SRD$,AUTO
          1 00028C  82C4 001D                            LB,'4000'X        29,B4
          1 00028E       4000
          1 00028F  0501 000E                            BBT      s:3476+2,PREL

      317     3472    5               IF Y@BFRSIZ=0 THEN EXIT;    /* Nothing to do                      */

   3472   1 000291  4901 000A                            BEZ,R4   s:3476,PREL

      318     3473    5               %KV_RCRLST.EOFDSP = '0'B;

   3473   1 000293  8846 000D                            LBF,'0010'X       13,B6
   3473   1 000295       0010

      319     3474    5               %KV_RCRLST.LSTRCR = Y@SRHCUR-1;

   3474   1 000296  6EFF                                 ADV,R6   -1
          1 000297  EF46 0005                            STR,R6   5,B6

      320     3475    5               %KV_RCRLST.PRTLSTRCR = '0'B;

   3475   1 000299  8846 000C                            LBF,'0010'X       12,B6
   3475   1 00029B       0010

      321     3476    5            END; ELSE IF Y@SRHCUR<=%KV_RCRLST.LSTRCR THEN DO;

   3476   1 00029C  0F81 0053                            B        s:3497,PREL

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:106  
   3476   1 00029E  E946 0005                            CMR,R6   5,B6
          1 0002A0  0A01 004F                            BAG      s:3497,PREL

      322     3477    5               IF KV@USR_PST.SCRCNT>0 THEN KV@USR_PST.SCRCNT = 0;

   3477   1 0002A2  D847 001F                            LDR,R5   KV@USR_PST+3,AUTO
          1 0002A4  5008                                 SOL,R5   8
          1 0002A5  5068                                 SAR,R5   8
          1 0002A6  5A81 0004                            BLEZ,R5  s:3478,PREL

   3477   1 0002A8  8847 001F                            LBF,'00FF'X       KV@USR_PST+3,AUTO
   3477   1 0002AA       00FF

      323     3478    5               KV@USR_PST.SCRCNT = KV@USR_PST.SCRCNT-Y@BFRSIZ;

   3478   1 0002AB  D847 001F                            LDR,R5   KV@USR_PST+3,AUTO
          1 0002AD  5008                                 SOL,R5   8
          1 0002AE  5068                                 SAR,R5   8
          1 0002AF  D254                                 SUB,R5   R4
          1 0002B0  DAC7 001F                            SRM,R5,'00FF'X    KV@USR_PST+3,AUTO
          1 0002B2       00FF

      324     3479    5               Y@BTMHOL = Y@BTMHOL+Y@BFRSIZ;

   3479   1 0002B3  CA47 0038                            ADD,R4   Y@BTMHOL,AUTO
          1 0002B5  CF47 0038                            STR,R4   Y@BTMHOL,AUTO

      325     3480    5               KV@USR_PST.PHSPST.LIN = Y@VRTLIN+%KV_SRD.TOPLFT.LIN+%KV_RCR.LINCNT;

   3480   1 0002B7  D847 0014                            LDR,R5   Y@SRHHI,AUTO
          1 0002B9  DA44 0009                            ADD,R5   9,B4
          1 0002BB  A0C5 0002                            LDH,R2   2,B5
          1 0002BD  AA55                                 ADD,R2   R5
          1 0002BE  AF47 001D                            STR,R2   KV@USR_PST+1,AUTO

      326     3481    6               DO;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:107  
      327     3482    6                  IF Y@SRHCUR+1<%KV_RCRLST.RCRCNT

   3482   1 0002C0  6E01                                 ADV,R6   1
          1 0002C1  E946 0001                            CMR,R6   1,B6
          1 0002C3  0881 000B                            BAGE     s:3485,PREL

      328     3483    6                  THEN IF %KV_RCRLST.RCR$(Y@SRHCUR+1)->KV$RCR.RCRBYTSIZ<0

   3483   1 0002C5  9847 0016                            LDR,R1   Y@SRHCUR,AUTO
          1 0002C7  1E09                                 ADV,R1   9
          1 0002C8  BC96                                 LDB,B3   ,B6,R1
          1 0002C9  D843 0001                            LDR,R5   1,B3
          1 0002CB  5801 0024                            BLZ,R5   s:3497,PREL
          1 0002CD  0F81 0006                            B        s:3486,PREL

      329     3484    6                  THEN EXIT; ELSE;
      330     3485    6                  ELSE IF NOT %KV_RCRLST.EOFDSP THEN EXIT;

   3485   1 0002CF  82C6 000D                            LB,'0010'X        13,B6
   3485   1 0002D1       0010
          1 0002D2  0581 001D                            BBF      s:3497,PREL

      331     3486    6                  IF KV@USR_PST.SCRCNT=0 THEN EXIT;

   3486   1 0002D4  82C7 001F                            LB,'00FF'X        KV@USR_PST+3,AUTO
   3486   1 0002D6       00FF
          1 0002D7  0581 0018                            BBF      s:3497,PREL

      332     3487        /*
      333     3488           Just accumulate the whole size for a string of deleted ones.
      334     3489           If they're all gone, we'll just erase at the bottom.
      335     3490        */
      336     3491    6                  IF KV@USR_PST.PHSPST.LIN<%KV_SRD.BTMRHT.LIN

   3491   1 0002D9  A944 000B                            CMR,R2   11,B4
          1 0002DB  0881 000F                            BAGE     s:3493,PREL

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:108  
      337     3492    6                  THEN CALL KVV$CALUSR (KV@USR_PST);

   3492   1 0002DD  BBC7 001C                            LAB,B3   KV@USR_PST,AUTO
          1 0002DF  BFC7 0056                            STB,B3   KV@SND_DAT+23,AUTO
          1 0002E1  BBC7 0056                            LAB,B3   KV@SND_DAT+23,AUTO
          1 0002E3  CBF0 0100                            LAB,B4   256,IMO
          1 0002E5  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          1 0002E8       0001                            DC       s:3492+12,PREL
          1 0002E9  0F81 0003                            B        s:3494,PREL

      338     3493    6                  ELSE Y@BTMHOL = 0;

   3493   1 0002EB  8747 0038                            CL       Y@BTMHOL,AUTO

      339     3494    6                  KV@USR_PST.SCRCNT = 0;

   3494   1 0002ED  8847 001F                            LBF,'00FF'X       KV@USR_PST+3,AUTO
   3494   1 0002EF       00FF

      340     3495    6               END;

      341     3496    5            END;

      342     3497    4            IF %KV_RCR.RCRBYTSIZ>=0 THEN EXIT; /* only partially deleted         */

   3497   1 0002F0  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 0002F2  E846 0001                            LDR,R6   1,B6
          1 0002F4  6881 006E                            BGEZ,R6  s:3528,PREL

      343     3498    4            CALL Y$DLTRCRRLS;

   3498   1 0002F6  E3C0 1793                            LNJ,B6   s:0,PREL
          1 0002F8       0001                            DC       s:3499,PREL

      344     3499    4            IF Y@BFRSIZ~=0 THEN GOTO DSPLOP;

   3499   1 0002F9  E847 0015                            LDR,R6   Y@SRHLO,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:109  
          1 0002FB  6981 FF33                            BNEZ,R6  s:3444,PREL

      345     3500    5            IF KV@VDH_OTPLCL.BFR_.BYTX<0 OR %KV_SRD.VRTSCR THEN DO;

   3500   1 0002FD  D847 0034                            LDR,R5   KV@VDH_OTPLCL+3,AUTO
          1 0002FF  5801 0008                            BLZ,R5   s:3501,PREL
          1 000301  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 000303  82C6 001D                            LB,'4000'X        29,B6
          1 000305       4000
          1 000306  0581 004C                            BBF      s:3522,PREL

      346     3501    5               IF %KV_RCRLST.EOFDSP THEN EXIT DSPLOP;

   3501   1 000308  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 00030A  82C6 000D                            LB,'0010'X        13,B6
          1 00030C       0010
          1 00030D  0501 0363                            BBT      s:3692,PREL

   3501   1                              Y$ERS_THE_REST  null
      347     3502    5   Y$ERS_THE_REST:;
      348     3503    5               KV@VDH_OTPLCL.BFR_.BYTX = 0;

   3503   1 00030F  8747 0034            Y$ERS_THE_REST  CL       KV@VDH_OTPLCL+3,AUTO

      349     3504    5               %KV_SRD.CRTVRTLINPHSLIN = Y@VRTLIN+%KV_SRD.TOPLFT.LIN;

   3504   1 000311  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 000313  E847 0014                            LDR,R6   Y@SRHHI,AUTO
          1 000315  EA46 0009                            ADD,R6   9,B6
          1 000317  EF46 0013                            STR,R6   19,B6

      350     3505    5               IF %KV_SRD.CRT.LIN~=%KV_SRD.CRTVRTLINPHSLIN

   3505   1 000319  E946 0015                            CMR,R6   21,B6
          1 00031B  0981 0007                            BNE      s:3507,PREL
          1 00031D  D846 0016                            LDR,R5   22,B6
          1 00031F  D946 000A                            CMR,R5   10,B6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:110  
          1 000321  0901 000E                            BE       s:3511,PREL

      351     3506    6                 OR %KV_SRD.CRT.CLM~=%KV_SRD.TOPLFT.CLM THEN DO;

      352     3507    6                  %KV_SRD.CRT.LIN = %KV_SRD.CRTVRTLINPHSLIN;

   3507   1 000323  EF46 0015                            STR,R6   21,B6

      353     3508    6                  %KV_SRD.CRT.CLM = %KV_SRD.TOPLFT.CLM;

   3508   1 000325  D846 000A                            LDR,R5   10,B6
          1 000327  DF46 0016                            STR,R5   22,B6

      354     3509    6                  %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_SKP;

   3509   1 000329  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 00032C  CC85                                 LDB,B4   ,B5
          1 00032D  4C01                                 LDV,R4   1
          1 00032E  CF44 001A                            STR,R4   26,B4

      355     3510    6               END;

      356     3511    6               IF KV@USR_PST.PHSPST.LIN<=0 THEN DO;

   3511   1 000330  E847 001D                            LDR,R6   KV@USR_PST+1,AUTO
          1 000332  6A01 0016                            BGZ,R6   s:3518,PREL

      357     3512    6                  IF KV@USR_PST.PHSPST.LIN=0

   3512   1 000334  6981 000A                            BNEZ,R6  s:3514,PREL

      358     3513    6                  THEN CALL KVV$CALUSR_EVT (%KV_USR_EVT_ID_DLTOTP);

   3513   1 000336  BB80 0000 0001  02                   LAB,B3   +1
          1 000339  CBF0 0100                            LAB,B4   256,IMO
          1 00033B  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_EVT
          1 00033E       0001                            DC       s:3514,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:111  

      359     3514    6                  %KV_SRD.UNKPST = '0'B;

   3514   1 00033F  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 000341  8846 001C                            LBF,'4000'X       28,B6
          1 000343       4000

      360     3515    6                  KV@USR_PST.PHSPST.LIN = -1;

   3515   1 000344  8947 001D                            LBT,'FFFF'X       KV@USR_PST+1,AUTO
   3515   1 000346       FFFF

      361     3516    6               END;

   3516   1 000347  0F81 000B                            B        s:3522,PREL

      362     3517    6               ELSE DO;

      363     3518    6                  %KV_SRD.HI_NONBLN = %KV_SRD.BTMRHT;

   3518   1 000349  8CC6 000B                            LDI      11,B6
          1 00034B  8D46 0017                            SDI      23,B6

      364     3519    6                  CALL KVO$ERSTO_ENDOF_SRD;

   3519   1 00034D  CBF0 0000                            LAB,B4   0,IMO
          1 00034F  E380 0000 0000  xent                 LNJ,B6   KVO$ERSTO_ENDOF_SRD
          1 000352       0001                            DC       s:3522,PREL

      365     3520    6               END;

      366     3521    5            END;

      367     3522    4            IF NOT %KV_RCRLST.EOF THEN EXIT DSPLOP;

   3522   1 000353  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 000355  82C6 000C                            LB,'0040'X        12,B6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:112  
          1 000357       0040
          1 000358  0581 0318                            BBF      s:3692,PREL

      368     3523    4            Y@SRHCUR = Y@SRHCUR-1;

   3523   1 00035A  88C7 0016                            DEC      Y@SRHCUR,AUTO

      369     3524    4            Y@RCR$ = PINCRW(ADDR(Y_LTLKEY),-1);

   3524   1 00035C  DB80 0000 000F  00                   LAB,B5   Y_VDH_GETBFR+10
          1 00035F  DFC7 000A                            STB,B5   Y@RCR$,AUTO

      370     3525    4            GOTO NXTLIN;                   /* Put out the EOF marker if needed   */

   3525   1 000361  0F81 0278                            B        s:3658,PREL

      371     3526    4         END;
      372     3527        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:113  
      373     3528    3         IF %KV_RCR.UPD OR Y@SRHCUR>%KV_RCRLST.LSTRCR

   3528   1 000363  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 000365  82C6 0002                            LB,'0040'X        2,B6
          1 000367       0040
          1 000368  0501 0029                            BBT      s:3532,PREL
          1 00036A  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 00036C  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 00036E  E945 0005                            CMR,R6   5,B5
          1 000370  0A01 0021                            BAG      s:3532,PREL
          1 000372  D0C5 000A                            LDH,R5   10,B5
          1 000374  D947 0014                            CMR,R5   Y@SRHHI,AUTO
          1 000376  0A01 001B                            BAG      s:3532,PREL
          1 000378  E945 0005                            CMR,R6   5,B5
          1 00037A  0981 000A                            BNE      s:3528+34,PREL
          1 00037C  82C5 000C                            LB,'0010'X        12,B5
          1 00037E       0010
          1 00037F  0581 0005                            BBF      s:3528+34,PREL
          1 000381  C847 0038                            LDR,R4   Y@BTMHOL,AUTO
          1 000383  4A01 000E                            BGZ,R4   s:3532,PREL
          1 000385  C0C6 0002                            LDH,R4   2,B6
          1 000387  CA47 0014                            ADD,R4   Y@SRHHI,AUTO
          1 000389  CCC7 000C                            LDB,B4   Y@SRD$,AUTO
          1 00038B  B2C4 000E                            LLH,R3   14,B4
          1 00038D  B247 0038                            SUB,R3   Y@BTMHOL,AUTO
          1 00038F  C953                                 CMR,R4   R3
          1 000390  0A81 0249                            BALE     s:3658,PREL

      374     3529    3           OR Y@VRTLIN<%KV_RCRLST.VRTSCRCNT
      375     3530    3           OR Y@SRHCUR=%KV_RCRLST.LSTRCR AND %KV_RCRLST.PRTLSTRCR AND Y@BTMHOL>0
      376     3531    4           OR Y@VRTLIN+%KV_RCR.LINCNT>%KV_SRD.LNG-Y@BTMHOL THEN DO;

      377     3532    4            IF %KV_RCR.NEW THEN IF %KV_RCRLST.CRTRCR~=Y@SRHCUR THEN EXIT;

   3532   1 000392  82C6 0002                            LB,'0020'X        2,B6
   3532   1 000394       0020
          1 000395  0581 0009                            BBF      s:3535,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:114  

   3532   1 000397  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 000399  E845 0006                            LDR,R6   6,B5
          1 00039B  E947 0016                            CMR,R6   Y@SRHCUR,AUTO
          1 00039D  0981 023C                            BNE      s:3658,PREL

      378     3533        /* Don't display the "EOF" record unless we're on it,
      379     3534           so that the EOF marker doesn't show the phantom record */
      380     3535    5            IF KV@USR_PST.PHSPST.LIN<=0 AND %KV_RCR.DSP THEN DO;

   3535   1 00039F  E847 001D                            LDR,R6   KV@USR_PST+1,AUTO
          1 0003A1  6A01 001B                            BGZ,R6   s:3542,PREL
          1 0003A3  82C6 0002                            LB,'0010'X        2,B6
          1 0003A5       0010
          1 0003A6  0581 0016                            BBF      s:3542,PREL

      381     3536    5               IF KV@USR_PST.PHSPST.LIN=0

   3536   1 0003A8  6981 000A                            BNEZ,R6  s:3538,PREL

      382     3537    5               THEN CALL KVV$CALUSR_EVT (%KV_USR_EVT_ID_DLTOTP);

   3537   1 0003AA  BB80 0000 0001  02                   LAB,B3   +1
          1 0003AD  CBF0 0100                            LAB,B4   256,IMO
          1 0003AF  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_EVT
          1 0003B2       0001                            DC       s:3538,PREL

      383     3538    5               %KV_SRD.UNKPST = '0'B;

   3538   1 0003B3  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 0003B5  8846 001C                            LBF,'4000'X       28,B6
          1 0003B7       4000

      384     3539    5               KV@USR_PST.PHSPST.LIN= -1;

   3539   1 0003B8  8947 001D                            LBT,'FFFF'X       KV@USR_PST+1,AUTO
   3539   1 0003BA       FFFF
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:115  

      385     3540    5               GOTO NXTLIN;

   3540   1 0003BB  0F81 021E                            B        s:3658,PREL

      386     3541    5            END;
      387     3542    4            %KV_RCR.DSP = '1'B;

   3542   1 0003BD  8946 0002                            LBT,'0010'X       2,B6
   3542   1 0003BF       0010

      388     3543    4            KV@VDH_OTPLCL.BFR_.ADR$ = ADDR(%KV_RCR);

   3543   1 0003C0  EFC7 0032                            STB,B6   KV@VDH_OTPLCL+1,AUTO

      389     3544    4            KV@VDH_OTPLCL.BFR_.BYTSIZ = %KV_RCR.RCRBYTSIZ-%KV_RCRLST.HRZSCROFS;

   3544   1 0003C2  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 0003C4  E846 0001                            LDR,R6   1,B6
          1 0003C6  E245 0003                            SUB,R6   3,B5
          1 0003C8  EF47 0035                            STR,R6   KV@VDH_OTPLCL+4,AUTO

      390     3545    4            %KV_MVD.VRTCLM = 1;

   3545   1 0003CA  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 0003CD  BCC4 0006                            LDB,B3   6,B4
          1 0003CF  5C01                                 LDV,R5   1
          1 0003D0  DF43 001B                            STR,R5   27,B3

      391     3546    4            %KV_SRD.CRTVRTLINPHSLIN = Y@VRTLIN+%KV_SRD.TOPLFT.LIN;

   3546   1 0003D2  BCC7 000C                            LDB,B3   Y@SRD$,AUTO
          1 0003D4  E847 0014                            LDR,R6   Y@SRHHI,AUTO
          1 0003D6  EA43 0009                            ADD,R6   9,B3
          1 0003D8  EF43 0013                            STR,R6   19,B3

      392     3547    4            %KV_SRD.VRTPSTOK = '1'B;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:116  

   3547   1 0003DA  8943 000E                            LBT,'0010'X       14,B3
   3547   1 0003DC       0010

      393     3548    5            IF %KV_SRD.VRTSCR AND %KV_RCRLST.FRSRCR<=%KV_RCRLST.LSTRCR THEN DO;

   3548   1 0003DD  82C3 001D                            LB,'4000'X        29,B3
   3548   1 0003DF       4000
          1 0003E0  0581 008D                            BBF      s:3584,PREL
          1 0003E2  C845 0004                            LDR,R4   4,B5
          1 0003E4  C945 0005                            CMR,R4   5,B5
          1 0003E6  0A01 0087                            BAG      s:3584,PREL

      394     3549    5               %KV_SRD.FLDEND.LIN = %KV_SRD.CRTVRTLINPHSLIN+%KV_RCR.LINCNT-1;

   3549   1 0003E8  B0C6 0002                            LDH,R3   2,B6
          1 0003EA  BA56                                 ADD,R3   R6
          1 0003EB  3EFF                                 ADV,R3   -1
          1 0003EC  BF43 0010                            STR,R3   16,B3

      395     3550    5               %KV_SRD.HI_NONBLN.LIN = %KV_SRD.BTMRHT.LIN-Y@BTMHOL;

   3550   1 0003EE  C843 000B                            LDR,R4   11,B3
          1 0003F0  C247 0038                            SUB,R4   Y@BTMHOL,AUTO
          1 0003F2  CF43 0017                            STR,R4   23,B3

      396     3551    5               %KV_SRD.HI_NONBLN.CLM = %KV_SRD.BTMRHT.CLM;

   3551   1 0003F4  A843 000C                            LDR,R2   12,B3
          1 0003F6  AF43 0018                            STR,R2   24,B3

      397     3552    6               IF %KV_SRD.FLDEND.LIN>=%KV_SRD.HI_NONBLN.LIN THEN DO;

   3552   1 0003F8  B954                                 CMR,R3   R4
          1 0003F9  0801 000A                            BAL      s:3556,PREL

      398     3553    6                  %KV_SRD.FLDEND.LIN = %KV_SRD.BTMRHT.LIN;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:117  

   3553   1 0003FB  B843 000B                            LDR,R3   11,B3
          1 0003FD  BF43 0010                            STR,R3   16,B3

      399     3554    6                  %KV_RCRLST.PRTLSTRCR = '0'B;

   3554   1 0003FF  8845 000C                            LBF,'0010'X       12,B5
   3554   1 000401       0010

      400     3555    6               END;

   3555   1 000402  0F81 0004                            B        s:3557,PREL

      401     3556    5               ELSE %KV_SRD.HI_NONBLN.LIN = %KV_SRD.FLDEND.LIN;

   3556   1 000404  C853                                 LDR,R4   R3
          1 000405  CF43 0017                            STR,R4   23,B3

      402     3557    5               IF Y@VRTLIN<%KV_RCRLST.VRTSCRCNT

   3557   1 000407  E0C5 000A                            LDH,R6   10,B5
          1 000409  E947 0014                            CMR,R6   Y@SRHHI,AUTO
          1 00040B  0A81 0006                            BALE     s:3559,PREL

      403     3558    5               THEN %KV_SRD.HI_NONBLN.LIN = %KV_SRD.CRTVRTLINPHSLIN-1;

   3558   1 00040D  C843 0013                            LDR,R4   19,B3
          1 00040F  4EFF                                 ADV,R4   -1
          1 000410  CF43 0017                            STR,R4   23,B3

      404     3559    6               IF %KV_RCR.LINCNT=0 THEN DO;

   3559   1 000412  E0C6 0002                            LDH,R6   2,B6
          1 000414  6981 0059                            BNEZ,R6  s:3584,PREL

      405     3560        /*
      406     3561           A new record, make room for it.
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:118  
      407     3562        */
      408     3563    6                  KV@USR_PST.PHSPST.LIN = %KV_SRD.CRTVRTLINPHSLIN;

   3563   1 000416  C843 0013                            LDR,R4   19,B3
          1 000418  CF47 001D                            STR,R4   KV@USR_PST+1,AUTO

      409     3564    6                  Y@SRHLO = %KV_SRD.BTMRHT.LIN-%KV_SRD.CRTVRTLINPHSLIN;

   3564   1 00041A  E843 000B                            LDR,R6   11,B3
          1 00041C  E243 0013                            SUB,R6   19,B3
          1 00041E  EF47 0015                            STR,R6   Y@SRHLO,AUTO

      410     3565    6                  IF Y@SRHCUR<%KV_RCRLST.LSTRCR

   3565   1 000420  B847 0016                            LDR,R3   Y@SRHCUR,AUTO
          1 000422  B945 0005                            CMR,R3   5,B5
          1 000424  0881 0012                            BAGE     s:3568,PREL

      411     3566    6                  THEN Y@SRHLO = MINIMUM (Y@SRHLO,

   3566   1 000426  A846 0001                            LDR,R2   1,B6
          1 000428  2EFF                                 ADV,R2   -1
          1 000429  A343 000D                            DIV,R2   13,B3
          1 00042B  A970 0000                            CMR,R2   0,IMO
          1 00042D  0881 0002                            BAGE     s:3566+10,PREL
          1 00042F  2C00                                 LDV,R2   0
          1 000430  A956                                 CMR,R2   R6
          1 000431  0A81 0002                            BALE     s:3566+14,PREL
          1 000433  A856                                 LDR,R2   R6
          1 000434  E852                                 LDR,R6   R2
          1 000435  EF47 0015                            STR,R6   Y@SRHLO,AUTO

      412     3567    6                    MAXIMUM ((%KV_RCR.RCRBYTSIZ-1)/%KV_SRD.WDT, 0));
      413     3568    6                  %KV_SRD.FLDEND.LIN = KV@USR_PST.PHSPST.LIN+Y@SRHLO;

   3568   1 000437  CA56                                 ADD,R4   R6
          1 000438  CF43 0010                            STR,R4   16,B3
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:119  

      414     3569    6                  Y@SRHLO = Y@SRHLO+1;

   3569   1 00043A  8AC7 0015                            INC      Y@SRHLO,AUTO

      415     3570    6                  %KV_RCR.LINCNT = Y@SRHLO;

   3570   1 00043C  E847 0015                            LDR,R6   Y@SRHLO,AUTO
          1 00043E  E7C6 0002                            STH,R6   2,B6

      416     3571    7                  IF Y@SRHLO>Y@BTMHOL THEN DO;

   3571   1 000440  E947 0038                            CMR,R6   Y@BTMHOL,AUTO
          1 000442  0A81 000B                            BALE     s:3576,PREL

      417     3572    7                     Y@BTMHOL = 0;

   3572   1 000444  8747 0038                            CL       Y@BTMHOL,AUTO

      418     3573    7                     %KV_RCRLST.PRTLSTRCR = '0'B;

   3573   1 000446  8845 000C                            LBF,'0010'X       12,B5
   3573   1 000448       0010

      419     3574    7                     %KV_RCRLST.EOFDSP = '0'B;

   3574   1 000449  8845 000D                            LBF,'0010'X       13,B5
   3574   1 00044B       0010

      420     3575    7                  END;

   3575   1 00044C  0F81 0006                            B        s:3577,PREL

      421     3576    6                  ELSE Y@BTMHOL = Y@BTMHOL-Y@SRHLO;

   3576   1 00044E  E247 0038                            SUB,R6   Y@BTMHOL,AUTO
          1 000450  8256                                 NEG      R6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:120  
          1 000451  EF47 0038                            STR,R6   Y@BTMHOL,AUTO

      422     3577    7                  IF %KV_SRD.FLDEND.LIN<%KV_SRD.BTMRHT.LIN THEN DO;

   3577   1 000453  E843 0010                            LDR,R6   16,B3
          1 000455  E943 000B                            CMR,R6   11,B3
          1 000457  0881 0014                            BAGE     s:3581,PREL

      423     3578    7                     KV@USR_PST.SCRCNT = Y@SRHLO;

   3578   1 000459  C847 0015                            LDR,R4   Y@SRHLO,AUTO
          1 00045B  CAC7 001F                            SRM,R4,'00FF'X    KV@USR_PST+3,AUTO
          1 00045D       00FF

      424     3579    7                     CALL KVV$CALUSR (KV@USR_PST);

   3579   1 00045E  ABC7 001C                            LAB,B2   KV@USR_PST,AUTO
          1 000460  AFC7 0056                            STB,B2   KV@SND_DAT+23,AUTO
          1 000462  BBC7 0056                            LAB,B3   KV@SND_DAT+23,AUTO
          1 000464  CBF0 0100                            LAB,B4   256,IMO
          1 000466  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          1 000469       0001                            DC       s:3580,PREL

      425     3580    7                  END;

   3580   1 00046A  0F81 0003                            B        s:3584,PREL

      426     3581    6                  ELSE %KV_SRD.HI_NONBLN.LIN = %KV_SRD.FLDEND.LIN;

   3581   1 00046C  EF43 0017                            STR,R6   23,B3

      427     3582    6               END;

      428     3583    5            END;

      429     3584    4            IF %KV_SRD.CRT.LIN~=%KV_SRD.CRTVRTLINPHSLIN

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:121  
   3584   1 00046E  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 000470  E846 0015                            LDR,R6   21,B6
          1 000472  E946 0013                            CMR,R6   19,B6
          1 000474  0981 0007                            BNE      s:3586,PREL
          1 000476  D846 0016                            LDR,R5   22,B6
          1 000478  D946 000A                            CMR,R5   10,B6
          1 00047A  0901 0016                            BE       s:3591,PREL

      430     3585    5              OR %KV_SRD.CRT.CLM~=%KV_SRD.TOPLFT.CLM THEN DO;

      431     3586    5               %KV_SRD.CRT.LIN = %KV_SRD.CRTVRTLINPHSLIN;

   3586   1 00047C  E846 0013                            LDR,R6   19,B6
          1 00047E  EF46 0015                            STR,R6   21,B6

      432     3587    5               %KV_SRD.CRT.CLM = %KV_SRD.TOPLFT.CLM;

   3587   1 000480  D846 000A                            LDR,R5   10,B6
          1 000482  DF46 0016                            STR,R5   22,B6

      433     3588    5               %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_SKP;

   3588   1 000484  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000487  CC85                                 LDB,B4   ,B5
          1 000488  4C01                                 LDV,R4   1
          1 000489  CF44 001A                            STR,R4   26,B4

      434     3589    5               CALL KVV$CALUSR_PST;

   3589   1 00048B  CBF0 0000                            LAB,B4   0,IMO
          1 00048D  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_PST
          1 000490       0001                            DC       s:3591,PREL

      435     3590    5            END;

      436     3591    4            IF KV@VDH_OTPLCL.BFR_.BYTX<0 AND %KV_RCRLST.LSTRCR>-2

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:122  
   3591   1 000491  E847 0034                            LDR,R6   KV@VDH_OTPLCL+3,AUTO
          1 000493  6881 0036                            BGEZ,R6  s:3609,PREL
          1 000495  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 000497  D846 0005                            LDR,R5   5,B6
          1 000499  5DFE                                 CMV,R5   -2
          1 00049A  0A81 002F                            BALE     s:3609,PREL
          1 00049C  D946 0004                            CMR,R5   4,B6
          1 00049E  0801 001B                            BAL      s:3604,PREL
          1 0004A0  DCC7 000C                            LDB,B5   Y@SRD$,AUTO
          1 0004A2  82C5 001D                            LB,'4000'X        29,B5
          1 0004A4       4000
          1 0004A5  0501 0024                            BBT      s:3609,PREL
          1 0004A7  CCC7 000A                            LDB,B4   Y@RCR$,AUTO
          1 0004A9  82C4 0002                            LB,'0020'X        2,B4
          1 0004AB       0020
          1 0004AC  0581 000D                            BBF      s:3604,PREL
          1 0004AE  C847 0016                            LDR,R4   Y@SRHCUR,AUTO
          1 0004B0  4E01                                 ADV,R4   1
          1 0004B1  C946 0001                            CMR,R4   1,B6
          1 0004B3  0801 0006                            BAL      s:3604,PREL
          1 0004B5  82C6 000D                            LB,'0010'X        13,B6
          1 0004B7       0010
          1 0004B8  0581 0011                            BBF      s:3609,PREL

      437     3592        /* Erase the rest: if this is the first update on a non-blank screen ... */
      438     3593    4              AND (%KV_RCRLST.FRSRCR>%KV_RCRLST.LSTRCR
      439     3594        /* and either a) e.g. the window changed, making a repaint needed, ... */
      440     3595    4              OR NOT %KV_SRD.VRTSCR
      441     3596        /* or b) we can't shift lines around so the rest always needs repainintg ... */
      442     3597    4              AND (NOT %KV_RCR.NEW
      443     3598        /* unless it's a new record ... */
      444     3599    4              OR Y@SRHCUR+1<%KV_RCRLST.RCRCNT
      445     3600        /* at the bottom of the screen (the "eof" record) ... */
      446     3601    4              OR %KV_RCRLST.EOFDSP))
      447     3602        /* with no EOF marker to display. */
      448     3603    5            THEN DO;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:123  
      449     3604    5               CALL KVO$ERSTO_ENDOF_SRD;

   3604   1 0004BA  CBF0 0000                            LAB,B4   0,IMO
          1 0004BC  E380 0000 0000  xent                 LNJ,B6   KVO$ERSTO_ENDOF_SRD
          1 0004BF       0001                            DC       s:3605,PREL

      450     3605    5               %KV_RCRLST.LSTRCR = 0;

   3605   1 0004C0  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 0004C2  8746 0005                            CL       5,B6

      451     3606    5               %KV_RCRLST.PRTLSTRCR = '0'B;

   3606   1 0004C4  8846 000C                            LBF,'0010'X       12,B6
   3606   1 0004C6       0010

      452     3607    5               %KV_RCRLST.EOFDSP = '0'B;

   3607   1 0004C7  8846 000D                            LBF,'0010'X       13,B6
   3607   1 0004C9       0010

      453     3608    5            END;

      454     3609    4            KV@VDH_OTPLCL.BFR_.BYTX =

   3609   1 0004CA  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 0004CC  E847 0013                            LDR,R6   Y@KEYLNG,AUTO
          1 0004CE  EA46 0003                            ADD,R6   3,B6
          1 0004D0  6E06                                 ADV,R6   6
          1 0004D1  EF47 0034                            STR,R6   KV@VDH_OTPLCL+3,AUTO

      455     3610    4              Y@KEYLNG+LENGTHV(KV$RCR)+%KV_RCRLST.HRZSCROFS;
      456     3611    4            IF Y@SRHCUR=%KV_RCRLST.CRTRCR AND %KV_SSN.REDSTRID=%KV_STR.ID

   3611   1 0004D3  D847 0016                            LDR,R5   Y@SRHCUR,AUTO
          1 0004D5  D946 0006                            CMR,R5   6,B6
          1 0004D7  0981 001E                            BNE      s:3618,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:124  
          1 0004D9  DCC7 000E                            LDB,B5   Y@SSN$,AUTO
          1 0004DB  C2C5 0038                            LLH,R4   56,B5
          1 0004DD  CCC7 0010                            LDB,B4   Y@STR$,AUTO
          1 0004DF  B2C4 001C                            LLH,R3   28,B4
          1 0004E1  C953                                 CMR,R4   R3
          1 0004E2  0981 0013                            BNE      s:3618,PREL
          1 0004E4  8DC5 0030                            CMN      48,B5
          1 0004E6  0901 000F                            BE       s:3618,PREL

      457     3612    5              AND %KV_SSN.REDBFR__.ADR$~=ADDR(NIL) THEN DO;

      458     3613    5               KV@VDH_OTPLCL.BFR_.ADR$ = %KV_SSN.REDBFR__.ADR$;

   3613   1 0004E8  BCC5 0030                            LDB,B3   48,B5
          1 0004EA  BFC7 0032                            STB,B3   KV@VDH_OTPLCL+1,AUTO

      459     3614    5               KV@VDH_OTPLCL.BFR_.BYTX = %KV_SSN.REDBFR.DSPLOWX;

   3614   1 0004EC  E845 002F                            LDR,R6   47,B5
          1 0004EE  EF47 0034                            STR,R6   KV@VDH_OTPLCL+3,AUTO

      460     3615    5               KV@VDH_OTPLCL.BFR_.BYTSIZ =

   3615   1 0004F0  B845 0033                            LDR,R3   51,B5
          1 0004F2  B245 002F                            SUB,R3   47,B5
          1 0004F4  BF47 0035                            STR,R3   KV@VDH_OTPLCL+4,AUTO

      461     3616    5                 %KV_SSN.REDBFR__.DATBYTSIZ-%KV_SSN.REDBFR.DSPLOWX;
      462     3617    5            END;

      463     3618    4            Y@SRHLO = KV@VDH_OTPLCL.BFR_.BYTSIZ;

   3618   1 0004F6  C847 0035                            LDR,R4   KV@VDH_OTPLCL+4,AUTO
          1 0004F8  CF47 0015                            STR,R4   Y@SRHLO,AUTO

      464     3619    4   OTPLCL:  IF Y@SRHLO>0 THEN CALL KVO$OTPLCL (KV@VDH_OTPLCL);

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:125  
   3619   1 0004FA  E847 0015            OTPLCL          LDR,R6   Y@SRHLO,AUTO
          1 0004FC  6A81 000D                            BLEZ,R6  s:3620,PREL

   3619   1 0004FE  EBC7 0031                            LAB,B6   KV@VDH_OTPLCL,AUTO
          1 000500  EFC7 0056                            STB,B6   KV@SND_DAT+23,AUTO
          1 000502  BBC7 0056                            LAB,B3   KV@SND_DAT+23,AUTO
          1 000504  CBF0 0100                            LAB,B4   256,IMO
          1 000506  E380 0000 0000  xent                 LNJ,B6   KVO$OTPLCL
          1 000509       0001                            DC       s:3620,PREL

      465     3620    4            IF %KV_SRD.CRT_PST<=%KV_SRD.HI_NONBLN_PST

   3620   1 00050A  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 00050C  8CC6 0015                            LDI      21,B6
          1 00050E  84C6 0017                            SID      23,B6
          1 000510  6A01 000B                            BGZ,R6   s:3622,PREL
          1 000512  6801 0003                            BLZ,R6   s:3621,PREL
          1 000514  7981 0007                            BNEZ,R7  s:3622,PREL

      466     3621    4            THEN CALL KVO$ERSTO_ENDOF_INP;

   3621   1 000516  CBF0 0000                            LAB,B4   0,IMO
          1 000518  E380 0000 0000  xent                 LNJ,B6   KVO$ERSTO_ENDOF_INP
          1 00051B       0001                            DC       s:3622,PREL

      467     3622    4            IF KV@VDH_OTPLCL.BFR_.BYTSIZ~=Y@SRHLO AND NOT %KV_MVD.HRZSCR

   3622   1 00051C  E847 0035                            LDR,R6   KV@VDH_OTPLCL+4,AUTO
          1 00051E  6801 0005                            BLZ,R6   s:3622+8,PREL
          1 000520  E947 0015                            CMR,R6   Y@SRHLO,AUTO
          1 000522  0901 006B                            BE       s:3645,PREL
          1 000524  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000527  DCC6 0006                            LDB,B5   6,B6
          1 000529  82C5 0016                            LB,'0004'X        22,B5
          1 00052B       0004
          1 00052C  0501 0061                            BBT      s:3645,PREL

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:126  
      468     3623        /*
      469     3624           The record would have wrapped if that were allowed. Note that it
      470     3625           can't be editted without scrolling it fully onto the screen.
      471     3626        */
      472     3627    5            THEN IF %KV_SRD.FLDEND.LIN<%KV_SRD.BTMRHT.LIN THEN DO;

   3627   1 00052E  CCC7 000C                            LDB,B4   Y@SRD$,AUTO
          1 000530  D844 0010                            LDR,R5   16,B4
          1 000532  D944 000B                            CMR,R5   11,B4
          1 000534  0881 0049                            BAGE     s:3640,PREL

      473     3628    5               Y@SRHLO = MINIMUM((KV@VDH_OTPLCL.BFR_.BYTSIZ-1)/%KV_SRD.WDT+1,

   3628   1 000536  D244 000B                            SUB,R5   11,B4
          1 000538  F856                                 LDR,R7   R6
          1 000539  6C00                                 LDV,R6   0
          1 00053A  8470 FFFF FFFF                       AID      -1,IMO
          1 00053D  F344 000D                            DIV,R7   13,B4
          1 00053F  E857                                 LDR,R6   R7
          1 000540  6E01                                 ADV,R6   1
          1 000541  DF47 0056                            STR,R5   KV@SND_DAT+23,AUTO
          1 000543  8255                                 NEG      R5
          1 000544  D956                                 CMR,R5   R6
          1 000545  0881 0004                            BAGE     s:3628+20,PREL
          1 000547  E847 0056                            LDR,R6   KV@SND_DAT+23,AUTO
          1 000549  8256                                 NEG      R6
          1 00054A  EF47 0015                            STR,R6   Y@SRHLO,AUTO

      474     3629    5                 %KV_SRD.BTMRHT.LIN-%KV_SRD.FLDEND.LIN);
      475     3630    5               KV@USR_PST.PHSPST.LIN = %KV_SRD.FLDEND.LIN+1;

   3630   1 00054C  D844 0010                            LDR,R5   16,B4
          1 00054E  5E01                                 ADV,R5   1
          1 00054F  DF47 001D                            STR,R5   KV@USR_PST+1,AUTO

      476     3631    5               KV@USR_PST.SCRCNT = Y@SRHLO;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:127  
   3631   1 000551  EAC7 001F                            SRM,R6,'00FF'X    KV@USR_PST+3,AUTO
   3631   1 000553       00FF

      477     3632    5               %KV_SRD.FLDEND.LIN = %KV_SRD.FLDEND.LIN+Y@SRHLO;

   3632   1 000554  EA44 0010                            ADD,R6   16,B4
          1 000556  EF44 0010                            STR,R6   16,B4

      478     3633    5               %KV_RCR.LINCNT = %KV_RCR.LINCNT+Y@SRHLO;

   3633   1 000558  DCC7 000A                            LDB,B5   Y@RCR$,AUTO
          1 00055A  D0C5 0002                            LDH,R5   2,B5
          1 00055C  DA47 0015                            ADD,R5   Y@SRHLO,AUTO
          1 00055E  D7C5 0002                            STH,R5   2,B5

      479     3634    5               IF %KV_SRD.FLDEND.LIN<%KV_SRD.BTMRHT.LIN

   3634   1 000560  E844 0010                            LDR,R6   16,B4
          1 000562  E944 000B                            CMR,R6   11,B4
          1 000564  0881 000F                            BAGE     s:3636,PREL

      480     3635    5               THEN CALL KVV$CALUSR (KV@USR_PST);

   3635   1 000566  BBC7 001C                            LAB,B3   KV@USR_PST,AUTO
          1 000568  BFC7 0056                            STB,B3   KV@SND_DAT+23,AUTO
          1 00056A  BBC7 0056                            LAB,B3   KV@SND_DAT+23,AUTO
          1 00056C  CBF0 0100                            LAB,B4   256,IMO
          1 00056E  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          1 000571       0001                            DC       s:3635+12,PREL
          1 000572  0F81 0005                            B        s:3637,PREL

      481     3636    5               ELSE %KV_SRD.HI_NONBLN = %KV_SRD.FLDEND;

   3636   1 000574  8CC4 0010                            LDI      16,B4
          1 000576  8D44 0017                            SDI      23,B4

      482     3637    5               Y@SRHLO = KV@VDH_OTPLCL.BFR_.BYTSIZ;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:128  

   3637   1 000578  E847 0035                            LDR,R6   KV@VDH_OTPLCL+4,AUTO
          1 00057A  EF47 0015                            STR,R6   Y@SRHLO,AUTO

      483     3638    5               GOTO OTPLCL;

   3638   1 00057C  0F81 FF7D                            B        s:3619,PREL

      484     3639    5            END;
      485     3640    5            ELSE IF Y@SRHLO>0 THEN DO;

   3640   1 00057E  C847 0015                            LDR,R4   Y@SRHLO,AUTO
          1 000580  4A81 000D                            BLEZ,R4  s:3645,PREL

      486     3641    5               %KV_RCR.DSP = '0'B;

   3641   1 000582  BCC7 000A                            LDB,B3   Y@RCR$,AUTO
          1 000584  8843 0002                            LBF,'0010'X       2,B3
          1 000586       0010

      487     3642    5               %KV_RCRLST.PRTLSTRCR = '1'B;

   3642   1 000587  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 000589  8945 000C                            LBT,'0010'X       12,B5
          1 00058B       0010

      488     3643    5               %KV_RCRLST.LSTRCR = 0;

   3643   1 00058C  8745 0005                            CL       5,B5

      489     3644    5            END;

      490     3645    4            IF %KV_SRD.CRT.CLM=%KV_SRD.TOPLFT.CLM

   3645   1 00058E  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 000590  E846 0016                            LDR,R6   22,B6
          1 000592  E946 000A                            CMR,R6   10,B6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:129  
          1 000594  0981 0009                            BNE      s:3648,PREL
          1 000596  D846 0015                            LDR,R5   21,B6
          1 000598  D946 0013                            CMR,R5   19,B6
          1 00059A  0A81 0003                            BALE     s:3648,PREL

      491     3646    4              AND %KV_SRD.CRT.LIN>%KV_SRD.CRTVRTLINPHSLIN
      492     3647    4            THEN %KV_SRD.CRT.LIN = %KV_SRD.CRT.LIN-1;

   3647   1 00059C  88C6 0015                            DEC      21,B6

      493     3648    4            Y@SRHLO = %KV_SRD.CRT.LIN-%KV_SRD.CRTVRTLINPHSLIN+1;

   3648   1 00059E  D846 0015                            LDR,R5   21,B6
          1 0005A0  D246 0013                            SUB,R5   19,B6
          1 0005A2  5E01                                 ADV,R5   1
          1 0005A3  DF47 0015                            STR,R5   Y@SRHLO,AUTO

      494     3649    4            IF Y@SRHLO<%KV_RCR.LINCNT

   3649   1 0005A5  DCC7 000A                            LDB,B5   Y@RCR$,AUTO
          1 0005A7  C0C5 0002                            LDH,R4   2,B5
          1 0005A9  C955                                 CMR,R4   R5
          1 0005AA  0A81 0026                            BALE     s:3656,PREL
          1 0005AC  B846 0010                            LDR,R3   16,B6
          1 0005AE  B946 000B                            CMR,R3   11,B6
          1 0005B0  0881 0020                            BAGE     s:3656,PREL

      495     3650    5              AND %KV_SRD.FLDEND.LIN<%KV_SRD.BTMRHT.LIN THEN DO;

      496     3651    5               KV@USR_PST.PHSPST.LIN = Y@SRHLO+%KV_SRD.CRTVRTLINPHSLIN;

   3651   1 0005B2  DA46 0013                            ADD,R5   19,B6
          1 0005B4  DF47 001D                            STR,R5   KV@USR_PST+1,AUTO

      497     3652    5               KV@USR_PST.SCRCNT = KV@USR_PST.PHSPST.LIN-%KV_SRD.FLDEND.LIN-1;

   3652   1 0005B6  D246 0010                            SUB,R5   16,B6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:130  
          1 0005B8  5EFF                                 ADV,R5   -1
          1 0005B9  DAC7 001F                            SRM,R5,'00FF'X    KV@USR_PST+3,AUTO
          1 0005BB       00FF

      498     3653    5               Y@BTMHOL = Y@BTMHOL-KV@USR_PST.SCRCNT;

   3653   1 0005BC  E847 001F                            LDR,R6   KV@USR_PST+3,AUTO
          1 0005BE  6008                                 SOL,R6   8
          1 0005BF  6068                                 SAR,R6   8
          1 0005C0  E247 0038                            SUB,R6   Y@BTMHOL,AUTO
          1 0005C2  8256                                 NEG      R6
          1 0005C3  EF47 0038                            STR,R6   Y@BTMHOL,AUTO

      499     3654    5               CALL KVV$CALUSR (KV@USR_PST);

   3654   1 0005C5  CBC7 001C                            LAB,B4   KV@USR_PST,AUTO
          1 0005C7  CFC7 0056                            STB,B4   KV@SND_DAT+23,AUTO
          1 0005C9  BBC7 0056                            LAB,B3   KV@SND_DAT+23,AUTO
          1 0005CB  CBF0 0100                            LAB,B4   256,IMO
          1 0005CD  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          1 0005D0       0001                            DC       s:3656,PREL

      500     3655    5            END;

      501     3656    4            %KV_RCR.LINCNT = Y@SRHLO;

   3656   1 0005D1  E847 0015                            LDR,R6   Y@SRHLO,AUTO
          1 0005D3  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 0005D5  E7C6 0002                            STH,R6   2,B6

      502     3657    4            %KV_RCR.UPD = '0'B;

   3657   1 0005D7  8846 0002                            LBF,'0040'X       2,B6
   3657   1 0005D9       0040

      503     3658    4         END;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:131  
   3656   1                              NXTLIN          null
      504     3659    3   NXTLIN:;
      505     3660    3         Y@VRTLIN = Y@VRTLIN+%KV_RCR.LINCNT;

   3660   1 0005DA  ECC7 000A            NXTLIN          LDB,B6   Y@RCR$,AUTO
          1 0005DC  E0C6 0002                            LDH,R6   2,B6
          1 0005DE  EA47 0014                            ADD,R6   Y@SRHHI,AUTO
          1 0005E0  EF47 0014                            STR,R6   Y@SRHHI,AUTO

      506     3661    3         Y@SRHCUR = Y@SRHCUR+1;

   3661   1 0005E2  8AC7 0016                            INC      Y@SRHCUR,AUTO

      507     3662    4         IF Y@VRTLIN>=%KV_SRD.LNG OR Y@SRHCUR>=%KV_RCRLST.RCRCNT THEN DO;

   3662   1 0005E4  DCC7 000C                            LDB,B5   Y@SRD$,AUTO
          1 0005E6  D2C5 000E                            LLH,R5   14,B5
          1 0005E8  D956                                 CMR,R5   R6
          1 0005E9  0A81 0009                            BALE     s:3663,PREL
          1 0005EB  CCC7 0006                            LDB,B4   Y@RCRLST$,AUTO
          1 0005ED  C847 0016                            LDR,R4   Y@SRHCUR,AUTO
          1 0005EF  C944 0001                            CMR,R4   1,B4
          1 0005F1  0801 FC3D                            BAL      s:3444,PREL

      508     3663    5            IF Y@VRTLIN>%KV_SRD.LNG THEN DO;

   3663   1 0005F3  D956                                 CMR,R5   R6
          1 0005F4  0881 0011                            BAGE     s:3668,PREL

      509     3664    5               %KV_RCR.LINCNT = %KV_RCR.LINCNT+%KV_SRD.LNG-Y@VRTLIN;

   3664   1 0005F6  C0C6 0002                            LDH,R4   2,B6
          1 0005F8  CA55                                 ADD,R4   R5
          1 0005F9  C256                                 SUB,R4   R6
          1 0005FA  C7C6 0002                            STH,R4   2,B6

      510     3665    5               %KV_RCRLST.PRTLSTRCR = '1'B;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:132  

   3665   1 0005FC  CCC7 0006                            LDB,B4   Y@RCRLST$,AUTO
          1 0005FE  8944 000C                            LBT,'0010'X       12,B4
          1 000600       0010

      511     3666    5               %KV_RCRLST.EOFDSP = '0'B;

   3666   1 000601  8844 000D                            LBF,'0010'X       13,B4
   3666   1 000603       0010

      512     3667    5            END;

   3667   1 000604  0F81 006A                            B        s:3689,PREL

      513     3668    5            ELSE IF Y@VRTLIN<%KV_SRD.LNG AND %KV_RCRLST.EOF THEN DO;

   3668   1 000606  0A81 0063                            BALE     s:3688+2,PREL
          1 000608  CCC7 0006                            LDB,B4   Y@RCRLST$,AUTO
          1 00060A  82C4 000C                            LB,'0040'X        12,B4
          1 00060C       0040
          1 00060D  0581 005C                            BBF      s:3688+2,PREL

      514     3669    5               IF %KV_RCRLST.EOFDSP THEN EXIT;

   3669   1 00060F  82C4 000D                            LB,'0010'X        13,B4
   3669   1 000611       0010
          1 000612  0501 0055                            BBT      s:3688,PREL

      515     3670    5               KV@VDH_OTPLCL.BFR_.ADR$ = %KV_MVD.DCBHDN$;

   3670   1 000614  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 000617  ACC3 0006                            LDB,B2   6,B3
          1 000619  9CC2 0006                            LDB,B1   6,B2
          1 00061B  9FC7 0032                            STB,B1   KV@VDH_OTPLCL+1,AUTO

      516     3671    5               IF KV@VDH_OTPLCL.BFR_.ADR$=ADDR(NIL) THEN EXIT;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:133  
   3671   1 00061D  8DC7 0032                            CMN      KV@VDH_OTPLCL+1,AUTO
          1 00061F  0901 0048                            BE       s:3688,PREL

      517     3672    5               KV@VDH_OTPLCL.BFR_.BYTSIZ =

   3672   1 000621  D2C1 0006                            LLH,R5   6,B1
          1 000623  DF47 0035                            STR,R5   KV@VDH_OTPLCL+4,AUTO

      518     3673    5                 KV@VDH_OTPLCL.BFR_.ADR$->KV$TITLE.TXTSIZ;
      519     3674    5               IF KV@VDH_OTPLCL.BFR_.BYTSIZ=0 THEN EXIT;

   3674   1 000625  5901 0042                            BEZ,R5   s:3688,PREL

      520     3675    5               %KV_RCRLST.EOFDSP = '1'B;

   3675   1 000627  8944 000D                            LBT,'0010'X       13,B4
   3675   1 000629       0010

      521     3676    5               %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.TOPLFT.LIN+Y@VRTLIN;

   3676   1 00062A  EA45 0009                            ADD,R6   9,B5
          1 00062C  EF45 0013                            STR,R6   19,B5

      522     3677    5               IF %KV_SRD.CRT.LIN~=%KV_SRD.CRTVRTLINPHSLIN

   3677   1 00062E  E945 0015                            CMR,R6   21,B5
          1 000630  0981 0007                            BNE      s:3679,PREL
          1 000632  D845 0016                            LDR,R5   22,B5
          1 000634  D945 000A                            CMR,R5   10,B5
          1 000636  0901 0011                            BE       s:3684,PREL

      523     3678    6                 OR %KV_SRD.CRT.CLM~=%KV_SRD.TOPLFT.CLM THEN DO;

      524     3679    6                  %KV_SRD.CRT.LIN = %KV_SRD.CRTVRTLINPHSLIN;

   3679   1 000638  EF45 0015                            STR,R6   21,B5

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:134  
      525     3680    6                  %KV_SRD.CRT.CLM = %KV_SRD.TOPLFT.CLM;

   3680   1 00063A  D845 000A                            LDR,R5   10,B5
          1 00063C  DF45 0016                            STR,R5   22,B5

      526     3681    6                  %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_SKP;

   3681   1 00063E  AC83                                 LDB,B2   ,B3
          1 00063F  4C01                                 LDV,R4   1
          1 000640  CF42 001A                            STR,R4   26,B2

      527     3682    6                  CALL KVV$CALUSR_PST;

   3682   1 000642  CBF0 0000                            LAB,B4   0,IMO
          1 000644  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_PST
          1 000647       0001                            DC       s:3684,PREL

      528     3683    6               END;

      529     3684    5               IF NOT %KV_SRD.VRTSCR AND KV@VDH_OTPLCL.BFR_.BYTX<0

   3684   1 000648  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 00064A  82C6 001D                            LB,'4000'X        29,B6
          1 00064C       4000
          1 00064D  0501 000B                            BBT      s:3686,PREL
          1 00064F  E847 0034                            LDR,R6   KV@VDH_OTPLCL+3,AUTO
          1 000651  6881 0007                            BGEZ,R6  s:3686,PREL

      530     3685    5               THEN CALL KVO$ERSTO_ENDOF_SRD;

   3685   1 000653  CBF0 0000                            LAB,B4   0,IMO
          1 000655  E380 0000 0000  xent                 LNJ,B6   KVO$ERSTO_ENDOF_SRD
          1 000658       0001                            DC       s:3686,PREL

      531     3686    5               KV@VDH_OTPLCL.BFR_.BYTX = 13;

   3686   1 000659  6C0D                                 LDV,R6   13
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:135  
          1 00065A  EF47 0034                            STR,R6   KV@VDH_OTPLCL+3,AUTO

      532     3687    5               CALL KVO$OTPLCL (KV@VDH_OTPLCL);

   3687   1 00065C  EBC7 0031                            LAB,B6   KV@VDH_OTPLCL,AUTO
          1 00065E  EFC7 0056                            STB,B6   KV@SND_DAT+23,AUTO
          1 000660  BBC7 0056                            LAB,B3   KV@SND_DAT+23,AUTO
          1 000662  CBF0 0100                            LAB,B4   256,IMO
          1 000664  E380 0000 0000  xent                 LNJ,B6   KVO$OTPLCL
          1 000667       0001                            DC       s:3688,PREL

      533     3688    4            END; ELSE %KV_RCRLST.EOFDSP = '0'B;

   3688   1 000668  0F81 0006                            B        s:3689,PREL

   3688   1 00066A  CCC7 0006                            LDB,B4   Y@RCRLST$,AUTO
          1 00066C  8844 000D                            LBF,'0010'X       13,B4
          1 00066E       0010

      534     3689    4            EXIT DSPLOP;

   3689   1 00066F  0F81 0001                            B        s:3692,PREL

      535     3690    4         END;
      536     3691    3      END;

      537     3692    2      %KV_RCRLST.VRTSCRCNT = 0;

   3692   1 000671  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 000673  87C6 000A                            CLH      10,B6

      538     3693    2      %KV_SRD.CRT = %KV_SRD.TOPLFT;

   3693   1 000675  DCC7 000C                            LDB,B5   Y@SRD$,AUTO
          1 000677  8CC5 0009                            LDI      9,B5
          1 000679  8D45 0015                            SDI      21,B5

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:136  
      539     3694    2      %KV_MVD.VRTCLM = Y@ORGVRTCLM;

   3694   1 00067B  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 00067E  BCC4 0006                            LDB,B3   6,B4
          1 000680  D847 0039                            LDR,R5   Y@ORGVRTCLM,AUTO
          1 000682  DF43 001B                            STR,R5   27,B3

      540     3695    3      IF Y@REDLIN>=0 THEN DO;

   3695   1 000684  E847 0012                            LDR,R6   Y@KEYCMP,AUTO
          1 000686  6801 0079                            BLZ,R6   s:3719,PREL

      541     3696    3         %KV_SRD.CRTVRTLINPHSLIN = Y@REDLIN+%KV_SRD.TOPLFT.LIN;

   3696   1 000688  EA45 0009                            ADD,R6   9,B5
          1 00068A  EF45 0013                            STR,R6   19,B5

      542     3697    3         %KV_SRD.FLDEND.LIN = %KV_SRD.CRTVRTLINPHSLIN+

   3697   1 00068C  B846 0006                            LDR,R3   6,B6
          1 00068E  3E08                                 ADV,R3   8
          1 00068F  BCB6                                 LDB,B3   ,B6,R3
          1 000690  C0C3 0002                            LDH,R4   2,B3
          1 000692  CA56                                 ADD,R4   R6
          1 000693  4EFF                                 ADV,R4   -1
          1 000694  CF45 0010                            STR,R4   16,B5

      543     3698    3           %KV_RCRLST.RCR$(%KV_RCRLST.CRTRCR)->KV$RCR.LINCNT-1;
      544     3699    3         %KV_SRD.HI_NONBLN = %KV_SRD.FLDEND;

   3699   1 000696  8CC5 0010                            LDI      16,B5
          1 000698  8D45 0017                            SDI      23,B5

      545     3700    3         IF %KV_SSN.REDSTRID~=%KV_STR.ID THEN EXIT;

   3700   1 00069A  BCC7 000E                            LDB,B3   Y@SSN$,AUTO
          1 00069C  B2C3 0038                            LLH,R3   56,B3
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:137  
          1 00069E  ACC7 0010                            LDB,B2   Y@STR$,AUTO
          1 0006A0  A2C2 001C                            LLH,R2   28,B2
          1 0006A2  B952                                 CMR,R3   R2
          1 0006A3  0981 005C                            BNE      s:3719,PREL

      546     3701    4         IF NOT %KV_SRD.VRTSCR THEN DO;

   3701   1 0006A5  82C5 001D                            LB,'4000'X        29,B5
   3701   1 0006A7       4000
          1 0006A8  0501 0018                            BBT      s:3707,PREL

      547     3702    4            IF KV@USR_PST.PHSPST.LIN<0 THEN %KV_MVD.FRMSCNINH = '1'B;

   3702   1 0006AA  9847 001D                            LDR,R1   KV@USR_PST+1,AUTO
          1 0006AC  1881 0006                            BGEZ,R1  s:3703,PREL

   3702   1 0006AE  9CC4 0006                            LDB,B1   6,B4
          1 0006B0  8941 0016                            LBT,'0010'X       22,B1
          1 0006B2       0010

      548     3703    4            IF %KV_VDI.RE_DSPINP THEN EXIT;

   3703   1 0006B3  9C84                                 LDB,B1   ,B4
          1 0006B4  82C1 0019                            LB,'0010'X        25,B1
          1 0006B6       0010
          1 0006B7  0501 0009                            BBT      s:3707,PREL

      549     3704    4            %KV_VDI.RE_DSPINP = '1'B;

   3704   1 0006B9  8941 0019                            LBT,'0010'X       25,B1
   3704   1 0006BB       0010

      550     3705    4            %KV_VDI.RE_DSPLOWX = %KV_SSN.REDBFR.NXTX;

   3705   1 0006BC  9C84                                 LDB,B1   ,B4
          1 0006BD  E843 002A                            LDR,R6   42,B3
          1 0006BF  EF41 0016                            STR,R6   22,B1
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:138  

      551     3706    4         END;

      552     3707    3         IF %KV_MVD.HRZSCR AND Y@ORGVRTCLM-%KV_SRD.PRMVRTCLM<=%KV_MVD.HRZSCRMRG

   3707   1 0006C1  9CC4 0006                            LDB,B1   6,B4
          1 0006C3  82C1 0016                            LB,'0004'X        22,B1
          1 0006C5       0004
          1 0006C6  0581 0017                            BBF      s:3709,PREL
          1 0006C8  D245 0012                            SUB,R5   18,B5
          1 0006CA  E2C1 0017                            LLH,R6   23,B1
          1 0006CC  E955                                 CMR,R6   R5
          1 0006CD  0801 0010                            BAL      s:3709,PREL
          1 0006CF  D843 002F                            LDR,R5   47,B3
          1 0006D1  5901 000C                            BEZ,R5   s:3709,PREL

      553     3708    3           AND %KV_SSN.REDBFR.DSPLOWX~=0 THEN CALL KVI$SHFDSPPST(0);

   3708   1 0006D3  BB80 0000 0004  02                   LAB,B3   +4
          1 0006D6  CBF0 0100                            LAB,B4   256,IMO
          1 0006D8  E380 0000 0000  xent                 LNJ,B6   KVI$SHFDSPPST
          1 0006DB       0001                            DC       s:3708+9,PREL
          1 0006DC  0F81 0023                            B        s:3719,PREL

      554     3709    3         ELSE IF %KV_MVD.HRZSCR AND Y@ORGVRTCLM+%KV_MVD.HRZSCRMRG>%KV_MVD.WDT

   3709   1 0006DE  0581 0013                            BBF      s:3712,PREL
          1 0006E0  E2C1 0017                            LLH,R6   23,B1
          1 0006E2  EA47 0039                            ADD,R6   Y@ORGVRTCLM,AUTO
          1 0006E4  6801 000D                            BLZ,R6   s:3712,PREL
          1 0006E6  E941 0013                            CMR,R6   19,B1
          1 0006E8  0381 0009                            BLE      s:3712,PREL

      555     3710    3         THEN CALL KVI$SHFDSPPST;

   3710   1 0006EA  CBF0 0000                            LAB,B4   0,IMO
          1 0006EC  E380 0000 0000  xent                 LNJ,B6   KVI$SHFDSPPST
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:139  
          1 0006EF       0001                            DC       s:3710+6,PREL
          1 0006F0  0F81 000F                            B        s:3719,PREL

      556     3711    4         ELSE DO;

      557     3712    4            %KV_RCRLST.LSTRCR = Y@SRHCUR-1;

   3712   1 0006F2  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 0006F4  6EFF                                 ADV,R6   -1
          1 0006F5  EF46 0005                            STR,R6   5,B6

      558     3713    4            CALL KVO$PST (KV_VDH_PST_VRT);

   3713   1 0006F7  BB80 0000 0006  02                   LAB,B3   +6
          1 0006FA  CBF0 0100                            LAB,B4   256,IMO
          1 0006FC  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 0006FF       0001                            DC       s:3719,PREL

      559     3714    4         END;

      560     3715    3      END;

      561     3716        /*
      562     3717           If the screen is blanked, don't delete any output for a bit.
      563     3718        */
      564     3719    3      IF %KV_RCRLST.RCRCNT=0 THEN DO;

   3719   1 000700  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 000702  E846 0001                            LDR,R6   1,B6
          1 000704  6981 000D                            BNEZ,R6  s:3724,PREL

      565     3720    3         IF %KV_RCRLST.LSTRCR = -1 AND KV@VDH_OTPLCL.BFR_.BYTX<0

   3720   1 000706  D846 0005                            LDR,R5   5,B6
          1 000708  5DFF                                 CMV,R5   -1
          1 000709  0981 0005                            BNE      s:3722,PREL
          1 00070B  C847 0034                            LDR,R4   KV@VDH_OTPLCL+3,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:140  
          1 00070D  4801 FC01                            BLZ,R4   s:3501,PREL

      566     3721    3         THEN GOTO Y$ERS_THE_REST;
      567     3722    3         Y@SRHCUR = -1;

   3722   1 00070F  8947 0016                            LBT,'FFFF'X       Y@SRHCUR,AUTO
   3722   1 000711       FFFF

      568     3723    3      END;

      569     3724    2      %KV_RCRLST.LSTRCR = Y@SRHCUR-1;

   3724   1 000712  D847 0016                            LDR,R5   Y@SRHCUR,AUTO
          1 000714  5EFF                                 ADV,R5   -1
          1 000715  DF46 0005                            STR,R5   5,B6

      570     3725    3      IF %KV_RCRLST.DLTRCREXS THEN DO;

   3725   1 000717  82C6 000D                            LB,'0080'X        13,B6
   3725   1 000719       0080
          1 00071A  0581 002C                            BBF      s:3737,PREL

      571     3726    3         %KV_RCRLST.DLTRCREXS = '0'B;

   3726   1 00071C  8846 000D                            LBF,'0080'X       13,B6
   3726   1 00071E       0080

      572     3727    3         Y@SRHCUR = 0;

   3727   1 00071F  8747 0016                            CL       Y@SRHCUR,AUTO

      573     3728    4         DO WHILE '1'B;

      574     3729    4            IF Y@SRHCUR=%KV_RCRLST.FRSRCR AND %KV_RCRLST.LSTRCR>%KV_RCRLST.FRSRCR

   3729   1 000721  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 000723  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:141  
          1 000725  E946 0004                            CMR,R6   4,B6
          1 000727  0981 000B                            BNE      s:3731,PREL
          1 000729  D846 0005                            LDR,R5   5,B6
          1 00072B  D946 0004                            CMR,R5   4,B6
          1 00072D  0A81 0005                            BALE     s:3731,PREL

      575     3730    4            THEN Y@SRHCUR = %KV_RCRLST.LSTRCR+1;

   3730   1 00072F  E855                                 LDR,R6   R5
          1 000730  6E01                                 ADV,R6   1
          1 000731  EF47 0016                            STR,R6   Y@SRHCUR,AUTO

      576     3731    4            IF Y@SRHCUR>=%KV_RCRLST.RCRCNT THEN EXIT;

   3731   1 000733  E946 0001                            CMR,R6   1,B6
          1 000735  0881 0011                            BAGE     s:3737,PREL

      577     3732    4            Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);

   3732   1 000737  B856                                 LDR,R3   R6
          1 000738  3E08                                 ADV,R3   8
          1 000739  DCB6                                 LDB,B5   ,B6,R3
          1 00073A  DFC7 000A                            STB,B5   Y@RCR$,AUTO

      578     3733    4            IF %KV_RCR.RCRBYTSIZ<0 THEN CALL Y$DLTRCRRLS;

   3733   1 00073C  D845 0001                            LDR,R5   1,B5
          1 00073E  5881 0005                            BGEZ,R5  s:3734,PREL

   3733   1 000740  E3C0 1349                            LNJ,B6   s:0,PREL
          1 000742       0001                            DC       s:3733+7,PREL
          1 000743  0FDE                                 B        s:3729,SPREL

      579     3734    4            ELSE Y@SRHCUR = Y@SRHCUR+1;

   3734   1 000744  8AC7 0016                            INC      Y@SRHCUR,AUTO

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:142  
      580     3735    4         END;

   3735   1 000746  0FDB                                 B        s:3729,SPREL

      581     3736    3      END;

      582     3737    2      RETURN;

   3737   1 000747  ECC7 0036                            LDB,B6   KV@VDH_OTPLCL+5,AUTO
          1 000749  C3C6 0001                            LNJ,B4   1,B6

      583     3738    2   END Y$DSPALL;
      584     3739        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:143  
      585     3740        /*F* NAME: KVE$FIXHRZSCR.
      586     3741             DESCRIPTION: Called by KVP$PRM when HRZSCR changes, to fix up the
      587     3742             linecounts and redisplay the screen.
      588     3743        */
      589     3744    1   KVE$FIXHRZSCR: ENTRY ALTRET;

   3744   1 00074B  D380 0000 0000  xent KVE$FIXHRZSCR   LNJ,B5   X6A_AUTO_1
          1 00074E       005A 0001                       DC       90,1

      590     3745
      591     3746    1      CALL Y$SETUP;

   3746   1 000750  E3C0 F8B6                            LNJ,B6   s:0,PREL
          1 000752       0001                            DC       s:3747,PREL

      592     3747    1      %KV_RCRLST.LSTRCR = %KV_RCRLST.FRSRCR-1;

   3747   1 000753  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 000755  E846 0004                            LDR,R6   4,B6
          1 000757  6EFF                                 ADV,R6   -1
          1 000758  EF46 0005                            STR,R6   5,B6

      593     3748    1      Y@SRHCUR = 0;

   3748   1 00075A  8747 0016                            CL       Y@SRHCUR,AUTO

      594     3749    2      DO WHILE Y@SRHCUR<%KV_RCRLST.RCRCNT;

   3749   1 00075C  D847 0016                            LDR,R5   Y@SRHCUR,AUTO
          1 00075E  D946 0001                            CMR,R5   1,B6
          1 000760  0881 0040                            BAGE     s:3761,PREL

      595     3750    2         Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);

   3750   1 000762  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 000764  B847 0016                            LDR,R3   Y@SRHCUR,AUTO
          1 000766  3E08                                 ADV,R3   8
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:144  
          1 000767  DCB6                                 LDB,B5   ,B6,R3
          1 000768  DFC7 000A                            STB,B5   Y@RCR$,AUTO

      596     3751    3         IF %KV_RCR.RCRBYTSIZ<0 THEN DO;

   3751   1 00076A  E845 0001                            LDR,R6   1,B5
          1 00076C  6881 000E                            BGEZ,R6  s:3755,PREL

      597     3752    3            KV@VDH_GETBFR = Y_VDH_GETBFR;

   3752   1 00076E  AB80 0000 0000  00                   LAB,B2   Y_VDH_OTPLCL
          1 000771  2C0A                                 LDV,R2   10
          1 000772  6C16                                 LDV,R6   22
          1 000773  BB87                                 LAB,B3   ,AUTO
          1 000774  3C4C                                 LDV,R3   76
          1 000775  0008                                 MMM

      598     3753    3            CALL Y$DLTRCRRLS;

   3753   1 000776  E3C0 1313                            LNJ,B6   s:0,PREL
          1 000778       0001                            DC       s:3754,PREL

      599     3754    3         END; ELSE DO;

   3754   1 000779  0F81 0020                            B        s:3760,PREL

      600     3755    3            IF %KV_MVD.HRZSCR THEN %KV_RCR.LINCNT = 1;

   3755   1 00077B  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 00077E  BCC4 0006                            LDB,B3   6,B4
          1 000780  82C3 0016                            LB,'0004'X        22,B3
          1 000782       0004
          1 000783  0581 0006                            BBF      s:3756,PREL

   3755   1 000785  5C01                                 LDV,R5   1
          1 000786  D7C5 0002                            STH,R5   2,B5
          1 000788  0F81 000F                            B        s:3758,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:145  

      601     3756    3            ELSE %KV_RCR.LINCNT =

   3756   1 00078A  ACC7 000C                            LDB,B2   Y@SRD$,AUTO
          1 00078C  EA42 000D                            ADD,R6   13,B2
          1 00078E  6EFF                                 ADV,R6   -1
          1 00078F  E342 000D                            DIV,R6   13,B2
          1 000791  E970 0001                            CMR,R6   1,IMO
          1 000793  0881 0002                            BAGE     s:3756+12,PREL
          1 000795  6C01                                 LDV,R6   1
          1 000796  E7C5 0002                            STH,R6   2,B5

      602     3757    3              MAXIMUM ((%KV_RCR.RCRBYTSIZ+%KV_SRD.WDT-1)/%KV_SRD.WDT, 1);
      603     3758    3            Y@SRHCUR = Y@SRHCUR+1;

   3758   1 000798  8AC7 0016                            INC      Y@SRHCUR,AUTO

      604     3759    3         END;

      605     3760    2      END;

   3760   1 00079A  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 00079C  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 00079E  E946 0001                            CMR,R6   1,B6
          1 0007A0  0842                                 BAL      s:3750,SPREL

      606     3761    1      IF NOT %KV_MVD.HRZSCR THEN %KV_RCRLST.HRZSCROFS = 0;

   3761   1 0007A1  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0007A4  CCC5 0006                            LDB,B4   6,B5
          1 0007A6  82C4 0016                            LB,'0004'X        22,B4
          1 0007A8       0004
          1 0007A9  0501 0003                            BBT      s:3762,PREL

   3761   1 0007AB  8746 0003                            CL       3,B6

      607     3762    1      RETURN;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:146  

   3762   1 0007AD  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      608     3763        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:147  
      609     3764        /*F* NAME: KVE$INCFLD.
      610     3765             DESCRIPTION: Called by KVO$PST when attempting to position below
      611     3766             FLDEND LIN (extending the record beyond its former line count).
      612     3767             Horizontal scrolling obviously off. Slides lower data down to make
      613     3768             room, or upper data up if already at the bottom of the window.
      614     3769        */
      615     3770    1   KVE$INCFLD: ENTRY ALTRET;

   3770   1 0007B0  D380 0000 0000  xent KVE$INCFLD      LNJ,B5   X6A_AUTO_1
          1 0007B3       005A 0001                       DC       90,1

      616     3771
      617     3772    1      CALL Y$SETUP;

   3772   1 0007B5  E3C0 F851                            LNJ,B6   s:0,PREL
          1 0007B7       0001                            DC       s:3773,PREL

      618     3773    1      %KV_RCR.LINCNT = %KV_RCR.LINCNT+1;

   3773   1 0007B8  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 0007BA  E0C6 0002                            LDH,R6   2,B6
          1 0007BC  6E01                                 ADV,R6   1
          1 0007BD  E7C6 0002                            STH,R6   2,B6

      619     3774    2      IF %KV_SRD.CRT.LIN<=%KV_SRD.BTMRHT.LIN THEN DO;

   3774   1 0007BF  DCC7 000C                            LDB,B5   Y@SRD$,AUTO
          1 0007C1  E845 0015                            LDR,R6   21,B5
          1 0007C3  E945 000B                            CMR,R6   11,B5
          1 0007C5  0A01 0048                            BAG      s:3796,PREL

      620     3775        /*
      621     3776           We don't need to scroll everything up, just make a hole for this record.
      622     3777        */
      623     3778    3         IF %KV_SRD.VRTSCR AND %KV_SRD.CRT.LIN<%KV_SRD.BTMRHT.LIN THEN DO;

   3778   1 0007C7  82C5 001D                            LB,'4000'X        29,B5
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:148  
   3778   1 0007C9       4000
          1 0007CA  0581 0026                            BBF      s:3785,PREL
          1 0007CC  0881 0024                            BAGE     s:3785,PREL

      624     3779    3            KV@USR_PST = KV_USR_PST;

   3779   1 0007CE  AB80 0000 0000  xsym                 LAB,B2   KV_USR_PST
          1 0007D1  2C00                                 LDV,R2   0
          1 0007D2  6C08                                 LDV,R6   8
          1 0007D3  BB87                                 LAB,B3   ,AUTO
          1 0007D4  3C38                                 LDV,R3   56
          1 0007D5  0008                                 MMM

      625     3780    3            KV@USR_PST.PHSPSTMOD = %KV_PHSPSTMOD_VRTSCR;

   3780   1 0007D6  6C04                                 LDV,R6   4
          1 0007D7  E7C7 001F                            STH,R6   KV@USR_PST+3,AUTO

      626     3781    3            KV@USR_PST.SCRCNT = 1;

   3781   1 0007D9  5C01                                 LDV,R5   1
          1 0007DA  DAC7 001F                            SRM,R5,'00FF'X    KV@USR_PST+3,AUTO
          1 0007DC       00FF

      627     3782    3            KV@USR_PST.PHSPST.LIN = %KV_SRD.CRT.LIN;

   3782   1 0007DD  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 0007DF  C846 0015                            LDR,R4   21,B6
          1 0007E1  CF47 001D                            STR,R4   KV@USR_PST+1,AUTO

      628     3783    3            CALL KVV$CALUSR (KV@USR_PST);

   3783   1 0007E3  DBC7 001C                            LAB,B5   KV@USR_PST,AUTO
          1 0007E5  DFC7 0056                            STB,B5   KV@SND_DAT+23,AUTO
          1 0007E7  BBC7 0056                            LAB,B3   KV@SND_DAT+23,AUTO
          1 0007E9  CBF0 0100                            LAB,B4   256,IMO
          1 0007EB  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:149  
          1 0007EE       0001                            DC       s:3784,PREL

      629     3784    3         END; ELSE DO;

   3784   1 0007EF  0F81 003B                            B        s:3802,PREL

      630     3785    3            %KV_RCRLST.EOFDSP = '0'B;

   3785   1 0007F1  CCC7 0006                            LDB,B4   Y@RCRLST$,AUTO
          1 0007F3  8844 000D                            LBF,'0010'X       13,B4
          1 0007F5       0010

      631     3786    3            %KV_SRD.FLDEND.LIN = %KV_SRD.FLDEND.LIN+1;

   3786   1 0007F6  8AC5 0010                            INC      16,B5

      632     3787    3            %KV_SRD.HI_NONBLN = %KV_SRD.FLDEND;

   3787   1 0007F8  8CC5 0010                            LDI      16,B5
          1 0007FA  8D45 0017                            SDI      23,B5

      633     3788    3            %KV_SRD.CRT.CLM = %KV_SRD.TOPLFT.CLM;

   3788   1 0007FC  D845 000A                            LDR,R5   10,B5
          1 0007FE  DF45 0016                            STR,R5   22,B5

      634     3789    3            CALL KVO$ERSTO_ENDOF_INP;

   3789   1 000800  CBF0 0000                            LAB,B4   0,IMO
          1 000802  E380 0000 0000  xent                 LNJ,B6   KVO$ERSTO_ENDOF_INP
          1 000805       0001                            DC       s:3790,PREL

      635     3790    3            %KV_RCRLST.LSTRCR = %KV_RCRLST.CRTRCR;

   3790   1 000806  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 000808  E846 0006                            LDR,R6   6,B6
          1 00080A  EF46 0005                            STR,R6   5,B6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:150  

      636     3791    3         END;

      637     3792    2      END; ELSE DO;

   3792   1 00080C  0F81 001E                            B        s:3802,PREL

      638     3793        /*
      639     3794           Scroll off the first record, if that's not this one.
      640     3795        */
      641     3796    2         IF %KV_RCRLST.CRTRCR<=%KV_RCRLST.FRSRCR THEN GOTO ERR_LD;

   3796   1 00080E  CCC7 0006                            LDB,B4   Y@RCRLST$,AUTO
          1 000810  D844 0006                            LDR,R5   6,B4
          1 000812  D944 0004                            CMR,R5   4,B4
          1 000814  0A81 0D2E                            BALE     s:4632,PREL

      642     3797    2         IF NOT %KV_SRD.VRTSCR THEN %KV_RCRLST.LSTRCR = -1;

   3797   1 000816  82C5 001D                            LB,'4000'X        29,B5
   3797   1 000818       4000
          1 000819  0501 0006                            BBT      s:3798,PREL

   3797   1 00081B  8944 0005                            LBT,'FFFF'X       5,B4
   3797   1 00081D       FFFF
          1 00081E  0F81 000A                            B        s:3800,PREL

      643     3798    2         ELSE %KV_RCRLST.VRTSCRCNT =

   3798   1 000820  B844 0004                            LDR,R3   4,B4
          1 000822  3E08                                 ADV,R3   8
          1 000823  BCB4                                 LDB,B3   ,B4,R3
          1 000824  C0C3 0002                            LDH,R4   2,B3
          1 000826  8254                                 NEG      R4
          1 000827  C7C4 000A                            STH,R4   10,B4

      644     3799    2           -%KV_RCRLST.RCR$(%KV_RCRLST.FRSRCR)->KV$RCR.LINCNT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:151  
      645     3800    2         %KV_RCRLST.FRSRCR = %KV_RCRLST.FRSRCR+1;

   3800   1 000829  8AC4 0004                            INC      4,B4

      646     3801    2      END;

      647     3802    1      CALL Y$DSPALL;

   3802   1 00082B  E3C0 F950                            LNJ,B6   s:0,PREL
          1 00082D       0001                            DC       s:3803,PREL

      648     3803    1      RETURN;

   3803   1 00082E  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      649     3804        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:152  
      650     3805        /*F* NAME: KVE$INPOPR
      651     3806             DESCRIPTION: Interprets screen-editor-specific input function
      652     3807             operators.  Altreturns if not a SE function.
      653     3808             Caller must insure that MVD is ORG=SE.
      654     3809        */
      655     3810    1   KVE$INPOPR: ENTRY(PRM_INPOPR_DUMMY) ALTRET;

   3810   1 000831  D380 0000 0000  xent KVE$INPOPR      LNJ,B5   X6A_AUTO_1
          1 000834       005A 0001                       DC       90,1

      656     3811
      657     3812    1      IF %KV_MVD.ORG~=%KV#VD_ORG_SE THEN RETURN;

   3812   1 000836  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000839  DCC6 0006                            LDB,B5   6,B6
          1 00083B  E2C5 0015                            LLH,R6   21,B5
          1 00083D  6D05                                 CMV,R6   5
          1 00083E  0901 0004                            BE       s:3813,PREL

   3812   1 000840  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      658     3813    1      CALL Y$SETUP;

   3813   1 000843  E3C0 F7C3                            LNJ,B6   s:0,PREL
          1 000845       0001                            DC       s:3814,PREL

      659     3814    1      Y@DLTRCR = KV$PTR.INPCNDPND.OPRX;

   3814   1 000846  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000849  E846 001C                            LDR,R6   28,B6
          1 00084B  EF47 0014                            STR,R6   Y@SRHHI,AUTO

      660     3815    1      IF Y@DLTRCR<=0 OR Y@DLTRCR>%KV_RCRLST.MAXRCR THEN Y@DLTRCR = 1;

   3815   1 00084D  6A81 0007                            BLEZ,R6  s:3815+8,PREL
          1 00084F  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 000851  E945 0002                            CMR,R6   2,B5
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:153  
          1 000853  0A81 0004                            BALE     s:3816,PREL

   3815   1 000855  6C01                                 LDV,R6   1
          1 000856  EF47 0014                            STR,R6   Y@SRHHI,AUTO

      661     3816    1      %KV_RCRLST.DFRCNT = 0;

   3816   1 000858  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 00085A  87C5 000D                            CLH      13,B5

      662     3817    1      %KV_STR.RE_REDCLM = %KV_SSN.REDBFR.EDTLOWX+1;

   3817   1 00085C  CCC7 0010                            LDB,B4   Y@STR$,AUTO
          1 00085E  BCC7 000E                            LDB,B3   Y@SSN$,AUTO
          1 000860  D843 002B                            LDR,R5   43,B3
          1 000862  5E01                                 ADV,R5   1
          1 000863  DF44 0012                            STR,R5   18,B4

      663     3818    1      IF %KV_VDI.RE_DSPINP AND NOT %KV_MVD.FRMSCNINH

   3818   1 000865  AC86                                 LDB,B2   ,B6
          1 000866  82C2 0019                            LB,'0010'X        25,B2
          1 000868       0010
          1 000869  0581 0016                            BBF      s:3821,PREL
          1 00086B  9CC6 0006                            LDB,B1   6,B6
          1 00086D  82C1 0016                            LB,'0010'X        22,B1
          1 00086F       0010
          1 000870  0501 000F                            BBT      s:3821,PREL

      664     3819    1      THEN IF %KV_VDI.RE_DSPLOWX<%KV_SSN.REDBFR.NXTX

   3819   1 000872  C842 0016                            LDR,R4   22,B2
          1 000874  4801 000B                            BLZ,R4   s:3821,PREL
          1 000876  C943 002A                            CMR,R4   42,B3
          1 000878  0881 0007                            BAGE     s:3821,PREL

      665     3820    1      THEN CALL KVI$RE_DSPINP;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:154  

   3820   1 00087A  CBF0 0000                            LAB,B4   0,IMO
          1 00087C  E380 0000 0000  xent                 LNJ,B6   KVI$RE_DSPINP
          1 00087F       0001                            DC       s:3821,PREL

      666     3821    1      Y@SRHLO = PRM_FND.BYT;               /* Char to search for if FNDPSTCHR    */

   3821   1 000880  ECC7 0004                            LDB,B6   @PRM_INPOPR_DUMMY,AUTO
          1 000882  E086                                 LDH,R6   ,B6
          1 000883  EF47 0015                            STR,R6   Y@SRHLO,AUTO

      667     3822    1      Y@LINCNT = PRM_INPOPR.ID;

   3822   1 000885  D806                                 LDR,R5   ,B6
          1 000886  D570 00FF                            AND,R5   255,IMO
          1 000888  DF47 001B                            STR,R5   Y@LINCNT,AUTO

      668     3823    1      KV@USR_RQSDAT.RE_RED = '0'B;

   3823   1 00088A  8847 0020                            LBF,'0080'X       KV@USR_RQSDAT,AUTO
   3823   1 00088C       0080

      669     3824    2   INPOPR: DO CASE Y@LINCNT;

   3824   1 00088D  B847 001B            INPOPR          LDR,R3   Y@LINCNT,AUTO
          1 00088F  3EFA                                 ADV,R3   -6
          1 000890  3D2D                                 CMV,R3   45
          1 000891  0281 0034                            BGE      s:3826,PREL
          1 000893  A830 0000 0899  01                   LDR,R2   INPOPR+12,R3
          1 000896  83A0 0000 08C6  01                   JMP      s:3826,R2
          1 000899       016F                            DC       s:3915,PREL
          1 00089A       0000                            DC       s:3826,PREL
          1 00089B       0000                            DC       s:3826,PREL
          1 00089C       0000                            DC       s:3826,PREL
          1 00089D       0000                            DC       s:3826,PREL
          1 00089E       0000                            DC       s:3826,PREL
          1 00089F       0087                            DC       s:3863,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:155  
          1 0008A0       0087                            DC       s:3863,PREL
          1 0008A1       0000                            DC       s:3826,PREL
          1 0008A2       0000                            DC       s:3826,PREL
          1 0008A3       0000                            DC       s:3826,PREL
          1 0008A4       0000                            DC       s:3826,PREL
          1 0008A5       0000                            DC       s:3826,PREL
          1 0008A6       0000                            DC       s:3826,PREL
          1 0008A7       0000                            DC       s:3826,PREL
          1 0008A8       0000                            DC       s:3826,PREL
          1 0008A9       0003                            DC       s:3828,PREL
          1 0008AA       016F                            DC       s:3915,PREL
          1 0008AB       0021                            DC       s:3837,PREL
          1 0008AC       0000                            DC       s:3826,PREL
          1 0008AD       0000                            DC       s:3826,PREL
          1 0008AE       0000                            DC       s:3826,PREL
          1 0008AF       0000                            DC       s:3826,PREL
          1 0008B0       0000                            DC       s:3826,PREL
          1 0008B1       0000                            DC       s:3826,PREL
          1 0008B2       0021                            DC       s:3837,PREL
          1 0008B3       0000                            DC       s:3826,PREL
          1 0008B4       0000                            DC       s:3826,PREL
          1 0008B5       0000                            DC       s:3826,PREL
          1 0008B6       0000                            DC       s:3826,PREL
          1 0008B7       0000                            DC       s:3826,PREL
          1 0008B8       0000                            DC       s:3826,PREL
          1 0008B9       0000                            DC       s:3826,PREL
          1 0008BA       0000                            DC       s:3826,PREL
          1 0008BB       0000                            DC       s:3826,PREL
          1 0008BC       0000                            DC       s:3826,PREL
          1 0008BD       0000                            DC       s:3826,PREL
          1 0008BE       03A3                            DC       s:4055,PREL
          1 0008BF       016F                            DC       s:3915,PREL
          1 0008C0       0003                            DC       s:3828,PREL
          1 0008C1       0021                            DC       s:3837,PREL
          1 0008C2       0000                            DC       s:3826,PREL
          1 0008C3       0000                            DC       s:3826,PREL
          1 0008C4       0000                            DC       s:3826,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:156  
          1 0008C5       005A                            DC       s:3853,PREL

      670     3825    2      CASE ELSE;

      671     3826    2         ALTRETURN;

   3826   1 0008C6  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      672     3827    2      CASE %KV_INPPRC_SE_UP, %KV_INPPRC_PSTLFT;

      673     3828    2         IF Y@SRHCUR=0 AND %KV_RCRLST.BOF THEN GOTO INPOPR_EXIT;

   3828   1 0008C9  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 0008CB  6981 0008                            BNEZ,R6  s:3829,PREL
          1 0008CD  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 0008CF  82C6 000C                            LB,'0020'X        12,B6
          1 0008D1       0020
          1 0008D2  0501 0819                            BBT      s:4312,PREL

      674     3829    2         Y@DLTRCR = -Y@DLTRCR;

   3829   1 0008D4  D847 0014                            LDR,R5   Y@SRHHI,AUTO
          1 0008D6  8255                                 NEG      R5
          1 0008D7  DF47 0014                            STR,R5   Y@SRHHI,AUTO

      675     3830    3         IF Y@LINCNT=%KV_INPPRC_PSTLFT THEN DO;

   3830   1 0008D9  C847 001B                            LDR,R4   Y@LINCNT,AUTO
          1 0008DB  4D16                                 CMV,R4   22
          1 0008DC  0981 0008                            BNE      s:3834,PREL

      676     3831    3            %KV_STR.RE_REDCLM = 0;

   3831   1 0008DE  ECC7 0010                            LDB,B6   Y@STR$,AUTO
          1 0008E0  8746 0012                            CL       18,B6

      677     3832    3            Y@DLTRCR = -1;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:157  

   3832   1 0008E2  8947 0014                            LBT,'FFFF'X       Y@SRHHI,AUTO
   3832   1 0008E4       FFFF

      678     3833    3         END;

      679     3834    2         GOTO SETEDTRHT;

   3834   1 0008E5  0F81 012E                            B        s:3906,PREL

      680     3835        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:158  
      681     3836    2      CASE %KV_INPPRC_SE_DWN, %KV_INPPRC_PSTRHT, %KV_INPPRC_TAB;

      682     3837    2         IF %KV_RCRLST.EOF AND Y@SRHCUR+1=%KV_RCRLST.RCRCNT

   3837   1 0008E7  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 0008E9  82C6 000C                            LB,'0040'X        12,B6
          1 0008EB       0040
          1 0008EC  0581 0025                            BBF      s:3846,PREL
          1 0008EE  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 0008F0  6E01                                 ADV,R6   1
          1 0008F1  E946 0001                            CMR,R6   1,B6
          1 0008F3  0981 001E                            BNE      s:3846,PREL

      683     3838    2         THEN IF %KV_SSN.REDBFR.EDTLOWX~=0 OR %KV_SSN.REDONL

   3838   1 0008F5  DCC7 000E                            LDB,B5   Y@SSN$,AUTO
          1 0008F7  D845 002B                            LDR,R5   43,B5
          1 0008F9  5981 07F2                            BNEZ,R5  s:4312,PREL
          1 0008FB  82C5 0028                            LB,'0200'X        40,B5
          1 0008FD       0200
          1 0008FE  0501 07ED                            BBT      s:4312,PREL
          1 000900  C847 001B                            LDR,R4   Y@LINCNT,AUTO
          1 000902  4D2E                                 CMV,R4   46
          1 000903  0981 07E8                            BNE      s:4312,PREL

      684     3839    2           OR Y@LINCNT~=%KV_INPPRC_SE_DWN THEN GOTO INPOPR_EXIT;
      685     3840    3         ELSE DO;

      686     3841    3            %KV_SSN.REDBFR.EDTLOWX = %KV_SSN.REDBFR.NXTX;

   3841   1 000905  D845 002A                            LDR,R5   42,B5
          1 000907  DF45 002B                            STR,R5   43,B5

      687     3842    3            %KV_STR.RE_REDCLM = %KV_SSN.REDBFR.EDTLOWX+1;

   3842   1 000909  CCC7 0010                            LDB,B4   Y@STR$,AUTO
          1 00090B  5E01                                 ADV,R5   1
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:159  
          1 00090C  DF44 0012                            STR,R5   18,B4

      688     3843    3            Y@LINCNT = 0;                  /* Normal split                       */

   3843   1 00090E  8747 001B                            CL       Y@LINCNT,AUTO

      689     3844    3            GOTO SPLIT_ONE;

   3844   1 000910  0F81 0399                            B        s:4066,PREL

      690     3845    3         END;
      691     3846    3         IF Y@LINCNT~=%KV_INPPRC_SE_DWN THEN DO;

   3846   1 000912  E847 001B                            LDR,R6   Y@LINCNT,AUTO
          1 000914  6D2E                                 CMV,R6   46
          1 000915  0901 0008                            BE       s:3850,PREL

      692     3847    3            %KV_STR.RE_REDCLM = 1;

   3847   1 000917  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 000919  5C01                                 LDV,R5   1
          1 00091A  DF45 0012                            STR,R5   18,B5

      693     3848    3            Y@DLTRCR = 1;

   3848   1 00091C  DF47 0014                            STR,R5   Y@SRHHI,AUTO

      694     3849    3         END;

      695     3850    2         GOTO SETEDTRHT;

   3850   1 00091E  0F81 00F5                            B        s:3906,PREL

      696     3851
      697     3852    2      CASE %KV_INPPRC_SE_CRSHOM;

      698     3853    2         IF %KV_RCRLST.FRSRCR=%KV_RCRLST.LSTRCR THEN GOTO INPOPR_EXIT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:160  

   3853   1 000920  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 000922  E846 0004                            LDR,R6   4,B6
          1 000924  E946 0005                            CMR,R6   5,B6
          1 000926  0901 07C5                            BE       s:4312,PREL

      699     3854    2         IF KV$PTR.INPCNDPND.OPRX=1

   3854   1 000928  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 00092B  D845 001C                            LDR,R5   28,B5
          1 00092D  5D01                                 CMV,R5   1
          1 00092E  0981 000A                            BNE      s:3856,PREL

      700     3855    2         THEN Y@DLTRCR = (%KV_RCRLST.FRSRCR+%KV_RCRLST.LSTRCR+1)/2;

   3855   1 000930  EA46 0005                            ADD,R6   5,B6
          1 000932  6E01                                 ADV,R6   1
          1 000933  E370 0002                            DIV,R6   2,IMO
          1 000935  EF47 0014                            STR,R6   Y@SRHHI,AUTO
          1 000937  0F81 000B                            B        s:3858,PREL

      701     3856    2         ELSE IF KV$PTR.INPCNDPND.OPRX<1 THEN Y@DLTRCR = %KV_RCRLST.FRSRCR;

   3856   1 000939  0881 0005                            BAGE     s:3857,PREL

   3856   1 00093B  EF47 0014                            STR,R6   Y@SRHHI,AUTO
          1 00093D  0F81 0005                            B        s:3858,PREL

      702     3857    2         ELSE Y@DLTRCR = %KV_RCRLST.LSTRCR;

   3857   1 00093F  C846 0005                            LDR,R4   5,B6
          1 000941  CF47 0014                            STR,R4   Y@SRHHI,AUTO

      703     3858    2         Y@DLTRCR = Y@DLTRCR-Y@SRHCUR;

   3858   1 000943  E847 0014                            LDR,R6   Y@SRHHI,AUTO
          1 000945  E247 0016                            SUB,R6   Y@SRHCUR,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:161  
          1 000947  EF47 0014                            STR,R6   Y@SRHHI,AUTO

      704     3859    2         IF Y@DLTRCR=0 THEN GOTO INPOPR_EXIT;

   3859   1 000949  6901 07A2                            BEZ,R6   s:4312,PREL

      705     3860    2         ELSE GOTO SETEDTRHT;

   3860   1 00094B  0F81 00C8                            B        s:3906,PREL

      706     3861        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:162  
      707     3862    2      CASE %KV_INPPRC_FNDPSTCHR, %KV_INPPRC_FNDPSTWRD;

      708     3863    3         IF NOT %KV_MVD.EDTRHT\PRM_FND.RVRDRC THEN DO;

   3863   1 00094D  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000950  DCC6 0006                            LDB,B5   6,B6
          1 000952  E845 0015                            LDR,R6   21,B5
          1 000954  6009                                 SOL,R6   9
          1 000955  E570 8000                            AND,R6   -32768,IMO
          1 000957  CCC7 0004                            LDB,B4   @PRM_INPOPR_DUMMY,AUTO
          1 000959  D844 0001                            LDR,R5   1,B4
          1 00095B  D570 8000                            AND,R5   -32768,IMO
          1 00095D  E655                                 XOR,R6   R5
          1 00095E  6981 000B                            BNEZ,R6  s:3867,PREL

      709     3864    3            Y@DLTRCR = -1;

   3864   1 000960  8947 0014                            LBT,'FFFF'X       Y@SRHHI,AUTO
   3864   1 000962       FFFF

      710     3865    3            IF Y@SRHCUR=0 THEN ALTRETURN;

   3865   1 000963  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 000965  6981 0010                            BNEZ,R6  s:3863,PREL

   3865   1 000967  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      711     3866    3         END;
      712     3867    2         ELSE IF Y@SRHCUR=%KV_RCRLST.RCRCNT-1 THEN ALTRETURN;

   3867   1 00096A  BCC7 0006                            LDB,B3   Y@RCRLST$,AUTO
          1 00096C  E843 0001                            LDR,R6   1,B3
          1 00096E  6EFF                                 ADV,R6   -1
          1 00096F  E947 0016                            CMR,R6   Y@SRHCUR,AUTO
          1 000971  0981 0004                            BNE      s:3863,PREL

   3867   1 000973  C380 0000 0000  xent                 LNJ,B4   X6A_AALT
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:163  

   3863   1                              SRHNXT          null
      713     3868    2   SRHNXT:;
      714     3869    2         Y@KEY$ = %KV_RCRLST.RCR$(Y@SRHCUR+Y@DLTRCR);

   3869   1 000976  E847 0016            SRHNXT          LDR,R6   Y@SRHCUR,AUTO
          1 000978  EA47 0014                            ADD,R6   Y@SRHHI,AUTO
          1 00097A  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 00097C  B856                                 LDR,R3   R6
          1 00097D  3E08                                 ADV,R3   8
          1 00097E  DCB6                                 LDB,B5   ,B6,R3
          1 00097F  DFC7 0008                            STB,B5   Y@KEY$,AUTO

      715     3870    2         Y@TMP32B.TOP = Y@KEYLNG+LENGTHV(KV$RCR);

   3870   1 000981  E847 0013                            LDR,R6   Y@KEYLNG,AUTO
          1 000983  6E06                                 ADV,R6   6
          1 000984  EF47 0017                            STR,R6   Y@TMP32,AUTO

      716     3871    2         Y@TMP32B.BTM = Y@KEY$->KV$RCR.RCRBYTSIZ+Y@TMP32B.TOP;

   3871   1 000986  EA45 0001                            ADD,R6   1,B5
          1 000988  EF47 0018                            STR,R6   Y@TMP32+1,AUTO

      717     3872    3         IF Y@DLTRCR>0 THEN DO;

   3872   1 00098A  D847 0014                            LDR,R5   Y@SRHHI,AUTO
          1 00098C  5A81 0009                            BLEZ,R5  s:3876,PREL

      718     3873    3            Y@TMP32B.TOP = Y@TMP32B.BTM-1;

   3873   1 00098E  6EFF                                 ADV,R6   -1
          1 00098F  EF47 0017                            STR,R6   Y@TMP32,AUTO

      719     3874    3            Y@TMP32B.BTM = Y@KEYLNG+LENGTHV(KV$RCR)-1;

   3874   1 000991  C847 0013                            LDR,R4   Y@KEYLNG,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:164  
          1 000993  4E05                                 ADV,R4   5
          1 000994  CF47 0018                            STR,R4   Y@TMP32+1,AUTO

      720     3875    3         END;

      721     3876    3         IF Y@LINCNT=%KV_INPPRC_FNDPSTWRD THEN DO WHILE '1'B;

   3876   1 000996  E847 001B                            LDR,R6   Y@LINCNT,AUTO
          1 000998  6D0D                                 CMV,R6   13
          1 000999  0981 003C                            BNE      s:3895,PREL

      722     3877    4            IF Y@DLTRCR>0 THEN DO UNTIL Y@LINCNT=0;

   3877   1 00099B  E847 0014                            LDR,R6   Y@SRHHI,AUTO
          1 00099D  6A81 0016                            BLEZ,R6  s:3885,PREL

      723     3878    4               Y@TMP32B.BTM = Y@TMP32B.BTM+1;

   3878   1 00099F  8AC7 0018                            INC      Y@TMP32+1,AUTO

      724     3879    4               IF Y@KEY$->RCR_BYT(Y@TMP32B.BTM)~=ASCBIN(' ') THEN GOTO CHRFND;

   3879   1 0009A1  ECC7 0008                            LDB,B6   Y@KEY$,AUTO
          1 0009A3  B847 0018                            LDR,R3   Y@TMP32+1,AUTO
          1 0009A5  E0B6                                 LDH,R6   ,B6,R3
          1 0009A6  6D20                                 CMV,R6   32
          1 0009A7  0981 0065                            BNE      s:3898,PREL

      725     3880    5               IF Y@TMP32B.BTM>Y@TMP32B.TOP THEN DO;

   3880   1 0009A9  B947 0017                            CMR,R3   Y@TMP32,AUTO
          1 0009AB  0A81 0005                            BALE     s:3884,PREL

      726     3881    5                  Y@TMP32B.BTM = Y@TMP32B.BTM+1;

   3881   1 0009AD  8AC7 0018                            INC      Y@TMP32+1,AUTO

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:165  
      727     3882    5                  Y@LINCNT = 0;

   3882   1 0009AF  8747 001B                            CL       Y@LINCNT,AUTO

      728     3883    5               END;

      729     3884    4            END;

   3884   1 0009B1  E847 001B                            LDR,R6   Y@LINCNT,AUTO
          1 0009B3  69EC                                 BNEZ,R6  s:3878,SPREL

      730     3885    3            Y@TMP32B.BTM = Y@TMP32B.BTM-1;

   3885   1 0009B4  88C7 0018                            DEC      Y@TMP32+1,AUTO

      731     3886    3            IF Y@TMP32B.BTM<Y@TMP32B.TOP THEN Y@LINCNT = 0;

   3886   1 0009B6  E847 0018                            LDR,R6   Y@TMP32+1,AUTO
          1 0009B8  E947 0017                            CMR,R6   Y@TMP32,AUTO
          1 0009BA  0881 0003                            BAGE     s:3887,PREL

   3886   1 0009BC  8747 001B                            CL       Y@LINCNT,AUTO

      732     3887    3            IF Y@TMP32B.BTM>=Y@TMP32B.TOP

   3887   1 0009BE  0801 000B                            BAL      s:3889,PREL
          1 0009C0  ECC7 0008                            LDB,B6   Y@KEY$,AUTO
          1 0009C2  B856                                 LDR,R3   R6
          1 0009C3  D0B6                                 LDH,R5   ,B6,R3
          1 0009C4  5D20                                 CMV,R5   32
          1 0009C5  0901 0004                            BE       s:3889,PREL

      733     3888    3              AND Y@KEY$->RCR_BYT(Y@TMP32B.BTM)~=ASCBIN(' ') THEN Y@LINCNT = 0;

   3888   1 0009C7  8747 001B                            CL       Y@LINCNT,AUTO
          1 0009C9  0FD2                                 B        s:3877,SPREL

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:166  
      734     3889    4            ELSE IF Y@LINCNT=0 THEN DO;

   3889   1 0009CA  D847 001B                            LDR,R5   Y@LINCNT,AUTO
          1 0009CC  59CF                                 BNEZ,R5  s:3877,SPREL

      735     3890    4               %KV_STR.RE_REDCLM = Y@TMP32B.BTM-Y@TMP32B.TOP+2;

   3890   1 0009CD  E247 0017                            SUB,R6   Y@TMP32,AUTO
          1 0009CF  ECC7 0010                            LDB,B6   Y@STR$,AUTO
          1 0009D1  6E02                                 ADV,R6   2
          1 0009D2  EF46 0012                            STR,R6   18,B6

      736     3891    4               GOTO SETEDTRHT;

   3891   1 0009D4  0F81 003F                            B        s:3906,PREL

      737     3892    4            END;
      738     3893    3         END;

      739     3894    3         ELSE DO UNTIL Y@KEY$->RCR_BYT(Y@TMP32B.BTM)=Y@SRHLO;

      740     3895    4            IF Y@TMP32B.TOP=Y@TMP32B.BTM THEN DO;

   3895   1 0009D6  E847 0017                            LDR,R6   Y@TMP32,AUTO
          1 0009D8  E947 0018                            CMR,R6   Y@TMP32+1,AUTO
          1 0009DA  0981 0020                            BNE      s:3902,PREL

      741     3896    4               IF Y@DLTRCR>0 THEN Y@DLTRCR = Y@DLTRCR+1;

   3896   1 0009DC  D847 0014                            LDR,R5   Y@SRHHI,AUTO
          1 0009DE  5A81 0005                            BLEZ,R5  s:3897,PREL

   3896   1 0009E0  8AC7 0014                            INC      Y@SRHHI,AUTO
          1 0009E2  0F81 0003                            B        s:3898,PREL

      742     3897    4               ELSE Y@DLTRCR = Y@DLTRCR-1;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:167  
   3897   1 0009E4  88C7 0014                            DEC      Y@SRHHI,AUTO

      743     3898    4               IF Y@SRHCUR+Y@DLTRCR=%KV_RCRLST.RCRCNT OR Y@SRHCUR+Y@DLTRCR<0

   3898   1 0009E6  D847 0016                            LDR,R5   Y@SRHCUR,AUTO
          1 0009E8  DA47 0014                            ADD,R5   Y@SRHHI,AUTO
          1 0009EA  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 0009EC  D946 0001                            CMR,R5   1,B6
          1 0009EE  0901 0007                            BE       s:3899,PREL
          1 0009F0  D847 0016                            LDR,R5   Y@SRHCUR,AUTO
          1 0009F2  DA47 0014                            ADD,R5   Y@SRHHI,AUTO
          1 0009F4  5881 0004                            BGEZ,R5  s:3900,PREL

      744     3899    4               THEN ALTRETURN;

   3899   1 0009F6  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      745     3900    4               GOTO SRHNXT;

   3900   1 0009F9  0F81 FF7C                            B        s:3863,PREL

      746     3901    4            END;
      747     3902    3            IF Y@DLTRCR>0 THEN Y@TMP32B.BTM = Y@TMP32B.BTM+1;

   3902   1 0009FB  D847 0014                            LDR,R5   Y@SRHHI,AUTO
          1 0009FD  5A81 0005                            BLEZ,R5  s:3903,PREL

   3902   1 0009FF  8AC7 0018                            INC      Y@TMP32+1,AUTO
          1 000A01  0F81 0003                            B        s:3904,PREL

      748     3903    3            ELSE Y@TMP32B.BTM = Y@TMP32B.BTM-1;

   3903   1 000A03  88C7 0018                            DEC      Y@TMP32+1,AUTO

      749     3904    3         END;

   3904   1 000A05  ECC7 0008                            LDB,B6   Y@KEY$,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:168  
          1 000A07  B847 0018                            LDR,R3   Y@TMP32+1,AUTO
          1 000A09  C0B6                                 LDH,R4   ,B6,R3
          1 000A0A  C947 0015                            CMR,R4   Y@SRHLO,AUTO
          1 000A0C  09CA                                 BNE      s:3895,SPREL

   3898   1                              CHRFND          null
      750     3905    2   CHRFND:;
      751     3906    2         %KV_STR.RE_REDCLM = Y@TMP32B.BTM-Y@KEYLNG-LENGTHV(KV$RCR)+1;

   3906   1 000A0D  B247 0013            CHRFND          SUB,R3   Y@KEYLNG,AUTO
          1 000A0F  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 000A11  3EFB                                 ADV,R3   -5
          1 000A12  BF45 0012                            STR,R3   18,B5

   3906   1                              SETEDTRHT       null
      752     3907    2   SETEDTRHT:;
      753     3908    2         IF Y@DLTRCR>0 THEN %KV_MVD.EDTRHT = '1'B;

   3908   1 000A14  E847 0014            SETEDTRHT       LDR,R6   Y@SRHHI,AUTO
          1 000A16  6A81 000B                            BLEZ,R6  s:3909,PREL

   3908   1 000A18  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000A1B  DCC6 0006                            LDB,B5   6,B6
          1 000A1D  8945 0015                            LBT,'0040'X       21,B5
          1 000A1F       0040
          1 000A20  0F81 0009                            B        s:3908,PREL

      754     3909    2         ELSE %KV_MVD.EDTRHT = '0'B;

   3909   1 000A22  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000A25  DCC6 0006                            LDB,B5   6,B6
          1 000A27  8845 0015                            LBF,'0040'X       21,B5
          1 000A29       0040

   3908   1                              NXTRCR          null
      755     3910    2   NXTRCR:;
      756     3911    2         %KV_RCRLST.CRTRCR = Y@SRHCUR+Y@DLTRCR;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:169  

   3911   1 000A2A  EA47 0016            NXTRCR          ADD,R6   Y@SRHCUR,AUTO
          1 000A2C  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 000A2E  EF45 0006                            STR,R6   6,B5

      757     3912    2         CALL Y$UPDRCR ALTRET(ABRRED);

   3912   1 000A30  E3C0 1413                            LNJ,B6   s:0,PREL
          1 000A32       0723                            DC       s:4338,PREL
          1 000A33  0F81 06CC                            B        s:4321,PREL

      758     3913        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:170  
      759     3914    2      CASE %KV_INPPRC_JOIN, %KV_INPPRC_DEL, %KV_INPPRC_DELLFT;

      760     3915    2         IF %KV_SSN.REDBFR.EDTLOWX=0 AND %KV_SSN.REDBFR__.DATBYTSIZ~=0

   3915   1 000A35  ECC7 000E                            LDB,B6   Y@SSN$,AUTO
          1 000A37  E846 002B                            LDR,R6   43,B6
          1 000A39  6981 0009                            BNEZ,R6  s:3917,PREL
          1 000A3B  D846 0033                            LDR,R5   51,B6
          1 000A3D  5901 0005                            BEZ,R5   s:3917,PREL

      761     3916    2         THEN Y@SRHCUR = Y@SRHCUR-1;

   3916   1 000A3F  88C7 0016                            DEC      Y@SRHCUR,AUTO
          1 000A41  0F81 0008                            B        s:3918,PREL

      762     3917    2         ELSE IF %KV_SSN.REDBFR.EDTLOWX<%KV_SSN.REDBFR.NXTX THEN RETURN;

   3917   1 000A43  E946 002A                            CMR,R6   42,B6
          1 000A45  0881 0004                            BAGE     s:3918,PREL

   3917   1 000A47  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      763     3918    2         IF Y@SRHCUR<0 OR Y@SRHCUR+1>=%KV_RCRLST.RCRCNT

   3918   1 000A4A  D847 0016                            LDR,R5   Y@SRHCUR,AUTO
          1 000A4C  5801 001A                            BLZ,R5   s:3920,PREL
          1 000A4E  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 000A50  5E01                                 ADV,R5   1
          1 000A51  D945 0001                            CMR,R5   1,B5
          1 000A53  0801 0016                            BAL      s:3921,PREL
          1 000A55  82C5 000C                            LB,'0040'X        12,B5
          1 000A57       0040
          1 000A58  0581 000E                            BBF      s:3920,PREL
          1 000A5A  9847 0016                            LDR,R1   Y@SRHCUR,AUTO
          1 000A5C  1E08                                 ADV,R1   8
          1 000A5D  CC95                                 LDB,B4   ,B5,R1
          1 000A5E  82C4 0002                            LB,'0020'X        2,B4
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:171  
          1 000A60       0020
          1 000A61  0501 0005                            BBT      s:3920,PREL
          1 000A63  C846 002A                            LDR,R4   42,B6
          1 000A65  4A81 0004                            BLEZ,R4  s:3921,PREL

      764     3919    2           AND (NOT %KV_RCRLST.EOF OR %KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.NEW
      765     3920    2           OR %KV_SSN.REDBFR.NXTX>0) THEN RETURN;

   3920   1 000A67  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      766     3921    3         IF %KV_SSN.REDBFR.EDTLOWX>%KV_SSN.REDBFR.NXTX THEN DO;

   3921   1 000A6A  E946 002A                            CMR,R6   42,B6
          1 000A6C  0A81 000E                            BALE     s:3926,PREL

      767     3922    3            %KV_SSN.REDBFR.EDTLOWX = %KV_SSN.REDBFR.NXTX;

   3922   1 000A6E  E846 002A                            LDR,R6   42,B6
          1 000A70  EF46 002B                            STR,R6   43,B6

      768     3923    3            %KV_STR.RE_REDCLM = %KV_SSN.REDBFR.EDTLOWX+1;

   3923   1 000A72  CCC7 0010                            LDB,B4   Y@STR$,AUTO
          1 000A74  6E01                                 ADV,R6   1
          1 000A75  EF44 0012                            STR,R6   18,B4

      769     3924    3            %KV_SSN.REDBFR__.DATBYTSIZ = %KV_SSN.REDBFR.NXTX;

   3924   1 000A77  C846 002A                            LDR,R4   42,B6
          1 000A79  CF46 0033                            STR,R4   51,B6

      770     3925    3         END;

      771     3926    2         Y@KEY$ = %KV_RCRLST.RCR$(Y@SRHCUR);

   3926   1 000A7B  A847 0016                            LDR,R2   Y@SRHCUR,AUTO
          1 000A7D  2E08                                 ADV,R2   8
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:172  
          1 000A7E  CCA5                                 LDB,B4   ,B5,R2
          1 000A7F  CFC7 0008                            STB,B4   Y@KEY$,AUTO

      772     3927        /*
      773     3928           We have one possibly updated record to join to an adjacent one.
      774     3929           Insure that no data is lost by deleting before the data in the
      775     3930           deleted record has been sent in the combined record.
      776     3931        */
      777     3932    3         IF %KV_SSN.REDBFR__.DATBYTSIZ=0 THEN DO;

   3932   1 000A81  E846 0033                            LDR,R6   51,B6
          1 000A83  6981 000A                            BNEZ,R6  s:3942,PREL

      778     3933        /*
      779     3934           A simple case. The possibly updated record has no data to be lost.
      780     3935           Just delete this record and position to the next one (down).
      781     3936        */
      782     3937    3            Y@KEY$->KV$RCR.RCRBYTSIZ = -1;

   3937   1 000A85  8944 0001                            LBT,'FFFF'X       1,B4
   3937   1 000A87       FFFF

      783     3938    3            %KV_RCRLST.CRTRCR = %KV_RCRLST.CRTRCR+1;

   3938   1 000A88  8AC5 0006                            INC      6,B5

      784     3939    3            Y@SRHCUR = Y@SRHCUR-1;

   3939   1 000A8A  88C7 0016                            DEC      Y@SRHCUR,AUTO

      785     3940    3            GOTO JOIN_DONE;

   3940   1 000A8C  0F81 01B7                            B        s:4043,PREL

      786     3941    3         END;
      787     3942    2         Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR+1);

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:173  
   3942   1 000A8E  9847 0016                            LDR,R1   Y@SRHCUR,AUTO
          1 000A90  1E09                                 ADV,R1   9
          1 000A91  BC95                                 LDB,B3   ,B5,R1
          1 000A92  BFC7 000A                            STB,B3   Y@RCR$,AUTO

      788     3943    3         IF Y@SRHCUR=%KV_RCRLST.CRTRCR AND %KV_RCR.RCRBYTSIZ=0 THEN DO;

   3943   1 000A94  C847 0016                            LDR,R4   Y@SRHCUR,AUTO
          1 000A96  C945 0006                            CMR,R4   6,B5
          1 000A98  0981 000A                            BNE      s:3949+2,PREL
          1 000A9A  E843 0001                            LDR,R6   1,B3
          1 000A9C  6981 0006                            BNEZ,R6  s:3949+2,PREL

      789     3944        /*
      790     3945           The possibly updated record has all the joint data. Send it first
      791     3946           if updated.
      792     3947        */
      793     3948    3            CALL Y$UPDRCR ALTRET(ABRRED);

   3948   1 000A9E  E3C0 13A5                            LNJ,B6   s:0,PREL
          1 000AA0       06B5                            DC       s:4338,PREL

      794     3949    2         END; ELSE IF Y@SRHCUR~=%KV_RCRLST.CRTRCR

   3949   1 000AA1  0F81 0193                            B        s:4041,PREL

   3949   1 000AA3  0901 004B                            BE       s:3980,PREL
          1 000AA5  E844 0001                            LDR,R6   1,B4
          1 000AA7  6981 0047                            BNEZ,R6  s:3980,PREL

      795     3950    3           AND Y@KEY$->KV$RCR.RCRBYTSIZ=0 THEN DO;

      796     3951        /*
      797     3952           The possibly updated record has all the joint data, but the wrong key.
      798     3953           Shuffle things around a bit.
      799     3954        */
      800     3955    3            Y@BFRSIZ = Y@KEYLNG+LENGTHV(KV$RCR)+%KV_SSN.REDBFR__.DATBYTSIZ;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:174  

   3955   1 000AA9  E847 0013                            LDR,R6   Y@KEYLNG,AUTO
          1 000AAB  EA46 0033                            ADD,R6   51,B6
          1 000AAD  6E06                                 ADV,R6   6
          1 000AAE  EF47 0015                            STR,R6   Y@SRHLO,AUTO

      801     3956    3            IF Y@KEY$->KV$RCR.STRBYTSIZ<Y@BFRSIZ

   3956   1 000AB0  E904                                 CMR,R6   ,B4
          1 000AB1  0A81 002F                            BALE     s:3971,PREL
          1 000AB3  E903                                 CMR,R6   ,B3
          1 000AB4  0A01 002C                            BAG      s:3971,PREL

      802     3957    4              AND %KV_RCR.STRBYTSIZ>=Y@BFRSIZ THEN DO;

      803     3958        /*
      804     3959           Switching the RCRBFRs would save allocating a new one. Do it.
      805     3960        */
      806     3961    4               %KV_RCR.RCRBYTSIZ = 0;      /* Force writing the record.          */

   3961   1 000AB6  8743 0001                            CL       1,B3

      807     3962    4               SUBSTR(Y@KEY$->KV$RCR.TXT,Y@KEYLNG,Y@KEYLNG) =

   3962   1 000AB8  AB83                                 LAB,B2   ,B3
          1 000AB9  2C06                                 LDV,R2   6
          1 000ABA  E847 0013                            LDR,R6   Y@KEYLNG,AUTO
          1 000ABC  BB84                                 LAB,B3   ,B4
          1 000ABD  B856                                 LDR,R3   R6
          1 000ABE  3E06                                 ADV,R3   6
          1 000ABF  0008                                 MMM

      808     3963    4                 SUBSTR(%KV_RCR.TXT,0,Y@KEYLNG);
      809     3964    4               SUBSTR(%KV_RCR.TXT,0,Y@KEYLNG) =

   3964   1 000AC0  ACC7 0008                            LDB,B2   Y@KEY$,AUTO
          1 000AC2  2C06                                 LDV,R2   6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:175  
          1 000AC3  E847 0013                            LDR,R6   Y@KEYLNG,AUTO
          1 000AC5  BCC7 000A                            LDB,B3   Y@RCR$,AUTO
          1 000AC7  3C06                                 LDV,R3   6
          1 000AC8  0008                                 MMM

      810     3965    4                 SUBSTR(Y@KEY$->KV$RCR.TXT,0,Y@KEYLNG);
      811     3966    4               SUBSTR(Y@KEY$->KV$RCR.TXT,0,Y@KEYLNG) =

   3966   1 000AC9  ACC7 0008                            LDB,B2   Y@KEY$,AUTO
          1 000ACB  A847 0013                            LDR,R2   Y@KEYLNG,AUTO
          1 000ACD  2E06                                 ADV,R2   6
          1 000ACE  E847 0013                            LDR,R6   Y@KEYLNG,AUTO
          1 000AD0  BB82                                 LAB,B3   ,B2
          1 000AD1  3C06                                 LDV,R3   6
          1 000AD2  0008                                 MMM

      812     3967    4                 SUBSTR(Y@KEY$->KV$RCR.TXT,Y@KEYLNG,Y@KEYLNG);
      813     3968    4               %KV_RCRLST.RCR$(Y@SRHCUR) = Y@RCR$;

   3968   1 000AD3  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 000AD5  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 000AD7  B847 0016                            LDR,R3   Y@SRHCUR,AUTO
          1 000AD9  3E08                                 ADV,R3   8
          1 000ADA  EFB5                                 STB,B6   ,B5,R3

      814     3969    4               %KV_RCRLST.RCR$(Y@SRHCUR+1) = Y@KEY$;

   3969   1 000ADB  9CC7 0008                            LDB,B1   Y@KEY$,AUTO
          1 000ADD  A847 0016                            LDR,R2   Y@SRHCUR,AUTO
          1 000ADF  2E09                                 ADV,R2   9
          1 000AE0  9FA5                                 STB,B1   ,B5,R2

      815     3970    4            END;

      816     3971    3            CALL Y$UPDRCR ALTRET(ABRRED);

   3971   1 000AE1  E3C0 1362                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:176  
          1 000AE3       0672                            DC       s:4338,PREL

      817     3972        /*
      818     3973           Display it in the right place.
      819     3974        */
      820     3975    3            %KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.UPD = '1'B;

   3975   1 000AE4  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 000AE6  B847 0016                            LDR,R3   Y@SRHCUR,AUTO
          1 000AE8  3E08                                 ADV,R3   8
          1 000AE9  DCB6                                 LDB,B5   ,B6,R3
          1 000AEA  8945 0002                            LBT,'0040'X       2,B5
          1 000AEC       0040

      821     3976    3         END; ELSE DO;

   3976   1 000AED  0F81 0147                            B        s:4041,PREL

      822     3977        /*
      823     3978           Both records have data in them. package it up.
      824     3979        */
      825     3980    3            SUBSTR(ADDR(KV@VDH_OTPLCL)->CHARS,0,Y@KEYLNG) =

   3980   1 000AEF  AB84                                 LAB,B2   ,B4
          1 000AF0  2C06                                 LDV,R2   6
          1 000AF1  E847 0013                            LDR,R6   Y@KEYLNG,AUTO
          1 000AF3  BB87                                 LAB,B3   ,AUTO
          1 000AF4  3C62                                 LDV,R3   98
          1 000AF5  0008                                 MMM

      826     3981    3              SUBSTR(Y@KEY$->KV$RCR.TXT,0,Y@KEYLNG);
      827     3982    3            Y@BFRSIZ = Y@KEYLNG+LENGTHV(KV$RCR)+%KV_SSN.REDBFR__.DATBYTSIZ;

   3982   1 000AF6  ECC7 000E                            LDB,B6   Y@SSN$,AUTO
          1 000AF8  E847 0013                            LDR,R6   Y@KEYLNG,AUTO
          1 000AFA  EA46 0033                            ADD,R6   51,B6
          1 000AFC  6E06                                 ADV,R6   6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:177  
          1 000AFD  EF47 0015                            STR,R6   Y@SRHLO,AUTO

      828     3983    3            IF %KV_RCRLST.TXTEDT THEN Y@BFRSIZ = Y@BFRSIZ+2;

   3983   1 000AFF  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 000B01  82C5 000D                            LB,'0040'X        13,B5
          1 000B03       0040
          1 000B04  0581 0004                            BBF      s:3984,PREL

   3983   1 000B06  6E02                                 ADV,R6   2
          1 000B07  EF47 0015                            STR,R6   Y@SRHLO,AUTO

      829     3984    4            IF Y@SRHCUR=%KV_RCRLST.CRTRCR THEN DO;

   3984   1 000B09  D847 0016                            LDR,R5   Y@SRHCUR,AUTO
          1 000B0B  D945 0006                            CMR,R5   6,B5
          1 000B0D  0981 000B                            BNE      s:3988,PREL

      830     3985    4               Y@BFRSIZ = Y@BFRSIZ+%KV_RCR.RCRBYTSIZ;

   3985   1 000B0F  9CC7 000A                            LDB,B1   Y@RCR$,AUTO
          1 000B11  EA41 0001                            ADD,R6   1,B1
          1 000B13  EF47 0015                            STR,R6   Y@SRHLO,AUTO

      831     3986    4               Y@KEY$ = Y@RCR$;

   3986   1 000B15  9FC7 0008                            STB,B1   Y@KEY$,AUTO

      832     3987    4            END; ELSE DO;

   3987   1 000B17  0F81 002D                            B        s:3996,PREL

      833     3988    4               %KV_STR.RE_REDCLM = Y@KEY$->KV$RCR.RCRBYTSIZ+1;

   3988   1 000B19  9CC7 0010                            LDB,B1   Y@STR$,AUTO
          1 000B1B  ECC7 0008                            LDB,B6   Y@KEY$,AUTO
          1 000B1D  C846 0001                            LDR,R4   1,B6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:178  
          1 000B1F  4E01                                 ADV,R4   1
          1 000B20  CF41 0012                            STR,R4   18,B1

      834     3989    4               Y@BFRSIZ = Y@BFRSIZ+Y@KEY$->KV$RCR.RCRBYTSIZ;

   3989   1 000B22  EA46 0001                            ADD,R6   1,B6
          1 000B24  EF47 0015                            STR,R6   Y@SRHLO,AUTO

      835     3990    4               Y@KEY$->KV$RCR.NEW = %KV_RCR.NEW;

   3990   1 000B26  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 000B28  B846 0002                            LDR,R3   2,B6
          1 000B2A  ECC7 0008                            LDB,B6   Y@KEY$,AUTO
          1 000B2C  BAC6 0002                            SRM,R3,'0020'X    2,B6
          1 000B2E       0020

      836     3991    4               SUBSTR(Y@KEY$->KV$RCR.TXT,0,Y@KEYLNG) =

   3991   1 000B2F  ACC7 000A                            LDB,B2   Y@RCR$,AUTO
          1 000B31  2C06                                 LDV,R2   6
          1 000B32  E847 0013                            LDR,R6   Y@KEYLNG,AUTO
          1 000B34  BB86                                 LAB,B3   ,B6
          1 000B35  3C06                                 LDV,R3   6
          1 000B36  0008                                 MMM

      837     3992    4                 SUBSTR(%KV_RCR.TXT,0,Y@KEYLNG);
      838     3993    4               %KV_RCRLST.RCR$(Y@SRHCUR) = Y@RCR$;

   3993   1 000B37  DCC7 000A                            LDB,B5   Y@RCR$,AUTO
          1 000B39  ACC7 0006                            LDB,B2   Y@RCRLST$,AUTO
          1 000B3B  B847 0016                            LDR,R3   Y@SRHCUR,AUTO
          1 000B3D  3E08                                 ADV,R3   8
          1 000B3E  DFB2                                 STB,B5   ,B2,R3

      839     3994    4               %KV_RCRLST.RCR$(Y@SRHCUR+1) = Y@KEY$;

   3994   1 000B3F  9CC7 0008                            LDB,B1   Y@KEY$,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:179  
          1 000B41  A847 0016                            LDR,R2   Y@SRHCUR,AUTO
          1 000B43  2E09                                 ADV,R2   9
          1 000B44  9FA2                                 STB,B1   ,B2,R2

      840     3995    4            END;

      841     3996    3            Y@DLTRCR = Y@SRHCUR;

   3996   1 000B45  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 000B47  EF47 0014                            STR,R6   Y@SRHHI,AUTO

      842     3997    3            CALL Y$GETRCRBFR;

   3997   1 000B49  E3C0 1003                            LNJ,B6   s:0,PREL
          1 000B4B       0001                            DC       s:3998,PREL

      843     3998    3            Y@BFRSIZ = %KV_SSN.REDBFR__.DATBYTSIZ;

   3998   1 000B4C  ECC7 000E                            LDB,B6   Y@SSN$,AUTO
          1 000B4E  E846 0033                            LDR,R6   51,B6
          1 000B50  EF47 0015                            STR,R6   Y@SRHLO,AUTO

      844     3999    3            IF %KV_SSN.REDBFR.EDTLOWX=0

   3999   1 000B52  D846 002B                            LDR,R5   43,B6
          1 000B54  5981 000C                            BNEZ,R5  s:4001,PREL

      845     4000    3            THEN Y@DLTRCR = Y@KEYLNG+%KV_RCR.RCRBYTSIZ-Y@BFRSIZ;

   4000   1 000B56  DCC7 000A                            LDB,B5   Y@RCR$,AUTO
          1 000B58  C847 0013                            LDR,R4   Y@KEYLNG,AUTO
          1 000B5A  CA45 0001                            ADD,R4   1,B5
          1 000B5C  C256                                 SUB,R4   R6
          1 000B5D  CF47 0014                            STR,R4   Y@SRHHI,AUTO
          1 000B5F  0F81 0005                            B        s:4002,PREL

      846     4001    3            ELSE Y@DLTRCR = Y@KEYLNG;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:180  

   4001   1 000B61  C847 0013                            LDR,R4   Y@KEYLNG,AUTO
          1 000B63  CF47 0014                            STR,R4   Y@SRHHI,AUTO

      847     4002    3            SUBSTR(%KV_RCR.TXT,Y@DLTRCR,Y@BFRSIZ) =

   4002   1 000B65  DCC6 0030                            LDB,B5   48,B6
          1 000B67  B846 0032                            LDR,R3   50,B6
          1 000B69  AB85                                 LAB,B2   ,B5
          1 000B6A  A853                                 LDR,R2   R3
          1 000B6B  BCC7 000A                            LDB,B3   Y@RCR$,AUTO
          1 000B6D  B854                                 LDR,R3   R4
          1 000B6E  3E06                                 ADV,R3   6
          1 000B6F  0008                                 MMM

      848     4003    3              SUBSTR(%KV_SSN.REDBFR__.ADR$->CHARS,%KV_SSN.REDBFR__.BYTX,Y@BFRSIZ);
      849     4004    3            Y@BFRSIZ = Y@KEY$->KV$RCR.RCRBYTSIZ;

   4004   1 000B70  ECC7 0008                            LDB,B6   Y@KEY$,AUTO
          1 000B72  E846 0001                            LDR,R6   1,B6
          1 000B74  EF47 0015                            STR,R6   Y@SRHLO,AUTO

      850     4005    3            IF Y@KEYLNG~=Y@DLTRCR THEN Y@DLTRCR = Y@KEYLNG;

   4005   1 000B76  D847 0013                            LDR,R5   Y@KEYLNG,AUTO
          1 000B78  D947 0014                            CMR,R5   Y@SRHHI,AUTO
          1 000B7A  0901 0005                            BE       s:4006,PREL

   4005   1 000B7C  DF47 0014                            STR,R5   Y@SRHHI,AUTO
          1 000B7E  0F81 0008                            B        s:4007,PREL

      851     4006    3            ELSE Y@DLTRCR = Y@KEYLNG+%KV_RCR.RCRBYTSIZ-Y@BFRSIZ;

   4006   1 000B80  CCC7 000A                            LDB,B4   Y@RCR$,AUTO
          1 000B82  DA44 0001                            ADD,R5   1,B4
          1 000B84  D256                                 SUB,R5   R6
          1 000B85  DF47 0014                            STR,R5   Y@SRHHI,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:181  

      852     4007    3            SUBSTR(%KV_RCR.TXT,Y@DLTRCR,Y@BFRSIZ) =

   4007   1 000B87  AB86                                 LAB,B2   ,B6
          1 000B88  A847 0013                            LDR,R2   Y@KEYLNG,AUTO
          1 000B8A  2E06                                 ADV,R2   6
          1 000B8B  BCC7 000A                            LDB,B3   Y@RCR$,AUTO
          1 000B8D  B855                                 LDR,R3   R5
          1 000B8E  3E06                                 ADV,R3   6
          1 000B8F  0008                                 MMM

      853     4008    3              SUBSTR(Y@KEY$->KV$RCR.TXT,Y@KEYLNG,Y@BFRSIZ);
      854     4009    4            IF %KV_RCRLST.TXTEDT THEN DO;

   4009   1 000B90  CCC7 0006                            LDB,B4   Y@RCRLST$,AUTO
          1 000B92  82C4 000D                            LB,'0040'X        13,B4
          1 000B94       0040
          1 000B95  0581 0090                            BBF      s:4038,PREL

      855     4010    4               IF Y@DLTRCR=Y@KEYLNG THEN Y@DLTRCR = Y@DLTRCR+Y@BFRSIZ+2;

   4010   1 000B97  E847 0014                            LDR,R6   Y@SRHHI,AUTO
          1 000B99  E947 0013                            CMR,R6   Y@KEYLNG,AUTO
          1 000B9B  0981 0006                            BNE      s:4011,PREL

   4010   1 000B9D  EA47 0015                            ADD,R6   Y@SRHLO,AUTO
          1 000B9F  6E02                                 ADV,R6   2
          1 000BA0  EF47 0014                            STR,R6   Y@SRHHI,AUTO

      856     4011    4               Y@LINCNT = Y@DLTRCR-2;

   4011   1 000BA2  6EFE                                 ADV,R6   -2
          1 000BA3  EF47 001B                            STR,R6   Y@LINCNT,AUTO

      857     4012    4               SUBSTR(%KV_RCR.TXT,Y@LINCNT,1) = ' ';

   4012   1 000BA5  3C20                                 LDV,R3   32
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:182  
          1 000BA6  BCC7 000A                            LDB,B3   Y@RCR$,AUTO
          1 000BA8  A856                                 LDR,R2   R6
          1 000BA9  2E06                                 ADV,R2   6
          1 000BAA  B7A3                                 STH,R3   ,B3,R2

      858     4013    4               SUBSTR(%KV_RCR.TXT,Y@LINCNT+1,1) = ' ';

   4013   1 000BAB  9856                                 LDR,R1   R6
          1 000BAC  1E07                                 ADV,R1   7
          1 000BAD  B793                                 STH,R3   ,B3,R1

      859     4014    5               DO WHILE SUBSTR(%KV_RCR.TXT,Y@DLTRCR,1)=' ';

   4014   1 000BAE  0F81 000D                            B        s:4017,PREL

      860     4015    5                  IF Y@DLTRCR-Y@KEYLNG=%KV_RCR.RCRBYTSIZ THEN EXIT;

   4015   1 000BB0  E847 0014                            LDR,R6   Y@SRHHI,AUTO
          1 000BB2  E247 0013                            SUB,R6   Y@KEYLNG,AUTO
          1 000BB4  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 000BB6  E946 0001                            CMR,R6   1,B6
          1 000BB8  0901 000B                            BE       s:4019,PREL

      861     4016    5                  Y@DLTRCR = Y@DLTRCR+1;

   4016   1 000BBA  8AC7 0014                            INC      Y@SRHHI,AUTO

      862     4017    5               END;

   4017   1 000BBC  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 000BBE  B847 0014                            LDR,R3   Y@SRHHI,AUTO
          1 000BC0  3E06                                 ADV,R3   6
          1 000BC1  E0B6                                 LDH,R6   ,B6,R3
          1 000BC2  6D20                                 CMV,R6   32
          1 000BC3  096D                                 BE       s:4015,SPREL

      863     4018    5               DO UNTIL SUBSTR(%KV_RCR.TXT,Y@LINCNT,1)~=' ';
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:183  

      864     4019    5                  Y@LINCNT = Y@LINCNT-1;

   4019   1 000BC4  88C7 001B                            DEC      Y@LINCNT,AUTO

      865     4020    5                  IF Y@LINCNT=Y@KEYLNG THEN EXIT;

   4020   1 000BC6  E847 001B                            LDR,R6   Y@LINCNT,AUTO
          1 000BC8  E947 0013                            CMR,R6   Y@KEYLNG,AUTO
          1 000BCA  0901 0008                            BE       s:4022,PREL

      866     4021    5               END;

   4021   1 000BCC  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 000BCE  B856                                 LDR,R3   R6
          1 000BCF  3E06                                 ADV,R3   6
          1 000BD0  D0B6                                 LDH,R5   ,B6,R3
          1 000BD1  5D20                                 CMV,R5   32
          1 000BD2  0972                                 BE       s:4019,SPREL

      867     4022    5               IF SUBSTR(%KV_RCR.TXT,Y@LINCNT,1)=' ' THEN DO;

   4022   1 000BD3  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 000BD5  B856                                 LDR,R3   R6
          1 000BD6  3E06                                 ADV,R3   6
          1 000BD7  D0B6                                 LDH,R5   ,B6,R3
          1 000BD8  5D20                                 CMV,R5   32
          1 000BD9  0981 000F                            BNE      s:4025+2,PREL

      868     4023    5                  IF %KV_STR.AUTTABCLM>1

   4023   1 000BDB  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 000BDD  C2C5 001E                            LLH,R4   30,B5
          1 000BDF  4D01                                 CMV,R4   1
          1 000BE0  0381 0020                            BLE      s:4031,PREL

      869     4024    5                  THEN Y@LINCNT = Y@LINCNT+%KV_STR.AUTTABCLM-1;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:184  

   4024   1 000BE2  CA56                                 ADD,R4   R6
          1 000BE3  E854                                 LDR,R6   R4
          1 000BE4  6EFF                                 ADV,R6   -1
          1 000BE5  EF47 001B                            STR,R6   Y@LINCNT,AUTO

      870     4025    4               END; ELSE IF (SUBSTR(%KV_RCR.TXT,Y@LINCNT,1)='.'

   4025   1 000BE7  0F81 0019                            B        s:4031,PREL

   4025   1 000BE9  5D2E                                 CMV,R5   46
          1 000BEA  0901 0007                            BE       s:4025+11,PREL
          1 000BEC  5D21                                 CMV,R5   33
          1 000BED  0901 0004                            BE       s:4025+11,PREL
          1 000BEF  5D3F                                 CMV,R5   63
          1 000BF0  0981 000D                            BNE      s:4030,PREL
          1 000BF2  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 000BF4  82C5 000E                            LB,'0080'X        14,B5
          1 000BF6       0080
          1 000BF7  0501 0006                            BBT      s:4030,PREL

      871     4026    4                 OR SUBSTR(%KV_RCR.TXT,Y@LINCNT,1)='!'
      872     4027    4                 OR SUBSTR(%KV_RCR.TXT,Y@LINCNT,1)='?')
      873     4028    4                 AND NOT %KV_RCRLST.ONESPCEDT
      874     4029    4               THEN Y@LINCNT = Y@LINCNT+3;

   4029   1 000BF9  6E03                                 ADV,R6   3
          1 000BFA  EF47 001B                            STR,R6   Y@LINCNT,AUTO
          1 000BFC  0F81 0004                            B        s:4031,PREL

      875     4030    4               ELSE Y@LINCNT = Y@LINCNT+2;

   4030   1 000BFE  6E02                                 ADV,R6   2
          1 000BFF  EF47 001B                            STR,R6   Y@LINCNT,AUTO

      876     4031    4               IF Y@DLTRCR<=Y@LINCNT THEN EXIT;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:185  
   4031   1 000C01  E947 0014                            CMR,R6   Y@SRHHI,AUTO
          1 000C03  0881 0022                            BAGE     s:4038,PREL

      877     4032    4               Y@BFRSIZ = %KV_RCR.RCRBYTSIZ-Y@DLTRCR+Y@KEYLNG;

   4032   1 000C05  D846 0001                            LDR,R5   1,B6
          1 000C07  D247 0014                            SUB,R5   Y@SRHHI,AUTO
          1 000C09  DA47 0013                            ADD,R5   Y@KEYLNG,AUTO
          1 000C0B  DF47 0015                            STR,R5   Y@SRHLO,AUTO

      878     4033    4               %KV_STR.RE_REDCLM = Y@LINCNT-Y@KEYLNG+1;

   4033   1 000C0D  E247 0013                            SUB,R6   Y@KEYLNG,AUTO
          1 000C0F  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 000C11  6E01                                 ADV,R6   1
          1 000C12  EF45 0012                            STR,R6   18,B5

      879     4034    4               %KV_RCR.RCRBYTSIZ = %KV_RCR.RCRBYTSIZ+Y@LINCNT-Y@DLTRCR;

   4034   1 000C14  C846 0001                            LDR,R4   1,B6
          1 000C16  CA47 001B                            ADD,R4   Y@LINCNT,AUTO
          1 000C18  C247 0014                            SUB,R4   Y@SRHHI,AUTO
          1 000C1A  CF46 0001                            STR,R4   1,B6

      880     4035    4               SUBSTR(%KV_RCR.TXT,Y@LINCNT,Y@BFRSIZ) =

   4035   1 000C1C  AB86                                 LAB,B2   ,B6
          1 000C1D  A847 0014                            LDR,R2   Y@SRHHI,AUTO
          1 000C1F  2E06                                 ADV,R2   6
          1 000C20  E855                                 LDR,R6   R5
          1 000C21  BB82                                 LAB,B3   ,B2
          1 000C22  B847 001B                            LDR,R3   Y@LINCNT,AUTO
          1 000C24  3E06                                 ADV,R3   6
          1 000C25  0008                                 MMM

      881     4036    4                 SUBSTR(%KV_RCR.TXT,Y@DLTRCR,Y@BFRSIZ);
      882     4037    4            END;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:186  

      883     4038    3            %KV_RCRLST.SNDRCR = Y@SRHCUR;

   4038   1 000C26  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 000C28  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 000C2A  EF46 0007                            STR,R6   7,B6

      884     4039    3            IF %KV_STR.SNDMAXNMBRCR~=0 THEN CALL Y$SNDRCR;

   4039   1 000C2C  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 000C2E  D845 0019                            LDR,R5   25,B5
          1 000C30  5901 0004                            BEZ,R5   s:4041,PREL

   4039   1 000C32  E3C0 1168                            LNJ,B6   s:0,PREL
          1 000C34       0001                            DC       s:4041,PREL

      885     4040    3         END;

      886     4041    2         Y@KEY$ = %KV_RCRLST.RCR$(Y@SRHCUR+1);

   4041   1 000C35  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 000C37  B847 0016                            LDR,R3   Y@SRHCUR,AUTO
          1 000C39  3E09                                 ADV,R3   9
          1 000C3A  DCB6                                 LDB,B5   ,B6,R3
          1 000C3B  DFC7 0008                            STB,B5   Y@KEY$,AUTO

      887     4042    2         Y@KEY$->KV$RCR.RCRBYTSIZ = -1;

   4042   1 000C3D  8945 0001                            LBT,'FFFF'X       1,B5
   4042   1 000C3F       FFFF

      888     4043    2         %KV_RCRLST.CRTRCR = Y@SRHCUR;

   4043   1 000C40  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 000C42  EF46 0006                            STR,R6   6,B6

   4043   1                              JOIN_DONE       null
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:187  
      889     4044        /*E*  ERROR: KVE-E$RECORD_DELETED-0
      890     4045              MESSAGE:A normal join operation caused this record to disappear.
      891     4046        */
      892     4047    2   JOIN_DONE:;
      893     4048    2         %KV_RCRLST.DLTRCREXS = '1'B;

   4048   1 000C44  ECC7 0006            JOIN_DONE       LDB,B6   Y@RCRLST$,AUTO
          1 000C46  8946 000D                            LBT,'0080'X       13,B6
          1 000C48       0080

      894     4049    2         IF Y@KEY$->KV$RCR.NEW THEN EXIT;  /* No need to report this one         */

   4049   1 000C49  DCC7 0008                            LDB,B5   Y@KEY$,AUTO
          1 000C4B  82C5 0002                            LB,'0020'X        2,B5
          1 000C4D       0020
          1 000C4E  0501 04B1                            BBT      s:4321,PREL

      895     4050    2         IF %KV_RCRLST.SNDRCR>=0 THEN %KV_RCRLST.SNDRQR.DLT = '1'B;

   4050   1 000C50  E846 0007                            LDR,R6   7,B6
          1 000C52  6801 0006                            BLZ,R6   s:4051,PREL

   4050   1 000C54  8946 000C                            LBT,'0004'X       12,B6
   4050   1 000C56       0004
          1 000C57  0F81 0006                            B        s:4052,PREL

      896     4051    2         ELSE %KV_RCRLST.SNDRCR = Y@SRHCUR+1;

   4051   1 000C59  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 000C5B  6E01                                 ADV,R6   1
          1 000C5C  EF46 0007                            STR,R6   7,B6

      897     4052    2         IF %KV_STR.SNDMAXNMBRCR~=0 THEN CALL Y$SNDRCR;

   4052   1 000C5E  CCC7 0010                            LDB,B4   Y@STR$,AUTO
          1 000C60  D844 0019                            LDR,R5   25,B4
          1 000C62  5901 049D                            BEZ,R5   s:4321,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:188  

   4052   1 000C64  E3C0 1136                            LNJ,B6   s:0,PREL
          1 000C66       0001                            DC       s:4052+9,PREL
          1 000C67  0F81 0498                            B        s:4321,PREL

      898     4053        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:189  
      899     4054    2      CASE %KV_INPPRC_SPLIT;

      900     4055    3         IF %KV_SSN.REDBFR.EDTLOWX>%KV_SSN.REDBFR.NXTX THEN DO;

   4055   1 000C69  ECC7 000E                            LDB,B6   Y@SSN$,AUTO
          1 000C6B  E846 002B                            LDR,R6   43,B6
          1 000C6D  E946 002A                            CMR,R6   42,B6
          1 000C6F  0A81 000E                            BALE     s:4060,PREL

      901     4056    3            %KV_SSN.REDBFR.EDTLOWX = %KV_SSN.REDBFR.NXTX;

   4056   1 000C71  E846 002A                            LDR,R6   42,B6
          1 000C73  EF46 002B                            STR,R6   43,B6

      902     4057    3            %KV_STR.RE_REDCLM = %KV_SSN.REDBFR.EDTLOWX+1;

   4057   1 000C75  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 000C77  6E01                                 ADV,R6   1
          1 000C78  EF45 0012                            STR,R6   18,B5

      903     4058    3            %KV_SSN.REDBFR__.DATBYTSIZ = %KV_SSN.REDBFR.NXTX;

   4058   1 000C7A  D846 002A                            LDR,R5   42,B6
          1 000C7C  DF46 0033                            STR,R5   51,B6

      904     4059    3         END;

      905     4060    3         IF Y@DLTRCR=1 AND %KV_RCRLST.DFRCNT=0 THEN DO;

   4060   1 000C7E  E847 0014                            LDR,R6   Y@SRHHI,AUTO
          1 000C80  6D01                                 CMV,R6   1
          1 000C81  0981 001D                            BNE      s:4065,PREL
          1 000C83  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 000C85  D0C5 000D                            LDH,R5   13,B5
          1 000C87  5981 0017                            BNEZ,R5  s:4065,PREL

      906     4061    3            Y@DLTRCR = MAXIMUM (0,KV$PTR.INPCNDPND.OPRX);
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:190  

   4061   1 000C89  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 000C8C  C844 001C                            LDR,R4   28,B4
          1 000C8E  C970 0000                            CMR,R4   0,IMO
          1 000C90  0881 0002                            BAGE     s:4061+10,PREL
          1 000C92  4C00                                 LDV,R4   0
          1 000C93  E854                                 LDR,R6   R4
          1 000C94  EF47 0014                            STR,R6   Y@SRHHI,AUTO

      907     4062    3            IF Y@DLTRCR=0 THEN EXIT;

   4062   1 000C96  6901 0008                            BEZ,R6   s:4065,PREL

      908     4063    3            %KV_RCRLST.DFRCNT = %KV_RCRLST.LSTRCR-%KV_RCRLST.CRTRCR+1;

   4063   1 000C98  C845 0005                            LDR,R4   5,B5
          1 000C9A  C245 0006                            SUB,R4   6,B5
          1 000C9C  4E01                                 ADV,R4   1
          1 000C9D  C7C5 000D                            STH,R4   13,B5

      909     4064    3         END;

      910     4065    2         Y@LINCNT = Y@DLTRCR;

   4065   1 000C9F  EF47 001B                            STR,R6   Y@LINCNT,AUTO

      911     4066    2         IF Y@LINCNT>0 AND %KV_STR.WRDWRPCLM<12 THEN GOTO INPOPR_EXIT;

   4066   1 000CA1  6A81 0008                            BLEZ,R6  s:4066,PREL
          1 000CA3  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 000CA5  D2C5 001D                            LLH,R5   29,B5
          1 000CA7  5D0C                                 CMV,R5   12
          1 000CA8  0201 0443                            BL       s:4312,PREL

   4066   1                              SPLIT_ONE       null
      912     4067    2   SPLIT_ONE:;
      913     4068    3         IF Y@LINCNT>0 THEN DO;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:191  

   4068   1 000CAA  E847 001B            SPLIT_ONE       LDR,R6   Y@LINCNT,AUTO
          1 000CAC  6A81 01E3                            BLEZ,R6  s:4182,PREL

      914     4069        /*
      915     4070           Find the spot to split the line at.
      916     4071        */
      917     4072    3            Y@DLTRCR = %KV_STR.WRDWRPCLM;

   4072   1 000CAE  ECC7 0010                            LDB,B6   Y@STR$,AUTO
          1 000CB0  D2C6 001D                            LLH,R5   29,B6
          1 000CB2  DF47 0014                            STR,R5   Y@SRHHI,AUTO

      918     4073    3            Y@KEY$ = %KV_SSN.REDBFR__.ADR$;

   4073   1 000CB4  DCC7 000E                            LDB,B5   Y@SSN$,AUTO
          1 000CB6  CCC5 0030                            LDB,B4   48,B5
          1 000CB8  CFC7 0008                            STB,B4   Y@KEY$,AUTO

      919     4074    4            IF Y@DLTRCR<%KV_SSN.REDBFR.NXTX THEN DO;

   4074   1 000CBA  D945 002A                            CMR,R5   42,B5
          1 000CBC  0881 0042                            BAGE     s:4090,PREL

      920     4075    4               %KV_STR.RE_REDCLM = %KV_SSN.REDBFR.NXTX+1;

   4075   1 000CBE  C845 002A                            LDR,R4   42,B5
          1 000CC0  4E01                                 ADV,R4   1
          1 000CC1  CF46 0012                            STR,R4   18,B6

      921     4076    5               DO UNTIL Y@DLTRCR<0;

      922     4077    5                  IF SUBSTR(Y@KEY$->CHARS,Y@DLTRCR,1)=' ' THEN EXIT;

   4077   1 000CC3  ECC7 0008                            LDB,B6   Y@KEY$,AUTO
          1 000CC5  B847 0014                            LDR,R3   Y@SRHHI,AUTO
          1 000CC7  E0B6                                 LDH,R6   ,B6,R3
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:192  
          1 000CC8  6D20                                 CMV,R6   32
          1 000CC9  0901 0006                            BE       s:4080,PREL

      923     4078    5                  Y@DLTRCR = Y@DLTRCR-1;

   4078   1 000CCB  88C7 0014                            DEC      Y@SRHHI,AUTO

      924     4079    5               END;

   4079   1 000CCD  E847 0014                            LDR,R6   Y@SRHHI,AUTO
          1 000CCF  68F4                                 BGEZ,R6  s:4077,SPREL

      925     4080    4               IF Y@DLTRCR<%KV_STR.WRDWRPCLM/2 OR Y@DLTRCR<%KV_STR.AUTTABCLM

   4080   1 000CD0  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 000CD2  E2C5 001D                            LLH,R6   29,B5
          1 000CD4  6041                                 SOR,R6   1
          1 000CD5  6801 000B                            BLZ,R6   s:4081,PREL
          1 000CD7  E947 0014                            CMR,R6   Y@SRHHI,AUTO
          1 000CD9  0A01 0007                            BAG      s:4081,PREL
          1 000CDB  E2C5 001E                            LLH,R6   30,B5
          1 000CDD  E947 0014                            CMR,R6   Y@SRHHI,AUTO
          1 000CDF  0A81 0007                            BALE     s:4082,PREL

      926     4081    4               THEN Y@DLTRCR = %KV_STR.WRDWRPCLM;

   4081   1 000CE1  E2C5 001D                            LLH,R6   29,B5
          1 000CE3  EF47 0014                            STR,R6   Y@SRHHI,AUTO
          1 000CE5  0F81 0003                            B        s:4083,PREL

      927     4082    4               ELSE Y@DLTRCR = Y@DLTRCR+1;

   4082   1 000CE7  8AC7 0014                            INC      Y@SRHHI,AUTO

      928     4083    4               %KV_SSN.REDBFR.EDTLOWX = Y@DLTRCR;

   4083   1 000CE9  CCC7 000E                            LDB,B4   Y@SSN$,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:193  
          1 000CEB  E847 0014                            LDR,R6   Y@SRHHI,AUTO
          1 000CED  EF44 002B                            STR,R6   43,B4

      929     4084    4               IF Y@LINCNT=1 AND %KV_RCRLST.DFRCNT>0

   4084   1 000CEF  D847 001B                            LDR,R5   Y@LINCNT,AUTO
          1 000CF1  5D01                                 CMV,R5   1
          1 000CF2  0981 019D                            BNE      s:4182,PREL
          1 000CF4  BCC7 0006                            LDB,B3   Y@RCRLST$,AUTO
          1 000CF6  C0C3 000D                            LDH,R4   13,B3
          1 000CF8  4A81 0197                            BLEZ,R4  s:4182,PREL

      930     4085    4               THEN %KV_RCRLST.DFROPR = %KV_INPPRC_SPLIT;

   4085   1 000CFA  3C2B                                 LDV,R3   43
          1 000CFB  B7C3 000E                            STH,R3   14,B3

      931     4086    4            END; ELSE DO;

   4086   1 000CFD  0F81 0192                            B        s:4182,PREL

      932     4087        /*
      933     4088           The current one's too short - see if we can get anything from the next one.
      934     4089        */
      935     4090    4               IF %KV_RCRLST.CRTRCR+1=%KV_RCRLST.RCRCNT OR %KV_RCRLST.DFRCNT=1

   4090   1 000CFF  BCC7 0006                            LDB,B3   Y@RCRLST$,AUTO
          1 000D01  C843 0006                            LDR,R4   6,B3
          1 000D03  4E01                                 ADV,R4   1
          1 000D04  C943 0001                            CMR,R4   1,B3
          1 000D06  0901 03E5                            BE       s:4312,PREL
          1 000D08  B0C3 000D                            LDH,R3   13,B3
          1 000D0A  3D01                                 CMV,R3   1
          1 000D0B  0901 03E0                            BE       s:4312,PREL

      936     4091    4               THEN GOTO INPOPR_EXIT;
      937     4092    5               DO WHILE %KV_SSN.REDBFR__.BFRBYTSIZ<Y@DLTRCR+1;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:194  

   4092   1 000D0D  0F81 001A                            B        s:4099,PREL

      938     4093    6                  CALL KVS$GETREDBFR WHENALTRETURN DO;

   4093   1 000D0F  CBF0 0000                            LAB,B4   0,IMO
          1 000D11  E380 0000 0000  xent                 LNJ,B6   KVS$GETREDBFR
          1 000D14       0003                            DC       s:4094,PREL
          1 000D15  0F81 000C                            B        s:4098,PREL

      939     4094    6                     %KV_STR.ERR.COD = %E$CANTGETCTX;

   4094   1 000D17  ECC7 0010                            LDB,B6   Y@STR$,AUTO
          1 000D19  E870 05C8                            LDR,R6   1480,IMO
          1 000D1B  EF46 0013                            STR,R6   19,B6

      940     4095    6                     CALL Y$UPDRCRSND;

   4095   1 000D1D  E3C0 118A                            LNJ,B6   s:0,PREL
          1 000D1F       0001                            DC       s:4096,PREL

      941     4096    6                     GOTO ABRRED;

   4096   1 000D20  0F81 0434                            B        s:4338,PREL

      942     4097    6                  END;
      943     4098    5                  Y@KEY$ = %KV_SSN.REDBFR__.ADR$;

   4098   1 000D22  ECC7 000E                            LDB,B6   Y@SSN$,AUTO
          1 000D24  DCC6 0030                            LDB,B5   48,B6
          1 000D26  DFC7 0008                            STB,B5   Y@KEY$,AUTO

      944     4099    5               END;

   4099   1 000D28  ECC7 000E                            LDB,B6   Y@SSN$,AUTO
          1 000D2A  E846 0034                            LDR,R6   52,B6
          1 000D2C  6801 0004                            BLZ,R6   s:4100,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:195  
          1 000D2E  E947 0014                            CMR,R6   Y@SRHHI,AUTO
          1 000D30  0ADF                                 BALE     s:4093,SPREL

      945     4100    4               Y@SRHLO = %KV_SSN.REDBFR.NXTX;

   4100   1 000D31  D846 002A                            LDR,R5   42,B6
          1 000D33  DF47 0015                            STR,R5   Y@SRHLO,AUTO

      946     4101    5               DO WHILE Y@SRHLO>0;

   4101   1 000D35  5A81 000C                            BLEZ,R5  s:4105,PREL

      947     4102    5                  Y@SRHLO = Y@SRHLO-1;

   4102   1 000D37  88C7 0015                            DEC      Y@SRHLO,AUTO

      948     4103    5                  IF SUBSTR(Y@KEY$->CHARS,Y@SRHLO,1)~=' ' THEN EXIT;

   4103   1 000D39  ECC7 0008                            LDB,B6   Y@KEY$,AUTO
          1 000D3B  B847 0015                            LDR,R3   Y@SRHLO,AUTO
          1 000D3D  E0B6                                 LDH,R6   ,B6,R3
          1 000D3E  6D20                                 CMV,R6   32
          1 000D3F  0981 0002                            BNE      s:4105,PREL

      949     4104    5               END;

   4104   1 000D41  3A76                                 BGZ,R3   s:4102,SPREL

      950     4105    4               SUBSTR(Y@KEY$->CHARS,Y@SRHLO+1,1) = ' ';

   4105   1 000D42  6C20                                 LDV,R6   32
          1 000D43  ECC7 0008                            LDB,B6   Y@KEY$,AUTO
          1 000D45  B847 0015                            LDR,R3   Y@SRHLO,AUTO
          1 000D47  3E01                                 ADV,R3   1
          1 000D48  E7B6                                 STH,R6   ,B6,R3

      951     4106    4               SUBSTR(Y@KEY$->CHARS,Y@SRHLO+2,1) = ' ';
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:196  

   4106   1 000D49  A847 0015                            LDR,R2   Y@SRHLO,AUTO
          1 000D4B  2E02                                 ADV,R2   2
          1 000D4C  E7A6                                 STH,R6   ,B6,R2

      952     4107    4               IF Y@SRHLO>=0 THEN IF (SUBSTR(Y@KEY$->CHARS,Y@SRHLO,1)='!'

   4107   1 000D4D  D847 0015                            LDR,R5   Y@SRHLO,AUTO
          1 000D4F  5801 001D                            BLZ,R5   s:4114,PREL

   4107   1 000D51  9855                                 LDR,R1   R5
          1 000D52  C096                                 LDH,R4   ,B6,R1
          1 000D53  4D21                                 CMV,R4   33
          1 000D54  0901 0007                            BE       s:4107+15,PREL
          1 000D56  4D3F                                 CMV,R4   63
          1 000D57  0901 0004                            BE       s:4107+15,PREL
          1 000D59  4D2E                                 CMV,R4   46
          1 000D5A  0981 000D                            BNE      s:4112,PREL
          1 000D5C  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 000D5E  82C5 000E                            LB,'0080'X        14,B5
          1 000D60       0080
          1 000D61  0501 0006                            BBT      s:4112,PREL

      953     4108    4                 OR SUBSTR(Y@KEY$->CHARS,Y@SRHLO,1)='?'
      954     4109    4                 OR SUBSTR(Y@KEY$->CHARS,Y@SRHLO,1)='.')
      955     4110    4                 AND NOT %KV_RCRLST.ONESPCEDT
      956     4111    4               THEN Y@SRHLO = Y@SRHLO+3;

   4111   1 000D63  1E03                                 ADV,R1   3
          1 000D64  9F47 0015                            STR,R1   Y@SRHLO,AUTO
          1 000D66  0F81 001A                            B        s:4117,PREL

      957     4112    4               ELSE Y@SRHLO = Y@SRHLO+2;

   4112   1 000D68  9852                                 LDR,R1   R2
          1 000D69  9F47 0015                            STR,R1   Y@SRHLO,AUTO
          1 000D6B  0F81 0015                            B        s:4117,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:197  

      958     4113    5               ELSE DO;                    /* Start at autotab column            */

      959     4114    5                  Y@SRHLO = MAXIMUM (1,%KV_STR.AUTTABCLM)-1;

   4114   1 000D6D  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 000D6F  C2C5 001E                            LLH,R4   30,B5
          1 000D71  C970 0001                            CMR,R4   1,IMO
          1 000D73  0281 0002                            BGE      s:4114+9,PREL
          1 000D75  4C01                                 LDV,R4   1
          1 000D76  D854                                 LDR,R5   R4
          1 000D77  5EFF                                 ADV,R5   -1
          1 000D78  DF47 0015                            STR,R5   Y@SRHLO,AUTO

      960     4115    5                  SUBSTR(Y@KEY$->CHARS,0,Y@SRHLO) = ' ';

   4115   1 000D7A  DA70 2000                            ADD,R5   8192,IMO
          1 000D7C  0021                                 ALR      ;
          1 000D7D       4178 2000                                ALPHANUM('2000'X,IMO,,1),;
          1 000D7F       4006 0000                                ALPHANUM(0,B6,,R5,FILL)

      961     4116    5               END;

      962     4117    4               Y@DLTRCR = Y@DLTRCR-Y@SRHLO; /* Space available                   */

   4117   1 000D81  437F                                 CSYNC    s:4115+6,SPREL
          1 000D82  D847 0014                            LDR,R5   Y@SRHHI,AUTO
          1 000D84  D247 0015                            SUB,R5   Y@SRHLO,AUTO
          1 000D86  DF47 0014                            STR,R5   Y@SRHHI,AUTO

      963     4118    4               Y@KEY$ = %KV_RCRLST.RCR$(%KV_RCRLST.CRTRCR+1);

   4118   1 000D88  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 000D8A  B846 0006                            LDR,R3   6,B6
          1 000D8C  3E09                                 ADV,R3   9
          1 000D8D  DCB6                                 LDB,B5   ,B6,R3
          1 000D8E  DFC7 0008                            STB,B5   Y@KEY$,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:198  

      964     4119    4               Y@REDLIN = 0;

   4119   1 000D90  8747 0012                            CL       Y@KEYCMP,AUTO

      965     4120    5               DO WHILE '1'B;

      966     4121    5                  IF SUBSTR(Y@KEY$->KV$RCR.TXT,Y@REDLIN+Y@KEYLNG,1)~=' ' THEN EXIT;

   4121   1 000D92  E847 0012                            LDR,R6   Y@KEYCMP,AUTO
          1 000D94  EA47 0013                            ADD,R6   Y@KEYLNG,AUTO
          1 000D96  ECC7 0008                            LDB,B6   Y@KEY$,AUTO
          1 000D98  B856                                 LDR,R3   R6
          1 000D99  3E06                                 ADV,R3   6
          1 000D9A  E0B6                                 LDH,R6   ,B6,R3
          1 000D9B  6D20                                 CMV,R6   32
          1 000D9C  0981 000A                            BNE      s:4125,PREL

      967     4122    5                  IF Y@REDLIN>=Y@KEY$->KV$RCR.RCRBYTSIZ THEN EXIT;

   4122   1 000D9E  E847 0012                            LDR,R6   Y@KEYCMP,AUTO
          1 000DA0  E946 0001                            CMR,R6   1,B6
          1 000DA2  0881 0004                            BAGE     s:4125,PREL

      968     4123    5                  Y@REDLIN = Y@REDLIN+1;

   4123   1 000DA4  8AC7 0012                            INC      Y@KEYCMP,AUTO

      969     4124    5               END;

   4124   1 000DA6  0FEC                                 B        s:4121,SPREL

      970     4125    4               IF Y@REDLIN>=Y@KEY$->KV$RCR.RCRBYTSIZ

   4125   1 000DA7  E847 0012                            LDR,R6   Y@KEYCMP,AUTO
          1 000DA9  E946 0001                            CMR,R6   1,B6
          1 000DAB  0881 0340                            BAGE     s:4312,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:199  
          1 000DAD  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 000DAF  D2C5 001E                            LLH,R5   30,B5
          1 000DB1  5EFF                                 ADV,R5   -1
          1 000DB2  D956                                 CMR,R5   R6
          1 000DB3  0901 0007                            BE       s:4131,PREL
          1 000DB5  6981 0336                            BNEZ,R6  s:4312,PREL
          1 000DB7  C2C5 001E                            LLH,R4   30,B5
          1 000DB9  4981 0332                            BNEZ,R4  s:4312,PREL

      971     4126    4                 OR Y@REDLIN~=%KV_STR.AUTTABCLM-1
      972     4127    4                 AND (Y@REDLIN~=0 OR %KV_STR.AUTTABCLM~=0) THEN GOTO INPOPR_EXIT;
      973     4128        /*
      974     4129           The next one starts at autotab.  See if a word ends before DLTRCR more bytes.
      975     4130        */
      976     4131    4               Y@DLTRCR = MINIMUM(Y@KEY$->KV$RCR.RCRBYTSIZ, Y@REDLIN+Y@DLTRCR);

   4131   1 000DBB  EA47 0014                            ADD,R6   Y@SRHHI,AUTO
          1 000DBD  E946 0001                            CMR,R6   1,B6
          1 000DBF  0A81 0003                            BALE     s:4131+8,PREL
          1 000DC1  E846 0001                            LDR,R6   1,B6
          1 000DC3  EF47 0014                            STR,R6   Y@SRHHI,AUTO

      977     4132    4               IF Y@DLTRCR<Y@KEY$->KV$RCR.RCRBYTSIZ

   4132   1 000DC5  E946 0001                            CMR,R6   1,B6
          1 000DC7  0881 0018                            BAGE     s:4137,PREL

      978     4133    5               THEN DO WHILE Y@DLTRCR>Y@REDLIN;

   4133   1 000DC9  E947 0012                            CMR,R6   Y@KEYCMP,AUTO
          1 000DCB  0A81 0014                            BALE     s:4137,PREL

      979     4134    5                  IF SUBSTR(Y@KEY$->KV$RCR.TXT,Y@DLTRCR+Y@KEYLNG,1)=' ' THEN EXIT;

   4134   1 000DCD  E847 0014                            LDR,R6   Y@SRHHI,AUTO
          1 000DCF  EA47 0013                            ADD,R6   Y@KEYLNG,AUTO
          1 000DD1  ECC7 0008                            LDB,B6   Y@KEY$,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:200  
          1 000DD3  B856                                 LDR,R3   R6
          1 000DD4  3E06                                 ADV,R3   6
          1 000DD5  E0B6                                 LDH,R6   ,B6,R3
          1 000DD6  6D20                                 CMV,R6   32
          1 000DD7  0901 0008                            BE       s:4137,PREL

      980     4135    5                  Y@DLTRCR = Y@DLTRCR-1;

   4135   1 000DD9  88C7 0014                            DEC      Y@SRHHI,AUTO

      981     4136    5               END;

   4136   1 000DDB  E847 0014                            LDR,R6   Y@SRHHI,AUTO
          1 000DDD  E947 0012                            CMR,R6   Y@KEYCMP,AUTO
          1 000DDF  0A6E                                 BAG      s:4134,SPREL

      982     4137    4               %KV_STR.RE_REDCLM = 1;

   4137   1 000DE0  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 000DE2  6C01                                 LDV,R6   1
          1 000DE3  EF45 0012                            STR,R6   18,B5

      983     4138    5               IF %KV_RCRLST.DFRCNT>1 THEN DO;

   4138   1 000DE5  CCC7 0006                            LDB,B4   Y@RCRLST$,AUTO
          1 000DE7  D0C4 000D                            LDH,R5   13,B4
          1 000DE9  5D01                                 CMV,R5   1
          1 000DEA  0A81 0007                            BALE     s:4142,PREL

      984     4139    5                  %KV_RCRLST.DFRCNT = %KV_RCRLST.DFRCNT-1;

   4139   1 000DEC  5EFF                                 ADV,R5   -1
          1 000DED  D7C4 000D                            STH,R5   13,B4

      985     4140    5                  %KV_RCRLST.DFROPR = %KV_INPPRC_SPLIT;

   4140   1 000DEF  5C2B                                 LDV,R5   43
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:201  
          1 000DF0  D7C4 000E                            STH,R5   14,B4

      986     4141    5               END;

      987     4142    5               IF Y@DLTRCR<=Y@REDLIN THEN DO;

   4142   1 000DF2  D847 0014                            LDR,R5   Y@SRHHI,AUTO
          1 000DF4  D947 0012                            CMR,R5   Y@KEYCMP,AUTO
          1 000DF6  0A01 000C                            BAG      s:4152,PREL

      988     4143        /*
      989     4144           Y@DLTRCR may be 1 or 2 less, because of the space insertion for !?. above.
      990     4145        */
      991     4146        /* Nothing to do - the next word is too big */
      992     4147    5                  Y@REDLIN = Y@SRHCUR;

   4147   1 000DF8  C847 0016                            LDR,R4   Y@SRHCUR,AUTO
          1 000DFA  CF47 0012                            STR,R4   Y@KEYCMP,AUTO

      993     4148    5                  %KV_RCRLST.CRTRCR = %KV_RCRLST.CRTRCR+1;

   4148   1 000DFC  8AC4 0006                            INC      6,B4

      994     4149    5                  CALL Y$UPDRCR ALTRET(ABRRED);

   4149   1 000DFE  E3C0 1045                            LNJ,B6   s:0,PREL
          1 000E00       0355                            DC       s:4338,PREL

      995     4150    5                  EXIT INPOPR;

   4150   1 000E01  0F81 02FE                            B        s:4321,PREL

      996     4151    5               END;
      997     4152    4               Y@DLTRCR = Y@DLTRCR-Y@REDLIN;

   4152   1 000E03  D247 0012                            SUB,R5   Y@KEYCMP,AUTO
          1 000E05  DF47 0014                            STR,R5   Y@SRHHI,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:202  

      998     4153    4               SUBSTR(%KV_SSN.REDBFR__.ADR$->CHARS,Y@SRHLO,Y@DLTRCR) =

   4153   1 000E07  BCC7 000E                            LDB,B3   Y@SSN$,AUTO
          1 000E09  ACC3 0030                            LDB,B2   48,B3
          1 000E0B  C847 0012                            LDR,R4   Y@KEYCMP,AUTO
          1 000E0D  CA47 0013                            ADD,R4   Y@KEYLNG,AUTO
          1 000E0F  AFC7 0056                            STB,B2   KV@SND_DAT+23,AUTO
          1 000E11  AB86                                 LAB,B2   ,B6
          1 000E12  A854                                 LDR,R2   R4
          1 000E13  2E06                                 ADV,R2   6
          1 000E14  E855                                 LDR,R6   R5
          1 000E15  BCC7 0056                            LDB,B3   KV@SND_DAT+23,AUTO
          1 000E17  B847 0015                            LDR,R3   Y@SRHLO,AUTO
          1 000E19  0008                                 MMM

      999     4154    4                 SUBSTR(Y@KEY$->KV$RCR.TXT,Y@REDLIN+Y@KEYLNG,Y@DLTRCR);
     1000     4155    4               %KV_SSN.REDBFR.NXTX = Y@SRHLO+Y@DLTRCR;

   4155   1 000E1A  E847 0015                            LDR,R6   Y@SRHLO,AUTO
          1 000E1C  EA47 0014                            ADD,R6   Y@SRHHI,AUTO
          1 000E1E  DCC7 000E                            LDB,B5   Y@SSN$,AUTO
          1 000E20  EF45 002A                            STR,R6   42,B5

     1001     4156    4               Y@SRHLO = Y@DLTRCR+Y@REDLIN;

   4156   1 000E22  C847 0014                            LDR,R4   Y@SRHHI,AUTO
          1 000E24  CA47 0012                            ADD,R4   Y@KEYCMP,AUTO
          1 000E26  CF47 0015                            STR,R4   Y@SRHLO,AUTO

     1002     4157    5               DO UNTIL SUBSTR(Y@KEY$->KV$RCR.TXT,Y@SRHLO+Y@KEYLNG,1)~=' ';

     1003     4158    5                  IF Y@SRHLO>=Y@KEY$->KV$RCR.RCRBYTSIZ THEN EXIT;

   4158   1 000E28  ECC7 0008                            LDB,B6   Y@KEY$,AUTO
          1 000E2A  E847 0015                            LDR,R6   Y@SRHLO,AUTO
          1 000E2C  E946 0001                            CMR,R6   1,B6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:203  
          1 000E2E  0881 000C                            BAGE     s:4161,PREL

     1004     4159    5                  Y@SRHLO = Y@SRHLO+1;

   4159   1 000E30  8AC7 0015                            INC      Y@SRHLO,AUTO

     1005     4160    5               END;

   4160   1 000E32  E847 0015                            LDR,R6   Y@SRHLO,AUTO
          1 000E34  EA47 0013                            ADD,R6   Y@KEYLNG,AUTO
          1 000E36  B856                                 LDR,R3   R6
          1 000E37  3E06                                 ADV,R3   6
          1 000E38  E0B6                                 LDH,R6   ,B6,R3
          1 000E39  6D20                                 CMV,R6   32
          1 000E3A  096E                                 BE       s:4158,SPREL

     1006     4161    5               IF Y@SRHLO<Y@KEY$->KV$RCR.RCRBYTSIZ THEN DO;

   4161   1 000E3B  E847 0015                            LDR,R6   Y@SRHLO,AUTO
          1 000E3D  E946 0001                            CMR,R6   1,B6
          1 000E3F  0881 002C                            BAGE     s:4171,PREL

     1007     4162    5                  Y@DLTRCR = Y@KEY$->KV$RCR.RCRBYTSIZ-Y@SRHLO;

   4162   1 000E41  E246 0001                            SUB,R6   1,B6
          1 000E43  8256                                 NEG      R6
          1 000E44  EF47 0014                            STR,R6   Y@SRHHI,AUTO

     1008     4163    5                  SUBSTR(Y@KEY$->KV$RCR.TXT,Y@REDLIN+Y@KEYLNG,Y@DLTRCR) =

   4163   1 000E46  D847 0012                            LDR,R5   Y@KEYCMP,AUTO
          1 000E48  DA47 0013                            ADD,R5   Y@KEYLNG,AUTO
          1 000E4A  C847 0015                            LDR,R4   Y@SRHLO,AUTO
          1 000E4C  CA47 0013                            ADD,R4   Y@KEYLNG,AUTO
          1 000E4E  AB86                                 LAB,B2   ,B6
          1 000E4F  A854                                 LDR,R2   R4
          1 000E50  2E06                                 ADV,R2   6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:204  
          1 000E51  BB82                                 LAB,B3   ,B2
          1 000E52  B855                                 LDR,R3   R5
          1 000E53  3E06                                 ADV,R3   6
          1 000E54  0008                                 MMM

     1009     4164    5                    SUBSTR(Y@KEY$->KV$RCR.TXT,Y@SRHLO+Y@KEYLNG,Y@DLTRCR);
     1010     4165    5                  Y@KEY$->KV$RCR.RCRBYTSIZ = Y@REDLIN+Y@DLTRCR;

   4165   1 000E55  E847 0012                            LDR,R6   Y@KEYCMP,AUTO
          1 000E57  EA47 0014                            ADD,R6   Y@SRHHI,AUTO
          1 000E59  DCC7 0008                            LDB,B5   Y@KEY$,AUTO
          1 000E5B  EF45 0001                            STR,R6   1,B5

     1011     4166    5                  Y@KEY$->KV$RCR.UPD = '1'B;

   4166   1 000E5D  8945 0002                            LBT,'0040'X       2,B5
   4166   1 000E5F       0040

     1012     4167    5                  Y@KEY$->KV$RCR.NEW = '1'B;

   4167   1 000E60  8945 0002                            LBT,'0020'X       2,B5
   4167   1 000E62       0020

     1013     4168    5                  %KV_RCRLST.CRTRCR = %KV_RCRLST.CRTRCR+1;

   4168   1 000E63  CCC7 0006                            LDB,B4   Y@RCRLST$,AUTO
          1 000E65  8AC4 0006                            INC      6,B4

     1014     4169    5                  CALL Y$UPDRCRSND ALTRET(ABRRED);

   4169   1 000E67  E3C0 1040                            LNJ,B6   s:0,PREL
          1 000E69       02EC                            DC       s:4338,PREL

     1015     4170    5               END; ELSE DO;

   4170   1 000E6A  0F81 001A                            B        s:4177,PREL

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:205  
     1016     4171    5                  Y@KEY$->KV$RCR.RCRBYTSIZ = -1;

   4171   1 000E6C  8946 0001                            LBT,'FFFF'X       1,B6
   4171   1 000E6E       FFFF

     1017     4172    5                  Y@KEY$->KV$RCR.NEW = '0'B;

   4172   1 000E6F  8846 0002                            LBF,'0020'X       2,B6
   4172   1 000E71       0020

     1018     4173    5                  CALL Y$UPDRCRSND ALTRET(ABRRED);

   4173   1 000E72  E3C0 1035                            LNJ,B6   s:0,PREL
          1 000E74       02E1                            DC       s:4338,PREL

     1019     4174    5                  %KV_RCRLST.SNDRCR = Y@SRHCUR+1;

   4174   1 000E75  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 000E77  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 000E79  6E01                                 ADV,R6   1
          1 000E7A  EF46 0007                            STR,R6   7,B6

     1020     4175    5                  IF %KV_STR.SNDMAXNMBRCR>0 THEN CALL Y$SNDRCR;

   4175   1 000E7C  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 000E7E  D845 0019                            LDR,R5   25,B5
          1 000E80  5A81 0004                            BLEZ,R5  s:4177,PREL

   4175   1 000E82  E3C0 0F18                            LNJ,B6   s:0,PREL
          1 000E84       0001                            DC       s:4177,PREL

     1021     4176    5               END;

     1022     4177    4               %KV_RCR.UPD = '1'B;

   4177   1 000E85  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 000E87  8946 0002                            LBT,'0040'X       2,B6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:206  
          1 000E89       0040

     1023     4178    4               Y@REDLIN = Y@SRHCUR;

   4178   1 000E8A  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 000E8C  EF47 0012                            STR,R6   Y@KEYCMP,AUTO

     1024     4179    4               EXIT INPOPR;

   4179   1 000E8E  0F81 0271                            B        s:4321,PREL

     1025     4180    4            END;
     1026     4181    3         END;
     1027     4182    2         Y@KEYINC = %KV_RCRLST.KEYINC;

   4182   1 000E90  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 000E92  E846 0008                            LDR,R6   8,B6
          1 000E94  EF47 0014                            STR,R6   Y@SRHHI,AUTO

     1028     4183    2         IF Y@KEYINC=65535 THEN Y@KEYINC = 0;

   4183   1 000E96  E970 FFFF                            CMR,R6   -1,IMO
          1 000E98  0981 0003                            BNE      s:4184,PREL

   4183   1 000E9A  8747 0014                            CL       Y@SRHHI,AUTO

     1029     4184    2         Y@KEY$ = ADDR(Y_BIGKEY);

   4184   1 000E9C  DB80 0000 0012  00                   LAB,B5   Y_BIGKEY
          1 000E9F  DFC7 0008                            STB,B5   Y@KEY$,AUTO

     1030     4185    3         IF Y@SRHCUR+1=%KV_RCRLST.RCRCNT THEN DO;

   4185   1 000EA1  D847 0016                            LDR,R5   Y@SRHCUR,AUTO
          1 000EA3  5E01                                 ADV,R5   1
          1 000EA4  D946 0001                            CMR,R5   1,B6
          1 000EA6  0981 001C                            BNE      s:4191,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:207  

     1031     4186    3            IF NOT %KV_RCRLST.EOF

   4186   1 000EA8  82C6 000C                            LB,'0040'X        12,B6
   4186   1 000EAA       0040
          1 000EAB  0581 0240                            BBF      s:4312,PREL
          1 000EAD  82C6 000D                            LB,'0020'X        13,B6
          1 000EAF       0020
          1 000EB0  0501 0010                            BBT      s:4190,PREL
          1 000EB2  B847 0016                            LDR,R3   Y@SRHCUR,AUTO
          1 000EB4  3E08                                 ADV,R3   8
          1 000EB5  CCB6                                 LDB,B4   ,B6,R3
          1 000EB6  82C4 0002                            LB,'0020'X        2,B4
          1 000EB8       0020
          1 000EB9  0581 0007                            BBF      s:4190,PREL
          1 000EBB  BCC7 000E                            LDB,B3   Y@SSN$,AUTO
          1 000EBD  C843 002A                            LDR,R4   42,B3
          1 000EBF  4901 022C                            BEZ,R4   s:4312,PREL

     1032     4187    3              OR NOT %KV_RCRLST.ESYAPP AND %KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.NEW
     1033     4188    3              AND %KV_SSN.REDBFR.NXTX=0
     1034     4189    3            THEN GOTO INPOPR_EXIT;
     1035     4190    3         END; ELSE DO;

   4190   1 000EC1  0F81 001C                            B        s:4196,PREL

     1036     4191    3            Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR+1);

   4191   1 000EC3  B847 0016                            LDR,R3   Y@SRHCUR,AUTO
          1 000EC5  3E09                                 ADV,R3   9
          1 000EC6  CCB6                                 LDB,B4   ,B6,R3
          1 000EC7  CFC7 000A                            STB,B4   Y@RCR$,AUTO

     1037     4192    3            IF NOT %KV_RCR.NEW OR Y@SRHCUR+2<%KV_RCRLST.RCRCNT

   4192   1 000EC9  82C4 0002                            LB,'0020'X        2,B4
   4192   1 000ECB       0020
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:208  
          1 000ECC  0581 000D                            BBF      s:4194,PREL
          1 000ECE  C847 0016                            LDR,R4   Y@SRHCUR,AUTO
          1 000ED0  4E02                                 ADV,R4   2
          1 000ED1  C946 0001                            CMR,R4   1,B6
          1 000ED3  0801 0006                            BAL      s:4194,PREL
          1 000ED5  82C6 000C                            LB,'0040'X        12,B6
          1 000ED7       0040
          1 000ED8  0501 0005                            BBT      s:4196,PREL

     1038     4193    3              OR NOT %KV_RCRLST.EOF
     1039     4194    3            THEN Y@KEY$ = ADDR(%KV_RCR.TXT);

   4194   1 000EDA  BBC4 0003                            LAB,B3   3,B4
          1 000EDC  BFC7 0008                            STB,B3   Y@KEY$,AUTO

     1040     4195    3         END;

     1041     4196    2         CALL Y$CMPKEY;

   4196   1 000EDE  E3C0 0AFF                            LNJ,B6   s:0,PREL
          1 000EE0       0001                            DC       s:4197,PREL

     1042     4197    2         IF Y@KEYLNG>2 THEN IF Y@TMP32B.TOP~=0 THEN Y@KEYCMP = -1;

   4197   1 000EE1  E847 0013                            LDR,R6   Y@KEYLNG,AUTO
          1 000EE3  6D02                                 CMV,R6   2
          1 000EE4  0A81 000E                            BALE     s:4199,PREL

   4197   1 000EE6  D847 0017                            LDR,R5   Y@TMP32,AUTO
          1 000EE8  5901 0006                            BEZ,R5   s:4198,PREL

   4197   1 000EEA  8947 0012                            LBT,'FFFF'X       Y@KEYCMP,AUTO
   4197   1 000EEC       FFFF
          1 000EED  0F81 0005                            B        s:4199,PREL

     1043     4198    2         ELSE Y@KEYCMP = Y@TMP32B.BTM;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:209  
   4198   1 000EEF  C847 0018                            LDR,R4   Y@TMP32+1,AUTO
          1 000EF1  CF47 0012                            STR,R4   Y@KEYCMP,AUTO

     1044     4199    2         Y@SRHLO = 2;                      /* Cycle tracker for 521 algorithm    */

   4199   1 000EF3  5C02                                 LDV,R5   2
          1 000EF4  DF47 0015                            STR,R5   Y@SRHLO,AUTO

     1045     4200    3         DO WHILE Y@KEYINC>=Y@KEYCMPU;

   4200   1 000EF6  C847 0014                            LDR,R4   Y@SRHHI,AUTO
          1 000EF8  C947 0012                            CMR,R4   Y@KEYCMP,AUTO
          1 000EFA  0201 0048                            BL       s:4217,PREL

     1046     4201    4            DO CASE %KV_RCRLST.KEYTYP;

   4201   1 000EFC  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 000EFE  B846 000A                            LDR,R3   10,B6
          1 000F00  B570 00FF                            AND,R3   255,IMO
          1 000F02  3EFC                                 ADV,R3   -4
          1 000F03  3D03                                 CMV,R3   3
          1 000F04  0281 000A                            BGE      s:4203,PREL
          1 000F06  A830 0000 0F0C  01                   LDR,R2   s:4201+16,R3
          1 000F09  83A0 0000 0F0F  01                   JMP      s:4203,R2
          1 000F0C       000B                            DC       s:4207,PREL
          1 000F0D       0004                            DC       s:4205,PREL
          1 000F0E       0015                            DC       s:4209,PREL

     1047     4202    4            CASE ELSE;

     1048     4203    4               Y@KEYINC = 0;

   4203   1 000F0F  8747 0014                            CL       Y@SRHHI,AUTO
          1 000F11  0F81 002B                            B        s:4216,PREL

     1049     4204    4            CASE %G_KEYTYPE_BINHLF#;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:210  
     1050     4205    4               Y@KEYINC = Y@KEYCMPU/2;

   4205   1 000F13  E847 0012                            LDR,R6   Y@KEYCMP,AUTO
          1 000F15  6041                                 SOR,R6   1
          1 000F16  EF47 0014                            STR,R6   Y@SRHHI,AUTO
          1 000F18  0F81 0024                            B        s:4216,PREL

     1051     4206    4            CASE %G_KEYTYPE_BIN10#;

     1052     4207    4               Y@KEYINC = Y@KEYINC/10;

   4207   1 000F1A  F847 0014                            LDR,R7   Y@SRHHI,AUTO
          1 000F1C  6C00                                 LDV,R6   0
          1 000F1D  F370 000A                            DIV,R7   10,IMO
          1 000F1F  E857                                 LDR,R6   R7
          1 000F20  EF47 0014                            STR,R6   Y@SRHHI,AUTO
          1 000F22  0F81 001A                            B        s:4216,PREL

     1053     4208    4            CASE %G_KEYTYPE_BIN521#;

     1054     4209    4               Y@SRHLO = Y@SRHLO-1;

   4209   1 000F24  88C7 0015                            DEC      Y@SRHLO,AUTO

     1055     4210    5               IF Y@SRHLO = 0 THEN DO;

   4210   1 000F26  E847 0015                            LDR,R6   Y@SRHLO,AUTO
          1 000F28  6981 000F                            BNEZ,R6  s:4214,PREL

     1056     4211    5                  Y@SRHLO = 3;

   4211   1 000F2A  6C03                                 LDV,R6   3
          1 000F2B  EF47 0015                            STR,R6   Y@SRHLO,AUTO

     1057     4212    5                  Y@KEYINC = Y@KEYINC*2/5;

   4212   1 000F2D  F847 0014                            LDR,R7   Y@SRHHI,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:211  
          1 000F2F  6C00                                 LDV,R6   0
          1 000F30  7081                                 DOL,R7   1
          1 000F31  F370 0005                            DIV,R7   5,IMO
          1 000F33  E857                                 LDR,R6   R7
          1 000F34  EF47 0014                            STR,R6   Y@SRHHI,AUTO

     1058     4213    5               END;

   4213   1 000F36  0F81 0006                            B        s:4216,PREL

     1059     4214    4               ELSE Y@KEYINC = Y@KEYINC/2;

   4214   1 000F38  D847 0014                            LDR,R5   Y@SRHHI,AUTO
          1 000F3A  5041                                 SOR,R5   1
          1 000F3B  DF47 0014                            STR,R5   Y@SRHHI,AUTO

     1060     4215    4            END;

     1061     4216    3         END;

   4216   1 000F3D  E847 0014                            LDR,R6   Y@SRHHI,AUTO
          1 000F3F  E947 0012                            CMR,R6   Y@KEYCMP,AUTO
          1 000F41  0281 FFBA                            BGE      s:4201,PREL

     1062     4217    2         Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);

   4217   1 000F43  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 000F45  B847 0016                            LDR,R3   Y@SRHCUR,AUTO
          1 000F47  3E08                                 ADV,R3   8
          1 000F48  DCB6                                 LDB,B5   ,B6,R3
          1 000F49  DFC7 000A                            STB,B5   Y@RCR$,AUTO

     1063     4218    2         Y@KEY$ = ADDR(%KV_RCR.TXT);

   4218   1 000F4B  CBC5 0003                            LAB,B4   3,B5
          1 000F4D  CFC7 0008                            STB,B4   Y@KEY$,AUTO

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:212  
     1064     4219    2         CALL Y$INCKEY;

   4219   1 000F4F  E3C0 0D62                            LNJ,B6   s:0,PREL
          1 000F51       0001                            DC       s:4220,PREL

     1065     4220    3         IF Y@KEYINC=0 THEN DO;

   4220   1 000F52  E847 0014                            LDR,R6   Y@SRHHI,AUTO
          1 000F54  6981 002A                            BNEZ,R6  s:4235,PREL

     1066     4221    3            %KV_STR.RE_REDCLM = %KV_SSN.REDBFR.EDTLOWX+1;

   4221   1 000F56  ECC7 0010                            LDB,B6   Y@STR$,AUTO
          1 000F58  DCC7 000E                            LDB,B5   Y@SSN$,AUTO
          1 000F5A  D845 002B                            LDR,R5   43,B5
          1 000F5C  5E01                                 ADV,R5   1
          1 000F5D  DF46 0012                            STR,R5   18,B6

     1067     4222    3            %KV_STR.ERR.COD = %E$INSERT_NO_ROOM;

   4222   1 000F5F  C870 05A7                            LDR,R4   1447,IMO
          1 000F61  CF46 0013                            STR,R4   19,B6

     1068     4223    3            IF Y@LINCNT>0 THEN %KV_RCRLST.ACTCHR = '1'B;

   4223   1 000F63  B847 001B                            LDR,R3   Y@LINCNT,AUTO
          1 000F65  3A81 0006                            BLEZ,R3  s:4224,PREL

   4223   1 000F67  CCC7 0006                            LDB,B4   Y@RCRLST$,AUTO
          1 000F69  8944 000C                            LBT,'0008'X       12,B4
          1 000F6B       0008

     1069     4224    3            %KV_RCRLST.DATCTRCHR = ASCBIN(' ');

   4224   1 000F6C  5C20                                 LDV,R5   32
          1 000F6D  CCC7 0006                            LDB,B4   Y@RCRLST$,AUTO
          1 000F6F  D7C4 000C                            STH,R5   12,B4
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:213  

     1070     4225    3            CALL Y$UPDRCRSND;

   4225   1 000F71  E3C0 0F36                            LNJ,B6   s:0,PREL
          1 000F73       0001                            DC       s:4226,PREL

     1071     4226    3            IF %KV_RCRLST.SNDRCR<0 THEN %KV_RCRLST.ACTCHR = '0'B;

   4226   1 000F74  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 000F76  E846 0007                            LDR,R6   7,B6
          1 000F78  6881 0004                            BGEZ,R6  s:4227,PREL

   4226   1 000F7A  8846 000C                            LBF,'0008'X       12,B6
   4226   1 000F7C       0008

     1072     4227    3            GOTO ABRRED;

   4227   1 000F7D  0F81 01D7                            B        s:4338,PREL

     1073     4228         /*E*  ERROR:KVE-E$INSERT_NO_ROOM-0
     1074     4229                 MESSAGE:Insert attempted but couldn't be done by the system.
     1075     4230                 MESSAGE1:It was not possible to choose a key before the next record
     1076     4231                          conforming to the restraints imposed by KEYTYPE and KEYINCR.
     1077     4232                          The accompanying record is the desired "splitee".
     1078     4233           */
     1079     4234    3         END;
     1080     4235    2         Y@KEY$ = Y@RCR$;                  /* Save split record pointer          */

   4235   1 000F7F  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 000F81  EFC7 0008                            STB,B6   Y@KEY$,AUTO

     1081     4236    2         Y@SRHCUR = Y@SRHCUR+1;

   4236   1 000F83  8AC7 0016                            INC      Y@SRHCUR,AUTO

     1082     4237    2         Y@DLTRCR = %KV_RCRLST.RCRCNT-1;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:214  
   4237   1 000F85  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 000F87  D845 0001                            LDR,R5   1,B5
          1 000F89  5EFF                                 ADV,R5   -1
          1 000F8A  DF47 0014                            STR,R5   Y@SRHHI,AUTO

     1083     4238    2         IF Y@SRHCUR~=Y@DLTRCR OR NOT %KV_RCRLST.EOF

   4238   1 000F8C  D947 0016                            CMR,R5   Y@SRHCUR,AUTO
          1 000F8E  0981 000F                            BNE      s:4240,PREL
          1 000F90  82C5 000C                            LB,'0040'X        12,B5
          1 000F92       0040
          1 000F93  0581 000A                            BBF      s:4240,PREL
          1 000F95  B847 0016                            LDR,R3   Y@SRHCUR,AUTO
          1 000F97  3E08                                 ADV,R3   8
          1 000F98  CCB5                                 LDB,B4   ,B5,R3
          1 000F99  82C4 0002                            LB,'0020'X        2,B4
          1 000F9B       0020
          1 000F9C  0501 001E                            BBT      s:4244,PREL

     1084     4239    2           OR NOT %KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.NEW
     1085     4240    2         THEN IF %KV_RCRLST.RCRCNT<%KV_RCRLST.MAXRCR THEN Y@DLTRCR = -1;

   4240   1 000F9E  E845 0001                            LDR,R6   1,B5
          1 000FA0  E945 0002                            CMR,R6   2,B5
          1 000FA2  0881 0006                            BAGE     s:4241,PREL

   4240   1 000FA4  8947 0014                            LBT,'FFFF'X       Y@SRHHI,AUTO
   4240   1 000FA6       FFFF
          1 000FA7  0F81 0013                            B        s:4244,PREL

     1086     4241    2         ELSE IF Y@SRHCUR>Y@DLTRCR OR Y@SRHCUR=Y@DLTRCR AND %KV_RCRLST.EOF

   4241   1 000FA9  D947 0016                            CMR,R5   Y@SRHCUR,AUTO
          1 000FAB  0801 0008                            BAL      s:4242,PREL
          1 000FAD  0981 000A                            BNE      s:4243,PREL
          1 000FAF  82C5 000C                            LB,'0040'X        12,B5
          1 000FB1       0040
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:215  
          1 000FB2  0581 0005                            BBF      s:4243,PREL

     1087     4242    2         THEN Y@DLTRCR = 0;

   4242   1 000FB4  8747 0014                            CL       Y@SRHHI,AUTO
          1 000FB6  0F81 0004                            B        s:4244,PREL

     1088     4243    2         ELSE %KV_RCRLST.EOF = '0'B;

   4243   1 000FB8  8845 000C                            LBF,'0040'X       12,B5
   4243   1 000FBA       0040

     1089     4244    2         IF %KV_STR.AUTTABCLM>1

   4244   1 000FBB  CCC7 0010                            LDB,B4   Y@STR$,AUTO
          1 000FBD  E2C4 001E                            LLH,R6   30,B4
          1 000FBF  6D01                                 CMV,R6   1
          1 000FC0  0381 0017                            BLE      s:4249,PREL

     1090     4245    2         THEN IF Y@LINCNT>0

   4245   1 000FC2  C847 001B                            LDR,R4   Y@LINCNT,AUTO
          1 000FC4  4A01 000E                            BGZ,R4   s:4247,PREL
          1 000FC6  BCC7 000E                            LDB,B3   Y@SSN$,AUTO
          1 000FC8  B843 002A                            LDR,R3   42,B3
          1 000FCA  B943 002B                            CMR,R3   43,B3
          1 000FCC  0A81 000B                            BALE     s:4249,PREL
          1 000FCE  82C5 000D                            LB,'0040'X        13,B5
          1 000FD0       0040
          1 000FD1  0581 0006                            BBF      s:4249,PREL

     1091     4246    2           OR %KV_SSN.REDBFR.NXTX>%KV_SSN.REDBFR.EDTLOWX AND %KV_RCRLST.TXTEDT
     1092     4247    2         THEN Y@KEYLNG = Y@KEYLNG+%KV_STR.AUTTABCLM-1;

   4247   1 000FD3  EA47 0013                            ADD,R6   Y@KEYLNG,AUTO
          1 000FD5  6EFF                                 ADV,R6   -1
          1 000FD6  EF47 0013                            STR,R6   Y@KEYLNG,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:216  

     1093     4248        /* Bump KEYLNG to get the data into a large enough buffer where it belongs */
     1094     4249    2         Y@BFRSIZ = Y@KEYLNG+LENGTHV(KV$RCR)+

   4249   1 000FD8  BCC7 000E                            LDB,B3   Y@SSN$,AUTO
          1 000FDA  E847 0013                            LDR,R6   Y@KEYLNG,AUTO
          1 000FDC  EA43 002A                            ADD,R6   42,B3
          1 000FDE  E243 002B                            SUB,R6   43,B3
          1 000FE0  6E06                                 ADV,R6   6
          1 000FE1  EF47 0015                            STR,R6   Y@SRHLO,AUTO

     1095     4250    2           %KV_SSN.REDBFR.NXTX-%KV_SSN.REDBFR.EDTLOWX;
     1096     4251    2         CALL Y$GETRCRBFR ALTRET(ABRRED);

   4251   1 000FE3  E3C0 0B69                            LNJ,B6   s:0,PREL
          1 000FE5       0170                            DC       s:4338,PREL

     1097     4252    2         %KV_RCR.LINCNT = 0;

   4252   1 000FE6  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 000FE8  87C6 0002                            CLH      2,B6

     1098     4253    2         Y@BFRSIZ = %KV_RCR.RCRBYTSIZ;

   4253   1 000FEA  E846 0001                            LDR,R6   1,B6
          1 000FEC  EF47 0015                            STR,R6   Y@SRHLO,AUTO

     1099     4254    3         IF Y@BFRSIZ~=0 THEN DO;

   4254   1 000FEE  6901 00BF                            BEZ,R6   s:4295,PREL

     1100     4255        /*
     1101     4256        Send the new record only if there's data in it.
     1102     4257        */
     1103     4258    3            SUBSTR(%KV_RCR.TXT,Y@KEYLNG,Y@BFRSIZ) = SUBSTR

   4258   1 000FF0  DCC7 000E                            LDB,B5   Y@SSN$,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:217  
          1 000FF2  CCC5 0030                            LDB,B4   48,B5
          1 000FF4  D845 002B                            LDR,R5   43,B5
          1 000FF6  AB84                                 LAB,B2   ,B4
          1 000FF7  A855                                 LDR,R2   R5
          1 000FF8  BB86                                 LAB,B3   ,B6
          1 000FF9  B847 0013                            LDR,R3   Y@KEYLNG,AUTO
          1 000FFB  3E06                                 ADV,R3   6
          1 000FFC  0008                                 MMM

     1104     4259    3              (%KV_SSN.REDBFR__.ADR$->CHARS,%KV_SSN.REDBFR.EDTLOWX,Y@BFRSIZ);
     1105     4260    3            IF Y@LINCNT>0 OR %KV_RCRLST.TXTEDT

   4260   1 000FFD  E847 001B                            LDR,R6   Y@LINCNT,AUTO
          1 000FFF  6A01 0008                            BGZ,R6   s:4262,PREL
          1 001001  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001003  82C5 000D                            LB,'0040'X        13,B5
          1 001005       0040
          1 001006  0581 002A                            BBF      s:4269,PREL

     1106     4261        /* Make sure the record doesn't start with any blanks */
     1107     4262    4            THEN DO WHILE Y@BFRSIZ>1 AND SUBSTR(%KV_RCR.TXT,Y@KEYLNG,1)=' ';

   4262   1 001008  0F81 001B                            B        s:4268,PREL

     1108     4263    4               Y@BFRSIZ = Y@BFRSIZ-1;

   4263   1 00100A  88C7 0015                            DEC      Y@SRHLO,AUTO

     1109     4264    4               SUBSTR(%KV_RCR.TXT,Y@KEYLNG,Y@BFRSIZ)=

   4264   1 00100C  ACC7 000A                            LDB,B2   Y@RCR$,AUTO
          1 00100E  A847 0013                            LDR,R2   Y@KEYLNG,AUTO
          1 001010  2E07                                 ADV,R2   7
          1 001011  E847 0015                            LDR,R6   Y@SRHLO,AUTO
          1 001013  BB82                                 LAB,B3   ,B2
          1 001014  B847 0013                            LDR,R3   Y@KEYLNG,AUTO
          1 001016  3E06                                 ADV,R3   6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:218  
          1 001017  0008                                 MMM

     1110     4265    4                 SUBSTR(%KV_RCR.TXT,Y@KEYLNG+1,Y@BFRSIZ);
     1111     4266    4               %KV_RCR.RCRBYTSIZ = %KV_RCR.RCRBYTSIZ-1;

   4266   1 001018  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 00101A  88C6 0001                            DEC      1,B6

     1112     4267    4               IF Y@LINCNT>0 THEN %KV_STR.RE_REDCLM = %KV_STR.RE_REDCLM-1;

   4267   1 00101C  E847 001B                            LDR,R6   Y@LINCNT,AUTO
          1 00101E  6A81 0005                            BLEZ,R6  s:4268,PREL

   4267   1 001020  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 001022  88C5 0012                            DEC      18,B5

     1113     4268    4            END;

   4268   1 001024  D847 0015                            LDR,R5   Y@SRHLO,AUTO
          1 001026  5D01                                 CMV,R5   1
          1 001027  0A81 0009                            BALE     s:4269,PREL
          1 001029  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 00102B  B847 0013                            LDR,R3   Y@KEYLNG,AUTO
          1 00102D  3E06                                 ADV,R3   6
          1 00102E  C0B6                                 LDH,R4   ,B6,R3
          1 00102F  4D20                                 CMV,R4   32
          1 001030  095A                                 BE       s:4263,SPREL

     1114     4269    4            IF Y@KEYLNG~=%KV_RCRLST.KEYLNG THEN DO;

   4269   1 001031  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 001033  D2C6 000B                            LLH,R5   11,B6
          1 001035  D947 0013                            CMR,R5   Y@KEYLNG,AUTO
          1 001037  0901 0024                            BE       s:4277,PREL

     1115     4270        /* Put in the autotab spaces. */
     1116     4271    4               Y@KEYLNG = %KV_RCRLST.KEYLNG;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:219  

   4271   1 001039  DF47 0013                            STR,R5   Y@KEYLNG,AUTO

     1117     4272    4               IF Y@LINCNT>0

   4272   1 00103B  6A81 000A                            BLEZ,R6  s:4274,PREL

     1118     4273    4               THEN %KV_STR.RE_REDCLM = %KV_STR.RE_REDCLM+%KV_STR.AUTTABCLM-1;

   4273   1 00103D  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 00103F  C2C5 001E                            LLH,R4   30,B5
          1 001041  CA45 0012                            ADD,R4   18,B5
          1 001043  4EFF                                 ADV,R4   -1
          1 001044  CF45 0012                            STR,R4   18,B5

     1119     4274    4               %KV_RCR.RCRBYTSIZ = %KV_RCR.RCRBYTSIZ+%KV_STR.AUTTABCLM-1;

   4274   1 001046  DCC7 000A                            LDB,B5   Y@RCR$,AUTO
          1 001048  CCC7 0010                            LDB,B4   Y@STR$,AUTO
          1 00104A  C2C4 001E                            LLH,R4   30,B4
          1 00104C  CA45 0001                            ADD,R4   1,B5
          1 00104E  4EFF                                 ADV,R4   -1
          1 00104F  CF45 0001                            STR,R4   1,B5

     1120     4275    4               SUBSTR(%KV_RCR.TXT,Y@KEYLNG,%KV_STR.AUTTABCLM-1) = ' ';

   4275   1 001051  B2C4 001E                            LLH,R3   30,B4
          1 001053  A855                                 LDR,R2   R5
          1 001054  D853                                 LDR,R5   R3
          1 001055  DA70 1FFF                            ADD,R5   8191,IMO
          1 001057  0021                                 ALR      ;
          1 001058       4178 2000                                ALPHANUM('2000'X,IMO,,1),;
          1 00105A       4025 0003                                ALPHANUM(3,B5,R2,,R5,FILL)

     1121     4276    4            END;

     1122     4277    4            IF Y@LINCNT>0 THEN DO;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:220  

   4277   1 00105C  437F                                 CSYNC    s:4275+10,SPREL
          1 00105D  E847 001B                            LDR,R6   Y@LINCNT,AUTO
          1 00105F  6A81 0032                            BLEZ,R6  s:4285,PREL

     1123     4278        /* This split is due to word-wrap. Position to the new part, and dont send it */
     1124     4279    4               CALL KVI$EDTX_TO_VRTCLM (%KV_MVD.VRTCLM); /* Prepare to erase     */

   4279   1 001061  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001064  DCC6 0006                            LDB,B5   6,B6
          1 001066  CBC5 001B                            LAB,B4   27,B5
          1 001068  CFC7 0056                            STB,B4   KV@SND_DAT+23,AUTO
          1 00106A  BBC7 0056                            LAB,B3   KV@SND_DAT+23,AUTO
          1 00106C  CBF0 0100                            LAB,B4   256,IMO
          1 00106E  E380 0000 0000  xent                 LNJ,B6   KVI$EDTX_TO_VRTCLM
          1 001071       0001                            DC       s:4280,PREL

     1125     4280    4               CALL KVO$PST (KV_VDH_PST_VRT);

   4280   1 001072  BB80 0000 0006  02                   LAB,B3   +6
          1 001075  CBF0 0100                            LAB,B4   256,IMO
          1 001077  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 00107A       0001                            DC       s:4281,PREL

     1126     4281    4               %KV_RCR.NEW = '1'B;

   4281   1 00107B  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 00107D  8946 0002                            LBT,'0020'X       2,B6
          1 00107F       0020

     1127     4282    4               %KV_STR.RE_REDCLM = %KV_STR.RE_REDCLM-%KV_SSN.REDBFR.EDTLOWX;

   4282   1 001080  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 001082  CCC7 000E                            LDB,B4   Y@SSN$,AUTO
          1 001084  E845 0012                            LDR,R6   18,B5
          1 001086  E244 002B                            SUB,R6   43,B4
          1 001088  EF45 0012                            STR,R6   18,B5
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:221  

     1128     4283    4               %KV_RCRLST.CRTRCR = Y@SRHCUR;

   4283   1 00108A  BCC7 0006                            LDB,B3   Y@RCRLST$,AUTO
          1 00108C  D847 0016                            LDR,R5   Y@SRHCUR,AUTO
          1 00108E  DF43 0006                            STR,R5   6,B3

     1129     4284    4            END; ELSE DO;

   4284   1 001090  0F81 0015                            B        s:4289,PREL

     1130     4285    4               %KV_RCRLST.SNDRCR = Y@SRHCUR;

   4285   1 001092  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 001094  D847 0016                            LDR,R5   Y@SRHCUR,AUTO
          1 001096  DF46 0007                            STR,R5   7,B6

     1131     4286    4               IF %KV_STR.SNDMAXNMBRCR~=0 THEN CALL Y$SNDRCR;

   4286   1 001098  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 00109A  C845 0019                            LDR,R4   25,B5
          1 00109C  4901 0004                            BEZ,R4   s:4287,PREL

   4286   1 00109E  E3C0 0CFC                            LNJ,B6   s:0,PREL
          1 0010A0       0001                            DC       s:4287,PREL

     1132     4287    4               Y@KEY$ = ADDR(NIL);         /* Remember to stay here.             */

   4287   1 0010A1  EB80 0000 0000                       LAB,B6   0
          1 0010A4  EFC7 0008                            STB,B6   Y@KEY$,AUTO

     1133     4288    4            END;

     1134     4289    3            CALL KVO$ERSTO_ENDOF_INP;      /* Erase the shifted part             */

   4289   1 0010A6  CBF0 0000                            LAB,B4   0,IMO
          1 0010A8  E380 0000 0000  xent                 LNJ,B6   KVO$ERSTO_ENDOF_INP
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:222  
          1 0010AB       0001                            DC       s:4290,PREL

     1135     4290    3         END;

   4290   1 0010AC  0F81 0019                            B        s:4300,PREL

     1136     4291    3         ELSE DO;

     1137     4292        /*
     1138     4293        Position to the empty record.
     1139     4294        */
     1140     4295    3            %KV_RCR.NEW = '1'B;

   4295   1 0010AE  8946 0002                            LBT,'0020'X       2,B6
   4295   1 0010B0       0020

     1141     4296    3            %KV_STR.RE_REDCLM = MAXIMUM(1,%KV_STR.AUTTABCLM);

   4296   1 0010B1  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 0010B3  D2C5 001E                            LLH,R5   30,B5
          1 0010B5  D970 0001                            CMR,R5   1,IMO
          1 0010B7  0281 0002                            BGE      s:4296+9,PREL
          1 0010B9  5C01                                 LDV,R5   1
          1 0010BA  DF45 0012                            STR,R5   18,B5

     1142     4297    3            Y@KEYLNG = %KV_RCRLST.KEYLNG;

   4297   1 0010BC  CCC7 0006                            LDB,B4   Y@RCRLST$,AUTO
          1 0010BE  C2C4 000B                            LLH,R4   11,B4
          1 0010C0  CF47 0013                            STR,R4   Y@KEYLNG,AUTO

     1143     4298    3            %KV_RCRLST.CRTRCR = Y@SRHCUR;

   4298   1 0010C2  B847 0016                            LDR,R3   Y@SRHCUR,AUTO
          1 0010C4  BF44 0006                            STR,R3   6,B4

     1144     4299    3         END;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:223  

     1145     4300    2         %KV_SSN.REDBFR.NXTX = %KV_SSN.REDBFR.EDTLOWX;

   4300   1 0010C6  ECC7 000E                            LDB,B6   Y@SSN$,AUTO
          1 0010C8  E846 002B                            LDR,R6   43,B6
          1 0010CA  EF46 002A                            STR,R6   42,B6

     1146     4301    2         %KV_SSN.REDBFR.INSMODX = %KV_SSN.REDBFR.EDTLOWX;

   4301   1 0010CC  EF46 002E                            STR,R6   46,B6

     1147     4302    2         %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.EDTLOWX;

   4302   1 0010CE  EF46 002C                            STR,R6   44,B6

     1148     4303    2         %KV_SSN.REDBFR__.DATBYTSIZ = %KV_SSN.REDBFR.EDTLOWX;

   4303   1 0010D0  EF46 0033                            STR,R6   51,B6

     1149     4304    2         Y@SRHCUR = Y@SRHCUR-1;

   4304   1 0010D2  88C7 0016                            DEC      Y@SRHCUR,AUTO

     1150     4305    2         Y@REDLIN = Y@SRHCUR;

   4305   1 0010D4  D847 0016                            LDR,R5   Y@SRHCUR,AUTO
          1 0010D6  DF47 0012                            STR,R5   Y@KEYCMP,AUTO

     1151     4306    2         Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);

   4306   1 0010D8  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 0010DA  B855                                 LDR,R3   R5
          1 0010DB  3E08                                 ADV,R3   8
          1 0010DC  CCB5                                 LDB,B4   ,B5,R3
          1 0010DD  CFC7 000A                            STB,B4   Y@RCR$,AUTO

     1152     4307    3         IF %KV_STR.SNDMAXNMBRCR~=0 AND Y@KEY$=ADDR(NIL) THEN DO;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:224  

   4307   1 0010DF  BCC7 0010                            LDB,B3   Y@STR$,AUTO
          1 0010E1  C843 0019                            LDR,R4   25,B3
          1 0010E3  4901 0019                            BEZ,R4   s:4318,PREL
          1 0010E5  8DC7 0008                            CMN      Y@KEY$,AUTO
          1 0010E7  0981 0015                            BNE      s:4318,PREL

     1153     4308        /*N* MAXNMBRCR~=0 should be SNDRCR<0 */
     1154     4309        /*
     1155     4310        We can still edit. Stay on this record.
     1156     4311        */
     1157     4312    3            CALL Y$DSPALL;

   4312   1 0010E9  E3C0 F092                            LNJ,B6   s:0,PREL
          1 0010EB       0001                            DC       s:4312,PREL

   4312   1                              INPOPR_EXIT     null
     1158     4313    3   INPOPR_EXIT:;
     1159     4314    3            IF KV@USR_RQSDAT.RE_RED THEN CALL KVV$VDIINT(KV_VDH_DAT);

   4314   1 0010EC  82C7 0020            INPOPR_EXIT     LB,'0080'X        KV@USR_RQSDAT,AUTO
   4314   1 0010EE       0080
          1 0010EF  0581 000A                            BBF      s:4316,PREL

   4314   1 0010F1  BB80 0000 0008  02                   LAB,B3   +8
          1 0010F4  CBF0 0100                            LAB,B4   256,IMO
          1 0010F6  E380 0000 0000  xent                 LNJ,B6   KVV$VDIINT
          1 0010F9       0001                            DC       s:4316,PREL

     1160     4315        /* Now is the time for typeahead if we got here from Y$ENBRED */
     1161     4316    3            RETURN;

   4316   1 0010FA  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1162     4317    3         END;
     1163     4318    2         CALL Y$UPDRCR ALTRET(ABRRED);

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:225  
   4318   1 0010FD  E3C0 0D46                            LNJ,B6   s:0,PREL
          1 0010FF       0056                            DC       s:4338,PREL

     1164     4319    2      END /* CASE */;

     1165     4320        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:226  
     1166     4321    1      IF %KV_RCRLST.TXTEDT AND %KV_STR.RE_REDCLM<%KV_STR.AUTTABCLM

   4321   1 001100  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 001102  82C6 000D                            LB,'0040'X        13,B6
          1 001104       0040
          1 001105  0581 0010                            BBF      s:4324,PREL
          1 001107  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 001109  E2C5 001E                            LLH,R6   30,B5
          1 00110B  E945 0012                            CMR,R6   18,B5
          1 00110D  0381 0008                            BLE      s:4324,PREL
          1 00110F  D845 0012                            LDR,R5   18,B5
          1 001111  5901 0004                            BEZ,R5   s:4324,PREL

     1167     4322    1        AND %KV_STR.RE_REDCLM>0
     1168     4323    1      THEN %KV_STR.RE_REDCLM = %KV_STR.AUTTABCLM;

   4323   1 001113  D856                                 LDR,R5   R6
          1 001114  DF45 0012                            STR,R5   18,B5

     1169     4324    1      KV@USR_RQSDAT = KV_USR_RQSDAT;

   4324   1 001116  AB80 0000 0000  xsym                 LAB,B2   KV_USR_RQSDAT
          1 001119  2C00                                 LDV,R2   0
          1 00111A  6C0C                                 LDV,R6   12
          1 00111B  BB87                                 LAB,B3   ,AUTO
          1 00111C  3C40                                 LDV,R3   64
          1 00111D  0008                                 MMM

     1170     4325    1      KV@USR_RQSDAT.MAXRCRBYTSIZ = %KV_STR.MAXRCRBYTSIZ;

   4325   1 00111E  ECC7 0010                            LDB,B6   Y@STR$,AUTO
          1 001120  E846 0015                            LDR,R6   21,B6
          1 001122  EF47 0025                            STR,R6   KV@USR_RQSDAT+5,AUTO

     1171     4326    2      IF %KV_RCRLST.SNDRCR<0 AND NOT %KV_RCRLST.SNDRQR THEN DO;

   4326   1 001124  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:227  
          1 001126  D845 0007                            LDR,R5   7,B5
          1 001128  5881 0016                            BGEZ,R5  s:4334+2,PREL
          1 00112A  82C5 000C                            LB,'0006'X        12,B5
          1 00112C       0006
          1 00112D  0501 0011                            BBT      s:4334+2,PREL

     1172     4327        /*
     1173     4328           We can allow more editing.  Place the cursor appropriately.
     1174     4329        */
     1175     4330    3         CALL Y$CHKSCR WHENRETURN DO;

   4330   1 00112F  E3C0 061A                            LNJ,B6   s:0,PREL
          1 001131       0003                            DC       s:4333,PREL

     1176     4331    3            GOTO Y$ENBRED;

   4331   1 001132  0F81 032E                            B        s:4577,PREL

     1177     4332    3         END;
     1178     4333    2         IF %KV_STR.SNDMAXNMBRCR~=0 THEN CALL Y$SNDNEED;

   4333   1 001134  ECC7 0010                            LDB,B6   Y@STR$,AUTO
          1 001136  E846 0019                            LDR,R6   25,B6
          1 001138  6901 001C                            BEZ,R6   s:4338,PREL

   4333   1 00113A  E3C0 0BE0                            LNJ,B6   s:0,PREL
          1 00113C       0001                            DC       s:4334,PREL

     1179     4334    2      END; ELSE IF Y@REDLIN~=%KV_RCRLST.CRTRCR AND %KV_RCRLST.DFROPR=0 THEN DO;

   4334   1 00113D  0F81 0017                            B        s:4338,PREL

   4334   1 00113F  C847 0012                            LDR,R4   Y@KEYCMP,AUTO
          1 001141  C945 0006                            CMR,R4   6,B5
          1 001143  0901 0011                            BE       s:4338,PREL
          1 001145  B0C5 000E                            LDH,R3   14,B5
          1 001147  3981 000D                            BNEZ,R3  s:4338,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:228  

     1180     4335    2         %KV_RCRLST.DFROPR = %KV_INPPRC_SE_DWN;

   4335   1 001149  2C2E                                 LDV,R2   46
          1 00114A  A7C5 000E                            STH,R2   14,B5

     1181     4336    2         %KV_RCRLST.DFRCNT = %KV_RCRLST.CRTRCR-Y@REDLIN;

   4336   1 00114C  C245 0006                            SUB,R4   6,B5
          1 00114E  8254                                 NEG      R4
          1 00114F  C7C5 000D                            STH,R4   13,B5

     1182     4337    2         %KV_RCRLST.CRTRCR = Y@REDLIN;

   4337   1 001151  E847 0012                            LDR,R6   Y@KEYCMP,AUTO
          1 001153  EF45 0006                            STR,R6   6,B5

     1183     4338    2      END;

   4335   1                              ABRRED          null
     1184     4339    1   ABRRED:;
     1185     4340    1      CALL KVI$PRGRED;

   4340   1 001155  CBF0 0000            ABRRED          LAB,B4   0,IMO
          1 001157  E380 0000 0000  xent                 LNJ,B6   KVI$PRGRED
          1 00115A       0001                            DC       s:4341,PREL

     1186     4341    1      CALL KVI$TRMRED_VDH_DAT;

   4341   1 00115B  CBF0 0000                            LAB,B4   0,IMO
          1 00115D  E380 0000 0000  xent                 LNJ,B6   KVI$TRMRED_VDH_DAT
          1 001160       0001                            DC       s:4342,PREL

     1187     4342    1      IF %KV_SRD.PRKCRS THEN CALL KVO$PST (KV_VDH_PST_HOM);

   4342   1 001161  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 001163  82C6 000F                            LB,'0004'X        15,B6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:229  
          1 001165       0004
          1 001166  0581 000A                            BBF      s:4343,PREL

   4342   1 001168  BB80 0000 000A  02                   LAB,B3   +10
          1 00116B  CBF0 0100                            LAB,B4   256,IMO
          1 00116D  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 001170       0001                            DC       s:4343,PREL

     1188     4343    1      RETURN;

   4343   1 001171  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1189     4344        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:230  
     1190     4345    1   KVE$INSREC: ENTRY ALTRET;

   4345   1 001174  D380 0000 0000  xent KVE$INSREC      LNJ,B5   X6A_AUTO_1
          1 001177       005A 0001                       DC       90,1

     1191     4346        /*F* NAME: KVE$INSREC.
     1192     4347             DESCRIPTION: Called by the protocol receiver as a result of a
     1193     4348             VDO_DAT, to put a new (or updated) record into the editor context.
     1194     4349             The record is described by KV_RCVVDO. In particular .OTPLCL and
     1195     4350             .VDOVLP_KEY$.
     1196     4351        */
     1197     4352
     1198     4353    1      CALL Y$SETUP;

   4353   1 001179  E3C0 EE8D                            LNJ,B6   s:0,PREL
          1 00117B       0001                            DC       s:4354,PREL

     1199     4354    1      Y@KEY$ = PINCRW(KV_RCVVDO.VDOVLP_KEY$,SIZEW(KV$VDOVLP));

   4354   1 00117C  EC80 0000 0000  xsym                 LDB,B6   KV$RCVVDO$
          1 00117F  DCC6 0014                            LDB,B5   20,B6
          1 001181  CBC5 0001                            LAB,B4   1,B5
          1 001183  CFC7 0008                            STB,B4   Y@KEY$,AUTO

     1200     4355    2      IF KV_RCVVDO.VDOVLP_ERR$~=ADDR(NIL) THEN DO;

   4355   1 001185  8DC6 0010                            CMN      16,B6
          1 001187  0901 006E                            BE       s:4385,PREL

     1201     4356    3         IF KV_RCVVDO.VDOVLP_ERR$->KV$VDOVLP_ERR.ERRCODE.ERR#=%E$EOF THEN DO;

   4356   1 001189  BCC6 0010                            LDB,B3   16,B6
          1 00118B  E843 0002                            LDR,R6   2,B3
          1 00118D  6043                                 SOR,R6   3
          1 00118E  6D06                                 CMV,R6   6
          1 00118F  0981 001D                            BNE      s:4363,PREL

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:231  
     1202     4357    3            IF %KV_RCRLST.DATCTRCHR>=0 THEN %KV_RCRLST.EOF = '1'B;

   4357   1 001191  ACC7 0006                            LDB,B2   Y@RCRLST$,AUTO
          1 001193  D0C2 000C                            LDH,R5   12,B2
          1 001195  5801 0006                            BLZ,R5   s:4358,PREL

   4357   1 001197  8942 000C                            LBT,'0040'X       12,B2
   4357   1 001199       0040
          1 00119A  0F81 0009                            B        s:4359,PREL

     1203     4358    3            ELSE IF %KV_RCRLST.RCRNEDSNT THEN %KV_RCRLST.BOF = '1'B;

   4358   1 00119C  82C2 000C                            LB,'0080'X        12,B2
   4358   1 00119E       0080
          1 00119F  0581 0004                            BBF      s:4359,PREL

   4358   1 0011A1  8942 000C                            LBT,'0020'X       12,B2
   4358   1 0011A3       0020

     1204     4359    3            %KV_RCRLST.RCRNEDSNT = '0'B;

   4359   1 0011A4  8842 000C                            LBF,'0080'X       12,B2
   4359   1 0011A6       0080

     1205     4360    3            %KV_RCRLST.EOFDSP = '0'B;

   4360   1 0011A7  8842 000D                            LBF,'0010'X       13,B2
   4360   1 0011A9       0010

     1206     4361    3            RETURN;

   4361   1 0011AA  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1207     4362    3         END;
     1208     4363    2         IF KV_RCVVDO.OTPLCL.BFR_.ADR$~=ADDR(NIL)

   4363   1 0011AD  8DC6 0019                            CMN      25,B6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:232  
          1 0011AF  0901 0005                            BE       s:4365,PREL

     1209     4364    2         THEN Y@KEY$ = KV_RCVVDO.OTPLCL.BFR_.ADR$;

   4364   1 0011B1  ACC6 0019                            LDB,B2   25,B6
          1 0011B3  AFC7 0008                            STB,B2   Y@KEY$,AUTO

     1210     4365    2         IF %KV_RCRLST.RCRCNT=0 THEN RETURN;

   4365   1 0011B5  CCC7 0006                            LDB,B4   Y@RCRLST$,AUTO
          1 0011B7  D844 0001                            LDR,R5   1,B4
          1 0011B9  5981 0004                            BNEZ,R5  s:4366,PREL

   4365   1 0011BB  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1211     4366    3         CALL Y$FNDKEY WHENRETURN DO;

   4366   1 0011BE  E3C0 092C                            LNJ,B6   s:0,PREL
          1 0011C0       0003                            DC       s:4369,PREL

     1212     4367    3            Y@SRHCUR = Y@SRHCUR-1;

   4367   1 0011C1  88C7 0016                            DEC      Y@SRHCUR,AUTO

     1213     4368    3         END;

     1214     4369    2         Y@KEY$ = PINCRW(KV_RCVVDO.VDOVLP_KEY$, SIZEW(KV$VDOVLP));

   4369   1 0011C3  EC80 0000 0000  xsym                 LDB,B6   KV$RCVVDO$
          1 0011C6  DCC6 0014                            LDB,B5   20,B6
          1 0011C8  CBC5 0001                            LAB,B4   1,B5
          1 0011CA  CFC7 0008                            STB,B4   Y@KEY$,AUTO

     1215     4370    2         KV@VDH_GETBFR = Y_VDH_GETBFR;

   4370   1 0011CC  AB80 0000 0000  00                   LAB,B2   Y_VDH_OTPLCL
          1 0011CF  2C0A                                 LDV,R2   10
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:233  
          1 0011D0  6C16                                 LDV,R6   22
          1 0011D1  BB87                                 LAB,B3   ,AUTO
          1 0011D2  3C4C                                 LDV,R3   76
          1 0011D3  0008                                 MMM

     1216     4371    3         DO WHILE Y@SRHCUR>=0;

   4371   1 0011D4  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 0011D6  6801 001C                            BLZ,R6   s:4383,PREL

     1217     4372        /*
     1218     4373           Delete until the current record key is smaller than the start key.
     1219     4374        */
     1220     4375    3            CALL Y$CMPKEY;

   4375   1 0011D8  E3C0 0805                            LNJ,B6   s:0,PREL
          1 0011DA       0001                            DC       s:4376,PREL

     1221     4376    3            IF Y@KEYCMP>0 THEN EXIT;

   4376   1 0011DB  E847 0012                            LDR,R6   Y@KEYCMP,AUTO
          1 0011DD  6A01 0015                            BGZ,R6   s:4383,PREL

     1222     4377    3            CALL Y$DLTRCR;

   4377   1 0011DF  E3C0 0877                            LNJ,B6   s:0,PREL
          1 0011E1       0001                            DC       s:4378,PREL

     1223     4378    3            IF Y@SRHCUR+1>=%KV_RCRLST.RCRCNT THEN %KV_RCRLST.EOF = '0'B;

   4378   1 0011E2  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 0011E4  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 0011E6  6E01                                 ADV,R6   1
          1 0011E7  E946 0001                            CMR,R6   1,B6
          1 0011E9  0801 0004                            BAL      s:4381,PREL

   4378   1 0011EB  8846 000C                            LBF,'0040'X       12,B6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:234  
   4378   1 0011ED       0040

     1224     4379         /* 6EDIT deletes the last record just to make sure it is in sync */
     1225     4380         /* It's still in the file, so EOF shouldn't be set. */
     1226     4381    3            Y@SRHCUR = Y@SRHCUR-1;

   4381   1 0011EE  88C7 0016                            DEC      Y@SRHCUR,AUTO

     1227     4382    3         END;

   4382   1 0011F0  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 0011F2  68E6                                 BGEZ,R6  s:4375,SPREL

     1228     4383    2         RETURN;

   4383   1 0011F3  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1229     4384    2      END;
     1230     4385    2      CALL Y$FNDKEY WHENRETURN DO;

   4385   1 0011F6  E3C0 08F4                            LNJ,B6   s:0,PREL
          1 0011F8       004B                            DC       s:4420,PREL

     1231     4386        /*
     1232     4387           The record has a new key.  Check for insertion or extension.
     1233     4388        */
     1234     4389    3         IF %KV_RCRLST.RCRCNT=%KV_RCRLST.MAXRCR THEN DO;

   4389   1 0011F9  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 0011FB  E846 0001                            LDR,R6   1,B6
          1 0011FD  E946 0002                            CMR,R6   2,B6
          1 0011FF  0981 0011                            BNE      s:4398,PREL

     1235     4390        /*
     1236     4391           The context is full, pick a record to discard.
     1237     4392        */
     1238     4393    3            %KV_RCRLST.EOF = '0'B;         /* Last going away, or write past it  */
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:235  

   4393   1 001201  8846 000C                            LBF,'0040'X       12,B6
   4393   1 001203       0040

     1239     4394    3            IF Y@KEYCMP>0 THEN Y@DLTRCR = 0;

   4394   1 001204  D847 0012                            LDR,R5   Y@KEYCMP,AUTO
          1 001206  5A81 0005                            BLEZ,R5  s:4395,PREL

   4394   1 001208  8747 0014                            CL       Y@SRHHI,AUTO
          1 00120A  0F81 0012                            B        s:4407,PREL

     1240     4395    3            ELSE Y@DLTRCR = %KV_RCRLST.RCRCNT-1;

   4395   1 00120C  6EFF                                 ADV,R6   -1
          1 00120D  EF47 0014                            STR,R6   Y@SRHHI,AUTO

     1241     4396    3         END;

   4396   1 00120F  0F81 000D                            B        s:4407,PREL

     1242     4397    3         ELSE DO;

     1243     4398    4            IF %KV_RCRLST.RCRCNT=0 THEN DO;

   4398   1 001211  6981 0008                            BNEZ,R6  s:4402,PREL

     1244     4399    4               %KV_RCRLST.CRTRCR = 0;

   4399   1 001213  8746 0006                            CL       6,B6

     1245     4400    4               %KV_STR.RE_REDCLM = 1;

   4400   1 001215  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 001217  5C01                                 LDV,R5   1
          1 001218  DF45 0012                            STR,R5   18,B5

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:236  
     1246     4401    4            END;

     1247     4402    3            Y@DLTRCR = -1;

   4402   1 00121A  8947 0014                            LBT,'FFFF'X       Y@SRHHI,AUTO
   4402   1 00121C       FFFF

     1248     4403    3         END;

     1249     4404        /*
     1250     4405           Re-use a deleted record if it's still on the screen.
     1251     4406        */
     1252     4407    2         IF Y@SRHCUR>0

   4407   1 00121D  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 00121F  6A81 000E                            BLEZ,R6  s:4412,PREL

     1253     4408    3         THEN IF %KV_RCRLST.RCR$(Y@SRHCUR-1)->KV$RCR.RCRBYTSIZ<0 THEN DO;

   4408   1 001221  B856                                 LDR,R3   R6
          1 001222  3E07                                 ADV,R3   7
          1 001223  DCB6                                 LDB,B5   ,B6,R3
          1 001224  D845 0001                            LDR,R5   1,B5
          1 001226  5881 0007                            BGEZ,R5  s:4412,PREL

     1254     4409    3            Y@SRHCUR = Y@SRHCUR-1;

   4409   1 001228  88C7 0016                            DEC      Y@SRHCUR,AUTO

     1255     4410    3            Y@DLTRCR = Y@SRHCUR;

   4410   1 00122A  C847 0016                            LDR,R4   Y@SRHCUR,AUTO
          1 00122C  CF47 0014                            STR,R4   Y@SRHHI,AUTO

     1256     4411    3         END;

     1257     4412    2         IF Y@SRHCUR<%KV_RCRLST.RCRCNT AND Y@SRHCUR~=Y@DLTRCR
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:237  

   4412   1 00122E  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 001230  E946 0001                            CMR,R6   1,B6
          1 001232  0881 000E                            BAGE     s:4415,PREL
          1 001234  E947 0014                            CMR,R6   Y@SRHHI,AUTO
          1 001236  0901 000A                            BE       s:4415,PREL

     1258     4413    2         THEN IF %KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.RCRBYTSIZ<0

   4413   1 001238  B856                                 LDR,R3   R6
          1 001239  3E08                                 ADV,R3   8
          1 00123A  DCB6                                 LDB,B5   ,B6,R3
          1 00123B  D845 0001                            LDR,R5   1,B5
          1 00123D  5881 0003                            BGEZ,R5  s:4415,PREL

     1259     4414    2         THEN Y@DLTRCR = Y@SRHCUR;

   4414   1 00123F  EF47 0014                            STR,R6   Y@SRHHI,AUTO

     1260     4415    2      END;

   4415   1 001241  0F81 0005                            B        s:4423,PREL

     1261     4416    2      WHENALTRETURN DO;

     1262     4417        /*
     1263     4418           Replace existing record.
     1264     4419        */
     1265     4420    2         Y@DLTRCR = Y@SRHCUR;

   4420   1 001243  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 001245  EF47 0014                            STR,R6   Y@SRHHI,AUTO

     1266     4421    2      END;

     1267     4422
     1268     4423    1      Y@BFRSIZ = Y@KEYLNG+LENGTHV(KV$RCR)+KV_RCVVDO.OTPLCL.BFR_.BYTSIZ;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:238  

   4423   1 001247  EC80 0000 0000  xsym                 LDB,B6   KV$RCVVDO$
          1 00124A  D847 0013                            LDR,R5   Y@KEYLNG,AUTO
          1 00124C  DA46 001C                            ADD,R5   28,B6
          1 00124E  5E06                                 ADV,R5   6
          1 00124F  DF47 0015                            STR,R5   Y@SRHLO,AUTO

     1269     4424    2      IF Y@SRHCUR=Y@DLTRCR THEN DO;

   4424   1 001251  E947 0014                            CMR,R6   Y@SRHHI,AUTO
          1 001253  0981 0029                            BNE      s:4435,PREL

     1270     4425        /*
     1271     4426           Check for identical replacement.  The screen may already be ok.
     1272     4427        */
     1273     4428    2         Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);

   4428   1 001255  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001257  B856                                 LDR,R3   R6
          1 001258  3E08                                 ADV,R3   8
          1 001259  CCB5                                 LDB,B4   ,B5,R3
          1 00125A  CFC7 000A                            STB,B4   Y@RCR$,AUTO

     1274     4429    2         IF %KV_RCR.RCRBYTSIZ<0

   4429   1 00125C  C844 0001                            LDR,R4   1,B4
          1 00125E  4881 001E                            BGEZ,R4  s:4435,PREL
          1 001260  CA46 001C                            ADD,R4   28,B6
          1 001262  4981 001A                            BNEZ,R4  s:4435,PREL

     1275     4430    2           AND %KV_RCR.RCRBYTSIZ+KV_RCVVDO.OTPLCL.BFR_.BYTSIZ=0
     1276     4431    2         THEN IF SUBSTR(%KV_RCR.TXT,Y@KEYLNG,KV_RCVVDO.OTPLCL.BFR_.BYTSIZ)=

   4431   1 001264  C846 001C                            LDR,R4   28,B6
          1 001266  BCC6 0019                            LDB,B3   25,B6
          1 001268  A846 001B                            LDR,R2   27,B6
          1 00126A  AF47 0056                            STR,R2   KV@SND_DAT+23,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:239  
          1 00126C  CF47 0057                            STR,R4   KV@SND_DAT+24,AUTO
          1 00126E  BFC7 0058                            STB,B3   KV@SND_DAT+25,AUTO
          1 001270  AB84                                 LAB,B2   ,B4
          1 001271  A847 0013                            LDR,R2   Y@KEYLNG,AUTO
          1 001273  2E06                                 ADV,R2   6
          1 001274  E854                                 LDR,R6   R4
          1 001275  B847 0056                            LDR,R3   KV@SND_DAT+23,AUTO
          1 001277  F854                                 LDR,R7   R4
          1 001278  D380 0000 0000  xent                 LNJ,B5   X6C_ACM
          1 00127B  5381 002D                            CBE      s:4443,PREL

     1277     4432    2           SUBSTR(KV_RCVVDO.OTPLCL.BFR_.ADR$->CHARS,KV_RCVVDO.OTPLCL.BFR_.BYTX,
     1278     4433    2           KV_RCVVDO.OTPLCL.BFR_.BYTSIZ) THEN GOTO USE_DLTRCR;
     1279     4434    2      END;

     1280     4435    1      CALL Y$GETRCRBFR ALTRET(ABRRED);

   4435   1 00127D  E3C0 08CF                            LNJ,B6   s:0,PREL
          1 00127F       FED6                            DC       s:4338,PREL

     1281     4436    1      %KV_RCR.DSP = '0'B;

   4436   1 001280  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 001282  8846 0002                            LBF,'0010'X       2,B6
          1 001284       0010

     1282     4437    2      IF %KV_RCRLST.RCRNEDSNT THEN DO;

   4437   1 001285  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001287  82C5 000C                            LB,'0080'X        12,B5
          1 001289       0080
          1 00128A  0581 001E                            BBF      s:4443,PREL

     1283     4438    2         IF %KV_RCRLST.DATCTRCHR>0 AND Y@KEYCMP>0

   4438   1 00128C  E0C5 000C                            LDH,R6   12,B5
          1 00128E  6A81 000A                            BLEZ,R6  s:4440,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:240  
          1 001290  D847 0012                            LDR,R5   Y@KEYCMP,AUTO
          1 001292  5A81 0006                            BLEZ,R5  s:4440,PREL

     1284     4439    2         THEN %KV_RCRLST.DATCTRCHR = %KV_RCRLST.DATCTRCHR-1;

   4439   1 001294  6EFF                                 ADV,R6   -1
          1 001295  E7C5 000C                            STH,R6   12,B5
          1 001297  0F81 000A                            B        s:4442,PREL

     1285     4440    2         ELSE IF %KV_RCRLST.DATCTRCHR<0 AND Y@KEYCMP<0

   4440   1 001299  6881 0008                            BGEZ,R6  s:4442,PREL
          1 00129B  D847 0012                            LDR,R5   Y@KEYCMP,AUTO
          1 00129D  5881 0004                            BGEZ,R5  s:4442,PREL

     1286     4441    2         THEN %KV_RCRLST.DATCTRCHR = %KV_RCRLST.DATCTRCHR+1;

   4441   1 00129F  6E01                                 ADV,R6   1
          1 0012A0  E7C5 000C                            STH,R6   12,B5

     1287     4442    2         IF %KV_RCRLST.DATCTRCHR=0 THEN %KV_RCRLST.RCRNEDSNT = '0'B;

   4442   1 0012A2  E0C5 000C                            LDH,R6   12,B5
          1 0012A4  6981 0004                            BNEZ,R6  s:4443,PREL

   4442   1 0012A6  8845 000C                            LBF,'0080'X       12,B5
   4442   1 0012A8       0080

     1288     4443    2      END;

   4442   1                              USE_DLTRCR      null
     1289     4444    1   USE_DLTRCR:;
     1290     4445        /*
     1291     4446           Put in the data and key.
     1292     4447        */
     1293     4448    1      SUBSTR(%KV_RCR.TXT,0,Y@KEYLNG) = SUBSTR(Y@KEY$->CHARS,0,Y@KEYLNG);

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:241  
   4448   1 0012A9  ACC7 0008            USE_DLTRCR      LDB,B2   Y@KEY$,AUTO
          1 0012AB  2C00                                 LDV,R2   0
          1 0012AC  E847 0013                            LDR,R6   Y@KEYLNG,AUTO
          1 0012AE  BCC7 000A                            LDB,B3   Y@RCR$,AUTO
          1 0012B0  3C06                                 LDV,R3   6
          1 0012B1  0008                                 MMM

     1294     4449    1      %KV_RCR.RCRBYTSIZ = KV_RCVVDO.OTPLCL.BFR_.BYTSIZ;

   4449   1 0012B2  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 0012B4  DC80 0000 0000  xsym                 LDB,B5   KV$RCVVDO$
          1 0012B7  E845 001C                            LDR,R6   28,B5
          1 0012B9  EF46 0001                            STR,R6   1,B6

     1295     4450    1      SUBSTR(%KV_RCR.TXT,Y@KEYLNG,%KV_RCR.RCRBYTSIZ) =

   4450   1 0012BB  DC80 0000 0000  xsym                 LDB,B5   KV$RCVVDO$
          1 0012BE  CCC5 0019                            LDB,B4   25,B5
          1 0012C0  D845 001B                            LDR,R5   27,B5
          1 0012C2  AB84                                 LAB,B2   ,B4
          1 0012C3  A855                                 LDR,R2   R5
          1 0012C4  BB86                                 LAB,B3   ,B6
          1 0012C5  B847 0013                            LDR,R3   Y@KEYLNG,AUTO
          1 0012C7  3E06                                 ADV,R3   6
          1 0012C8  0008                                 MMM

     1296     4451    1        SUBSTR(KV_RCVVDO.OTPLCL.BFR_.ADR$->CHARS,
     1297     4452    1        KV_RCVVDO.OTPLCL.BFR_.BYTX, %KV_RCR.RCRBYTSIZ);
     1298     4453    1      RETURN;

   4453   1 0012C9  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1299     4454        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:242  
     1300     4455    1   KVE$PST: ENTRY ALTRET;

   4455   1 0012CC  D380 0000 0000  xent KVE$PST         LNJ,B5   X6A_AUTO_1
          1 0012CF       005A 0001                       DC       90,1

     1301     4456        /*F* NAME: KVE$PST.
     1302     4457             DESCRITION: Performs the record selection portion of the M$SINPUT
     1303     4458             function for the screen editor.
     1304     4459        */
     1305     4460    1      CALL Y$SETUP;

   4460   1 0012D1  E3C0 ED35                            LNJ,B6   s:0,PREL
          1 0012D3       0001                            DC       s:4461,PREL

     1306     4461    1      Y@KEY$ = PINCRW(KV_RCVVDO.VDOVLP_KEY$,SIZEW(KV$VDOVLP));

   4461   1 0012D4  EC80 0000 0000  xsym                 LDB,B6   KV$RCVVDO$
          1 0012D7  DCC6 0014                            LDB,B5   20,B6
          1 0012D9  CBC5 0001                            LAB,B4   1,B5
          1 0012DB  CFC7 0008                            STB,B4   Y@KEY$,AUTO

     1307     4462    2      CALL Y$FNDKEY WHENRETURN DO;

   4462   1 0012DD  E3C0 080D                            LNJ,B6   s:0,PREL
          1 0012DF       000F                            DC       s:4466,PREL

     1308     4463    2   PST_NOKEY: IF KV_RCVVDO.VDOVLP_MRK$~=ADDR(NIL)

   4463   1 0012E0  EC80 0000 0000  xsym PST_NOKEY       LDB,B6   KV$RCVVDO$
          1 0012E3  8DC6 0016                            CMN      22,B6
          1 0012E5  0901 0006                            BE       s:4465,PREL

     1309     4464    2         THEN %KV_STR.ERR.COD = %E$NOKEY;

   4464   1 0012E7  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 0012E9  6C42                                 LDV,R6   66
          1 0012EA  EF45 0013                            STR,R6   19,B5
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:243  

     1310     4465    2      END; WHENALTRETURN DO;

   4465   1 0012EC  0F81 000A                            B        s:4469,PREL

     1311     4466    2         IF %KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.RCRBYTSIZ<0

   4466   1 0012EE  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 0012F0  B847 0016                            LDR,R3   Y@SRHCUR,AUTO
          1 0012F2  3E08                                 ADV,R3   8
          1 0012F3  DCB6                                 LDB,B5   ,B6,R3
          1 0012F4  E845 0001                            LDR,R6   1,B5
          1 0012F6  686A                                 BLZ,R6   s:4463,SPREL

     1312     4467    2         THEN GOTO PST_NOKEY;
     1313     4468    2      END;

     1314     4469    2      DO WHILE Y@SRHCUR<%KV_RCRLST.RCRCNT;

   4469   1 0012F7  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 0012F9  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 0012FB  E946 0001                            CMR,R6   1,B6
          1 0012FD  0881 0012                            BAGE     s:4473,PREL

     1315     4470    2         IF %KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.RCRBYTSIZ>=0 THEN EXIT;

   4470   1 0012FF  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 001301  B847 0016                            LDR,R3   Y@SRHCUR,AUTO
          1 001303  3E08                                 ADV,R3   8
          1 001304  DCB6                                 LDB,B5   ,B6,R3
          1 001305  E845 0001                            LDR,R6   1,B5
          1 001307  6881 0008                            BGEZ,R6  s:4473,PREL

     1316     4471    2         Y@SRHCUR = Y@SRHCUR+1;

   4471   1 001309  8AC7 0016                            INC      Y@SRHCUR,AUTO

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:244  
     1317     4472    2      END;

   4472   1 00130B  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 00130D  E946 0001                            CMR,R6   1,B6
          1 00130F  0870                                 BAL      s:4470,SPREL

     1318     4473    1      IF Y@SRHCUR=%KV_RCRLST.RCRCNT AND NOT %KV_RCRLST.EOF

   4473   1 001310  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 001312  E946 0001                            CMR,R6   1,B6
          1 001314  0981 0006                            BNE      s:4473+11,PREL
          1 001316  82C6 000C                            LB,'0040'X        12,B6
          1 001318       0040
          1 001319  0581 0005                            BBF      s:4474,PREL
          1 00131B  E946 0006                            CMR,R6   6,B6
          1 00131D  0981 0004                            BNE      s:4475,PREL

     1319     4474    1        OR Y@SRHCUR=%KV_RCRLST.CRTRCR THEN RETURN;

   4474   1 00131F  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1320     4475    1      %KV_RCRLST.DFRCNT = Y@SRHCUR-%KV_RCRLST.CRTRCR;

   4475   1 001322  E246 0006                            SUB,R6   6,B6
          1 001324  E7C6 000D                            STH,R6   13,B6

     1321     4476    1      %KV_RCRLST.DFROPR = %KV_INPPRC_SE_DWN;

   4476   1 001326  6C2E                                 LDV,R6   46
          1 001327  E7C6 000E                            STH,R6   14,B6

     1322     4477    1      RETURN;

   4477   1 001329  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1323     4478        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:245  
     1324     4479    1   KVE$RE_DSPSE: ENTRY ALTRET;

   4479   1 00132C  D380 0000 0000  xent KVE$RE_DSPSE    LNJ,B5   X6A_AUTO_1
          1 00132F       005A 0001                       DC       90,1

     1325     4480        /*F* NAME: KVE$RE_DSPSE.
     1326     4481             DESCRIPTION: For non-scrolling terminals, only new records are dispayed
     1327     4482             until there is no typeahead. This code fixes up the screen when the
     1328     4483             typeahead stops.
     1329     4484        */
     1330     4485
     1331     4486    1      CALL Y$SETUP;

   4486   1 001331  E3C0 ECD5                            LNJ,B6   s:0,PREL
          1 001333       0001                            DC       s:4487,PREL

     1332     4487    1      %KV_RCRLST.LSTRCR = -1;

   4487   1 001334  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 001336  8946 0005                            LBT,'FFFF'X       5,B6
          1 001338       FFFF

     1333     4488    1      %KV_VDI.RE_DSPINP = '0'B;

   4488   1 001339  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 00133C  CC85                                 LDB,B4   ,B5
          1 00133D  8844 0019                            LBF,'0010'X       25,B4
          1 00133F       0010

     1334     4489    1      CALL Y$DSPALL;

   4489   1 001340  E3C0 EE3B                            LNJ,B6   s:0,PREL
          1 001342       0001                            DC       s:4490,PREL

     1335     4490    1      %KV_MVD.FRMSCNINH = '0'B;

   4490   1 001343  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:246  
          1 001346  DCC6 0006                            LDB,B5   6,B6
          1 001348  8845 0016                            LBF,'0010'X       22,B5
          1 00134A       0010

     1336     4491    1      IF %KV_SSN.REDRQSPND THEN IF %KV_SSN.REDBFR.NXTX>%KV_VDI.RE_DSPLOWX

   4491   1 00134B  DCC7 000E                            LDB,B5   Y@SSN$,AUTO
          1 00134D  82C5 0028                            LB,'0002'X        40,B5
          1 00134F       0002
          1 001350  0581 0010                            BBF      s:4494,PREL

   4491   1 001352  CC86                                 LDB,B4   ,B6
          1 001353  E845 002A                            LDR,R6   42,B5
          1 001355  6801 0008                            BLZ,R6   s:4493,PREL
          1 001357  E944 0016                            CMR,R6   22,B4
          1 001359  0381 0004                            BLE      s:4493,PREL

     1337     4492    1      THEN ALTRETURN;

   4492   1 00135B  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1338     4493    1      ELSE %KV_VDI.RE_DSPINP = '1'B;

   4493   1 00135E  8944 0019                            LBT,'0010'X       25,B4
   4493   1 001360       0010

     1339     4494    1      RETURN;

   4494   1 001361  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1340     4495        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:247  
     1341     4496    1   KVE$RQSDAT: ENTRY(PRM_INPOPR_DUMMY) ALTRET;

   4496   1 001364  D380 0000 0000  xent KVE$RQSDAT      LNJ,B5   X6A_AUTO_1
          1 001367       005A 0001                       DC       90,1

     1342     4497        /*f* NAME: KVE$RQSDAT.
     1343     4498             DESCRIPTION: Initiates a read operation for a screen editor device.
     1344     4499             Makes sure there's no record waiting to go, that the image is correct
     1345     4500             and gets the cursor to the proper place.
     1346     4501        */
     1347     4502
     1348     4503    1      CALL Y$SETUP;

   4503   1 001369  E3C0 EC9D                            LNJ,B6   s:0,PREL
          1 00136B       0001                            DC       s:4504,PREL

     1349     4504    2      IF %KV_RCRLST.SNDRCR<0 AND %KV_RCRLST.NO_CTX THEN DO;

   4504   1 00136C  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 00136E  E846 0007                            LDR,R6   7,B6
          1 001370  6881 0015                            BGEZ,R6  s:4510,PREL
          1 001372  82C6 000D                            LB,'0008'X        13,B6
          1 001374       0008
          1 001375  0581 0010                            BBF      s:4510,PREL

     1350     4505    2         %KV_RCRLST.SNDRCR=%KV_RCRLST.RCRCNT;

   4505   1 001377  E846 0001                            LDR,R6   1,B6
          1 001379  EF46 0007                            STR,R6   7,B6

     1351     4506    2         %KV_STR.ERR.COD=%E$CANTGETCTX;

   4506   1 00137B  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 00137D  D870 05C8                            LDR,R5   1480,IMO
          1 00137F  DF45 0013                            STR,R5   19,B5

     1352     4507    2         CALL Y$SNDRCR;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:248  

   4507   1 001381  E3C0 0A19                            LNJ,B6   s:0,PREL
          1 001383       0001                            DC       s:4508,PREL

     1353     4508    2         GOTO ABRRED;

   4508   1 001384  0F81 FDD0                            B        s:4338,PREL

     1354     4509    2      END;
     1355     4510    2      IF %KV_RCRLST.SNDRCR>=0 THEN DO;

   4510   1 001386  6801 0006                            BLZ,R6   s:4514,PREL

     1356     4511    2         CALL Y$SNDRCR;

   4511   1 001388  E3C0 0A12                            LNJ,B6   s:0,PREL
          1 00138A       0001                            DC       s:4512,PREL

     1357     4512    2         GOTO ABRRED;

   4512   1 00138B  0F81 FDC9                            B        s:4338,PREL

     1358     4513    2      END;
     1359     4514    2      ELSE IF %KV_RCRLST.SNDRQR THEN DO;

   4514   1 00138D  82C6 000C                            LB,'0006'X        12,B6
   4514   1 00138F       0006
          1 001390  0581 0016                            BBF      s:4521,PREL

     1360     4515    2         %KV_RCRLST.SNDRCR = %KV_RCRLST.CRTRCR;

   4515   1 001392  E846 0006                            LDR,R6   6,B6
          1 001394  EF46 0007                            STR,R6   7,B6

     1361     4516    2         IF %KV_RCRLST.SNDRQR.DLT THEN %KV_RCRLST.SNDRCR = %KV_RCRLST.SNDRCR+1;

   4516   1 001396  82C6 000C                            LB,'0004'X        12,B6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:249  
   4516   1 001398       0004
          1 001399  0581 0003                            BBF      s:4517,PREL

   4516   1 00139B  8AC6 0007                            INC      7,B6

     1362     4517    2         CALL Y$SNDRCR;

   4517   1 00139D  E3C0 09FD                            LNJ,B6   s:0,PREL
          1 00139F       0001                            DC       s:4518,PREL

     1363     4518    2         %KV_RCRLST.SNDRQR = '0'B;

   4518   1 0013A0  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 0013A2  8846 000C                            LBF,'0006'X       12,B6
          1 0013A4       0006

     1364     4519    2         GOTO ABRRED;

   4519   1 0013A5  0F81 FDAF                            B        s:4338,PREL

     1365     4520    2      END;
     1366     4521    2      IF %KV_RCRLST.ACTCHR THEN DO;

   4521   1 0013A7  82C6 000C                            LB,'0008'X        12,B6
   4521   1 0013A9       0008
          1 0013AA  0581 0006                            BBF      s:4528,PREL

     1367     4522        /*
     1368     4523           Stop reading on activation characters.
     1369     4524        */
     1370     4525    2         %KV_RCRLST.ACTCHR = '0'B;

   4525   1 0013AC  8846 000C                            LBF,'0008'X       12,B6
   4525   1 0013AE       0008

     1371     4526    2         GOTO ABRRED;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:250  
   4526   1 0013AF  0F81 FDA5                            B        s:4338,PREL

     1372     4527    2      END;
     1373     4528    2      IF %KV_RCRLST.DFROPR=%KV_INPPRC_SE_DWN THEN DO;

   4528   1 0013B1  D0C6 000E                            LDH,R5   14,B6
          1 0013B3  5D2E                                 CMV,R5   46
          1 0013B4  0981 000A                            BNE      s:4532,PREL

     1374     4529    2         %KV_RCRLST.CRTRCR = %KV_RCRLST.CRTRCR+%KV_RCRLST.DFRCNT;

   4529   1 0013B6  C0C6 000D                            LDH,R4   13,B6
          1 0013B8  CA46 0006                            ADD,R4   6,B6
          1 0013BA  CF46 0006                            STR,R4   6,B6

     1375     4530    2         %KV_RCRLST.DFROPR = -1;      /* Don't double-compensate when deleting   */

   4530   1 0013BC  8946 000E                            LBT,'FF00'X       14,B6
   4530   1 0013BE       FF00

     1376     4531    2      END;

     1377     4532    1      IF %KV_RCRLST.DLTRCREXS THEN CALL Y$DSPALL;

   4532   1 0013BF  82C6 000D                            LB,'0080'X        13,B6
   4532   1 0013C1       0080
          1 0013C2  0581 0004                            BBF      s:4533,PREL

   4532   1 0013C4  E3C0 EDB7                            LNJ,B6   s:0,PREL
          1 0013C6       0001                            DC       s:4533,PREL

     1378     4533    1      Y@REDLIN = %KV_RCRLST.CRTRCR;

   4533   1 0013C7  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 0013C9  E846 0006                            LDR,R6   6,B6
          1 0013CB  EF47 0012                            STR,R6   Y@KEYCMP,AUTO

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:251  
     1379     4534    2      IF %KV_RCRLST.DFROPR<0 THEN DO;

   4534   1 0013CD  D0C6 000E                            LDH,R5   14,B6
          1 0013CF  5881 000B                            BGEZ,R5  s:4539,PREL

     1380     4535    2         Y@REDLIN = -%KV_RCRLST.DFRCNT*256+Y@REDLIN; /* Only direction matters   */

   4535   1 0013D1  C0C6 000D                            LDH,R4   13,B6
          1 0013D3  4008                                 SOL,R4   8
          1 0013D4  8254                                 NEG      R4
          1 0013D5  CA56                                 ADD,R4   R6
          1 0013D6  E854                                 LDR,R6   R4
          1 0013D7  EF47 0012                            STR,R6   Y@KEYCMP,AUTO

     1381     4536    2         %KV_RCRLST.DFROPR = 0;

   4536   1 0013D9  87C6 000E                            CLH      14,B6

     1382     4537    2      END;

     1383     4538
     1384     4539    1      IF %KV_RCRLST.RCRCNT<%KV_RCRLST.FRSRCR

   4539   1 0013DB  D846 0001                            LDR,R5   1,B6
          1 0013DD  D946 0004                            CMR,R5   4,B6
          1 0013DF  0881 0003                            BAGE     s:4541,PREL

     1385     4540    1      THEN %KV_RCRLST.FRSRCR = %KV_RCRLST.RCRCNT;

   4540   1 0013E1  DF46 0004                            STR,R5   4,B6

     1386     4541    1      IF %KV_RCRLST.RCRCNT<%KV_RCRLST.LSTRCR

   4541   1 0013E3  D946 0005                            CMR,R5   5,B6
          1 0013E5  0881 0004                            BAGE     s:4544,PREL

     1387     4542    1      THEN %KV_RCRLST.LSTRCR = %KV_RCRLST.RCRCNT-1;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:252  

   4542   1 0013E7  5EFF                                 ADV,R5   -1
          1 0013E8  DF46 0005                            STR,R5   5,B6

     1388     4543    2      DO;

     1389     4544    2         IF Y@REDLIN<=%KV_RCRLST.LSTRCR

   4544   1 0013EA  E946 0005                            CMR,R6   5,B6
          1 0013EC  0A01 0005                            BAG      s:4546,PREL
          1 0013EE  E946 0004                            CMR,R6   4,B6
          1 0013F0  0881 0037                            BAGE     s:4560,PREL

     1390     4545    2           AND Y@REDLIN>=%KV_RCRLST.FRSRCR THEN EXIT;
     1391     4546    2         Y@REDLIN = %KV_RCRLST.FRSRCR;

   4546   1 0013F2  E846 0004                            LDR,R6   4,B6
          1 0013F4  EF47 0012                            STR,R6   Y@KEYCMP,AUTO

     1392     4547        /*
     1393     4548           Get a more accurate value in CRTVRTLINPHSLIN if it could be wrong
     1394     4549        */
     1395     4550    2         %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.TOPLFT.LIN;

   4550   1 0013F6  DCC7 000C                            LDB,B5   Y@SRD$,AUTO
          1 0013F8  D845 0009                            LDR,R5   9,B5
          1 0013FA  DF45 0013                            STR,R5   19,B5

     1396     4551    2         Y@SRHHI = %KV_SRD.CRTVRTLINPHSLIN+Y@VRTSCRMRG;

   4551   1 0013FC  DA47 0019                            ADD,R5   Y@VRTSCRMRG,AUTO
          1 0013FE  DF47 0014                            STR,R5   Y@SRHHI,AUTO

     1397     4552    3         DO WHILE Y@REDLIN<%KV_RCRLST.RCRCNT;

   4552   1 001400  E946 0001                            CMR,R6   1,B6
          1 001402  0881 0025                            BAGE     s:4560,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:253  

     1398     4553    3            IF %KV_SRD.CRTVRTLINPHSLIN>=Y@SRHHI THEN EXIT;

   4553   1 001404  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 001406  E846 0013                            LDR,R6   19,B6
          1 001408  E947 0014                            CMR,R6   Y@SRHHI,AUTO
          1 00140A  0881 001D                            BAGE     s:4560,PREL

     1399     4554    3            CALL Y$LINCNT (%KV_RCRLST.RCR$(Y@REDLIN)->KV$RCR);

   4554   1 00140C  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 00140E  B847 0012                            LDR,R3   Y@KEYCMP,AUTO
          1 001410  3E08                                 ADV,R3   8
          1 001411  CCB5                                 LDB,B4   ,B5,R3
          1 001412  CFC7 003A                            STB,B4   Y@ORGVRTCLM+1,AUTO
          1 001414  E3C0 0590                            LNJ,B6   s:0,PREL
          1 001416       0001                            DC       s:4555,PREL

     1400     4555    3            %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRTVRTLINPHSLIN+Y@LINCNT;

   4555   1 001417  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 001419  E846 0013                            LDR,R6   19,B6
          1 00141B  EA47 001B                            ADD,R6   Y@LINCNT,AUTO
          1 00141D  EF46 0013                            STR,R6   19,B6

     1401     4556    3            Y@REDLIN = Y@REDLIN+1;

   4556   1 00141F  8AC7 0012                            INC      Y@KEYCMP,AUTO

     1402     4557    3         END;

   4557   1 001421  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001423  D847 0012                            LDR,R5   Y@KEYCMP,AUTO
          1 001425  D945 0001                            CMR,R5   1,B5
          1 001427  085D                                 BAL      s:4553,SPREL

     1403     4558    2      END;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:254  

     1404     4559
     1405     4560    2      CALL Y$CHKSCR WHENALTRETURN DO;

   4560   1 001428  E3C0 0321                            LNJ,B6   s:0,PREL
          1 00142A       0003                            DC       s:4561,PREL
          1 00142B  0F81 0014                            B        s:4568,PREL

     1406     4561    2         IF %KV_RCRLST.RCRNEDSNT THEN EXIT;

   4561   1 00142D  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 00142F  82C6 000C                            LB,'0080'X        12,B6
          1 001431       0080
          1 001432  0501 000D                            BBT      s:4568,PREL

     1407     4562    2         IF %KV_STR.SNDMAXNMBRCR~=0 THEN CALL Y$SNDNEED;

   4562   1 001434  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 001436  E845 0019                            LDR,R6   25,B5
          1 001438  6901 0004                            BEZ,R6   s:4566,PREL

   4562   1 00143A  E3C0 08E0                            LNJ,B6   s:0,PREL
          1 00143C       0001                            DC       s:4566,PREL

     1408     4563        /*E*  ERROR: KVE-E$RECORDS_NEEDED-0
     1409     4564              MESSAGE:The FEP needs records to continue screen-editing.
     1410     4565        */
     1411     4566    2         RETURN;

   4566   1 00143D  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1412     4567    2      END;
     1413     4568    2      IF %KV_RCRLST.RCRNEDSNT THEN DO;

   4568   1 001440  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 001442  82C6 000C                            LB,'0080'X        12,B6
          1 001444       0080
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:255  
          1 001445  0581 000A                            BBF      s:4576,PREL

     1414     4569        /*
     1415     4570           Got a read while still needing records. Must be all the records.
     1416     4571        */
     1417     4572    2         %KV_RCRLST.EOF = '1'B;

   4572   1 001447  8946 000C                            LBT,'0040'X       12,B6
   4572   1 001449       0040

     1418     4573    2         %KV_RCRLST.BOF = '1'B;

   4573   1 00144A  8946 000C                            LBT,'0020'X       12,B6
   4573   1 00144C       0020

     1419     4574    2         %KV_RCRLST.RCRNEDSNT = '0'B;

   4574   1 00144D  8846 000C                            LBF,'0080'X       12,B6
   4574   1 00144F       0080

     1420     4575    2      END;

     1421     4576    1      IF %KV_SSN.REDRQSPND THEN RETURN;

   4576   1 001450  DCC7 000E                            LDB,B5   Y@SSN$,AUTO
          1 001452  82C5 0028                            LB,'0002'X        40,B5
          1 001454       0002
          1 001455  0581 0004                            BBF      s:4577,PREL

   4576   1 001457  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1422     4577    1      KV@USR_RQSDAT = PRM_RQSDAT;

   4577   1 00145A  ACC7 0004                            LDB,B2   @PRM_INPOPR_DUMMY,AUTO
          1 00145C  2C00                                 LDV,R2   0
          1 00145D  6C0C                                 LDV,R6   12
          1 00145E  BB87                                 LAB,B3   ,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:256  
          1 00145F  3C40                                 LDV,R3   64
          1 001460  0008                                 MMM

   4577   1                              Y$ENBRED        null
     1423     4578        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:257  
     1424     4579    1   Y$ENBRED:;
     1425     4580        /*N* TEMP UNTIL I FIGGER HOW TO DEAL WITH OTHER STREAM READS INTERRUPTING */
     1426     4581    2      IF %KV_STR.SNDMAXNMBRCR=0 THEN DO;

   4581   1 001461  ECC7 0010            Y$ENBRED        LDB,B6   Y@STR$,AUTO
          1 001463  E846 0019                            LDR,R6   25,B6
          1 001465  6981 0010                            BNEZ,R6  s:4586,PREL

     1427     4582    2         CALL KVI$PRGRED;

   4582   1 001467  CBF0 0000                            LAB,B4   0,IMO
          1 001469  E380 0000 0000  xent                 LNJ,B6   KVI$PRGRED
          1 00146C       0001                            DC       s:4583,PREL

     1428     4583    2         CALL KVI$TRMRED_VDH_DAT;

   4583   1 00146D  CBF0 0000                            LAB,B4   0,IMO
          1 00146F  E380 0000 0000  xent                 LNJ,B6   KVI$TRMRED_VDH_DAT
          1 001472       0001                            DC       s:4584,PREL

     1429     4584    2         RETURN;

   4584   1 001473  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1430     4585    2      END;
     1431     4586    1      IF %KV_RCRLST.CRTRCR>=%KV_RCRLST.RCRCNT

   4586   1 001476  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001478  D845 0006                            LDR,R5   6,B5
          1 00147A  D945 0001                            CMR,R5   1,B5
          1 00147C  0801 0077                            BAL      s:4621,PREL

     1432     4587    2      THEN IF %KV_RCRLST.KEYINC=65535 THEN DO;

   4587   1 00147E  C845 0008                            LDR,R4   8,B5
          1 001480  C970 FFFF                            CMR,R4   -1,IMO
          1 001482  0981 0016                            BNE      s:4599,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:258  

     1433     4588    3         IF %KV_RCRLST.RCRCNT=0 THEN DO;

   4588   1 001484  B845 0001                            LDR,R3   1,B5
          1 001486  3981 000A                            BNEZ,R3  s:4593,PREL

     1434     4589    3            %KV_STR.ERR.COD = %E$INSERT_NO_ROOM;

   4589   1 001488  A870 05A7                            LDR,R2   1447,IMO
          1 00148A  AF46 0013                            STR,R2   19,B6

     1435     4590    3            CALL Y$SNDRCR;

   4590   1 00148C  E3C0 090E                            LNJ,B6   s:0,PREL
          1 00148E       0001                            DC       s:4591,PREL

     1436     4591    3            GOTO ABRRED;

   4591   1 00148F  0F81 FCC5                            B        s:4338,PREL

     1437     4592    3         END;
     1438     4593    2         %KV_RCRLST.CRTRCR = %KV_RCRLST.RCRCNT-1;

   4593   1 001491  D853                                 LDR,R5   R3
          1 001492  5EFF                                 ADV,R5   -1
          1 001493  DF45 0006                            STR,R5   6,B5

     1439     4594    2         %KV_STR.RE_REDCLM = 0;

   4594   1 001495  8746 0012                            CL       18,B6

     1440     4595    2      END; ELSE DO;

   4595   1 001497  0F81 005C                            B        s:4621,PREL

     1441     4596        /*
     1442     4597           Make a temp record to start an empty file.
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:259  
     1443     4598        */
     1444     4599    2         IF %KV_RCRLST.RCRCNT=0 AND KV_RCVVDO.VDOVLP_KEY$~=ADDR(NIL)

   4599   1 001499  B845 0001                            LDR,R3   1,B5
          1 00149B  3981 0010                            BNEZ,R3  s:4603,PREL
          1 00149D  CC80 0000 0000  xsym                 LDB,B4   KV$RCVVDO$
          1 0014A0  8DC4 0014                            CMN      20,B4
          1 0014A2  0901 0009                            BE       s:4603,PREL

     1445     4600    2         THEN ADDR(KV@VDH_OTPLCL)->KEYU4 =

   4600   1 0014A4  BCC4 0014                            LDB,B3   20,B4
          1 0014A6  8CC3 0001                            LDI      1,B3
          1 0014A8  8D47 0031                            SDI      KV@VDH_OTPLCL,AUTO
          1 0014AA  0F81 001B                            B        s:4609,PREL

     1446     4601    2           PINCRW(KV_RCVVDO.VDOVLP_KEY$,SIZEW(KV$VDOVLP))->KEYU4;
     1447     4602    3         ELSE DO;

     1448     4603    3            IF %KV_RCRLST.RCRCNT=0 THEN Y@KEY$ = ADDR(Y_LTLKEY);

   4603   1 0014AC  3981 0008                            BNEZ,R3  s:4604,PREL

   4603   1 0014AE  CB80 0000 0010  00                   LAB,B4   Y_LTLKEY
          1 0014B1  CFC7 0008                            STB,B4   Y@KEY$,AUTO
          1 0014B3  0F81 0007                            B        s:4605,PREL

     1449     4604    3            ELSE Y@KEY$ = ADDR(%KV_RCRLST.RCR$(%KV_RCRLST.RCRCNT-1)->KV$RCR.TXT);

   4604   1 0014B5  3E07                                 ADV,R3   7
          1 0014B6  CCB5                                 LDB,B4   ,B5,R3
          1 0014B7  BBC4 0003                            LAB,B3   3,B4
          1 0014B9  BFC7 0008                            STB,B3   Y@KEY$,AUTO

     1450     4605    3            Y@KEYINC = %KV_RCRLST.KEYINC;

   4605   1 0014BB  CF47 0014                            STR,R4   Y@SRHHI,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:260  

     1451     4606    3            IF Y@KEYINC=65535 THEN Y@KEYINC = 0;

   4606   1 0014BD  C970 FFFF                            CMR,R4   -1,IMO
          1 0014BF  0981 0003                            BNE      s:4607,PREL

   4606   1 0014C1  8747 0014                            CL       Y@SRHHI,AUTO

     1452     4607    3            CALL Y$INCKEY;

   4607   1 0014C3  E3C0 07EE                            LNJ,B6   s:0,PREL
          1 0014C5       0001                            DC       s:4609,PREL

     1453     4608    3         END;

     1454     4609    2         Y@SRHCUR = %KV_RCRLST.RCRCNT;

   4609   1 0014C6  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 0014C8  E846 0001                            LDR,R6   1,B6
          1 0014CA  EF47 0016                            STR,R6   Y@SRHCUR,AUTO

     1455     4610    2         %KV_RCRLST.CRTRCR = Y@SRHCUR;

   4610   1 0014CC  EF46 0006                            STR,R6   6,B6

     1456     4611    2         IF Y@SRHCUR<%KV_RCRLST.MAXRCR THEN Y@DLTRCR = -1;

   4611   1 0014CE  E946 0002                            CMR,R6   2,B6
          1 0014D0  0881 0006                            BAGE     s:4612,PREL

   4611   1 0014D2  8947 0014                            LBT,'FFFF'X       Y@SRHHI,AUTO
   4611   1 0014D4       FFFF
          1 0014D5  0F81 0003                            B        s:4613,PREL

     1457     4612    2         ELSE Y@DLTRCR = 0;

   4612   1 0014D7  8747 0014                            CL       Y@SRHHI,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:261  

     1458     4613    2         %KV_STR.RE_REDCLM = 1;

   4613   1 0014D9  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 0014DB  5C01                                 LDV,R5   1
          1 0014DC  DF45 0012                            STR,R5   18,B5

     1459     4614    2         Y@BFRSIZ = LENGTHV(KV$RCR)+Y@KEYLNG;

   4614   1 0014DE  C847 0013                            LDR,R4   Y@KEYLNG,AUTO
          1 0014E0  4E06                                 ADV,R4   6
          1 0014E1  CF47 0015                            STR,R4   Y@SRHLO,AUTO

     1460     4615    2         CALL Y$GETRCRBFR ALTRET(ABRRED);

   4615   1 0014E3  E3C0 0669                            LNJ,B6   s:0,PREL
          1 0014E5       FC70                            DC       s:4338,PREL

     1461     4616    2         %KV_RCR.LINCNT = 0;

   4616   1 0014E6  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 0014E8  87C6 0002                            CLH      2,B6

     1462     4617    2         %KV_RCR.NEW = '1'B;

   4617   1 0014EA  8946 0002                            LBT,'0020'X       2,B6
   4617   1 0014EC       0020

     1463     4618    2         %KV_SSN.REDBFR__.DATBYTSIZ = 0;   /* Dont display the wrong record      */

   4618   1 0014ED  DCC7 000E                            LDB,B5   Y@SSN$,AUTO
          1 0014EF  8745 0033                            CL       51,B5

     1464     4619    2         CALL Y$DSPALL;

   4619   1 0014F1  E3C0 EC8A                            LNJ,B6   s:0,PREL
          1 0014F3       0001                            DC       s:4621,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:262  

     1465     4620    2      END;

     1466     4621    1      Y@RCR$ = %KV_RCRLST.RCR$(%KV_RCRLST.CRTRCR);

   4621   1 0014F4  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 0014F6  B846 0006                            LDR,R3   6,B6
          1 0014F8  3E08                                 ADV,R3   8
          1 0014F9  DCB6                                 LDB,B5   ,B6,R3
          1 0014FA  DFC7 000A                            STB,B5   Y@RCR$,AUTO

     1467     4622    1      KV@USR_RQSDAT.BFR_.ADR$ = ADDR(%KV_RCR);

   4622   1 0014FC  DFC7 0021                            STB,B5   KV@USR_RQSDAT+1,AUTO

     1468     4623    1      KV@USR_RQSDAT.BFR_.BYTSIZ = %KV_RCR.RCRBYTSIZ;

   4623   1 0014FE  E845 0001                            LDR,R6   1,B5
          1 001500  EF47 0024                            STR,R6   KV@USR_RQSDAT+4,AUTO

     1469     4624    1      KV@USR_RQSDAT.BFR_.BYTX = Y@KEYLNG+LENGTHV(KV$RCR);

   4624   1 001502  D847 0013                            LDR,R5   Y@KEYLNG,AUTO
          1 001504  5E06                                 ADV,R5   6
          1 001505  DF47 0023                            STR,R5   KV@USR_RQSDAT+3,AUTO

     1470     4625    1      KV@USR_RQSDAT.RE_RED = '1'B;

   4625   1 001507  8947 0020                            LBT,'0080'X       KV@USR_RQSDAT,AUTO
   4625   1 001509       0080

     1471     4626    1      IF %KV_STR.AUTTABCLM>KV@USR_RQSDAT.BFR_.BYTSIZ

   4626   1 00150A  CCC7 0010                            LDB,B4   Y@STR$,AUTO
          1 00150C  C2C4 001E                            LLH,R4   30,B4
          1 00150E  C956                                 CMR,R4   R6
          1 00150F  0381 0011                            BLE      s:4629,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:263  

     1472     4627    1      THEN IF %KV_RCRLST.TXTEDT OR %KV_RCR.NEW AND %KV_RCR.RCRBYTSIZ=0

   4627   1 001511  82C6 000D                            LB,'0040'X        13,B6
   4627   1 001513       0040
          1 001514  0501 000A                            BBT      s:4628,PREL
          1 001516  82C5 0002                            LB,'0020'X        2,B5
          1 001518       0020
          1 001519  0581 0007                            BBF      s:4629,PREL
          1 00151B  B845 0001                            LDR,R3   1,B5
          1 00151D  3981 0003                            BNEZ,R3  s:4629,PREL

     1473     4628    1      THEN %KV_STR.RE_REDCLM = %KV_STR.AUTTABCLM;

   4628   1 00151F  CF44 0012                            STR,R4   18,B4

     1474     4629    2      IF NOT %KV_MVD.HRZSCR THEN DO;

   4629   1 001521  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 001524  ACC3 0006                            LDB,B2   6,B3
          1 001526  82C2 0016                            LB,'0004'X        22,B2
          1 001528       0004
          1 001529  0501 002D                            BBT      s:4643,PREL

     1475     4630    2         IF KV@USR_RQSDAT.MAXRCRBYTSIZ>%KV_SRD.LNG*%KV_SRD.WDT

   4630   1 00152B  9CC7 000C                            LDB,B1   Y@SRD$,AUTO
          1 00152D  F2C1 000E                            LLH,R7   14,B1
          1 00152F  FB41 000D                            MUL,R7   13,B1
          1 001531  E857                                 LDR,R6   R7
          1 001532  E947 0025                            CMR,R6   KV@USR_RQSDAT+5,AUTO
          1 001534  0281 0008                            BGE      s:4632,PREL

     1476     4631    2         THEN KV@USR_RQSDAT.MAXRCRBYTSIZ = %KV_SRD.LNG*%KV_SRD.WDT;

   4631   1 001536  F2C1 000E                            LLH,R7   14,B1
          1 001538  FB41 000D                            MUL,R7   13,B1
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:264  
          1 00153A  E857                                 LDR,R6   R7
          1 00153B  EF47 0025                            STR,R6   KV@USR_RQSDAT+5,AUTO

     1477     4632    2         IF KV@USR_RQSDAT.BFR_.BYTSIZ<=KV@USR_RQSDAT.MAXRCRBYTSIZ THEN EXIT;

   4632   1 00153D  E847 0024                            LDR,R6   KV@USR_RQSDAT+4,AUTO
          1 00153F  E947 0025                            CMR,R6   KV@USR_RQSDAT+5,AUTO
          1 001541  0381 0015                            BLE      s:4643,PREL

   4632   1                              ERR_LD          null
     1478     4633    2   ERR_LD:; /* KVE$INCFLD could report E$LD if spaceinsert is off */
     1479     4634        /* Cannot possibly edit this record. Abort the read. */
     1480     4635    2         %KV_STR.ERR.COD = %E$LD;

   4635   1 001543  ECC7 0010            ERR_LD          LDB,B6   Y@STR$,AUTO
          1 001545  6C07                                 LDV,R6   7
          1 001546  EF46 0013                            STR,R6   19,B6

     1481     4636        /*E*  ERROR:KVE-E$LD-0
     1482     4637              MESSAGE:Record too large to edit.
     1483     4638        */
     1484     4639    2         %KV_RCRLST.SNDRCR = %KV_RCRLST.CRTRCR;

   4639   1 001548  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 00154A  D845 0006                            LDR,R5   6,B5
          1 00154C  DF45 0007                            STR,R5   7,B5

     1485     4640    2         IF %KV_STR.SNDMAXNMBRCR~=0 THEN CALL Y$SNDRCR;

   4640   1 00154E  C846 0019                            LDR,R4   25,B6
          1 001550  4901 0004                            BEZ,R4   s:4641,PREL

   4640   1 001552  E3C0 0848                            LNJ,B6   s:0,PREL
          1 001554       0001                            DC       s:4641,PREL

     1486     4641    2         GOTO ABRRED;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:265  
   4641   1 001555  0F81 FBFF                            B        s:4338,PREL

     1487     4642    2      END;
     1488     4643    1      %KV_SRD.PRMVRTCLM = 0;

   4643   1 001557  ACC7 000C                            LDB,B2   Y@SRD$,AUTO
          1 001559  8742 0012                            CL       18,B2

     1489     4644    1      IF %KV_MVD.HRZSCR THEN %KV_SSN.REDBFR.DSPLOWX = %KV_RCRLST.HRZSCROFS;

   4644   1 00155B  9CC3 0006                            LDB,B1   6,B3
          1 00155D  82C1 0016                            LB,'0004'X        22,B1
          1 00155F       0004
          1 001560  0581 0009                            BBF      s:4645,PREL

   4644   1 001562  ECC7 000E                            LDB,B6   Y@SSN$,AUTO
          1 001564  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001566  E845 0003                            LDR,R6   3,B5
          1 001568  EF46 002F                            STR,R6   47,B6

     1490     4645    1      IF %KV_MVD.FRMSCNINH THEN %KV_VDI.RE_DSPINP = '1'B;

   4645   1 00156A  ECC3 0006                            LDB,B6   6,B3
          1 00156C  82C6 0016                            LB,'0010'X        22,B6
          1 00156E       0010
          1 00156F  0581 0005                            BBF      s:4646,PREL

   4645   1 001571  DC83                                 LDB,B5   ,B3
          1 001572  8945 0019                            LBT,'0010'X       25,B5
          1 001574       0010

     1491     4646    1      KV@VDH_OTPLCL.NO_WRAP = %KV_VDI.RE_DSPINP;

   4646   1 001575  EC83                                 LDB,B6   ,B3
          1 001576  E846 0019                            LDR,R6   25,B6
          1 001578  EAC7 0031                            SRM,R6,'0010'X    KV@VDH_OTPLCL,AUTO
          1 00157A       0010
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:266  

     1492     4647    1      KV$PTR.INPCNDPND.OPRX = 0;

   4647   1 00157B  8743 001C                            CL       28,B3

     1493     4648    1      IF %KV_RCRLST.DFROPR~=0 THEN %KV_VDI.USRRQSDAT.RED = '1'B;

   4648   1 00157D  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 00157F  E0C6 000E                            LDH,R6   14,B6
          1 001581  6901 0005                            BEZ,R6   s:4650,PREL

   4648   1 001583  DC83                                 LDB,B5   ,B3
          1 001584  8945 001D                            LBT,'0010'X       29,B5
          1 001586       0010

     1494     4649        /* Don't process typeahead for a deferred operator. */
     1495     4650    1      CALL KVI$RQSDAT (KV@USR_RQSDAT);

   4650   1 001587  DBC7 0020                            LAB,B5   KV@USR_RQSDAT,AUTO
          1 001589  DFC7 0056                            STB,B5   KV@SND_DAT+23,AUTO
          1 00158B  BBC7 0056                            LAB,B3   KV@SND_DAT+23,AUTO
          1 00158D  CBF0 0100                            LAB,B4   256,IMO
          1 00158F  E380 0000 0000  xent                 LNJ,B6   KVI$RQSDAT
          1 001592       0001                            DC       s:4651,PREL

     1496     4651    2      IF KV@VDH_OTPLCL.NO_WRAP THEN DO;

   4651   1 001593  82C7 0031                            LB,'0010'X        KV@VDH_OTPLCL,AUTO
   4651   1 001595       0010
          1 001596  0581 000D                            BBF      s:4655,PREL

     1497     4652    2         %KV_VDI.RE_DSPINP = '1'B;

   4652   1 001598  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00159B  DC86                                 LDB,B5   ,B6
          1 00159C  8945 0019                            LBT,'0010'X       25,B5
          1 00159E       0010
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:267  

     1498     4653    2         %KV_VDI.RE_DSPLOWX = KV@USR_RQSDAT.BFR_.BYTSIZ;

   4653   1 00159F  DC86                                 LDB,B5   ,B6
          1 0015A0  E847 0024                            LDR,R6   KV@USR_RQSDAT+4,AUTO
          1 0015A2  EF45 0016                            STR,R6   22,B5

     1499     4654    2      END;

     1500     4655    1      IF NOT %KV_SSN.REDRQSPND THEN RETURN;

   4655   1 0015A4  ECC7 000E                            LDB,B6   Y@SSN$,AUTO
          1 0015A6  82C6 0028                            LB,'0002'X        40,B6
          1 0015A8       0002
          1 0015A9  0501 0004                            BBT      s:4656,PREL

   4655   1 0015AB  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1501     4656    2      IF %KV_RCRLST.DFROPR~=0 THEN DO;

   4656   1 0015AE  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 0015B0  E0C5 000E                            LDH,R6   14,B5
          1 0015B2  6901 0014                            BEZ,R6   s:4665,PREL

     1502     4657    2         Y@LINCNT = %KV_RCRLST.DFROPR;

   4657   1 0015B4  EF47 001B                            STR,R6   Y@LINCNT,AUTO

     1503     4658    2         Y@DLTRCR = %KV_RCRLST.DFRCNT;

   4658   1 0015B6  D0C5 000D                            LDH,R5   13,B5
          1 0015B8  DF47 0014                            STR,R5   Y@SRHHI,AUTO

     1504     4659    2         %KV_RCRLST.DFROPR = 0;

   4659   1 0015BA  87C5 000E                            CLH      14,B5

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:268  
     1505     4660    2         IF Y@LINCNT=%KV_INPPRC_SPLIT THEN Y@DLTRCR = 1;

   4660   1 0015BC  6D2B                                 CMV,R6   43
          1 0015BD  0981 0004                            BNE      s:4661,PREL

   4660   1 0015BF  5C01                                 LDV,R5   1
          1 0015C0  DF47 0014                            STR,R5   Y@SRHHI,AUTO

     1506     4661    2         CALL Y$SETUP;

   4661   1 0015C2  E3C0 EA44                            LNJ,B6   s:0,PREL
          1 0015C4       0001                            DC       s:4662,PREL

     1507     4662    2         GOTO INPOPR;

   4662   1 0015C5  0F81 F2C7                            B        s:3824,PREL

     1508     4663    2      END;
     1509     4664    2      DO WHILE '1'B;

     1510     4665    2         KV@USR_RQSDAT.RE_RED = %KV_SRD.VRTPSTOK;

   4665   1 0015C7  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 0015C9  E846 000E                            LDR,R6   14,B6
          1 0015CB  6003                                 SOL,R6   3
          1 0015CC  EAC7 0020                            SRM,R6,'0080'X    KV@USR_RQSDAT,AUTO
          1 0015CE       0080

     1511     4666        /*
     1512     4667           VRTPSTOK must be preserved so that typed-ahead input works properly
     1513     4668           (RE_DSPINP in particular).
     1514     4669        */
     1515     4670    2         CALL Y$DSPALL;

   4670   1 0015CF  E3C0 EBAC                            LNJ,B6   s:0,PREL
          1 0015D1       0001                            DC       s:4671,PREL

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:269  
     1516     4671    2         %KV_SRD.VRTPSTOK = KV@USR_RQSDAT.RE_RED;

   4671   1 0015D2  E847 0020                            LDR,R6   KV@USR_RQSDAT,AUTO
          1 0015D4  6043                                 SOR,R6   3
          1 0015D5  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 0015D7  EAC6 000E                            SRM,R6,'0010'X    14,B6
          1 0015D9       0010

     1517     4672    2         IF %KV_RCRLST.PRTLSTRCR AND %KV_RCRLST.CRTRCR=%KV_RCRLST.LSTRCR

   4672   1 0015DA  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 0015DC  82C5 000C                            LB,'0010'X        12,B5
          1 0015DE       0010
          1 0015DF  0581 0007                            BBF      s:4672+13,PREL
          1 0015E1  E845 0006                            LDR,R6   6,B5
          1 0015E3  E945 0005                            CMR,R6   5,B5
          1 0015E5  0901 0007                            BE       s:4674,PREL
          1 0015E7  E845 0006                            LDR,R6   6,B5
          1 0015E9  E945 0005                            CMR,R6   5,B5
          1 0015EB  0A81 0016                            BALE     s:4681,PREL

     1518     4673    3           OR %KV_RCRLST.CRTRCR>%KV_RCRLST.LSTRCR THEN DO;

     1519     4674    3            %KV_RCRLST.VRTSCRCNT =

   4674   1 0015ED  B845 0004                            LDR,R3   4,B5
          1 0015EF  3E08                                 ADV,R3   8
          1 0015F0  CCB5                                 LDB,B4   ,B5,R3
          1 0015F1  D0C4 0002                            LDH,R5   2,B4
          1 0015F3  8255                                 NEG      R5
          1 0015F4  D7C5 000A                            STH,R5   10,B5

     1520     4675    3              -%KV_RCRLST.RCR$(%KV_RCRLST.FRSRCR)->KV$RCR.LINCNT;
     1521     4676    3            IF NOT %KV_SRD.VRTSCR THEN %KV_RCRLST.LSTRCR = %KV_RCRLST.FRSRCR;

   4676   1 0015F6  82C6 001D                            LB,'4000'X        29,B6
   4676   1 0015F8       4000
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:270  
          1 0015F9  0501 0005                            BBT      s:4677,PREL

   4676   1 0015FB  D845 0004                            LDR,R5   4,B5
          1 0015FD  DF45 0005                            STR,R5   5,B5

     1522     4677    3            %KV_RCRLST.FRSRCR = %KV_RCRLST.FRSRCR+1;

   4677   1 0015FF  8AC5 0004                            INC      4,B5

     1523     4678    3         END;

   4678   1 001601  0FC6                                 B        s:4665,SPREL

     1524     4679    2         ELSE EXIT;
     1525     4680    2      END;

     1526     4681    1      RETURN;

   4681   1 001602  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1527     4682        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:271  
     1528     4683    1   KVE$SCRALL: ENTRY ALTRET;

   4683   1 001605  D380 0000 0000  xent KVE$SCRALL      LNJ,B5   X6A_AUTO_1
          1 001608       005A 0001                       DC       90,1

     1529     4684        /*F* NAME: KVE$SCRALL
     1530     4685             PURPOSE: Slides the rest of the records to where the cursor one is.
     1531     4686        */
     1532     4687    1      CALL Y$SETUP;

   4687   1 00160A  E3C0 E9FC                            LNJ,B6   s:0,PREL
          1 00160C       0001                            DC       s:4688,PREL

     1533     4688    1      Y@KEYLNG = Y@KEYLNG+LENGTHV(KV$RCR); /* More useful this way here          */

   4688   1 00160D  E847 0013                            LDR,R6   Y@KEYLNG,AUTO
          1 00160F  6E06                                 ADV,R6   6
          1 001610  EF47 0013                            STR,R6   Y@KEYLNG,AUTO

     1534     4689    1      Y@DLTRCR = %KV_RCRLST.HRZSCROFS-%KV_SSN.REDBFR.DSPLOWX;

   4689   1 001612  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 001614  DCC7 000E                            LDB,B5   Y@SSN$,AUTO
          1 001616  D846 0003                            LDR,R5   3,B6
          1 001618  D245 002F                            SUB,R5   47,B5
          1 00161A  DF47 0014                            STR,R5   Y@SRHHI,AUTO

     1535     4690    1      IF Y@DLTRCR=0 THEN RETURN;

   4690   1 00161C  5981 0004                            BNEZ,R5  s:4691,PREL

   4690   1 00161E  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1536     4691    1      %KV_RCRLST.HRZSCROFS = %KV_SSN.REDBFR.DSPLOWX;

   4691   1 001621  C845 002F                            LDR,R4   47,B5
          1 001623  CF46 0003                            STR,R4   3,B6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:272  

     1537     4692    1      KV@VDH_OTPLCL = Y_VDH_OTPLCL;

   4692   1 001625  AB80 0000 0000  00                   LAB,B2   Y_VDH_OTPLCL
          1 001628  2C00                                 LDV,R2   0
          1 001629  6C0A                                 LDV,R6   10
          1 00162A  BB87                                 LAB,B3   ,AUTO
          1 00162B  3C62                                 LDV,R3   98
          1 00162C  0008                                 MMM

     1538     4693    1      KV@USR_PST = KV_USR_PST;

   4693   1 00162D  AB80 0000 0000  xsym                 LAB,B2   KV_USR_PST
          1 001630  2C00                                 LDV,R2   0
          1 001631  6C08                                 LDV,R6   8
          1 001632  BB87                                 LAB,B3   ,AUTO
          1 001633  3C38                                 LDV,R3   56
          1 001634  0008                                 MMM

     1539     4694    1      KV@USR_PST.PHSPST = %KV_SRD.TOPLFT;

   4694   1 001635  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 001637  8CC6 0009                            LDI      9,B6
          1 001639  8D47 001D                            SDI      KV@USR_PST+1,AUTO

     1540     4695    1      KV@USR_PST.PHSPSTMOD = %KV_PHSPSTMOD_HRZSCR;

   4695   1 00163B  5C05                                 LDV,R5   5
          1 00163C  D7C7 001F                            STH,R5   KV@USR_PST+3,AUTO

     1541     4696    1      KV@USR_PST.SCRCNT = Y@DLTRCR;

   4696   1 00163E  C847 0014                            LDR,R4   Y@SRHHI,AUTO
          1 001640  CAC7 001F                            SRM,R4,'00FF'X    KV@USR_PST+3,AUTO
          1 001642       00FF

     1542     4697    1      IF Y@DLTRCR>25 OR Y@DLTRCR<-25 THEN KV@USR_PST.SCRCNT = 0;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:273  

   4697   1 001643  4D19                                 CMV,R4   25
          1 001644  0A01 0004                            BAG      s:4697+6,PREL
          1 001646  4DE7                                 CMV,R4   -25
          1 001647  0881 0006                            BAGE     s:4698,PREL

   4697   1 001649  8847 001F                            LBF,'00FF'X       KV@USR_PST+3,AUTO
   4697   1 00164B       00FF
          1 00164C  0F81 0008                            B        s:4699,PREL

     1543     4698    1      ELSE IF Y@DLTRCR<0 THEN Y@DLTRCR = -%KV_SRD.WDT-Y@DLTRCR;

   4698   1 00164E  4881 0006                            BGEZ,R4  s:4699,PREL

   4698   1 001650  CA46 000D                            ADD,R4   13,B6
          1 001652  8254                                 NEG      R4
          1 001653  CF47 0014                            STR,R4   Y@SRHHI,AUTO

     1544     4699    1      Y@SRHCUR = %KV_RCRLST.FRSRCR;

   4699   1 001655  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001657  B845 0004                            LDR,R3   4,B5
          1 001659  BF47 0016                            STR,R3   Y@SRHCUR,AUTO

     1545     4700    2      DO WHILE '1'B;

     1546     4701    2         IF KV@USR_PST.PHSPST.LIN>%KV_SRD.BTMRHT.LIN

   4701   1 00165B  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 00165D  E847 001D                            LDR,R6   KV@USR_PST+1,AUTO
          1 00165F  E946 000B                            CMR,R6   11,B6
          1 001661  0A01 00D7                            BAG      s:4748,PREL
          1 001663  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001665  D847 0016                            LDR,R5   Y@SRHCUR,AUTO
          1 001667  D945 0001                            CMR,R5   1,B5
          1 001669  0881 00CF                            BAGE     s:4748,PREL

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:274  
     1547     4702    2           OR Y@SRHCUR>=%KV_RCRLST.RCRCNT THEN EXIT;
     1548     4703    3         IF Y@SRHCUR~=%KV_RCRLST.CRTRCR THEN DO;

   4703   1 00166B  D945 0006                            CMR,R5   6,B5
          1 00166D  0901 00C5                            BE       s:4745,PREL

     1549     4704    3            Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);

   4704   1 00166F  B855                                 LDR,R3   R5
          1 001670  3E08                                 ADV,R3   8
          1 001671  CCB5                                 LDB,B4   ,B5,R3
          1 001672  CFC7 000A                            STB,B4   Y@RCR$,AUTO

     1550     4705    3            KV@VDH_OTPLCL.BFR_.ADR$ = Y@RCR$;

   4705   1 001674  CFC7 0032                            STB,B4   KV@VDH_OTPLCL+1,AUTO

     1551     4706    3            KV@VDH_OTPLCL.BFR_.BYTX = %KV_RCRLST.HRZSCROFS+Y@KEYLNG;

   4706   1 001676  C845 0003                            LDR,R4   3,B5
          1 001678  CA47 0013                            ADD,R4   Y@KEYLNG,AUTO
          1 00167A  CF47 0034                            STR,R4   KV@VDH_OTPLCL+3,AUTO

     1552     4707    3            IF %KV_RCR.RCRBYTSIZ>%KV_RCRLST.HRZSCROFS

   4707   1 00167C  A844 0001                            LDR,R2   1,B4
          1 00167E  A945 0003                            CMR,R2   3,B5
          1 001680  0A81 0007                            BALE     s:4709,PREL

     1553     4708    3            THEN KV@VDH_OTPLCL.BFR_.BYTSIZ = %KV_RCR.RCRBYTSIZ-%KV_RCRLST.HRZSCROFS;

   4708   1 001682  A245 0003                            SUB,R2   3,B5
          1 001684  AF47 0035                            STR,R2   KV@VDH_OTPLCL+4,AUTO
          1 001686  0F81 0003                            B        s:4710,PREL

     1554     4709    3            ELSE KV@VDH_OTPLCL.BFR_.BYTSIZ = 0;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:275  
   4709   1 001688  8747 0035                            CL       KV@VDH_OTPLCL+4,AUTO

     1555     4710    4            IF %KV_MRD.HRZSCR AND %KV_RCR.ONE_2_1 AND KV@USR_PST.SCRCNT~=0 THEN DO;

   4710   1 00168A  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 00168D  ACC3 0008                            LDB,B2   8,B3
          1 00168F  82C2 0017                            LB,'0020'X        23,B2
          1 001691       0020
          1 001692  0581 003E                            BBF      s:4722,PREL
          1 001694  82C4 0002                            LB,'0080'X        2,B4
          1 001696       0080
          1 001697  0581 0039                            BBF      s:4722,PREL
          1 001699  82C7 001F                            LB,'00FF'X        KV@USR_PST+3,AUTO
          1 00169B       00FF
          1 00169C  0581 0034                            BBF      s:4722,PREL

     1556     4711    4               CALL KVV$CALUSR (KV@USR_PST);

   4711   1 00169E  9BC7 001C                            LAB,B1   KV@USR_PST,AUTO
          1 0016A0  9FC7 0056                            STB,B1   KV@SND_DAT+23,AUTO
          1 0016A2  BBC7 0056                            LAB,B3   KV@SND_DAT+23,AUTO
          1 0016A4  CBF0 0100                            LAB,B4   256,IMO
          1 0016A6  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          1 0016A9       0001                            DC       s:4712,PREL

     1557     4712    4               Y@SRHLO = Y@DLTRCR;         /* Can't need to erase after OTPLCL   */

   4712   1 0016AA  E847 0014                            LDR,R6   Y@SRHHI,AUTO
          1 0016AC  EF47 0015                            STR,R6   Y@SRHLO,AUTO

     1558     4713    5               IF Y@DLTRCR<0 THEN DO;

   4713   1 0016AE  6881 0018                            BGEZ,R6  s:4719+2,PREL

     1559     4714    5                  KV@VDH_OTPLCL.BFR_.BYTX = KV@VDH_OTPLCL.BFR_.BYTX-Y@DLTRCR;

   4714   1 0016B0  E247 0034                            SUB,R6   KV@VDH_OTPLCL+3,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:276  
          1 0016B2  8256                                 NEG      R6
          1 0016B3  EF47 0034                            STR,R6   KV@VDH_OTPLCL+3,AUTO

     1560     4715    5                  IF KV@VDH_OTPLCL.BFR_.BYTSIZ+Y@DLTRCR>0

   4715   1 0016B5  D847 0035                            LDR,R5   KV@VDH_OTPLCL+4,AUTO
          1 0016B7  DA47 0014                            ADD,R5   Y@SRHHI,AUTO
          1 0016B9  5A81 0009                            BLEZ,R5  s:4718,PREL

     1561     4716    5                  THEN KV@VDH_OTPLCL.BFR_.BYTSIZ =

   4716   1 0016BB  D847 0035                            LDR,R5   KV@VDH_OTPLCL+4,AUTO
          1 0016BD  DA47 0014                            ADD,R5   Y@SRHHI,AUTO
          1 0016BF  DF47 0035                            STR,R5   KV@VDH_OTPLCL+4,AUTO
          1 0016C1  0F81 001D                            B        s:4726,PREL

     1562     4717    5                    KV@VDH_OTPLCL.BFR_.BYTSIZ+Y@DLTRCR;
     1563     4718    5                  ELSE KV@VDH_OTPLCL.BFR_.BYTSIZ = 0;

   4718   1 0016C3  8747 0035                            CL       KV@VDH_OTPLCL+4,AUTO

     1564     4719    4               END; ELSE IF KV@VDH_OTPLCL.BFR_.BYTSIZ>Y@DLTRCR

   4719   1 0016C5  0F81 0019                            B        s:4726,PREL

   4719   1 0016C7  6801 0005                            BLZ,R6   s:4720,PREL
          1 0016C9  E947 0035                            CMR,R6   KV@VDH_OTPLCL+4,AUTO
          1 0016CB  0281 0013                            BGE      s:4726,PREL

     1565     4720    4               THEN KV@VDH_OTPLCL.BFR_.BYTSIZ = Y@DLTRCR;

   4720   1 0016CD  EF47 0035                            STR,R6   KV@VDH_OTPLCL+4,AUTO

     1566     4721    4            END; ELSE DO;

   4721   1 0016CF  0F81 000F                            B        s:4726,PREL

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:277  
     1567     4722    4               %KV_SRD.CRT = KV@USR_PST.PHSPST;

   4722   1 0016D1  8CC7 001D                            LDI      KV@USR_PST+1,AUTO
          1 0016D3  8D46 0015                            SDI      21,B6

     1568     4723    4               Y@SRHLO = %KV_SRD.CRT.CLM-%KV_SRD.TOPLFT.CLM;

   4723   1 0016D5  C846 0016                            LDR,R4   22,B6
          1 0016D7  C246 000A                            SUB,R4   10,B6
          1 0016D9  CF47 0015                            STR,R4   Y@SRHLO,AUTO

     1569     4724    4               %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_SKP;

   4724   1 0016DB  AC83                                 LDB,B2   ,B3
          1 0016DC  2C01                                 LDV,R2   1
          1 0016DD  AF42 001A                            STR,R2   26,B2

     1570     4725    4            END;

     1571     4726    3            %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRT.LIN;

   4726   1 0016DF  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 0016E1  E846 0015                            LDR,R6   21,B6
          1 0016E3  EF46 0013                            STR,R6   19,B6

     1572     4727    3            %KV_SRD.FLDEND.LIN = %KV_SRD.CRT.LIN;

   4727   1 0016E5  EF46 0010                            STR,R6   16,B6

     1573     4728    3            %KV_SRD.HI_NONBLN = %KV_SRD.FLDEND;

   4728   1 0016E7  8CC6 0010                            LDI      16,B6
          1 0016E9  8D46 0017                            SDI      23,B6

     1574     4729    3            %KV_MVD.VRTCLM = 1;

   4729   1 0016EB  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:278  
          1 0016EE  CCC5 0006                            LDB,B4   6,B5
          1 0016F0  5C01                                 LDV,R5   1
          1 0016F1  DF44 001B                            STR,R5   27,B4

     1575     4730    3            %KV_SRD.VRTPSTOK = '1'B;

   4730   1 0016F3  8946 000E                            LBT,'0010'X       14,B6
   4730   1 0016F5       0010

     1576     4731    3            IF KV@VDH_OTPLCL.BFR_.BYTSIZ~=0

   4731   1 0016F6  E847 0035                            LDR,R6   KV@VDH_OTPLCL+4,AUTO
          1 0016F8  6901 000D                            BEZ,R6   s:4734,PREL

     1577     4732    3            THEN CALL KVO$OTPLCL (KV@VDH_OTPLCL);

   4732   1 0016FA  CBC7 0031                            LAB,B4   KV@VDH_OTPLCL,AUTO
          1 0016FC  CFC7 0056                            STB,B4   KV@SND_DAT+23,AUTO
          1 0016FE  BBC7 0056                            LAB,B3   KV@SND_DAT+23,AUTO
          1 001700  CBF0 0100                            LAB,B4   256,IMO
          1 001702  E380 0000 0000  xent                 LNJ,B6   KVO$OTPLCL
          1 001705       0001                            DC       s:4734,PREL

     1578     4733        /* Use EL0 if it works here */
     1579     4734    3            IF %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_BLN

   4734   1 001706  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001709  DC86                                 LDB,B5   ,B6
          1 00170A  E845 001A                            LDR,R6   26,B5
          1 00170C  6D02                                 CMV,R6   2
          1 00170D  0981 0009                            BNE      s:4736,PREL

     1580     4735    3            THEN %KV_SRD.CRT.CLM = %KV_MRD.DVCCLM;

   4735   1 00170F  CCC6 0008                            LDB,B4   8,B6
          1 001711  BCC7 000C                            LDB,B3   Y@SRD$,AUTO
          1 001713  D844 001E                            LDR,R5   30,B4
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:279  
          1 001715  DF43 0016                            STR,R5   22,B3

     1581     4736    3            IF %KV_SRD.CRT.CLM<=%KV_SRD.FLDEND.CLM AND Y@SRHLO=0

   4736   1 001717  DCC7 000C                            LDB,B5   Y@SRD$,AUTO
          1 001719  E845 0016                            LDR,R6   22,B5
          1 00171B  E945 0011                            CMR,R6   17,B5
          1 00171D  0A01 0015                            BAG      s:4745,PREL
          1 00171F  D847 0015                            LDR,R5   Y@SRHLO,AUTO
          1 001721  5981 0011                            BNEZ,R5  s:4745,PREL
          1 001723  C847 0014                            LDR,R4   Y@SRHHI,AUTO
          1 001725  4801 0007                            BLZ,R4   s:4743,PREL
          1 001727  CC86                                 LDB,B4   ,B6
          1 001728  B844 001A                            LDR,R3   26,B4
          1 00172A  3D02                                 CMV,R3   2
          1 00172B  0981 0007                            BNE      s:4745,PREL

     1582     4737        /*
     1583     4738           Erase the rest of the line if we didn't OTPLCL all the way,
     1584     4739           we didn't shift using ICH/DCH,
     1585     4740           and we're shifting left or had a bunch of blanks at the end.
     1586     4741        */
     1587     4742    3              AND (Y@DLTRCR<0 OR %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_BLN)
     1588     4743    3            THEN CALL KVO$ERSTO_ENDOF_INP;

   4743   1 00172D  CBF0 0000                            LAB,B4   0,IMO
          1 00172F  E380 0000 0000  xent                 LNJ,B6   KVO$ERSTO_ENDOF_INP
          1 001732       0001                            DC       s:4745,PREL

     1589     4744    3         END;

     1590     4745    2         KV@USR_PST.PHSPST.LIN = KV@USR_PST.PHSPST.LIN+1;

   4745   1 001733  8AC7 001D                            INC      KV@USR_PST+1,AUTO

     1591     4746    2         Y@SRHCUR = Y@SRHCUR+1;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:280  
   4746   1 001735  8AC7 0016                            INC      Y@SRHCUR,AUTO

     1592     4747    2      END;

   4747   1 001737  0F81 FF23                            B        s:4701,PREL

     1593     4748    1      %KV_SRD.CRTVRTLINPHSLIN =

   4748   1 001739  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 00173B  D846 0009                            LDR,R5   9,B6
          1 00173D  DA45 0006                            ADD,R5   6,B5
          1 00173F  D245 0004                            SUB,R5   4,B5
          1 001741  DF46 0013                            STR,R5   19,B6

     1594     4749    1        %KV_SRD.TOPLFT.LIN+%KV_RCRLST.CRTRCR-%KV_RCRLST.FRSRCR;
     1595     4750    1      %KV_SRD.FLDEND.LIN = %KV_SRD.CRTVRTLINPHSLIN;

   4750   1 001743  DF46 0010                            STR,R5   16,B6

     1596     4751    1      %KV_SRD.HI_NONBLN.LIN = %KV_SRD.CRTVRTLINPHSLIN;

   4751   1 001745  DF46 0017                            STR,R5   23,B6

     1597     4752    1      RETURN;

   4752   1 001747  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1598     4753        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:281  
     1599     4754        /*I* NAME: Y$CHKSCR
     1600     4755          Checks to make sure the desired record is within the scrolling
     1601     4756          margins, on the screen, and in the record set.  The desired record
     1602     4757          is indicated by RCRLST.CRTRCR,  the previous one in Y@REDLIN.
     1603     4758          RETURNs if all is well.
     1604     4759        */
     1605     4760
     1606     4761    1   Y$CHKSCR: PROC ALTRET;

   4761   1 00174A  EFC7 0036            Y$CHKSCR        STB,B6   KV@VDH_OTPLCL+5,AUTO

     1607     4762
     1608     4763    3      IF %KV_RCRLST.DFROPR=0 THEN DO;

   4763   1 00174C  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 00174E  E0C5 000E                            LDH,R6   14,B5
          1 001750  6981 0043                            BNEZ,R6  s:4782,PREL

     1609     4764    3         %KV_RCRLST.DFRCNT = 0;

   4764   1 001752  87C5 000D                            CLH      13,B5

     1610     4765    4         IF %KV_RCRLST.CRTRCR<0 THEN DO;

   4765   1 001754  D845 0006                            LDR,R5   6,B5
          1 001756  5881 000C                            BGEZ,R5  s:4768+2,PREL

     1611     4766    4            IF NOT %KV_RCRLST.BOF THEN %KV_RCRLST.DFRCNT = %KV_RCRLST.CRTRCR;

   4766   1 001758  82C5 000C                            LB,'0020'X        12,B5
   4766   1 00175A       0020
          1 00175B  0501 0003                            BBT      s:4767,PREL

   4766   1 00175D  D7C5 000D                            STH,R5   13,B5

     1612     4767    4            %KV_RCRLST.CRTRCR = 0;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:282  
   4767   1 00175F  8745 0006                            CL       6,B5

     1613     4768    4         END; ELSE IF %KV_RCRLST.CRTRCR>=%KV_RCRLST.RCRCNT THEN DO;

   4768   1 001761  0F81 002B                            B        s:4779,PREL

   4768   1 001763  D945 0001                            CMR,R5   1,B5
          1 001765  0801 0027                            BAL      s:4779,PREL

     1614     4769    5            IF NOT %KV_RCRLST.EOF AND %KV_RCRLST.RCRCNT>0 THEN DO;

   4769   1 001767  82C5 000C                            LB,'0040'X        12,B5
   4769   1 001769       0040
          1 00176A  0501 0012                            BBT      s:4773,PREL
          1 00176C  C845 0001                            LDR,R4   1,B5
          1 00176E  4A81 000E                            BLEZ,R4  s:4773,PREL

     1615     4770    5               %KV_RCRLST.DFRCNT = %KV_RCRLST.CRTRCR-%KV_RCRLST.RCRCNT+1;

   4770   1 001770  D254                                 SUB,R5   R4
          1 001771  5E01                                 ADV,R5   1
          1 001772  D7C5 000D                            STH,R5   13,B5

     1616     4771    5               %KV_RCRLST.CRTRCR = %KV_RCRLST.CRTRCR-%KV_RCRLST.DFRCNT;

   4771   1 001774  D0C5 000D                            LDH,R5   13,B5
          1 001776  D245 0006                            SUB,R5   6,B5
          1 001778  8255                                 NEG      R5
          1 001779  DF45 0006                            STR,R5   6,B5

     1617     4772    5            END; ELSE DO;

   4772   1 00177B  0F81 0011                            B        s:4779,PREL

     1618     4773    5               %KV_RCRLST.CRTRCR = %KV_RCRLST.RCRCNT;

   4773   1 00177D  D845 0001                            LDR,R5   1,B5
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:283  
          1 00177F  DF45 0006                            STR,R5   6,B5

     1619     4774    5               IF %KV_RCRLST.CRTRCR>0

   4774   1 001781  5A81 000B                            BLEZ,R5  s:4779,PREL

     1620     4775    5               THEN IF %KV_RCRLST.RCR$(%KV_RCRLST.CRTRCR-1)->KV$RCR.NEW

   4775   1 001783  B855                                 LDR,R3   R5
          1 001784  3E07                                 ADV,R3   7
          1 001785  ECB5                                 LDB,B6   ,B5,R3
          1 001786  82C6 0002                            LB,'0020'X        2,B6
          1 001788       0020
          1 001789  0581 0003                            BBF      s:4779,PREL

     1621     4776    5               THEN %KV_RCRLST.CRTRCR = %KV_RCRLST.CRTRCR-1;

   4776   1 00178B  88C5 0006                            DEC      6,B5

     1622     4777    5            END;

     1623     4778    4         END;

     1624     4779    3         IF %KV_RCRLST.DFRCNT~=0 THEN %KV_RCRLST.DFROPR = %KV_INPPRC_SE_DWN;

   4779   1 00178D  D0C5 000D                            LDH,R5   13,B5
          1 00178F  5901 0004                            BEZ,R5   s:4782,PREL

   4779   1 001791  4C2E                                 LDV,R4   46
          1 001792  C7C5 000E                            STH,R4   14,B5

     1625     4780    3      END;

     1626     4781
     1627     4782    2      Y@SRHLO = 0;

   4782   1 001794  8747 0015                            CL       Y@SRHLO,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:284  

     1628     4783    3      IF Y@REDLIN>%KV_RCRLST.CRTRCR THEN DO;

   4783   1 001796  E847 0012                            LDR,R6   Y@KEYCMP,AUTO
          1 001798  E945 0006                            CMR,R6   6,B5
          1 00179A  0A81 0032                            BALE     s:4796,PREL

     1629     4784        /*
     1630     4785        We're moving up the screen.  Check to see if we should scroll.
     1631     4786        */
     1632     4787    4         DO UNTIL Y@REDLIN=%KV_RCRLST.CRTRCR;

     1633     4788    4            IF Y@REDLIN=0 THEN EXIT;

   4788   1 00179C  E847 0012                            LDR,R6   Y@KEYCMP,AUTO
          1 00179E  6901 001D                            BEZ,R6   s:4793,PREL

     1634     4789    4            Y@REDLIN = Y@REDLIN-1;

   4789   1 0017A0  88C7 0012                            DEC      Y@KEYCMP,AUTO

     1635     4790    4            CALL Y$LINCNT (%KV_RCRLST.RCR$(Y@REDLIN)->KV$RCR);

   4790   1 0017A2  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 0017A4  B847 0012                            LDR,R3   Y@KEYCMP,AUTO
          1 0017A6  3E08                                 ADV,R3   8
          1 0017A7  DCB6                                 LDB,B5   ,B6,R3
          1 0017A8  DFC7 003A                            STB,B5   Y@ORGVRTCLM+1,AUTO
          1 0017AA  E3C0 01FA                            LNJ,B6   s:0,PREL
          1 0017AC       0001                            DC       s:4791,PREL

     1636     4791    4            %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRTVRTLINPHSLIN-Y@LINCNT;

   4791   1 0017AD  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 0017AF  E846 0013                            LDR,R6   19,B6
          1 0017B1  E247 001B                            SUB,R6   Y@LINCNT,AUTO
          1 0017B3  EF46 0013                            STR,R6   19,B6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:285  

     1637     4792    4         END;

   4792   1 0017B5  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 0017B7  D847 0012                            LDR,R5   Y@KEYCMP,AUTO
          1 0017B9  D945 0006                            CMR,R5   6,B5
          1 0017BB  09E1                                 BNE      s:4788,SPREL

     1638     4793    3         IF %KV_SRD.CRTVRTLINPHSLIN<%KV_SRD.TOPLFT.LIN+Y@VRTSCRMRG

   4793   1 0017BC  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 0017BE  E846 0009                            LDR,R6   9,B6
          1 0017C0  EA47 0019                            ADD,R6   Y@VRTSCRMRG,AUTO
          1 0017C2  E946 0013                            CMR,R6   19,B6
          1 0017C4  0A81 003B                            BALE     s:4809,PREL

     1639     4794    3         THEN %KV_RCRLST.SCRDN = '1'B;

   4794   1 0017C6  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 0017C8  8945 000D                            LBT,'0002'X       13,B5
          1 0017CA       0002

     1640     4795    3      END;

   4795   1 0017CB  0F81 0034                            B        s:4809,PREL

     1641     4796    3      ELSE IF Y@REDLIN<%KV_RCRLST.CRTRCR THEN DO;

   4796   1 0017CD  0881 0032                            BAGE     s:4809,PREL

     1642     4797        /*
     1643     4798        Going down the screen. Ditto.
     1644     4799        */
     1645     4800    4         DO WHILE Y@REDLIN<%KV_RCRLST.RCRCNT;

   4800   1 0017CF  E945 0001                            CMR,R6   1,B5
          1 0017D1  0881 0021                            BAGE     s:4806,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:286  

     1646     4801    4            CALL Y$LINCNT (%KV_RCRLST.RCR$(Y@REDLIN)->KV$RCR);

   4801   1 0017D3  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 0017D5  B847 0012                            LDR,R3   Y@KEYCMP,AUTO
          1 0017D7  3E08                                 ADV,R3   8
          1 0017D8  DCB6                                 LDB,B5   ,B6,R3
          1 0017D9  DFC7 003A                            STB,B5   Y@ORGVRTCLM+1,AUTO
          1 0017DB  E3C0 01C9                            LNJ,B6   s:0,PREL
          1 0017DD       0001                            DC       s:4802,PREL

     1647     4802    4            %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRTVRTLINPHSLIN+Y@LINCNT;

   4802   1 0017DE  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 0017E0  E846 0013                            LDR,R6   19,B6
          1 0017E2  EA47 001B                            ADD,R6   Y@LINCNT,AUTO
          1 0017E4  EF46 0013                            STR,R6   19,B6

     1648     4803    4            Y@REDLIN = Y@REDLIN+1;

   4803   1 0017E6  8AC7 0012                            INC      Y@KEYCMP,AUTO

     1649     4804    4            IF Y@REDLIN = %KV_RCRLST.CRTRCR THEN EXIT;

   4804   1 0017E8  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 0017EA  D847 0012                            LDR,R5   Y@KEYCMP,AUTO
          1 0017EC  D945 0006                            CMR,R5   6,B5
          1 0017EE  0901 0004                            BE       s:4806,PREL

     1650     4805    4         END;

   4805   1 0017F0  D945 0001                            CMR,R5   1,B5
          1 0017F2  0861                                 BAL      s:4801,SPREL

     1651     4806    3         IF %KV_SRD.CRTVRTLINPHSLIN>%KV_SRD.BTMRHT.LIN-Y@VRTSCRMRG

   4806   1 0017F3  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:287  
          1 0017F5  E846 000B                            LDR,R6   11,B6
          1 0017F7  E247 0019                            SUB,R6   Y@VRTSCRMRG,AUTO
          1 0017F9  E946 0013                            CMR,R6   19,B6
          1 0017FB  0881 0004                            BAGE     s:4809,PREL

     1652     4807    3         THEN %KV_RCRLST.SCRUP = '1'B;

   4807   1 0017FD  8945 000D                            LBT,'0001'X       13,B5
   4807   1 0017FF       0001

     1653     4808    3      END;

     1654     4809    3      IF %KV_RCRLST.SCRDN THEN DO WHILE '1'B;

   4809   1 001800  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 001802  82C6 000D                            LB,'0002'X        13,B6
          1 001804       0002
          1 001805  0581 003E                            BBF      s:4819,PREL

     1655     4810    3         IF %KV_SRD.CRTVRTLINPHSLIN>=%KV_SRD.TOPLFT.LIN+Y@VRTSCRSHF

   4810   1 001807  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 001809  E846 0009                            LDR,R6   9,B6
          1 00180B  EA47 001A                            ADD,R6   Y@VRTSCRSHF,AUTO
          1 00180D  E946 0013                            CMR,R6   19,B6
          1 00180F  0A81 000C                            BALE     s:4812,PREL
          1 001811  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001813  E845 0004                            LDR,R6   4,B5
          1 001815  6981 000B                            BNEZ,R6  s:4813,PREL
          1 001817  82C5 000C                            LB,'0020'X        12,B5
          1 001819       0020
          1 00181A  0581 0006                            BBF      s:4813,PREL

     1656     4811    3           OR %KV_RCRLST.FRSRCR=0 AND %KV_RCRLST.BOF
     1657     4812    3         THEN %KV_RCRLST.SCRDN = '0'B;

   4812   1 00181C  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:288  
          1 00181E  8845 000D                            LBF,'0002'X       13,B5
          1 001820       0002

     1658     4813    3         IF NOT %KV_RCRLST.SCRDN OR %KV_RCRLST.FRSRCR=0 THEN EXIT;

   4813   1 001821  82C5 000D                            LB,'0002'X        13,B5
   4813   1 001823       0002
          1 001824  0581 001F                            BBF      s:4819,PREL
          1 001826  E845 0004                            LDR,R6   4,B5
          1 001828  6901 001B                            BEZ,R6   s:4819,PREL

     1659     4814    3         %KV_RCRLST.FRSRCR = %KV_RCRLST.FRSRCR-1;

   4814   1 00182A  88C5 0004                            DEC      4,B5

     1660     4815    3         CALL Y$LINCNT (%KV_RCRLST.RCR$(%KV_RCRLST.FRSRCR)->KV$RCR);

   4815   1 00182C  B845 0004                            LDR,R3   4,B5
          1 00182E  3E08                                 ADV,R3   8
          1 00182F  CCB5                                 LDB,B4   ,B5,R3
          1 001830  CFC7 003A                            STB,B4   Y@ORGVRTCLM+1,AUTO
          1 001832  E3C0 0172                            LNJ,B6   s:0,PREL
          1 001834       0001                            DC       s:4816,PREL

     1661     4816    3         Y@SRHLO = Y@SRHLO+Y@LINCNT;

   4816   1 001835  E847 0015                            LDR,R6   Y@SRHLO,AUTO
          1 001837  EA47 001B                            ADD,R6   Y@LINCNT,AUTO
          1 001839  EF47 0015                            STR,R6   Y@SRHLO,AUTO

     1662     4817    3         %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRTVRTLINPHSLIN+Y@LINCNT;

   4817   1 00183B  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 00183D  D846 0013                            LDR,R5   19,B6
          1 00183F  DA47 001B                            ADD,R5   Y@LINCNT,AUTO
          1 001841  DF46 0013                            STR,R5   19,B6

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:289  
     1663     4818    3      END;

   4818   1 001843  0FC4                                 B        s:4810,SPREL

     1664     4819    3      IF %KV_RCRLST.SCRUP THEN DO WHILE '1'B;

   4819   1 001844  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 001846  82C6 000D                            LB,'0001'X        13,B6
          1 001848       0001
          1 001849  0581 0048                            BBF      s:4833,PREL

     1665     4820    3         IF %KV_SRD.CRTVRTLINPHSLIN<=%KV_SRD.BTMRHT.LIN-Y@VRTSCRSHF

   4820   1 00184B  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 00184D  E846 000B                            LDR,R6   11,B6
          1 00184F  E247 001A                            SUB,R6   Y@VRTSCRSHF,AUTO
          1 001851  E946 0013                            CMR,R6   19,B6
          1 001853  0881 000F                            BAGE     s:4822,PREL
          1 001855  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001857  82C5 000C                            LB,'0040'X        12,B5
          1 001859       0040
          1 00185A  0581 000D                            BBF      s:4823,PREL
          1 00185C  E845 0005                            LDR,R6   5,B5
          1 00185E  6E01                                 ADV,R6   1
          1 00185F  E945 0001                            CMR,R6   1,B5
          1 001861  0981 0006                            BNE      s:4823,PREL

     1666     4821    3           OR %KV_RCRLST.EOF AND %KV_RCRLST.LSTRCR+1=%KV_RCRLST.RCRCNT
     1667     4822    3         THEN %KV_RCRLST.SCRUP = '0'B;

   4822   1 001863  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001865  8845 000D                            LBF,'0001'X       13,B5
          1 001867       0001

     1668     4823    3         IF NOT %KV_RCRLST.SCRUP OR %KV_RCRLST.FRSRCR>=%KV_RCRLST.RCRCNT THEN EXIT;

   4823   1 001868  82C5 000D                            LB,'0001'X        13,B5
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:290  
   4823   1 00186A       0001
          1 00186B  0581 0026                            BBF      s:4833,PREL
          1 00186D  E845 0004                            LDR,R6   4,B5
          1 00186F  E945 0001                            CMR,R6   1,B5
          1 001871  0881 0020                            BAGE     s:4833,PREL

   4823   1                              Y$SCRUP         null
     1669     4824    3   Y$SCRUP:;
     1670     4825    3         CALL Y$LINCNT (%KV_RCRLST.RCR$(%KV_RCRLST.FRSRCR)->KV$RCR);

   4825   1 001873  ECC7 0006            Y$SCRUP         LDB,B6   Y@RCRLST$,AUTO
          1 001875  B846 0004                            LDR,R3   4,B6
          1 001877  3E08                                 ADV,R3   8
          1 001878  DCB6                                 LDB,B5   ,B6,R3
          1 001879  DFC7 003A                            STB,B5   Y@ORGVRTCLM+1,AUTO
          1 00187B  E3C0 0129                            LNJ,B6   s:0,PREL
          1 00187D       0001                            DC       s:4826,PREL

     1671     4826    3         Y@SRHLO = Y@SRHLO-Y@LINCNT;

   4826   1 00187E  E847 0015                            LDR,R6   Y@SRHLO,AUTO
          1 001880  E247 001B                            SUB,R6   Y@LINCNT,AUTO
          1 001882  EF47 0015                            STR,R6   Y@SRHLO,AUTO

     1672     4827    3         %KV_RCRLST.FRSRCR = %KV_RCRLST.FRSRCR+1;

   4827   1 001884  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 001886  8AC6 0004                            INC      4,B6

     1673     4828    3         %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRTVRTLINPHSLIN-Y@LINCNT;

   4828   1 001888  DCC7 000C                            LDB,B5   Y@SRD$,AUTO
          1 00188A  D845 0013                            LDR,R5   19,B5
          1 00188C  D247 001B                            SUB,R5   Y@LINCNT,AUTO
          1 00188E  DF45 0013                            STR,R5   19,B5

     1674     4829    3      END;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:291  

   4829   1 001890  0F81 FFBA                            B        s:4820,PREL

     1675     4830        /*
     1676     4831           Make sure the desired record is all displayed.
     1677     4832        */
     1678     4833    3      IF %KV_RCRLST.CRTRCR<%KV_RCRLST.RCRCNT AND %KV_RCRLST.CRTRCR>=0 THEN DO;

   4833   1 001892  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 001894  E846 0006                            LDR,R6   6,B6
          1 001896  E946 0001                            CMR,R6   1,B6
          1 001898  0881 0038                            BAGE     s:4849,PREL
          1 00189A  6801 0036                            BLZ,R6   s:4849,PREL

     1679     4834    3         Y@RCR$ = %KV_RCRLST.RCR$(%KV_RCRLST.CRTRCR);

   4834   1 00189C  B856                                 LDR,R3   R6
          1 00189D  3E08                                 ADV,R3   8
          1 00189E  DCB6                                 LDB,B5   ,B6,R3
          1 00189F  DFC7 000A                            STB,B5   Y@RCR$,AUTO

     1680     4835    3         IF %KV_RCRLST.CRTRCR>%KV_RCRLST.LSTRCR

   4835   1 0018A1  E946 0005                            CMR,R6   5,B6
          1 0018A3  0A01 0008                            BAG      s:4837,PREL
          1 0018A5  0981 0009                            BNE      s:4838,PREL
          1 0018A7  82C6 000C                            LB,'0010'X        12,B6
          1 0018A9       0010
          1 0018AA  0581 0004                            BBF      s:4838,PREL

     1681     4836    3           OR %KV_RCRLST.CRTRCR=%KV_RCRLST.LSTRCR AND %KV_RCRLST.PRTLSTRCR
     1682     4837    3         THEN %KV_RCR.UPD = '1'B;          /* Recalculate if RCR.LINCNT is wrong */

   4837   1 0018AC  8945 0002                            LBT,'0040'X       2,B5
   4837   1 0018AE       0040

     1683     4838    3         CALL Y$LINCNT (%KV_RCR);
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:292  

   4838   1 0018AF  DFC7 003A                            STB,B5   Y@ORGVRTCLM+1,AUTO
          1 0018B1  E3C0 00F3                            LNJ,B6   s:0,PREL
          1 0018B3       0001                            DC       s:4839,PREL

     1684     4839    3         Y@REDLIN = Y@LINCNT-1;

   4839   1 0018B4  E847 001B                            LDR,R6   Y@LINCNT,AUTO
          1 0018B6  6EFF                                 ADV,R6   -1
          1 0018B7  EF47 0012                            STR,R6   Y@KEYCMP,AUTO

     1685     4840    3         IF %KV_SRD.CRTVRTLINPHSLIN+Y@REDLIN<=%KV_SRD.BTMRHT.LIN

   4840   1 0018B9  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 0018BB  EA46 0013                            ADD,R6   19,B6
          1 0018BD  E946 000B                            CMR,R6   11,B6
          1 0018BF  0A81 0011                            BALE     s:4849,PREL
          1 0018C1  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 0018C3  E845 0004                            LDR,R6   4,B5
          1 0018C5  E945 0006                            CMR,R6   6,B5
          1 0018C7  0881 0009                            BAGE     s:4849,PREL

     1686     4841    3           OR %KV_RCRLST.FRSRCR>=%KV_RCRLST.CRTRCR THEN EXIT;
     1687     4842    3         %KV_RCRLST.SCRUP = '1'B;

   4842   1 0018C9  8945 000D                            LBT,'0001'X       13,B5
   4842   1 0018CB       0001

     1688     4843    3         %KV_RCRLST.SCRDN = '0'B;

   4843   1 0018CC  8845 000D                            LBF,'0002'X       13,B5
   4843   1 0018CE       0002

     1689     4844    3         GOTO Y$SCRUP;

   4844   1 0018CF  0F81 FFA3                            B        s:4823,PREL

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:293  
     1690     4845    3      END;
     1691     4846        /*
     1692     4847           Figure what the last record on the screen will be, too.
     1693     4848        */
     1694     4849    2      Y@REDLIN = %KV_SRD.CRTVRTLINPHSLIN;

   4849   1 0018D1  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 0018D3  E846 0013                            LDR,R6   19,B6
          1 0018D5  EF47 0012                            STR,R6   Y@KEYCMP,AUTO

     1695     4850    2      Y@SRHHI = %KV_RCRLST.CRTRCR;

   4850   1 0018D7  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 0018D9  D845 0006                            LDR,R5   6,B5
          1 0018DB  DF47 0014                            STR,R5   Y@SRHHI,AUTO

     1696     4851    3   FNDBTM: DO WHILE Y@REDLIN<=%KV_SRD.BTMRHT.LIN;

   4851   1 0018DD  E946 000B            FNDBTM          CMR,R6   11,B6
          1 0018DF  0A01 0068                            BAG      s:4871,PREL

     1697     4852    4         IF Y@SRHHI<%KV_RCRLST.RCRCNT THEN DO;

   4852   1 0018E1  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 0018E3  E847 0014                            LDR,R6   Y@SRHHI,AUTO
          1 0018E5  E946 0001                            CMR,R6   1,B6
          1 0018E7  0881 0011                            BAGE     s:4855+2,PREL

     1698     4853    4            CALL Y$LINCNT(%KV_RCRLST.RCR$(Y@SRHHI)->KV$RCR);

   4853   1 0018E9  B856                                 LDR,R3   R6
          1 0018EA  3E08                                 ADV,R3   8
          1 0018EB  DCB6                                 LDB,B5   ,B6,R3
          1 0018EC  DFC7 003A                            STB,B5   Y@ORGVRTCLM+1,AUTO
          1 0018EE  E3C0 00B6                            LNJ,B6   s:0,PREL
          1 0018F0       0001                            DC       s:4854,PREL

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:294  
     1699     4854    4            Y@REDLIN = Y@REDLIN+Y@LINCNT;

   4854   1 0018F1  E847 0012                            LDR,R6   Y@KEYCMP,AUTO
          1 0018F3  EA47 001B                            ADD,R6   Y@LINCNT,AUTO
          1 0018F5  EF47 0012                            STR,R6   Y@KEYCMP,AUTO

     1700     4855    3         END; ELSE IF %KV_RCRLST.EOF AND %KV_RCRLST.FRSRCR>0 AND %KV_SRD.VRTSCR

   4855   1 0018F7  0F81 0048                            B        s:4869,PREL

   4855   1 0018F9  82C6 000C                            LB,'0040'X        12,B6
   4855   1 0018FB       0040
          1 0018FC  0581 004B                            BBF      s:4871,PREL
          1 0018FE  D846 0004                            LDR,R5   4,B6
          1 001900  5A81 0047                            BLEZ,R5  s:4871,PREL
          1 001902  DCC7 000C                            LDB,B5   Y@SRD$,AUTO
          1 001904  82C5 001D                            LB,'4000'X        29,B5
          1 001906       4000
          1 001907  0581 0040                            BBF      s:4871,PREL
          1 001909  C2C5 000E                            LLH,R4   14,B5
          1 00190B  C247 001A                            SUB,R4   Y@VRTSCRSHF,AUTO
          1 00190D  4D01                                 CMV,R4   1
          1 00190E  0A81 0039                            BALE     s:4871,PREL
          1 001910  C847 0012                            LDR,R4   Y@KEYCMP,AUTO
          1 001912  C945 000B                            CMR,R4   11,B5
          1 001914  0881 0033                            BAGE     s:4871,PREL

     1701     4856    3           AND %KV_SRD.LNG-Y@VRTSCRSHF>1
     1702     4857    4           AND Y@REDLIN<%KV_SRD.BTMRHT.LIN THEN DO;

     1703     4858        /*
     1704     4859           Try to leave only the bottom line empty for the EOF record if its easy
     1705     4860        */
     1706     4861    4            CALL Y$LINCNT (%KV_RCRLST.RCR$(%KV_RCRLST.FRSRCR-1)->KV$RCR);

   4861   1 001916  B855                                 LDR,R3   R5
          1 001917  3E07                                 ADV,R3   7
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:295  
          1 001918  CCB6                                 LDB,B4   ,B6,R3
          1 001919  CFC7 003A                            STB,B4   Y@ORGVRTCLM+1,AUTO
          1 00191B  E3C0 0089                            LNJ,B6   s:0,PREL
          1 00191D       0001                            DC       s:4862,PREL

     1707     4862    4            IF %KV_SRD.BTMRHT.LIN-%KV_SRD.CRTVRTLINPHSLIN<=Y@LINCNT

   4862   1 00191E  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 001920  E846 000B                            LDR,R6   11,B6
          1 001922  E246 0013                            SUB,R6   19,B6
          1 001924  E947 001B                            CMR,R6   Y@LINCNT,AUTO
          1 001926  0A81 0021                            BALE     s:4871,PREL

     1708     4863    4            THEN EXIT FNDBTM;
     1709     4864    4            %KV_RCRLST.FRSRCR = %KV_RCRLST.FRSRCR-1;

   4864   1 001928  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 00192A  88C5 0004                            DEC      4,B5

     1710     4865    4            Y@REDLIN = Y@REDLIN+Y@LINCNT;

   4865   1 00192C  E847 0012                            LDR,R6   Y@KEYCMP,AUTO
          1 00192E  EA47 001B                            ADD,R6   Y@LINCNT,AUTO
          1 001930  EF47 0012                            STR,R6   Y@KEYCMP,AUTO

     1711     4866    4            %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRTVRTLINPHSLIN+Y@LINCNT;

   4866   1 001932  D846 0013                            LDR,R5   19,B6
          1 001934  DA47 001B                            ADD,R5   Y@LINCNT,AUTO
          1 001936  DF46 0013                            STR,R5   19,B6

     1712     4867    4            Y@SRHLO = Y@SRHLO+Y@LINCNT;

   4867   1 001938  C847 0015                            LDR,R4   Y@SRHLO,AUTO
          1 00193A  CA47 001B                            ADD,R4   Y@LINCNT,AUTO
          1 00193C  CF47 0015                            STR,R4   Y@SRHLO,AUTO

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:296  
     1713     4868    3         END; ELSE EXIT;         /* Can't fill the screen - ask for more records */

   4868   1 00193E  0F81 0001                            B        s:4869,PREL

     1714     4869    3         Y@SRHHI = Y@SRHHI+1;

   4869   1 001940  8AC7 0014                            INC      Y@SRHHI,AUTO

     1715     4870    3      END;

   4870   1 001942  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 001944  E946 000B                            CMR,R6   11,B6
          1 001946  0A81 FF9A                            BALE     s:4852,PREL

     1716     4871    2      IF Y@SRHLO~=0 THEN IF %KV_SRD.VRTSCR

   4871   1 001948  E847 0015                            LDR,R6   Y@SRHLO,AUTO
          1 00194A  6901 0016                            BEZ,R6   s:4875,PREL

   4871   1 00194C  ECC7 000C                            LDB,B6   Y@SRD$,AUTO
          1 00194E  82C6 001D                            LB,'4000'X        29,B6
          1 001950       4000
          1 001951  0581 000A                            BBF      s:4873,PREL

     1717     4872    2      THEN %KV_RCRLST.VRTSCRCNT = %KV_RCRLST.VRTSCRCNT+Y@SRHLO;

   4872   1 001953  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001955  D0C5 000A                            LDH,R5   10,B5
          1 001957  DA56                                 ADD,R5   R6
          1 001958  D7C5 000A                            STH,R5   10,B5
          1 00195A  0F81 0006                            B        s:4875,PREL

     1718     4873    2      ELSE %KV_RCRLST.LSTRCR = -1;

   4873   1 00195C  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 00195E  8945 0005                            LBT,'FFFF'X       5,B5
          1 001960       FFFF
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:297  

     1719     4874
     1720     4875    2      IF %KV_RCRLST.MAXRCR-%KV_RCRLST.RCRCNT>=%KV_RCRLST.SPRCNT

   4875   1 001961  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 001963  D846 0002                            LDR,R5   2,B6
          1 001965  D246 0001                            SUB,R5   1,B6
          1 001967  C846 000B                            LDR,R4   11,B6
          1 001969  C570 00FF                            AND,R4   255,IMO
          1 00196B  C955                                 CMR,R4   R5
          1 00196C  0A01 000B                            BAG      s:4875+23,PREL
          1 00196E  82C6 000C                            LB,'0020'X        12,B6
          1 001970       0020
          1 001971  0581 002B                            BBF      s:4882,PREL
          1 001973  82C6 000C                            LB,'0040'X        12,B6
          1 001975       0040
          1 001976  0581 0026                            BBF      s:4882,PREL
          1 001978  D0C6 000E                            LDH,R5   14,B6
          1 00197A  5D2E                                 CMV,R5   46
          1 00197B  0901 0021                            BE       s:4882,PREL
          1 00197D  82C6 000D                            LB,'0002'X        13,B6
          1 00197F       0002
          1 001980  0501 001C                            BBT      s:4882,PREL
          1 001982  B846 0006                            LDR,R3   6,B6
          1 001984  3981 0006                            BNEZ,R3  s:4875+42,PREL
          1 001986  82C6 000C                            LB,'0020'X        12,B6
          1 001988       0020
          1 001989  0581 0013                            BBF      s:4882,PREL
          1 00198B  82C6 000C                            LB,'0040'X        12,B6
          1 00198D       0040
          1 00198E  0501 0012                            BBT      s:4883,PREL
          1 001990  DCC7 000C                            LDB,B5   Y@SRD$,AUTO
          1 001992  A847 0012                            LDR,R2   Y@KEYCMP,AUTO
          1 001994  A945 000B                            CMR,R2   11,B5
          1 001996  0A81 0006                            BALE     s:4882,PREL
          1 001998  3E01                                 ADV,R3   1
          1 001999  B946 0001                            CMR,R3   1,B6
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:298  
          1 00199B  0801 0005                            BAL      s:4883,PREL

     1721     4876    2        AND (NOT %KV_RCRLST.BOF OR NOT %KV_RCRLST.EOF)
     1722     4877    2        OR %KV_RCRLST.DFROPR=%KV_INPPRC_SE_DWN
     1723     4878    2        OR %KV_RCRLST.SCRDN
     1724     4879    2        OR %KV_RCRLST.CRTRCR=0 AND NOT %KV_RCRLST.BOF
     1725     4880    2        OR NOT %KV_RCRLST.EOF AND (Y@REDLIN<=%KV_SRD.BTMRHT.LIN
     1726     4881    2        OR %KV_RCRLST.CRTRCR+1>=%KV_RCRLST.RCRCNT)
     1727     4882    2      THEN ALTRETURN;

   4882   1 00199D  ECC7 0036                            LDB,B6   KV@VDH_OTPLCL+5,AUTO
          1 00199F  B806                                 LDR,R3   ,B6
          1 0019A0  C3B6                                 LNJ,B4   ,B6,R3

     1728     4883    2      RETURN;

   4883   1 0019A1  ECC7 0036                            LDB,B6   KV@VDH_OTPLCL+5,AUTO
          1 0019A3  C3C6 0001                            LNJ,B4   1,B6

     1729     4884    2   END Y$CHKSCR;
     1730     4885        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:299  
     1731     4886        /*I* NAME: Y$LINCNT
     1732     4887          Puts the real line count for the parameter record into Y@LINCNT.
     1733     4888        */
     1734     4889
     1735     4890    1   Y$LINCNT: PROC(Y$RCR) ALTRET;

   4890   1 0019A5  EFC7 0038            Y$LINCNT        STB,B6   Y@BTMHOL,AUTO

     1736     4891
     1737     4892        %KV$RCR (NAME=Y$RCR, STCLASS=PARAM);
     1738     4922
     1739     4923    2      Y@LINCNT = Y$RCR.LINCNT;

   4923   1 0019A7  DCC7 003A                            LDB,B5   @Y$RCR,AUTO
          1 0019A9  E0C5 0002                            LDH,R6   2,B5
          1 0019AB  EF47 001B                            STR,R6   Y@LINCNT,AUTO

     1740     4924    2      IF Y$RCR.RCRBYTSIZ<0 THEN Y@LINCNT=0;

   4924   1 0019AD  D845 0001                            LDR,R5   1,B5
          1 0019AF  5881 0005                            BGEZ,R5  s:4925,PREL

   4924   1 0019B1  8747 001B                            CL       Y@LINCNT,AUTO
          1 0019B3  0F81 0026                            B        s:4927,PREL

     1741     4925    2      ELSE IF Y@LINCNT<=0 OR Y$RCR.UPD THEN IF %KV_MVD.HRZSCR THEN Y@LINCNT=1;

   4925   1 0019B5  6A81 0006                            BLEZ,R6  s:4925+7,PREL
          1 0019B7  82C5 0002                            LB,'0040'X        2,B5
          1 0019B9       0040
          1 0019BA  0581 001F                            BBF      s:4927,PREL

   4925   1 0019BC  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 0019BF  BCC4 0006                            LDB,B3   6,B4
          1 0019C1  82C3 0016                            LB,'0004'X        22,B3
          1 0019C3       0004
          1 0019C4  0581 0006                            BBF      s:4926,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:300  

   4925   1 0019C6  6C01                                 LDV,R6   1
          1 0019C7  EF47 001B                            STR,R6   Y@LINCNT,AUTO
          1 0019C9  0F81 0010                            B        s:4927,PREL

     1742     4926    2      ELSE Y@LINCNT = MAXIMUM ((Y$RCR.RCRBYTSIZ+%KV_SRD.WDT-1)/%KV_SRD.WDT,1);

   4926   1 0019CB  ACC7 000C                            LDB,B2   Y@SRD$,AUTO
          1 0019CD  DA42 000D                            ADD,R5   13,B2
          1 0019CF  5EFF                                 ADV,R5   -1
          1 0019D0  D342 000D                            DIV,R5   13,B2
          1 0019D2  D970 0001                            CMR,R5   1,IMO
          1 0019D4  0881 0002                            BAGE     s:4926+12,PREL
          1 0019D6  5C01                                 LDV,R5   1
          1 0019D7  E855                                 LDR,R6   R5
          1 0019D8  EF47 001B                            STR,R6   Y@LINCNT,AUTO

     1743     4927    2      RETURN;

   4927   1 0019DA  ECC7 0038                            LDB,B6   Y@BTMHOL,AUTO
          1 0019DC  C3C6 0001                            LNJ,B4   1,B6

     1744     4928    2   END Y$LINCNT;
     1745     4929        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:301  
     1746     4930        /*I* NAME: Y$CMPKEY
     1747     4931             Compares keys of KV$RCR for record # in Y@SRHCUR versus key at
     1748     4932             Y@KEY$. Returns Y@KEYCMP >0 if KEY$ greater, <0 is less, 0 if equal.
     1749     4933             ALTRETURNs if equal.
     1750     4934        */
     1751     4935
     1752     4936    1   Y$CMPKEY: PROC ALTRET;

   4936   1 0019DE  EFC7 0038            Y$CMPKEY        STB,B6   Y@BTMHOL,AUTO

     1753     4937
     1754     4938    3      DO CASE Y@KEYLNG;

   4938   1 0019E0  B847 0013                            LDR,R3   Y@KEYLNG,AUTO
          1 0019E2  3D05                                 CMV,R3   5
          1 0019E3  0281 0067                            BGE      s:4957,PREL
          1 0019E5  A830 0000 19EB  01                   LDR,R2   s:4938+11,R3
          1 0019E8  83A0 0000 19F0  01                   JMP      s:4940,R2
          1 0019EB       005B                            DC       s:4957,PREL
          1 0019EC       0000                            DC       s:4940,PREL
          1 0019ED       0010                            DC       s:4943,PREL
          1 0019EE       001F                            DC       s:4946,PREL
          1 0019EF       003B                            DC       s:4950,PREL

     1755     4939    3      CASE 1;

     1756     4940    3         Y@KEYCMP = Y@KEY$->KEYU1-

   4940   1 0019F0  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 0019F2  9847 0016                            LDR,R1   Y@SRHCUR,AUTO
          1 0019F4  1E08                                 ADV,R1   8
          1 0019F5  CC95                                 LDB,B4   ,B5,R1
          1 0019F6  BCC7 0008                            LDB,B3   Y@KEY$,AUTO
          1 0019F8  E283                                 LLH,R6   ,B3
          1 0019F9  D2C4 0003                            LLH,R5   3,B4
          1 0019FB  E255                                 SUB,R6   R5
          1 0019FC  EF47 0012                            STR,R6   Y@KEYCMP,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:302  
          1 0019FE  0F81 004C                            B        s:4957,PREL

     1757     4941    3           ADDR(%KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.TXT)->KEYU1;
     1758     4942    3      CASE 2;

     1759     4943    3         Y@KEYCMP = Y@KEY$->KEYU2-

   4943   1 001A00  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001A02  9847 0016                            LDR,R1   Y@SRHCUR,AUTO
          1 001A04  1E08                                 ADV,R1   8
          1 001A05  CC95                                 LDB,B4   ,B5,R1
          1 001A06  BCC7 0008                            LDB,B3   Y@KEY$,AUTO
          1 001A08  E803                                 LDR,R6   ,B3
          1 001A09  E244 0003                            SUB,R6   3,B4
          1 001A0B  EF47 0012                            STR,R6   Y@KEYCMP,AUTO
          1 001A0D  0F81 003D                            B        s:4957,PREL

     1760     4944    3           ADDR(%KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.TXT)->KEYU2;
     1761     4945    3      CASE 3;

     1762     4946    3         Y@TMP32 = ADDR(%KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.TXT)->KEYU3;

   4946   1 001A0F  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001A11  9847 0016                            LDR,R1   Y@SRHCUR,AUTO
          1 001A13  1E08                                 ADV,R1   8
          1 001A14  CC95                                 LDB,B4   ,B5,R1
          1 001A15  8CC4 0003                            LDI      3,B4
          1 001A17  70C8                                 DOR,R7   8
          1 001A18  8D47 0056                            SDI      KV@SND_DAT+23,AUTO
          1 001A1A  ABC7 0056                            LAB,B2   KV@SND_DAT+23,AUTO
          1 001A1C  2C00                                 LDV,R2   0
          1 001A1D  6C04                                 LDV,R6   4
          1 001A1E  BB87                                 LAB,B3   ,AUTO
          1 001A1F  3C2E                                 LDV,R3   46
          1 001A20  0008                                 MMM

     1763     4947    3         Y@TMP32 = Y@KEY$->KEYU3-Y@TMP32;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:303  

   4947   1 001A21  ECC7 0008                            LDB,B6   Y@KEY$,AUTO
          1 001A23  8C86                                 LDI      ,B6
          1 001A24  70C8                                 DOR,R7   8
          1 001A25  84C7 0017                            SID      Y@TMP32,AUTO
          1 001A27  8D47 0017                            SDI      Y@TMP32,AUTO

     1764     4948    3         GOTO LONGKEY;

   4948   1 001A29  0F81 000E                            B        s:4951,PREL

     1765     4949    3      CASE 4;

     1766     4950    3         Y@TMP32 = Y@KEY$->KEYU4-

   4950   1 001A2B  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001A2D  9847 0016                            LDR,R1   Y@SRHCUR,AUTO
          1 001A2F  1E08                                 ADV,R1   8
          1 001A30  CC95                                 LDB,B4   ,B5,R1
          1 001A31  BCC7 0008                            LDB,B3   Y@KEY$,AUTO
          1 001A33  8C83                                 LDI      ,B3
          1 001A34  84C4 0003                            SID      3,B4
          1 001A36  8D47 0017                            SDI      Y@TMP32,AUTO

     1767     4951    3           ADDR(%KV_RCRLST.RCR$(Y@SRHCUR)->KV$RCR.TXT)->KEYU4;

   4951   1                              LONGKEY         null
     1768     4952    3   LONGKEY:;
     1769     4953    3         IF Y@TMP32B.TOP~=0 THEN Y@KEYCMP = Y@TMP32B.TOP;

   4953   1 001A38  D847 0017            LONGKEY         LDR,R5   Y@TMP32,AUTO
          1 001A3A  5901 0005                            BEZ,R5   s:4954,PREL

   4953   1 001A3C  DF47 0012                            STR,R5   Y@KEYCMP,AUTO
          1 001A3E  0F81 000C                            B        s:4957,PREL

     1770     4954    3         ELSE IF Y@TMP32B.BTM<0 THEN Y@KEYCMP = 1;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:304  

   4954   1 001A40  C847 0018                            LDR,R4   Y@TMP32+1,AUTO
          1 001A42  4881 0006                            BGEZ,R4  s:4955,PREL

   4954   1 001A44  3C01                                 LDV,R3   1
          1 001A45  BF47 0012                            STR,R3   Y@KEYCMP,AUTO
          1 001A47  0F81 0003                            B        s:4957,PREL

     1771     4955    3         ELSE Y@KEYCMP = Y@TMP32B.BTM;

   4955   1 001A49  CF47 0012                            STR,R4   Y@KEYCMP,AUTO

     1772     4956    3      END;

     1773     4957    2      IF Y@KEYCMP~=0 THEN RETURN;

   4957   1 001A4B  E847 0012                            LDR,R6   Y@KEYCMP,AUTO
          1 001A4D  6901 0005                            BEZ,R6   s:4958,PREL

   4957   1 001A4F  ECC7 0038                            LDB,B6   Y@BTMHOL,AUTO
          1 001A51  C3C6 0001                            LNJ,B4   1,B6

     1774     4958    2      ALTRETURN;

   4958   1 001A53  ECC7 0038                            LDB,B6   Y@BTMHOL,AUTO
          1 001A55  B806                                 LDR,R3   ,B6
          1 001A56  C3B6                                 LNJ,B4   ,B6,R3

     1775     4959    2   END Y$CMPKEY;
     1776     4960        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:305  
     1777     4961        /*I* NAME: Y$DLTRCR
     1778     4962             Description: Releases the KV$RCR at Y@SRHCUR if it isn't on the
     1779     4963             screen.  Marks it for erasure and release if it is.
     1780     4964        */
     1781     4965    1   Y$DLTRCR: PROC;

   4965   1 001A57  EFC7 003A            Y$DLTRCR        STB,B6   @Y$RCR,AUTO

     1782     4966
     1783     4967    2      Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);

   4967   1 001A59  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001A5B  B847 0016                            LDR,R3   Y@SRHCUR,AUTO
          1 001A5D  3E08                                 ADV,R3   8
          1 001A5E  CCB5                                 LDB,B4   ,B5,R3
          1 001A5F  CFC7 000A                            STB,B4   Y@RCR$,AUTO

     1784     4968    2      IF %KV_RCR.RCRBYTSIZ<0 OR %KV_RCR.LINCNT~=0

   4968   1 001A61  E844 0001                            LDR,R6   1,B4
          1 001A63  6801 000F                            BLZ,R6   s:4970,PREL
          1 001A65  D0C4 0002                            LDH,R5   2,B4
          1 001A67  5901 0020                            BEZ,R5   s:4974+4,PREL
          1 001A69  C847 0016                            LDR,R4   Y@SRHCUR,AUTO
          1 001A6B  C945 0004                            CMR,R4   4,B5
          1 001A6D  0801 001A                            BAL      s:4974+4,PREL
          1 001A6F  C945 0005                            CMR,R4   5,B5
          1 001A71  0A01 0016                            BAG      s:4974+4,PREL

     1785     4969    3        AND Y@SRHCUR>=%KV_RCRLST.FRSRCR AND Y@SRHCUR<=%KV_RCRLST.LSTRCR THEN DO;

     1786     4970    3         %KV_RCRLST.DLTRCREXS = '1'B;

   4970   1 001A73  8945 000D                            LBT,'0080'X       13,B5
   4970   1 001A75       0080

     1787     4971    3         IF %KV_RCR.RCRBYTSIZ>0 THEN %KV_RCR.RCRBYTSIZ = -%KV_RCR.RCRBYTSIZ;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:306  

   4971   1 001A76  E844 0001                            LDR,R6   1,B4
          1 001A78  6A81 0006                            BLEZ,R6  s:4972,PREL

   4971   1 001A7A  8256                                 NEG      R6
          1 001A7B  EF44 0001                            STR,R6   1,B4
          1 001A7D  0F81 0004                            B        s:4973,PREL

     1788     4972    3         ELSE %KV_RCR.RCRBYTSIZ = -1;

   4972   1 001A7F  8944 0001                            LBT,'FFFF'X       1,B4
   4972   1 001A81       FFFF

     1789     4973    3         Y@BFRSIZ = 0;

   4973   1 001A82  8747 0015                            CL       Y@SRHLO,AUTO

     1790     4974    3         RETURN;

   4974   1 001A84  ECC7 003A                            LDB,B6   @Y$RCR,AUTO
          1 001A86  C3C6 0001                            LNJ,B4   1,B6
          1 001A88  0F81 0003                            B        s:4977,PREL

     1791     4975    3      END;
     1792     4976    2   Y$DLTRCRRLS: ENTRY;

   4976   1 001A8A  EFC7 003A            Y$DLTRCRRLS     STB,B6   @Y$RCR,AUTO

     1793     4977    2      %KV_RCRLST.RCRCNT = %KV_RCRLST.RCRCNT-1;

   4977   1 001A8C  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001A8E  88C5 0001                            DEC      1,B5

     1794     4978    2      IF Y@SRHCUR<%KV_RCRLST.FRSRCR THEN %KV_RCRLST.FRSRCR = %KV_RCRLST.FRSRCR-1;

   4978   1 001A90  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 001A92  E945 0004                            CMR,R6   4,B5
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:307  
          1 001A94  0881 0003                            BAGE     s:4979,PREL

   4978   1 001A96  88C5 0004                            DEC      4,B5

     1795     4979    2      IF Y@SRHCUR<=%KV_RCRLST.LSTRCR THEN %KV_RCRLST.LSTRCR = %KV_RCRLST.LSTRCR-1;

   4979   1 001A98  E945 0005                            CMR,R6   5,B5
          1 001A9A  0A01 0003                            BAG      s:4980,PREL

   4979   1 001A9C  88C5 0005                            DEC      5,B5

     1796     4980    2      IF Y@SRHCUR=%KV_RCRLST.SNDRCR THEN %KV_RCRLST.SNDRCR = -1;

   4980   1 001A9E  E945 0007                            CMR,R6   7,B5
          1 001AA0  0981 0004                            BNE      s:4981,PREL

   4980   1 001AA2  8945 0007                            LBT,'FFFF'X       7,B5
   4980   1 001AA4       FFFF

     1797     4981    2      IF Y@SRHCUR<%KV_RCRLST.SNDRCR THEN %KV_RCRLST.SNDRCR = %KV_RCRLST.SNDRCR-1;

   4981   1 001AA5  E945 0007                            CMR,R6   7,B5
          1 001AA7  0881 0003                            BAGE     s:4982,PREL

   4981   1 001AA9  88C5 0007                            DEC      7,B5

     1798     4982    2      Y@BFRSIZ = %KV_RCRLST.CRTRCR;

   4982   1 001AAB  D845 0006                            LDR,R5   6,B5
          1 001AAD  DF47 0015                            STR,R5   Y@SRHLO,AUTO

     1799     4983    2      IF %KV_RCRLST.DFROPR=%KV_INPPRC_SE_DWN

   4983   1 001AAF  C0C5 000E                            LDH,R4   14,B5
          1 001AB1  4D2E                                 CMV,R4   46
          1 001AB2  0981 0007                            BNE      s:4985,PREL

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:308  
     1800     4984    2      THEN Y@BFRSIZ = Y@BFRSIZ+%KV_RCRLST.DFRCNT;

   4984   1 001AB4  B0C5 000D                            LDH,R3   13,B5
          1 001AB6  BA55                                 ADD,R3   R5
          1 001AB7  D853                                 LDR,R5   R3
          1 001AB8  DF47 0015                            STR,R5   Y@SRHLO,AUTO

     1801     4985    2      IF Y@SRHCUR<Y@BFRSIZ THEN %KV_RCRLST.CRTRCR = %KV_RCRLST.CRTRCR-1;

   4985   1 001ABA  E955                                 CMR,R6   R5
          1 001ABB  0881 0003                            BAGE     s:4986,PREL

   4985   1 001ABD  88C5 0006                            DEC      6,B5

     1802     4986    2      Y@BFRSIZ = 4*(%KV_RCRLST.RCRCNT-Y@SRHCUR);

   4986   1 001ABF  E245 0001                            SUB,R6   1,B5
          1 001AC1  D856                                 LDR,R5   R6
          1 001AC2  5002                                 SOL,R5   2
          1 001AC3  8255                                 NEG      R5
          1 001AC4  DF47 0015                            STR,R5   Y@SRHLO,AUTO

     1803     4987    2      IF Y@BFRSIZ~=0

   4987   1 001AC6  5901 000D                            BEZ,R5   s:4990,PREL

     1804     4988    2      THEN SUBSTR(ADDR(%KV_RCRLST.RCR$(Y@SRHCUR))->CHARS,0,Y@BFRSIZ) =

   4988   1 001AC8  AB85                                 LAB,B2   ,B5
          1 001AC9  A847 0016                            LDR,R2   Y@SRHCUR,AUTO
          1 001ACB  2002                                 SOL,R2   2
          1 001ACC  2E24                                 ADV,R2   36
          1 001ACD  E855                                 LDR,R6   R5
          1 001ACE  BB82                                 LAB,B3   ,B2
          1 001ACF  B847 0016                            LDR,R3   Y@SRHCUR,AUTO
          1 001AD1  3002                                 SOL,R3   2
          1 001AD2  3E20                                 ADV,R3   32
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:309  
          1 001AD3  0008                                 MMM

     1805     4989    2        SUBSTR(ADDR(%KV_RCRLST.RCR$(Y@SRHCUR+1))->CHARS,0,Y@BFRSIZ);
     1806     4990    2      KV@VDH_GETBFR.BFR$ = ADDR(%KV_RCR);

   4990   1 001AD4  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 001AD6  EFC7 0027                            STB,B6   KV@VDH_GETBFR+1,AUTO

     1807     4991    2      KV@VDH_GETBFR.BYTSIZ = %KV_RCR.STRBYTSIZ;

   4991   1 001AD8  E806                                 LDR,R6   ,B6
          1 001AD9  EF47 0029                            STR,R6   KV@VDH_GETBFR+3,AUTO

     1808     4992    2      CALL KVS$RLSBFR (KV@VDH_GETBFR);

   4992   1 001ADB  DBC7 0026                            LAB,B5   KV@VDH_GETBFR,AUTO
          1 001ADD  DFC7 0056                            STB,B5   KV@SND_DAT+23,AUTO
          1 001ADF  BBC7 0056                            LAB,B3   KV@SND_DAT+23,AUTO
          1 001AE1  CBF0 0100                            LAB,B4   256,IMO
          1 001AE3  E380 0000 0000  xent                 LNJ,B6   KVS$RLSBFR
          1 001AE6       0001                            DC       s:4993,PREL

     1809     4993    2      RETURN;

   4993   1 001AE7  ECC7 003A                            LDB,B6   @Y$RCR,AUTO
          1 001AE9  C3C6 0001                            LNJ,B4   1,B6

     1810     4994    2   END Y$DLTRCR;
     1811     4995        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:310  
     1812     4996        /*I* NAME: Y$FNDKEY
     1813     4997             Sets Y@SRHCUR to index the KV$RCRLST.RCR$ pointing to the record
     1814     4998             equal to or immediately following that whose key is at KEY$.
     1815     4999             ALTRETURNs if EQUAL. Y@KEYCMP>0 only if Y@SRHCUR=RCRLST.RCRCNT.
     1816     5000        */
     1817     5001
     1818     5002    1   Y$FNDKEY: PROC ALTRET;

   5002   1 001AEB  EFC7 0036            Y$FNDKEY        STB,B6   KV@VDH_OTPLCL+5,AUTO

     1819     5003
     1820     5004    2      Y@SRHHI = %KV_RCRLST.RCRCNT-1;

   5004   1 001AED  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001AEF  E845 0001                            LDR,R6   1,B5
          1 001AF1  6EFF                                 ADV,R6   -1
          1 001AF2  EF47 0014                            STR,R6   Y@SRHHI,AUTO

     1821     5005    2      Y@SRHLO = 0;

   5005   1 001AF4  8747 0015                            CL       Y@SRHLO,AUTO

     1822     5006    2      Y@SRHCUR = Y@SRHHI;

   5006   1 001AF6  EF47 0016                            STR,R6   Y@SRHCUR,AUTO

     1823     5007    3      IF Y@SRHCUR>=0 THEN CALL Y$CMPKEY WHENALTRETURN DO;

   5007   1 001AF8  6801 000C                            BLZ,R6   s:5010,PREL

   5007   1 001AFA  E3C0 FEE3                            LNJ,B6   s:0,PREL
          1 001AFC       0003                            DC       s:5008,PREL
          1 001AFD  0F81 0005                            B        s:5008+4,PREL

     1824     5008    3   RETALT: ALTRETURN;

   5008   1 001AFF  ECC7 0036            RETALT          LDB,B6   KV@VDH_OTPLCL+5,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:311  
          1 001B01  B806                                 LDR,R3   ,B6
          1 001B02  C3B6                                 LNJ,B4   ,B6,R3
          1 001B03  0F81 0004                            B        s:5011,PREL

     1825     5009    3      END;
     1826     5010    2      ELSE Y@KEYCMP = 1;

   5010   1 001B05  5C01                                 LDV,R5   1
          1 001B06  DF47 0012                            STR,R5   Y@KEYCMP,AUTO

     1827     5011    3      IF Y@KEYCMP>0 THEN DO;

   5011   1 001B08  E847 0012                            LDR,R6   Y@KEYCMP,AUTO
          1 001B0A  6A81 0007                            BLEZ,R6  s:5015,PREL

     1828     5012    3         Y@SRHCUR = Y@SRHCUR+1;

   5012   1 001B0C  8AC7 0016                            INC      Y@SRHCUR,AUTO

     1829     5013    3         RETURN;

   5013   1 001B0E  ECC7 0036                            LDB,B6   KV@VDH_OTPLCL+5,AUTO
          1 001B10  C3C6 0001                            LNJ,B4   1,B6

     1830     5014    3      END;
     1831     5015    2      Y@SRHCUR = Y@SRHLO;

   5015   1 001B12  D847 0015                            LDR,R5   Y@SRHLO,AUTO
          1 001B14  DF47 0016                            STR,R5   Y@SRHCUR,AUTO

     1832     5016    2      CALL Y$CMPKEY ALTRET(RETALT);

   5016   1 001B16  E3C0 FEC7                            LNJ,B6   s:0,PREL
          1 001B18       FFE7                            DC       s:5008,PREL

     1833     5017    2      IF Y@KEYCMP<0 THEN RETURN;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:312  
   5017   1 001B19  E847 0012                            LDR,R6   Y@KEYCMP,AUTO
          1 001B1B  6881 0005                            BGEZ,R6  s:5018,PREL

   5017   1 001B1D  ECC7 0036                            LDB,B6   KV@VDH_OTPLCL+5,AUTO
          1 001B1F  C3C6 0001                            LNJ,B4   1,B6

     1834     5018    3      DO WHILE Y@SRHHI-Y@SRHLO>1;

   5018   1 001B21  0F81 001A                            B        s:5023,PREL

     1835     5019    3         Y@SRHCUR = (Y@SRHHI+Y@SRHLO)/2;

   5019   1 001B23  E847 0014                            LDR,R6   Y@SRHHI,AUTO
          1 001B25  EA47 0015                            ADD,R6   Y@SRHLO,AUTO
          1 001B27  E370 0002                            DIV,R6   2,IMO
          1 001B29  EF47 0016                            STR,R6   Y@SRHCUR,AUTO

     1836     5020    3         CALL Y$CMPKEY ALTRET(RETALT);

   5020   1 001B2B  E3C0 FEB2                            LNJ,B6   s:0,PREL
          1 001B2D       FFD2                            DC       s:5008,PREL

     1837     5021    3         IF Y@KEYCMP>0 THEN Y@SRHLO = Y@SRHCUR;

   5021   1 001B2E  E847 0012                            LDR,R6   Y@KEYCMP,AUTO
          1 001B30  6A81 0007                            BLEZ,R6  s:5022,PREL

   5021   1 001B32  D847 0016                            LDR,R5   Y@SRHCUR,AUTO
          1 001B34  DF47 0015                            STR,R5   Y@SRHLO,AUTO
          1 001B36  0F81 0005                            B        s:5023,PREL

     1838     5022    3         ELSE Y@SRHHI=Y@SRHCUR;

   5022   1 001B38  D847 0016                            LDR,R5   Y@SRHCUR,AUTO
          1 001B3A  DF47 0014                            STR,R5   Y@SRHHI,AUTO

     1839     5023    3      END;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:313  

   5023   1 001B3C  D847 0014                            LDR,R5   Y@SRHHI,AUTO
          1 001B3E  D247 0015                            SUB,R5   Y@SRHLO,AUTO
          1 001B40  5D01                                 CMV,R5   1
          1 001B41  0A62                                 BAG      s:5019,SPREL

     1840     5024    2      Y@SRHCUR = Y@SRHHI;

   5024   1 001B42  D847 0014                            LDR,R5   Y@SRHHI,AUTO
          1 001B44  DF47 0016                            STR,R5   Y@SRHCUR,AUTO

     1841     5025    2      Y@KEYCMP = -1;

   5025   1 001B46  8947 0012                            LBT,'FFFF'X       Y@KEYCMP,AUTO
   5025   1 001B48       FFFF

     1842     5026    2   END;

   5026   1 001B49  ECC7 0036                            LDB,B6   KV@VDH_OTPLCL+5,AUTO
          1 001B4B  C3C6 0001                            LNJ,B4   1,B6

     1843     5027        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:314  
     1844     5028        /*I* NAME: Y$GETRCRBFR.
     1845     5029             Allocates a KV$RCR at least Y@BFRSIZ bytes big, or reuses the one
     1846     5030             used by RCR$(Y@DLTRCR). IT is released if not used. Any shuffling
     1847     5031             of RCR$ pointers is performed, and scrolling information is computed.
     1848     5032        */
     1849     5033
     1850     5034    1   Y$GETRCRBFR: PROC ALTRET;

   5034   1 001B4D  EFC7 0038            Y$GETRCRBFR     STB,B6   Y@BTMHOL,AUTO

     1851     5035
     1852     5036    2      KV@VDH_GETBFR = Y_VDH_GETBFR;

   5036   1 001B4F  AB80 0000 0000  00                   LAB,B2   Y_VDH_OTPLCL
          1 001B52  2C0A                                 LDV,R2   10
          1 001B53  6C16                                 LDV,R6   22
          1 001B54  BB87                                 LAB,B3   ,AUTO
          1 001B55  3C4C                                 LDV,R3   76
          1 001B56  0008                                 MMM

     1853     5037    3      IF Y@DLTRCR~=-1 THEN DO;

   5037   1 001B57  E847 0014                            LDR,R6   Y@SRHHI,AUTO
          1 001B59  6DFF                                 CMV,R6   -1
          1 001B5A  0901 0035                            BE       s:5052,PREL

     1854     5038    3         Y@RCR$ = %KV_RCRLST.RCR$(Y@DLTRCR);

   5038   1 001B5C  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 001B5E  B856                                 LDR,R3   R6
          1 001B5F  3E08                                 ADV,R3   8
          1 001B60  DCB6                                 LDB,B5   ,B6,R3
          1 001B61  DFC7 000A                            STB,B5   Y@RCR$,AUTO

     1855     5039    3         KV@VDH_GETBFR.BFR$ = Y@RCR$;

   5039   1 001B63  DFC7 0027                            STB,B5   KV@VDH_GETBFR+1,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:315  

     1856     5040    3         Y@TMP32B.TOP = %KV_RCR.LINCNT;    /* Save old record size.              */

   5040   1 001B65  D0C5 0002                            LDH,R5   2,B5
          1 001B67  DF47 0017                            STR,R5   Y@TMP32,AUTO

     1857     5041    3         %KV_RCRLST.RCR$(Y@DLTRCR) = ADDR(NIL);

   5041   1 001B69  CB80 0000 0000                       LAB,B4   0
          1 001B6C  CFB6                                 STB,B4   ,B6,R3

     1858     5042    3         IF %KV_RCR.STRBYTSIZ<Y@BFRSIZ OR %KV_RCR.STRBYTSIZ>Y@BFRSIZ*2

   5042   1 001B6D  C805                                 LDR,R4   ,B5
          1 001B6E  C947 0015                            CMR,R4   Y@SRHLO,AUTO
          1 001B70  0801 000C                            BAL      s:5047,PREL
          1 001B72  A847 0015                            LDR,R2   Y@SRHLO,AUTO
          1 001B74  2001                                 SOL,R2   1
          1 001B75  A954                                 CMR,R2   R4
          1 001B76  0881 0019                            BAGE     s:5052,PREL
          1 001B78  9847 0015                            LDR,R1   Y@SRHLO,AUTO
          1 001B7A  1D20                                 CMV,R1   32
          1 001B7B  0A81 0014                            BALE     s:5052,PREL

     1859     5043    4           AND Y@BFRSIZ>32 THEN DO;

     1860     5044        /*
     1861     5045           The old one is insufficient. Just release it.
     1862     5046        */
     1863     5047    4            KV@VDH_GETBFR.BYTSIZ = %KV_RCR.STRBYTSIZ;

   5047   1 001B7D  CF47 0029                            STR,R4   KV@VDH_GETBFR+3,AUTO

     1864     5048    4            CALL KVS$RLSBFR (KV@VDH_GETBFR);

   5048   1 001B7F  CBC7 0026                            LAB,B4   KV@VDH_GETBFR,AUTO
          1 001B81  CFC7 0056                            STB,B4   KV@SND_DAT+23,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:316  
          1 001B83  BBC7 0056                            LAB,B3   KV@SND_DAT+23,AUTO
          1 001B85  CBF0 0100                            LAB,B4   256,IMO
          1 001B87  E380 0000 0000  xent                 LNJ,B6   KVS$RLSBFR
          1 001B8A       0001                            DC       s:5049,PREL

     1865     5049    4            KV@VDH_GETBFR.BFR$ = ADDR(NIL);

   5049   1 001B8B  EB80 0000 0000                       LAB,B6   0
          1 001B8E  EFC7 0027                            STB,B6   KV@VDH_GETBFR+1,AUTO

     1866     5050    4         END;

     1867     5051    3      END;

     1868     5052    3      IF KV@VDH_GETBFR.BFR$=ADDR(NIL) THEN DO;

   5052   1 001B90  8DC7 0027                            CMN      KV@VDH_GETBFR+1,AUTO
          1 001B92  0981 0038                            BNE      s:5066,PREL

     1869     5053        /*
     1870     5054           Need a buffer. Get one.
     1871     5055        */
     1872     5056    3         KV@VDH_GETBFR.BYTSIZ = Y@BFRSIZ;

   5056   1 001B94  E847 0015                            LDR,R6   Y@SRHLO,AUTO
          1 001B96  EF47 0029                            STR,R6   KV@VDH_GETBFR+3,AUTO

     1873     5057    4         CALL KVS$GETBFR (KV@VDH_GETBFR) WHENALTRETURN DO;

   5057   1 001B98  EBC7 0026                            LAB,B6   KV@VDH_GETBFR,AUTO
          1 001B9A  EFC7 0056                            STB,B6   KV@SND_DAT+23,AUTO
          1 001B9C  BBC7 0056                            LAB,B3   KV@SND_DAT+23,AUTO
          1 001B9E  CBF0 0100                            LAB,B4   256,IMO
          1 001BA0  E380 0000 0000  xent                 LNJ,B6   KVS$GETBFR
          1 001BA3       0003                            DC       s:5058,PREL
          1 001BA4  0F81 001F                            B        s:5063,PREL

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:317  
     1874     5058    4            %KV_RCRLST.NO_CTX = '1'B;

   5058   1 001BA6  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 001BA8  8946 000D                            LBT,'0008'X       13,B6
          1 001BAA       0008

     1875     5059    4            %KV_STR.ERR.COD = %E$CANTGETCTX;

   5059   1 001BAB  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 001BAD  E870 05C8                            LDR,R6   1480,IMO
          1 001BAF  EF45 0013                            STR,R6   19,B5

     1876     5060    4            IF %KV_RCRLST.SNDRCR<0 THEN %KV_RCRLST.SNDRCR=%KV_RCRLST.RCRCNT;

   5060   1 001BB1  D846 0007                            LDR,R5   7,B6
          1 001BB3  5881 0005                            BGEZ,R5  s:5061,PREL

   5060   1 001BB5  D846 0001                            LDR,R5   1,B6
          1 001BB7  DF46 0007                            STR,R5   7,B6

     1877     5061    4            IF %KV_STR.SNDMAXNMBRCR>0 THEN CALL Y$SNDRCR;

   5061   1 001BB9  C845 0019                            LDR,R4   25,B5
          1 001BBB  4A81 0004                            BLEZ,R4  s:5062,PREL

   5061   1 001BBD  E3C0 01DD                            LNJ,B6   s:0,PREL
          1 001BBF       0001                            DC       s:5062,PREL

     1878     5062    4            ALTRETURN; END;

   5062   1 001BC0  ECC7 0038                            LDB,B6   Y@BTMHOL,AUTO
          1 001BC2  B806                                 LDR,R3   ,B6
          1 001BC3  C3B6                                 LNJ,B4   ,B6,R3

     1879     5063    3         Y@RCR$ = KV@VDH_GETBFR.BFR$;

   5063   1 001BC4  ECC7 0027                            LDB,B6   KV@VDH_GETBFR+1,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:318  
          1 001BC6  EFC7 000A                            STB,B6   Y@RCR$,AUTO

     1880     5064    3         %KV_RCR.STRBYTSIZ = KV@VDH_GETBFR.BYTSIZ;

   5064   1 001BC8  E847 0029                            LDR,R6   KV@VDH_GETBFR+3,AUTO
          1 001BCA  EF06                                 STR,R6   ,B6

     1881     5065    3      END;

     1882     5066    2      ADDR(%KV_RCR.TXT)->KEYU4 = ADDR(KV@VDH_OTPLCL)->KEYU4;

   5066   1 001BCB  8CC7 0031                            LDI      KV@VDH_OTPLCL,AUTO
          1 001BCD  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 001BCF  8D46 0003                            SDI      3,B6

     1883     5067    2      %KV_RCR.UPD = '1'B;

   5067   1 001BD1  8946 0002                            LBT,'0040'X       2,B6
   5067   1 001BD3       0040

     1884     5068    2      %KV_RCR.ONE_2_1 = '1'B;

   5068   1 001BD4  8946 0002                            LBT,'0080'X       2,B6
   5068   1 001BD6       0080

     1885     5069    2      %KV_RCR.NEW = '0'B;

   5069   1 001BD7  8846 0002                            LBF,'0020'X       2,B6
   5069   1 001BD9       0020

     1886     5070    2      %KV_RCR.RCRBYTSIZ = Y@BFRSIZ-Y@KEYLNG-LENGTHV(KV$RCR);

   5070   1 001BDA  D847 0015                            LDR,R5   Y@SRHLO,AUTO
          1 001BDC  D247 0013                            SUB,R5   Y@KEYLNG,AUTO
          1 001BDE  5EFA                                 ADV,R5   -6
          1 001BDF  DF46 0001                            STR,R5   1,B6

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:319  
     1887     5071    2      IF Y@SRHCUR=Y@DLTRCR THEN %KV_RCR.LINCNT = Y@TMP32B.TOP;

   5071   1 001BE1  C847 0016                            LDR,R4   Y@SRHCUR,AUTO
          1 001BE3  C947 0014                            CMR,R4   Y@SRHHI,AUTO
          1 001BE5  0981 0007                            BNE      s:5076,PREL

   5071   1 001BE7  B847 0017                            LDR,R3   Y@TMP32,AUTO
          1 001BE9  B7C6 0002                            STH,R3   2,B6
          1 001BEB  0F81 00BA                            B        s:5127,PREL

     1888     5072    3      ELSE DO;

     1889     5073        /*
     1890     5074           This is a new record key.  Shuffle the pointers if necessary.
     1891     5075        */
     1892     5076    3         IF Y@SRHCUR<=%KV_RCRLST.FRSRCR OR Y@SRHCUR>%KV_RCRLST.LSTRCR

   5076   1 001BED  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001BEF  C945 0004                            CMR,R4   4,B5
          1 001BF1  0A81 0005                            BALE     s:5077,PREL
          1 001BF3  C945 0005                            CMR,R4   5,B5
          1 001BF5  0A81 0020                            BALE     s:5080,PREL

     1893     5077    3         THEN IF %KV_MVD.HRZSCR THEN %KV_RCR.LINCNT = 1;

   5077   1 001BF7  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 001BFA  BCC4 0006                            LDB,B3   6,B4
          1 001BFC  82C3 0016                            LB,'0004'X        22,B3
          1 001BFE       0004
          1 001BFF  0581 0006                            BBF      s:5078,PREL

   5077   1 001C01  3C01                                 LDV,R3   1
          1 001C02  B7C6 0002                            STH,R3   2,B6
          1 001C04  0F81 0013                            B        s:5081,PREL

     1894     5078    3         ELSE %KV_RCR.LINCNT = MAXIMUM

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:320  
   5078   1 001C06  ACC7 000C                            LDB,B2   Y@SRD$,AUTO
          1 001C08  DA42 000D                            ADD,R5   13,B2
          1 001C0A  5EFF                                 ADV,R5   -1
          1 001C0B  D342 000D                            DIV,R5   13,B2
          1 001C0D  D970 0001                            CMR,R5   1,IMO
          1 001C0F  0881 0002                            BAGE     s:5078+12,PREL
          1 001C11  5C01                                 LDV,R5   1
          1 001C12  D7C6 0002                            STH,R5   2,B6
          1 001C14  0F81 0003                            B        s:5081,PREL

     1895     5079    3           ((%KV_RCR.RCRBYTSIZ-1+%KV_SRD.WDT)/%KV_SRD.WDT,1);
     1896     5080    3         ELSE %KV_RCR.LINCNT = 0;

   5080   1 001C16  87C6 0002                            CLH      2,B6

     1897     5081    3         Y@BFRSIZ = %KV_RCRLST.CRTRCR;

   5081   1 001C18  D845 0006                            LDR,R5   6,B5
          1 001C1A  DF47 0015                            STR,R5   Y@SRHLO,AUTO

     1898     5082    3         IF %KV_RCRLST.DFROPR=%KV_INPPRC_SE_DWN

   5082   1 001C1C  B0C5 000E                            LDH,R3   14,B5
          1 001C1E  3D2E                                 CMV,R3   46
          1 001C1F  0981 0007                            BNE      s:5084,PREL

     1899     5083    3         THEN Y@BFRSIZ = Y@BFRSIZ+%KV_RCRLST.DFRCNT;

   5083   1 001C21  A0C5 000D                            LDH,R2   13,B5
          1 001C23  AA55                                 ADD,R2   R5
          1 001C24  D852                                 LDR,R5   R2
          1 001C25  DF47 0015                            STR,R5   Y@SRHLO,AUTO

     1900     5084    4         IF Y@DLTRCR=0 THEN DO;

   5084   1 001C27  A847 0014                            LDR,R2   Y@SRHHI,AUTO
          1 001C29  2981 003A                            BNEZ,R2  s:5103,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:321  

     1901     5085        /*
     1902     5086           Pushed first one off.
     1903     5087        */
     1904     5088    4            Y@SRHCUR = Y@SRHCUR-1;

   5088   1 001C2B  88C7 0016                            DEC      Y@SRHCUR,AUTO

     1905     5089    4            IF %KV_RCRLST.FRSRCR>0

   5089   1 001C2D  C845 0004                            LDR,R4   4,B5
          1 001C2F  4A81 0005                            BLEZ,R4  s:5091,PREL

     1906     5090    4            THEN %KV_RCRLST.FRSRCR = %KV_RCRLST.FRSRCR-1;

   5090   1 001C31  88C5 0004                            DEC      4,B5
          1 001C33  0F81 0013                            B        s:5093,PREL

     1907     5091    4            ELSE IF NOT %KV_SRD.VRTSCR THEN %KV_RCRLST.LSTRCR = -1;

   5091   1 001C35  CCC7 000C                            LDB,B4   Y@SRD$,AUTO
          1 001C37  82C4 001D                            LB,'4000'X        29,B4
          1 001C39       4000
          1 001C3A  0501 0006                            BBT      s:5092,PREL

   5091   1 001C3C  8945 0005                            LBT,'FFFF'X       5,B5
   5091   1 001C3E       FFFF
          1 001C3F  0F81 0007                            B        s:5093,PREL

     1908     5092    4            ELSE %KV_RCRLST.VRTSCRCNT = %KV_RCRLST.VRTSCRCNT-Y@TMP32B.TOP;

   5092   1 001C41  90C5 000A                            LDH,R1   10,B5
          1 001C43  9247 0017                            SUB,R1   Y@TMP32,AUTO
          1 001C45  97C5 000A                            STH,R1   10,B5

     1909     5093    4            IF %KV_RCRLST.LSTRCR>=0

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:322  
   5093   1 001C47  E845 0005                            LDR,R6   5,B5
          1 001C49  6801 0003                            BLZ,R6   s:5095,PREL

     1910     5094    4            THEN %KV_RCRLST.LSTRCR = %KV_RCRLST.LSTRCR-1;

   5094   1 001C4B  88C5 0005                            DEC      5,B5

     1911     5095    4            %KV_RCRLST.SNDRCR = %KV_RCRLST.SNDRCR-1;

   5095   1 001C4D  88C5 0007                            DEC      7,B5

     1912     5096    4            IF Y@BFRSIZ>0

   5096   1 001C4F  5A81 0003                            BLEZ,R5  s:5098,PREL

     1913     5097    4            THEN %KV_RCRLST.CRTRCR = %KV_RCRLST.CRTRCR-1;

   5097   1 001C51  88C5 0006                            DEC      6,B5

     1914     5098    4            %KV_RCRLST.BOF = '0'B;

   5098   1 001C53  8845 000C                            LBF,'0020'X       12,B5
   5098   1 001C55       0020

     1915     5099    4            Y@BFRSIZ = %KV_RCRLST.RCRCNT*4-4;

   5099   1 001C56  D845 0001                            LDR,R5   1,B5
          1 001C58  5002                                 SOL,R5   2
          1 001C59  5EFC                                 ADV,R5   -4
          1 001C5A  DF47 0015                            STR,R5   Y@SRHLO,AUTO

     1916     5100    4            SUBSTR(ADDR(%KV_RCRLST.RCR$)->CHARS,0,Y@BFRSIZ) =

   5100   1 001C5C  AB85                                 LAB,B2   ,B5
          1 001C5D  2C24                                 LDV,R2   36
          1 001C5E  E855                                 LDR,R6   R5
          1 001C5F  BB82                                 LAB,B3   ,B2
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:323  
          1 001C60  3C20                                 LDV,R3   32
          1 001C61  0008                                 MMM

     1917     5101    4              SUBSTR(ADDR(%KV_RCRLST.RCR$(1))->CHARS,0,Y@BFRSIZ);
     1918     5102    4         END;

   5102   1 001C62  0F81 0043                            B        s:5127,PREL

     1919     5103    3         ELSE IF Y@SRHCUR=%KV_RCRLST.RCRCNT

   5103   1 001C64  C945 0001                            CMR,R4   1,B5
          1 001C66  0981 0005                            BNE      s:5112,PREL

     1920     5104        /*
     1921     5105           Adding to the end of incomplete set.
     1922     5106        */
     1923     5107    3         THEN %KV_RCRLST.RCRCNT = %KV_RCRLST.RCRCNT+1;

   5107   1 001C68  8AC5 0001                            INC      1,B5
          1 001C6A  0F81 003B                            B        s:5127,PREL

     1924     5108    4         ELSE DO;

     1925     5109        /*
     1926     5110           Inserting somewhere in the middle.
     1927     5111        */
     1928     5112    4            IF Y@DLTRCR<0 THEN %KV_RCRLST.RCRCNT = %KV_RCRLST.RCRCNT+1;

   5112   1 001C6C  2881 0005                            BGEZ,R2  s:5113,PREL

   5112   1 001C6E  8AC5 0001                            INC      1,B5
          1 001C70  0F81 0004                            B        s:5114,PREL

     1929     5113    4            ELSE %KV_RCRLST.EOF = '0'B;

   5113   1 001C72  8845 000C                            LBF,'0040'X       12,B5
   5113   1 001C74       0040
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:324  

     1930     5114    4            IF Y@SRHCUR<=%KV_RCRLST.FRSRCR

   5114   1 001C75  C945 0004                            CMR,R4   4,B5
          1 001C77  0A01 0003                            BAG      s:5116,PREL

     1931     5115    4            THEN %KV_RCRLST.FRSRCR = %KV_RCRLST.FRSRCR+1;

   5115   1 001C79  8AC5 0004                            INC      4,B5

     1932     5116    4            IF Y@SRHCUR<=%KV_RCRLST.LSTRCR

   5116   1 001C7B  C945 0005                            CMR,R4   5,B5
          1 001C7D  0A01 0003                            BAG      s:5118,PREL

     1933     5117    4            THEN %KV_RCRLST.LSTRCR = %KV_RCRLST.LSTRCR+1;

   5117   1 001C7F  8AC5 0005                            INC      5,B5

     1934     5118    4            IF Y@SRHCUR<=%KV_RCRLST.SNDRCR

   5118   1 001C81  C945 0007                            CMR,R4   7,B5
          1 001C83  0A01 0003                            BAG      s:5120,PREL

     1935     5119    4            THEN %KV_RCRLST.SNDRCR = %KV_RCRLST.SNDRCR+1;

   5119   1 001C85  8AC5 0007                            INC      7,B5

     1936     5120    4            IF Y@SRHCUR<=Y@BFRSIZ OR Y@BFRSIZ<0

   5120   1 001C87  C955                                 CMR,R4   R5
          1 001C88  0A81 0003                            BALE     s:5121,PREL
          1 001C8A  5881 0003                            BGEZ,R5  s:5122,PREL

     1937     5121    4            THEN %KV_RCRLST.CRTRCR = %KV_RCRLST.CRTRCR+1;

   5121   1 001C8C  8AC5 0006                            INC      6,B5
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:325  

     1938     5122    5            DO Y@BFRSIZ = %KV_RCRLST.RCRCNT-2 DOWNTO Y@SRHCUR;

   5122   1 001C8E  D845 0001                            LDR,R5   1,B5
          1 001C90  5EFE                                 ADV,R5   -2
          1 001C91  DF47 0015                            STR,R5   Y@SRHLO,AUTO
          1 001C93  0F81 000D                            B        s:5124+2,PREL

     1939     5123    5               %KV_RCRLST.RCR$(Y@BFRSIZ+1) = %KV_RCRLST.RCR$(Y@BFRSIZ);

   5123   1 001C95  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 001C97  B847 0015                            LDR,R3   Y@SRHLO,AUTO
          1 001C99  3E08                                 ADV,R3   8
          1 001C9A  DCB6                                 LDB,B5   ,B6,R3
          1 001C9B  A847 0015                            LDR,R2   Y@SRHLO,AUTO
          1 001C9D  2E09                                 ADV,R2   9
          1 001C9E  DFA6                                 STB,B5   ,B6,R2

     1940     5124    5            END;

   5124   1 001C9F  88C7 0015                            DEC      Y@SRHLO,AUTO
          1 001CA1  E847 0015                            LDR,R6   Y@SRHLO,AUTO
          1 001CA3  E947 0016                            CMR,R6   Y@SRHCUR,AUTO
          1 001CA5  08F0                                 BAGE     s:5123,SPREL

     1941     5125    4         END;

     1942     5126    3      END;

     1943     5127    2      %KV_RCRLST.RCR$(Y@SRHCUR) = KV@VDH_GETBFR.BFR$;

   5127   1 001CA6  ECC7 0027                            LDB,B6   KV@VDH_GETBFR+1,AUTO
          1 001CA8  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001CAA  B847 0016                            LDR,R3   Y@SRHCUR,AUTO
          1 001CAC  3E08                                 ADV,R3   8
          1 001CAD  EFB5                                 STB,B6   ,B5,R3

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:326  
     1944     5128    2      RETURN;

   5128   1 001CAE  ECC7 0038                            LDB,B6   Y@BTMHOL,AUTO
          1 001CB0  C3C6 0001                            LNJ,B4   1,B6

     1945     5129    2   END Y$GETRCRBFR;
     1946     5130        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:327  
     1947     5131        /*I* NAME: Y$INCKEY.
     1948     5132             DESCRIPTION: Increments the key at Y@KEY$ by Y@KEYINC and stores
     1949     5133             the result at KV@VDH_OTPLCL.  If the incrementation wrapped, Y@KEYINC
     1950     5134             is zeroed.
     1951     5135        */
     1952     5136    1   Y$INCKEY: PROC;

   5136   1 001CB2  EFC7 0036            Y$INCKEY        STB,B6   KV@VDH_OTPLCL+5,AUTO

     1953     5137
     1954     5138    3      DO CASE Y@KEYLNG;

   5138   1 001CB4  B847 0013                            LDR,R3   Y@KEYLNG,AUTO
          1 001CB6  3D05                                 CMV,R3   5
          1 001CB7  0281 005F                            BGE      s:5154,PREL
          1 001CB9  A830 0000 1CBF  01                   LDR,R2   s:5138+11,R3
          1 001CBC  83A0 0000 1CC4  01                   JMP      s:5140,R2
          1 001CBF       0053                            DC       s:5154,PREL
          1 001CC0       0000                            DC       s:5140,PREL
          1 001CC1       0011                            DC       s:5143,PREL
          1 001CC2       001F                            DC       s:5147,PREL
          1 001CC3       0042                            DC       s:5151,PREL

     1955     5139    3      CASE 1;

     1956     5140    3         ADDR(KV@VDH_OTPLCL)->KEYU1 = Y@KEY$->KEYU1+Y@KEYINC;

   5140   1 001CC4  DCC7 0008                            LDB,B5   Y@KEY$,AUTO
          1 001CC6  E285                                 LLH,R6   ,B5
          1 001CC7  EA47 0014                            ADD,R6   Y@SRHHI,AUTO
          1 001CC9  E7C7 0031                            STH,R6   KV@VDH_OTPLCL,AUTO

     1957     5141    3         IF ADDR(KV@VDH_OTPLCL)->KEYU1<=Y@KEY$->KEYU1 THEN Y@KEYINC = 0;

   5141   1 001CCB  E2C7 0031                            LLH,R6   KV@VDH_OTPLCL,AUTO
          1 001CCD  D285                                 LLH,R5   ,B5
          1 001CCE  E955                                 CMR,R6   R5
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:328  
          1 001CCF  0A01 0047                            BAG      s:5154,PREL

   5141   1 001CD1  8747 0014                            CL       Y@SRHHI,AUTO
          1 001CD3  0F81 0043                            B        s:5154,PREL

     1958     5142    3      CASE 2;

     1959     5143    3         ADDR(KV@VDH_OTPLCL)->KEYU2 = Y@KEY$->KEYU2+Y@KEYINC;

   5143   1 001CD5  DCC7 0008                            LDB,B5   Y@KEY$,AUTO
          1 001CD7  E805                                 LDR,R6   ,B5
          1 001CD8  EA47 0014                            ADD,R6   Y@SRHHI,AUTO
          1 001CDA  EF47 0031                            STR,R6   KV@VDH_OTPLCL,AUTO

     1960     5144    3         IF ADDR(KV@VDH_OTPLCL)->KEYU2<=Y@KEY$->KEYU2 THEN Y@KEYINC = 0;

   5144   1 001CDC  E905                                 CMR,R6   ,B5
          1 001CDD  0301 0039                            BG       s:5154,PREL

   5144   1 001CDF  8747 0014                            CL       Y@SRHHI,AUTO
          1 001CE1  0F81 0035                            B        s:5154,PREL

     1961     5145    3      CASE 3;

     1962     5146        /*N* PL6 should be able to do this in one statement, but it can't */
     1963     5147    3         ADDR(KV@VDH_OTPLCL)->KEYU4 = Y@KEY$->KEYU3+Y@KEYINC;

   5147   1 001CE3  F847 0014                            LDR,R7   Y@SRHHI,AUTO
          1 001CE5  6C00                                 LDV,R6   0
          1 001CE6  8D47 0056                            SDI      KV@SND_DAT+23,AUTO
          1 001CE8  DCC7 0008                            LDB,B5   Y@KEY$,AUTO
          1 001CEA  8C85                                 LDI      ,B5
          1 001CEB  70C8                                 DOR,R7   8
          1 001CEC  8447 0056                            AID      KV@SND_DAT+23,AUTO
          1 001CEE  8D47 0031                            SDI      KV@VDH_OTPLCL,AUTO

     1964     5148    3         ADDR(KV@VDH_OTPLCL)->KEYU3 = ADDR(KV@VDH_OTPLCL)->KEYU4;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:329  

   5148   1 001CF0  7088                                 DOL,R7   8
          1 001CF1  8D47 0031                            SDI      KV@VDH_OTPLCL,AUTO

     1965     5149    3         IF ADDR(KV@VDH_OTPLCL)->KEYU3<=Y@KEY$->KEYU3 THEN Y@KEYINC = 0;

   5149   1 001CF3  8C85                                 LDI      ,B5
          1 001CF4  70C8                                 DOR,R7   8
          1 001CF5  8D47 0056                            SDI      KV@SND_DAT+23,AUTO
          1 001CF7  8CC7 0031                            LDI      KV@VDH_OTPLCL,AUTO
          1 001CF9  70C8                                 DOR,R7   8
          1 001CFA  84C7 0056                            SID      KV@SND_DAT+23,AUTO
          1 001CFC  6A01 001A                            BGZ,R6   s:5154,PREL
          1 001CFE  6801 0003                            BLZ,R6   s:5149+15,PREL
          1 001D00  7981 0016                            BNEZ,R7  s:5154,PREL

   5149   1 001D02  8747 0014                            CL       Y@SRHHI,AUTO
          1 001D04  0F81 0012                            B        s:5154,PREL

     1966     5150    3      CASE 4;

     1967     5151    3         ADDR(KV@VDH_OTPLCL)->KEYU4 = Y@KEY$->KEYU4+Y@KEYINC;

   5151   1 001D06  DCC7 0008                            LDB,B5   Y@KEY$,AUTO
          1 001D08  F847 0014                            LDR,R7   Y@SRHHI,AUTO
          1 001D0A  6C00                                 LDV,R6   0
          1 001D0B  8405                                 AID      ,B5
          1 001D0C  8D47 0031                            SDI      KV@VDH_OTPLCL,AUTO

     1968     5152    3         IF ADDR(KV@VDH_OTPLCL)->KEYU4<=Y@KEY$->KEYU4 THEN Y@KEYINC = 0;

   5152   1 001D0E  8485                                 SID      ,B5
          1 001D0F  6981 0003                            BNEZ,R6  s:5152+5,PREL
          1 001D11  7901 0003                            BEZ,R7   s:5152+7,PREL
          1 001D13  0601 0003                            BCT      s:5154,PREL

   5152   1 001D15  8747 0014                            CL       Y@SRHHI,AUTO
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:330  

     1969     5153    3      END;

     1970     5154    2      RETURN;

   5154   1 001D17  ECC7 0036                            LDB,B6   KV@VDH_OTPLCL+5,AUTO
          1 001D19  C3C6 0001                            LNJ,B4   1,B6

     1971     5155    2   END Y$INCKEY;
     1972     5156        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:331  
     1973     5157        /*I* NAME: Y$SNDNEED.
     1974     5158             Altreturns a RQSDAT with E$RECORDS_NEEDED and proper values for
     1975     5159             KEY and count.
     1976     5160        */
     1977     5161    1   Y$SNDNEED: PROC;

   5161   1 001D1B  EFC7 003A            Y$SNDNEED       STB,B6   @Y$RCR,AUTO

     1978     5162
     1979     5163        %KV$VDOVLP_ERR (NAME=Y_ERR, STCLASS=CONSTANT, FCG=KV, MID=E, MON='1'B);
     1980     5260        %KV$VDOVLP_ERR (NAME=Y@ERR, STCLASS=AUTO);
     1981     5357        %KV$SND_DAT (NAME=KV_SND_DAT, STCLASS=SYMREF);
     1982     5476        %KV$SND_DAT (NAME=KV@SND_DAT, STCLASS=AUTO);
     1983     5595        %KV$VDOVLP_KEY (NAME=Y_KEY, STCLASS=CONSTANT);
     1984     5645
     1985     5646    2      KV@SND_DAT = KV_SND_DAT;

   5646   1 001D1D  AB80 0000 0000  xsym                 LAB,B2   KV_SND_DAT
          1 001D20  2C00                                 LDV,R2   0
          1 001D21  6C2E                                 LDV,R6   46
          1 001D22  BB87                                 LAB,B3   ,AUTO
          1 001D23  3C7E                                 LDV,R3   126
          1 001D24  0008                                 MMM

     1986     5647    2      %KV_STR.ERR.COD = %E$RECORDS_NEEDED;

   5647   1 001D25  ECC7 0010                            LDB,B6   Y@STR$,AUTO
          1 001D27  E870 05A5                            LDR,R6   1445,IMO
          1 001D29  EF46 0013                            STR,R6   19,B6

     1987     5648    2      KV@SND_DAT.DATCTRCHRTYP = %KV_DATCTRCHRTYP_CNT;

   5648   1 001D2B  8947 003F                            LBT,'000C'X       KV@SND_DAT,AUTO
   5648   1 001D2D       000C

     1988     5649    2      %KV_RCRLST.RCRNEDSNT = '1'B;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:332  
   5649   1 001D2E  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001D30  8945 000C                            LBT,'0080'X       12,B5
          1 001D32       0080

     1989     5650    2      IF %KV_RCRLST.MAXRCR>%KV_RCRLST.RCRCNT

   5650   1 001D33  D845 0002                            LDR,R5   2,B5
          1 001D35  D945 0001                            CMR,R5   1,B5
          1 001D37  0A81 0007                            BALE     s:5652,PREL

     1990     5651    2      THEN %KV_RCRLST.DATCTRCHR = %KV_RCRLST.MAXRCR-%KV_RCRLST.RCRCNT;

   5651   1 001D39  D245 0001                            SUB,R5   1,B5
          1 001D3B  D7C5 000C                            STH,R5   12,B5
          1 001D3D  0F81 0013                            B        s:5654,PREL

     1991     5652    2      ELSE %KV_RCRLST.DATCTRCHR = MINIMUM (%KV_RCRLST.MAXRCR/4,

   5652   1 001D3F  CCC7 000C                            LDB,B4   Y@SRD$,AUTO
          1 001D41  C2C4 000E                            LLH,R4   14,B4
          1 001D43  C255                                 SUB,R4   R5
          1 001D44  D370 0004                            DIV,R5   4,IMO
          1 001D46  CF47 0056                            STR,R4   KV@SND_DAT+23,AUTO
          1 001D48  8654                                 CPL      R4
          1 001D49  C955                                 CMR,R4   R5
          1 001D4A  0881 0004                            BAGE     s:5652+16,PREL
          1 001D4C  D847 0056                            LDR,R5   KV@SND_DAT+23,AUTO
          1 001D4E  8655                                 CPL      R5
          1 001D4F  D7C5 000C                            STH,R5   12,B5

     1992     5653    2        %KV_RCRLST.MAXRCR-%KV_SRD.LNG-1);
     1993     5654    3      IF %KV_RCRLST.RCRCNT~=0 THEN DO;

   5654   1 001D51  D845 0001                            LDR,R5   1,B5
          1 001D53  5901 003B                            BEZ,R5   s:5669,PREL

     1994     5655        /*
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:333  
     1995     5656           Figgerout which way to go.
     1996     5657        */
     1997     5658    3         IF MAXIMUM(%KV_RCRLST.CRTRCR,%KV_RCRLST.FRSRCR)+%KV_RCRLST.CRTRCR>=

   5658   1 001D55  C845 0004                            LDR,R4   4,B5
          1 001D57  C945 0006                            CMR,R4   6,B5
          1 001D59  0881 0003                            BAGE     s:5658+8,PREL
          1 001D5B  C845 0006                            LDR,R4   6,B5
          1 001D5D  CA45 0006                            ADD,R4   6,B5
          1 001D5F  C955                                 CMR,R4   R5
          1 001D60  0801 0006                            BAL      s:5658+18,PREL
          1 001D62  82C5 000C                            LB,'0040'X        12,B5
          1 001D64       0040
          1 001D65  0581 0006                            BBF      s:5660,PREL
          1 001D67  82C5 000C                            LB,'0020'X        12,B5
          1 001D69       0020
          1 001D6A  0581 0015                            BBF      s:5664,PREL

     1998     5659    4           %KV_RCRLST.RCRCNT AND NOT %KV_RCRLST.EOF OR %KV_RCRLST.BOF THEN DO;

     1999     5660    4            Y@RCR$ = %KV_RCRLST.RCR$(%KV_RCRLST.RCRCNT-1);

   5660   1 001D6C  B855                                 LDR,R3   R5
          1 001D6D  3E07                                 ADV,R3   7
          1 001D6E  CCB5                                 LDB,B4   ,B5,R3
          1 001D6F  CFC7 000A                            STB,B4   Y@RCR$,AUTO

     2000     5661    4            IF %KV_RCR.NEW THEN IF %KV_RCRLST.RCRCNT=1 THEN GOTO SUBCOMMON;

   5661   1 001D71  82C4 0002                            LB,'0020'X        2,B4
   5661   1 001D73       0020
          1 001D74  0581 0014                            BBF      s:5667,PREL

   5661   1 001D76  5D01                                 CMV,R5   1
          1 001D77  0901 0086                            BE       s:5700,PREL

     2001     5662    4            ELSE Y@RCR$ = %KV_RCRLST.RCR$(%KV_RCRLST.RCRCNT-2);
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:334  

   5662   1 001D79  B855                                 LDR,R3   R5
          1 001D7A  3E06                                 ADV,R3   6
          1 001D7B  ACB5                                 LDB,B2   ,B5,R3
          1 001D7C  AFC7 000A                            STB,B2   Y@RCR$,AUTO

     2002     5663    4         END; ELSE DO;

   5663   1 001D7E  0F81 000A                            B        s:5667,PREL

     2003     5664    4            %KV_RCRLST.DATCTRCHR = -%KV_RCRLST.DATCTRCHR;

   5664   1 001D80  C0C5 000C                            LDH,R4   12,B5
          1 001D82  8254                                 NEG      R4
          1 001D83  C7C5 000C                            STH,R4   12,B5

     2004     5665    4            Y@RCR$ = %KV_RCRLST.RCR$(0);

   5665   1 001D85  CCC5 0010                            LDB,B4   16,B5
          1 001D87  CFC7 000A                            STB,B4   Y@RCR$,AUTO

     2005     5666    4         END;

     2006     5667    3         KV@SND_DAT.VDOVLP.KEY$ = ADDR(KV@VDH_OTPLCL); /* HANDY BUFFER SPACE     */

   5667   1 001D89  CBC7 0031                            LAB,B4   KV@VDH_OTPLCL,AUTO
          1 001D8B  CFC7 004A                            STB,B4   KV@SND_DAT+11,AUTO

     2007     5668    3      END;

   5668   1 001D8D  0F81 000B                            B        s:5670,PREL

     2008     5669    2      ELSE IF %KV_RCRLST.EOF THEN %KV_RCRLST.DATCTRCHR = -%KV_RCRLST.DATCTRCHR;

   5669   1 001D8F  82C5 000C                            LB,'0040'X        12,B5
   5669   1 001D91       0040
          1 001D92  0581 0006                            BBF      s:5670,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:335  

   5669   1 001D94  C0C5 000C                            LDH,R4   12,B5
          1 001D96  8254                                 NEG      R4
          1 001D97  C7C5 000C                            STH,R4   12,B5

     2009     5670    2      GOTO SUBCOMMON;

   5670   1 001D99  0F81 0064                            B        s:5700,PREL

     2010     5671
     2011     5672    2   Y$SNDRCR: ENTRY;

   5672   1 001D9B  EFC7 003A            Y$SNDRCR        STB,B6   @Y$RCR,AUTO

     2012     5673
     2013     5674    2      KV@SND_DAT = KV_SND_DAT;

   5674   1 001D9D  AB80 0000 0000  xsym                 LAB,B2   KV_SND_DAT
          1 001DA0  2C00                                 LDV,R2   0
          1 001DA1  6C2E                                 LDV,R6   46
          1 001DA2  BB87                                 LAB,B3   ,AUTO
          1 001DA3  3C7E                                 LDV,R3   126
          1 001DA4  0008                                 MMM

     2014     5675    3      IF %KV_RCRLST.SNDRCR<0 OR %KV_RCRLST.SNDRCR>=%KV_RCRLST.RCRCNT THEN DO;

   5675   1 001DA5  ECC7 0006                            LDB,B6   Y@RCRLST$,AUTO
          1 001DA7  E846 0007                            LDR,R6   7,B6
          1 001DA9  6801 0005                            BLZ,R6   s:5682,PREL
          1 001DAB  E946 0001                            CMR,R6   1,B6
          1 001DAD  0801 000F                            BAL      s:5686,PREL

     2015     5676        /*E* ERROR: KVE-E$FREC-E
     2016     5677             MESSAGE:Protocol error - record may be lost.
     2017     5678             MESSAGE1:Record insertions have lost an updated record
     2018     5679                      by pushing it out of the VDH cache.  The program should
     2019     5680                      only do insertions after an activation character.
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:336  
     2020     5681        */
     2021     5682    3         IF %KV_STR.ERR.COD=0 THEN %KV_STR.ERR.COD = %E$FREC;

   5682   1 001DAF  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 001DB1  D845 0013                            LDR,R5   19,B5
          1 001DB3  5981 0004                            BNEZ,R5  s:5683,PREL

   5682   1 001DB5  5C26                                 LDV,R5   38
          1 001DB6  DF45 0013                            STR,R5   19,B5

     2022     5683    3         %KV_RCRLST.SNDRCR = -1;

   5683   1 001DB8  8946 0007                            LBT,'FFFF'X       7,B6
   5683   1 001DBA       FFFF

     2023     5684    3         GOTO SUBCOMMON;

   5684   1 001DBB  0F81 0042                            B        s:5700,PREL

     2024     5685    3      END;
     2025     5686    2      Y@RCR$ = %KV_RCRLST.RCR$(%KV_RCRLST.SNDRCR);

   5686   1 001DBD  B856                                 LDR,R3   R6
          1 001DBE  3E08                                 ADV,R3   8
          1 001DBF  DCB6                                 LDB,B5   ,B6,R3
          1 001DC0  DFC7 000A                            STB,B5   Y@RCR$,AUTO

     2026     5687    2      %KV_RCRLST.SNDRCR = -1;

   5687   1 001DC2  8946 0007                            LBT,'FFFF'X       7,B6
   5687   1 001DC4       FFFF

     2027     5688    3      IF %KV_RCR.RCRBYTSIZ>=0 THEN DO;

   5688   1 001DC5  D845 0001                            LDR,R5   1,B5
          1 001DC7  5801 002C                            BLZ,R5   s:5699,PREL

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:337  
     2028     5689    3         KV@SND_DAT.DAT__.DATBYTSIZ = %KV_RCR.RCRBYTSIZ;

   5689   1 001DC9  DF47 0051                            STR,R5   KV@SND_DAT+18,AUTO

     2029     5690    3         KV@SND_DAT.DAT__.ADR$ = Y@RCR$;

   5690   1 001DCB  DFC7 004E                            STB,B5   KV@SND_DAT+15,AUTO

     2030     5691    3         KV@SND_DAT.DAT__.BYTX = LENGTHV(KV$RCR)+%KV_RCRLST.KEYLNG;

   5691   1 001DCD  C2C6 000B                            LLH,R4   11,B6
          1 001DCF  4E06                                 ADV,R4   6
          1 001DD0  CF47 0050                            STR,R4   KV@SND_DAT+17,AUTO

     2031     5692    4         IF %KV_RCRLST.ACTCHR THEN DO;

   5692   1 001DD2  82C6 000C                            LB,'0008'X        12,B6
   5692   1 001DD4       0008
          1 001DD5  0581 0010                            BBF      s:5696,PREL

     2032     5693    4            KV@SND_DAT.DATCTRCHRTYP = %KV_DATCTRCHRTYP_ACT;

   5693   1 001DD7  3C04                                 LDV,R3   4
          1 001DD8  BAC7 003F                            SRM,R3,'000C'X    KV@SND_DAT,AUTO
          1 001DDA       000C

     2033     5694    4            IF %KV_RCRLST.SAMDAT THEN KV@SND_DAT.DATMOD = %KV#DATMOD_TRN;

   5694   1 001DDB  82C6 000D                            LB,'0004'X        13,B6
   5694   1 001DDD       0004
          1 001DDE  0581 000D                            BBF      s:5697,PREL

   5694   1 001DE0  2C01                                 LDV,R2   1
          1 001DE1  AAC7 003F                            SRM,R2,'0003'X    KV@SND_DAT,AUTO
          1 001DE3       0003

     2034     5695    4         END;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:338  

   5695   1 001DE4  0F81 0007                            B        s:5697,PREL

     2035     5696    3         ELSE IF %KV_STR.ERR.COD=0 THEN EXIT;

   5696   1 001DE6  CCC7 0010                            LDB,B4   Y@STR$,AUTO
          1 001DE8  B844 0013                            LDR,R3   19,B4
          1 001DEA  3901 0007                            BEZ,R3   s:5698,PREL

     2036     5697    3         KV@SND_DAT.ACTPOS = %KV_STR.RE_REDCLM;

   5697   1 001DEC  CCC7 0010                            LDB,B4   Y@STR$,AUTO
          1 001DEE  B844 0012                            LDR,R3   18,B4
          1 001DF0  BF47 0055                            STR,R3   KV@SND_DAT+22,AUTO

     2037     5698    3      END;

   5698   1 001DF2  0F81 0007                            B        s:5700,PREL

     2038     5699    2      ELSE %KV_STR.ERR.COD = %E$RECORD_DELETED;

   5699   1 001DF4  CCC7 0010                            LDB,B4   Y@STR$,AUTO
          1 001DF6  C870 05A6                            LDR,R4   1446,IMO
          1 001DF8  CF44 0013                            STR,R4   19,B4

     2039     5700    2      KV@SND_DAT.VDOVLP.KEY$ = ADDR(KV@VDH_OTPLCL);

   5700   1 001DFA  ABC7 0031                            LAB,B2   KV@VDH_OTPLCL,AUTO
          1 001DFC  AFC7 004A                            STB,B2   KV@SND_DAT+11,AUTO

   5700   1                              SUBCOMMON       null
     2040     5701    2   SUBCOMMON:;
     2041     5702    3      IF %KV_STR.ERR.COD~=0 THEN DO;

   5702   1 001DFE  ECC7 0010            SUBCOMMON       LDB,B6   Y@STR$,AUTO
          1 001E00  E846 0013                            LDR,R6   19,B6
          1 001E02  6901 0017                            BEZ,R6   s:5708,PREL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:339  

     2042     5703    3         KV@SND_DAT.VDOVLP.ERR$ = ADDR(Y@ERR);

   5703   1 001E04  DBC7 003C                            LAB,B5   Y@ERR,AUTO
          1 001E06  DFC7 0046                            STB,B5   KV@SND_DAT+7,AUTO

     2043     5704    3         Y@ERR = Y_ERR;

   5704   1 001E08  AB80 0000 0000  00                   LAB,B2   Y_VDH_OTPLCL
          1 001E0B  2C28                                 LDV,R2   40
          1 001E0C  6C06                                 LDV,R6   6
          1 001E0D  BB87                                 LAB,B3   ,AUTO
          1 001E0E  3C78                                 LDV,R3   120
          1 001E0F  0008                                 MMM

     2044     5705    3         Y@ERR.ERRCODE.ERR# = %KV_STR.ERR.COD;

   5705   1 001E10  ECC7 0010                            LDB,B6   Y@STR$,AUTO
          1 001E12  E846 0013                            LDR,R6   19,B6
          1 001E14  6003                                 SOL,R6   3
          1 001E15  EAC7 003E                            SRM,R6,'FFF8'X    Y@ERR+2,AUTO
          1 001E17       FFF8

     2045     5706    3         %KV_STR.ERR.COD = 0;

   5706   1 001E18  8746 0013                            CL       19,B6

     2046     5707    3      END;

     2047     5708    2      KV@SND_DAT.DATCTRCHR = BINASC(%KV_RCRLST.DATCTRCHR);

   5708   1 001E1A  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001E1C  E0C5 000C                            LDH,R6   12,B5
          1 001E1E  E7C7 0054                            STH,R6   KV@SND_DAT+21,AUTO

     2048     5709    3      IF KV@SND_DAT.VDOVLP.KEY$~=ADDR(NIL) THEN DO;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:340  
   5709   1 001E20  8DC7 004A                            CMN      KV@SND_DAT+11,AUTO
          1 001E22  0901 0011                            BE       s:5715,PREL

     2049     5710    3         ADDR(KV@VDH_OTPLCL)->KV$VDOVLP = Y_KEY;

   5710   1 001E24  D800 0000 0017  00                   LDR,R5   Y_KEY
          1 001E27  DF47 0031                            STR,R5   KV@VDH_OTPLCL,AUTO

     2050     5711    3         ADDR(KV@VDH_OTPLCL)->KV$VDOVLP.BYTSIZ = %KV_RCRLST.KEYLNG;

   5711   1 001E29  C2C5 000B                            LLH,R4   11,B5
          1 001E2B  CAC7 0031                            SRM,R4,'00FF'X    KV@VDH_OTPLCL,AUTO
          1 001E2D       00FF

     2051     5712    3         PINCRW(ADDR(KV@VDH_OTPLCL),SIZEW(KV$VDOVLP))->KEYU4 =

   5712   1 001E2E  CCC7 000A                            LDB,B4   Y@RCR$,AUTO
          1 001E30  8CC4 0003                            LDI      3,B4
          1 001E32  8D47 0032                            SDI      KV@VDH_OTPLCL+1,AUTO

     2052     5713    3           ADDR(%KV_RCR.TXT)->KEYU4;
     2053     5714    3      END;

     2054     5715    2      CALL KVM$SND (KV@SND_DAT);

   5715   1 001E34  CBC7 003F                            LAB,B4   KV@SND_DAT,AUTO
          1 001E36  CFC7 0056                            STB,B4   KV@SND_DAT+23,AUTO
          1 001E38  BBC7 0056                            LAB,B3   KV@SND_DAT+23,AUTO
          1 001E3A  CBF0 0100                            LAB,B4   256,IMO
          1 001E3C  E380 0000 0000  xent                 LNJ,B6   KVM$SND
          1 001E3F       0001                            DC       s:5716,PREL

     2055     5716    2      RETURN;

   5716   1 001E40  ECC7 003A                            LDB,B6   @Y$RCR,AUTO
          1 001E42  C3C6 0001                            LNJ,B4   1,B6

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:341  
     2056     5717    2   END Y$SNDNEED;
     2057     5718        %EJECT;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:342  
     2058     5719        /*I* NAME: Y$UPDRCR.
     2059     5720             DESCRIPTION: Compares SSN.REDBFR__ with RCR at Y@SRHCUR, and updates
     2060     5721             RCR is different, sending the record if possible, else saving tha
     2061     5722             need in RCRLST.SNDRCR.
     2062     5723        */
     2063     5724    1   Y$UPDRCR: PROC ALTRET;

   5724   1 001E44  EFC7 0036            Y$UPDRCR        STB,B6   KV@VDH_OTPLCL+5,AUTO

     2064     5725
     2065     5726    2      Y@RCR$ = %KV_RCRLST.RCR$(Y@SRHCUR);

   5726   1 001E46  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001E48  B847 0016                            LDR,R3   Y@SRHCUR,AUTO
          1 001E4A  3E08                                 ADV,R3   8
          1 001E4B  CCB5                                 LDB,B4   ,B5,R3
          1 001E4C  CFC7 000A                            STB,B4   Y@RCR$,AUTO

     2066     5727    2      Y@BFRSIZ = %KV_SSN.REDBFR.NXTX;

   5727   1 001E4E  BCC7 000E                            LDB,B3   Y@SSN$,AUTO
          1 001E50  E843 002A                            LDR,R6   42,B3
          1 001E52  EF47 0015                            STR,R6   Y@SRHLO,AUTO

     2067     5728    2      IF (%KV_RCR.RCRBYTSIZ=Y@BFRSIZ OR NOT %KV_SSN.BP AND

   5728   1 001E54  E944 0001                            CMR,R6   1,B4
          1 001E56  0901 0008                            BE       s:5728+11,PREL
          1 001E58  82C3 0037                            LB,'0010'X        55,B3
          1 001E5A       0010
          1 001E5B  0501 0021                            BBT      s:5734,PREL
          1 001E5D  0A81 001F                            BALE     s:5734,PREL
          1 001E5F  82C4 0002                            LB,'0020'X        2,B4
          1 001E61       0020
          1 001E62  0501 001A                            BBT      s:5734,PREL

     2068     5729    3        %KV_RCR.RCRBYTSIZ<Y@BFRSIZ) AND NOT %KV_RCR.NEW THEN DO;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:343  

     2069     5730    3         IF SUBSTR(%KV_RCR.TXT,Y@KEYLNG,%KV_RCR.RCRBYTSIZ)=

   5730   1 001E64  D844 0001                            LDR,R5   1,B4
          1 001E66  ACC3 0030                            LDB,B2   48,B3
          1 001E68  DF47 0056                            STR,R5   KV@SND_DAT+23,AUTO
          1 001E6A  AFC7 0057                            STB,B2   KV@SND_DAT+24,AUTO
          1 001E6C  AB84                                 LAB,B2   ,B4
          1 001E6D  A847 0013                            LDR,R2   Y@KEYLNG,AUTO
          1 001E6F  2E06                                 ADV,R2   6
          1 001E70  E855                                 LDR,R6   R5
          1 001E71  BCC7 0057                            LDB,B3   KV@SND_DAT+24,AUTO
          1 001E73  3C00                                 LDV,R3   0
          1 001E74  F847 0015                            LDR,R7   Y@SRHLO,AUTO
          1 001E76  D380 0000 0000  xent                 LNJ,B5   X6C_ACM
          1 001E79  5381 0020                            CBE      s:5738,PREL

     2070     5731    3           SUBSTR(%KV_SSN.REDBFR__.ADR$->CHARS,0,Y@BFRSIZ)
     2071     5732    3         THEN GOTO Y@CHK_ACTCHR;
     2072     5733    3      END;

   5733   1 001E7B  0F81 002A                            B        s:5742+2,PREL

     2073     5734    2      ELSE IF Y@BFRSIZ=0 AND %KV_RCR.NEW AND %KV_RCRLST.EOF

   5734   1 001E7D  6981 0028                            BNEZ,R6  s:5742+2,PREL
          1 001E7F  82C4 0002                            LB,'0020'X        2,B4
          1 001E81       0020
          1 001E82  0581 0023                            BBF      s:5742+2,PREL
          1 001E84  82C5 000C                            LB,'0040'X        12,B5
          1 001E86       0040
          1 001E87  0581 001E                            BBF      s:5742+2,PREL
          1 001E89  D847 0016                            LDR,R5   Y@SRHCUR,AUTO
          1 001E8B  5E01                                 ADV,R5   1
          1 001E8C  D945 0001                            CMR,R5   1,B5
          1 001E8E  0981 0017                            BNE      s:5742+2,PREL

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:344  
     2074     5735    3        AND Y@SRHCUR+1=%KV_RCRLST.RCRCNT THEN DO;

     2075     5736    3         %KV_RCR.RCRBYTSIZ = 0;

   5736   1 001E90  8744 0001                            CL       1,B4

     2076     5737    3         %KV_RCR.LINCNT = -%KV_RCR.LINCNT;

   5737   1 001E92  C0C4 0002                            LDH,R4   2,B4
          1 001E94  8254                                 NEG      R4
          1 001E95  C7C4 0002                            STH,R4   2,B4

     2077     5738    3         %KV_RCR.UPD = '1'B;

   5738   1 001E97  8944 0002                            LBT,'0040'X       2,B4
   5738   1 001E99       0040

   5738   1                              Y@CHK_ACTCHR    null
     2078     5739    3   Y@CHK_ACTCHR:;
     2079     5740    3         IF NOT %KV_RCRLST.ACTCHR THEN GOTO Y@UN_SCR;

   5740   1 001E9A  ECC7 0006            Y@CHK_ACTCHR    LDB,B6   Y@RCRLST$,AUTO
          1 001E9C  82C6 000C                            LB,'0008'X        12,B6
          1 001E9E       0008
          1 001E9F  0581 0063                            BBF      s:5764,PREL

     2080     5741    3         %KV_RCRLST.SAMDAT = '1'B;         /* Tell the Host it's not updated     */

   5741   1 001EA1  8946 000D                            LBT,'0004'X       13,B6
   5741   1 001EA3       0004

     2081     5742    3         GOTO Y@SNDRCR;

   5742   1 001EA4  0F81 0046                            B        s:5760,PREL
          1 001EA6  0F81 0003                            B        s:5745,PREL

     2082     5743    3      END;
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:345  
     2083     5744    2   Y$UPDRCRSND: ENTRY ALTRET;

   5744   1 001EA8  EFC7 0036            Y$UPDRCRSND     STB,B6   KV@VDH_OTPLCL+5,AUTO

     2084     5745    2      %KV_RCR.RCRBYTSIZ = %KV_SSN.REDBFR.NXTX;

   5745   1 001EAA  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 001EAC  DCC7 000E                            LDB,B5   Y@SSN$,AUTO
          1 001EAE  E845 002A                            LDR,R6   42,B5
          1 001EB0  EF46 0001                            STR,R6   1,B6

     2085     5746    2      Y@BFRSIZ = %KV_RCR.RCRBYTSIZ+Y@KEYLNG+LENGTHV(KV$RCR);

   5746   1 001EB2  EA47 0013                            ADD,R6   Y@KEYLNG,AUTO
          1 001EB4  6E06                                 ADV,R6   6
          1 001EB5  EF47 0015                            STR,R6   Y@SRHLO,AUTO

     2086     5747    3      IF Y@BFRSIZ>%KV_RCR.STRBYTSIZ THEN DO;

   5747   1 001EB7  E906                                 CMR,R6   ,B6
          1 001EB8  0A81 0024                            BALE     s:5758,PREL

     2087     5748    3         Y@DLTRCR = Y@SRHCUR;

   5748   1 001EBA  D847 0016                            LDR,R5   Y@SRHCUR,AUTO
          1 001EBC  DF47 0014                            STR,R5   Y@SRHHI,AUTO

     2088     5749    3         SUBSTR(ADDR(KV@VDH_OTPLCL)->CHARS,0,Y@KEYLNG) =

   5749   1 001EBE  AB86                                 LAB,B2   ,B6
          1 001EBF  2C06                                 LDV,R2   6
          1 001EC0  E847 0013                            LDR,R6   Y@KEYLNG,AUTO
          1 001EC2  BB87                                 LAB,B3   ,AUTO
          1 001EC3  3C62                                 LDV,R3   98
          1 001EC4  0008                                 MMM

     2089     5750    3           SUBSTR(%KV_RCR.TXT,0,Y@KEYLNG);
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:346  
     2090     5751    4         CALL Y$GETRCRBFR WHENALTRETURN DO;

   5751   1 001EC5  E3C0 FC87                            LNJ,B6   s:0,PREL
          1 001EC7       0003                            DC       s:5752,PREL
          1 001EC8  0F81 0005                            B        s:5754,PREL

     2091     5752    4            ALTRETURN;

   5752   1 001ECA  ECC7 0036                            LDB,B6   KV@VDH_OTPLCL+5,AUTO
          1 001ECC  B806                                 LDR,R3   ,B6
          1 001ECD  C3B6                                 LNJ,B4   ,B6,R3

     2092     5753    4         END;
     2093     5754    3         %KV_RCR.UPD = '0'B;

   5754   1 001ECE  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 001ED0  8846 0002                            LBF,'0040'X       2,B6
          1 001ED2       0040

     2094     5755    3         %KV_RCR.DSP = '1'B;

   5755   1 001ED3  8946 0002                            LBT,'0010'X       2,B6
   5755   1 001ED5       0010

     2095     5756    3         %KV_RCR.ONE_2_1 = %KV_SSN.CLMIS_BYTX;

   5756   1 001ED6  DCC7 000E                            LDB,B5   Y@SSN$,AUTO
          1 001ED8  E845 0037                            LDR,R6   55,B5
          1 001EDA  EAC6 0002                            SRM,R6,'0080'X    2,B6
          1 001EDC       0080

     2096     5757    3      END;

     2097     5758    2      %KV_RCR.NEW = '0'B;

   5758   1 001EDD  8846 0002                            LBF,'0020'X       2,B6
   5758   1 001EDF       0020
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:347  

     2098     5759    2      SUBSTR(%KV_RCR.TXT,Y@KEYLNG,%KV_RCR.RCRBYTSIZ) =

   5759   1 001EE0  E846 0001                            LDR,R6   1,B6
          1 001EE2  CCC5 0030                            LDB,B4   48,B5
          1 001EE4  AB84                                 LAB,B2   ,B4
          1 001EE5  2C00                                 LDV,R2   0
          1 001EE6  BB86                                 LAB,B3   ,B6
          1 001EE7  B847 0013                            LDR,R3   Y@KEYLNG,AUTO
          1 001EE9  3E06                                 ADV,R3   6
          1 001EEA  0008                                 MMM

     2099     5760    2        SUBSTR(%KV_SSN.REDBFR__.ADR$->CHARS,0,%KV_RCR.RCRBYTSIZ);

   5760   1                              Y@SNDRCR        null
     2100     5761    2   Y@SNDRCR:;
     2101     5762    2      IF %KV_RCRLST.SNDRCR<0 THEN %KV_RCRLST.SNDRCR = Y@SRHCUR;

   5762   1 001EEB  ECC7 0006            Y@SNDRCR        LDB,B6   Y@RCRLST$,AUTO
          1 001EED  E846 0007                            LDR,R6   7,B6
          1 001EEF  6881 0007                            BGEZ,R6  s:5763,PREL

   5762   1 001EF1  E847 0016                            LDR,R6   Y@SRHCUR,AUTO
          1 001EF3  EF46 0007                            STR,R6   7,B6
          1 001EF5  0F81 0004                            B        s:5764,PREL

     2102     5763    2      ELSE %KV_RCRLST.SNDRQR.INS = '1'B;   /* an insert needed two writes        */

   5763   1 001EF7  8946 000C                            LBT,'0002'X       12,B6
   5763   1 001EF9       0002

     2103     5764    2      IF %KV_STR.SNDMAXNMBRCR~=0 THEN CALL Y$SNDRCR;

   5764   1 001EFA  DCC7 0010                            LDB,B5   Y@STR$,AUTO
          1 001EFC  D845 0019                            LDR,R5   25,B5
          1 001EFE  5901 0004                            BEZ,R5   s:5764,PREL

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:348  
   5764   1 001F00  E3C0 FE9A                            LNJ,B6   s:0,PREL
          1 001F02       0001                            DC       s:5764,PREL

   5764   1                              Y@UN_SCR        null
     2104     5765    2   Y@UN_SCR:;
     2105     5766    3      IF %KV_SSN.REDBFR.DSPLOWX~=%KV_RCRLST.HRZSCROFS THEN DO;

   5766   1 001F03  ECC7 000E            Y@UN_SCR        LDB,B6   Y@SSN$,AUTO
          1 001F05  DCC7 0006                            LDB,B5   Y@RCRLST$,AUTO
          1 001F07  E846 002F                            LDR,R6   47,B6
          1 001F09  E945 0003                            CMR,R6   3,B5
          1 001F0B  0901 000E                            BE       s:5770,PREL

     2106     5767    3         %KV_VDI.RE_DSPINP = '0'B;

   5767   1 001F0D  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 001F10  BC84                                 LDB,B3   ,B4
          1 001F11  8843 0019                            LBF,'0010'X       25,B3
          1 001F13       0010

     2107     5768    3         CALL KVI$SHFTO_DFL;

   5768   1 001F14  CBF0 0000                            LAB,B4   0,IMO
          1 001F16  E380 0000 0000  xent                 LNJ,B6   KVI$SHFTO_DFL
          1 001F19       0001                            DC       s:5770,PREL

     2108     5769    3      END;

     2109     5770    2      IF %KV_RCR.ONE_2_1 AND %KV_RCR.LINCNT>

   5770   1 001F1A  ECC7 000A                            LDB,B6   Y@RCR$,AUTO
          1 001F1C  82C6 0002                            LB,'0080'X        2,B6
          1 001F1E       0080
          1 001F1F  0581 0017                            BBF      s:5773,PREL
          1 001F21  DCC7 000C                            LDB,B5   Y@SRD$,AUTO
          1 001F23  E846 0001                            LDR,R6   1,B6
          1 001F25  EA45 000D                            ADD,R6   13,B5
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:349  
          1 001F27  6EFF                                 ADV,R6   -1
          1 001F28  E345 000D                            DIV,R6   13,B5
          1 001F2A  E970 0001                            CMR,R6   1,IMO
          1 001F2C  0881 0002                            BAGE     s:5770+21,PREL
          1 001F2E  6C01                                 LDV,R6   1
          1 001F2F  D0C6 0002                            LDH,R5   2,B6
          1 001F31  D956                                 CMR,R5   R6
          1 001F32  0A81 0004                            BALE     s:5773,PREL

     2110     5771    2        MAXIMUM ((%KV_RCR.RCRBYTSIZ+%KV_SRD.WDT-1)/%KV_SRD.WDT, 1)
     2111     5772    2      THEN %KV_RCR.LINCNT = -%KV_RCR.LINCNT;

   5772   1 001F34  8255                                 NEG      R5
          1 001F35  D7C6 0002                            STH,R5   2,B6

     2112     5773    2      RETURN;

   5773   1 001F37  ECC7 0036                            LDB,B6   KV@VDH_OTPLCL+5,AUTO
          1 001F39  C3C6 0001                            LNJ,B4   1,B6
     2113     5774    2   END Y$UPDRCR;
     2114     5775    1   END;

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:350  
--  Include file information  --

   KV_ERRORS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   KV$VDP.:E05TOU  is referenced.
   KV$INPFNC.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KVE$SE.
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:351  

 **** Variables and constants ****

  ****  Section 000 RoData KVE$SE

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    12-0-0/w SBIN(32)    r     1 Y_BIGKEY                  14-0-0/w STRC(48)    r     1 Y_ERR
    17-0-0/w STRC(16)    r     1 Y_KEY                     10-0-0/w UBIN(32)    r     1 Y_LTLKEY
     5-0-0/w STRC(176)   r     1 Y_VDH_GETBFR               0-0-0/w STRC(80)    r     1 Y_VDH_OTPLCL

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @PRM_INPOPR_DUMMY         3A-0-0/w PTR         r     1 @Y$RCR
    3F-0-0/w STRC(368)   r     1 KV@SND_DAT                1C-0-0/w STRC(64)    r     1 KV@USR_PST
    20-0-0/w STRC(96)    r     1 KV@USR_RQSDAT             26-0-0/w STRC(176)   r     1 KV@VDH_GETBFR
    31-0-0/w STRC(80)    r     1 KV@VDH_OTPLCL             *0-0-0/w STRC(17)    r     1 PRM_FND
    *0-0-0/w STRC(16)    r     1 PRM_INPOPR                *0-0-0/w ACHR        r     1 PRM_INPOPR_DUMMY
    *0-0-0/w ASTR(24)    r     1 PRM_INPOPR_TXT            *0-0-0/w STRC(96)    r     1 PRM_RQSDAT
    *0-0-0/w STRC(128)   r     1 PRM_VDH_DAT               *0-0-0/w STRC(56)    r     1 Y$RCR
    15-0-0/w SBIN(16)    r     1 Y@BFRSIZ                  38-0-0/w SBIN(16)    r     1 Y@BTMHOL
    14-0-0/w SBIN(16)    r     1 Y@DLTRCR                  3C-0-0/w STRC(48)    r     1 Y@ERR
     8-0-0/w PTR         r     1 Y@KEY$                    12-0-0/w SBIN(16)    r     1 Y@KEYCMP
    12-0-0/w UBIN(16)    r     1 Y@KEYCMPU                 14-0-0/w UBIN(16)    r     1 Y@KEYINC
    13-0-0/w SBIN(16)    r     1 Y@KEYLNG                  1B-0-0/w SBIN(16)    r     1 Y@LINCNT
    39-0-0/w SBIN(16)    r     1 Y@ORGVRTCLM                A-0-0/w PTR         r     1 Y@RCR$
     6-0-0/w PTR         r     1 Y@RCRLST$                 12-0-0/w SBIN(16)    r     1 Y@REDLIN
     C-0-0/w PTR         r     1 Y@SRD$                    16-0-0/w SBIN(16)    r     1 Y@SRHCUR
    14-0-0/w SBIN(16)    r     1 Y@SRHHI                   15-0-0/w SBIN(16)    r     1 Y@SRHLO
     E-0-0/w PTR         r     1 Y@SSN$                    10-0-0/w PTR         r     1 Y@STR$
    17-0-0/w UBIN(32)    r     1 Y@TMP32                   17-0-0/w STRC(32)    r     1 Y@TMP32B
    14-0-0/w SBIN(16)    r     1 Y@VRTLIN                  19-0-0/w SBIN(16)    r     1 Y@VRTSCRMRG
    1A-0-0/w SBIN(16)    r     1 Y@VRTSCRSHF

PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:352  
  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$                    0-0-0/w PTR         r     1 KV$RCVVDO$
     0-0-0/w UBIN(16)    r     1 KV_CMPCOD_TO_ERR#(0:0)
     0-0-0/w STRC(368)   r     1 KV_SND_DAT                 0-0-0/w STRC(64)    r     1 KV_USR_PST
     0-0-0/w STRC(96)    r     1 KV_USR_RQSDAT              0-0-0/w UBIN(16)    r     1 KV_VDH_DAT
     0-0-0/w SBIN(16)    r     1 KV_VDH_PST_HOM             0-0-0/w SBIN(16)    r     1 KV_VDH_PST_VRT

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(8)     r     1 CHARS                      0-0-0/w UBIN(8)     r     1 KEYU1
     0-0-0/w UBIN(16)    r     1 KEYU2                      0-0-0/w UBIN(24)    r     1 KEYU3
     0-0-0/w UBIN(32)    r     1 KEYU4                      0-0-0/w STRC(512)   r     1 KV$MRD
     0-0-0/w STRC(512)   r     1 KV$MVD                     0-0-0/w STRC(480)   r     1 KV$PTR
     0-0-0/w STRC(56)    r     1 KV$RCR                     0-0-0/w STRC(288)   r     1 KV$RCRLST
     0-0-0/w STRC(496)   r     1 KV$SRD                     0-0-0/w STRC(1024)  r     1 KV$SSN
     0-0-0/w STRC(512)   r     1 KV$STR                     0-0-0/w STRC(104)   r     1 KV$TITLE
     0-0-0/w STRC(512)   r     1 KV$VDI                     0-0-0/w STRC(16)    r     1 KV$VDOVLP
     0-0-0/w STRC(48)    r     1 KV$VDOVLP_ERR              0-0-0/w STRC(544)   r     1 KV_RCVVDO
     0-0-0/c SBIN(8)     r     1 RCR_BYT(0:0)


   Procedure KVE$SE requires 7995 words for executable code.
   Procedure KVE$SE requires 90 words of local(AUTO) storage.

    No errors detected in file KVE$SE.:E05TSI    .
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:353  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:354  
          MINI XREF LISTING

ABRRED
      4335**LABEL    3337--CALLALT  3339--GOTO     3352--CALLALT  3353--GOTO     3912--CALLALT  3948--CALLALT
      3971--CALLALT  4096--GOTO     4149--CALLALT  4169--CALLALT  4173--CALLALT  4227--GOTO     4251--CALLALT
      4318--CALLALT  4435--CALLALT  4508--GOTO     4512--GOTO     4519--GOTO     4526--GOTO     4591--GOTO
      4615--CALLALT  4641--GOTO
CHARS
      3031**DCL      3980<<ASSIGN   4002>>ASSIGN   4077>>IF       4103>>IF       4105<<ASSIGN   4106<<ASSIGN
      4107>>IF       4107>>IF       4107>>IF       4115<<ASSIGN   4153<<ASSIGN   4258>>ASSIGN   4431>>IF
      4448>>ASSIGN   4450>>ASSIGN   4988<<ASSIGN   4988>>ASSIGN   5100<<ASSIGN   5100>>ASSIGN   5730>>IF
      5749<<ASSIGN   5759>>ASSIGN
CHRFND
      3898**LABEL    3879--GOTO
DSPLOP IN PROCEDURE Y$DSPALL
      3444**LABEL    3499--GOTO     3501--EXIT     3522--EXIT     3689--EXIT
ERR_LD
      4632**LABEL    3796--GOTO
FNDBTM IN PROCEDURE Y$CHKSCR
      4851**LABEL    4863--EXIT
INPOPR
      3824**LABEL    4150--EXIT     4179--EXIT     4662--GOTO
INPOPR_EXIT
      4312**LABEL    3828--GOTO     3839--GOTO     3853--GOTO     3859--GOTO     4066--GOTO     4091--GOTO
      4127--GOTO     4189--GOTO
JOIN_DONE
      4043**LABEL    3940--GOTO
KEYU1
      3032**DCL      4940>>ASSIGN   4940>>ASSIGN   5140<<ASSIGN   5140>>ASSIGN   5141>>IF       5141>>IF
KEYU2
      3033**DCL      4943>>ASSIGN   4943>>ASSIGN   5143<<ASSIGN   5143>>ASSIGN   5144>>IF       5144>>IF
KEYU3
      3034**DCL      4946>>ASSIGN   4947>>ASSIGN   5147>>ASSIGN   5148<<ASSIGN   5149>>IF       5149>>IF
KEYU4
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:355  
      3035**DCL      4600<<ASSIGN   4600>>ASSIGN   4950>>ASSIGN   4950>>ASSIGN   5066<<ASSIGN   5066>>ASSIGN
      5147<<ASSIGN   5148>>ASSIGN   5151<<ASSIGN   5151>>ASSIGN   5152>>IF       5152>>IF       5712<<ASSIGN
      5712>>ASSIGN
KV$MRD.DVCCLM
      1437**DCL      4735>>ASSIGN
KV$MRD.HRZSCR
      1425**DCL      4710>>IF
KV$MVD.DCBHDN$
      1463**DCL      3670>>ASSIGN
KV$MVD.EDTRHT
      1467**DCL      3863>>IF       3908<<ASSIGN   3909<<ASSIGN
KV$MVD.FRMSCNINH
      1471**DCL      3440>>IF       3702<<ASSIGN   3818>>IF       4490<<ASSIGN   4645>>IF
KV$MVD.HRZSCR
      1471**DCL      3622>>IF       3707>>IF       3709>>IF       3755>>IF       3761>>IF       4629>>IF
      4644>>IF       4925>>IF       5077>>IF
KV$MVD.HRZSCRMRG
      1472**DCL      3707>>IF       3709>>IF
KV$MVD.ORG
      1467**DCL      3812>>IF
KV$MVD.VRTCLM
      1479**DCL      3414>>ASSIGN   3545<<ASSIGN   3694<<ASSIGN   4279<>CALL     4729<<ASSIGN
KV$MVD.WDT
      1466**DCL      3709>>IF
KV$PTR.INPCNDPND
      1511**DCL      1520--REDEF    1524--REDEF
KV$PTR.INPCNDPND.OPRX
      1520**DCL      3814>>ASSIGN   3854>>IF       3856>>IF       4061>>ASSIGN   4647<<ASSIGN
KV$PTR.LINLST$
      1507**DCL      1508--REDEF    3296>>ASSIGN
KV$PTR.MRD$
      1506**DCL      4710>>IF       4735>>ASSIGN
KV$PTR.MVD$
      1506**DCL      3414>>ASSIGN   3440>>IF       3545>>ASSIGN   3622>>IF       3670>>ASSIGN   3694>>ASSIGN
      3702>>ASSIGN   3707>>IF       3707>>IF       3709>>IF       3709>>IF       3709>>IF       3755>>IF
      3761>>IF       3812>>IF       3818>>IF       3863>>IF       3908>>ASSIGN   3909>>ASSIGN   4279>>CALL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:356  
      4490>>ASSIGN   4629>>IF       4644>>IF       4645>>IF       4729>>ASSIGN   4925>>IF       5077>>IF
KV$PTR.SRD$
      1507**DCL      3298>>ASSIGN
KV$PTR.SSN$
      1505**DCL      3295>>ASSIGN
KV$PTR.STR$
      1505**DCL      3297>>ASSIGN
KV$PTR.VDI$
      1505**DCL      3330>>IF       3415>>IF       3439>>IF       3509>>ASSIGN   3588>>ASSIGN   3681>>ASSIGN
      3703>>IF       3704>>ASSIGN   3705>>ASSIGN   3818>>IF       3819>>IF       4488>>ASSIGN   4491>>IF
      4493>>ASSIGN   4645>>ASSIGN   4646>>ASSIGN   4648>>ASSIGN   4652>>ASSIGN   4653>>ASSIGN   4724>>ASSIGN
      4734>>IF       4736>>IF       5767>>ASSIGN
KV$PTR$
      1499**DCL      1505--IMP-PTR  3295>>ASSIGN   3296>>ASSIGN   3297>>ASSIGN   3298>>ASSIGN   3330>>IF
      3414>>ASSIGN   3415>>IF       3439>>IF       3440>>IF       3509>>ASSIGN   3545>>ASSIGN   3588>>ASSIGN
      3622>>IF       3670>>ASSIGN   3681>>ASSIGN   3694>>ASSIGN   3702>>ASSIGN   3703>>IF       3704>>ASSIGN
      3705>>ASSIGN   3707>>IF       3707>>IF       3709>>IF       3709>>IF       3709>>IF       3755>>IF
      3761>>IF       3812>>IF       3814>>ASSIGN   3818>>IF       3818>>IF       3819>>IF       3854>>IF
      3856>>IF       3863>>IF       3908>>ASSIGN   3909>>ASSIGN   4061>>ASSIGN   4279>>CALL     4488>>ASSIGN
      4490>>ASSIGN   4491>>IF       4493>>ASSIGN   4629>>IF       4644>>IF       4645>>IF       4645>>ASSIGN
      4646>>ASSIGN   4647>>ASSIGN   4648>>ASSIGN   4652>>ASSIGN   4653>>ASSIGN   4710>>IF       4724>>ASSIGN
      4729>>ASSIGN   4734>>IF       4735>>ASSIGN   4736>>IF       4925>>IF       5077>>IF       5767>>ASSIGN
KV$RCR
      1548**DCL      3543--ASSIGN   3609--ASSIGN   3870--ASSIGN   3874--ASSIGN   3906--ASSIGN   3955--ASSIGN
      3982--ASSIGN   4249--ASSIGN   4423--ASSIGN   4554<>CALL     4614--ASSIGN   4622--ASSIGN   4624--ASSIGN
      4688--ASSIGN   4790<>CALL     4801<>CALL     4815<>CALL     4825<>CALL     4838<>CALL     4853<>CALL
      4861<>CALL     4990--ASSIGN   5070--ASSIGN   5691--ASSIGN   5746--ASSIGN
KV$RCR.DSP
      1550**DCL      3535>>IF       3542<<ASSIGN   3641<<ASSIGN   4436<<ASSIGN   5755<<ASSIGN
KV$RCR.LINCNT
      1549**DCL      3448>>IF       3454>>IF       3458>>IF       3459<<ASSIGN   3459>>ASSIGN   3460>>ASSIGN
      3465<<ASSIGN   3466<<ASSIGN   3468>>ASSIGN   3470<<ASSIGN   3480>>ASSIGN   3528>>IF       3549>>ASSIGN
      3559>>IF       3570<<ASSIGN   3633<<ASSIGN   3633>>ASSIGN   3649>>IF       3656<<ASSIGN   3660>>ASSIGN
      3664<<ASSIGN   3664>>ASSIGN   3697>>ASSIGN   3755<<ASSIGN   3756<<ASSIGN   3773<<ASSIGN   3773>>ASSIGN
      3798>>ASSIGN   4252<<ASSIGN   4616<<ASSIGN   4674>>ASSIGN   4968>>IF       5040>>ASSIGN   5071<<ASSIGN
      5077<<ASSIGN   5078<<ASSIGN   5080<<ASSIGN   5737<<ASSIGN   5737>>ASSIGN   5770>>IF       5772<<ASSIGN
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:357  
      5772>>ASSIGN
KV$RCR.NEW
      1549**DCL      3465>>IF       3532>>IF       3591>>IF       3918>>IF       3990<<ASSIGN   3990>>ASSIGN
      4049>>IF       4167<<ASSIGN   4172<<ASSIGN   4186>>IF       4192>>IF       4238>>IF       4281<<ASSIGN
      4295<<ASSIGN   4617<<ASSIGN   4627>>IF       4775>>IF       5069<<ASSIGN   5661>>IF       5728>>IF
      5734>>IF       5758<<ASSIGN
KV$RCR.ONE_2_1
      1549**DCL      4710>>IF       5068<<ASSIGN   5756<<ASSIGN   5770>>IF
KV$RCR.RCRBYTSIZ
      1548**DCL      3454>>IF       3458>>IF       3465>>IF       3466>>ASSIGN   3483>>IF       3497>>IF
      3544>>ASSIGN   3566>>ASSIGN   3733>>IF       3751>>IF       3756>>ASSIGN   3871>>ASSIGN   3937<<ASSIGN
      3943>>IF       3949>>IF       3961<<ASSIGN   3985>>ASSIGN   3988>>ASSIGN   3989>>ASSIGN   4000>>ASSIGN
      4004>>ASSIGN   4006>>ASSIGN   4015>>IF       4032>>ASSIGN   4034<<ASSIGN   4034>>ASSIGN   4042<<ASSIGN
      4122>>IF       4125>>IF       4131>>ASSIGN   4132>>IF       4158>>IF       4161>>IF       4162>>ASSIGN
      4165<<ASSIGN   4171<<ASSIGN   4253>>ASSIGN   4266<<ASSIGN   4266>>ASSIGN   4274<<ASSIGN   4274>>ASSIGN
      4408>>IF       4413>>IF       4429>>IF       4429>>IF       4449<<ASSIGN   4450>>ASSIGN   4450>>ASSIGN
      4466>>IF       4470>>IF       4623>>ASSIGN   4627>>IF       4707>>IF       4708>>ASSIGN   4968>>IF
      4971>>IF       4971<<ASSIGN   4971>>ASSIGN   4972<<ASSIGN   5070<<ASSIGN   5078>>ASSIGN   5688>>IF
      5689>>ASSIGN   5728>>IF       5728>>IF       5730>>IF       5736<<ASSIGN   5745<<ASSIGN   5746>>ASSIGN
      5759>>ASSIGN   5759>>ASSIGN   5770>>IF
KV$RCR.STRBYTSIZ
      1548**DCL      3956>>IF       3956>>IF       4991>>ASSIGN   5042>>IF       5042>>IF       5047>>ASSIGN
      5064<<ASSIGN   5747>>IF
KV$RCR.TXT
      1554**DCL      3962<<ASSIGN   3962>>ASSIGN   3964<<ASSIGN   3964>>ASSIGN   3966<<ASSIGN   3966>>ASSIGN
      3980>>ASSIGN   3991<<ASSIGN   3991>>ASSIGN   4002<<ASSIGN   4007<<ASSIGN   4007>>ASSIGN   4012<<ASSIGN
      4013<<ASSIGN   4014>>DOWHILE  4018>>DOUNTIL  4022>>IF       4025>>IF       4025>>IF       4025>>IF
      4035<<ASSIGN   4035>>ASSIGN   4121>>IF       4134>>IF       4153>>ASSIGN   4157>>DOUNTIL  4163<<ASSIGN
      4163>>ASSIGN   4194--ASSIGN   4218--ASSIGN   4258<<ASSIGN   4262>>DOWHILE  4264<<ASSIGN   4264>>ASSIGN
      4275<<ASSIGN   4431>>IF       4448<<ASSIGN   4450<<ASSIGN   4604--ASSIGN   4940--ASSIGN   4943--ASSIGN
      4946--ASSIGN   4950--ASSIGN   5066--ASSIGN   5712--ASSIGN   5730>>IF       5749>>ASSIGN   5759<<ASSIGN
KV$RCR.UPD
      1549**DCL      3452<<ASSIGN   3528>>IF       3657<<ASSIGN   3975<<ASSIGN   4166<<ASSIGN   4177<<ASSIGN
      4837<<ASSIGN   5067<<ASSIGN   5738<<ASSIGN   5754<<ASSIGN
KV$RCRLST.ACTCHR
      1587**DCL      3334<<ASSIGN   3338<<ASSIGN   3364<<ASSIGN   4223<<ASSIGN   4226<<ASSIGN   4521>>IF
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:358  
      4525<<ASSIGN   5692>>IF       5740>>IF
KV$RCRLST.BOF
      1587**DCL      3362<<ASSIGN   3828>>IF       4358<<ASSIGN   4573<<ASSIGN   4766>>IF       4810>>IF
      4875>>IF       4875>>IF       5098<<ASSIGN   5658>>IF
KV$RCRLST.CRTRCR
      1582**DCL      3299>>ASSIGN   3372<<ASSIGN   3446>>IF       3532>>IF       3611>>IF       3697>>ASSIGN
      3790>>ASSIGN   3796>>IF       3911<<ASSIGN   3938<<ASSIGN   3938>>ASSIGN   3943>>IF       3949>>IF
      3984>>IF       4043<<ASSIGN   4063>>ASSIGN   4090>>IF       4118>>ASSIGN   4148<<ASSIGN   4148>>ASSIGN
      4168<<ASSIGN   4168>>ASSIGN   4283<<ASSIGN   4298<<ASSIGN   4334>>IF       4336>>ASSIGN   4337<<ASSIGN
      4399<<ASSIGN   4473>>IF       4475>>ASSIGN   4515>>ASSIGN   4529<<ASSIGN   4529>>ASSIGN   4533>>ASSIGN
      4586>>IF       4593<<ASSIGN   4610<<ASSIGN   4621>>ASSIGN   4639>>ASSIGN   4672>>IF       4672>>IF
      4703>>IF       4748>>ASSIGN   4765>>IF       4766>>ASSIGN   4767<<ASSIGN   4768>>IF       4770>>ASSIGN
      4771<<ASSIGN   4771>>ASSIGN   4773<<ASSIGN   4774>>IF       4775>>IF       4776<<ASSIGN   4776>>ASSIGN
      4783>>IF       4787>>DOUNTIL  4796>>IF       4804>>IF       4833>>IF       4833>>IF       4834>>ASSIGN
      4835>>IF       4835>>IF       4840>>IF       4850>>ASSIGN   4875>>IF       4875>>IF       4982>>ASSIGN
      4985<<ASSIGN   4985>>ASSIGN   5081>>ASSIGN   5097<<ASSIGN   5097>>ASSIGN   5121<<ASSIGN   5121>>ASSIGN
      5658>>IF       5658>>IF
KV$RCRLST.DATCTRCHR
      1586**DCL      3335<<ASSIGN   4224<<ASSIGN   4357>>IF       4438>>IF       4439<<ASSIGN   4439>>ASSIGN
      4440>>IF       4441<<ASSIGN   4441>>ASSIGN   4442>>IF       5651<<ASSIGN   5652<<ASSIGN   5664<<ASSIGN
      5664>>ASSIGN   5669<<ASSIGN   5669>>ASSIGN   5708>>ASSIGN
KV$RCRLST.DFRCNT
      1588**DCL      3348<<ASSIGN   3816<<ASSIGN   4060>>IF       4063<<ASSIGN   4084>>IF       4090>>IF
      4138>>IF       4139<<ASSIGN   4139>>ASSIGN   4336<<ASSIGN   4475<<ASSIGN   4529>>ASSIGN   4535>>ASSIGN
      4658>>ASSIGN   4764<<ASSIGN   4766<<ASSIGN   4770<<ASSIGN   4771>>ASSIGN   4779>>IF       4984>>ASSIGN
      5083>>ASSIGN
KV$RCRLST.DFROPR
      1591**DCL      3370<<ASSIGN   4085<<ASSIGN   4140<<ASSIGN   4334>>IF       4335<<ASSIGN   4476<<ASSIGN
      4528>>IF       4530<<ASSIGN   4534>>IF       4536<<ASSIGN   4648>>IF       4656>>IF       4657>>ASSIGN
      4659<<ASSIGN   4763>>IF       4779<<ASSIGN   4875>>IF       4983>>IF       5082>>IF
KV$RCRLST.DLTRCREXS
      1589**DCL      3725>>IF       3726<<ASSIGN   4048<<ASSIGN   4532>>IF       4970<<ASSIGN
KV$RCRLST.EOF
      1586**DCL      3363<<ASSIGN   3522>>IF       3668>>IF       3837>>IF       3918>>IF       4186>>IF
      4192>>IF       4238>>IF       4241>>IF       4243<<ASSIGN   4357<<ASSIGN   4378<<ASSIGN   4393<<ASSIGN
      4473>>IF       4572<<ASSIGN   4769>>IF       4820>>IF       4855>>IF       4875>>IF       4875>>IF
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:359  
      5113<<ASSIGN   5658>>IF       5669>>IF       5734>>IF
KV$RCRLST.EOFDSP
      1589**DCL      3369<<ASSIGN   3394<<ASSIGN   3433<<ASSIGN   3473<<ASSIGN   3485>>IF       3501>>IF
      3574<<ASSIGN   3591>>IF       3607<<ASSIGN   3666<<ASSIGN   3669>>IF       3675<<ASSIGN   3688<<ASSIGN
      3785<<ASSIGN   4360<<ASSIGN
KV$RCRLST.ESYAPP
      1589**DCL      4186>>IF
KV$RCRLST.FRSRCR
      1581**DCL      3372>>ASSIGN   3417>>ASSIGN   3548>>IF       3591>>IF       3729>>IF       3729>>IF
      3747>>ASSIGN   3796>>IF       3798>>ASSIGN   3800<<ASSIGN   3800>>ASSIGN   3853>>IF       3855>>ASSIGN
      3856>>ASSIGN   4539>>IF       4540<<ASSIGN   4544>>IF       4546>>ASSIGN   4674>>ASSIGN   4676>>ASSIGN
      4677<<ASSIGN   4677>>ASSIGN   4699>>ASSIGN   4748>>ASSIGN   4810>>IF       4813>>IF       4814<<ASSIGN
      4814>>ASSIGN   4815>>CALL     4823>>IF       4825>>CALL     4827<<ASSIGN   4827>>ASSIGN   4840>>IF
      4855>>IF       4861>>CALL     4864<<ASSIGN   4864>>ASSIGN   4968>>IF       4978>>IF       4978<<ASSIGN
      4978>>ASSIGN   5076>>IF       5089>>IF       5090<<ASSIGN   5090>>ASSIGN   5114>>IF       5115<<ASSIGN
      5115>>ASSIGN   5658>>IF
KV$RCRLST.HRZSCROFS
      1581**DCL      3391<<ASSIGN   3544>>ASSIGN   3609>>ASSIGN   3761<<ASSIGN   4644>>ASSIGN   4689>>ASSIGN
      4691<<ASSIGN   4706>>ASSIGN   4707>>IF       4708>>ASSIGN   5766>>IF
KV$RCRLST.KEYINC
      1583**DCL      4182>>ASSIGN   4587>>IF       4605>>ASSIGN
KV$RCRLST.KEYLNG
      1585**DCL      3303>>ASSIGN   4269>>IF       4271>>ASSIGN   4297>>ASSIGN   5691>>ASSIGN   5711>>ASSIGN
KV$RCRLST.KEYTYP
      1585**DCL      4201>>DOCASE
KV$RCRLST.LSTRCR
      1582**DCL      3392<<ASSIGN   3438<<ASSIGN   3474<<ASSIGN   3476>>IF       3528>>IF       3528>>IF
      3548>>IF       3565>>IF       3591>>IF       3591>>IF       3605<<ASSIGN   3643<<ASSIGN   3712<<ASSIGN
      3720>>IF       3724<<ASSIGN   3729>>IF       3730>>ASSIGN   3747<<ASSIGN   3790<<ASSIGN   3797<<ASSIGN
      3853>>IF       3855>>ASSIGN   3857>>ASSIGN   4063>>ASSIGN   4487<<ASSIGN   4541>>IF       4542<<ASSIGN
      4544>>IF       4672>>IF       4672>>IF       4676<<ASSIGN   4820>>IF       4835>>IF       4835>>IF
      4873<<ASSIGN   4968>>IF       4979>>IF       4979<<ASSIGN   4979>>ASSIGN   5076>>IF       5091<<ASSIGN
      5093>>IF       5094<<ASSIGN   5094>>ASSIGN   5116>>IF       5117<<ASSIGN   5117>>ASSIGN
KV$RCRLST.MAXRCR
      1581**DCL      3308>>IF       3308>>ASSIGN   3815>>IF       4240>>IF       4389>>IF       4611>>IF
      4875>>IF       5650>>IF       5651>>ASSIGN   5652>>ASSIGN   5652>>ASSIGN
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:360  
KV$RCRLST.NO_CTX
      1590**DCL      3368<<ASSIGN   4504>>IF       5058<<ASSIGN
KV$RCRLST.ONESPCEDT
      1591**DCL      4025>>IF       4107>>IF
KV$RCRLST.PRTLSTRCR
      1587**DCL      3367<<ASSIGN   3393<<ASSIGN   3432<<ASSIGN   3475<<ASSIGN   3528>>IF       3554<<ASSIGN
      3573<<ASSIGN   3606<<ASSIGN   3642<<ASSIGN   3665<<ASSIGN   4672>>IF       4835>>IF
KV$RCRLST.RCR$
      1592**DCL      3301>>ASSIGN   3445>>ASSIGN   3483>>IF       3697>>ASSIGN   3732>>ASSIGN   3750>>ASSIGN
      3798>>ASSIGN   3869>>ASSIGN   3918>>IF       3926>>ASSIGN   3942>>ASSIGN   3968<<ASSIGN   3969<<ASSIGN
      3975>>ASSIGN   3993<<ASSIGN   3994<<ASSIGN   4041>>ASSIGN   4118>>ASSIGN   4186>>IF       4191>>ASSIGN
      4217>>ASSIGN   4238>>IF       4306>>ASSIGN   4408>>IF       4413>>IF       4428>>ASSIGN   4466>>IF
      4470>>IF       4554>>CALL     4604>>ASSIGN   4621>>ASSIGN   4674>>ASSIGN   4704>>ASSIGN   4775>>IF
      4790>>CALL     4801>>CALL     4815>>CALL     4825>>CALL     4834>>ASSIGN   4853>>CALL     4861>>CALL
      4940>>ASSIGN   4943>>ASSIGN   4946>>ASSIGN   4950>>ASSIGN   4967>>ASSIGN   4988--ASSIGN   4988--ASSIGN
      5038>>ASSIGN   5041<<ASSIGN   5100--ASSIGN   5100--ASSIGN   5123<<ASSIGN   5123>>ASSIGN   5127<<ASSIGN
      5660>>ASSIGN   5662>>ASSIGN   5665>>ASSIGN   5686>>ASSIGN   5726>>ASSIGN
KV$RCRLST.RCRCNT
      1580**DCL      3300>>IF       3361>>ASSIGN   3443>>IF       3482>>IF       3591>>IF       3662>>IF
      3719>>IF       3731>>IF       3749>>DOWHILE  3837>>IF       3867>>IF       3898>>IF       3918>>IF
      4090>>IF       4185>>IF       4192>>IF       4237>>ASSIGN   4240>>IF       4365>>IF       4378>>IF
      4389>>IF       4395>>ASSIGN   4398>>IF       4412>>IF       4469>>DOWHILE  4473>>IF       4505>>ASSIGN
      4539>>IF       4540>>ASSIGN   4541>>IF       4542>>ASSIGN   4552>>DOWHILE  4586>>IF       4588>>IF
      4593>>ASSIGN   4599>>IF       4603>>IF       4604>>ASSIGN   4609>>ASSIGN   4701>>IF       4768>>IF
      4769>>IF       4770>>ASSIGN   4773>>ASSIGN   4800>>DOWHILE  4820>>IF       4823>>IF       4833>>IF
      4852>>IF       4875>>IF       4875>>IF       4977<<ASSIGN   4977>>ASSIGN   4986>>ASSIGN   5004>>ASSIGN
      5060>>ASSIGN   5099>>ASSIGN   5103>>IF       5107<<ASSIGN   5107>>ASSIGN   5112<<ASSIGN   5112>>ASSIGN
      5122>>DOINDEX  5650>>IF       5651>>ASSIGN   5654>>IF       5658>>IF       5660>>ASSIGN   5661>>IF
      5662>>ASSIGN   5675>>IF       5734>>IF
KV$RCRLST.RCRNEDSNT
      1586**DCL      3366<<ASSIGN   4358>>IF       4359<<ASSIGN   4437>>IF       4442<<ASSIGN   4561>>IF
      4568>>IF       4574<<ASSIGN   5649<<ASSIGN
KV$RCRLST.SAMDAT
      1590**DCL      3336<<ASSIGN   5694>>IF       5741<<ASSIGN
KV$RCRLST.SCRDN
      1590**DCL      4794<<ASSIGN   4809>>IF       4812<<ASSIGN   4813>>IF       4843<<ASSIGN   4875>>IF
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:361  
KV$RCRLST.SCRUP
      1590**DCL      4807<<ASSIGN   4819>>IF       4822<<ASSIGN   4823>>IF       4842<<ASSIGN
KV$RCRLST.SNDRCR
      1583**DCL      3338>>IF       3371<<ASSIGN   4038<<ASSIGN   4050>>IF       4051<<ASSIGN   4174<<ASSIGN
      4226>>IF       4285<<ASSIGN   4326>>IF       4504>>IF       4505<<ASSIGN   4510>>IF       4515<<ASSIGN
      4516<<ASSIGN   4516>>ASSIGN   4639<<ASSIGN   4980>>IF       4980<<ASSIGN   4981>>IF       4981<<ASSIGN
      4981>>ASSIGN   5060>>IF       5060<<ASSIGN   5095<<ASSIGN   5095>>ASSIGN   5118>>IF       5119<<ASSIGN
      5119>>ASSIGN   5675>>IF       5675>>IF       5683<<ASSIGN   5686>>ASSIGN   5687<<ASSIGN   5762>>IF
      5762<<ASSIGN
KV$RCRLST.SNDRQR
      1587**DCL      3365<<ASSIGN   4326>>IF       4514>>IF       4518<<ASSIGN
KV$RCRLST.SNDRQR.DLT
      1587**DCL      4050<<ASSIGN   4516>>IF
KV$RCRLST.SNDRQR.INS
      1588**DCL      5763<<ASSIGN
KV$RCRLST.SPRCNT
      1585**DCL      4875>>IF
KV$RCRLST.TXTEDT
      1589**DCL      3983>>IF       4009>>IF       4245>>IF       4260>>IF       4321>>IF       4627>>IF
KV$RCRLST.VRTSCRCNT
      1584**DCL      3425>>IF       3426>>IF       3426>>IF       3429>>ASSIGN   3528>>IF       3557>>IF
      3692<<ASSIGN   3798<<ASSIGN   4674<<ASSIGN   4872<<ASSIGN   4872>>ASSIGN   5092<<ASSIGN   5092>>ASSIGN
KV$RCRLST.VRTSCRMRG
      1584**DCL      3304>>ASSIGN
KV$RCRLST.VRTSCRSHF
      1584**DCL      3309>>ASSIGN
KV$RCVVDO$
      1736**DCL      1608--IMP-PTR  4354>>ASSIGN   4355>>IF       4356>>IF       4363>>IF       4364>>ASSIGN
      4369>>ASSIGN   4423>>ASSIGN   4429>>IF       4431>>IF       4431>>IF       4431>>IF       4431>>IF
      4449>>ASSIGN   4450>>ASSIGN   4450>>ASSIGN   4461>>ASSIGN   4463>>IF       4599>>IF       4600>>ASSIGN
KV$SRD.BTMRHT
      1854**DCL      1859--REDEF    3422>>ASSIGN   3423>>ASSIGN   3518>>ASSIGN
KV$SRD.BTMRHT.CLM
      1856**DCL      3551>>ASSIGN
KV$SRD.BTMRHT.LIN
      1856**DCL      3491>>IF       3550>>ASSIGN   3553>>ASSIGN   3564>>ASSIGN   3577>>IF       3627>>IF
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:362  
      3628>>ASSIGN   3634>>IF       3649>>IF       3774>>IF       3778>>IF       4701>>IF       4806>>IF
      4820>>IF       4840>>IF       4851>>DOWHILE  4855>>IF       4862>>IF       4875>>IF
KV$SRD.CRT
      1930**DCL      1935--REDEF    3693<<ASSIGN   4722<<ASSIGN
KV$SRD.CRT.CLM
      1932**DCL      3424<<ASSIGN   3505>>IF       3508<<ASSIGN   3584>>IF       3587<<ASSIGN   3645>>IF
      3677>>IF       3680<<ASSIGN   3788<<ASSIGN   4723>>ASSIGN   4735<<ASSIGN   4736>>IF
KV$SRD.CRT.LIN
      1932**DCL      3505>>IF       3507<<ASSIGN   3584>>IF       3586<<ASSIGN   3645>>IF       3647<<ASSIGN
      3647>>ASSIGN   3648>>ASSIGN   3677>>IF       3679<<ASSIGN   3774>>IF       3778>>IF       3782>>ASSIGN
      4726>>ASSIGN   4727>>ASSIGN
KV$SRD.CRTVRTLINPHSLIN
      1902**DCL      3504<<ASSIGN   3505>>IF       3507>>ASSIGN   3546<<ASSIGN   3549>>ASSIGN   3558>>ASSIGN
      3563>>ASSIGN   3564>>ASSIGN   3584>>IF       3586>>ASSIGN   3645>>IF       3648>>ASSIGN   3651>>ASSIGN
      3676<<ASSIGN   3677>>IF       3679>>ASSIGN   3696<<ASSIGN   3697>>ASSIGN   4550<<ASSIGN   4551>>ASSIGN
      4553>>IF       4555<<ASSIGN   4555>>ASSIGN   4726<<ASSIGN   4748<<ASSIGN   4750>>ASSIGN   4751>>ASSIGN
      4791<<ASSIGN   4791>>ASSIGN   4793>>IF       4802<<ASSIGN   4802>>ASSIGN   4806>>IF       4810>>IF
      4817<<ASSIGN   4817>>ASSIGN   4820>>IF       4828<<ASSIGN   4828>>ASSIGN   4840>>IF       4849>>ASSIGN
      4862>>IF       4866<<ASSIGN   4866>>ASSIGN
KV$SRD.CRT_PST
      1935**DCL      3620>>IF
KV$SRD.FLDEND
      1894**DCL      1899--REDEF    3422<<ASSIGN   3636>>ASSIGN   3699>>ASSIGN   3787>>ASSIGN   4728>>ASSIGN
KV$SRD.FLDEND.CLM
      1896**DCL      4736>>IF
KV$SRD.FLDEND.LIN
      1896**DCL      3549<<ASSIGN   3552>>IF       3553<<ASSIGN   3556>>ASSIGN   3568<<ASSIGN   3577>>IF
      3581>>ASSIGN   3627>>IF       3628>>ASSIGN   3630>>ASSIGN   3632<<ASSIGN   3632>>ASSIGN   3634>>IF
      3649>>IF       3652>>ASSIGN   3697<<ASSIGN   3786<<ASSIGN   3786>>ASSIGN   4727<<ASSIGN   4750<<ASSIGN
KV$SRD.HI_NONBLN
      1964**DCL      1969--REDEF    3423<<ASSIGN   3518<<ASSIGN   3636<<ASSIGN   3699<<ASSIGN   3787<<ASSIGN
      4728<<ASSIGN
KV$SRD.HI_NONBLN.CLM
      1966**DCL      3551<<ASSIGN
KV$SRD.HI_NONBLN.LIN
      1966**DCL      3550<<ASSIGN   3552>>IF       3556<<ASSIGN   3558<<ASSIGN   3581<<ASSIGN   4751<<ASSIGN
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:363  
KV$SRD.HI_NONBLN_PST
      1969**DCL      3620>>IF
KV$SRD.LNG
      1862**DCL      3306>>ASSIGN   3307>>IF       3307>>ASSIGN   3311>>ASSIGN   3313>>ASSIGN   3315>>IF
      3315>>ASSIGN   3426>>IF       3426>>IF       3528>>IF       3662>>IF       3663>>IF       3664>>ASSIGN
      3668>>IF       4630>>IF       4631>>ASSIGN   4855>>IF       5652>>ASSIGN
KV$SRD.ORG
      1786**DCL      1791--REDEF
KV$SRD.PAGEHALT
      1863**DCL      3420<<ASSIGN
KV$SRD.PRKCRS
      1866**DCL      4342>>IF
KV$SRD.PRMVRTCLM
      1902**DCL      3707>>IF       4643<<ASSIGN
KV$SRD.SRDEND
      1999**DCL      2004--REDEF
KV$SRD.TOPLFT
      1820**DCL      1825--REDEF    3428>>ASSIGN   3693>>ASSIGN   4694>>ASSIGN
KV$SRD.TOPLFT.CLM
      1822**DCL      3505>>IF       3508>>ASSIGN   3584>>IF       3587>>ASSIGN   3645>>IF       3677>>IF
      3680>>ASSIGN   3788>>ASSIGN   4723>>ASSIGN
KV$SRD.TOPLFT.LIN
      1822**DCL      3480>>ASSIGN   3504>>ASSIGN   3546>>ASSIGN   3676>>ASSIGN   3696>>ASSIGN   4550>>ASSIGN
      4748>>ASSIGN   4793>>IF       4810>>IF
KV$SRD.UNKPST
      2007**DCL      3514<<ASSIGN   3538<<ASSIGN
KV$SRD.VRTPSTOK
      1863**DCL      3547<<ASSIGN   4665>>ASSIGN   4671<<ASSIGN   4730<<ASSIGN
KV$SRD.VRTSCR
      2008**DCL      3439>>IF       3471>>IF       3500>>IF       3548>>IF       3591>>IF       3684>>IF
      3701>>IF       3778>>IF       3797>>IF       4676>>IF       4855>>IF       4871>>IF       5091>>IF
KV$SRD.WDT
      1862**DCL      3448>>IF       3466>>ASSIGN   3466>>ASSIGN   3566>>ASSIGN   3628>>ASSIGN   3756>>ASSIGN
      3756>>ASSIGN   4630>>IF       4631>>ASSIGN   4698>>ASSIGN   4926>>ASSIGN   4926>>ASSIGN   5078>>ASSIGN
      5078>>ASSIGN   5770>>IF       5770>>IF
KV$SRD.WRPPAG
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:364  
      1864**DCL      3421<<ASSIGN
KV$SSN.BP
      2087**DCL      5728>>IF
KV$SSN.CLMIS_BYTX
      2086**DCL      5756>>ASSIGN
KV$SSN.REDBFR.DSPLOWX
      2057**DCL      3391>>ASSIGN   3614>>ASSIGN   3615>>ASSIGN   3707>>IF       4644<<ASSIGN   4689>>ASSIGN
      4691>>ASSIGN   5766>>IF
KV$SSN.REDBFR.EDTHI_X
      2056**DCL      4302<<ASSIGN
KV$SSN.REDBFR.EDTLOWX
      2056**DCL      3332>>ASSIGN   3341>>IF       3817>>ASSIGN   3838>>IF       3841<<ASSIGN   3842>>ASSIGN
      3915>>IF       3917>>IF       3921>>IF       3922<<ASSIGN   3923>>ASSIGN   3999>>IF       4055>>IF
      4056<<ASSIGN   4057>>ASSIGN   4083<<ASSIGN   4221>>ASSIGN   4245>>IF       4249>>ASSIGN   4258>>ASSIGN
      4282>>ASSIGN   4300>>ASSIGN   4301>>ASSIGN   4302>>ASSIGN   4303>>ASSIGN
KV$SSN.REDBFR.INSMODX
      2057**DCL      4301<<ASSIGN
KV$SSN.REDBFR.NXTX
      2055**DCL      3341>>IF       3705>>ASSIGN   3819>>IF       3841>>ASSIGN   3917>>IF       3918>>IF
      3921>>IF       3922>>ASSIGN   3924>>ASSIGN   4055>>IF       4056>>ASSIGN   4058>>ASSIGN   4074>>IF
      4075>>ASSIGN   4100>>ASSIGN   4155<<ASSIGN   4186>>IF       4245>>IF       4249>>ASSIGN   4300<<ASSIGN
      4491>>IF       5727>>ASSIGN   5745>>ASSIGN
KV$SSN.REDBFR__.ADR$
      2082**DCL      3611>>IF       3613>>ASSIGN   4002>>ASSIGN   4073>>ASSIGN   4098>>ASSIGN   4153>>ASSIGN
      4258>>ASSIGN   5730>>IF       5759>>ASSIGN
KV$SSN.REDBFR__.BFRBYTSIZ
      2083**DCL      4092>>DOWHILE
KV$SSN.REDBFR__.BYTX
      2082**DCL      4002>>ASSIGN
KV$SSN.REDBFR__.DATBYTSIZ
      2082**DCL      3615>>ASSIGN   3915>>IF       3924<<ASSIGN   3932>>IF       3955>>ASSIGN   3982>>ASSIGN
      3998>>ASSIGN   4058<<ASSIGN   4303<<ASSIGN   4618<<ASSIGN
KV$SSN.REDONL
      2052**DCL      3838>>IF
KV$SSN.REDRQSPND
      2054**DCL      4491>>IF       4576>>IF       4655>>IF
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:365  
KV$SSN.REDRSPCNT
      2042**DCL      2043--REDEF
KV$SSN.REDSTRID
      2088**DCL      3390>>IF       3611>>IF       3700>>IF
KV$STR.AUTTABCLM
      2176**DCL      4023>>IF       4024>>ASSIGN   4080>>IF       4114>>ASSIGN   4125>>IF       4125>>IF
      4244>>IF       4247>>ASSIGN   4273>>ASSIGN   4274>>ASSIGN   4275>>ASSIGN   4296>>ASSIGN   4321>>IF
      4323>>ASSIGN   4626>>IF       4628>>ASSIGN
KV$STR.ERR.COD
      2168**DCL      3351<<ASSIGN   4094<<ASSIGN   4222<<ASSIGN   4464<<ASSIGN   4506<<ASSIGN   4589<<ASSIGN
      4635<<ASSIGN   5059<<ASSIGN   5647<<ASSIGN   5682>>IF       5682<<ASSIGN   5696>>IF       5699<<ASSIGN
      5702>>IF       5705>>ASSIGN   5706<<ASSIGN
KV$STR.ID
      2174**DCL      3390>>IF       3611>>IF       3700>>IF
KV$STR.MAXRCRBYTSIZ
      2171**DCL      4325>>ASSIGN
KV$STR.RE_REDCLM
      2144**DCL      3332<<ASSIGN   3341>>IF       3373<<ASSIGN   3817<<ASSIGN   3831<<ASSIGN   3842<<ASSIGN
      3847<<ASSIGN   3890<<ASSIGN   3906<<ASSIGN   3923<<ASSIGN   3988<<ASSIGN   4033<<ASSIGN   4057<<ASSIGN
      4075<<ASSIGN   4137<<ASSIGN   4221<<ASSIGN   4267<<ASSIGN   4267>>ASSIGN   4273<<ASSIGN   4273>>ASSIGN
      4282<<ASSIGN   4282>>ASSIGN   4296<<ASSIGN   4321>>IF       4321>>IF       4323<<ASSIGN   4400<<ASSIGN
      4594<<ASSIGN   4613<<ASSIGN   4628<<ASSIGN   5697>>ASSIGN
KV$STR.SNDMAXNMBRCR
      2172**DCL      4039>>IF       4052>>IF       4175>>IF       4286>>IF       4307>>IF       4333>>IF
      4562>>IF       4581>>IF       4640>>IF       5061>>IF       5764>>IF
KV$STR.WRDWRP
      2177**DCL      3341>>IF
KV$STR.WRDWRPCLM
      2176**DCL      3341>>IF       3341>>IF       4066>>IF       4072>>ASSIGN   4080>>IF       4081>>ASSIGN
KV$TITLE.TXTSIZ
      2227**DCL      2227--REDEF    3672>>ASSIGN
KV$VDI.OTPCNDPND.PST
      2287**DCL      3415>>IF       3509<<ASSIGN   3588<<ASSIGN   3681<<ASSIGN   4724<<ASSIGN   4734>>IF
      4736>>IF
KV$VDI.RE_DSPINP
      2285**DCL      3330>>IF       3439>>IF       3703>>IF       3704<<ASSIGN   3818>>IF       4488<<ASSIGN
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:366  
      4493<<ASSIGN   4645<<ASSIGN   4646>>ASSIGN   4652<<ASSIGN   5767<<ASSIGN
KV$VDI.RE_DSPLOWX
      2281**DCL      3705<<ASSIGN   3819>>IF       4491>>IF       4653<<ASSIGN
KV$VDI.USRRQSDAT.RED
      2291**DCL      4648<<ASSIGN
KV$VDOVLP
      2322**DCL      4354--ASSIGN   4369--ASSIGN   4461--ASSIGN   4600--ASSIGN   5710<<ASSIGN   5712--ASSIGN
KV$VDOVLP.BYTSIZ
      2328**DCL      5711<<ASSIGN
KV$VDOVLP_ERR.ERRCODE.ERR#
      2429**DCL      4356>>IF
KV@SND_DAT IN PROCEDURE Y$SNDNEED
      5490**DCL      5646<<ASSIGN   5674<<ASSIGN   5715<>CALL
KV@SND_DAT.ACTPOS IN PROCEDURE Y$SNDNEED
      5593**DCL      5697<<ASSIGN
KV@SND_DAT.DATCTRCHR IN PROCEDURE Y$SNDNEED
      5592**DCL      5708<<ASSIGN
KV@SND_DAT.DATCTRCHRTYP IN PROCEDURE Y$SNDNEED
      5528**DCL      5648<<ASSIGN   5693<<ASSIGN
KV@SND_DAT.DATMOD IN PROCEDURE Y$SNDNEED
      5528**DCL      5694<<ASSIGN
KV@SND_DAT.DAT__.ADR$ IN PROCEDURE Y$SNDNEED
      5588**DCL      5690<<ASSIGN
KV@SND_DAT.DAT__.BYTX IN PROCEDURE Y$SNDNEED
      5588**DCL      5691<<ASSIGN
KV@SND_DAT.DAT__.DATBYTSIZ IN PROCEDURE Y$SNDNEED
      5588**DCL      5689<<ASSIGN
KV@SND_DAT.VDOVLP IN PROCEDURE Y$SNDNEED
      5558**DCL      5561--REDEF
KV@SND_DAT.VDOVLP.ERR$ IN PROCEDURE Y$SNDNEED
      5559**DCL      5703<<ASSIGN
KV@SND_DAT.VDOVLP.KEY$ IN PROCEDURE Y$SNDNEED
      5560**DCL      5667<<ASSIGN   5700<<ASSIGN   5709>>IF
KV@USR_PST
      2580**DCL      3411<<ASSIGN   3435<>CALL     3492<>CALL     3579<>CALL     3635<>CALL     3654<>CALL
      3779<<ASSIGN   3783<>CALL     4693<<ASSIGN   4711<>CALL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:367  
KV@USR_PST.PHSPST
      2613**DCL      2618--REDEF    3428<<ASSIGN   4694<<ASSIGN   4722>>ASSIGN
KV@USR_PST.PHSPST.LIN
      2615**DCL      3440<<ASSIGN   3441<<ASSIGN   3480<<ASSIGN   3491>>IF       3511>>IF       3512>>IF
      3515<<ASSIGN   3535>>IF       3536>>IF       3539<<ASSIGN   3563<<ASSIGN   3568>>ASSIGN   3630<<ASSIGN
      3651<<ASSIGN   3652>>ASSIGN   3702>>IF       3782<<ASSIGN   4701>>IF       4745<<ASSIGN   4745>>ASSIGN
KV@USR_PST.PHSPSTMOD
      2621**DCL      3412<<ASSIGN   3780<<ASSIGN   4695<<ASSIGN
KV@USR_PST.SCRCNT
      2621**DCL      3429<<ASSIGN   3430>>IF       3430>>ASSIGN   3436<<ASSIGN   3477>>IF       3477<<ASSIGN
      3478<<ASSIGN   3478>>ASSIGN   3486>>IF       3494<<ASSIGN   3578<<ASSIGN   3631<<ASSIGN   3652<<ASSIGN
      3653>>ASSIGN   3781<<ASSIGN   4696<<ASSIGN   4697<<ASSIGN   4710>>IF
KV@USR_RQSDAT
      2650**DCL      4324<<ASSIGN   4577<<ASSIGN   4650<>CALL
KV@USR_RQSDAT.BFR_.ADR$
      2681**DCL      4622<<ASSIGN
KV@USR_RQSDAT.BFR_.BYTSIZ
      2681**DCL      4623<<ASSIGN   4626>>IF       4632>>IF       4653>>ASSIGN
KV@USR_RQSDAT.BFR_.BYTX
      2681**DCL      4624<<ASSIGN
KV@USR_RQSDAT.MAXRCRBYTSIZ
      2684**DCL      4325<<ASSIGN   4630>>IF       4631<<ASSIGN   4632>>IF
KV@USR_RQSDAT.RE_RED
      2656**DCL      3823<<ASSIGN   4314>>IF       4625<<ASSIGN   4665<<ASSIGN   4671>>ASSIGN
KV@VDH_GETBFR
      2777**DCL      3374<<ASSIGN   3418<<ASSIGN   3752<<ASSIGN   4370<<ASSIGN   4992<>CALL     5036<<ASSIGN
      5048<>CALL     5057<>CALL
KV@VDH_GETBFR.BFR$
      2783**DCL      4990<<ASSIGN   5039<<ASSIGN   5049<<ASSIGN   5052>>IF       5063>>ASSIGN   5127>>ASSIGN
KV@VDH_GETBFR.BYTSIZ
      2783**DCL      4991<<ASSIGN   5047<<ASSIGN   5056<<ASSIGN   5064>>ASSIGN
KV@VDH_OTPLCL
      2851**DCL      3409<<ASSIGN   3619<>CALL     3687<>CALL     3980--ASSIGN   4600--ASSIGN   4692<<ASSIGN
      4732<>CALL     5066--ASSIGN   5140--ASSIGN   5141--IF       5143--ASSIGN   5144--IF       5147--ASSIGN
      5148--ASSIGN   5148--ASSIGN   5149--IF       5151--ASSIGN   5152--IF       5667--ASSIGN   5700--ASSIGN
      5710--ASSIGN   5711--ASSIGN   5712--ASSIGN   5749--ASSIGN
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:368  
KV@VDH_OTPLCL.BFR_.ADR$
      2884**DCL      3543<<ASSIGN   3613<<ASSIGN   3670<<ASSIGN   3671>>IF       3672>>ASSIGN   4705<<ASSIGN
KV@VDH_OTPLCL.BFR_.BYTSIZ
      2884**DCL      3544<<ASSIGN   3615<<ASSIGN   3618>>ASSIGN   3622>>IF       3628>>ASSIGN   3637>>ASSIGN
      3672<<ASSIGN   3674>>IF       4708<<ASSIGN   4709<<ASSIGN   4715>>IF       4716<<ASSIGN   4716>>ASSIGN
      4718<<ASSIGN   4719>>IF       4720<<ASSIGN   4731>>IF
KV@VDH_OTPLCL.BFR_.BYTX
      2884**DCL      3410<<ASSIGN   3500>>IF       3503<<ASSIGN   3591>>IF       3609<<ASSIGN   3614<<ASSIGN
      3684>>IF       3686<<ASSIGN   3720>>IF       4706<<ASSIGN   4714<<ASSIGN   4714>>ASSIGN
KV@VDH_OTPLCL.NO_WRAP
      2858**DCL      4646<<ASSIGN   4651>>IF
KVI$EDTX_TO_VRTCLM
      2437**DCL-ENT  4279--CALL
KVI$PRGRED
      2438**DCL-ENT  4340--CALL     4582--CALL
KVI$RE_DSPINP
      2439**DCL-ENT  3330--CALL     3820--CALL
KVI$RQSDAT
      2440**DCL-ENT  4650--CALL
KVI$SHFDSPPST
      2441**DCL-ENT  3708--CALL     3710--CALL
KVI$SHFTO_DFL
      2442**DCL-ENT  5768--CALL
KVI$TRMRED_VDH_DAT
      2443**DCL-ENT  4341--CALL     4583--CALL
KVM$SND
      2444**DCL-ENT  5715--CALL
KVO$ERSTO_ENDOF_INP
      2445**DCL-ENT  3621--CALL     3789--CALL     4289--CALL     4743--CALL
KVO$ERSTO_ENDOF_SRD
      2446**DCL-ENT  3519--CALL     3604--CALL     3685--CALL
KVO$OTPLCL
      2447**DCL-ENT  3619--CALL     3687--CALL     4732--CALL
KVO$PST
      2448**DCL-ENT  3713--CALL     4280--CALL     4342--CALL
KVS$GETBFR
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:369  
      2449**DCL-ENT  5057--CALL
KVS$GETREDBFR
      2450**DCL-ENT  4093--CALL
KVS$RLSBFR
      2451**DCL-ENT  4992--CALL     5048--CALL
KVV$CALUSR
      2452**DCL-ENT  3435--CALL     3492--CALL     3579--CALL     3635--CALL     3654--CALL     3783--CALL
      4711--CALL
KVV$CALUSR_EVT
      2453**DCL-ENT  3513--CALL     3537--CALL
KVV$CALUSR_PST
      2454**DCL-ENT  3415--CALL     3589--CALL     3682--CALL
KVV$VDIINT
      2455**DCL-ENT  4314--CALL
KV_CMPCOD_TO_ERR#
      3288**DCL      3351>>ASSIGN
KV_RCVVDO.OTPLCL.BFR_.ADR$
      1682**DCL      4363>>IF       4364>>ASSIGN   4431>>IF       4450>>ASSIGN
KV_RCVVDO.OTPLCL.BFR_.BYTSIZ
      1682**DCL      4423>>ASSIGN   4429>>IF       4431>>IF       4431>>IF       4449>>ASSIGN
KV_RCVVDO.OTPLCL.BFR_.BYTX
      1682**DCL      4431>>IF       4450>>ASSIGN
KV_RCVVDO.VDOVLP_ERR$
      1611**DCL      4355>>IF       4356>>IF
KV_RCVVDO.VDOVLP_KEY$
      1612**DCL      4354>>ASSIGN   4369>>ASSIGN   4461>>ASSIGN   4599>>IF       4600>>ASSIGN
KV_RCVVDO.VDOVLP_MRK$
      1612**DCL      4463>>IF
KV_RCVVDO.VDP_VDO.LGLVD_ORG_BIT
      1723**DCL      1725--REDEF
KV_SND_DAT IN PROCEDURE Y$SNDNEED
      5371**DCL      5646>>ASSIGN   5674>>ASSIGN
KV_SND_DAT.VDOVLP IN PROCEDURE Y$SNDNEED
      5439**DCL      5442--REDEF
KV_USR_PST
      2510**DCL      3411>>ASSIGN   3779>>ASSIGN   4693>>ASSIGN
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:370  
KV_USR_PST.PHSPST
      2543**DCL      2548--REDEF
KV_USR_RQSDAT
      2713**DCL      4324>>ASSIGN
KV_VDH_DAT
      2749**DCL      4314<>CALL
KV_VDH_PST_HOM
      2457**DCL      4342<>CALL
KV_VDH_PST_VRT
      2456**DCL      3713<>CALL     4280<>CALL
LONGKEY IN PROCEDURE Y$CMPKEY
      4951**LABEL    4948--GOTO
NXTLIN IN PROCEDURE Y$DSPALL
      3656**LABEL    3525--GOTO     3540--GOTO
OTPLCL IN PROCEDURE Y$DSPALL
      3619**LABEL    3638--GOTO
PRM_FND.BYT
      3285**DCL      3821>>ASSIGN
PRM_FND.RVRDRC
      3287**DCL      3863>>IF
PRM_INPOPR.ID
      3051**DCL      3049--IMP-SIZ  3051--REDEF    3052--REDEF    3052--REDEF    3822>>ASSIGN
PRM_INPOPR_DUMMY
      3049**DCL         8--PROC     3049--REDEF    3052--REDEF    3055--REDEF    3063--REDEF    3167--REDEF
      3203--REDEF    3237--REDEF    3284--REDEF    3328--ENTRY    3810--ENTRY    4496--ENTRY
PRM_INPOPR_PST.VDH_PST.PSTVAL
      3129**DCL      3134--REDEF
PRM_INPOPR_TXT.L
      3060**DCL      3060--IMP-SIZ
PRM_RQSDAT
      3167**DCL      4577>>ASSIGN
PRM_VDH_DAT.CMPCOD
      3277**DCL      3341>>IF       3351>>ASSIGN
PRM_VDH_DAT.DATCTRCHR
      3279**DCL      3335>>ASSIGN
PRM_VDH_DAT.DATCTRCHRTYP
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:371  
      3244**DCL      3333>>IF
PST_NOKEY
      4463**LABEL    4467--GOTO
RCR_BYT
      3036**DCL      3879>>IF       3887>>IF       3894>>DOUNTIL
RETALT IN PROCEDURE Y$FNDKEY
      5008**LABEL    5016--CALLALT  5020--CALLALT
SETEDTRHT
      3906**LABEL    3834--GOTO     3850--GOTO     3860--GOTO     3891--GOTO
SPLIT_ONE
      4066**LABEL    3349--GOTO     3844--GOTO
SRHNXT
      3863**LABEL    3900--GOTO
SUBCOMMON IN PROCEDURE Y$SNDNEED
      5700**LABEL    5661--GOTO     5670--GOTO     5684--GOTO
USE_DLTRCR
      4442**LABEL    4433--GOTO
Y$CHKSCR
      4761**PROC     4330--CALL     4560--CALL
Y$CMPKEY
      4936**PROC     4196--CALL     4375--CALL     5007--CALL     5016--CALL     5020--CALL
Y$DLTRCR
      4965**PROC     3377--CALL     4377--CALL
Y$DLTRCRRLS IN PROCEDURE Y$DLTRCR
      4976**ENTRY    3498--CALL     3733--CALL     3753--CALL
Y$DSPALL
      3405**PROC     3395--CALL     3401--CALL     3802--CALL     4312--CALL     4489--CALL     4532--CALL
      4619--CALL     4670--CALL
Y$ENBRED
      4577**LABEL    4331--GOTO
Y$ERS_THE_REST IN PROCEDURE Y$DSPALL
      3501**LABEL    3721--GOTO
Y$FNDKEY
      5002**PROC     4366--CALL     4385--CALL     4462--CALL
Y$GETRCRBFR
      5034**PROC     3997--CALL     4251--CALL     4435--CALL     4615--CALL     5751--CALL
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:372  
Y$INCKEY
      5136**PROC     4219--CALL     4607--CALL
Y$LINCNT
      4890**PROC     4554--CALL     4790--CALL     4801--CALL     4815--CALL     4825--CALL     4838--CALL
      4853--CALL     4861--CALL
Y$RCR IN PROCEDURE Y$LINCNT
      4913**DCL      4890--PROC
Y$RCR.LINCNT IN PROCEDURE Y$LINCNT
      4914**DCL      4923>>ASSIGN
Y$RCR.RCRBYTSIZ IN PROCEDURE Y$LINCNT
      4913**DCL      4924>>IF       4926>>ASSIGN
Y$RCR.UPD IN PROCEDURE Y$LINCNT
      4914**DCL      4925>>IF
Y$SCRUP IN PROCEDURE Y$CHKSCR
      4823**LABEL    4844--GOTO
Y$SETUP
      3294**PROC     3331--CALL     3360--CALL     3389--CALL     3400--CALL     3746--CALL     3772--CALL
      3813--CALL     4353--CALL     4460--CALL     4486--CALL     4503--CALL     4661--CALL     4687--CALL
Y$SNDNEED
      5161**PROC     4333--CALL     4562--CALL
Y$SNDRCR IN PROCEDURE Y$SNDNEED
      5672**ENTRY    4039--CALL     4052--CALL     4175--CALL     4286--CALL     4507--CALL     4511--CALL
      4517--CALL     4590--CALL     4640--CALL     5061--CALL     5764--CALL
Y$UPDRCR
      5724**PROC     3337--CALL     3912--CALL     3948--CALL     3971--CALL     4149--CALL     4318--CALL
Y$UPDRCRSND IN PROCEDURE Y$UPDRCR
      5744**ENTRY    3352--CALL     4095--CALL     4169--CALL     4173--CALL     4225--CALL
Y@BFRSIZ
      2474**DCL      3460<<ASSIGN   3461>>IF       3468<<ASSIGN   3468>>ASSIGN   3472>>IF       3478>>ASSIGN
      3479>>ASSIGN   3499>>IF       3955<<ASSIGN   3956>>IF       3956>>IF       3982<<ASSIGN   3983<<ASSIGN
      3983>>ASSIGN   3985<<ASSIGN   3985>>ASSIGN   3989<<ASSIGN   3989>>ASSIGN   3998<<ASSIGN   4000>>ASSIGN
      4002>>ASSIGN   4002>>ASSIGN   4004<<ASSIGN   4006>>ASSIGN   4007>>ASSIGN   4007>>ASSIGN   4010>>ASSIGN
      4032<<ASSIGN   4035>>ASSIGN   4035>>ASSIGN   4249<<ASSIGN   4253<<ASSIGN   4254>>IF       4258>>ASSIGN
      4258>>ASSIGN   4262>>DOWHILE  4263<<ASSIGN   4263>>ASSIGN   4264>>ASSIGN   4264>>ASSIGN   4423<<ASSIGN
      4614<<ASSIGN   4973<<ASSIGN   4982<<ASSIGN   4984<<ASSIGN   4984>>ASSIGN   4985>>IF       4986<<ASSIGN
      4987>>IF       4988>>ASSIGN   4988>>ASSIGN   5042>>IF       5042>>IF       5042>>IF       5056>>ASSIGN
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:373  
      5070>>ASSIGN   5081<<ASSIGN   5083<<ASSIGN   5083>>ASSIGN   5096>>IF       5099<<ASSIGN   5100>>ASSIGN
      5100>>ASSIGN   5120>>IF       5120>>IF       5122<<DOINDEX  5123>>ASSIGN   5123>>ASSIGN   5727<<ASSIGN
      5728>>IF       5728>>IF       5730>>IF       5734>>IF       5746<<ASSIGN   5747>>IF
Y@BTMHOL IN PROCEDURE Y$DSPALL
      3406**DCL      3413<<ASSIGN   3430<<ASSIGN   3479<<ASSIGN   3479>>ASSIGN   3493<<ASSIGN   3528>>IF
      3528>>IF       3550>>ASSIGN   3571>>IF       3572<<ASSIGN   3576<<ASSIGN   3576>>ASSIGN   3653<<ASSIGN
      3653>>ASSIGN
Y@CHK_ACTCHR IN PROCEDURE Y$UPDRCR
      5738**LABEL    5732--GOTO
Y@DLTRCR
      2470**DCL      3814<<ASSIGN   3815>>IF       3815>>IF       3815<<ASSIGN   3829<<ASSIGN   3829>>ASSIGN
      3832<<ASSIGN   3848<<ASSIGN   3855<<ASSIGN   3856<<ASSIGN   3857<<ASSIGN   3858<<ASSIGN   3858>>ASSIGN
      3859>>IF       3864<<ASSIGN   3869>>ASSIGN   3872>>IF       3877>>IF       3896>>IF       3896<<ASSIGN
      3896>>ASSIGN   3897<<ASSIGN   3897>>ASSIGN   3898>>IF       3898>>IF       3902>>IF       3908>>IF
      3911>>ASSIGN   3996<<ASSIGN   4000<<ASSIGN   4001<<ASSIGN   4002>>ASSIGN   4005>>IF       4005<<ASSIGN
      4006<<ASSIGN   4007>>ASSIGN   4010>>IF       4010<<ASSIGN   4010>>ASSIGN   4011>>ASSIGN   4014>>DOWHILE
      4015>>IF       4016<<ASSIGN   4016>>ASSIGN   4031>>IF       4032>>ASSIGN   4034>>ASSIGN   4035>>ASSIGN
      4060>>IF       4061<<ASSIGN   4062>>IF       4065>>ASSIGN   4072<<ASSIGN   4074>>IF       4076>>DOUNTIL
      4077>>IF       4078<<ASSIGN   4078>>ASSIGN   4080>>IF       4080>>IF       4081<<ASSIGN   4082<<ASSIGN
      4082>>ASSIGN   4083>>ASSIGN   4092>>DOWHILE  4117<<ASSIGN   4117>>ASSIGN   4131<<ASSIGN   4131>>ASSIGN
      4132>>IF       4133>>DOWHILE  4134>>IF       4135<<ASSIGN   4135>>ASSIGN   4142>>IF       4152<<ASSIGN
      4152>>ASSIGN   4153>>ASSIGN   4153>>ASSIGN   4155>>ASSIGN   4156>>ASSIGN   4162<<ASSIGN   4163>>ASSIGN
      4163>>ASSIGN   4165>>ASSIGN   4237<<ASSIGN   4238>>IF       4240<<ASSIGN   4241>>IF       4241>>IF
      4242<<ASSIGN   4394<<ASSIGN   4395<<ASSIGN   4402<<ASSIGN   4410<<ASSIGN   4412>>IF       4414<<ASSIGN
      4420<<ASSIGN   4424>>IF       4611<<ASSIGN   4612<<ASSIGN   4658<<ASSIGN   4660<<ASSIGN   4689<<ASSIGN
      4690>>IF       4696>>ASSIGN   4697>>IF       4697>>IF       4698>>IF       4698<<ASSIGN   4698>>ASSIGN
      4712>>ASSIGN   4713>>IF       4714>>ASSIGN   4715>>IF       4716>>ASSIGN   4719>>IF       4720>>ASSIGN
      4736>>IF       5037>>IF       5038>>ASSIGN   5041>>ASSIGN   5071>>IF       5084>>IF       5112>>IF
      5748<<ASSIGN
Y@ERR IN PROCEDURE Y$SNDNEED
      5295**DCL      5703--ASSIGN   5704<<ASSIGN
Y@ERR.ERRCODE.ERR# IN PROCEDURE Y$SNDNEED
      5353**DCL      5705<<ASSIGN
Y@KEY$
      2460**DCL      3869<<ASSIGN   3871>>ASSIGN   3879>>IF       3887>>IF       3894>>DOUNTIL  3926<<ASSIGN
      3937>>ASSIGN   3949>>IF       3956>>IF       3962>>ASSIGN   3964>>ASSIGN   3966>>ASSIGN   3966>>ASSIGN
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:374  
      3969>>ASSIGN   3980>>ASSIGN   3986<<ASSIGN   3988>>ASSIGN   3989>>ASSIGN   3990>>ASSIGN   3991>>ASSIGN
      3994>>ASSIGN   4004>>ASSIGN   4007>>ASSIGN   4041<<ASSIGN   4042>>ASSIGN   4049>>IF       4073<<ASSIGN
      4077>>IF       4098<<ASSIGN   4103>>IF       4105>>ASSIGN   4106>>ASSIGN   4107>>IF       4107>>IF
      4107>>IF       4115>>ASSIGN   4118<<ASSIGN   4121>>IF       4122>>IF       4125>>IF       4131>>ASSIGN
      4132>>IF       4134>>IF       4153>>ASSIGN   4157>>DOUNTIL  4158>>IF       4161>>IF       4162>>ASSIGN
      4163>>ASSIGN   4163>>ASSIGN   4165>>ASSIGN   4166>>ASSIGN   4167>>ASSIGN   4171>>ASSIGN   4172>>ASSIGN
      4184<<ASSIGN   4194<<ASSIGN   4218<<ASSIGN   4235<<ASSIGN   4287<<ASSIGN   4307>>IF       4354<<ASSIGN
      4364<<ASSIGN   4369<<ASSIGN   4448>>ASSIGN   4461<<ASSIGN   4603<<ASSIGN   4604<<ASSIGN   4940>>ASSIGN
      4943>>ASSIGN   4947>>ASSIGN   4950>>ASSIGN   5140>>ASSIGN   5141>>IF       5143>>ASSIGN   5144>>IF
      5147>>ASSIGN   5149>>IF       5151>>ASSIGN   5152>>IF
Y@KEYCMP
      2465**DCL      2466--REDEF    2467--REDEF    4197<<ASSIGN   4198<<ASSIGN   4376>>IF       4394>>IF
      4438>>IF       4440>>IF       4940<<ASSIGN   4943<<ASSIGN   4953<<ASSIGN   4954<<ASSIGN   4955<<ASSIGN
      4957>>IF       5010<<ASSIGN   5011>>IF       5017>>IF       5021>>IF       5025<<ASSIGN
Y@KEYCMPU
      2466**DCL      4200>>DOWHILE  4205>>ASSIGN
Y@KEYINC
      2472**DCL      4182<<ASSIGN   4183>>IF       4183<<ASSIGN   4200>>DOWHILE  4203<<ASSIGN   4205<<ASSIGN
      4207<<ASSIGN   4207>>ASSIGN   4212<<ASSIGN   4212>>ASSIGN   4214<<ASSIGN   4214>>ASSIGN   4220>>IF
      4605<<ASSIGN   4606>>IF       4606<<ASSIGN   5140>>ASSIGN   5141<<ASSIGN   5143>>ASSIGN   5144<<ASSIGN
      5147>>ASSIGN   5149<<ASSIGN   5151>>ASSIGN   5152<<ASSIGN
Y@KEYLNG
      2468**DCL      3303<<ASSIGN   3609>>ASSIGN   3870>>ASSIGN   3874>>ASSIGN   3906>>ASSIGN   3955>>ASSIGN
      3962>>ASSIGN   3962>>ASSIGN   3962>>ASSIGN   3964>>ASSIGN   3964>>ASSIGN   3966>>ASSIGN   3966>>ASSIGN
      3966>>ASSIGN   3980>>ASSIGN   3980>>ASSIGN   3982>>ASSIGN   3991>>ASSIGN   3991>>ASSIGN   4000>>ASSIGN
      4001>>ASSIGN   4005>>IF       4005>>ASSIGN   4006>>ASSIGN   4007>>ASSIGN   4010>>IF       4015>>IF
      4020>>IF       4032>>ASSIGN   4033>>ASSIGN   4121>>IF       4134>>IF       4153>>ASSIGN   4157>>DOUNTIL
      4163>>ASSIGN   4163>>ASSIGN   4197>>IF       4247<<ASSIGN   4247>>ASSIGN   4249>>ASSIGN   4258>>ASSIGN
      4262>>DOWHILE  4264>>ASSIGN   4264>>ASSIGN   4269>>IF       4271<<ASSIGN   4275>>ASSIGN   4297<<ASSIGN
      4423>>ASSIGN   4431>>IF       4448>>ASSIGN   4448>>ASSIGN   4450>>ASSIGN   4614>>ASSIGN   4624>>ASSIGN
      4688<<ASSIGN   4688>>ASSIGN   4706>>ASSIGN   4938>>DOCASE   5070>>ASSIGN   5138>>DOCASE   5730>>IF
      5746>>ASSIGN   5749>>ASSIGN   5749>>ASSIGN   5759>>ASSIGN
Y@LINCNT
      2482**DCL      3347<<ASSIGN   3822<<ASSIGN   3824>>DOCASE   3830>>IF       3838>>IF       3843<<ASSIGN
      3846>>IF       3876>>IF       3877>>DOUNTIL  3882<<ASSIGN   3886<<ASSIGN   3888<<ASSIGN   3889>>IF
      4011<<ASSIGN   4012>>ASSIGN   4013>>ASSIGN   4018>>DOUNTIL  4019<<ASSIGN   4019>>ASSIGN   4020>>IF
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:375  
      4022>>IF       4024<<ASSIGN   4024>>ASSIGN   4025>>IF       4025>>IF       4025>>IF       4029<<ASSIGN
      4029>>ASSIGN   4030<<ASSIGN   4030>>ASSIGN   4031>>IF       4033>>ASSIGN   4034>>ASSIGN   4035>>ASSIGN
      4065<<ASSIGN   4066>>IF       4068>>IF       4084>>IF       4223>>IF       4245>>IF       4260>>IF
      4267>>IF       4272>>IF       4277>>IF       4555>>ASSIGN   4657<<ASSIGN   4660>>IF       4791>>ASSIGN
      4802>>ASSIGN   4816>>ASSIGN   4817>>ASSIGN   4826>>ASSIGN   4828>>ASSIGN   4839>>ASSIGN   4854>>ASSIGN
      4862>>IF       4865>>ASSIGN   4866>>ASSIGN   4867>>ASSIGN   4923<<ASSIGN   4924<<ASSIGN   4925>>IF
      4925<<ASSIGN   4926<<ASSIGN
Y@ORGVRTCLM IN PROCEDURE Y$DSPALL
      3407**DCL      3414<<ASSIGN   3448>>IF       3694>>ASSIGN   3707>>IF       3709>>IF
Y@RCR$
      2461**DCL      1548--IMP-PTR  3301<<ASSIGN   3445<<ASSIGN   3448>>IF       3452>>ASSIGN   3454>>IF
      3454>>IF       3458>>IF       3458>>IF       3459>>ASSIGN   3459>>ASSIGN   3460>>ASSIGN   3465>>IF
      3465>>IF       3465>>ASSIGN   3466>>ASSIGN   3466>>ASSIGN   3468>>ASSIGN   3470>>ASSIGN   3480>>ASSIGN
      3497>>IF       3524<<ASSIGN   3528>>IF       3528>>IF       3532>>IF       3535>>IF       3542>>ASSIGN
      3543>>ASSIGN   3544>>ASSIGN   3549>>ASSIGN   3559>>IF       3566>>ASSIGN   3570>>ASSIGN   3591>>IF
      3633>>ASSIGN   3633>>ASSIGN   3641>>ASSIGN   3649>>IF       3656>>ASSIGN   3657>>ASSIGN   3660>>ASSIGN
      3664>>ASSIGN   3664>>ASSIGN   3732<<ASSIGN   3733>>IF       3750<<ASSIGN   3751>>IF       3755>>ASSIGN
      3756>>ASSIGN   3756>>ASSIGN   3773>>ASSIGN   3773>>ASSIGN   3942<<ASSIGN   3943>>IF       3956>>IF
      3961>>ASSIGN   3962>>ASSIGN   3964>>ASSIGN   3968>>ASSIGN   3985>>ASSIGN   3986>>ASSIGN   3990>>ASSIGN
      3991>>ASSIGN   3993>>ASSIGN   4000>>ASSIGN   4002>>ASSIGN   4006>>ASSIGN   4007>>ASSIGN   4012>>ASSIGN
      4013>>ASSIGN   4014>>DOWHILE  4015>>IF       4018>>DOUNTIL  4022>>IF       4025>>IF       4025>>IF
      4025>>IF       4032>>ASSIGN   4034>>ASSIGN   4034>>ASSIGN   4035>>ASSIGN   4035>>ASSIGN   4177>>ASSIGN
      4191<<ASSIGN   4192>>IF       4194>>ASSIGN   4217<<ASSIGN   4218>>ASSIGN   4235>>ASSIGN   4252>>ASSIGN
      4253>>ASSIGN   4258>>ASSIGN   4262>>DOWHILE  4264>>ASSIGN   4264>>ASSIGN   4266>>ASSIGN   4266>>ASSIGN
      4274>>ASSIGN   4274>>ASSIGN   4275>>ASSIGN   4281>>ASSIGN   4295>>ASSIGN   4306<<ASSIGN   4428<<ASSIGN
      4429>>IF       4429>>IF       4431>>IF       4436>>ASSIGN   4448>>ASSIGN   4449>>ASSIGN   4450>>ASSIGN
      4450>>ASSIGN   4450>>ASSIGN   4616>>ASSIGN   4617>>ASSIGN   4621<<ASSIGN   4622>>ASSIGN   4623>>ASSIGN
      4627>>IF       4627>>IF       4704<<ASSIGN   4705>>ASSIGN   4707>>IF       4708>>ASSIGN   4710>>IF
      4834<<ASSIGN   4837>>ASSIGN   4838>>CALL     4967<<ASSIGN   4968>>IF       4968>>IF       4971>>IF
      4971>>ASSIGN   4971>>ASSIGN   4972>>ASSIGN   4990>>ASSIGN   4991>>ASSIGN   5038<<ASSIGN   5039>>ASSIGN
      5040>>ASSIGN   5042>>IF       5042>>IF       5047>>ASSIGN   5063<<ASSIGN   5064>>ASSIGN   5066>>ASSIGN
      5067>>ASSIGN   5068>>ASSIGN   5069>>ASSIGN   5070>>ASSIGN   5071>>ASSIGN   5077>>ASSIGN   5078>>ASSIGN
      5078>>ASSIGN   5080>>ASSIGN   5660<<ASSIGN   5661>>IF       5662<<ASSIGN   5665<<ASSIGN   5686<<ASSIGN
      5688>>IF       5689>>ASSIGN   5690>>ASSIGN   5712>>ASSIGN   5726<<ASSIGN   5728>>IF       5728>>IF
      5728>>IF       5730>>IF       5730>>IF       5734>>IF       5736>>ASSIGN   5737>>ASSIGN   5737>>ASSIGN
      5738>>ASSIGN   5745>>ASSIGN   5746>>ASSIGN   5747>>IF       5749>>ASSIGN   5754>>ASSIGN   5755>>ASSIGN
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:376  
      5756>>ASSIGN   5758>>ASSIGN   5759>>ASSIGN   5759>>ASSIGN   5759>>ASSIGN   5770>>IF       5770>>IF
      5770>>IF       5772>>ASSIGN   5772>>ASSIGN
Y@RCRLST$
      2459**DCL      1580--IMP-PTR  3296<<ASSIGN   3299>>ASSIGN   3300>>IF       3301>>ASSIGN   3303>>ASSIGN
      3304>>ASSIGN   3308>>IF       3308>>ASSIGN   3309>>ASSIGN   3334>>ASSIGN   3335>>ASSIGN   3336>>ASSIGN
      3338>>IF       3338>>ASSIGN   3348>>ASSIGN   3361>>ASSIGN   3362>>ASSIGN   3363>>ASSIGN   3364>>ASSIGN
      3365>>ASSIGN   3366>>ASSIGN   3367>>ASSIGN   3368>>ASSIGN   3369>>ASSIGN   3370>>ASSIGN   3371>>ASSIGN
      3372>>ASSIGN   3372>>ASSIGN   3391>>ASSIGN   3392>>ASSIGN   3393>>ASSIGN   3394>>ASSIGN   3417>>ASSIGN
      3425>>IF       3426>>IF       3426>>IF       3429>>ASSIGN   3432>>ASSIGN   3433>>ASSIGN   3438>>ASSIGN
      3443>>IF       3445>>ASSIGN   3446>>IF       3473>>ASSIGN   3474>>ASSIGN   3475>>ASSIGN   3476>>IF
      3482>>IF       3483>>IF       3485>>IF       3501>>IF       3522>>IF       3528>>IF       3528>>IF
      3528>>IF       3528>>IF       3532>>IF       3544>>ASSIGN   3548>>IF       3548>>IF       3554>>ASSIGN
      3557>>IF       3565>>IF       3573>>ASSIGN   3574>>ASSIGN   3591>>IF       3591>>IF       3591>>IF
      3591>>IF       3591>>IF       3605>>ASSIGN   3606>>ASSIGN   3607>>ASSIGN   3609>>ASSIGN   3611>>IF
      3642>>ASSIGN   3643>>ASSIGN   3662>>IF       3665>>ASSIGN   3666>>ASSIGN   3668>>IF       3669>>IF
      3675>>ASSIGN   3688>>ASSIGN   3692>>ASSIGN   3697>>ASSIGN   3697>>ASSIGN   3712>>ASSIGN   3719>>IF
      3720>>IF       3724>>ASSIGN   3725>>IF       3726>>ASSIGN   3729>>IF       3729>>IF       3729>>IF
      3730>>ASSIGN   3731>>IF       3732>>ASSIGN   3747>>ASSIGN   3747>>ASSIGN   3749>>DOWHILE  3750>>ASSIGN
      3761>>ASSIGN   3785>>ASSIGN   3790>>ASSIGN   3790>>ASSIGN   3796>>IF       3796>>IF       3797>>ASSIGN
      3798>>ASSIGN   3798>>ASSIGN   3798>>ASSIGN   3800>>ASSIGN   3800>>ASSIGN   3815>>IF       3816>>ASSIGN
      3828>>IF       3837>>IF       3837>>IF       3853>>IF       3853>>IF       3855>>ASSIGN   3855>>ASSIGN
      3856>>ASSIGN   3857>>ASSIGN   3867>>IF       3869>>ASSIGN   3898>>IF       3911>>ASSIGN   3918>>IF
      3918>>IF       3918>>IF       3926>>ASSIGN   3938>>ASSIGN   3938>>ASSIGN   3942>>ASSIGN   3943>>IF
      3949>>IF       3968>>ASSIGN   3969>>ASSIGN   3975>>ASSIGN   3983>>IF       3984>>IF       3993>>ASSIGN
      3994>>ASSIGN   4009>>IF       4025>>IF       4038>>ASSIGN   4041>>ASSIGN   4043>>ASSIGN   4048>>ASSIGN
      4050>>IF       4050>>ASSIGN   4051>>ASSIGN   4060>>IF       4063>>ASSIGN   4063>>ASSIGN   4063>>ASSIGN
      4084>>IF       4085>>ASSIGN   4090>>IF       4090>>IF       4090>>IF       4107>>IF       4118>>ASSIGN
      4118>>ASSIGN   4138>>IF       4139>>ASSIGN   4139>>ASSIGN   4140>>ASSIGN   4148>>ASSIGN   4148>>ASSIGN
      4168>>ASSIGN   4168>>ASSIGN   4174>>ASSIGN   4182>>ASSIGN   4185>>IF       4186>>IF       4186>>IF
      4186>>IF       4191>>ASSIGN   4192>>IF       4192>>IF       4201>>DOCASE   4217>>ASSIGN   4223>>ASSIGN
      4224>>ASSIGN   4226>>IF       4226>>ASSIGN   4237>>ASSIGN   4238>>IF       4238>>IF       4240>>IF
      4240>>IF       4241>>IF       4243>>ASSIGN   4245>>IF       4260>>IF       4269>>IF       4271>>ASSIGN
      4283>>ASSIGN   4285>>ASSIGN   4297>>ASSIGN   4298>>ASSIGN   4306>>ASSIGN   4321>>IF       4326>>IF
      4326>>IF       4334>>IF       4334>>IF       4335>>ASSIGN   4336>>ASSIGN   4336>>ASSIGN   4337>>ASSIGN
      4357>>IF       4357>>ASSIGN   4358>>IF       4358>>ASSIGN   4359>>ASSIGN   4360>>ASSIGN   4365>>IF
      4378>>IF       4378>>ASSIGN   4389>>IF       4389>>IF       4393>>ASSIGN   4395>>ASSIGN   4398>>IF
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:377  
      4399>>ASSIGN   4408>>IF       4412>>IF       4413>>IF       4428>>ASSIGN   4437>>IF       4438>>IF
      4439>>ASSIGN   4439>>ASSIGN   4440>>IF       4441>>ASSIGN   4441>>ASSIGN   4442>>IF       4442>>ASSIGN
      4466>>IF       4469>>DOWHILE  4470>>IF       4473>>IF       4473>>IF       4473>>IF       4475>>ASSIGN
      4475>>ASSIGN   4476>>ASSIGN   4487>>ASSIGN   4504>>IF       4504>>IF       4505>>ASSIGN   4505>>ASSIGN
      4510>>IF       4514>>IF       4515>>ASSIGN   4515>>ASSIGN   4516>>IF       4516>>ASSIGN   4516>>ASSIGN
      4518>>ASSIGN   4521>>IF       4525>>ASSIGN   4528>>IF       4529>>ASSIGN   4529>>ASSIGN   4529>>ASSIGN
      4530>>ASSIGN   4532>>IF       4533>>ASSIGN   4534>>IF       4535>>ASSIGN   4536>>ASSIGN   4539>>IF
      4539>>IF       4540>>ASSIGN   4540>>ASSIGN   4541>>IF       4541>>IF       4542>>ASSIGN   4542>>ASSIGN
      4544>>IF       4544>>IF       4546>>ASSIGN   4552>>DOWHILE  4554>>CALL     4561>>IF       4568>>IF
      4572>>ASSIGN   4573>>ASSIGN   4574>>ASSIGN   4586>>IF       4586>>IF       4587>>IF       4588>>IF
      4593>>ASSIGN   4593>>ASSIGN   4599>>IF       4603>>IF       4604>>ASSIGN   4604>>ASSIGN   4605>>ASSIGN
      4609>>ASSIGN   4610>>ASSIGN   4611>>IF       4621>>ASSIGN   4621>>ASSIGN   4627>>IF       4639>>ASSIGN
      4639>>ASSIGN   4644>>ASSIGN   4648>>IF       4656>>IF       4657>>ASSIGN   4658>>ASSIGN   4659>>ASSIGN
      4672>>IF       4672>>IF       4672>>IF       4672>>IF       4672>>IF       4674>>ASSIGN   4674>>ASSIGN
      4674>>ASSIGN   4676>>ASSIGN   4676>>ASSIGN   4677>>ASSIGN   4677>>ASSIGN   4689>>ASSIGN   4691>>ASSIGN
      4699>>ASSIGN   4701>>IF       4703>>IF       4704>>ASSIGN   4706>>ASSIGN   4707>>IF       4708>>ASSIGN
      4748>>ASSIGN   4748>>ASSIGN   4763>>IF       4764>>ASSIGN   4765>>IF       4766>>IF       4766>>ASSIGN
      4766>>ASSIGN   4767>>ASSIGN   4768>>IF       4768>>IF       4769>>IF       4769>>IF       4770>>ASSIGN
      4770>>ASSIGN   4770>>ASSIGN   4771>>ASSIGN   4771>>ASSIGN   4771>>ASSIGN   4773>>ASSIGN   4773>>ASSIGN
      4774>>IF       4775>>IF       4775>>IF       4776>>ASSIGN   4776>>ASSIGN   4779>>IF       4779>>ASSIGN
      4783>>IF       4787>>DOUNTIL  4790>>CALL     4794>>ASSIGN   4796>>IF       4800>>DOWHILE  4801>>CALL
      4804>>IF       4807>>ASSIGN   4809>>IF       4810>>IF       4810>>IF       4812>>ASSIGN   4813>>IF
      4813>>IF       4814>>ASSIGN   4814>>ASSIGN   4815>>CALL     4815>>CALL     4819>>IF       4820>>IF
      4820>>IF       4820>>IF       4822>>ASSIGN   4823>>IF       4823>>IF       4823>>IF       4825>>CALL
      4825>>CALL     4827>>ASSIGN   4827>>ASSIGN   4833>>IF       4833>>IF       4833>>IF       4834>>ASSIGN
      4834>>ASSIGN   4835>>IF       4835>>IF       4835>>IF       4835>>IF       4835>>IF       4840>>IF
      4840>>IF       4842>>ASSIGN   4843>>ASSIGN   4850>>ASSIGN   4852>>IF       4853>>CALL     4855>>IF
      4855>>IF       4861>>CALL     4861>>CALL     4864>>ASSIGN   4864>>ASSIGN   4872>>ASSIGN   4872>>ASSIGN
      4873>>ASSIGN   4875>>IF       4875>>IF       4875>>IF       4875>>IF       4875>>IF       4875>>IF
      4875>>IF       4875>>IF       4875>>IF       4875>>IF       4875>>IF       4875>>IF       4940>>ASSIGN
      4943>>ASSIGN   4946>>ASSIGN   4950>>ASSIGN   4967>>ASSIGN   4968>>IF       4968>>IF       4970>>ASSIGN
      4977>>ASSIGN   4977>>ASSIGN   4978>>IF       4978>>ASSIGN   4978>>ASSIGN   4979>>IF       4979>>ASSIGN
      4979>>ASSIGN   4980>>IF       4980>>ASSIGN   4981>>IF       4981>>ASSIGN   4981>>ASSIGN   4982>>ASSIGN
      4983>>IF       4984>>ASSIGN   4985>>ASSIGN   4985>>ASSIGN   4986>>ASSIGN   4988>>ASSIGN   4988>>ASSIGN
      5004>>ASSIGN   5038>>ASSIGN   5041>>ASSIGN   5058>>ASSIGN   5060>>IF       5060>>ASSIGN   5060>>ASSIGN
      5076>>IF       5076>>IF       5081>>ASSIGN   5082>>IF       5083>>ASSIGN   5089>>IF       5090>>ASSIGN
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:378  
      5090>>ASSIGN   5091>>ASSIGN   5092>>ASSIGN   5092>>ASSIGN   5093>>IF       5094>>ASSIGN   5094>>ASSIGN
      5095>>ASSIGN   5095>>ASSIGN   5097>>ASSIGN   5097>>ASSIGN   5098>>ASSIGN   5099>>ASSIGN   5100>>ASSIGN
      5100>>ASSIGN   5103>>IF       5107>>ASSIGN   5107>>ASSIGN   5112>>ASSIGN   5112>>ASSIGN   5113>>ASSIGN
      5114>>IF       5115>>ASSIGN   5115>>ASSIGN   5116>>IF       5117>>ASSIGN   5117>>ASSIGN   5118>>IF
      5119>>ASSIGN   5119>>ASSIGN   5121>>ASSIGN   5121>>ASSIGN   5122>>DOINDEX  5123>>ASSIGN   5123>>ASSIGN
      5127>>ASSIGN   5649>>ASSIGN   5650>>IF       5650>>IF       5651>>ASSIGN   5651>>ASSIGN   5651>>ASSIGN
      5652>>ASSIGN   5652>>ASSIGN   5652>>ASSIGN   5654>>IF       5658>>IF       5658>>IF       5658>>IF
      5658>>IF       5658>>IF       5658>>IF       5660>>ASSIGN   5660>>ASSIGN   5661>>IF       5662>>ASSIGN
      5662>>ASSIGN   5664>>ASSIGN   5664>>ASSIGN   5665>>ASSIGN   5669>>IF       5669>>ASSIGN   5669>>ASSIGN
      5675>>IF       5675>>IF       5675>>IF       5683>>ASSIGN   5686>>ASSIGN   5686>>ASSIGN   5687>>ASSIGN
      5691>>ASSIGN   5692>>IF       5694>>IF       5708>>ASSIGN   5711>>ASSIGN   5726>>ASSIGN   5734>>IF
      5734>>IF       5740>>IF       5741>>ASSIGN   5762>>IF       5762>>ASSIGN   5763>>ASSIGN   5766>>IF
Y@REDLIN
      2467**DCL      3302<<ASSIGN   3419<<ASSIGN   3447<<ASSIGN   3695>>IF       3696>>ASSIGN   4119<<ASSIGN
      4121>>IF       4122>>IF       4123<<ASSIGN   4123>>ASSIGN   4125>>IF       4125>>IF       4125>>IF
      4131>>ASSIGN   4133>>DOWHILE  4142>>IF       4147<<ASSIGN   4152>>ASSIGN   4153>>ASSIGN   4156>>ASSIGN
      4163>>ASSIGN   4165>>ASSIGN   4178<<ASSIGN   4305<<ASSIGN   4334>>IF       4336>>ASSIGN   4337>>ASSIGN
      4533<<ASSIGN   4535<<ASSIGN   4535>>ASSIGN   4544>>IF       4544>>IF       4546<<ASSIGN   4552>>DOWHILE
      4554>>CALL     4556<<ASSIGN   4556>>ASSIGN   4783>>IF       4787>>DOUNTIL  4788>>IF       4789<<ASSIGN
      4789>>ASSIGN   4790>>CALL     4796>>IF       4800>>DOWHILE  4801>>CALL     4803<<ASSIGN   4803>>ASSIGN
      4804>>IF       4839<<ASSIGN   4840>>IF       4849<<ASSIGN   4851>>DOWHILE  4854<<ASSIGN   4854>>ASSIGN
      4855>>IF       4865<<ASSIGN   4865>>ASSIGN   4875>>IF
Y@SNDRCR IN PROCEDURE Y$UPDRCR
      5760**LABEL    5742--GOTO
Y@SRD$
      2462**DCL      1758--IMP-PTR  3298<<ASSIGN   3306>>ASSIGN   3307>>IF       3307>>ASSIGN   3311>>ASSIGN
      3313>>ASSIGN   3315>>IF       3315>>ASSIGN   3420>>ASSIGN   3421>>ASSIGN   3422>>ASSIGN   3422>>ASSIGN
      3423>>ASSIGN   3423>>ASSIGN   3424>>ASSIGN   3426>>IF       3426>>IF       3428>>ASSIGN   3439>>IF
      3448>>IF       3466>>ASSIGN   3466>>ASSIGN   3471>>IF       3480>>ASSIGN   3491>>IF       3500>>IF
      3504>>ASSIGN   3504>>ASSIGN   3505>>IF       3505>>IF       3505>>IF       3505>>IF       3507>>ASSIGN
      3507>>ASSIGN   3508>>ASSIGN   3508>>ASSIGN   3514>>ASSIGN   3518>>ASSIGN   3518>>ASSIGN   3528>>IF
      3538>>ASSIGN   3546>>ASSIGN   3546>>ASSIGN   3547>>ASSIGN   3548>>IF       3549>>ASSIGN   3549>>ASSIGN
      3550>>ASSIGN   3550>>ASSIGN   3551>>ASSIGN   3551>>ASSIGN   3552>>IF       3552>>IF       3553>>ASSIGN
      3553>>ASSIGN   3556>>ASSIGN   3556>>ASSIGN   3558>>ASSIGN   3558>>ASSIGN   3563>>ASSIGN   3564>>ASSIGN
      3564>>ASSIGN   3566>>ASSIGN   3568>>ASSIGN   3577>>IF       3577>>IF       3581>>ASSIGN   3581>>ASSIGN
      3584>>IF       3584>>IF       3584>>IF       3584>>IF       3586>>ASSIGN   3586>>ASSIGN   3587>>ASSIGN
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:379  
      3587>>ASSIGN   3591>>IF       3620>>IF       3620>>IF       3627>>IF       3627>>IF       3628>>ASSIGN
      3628>>ASSIGN   3628>>ASSIGN   3630>>ASSIGN   3632>>ASSIGN   3632>>ASSIGN   3634>>IF       3634>>IF
      3636>>ASSIGN   3636>>ASSIGN   3645>>IF       3645>>IF       3645>>IF       3645>>IF       3647>>ASSIGN
      3647>>ASSIGN   3648>>ASSIGN   3648>>ASSIGN   3649>>IF       3649>>IF       3651>>ASSIGN   3652>>ASSIGN
      3662>>IF       3663>>IF       3664>>ASSIGN   3668>>IF       3676>>ASSIGN   3676>>ASSIGN   3677>>IF
      3677>>IF       3677>>IF       3677>>IF       3679>>ASSIGN   3679>>ASSIGN   3680>>ASSIGN   3680>>ASSIGN
      3684>>IF       3693>>ASSIGN   3693>>ASSIGN   3696>>ASSIGN   3696>>ASSIGN   3697>>ASSIGN   3697>>ASSIGN
      3699>>ASSIGN   3699>>ASSIGN   3701>>IF       3707>>IF       3756>>ASSIGN   3756>>ASSIGN   3774>>IF
      3774>>IF       3778>>IF       3778>>IF       3778>>IF       3782>>ASSIGN   3786>>ASSIGN   3786>>ASSIGN
      3787>>ASSIGN   3787>>ASSIGN   3788>>ASSIGN   3788>>ASSIGN   3797>>IF       4342>>IF       4550>>ASSIGN
      4550>>ASSIGN   4551>>ASSIGN   4553>>IF       4555>>ASSIGN   4555>>ASSIGN   4630>>IF       4630>>IF
      4631>>ASSIGN   4631>>ASSIGN   4643>>ASSIGN   4665>>ASSIGN   4671>>ASSIGN   4676>>IF       4694>>ASSIGN
      4698>>ASSIGN   4701>>IF       4722>>ASSIGN   4723>>ASSIGN   4723>>ASSIGN   4726>>ASSIGN   4726>>ASSIGN
      4727>>ASSIGN   4727>>ASSIGN   4728>>ASSIGN   4728>>ASSIGN   4730>>ASSIGN   4735>>ASSIGN   4736>>IF
      4736>>IF       4748>>ASSIGN   4748>>ASSIGN   4750>>ASSIGN   4750>>ASSIGN   4751>>ASSIGN   4751>>ASSIGN
      4791>>ASSIGN   4791>>ASSIGN   4793>>IF       4793>>IF       4802>>ASSIGN   4802>>ASSIGN   4806>>IF
      4806>>IF       4810>>IF       4810>>IF       4817>>ASSIGN   4817>>ASSIGN   4820>>IF       4820>>IF
      4828>>ASSIGN   4828>>ASSIGN   4840>>IF       4840>>IF       4849>>ASSIGN   4851>>DOWHILE  4855>>IF
      4855>>IF       4855>>IF       4862>>IF       4862>>IF       4866>>ASSIGN   4866>>ASSIGN   4871>>IF
      4875>>IF       4926>>ASSIGN   4926>>ASSIGN   5078>>ASSIGN   5078>>ASSIGN   5091>>IF       5652>>ASSIGN
      5770>>IF       5770>>IF
Y@SRHCUR
      2475**DCL      3299<<ASSIGN   3300>>IF       3300>>IF       3301>>ASSIGN   3302>>ASSIGN   3361<<ASSIGN
      3375>>DOWHILE  3376<<ASSIGN   3376>>ASSIGN   3417<<ASSIGN   3445>>ASSIGN   3446>>IF       3474>>ASSIGN
      3476>>IF       3482>>IF       3483>>IF       3523<<ASSIGN   3523>>ASSIGN   3528>>IF       3528>>IF
      3532>>IF       3565>>IF       3591>>IF       3611>>IF       3661<<ASSIGN   3661>>ASSIGN   3662>>IF
      3712>>ASSIGN   3722<<ASSIGN   3724>>ASSIGN   3727<<ASSIGN   3729>>IF       3730<<ASSIGN   3731>>IF
      3732>>ASSIGN   3734<<ASSIGN   3734>>ASSIGN   3748<<ASSIGN   3749>>DOWHILE  3750>>ASSIGN   3758<<ASSIGN
      3758>>ASSIGN   3828>>IF       3837>>IF       3858>>ASSIGN   3865>>IF       3867>>IF       3869>>ASSIGN
      3898>>IF       3898>>IF       3911>>ASSIGN   3916<<ASSIGN   3916>>ASSIGN   3918>>IF       3918>>IF
      3918>>IF       3926>>ASSIGN   3939<<ASSIGN   3939>>ASSIGN   3942>>ASSIGN   3943>>IF       3949>>IF
      3968>>ASSIGN   3969>>ASSIGN   3975>>ASSIGN   3984>>IF       3993>>ASSIGN   3994>>ASSIGN   3996>>ASSIGN
      4038>>ASSIGN   4041>>ASSIGN   4043>>ASSIGN   4051>>ASSIGN   4147>>ASSIGN   4174>>ASSIGN   4178>>ASSIGN
      4185>>IF       4186>>IF       4191>>ASSIGN   4192>>IF       4217>>ASSIGN   4236<<ASSIGN   4236>>ASSIGN
      4238>>IF       4238>>IF       4241>>IF       4241>>IF       4283>>ASSIGN   4285>>ASSIGN   4298>>ASSIGN
      4304<<ASSIGN   4304>>ASSIGN   4305>>ASSIGN   4306>>ASSIGN   4367<<ASSIGN   4367>>ASSIGN   4371>>DOWHILE
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:380  
      4378>>IF       4381<<ASSIGN   4381>>ASSIGN   4407>>IF       4408>>IF       4409<<ASSIGN   4409>>ASSIGN
      4410>>ASSIGN   4412>>IF       4412>>IF       4413>>IF       4414>>ASSIGN   4420>>ASSIGN   4424>>IF
      4428>>ASSIGN   4466>>IF       4469>>DOWHILE  4470>>IF       4471<<ASSIGN   4471>>ASSIGN   4473>>IF
      4473>>IF       4475>>ASSIGN   4609<<ASSIGN   4610>>ASSIGN   4611>>IF       4699<<ASSIGN   4701>>IF
      4703>>IF       4704>>ASSIGN   4746<<ASSIGN   4746>>ASSIGN   4940>>ASSIGN   4943>>ASSIGN   4946>>ASSIGN
      4950>>ASSIGN   4967>>ASSIGN   4968>>IF       4968>>IF       4978>>IF       4979>>IF       4980>>IF
      4981>>IF       4985>>IF       4986>>ASSIGN   4988>>ASSIGN   4988>>ASSIGN   5006<<ASSIGN   5007>>IF
      5012<<ASSIGN   5012>>ASSIGN   5015<<ASSIGN   5019<<ASSIGN   5021>>ASSIGN   5022>>ASSIGN   5024<<ASSIGN
      5071>>IF       5076>>IF       5076>>IF       5088<<ASSIGN   5088>>ASSIGN   5103>>IF       5114>>IF
      5116>>IF       5118>>IF       5120>>IF       5122>>DOINDEX  5127>>ASSIGN   5726>>ASSIGN   5734>>IF
      5748>>ASSIGN   5762>>ASSIGN
Y@SRHHI
      2469**DCL      2470--REDEF    2471--REDEF    2472--REDEF    4551<<ASSIGN   4553>>IF       4850<<ASSIGN
      4852>>IF       4853>>CALL     4869<<ASSIGN   4869>>ASSIGN   5004<<ASSIGN   5006>>ASSIGN   5018>>DOWHILE
      5019>>ASSIGN   5022<<ASSIGN   5024>>ASSIGN
Y@SRHLO
      2473**DCL      2474--REDEF    3564<<ASSIGN   3566<<ASSIGN   3566>>ASSIGN   3568>>ASSIGN   3569<<ASSIGN
      3569>>ASSIGN   3570>>ASSIGN   3571>>IF       3576>>ASSIGN   3578>>ASSIGN   3618<<ASSIGN   3619>>IF
      3622>>IF       3628<<ASSIGN   3631>>ASSIGN   3632>>ASSIGN   3633>>ASSIGN   3637<<ASSIGN   3640>>IF
      3648<<ASSIGN   3649>>IF       3651>>ASSIGN   3656>>ASSIGN   3821<<ASSIGN   3894>>DOUNTIL  4100<<ASSIGN
      4101>>DOWHILE  4102<<ASSIGN   4102>>ASSIGN   4103>>IF       4105>>ASSIGN   4106>>ASSIGN   4107>>IF
      4107>>IF       4107>>IF       4107>>IF       4111<<ASSIGN   4111>>ASSIGN   4112<<ASSIGN   4112>>ASSIGN
      4114<<ASSIGN   4115>>ASSIGN   4117>>ASSIGN   4153>>ASSIGN   4155>>ASSIGN   4156<<ASSIGN   4157>>DOUNTIL
      4158>>IF       4159<<ASSIGN   4159>>ASSIGN   4161>>IF       4162>>ASSIGN   4163>>ASSIGN   4199<<ASSIGN
      4209<<ASSIGN   4209>>ASSIGN   4210>>IF       4211<<ASSIGN   4712<<ASSIGN   4723<<ASSIGN   4736>>IF
      4782<<ASSIGN   4816<<ASSIGN   4816>>ASSIGN   4826<<ASSIGN   4826>>ASSIGN   4867<<ASSIGN   4867>>ASSIGN
      4871>>IF       4872>>ASSIGN   5005<<ASSIGN   5015>>ASSIGN   5018>>DOWHILE  5019>>ASSIGN   5021<<ASSIGN
Y@SSN$
      2463**DCL      2036--IMP-PTR  3295<<ASSIGN   3332>>ASSIGN   3341>>IF       3341>>IF       3390>>IF
      3391>>ASSIGN   3611>>IF       3611>>IF       3613>>ASSIGN   3614>>ASSIGN   3615>>ASSIGN   3615>>ASSIGN
      3700>>IF       3705>>ASSIGN   3707>>IF       3817>>ASSIGN   3819>>IF       3838>>IF       3838>>IF
      3841>>ASSIGN   3841>>ASSIGN   3842>>ASSIGN   3915>>IF       3915>>IF       3917>>IF       3917>>IF
      3918>>IF       3921>>IF       3921>>IF       3922>>ASSIGN   3922>>ASSIGN   3923>>ASSIGN   3924>>ASSIGN
      3924>>ASSIGN   3932>>IF       3955>>ASSIGN   3982>>ASSIGN   3998>>ASSIGN   3999>>IF       4002>>ASSIGN
      4002>>ASSIGN   4055>>IF       4055>>IF       4056>>ASSIGN   4056>>ASSIGN   4057>>ASSIGN   4058>>ASSIGN
      4058>>ASSIGN   4073>>ASSIGN   4074>>IF       4075>>ASSIGN   4083>>ASSIGN   4092>>DOWHILE  4098>>ASSIGN
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:381  
      4100>>ASSIGN   4153>>ASSIGN   4155>>ASSIGN   4186>>IF       4221>>ASSIGN   4245>>IF       4245>>IF
      4249>>ASSIGN   4249>>ASSIGN   4258>>ASSIGN   4258>>ASSIGN   4282>>ASSIGN   4300>>ASSIGN   4300>>ASSIGN
      4301>>ASSIGN   4301>>ASSIGN   4302>>ASSIGN   4302>>ASSIGN   4303>>ASSIGN   4303>>ASSIGN   4491>>IF
      4491>>IF       4576>>IF       4618>>ASSIGN   4644>>ASSIGN   4655>>IF       4689>>ASSIGN   4691>>ASSIGN
      5727>>ASSIGN   5728>>IF       5730>>IF       5745>>ASSIGN   5756>>ASSIGN   5759>>ASSIGN   5766>>IF
Y@STR$
      2464**DCL      2114--IMP-PTR  3297<<ASSIGN   3332>>ASSIGN   3341>>IF       3341>>IF       3341>>IF
      3341>>IF       3351>>ASSIGN   3373>>ASSIGN   3390>>IF       3611>>IF       3700>>IF       3817>>ASSIGN
      3831>>ASSIGN   3842>>ASSIGN   3847>>ASSIGN   3890>>ASSIGN   3906>>ASSIGN   3923>>ASSIGN   3988>>ASSIGN
      4023>>IF       4024>>ASSIGN   4033>>ASSIGN   4039>>IF       4052>>IF       4057>>ASSIGN   4066>>IF
      4072>>ASSIGN   4075>>ASSIGN   4080>>IF       4080>>IF       4081>>ASSIGN   4094>>ASSIGN   4114>>ASSIGN
      4125>>IF       4125>>IF       4137>>ASSIGN   4175>>IF       4221>>ASSIGN   4222>>ASSIGN   4244>>IF
      4247>>ASSIGN   4267>>ASSIGN   4267>>ASSIGN   4273>>ASSIGN   4273>>ASSIGN   4273>>ASSIGN   4274>>ASSIGN
      4275>>ASSIGN   4282>>ASSIGN   4282>>ASSIGN   4286>>IF       4296>>ASSIGN   4296>>ASSIGN   4307>>IF
      4321>>IF       4321>>IF       4321>>IF       4323>>ASSIGN   4323>>ASSIGN   4325>>ASSIGN   4333>>IF
      4400>>ASSIGN   4464>>ASSIGN   4506>>ASSIGN   4562>>IF       4581>>IF       4589>>ASSIGN   4594>>ASSIGN
      4613>>ASSIGN   4626>>IF       4628>>ASSIGN   4628>>ASSIGN   4635>>ASSIGN   4640>>IF       5059>>ASSIGN
      5061>>IF       5647>>ASSIGN   5682>>IF       5682>>ASSIGN   5696>>IF       5697>>ASSIGN   5699>>ASSIGN
      5702>>IF       5705>>ASSIGN   5706>>ASSIGN   5764>>IF
Y@TMP32
      2476**DCL      2477--REDEF    4946<<ASSIGN   4947<<ASSIGN   4947>>ASSIGN   4950<<ASSIGN
Y@TMP32B.BTM
      2479**DCL      3871<<ASSIGN   3873>>ASSIGN   3874<<ASSIGN   3878<<ASSIGN   3878>>ASSIGN   3879>>IF
      3880>>IF       3881<<ASSIGN   3881>>ASSIGN   3885<<ASSIGN   3885>>ASSIGN   3886>>IF       3887>>IF
      3887>>IF       3890>>ASSIGN   3894>>DOUNTIL  3895>>IF       3902<<ASSIGN   3902>>ASSIGN   3903<<ASSIGN
      3903>>ASSIGN   3906>>ASSIGN   4198>>ASSIGN   4954>>IF       4955>>ASSIGN
Y@TMP32B.TOP
      2478**DCL      3870<<ASSIGN   3871>>ASSIGN   3873<<ASSIGN   3880>>IF       3886>>IF       3887>>IF
      3890>>ASSIGN   3895>>IF       4197>>IF       4953>>IF       4953>>ASSIGN   5040<<ASSIGN   5071>>ASSIGN
      5092>>ASSIGN
Y@UN_SCR IN PROCEDURE Y$UPDRCR
      5764**LABEL    5740--GOTO
Y@VRTLIN
      2471**DCL      3416<<ASSIGN   3447>>ASSIGN   3480>>ASSIGN   3504>>ASSIGN   3528>>IF       3528>>IF
      3546>>ASSIGN   3557>>IF       3660<<ASSIGN   3660>>ASSIGN   3662>>IF       3663>>IF       3664>>ASSIGN
      3668>>IF       3676>>ASSIGN
PL6.E3A0      #001=KVE$SE File=KVE$SE.:E05TSI                                    WED 07/30/97 01:56 Page:382  
Y@VRTSCRMRG
      2480**DCL      3304<<ASSIGN   3305>>IF       3306<<ASSIGN   3306>>ASSIGN   3307>>IF       3307<<ASSIGN
      3308>>IF       3308<<ASSIGN   3311>>ASSIGN   3314>>ASSIGN   4551>>ASSIGN   4793>>IF       4806>>IF
Y@VRTSCRSHF
      2481**DCL      3309<<ASSIGN   3310>>IF       3311<<ASSIGN   3311>>ASSIGN   3313>>IF       3313<<ASSIGN
      3314<<ASSIGN   3314>>ASSIGN   3315>>IF       3315<<ASSIGN   3320>>IF       3320<<ASSIGN   3320>>ASSIGN
      4810>>IF       4820>>IF       4855>>IF
Y_BIGKEY
      3027**DCL      4184--ASSIGN
Y_ERR IN PROCEDURE Y$SNDNEED
      5198**DCL      5704>>ASSIGN
Y_KEY IN PROCEDURE Y$SNDNEED
      5630**DCL      5710>>ASSIGN
Y_LTLKEY
      3026**DCL      3524--ASSIGN   4603--ASSIGN
Y_VDH_GETBFR
      2988**DCL      3374>>ASSIGN   3418>>ASSIGN   3752>>ASSIGN   4370>>ASSIGN   5036>>ASSIGN
Y_VDH_OTPLCL
      2924**DCL      3409>>ASSIGN   4692>>ASSIGN
