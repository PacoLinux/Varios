
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:1    
        1        1        /*M*  ZIO$DBREAD - obtains data-base page requested from the 'in-core'
        2        2                          buffer pool.  If this page doesn't currently exist
        3        3                          in the pool, it is read from the file system.  */
        4        4        /*T***********************************************************/
        5        5        /*T*                                                         */
        6        6        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        7        7        /*T*                                                         */
        8        8        /*T***********************************************************/
        9        9        ZIO$DBREAD: PROC ALTRET
       10       10         /* USE($PR5 FOR GLOBAL$) */
       11       11               AVOID($PR5,$PR6,$PR7);
       12       12    1   DCL B$TCB$ PTR SYMREF;
       13       13    1   DCL ZIB$DBINP ENTRY;
       14       14    1   DCL ZIM$TRACE ENTRY;
       15       15    1   DCL ZIM$ICKSM ENTRY;
       16       16    1   DCL ZIO$GETBUF ENTRY ALTRET;
       17       17    1   DCL ZIO$GETSLOT ENTRY ALTRET;
       18       18    1   DCL ZIO$CHKBUSY ENTRY ALTRET;
       19       19    1   DCL ZIM$ENQM ENTRY(1) ALTRET;
       20       20    1   DCL ZIM$ENQ_FIND ENTRY ALTRET;
       21       21    1   DCL ZIM$PROL ENTRY ALTRET;
       22       22    1   DCL FPT$ PTR;
       23       23    1   DCL ONEWORD UBIN(36) BASED;
       24       24    1   DCL ERROR UBIN(36);
       25       25    1   DCL X UBIN(36); /* number of zero's */
       26       26    1   DCL Y UBIN(9); /* length of errfield_insert.text */
       27       27        %INCLUDE CP_6;
       28      108        %FPT_READ (FPTN=FPT$READD, STCLASS="BASED(FPT$)");
       29      147         %FPT_ENQ(FPTN=FPT$ENQ,STCLASS=BASED);
       30      165         %FPT_WAIT(STCLASS=SYMREF);
       31      179        %INCLUDE CP_6_SUBS;
       32      719        %B$TCB;
       33      722        %B$ALT;
       34      730        %F$DCB;
       35      787        %SUB_EXC;
       36      834        %INCLUDE B_ERRORS_C;
       37     1961        %INCLUDE ZI$GLOBAL;
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:2    
       38     2447        %GLOBALS;
       39     2755        %BUFFERS;
       40     2770        %TRCE_SUBS;
       41     2794        %ENQLIST;
       42     2812        %INCLUDE ZI$DBCB;
       43     3454        %AWS;
       44     3494        %INCLUDE ZI_ERRORS_C;
       45     3820    1   DCL INDX SBIN ALIGNED; /* LOCAL INDEX VARIABLE */
       46     3821    1   DCL PRESLOT SBIN ALIGNED;
       47     3822    1   DCL 1 CLEAR12 ALIGNED BASED,
       48     3823    1         2 * CHAR(48);
       49     3824        %EJECT;
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:3    
       50     3825    1       GLOBAL.STATS.CURR.REQS=GLOBAL.STATS.CURR.REQS+1;
       51     3826    1       AWS$=GLOBAL.PARAN.IO.AWS$;
       52     3827    1       IF AWS.ATRIB.CAC=%YES# AND
       53     3828    2          (AWS.FIPN=0 OR GLOBAL.PARAN.IO.PGNO<AWS.FIPN) THEN DO;
       54     3829        /*          Concurrent access control and not inventory page. */
       55     3830    2           GLOBAL.ENQ.VALUE.DCB#=AWS.DDCB;
       56     3831    2           GLOBAL.ENQ.VALUE.RNAME=GLOBAL.PARAN.IO.PGNO;
       57     3832    2           GLOBAL.ENQ.SHARE = %ALL#;
       58     3833    2           CALL ZIM$ENQM ALTRET(ALT);
       59     3834    2           ENQLIST$=GLOBAL.ENQ.LIST.BASE$;
       60     3835
       61     3836    2           GLOBAL.BCB.SLOT=ENQLIST.BUFSLOT(GLOBAL.ENQ.LIST.INDX);
       62     3837    3           IF GLOBAL.BCB.SLOT=0 THEN DO;
       63     3838        /*              No buffer.  No need to search BCB list. */
       64     3839                    %DBCAL(NAME=ZIO$GETSLOT,EXC=EXC_GETB,ALT=ER_GETB);
       65     3855        /*
       66     3856                        ZIO$GETBUF may destroy ENQ.LIST.INDX if a buffer
       67     3857                        needs to be cleared and it was operating under
       68     3858                        currencies only.  Therefore refind the ENQ
       69     3859                        entry here.
       70     3860        */
       71     3861    3               CALL ZIM$ENQ_FIND ALTRET(ALT);
       72     3862        /*              Link up BCB and ENQLIST. */
       73     3863    3               GLOBAL.BCB.BUF.ENQINDX(GLOBAL.BCB.SLOT)=GLOBAL.ENQ.LIST.INDX;
       74     3864    3               ENQLIST.BUFSLOT(GLOBAL.ENQ.LIST.INDX)=GLOBAL.BCB.SLOT;
       75     3865    3               END;
       76     3866    3           ELSE DO;
       77     3867        /*              Have slot.  Just check if busy or not. */
       78     3868                    %DBCAL(NAME=ZIO$CHKBUSY,ALT=ER_GETB);
       79     3884    3               GOTO BUFHIT;
       80     3885    3               END;
       81     3886    2           END;
       82     3887    2       ELSE DO;
       83     3888        /*          No hint.  Must do full search. */
       84     3889                %DBCAL(NAME=ZIO$GETBUF,EXC=BUFHIT,ALT=ER_GETB);
       85     3905    2           END;
       86     3906
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:4    
       87     3907    1       FPT$=GLOBAL.READD$;
       88     3908    1       FPT$READD.BUF_.BUF$=PINCRW(GLOBAL.PARAN.IO.BUF$,-3);
       89     3909    1   /*DIAG*/ FPT$READD.BUF_.BUF$->CLEAR12 = '0'B;
       90     3910    1       FPT$READD.V.DCB# = AWS.DDCB;
       91     3911    1       FPT$READD.V.SEED#=AWS.ENCRP;
       92     3912        /*     Read the data base page.              */
       93     3913    1       GLOBAL.GRANULE=GLOBAL.PARAN.IO.PGNO;
       94     3914    1       CALL M$READ (FPT$READD) ALTRET(RDD_ERR);
       95     3915    2       IF GLOBAL.PARAN.TRACE.MODE~='0'B THEN DO;
       96     3916    2           IF NOT AWS.ATRIB.CAC THEN
       97     3917        /*N*                If no CAC or ENQ already existed. */
       98     3918    2               GLOBAL.PARAN.TRACE.TYPE=TR#PREAD;
       99     3919    2           ELSE
      100     3920    2               GLOBAL.PARAN.TRACE.TYPE=TR#PREADENQ;
      101     3921    2           GLOBAL.PARAN.TRACE.PDCB=AWS.DDCB;
      102     3922    2           GLOBAL.PARAN.TRACE.PNO=GLOBAL.PARAN.IO.PGNO;
      103     3923    2           CALL ZIM$TRACE;
      104     3924    2           END;
      105     3925    1       IF AWS.ATRIB.CHKSUM THEN
      106     3926    2       DO;
      107     3927    2           GLOBAL.PARAN.ICKSM.P$=FPT$READD.BUF_.BUF$;
      108     3928    2           CALL ZIM$ICKSM;
      109     3929    2           IF GLOBAL.PARAN.ICKSM.V~=
      110     3930    3   /* DIAG */ PINCRW(GLOBAL.PARAN.ICKSM.P$,2)->ONEWORD THEN DO;
      111     3931    3   /*DIAG */   INDX = GLOBAL.BCB.TAIL;
      112     3932    4   /*DIAG */   DO WHILE (GLOBAL.PARAN.IO.BUF$ =
      113     3933    4   /*DIAG */ GLOBAL.BCB.BUF.BUF$(INDX));
      114     3934    4   /*DIAG */       INDX = GLOBAL.BCB.BUF.LINK(INDX);
      115     3935    4   /*DIAG */       END;
      116     3936    3   /*DIAG */   FPT$READD.BUF_.BUF$ = PINCRW(GLOBAL.BCB.BUF.BUF$(INDX), -3);
      117     3937    3   /*DIAG*/    CALL M$READ(FPT$READD);
      118     3938    3               GOTO ER_CKSM;
      119     3939    3   /*DIAG*/    END;
      120     3940    2           END;
      121     3941    1   READ_DONE:
      122     3942    1       PINCRW(GLOBAL.PARAN.IO.BUF$,-3)->BLOCK.PSTAMP=GLOBAL.BCB.SLOT;
      123     3943    1       GLOBAL.STATS.CURR.READS=GLOBAL.STATS.CURR.READS+1;
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:5    
      124     3944    1       RETURN;
      125     3945    1   BUFHIT: GLOBAL.STATS.CURR.HITS=GLOBAL.STATS.CURR.HITS+1;
      126     3946    1       RETURN;
      127     3947        %EJECT;
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:6    
      128     3948        /*             Can't read page from file system            */
      129     3949    1   RDD_ERR:
      130     3950        /* Verify failure                                          */
      131     3951    1       IF AWS.ATRIB.ATMP=%YES# AND
      132     3952    1          B$TCB$->B$TCB.ALT$->B$ALT.ERR.ERR#=%E$DI THEN
      133     3953    2       DO;
      134     3954    2           CALL ZIB$DBINP;
      135     3955    2           GOTO READ_DONE;
      136     3956    2           END;
      137     3957    2       ELSE DO;
      138     3958        /* error reading page, give alternate return.              */
      139     3959    2           ERROR=ERR#IO#RDD;
      140     3960    2           GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      141     3961    2           GLOBAL.RET.DCB#=GLOBAL.READD$->FPT$READD.V.DCB#;
      142     3962    2           GOTO DBALT;
      143     3963    2           END;
      144     3964    1   ER_CKSM:
      145     3965    1       IF GLOBAL.GRANULE=0 THEN
      146     3966    1           GOTO READ_DONE;
      147     3967    1       CALL BINCHAR(GLOBAL.ERRFIELD_INSERT.TEXT(1),GLOBAL.PARAN.IO.PGNO);
      148     3968    1       X = 0;
      149     3969    1       Y = 0;
      150     3970    2       DO WHILE (SUBSTR(GLOBAL.ERRFIELD_INSERT.TEXT(1),X,1)='0');
      151     3971    2           X = X + 1;
      152     3972    2           END;
      153     3973    1       Y = 31 - X;
      154     3974    1       GLOBAL.ERRFIELD_INSERT.TEXT(1) = SUBSTR(GLOBAL.ERRFIELD_INSERT.TEXT(1),X,Y);
      155     3975    1       GLOBAL.ERRFIELD_INSERT.LENGTH(1) = Y;
      156     3976    1       ERROR=ERR#IO#CKSM;
      157     3977    1   DBALT: ;
      158     3978            %DBALT;
      159     3992    1   ER_GETB: ;
      160     3993    1   EXC_GETB: /* ENQ LIST AND BUF MAN DO NOT AGREE */
      161     3994    1       ERROR=ERR#BM#E02;
      162     3995    1       GOTO DBALT;
      163     3996    1   ALT:ALTRETURN;
      164     3997    1   END ZIO$DBREAD;
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:7    
      165     3998        %EOD;

PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:8    
--  Include file information  --

   ZI_ERRORS_C.:ZIC0TOU  is referenced.
   ZI$DBCB.:ZIC0TOU  is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIO$DBREAD.

   Procedure ZIO$DBREAD requires 258 words for executable code.
   Procedure ZIO$DBREAD requires 14 words of local(AUTO) storage.

PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:9    

 Object Unit name= ZIO$DBREAD                                 File name= ZIM$RDWRT.:ZIC0TOU
 UTS= SEP 05 '97 13:05:25.04 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Proc  even  none   258    402  ZIO$DBREAD
    2  RoData even  none     3      3  ZIO$DBREAD

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      XStd       0  ZIO$DBREAD

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           XStd      1 ZIM$ENQM
         yes           XStd      0 ZIB$DBINP
 yes     yes           XStd      0 ZIO$GETSLOT
         yes           XStd      0 ZIM$TRACE
         yes           XStd      0 ZIB$ERR
 yes     yes           XStd      0 ZIM$ENQ_FIND
 yes     yes           XStd      0 ZIO$CHKBUSY
 yes     yes           XStd      0 ZIO$GETBUF
         yes           XStd      0 ZIM$ICKSM
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:10   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$TCB$                                M$UC                                  FPT_WAIT
r    GLOBAL$
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:11   


        1        1        /*M*  ZIO$DBREAD - obtains data-base page requested from the 'in-core'
        2        2                          buffer pool.  If this page doesn't currently exist
        3        3                          in the pool, it is read from the file system.  */
        4        4        /*T***********************************************************/
        5        5        /*T*                                                         */
        6        6        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        7        7        /*T*                                                         */
        8        8        /*T***********************************************************/
        9        9        ZIO$DBREAD: PROC ALTRET

      9  1 000000   000000 700200 xent  ZIO$DBREAD   TSX0  ! X66_AUTO_0
         1 000001   000016 000000                    ZERO    14,0

       10       10         /* USE($PR5 FOR GLOBAL$) */
       11       11               AVOID($PR5,$PR6,$PR7);
       12       12    1   DCL B$TCB$ PTR SYMREF;
       13       13    1   DCL ZIB$DBINP ENTRY;
       14       14    1   DCL ZIM$TRACE ENTRY;
       15       15    1   DCL ZIM$ICKSM ENTRY;
       16       16    1   DCL ZIO$GETBUF ENTRY ALTRET;
       17       17    1   DCL ZIO$GETSLOT ENTRY ALTRET;
       18       18    1   DCL ZIO$CHKBUSY ENTRY ALTRET;
       19       19    1   DCL ZIM$ENQM ENTRY(1) ALTRET;
       20       20    1   DCL ZIM$ENQ_FIND ENTRY ALTRET;
       21       21    1   DCL ZIM$PROL ENTRY ALTRET;
       22       22    1   DCL FPT$ PTR;
       23       23    1   DCL ONEWORD UBIN(36) BASED;
       24       24    1   DCL ERROR UBIN(36);
       25       25    1   DCL X UBIN(36); /* number of zero's */
       26       26    1   DCL Y UBIN(9); /* length of errfield_insert.text */
       27       27        %INCLUDE CP_6;
       28      108        %FPT_READ (FPTN=FPT$READD, STCLASS="BASED(FPT$)");
       29      147         %FPT_ENQ(FPTN=FPT$ENQ,STCLASS=BASED);
       30      165         %FPT_WAIT(STCLASS=SYMREF);
       31      179        %INCLUDE CP_6_SUBS;
       32      719        %B$TCB;
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:12   
       33      722        %B$ALT;
       34      730        %F$DCB;
       35      787        %SUB_EXC;
       36      834        %INCLUDE B_ERRORS_C;
       37     1961        %INCLUDE ZI$GLOBAL;
       38     2447        %GLOBALS;
       39     2755        %BUFFERS;
       40     2770        %TRCE_SUBS;
       41     2794        %ENQLIST;
       42     2812        %INCLUDE ZI$DBCB;
       43     3454        %AWS;
       44     3494        %INCLUDE ZI_ERRORS_C;
       45     3820    1   DCL INDX SBIN ALIGNED; /* LOCAL INDEX VARIABLE */
       46     3821    1   DCL PRESLOT SBIN ALIGNED;
       47     3822    1   DCL 1 CLEAR12 ALIGNED BASED,
       48     3823    1         2 * CHAR(48);
       49     3824        %EJECT;
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:13   
       50     3825    1       GLOBAL.STATS.CURR.REQS=GLOBAL.STATS.CURR.REQS+1;

   3825  1 000002   000000 470400 xsym               LDP0    GLOBAL$
         1 000003   001423 235100                    LDA     787,,PR0
         1 000004   000001 035007                    ADLA    1,DL
         1 000005   001423 755100                    STA     787,,PR0

       51     3826    1       AWS$=GLOBAL.PARAN.IO.AWS$;

   3826  1 000006   000020 236100                    LDQ     16,,PR0
         1 000007   200010 756100                    STQ     AWS$,,AUTO

       52     3827    1       IF AWS.ATRIB.CAC=%YES# AND

   3827  1 000010   200010 471500                    LDP1    AWS$,,AUTO
         1 000011   100000 236100                    LDQ     0,,PR1
         1 000012   000001 316003                    CANQ    1,DU
         1 000013   000112 600000 1                  TZE     s:3893
         1 000014   100005 235100                    LDA     5,,PR1
         1 000015   000022 600000 1                  TZE     s:3830
         1 000016   000021 236100                    LDQ     17,,PR0
         1 000017   000112 604000 1                  TMI     s:3893
         1 000020   100005 116100                    CMPQ    5,,PR1
         1 000021   000112 605000 1                  TPL     s:3893

       53     3828    2          (AWS.FIPN=0 OR GLOBAL.PARAN.IO.PGNO<AWS.FIPN) THEN DO;

       54     3829        /*          Concurrent access control and not inventory page. */
       55     3830    2           GLOBAL.ENQ.VALUE.DCB#=AWS.DDCB;

   3830  1 000022   100006 220100                    LDX0    6,,PR1
         1 000023   001407 440100                    SXL0    775,,PR0

       56     3831    2           GLOBAL.ENQ.VALUE.RNAME=GLOBAL.PARAN.IO.PGNO;

   3831  1 000024   000021 235100                    LDA     17,,PR0
         1 000025   001410 755100                    STA     776,,PR0
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:14   

       57     3832    2           GLOBAL.ENQ.SHARE = %ALL#;

   3832  1 000026   001000 236003                    LDQ     512,DU
         1 000027   001407 552140                    STBQ    775,'40'O,PR0

       58     3833    2           CALL ZIM$ENQM ALTRET(ALT);

   3833  1 000030   000000 631400 2                  EPPR1   0
         1 000031   000000 701000 xent               TSX1    ZIM$ENQM
         1 000032   000401 702000 1                  TSX2    ALT

       59     3834    2           ENQLIST$=GLOBAL.ENQ.LIST.BASE$;

   3834  1 000033   000000 470400 xsym               LDP0    GLOBAL$
         1 000034   001411 236100                    LDQ     777,,PR0
         1 000035   200007 756100                    STQ     ENQLIST$,,AUTO

       60     3835
       61     3836    2           GLOBAL.BCB.SLOT=ENQLIST.BUFSLOT(GLOBAL.ENQ.LIST.INDX);

   3836  1 000036   001412 220100                    LDX0    778,,PR0
         1 000037   001412 020100                    ADLX0   778,,PR0
         1 000040   200007 471500                    LDP1    ENQLIST$,,AUTO
         1 000041   100000 236110                    LDQ     0,X0,PR1
         1 000042   000022 772000                    QRL     18
         1 000043   000777 376007                    ANQ     511,DL
         1 000044   000200 756100                    STQ     128,,PR0

       62     3837    3           IF GLOBAL.BCB.SLOT=0 THEN DO;

   3837  1 000045   000103 601000 1                  TNZ     s:3872

       63     3838        /*              No buffer.  No need to search BCB list. */
       64     3839                    %DBCAL(NAME=ZIO$GETSLOT,EXC=EXC_GETB,ALT=ER_GETB);

   3843  1 000046   000000 631400 2                  EPPR1   0
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:15   
         1 000047   000000 701000 xent               TSX1    ZIO$GETSLOT
         1 000050   000376 702000 1                  TSX2    ER_GETB

   3844  1 000051   000000 470400 xsym               LDP0    GLOBAL$
         1 000052   000006 235100                    LDA     6,,PR0
         1 000053   000056 600000 1                  TZE     s:3861

   3849  1 000054   000006 450100                    STZ     6,,PR0

   3850  1 000055   000376 710000 1                  TRA     ER_GETB

       65     3855        /*
       66     3856                        ZIO$GETBUF may destroy ENQ.LIST.INDX if a buffer
       67     3857                        needs to be cleared and it was operating under
       68     3858                        currencies only.  Therefore refind the ENQ
       69     3859                        entry here.
       70     3860        */
       71     3861    3               CALL ZIM$ENQ_FIND ALTRET(ALT);

   3861  1 000056   000000 631400 2                  EPPR1   0
         1 000057   000000 701000 xent               TSX1    ZIM$ENQ_FIND
         1 000060   000401 702000 1                  TSX2    ALT

       72     3862        /*              Link up BCB and ENQLIST. */
       73     3863    3               GLOBAL.BCB.BUF.ENQINDX(GLOBAL.BCB.SLOT)=GLOBAL.ENQ.LIST.INDX;

   3863  1 000061   000000 470400 xsym               LDP0    GLOBAL$
         1 000062   000200 236100                    LDQ     128,,PR0
         1 000063   000005 402007                    MPY     5,DL
         1 000064   000000 620006                    EAX0    0,QL
         1 000065   001412 236100                    LDQ     778,,PR0
         1 000066   000022 772000                    QRL     18
         1 000067   000206 676110                    ERQ     134,X0,PR0
         1 000070   077777 376007                    ANQ     32767,DL
         1 000071   000206 656110                    ERSQ    134,X0,PR0

       74     3864    3               ENQLIST.BUFSLOT(GLOBAL.ENQ.LIST.INDX)=GLOBAL.BCB.SLOT;
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:16   

   3864  1 000072   001412 220100                    LDX0    778,,PR0
         1 000073   001412 020100                    ADLX0   778,,PR0
         1 000074   200007 471500                    LDP1    ENQLIST$,,AUTO
         1 000075   000200 236100                    LDQ     128,,PR0
         1 000076   000022 736000                    QLS     18
         1 000077   100000 676110                    ERQ     0,X0,PR1
         1 000100   000777 376003                    ANQ     511,DU
         1 000101   100000 656110                    ERSQ    0,X0,PR1

       75     3865    3               END;

   3865  1 000102   000122 710000 1                  TRA     s:3907

       76     3866    3           ELSE DO;

       77     3867        /*              Have slot.  Just check if busy or not. */
       78     3868                    %DBCAL(NAME=ZIO$CHKBUSY,ALT=ER_GETB);

   3872  1 000103   000000 631400 2                  EPPR1   0
         1 000104   000000 701000 xent               TSX1    ZIO$CHKBUSY
         1 000105   000376 702000 1                  TSX2    ER_GETB

   3873  1 000106   000000 470400 xsym               LDP0    GLOBAL$
         1 000107   000006 235100                    LDA     6,,PR0
         1 000110   000376 601000 1                  TNZ     ER_GETB

       79     3884    3               GOTO BUFHIT;

   3884  1 000111   000255 710000 1                  TRA     BUFHIT

       80     3885    3               END;
       81     3886    2           END;
       82     3887    2       ELSE DO;

       83     3888        /*          No hint.  Must do full search. */
       84     3889                %DBCAL(NAME=ZIO$GETBUF,EXC=BUFHIT,ALT=ER_GETB);
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:17   

   3893  1 000112   000000 631400 2                  EPPR1   0
         1 000113   000000 701000 xent               TSX1    ZIO$GETBUF
         1 000114   000376 702000 1                  TSX2    ER_GETB

   3894  1 000115   000000 470400 xsym               LDP0    GLOBAL$
         1 000116   000006 235100                    LDA     6,,PR0
         1 000117   000122 600000 1                  TZE     s:3907

   3899  1 000120   000006 450100                    STZ     6,,PR0

   3900  1 000121   000255 710000 1                  TRA     BUFHIT

       85     3905    2           END;
       86     3906
       87     3907    1       FPT$=GLOBAL.READD$;

   3907  1 000122   005073 236100                    LDQ     2619,,PR0
         1 000123   200003 756100                    STQ     FPT$,,AUTO

       88     3908    1       FPT$READD.BUF_.BUF$=PINCRW(GLOBAL.PARAN.IO.BUF$,-3);

   3908  1 000124   000022 236100                    LDQ     18,,PR0
         1 000125   777775 036003                    ADLQ    -3,DU
         1 000126   200003 471500                    LDP1    FPT$,,AUTO
         1 000127   100005 756100                    STQ     5,,PR1

       89     3909    1   /*DIAG*/ FPT$READD.BUF_.BUF$->CLEAR12 = '0'B;

   3909  1 000130   100005 473500                    LDP3    5,,PR1
         1 000131   000100 100400                    MLR     fill='000'O
         1 000132   000000 000001 2                  ADSC9   0                        cn=0,n=1
         1 000133   300000 000060                    ADSC9   0,,PR3                   cn=0,n=48

       90     3910    1       FPT$READD.V.DCB# = AWS.DDCB;

   3910  1 000134   200010 473500                    LDP3    AWS$,,AUTO
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:18   
         1 000135   300006 220100                    LDX0    6,,PR3
         1 000136   100010 740100                    STX0    8,,PR1

       91     3911    1       FPT$READD.V.SEED#=AWS.ENCRP;

   3911  1 000137   300007 236100                    LDQ     7,,PR3
         1 000140   100012 756100                    STQ     10,,PR1

       92     3912        /*     Read the data base page.              */
       93     3913    1       GLOBAL.GRANULE=GLOBAL.PARAN.IO.PGNO;

   3913  1 000141   000021 235100                    LDA     17,,PR0
         1 000142   004622 755100                    STA     2450,,PR0

       94     3914    1       CALL M$READ (FPT$READD) ALTRET(RDD_ERR);

   3914  1 000143   100000 630500                    EPPR0   0,,PR1
         1 000144   440000 713400                    CLIMB   alt,read
         1 000145   401400 401760                    pmme    nvectors=4
         1 000146   000261 702000 1                  TSX2    RDD_ERR

       95     3915    2       IF GLOBAL.PARAN.TRACE.MODE~='0'B THEN DO;

   3915  1 000147   000000 470400 xsym               LDP0    GLOBAL$
         1 000150   000061 235100                    LDA     49,,PR0
         1 000151   000172 600000 1                  TZE     s:3925

       96     3916    2           IF NOT AWS.ATRIB.CAC THEN

   3916  1 000152   200010 471500                    LDP1    AWS$,,AUTO
         1 000153   100000 236100                    LDQ     0,,PR1
         1 000154   000001 316003                    CANQ    1,DU
         1 000155   000161 601000 1                  TNZ     s:3920

       97     3917        /*N*                If no CAC or ENQ already existed. */
       98     3918    2               GLOBAL.PARAN.TRACE.TYPE=TR#PREAD;

PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:19   
   3918  1 000156   000002 220003                    LDX0    2,DU
         1 000157   000060 740100                    STX0    48,,PR0
         1 000160   000163 710000 1                  TRA     s:3921

       99     3919    2           ELSE
      100     3920    2               GLOBAL.PARAN.TRACE.TYPE=TR#PREADENQ;

   3920  1 000161   000015 220003                    LDX0    13,DU
         1 000162   000060 740100                    STX0    48,,PR0

      101     3921    2           GLOBAL.PARAN.TRACE.PDCB=AWS.DDCB;

   3921  1 000163   100006 221100                    LDX1    6,,PR1
         1 000164   000055 441100                    SXL1    45,,PR0

      102     3922    2           GLOBAL.PARAN.TRACE.PNO=GLOBAL.PARAN.IO.PGNO;

   3922  1 000165   000021 235100                    LDA     17,,PR0
         1 000166   000056 755100                    STA     46,,PR0

      103     3923    2           CALL ZIM$TRACE;

   3923  1 000167   000000 631400 2                  EPPR1   0
         1 000170   000000 701000 xent               TSX1    ZIM$TRACE
         1 000171   000000 011000                    NOP     0

      104     3924    2           END;

      105     3925    1       IF AWS.ATRIB.CHKSUM THEN

   3925  1 000172   200010 470500                    LDP0    AWS$,,AUTO
         1 000173   000000 236100                    LDQ     0,,PR0
         1 000174   010000 316003                    CANQ    4096,DU
         1 000175   000245 600000 1                  TZE     READ_DONE

      106     3926    2       DO;

PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:20   
      107     3927    2           GLOBAL.PARAN.ICKSM.P$=FPT$READD.BUF_.BUF$;

   3927  1 000176   200003 471500                    LDP1    FPT$,,AUTO
         1 000177   100005 236100                    LDQ     5,,PR1
         1 000200   000000 473400 xsym               LDP3    GLOBAL$
         1 000201   300023 756100                    STQ     19,,PR3

      108     3928    2           CALL ZIM$ICKSM;

   3928  1 000202   000000 631400 2                  EPPR1   0
         1 000203   000000 701000 xent               TSX1    ZIM$ICKSM
         1 000204   000000 011000                    NOP     0

      109     3929    2           IF GLOBAL.PARAN.ICKSM.V~=

   3929  1 000205   000000 470400 xsym               LDP0    GLOBAL$
         1 000206   000023 471500                    LDP1    19,,PR0
         1 000207   000024 236100                    LDQ     20,,PR0
         1 000210   100002 116100                    CMPQ    2,,PR1
         1 000211   000245 600000 1                  TZE     READ_DONE

      110     3930    3   /* DIAG */ PINCRW(GLOBAL.PARAN.ICKSM.P$,2)->ONEWORD THEN DO;

      111     3931    3   /*DIAG */   INDX = GLOBAL.BCB.TAIL;

   3931  1 000212   000176 235100                    LDA     126,,PR0
         1 000213   200011 755100                    STA     INDX,,AUTO

      112     3932    4   /*DIAG */   DO WHILE (GLOBAL.PARAN.IO.BUF$ =

   3932  1 000214   200011 236100                    LDQ     INDX,,AUTO
         1 000215   000005 402007                    MPY     5,DL
         1 000216   000202 236106                    LDQ     130,QL,PR0
         1 000217   000022 116100                    CMPQ    18,,PR0
         1 000220   000233 601000 1                  TNZ     s:3936

      113     3933    4   /*DIAG */ GLOBAL.BCB.BUF.BUF$(INDX));
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:21   
      114     3934    4   /*DIAG */       INDX = GLOBAL.BCB.BUF.LINK(INDX);

   3934  1 000221   200011 236100                    LDQ     INDX,,AUTO
         1 000222   000005 402007                    MPY     5,DL
         1 000223   000000 470400 xsym               LDP0    GLOBAL$
         1 000224   000205 236106                    LDQ     133,QL,PR0
         1 000225   000022 772000                    QRL     18
         1 000226   200011 756100                    STQ     INDX,,AUTO

      115     3935    4   /*DIAG */       END;

   3935  1 000227   000005 402007                    MPY     5,DL
         1 000230   000202 236106                    LDQ     130,QL,PR0
         1 000231   000022 116100                    CMPQ    18,,PR0
         1 000232   000221 600000 1                  TZE     s:3934

      116     3936    3   /*DIAG */   FPT$READD.BUF_.BUF$ = PINCRW(GLOBAL.BCB.BUF.BUF$(INDX), -3);

   3936  1 000233   200011 236100                    LDQ     INDX,,AUTO
         1 000234   000005 402007                    MPY     5,DL
         1 000235   000202 236106                    LDQ     130,QL,PR0
         1 000236   777775 036003                    ADLQ    -3,DU
         1 000237   200003 471500                    LDP1    FPT$,,AUTO
         1 000240   100005 756100                    STQ     5,,PR1

      117     3937    3   /*DIAG*/    CALL M$READ(FPT$READD);

   3937  1 000241   100000 630500                    EPPR0   0,,PR1
         1 000242   040000 713400                    CLIMB   read
         1 000243   401400 401760                    pmme    nvectors=4

      118     3938    3               GOTO ER_CKSM;

   3938  1 000244   000312 710000 1                  TRA     ER_CKSM

      119     3939    3   /*DIAG*/    END;
      120     3940    2           END;
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:22   
      121     3941    1   READ_DONE:
      122     3942    1       PINCRW(GLOBAL.PARAN.IO.BUF$,-3)->BLOCK.PSTAMP=GLOBAL.BCB.SLOT;

   3942  1 000245   000000 470400 xsym  READ_DONE    LDP0    GLOBAL$
         1 000246   000022 471500                    LDP1    18,,PR0
         1 000247   000200 235100                    LDA     128,,PR0
         1 000250   177775 755100                    STA     -3,,PR1

      123     3943    1       GLOBAL.STATS.CURR.READS=GLOBAL.STATS.CURR.READS+1;

   3943  1 000251   001425 235100                    LDA     789,,PR0
         1 000252   000001 035007                    ADLA    1,DL
         1 000253   001425 755100                    STA     789,,PR0

      124     3944    1       RETURN;

   3944  1 000254   000000 702200 xent               TSX2  ! X66_ARET

      125     3945    1   BUFHIT: GLOBAL.STATS.CURR.HITS=GLOBAL.STATS.CURR.HITS+1;

   3945  1 000255   001424 235100       BUFHIT       LDA     788,,PR0
         1 000256   000001 035007                    ADLA    1,DL
         1 000257   001424 755100                    STA     788,,PR0

      126     3946    1       RETURN;

   3946  1 000260   000000 702200 xent               TSX2  ! X66_ARET

      127     3947        %EJECT;
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:23   
      128     3948        /*             Can't read page from file system            */
      129     3949    1   RDD_ERR:
      130     3950        /* Verify failure                                          */
      131     3951    1       IF AWS.ATRIB.ATMP=%YES# AND

   3951  1 000261   200010 470500       RDD_ERR      LDP0    AWS$,,AUTO
         1 000262   000000 236100                    LDQ     0,,PR0
         1 000263   000100 316003                    CANQ    64,DU
         1 000264   000277 600000 1                  TZE     s:3959
         1 000265   000000 471400 xsym               LDP1    B$TCB$
         1 000266   100000 473500                    LDP3    0,,PR1
         1 000267   300102 236100                    LDQ     66,,PR3
         1 000270   377770 376007                    ANQ     131064,DL
         1 000271   000110 116007                    CMPQ    72,DL
         1 000272   000277 601000 1                  TNZ     s:3959

      132     3952    1          B$TCB$->B$TCB.ALT$->B$ALT.ERR.ERR#=%E$DI THEN
      133     3953    2       DO;

      134     3954    2           CALL ZIB$DBINP;

   3954  1 000273   000000 631400 2                  EPPR1   0
         1 000274   000000 701000 xent               TSX1    ZIB$DBINP
         1 000275   000000 011000                    NOP     0

      135     3955    2           GOTO READ_DONE;

   3955  1 000276   000245 710000 1                  TRA     READ_DONE

      136     3956    2           END;
      137     3957    2       ELSE DO;

      138     3958        /* error reading page, give alternate return.              */
      139     3959    2           ERROR=ERR#IO#RDD;

   3959  1 000277   303361 235007                    LDA     100081,DL
         1 000300   200004 755100                    STA     ERROR,,AUTO
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:24   

      140     3960    2           GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   3960  1 000301   000000 471400 xsym               LDP1    B$TCB$
         1 000302   100000 473500                    LDP3    0,,PR1
         1 000303   300102 236100                    LDQ     66,,PR3
         1 000304   000000 474400 xsym               LDP4    GLOBAL$
         1 000305   400007 756100                    STQ     7,,PR4

      141     3961    2           GLOBAL.RET.DCB#=GLOBAL.READD$->FPT$READD.V.DCB#;

   3961  1 000306   405073 473500                    LDP3    2619,,PR4
         1 000307   300010 220100                    LDX0    8,,PR3
         1 000310   400014 740100                    STX0    12,,PR4

      142     3962    2           GOTO DBALT;

   3962  1 000311   000356 710000 1                  TRA     DBALT

      143     3963    2           END;
      144     3964    1   ER_CKSM:
      145     3965    1       IF GLOBAL.GRANULE=0 THEN

   3965  1 000312   000000 470400 xsym  ER_CKSM      LDP0    GLOBAL$
         1 000313   004622 235100                    LDA     2450,,PR0
         1 000314   000245 600000 1                  TZE     READ_DONE

      146     3966    1           GOTO READ_DONE;
      147     3967    1       CALL BINCHAR(GLOBAL.ERRFIELD_INSERT.TEXT(1),GLOBAL.PARAN.IO.PGNO);

   3967  1 000315   000021 235100                    LDA     17,,PR0
         1 000316   000044 773000                    LRL     36
         1 000317   200014 757100                    STAQ    PRESLOT+2,,AUTO
         1 000320   000100 301500                    BTD
         1 000321   200014 000010                    NDSC9   PRESLOT+2,,AUTO          cn=0,s=lsgnf,sf=0,n=8
         1 000322   004756 230037                    NDSC9   2542,,PR0                cn=1,s=nosgn,sf=0,n=31

PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:25   
      148     3968    1       X = 0;

   3968  1 000323   200005 450100                    STZ     X,,AUTO

      149     3969    1       Y = 0;

   3969  1 000324   200006 450100                    STZ     Y,,AUTO

      150     3970    2       DO WHILE (SUBSTR(GLOBAL.ERRFIELD_INSERT.TEXT(1),X,1)='0');

   3970  1 000325   000331 710000 1                  TRA     s:3972

      151     3971    2           X = X + 1;

   3971  1 000326   200005 235100                    LDA     X,,AUTO
         1 000327   000001 035007                    ADLA    1,DL
         1 000330   200005 755100                    STA     X,,AUTO

      152     3972    2           END;

   3972  1 000331   000000 470400 xsym               LDP0    GLOBAL$
         1 000332   200005 235100                    LDA     X,,AUTO
         1 000333   040000 106505                    CMPC    fill='040'O
         1 000334   004756 200001                    ADSC9   2542,A,PR0               cn=1,n=1
         1 000335   000001 000001 2                  ADSC9   1                        cn=0,n=1
         1 000336   000326 600000 1                  TZE     s:3971

      153     3973    1       Y = 31 - X;

   3973  1 000337   000002 675000 2                  ERA     2
         1 000340   000040 035007                    ADLA    32,DL
         1 000341   000033 735000                    ALS     27
         1 000342   200006 755100                    STA     Y,,AUTO

      154     3974    1       GLOBAL.ERRFIELD_INSERT.TEXT(1) = SUBSTR(GLOBAL.ERRFIELD_INSERT.TEXT(1),X,Y);

   3974  1 000343   200006 236100                    LDQ     Y,,AUTO
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:26   
         1 000344   000033 772000                    QRL     27
         1 000345   000000 620006                    EAX0    0,QL
         1 000346   200005 236100                    LDQ     X,,AUTO
         1 000347   040100 100546                    MLR     fill='040'O
         1 000350   004756 200010                    ADSC9   2542,Q,PR0               cn=1,n=*X0
         1 000351   004756 200037                    ADSC9   2542,,PR0                cn=1,n=31

      155     3975    1       GLOBAL.ERRFIELD_INSERT.LENGTH(1) = Y;

   3975  1 000352   200006 236100                    LDQ     Y,,AUTO
         1 000353   004756 552140                    STBQ    2542,'40'O,PR0

      156     3976    1       ERROR=ERR#IO#CKSM;

   3976  1 000354   303374 235007                    LDA     100092,DL
         1 000355   200004 755100                    STA     ERROR,,AUTO

   3976  1 000356                       DBALT        null
      157     3977    1   DBALT: ;
      158     3978            %DBALT;

   3979  1 000356   000000 470400 xsym               LDP0    GLOBAL$
         1 000357   000006 235100                    LDA     6,,PR0
         1 000360   000367 601000 1                  TNZ     s:3987

   3981  1 000361   000010 450100                    STZ     8,,PR0

   3982  1 000362   000012 450100                    STZ     10,,PR0

   3983  1 000363   000013 450100                    STZ     11,,PR0

   3984  1 000364   000011 450100                    STZ     9,,PR0

   3985  1 000365   200004 236100                    LDQ     ERROR,,AUTO
         1 000366   000006 756100                    STQ     6,,PR0

   3987  1 000367   000006 235100                    LDA     6,,PR0
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:27   
         1 000370   303240 115007                    CMPA    100000,DL
         1 000371   000373 603000 1                  TRC     s:3990

   3988  1 000372   000000 702200 xent               TSX2  ! X66_AALT

   3990  1 000373   000000 631400 2                  EPPR1   0
         1 000374   000000 701000 xent               TSX1    ZIB$ERR
         1 000375   000000 011000                    NOP     0

   3987  1 000376                       ER_GETB      null
      159     3992    1   ER_GETB: ;
      160     3993    1   EXC_GETB: /* ENQ LIST AND BUF MAN DO NOT AGREE */
      161     3994    1       ERROR=ERR#BM#E02;

   3994  1 000376   303331 235007       EXC_GETB     LDA     100057,DL
         1 000377   200004 755100                    STA     ERROR,,AUTO

      162     3995    1       GOTO DBALT;

   3995  1 000400   000356 710000 1                  TRA     DBALT

      163     3996    1   ALT:ALTRETURN;

   3996  1 000401   000000 702200 xent  ALT          TSX2  ! X66_AALT

(unnamed)
 Sect OctLoc
   2     000   000000 000000   060040 040040   777777 777777                    ....0   ....
      164     3997    1   END ZIO$DBREAD;
      165     3998        %EOD;

PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:28   
--  Include file information  --

   ZI_ERRORS_C.:ZIC0TOU  is referenced.
   ZI$DBCB.:ZIC0TOU  is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIO$DBREAD.

   Procedure ZIO$DBREAD requires 258 words for executable code.
   Procedure ZIO$DBREAD requires 14 words of local(AUTO) storage.
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:29   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:30   
          MINI XREF LISTING

ALT
      3996**LABEL    3833--CALLALT  3861--CALLALT
AWS.ATRIB.ATMP
      3468**DCL      3951>>IF
AWS.ATRIB.CAC
      3473**DCL      3827>>IF       3916>>IF
AWS.ATRIB.CHKSUM
      3463**DCL      3925>>IF
AWS.DDCB
      3481**DCL      3830>>ASSIGN   3910>>ASSIGN   3921>>ASSIGN
AWS.ENCRP
      3483**DCL      3911>>ASSIGN
AWS.FIPN
      3480**DCL      3827>>IF       3827>>IF
AWS$
      3455**DCL      3456--IMP-PTR  3826<<ASSIGN   3827>>IF       3827>>IF       3827>>IF       3830>>ASSIGN
      3910>>ASSIGN   3911>>ASSIGN   3916>>IF       3921>>ASSIGN   3925>>IF       3951>>IF
B$ALT.CODE
       724**DCL       724--REDEF     725--REDEF     725--REDEF
B$ALT.ERR
       725**DCL      3960>>ASSIGN
B$ALT.ERR.ERR#
       726**DCL       726--REDEF    3951>>IF
B$ALT.EVID
       725**DCL       725--REDEF     725--REDEF
B$TCB.ALT$
       720**DCL      3951>>IF       3960>>ASSIGN
B$TCB$
        12**DCL      3951>>IF       3960>>ASSIGN
BLOCK.PSTAMP
      2760**DCL      3942<<ASSIGN
BUFHIT
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:31   
      3945**LABEL    3884--GOTO     3900--GOTO
CLEAR12
      3822**DCL      3909<<ASSIGN
DBALT
      3976**LABEL    3962--GOTO     3995--GOTO
ENQLIST.BUFSLOT
      2804**DCL      3836>>ASSIGN   3864<<ASSIGN
ENQLIST$
      2810**DCL      2795--IMP-PTR  3834<<ASSIGN   3836>>ASSIGN   3864>>ASSIGN
ERROR
        24**DCL      3959<<ASSIGN   3976<<ASSIGN   3985>>ASSIGN   3994<<ASSIGN
ER_CKSM
      3965**LABEL    3938--GOTO
ER_GETB
      3987**LABEL    3843--CALLALT  3872--CALLALT  3875--GOTO     3893--CALLALT
EXC_GETB
      3994**LABEL    3850--GOTO
F$DCB.ACTPOS
       763**DCL       763--REDEF
F$DCB.ARS#
       737**DCL       737--REDEF
F$DCB.ATTR
       756**DCL       757--REDEF
F$DCB.BORROW
       771**DCL       771--REDEF     771--REDEF     771--REDEF
F$DCB.DCBNAME.L
       785**DCL       785--IMP-SIZ
F$DCB.EOMCHAR#
       741**DCL       741--REDEF
F$DCB.FLDID
       766**DCL       766--REDEF
F$DCB.FORM$
       760**DCL       760--REDEF
F$DCB.FSECT
       776**DCL       776--REDEF
F$DCB.FSN#
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:32   
       753**DCL       753--REDEF     753--REDEF     754--REDEF
F$DCB.HEADER$
       759**DCL       759--REDEF
F$DCB.IXTNSIZE#
       757**DCL       757--REDEF
F$DCB.LASTSTA$
       746**DCL       746--REDEF
F$DCB.LVL
       772**DCL       772--REDEF
F$DCB.NAME#.C
       747**DCL       747--REDEF
F$DCB.NOEOF
       769**DCL       769--REDEF
F$DCB.NRECS#
       758**DCL       758--REDEF
F$DCB.NRECX
       777**DCL       777--REDEF
F$DCB.OHDR
       769**DCL       769--REDEF
F$DCB.ORG#
       752**DCL       752--REDEF
F$DCB.PRECNO
       775**DCL       775--REDEF
F$DCB.RCSZ
       781**DCL       781--REDEF
F$DCB.RES#
       748**DCL       748--REDEF
F$DCB.SETX
       760**DCL       760--REDEF
F$DCB.TAB$
       760**DCL       760--REDEF
F$DCB.TDA
       774**DCL       775--REDEF
F$DCB.WSN#
       748**DCL       748--REDEF
FPT$
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:33   
        22**DCL       125--IMP-PTR  3907<<ASSIGN   3908>>ASSIGN   3909>>ASSIGN   3910>>ASSIGN   3911>>ASSIGN
      3914>>CALL     3927>>ASSIGN   3936>>ASSIGN   3937>>CALL
FPT$READD
       125**DCL      3914<>CALL     3937<>CALL
FPT$READD.BUF_.BUF$
       128**DCL      3908<<ASSIGN   3909>>ASSIGN   3927>>ASSIGN   3936<<ASSIGN
FPT$READD.STATION_
       128**DCL       129--REDEF
FPT$READD.V.DCB#
       129**DCL      3910<<ASSIGN   3961>>ASSIGN
FPT$READD.V.DVBYTE.REREAD#
       140**DCL       140--REDEF
FPT$READD.V.INDX#
       138**DCL       138--REDEF
FPT$READD.V.SEED#
       139**DCL      3911<<ASSIGN
GLOBAL.ACTIVE.DBCB$
      2454**DCL      2455--REDEF
GLOBAL.ACTIVE.SSS$
      2450**DCL      2451--REDEF
GLOBAL.BCB.BUF.BUF$
      2561**DCL      3932>>DOWHILE  3936>>ASSIGN
GLOBAL.BCB.BUF.ENQINDX
      2571**DCL      3863<<ASSIGN
GLOBAL.BCB.BUF.LINK
      2564**DCL      3934>>ASSIGN
GLOBAL.BCB.SLOT
      2558**DCL      3836<<ASSIGN   3837>>IF       3863>>ASSIGN   3864>>ASSIGN   3942>>ASSIGN
GLOBAL.BCB.TAIL
      2556**DCL      3931>>ASSIGN
GLOBAL.ENQ.LIST.BASE$
      2586**DCL      3834>>ASSIGN
GLOBAL.ENQ.LIST.INDX
      2588**DCL      3836>>ASSIGN   3863>>ASSIGN   3864>>ASSIGN
GLOBAL.ENQ.SHARE
      2574**DCL      3832<<ASSIGN
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:34   
GLOBAL.ENQ.VALUE.DCB#
      2581**DCL      3830<<ASSIGN
GLOBAL.ENQ.VALUE.RNAME
      2583**DCL      3831<<ASSIGN
GLOBAL.ERRFIELD_INSERT.LENGTH
      2673**DCL      3975<<ASSIGN
GLOBAL.ERRFIELD_INSERT.TEXT
      2674**DCL      3967<<CALLBLT  3970>>DOWHILE  3974<<ASSIGN   3974>>ASSIGN
GLOBAL.GRANULE
      2656**DCL      3913<<ASSIGN   3965>>IF
GLOBAL.KEY
      2658**DCL      2661--REDEF
GLOBAL.PARAN.ICKSM.P$
      2501**DCL      3927<<ASSIGN   3929>>IF
GLOBAL.PARAN.ICKSM.V
      2502**DCL      3929>>IF
GLOBAL.PARAN.IO.AWS$
      2497**DCL      3826>>ASSIGN
GLOBAL.PARAN.IO.BUF$
      2499**DCL      3908>>ASSIGN   3932>>DOWHILE  3942>>ASSIGN
GLOBAL.PARAN.IO.PGNO
      2498**DCL      3827>>IF       3831>>ASSIGN   3913>>ASSIGN   3922>>ASSIGN   3967>>CALLBLT
GLOBAL.PARAN.TRACE.MODE
      2533**DCL      2540--REDEF    3915>>IF
GLOBAL.PARAN.TRACE.PDCB
      2528**DCL      3921<<ASSIGN
GLOBAL.PARAN.TRACE.PNO
      2529**DCL      3922<<ASSIGN
GLOBAL.PARAN.TRACE.TYPE
      2531**DCL      3918<<ASSIGN   3920<<ASSIGN
GLOBAL.PRINTBUF.BUFFER
      2692**DCL      2693--REDEF    2694--REDEF    2695--REDEF
GLOBAL.PRINTBUF.ERR.V
      2697**DCL      2700--REDEF    2701--REDEF    2702--REDEF
GLOBAL.READD$
      2710**DCL      3907>>ASSIGN   3961>>ASSIGN
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:35   
GLOBAL.RET.AC#
      2470**DCL      3981<<ASSIGN
GLOBAL.RET.DCB#
      2474**DCL      3961<<ASSIGN
GLOBAL.RET.ERROR#
      2468**DCL      3844>>IF       3849<<ASSIGN   3873>>IF       3894>>IF       3899<<ASSIGN   3979>>IF
      3985<<ASSIGN   3987>>IF
GLOBAL.RET.FR#
      2471**DCL      3984<<ASSIGN
GLOBAL.RET.RC#
      2473**DCL      3983<<ASSIGN
GLOBAL.RET.SC#
      2472**DCL      3982<<ASSIGN
GLOBAL.RET.SYSERR#
      2469**DCL      3960<<ASSIGN
GLOBAL.STATS.CURR.HITS
      2607**DCL      3945<<ASSIGN   3945>>ASSIGN
GLOBAL.STATS.CURR.READS
      2608**DCL      3943<<ASSIGN   3943>>ASSIGN
GLOBAL.STATS.CURR.REQS
      2606**DCL      3825<<ASSIGN   3825>>ASSIGN
GLOBAL$
      2752**DCL      2448--IMP-PTR  3825>>ASSIGN   3825>>ASSIGN   3826>>ASSIGN   3827>>IF       3830>>ASSIGN
      3831>>ASSIGN   3831>>ASSIGN   3832>>ASSIGN   3834>>ASSIGN   3836>>ASSIGN   3836>>ASSIGN   3837>>IF
      3844>>IF       3849>>ASSIGN   3863>>ASSIGN   3863>>ASSIGN   3863>>ASSIGN   3864>>ASSIGN   3864>>ASSIGN
      3873>>IF       3894>>IF       3899>>ASSIGN   3907>>ASSIGN   3908>>ASSIGN   3913>>ASSIGN   3913>>ASSIGN
      3915>>IF       3918>>ASSIGN   3920>>ASSIGN   3921>>ASSIGN   3922>>ASSIGN   3922>>ASSIGN   3927>>ASSIGN
      3929>>IF       3929>>IF       3931>>ASSIGN   3932>>DOWHILE  3932>>DOWHILE  3934>>ASSIGN   3936>>ASSIGN
      3942>>ASSIGN   3942>>ASSIGN   3943>>ASSIGN   3943>>ASSIGN   3945>>ASSIGN   3945>>ASSIGN   3960>>ASSIGN
      3961>>ASSIGN   3961>>ASSIGN   3965>>IF       3967>>CALLBLT  3967>>CALLBLT  3970>>DOWHILE  3974>>ASSIGN
      3974>>ASSIGN   3975>>ASSIGN   3979>>IF       3981>>ASSIGN   3982>>ASSIGN   3983>>ASSIGN   3984>>ASSIGN
      3985>>ASSIGN   3987>>IF
INDX
      3820**DCL      3931<<ASSIGN   3932>>DOWHILE  3934<<ASSIGN   3934>>ASSIGN   3936>>ASSIGN
M$READ
        37**DCL-ENT  3914--CALL     3937--CALL
PL6.E3A0      #001=ZIO$DBREAD File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:36   
ONEWORD
        23**DCL      3929>>IF
RDD_ERR
      3951**LABEL    3914--CALLALT
READ_DONE
      3942**LABEL    3955--GOTO     3966--GOTO
X
        25**DCL      3968<<ASSIGN   3970>>DOWHILE  3971<<ASSIGN   3971>>ASSIGN   3973>>ASSIGN   3974>>ASSIGN
Y
        26**DCL      3969<<ASSIGN   3973<<ASSIGN   3974>>ASSIGN   3975>>ASSIGN
ZIB$DBINP
        13**DCL-ENT  3954--CALL
ZIB$ERR
      2753**DCL-ENT  3990--CALL
ZIM$ENQM
        19**DCL-ENT  3833--CALL
ZIM$ENQ_FIND
        20**DCL-ENT  3861--CALL
ZIM$ICKSM
        15**DCL-ENT  3928--CALL
ZIM$TRACE
        14**DCL-ENT  3923--CALL
ZIO$CHKBUSY
        18**DCL-ENT  3872--CALL
ZIO$GETBUF
        16**DCL-ENT  3893--CALL
ZIO$GETSLOT
        17**DCL-ENT  3843--CALL

PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:37   
      166        1        /*M* ZIO$DWRITE - writes page associated with 'BUFNUM' index of
      167        2                          the buffer pool.                         */
      168        3        /*T***********************************************************/
      169        4        /*T*                                                         */
      170        5        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      171        6        /*T*                                                         */
      172        7        /*T***********************************************************/
      173        8        ZIO$DWRITE: PROC(BUFNUM) ALTRET
      174        9         /* USE($PR5 FOR GLOBAL$) */
      175       10               AVOID($PR5,$PR6,$PR7);
      176       11    1   DCL BUFNUM SBIN;
      177       12    1   DCL B$TCB$ PTR SYMREF;
      178       13    1   DCL ZI_WAITIO BIT(1) SYMREF;
      179       14    1   DCL FPT$ PTR;
      180       15    1   DCL ZIM$TRACE ENTRY;
      181       16    1   DCL ONEWORD UBIN(36) BASED;
      182       17    1   DCL ERROR UBIN(36);
      183       18    1   DCL ZIM$ICKSM ENTRY;
      184       19    1   DCL ZIM$JCKSMC ENTRY(1);
      185       20    1   DCL ZIM$UNCHECK ENTRY; /* ENTDEF IN ZIM$JCKPT */
      186       21        %INCLUDE CP_6;
      187      102         %B$TCB;
      188      105         %B$ALT;
      189      113        %F$DCB;
      190      170        %FPT_WRITE (FPTN=FPT$WRTD, STCLASS="BASED(FPT$)");
      191      201        %INCLUDE CP_6_SUBS;
      192      741        %INCLUDE ZI$GLOBAL;
      193     1227        %GLOBALS;
      194     1535        %TRCE_SUBS;
      195     1559        %INCLUDE ZI$DBCB;
      196     2201        %AWS;
      197     2241        %INCLUDE ZI_ERRORS_C;
      198     2567        %EJECT;
PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:38   
      199     2568        /*     Perform actual data base write to the file system   */
      200     2569    1       AWS$=GLOBAL.BCB.BUF.AWS$(BUFNUM);
      201     2570    1       FPT$ = GLOBAL.WRTD$;
      202     2571    1       GLOBAL.GRANULE=GLOBAL.BCB.BUF.PGNO(BUFNUM);
      203     2572    1       FPT$WRTD.BUF_.BUF$=PINCRW(GLOBAL.BCB.BUF.BUF$(BUFNUM),-3);
      204     2573    1       FPT$WRTD.V.DCB# = AWS.DDCB;
      205     2574    1       FPT$WRTD.V.EVENT# = BUFNUM;
      206     2575    1       FPT$WRTD.V.SEED#=AWS.ENCRP;
      207     2576        /*     Write the data base page.              */
      208     2577    1       IF AWS.ATRIB.CHKSUM THEN
      209     2578    2       DO;
      210     2579    2           GLOBAL.PARAN.ICKSM.P$=FPT$WRTD.BUF_.BUF$;
      211     2580    2           CALL ZIM$ICKSM;
      212     2581    2           PINCRW(FPT$WRTD.BUF_.BUF$,2)->ONEWORD=GLOBAL.PARAN.ICKSM.V;
      213     2582    2           END;
      214     2583    1       IF AWS.ATRIB.CJRNL AND
      215     2584    1          GLOBAL.GRANULE~=0 AND
      216     2585    1          (AWS.FIPN=0 OR GLOBAL.GRANULE<AWS.FIPN) THEN
      217     2586    1           CALL ZIM$JCKSMC(BUFNUM);
      218     2587        /*             If unprotected write call uncheck */
      219     2588    1       IF AWS.ATRIB.UNPROTECT THEN
      220     2589    1           CALL ZIM$UNCHECK;
      221     2590    2       DO INHIBIT;
      222     2591    2           GLOBAL.BCB.BUF.STATUS.BUSY(BUFNUM)=%YES#;
      223     2592    2           END;
      224     2593    1       CALL M$WRITE (FPT$WRTD) ALTRET(WRTD_ERR);
      225     2594    2       IF ZI_WAITIO THEN DO;
      226     2595    2           GLOBAL.BCB.BUF.STATUS.BUSY(BUFNUM) = %NO#;
      227     2596    2           GLOBAL.BCB.BUF.STATUS.MODIFY(BUFNUM) = %NO#;
      228     2597    2           FPT$WRTD.BUF_.BUF$->ONEWORD = BUFNUM;
      229     2598    2           END;
      230     2599    2       IF GLOBAL.PARAN.TRACE.MODE~='0'B THEN DO;
      231     2600    2           GLOBAL.PARAN.TRACE.TYPE=TR#PWRITE;
      232     2601    2           GLOBAL.PARAN.TRACE.PDCB=AWS.DDCB;
      233     2602    2           GLOBAL.PARAN.TRACE.PNO=GLOBAL.GRANULE;
      234     2603    2           CALL ZIM$TRACE;
      235     2604    2           END;
PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:39   
      236     2605    1       RETURN;
      237     2606        %EJECT;
PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:40   
      238     2607        /* Can't write the page, give alternate return.  */
      239     2608    1   WRTD_ERR:
      240     2609    2       DO INHIBIT;
      241     2610    2           GLOBAL.BCB.BUF.STATUS(BUFNUM)='0'B;
      242     2611    2           END;
      243     2612    1       ERROR=ERR#IO#WRTD;
      244     2613    1       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      245     2614    1       GLOBAL.RET.DCB#=GLOBAL.WRTD$->FPT$WRTD.V.DCB#;
      246     2615    1       GOTO ALT;
      247     2616    1   ER_CKSM: ;
      248     2617    1   ALT: ;
      249     2618            %DBALT;
      250     2632    1   END ZIO$DWRITE;

PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:41   
--  Include file information  --

   ZI_ERRORS_C.:ZIC0TOU  is referenced.
   ZI$DBCB.:ZIC0TOU  is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIO$DWRITE.

   Procedure ZIO$DWRITE requires 138 words for executable code.
   Procedure ZIO$DWRITE requires 8 words of local(AUTO) storage.

    No errors detected in file ZIM$RDWRT.:ZIC0TSI    .

PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:42   

 Object Unit name= ZIO$DWRITE                                 File name= ZIM$RDWRT.:ZIC0TOU
 UTS= SEP 05 '97 13:05:42.96 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Proc  even  none   138    212  ZIO$DWRITE
    2  RoData even  none     5      5  ZIO$DWRITE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      XStd       1  ZIO$DWRITE

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           XStd      0 ZIM$ICKSM
         yes           XStd      0 ZIM$TRACE
         yes           XStd      0 ZIB$ERR
         yes           XStd      1 ZIM$JCKSMC
         yes           XStd      0 ZIM$UNCHECK
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:43   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$TCB$                                ZI_WAITIO                             M$UC
r    GLOBAL$
PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:44   


      166        1        /*M* ZIO$DWRITE - writes page associated with 'BUFNUM' index of
      167        2                          the buffer pool.                         */
      168        3        /*T***********************************************************/
      169        4        /*T*                                                         */
      170        5        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      171        6        /*T*                                                         */
      172        7        /*T***********************************************************/
      173        8        ZIO$DWRITE: PROC(BUFNUM) ALTRET

      8  1 000000   000000 700200 xent  ZIO$DWRITE   TSX0  ! X66_AUTO_1
         1 000001   000010 000001                    ZERO    8,1

      174        9         /* USE($PR5 FOR GLOBAL$) */
      175       10               AVOID($PR5,$PR6,$PR7);
      176       11    1   DCL BUFNUM SBIN;
      177       12    1   DCL B$TCB$ PTR SYMREF;
      178       13    1   DCL ZI_WAITIO BIT(1) SYMREF;
      179       14    1   DCL FPT$ PTR;
      180       15    1   DCL ZIM$TRACE ENTRY;
      181       16    1   DCL ONEWORD UBIN(36) BASED;
      182       17    1   DCL ERROR UBIN(36);
      183       18    1   DCL ZIM$ICKSM ENTRY;
      184       19    1   DCL ZIM$JCKSMC ENTRY(1);
      185       20    1   DCL ZIM$UNCHECK ENTRY; /* ENTDEF IN ZIM$JCKPT */
      186       21        %INCLUDE CP_6;
      187      102         %B$TCB;
      188      105         %B$ALT;
      189      113        %F$DCB;
      190      170        %FPT_WRITE (FPTN=FPT$WRTD, STCLASS="BASED(FPT$)");
      191      201        %INCLUDE CP_6_SUBS;
      192      741        %INCLUDE ZI$GLOBAL;
      193     1227        %GLOBALS;
      194     1535        %TRCE_SUBS;
      195     1559        %INCLUDE ZI$DBCB;
      196     2201        %AWS;
      197     2241        %INCLUDE ZI_ERRORS_C;
PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:45   
      198     2567        %EJECT;
PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:46   
      199     2568        /*     Perform actual data base write to the file system   */
      200     2569    1       AWS$=GLOBAL.BCB.BUF.AWS$(BUFNUM);

   2569  1 000002   200003 470500                    LDP0    @BUFNUM,,AUTO
         1 000003   000000 236100                    LDQ     0,,PR0
         1 000004   000005 402007                    MPY     5,DL
         1 000005   000000 471400 xsym               LDP1    GLOBAL$
         1 000006   100204 236106                    LDQ     132,QL,PR1
         1 000007   200006 756100                    STQ     AWS$,,AUTO

      201     2570    1       FPT$ = GLOBAL.WRTD$;

   2570  1 000010   105074 236100                    LDQ     2620,,PR1
         1 000011   200004 756100                    STQ     FPT$,,AUTO

      202     2571    1       GLOBAL.GRANULE=GLOBAL.BCB.BUF.PGNO(BUFNUM);

   2571  1 000012   000000 236100                    LDQ     0,,PR0
         1 000013   000005 402007                    MPY     5,DL
         1 000014   100203 235106                    LDA     131,QL,PR1
         1 000015   104622 755100                    STA     2450,,PR1

      203     2572    1       FPT$WRTD.BUF_.BUF$=PINCRW(GLOBAL.BCB.BUF.BUF$(BUFNUM),-3);

   2572  1 000016   000000 236100                    LDQ     0,,PR0
         1 000017   000005 402007                    MPY     5,DL
         1 000020   100202 236106                    LDQ     130,QL,PR1
         1 000021   777775 036003                    ADLQ    -3,DU
         1 000022   200004 473500                    LDP3    FPT$,,AUTO
         1 000023   300005 756100                    STQ     5,,PR3

      204     2573    1       FPT$WRTD.V.DCB# = AWS.DDCB;

   2573  1 000024   200006 474500                    LDP4    AWS$,,AUTO
         1 000025   400006 220100                    LDX0    6,,PR4
         1 000026   300010 740100                    STX0    8,,PR3

PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:47   
      205     2574    1       FPT$WRTD.V.EVENT# = BUFNUM;

   2574  1 000027   000000 235100                    LDA     0,,PR0
         1 000030   300011 755100                    STA     9,,PR3

      206     2575    1       FPT$WRTD.V.SEED#=AWS.ENCRP;

   2575  1 000031   400007 236100                    LDQ     7,,PR4
         1 000032   300012 756100                    STQ     10,,PR3

      207     2576        /*     Write the data base page.              */
      208     2577    1       IF AWS.ATRIB.CHKSUM THEN

   2577  1 000033   400000 236100                    LDQ     0,,PR4
         1 000034   010000 316003                    CANQ    4096,DU
         1 000035   000050 600000 1                  TZE     s:2583

      209     2578    2       DO;

      210     2579    2           GLOBAL.PARAN.ICKSM.P$=FPT$WRTD.BUF_.BUF$;

   2579  1 000036   300005 236100                    LDQ     5,,PR3
         1 000037   100023 756100                    STQ     19,,PR1

      211     2580    2           CALL ZIM$ICKSM;

   2580  1 000040   000000 631400 2                  EPPR1   0
         1 000041   000000 701000 xent               TSX1    ZIM$ICKSM
         1 000042   000000 011000                    NOP     0

      212     2581    2           PINCRW(FPT$WRTD.BUF_.BUF$,2)->ONEWORD=GLOBAL.PARAN.ICKSM.V;

   2581  1 000043   200004 470500                    LDP0    FPT$,,AUTO
         1 000044   000005 471500                    LDP1    5,,PR0
         1 000045   000000 473400 xsym               LDP3    GLOBAL$
         1 000046   300024 235100                    LDA     20,,PR3
         1 000047   100002 755100                    STA     2,,PR1
PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:48   

      213     2582    2           END;

      214     2583    1       IF AWS.ATRIB.CJRNL AND

   2583  1 000050   200006 470500                    LDP0    AWS$,,AUTO
         1 000051   000000 236100                    LDQ     0,,PR0
         1 000052   100000 316003                    CANQ    32768,DU
         1 000053   000070 600000 1                  TZE     s:2588
         1 000054   000000 471400 xsym               LDP1    GLOBAL$
         1 000055   104622 235100                    LDA     2450,,PR1
         1 000056   000070 600000 1                  TZE     s:2588
         1 000057   000005 235100                    LDA     5,,PR0
         1 000060   000064 600000 1                  TZE     s:2586
         1 000061   104622 236100                    LDQ     2450,,PR1
         1 000062   000005 116100                    CMPQ    5,,PR0
         1 000063   000070 605000 1                  TPL     s:2588

      215     2584    1          GLOBAL.GRANULE~=0 AND
      216     2585    1          (AWS.FIPN=0 OR GLOBAL.GRANULE<AWS.FIPN) THEN
      217     2586    1           CALL ZIM$JCKSMC(BUFNUM);

   2586  1 000064   200003 630500                    EPPR0   @BUFNUM,,AUTO
         1 000065   000001 631400 2                  EPPR1   1
         1 000066   000000 701000 xent               TSX1    ZIM$JCKSMC
         1 000067   000000 011000                    NOP     0

      218     2587        /*             If unprotected write call uncheck */
      219     2588    1       IF AWS.ATRIB.UNPROTECT THEN

   2588  1 000070   200006 470500                    LDP0    AWS$,,AUTO
         1 000071   000000 236100                    LDQ     0,,PR0
         1 000072   400000 316007                    CANQ    -131072,DL
         1 000073   000077 600000 1                  TZE     s:2591

      220     2589    1           CALL ZIM$UNCHECK;

PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:49   
   2589  1 000074   000000 631400 2                  EPPR1   0
         1 000075   000000 701000 xent               TSX1    ZIM$UNCHECK
         1 000076   000000 011000                    NOP     0

      221     2590    2       DO INHIBIT;

      222     2591    2           GLOBAL.BCB.BUF.STATUS.BUSY(BUFNUM)=%YES#;

   2591  1 000077   200003 470700                    LDP0  ! @BUFNUM,,AUTO
         1 000100   000000 236300                    LDQ   ! 0,,PR0
         1 000101   000005 402207                    MPY   ! 5,DL
         1 000102   000000 471600 xsym               LDP1  ! GLOBAL$
         1 000103   000000 620206                    EAX0  ! 0,QL
         1 000104   400000 236207                    LDQ   ! -131072,DL
         1 000105   100206 256310                    ORSQ  ! 134,X0,PR1

      223     2592    2           END;

      224     2593    1       CALL M$WRITE (FPT$WRTD) ALTRET(WRTD_ERR);

   2593  1 000106   200004 470500                    LDP0    FPT$,,AUTO
         1 000107   440001 713400                    CLIMB   alt,write
         1 000110   401400 401760                    pmme    nvectors=4
         1 000111   000152 702000 1                  TSX2    WRTD_ERR

      225     2594    2       IF ZI_WAITIO THEN DO;

   2594  1 000112   000000 234000 xsym               SZN     ZI_WAITIO
         1 000113   000134 605000 1                  TPL     s:2599

      226     2595    2           GLOBAL.BCB.BUF.STATUS.BUSY(BUFNUM) = %NO#;

   2595  1 000114   200003 470500                    LDP0    @BUFNUM,,AUTO
         1 000115   000000 236100                    LDQ     0,,PR0
         1 000116   000005 402007                    MPY     5,DL
         1 000117   000000 471400 xsym               LDP1    GLOBAL$
         1 000120   000000 620006                    EAX0    0,QL
PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:50   
         1 000121   000002 236000 2                  LDQ     2
         1 000122   100206 356110                    ANSQ    134,X0,PR1

      227     2596    2           GLOBAL.BCB.BUF.STATUS.MODIFY(BUFNUM) = %NO#;

   2596  1 000123   000000 236100                    LDQ     0,,PR0
         1 000124   000005 402007                    MPY     5,DL
         1 000125   000000 620006                    EAX0    0,QL
         1 000126   000003 236000 2                  LDQ     3
         1 000127   100206 356110                    ANSQ    134,X0,PR1

      228     2597    2           FPT$WRTD.BUF_.BUF$->ONEWORD = BUFNUM;

   2597  1 000130   200004 473500                    LDP3    FPT$,,AUTO
         1 000131   300005 474500                    LDP4    5,,PR3
         1 000132   000000 235100                    LDA     0,,PR0
         1 000133   400000 755100                    STA     0,,PR4

      229     2598    2           END;

      230     2599    2       IF GLOBAL.PARAN.TRACE.MODE~='0'B THEN DO;

   2599  1 000134   000000 470400 xsym               LDP0    GLOBAL$
         1 000135   000061 235100                    LDA     49,,PR0
         1 000136   000151 600000 1                  TZE     s:2605

      231     2600    2           GLOBAL.PARAN.TRACE.TYPE=TR#PWRITE;

   2600  1 000137   000003 220003                    LDX0    3,DU
         1 000140   000060 740100                    STX0    48,,PR0

      232     2601    2           GLOBAL.PARAN.TRACE.PDCB=AWS.DDCB;

   2601  1 000141   200006 471500                    LDP1    AWS$,,AUTO
         1 000142   100006 221100                    LDX1    6,,PR1
         1 000143   000055 441100                    SXL1    45,,PR0

PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:51   
      233     2602    2           GLOBAL.PARAN.TRACE.PNO=GLOBAL.GRANULE;

   2602  1 000144   004622 235100                    LDA     2450,,PR0
         1 000145   000056 755100                    STA     46,,PR0

      234     2603    2           CALL ZIM$TRACE;

   2603  1 000146   000000 631400 2                  EPPR1   0
         1 000147   000000 701000 xent               TSX1    ZIM$TRACE
         1 000150   000000 011000                    NOP     0

      235     2604    2           END;

      236     2605    1       RETURN;

   2605  1 000151   000000 702200 xent               TSX2  ! X66_ARET

      237     2606        %EJECT;
PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:52   
      238     2607        /* Can't write the page, give alternate return.  */
      239     2608    1   WRTD_ERR:
      240     2609    2       DO INHIBIT;

   2609  1 000152                       WRTD_ERR     null
      241     2610    2           GLOBAL.BCB.BUF.STATUS(BUFNUM)='0'B;

   2610  1 000152   200003 470700                    LDP0  ! @BUFNUM,,AUTO
         1 000153   000000 236300                    LDQ   ! 0,,PR0
         1 000154   000005 402207                    MPY   ! 5,DL
         1 000155   000000 471600 xsym               LDP1  ! GLOBAL$
         1 000156   000000 620206                    EAX0  ! 0,QL
         1 000157   000004 236200 2                  LDQ   ! 4
         1 000160   100206 356310                    ANSQ  ! 134,X0,PR1

      242     2611    2           END;

      243     2612    1       ERROR=ERR#IO#WRTD;

   2612  1 000161   303362 235007                    LDA     100082,DL
         1 000162   200005 755100                    STA     ERROR,,AUTO

      244     2613    1       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   2613  1 000163   000000 473400 xsym               LDP3    B$TCB$
         1 000164   300000 474500                    LDP4    0,,PR3
         1 000165   400102 236100                    LDQ     66,,PR4
         1 000166   100007 756100                    STQ     7,,PR1

      245     2614    1       GLOBAL.RET.DCB#=GLOBAL.WRTD$->FPT$WRTD.V.DCB#;

   2614  1 000167   105074 474500                    LDP4    2620,,PR1
         1 000170   400010 220100                    LDX0    8,,PR4
         1 000171   100014 740100                    STX0    12,,PR1

      246     2615    1       GOTO ALT;

PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:53   
   2615  1 000172   000173 710000 1                  TRA     ER_CKSM

   2614  1 000173                       ER_CKSM      null
   2614  1 000173                       ALT          null
      247     2616    1   ER_CKSM: ;
      248     2617    1   ALT: ;
      249     2618            %DBALT;

   2619  1 000173   100006 235100                    LDA     6,,PR1
         1 000174   000203 601000 1                  TNZ     s:2627

   2621  1 000175   100010 450100                    STZ     8,,PR1

   2622  1 000176   100012 450100                    STZ     10,,PR1

   2623  1 000177   100013 450100                    STZ     11,,PR1

   2624  1 000200   100011 450100                    STZ     9,,PR1

   2625  1 000201   200005 235100                    LDA     ERROR,,AUTO
         1 000202   100006 755100                    STA     6,,PR1

   2627  1 000203   303240 115007                    CMPA    100000,DL
         1 000204   000206 603000 1                  TRC     s:2630

   2628  1 000205   000000 702200 xent               TSX2  ! X66_AALT

   2630  1 000206   000000 631400 2                  EPPR1   0
         1 000207   000000 701000 xent               TSX1    ZIB$ERR
         1 000210   000000 011000                    NOP     0

      250     2632    1   END ZIO$DWRITE;

   2632  1 000211   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:54   
   2     000   000000 000000   000001 000000   777777 377777   777777 577777    ................
   2     004   777777 077777                                                    ..?.

PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:55   
--  Include file information  --

   ZI_ERRORS_C.:ZIC0TOU  is referenced.
   ZI$DBCB.:ZIC0TOU  is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIO$DWRITE.

   Procedure ZIO$DWRITE requires 138 words for executable code.
   Procedure ZIO$DWRITE requires 8 words of local(AUTO) storage.

    No errors detected in file ZIM$RDWRT.:ZIC0TSI    .
PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:56   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:57   
          MINI XREF LISTING

ALT
      2614**LABEL    2615--GOTO
AWS.ATRIB.CHKSUM
      2210**DCL      2577>>IF
AWS.ATRIB.CJRNL
      2207**DCL      2583>>IF
AWS.ATRIB.UNPROTECT
      2221**DCL      2588>>IF
AWS.DDCB
      2228**DCL      2573>>ASSIGN   2601>>ASSIGN
AWS.ENCRP
      2230**DCL      2575>>ASSIGN
AWS.FIPN
      2227**DCL      2583>>IF       2583>>IF
AWS$
      2202**DCL      2203--IMP-PTR  2569<<ASSIGN   2573>>ASSIGN   2575>>ASSIGN   2577>>IF       2583>>IF
      2583>>IF       2583>>IF       2588>>IF       2601>>ASSIGN
B$ALT.CODE
       107**DCL       107--REDEF     108--REDEF     108--REDEF
B$ALT.ERR
       108**DCL      2613>>ASSIGN
B$ALT.ERR.ERR#
       109**DCL       109--REDEF
B$ALT.EVID
       108**DCL       108--REDEF     108--REDEF
B$TCB.ALT$
       103**DCL      2613>>ASSIGN
B$TCB$
        12**DCL      2613>>ASSIGN
BUFNUM
        11**DCL         8--PROC     2569>>ASSIGN   2571>>ASSIGN   2572>>ASSIGN   2574>>ASSIGN   2586<>CALL
      2591>>ASSIGN   2595>>ASSIGN   2596>>ASSIGN   2597>>ASSIGN   2610>>ASSIGN
PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:58   
ERROR
        17**DCL      2612<<ASSIGN   2625>>ASSIGN
F$DCB.ACTPOS
       146**DCL       146--REDEF
F$DCB.ARS#
       120**DCL       120--REDEF
F$DCB.ATTR
       139**DCL       140--REDEF
F$DCB.BORROW
       154**DCL       154--REDEF     154--REDEF     154--REDEF
F$DCB.DCBNAME.L
       168**DCL       168--IMP-SIZ
F$DCB.EOMCHAR#
       124**DCL       124--REDEF
F$DCB.FLDID
       149**DCL       149--REDEF
F$DCB.FORM$
       143**DCL       143--REDEF
F$DCB.FSECT
       159**DCL       159--REDEF
F$DCB.FSN#
       136**DCL       136--REDEF     136--REDEF     137--REDEF
F$DCB.HEADER$
       142**DCL       142--REDEF
F$DCB.IXTNSIZE#
       140**DCL       140--REDEF
F$DCB.LASTSTA$
       129**DCL       129--REDEF
F$DCB.LVL
       155**DCL       155--REDEF
F$DCB.NAME#.C
       130**DCL       130--REDEF
F$DCB.NOEOF
       152**DCL       152--REDEF
F$DCB.NRECS#
       141**DCL       141--REDEF
PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:59   
F$DCB.NRECX
       160**DCL       160--REDEF
F$DCB.OHDR
       152**DCL       152--REDEF
F$DCB.ORG#
       135**DCL       135--REDEF
F$DCB.PRECNO
       158**DCL       158--REDEF
F$DCB.RCSZ
       164**DCL       164--REDEF
F$DCB.RES#
       131**DCL       131--REDEF
F$DCB.SETX
       143**DCL       143--REDEF
F$DCB.TAB$
       143**DCL       143--REDEF
F$DCB.TDA
       157**DCL       158--REDEF
F$DCB.WSN#
       131**DCL       131--REDEF
FPT$
        14**DCL       187--IMP-PTR  2570<<ASSIGN   2572>>ASSIGN   2573>>ASSIGN   2574>>ASSIGN   2575>>ASSIGN
      2579>>ASSIGN   2581>>ASSIGN   2593>>CALL     2597>>ASSIGN
FPT$WRTD
       187**DCL      2593<>CALL
FPT$WRTD.BUF_.BUF$
       189**DCL      2572<<ASSIGN   2579>>ASSIGN   2581>>ASSIGN   2597>>ASSIGN
FPT$WRTD.STATION_
       189**DCL       189--REDEF
FPT$WRTD.V.DCB#
       190**DCL      2573<<ASSIGN   2614>>ASSIGN
FPT$WRTD.V.DVBYTE.VFC#
       196**DCL       196--REDEF
FPT$WRTD.V.EVENT#
       195**DCL      2574<<ASSIGN
FPT$WRTD.V.SEED#
PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:60   
       195**DCL      2575<<ASSIGN
GLOBAL.ACTIVE.DBCB$
      1234**DCL      1235--REDEF
GLOBAL.ACTIVE.SSS$
      1230**DCL      1231--REDEF
GLOBAL.BCB.BUF.AWS$
      1343**DCL      2569>>ASSIGN
GLOBAL.BCB.BUF.BUF$
      1341**DCL      2572>>ASSIGN
GLOBAL.BCB.BUF.PGNO
      1342**DCL      2571>>ASSIGN
GLOBAL.BCB.BUF.STATUS
      1347**DCL      2610<<ASSIGN
GLOBAL.BCB.BUF.STATUS.BUSY
      1348**DCL      2591<<ASSIGN   2595<<ASSIGN
GLOBAL.BCB.BUF.STATUS.MODIFY
      1349**DCL      2596<<ASSIGN
GLOBAL.GRANULE
      1436**DCL      2571<<ASSIGN   2583>>IF       2583>>IF       2602>>ASSIGN
GLOBAL.KEY
      1438**DCL      1441--REDEF
GLOBAL.PARAN.ICKSM.P$
      1281**DCL      2579<<ASSIGN
GLOBAL.PARAN.ICKSM.V
      1282**DCL      2581>>ASSIGN
GLOBAL.PARAN.TRACE.MODE
      1313**DCL      1320--REDEF    2599>>IF
GLOBAL.PARAN.TRACE.PDCB
      1308**DCL      2601<<ASSIGN
GLOBAL.PARAN.TRACE.PNO
      1309**DCL      2602<<ASSIGN
GLOBAL.PARAN.TRACE.TYPE
      1311**DCL      2600<<ASSIGN
GLOBAL.PRINTBUF.BUFFER
      1472**DCL      1473--REDEF    1474--REDEF    1475--REDEF
GLOBAL.PRINTBUF.ERR.V
PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:61   
      1477**DCL      1480--REDEF    1481--REDEF    1482--REDEF
GLOBAL.RET.AC#
      1250**DCL      2621<<ASSIGN
GLOBAL.RET.DCB#
      1254**DCL      2614<<ASSIGN
GLOBAL.RET.ERROR#
      1248**DCL      2619>>IF       2625<<ASSIGN   2627>>IF
GLOBAL.RET.FR#
      1251**DCL      2624<<ASSIGN
GLOBAL.RET.RC#
      1253**DCL      2623<<ASSIGN
GLOBAL.RET.SC#
      1252**DCL      2622<<ASSIGN
GLOBAL.RET.SYSERR#
      1249**DCL      2613<<ASSIGN
GLOBAL.WRTD$
      1491**DCL      2570>>ASSIGN   2614>>ASSIGN
GLOBAL$
      1532**DCL      1228--IMP-PTR  2569>>ASSIGN   2570>>ASSIGN   2571>>ASSIGN   2571>>ASSIGN   2572>>ASSIGN
      2579>>ASSIGN   2581>>ASSIGN   2583>>IF       2583>>IF       2591>>ASSIGN   2595>>ASSIGN   2596>>ASSIGN
      2599>>IF       2600>>ASSIGN   2601>>ASSIGN   2602>>ASSIGN   2602>>ASSIGN   2610>>ASSIGN   2613>>ASSIGN
      2614>>ASSIGN   2614>>ASSIGN   2619>>IF       2621>>ASSIGN   2622>>ASSIGN   2623>>ASSIGN   2624>>ASSIGN
      2625>>ASSIGN   2627>>IF
M$WRITE
        31**DCL-ENT  2593--CALL
ONEWORD
        16**DCL      2581<<ASSIGN   2597<<ASSIGN
WRTD_ERR
      2609**LABEL    2593--CALLALT
ZIB$ERR
      1533**DCL-ENT  2630--CALL
ZIM$ICKSM
        18**DCL-ENT  2580--CALL
ZIM$JCKSMC
        19**DCL-ENT  2586--CALL
ZIM$TRACE
PL6.E3A0      #002=ZIO$DWRITE File=ZIM$RDWRT.:ZIC0TSI                            FRI 09/05/97 13:05 Page:62   
        15**DCL-ENT  2603--CALL
ZIM$UNCHECK
        20**DCL-ENT  2589--CALL
ZI_WAITIO
        13**DCL      2594>>IF
