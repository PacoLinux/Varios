VERSION E05

PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:1    
        1        1        /*M*  FMS$SCFU          SCAN AND MANIPULATE CFU AREAS              */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*MCL=0,MOC,MEC,CLM=12,EXM=12,CRT=6,DMR,PLM=3,IND=3,ENU=0,DCI=3,
        8        8        CSU=3,ECU=3,THI=0,DTI=0,CRM=86 */
        9        9                    /**/
       10       10                    /*F*   NAME:   FMS$SCANACCT
       11       11                     PURPOSE:   TO SCAN THE CFU AREA FOR THE ACCT BLOCK WHICH
       12       12                     DESCRIBES THIS ACCOUNT.  IF FOUND THE CURRENT
       13       13                     FM$CFU.ACCTX IS POINTED TO IT AND ALTRETURN IS TAKEN.
       14       14                     IF NOT, A NEW ENTRY IS BUILT UNLESS DCB.SETX IS ZERO (MAD ACCT).
       15       15                    */
       16       16        FMS$SCANACCT: PROC ALTRET;
       17       17                    /**/
       18       18                    /* AUTOMATIC DATA */
       19       19    1   DCL JDCB$ PTR; /* CURRENT DCB (CONTAINS ACCT)*/
       20       20    1   DCL CFU$ PTR; /* CURRENT CFU POINTER */
       21       21    1   DCL ACCTX SBIN; /* INDEX TO ACCOUNT BLOCK */
       22       22    1   DCL ACCT$ PTR; /* TEMP POINTER */
       23       23                    /**/
       24       24        %INCLUDE F$JIT_C;
       25      454        %INCLUDE F_ERRORS_C;
       26      694        %INCLUDE FM$MACROS;
       27     1069        %FM$CFUA(BASED="BASED(ACCT$)");
       28     1075        %FM$CFU(BASED="BASED(CFU$)");
       29     1081        %FM$CFUX;
       30     1086        %FM$SET(BASED="BASED(FM$SET$)");
       31     1091        %MACRO F$DCB#(BASED=BASED);
       32     1092        %INCLUDE F$DCB;
       33     1141        %MEND;
       34     1142        %F$DCB#(BASED="BASED(JDCB$)");
       35     1192                    /* DEFINE EXTERNAL ROUTINES */
       36     1193    1   DCL FMP$ULIST ENTRY(2)ALTRET;
       37     1194    1   DCL FMR$L8 ENTRY; /* LOCK CFU AREA */
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:2    
       38     1195    1   DCL FMR$U8 ENTRY; /* UNLOCK CFU AREA */
       39     1196    1   DCL FMR$GA ENTRY(2) ALTRET; /* GET AN ACCT BLOCK */
       40     1197    1   DCL FMS$GARBCOL ENTRY ALTRET; /* GARBAGE COLLECTOR */
       41     1198    1   DCL SC_CFUSBAD ENTRY CONV(2,0);
       42     1199    1   DCL B$JIT$ SYMREF READONLY PTR;
       43     1200    1   DCL F$CFU$ PTR SYMREF READONLY;
       44     1201    1   DCL FM$SET$ REDEF F$CFU$ PTR;
       45     1202    1   DCL FM_GCT UBIN SYMREF;
       46     1203    1   DCL FM_SYSACCTX UBIN SYMREF;
       47     1204    1   DCL FM_SYSSETX UBIN SYMREF;
       48     1205        %EJECT;
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:3    
       49     1206    1      JDCB$=B$JIT$->B$JIT.DCB$;
       50     1207    1      CFU$=JDCB$->F$DCB.CFU$;
       51     1208    1   RESCAN:;
       52     1209    1      CALL FMR$L8;
       53     1210    1      ACCT$=PINCRW(F$CFU$,FM$CFUX.ACCTS);
       54     1211    1      ACCTX=FM$CFUX.ACCTS;
       55     1212    1   NXTACCT:;
       56     1213    1      IF FM$CFUA.ACCT=F$DCB.ACCT AND(
       57     1214    1        FM$CFUA.SETX=F$DCB.SETX
       58     1215    1        OR F$DCB.SETX=0 AND NOT FM$CFUA.PRIV
       59     1216    1        ) THEN GOTO FOUND;
       60     1217    2      IF FM$CFUA.LINKX~=0 THEN DO;
       61     1218    2         ACCTX=FM$CFUA.LINKX;
       62     1219    2         ACCT$=PINCRW(F$CFU$,ACCTX);
       63     1220    2         GOTO NXTACCT;
       64     1221    2         END;
       65     1222    2      IF FM$CFUX.ACCTX~=ACCTX THEN DO;
       66     1223    2         CALL SC_CFUSBAD;
       67     1224    2         FM$CFUX.ACCTX=ACCTX;
       68     1225    2         END;
       69     1226    1      IF JDCB$->F$DCB.SETX=0 THEN GOTO RETRET;
       70     1227                    /*
       71     1228                    *  THE ACCT BLOCK WAS NOT FOUND SO BUILD A NEW ONE
       72     1229                    */
       73     1230    1      CALL FMR$GA(ACCT$,ACCTX)ALTRET(RETRET);
       74     1231    1      FM$CFUA.ACCT=JDCB$->F$DCB.ACCT;
       75     1232    1      FM$CFUA.SETX=JDCB$->F$DCB.SETX;
       76     1233    1      IF FM_SYSACCTX=0
       77     1234    1      THEN IF JDCB$->F$DCB.SETX=FM_SYSSETX AND JDCB$->F$DCB.ACCT=':SYS'
       78     1235    1         THEN FM_SYSACCTX=ACCTX;
       79     1236                    /*
       80     1237                    *  NOW CHAIN THIS ACCT BLOCK ONTO THE ACCT BLOCK CHAIN
       81     1238                    *  FM_CFUAS DEFINES THE START OF ACCT BLOCKS.
       82     1239                    *  FM_CFUAX DEFINES THE CURRENT END OF ACCT BLOCKS.
       83     1240                    */
       84     1241    1      PINCRW(F$CFU$,FM$CFUX.ACCTX)->FM$CFUA.LINKX=ACCTX;
       85     1242    1      FM$CFUX.ACCTX=ACCTX;
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:4    
       86     1243    1      FM$CFUA.AGE=FM_GCT; /* MARK USAGE */
       87     1244    1      IF F$DCB.PSN~=' '
       88     1245    1        OR B$JIT.ERR.CODE=%E$NOKEY THEN FM$CFUA.PRIV='1'B;
       89     1246    1      FM$CFU.ACCTX=ACCTX;
       90     1247    1      B$JIT.ERR='0'B;
       91     1248    1   RETRET: CALL FMR$U8;
       92     1249    1      RETURN;
       93     1250                    /*
       94     1251                    *  NOW WE HAVE AN ACCOUNT BLOCK (EITHER WE FOUND ONE OR WE
       95     1252                    *  BUILT ONE.
       96     1253                    */
       97     1254    1   FOUND:
       98     1255    1      IF B$JIT.ERR.CODE~=%E$NOKEY
       99     1256    1        AND F$DCB.PSN=' ' THEN FM$CFUA.PRIV='0'B;
      100     1257    1      FM$CFU.ACCTX=POFFW(ACCT$,F$CFU$);
      101     1258    1      F$DCB.SETX=FM$CFUA.SETX;
      102     1259    1      B$JIT.ERR='0'B;
      103     1260    1      FM$CFUA.AGE=FM_GCT; /* MARK USAGE */
      104     1261    1      CALL FMP$ULIST(FM$SET(F$DCB.SETX))ALTRET(RETRET);
      105     1262    1      IF NOT FM$CFUA.FLAGS.EXIST THEN GOTO RETRET;
      106     1263    1      CALL FMR$U8;
      107     1264    1      ALTRETURN;
      108     1265                    /**/
      109     1266    1   END FMS$SCANACCT;
      110     1267        %EOD;

PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:5    
--  Include file information  --

   F$DCB.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMS$SCANACCT.

   Procedure FMS$SCANACCT requires 156 words for executable code.
   Procedure FMS$SCANACCT requires 10 words of local(AUTO) storage.

PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:6    

 Object Unit name= FMS$SCANACCT                               File name= FMS$SCFU.:E05TOU
 UTS= JUL 29 '97 17:01:13.76 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  FMS$SCANACCT
    1   Proc  even  none   156    234  FMS$SCANACCT
    2  RoData even  none     2      2  FMS$SCANACCT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        0  FMS$SCANACCT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 FMR$L8
 yes     yes           Std       2 FMR$GA
         yes           Std       0 FMR$U8
 yes     yes           Std       2 FMP$ULIST
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:7    

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_CFUSBAD                       r    B$JIT$                           r    F$CFU$
     FM_GCT                                FM_SYSACCTX                           FM_SYSSETX
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:8    


        1        1        /*M*  FMS$SCFU          SCAN AND MANIPULATE CFU AREAS              */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*MCL=0,MOC,MEC,CLM=12,EXM=12,CRT=6,DMR,PLM=3,IND=3,ENU=0,DCI=3,
        8        8        CSU=3,ECU=3,THI=0,DTI=0,CRM=86 */
        9        9                    /**/
       10       10                    /*F*   NAME:   FMS$SCANACCT
       11       11                     PURPOSE:   TO SCAN THE CFU AREA FOR THE ACCT BLOCK WHICH
       12       12                     DESCRIBES THIS ACCOUNT.  IF FOUND THE CURRENT
       13       13                     FM$CFU.ACCTX IS POINTED TO IT AND ALTRETURN IS TAKEN.
       14       14                     IF NOT, A NEW ENTRY IS BUILT UNLESS DCB.SETX IS ZERO (MAD ACCT).
       15       15                    */
       16       16        FMS$SCANACCT: PROC ALTRET;

     16  1 000000   000000 700200 xent  FMS$SCANACCT TSX0  ! X66_AUTO_0
         1 000001   000012 000000                    ZERO    10,0

       17       17                    /**/
       18       18                    /* AUTOMATIC DATA */
       19       19    1   DCL JDCB$ PTR; /* CURRENT DCB (CONTAINS ACCT)*/
       20       20    1   DCL CFU$ PTR; /* CURRENT CFU POINTER */
       21       21    1   DCL ACCTX SBIN; /* INDEX TO ACCOUNT BLOCK */
       22       22    1   DCL ACCT$ PTR; /* TEMP POINTER */
       23       23                    /**/
       24       24        %INCLUDE F$JIT_C;
       25      454        %INCLUDE F_ERRORS_C;
       26      694        %INCLUDE FM$MACROS;
       27     1069        %FM$CFUA(BASED="BASED(ACCT$)");
       28     1075        %FM$CFU(BASED="BASED(CFU$)");
       29     1081        %FM$CFUX;
       30     1086        %FM$SET(BASED="BASED(FM$SET$)");
       31     1091        %MACRO F$DCB#(BASED=BASED);
       32     1092        %INCLUDE F$DCB;
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:9    
       33     1141        %MEND;
       34     1142        %F$DCB#(BASED="BASED(JDCB$)");
       35     1192                    /* DEFINE EXTERNAL ROUTINES */
       36     1193    1   DCL FMP$ULIST ENTRY(2)ALTRET;
       37     1194    1   DCL FMR$L8 ENTRY; /* LOCK CFU AREA */
       38     1195    1   DCL FMR$U8 ENTRY; /* UNLOCK CFU AREA */
       39     1196    1   DCL FMR$GA ENTRY(2) ALTRET; /* GET AN ACCT BLOCK */
       40     1197    1   DCL FMS$GARBCOL ENTRY ALTRET; /* GARBAGE COLLECTOR */
       41     1198    1   DCL SC_CFUSBAD ENTRY CONV(2,0);
       42     1199    1   DCL B$JIT$ SYMREF READONLY PTR;
       43     1200    1   DCL F$CFU$ PTR SYMREF READONLY;
       44     1201    1   DCL FM$SET$ REDEF F$CFU$ PTR;
       45     1202    1   DCL FM_GCT UBIN SYMREF;
       46     1203    1   DCL FM_SYSACCTX UBIN SYMREF;
       47     1204    1   DCL FM_SYSSETX UBIN SYMREF;
       48     1205        %EJECT;
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:10   
       49     1206    1      JDCB$=B$JIT$->B$JIT.DCB$;

   1206  1 000002   000000 470400 xsym               LDP0    B$JIT$
         1 000003   000232 236100                    LDQ     154,,PR0
         1 000004   200003 756100                    STQ     JDCB$,,AUTO

       50     1207    1      CFU$=JDCB$->F$DCB.CFU$;

   1207  1 000005   200003 471500                    LDP1    JDCB$,,AUTO
         1 000006   100066 236100                    LDQ     54,,PR1
         1 000007   200004 756100                    STQ     CFU$,,AUTO

   1207  1 000010                       RESCAN       null
       51     1208    1   RESCAN:;
       52     1209    1      CALL FMR$L8;

   1209  1 000010   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000011   000000 701000 xent               TSX1    FMR$L8
         1 000012   000000 011000                    NOP     0

       53     1210    1      ACCT$=PINCRW(F$CFU$,FM$CFUX.ACCTS);

   1210  1 000013   000000 470400 xsym               LDP0    F$CFU$
         1 000014   000000 720100                    LXL0    0,,PR0
         1 000015   000000 636010                    EAQ     0,X0
         1 000016   000000 036000 xsym               ADLQ    F$CFU$
         1 000017   200006 756100                    STQ     ACCT$,,AUTO

       54     1211    1      ACCTX=FM$CFUX.ACCTS;

   1211  1 000020   000000 236100                    LDQ     0,,PR0
         1 000021   777777 376007                    ANQ     -1,DL
         1 000022   200005 756100                    STQ     ACCTX,,AUTO

   1211  1 000023                       NXTACCT      null
       55     1212    1   NXTACCT:;
       56     1213    1      IF FM$CFUA.ACCT=F$DCB.ACCT AND(
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:11   

   1213  1 000023   200006 470500                    LDP0    ACCT$,,AUTO
         1 000024   200003 471500                    LDP1    JDCB$,,AUTO
         1 000025   040100 106500                    CMPC    fill='040'O
         1 000026   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         1 000027   100020 000010                    ADSC9   16,,PR1                  cn=0,n=8
         1 000030   000041 601000 1                  TNZ     s:1217
         1 000031   100051 720100                    LXL0    41,,PR1
         1 000032   000000 100100                    CMPX0   0,,PR0
         1 000033   000161 600000 1                  TZE     FOUND
         1 000034   000000 100003                    CMPX0   0,DU
         1 000035   000041 601000 1                  TNZ     s:1217
         1 000036   000005 236100                    LDQ     5,,PR0
         1 000037   040000 316003                    CANQ    16384,DU
         1 000040   000161 600000 1                  TZE     FOUND

       57     1214    1        FM$CFUA.SETX=F$DCB.SETX
       58     1215    1        OR F$DCB.SETX=0 AND NOT FM$CFUA.PRIV
       59     1216    1        ) THEN GOTO FOUND;
       60     1217    2      IF FM$CFUA.LINKX~=0 THEN DO;

   1217  1 000041   000000 720100                    LXL0    0,,PR0
         1 000042   000052 600000 1                  TZE     s:1222

       61     1218    2         ACCTX=FM$CFUA.LINKX;

   1218  1 000043   000000 236100                    LDQ     0,,PR0
         1 000044   777777 376007                    ANQ     -1,DL
         1 000045   200005 756100                    STQ     ACCTX,,AUTO

       62     1219    2         ACCT$=PINCRW(F$CFU$,ACCTX);

   1219  1 000046   000022 736000                    QLS     18
         1 000047   000000 036000 xsym               ADLQ    F$CFU$
         1 000050   200006 756100                    STQ     ACCT$,,AUTO

       63     1220    2         GOTO NXTACCT;
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:12   

   1220  1 000051   000023 710000 1                  TRA     NXTACCT

       64     1221    2         END;
       65     1222    2      IF FM$CFUX.ACCTX~=ACCTX THEN DO;

   1222  1 000052   000000 473400 xsym               LDP3    F$CFU$
         1 000053   300001 236100                    LDQ     1,,PR3
         1 000054   000022 772000                    QRL     18
         1 000055   200005 116100                    CMPQ    ACCTX,,AUTO
         1 000056   000064 600000 1                  TZE     s:1226

       66     1223    2         CALL SC_CFUSBAD;

   1223  1 000057   000000 713400 xsym               CLIMB   SC_CFUSBAD
         1 000060   000000 600000 xsid               climb   nvectors=         0

       67     1224    2         FM$CFUX.ACCTX=ACCTX;

   1224  1 000061   200005 720100                    LXL0    ACCTX,,AUTO
         1 000062   000000 470400 xsym               LDP0    F$CFU$
         1 000063   000001 740100                    STX0    1,,PR0

       68     1225    2         END;

       69     1226    1      IF JDCB$->F$DCB.SETX=0 THEN GOTO RETRET;

   1226  1 000064   200003 470500                    LDP0    JDCB$,,AUTO
         1 000065   000051 720100                    LXL0    41,,PR0
         1 000066   000155 600000 1                  TZE     RETRET

       70     1227                    /*
       71     1228                    *  THE ACCT BLOCK WAS NOT FOUND SO BUILD A NEW ONE
       72     1229                    */
       73     1230    1      CALL FMR$GA(ACCT$,ACCTX)ALTRET(RETRET);

   1230  1 000067   200005 631500                    EPPR1   ACCTX,,AUTO
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:13   
         1 000070   200011 451500                    STP1    ACCT$+3,,AUTO
         1 000071   200006 633500                    EPPR3   ACCT$,,AUTO
         1 000072   200010 453500                    STP3    ACCT$+2,,AUTO
         1 000073   200010 630500                    EPPR0   ACCT$+2,,AUTO
         1 000074   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000075   000000 701000 xent               TSX1    FMR$GA
         1 000076   000155 702000 1                  TSX2    RETRET

       74     1231    1      FM$CFUA.ACCT=JDCB$->F$DCB.ACCT;

   1231  1 000077   200006 470500                    LDP0    ACCT$,,AUTO
         1 000100   200003 471500                    LDP1    JDCB$,,AUTO
         1 000101   100020 237100                    LDAQ    16,,PR1
         1 000102   000001 755100                    STA     1,,PR0
         1 000103   000002 756100                    STQ     2,,PR0

       75     1232    1      FM$CFUA.SETX=JDCB$->F$DCB.SETX;

   1232  1 000104   100051 720100                    LXL0    41,,PR1
         1 000105   200006 470500                    LDP0    ACCT$,,AUTO
         1 000106   000000 740100                    STX0    0,,PR0

       76     1233    1      IF FM_SYSACCTX=0

   1233  1 000107   000000 235000 xsym               LDA     FM_SYSACCTX
         1 000110   000123 601000 1                  TNZ     s:1241

       77     1234    1      THEN IF JDCB$->F$DCB.SETX=FM_SYSSETX AND JDCB$->F$DCB.ACCT=':SYS'

   1234  1 000111   100051 236100                    LDQ     41,,PR1
         1 000112   777777 376007                    ANQ     -1,DL
         1 000113   000000 116000 xsym               CMPQ    FM_SYSSETX
         1 000114   000123 601000 1                  TNZ     s:1241
         1 000115   040000 106500                    CMPC    fill='040'O
         1 000116   100020 000010                    ADSC9   16,,PR1                  cn=0,n=8
         1 000117   000000 000004 0                  ADSC9   0                        cn=0,n=4
         1 000120   000123 601000 1                  TNZ     s:1241
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:14   

       78     1235    1         THEN FM_SYSACCTX=ACCTX;

   1235  1 000121   200005 235100                    LDA     ACCTX,,AUTO
         1 000122   000000 755000 xsym               STA     FM_SYSACCTX

       79     1236                    /*
       80     1237                    *  NOW CHAIN THIS ACCT BLOCK ONTO THE ACCT BLOCK CHAIN
       81     1238                    *  FM_CFUAS DEFINES THE START OF ACCT BLOCKS.
       82     1239                    *  FM_CFUAX DEFINES THE CURRENT END OF ACCT BLOCKS.
       83     1240                    */
       84     1241    1      PINCRW(F$CFU$,FM$CFUX.ACCTX)->FM$CFUA.LINKX=ACCTX;

   1241  1 000123   000000 470400 xsym               LDP0    F$CFU$
         1 000124   000001 220100                    LDX0    1,,PR0
         1 000125   200005 721100                    LXL1    ACCTX,,AUTO
         1 000126   000000 441110                    SXL1    0,X0,PR0

       85     1242    1      FM$CFUX.ACCTX=ACCTX;

   1242  1 000127   200005 720100                    LXL0    ACCTX,,AUTO
         1 000130   000001 740100                    STX0    1,,PR0

       86     1243    1      FM$CFUA.AGE=FM_GCT; /* MARK USAGE */

   1243  1 000131   000000 721000 xsym               LXL1    FM_GCT
         1 000132   200006 473500                    LDP3    ACCT$,,AUTO
         1 000133   300006 741100                    STX1    6,,PR3

       87     1244    1      IF F$DCB.PSN~=' '

   1244  1 000134   040000 106500                    CMPC    fill='040'O
         1 000135   100024 000006                    ADSC9   20,,PR1                  cn=0,n=6
         1 000136   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000137   000145 601000 1                  TNZ     s:1245
         1 000140   000000 473400 xsym               LDP3    B$JIT$
         1 000141   300012 236100                    LDQ     10,,PR3
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:15   
         1 000142   377770 376007                    ANQ     131064,DL
         1 000143   001020 116007                    CMPQ    528,DL
         1 000144   000150 601000 1                  TNZ     s:1246

       88     1245    1        OR B$JIT.ERR.CODE=%E$NOKEY THEN FM$CFUA.PRIV='1'B;

   1245  1 000145   200006 473500                    LDP3    ACCT$,,AUTO
         1 000146   040000 236003                    LDQ     16384,DU
         1 000147   300005 256100                    ORSQ    5,,PR3

       89     1246    1      FM$CFU.ACCTX=ACCTX;

   1246  1 000150   200005 720100                    LXL0    ACCTX,,AUTO
         1 000151   200004 473500                    LDP3    CFU$,,AUTO
         1 000152   300002 740100                    STX0    2,,PR3

       90     1247    1      B$JIT.ERR='0'B;

   1247  1 000153   000000 474400 xsym               LDP4    B$JIT$
         1 000154   400012 450100                    STZ     10,,PR4

       91     1248    1   RETRET: CALL FMR$U8;

   1248  1 000155   000002 631400 xsym  RETRET       EPPR1   B_VECTNIL+2
         1 000156   000000 701000 xent               TSX1    FMR$U8
         1 000157   000000 011000                    NOP     0

       92     1249    1      RETURN;

   1249  1 000160   000000 702200 xent               TSX2  ! X66_ARET

       93     1250                    /*
       94     1251                    *  NOW WE HAVE AN ACCOUNT BLOCK (EITHER WE FOUND ONE OR WE
       95     1252                    *  BUILT ONE.
       96     1253                    */
       97     1254    1   FOUND:
       98     1255    1      IF B$JIT.ERR.CODE~=%E$NOKEY
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:16   

   1255  1 000161   000000 473400 xsym  FOUND        LDP3    B$JIT$
         1 000162   300012 236100                    LDQ     10,,PR3
         1 000163   377770 376007                    ANQ     131064,DL
         1 000164   001020 116007                    CMPQ    528,DL
         1 000165   000174 600000 1                  TZE     s:1257
         1 000166   040000 106500                    CMPC    fill='040'O
         1 000167   100024 000006                    ADSC9   20,,PR1                  cn=0,n=6
         1 000170   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000171   000174 601000 1                  TNZ     s:1257

       99     1256    1        AND F$DCB.PSN=' ' THEN FM$CFUA.PRIV='0'B;

   1256  1 000172   000000 236000 2                  LDQ     0
         1 000173   000005 356100                    ANSQ    5,,PR0

      100     1257    1      FM$CFU.ACCTX=POFFW(ACCT$,F$CFU$);

   1257  1 000174   000000 235000 xsym               LDA     F$CFU$
         1 000175   000022 771000                    ARL     18
         1 000176   200010 755100                    STA     ACCT$+2,,AUTO
         1 000177   200006 236100                    LDQ     ACCT$,,AUTO
         1 000200   000022 772000                    QRL     18
         1 000201   200010 136100                    SBLQ    ACCT$+2,,AUTO
         1 000202   000000 620006                    EAX0    0,QL
         1 000203   200004 470500                    LDP0    CFU$,,AUTO
         1 000204   000002 740100                    STX0    2,,PR0

      101     1258    1      F$DCB.SETX=FM$CFUA.SETX;

   1258  1 000205   200006 474500                    LDP4    ACCT$,,AUTO
         1 000206   400000 221100                    LDX1    0,,PR4
         1 000207   100051 441100                    SXL1    41,,PR1

      102     1259    1      B$JIT.ERR='0'B;

   1259  1 000210   300012 450100                    STZ     10,,PR3
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:17   

      103     1260    1      FM$CFUA.AGE=FM_GCT; /* MARK USAGE */

   1260  1 000211   000000 720000 xsym               LXL0    FM_GCT
         1 000212   400006 740100                    STX0    6,,PR4

      104     1261    1      CALL FMP$ULIST(FM$SET(F$DCB.SETX))ALTRET(RETRET);

   1261  1 000213   100051 236100                    LDQ     41,,PR1
         1 000214   000003 736000                    QLS     3
         1 000215   000001 376000 2                  ANQ     1
         1 000216   000022 736000                    QLS     18
         1 000217   000000 036000 xsym               ADLQ    F$CFU$
         1 000220   200010 756100                    STQ     ACCT$+2,,AUTO
         1 000221   200010 630500                    EPPR0   ACCT$+2,,AUTO
         1 000222   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000223   000000 701000 xent               TSX1    FMP$ULIST
         1 000224   000155 702000 1                  TSX2    RETRET

      105     1262    1      IF NOT FM$CFUA.FLAGS.EXIST THEN GOTO RETRET;

   1262  1 000225   200006 470500                    LDP0    ACCT$,,AUTO
         1 000226   000005 234100                    SZN     5,,PR0
         1 000227   000155 605000 1                  TPL     RETRET

      106     1263    1      CALL FMR$U8;

   1263  1 000230   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000231   000000 701000 xent               TSX1    FMR$U8
         1 000232   000000 011000                    NOP     0

      107     1264    1      ALTRETURN;

   1264  1 000233   000000 702200 xent               TSX2  ! X66_AALT

(unnamed)
 Sect OctLoc
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:18   
   0     000   072123 131123                                                    :SYS

(unnamed)
 Sect OctLoc
   2     000   737777 777777   000007 777770                                    ........
      108     1265                    /**/
      109     1266    1   END FMS$SCANACCT;
      110     1267        %EOD;

PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:19   
--  Include file information  --

   F$DCB.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMS$SCANACCT.
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:20   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     6-0-0/w PTR         r     1 ACCT$                      5-0-0/w SBIN        r     1 ACCTX
     4-0-0/w PTR         r     1 CFU$                       3-0-0/w PTR         r     1 JDCB$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 F$CFU$
     0-0-0/w PTR         r     1 FM$SET$                    0-0-0/w UBIN        r     1 FM_GCT
     0-0-0/w UBIN        r     1 FM_SYSACCTX                0-0-0/w UBIN        r     1 FM_SYSSETX

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(288)   r     1 FM$CFU                     0-0-0/w STRC(288)   r     1 FM$CFUA
     0-0-0/w STRC(288)   r     1 FM$CFUX                    0-0-0/w STRC(288)   r     1 FM$SET(0:0)


   Procedure FMS$SCANACCT requires 156 words for executable code.
   Procedure FMS$SCANACCT requires 10 words of local(AUTO) storage.
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:21   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:22   
          MINI XREF LISTING

ACCT$
        22**DCL      1070--IMP-PTR  1210<<ASSIGN   1213>>IF       1213>>IF       1213>>IF       1217>>IF
      1218>>ASSIGN   1219<<ASSIGN   1230<>CALL     1231>>ASSIGN   1232>>ASSIGN   1243>>ASSIGN   1245>>ASSIGN
      1256>>ASSIGN   1257>>ASSIGN   1258>>ASSIGN   1260>>ASSIGN   1262>>IF
ACCTX
        21**DCL      1211<<ASSIGN   1218<<ASSIGN   1219>>ASSIGN   1222>>IF       1224>>ASSIGN   1230<>CALL
      1235>>ASSIGN   1241>>ASSIGN   1242>>ASSIGN   1246>>ASSIGN
B$JIT.DCB$
       441**DCL      1206>>ASSIGN
B$JIT.ERR
       351**DCL      1247<<ASSIGN   1259<<ASSIGN
B$JIT.ERR.CODE
       352**DCL      1244>>IF       1255>>IF
B$JIT.ERR.MID
       352**DCL       352--REDEF
B$JIT$
      1199**DCL       346--IMP-PTR  1206>>ASSIGN   1244>>IF       1247>>ASSIGN   1255>>IF       1259>>ASSIGN
CFU$
        20**DCL      1076--IMP-PTR  1207<<ASSIGN   1246>>ASSIGN   1257>>ASSIGN
F$CFU$
      1200**DCL      1082--IMP-PTR  1201--REDEF    1210>>ASSIGN   1210>>ASSIGN   1211>>ASSIGN   1219>>ASSIGN
      1222>>IF       1224>>ASSIGN   1241>>ASSIGN   1241>>ASSIGN   1242>>ASSIGN   1257>>ASSIGN
F$DCB.ACCT
      1153**DCL      1213>>IF       1231>>ASSIGN   1234>>IF
F$DCB.ACTPOS
      1168**DCL      1168--REDEF
F$DCB.ARS
      1143**DCL      1143--REDEF
F$DCB.ATTR
      1161**DCL      1162--REDEF
F$DCB.BORROW
      1176**DCL      1176--REDEF    1176--REDEF    1176--REDEF
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:23   
F$DCB.CFU$
      1177**DCL      1207>>ASSIGN
F$DCB.DCBNAME.L
      1190**DCL      1190--IMP-SIZ
F$DCB.EOMCHAR
      1147**DCL      1147--REDEF
F$DCB.FLDID
      1171**DCL      1171--REDEF
F$DCB.FORM$
      1165**DCL      1165--REDEF
F$DCB.FSECT
      1181**DCL      1181--REDEF
F$DCB.FSN
      1158**DCL      1158--REDEF    1158--REDEF    1159--REDEF
F$DCB.HEADER$
      1164**DCL      1164--REDEF
F$DCB.IXTNSIZE
      1162**DCL      1162--REDEF
F$DCB.LASTSTA$
      1152**DCL      1152--REDEF
F$DCB.LVL
      1177**DCL      1177--REDEF
F$DCB.NAME.C
      1152**DCL      1152--REDEF
F$DCB.NOEOF
      1173**DCL      1173--REDEF
F$DCB.NRECS
      1163**DCL      1163--REDEF
F$DCB.NRECX
      1182**DCL      1182--REDEF
F$DCB.OHDR
      1174**DCL      1174--REDEF
F$DCB.ORG
      1157**DCL      1157--REDEF
F$DCB.PRECNO
      1180**DCL      1180--REDEF
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:24   
F$DCB.PSN
      1153**DCL      1244>>IF       1255>>IF
F$DCB.RCSZ
      1185**DCL      1185--REDEF
F$DCB.RES
      1153**DCL      1153--REDEF
F$DCB.SETX
      1165**DCL      1165--REDEF    1213>>IF       1213>>IF       1226>>IF       1232>>ASSIGN   1234>>IF
      1258<<ASSIGN   1261>>CALL
F$DCB.TAB$
      1164**DCL      1165--REDEF
F$DCB.TDA
      1179**DCL      1179--REDEF
F$DCB.WSN
      1154**DCL      1154--REDEF
FM$CFU.ACCTX
      1077**DCL      1077--REDEF    1246<<ASSIGN   1257<<ASSIGN
FM$CFUA.ACCT
      1070**DCL      1213>>IF       1231<<ASSIGN
FM$CFUA.AGE
      1073**DCL      1243<<ASSIGN   1260<<ASSIGN
FM$CFUA.FLAGS.EXIST
      1070**DCL      1262>>IF
FM$CFUA.LINKX
      1070**DCL      1217>>IF       1218>>ASSIGN   1241<<ASSIGN
FM$CFUA.PRIV
      1071**DCL      1213>>IF       1245<<ASSIGN   1256<<ASSIGN
FM$CFUA.SETX
      1070**DCL      1213>>IF       1232<<ASSIGN   1258>>ASSIGN
FM$CFUX.ACCTS
      1082**DCL      1210>>ASSIGN   1211>>ASSIGN
FM$CFUX.ACCTX
      1082**DCL      1222>>IF       1224<<ASSIGN   1241>>ASSIGN   1242<<ASSIGN
FM$SET
      1087**DCL      1261<>CALL
FM$SET.USERLIST
PL6.E3A0      #001=FMS$SCANACCT File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:25   
      1088**DCL      1088--REDEF
FM$SET$
      1201**DCL      1087--IMP-PTR  1261>>CALL
FMP$ULIST
      1193**DCL-ENT  1261--CALL
FMR$GA
      1196**DCL-ENT  1230--CALL
FMR$L8
      1194**DCL-ENT  1209--CALL
FMR$U8
      1195**DCL-ENT  1248--CALL     1263--CALL
FM_GCT
      1202**DCL      1243>>ASSIGN   1260>>ASSIGN
FM_SYSACCTX
      1203**DCL      1233>>IF       1235<<ASSIGN
FM_SYSSETX
      1204**DCL      1234>>IF
FOUND
      1255**LABEL    1216--GOTO
JDCB$
        19**DCL      1143--IMP-PTR  1206<<ASSIGN   1207>>ASSIGN   1213>>IF       1213>>IF       1213>>IF
      1226>>IF       1231>>ASSIGN   1232>>ASSIGN   1234>>IF       1234>>IF       1244>>IF       1255>>IF
      1258>>ASSIGN   1261>>CALL
NXTACCT
      1211**LABEL    1220--GOTO
RETRET
      1248**LABEL    1226--GOTO     1230--CALLALT  1261--CALLALT  1262--GOTO
SC_CFUSBAD
      1198**DCL-ENT  1223--CALL

PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:26   
      111        1        /*T***********************************************************/
      112        2        /*T*                                                         */
      113        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      114        4        /*T*                                                         */
      115        5        /*T***********************************************************/
      116        6                    /*F*  NAME:   FMS$SCANNAME
      117        7                    *
      118        8                    *     PURPOSE:   TO SCAN THE CFU NAME AREA FOR THE CURRENT FILE
      119        9                    *                NAME CONTAINED IN THE DCB.
      120       10                    *     ENTRY:  FMS$SCANNAMENW
      121       11                    *           SAME AS SCANNAME BUT ALTRETURN IF PARTIAL CFU
      122       12                    *           CONDITION OCCURS. USED IF ENQUED TO AVOID DEADLOCK.
      123       13                    */
      124       14        FMS$SCANNAME: PROC ALTRET;
      125       15                    /**/
      126       16                    /* AUTOMATIC DATA */
      127       17    1   DCL JDCB$ PTR; /* POINTER TO THE DCB */
      128       18    1   DCL CFU$ PTR; /* POINTER TO THE CFU */
      129       19    1   DCL 1 CFUX REDEF CFU$,
      130       20    1         2 X UBIN HALF UNAL,2 * BIT(18);
      131       21    1   DCL NAME$ PTR; /* POINTER TO THE CFU NAME */
      132       22    1   DCL 1 NAMEX REDEF NAME$,
      133       23    1         2 X UBIN(20) UNAL,2 * BIT(16);
      134       24    1   DCL I SBIN; /* NUMBER HOLDER */
      135       25    1   DCL CFUX$ PTR; /* POINTER FOR OTHER CFU */
      136       26    1   DCL 1 CFUXX REDEF CFUX$,
      137       27    1         2 X UBIN HALF UNAL,2 * BIT(18);
      138       28    1   DCL NOWAIT BIT(1);
      139       29                    /**/
      140       30                    /* SYMREF DATA */
      141       31                    /**/
      142       32    1   DCL FM_CFUBUSY SBIN STATIC SYMDEF INIT(0);
      143       33    1   DCL S_CUN UBIN SYMREF;
      144       34        %INCLUDE JG_GHOSTS_C;
      145      124    1   DCL B$JIT$ PTR SYMREF READONLY; /* POINTER TO THE JIT */
      146      125    1   DCL F$CFU$ PTR SYMREF READONLY;
      147      126        %MACRO F$DCB#(BASED=BASED);
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:27   
      148      127        %INCLUDE F$DCB;
      149      176        %MEND;
      150      177        %F$DCB#(BASED="BASED(JDCB$)");
      151      227        %INCLUDE FM$MACROS;
      152      602        %FM$CFU;
      153      608        %FM$CFUF;
      154      611        %FM$CFUX;
      155      616        %INCLUDE F$JIT_C;
      156     1046        %INCLUDE CP_6_SUBS;
      157     1586        %INCLUDE F_ERRORS_C;
      158     1826        %INCLUDE SS_SCHED_C;
      159     2059        %SUB FCG#='0615'O;
      160     2060        %SUB MID#='23'O;
      161     2061        %ERRCODE(NAME=FMO$E$FILEBUSY,COD#=%E$FILEBUSY);
      162     2065        %ERRCODE(NAME=FMO$E$CREATERR,COD#=%E$CREATERR);
      163     2069        %ERRCODE(NAME=FMS$E$JRNLERR,COD#=%E$JRNLERR);
      164     2073                    /**/
      165     2074                    /* SPECIAL BASED ITEM */
      166     2075                    /**/
      167     2076    1   DCL NAMEI BASED(NAME$) CHAR(I);
      168     2077        %FM$CFUN(BASED="BASED(NAME$)");
      169     2080                    /**/
      170     2081                    /* DEFINE EXTERNAL ROUTINES */
      171     2082    1   DCL FMR$FN ENTRY(1); /* ZAP NAMEX OF A CFU */
      172     2083    1   DCL FMR$L8 ENTRY; /* ENQUEUE ON RESOURCE (SHR)*/
      173     2084    1   DCL FMR$U8 ENTRY; /* DEQUEUE RESOURCE */
      174     2085    1   DCL FMS$GARBCOL ENTRY ALTRET; /* CLEANUP FOR SPACE */
      175     2086    1   DCL FMR$M8 ENTRY(2); /* MOVE INACTIVE CFU DATA */
      176     2087    1   DCL FMR$ZA ENTRY(1); /* FREE A CFU BLOCK */
      177     2088    1   DCL SSR$REG ENTRY(3)ALTRET; /* WAIT A BIT FOR CLOSE TO FINISH */
      178     2089        %EJECT;
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:28   
      179     2090    1      NOWAIT='0'B;
      180     2091    1   SCANNAME:;
      181     2092    1      JDCB$=B$JIT$->B$JIT.DCB$;
      182     2093    1      CFU$=JDCB$->F$DCB.CFU$;
      183     2094    1   RESCAN:;
      184     2095    1      CALL FMR$L8;
      185     2096                    /*
      186     2097                    *  NOW LOOK FOR THIS FILENAME IN THE CFU AREA
      187     2098                    */
      188     2099    1      NAME$=PINCRC(F$CFU$,FM$CFUX.NAMES);
      189     2100    1      CFUX$=PINCRC(F$CFU$,FM$CFUX.NAMEX);
      190     2101    1      I=F$DCB.NAME.L+1;
      191     2102    2      DO WHILE(NAME$<CFUX$);
      192     2103    2         IF ADDR(FM$CFUN.L)->NAMEI=ADDR(F$DCB.NAME)->NAMEI THEN GOTO FOUND;
      193     2104    2         NAME$=PINCRC(NAME$,FM$CFUN.L+3);
      194     2105    2         END;
      195     2106                    /*
      196     2107                    *  THE NAME IS NOT IN THE CFU AREA
      197     2108                    */
      198     2109    2      IF FM$CFUX.NAMEX+34>FM$CFUX.NAMET THEN DO;
      199     2110    2         CALL FMS$GARBCOL ALTRET(ERRET1);
      200     2111    2         NAME$=PINCRC(F$CFU$,FM$CFUX.NAMEX);
      201     2112    2         END;
      202     2113    1      FM$CFUX.NAMEX=FM$CFUX.NAMEX+I+2;
      203     2114    1      CFU$->FM$CFU.NAMEX=NAMEX.X;
      204     2115    1      ADDR(FM$CFUN.L)->NAMEI=ADDR(F$DCB.NAME)->NAMEI;
      205     2116    1   NOTFOUND0: FM$CFUN.LNKX=CFUX.X;
      206     2117    1   NOTFOUND: CFUX$=CFU$;
      207     2118    1      IF F$DCB.ACS=%JRNL# AND F$DCB.FUN~=%CREATE# THEN GOTO FMSE$JRNLERR;
      208     2119    1      CALL FMR$U8;
      209     2120    1      RETURN;
      210     2121                    /**/
      211     2122    1   FMS$SCANNAMENW: ENTRY ALTRET;
      212     2123    1      NOWAIT='1'B;
      213     2124    1      GOTO SCANNAME;
      214     2125        %EJECT;
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:29   
      215     2126                    /*
      216     2127                    *  THE NAME WAS FOUND IN THE CFU AREA (NAMEX IS THE INDEX )
      217     2128                    */
      218     2129    1   FOUND:
      219     2130    1      CFUX$=PINCRW(F$CFU$,FM$CFUN.LNKX);
      220     2131    1      I=-FM$CFUX.CFUT/8;
      221     2132    2      DO WHILE (CFUXX.X<FM$CFUX.CFUT AND I<0);
      222     2133    2         IF CFUX$->FM$CFU.ACCTX=CFU$->FM$CFU.ACCTX THEN GOTO FOUND1;
      223     2134    2         CFUX$=PINCRW(F$CFU$,CFUX$->FM$CFU.NAMEX);
      224     2135    2         IF CFUXX&'000007'O OR CFUXX.X=0 THEN I=0;
      225     2136    2         I=I+1;
      226     2137    2         END;
      227     2138                    /*
      228     2139                    *  NO OTHER CFU FOR THIS FILE EXISTS
      229     2140                    */
      230     2141                    /* LINK OUR CFU TO HEAD OF NAME CHAIN */
      231     2142    1      CFU$->FM$CFU.NAMEX=FM$CFUN.LNKX;
      232     2143    1      GOTO NOTFOUND0;
      233     2144        %EJECT;
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:30   
      234     2145                    /*
      235     2146                    *  ANOTHER CFU IS OPEN TO THIS FILE (OR DEFINES THE FILE)
      236     2147                    */
      237     2148    1   FOUND1:;
      238     2149    1      IF CFUX$->FM$CFU.FUN>%JRNL# OR CFUX$->FM$CFU.FUN=%JRNL#
      239     2150    2        AND S_CUN~=JG_JAYS# AND CFUX$->FM$CFU.XTX=0 THEN DO;
      240     2151    2         CALL FMR$U8;
      241     2152    2         FM_CFUBUSY=FM_CFUBUSY+1;
      242     2153    2         IF NOWAIT THEN ALTRETURN;
      243     2154    2         CALL SSR$REG(%SS_SL,1,1)ALTRET(RESCAN);
      244     2155    2         GOTO RESCAN;
      245     2156    2         END;
      246     2157    1      IF F$DCB.FUN=%CREATE#
      247     2158    1        AND F$DCB.EXIST=%ERROR#
      248     2159    1        AND CFUX$->FM$CFU.FITSDA~=0
      249     2160    1      THEN GOTO ERR110;
      250     2161    2      IF CFUX$->FM$CFU.FUN=0 THEN DO;
      251     2162    2         IF F$DCB.ACS=%JRNL# AND F$DCB.FUN~=%CREATE#
      252     2163    2         THEN GOTO FMSE$JRNLERR;
      253     2164    2         CALL FMR$M8(CFUX$,CFU$);
      254     2165    2         GOTO SETSHARED;
      255     2166    2         END;
      256     2167        %EJECT;
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:31   
      257     2168                    /* CHECK SHAREABILITY */
      258     2169                    /*
      259     2170                    *  DETERMINE MOST POSSIBLE FUNCTION FOR CREATE
      260     2171                    */
      261     2172    1      IF F$DCB.ACS=%JRNL# OR CFUX$->FM$CFU.FUN=%JRNL#
      262     2173    1      THEN IF CFUX$->FM$CFU.FUN=F$DCB.ACS THEN GOTO SETSHARED;
      263     2174    1         ELSE GOTO FMSE$JRNLERR;
      264     2175                    /**/
      265     2176                    /*
      266     2177                    *  PROCESS SHARE TESTS WHEN OUR CFU SAYS 'IN'
      267     2178                    */
      268     2179    2      IF F$DCB.FUN=%IN# THEN DO;
      269     2180    3         DO CASE(CFUX$->FM$CFU.FUN);
      270     2181    3         CASE(%CREATE#);
      271     2182    3            IF CFU$->FM$CFU.SHARE=%ALL# THEN GOTO ERR109;/*NO UPDATING*/
      272     2183    3            CFU$=CFUX$; /* OTHER CFU IS CREATE */
      273     2184    3            CFUX$=JDCB$->F$DCB.CFU$;
      274     2185    3            CFUX$->FM$CFU.NAMEX=FM$CFUN.LNKX; /* LINK US INTO THE CHAIN */
      275     2186    3            FM$CFUN.LNKX=CFUXX.X;
      276     2187    3            CALL FMR$FN(CFU$); /* THEN DECHAIN CREATE CFU */
      277     2188    3            GOTO LINKUP;
      278     2189    3         CASE(%UPDATE#);/* OTHER CFU IS UPDATE */
      279     2190    3            IF CFU$->FM$CFU.SHARE~=%ALL#
      280     2191    3              OR CFUX$->FM$CFU.SHARE=%NONE#
      281     2192    3            THEN GOTO ERR109;
      282     2193    3         CASE(%IN#);/* OTHER CFU IS INPUT */
      283     2194    3            IF CFUX$->FM$CFU.SHARE=%ALL#
      284     2195    3              AND CFU$->FM$CFU.SHARE~=%ALL#
      285     2196    3            THEN GOTO ERR109; /* DONT NAIL SHARING OF A FILE */
      286     2197    3         END;
      287     2198                    /*
      288     2199                    *  PROCESS SHARE TESTS WHEN OUR CFU SAYS 'CREATE'
      289     2200                    */
      290     2201    2         END;
      291     2202    1      ELSE IF F$DCB.FUN=%CREATE# AND F$DCB.EXIST=%NEWFILE#
      292     2203    2           AND NOT B$JIT.FEXT(F$DCB.FEXTX) THEN DO;
      293     2204    2            IF CFUX$->FM$CFU.ACFU>0
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:32   
      294     2205    2              OR CFUX$->FM$CFU.FUN~=%IN#
      295     2206    2              OR CFUX$->FM$CFU.SHARE=%ALL#
      296     2207    2            THEN GOTO ERR109;
      297     2208                    /*
      298     2209                    *  THE OTHER CFU IS 'IN'
      299     2210                    */
      300     2211    2            CFU$->FM$CFU.FITSDA=CFUX$->FM$CFU.FITSDA;
      301     2212    2            GOTO LINKUP;
      302     2213    2            END;
      303     2214    2         ELSE DO;
      304     2215                    /*
      305     2216                    *  PROCESS SHARE TESTS WHEN OUR CFU SAYS 'UPDATE'
      306     2217                    */
      307     2218    2            IF CFUX$->FM$CFU.SHARE~=%ALL#
      308     2219    2              OR CFU$->FM$CFU.SHARE=%NONE#
      309     2220    2              OR CFU$->FM$CFU.SHARE=%IN# AND CFUX$->FM$CFU.FUN=%UPDATE#
      310     2221    2            THEN GOTO ERR109;
      311     2222    2            END;
      312     2223                    /*
      313     2224                    *  HOOK US TO THE OTHER CFU, INCREMENT ITS USE COUNT, AND
      314     2225                    *  ZAP THE CFU WE WERE USING.  SET US 'SHARED'.
      315     2226                    */
      316     2227    1   SETSHARED:;
      317     2228    1      JDCB$->F$DCB.CFU$=CFUX$;
      318     2229    1      CALL FMR$ZA(CFU$);
      319     2230    1      IF F$DCB.ACS~=%JRNL# AND CFUX$->FM$CFU.USECNT>0
      320     2231    1      THEN F$DCB.SHARED='1'B;
      321     2232    1      GOTO SHAREOK;
      322     2233                    /*
      323     2234                    *  NOW LINK UP THE TWO CFUS SO THAT INPUT ONE POINTS TO NAMEX/ACCTX
      324     2235                    *  AND CREATE ONE POINTS TO INPUT ONE.
      325     2236                    */
      326     2237    1   LINKUP: CFU$->FM$CFUF.ACCNAM=POFFW(CFUX$,F$CFU$);
      327     2238    1      CFUX$->FM$CFU.ACFU=1;
      328     2239    1   SHAREOK:;
      329     2240    1      CFUX$->FM$CFU.USECNT=CFUX$->FM$CFU.USECNT+1;
      330     2241    1      CFU$=JDCB$->F$DCB.CFU$;
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:33   
      331     2242    1      CALL FMR$U8;
      332     2243                    /* IF WE FOUND A CREATE CFU FOR INPUT OPEN, WE MUST SRCHFD ANYWAY*/
      333     2244    1      IF CFU$->FM$CFU.FITSDA=0 THEN RETURN;
      334     2245                    /*
      335     2246                    *  NOW WE HAVE THE FIT DISK ADDRESS SO WE DO NOT HAVE TO SEARCH
      336     2247                    *  THE FILE DIRECTORY.
      337     2248                    */
      338     2249    1      ALTRETURN;
      339     2250                    /**/
      340     2251    1   ERR109: B$JIT.ERR=FMO$E$FILEBUSY;
      341     2252    1   ERRET:;
      342     2253    1      IF CFU$->FM$CFU.NAMEX~=0 THEN CALL FMR$FN(CFU$);
      343     2254    1      IF CFUX$->FM$CFU.FUN~=%CREATE#
      344     2255    1      THEN CFU$->FM$CFU.FITSDA=CFUX$->FM$CFU.FITSDA;
      345     2256    1   ERRET1:;
      346     2257    1      CALL FMR$U8;
      347     2258    1      RETURN;
      348     2259                    /**/
      349     2260    1   ERR110: B$JIT.ERR=FMO$E$CREATERR;
      350     2261    1      GOTO ERRET;
      351     2262    1   FMSE$JRNLERR:
      352     2263    1      B$JIT.ERR=FMS$E$JRNLERR;
      353     2264    1      GOTO ERRET;
      354     2265                    /**/
      355     2266                    /**/
      356     2267    1   END FMS$SCANNAME;
      357     2268        %EOD;

PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:34   
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FMS$SCANNAME.

   Procedure FMS$SCANNAME requires 392 words for executable code.
   Procedure FMS$SCANNAME requires 12 words of local(AUTO) storage.

PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:35   

 Object Unit name= FMS$SCANNAME                               File name= FMS$SCFU.:E05TOU
 UTS= JUL 29 '97 17:01:38.92 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none     1      1  FMS$SCANNAME
    1  RoData even  UTS      3      3  FMS$SCANNAME
    2   Proc  even  none   392    610  FMS$SCANNAME
    3  RoData even  none     4      4  FMS$SCANNAME

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        0  FMS$SCANNAME
     2    142          yes     yes      Std        0  FMS$SCANNAMENW

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      0  FM_CFUBUSY
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:36   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 FMR$L8
 yes     yes           Std       0 FMS$GARBCOL
 yes     yes           Std       3 SSR$REG
         yes           Std       1 FMR$ZA
         yes           Std       2 FMR$M8
         yes           Std       1 FMR$FN
         yes           Std       0 FMR$U8
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     S_CUN                            r    B$JIT$                           r    F$CFU$
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:37   


      111        1        /*T***********************************************************/
      112        2        /*T*                                                         */
      113        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      114        4        /*T*                                                         */
      115        5        /*T***********************************************************/
      116        6                    /*F*  NAME:   FMS$SCANNAME
      117        7                    *
      118        8                    *     PURPOSE:   TO SCAN THE CFU NAME AREA FOR THE CURRENT FILE
      119        9                    *                NAME CONTAINED IN THE DCB.
      120       10                    *     ENTRY:  FMS$SCANNAMENW
      121       11                    *           SAME AS SCANNAME BUT ALTRETURN IF PARTIAL CFU
      122       12                    *           CONDITION OCCURS. USED IF ENQUED TO AVOID DEADLOCK.
      123       13                    */
      124       14        FMS$SCANNAME: PROC ALTRET;

     14  2 000000   000000 700200 xent  FMS$SCANNAME TSX0  ! X66_AUTO_0
         2 000001   000014 000000                    ZERO    12,0

      125       15                    /**/
      126       16                    /* AUTOMATIC DATA */
      127       17    1   DCL JDCB$ PTR; /* POINTER TO THE DCB */
      128       18    1   DCL CFU$ PTR; /* POINTER TO THE CFU */
      129       19    1   DCL 1 CFUX REDEF CFU$,
      130       20    1         2 X UBIN HALF UNAL,2 * BIT(18);
      131       21    1   DCL NAME$ PTR; /* POINTER TO THE CFU NAME */
      132       22    1   DCL 1 NAMEX REDEF NAME$,
      133       23    1         2 X UBIN(20) UNAL,2 * BIT(16);
      134       24    1   DCL I SBIN; /* NUMBER HOLDER */
      135       25    1   DCL CFUX$ PTR; /* POINTER FOR OTHER CFU */
      136       26    1   DCL 1 CFUXX REDEF CFUX$,
      137       27    1         2 X UBIN HALF UNAL,2 * BIT(18);
      138       28    1   DCL NOWAIT BIT(1);
      139       29                    /**/
      140       30                    /* SYMREF DATA */
      141       31                    /**/
      142       32    1   DCL FM_CFUBUSY SBIN STATIC SYMDEF INIT(0);
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:38   
      143       33    1   DCL S_CUN UBIN SYMREF;
      144       34        %INCLUDE JG_GHOSTS_C;
      145      124    1   DCL B$JIT$ PTR SYMREF READONLY; /* POINTER TO THE JIT */
      146      125    1   DCL F$CFU$ PTR SYMREF READONLY;
      147      126        %MACRO F$DCB#(BASED=BASED);
      148      127        %INCLUDE F$DCB;
      149      176        %MEND;
      150      177        %F$DCB#(BASED="BASED(JDCB$)");
      151      227        %INCLUDE FM$MACROS;
      152      602        %FM$CFU;
      153      608        %FM$CFUF;
      154      611        %FM$CFUX;
      155      616        %INCLUDE F$JIT_C;
      156     1046        %INCLUDE CP_6_SUBS;
      157     1586        %INCLUDE F_ERRORS_C;
      158     1826        %INCLUDE SS_SCHED_C;
      159     2059        %SUB FCG#='0615'O;
      160     2060        %SUB MID#='23'O;
      161     2061        %ERRCODE(NAME=FMO$E$FILEBUSY,COD#=%E$FILEBUSY);
      162     2065        %ERRCODE(NAME=FMO$E$CREATERR,COD#=%E$CREATERR);
      163     2069        %ERRCODE(NAME=FMS$E$JRNLERR,COD#=%E$JRNLERR);
      164     2073                    /**/
      165     2074                    /* SPECIAL BASED ITEM */
      166     2075                    /**/
      167     2076    1   DCL NAMEI BASED(NAME$) CHAR(I);
      168     2077        %FM$CFUN(BASED="BASED(NAME$)");
      169     2080                    /**/
      170     2081                    /* DEFINE EXTERNAL ROUTINES */
      171     2082    1   DCL FMR$FN ENTRY(1); /* ZAP NAMEX OF A CFU */
      172     2083    1   DCL FMR$L8 ENTRY; /* ENQUEUE ON RESOURCE (SHR)*/
      173     2084    1   DCL FMR$U8 ENTRY; /* DEQUEUE RESOURCE */
      174     2085    1   DCL FMS$GARBCOL ENTRY ALTRET; /* CLEANUP FOR SPACE */
      175     2086    1   DCL FMR$M8 ENTRY(2); /* MOVE INACTIVE CFU DATA */
      176     2087    1   DCL FMR$ZA ENTRY(1); /* FREE A CFU BLOCK */
      177     2088    1   DCL SSR$REG ENTRY(3)ALTRET; /* WAIT A BIT FOR CLOSE TO FINISH */
      178     2089        %EJECT;
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:39   
      179     2090    1      NOWAIT='0'B;

   2090  2 000002   200010 450100                    STZ     NOWAIT,,AUTO

   2090  2 000003                       SCANNAME     null
      180     2091    1   SCANNAME:;
      181     2092    1      JDCB$=B$JIT$->B$JIT.DCB$;

   2092  2 000003   000000 470400 xsym               LDP0    B$JIT$
         2 000004   000232 236100                    LDQ     154,,PR0
         2 000005   200003 756100                    STQ     JDCB$,,AUTO

      182     2093    1      CFU$=JDCB$->F$DCB.CFU$;

   2093  2 000006   200003 471500                    LDP1    JDCB$,,AUTO
         2 000007   100066 236100                    LDQ     54,,PR1
         2 000010   200004 756100                    STQ     CFU$,,AUTO

   2093  2 000011                       RESCAN       null
      183     2094    1   RESCAN:;
      184     2095    1      CALL FMR$L8;

   2095  2 000011   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000012   000000 701000 xent               TSX1    FMR$L8
         2 000013   000000 011000                    NOP     0

      185     2096                    /*
      186     2097                    *  NOW LOOK FOR THIS FILENAME IN THE CFU AREA
      187     2098                    */
      188     2099    1      NAME$=PINCRC(F$CFU$,FM$CFUX.NAMES);

   2099  2 000014   000000 470400 xsym               LDP0    F$CFU$
         2 000015   000001 236100                    LDQ     1,,PR0
         2 000016   777777 376007                    ANQ     -1,DL
         2 000017   000020 736000                    QLS     16
         2 000020   000000 036000 xsym               ADLQ    F$CFU$
         2 000021   200005 756100                    STQ     NAME$,,AUTO
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:40   

      189     2100    1      CFUX$=PINCRC(F$CFU$,FM$CFUX.NAMEX);

   2100  2 000022   000002 236100                    LDQ     2,,PR0
         2 000023   777777 376007                    ANQ     -1,DL
         2 000024   000020 736000                    QLS     16
         2 000025   000000 036000 xsym               ADLQ    F$CFU$
         2 000026   200007 756100                    STQ     CFUX$,,AUTO

      190     2101    1      I=F$DCB.NAME.L+1;

   2101  2 000027   200003 471500                    LDP1    JDCB$,,AUTO
         2 000030   100010 236100                    LDQ     8,,PR1
         2 000031   000033 772000                    QRL     27
         2 000032   000001 036007                    ADLQ    1,DL
         2 000033   200006 756100                    STQ     I,,AUTO

      191     2102    2      DO WHILE(NAME$<CFUX$);

   2102  2 000034   200005 236100                    LDQ     NAME$,,AUTO
         2 000035   200007 116100                    CMPQ    CFUX$,,AUTO
         2 000036   000060 603000 2                  TRC     s:2109

      192     2103    2         IF ADDR(FM$CFUN.L)->NAMEI=ADDR(F$DCB.NAME)->NAMEI THEN GOTO FOUND;

   2103  2 000037   200005 470500                    LDP0    NAME$,,AUTO
         2 000040   200006 720100                    LXL0    I,,AUTO
         2 000041   200003 471500                    LDP1    JDCB$,,AUTO
         2 000042   040140 106540                    CMPC    fill='040'O
         2 000043   000000 400010                    ADSC9   0,,PR0                   cn=2,n=*X0
         2 000044   100010 000010                    ADSC9   8,,PR1                   cn=0,n=*X0
         2 000045   000147 600000 2                  TZE     FOUND

      193     2104    2         NAME$=PINCRC(NAME$,FM$CFUN.L+3);

   2104  2 000046   000100 101500                    MRL     fill='000'O
         2 000047   000000 400001                    ADSC9   0,,PR0                   cn=2,n=1
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:41   
         2 000050   200012 000004                    ADSC9   NOWAIT+2,,AUTO           cn=0,n=4
         2 000051   200012 236100                    LDQ     NOWAIT+2,,AUTO
         2 000052   000020 736000                    QLS     16
         2 000053   600000 036007                    ADLQ    -65536,DL
         2 000054   200005 036100                    ADLQ    NAME$,,AUTO
         2 000055   200005 756100                    STQ     NAME$,,AUTO

      194     2105    2         END;

   2105  2 000056   200007 116100                    CMPQ    CFUX$,,AUTO
         2 000057   000037 602000 2                  TNC     s:2103

      195     2106                    /*
      196     2107                    *  THE NAME IS NOT IN THE CFU AREA
      197     2108                    */
      198     2109    2      IF FM$CFUX.NAMEX+34>FM$CFUX.NAMET THEN DO;

   2109  2 000060   000000 470400 xsym               LDP0    F$CFU$
         2 000061   000002 720100                    LXL0    2,,PR0
         2 000062   000042 621010                    EAX1    34,X0
         2 000063   000003 101100                    CMPX1   3,,PR0
         2 000064   000077 602000 2                  TNC     s:2113
         2 000065   000077 600000 2                  TZE     s:2113

      199     2110    2         CALL FMS$GARBCOL ALTRET(ERRET1);

   2110  2 000066   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000067   000000 701000 xent               TSX1    FMS$GARBCOL
         2 000070   000574 702000 2                  TSX2    ERRET1

      200     2111    2         NAME$=PINCRC(F$CFU$,FM$CFUX.NAMEX);

   2111  2 000071   000000 470400 xsym               LDP0    F$CFU$
         2 000072   000002 236100                    LDQ     2,,PR0
         2 000073   777777 376007                    ANQ     -1,DL
         2 000074   000020 736000                    QLS     16
         2 000075   000000 036000 xsym               ADLQ    F$CFU$
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:42   
         2 000076   200005 756100                    STQ     NAME$,,AUTO

      201     2112    2         END;

      202     2113    1      FM$CFUX.NAMEX=FM$CFUX.NAMEX+I+2;

   2113  2 000077   000002 236100                    LDQ     2,,PR0
         2 000100   777777 376007                    ANQ     -1,DL
         2 000101   200006 036100                    ADLQ    I,,AUTO
         2 000102   000002 620006                    EAX0    2,QL
         2 000103   000002 440100                    SXL0    2,,PR0

      203     2114    1      CFU$->FM$CFU.NAMEX=NAMEX.X;

   2114  2 000104   200005 236100                    LDQ     NAME$,,AUTO
         2 000105   000020 772000                    QRL     16
         2 000106   000000 621006                    EAX1    0,QL
         2 000107   200004 471500                    LDP1    CFU$,,AUTO
         2 000110   100002 441100                    SXL1    2,,PR1

      204     2115    1      ADDR(FM$CFUN.L)->NAMEI=ADDR(F$DCB.NAME)->NAMEI;

   2115  2 000111   200003 471500                    LDP1    JDCB$,,AUTO
         2 000112   200006 720100                    LXL0    I,,AUTO
         2 000113   200005 473500                    LDP3    NAME$,,AUTO
         2 000114   040140 100540                    MLR     fill='040'O
         2 000115   100010 000010                    ADSC9   8,,PR1                   cn=0,n=*X0
         2 000116   300000 400010                    ADSC9   0,,PR3                   cn=2,n=*X0

      205     2116    1   NOTFOUND0: FM$CFUN.LNKX=CFUX.X;

   2116  2 000117   200005 470500       NOTFOUND0    LDP0    NAME$,,AUTO
         2 000120   000100 100500                    MLR     fill='000'O
         2 000121   200004 000002                    ADSC9   CFU$,,AUTO               cn=0,n=2
         2 000122   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2

      206     2117    1   NOTFOUND: CFUX$=CFU$;
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:43   

   2117  2 000123   200004 236100       NOTFOUND     LDQ     CFU$,,AUTO
         2 000124   200007 756100                    STQ     CFUX$,,AUTO

      207     2118    1      IF F$DCB.ACS=%JRNL# AND F$DCB.FUN~=%CREATE# THEN GOTO FMSE$JRNLERR;

   2118  2 000125   200003 471500                    LDP1    JDCB$,,AUTO
         2 000126   100036 236100                    LDQ     30,,PR1
         2 000127   000777 376007                    ANQ     511,DL
         2 000130   000004 116007                    CMPQ    4,DL
         2 000131   000136 601000 2                  TNZ     s:2119
         2 000132   100032 236100                    LDQ     26,,PR1
         2 000133   000777 376003                    ANQ     511,DU
         2 000134   000003 116003                    CMPQ    3,DU
         2 000135   000604 601000 2                  TNZ     FMSE$JRNLERR

      208     2119    1      CALL FMR$U8;

   2119  2 000136   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000137   000000 701000 xent               TSX1    FMR$U8
         2 000140   000000 011000                    NOP     0

      209     2120    1      RETURN;

   2120  2 000141   000000 702200 xent               TSX2  ! X66_ARET

      210     2121                    /**/
      211     2122    1   FMS$SCANNAMENW: ENTRY ALTRET;

   2122  2 000142   000000 700200 xent  FMS$SCANNAM* TSX0  ! X66_AUTO_0
         2 000143   000014 000000                    ZERO    12,0

      212     2123    1      NOWAIT='1'B;

   2123  2 000144   400000 236003                    LDQ     -131072,DU
         2 000145   200010 756100                    STQ     NOWAIT,,AUTO

PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:44   
      213     2124    1      GOTO SCANNAME;

   2124  2 000146   000003 710000 2                  TRA     SCANNAME

      214     2125        %EJECT;
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:45   
      215     2126                    /*
      216     2127                    *  THE NAME WAS FOUND IN THE CFU AREA (NAMEX IS THE INDEX )
      217     2128                    */
      218     2129    1   FOUND:
      219     2130    1      CFUX$=PINCRW(F$CFU$,FM$CFUN.LNKX);

   2130  2 000147   000100 100500       FOUND        MLR     fill='000'O
         2 000150   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         2 000151   200012 000004                    ADSC9   NOWAIT+2,,AUTO           cn=0,n=4
         2 000152   200012 221100                    LDX1    NOWAIT+2,,AUTO
         2 000153   000000 636011                    EAQ     0,X1
         2 000154   000000 036000 xsym               ADLQ    F$CFU$
         2 000155   200007 756100                    STQ     CFUX$,,AUTO

      220     2131    1      I=-FM$CFUX.CFUT/8;

   2131  2 000156   000000 473400 xsym               LDP3    F$CFU$
         2 000157   300002 236100                    LDQ     2,,PR3
         2 000160   000022 772000                    QRL     18
         2 000161   000027 676000 xsym               ERQ     B_VECTNIL+23
         2 000162   000001 036007                    ADLQ    1,DL
         2 000163   000010 506007                    DIV     8,DL
         2 000164   200006 756100                    STQ     I,,AUTO

      221     2132    2      DO WHILE (CFUXX.X<FM$CFUX.CFUT AND I<0);

   2132  2 000165   000206 710000 2                  TRA     s:2137

      222     2133    2         IF CFUX$->FM$CFU.ACCTX=CFU$->FM$CFU.ACCTX THEN GOTO FOUND1;

   2133  2 000166   200007 470500                    LDP0    CFUX$,,AUTO
         2 000167   000002 220100                    LDX0    2,,PR0
         2 000170   200004 471500                    LDP1    CFU$,,AUTO
         2 000171   100002 100100                    CMPX0   2,,PR1
         2 000172   000222 600000 2                  TZE     FOUND1

      223     2134    2         CFUX$=PINCRW(F$CFU$,CFUX$->FM$CFU.NAMEX);
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:46   

   2134  2 000173   000002 721100                    LXL1    2,,PR0
         2 000174   000000 636011                    EAQ     0,X1
         2 000175   000000 036000 xsym               ADLQ    F$CFU$
         2 000176   200007 756100                    STQ     CFUX$,,AUTO

      224     2135    2         IF CFUXX&'000007'O OR CFUXX.X=0 THEN I=0;

   2135  2 000177   200007 236100                    LDQ     CFUX$,,AUTO
         2 000200   000007 376003                    ANQ     7,DU
         2 000201   000204 601000 2                  TNZ     s:2135+5
         2 000202   200007 220100                    LDX0    CFUX$,,AUTO
         2 000203   000205 601000 2                  TNZ     s:2136

   2135  2 000204   200006 450100                    STZ     I,,AUTO

      225     2136    2         I=I+1;

   2136  2 000205   200006 054100                    AOS     I,,AUTO

      226     2137    2         END;

   2137  2 000206   200007 220100                    LDX0    CFUX$,,AUTO
         2 000207   000000 470400 xsym               LDP0    F$CFU$
         2 000210   000002 100100                    CMPX0   2,,PR0
         2 000211   000214 603000 2                  TRC     s:2142
         2 000212   200006 235100                    LDA     I,,AUTO
         2 000213   000166 604000 2                  TMI     s:2133

      227     2138                    /*
      228     2139                    *  NO OTHER CFU FOR THIS FILE EXISTS
      229     2140                    */
      230     2141                    /* LINK OUR CFU TO HEAD OF NAME CHAIN */
      231     2142    1      CFU$->FM$CFU.NAMEX=FM$CFUN.LNKX;

   2142  2 000214   200005 471500                    LDP1    NAME$,,AUTO
         2 000215   200004 473500                    LDP3    CFU$,,AUTO
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:47   
         2 000216   000100 100500                    MLR     fill='000'O
         2 000217   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2
         2 000220   300002 400002                    ADSC9   2,,PR3                   cn=2,n=2

      232     2143    1      GOTO NOTFOUND0;

   2143  2 000221   000117 710000 2                  TRA     NOTFOUND0

   2142  2 000222                       FOUND1       null
      233     2144        %EJECT;
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:48   
      234     2145                    /*
      235     2146                    *  ANOTHER CFU IS OPEN TO THIS FILE (OR DEFINES THE FILE)
      236     2147                    */
      237     2148    1   FOUND1:;
      238     2149    1      IF CFUX$->FM$CFU.FUN>%JRNL# OR CFUX$->FM$CFU.FUN=%JRNL#

   2149  2 000222   000000 236100                    LDQ     0,,PR0
         2 000223   700000 376003                    ANQ     -32768,DU
         2 000224   500000 116003                    CMPQ    -98304,DU
         2 000225   000235 603000 2                  TRC     s:2151
         2 000226   400000 116003                    CMPQ    -131072,DU
         2 000227   000251 601000 2                  TNZ     s:2157
         2 000230   000000 235000 xsym               LDA     S_CUN
         2 000231   000015 115007                    CMPA    13,DL
         2 000232   000251 600000 2                  TZE     s:2157
         2 000233   000003 221100                    LDX1    3,,PR0
         2 000234   000251 601000 2                  TNZ     s:2157

      239     2150    2        AND S_CUN~=JG_JAYS# AND CFUX$->FM$CFU.XTX=0 THEN DO;

      240     2151    2         CALL FMR$U8;

   2151  2 000235   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000236   000000 701000 xent               TSX1    FMR$U8
         2 000237   000000 011000                    NOP     0

      241     2152    2         FM_CFUBUSY=FM_CFUBUSY+1;

   2152  2 000240   000000 054000 0                  AOS     FM_CFUBUSY

      242     2153    2         IF NOWAIT THEN ALTRETURN;

   2153  2 000241   200010 234100                    SZN     NOWAIT,,AUTO
         2 000242   000244 605000 2                  TPL     s:2154

   2153  2 000243   000000 702200 xent               TSX2  ! X66_AALT

PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:49   
      243     2154    2         CALL SSR$REG(%SS_SL,1,1)ALTRET(RESCAN);

   2154  2 000244   000001 630400 3                  EPPR0   1
         2 000245   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000246   000000 701000 xent               TSX1    SSR$REG
         2 000247   000011 702000 2                  TSX2    RESCAN

      244     2155    2         GOTO RESCAN;

   2155  2 000250   000011 710000 2                  TRA     RESCAN

      245     2156    2         END;
      246     2157    1      IF F$DCB.FUN=%CREATE#

   2157  2 000251   200003 473500                    LDP3    JDCB$,,AUTO
         2 000252   300032 236100                    LDQ     26,,PR3
         2 000253   000777 376003                    ANQ     511,DU
         2 000254   000003 116003                    CMPQ    3,DU
         2 000255   000265 601000 2                  TNZ     s:2161
         2 000256   300031 236100                    LDQ     25,,PR3
         2 000257   003000 376007                    ANQ     1536,DL
         2 000260   001000 116007                    CMPQ    512,DL
         2 000261   000265 601000 2                  TNZ     s:2161
         2 000262   000000 236100                    LDQ     0,,PR0
         2 000263   000032 316000 xsym               CANQ    B_VECTNIL+26
         2 000264   000600 601000 2                  TNZ     ERR110

      247     2158    1        AND F$DCB.EXIST=%ERROR#
      248     2159    1        AND CFUX$->FM$CFU.FITSDA~=0
      249     2160    1      THEN GOTO ERR110;
      250     2161    2      IF CFUX$->FM$CFU.FUN=0 THEN DO;

   2161  2 000265   000000 236100                    LDQ     0,,PR0
         2 000266   700000 316003                    CANQ    -32768,DU
         2 000267   000311 601000 2                  TNZ     s:2172

      251     2162    2         IF F$DCB.ACS=%JRNL# AND F$DCB.FUN~=%CREATE#
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:50   

   2162  2 000270   300036 236100                    LDQ     30,,PR3
         2 000271   000777 376007                    ANQ     511,DL
         2 000272   000004 116007                    CMPQ    4,DL
         2 000273   000300 601000 2                  TNZ     s:2164
         2 000274   300032 236100                    LDQ     26,,PR3
         2 000275   000777 376003                    ANQ     511,DU
         2 000276   000003 116003                    CMPQ    3,DU
         2 000277   000604 601000 2                  TNZ     FMSE$JRNLERR

      252     2163    2         THEN GOTO FMSE$JRNLERR;
      253     2164    2         CALL FMR$M8(CFUX$,CFU$);

   2164  2 000300   200004 634500                    EPPR4   CFU$,,AUTO
         2 000301   200013 454500                    STP4    NOWAIT+3,,AUTO
         2 000302   200007 635500                    EPPR5   CFUX$,,AUTO
         2 000303   200012 455500                    STP5    NOWAIT+2,,AUTO
         2 000304   200012 630500                    EPPR0   NOWAIT+2,,AUTO
         2 000305   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000306   000000 701000 xent               TSX1    FMR$M8
         2 000307   000000 011000                    NOP     0

      254     2165    2         GOTO SETSHARED;

   2165  2 000310   000471 710000 2                  TRA     SETSHARED

      255     2166    2         END;
      256     2167        %EJECT;
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:51   
      257     2168                    /* CHECK SHAREABILITY */
      258     2169                    /*
      259     2170                    *  DETERMINE MOST POSSIBLE FUNCTION FOR CREATE
      260     2171                    */
      261     2172    1      IF F$DCB.ACS=%JRNL# OR CFUX$->FM$CFU.FUN=%JRNL#

   2172  2 000311   300036 236100                    LDQ     30,,PR3
         2 000312   000777 376007                    ANQ     511,DL
         2 000313   000004 116007                    CMPQ    4,DL
         2 000314   000321 600000 2                  TZE     s:2173
         2 000315   000000 236100                    LDQ     0,,PR0
         2 000316   700000 376003                    ANQ     -32768,DU
         2 000317   400000 116003                    CMPQ    -131072,DU
         2 000320   000331 601000 2                  TNZ     s:2179

      262     2173    1      THEN IF CFUX$->FM$CFU.FUN=F$DCB.ACS THEN GOTO SETSHARED;

   2173  2 000321   300036 236100                    LDQ     30,,PR3
         2 000322   000777 376007                    ANQ     511,DL
         2 000323   200012 756100                    STQ     NOWAIT+2,,AUTO
         2 000324   000000 236100                    LDQ     0,,PR0
         2 000325   000041 772000                    QRL     33
         2 000326   200012 116100                    CMPQ    NOWAIT+2,,AUTO
         2 000327   000471 600000 2                  TZE     SETSHARED

      263     2174    1         ELSE GOTO FMSE$JRNLERR;

   2174  2 000330   000604 710000 2                  TRA     FMSE$JRNLERR

      264     2175                    /**/
      265     2176                    /*
      266     2177                    *  PROCESS SHARE TESTS WHEN OUR CFU SAYS 'IN'
      267     2178                    */
      268     2179    2      IF F$DCB.FUN=%IN# THEN DO;

   2179  2 000331   300032 236100                    LDQ     26,,PR3
         2 000332   000777 376003                    ANQ     511,DU
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:52   
         2 000333   000002 116003                    CMPQ    2,DU
         2 000334   000417 601000 2                  TNZ     s:2202

      269     2180    3         DO CASE(CFUX$->FM$CFU.FUN);

   2180  2 000335   000000 236100                    LDQ     0,,PR0
         2 000336   000041 772000                    QRL     33
         2 000337   000004 116007                    CMPQ    4,DL
         2 000340   000342 602006 2                  TNC     s:2180+5,QL
         2 000341   000471 710000 2                  TRA     SETSHARED
         2 000342   000416 710000 2                  TRA     s:2201
         2 000343   000375 710000 2                  TRA     s:2190
         2 000344   000406 710000 2                  TRA     s:2194
         2 000345   000346 710000 2                  TRA     s:2182

      270     2181    3         CASE(%CREATE#);

      271     2182    3            IF CFU$->FM$CFU.SHARE=%ALL# THEN GOTO ERR109;/*NO UPDATING*/

   2182  2 000346   100000 236100                    LDQ     0,,PR1
         2 000347   060000 376003                    ANQ     24576,DU
         2 000350   020000 116003                    CMPQ    8192,DU
         2 000351   000550 600000 2                  TZE     ERR109

      272     2183    3            CFU$=CFUX$; /* OTHER CFU IS CREATE */

   2183  2 000352   200007 236100                    LDQ     CFUX$,,AUTO
         2 000353   200004 756100                    STQ     CFU$,,AUTO

      273     2184    3            CFUX$=JDCB$->F$DCB.CFU$;

   2184  2 000354   300066 236100                    LDQ     54,,PR3
         2 000355   200007 756100                    STQ     CFUX$,,AUTO

      274     2185    3            CFUX$->FM$CFU.NAMEX=FM$CFUN.LNKX; /* LINK US INTO THE CHAIN */

   2185  2 000356   200005 470500                    LDP0    NAME$,,AUTO
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:53   
         2 000357   200007 471500                    LDP1    CFUX$,,AUTO
         2 000360   000100 100500                    MLR     fill='000'O
         2 000361   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         2 000362   100002 400002                    ADSC9   2,,PR1                   cn=2,n=2

      275     2186    3            FM$CFUN.LNKX=CFUXX.X;

   2186  2 000363   000100 100500                    MLR     fill='000'O
         2 000364   200007 000002                    ADSC9   CFUX$,,AUTO              cn=0,n=2
         2 000365   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2

      276     2187    3            CALL FMR$FN(CFU$); /* THEN DECHAIN CREATE CFU */

   2187  2 000366   200004 631500                    EPPR1   CFU$,,AUTO
         2 000367   200012 451500                    STP1    NOWAIT+2,,AUTO
         2 000370   200012 630500                    EPPR0   NOWAIT+2,,AUTO
         2 000371   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000372   000000 701000 xent               TSX1    FMR$FN
         2 000373   000000 011000                    NOP     0

      277     2188    3            GOTO LINKUP;

   2188  2 000374   000515 710000 2                  TRA     LINKUP

      278     2189    3         CASE(%UPDATE#);/* OTHER CFU IS UPDATE */

      279     2190    3            IF CFU$->FM$CFU.SHARE~=%ALL#

   2190  2 000375   100000 236100                    LDQ     0,,PR1
         2 000376   060000 376003                    ANQ     24576,DU
         2 000377   020000 116003                    CMPQ    8192,DU
         2 000400   000550 601000 2                  TNZ     ERR109
         2 000401   000000 236100                    LDQ     0,,PR0
         2 000402   060000 376003                    ANQ     24576,DU
         2 000403   060000 116003                    CMPQ    24576,DU
         2 000404   000550 600000 2                  TZE     ERR109
         2 000405   000471 710000 2                  TRA     SETSHARED
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:54   

      280     2191    3              OR CFUX$->FM$CFU.SHARE=%NONE#
      281     2192    3            THEN GOTO ERR109;
      282     2193    3         CASE(%IN#);/* OTHER CFU IS INPUT */

      283     2194    3            IF CFUX$->FM$CFU.SHARE=%ALL#

   2194  2 000406   000000 236100                    LDQ     0,,PR0
         2 000407   060000 376003                    ANQ     24576,DU
         2 000410   020000 116003                    CMPQ    8192,DU
         2 000411   000416 601000 2                  TNZ     s:2201
         2 000412   100000 236100                    LDQ     0,,PR1
         2 000413   060000 376003                    ANQ     24576,DU
         2 000414   020000 116003                    CMPQ    8192,DU
         2 000415   000550 601000 2                  TNZ     ERR109

      284     2195    3              AND CFU$->FM$CFU.SHARE~=%ALL#
      285     2196    3            THEN GOTO ERR109; /* DONT NAIL SHARING OF A FILE */
      286     2197    3         END;

      287     2198                    /*
      288     2199                    *  PROCESS SHARE TESTS WHEN OUR CFU SAYS 'CREATE'
      289     2200                    */
      290     2201    2         END;

   2201  2 000416   000471 710000 2                  TRA     SETSHARED

      291     2202    1      ELSE IF F$DCB.FUN=%CREATE# AND F$DCB.EXIST=%NEWFILE#

   2202  2 000417   000003 116003                    CMPQ    3,DU
         2 000420   000453 601000 2                  TNZ     s:2218
         2 000421   300031 236100                    LDQ     25,,PR3
         2 000422   003000 376007                    ANQ     1536,DL
         2 000423   003000 116007                    CMPQ    1536,DL
         2 000424   000453 601000 2                  TNZ     s:2218
         2 000425   300034 236100                    LDQ     28,,PR3
         2 000426   000011 772000                    QRL     9
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:55   
         2 000427   000777 376007                    ANQ     511,DL
         2 000430   000000 474400 xsym               LDP4    B$JIT$
         2 000431   000000 066506                    CMPB    filb='0'B
         2 000432   400220 000001                    BDSC    144,Q,PR4                by=0,bit=0,n=1
         2 000433   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         2 000434   000453 601000 2                  TNZ     s:2218

      292     2203    2           AND NOT B$JIT.FEXT(F$DCB.FEXTX) THEN DO;

      293     2204    2            IF CFUX$->FM$CFU.ACFU>0

   2204  2 000435   000000 236100                    LDQ     0,,PR0
         2 000436   010000 316003                    CANQ    4096,DU
         2 000437   000550 601000 2                  TNZ     ERR109
         2 000440   000000 236100                    LDQ     0,,PR0
         2 000441   700000 376003                    ANQ     -32768,DU
         2 000442   200000 116003                    CMPQ    65536,DU
         2 000443   000550 601000 2                  TNZ     ERR109
         2 000444   000000 236100                    LDQ     0,,PR0
         2 000445   060000 376003                    ANQ     24576,DU
         2 000446   020000 116003                    CMPQ    8192,DU
         2 000447   000550 600000 2                  TZE     ERR109

      294     2205    2              OR CFUX$->FM$CFU.FUN~=%IN#
      295     2206    2              OR CFUX$->FM$CFU.SHARE=%ALL#
      296     2207    2            THEN GOTO ERR109;
      297     2208                    /*
      298     2209                    *  THE OTHER CFU IS 'IN'
      299     2210                    */
      300     2211    2            CFU$->FM$CFU.FITSDA=CFUX$->FM$CFU.FITSDA;

   2211  2 000450   000000 236100                    LDQ     0,,PR0
         2 000451   100000 552134                    STBQ    0,'34'O,PR1

      301     2212    2            GOTO LINKUP;

   2212  2 000452   000515 710000 2                  TRA     LINKUP
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:56   

      302     2213    2            END;
      303     2214    2         ELSE DO;

      304     2215                    /*
      305     2216                    *  PROCESS SHARE TESTS WHEN OUR CFU SAYS 'UPDATE'
      306     2217                    */
      307     2218    2            IF CFUX$->FM$CFU.SHARE~=%ALL#

   2218  2 000453   000000 236100                    LDQ     0,,PR0
         2 000454   060000 376003                    ANQ     24576,DU
         2 000455   020000 116003                    CMPQ    8192,DU
         2 000456   000550 601000 2                  TNZ     ERR109
         2 000457   100000 236100                    LDQ     0,,PR1
         2 000460   060000 376003                    ANQ     24576,DU
         2 000461   060000 116003                    CMPQ    24576,DU
         2 000462   000550 600000 2                  TZE     ERR109
         2 000463   040000 116003                    CMPQ    16384,DU
         2 000464   000471 601000 2                  TNZ     SETSHARED
         2 000465   000000 236100                    LDQ     0,,PR0
         2 000466   700000 376003                    ANQ     -32768,DU
         2 000467   100000 116003                    CMPQ    32768,DU
         2 000470   000550 600000 2                  TZE     ERR109

      308     2219    2              OR CFU$->FM$CFU.SHARE=%NONE#
      309     2220    2              OR CFU$->FM$CFU.SHARE=%IN# AND CFUX$->FM$CFU.FUN=%UPDATE#
      310     2221    2            THEN GOTO ERR109;
      311     2222    2            END;

   2218  2 000471                       SETSHARED    null
      312     2223                    /*
      313     2224                    *  HOOK US TO THE OTHER CFU, INCREMENT ITS USE COUNT, AND
      314     2225                    *  ZAP THE CFU WE WERE USING.  SET US 'SHARED'.
      315     2226                    */
      316     2227    1   SETSHARED:;
      317     2228    1      JDCB$->F$DCB.CFU$=CFUX$;

PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:57   
   2228  2 000471   200007 236100                    LDQ     CFUX$,,AUTO
         2 000472   200003 470500                    LDP0    JDCB$,,AUTO
         2 000473   000066 756100                    STQ     54,,PR0

      318     2229    1      CALL FMR$ZA(CFU$);

   2229  2 000474   200004 631500                    EPPR1   CFU$,,AUTO
         2 000475   200012 451500                    STP1    NOWAIT+2,,AUTO
         2 000476   200012 630500                    EPPR0   NOWAIT+2,,AUTO
         2 000477   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000500   000000 701000 xent               TSX1    FMR$ZA
         2 000501   000000 011000                    NOP     0

      319     2230    1      IF F$DCB.ACS~=%JRNL# AND CFUX$->FM$CFU.USECNT>0

   2230  2 000502   200003 470500                    LDP0    JDCB$,,AUTO
         2 000503   000036 236100                    LDQ     30,,PR0
         2 000504   000777 376007                    ANQ     511,DL
         2 000505   000004 116007                    CMPQ    4,DL
         2 000506   000514 600000 2                  TZE     s:2232
         2 000507   200007 471500                    LDP1    CFUX$,,AUTO
         2 000510   100003 720100                    LXL0    3,,PR1
         2 000511   000514 600000 2                  TZE     s:2232

      320     2231    1      THEN F$DCB.SHARED='1'B;

   2231  2 000512   100000 236003                    LDQ     32768,DU
         2 000513   000064 256100                    ORSQ    52,,PR0

      321     2232    1      GOTO SHAREOK;

   2232  2 000514   000530 710000 2                  TRA     SHAREOK

      322     2233                    /*
      323     2234                    *  NOW LINK UP THE TWO CFUS SO THAT INPUT ONE POINTS TO NAMEX/ACCTX
      324     2235                    *  AND CREATE ONE POINTS TO INPUT ONE.
      325     2236                    */
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:58   
      326     2237    1   LINKUP: CFU$->FM$CFUF.ACCNAM=POFFW(CFUX$,F$CFU$);

   2237  2 000515   000000 235000 xsym  LINKUP       LDA     F$CFU$
         2 000516   000022 771000                    ARL     18
         2 000517   200012 755100                    STA     NOWAIT+2,,AUTO
         2 000520   200007 236100                    LDQ     CFUX$,,AUTO
         2 000521   000022 772000                    QRL     18
         2 000522   200012 136100                    SBLQ    NOWAIT+2,,AUTO
         2 000523   200004 470500                    LDP0    CFU$,,AUTO
         2 000524   000002 756100                    STQ     2,,PR0

      327     2238    1      CFUX$->FM$CFU.ACFU=1;

   2238  2 000525   200007 470500                    LDP0    CFUX$,,AUTO
         2 000526   010000 236003                    LDQ     4096,DU
         2 000527   000000 256100                    ORSQ    0,,PR0

   2238  2 000530                       SHAREOK      null
      328     2239    1   SHAREOK:;
      329     2240    1      CFUX$->FM$CFU.USECNT=CFUX$->FM$CFU.USECNT+1;

   2240  2 000530   200007 470500                    LDP0    CFUX$,,AUTO
         2 000531   000003 720100                    LXL0    3,,PR0
         2 000532   000001 621010                    EAX1    1,X0
         2 000533   000003 441100                    SXL1    3,,PR0

      330     2241    1      CFU$=JDCB$->F$DCB.CFU$;

   2241  2 000534   200003 470500                    LDP0    JDCB$,,AUTO
         2 000535   000066 236100                    LDQ     54,,PR0
         2 000536   200004 756100                    STQ     CFU$,,AUTO

      331     2242    1      CALL FMR$U8;

   2242  2 000537   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000540   000000 701000 xent               TSX1    FMR$U8
         2 000541   000000 011000                    NOP     0
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:59   

      332     2243                    /* IF WE FOUND A CREATE CFU FOR INPUT OPEN, WE MUST SRCHFD ANYWAY*/
      333     2244    1      IF CFU$->FM$CFU.FITSDA=0 THEN RETURN;

   2244  2 000542   200004 470500                    LDP0    CFU$,,AUTO
         2 000543   000000 236100                    LDQ     0,,PR0
         2 000544   000032 316000 xsym               CANQ    B_VECTNIL+26
         2 000545   000547 601000 2                  TNZ     s:2249

   2244  2 000546   000000 702200 xent               TSX2  ! X66_ARET

      334     2245                    /*
      335     2246                    *  NOW WE HAVE THE FIT DISK ADDRESS SO WE DO NOT HAVE TO SEARCH
      336     2247                    *  THE FILE DIRECTORY.
      337     2248                    */
      338     2249    1      ALTRETURN;

   2249  2 000547   000000 702200 xent               TSX2  ! X66_AALT

      339     2250                    /**/
      340     2251    1   ERR109: B$JIT.ERR=FMO$E$FILEBUSY;

   2251  2 000550   000000 236000 1     ERR109       LDQ     FMO$E$FILEBUSY
         2 000551   000000 474400 xsym               LDP4    B$JIT$
         2 000552   400012 756100                    STQ     10,,PR4

   2244  2 000553                       ERRET        null
      341     2252    1   ERRET:;
      342     2253    1      IF CFU$->FM$CFU.NAMEX~=0 THEN CALL FMR$FN(CFU$);

   2253  2 000553   200004 470500                    LDP0    CFU$,,AUTO
         2 000554   000002 720100                    LXL0    2,,PR0
         2 000555   000564 600000 2                  TZE     s:2254

   2253  2 000556   200004 631500                    EPPR1   CFU$,,AUTO
         2 000557   200012 451500                    STP1    NOWAIT+2,,AUTO
         2 000560   200012 630500                    EPPR0   NOWAIT+2,,AUTO
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:60   
         2 000561   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000562   000000 701000 xent               TSX1    FMR$FN
         2 000563   000000 011000                    NOP     0

      343     2254    1      IF CFUX$->FM$CFU.FUN~=%CREATE#

   2254  2 000564   200007 470500                    LDP0    CFUX$,,AUTO
         2 000565   000000 236100                    LDQ     0,,PR0
         2 000566   700000 376003                    ANQ     -32768,DU
         2 000567   300000 116003                    CMPQ    98304,DU
         2 000570   000574 600000 2                  TZE     ERRET1

      344     2255    1      THEN CFU$->FM$CFU.FITSDA=CFUX$->FM$CFU.FITSDA;

   2255  2 000571   200004 471500                    LDP1    CFU$,,AUTO
         2 000572   000000 236100                    LDQ     0,,PR0
         2 000573   100000 552134                    STBQ    0,'34'O,PR1

   2254  2 000574                       ERRET1       null
      345     2256    1   ERRET1:;
      346     2257    1      CALL FMR$U8;

   2257  2 000574   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000575   000000 701000 xent               TSX1    FMR$U8
         2 000576   000000 011000                    NOP     0

      347     2258    1      RETURN;

   2258  2 000577   000000 702200 xent               TSX2  ! X66_ARET

      348     2259                    /**/
      349     2260    1   ERR110: B$JIT.ERR=FMO$E$CREATERR;

   2260  2 000600   000001 236000 1     ERR110       LDQ     FMO$E$CREATERR
         2 000601   000000 474400 xsym               LDP4    B$JIT$
         2 000602   400012 756100                    STQ     10,,PR4

PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:61   
      350     2261    1      GOTO ERRET;

   2261  2 000603   000553 710000 2                  TRA     ERRET

      351     2262    1   FMSE$JRNLERR:
      352     2263    1      B$JIT.ERR=FMS$E$JRNLERR;

   2263  2 000604   000002 236000 1     FMSE$JRNLERR LDQ     FMS$E$JRNLERR
         2 000605   000000 470400 xsym               LDP0    B$JIT$
         2 000606   000012 756100                    STQ     10,,PR0

      353     2264    1      GOTO ERRET;

   2264  2 000607   000553 710000 2                  TRA     ERRET

FM_CFUBUSY
 Sect OctLoc
   0     000   000000 000000                                                    ....

FMO$E$FILEBUSY
 Sect OctLoc
   1     000   061523 001552                                                    1...

FMO$E$CREATERR
 Sect OctLoc
   1     001   061523 001562                                                    1...

FMS$E$JRNLERR
 Sect OctLoc
   1     002   061523 001712                                                    1...

(unnamed)
 Sect OctLoc
   3     000   000000 000031   000000 006000   000003 006000   000003 006000    ................
      354     2265                    /**/
      355     2266                    /**/
      356     2267    1   END FMS$SCANNAME;
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:62   
      357     2268        %EOD;

PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:63   
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FMS$SCANNAME.
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:64   

 **** Variables and constants ****

  ****  Section 000  Data  FMS$SCANNAME

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 FM_CFUBUSY

  ****  Section 001 RoData FMS$SCANNAME

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     1-0-0/b STRC        r     1 FMO$E$CREATERR             0-0-0/b STRC        r     1 FMO$E$FILEBUSY
     2-0-0/b STRC        r     1 FMS$E$JRNLERR

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 CFU$                       4-0-0/w STRC        r     1 CFUX
     7-0-0/w PTR         r     1 CFUX$                      7-0-0/w STRC        r     1 CFUXX
     6-0-0/w SBIN        r     1 I                          3-0-0/w PTR         r     1 JDCB$
     5-0-0/w PTR         r     1 NAME$                      5-0-0/w STRC        r     1 NAMEX
    10-0-0/b BIT         r     1 NOWAIT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 F$CFU$
     0-0-0/w UBIN        r     1 S_CUN

  ****  BASED and DCB variables  ****
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:65   

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(288)   r     1 FM$CFU                     0-0-0/w STRC(288)   r     1 FM$CFUF
     0-0-0/c ASTR(27)    r     1 FM$CFUN                    0-0-0/w STRC(288)   r     1 FM$CFUX
     0-0-0/c ACHR        r     1 NAMEI


   Procedure FMS$SCANNAME requires 392 words for executable code.
   Procedure FMS$SCANNAME requires 12 words of local(AUTO) storage.
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:66   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:67   
          MINI XREF LISTING

B$JIT.DCB$
      1033**DCL      2092>>ASSIGN
B$JIT.ERR
       943**DCL      2251<<ASSIGN   2260<<ASSIGN   2263<<ASSIGN
B$JIT.ERR.MID
       944**DCL       944--REDEF
B$JIT.FEXT
      1033**DCL      2202>>IF
B$JIT$
       124**DCL       938--IMP-PTR  2092>>ASSIGN   2202>>IF       2251>>ASSIGN   2260>>ASSIGN   2263>>ASSIGN
CFU$
        18**DCL        19--REDEF    2093<<ASSIGN   2114>>ASSIGN   2117>>ASSIGN   2133>>IF       2142>>ASSIGN
      2164<>CALL     2182>>IF       2183<<ASSIGN   2187<>CALL     2190>>IF       2194>>IF       2211>>ASSIGN
      2218>>IF       2218>>IF       2229<>CALL     2237>>ASSIGN   2241<<ASSIGN   2244>>IF       2253>>IF
      2253<>CALL     2255>>ASSIGN
CFUX.X
        20**DCL      2116>>ASSIGN
CFUX$
        25**DCL        26--REDEF    2100<<ASSIGN   2102>>DOWHILE  2117<<ASSIGN   2130<<ASSIGN   2133>>IF
      2134<<ASSIGN   2134>>ASSIGN   2149>>IF       2149>>IF       2149>>IF       2157>>IF       2161>>IF
      2164<>CALL     2172>>IF       2173>>IF       2180>>DOCASE   2183>>ASSIGN   2184<<ASSIGN   2185>>ASSIGN
      2190>>IF       2194>>IF       2204>>IF       2204>>IF       2204>>IF       2211>>ASSIGN   2218>>IF
      2218>>IF       2228>>ASSIGN   2230>>IF       2237>>ASSIGN   2238>>ASSIGN   2240>>ASSIGN   2240>>ASSIGN
      2254>>IF       2255>>ASSIGN
CFUXX
        26**DCL      2135>>IF
CFUXX.X
        27**DCL      2132>>DOWHILE  2135>>IF       2186>>ASSIGN
ERR109
      2251**LABEL    2182--GOTO     2192--GOTO     2196--GOTO     2207--GOTO     2221--GOTO
ERR110
      2260**LABEL    2160--GOTO
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:68   
ERRET
      2244**LABEL    2261--GOTO     2264--GOTO
ERRET1
      2254**LABEL    2110--CALLALT
F$CFU$
       125**DCL       612--IMP-PTR  2099>>ASSIGN   2099>>ASSIGN   2100>>ASSIGN   2100>>ASSIGN   2109>>IF
      2109>>IF       2111>>ASSIGN   2111>>ASSIGN   2113>>ASSIGN   2113>>ASSIGN   2130>>ASSIGN   2131>>ASSIGN
      2132>>DOWHILE  2134>>ASSIGN   2237>>ASSIGN
F$DCB.ACS
       195**DCL      2118>>IF       2162>>IF       2172>>IF       2173>>IF       2230>>IF
F$DCB.ACTPOS
       203**DCL       203--REDEF
F$DCB.ARS
       178**DCL       178--REDEF
F$DCB.ATTR
       196**DCL       197--REDEF
F$DCB.BORROW
       211**DCL       211--REDEF     211--REDEF     211--REDEF
F$DCB.CFU$
       212**DCL      2093>>ASSIGN   2184>>ASSIGN   2228<<ASSIGN   2241>>ASSIGN
F$DCB.DCBNAME.L
       225**DCL       225--IMP-SIZ
F$DCB.EOMCHAR
       182**DCL       182--REDEF
F$DCB.EXIST
       191**DCL      2157>>IF       2202>>IF
F$DCB.FEXTX
       194**DCL      2202>>IF
F$DCB.FLDID
       206**DCL       206--REDEF
F$DCB.FORM$
       200**DCL       200--REDEF
F$DCB.FSECT
       216**DCL       216--REDEF
F$DCB.FSN
       193**DCL       193--REDEF     193--REDEF     194--REDEF
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:69   
F$DCB.FUN
       192**DCL      2118>>IF       2157>>IF       2162>>IF       2179>>IF       2202>>IF
F$DCB.HEADER$
       199**DCL       199--REDEF
F$DCB.IXTNSIZE
       197**DCL       197--REDEF
F$DCB.LASTSTA$
       187**DCL       187--REDEF
F$DCB.LVL
       212**DCL       212--REDEF
F$DCB.NAME
       187**DCL      2103--IF       2115--ASSIGN
F$DCB.NAME.C
       187**DCL       187--REDEF
F$DCB.NAME.L
       187**DCL      2101>>ASSIGN
F$DCB.NOEOF
       208**DCL       208--REDEF
F$DCB.NRECS
       198**DCL       198--REDEF
F$DCB.NRECX
       217**DCL       217--REDEF
F$DCB.OHDR
       209**DCL       209--REDEF
F$DCB.ORG
       192**DCL       192--REDEF
F$DCB.PRECNO
       215**DCL       215--REDEF
F$DCB.RCSZ
       220**DCL       220--REDEF
F$DCB.RES
       188**DCL       188--REDEF
F$DCB.SETX
       200**DCL       200--REDEF
F$DCB.SHARED
       207**DCL      2231<<ASSIGN
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:70   
F$DCB.TAB$
       199**DCL       200--REDEF
F$DCB.TDA
       214**DCL       214--REDEF
F$DCB.WSN
       189**DCL       189--REDEF
FM$CFU.ACCTX
       604**DCL       604--REDEF    2133>>IF       2133>>IF
FM$CFU.ACFU
       603**DCL      2204>>IF       2238<<ASSIGN
FM$CFU.FITSDA
       604**DCL      2157>>IF       2211<<ASSIGN   2211>>ASSIGN   2244>>IF       2255<<ASSIGN   2255>>ASSIGN
FM$CFU.FUN
       603**DCL      2149>>IF       2149>>IF       2161>>IF       2172>>IF       2173>>IF       2180>>DOCASE
      2204>>IF       2218>>IF       2254>>IF
FM$CFU.NAMEX
       604**DCL      2114<<ASSIGN   2134>>ASSIGN   2142<<ASSIGN   2185<<ASSIGN   2253>>IF
FM$CFU.SHARE
       603**DCL      2182>>IF       2190>>IF       2190>>IF       2194>>IF       2194>>IF       2204>>IF
      2218>>IF       2218>>IF       2218>>IF
FM$CFU.USECNT
       605**DCL      2230>>IF       2240<<ASSIGN   2240>>ASSIGN
FM$CFU.XTX
       605**DCL      2149>>IF
FM$CFUF.ACCNAM
       609**DCL      2237<<ASSIGN
FM$CFUN.L
      2078**DCL      2078--IMP-SIZ  2103--IF       2104>>ASSIGN   2115--ASSIGN
FM$CFUN.LNKX
      2078**DCL      2116<<ASSIGN   2130>>ASSIGN   2142>>ASSIGN   2185>>ASSIGN   2186<<ASSIGN
FM$CFUX.CFUT
       612**DCL      2131>>ASSIGN   2132>>DOWHILE
FM$CFUX.NAMES
       612**DCL      2099>>ASSIGN
FM$CFUX.NAMET
       613**DCL      2109>>IF
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:71   
FM$CFUX.NAMEX
       613**DCL      2100>>ASSIGN   2109>>IF       2111>>ASSIGN   2113<<ASSIGN   2113>>ASSIGN
FMO$E$CREATERR
      2066**DCL      2260>>ASSIGN
FMO$E$FILEBUSY
      2062**DCL      2251>>ASSIGN
FMR$FN
      2082**DCL-ENT  2187--CALL     2253--CALL
FMR$L8
      2083**DCL-ENT  2095--CALL
FMR$M8
      2086**DCL-ENT  2164--CALL
FMR$U8
      2084**DCL-ENT  2119--CALL     2151--CALL     2242--CALL     2257--CALL
FMR$ZA
      2087**DCL-ENT  2229--CALL
FMS$E$JRNLERR
      2070**DCL      2263>>ASSIGN
FMS$GARBCOL
      2085**DCL-ENT  2110--CALL
FMSE$JRNLERR
      2263**LABEL    2118--GOTO     2163--GOTO     2174--GOTO
FM_CFUBUSY
        32**DCL      2152<<ASSIGN   2152>>ASSIGN
FOUND
      2130**LABEL    2103--GOTO
FOUND1
      2142**LABEL    2133--GOTO
I
        24**DCL      2076--IMP-SIZ  2101<<ASSIGN   2103>>IF       2103>>IF       2113>>ASSIGN   2115>>ASSIGN
      2115>>ASSIGN   2131<<ASSIGN   2132>>DOWHILE  2135<<ASSIGN   2136<<ASSIGN   2136>>ASSIGN
JDCB$
        17**DCL       178--IMP-PTR  2092<<ASSIGN   2093>>ASSIGN   2101>>ASSIGN   2103>>IF       2115>>ASSIGN
      2118>>IF       2118>>IF       2157>>IF       2157>>IF       2162>>IF       2162>>IF       2172>>IF
      2173>>IF       2179>>IF       2184>>ASSIGN   2202>>IF       2202>>IF       2202>>IF       2228>>ASSIGN
      2230>>IF       2231>>ASSIGN   2241>>ASSIGN
PL6.E3A0      #002=FMS$SCANNAME File=FMS$SCFU.:E05TSI                            TUE 07/29/97 17:01 Page:72   
LINKUP
      2237**LABEL    2188--GOTO     2212--GOTO
NAME$
        21**DCL        22--REDEF    2076--IMP-PTR  2078--IMP-PTR  2099<<ASSIGN   2102>>DOWHILE  2103>>IF
      2104<<ASSIGN   2104>>ASSIGN   2104>>ASSIGN   2111<<ASSIGN   2115>>ASSIGN   2116>>ASSIGN   2130>>ASSIGN
      2142>>ASSIGN   2185>>ASSIGN   2186>>ASSIGN
NAMEI
      2076**DCL      2103>>IF       2103>>IF       2115<<ASSIGN   2115>>ASSIGN
NAMEX.X
        23**DCL      2114>>ASSIGN
NOTFOUND0
      2116**LABEL    2143--GOTO
NOWAIT
        28**DCL      2090<<ASSIGN   2123<<ASSIGN   2153>>IF
RESCAN
      2093**LABEL    2154--CALLALT  2155--GOTO
SCANNAME
      2090**LABEL    2124--GOTO
SETSHARED
      2218**LABEL    2165--GOTO     2173--GOTO
SHAREOK
      2238**LABEL    2232--GOTO
SSR$REG
      2088**DCL-ENT  2154--CALL
S_CUN
        33**DCL      2149>>IF

PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:73   
      358        1        /*T***********************************************************/
      359        2        /*T*                                                         */
      360        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      361        4        /*T*                                                         */
      362        5        /*T***********************************************************/
      363        6                    /*F*  NAME:   FMS$GARBCOL       GARBAGE COLLECTOR */
      364        7        FMS$GARBCOL: PROC ALTRET;
      365        8                    /**/
      366        9                    /* DEFINE EXTERNAL ROUTINES */
      367       10                    /**/
      368       11    1   DCL MMH$GDS ENTRY(5) ALTRET;
      369       12    1   DCL UQB$DELQIDX ENTRY(1)ALTRET;
      370       13    1   DCL FMR$FN ENTRY(1); /* TO RELEASE UNUESD CFU NAMEX'S */
      371       14    1   DCL FMR$SETGIP ENTRY; /* SETS FM_GIP AND ENABLES (IF DISABLED) */
      372       15    1   DCL FMR$SLIDE ENTRY(3);
      373       16    1   DCL FMR$ZA ENTRY(1);
      374       17    1   DCL SC_CFUSBAD ENTRY CONV(2,0);
      375       18                    /**/
      376       19                    /* AUTOMATIC DATA */
      377       20                    /**/
      378       21    1   DCL P$ PTR;
      379       22    1   DCL 1 PX REDEF P$,
      380       23    1         2 X UBIN(20) UNAL,2 * BIT(16);
      381       24    1   DCL ERR REDEF P$ SBIN;
      382       25    1   DCL I SBIN;
      383       26    1   DCL CFUX SBIN;
      384       27    1   DCL CFUX$ REDEF CFUX PTR;
      385       28    1   DCL CFU$ PTR;
      386       29    1   DCL 1 CFU$X REDEF CFU$,
      387       30    1         2 X UBIN(18)UNAL,
      388       31    1         2 * BIT(18);
      389       32    1   DCL NAME$ PTR;
      390       33    1   DCL 1 NAMEX REDEF NAME$,
      391       34    1         2 X UBIN(20) UNAL,2 * BIT(16);
      392       35    1   DCL FLAG SBIN;
      393       36                    /**/
      394       37                    /* SYMDEFED ITEMS */
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:74   
      395       38                    /**/
      396       39    1   DCL FM_PCTFREEN UBIN STATIC SYMDEF INIT(50);
      397       40    1   DCL FM_PCTFREEC UBIN STATIC SYMDEF INIT(50);
      398       41                    /**/
      399       42                    /* SPECIAL BASED ITEMS */
      400       43                    /**/
      401       44    1   DCL A1 CHAR(I) UNAL BASED;
      402       45        %INCLUDE FM_DATA_R;
      403       59        %INCLUDE FM$MACROS;
      404      434        %FM$CFU(BASED="BASED(CFU$)");
      405      440        %FM$CFUF(BASED="BASED(CFU$)");
      406      443        %FM$CFUA(BASED="BASED(CFU$)");
      407      449        %FM$CFUX;
      408      454        %FM$CFUN(BASED="BASED(NAME$)");
      409      457        %INCLUDE F_ERRORS_C;
      410      697        %INCLUDE CP_6_SUBS;
      411     1237        %SUB FCG#='0615'O;
      412     1238        %SUB MID#='23'O;
      413     1239        %ERRCODE(NAME=FMS$E$NOCFUS,COD#=%E$NOCFUS);
      414     1243        %FM$SET(BASED="BASED(FM$SET$)");
      415     1248        %INCLUDE F$JIT_C;
      416     1678                    /**/
      417     1679                    /* SYMREFED ITEMS */
      418     1680                    /**/
      419     1681    1   DCL B$DS1$ PTR SYMREF;
      420     1682    1   DCL B$LS$ PTR SYMREF;
      421     1683    1   DCL MM_DSMAX UBIN BYTE SYMREF;
      422     1684    1   DCL B$JIT$ PTR SYMREF;
      423     1685        %SUB CFUSEG=B$DS1$;
      424     1686                    /**/
      425     1687                    /**/
      426     1688    1      CALL FMR$SETGIP;
      427     1689    1      IF FM_GCT=0
      428     1690    2      THEN DO;
      429     1691    2         FLAG=1024;
      430     1692    2         CALL MMH$GDS(1,B$DS1$,FLAG,ERR);
      431     1693    2         FM$CFUX='0'B;
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:75   
      432     1694    2         P$=PINCRW(F$CFU$,SIZEW(FM$CFUX));
      433     1695    2         F$CFU$->FM$CFUA.DFLTALL=%FFLG_READ#;/* TAPE ACCESS DEFAULT */
      434     1696    2         FM$CFUX.CFUT=FLAG;
      435     1697    2         FM$CFUX.NAMET=FLAG*4;
      436     1698    2         FLAG=1024*3;/*ONE QUARTER PAGE FOR NAMES*/
      437     1699    3         DO WHILE(PX.X<FLAG);
      438     1700    3            P$->FM$CFU.USECNT=1;
      439     1701    3            CALL FMR$ZA(P$);
      440     1702    3            P$=PINCRW(P$,SIZEW(P$->FM$CFU));
      441     1703    3            END;
      442     1704    2         FM$CFUX.CFUT=POFFW(P$,F$CFU$);
      443     1705    2         FM$CFUX.NAMES=FM$CFUX.CFUT*4;
      444     1706    2         FM$CFUX.NAMEX=FM$CFUX.NAMES;
      445     1707    2         END;
      446     1708    2      ELSE DO;
      447     1709        %EJECT;
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:76   
      448     1710                    /**/
      449     1711                    /*
      450     1712                    *  FIRST ZAP ANY REMAINING CFUS ON THE FREE CHAIN
      451     1713                    * UNTIL AT LEAST 1/4 ARE FREE
      452     1714                    */
      453     1715    2         IF FM_PCTFREEC>95 THEN FM_PCTFREEC=95;
      454     1716    2         IF FM_PCTFREEN>95 THEN FM_PCTFREEN=95;
      455     1717    2         IF FM$CFUX.NAMET<FM$CFUX.NAMEX
      456     1718    2           OR FM$CFUX.NAMEX<FM$CFUX.NAMES
      457     1719    2           OR FM$CFUX.CFUT*4~=FM$CFUX.NAMES
      458     1720    2         THEN CALL SC_CFUSBAD;
      459     1721                    /* FIRST MARK ALL THE ACCOUNT BLOCKS UNREFERENCED */
      460     1722    2         CFU$=PINCRW(F$CFU$,FM$CFUX.ACCTS);
      461     1723    3         DO WHILE (CFU$~=F$CFU$);
      462     1724    3            IF CFU$X.X>=FM$CFUX.CFUT
      463     1725    3              OR MOD(CFU$X.X,8)~=0
      464     1726    3              OR FM$CFUA.LINKX=0 AND CFU$X.X~=FM$CFUX.ACCTX
      465     1727    3            THEN CALL SC_CFUSBAD;
      466     1728    3            FM$CFUA.GCCTL='1'B;
      467     1729    3            CFU$=PINCRW(F$CFU$,FM$CFUA.LINKX);
      468     1730    3            END;
      469     1731    2         FLAG=-FM$CFUX.CFUT*FM_PCTFREEC/(SIZEW(FM$CFU)*100);
      470     1732    2         I=FM$CFUX.NAMET-FM$CFUX.NAMEX-FM_PCTFREEN*
      471     1733    2           (FM$CFUX.NAMET-FM$CFUX.NAMES)/100;
      472     1734    2         NAME$=PINCRC(F$CFU$,FM$CFUX.NAMES);
      473     1735    2         CFUX$=PINCRC(F$CFU$,FM$CFUX.NAMEX);
      474     1736    3         DO WHILE (NAME$<CFUX$);
      475     1737    3            IF FM$CFUN.LNKX>FM$CFUX.CFUT THEN I=I+3+FM$CFUN.L;
      476     1738    3            NAME$=PINCRC(NAME$,FM$CFUN.L+3);
      477     1739    3            END;
      478     1740    2         CFU$=PINCRW(F$CFU$,FM$CFUX.HEAD);
      479     1741    2         CFUX=0;
      480     1742    3         DO WHILE(CFU$~=F$CFU$ AND (FLAG<0 OR I<0));
      481     1743    3            IF CFU$X.X>=FM$CFUX.CFUT
      482     1744    3              OR MOD(CFU$X.X,8)~=0
      483     1745    3              OR CFUX~=CFU$->FM$CFUX.TAIL
      484     1746    3            THEN CALL SC_CFUSBAD;
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:77   
      485     1747    4            IF FM$CFU.NAMEX~=0 THEN DO;
      486     1748    4               NAMEX.X=FM$CFU.NAMEX;
      487     1749    4               CALL FMR$FN(CFU$);
      488     1750    4               IF NAMEX.X>FM$CFUX.CFUT AND NAMEX.X<FM$CFUX.NAMET
      489     1751    4               THEN IF FM$CFUN.LNKX=NAMEX.X THEN I=I+3+FM$CFUN.L;
      490     1752    4               END;
      491     1753    3            FM$CFUF.W0=0;
      492     1754    3            CFUX=CFU$X.X;
      493     1755    3            CFU$=PINCRW(F$CFU$,CFU$->FM$CFUX.HEAD);
      494     1756    3            FLAG=FLAG+1;
      495     1757    3            END;
      496     1758                    /**/
      497     1759                    /* MARK THE ACCOUNT BLOCKS FOR THE REST, SINCE FUN=0 */
      498     1760    3         DO WHILE (CFU$~=F$CFU$);
      499     1761    3            IF CFU$X.X>=FM$CFUX.CFUT
      500     1762    3              OR MOD(CFU$X.X,8)~=0
      501     1763    3              OR CFUX~=CFU$->FM$CFUX.TAIL
      502     1764    3            THEN CALL SC_CFUSBAD;
      503     1765    3            IF FM$CFU.ACCTX~=0 AND FM$CFU.ACCTX<FM$CFUX.CFUT
      504     1766    3            THEN PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.GCCTL='0'B;
      505     1767    3            CFUX=CFU$X.X;
      506     1768    3            CFU$=PINCRW(F$CFU$,CFU$->FM$CFUX.HEAD);
      507     1769    3            FLAG=FLAG+1;
      508     1770    3            END;
      509     1771                    /* NOW SQUEEZE THE NAME AREA */
      510     1772    2         CFUX$=PINCRC(F$CFU$,FM$CFUX.NAMEX);
      511     1773    2         NAME$=PINCRC(F$CFU$,FM$CFUX.NAMES);
      512     1774    2         P$=NAME$;
      513     1775    3         DO WHILE (NAME$<CFUX$);
      514     1776    3            I=FM$CFUN.LNKX;
      515     1777    4            IF I<FM$CFUX.CFUT THEN DO;
      516     1778    5               DO WHILE (I<FM$CFUX.CFUT);
      517     1779    5                  CFU$=PINCRW(F$CFU$,I);
      518     1780    5                  I=FM$CFU.NAMEX;
      519     1781    5                  END;
      520     1782    4               FM$CFU.NAMEX=PX.X;
      521     1783    4               I=FM$CFUN.L+3;
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:78   
      522     1784    4               P$->A1=NAME$->A1;
      523     1785    4               P$=PINCRC(P$,I);
      524     1786    4               END;
      525     1787    3            ELSE I=FM$CFUN.L+3;
      526     1788    3            NAME$=PINCRC(NAME$,I);
      527     1789    3            END;
      528     1790    2         FM$CFUX.NAMEX=PX.X;
      529     1791        %EJECT;
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:79   
      530     1792                    /* NOW FIND THE ACCT BLOCK WHICH MIGHT BE IN USE */
      531     1793    2         CFU$=PINCRW(F$CFU$,SIZEW(FM$CFU));
      532     1794    3         DO WHILE (CFU$X.X<FM$CFUX.CFUT);
      533     1795    3            IF FM$CFU.ACCTX~=0
      534     1796    3              AND FM$CFU.ACCTX<FM$CFUX.CFUT
      535     1797    3              AND MOD(FM$CFU.ACCTX,SIZEW(FM$CFU))=0
      536     1798    3              AND FM$CFU.FUN~=0
      537     1799    3            THEN IF PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.GCCTL
      538     1800    4               THEN DO;
      539     1801    4                  P$=PINCRW(F$CFU$,FM$CFUX.ACCTS);
      540     1802    5                  DO WHILE (P$~=F$CFU$);
      541     1803    6                     IF PX.X/4=FM$CFU.ACCTX THEN DO;
      542     1804    6                        P$->FM$CFUA.GCCTL='0'B;
      543     1805    6                        P$=F$CFU$;
      544     1806    6                        END;
      545     1807    5                     ELSE P$=PINCRW(F$CFU$,P$->FM$CFUA.LINKX);
      546     1808    5                     END;
      547     1809    4                  END;
      548     1810    3            CFU$=PINCRW(CFU$,SIZEW(FM$CFU));
      549     1811    3            END;
      550     1812                    /* NOW FREE SET ENTRIES THAT ARE NOT BUSY */
      551     1813    2         P$=ADDR(FM$SET(FM$CFUX.SETH));
      552     1814    2         CFUX$=FM$SET$;
      553     1815    3         DO WHILE (P$~=FM$SET$);
      554     1816    3            IF P$>=CFU$ THEN CALL SC_CFUSBAD;
      555     1817    4            IF P$->FM$SET.SYSID(0)=0 AND P$->FM$SET.DCTX(0)=0 THEN DO;
      556     1818    4               FLAG=FLAG+1;
      557     1819    4               CFUX$->FM$SET.SETL(0)=P$->FM$SET.SETL(0);
      558     1820    4               CALL UQB$DELQIDX(P$);
      559     1821    4               CALL UQB$DELQIDX(PINCRW(P$,6));
      560     1822    4               CALL FMR$ZA(P$);
      561     1823    4               P$=CFUX$;
      562     1824    4               END;
      563     1825    3            ELSE CFUX$=P$;
      564     1826    3            P$=ADDR(FM$SET(P$->FM$SET.SETL(0)));
      565     1827    3            END;
      566     1828                    /* NOW TRASH THE UNBUSY, UNUPDATED, ACCT BLOCKS */
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:80   
      567     1829    2         P$=F$CFU$;
      568     1830    2         CFU$=PINCRW(F$CFU$,FM$CFUX.ACCTS);
      569     1831    3         DO WHILE (CFU$~=F$CFU$);
      570     1832    3            IF FM$CFUA.GCCTL AND (FM$CFUA.GMOD=0 OR FM$CFUA.ACCT<=' ') AND
      571     1833    4              (FM$CFUA.FDFITSDA=0 OR FLAG<0 OR FM$CFUA.AGE~=FM$CFUX.GCT) THEN DO;
      572     1834    4               P$->FM$CFUA.LINKX=FM$CFUA.LINKX;
      573     1835    4               CALL UQB$DELQIDX(CFU$);
      574     1836    4               IF CFU$X.X=FM_SYSACCTX THEN
      575     1837    4                  FM_SYSACCTX=0; /* so we'll set it right when we get a new one */
      576     1838    4               CALL FMR$ZA(CFU$);
      577     1839    4               FLAG=FLAG+1;
      578     1840    4               END;
      579     1841    4            ELSE DO;
      580     1842    4               P$=CFU$;
      581     1843    4               IF FM$CFUA.GCCTL THEN CALL UQB$DELQIDX(CFU$);
      582     1844    4               END;
      583     1845    3            CFU$=PINCRW(F$CFU$,P$->FM$CFUA.LINKX);
      584     1846    3            END;
      585     1847    2         FM$CFUX.ACCTX=POFFW(P$,F$CFU$);
      586     1848                    /* IF THERE ARE NO FFREE CFUS, GET MORE SPACE */
      587     1849                    /* AND MOVE THE NAMES ABOVE IT                */
      588     1850    2         IF FLAG<0 THEN FLAG=1024;
      589     1851    2         ELSE FLAG=0;
      590     1852    2         IF (FM$CFUX.NAMET-FM$CFUX.NAMEX)<
      591     1853    2           (FM$CFUX.NAMET-FM$CFUX.NAMES)*FM_PCTFREEN/100
      592     1854    2         THEN FLAG=768;
      593     1855    3         IF FLAG~=0 THEN DO;
      594     1856    3            CALL MMH$GDS(1,B$DS1$,1024,ERR)ALTRET(NOPGS1);
      595     1857    3            CFUX=(FM$CFUX.NAMET-FM$CFUX.NAMES)/4;
      596     1858    3            CALL FMR$SLIDE(PINCRW(F$CFU$,FM$CFUX.CFUT),FLAG,CFUX);
      597     1859    3            FM$CFUX.NAMES=FM$CFUX.NAMES+FLAG*4;
      598     1860    3            FM$CFUX.NAMEX=FM$CFUX.NAMEX+FLAG*4;
      599     1861    3            FM$CFUX.NAMET=FM$CFUX.NAMET+4096;
      600     1862    3            P$=PINCRC(F$CFU$,FM$CFUX.NAMEX);
      601     1863    3            NAME$=PINCRC(F$CFU$,FM$CFUX.NAMES);
      602     1864    4            DO WHILE (NAME$<P$);
      603     1865    4               I=FM$CFUN.LNKX;
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:81   
      604     1866    5               DO WHILE (I<FM$CFUX.CFUT);
      605     1867    5                  CFU$=PINCRW(F$CFU$,I);
      606     1868    5                  I=FM$CFU.NAMEX;
      607     1869    5                  END;
      608     1870    4               FM$CFU.NAMEX=NAMEX.X;
      609     1871    4               NAME$=PINCRC(NAME$,FM$CFUN.L+3);
      610     1872    4               END;
      611     1873    3            P$=PINCRW(F$CFU$,FM$CFUX.CFUT);
      612     1874    3            FM$CFUX.CFUT=FM$CFUX.CFUT+FLAG;
      613     1875    4            DO WHILE (P$<PINCRW(F$CFU$,FM$CFUX.CFUT));
      614     1876    4               P$->FM$CFU.USECNT=1;
      615     1877    4               CALL FMR$ZA(P$);
      616     1878    4               P$=PINCRW(P$,SIZEW(FM$CFU));
      617     1879    4               END;
      618     1880    3            END;
      619     1881    2   NOPGS1:;
      620     1882                    /**/
      621     1883    2         END;
      622     1884    1      FM_GCT=FM_GCT+1;
      623     1885    1      FM$CFUX.GCT=FM_GCT;
      624     1886    1      IF FM$CFUX.HEAD~=0
      625     1887    1        AND FM$CFUX.NAMEX+34<=FM$CFUX.NAMET THEN RETURN;
      626     1888    1      B$JIT.ERR=FMS$E$NOCFUS;
      627     1889    1      ALTRETURN;
      628     1890    1   END FMS$GARBCOL;
      629     1891        %EOD;

PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:82   
--  Include file information  --

   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   FM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMS$GARBCOL.

   Procedure FMS$GARBCOL requires 769 words for executable code.
   Procedure FMS$GARBCOL requires 14 words of local(AUTO) storage.

PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:83   

 Object Unit name= FMS$GARBCOL                                File name= FMS$SCFU.:E05TOU
 UTS= JUL 29 '97 17:02:11.24 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none     2      2  FMS$GARBCOL
    1  RoData even  UTS      1      1  FMS$GARBCOL
    2   Proc  even  none   769   1401  FMS$GARBCOL
    3  RoData even  none     7      7  FMS$GARBCOL

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        0  FMS$GARBCOL

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      0  FM_PCTFREEN                        0      1  FM_PCTFREEC
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:84   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 FMR$SETGIP
 yes     yes           Std       5 MMH$GDS
         yes           Std       1 FMR$ZA
         yes           Std       1 FMR$FN
         yes           Std       3 FMR$SLIDE
 yes     yes           Std       1 UQB$DELQIDX
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_CFUSBAD                       r    F$CFU$                                FM_GCT
r    FM$SET$                               FM_SYSACCTX                           B$DS1$
     B$JIT$                                B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:85   


      358        1        /*T***********************************************************/
      359        2        /*T*                                                         */
      360        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      361        4        /*T*                                                         */
      362        5        /*T***********************************************************/
      363        6                    /*F*  NAME:   FMS$GARBCOL       GARBAGE COLLECTOR */
      364        7        FMS$GARBCOL: PROC ALTRET;

      7  2 000000   000000 700200 xent  FMS$GARBCOL  TSX0  ! X66_AUTO_0
         2 000001   000016 000000                    ZERO    14,0

      365        8                    /**/
      366        9                    /* DEFINE EXTERNAL ROUTINES */
      367       10                    /**/
      368       11    1   DCL MMH$GDS ENTRY(5) ALTRET;
      369       12    1   DCL UQB$DELQIDX ENTRY(1)ALTRET;
      370       13    1   DCL FMR$FN ENTRY(1); /* TO RELEASE UNUESD CFU NAMEX'S */
      371       14    1   DCL FMR$SETGIP ENTRY; /* SETS FM_GIP AND ENABLES (IF DISABLED) */
      372       15    1   DCL FMR$SLIDE ENTRY(3);
      373       16    1   DCL FMR$ZA ENTRY(1);
      374       17    1   DCL SC_CFUSBAD ENTRY CONV(2,0);
      375       18                    /**/
      376       19                    /* AUTOMATIC DATA */
      377       20                    /**/
      378       21    1   DCL P$ PTR;
      379       22    1   DCL 1 PX REDEF P$,
      380       23    1         2 X UBIN(20) UNAL,2 * BIT(16);
      381       24    1   DCL ERR REDEF P$ SBIN;
      382       25    1   DCL I SBIN;
      383       26    1   DCL CFUX SBIN;
      384       27    1   DCL CFUX$ REDEF CFUX PTR;
      385       28    1   DCL CFU$ PTR;
      386       29    1   DCL 1 CFU$X REDEF CFU$,
      387       30    1         2 X UBIN(18)UNAL,
      388       31    1         2 * BIT(18);
      389       32    1   DCL NAME$ PTR;
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:86   
      390       33    1   DCL 1 NAMEX REDEF NAME$,
      391       34    1         2 X UBIN(20) UNAL,2 * BIT(16);
      392       35    1   DCL FLAG SBIN;
      393       36                    /**/
      394       37                    /* SYMDEFED ITEMS */
      395       38                    /**/
      396       39    1   DCL FM_PCTFREEN UBIN STATIC SYMDEF INIT(50);
      397       40    1   DCL FM_PCTFREEC UBIN STATIC SYMDEF INIT(50);
      398       41                    /**/
      399       42                    /* SPECIAL BASED ITEMS */
      400       43                    /**/
      401       44    1   DCL A1 CHAR(I) UNAL BASED;
      402       45        %INCLUDE FM_DATA_R;
      403       59        %INCLUDE FM$MACROS;
      404      434        %FM$CFU(BASED="BASED(CFU$)");
      405      440        %FM$CFUF(BASED="BASED(CFU$)");
      406      443        %FM$CFUA(BASED="BASED(CFU$)");
      407      449        %FM$CFUX;
      408      454        %FM$CFUN(BASED="BASED(NAME$)");
      409      457        %INCLUDE F_ERRORS_C;
      410      697        %INCLUDE CP_6_SUBS;
      411     1237        %SUB FCG#='0615'O;
      412     1238        %SUB MID#='23'O;
      413     1239        %ERRCODE(NAME=FMS$E$NOCFUS,COD#=%E$NOCFUS);
      414     1243        %FM$SET(BASED="BASED(FM$SET$)");
      415     1248        %INCLUDE F$JIT_C;
      416     1678                    /**/
      417     1679                    /* SYMREFED ITEMS */
      418     1680                    /**/
      419     1681    1   DCL B$DS1$ PTR SYMREF;
      420     1682    1   DCL B$LS$ PTR SYMREF;
      421     1683    1   DCL MM_DSMAX UBIN BYTE SYMREF;
      422     1684    1   DCL B$JIT$ PTR SYMREF;
      423     1685        %SUB CFUSEG=B$DS1$;
      424     1686                    /**/
      425     1687                    /**/
      426     1688    1      CALL FMR$SETGIP;
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:87   

   1688  2 000002   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000003   000000 701000 xent               TSX1    FMR$SETGIP
         2 000004   000000 011000                    NOP     0

      427     1689    1      IF FM_GCT=0

   1689  2 000005   000000 235000 xsym               LDA     FM_GCT
         2 000006   000110 601000 2                  TNZ     s:1715

      428     1690    2      THEN DO;

      429     1691    2         FLAG=1024;

   1691  2 000007   002000 236007                    LDQ     1024,DL
         2 000010   200010 756100                    STQ     FLAG,,AUTO

      430     1692    2         CALL MMH$GDS(1,B$DS1$,FLAG,ERR);

   1692  2 000011   200003 630500                    EPPR0   P$,,AUTO
         2 000012   200015 450500                    STP0    FLAG+5,,AUTO
         2 000013   200010 631500                    EPPR1   FLAG,,AUTO
         2 000014   200014 451500                    STP1    FLAG+4,,AUTO
         2 000015   000000 237000 3                  LDAQ    0
         2 000016   200012 757100                    STAQ    FLAG+2,,AUTO
         2 000017   200012 630500                    EPPR0   FLAG+2,,AUTO
         2 000020   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 000021   000000 701000 xent               TSX1    MMH$GDS
         2 000022   000000 011000                    NOP     0

      431     1693    2         FM$CFUX='0'B;

   1693  2 000023   000000 470400 xsym               LDP0    F$CFU$
         2 000024   000100 100400                    MLR     fill='000'O
         2 000025   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000026   000000 000040                    ADSC9   0,,PR0                   cn=0,n=32

PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:88   
      432     1694    2         P$=PINCRW(F$CFU$,SIZEW(FM$CFUX));

   1694  2 000027   000000 236000 xsym               LDQ     F$CFU$
         2 000030   000010 036003                    ADLQ    8,DU
         2 000031   200003 756100                    STQ     P$,,AUTO

      433     1695    2         F$CFU$->FM$CFUA.DFLTALL=%FFLG_READ#;/* TAPE ACCESS DEFAULT */

   1695  2 000032   400000 220003                    LDX0    -131072,DU
         2 000033   000006 440100                    SXL0    6,,PR0

      434     1696    2         FM$CFUX.CFUT=FLAG;

   1696  2 000034   200010 721100                    LXL1    FLAG,,AUTO
         2 000035   000002 741100                    STX1    2,,PR0

      435     1697    2         FM$CFUX.NAMET=FLAG*4;

   1697  2 000036   200010 235100                    LDA     FLAG,,AUTO
         2 000037   000002 735000                    ALS     2
         2 000040   000000 622005                    EAX2    0,AL
         2 000041   000003 742100                    STX2    3,,PR0

      436     1698    2         FLAG=1024*3;/*ONE QUARTER PAGE FOR NAMES*/

   1698  2 000042   006000 235007                    LDA     3072,DL
         2 000043   200010 755100                    STA     FLAG,,AUTO

      437     1699    3         DO WHILE(PX.X<FLAG);

   1699  2 000044   200003 236100                    LDQ     P$,,AUTO
         2 000045   000020 772000                    QRL     16
         2 000046   200010 116100                    CMPQ    FLAG,,AUTO
         2 000047   000070 605000 2                  TPL     s:1704

      438     1700    3            P$->FM$CFU.USECNT=1;

PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:89   
   1700  2 000050   000001 220003                    LDX0    1,DU
         2 000051   200003 470500                    LDP0    P$,,AUTO
         2 000052   000003 440100                    SXL0    3,,PR0

      439     1701    3            CALL FMR$ZA(P$);

   1701  2 000053   200003 630500                    EPPR0   P$,,AUTO
         2 000054   200012 450500                    STP0    FLAG+2,,AUTO
         2 000055   200012 630500                    EPPR0   FLAG+2,,AUTO
         2 000056   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000057   000000 701000 xent               TSX1    FMR$ZA
         2 000060   000000 011000                    NOP     0

      440     1702    3            P$=PINCRW(P$,SIZEW(P$->FM$CFU));

   1702  2 000061   200003 236100                    LDQ     P$,,AUTO
         2 000062   000010 036003                    ADLQ    8,DU
         2 000063   200003 756100                    STQ     P$,,AUTO

      441     1703    3            END;

   1703  2 000064   200003 236100                    LDQ     P$,,AUTO
         2 000065   000020 772000                    QRL     16
         2 000066   200010 116100                    CMPQ    FLAG,,AUTO
         2 000067   000050 604000 2                  TMI     s:1700

      442     1704    2         FM$CFUX.CFUT=POFFW(P$,F$CFU$);

   1704  2 000070   000000 235000 xsym               LDA     F$CFU$
         2 000071   000022 771000                    ARL     18
         2 000072   200012 755100                    STA     FLAG+2,,AUTO
         2 000073   200003 236100                    LDQ     P$,,AUTO
         2 000074   000022 772000                    QRL     18
         2 000075   200012 136100                    SBLQ    FLAG+2,,AUTO
         2 000076   000000 620006                    EAX0    0,QL
         2 000077   000000 470400 xsym               LDP0    F$CFU$
         2 000100   000002 740100                    STX0    2,,PR0
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:90   

      443     1705    2         FM$CFUX.NAMES=FM$CFUX.CFUT*4;

   1705  2 000101   000002 236100                    LDQ     2,,PR0
         2 000102   000020 772000                    QRL     16
         2 000103   000002 376000 3                  ANQ     2
         2 000104   000000 621006                    EAX1    0,QL
         2 000105   000001 441100                    SXL1    1,,PR0

      444     1706    2         FM$CFUX.NAMEX=FM$CFUX.NAMES;

   1706  2 000106   000002 441100                    SXL1    2,,PR0

      445     1707    2         END;

   1707  2 000107   001361 710000 2                  TRA     NOPGS1

      446     1708    2      ELSE DO;

      447     1709        %EJECT;
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:91   
      448     1710                    /**/
      449     1711                    /*
      450     1712                    *  FIRST ZAP ANY REMAINING CFUS ON THE FREE CHAIN
      451     1713                    * UNTIL AT LEAST 1/4 ARE FREE
      452     1714                    */
      453     1715    2         IF FM_PCTFREEC>95 THEN FM_PCTFREEC=95;

   1715  2 000110   000001 236000 0                  LDQ     FM_PCTFREEC
         2 000111   000140 116007                    CMPQ    96,DL
         2 000112   000115 602000 2                  TNC     s:1716

   1715  2 000113   000137 235007                    LDA     95,DL
         2 000114   000001 755000 0                  STA     FM_PCTFREEC

      454     1716    2         IF FM_PCTFREEN>95 THEN FM_PCTFREEN=95;

   1716  2 000115   000000 235000 0                  LDA     FM_PCTFREEN
         2 000116   000140 115007                    CMPA    96,DL
         2 000117   000122 602000 2                  TNC     s:1717

   1716  2 000120   000137 236007                    LDQ     95,DL
         2 000121   000000 756000 0                  STQ     FM_PCTFREEN

      455     1717    2         IF FM$CFUX.NAMET<FM$CFUX.NAMEX

   1717  2 000122   000000 470400 xsym               LDP0    F$CFU$
         2 000123   000002 720100                    LXL0    2,,PR0
         2 000124   000003 100100                    CMPX0   3,,PR0
         2 000125   000127 600000 2                  TZE     s:1717+5
         2 000126   000146 603000 2                  TRC     s:1720
         2 000127   000001 236100                    LDQ     1,,PR0
         2 000130   777777 376007                    ANQ     -1,DL
         2 000131   200012 756100                    STQ     FLAG+2,,AUTO
         2 000132   000002 236100                    LDQ     2,,PR0
         2 000133   777777 376007                    ANQ     -1,DL
         2 000134   200012 116100                    CMPQ    FLAG+2,,AUTO
         2 000135   000146 604000 2                  TMI     s:1720
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:92   
         2 000136   000001 236100                    LDQ     1,,PR0
         2 000137   777777 376007                    ANQ     -1,DL
         2 000140   200013 756100                    STQ     FLAG+3,,AUTO
         2 000141   000002 236100                    LDQ     2,,PR0
         2 000142   000020 772000                    QRL     16
         2 000143   000002 376000 3                  ANQ     2
         2 000144   200013 116100                    CMPQ    FLAG+3,,AUTO
         2 000145   000150 600000 2                  TZE     s:1722

      456     1718    2           OR FM$CFUX.NAMEX<FM$CFUX.NAMES
      457     1719    2           OR FM$CFUX.CFUT*4~=FM$CFUX.NAMES
      458     1720    2         THEN CALL SC_CFUSBAD;

   1720  2 000146   000000 713400 xsym               CLIMB   SC_CFUSBAD
         2 000147   000000 600000 xsid               climb   nvectors=         0

      459     1721                    /* FIRST MARK ALL THE ACCOUNT BLOCKS UNREFERENCED */
      460     1722    2         CFU$=PINCRW(F$CFU$,FM$CFUX.ACCTS);

   1722  2 000150   000000 470400 xsym               LDP0    F$CFU$
         2 000151   000000 720100                    LXL0    0,,PR0
         2 000152   000000 636010                    EAQ     0,X0
         2 000153   000000 036000 xsym               ADLQ    F$CFU$
         2 000154   200006 756100                    STQ     CFU$,,AUTO

      461     1723    3         DO WHILE (CFU$~=F$CFU$);

   1723  2 000155   000000 116000 xsym               CMPQ    F$CFU$
         2 000156   000210 600000 2                  TZE     s:1731

      462     1724    3            IF CFU$X.X>=FM$CFUX.CFUT

   1724  2 000157   200006 220100                    LDX0    CFU$,,AUTO
         2 000160   000000 470400 xsym               LDP0    F$CFU$
         2 000161   000002 100100                    CMPX0   2,,PR0
         2 000162   000174 603000 2                  TRC     s:1727
         2 000163   200006 236100                    LDQ     CFU$,,AUTO
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:93   
         2 000164   000022 772000                    QRL     18
         2 000165   000007 376007                    ANQ     7,DL
         2 000166   000174 601000 2                  TNZ     s:1727
         2 000167   200006 471500                    LDP1    CFU$,,AUTO
         2 000170   100000 721100                    LXL1    0,,PR1
         2 000171   000176 601000 2                  TNZ     s:1728
         2 000172   000001 100100                    CMPX0   1,,PR0
         2 000173   000176 600000 2                  TZE     s:1728

      463     1725    3              OR MOD(CFU$X.X,8)~=0
      464     1726    3              OR FM$CFUA.LINKX=0 AND CFU$X.X~=FM$CFUX.ACCTX
      465     1727    3            THEN CALL SC_CFUSBAD;

   1727  2 000174   000000 713400 xsym               CLIMB   SC_CFUSBAD
         2 000175   000000 600000 xsid               climb   nvectors=         0

      466     1728    3            FM$CFUA.GCCTL='1'B;

   1728  2 000176   200006 470500                    LDP0    CFU$,,AUTO
         2 000177   020000 236003                    LDQ     8192,DU
         2 000200   000005 256100                    ORSQ    5,,PR0

      467     1729    3            CFU$=PINCRW(F$CFU$,FM$CFUA.LINKX);

   1729  2 000201   200006 470500                    LDP0    CFU$,,AUTO
         2 000202   000000 720100                    LXL0    0,,PR0
         2 000203   000000 636010                    EAQ     0,X0
         2 000204   000000 036000 xsym               ADLQ    F$CFU$
         2 000205   200006 756100                    STQ     CFU$,,AUTO

      468     1730    3            END;

   1730  2 000206   000000 116000 xsym               CMPQ    F$CFU$
         2 000207   000157 601000 2                  TNZ     s:1724

      469     1731    2         FLAG=-FM$CFUX.CFUT*FM_PCTFREEC/(SIZEW(FM$CFU)*100);

PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:94   
   1731  2 000210   000000 470400 xsym               LDP0    F$CFU$
         2 000211   000002 236100                    LDQ     2,,PR0
         2 000212   000022 772000                    QRL     18
         2 000213   000001 402000 0                  MPY     FM_PCTFREEC
         2 000214   000027 676000 xsym               ERQ     B_VECTNIL+23
         2 000215   000001 036007                    ADLQ    1,DL
         2 000216   001440 506007                    DIV     800,DL
         2 000217   200010 756100                    STQ     FLAG,,AUTO

      470     1732    2         I=FM$CFUX.NAMET-FM$CFUX.NAMEX-FM_PCTFREEN*

   1732  2 000220   000002 236100                    LDQ     2,,PR0
         2 000221   777777 376007                    ANQ     -1,DL
         2 000222   200012 756100                    STQ     FLAG+2,,AUTO
         2 000223   000003 236100                    LDQ     3,,PR0
         2 000224   000022 772000                    QRL     18
         2 000225   200012 136100                    SBLQ    FLAG+2,,AUTO
         2 000226   200013 756100                    STQ     FLAG+3,,AUTO
         2 000227   000001 236100                    LDQ     1,,PR0
         2 000230   777777 376007                    ANQ     -1,DL
         2 000231   200014 756100                    STQ     FLAG+4,,AUTO
         2 000232   000003 236100                    LDQ     3,,PR0
         2 000233   000022 772000                    QRL     18
         2 000234   200014 136100                    SBLQ    FLAG+4,,AUTO
         2 000235   000000 402000 0                  MPY     FM_PCTFREEN
         2 000236   000144 506007                    DIV     100,DL
         2 000237   200015 756100                    STQ     FLAG+5,,AUTO
         2 000240   200013 236100                    LDQ     FLAG+3,,AUTO
         2 000241   200015 136100                    SBLQ    FLAG+5,,AUTO
         2 000242   200004 756100                    STQ     I,,AUTO

      471     1733    2           (FM$CFUX.NAMET-FM$CFUX.NAMES)/100;
      472     1734    2         NAME$=PINCRC(F$CFU$,FM$CFUX.NAMES);

   1734  2 000243   000001 236100                    LDQ     1,,PR0
         2 000244   777777 376007                    ANQ     -1,DL
         2 000245   000020 736000                    QLS     16
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:95   
         2 000246   000000 036000 xsym               ADLQ    F$CFU$
         2 000247   200007 756100                    STQ     NAME$,,AUTO

      473     1735    2         CFUX$=PINCRC(F$CFU$,FM$CFUX.NAMEX);

   1735  2 000250   000002 236100                    LDQ     2,,PR0
         2 000251   777777 376007                    ANQ     -1,DL
         2 000252   000020 736000                    QLS     16
         2 000253   000000 036000 xsym               ADLQ    F$CFU$
         2 000254   200005 756100                    STQ     CFUX,,AUTO

      474     1736    3         DO WHILE (NAME$<CFUX$);

   1736  2 000255   200007 116100                    CMPQ    NAME$,,AUTO
         2 000256   000312 602000 2                  TNC     s:1740
         2 000257   000312 600000 2                  TZE     s:1740

      475     1737    3            IF FM$CFUN.LNKX>FM$CFUX.CFUT THEN I=I+3+FM$CFUN.L;

   1737  2 000260   200007 470500                    LDP0    NAME$,,AUTO
         2 000261   000100 101500                    MRL     fill='000'O
         2 000262   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         2 000263   200012 000004                    ADSC9   FLAG+2,,AUTO             cn=0,n=4
         2 000264   000000 471400 xsym               LDP1    F$CFU$
         2 000265   100002 236100                    LDQ     2,,PR1
         2 000266   000022 772000                    QRL     18
         2 000267   200012 116100                    CMPQ    FLAG+2,,AUTO
         2 000270   000300 605000 2                  TPL     s:1738

   1737  2 000271   000100 101500                    MRL     fill='000'O
         2 000272   000000 400001                    ADSC9   0,,PR0                   cn=2,n=1
         2 000273   200012 000004                    ADSC9   FLAG+2,,AUTO             cn=0,n=4
         2 000274   200012 236100                    LDQ     FLAG+2,,AUTO
         2 000275   200004 036100                    ADLQ    I,,AUTO
         2 000276   000003 036007                    ADLQ    3,DL
         2 000277   200004 756100                    STQ     I,,AUTO

PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:96   
      476     1738    3            NAME$=PINCRC(NAME$,FM$CFUN.L+3);

   1738  2 000300   000100 101500                    MRL     fill='000'O
         2 000301   000000 400001                    ADSC9   0,,PR0                   cn=2,n=1
         2 000302   200012 000004                    ADSC9   FLAG+2,,AUTO             cn=0,n=4
         2 000303   200012 236100                    LDQ     FLAG+2,,AUTO
         2 000304   000020 736000                    QLS     16
         2 000305   600000 036007                    ADLQ    -65536,DL
         2 000306   200007 036100                    ADLQ    NAME$,,AUTO
         2 000307   200007 756100                    STQ     NAME$,,AUTO

      477     1739    3            END;

   1739  2 000310   200005 116100                    CMPQ    CFUX,,AUTO
         2 000311   000260 602000 2                  TNC     s:1737

      478     1740    2         CFU$=PINCRW(F$CFU$,FM$CFUX.HEAD);

   1740  2 000312   000000 470400 xsym               LDP0    F$CFU$
         2 000313   000007 720100                    LXL0    7,,PR0
         2 000314   000000 636010                    EAQ     0,X0
         2 000315   000000 036000 xsym               ADLQ    F$CFU$
         2 000316   200006 756100                    STQ     CFU$,,AUTO

      479     1741    2         CFUX=0;

   1741  2 000317   200005 450100                    STZ     CFUX,,AUTO

      480     1742    3         DO WHILE(CFU$~=F$CFU$ AND (FLAG<0 OR I<0));

   1742  2 000320   000430 710000 2                  TRA     s:1757

      481     1743    3            IF CFU$X.X>=FM$CFUX.CFUT

   1743  2 000321   200006 220100                    LDX0    CFU$,,AUTO
         2 000322   000000 470400 xsym               LDP0    F$CFU$
         2 000323   000002 100100                    CMPX0   2,,PR0
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:97   
         2 000324   000336 603000 2                  TRC     s:1746
         2 000325   200006 236100                    LDQ     CFU$,,AUTO
         2 000326   000022 772000                    QRL     18
         2 000327   000007 376007                    ANQ     7,DL
         2 000330   000336 601000 2                  TNZ     s:1746
         2 000331   200006 471500                    LDP1    CFU$,,AUTO
         2 000332   100007 236100                    LDQ     7,,PR1
         2 000333   000022 772000                    QRL     18
         2 000334   200005 116100                    CMPQ    CFUX,,AUTO
         2 000335   000340 600000 2                  TZE     s:1747

      482     1744    3              OR MOD(CFU$X.X,8)~=0
      483     1745    3              OR CFUX~=CFU$->FM$CFUX.TAIL
      484     1746    3            THEN CALL SC_CFUSBAD;

   1746  2 000336   000000 713400 xsym               CLIMB   SC_CFUSBAD
         2 000337   000000 600000 xsid               climb   nvectors=         0

      485     1747    4            IF FM$CFU.NAMEX~=0 THEN DO;

   1747  2 000340   200006 470500                    LDP0    CFU$,,AUTO
         2 000341   000002 720100                    LXL0    2,,PR0
         2 000342   000415 600000 2                  TZE     s:1753

      486     1748    4               NAMEX.X=FM$CFU.NAMEX;

   1748  2 000343   000002 236100                    LDQ     2,,PR0
         2 000344   777777 376007                    ANQ     -1,DL
         2 000345   000020 736000                    QLS     16
         2 000346   200007 676100                    ERQ     NAME$,,AUTO
         2 000347   000034 376000 xsym               ANQ     B_VECTNIL+28
         2 000350   200007 656100                    ERSQ    NAME$,,AUTO

      487     1749    4               CALL FMR$FN(CFU$);

   1749  2 000351   200006 631500                    EPPR1   CFU$,,AUTO
         2 000352   200012 451500                    STP1    FLAG+2,,AUTO
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:98   
         2 000353   200012 630500                    EPPR0   FLAG+2,,AUTO
         2 000354   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000355   000000 701000 xent               TSX1    FMR$FN
         2 000356   000000 011000                    NOP     0

      488     1750    4               IF NAMEX.X>FM$CFUX.CFUT AND NAMEX.X<FM$CFUX.NAMET

   1750  2 000357   200007 236100                    LDQ     NAME$,,AUTO
         2 000360   000020 772000                    QRL     16
         2 000361   200012 756100                    STQ     FLAG+2,,AUTO
         2 000362   000000 470400 xsym               LDP0    F$CFU$
         2 000363   000002 236100                    LDQ     2,,PR0
         2 000364   000022 772000                    QRL     18
         2 000365   200012 116100                    CMPQ    FLAG+2,,AUTO
         2 000366   000415 605000 2                  TPL     s:1753
         2 000367   000003 236100                    LDQ     3,,PR0
         2 000370   000022 772000                    QRL     18
         2 000371   200013 756100                    STQ     FLAG+3,,AUTO
         2 000372   200007 236100                    LDQ     NAME$,,AUTO
         2 000373   000020 772000                    QRL     16
         2 000374   200013 116100                    CMPQ    FLAG+3,,AUTO
         2 000375   000415 605000 2                  TPL     s:1753

      489     1751    4               THEN IF FM$CFUN.LNKX=NAMEX.X THEN I=I+3+FM$CFUN.L;

   1751  2 000376   200012 756100                    STQ     FLAG+2,,AUTO
         2 000377   200007 471500                    LDP1    NAME$,,AUTO
         2 000400   000100 101500                    MRL     fill='000'O
         2 000401   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2
         2 000402   200013 000004                    ADSC9   FLAG+3,,AUTO             cn=0,n=4
         2 000403   200013 236100                    LDQ     FLAG+3,,AUTO
         2 000404   200012 116100                    CMPQ    FLAG+2,,AUTO
         2 000405   000415 601000 2                  TNZ     s:1753

   1751  2 000406   000100 101500                    MRL     fill='000'O
         2 000407   100000 400001                    ADSC9   0,,PR1                   cn=2,n=1
         2 000410   200012 000004                    ADSC9   FLAG+2,,AUTO             cn=0,n=4
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:99   
         2 000411   200012 236100                    LDQ     FLAG+2,,AUTO
         2 000412   200004 036100                    ADLQ    I,,AUTO
         2 000413   000003 036007                    ADLQ    3,DL
         2 000414   200004 756100                    STQ     I,,AUTO

      490     1752    4               END;

      491     1753    3            FM$CFUF.W0=0;

   1753  2 000415   200006 470500                    LDP0    CFU$,,AUTO
         2 000416   000000 450100                    STZ     0,,PR0

      492     1754    3            CFUX=CFU$X.X;

   1754  2 000417   200006 235100                    LDA     CFU$,,AUTO
         2 000420   000022 771000                    ARL     18
         2 000421   200005 755100                    STA     CFUX,,AUTO

      493     1755    3            CFU$=PINCRW(F$CFU$,CFU$->FM$CFUX.HEAD);

   1755  2 000422   200006 470500                    LDP0    CFU$,,AUTO
         2 000423   000007 720100                    LXL0    7,,PR0
         2 000424   000000 636010                    EAQ     0,X0
         2 000425   000000 036000 xsym               ADLQ    F$CFU$
         2 000426   200006 756100                    STQ     CFU$,,AUTO

      494     1756    3            FLAG=FLAG+1;

   1756  2 000427   200010 054100                    AOS     FLAG,,AUTO

      495     1757    3            END;

   1757  2 000430   000000 116000 xsym               CMPQ    F$CFU$
         2 000431   000436 600000 2                  TZE     s:1760
         2 000432   200010 235100                    LDA     FLAG,,AUTO
         2 000433   000321 604000 2                  TMI     s:1743
         2 000434   200004 235100                    LDA     I,,AUTO
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:100  
         2 000435   000321 604000 2                  TMI     s:1743

      496     1758                    /**/
      497     1759                    /* MARK THE ACCOUNT BLOCKS FOR THE REST, SINCE FUN=0 */
      498     1760    3         DO WHILE (CFU$~=F$CFU$);

   1760  2 000436   000000 116000 xsym               CMPQ    F$CFU$
         2 000437   000502 600000 2                  TZE     s:1772

      499     1761    3            IF CFU$X.X>=FM$CFUX.CFUT

   1761  2 000440   200006 220100                    LDX0    CFU$,,AUTO
         2 000441   000000 470400 xsym               LDP0    F$CFU$
         2 000442   000002 100100                    CMPX0   2,,PR0
         2 000443   000455 603000 2                  TRC     s:1764
         2 000444   200006 236100                    LDQ     CFU$,,AUTO
         2 000445   000022 772000                    QRL     18
         2 000446   000007 376007                    ANQ     7,DL
         2 000447   000455 601000 2                  TNZ     s:1764
         2 000450   200006 471500                    LDP1    CFU$,,AUTO
         2 000451   100007 236100                    LDQ     7,,PR1
         2 000452   000022 772000                    QRL     18
         2 000453   200005 116100                    CMPQ    CFUX,,AUTO
         2 000454   000457 600000 2                  TZE     s:1765

      500     1762    3              OR MOD(CFU$X.X,8)~=0
      501     1763    3              OR CFUX~=CFU$->FM$CFUX.TAIL
      502     1764    3            THEN CALL SC_CFUSBAD;

   1764  2 000455   000000 713400 xsym               CLIMB   SC_CFUSBAD
         2 000456   000000 600000 xsid               climb   nvectors=         0

      503     1765    3            IF FM$CFU.ACCTX~=0 AND FM$CFU.ACCTX<FM$CFUX.CFUT

   1765  2 000457   200006 470500                    LDP0    CFU$,,AUTO
         2 000460   000002 220100                    LDX0    2,,PR0
         2 000461   000467 600000 2                  TZE     s:1767
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:101  
         2 000462   000000 471400 xsym               LDP1    F$CFU$
         2 000463   100002 100100                    CMPX0   2,,PR1
         2 000464   000467 603000 2                  TRC     s:1767

      504     1766    3            THEN PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.GCCTL='0'B;

   1766  2 000465   000003 236000 3                  LDQ     3
         2 000466   100005 356110                    ANSQ    5,X0,PR1

      505     1767    3            CFUX=CFU$X.X;

   1767  2 000467   200006 235100                    LDA     CFU$,,AUTO
         2 000470   000022 771000                    ARL     18
         2 000471   200005 755100                    STA     CFUX,,AUTO

      506     1768    3            CFU$=PINCRW(F$CFU$,CFU$->FM$CFUX.HEAD);

   1768  2 000472   200006 470500                    LDP0    CFU$,,AUTO
         2 000473   000007 720100                    LXL0    7,,PR0
         2 000474   000000 636010                    EAQ     0,X0
         2 000475   000000 036000 xsym               ADLQ    F$CFU$
         2 000476   200006 756100                    STQ     CFU$,,AUTO

      507     1769    3            FLAG=FLAG+1;

   1769  2 000477   200010 054100                    AOS     FLAG,,AUTO

      508     1770    3            END;

   1770  2 000500   000000 116000 xsym               CMPQ    F$CFU$
         2 000501   000440 601000 2                  TNZ     s:1761

      509     1771                    /* NOW SQUEEZE THE NAME AREA */
      510     1772    2         CFUX$=PINCRC(F$CFU$,FM$CFUX.NAMEX);

   1772  2 000502   000000 470400 xsym               LDP0    F$CFU$
         2 000503   000002 236100                    LDQ     2,,PR0
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:102  
         2 000504   777777 376007                    ANQ     -1,DL
         2 000505   000020 736000                    QLS     16
         2 000506   000000 036000 xsym               ADLQ    F$CFU$
         2 000507   200005 756100                    STQ     CFUX,,AUTO

      511     1773    2         NAME$=PINCRC(F$CFU$,FM$CFUX.NAMES);

   1773  2 000510   000001 236100                    LDQ     1,,PR0
         2 000511   777777 376007                    ANQ     -1,DL
         2 000512   000020 736000                    QLS     16
         2 000513   000000 036000 xsym               ADLQ    F$CFU$
         2 000514   200007 756100                    STQ     NAME$,,AUTO

      512     1774    2         P$=NAME$;

   1774  2 000515   200003 756100                    STQ     P$,,AUTO

      513     1775    3         DO WHILE (NAME$<CFUX$);

   1775  2 000516   200005 116100                    CMPQ    CFUX,,AUTO
         2 000517   000612 603000 2                  TRC     s:1790

      514     1776    3            I=FM$CFUN.LNKX;

   1776  2 000520   200007 470500                    LDP0    NAME$,,AUTO
         2 000521   000100 101500                    MRL     fill='000'O
         2 000522   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         2 000523   200004 000004                    ADSC9   I,,AUTO                  cn=0,n=4

      515     1777    4            IF I<FM$CFUX.CFUT THEN DO;

   1777  2 000524   000000 471400 xsym               LDP1    F$CFU$
         2 000525   100002 236100                    LDQ     2,,PR1
         2 000526   000022 772000                    QRL     18
         2 000527   200004 116100                    CMPQ    I,,AUTO
         2 000530   000576 604400 2                  TMOZ    s:1787

PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:103  
      516     1778    5               DO WHILE (I<FM$CFUX.CFUT);

   1778  2 000531   000547 604400 2                  TMOZ    s:1782

      517     1779    5                  CFU$=PINCRW(F$CFU$,I);

   1779  2 000532   200004 236100                    LDQ     I,,AUTO
         2 000533   000022 736000                    QLS     18
         2 000534   000000 036000 xsym               ADLQ    F$CFU$
         2 000535   200006 756100                    STQ     CFU$,,AUTO

      518     1780    5                  I=FM$CFU.NAMEX;

   1780  2 000536   200006 470500                    LDP0    CFU$,,AUTO
         2 000537   000002 236100                    LDQ     2,,PR0
         2 000540   777777 376007                    ANQ     -1,DL
         2 000541   200004 756100                    STQ     I,,AUTO

      519     1781    5                  END;

   1781  2 000542   000000 471400 xsym               LDP1    F$CFU$
         2 000543   100002 236100                    LDQ     2,,PR1
         2 000544   000022 772000                    QRL     18
         2 000545   200004 116100                    CMPQ    I,,AUTO
         2 000546   000532 605400 2                  TPNZ    s:1779

      520     1782    4               FM$CFU.NAMEX=PX.X;

   1782  2 000547   200003 236100                    LDQ     P$,,AUTO
         2 000550   000020 772000                    QRL     16
         2 000551   000000 620006                    EAX0    0,QL
         2 000552   200006 470500                    LDP0    CFU$,,AUTO
         2 000553   000002 440100                    SXL0    2,,PR0

      521     1783    4               I=FM$CFUN.L+3;

   1783  2 000554   200007 470500                    LDP0    NAME$,,AUTO
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:104  
         2 000555   000100 101500                    MRL     fill='000'O
         2 000556   000000 400001                    ADSC9   0,,PR0                   cn=2,n=1
         2 000557   200012 000004                    ADSC9   FLAG+2,,AUTO             cn=0,n=4
         2 000560   200012 236100                    LDQ     FLAG+2,,AUTO
         2 000561   000003 036007                    ADLQ    3,DL
         2 000562   200004 756100                    STQ     I,,AUTO

      522     1784    4               P$->A1=NAME$->A1;

   1784  2 000563   000000 620006                    EAX0    0,QL
         2 000564   200003 473500                    LDP3    P$,,AUTO
         2 000565   200004 721100                    LXL1    I,,AUTO
         2 000566   040140 100540                    MLR     fill='040'O
         2 000567   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         2 000570   300000 000011                    ADSC9   0,,PR3                   cn=0,n=*X1

      523     1785    4               P$=PINCRC(P$,I);

   1785  2 000571   200004 236100                    LDQ     I,,AUTO
         2 000572   000020 736000                    QLS     16
         2 000573   200003 036100                    ADLQ    P$,,AUTO
         2 000574   200003 756100                    STQ     P$,,AUTO

      524     1786    4               END;

   1786  2 000575   000604 710000 2                  TRA     s:1788

      525     1787    3            ELSE I=FM$CFUN.L+3;

   1787  2 000576   000100 101500                    MRL     fill='000'O
         2 000577   000000 400001                    ADSC9   0,,PR0                   cn=2,n=1
         2 000600   200012 000004                    ADSC9   FLAG+2,,AUTO             cn=0,n=4
         2 000601   200012 236100                    LDQ     FLAG+2,,AUTO
         2 000602   000003 036007                    ADLQ    3,DL
         2 000603   200004 756100                    STQ     I,,AUTO

      526     1788    3            NAME$=PINCRC(NAME$,I);
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:105  

   1788  2 000604   200004 236100                    LDQ     I,,AUTO
         2 000605   000020 736000                    QLS     16
         2 000606   200007 036100                    ADLQ    NAME$,,AUTO
         2 000607   200007 756100                    STQ     NAME$,,AUTO

      527     1789    3            END;

   1789  2 000610   200005 116100                    CMPQ    CFUX,,AUTO
         2 000611   000520 602000 2                  TNC     s:1776

      528     1790    2         FM$CFUX.NAMEX=PX.X;

   1790  2 000612   200003 236100                    LDQ     P$,,AUTO
         2 000613   000020 772000                    QRL     16
         2 000614   000000 620006                    EAX0    0,QL
         2 000615   000000 470400 xsym               LDP0    F$CFU$
         2 000616   000002 440100                    SXL0    2,,PR0

      529     1791        %EJECT;
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:106  
      530     1792                    /* NOW FIND THE ACCT BLOCK WHICH MIGHT BE IN USE */
      531     1793    2         CFU$=PINCRW(F$CFU$,SIZEW(FM$CFU));

   1793  2 000617   000000 236000 xsym               LDQ     F$CFU$
         2 000620   000010 036003                    ADLQ    8,DU
         2 000621   200006 756100                    STQ     CFU$,,AUTO

      532     1794    3         DO WHILE (CFU$X.X<FM$CFUX.CFUT);

   1794  2 000622   200006 220100                    LDX0    CFU$,,AUTO
         2 000623   000002 100100                    CMPX0   2,,PR0
         2 000624   000712 603000 2                  TRC     s:1813

      533     1795    3            IF FM$CFU.ACCTX~=0

   1795  2 000625   200006 470500                    LDP0    CFU$,,AUTO
         2 000626   000002 220100                    LDX0    2,,PR0
         2 000627   000703 600000 2                  TZE     s:1810
         2 000630   000000 471400 xsym               LDP1    F$CFU$
         2 000631   100002 100100                    CMPX0   2,,PR1
         2 000632   000703 603000 2                  TRC     s:1810
         2 000633   000002 236100                    LDQ     2,,PR0
         2 000634   000022 772000                    QRL     18
         2 000635   000007 376007                    ANQ     7,DL
         2 000636   000703 601000 2                  TNZ     s:1810
         2 000637   000000 236100                    LDQ     0,,PR0
         2 000640   700000 316003                    CANQ    -32768,DU
         2 000641   000703 600000 2                  TZE     s:1810

      534     1796    3              AND FM$CFU.ACCTX<FM$CFUX.CFUT
      535     1797    3              AND MOD(FM$CFU.ACCTX,SIZEW(FM$CFU))=0
      536     1798    3              AND FM$CFU.FUN~=0
      537     1799    3            THEN IF PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.GCCTL

   1799  2 000642   100005 236110                    LDQ     5,X0,PR1
         2 000643   020000 316003                    CANQ    8192,DU
         2 000644   000703 600000 2                  TZE     s:1810
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:107  

      538     1800    4               THEN DO;

      539     1801    4                  P$=PINCRW(F$CFU$,FM$CFUX.ACCTS);

   1801  2 000645   100000 721100                    LXL1    0,,PR1
         2 000646   000000 636011                    EAQ     0,X1
         2 000647   000000 036000 xsym               ADLQ    F$CFU$
         2 000650   200003 756100                    STQ     P$,,AUTO

      540     1802    5                  DO WHILE (P$~=F$CFU$);

   1802  2 000651   000000 116000 xsym               CMPQ    F$CFU$
         2 000652   000703 600000 2                  TZE     s:1810

      541     1803    6                     IF PX.X/4=FM$CFU.ACCTX THEN DO;

   1803  2 000653   200003 236100                    LDQ     P$,,AUTO
         2 000654   000020 772000                    QRL     16
         2 000655   000002 772000                    QRL     2
         2 000656   200006 470500                    LDP0    CFU$,,AUTO
         2 000657   200012 756100                    STQ     FLAG+2,,AUTO
         2 000660   000002 236100                    LDQ     2,,PR0
         2 000661   000022 772000                    QRL     18
         2 000662   200013 756100                    STQ     FLAG+3,,AUTO
         2 000663   200012 236100                    LDQ     FLAG+2,,AUTO
         2 000664   200013 116100                    CMPQ    FLAG+3,,AUTO
         2 000665   000674 601000 2                  TNZ     s:1807

      542     1804    6                        P$->FM$CFUA.GCCTL='0'B;

   1804  2 000666   200003 471500                    LDP1    P$,,AUTO
         2 000667   000003 236000 3                  LDQ     3
         2 000670   100005 356100                    ANSQ    5,,PR1

      543     1805    6                        P$=F$CFU$;

PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:108  
   1805  2 000671   000000 236000 xsym               LDQ     F$CFU$
         2 000672   200003 756100                    STQ     P$,,AUTO

      544     1806    6                        END;

   1806  2 000673   000701 710000 2                  TRA     s:1808

      545     1807    5                     ELSE P$=PINCRW(F$CFU$,P$->FM$CFUA.LINKX);

   1807  2 000674   200003 471500                    LDP1    P$,,AUTO
         2 000675   100000 720100                    LXL0    0,,PR1
         2 000676   000000 636010                    EAQ     0,X0
         2 000677   000000 036000 xsym               ADLQ    F$CFU$
         2 000700   200003 756100                    STQ     P$,,AUTO

      546     1808    5                     END;

   1808  2 000701   000000 116000 xsym               CMPQ    F$CFU$
         2 000702   000653 601000 2                  TNZ     s:1803

      547     1809    4                  END;

      548     1810    3            CFU$=PINCRW(CFU$,SIZEW(FM$CFU));

   1810  2 000703   200006 236100                    LDQ     CFU$,,AUTO
         2 000704   000010 036003                    ADLQ    8,DU
         2 000705   200006 756100                    STQ     CFU$,,AUTO

      549     1811    3            END;

   1811  2 000706   200006 220100                    LDX0    CFU$,,AUTO
         2 000707   000000 470400 xsym               LDP0    F$CFU$
         2 000710   000002 100100                    CMPX0   2,,PR0
         2 000711   000625 602000 2                  TNC     s:1795

      550     1812                    /* NOW FREE SET ENTRIES THAT ARE NOT BUSY */
      551     1813    2         P$=ADDR(FM$SET(FM$CFUX.SETH));
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:109  

   1813  2 000712   000005 236100                    LDQ     5,,PR0
         2 000713   000017 772000                    QRL     15
         2 000714   000004 376000 3                  ANQ     4
         2 000715   000022 736000                    QLS     18
         2 000716   000000 036000 xsym               ADLQ    FM$SET$
         2 000717   200003 756100                    STQ     P$,,AUTO

      552     1814    2         CFUX$=FM$SET$;

   1814  2 000720   000000 236000 xsym               LDQ     FM$SET$
         2 000721   200005 756100                    STQ     CFUX,,AUTO

      553     1815    3         DO WHILE (P$~=FM$SET$);

   1815  2 000722   200003 116100                    CMPQ    P$,,AUTO
         2 000723   001005 600000 2                  TZE     s:1829

      554     1816    3            IF P$>=CFU$ THEN CALL SC_CFUSBAD;

   1816  2 000724   200003 236100                    LDQ     P$,,AUTO
         2 000725   200006 116100                    CMPQ    CFU$,,AUTO
         2 000726   000731 602000 2                  TNC     s:1817

   1816  2 000727   000000 713400 xsym               CLIMB   SC_CFUSBAD
         2 000730   000000 600000 xsid               climb   nvectors=         0

      555     1817    4            IF P$->FM$SET.SYSID(0)=0 AND P$->FM$SET.DCTX(0)=0 THEN DO;

   1817  2 000731   200003 470500                    LDP0    P$,,AUTO
         2 000732   000002 720100                    LXL0    2,,PR0
         2 000733   000772 601000 2                  TNZ     s:1825
         2 000734   000000 221100                    LDX1    0,,PR0
         2 000735   000772 601000 2                  TNZ     s:1825

      556     1818    4               FLAG=FLAG+1;

PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:110  
   1818  2 000736   200010 054100                    AOS     FLAG,,AUTO

      557     1819    4               CFUX$->FM$SET.SETL(0)=P$->FM$SET.SETL(0);

   1819  2 000737   000005 220100                    LDX0    5,,PR0
         2 000740   200005 471500                    LDP1    CFUX,,AUTO
         2 000741   100005 740100                    STX0    5,,PR1

      558     1820    4               CALL UQB$DELQIDX(P$);

   1820  2 000742   200003 631500                    EPPR1   P$,,AUTO
         2 000743   200012 451500                    STP1    FLAG+2,,AUTO
         2 000744   200012 630500                    EPPR0   FLAG+2,,AUTO
         2 000745   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000746   000000 701000 xent               TSX1    UQB$DELQIDX
         2 000747   000000 011000                    NOP     0

      559     1821    4               CALL UQB$DELQIDX(PINCRW(P$,6));

   1821  2 000750   200003 236100                    LDQ     P$,,AUTO
         2 000751   000006 036003                    ADLQ    6,DU
         2 000752   200012 756100                    STQ     FLAG+2,,AUTO
         2 000753   200012 630500                    EPPR0   FLAG+2,,AUTO
         2 000754   200013 450500                    STP0    FLAG+3,,AUTO
         2 000755   200013 630500                    EPPR0   FLAG+3,,AUTO
         2 000756   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000757   000000 701000 xent               TSX1    UQB$DELQIDX
         2 000760   000000 011000                    NOP     0

      560     1822    4               CALL FMR$ZA(P$);

   1822  2 000761   200003 630500                    EPPR0   P$,,AUTO
         2 000762   200012 450500                    STP0    FLAG+2,,AUTO
         2 000763   200012 630500                    EPPR0   FLAG+2,,AUTO
         2 000764   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000765   000000 701000 xent               TSX1    FMR$ZA
         2 000766   000000 011000                    NOP     0
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:111  

      561     1823    4               P$=CFUX$;

   1823  2 000767   200005 236100                    LDQ     CFUX,,AUTO
         2 000770   200003 756100                    STQ     P$,,AUTO

      562     1824    4               END;

   1824  2 000771   000774 710000 2                  TRA     s:1826

      563     1825    3            ELSE CFUX$=P$;

   1825  2 000772   200003 236100                    LDQ     P$,,AUTO
         2 000773   200005 756100                    STQ     CFUX,,AUTO

      564     1826    3            P$=ADDR(FM$SET(P$->FM$SET.SETL(0)));

   1826  2 000774   200003 470500                    LDP0    P$,,AUTO
         2 000775   000005 236100                    LDQ     5,,PR0
         2 000776   000017 772000                    QRL     15
         2 000777   000004 376000 3                  ANQ     4
         2 001000   000022 736000                    QLS     18
         2 001001   000000 036000 xsym               ADLQ    FM$SET$
         2 001002   200003 756100                    STQ     P$,,AUTO

      565     1827    3            END;

   1827  2 001003   000000 116000 xsym               CMPQ    FM$SET$
         2 001004   000724 601000 2                  TNZ     s:1816

      566     1828                    /* NOW TRASH THE UNBUSY, UNUPDATED, ACCT BLOCKS */
      567     1829    2         P$=F$CFU$;

   1829  2 001005   000000 236000 xsym               LDQ     F$CFU$
         2 001006   200003 756100                    STQ     P$,,AUTO

      568     1830    2         CFU$=PINCRW(F$CFU$,FM$CFUX.ACCTS);
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:112  

   1830  2 001007   000000 470400 xsym               LDP0    F$CFU$
         2 001010   000000 720100                    LXL0    0,,PR0
         2 001011   000000 636010                    EAQ     0,X0
         2 001012   000000 036000 xsym               ADLQ    F$CFU$
         2 001013   200006 756100                    STQ     CFU$,,AUTO

      569     1831    3         DO WHILE (CFU$~=F$CFU$);

   1831  2 001014   000000 116000 xsym               CMPQ    F$CFU$
         2 001015   001110 600000 2                  TZE     s:1847

      570     1832    3            IF FM$CFUA.GCCTL AND (FM$CFUA.GMOD=0 OR FM$CFUA.ACCT<=' ') AND

   1832  2 001016   200006 470500                    LDP0    CFU$,,AUTO
         2 001017   000005 236100                    LDQ     5,,PR0
         2 001020   020000 316003                    CANQ    8192,DU
         2 001021   001066 600000 2                  TZE     s:1842
         2 001022   100000 316003                    CANQ    32768,DU
         2 001023   001030 600000 2                  TZE     s:1832+10
         2 001024   040100 106400                    CMPC    fill='040'O
         2 001025   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 001026   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         2 001027   001066 602000 2                  TNC     s:1842
         2 001030   000004 235100                    LDA     4,,PR0
         2 001031   001040 600000 2                  TZE     s:1834
         2 001032   200010 235100                    LDA     FLAG,,AUTO
         2 001033   001040 604000 2                  TMI     s:1834
         2 001034   000006 220100                    LDX0    6,,PR0
         2 001035   000000 471400 xsym               LDP1    F$CFU$
         2 001036   100000 100100                    CMPX0   0,,PR1
         2 001037   001066 600000 2                  TZE     s:1842

      571     1833    4              (FM$CFUA.FDFITSDA=0 OR FLAG<0 OR FM$CFUA.AGE~=FM$CFUX.GCT) THEN DO;

      572     1834    4               P$->FM$CFUA.LINKX=FM$CFUA.LINKX;

PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:113  
   1834  2 001040   000000 720100                    LXL0    0,,PR0
         2 001041   200003 471500                    LDP1    P$,,AUTO
         2 001042   100000 440100                    SXL0    0,,PR1

      573     1835    4               CALL UQB$DELQIDX(CFU$);

   1835  2 001043   200006 630500                    EPPR0   CFU$,,AUTO
         2 001044   200012 450500                    STP0    FLAG+2,,AUTO
         2 001045   200012 630500                    EPPR0   FLAG+2,,AUTO
         2 001046   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001047   000000 701000 xent               TSX1    UQB$DELQIDX
         2 001050   000000 011000                    NOP     0

      574     1836    4               IF CFU$X.X=FM_SYSACCTX THEN

   1836  2 001051   200006 236100                    LDQ     CFU$,,AUTO
         2 001052   000022 772000                    QRL     18
         2 001053   000000 116000 xsym               CMPQ    FM_SYSACCTX
         2 001054   001056 601000 2                  TNZ     s:1838

      575     1837    4                  FM_SYSACCTX=0; /* so we'll set it right when we get a new one */

   1837  2 001055   000000 450000 xsym               STZ     FM_SYSACCTX

      576     1838    4               CALL FMR$ZA(CFU$);

   1838  2 001056   200006 630500                    EPPR0   CFU$,,AUTO
         2 001057   200012 450500                    STP0    FLAG+2,,AUTO
         2 001060   200012 630500                    EPPR0   FLAG+2,,AUTO
         2 001061   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001062   000000 701000 xent               TSX1    FMR$ZA
         2 001063   000000 011000                    NOP     0

      577     1839    4               FLAG=FLAG+1;

   1839  2 001064   200010 054100                    AOS     FLAG,,AUTO

PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:114  
      578     1840    4               END;

   1840  2 001065   001101 710000 2                  TRA     s:1845

      579     1841    4            ELSE DO;

      580     1842    4               P$=CFU$;

   1842  2 001066   200006 236100                    LDQ     CFU$,,AUTO
         2 001067   200003 756100                    STQ     P$,,AUTO

      581     1843    4               IF FM$CFUA.GCCTL THEN CALL UQB$DELQIDX(CFU$);

   1843  2 001070   000005 236100                    LDQ     5,,PR0
         2 001071   020000 316003                    CANQ    8192,DU
         2 001072   001101 600000 2                  TZE     s:1845

   1843  2 001073   200006 631500                    EPPR1   CFU$,,AUTO
         2 001074   200012 451500                    STP1    FLAG+2,,AUTO
         2 001075   200012 630500                    EPPR0   FLAG+2,,AUTO
         2 001076   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001077   000000 701000 xent               TSX1    UQB$DELQIDX
         2 001100   000000 011000                    NOP     0

      582     1844    4               END;

      583     1845    3            CFU$=PINCRW(F$CFU$,P$->FM$CFUA.LINKX);

   1845  2 001101   200003 470500                    LDP0    P$,,AUTO
         2 001102   000000 720100                    LXL0    0,,PR0
         2 001103   000000 636010                    EAQ     0,X0
         2 001104   000000 036000 xsym               ADLQ    F$CFU$
         2 001105   200006 756100                    STQ     CFU$,,AUTO

      584     1846    3            END;

   1846  2 001106   000000 116000 xsym               CMPQ    F$CFU$
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:115  
         2 001107   001016 601000 2                  TNZ     s:1832

      585     1847    2         FM$CFUX.ACCTX=POFFW(P$,F$CFU$);

   1847  2 001110   000000 235000 xsym               LDA     F$CFU$
         2 001111   000022 771000                    ARL     18
         2 001112   200012 755100                    STA     FLAG+2,,AUTO
         2 001113   200003 236100                    LDQ     P$,,AUTO
         2 001114   000022 772000                    QRL     18
         2 001115   200012 136100                    SBLQ    FLAG+2,,AUTO
         2 001116   000000 620006                    EAX0    0,QL
         2 001117   000000 470400 xsym               LDP0    F$CFU$
         2 001120   000001 740100                    STX0    1,,PR0

      586     1848                    /* IF THERE ARE NO FFREE CFUS, GET MORE SPACE */
      587     1849                    /* AND MOVE THE NAMES ABOVE IT                */
      588     1850    2         IF FLAG<0 THEN FLAG=1024;

   1850  2 001121   200010 236100                    LDQ     FLAG,,AUTO
         2 001122   001126 605000 2                  TPL     s:1851

   1850  2 001123   002000 235007                    LDA     1024,DL
         2 001124   200010 755100                    STA     FLAG,,AUTO
         2 001125   001127 710000 2                  TRA     s:1852

      589     1851    2         ELSE FLAG=0;

   1851  2 001126   200010 450100                    STZ     FLAG,,AUTO

      590     1852    2         IF (FM$CFUX.NAMET-FM$CFUX.NAMEX)<

   1852  2 001127   000002 236100                    LDQ     2,,PR0
         2 001130   777777 376007                    ANQ     -1,DL
         2 001131   200012 756100                    STQ     FLAG+2,,AUTO
         2 001132   000003 236100                    LDQ     3,,PR0
         2 001133   000022 772000                    QRL     18
         2 001134   200012 136100                    SBLQ    FLAG+2,,AUTO
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:116  
         2 001135   200013 756100                    STQ     FLAG+3,,AUTO
         2 001136   000001 236100                    LDQ     1,,PR0
         2 001137   777777 376007                    ANQ     -1,DL
         2 001140   200014 756100                    STQ     FLAG+4,,AUTO
         2 001141   000003 236100                    LDQ     3,,PR0
         2 001142   000022 772000                    QRL     18
         2 001143   200014 136100                    SBLQ    FLAG+4,,AUTO
         2 001144   000000 402000 0                  MPY     FM_PCTFREEN
         2 001145   000144 506007                    DIV     100,DL
         2 001146   200013 116100                    CMPQ    FLAG+3,,AUTO
         2 001147   001152 604400 2                  TMOZ    s:1855

      591     1853    2           (FM$CFUX.NAMET-FM$CFUX.NAMES)*FM_PCTFREEN/100
      592     1854    2         THEN FLAG=768;

   1854  2 001150   001400 235007                    LDA     768,DL
         2 001151   200010 755100                    STA     FLAG,,AUTO

      593     1855    3         IF FLAG~=0 THEN DO;

   1855  2 001152   200010 235100                    LDA     FLAG,,AUTO
         2 001153   001361 600000 2                  TZE     NOPGS1

      594     1856    3            CALL MMH$GDS(1,B$DS1$,1024,ERR)ALTRET(NOPGS1);

   1856  2 001154   200003 631500                    EPPR1   P$,,AUTO
         2 001155   200015 451500                    STP1    FLAG+5,,AUTO
         2 001156   000006 236000 3                  LDQ     6
         2 001157   200014 756100                    STQ     FLAG+4,,AUTO
         2 001160   000000 237000 3                  LDAQ    0
         2 001161   200012 757100                    STAQ    FLAG+2,,AUTO
         2 001162   200012 630500                    EPPR0   FLAG+2,,AUTO
         2 001163   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 001164   000000 701000 xent               TSX1    MMH$GDS
         2 001165   001361 702000 2                  TSX2    NOPGS1

      595     1857    3            CFUX=(FM$CFUX.NAMET-FM$CFUX.NAMES)/4;
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:117  

   1857  2 001166   000000 470400 xsym               LDP0    F$CFU$
         2 001167   000001 236100                    LDQ     1,,PR0
         2 001170   777777 376007                    ANQ     -1,DL
         2 001171   200012 756100                    STQ     FLAG+2,,AUTO
         2 001172   000003 236100                    LDQ     3,,PR0
         2 001173   000022 772000                    QRL     18
         2 001174   200012 136100                    SBLQ    FLAG+2,,AUTO
         2 001175   000004 506007                    DIV     4,DL
         2 001176   200005 756100                    STQ     CFUX,,AUTO

      596     1858    3            CALL FMR$SLIDE(PINCRW(F$CFU$,FM$CFUX.CFUT),FLAG,CFUX);

   1858  2 001177   000002 220100                    LDX0    2,,PR0
         2 001200   000000 636010                    EAQ     0,X0
         2 001201   000000 036000 xsym               ADLQ    F$CFU$
         2 001202   200012 756100                    STQ     FLAG+2,,AUTO
         2 001203   200005 631500                    EPPR1   CFUX,,AUTO
         2 001204   200015 451500                    STP1    FLAG+5,,AUTO
         2 001205   200010 633500                    EPPR3   FLAG,,AUTO
         2 001206   200014 453500                    STP3    FLAG+4,,AUTO
         2 001207   200012 634500                    EPPR4   FLAG+2,,AUTO
         2 001210   200013 454500                    STP4    FLAG+3,,AUTO
         2 001211   200013 630500                    EPPR0   FLAG+3,,AUTO
         2 001212   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001213   000000 701000 xent               TSX1    FMR$SLIDE
         2 001214   000000 011000                    NOP     0

      597     1859    3            FM$CFUX.NAMES=FM$CFUX.NAMES+FLAG*4;

   1859  2 001215   000000 470400 xsym               LDP0    F$CFU$
         2 001216   000001 236100                    LDQ     1,,PR0
         2 001217   777777 376007                    ANQ     -1,DL
         2 001220   200012 756100                    STQ     FLAG+2,,AUTO
         2 001221   200010 236100                    LDQ     FLAG,,AUTO
         2 001222   000002 736000                    QLS     2
         2 001223   200012 036100                    ADLQ    FLAG+2,,AUTO
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:118  
         2 001224   000000 620006                    EAX0    0,QL
         2 001225   000001 440100                    SXL0    1,,PR0

      598     1860    3            FM$CFUX.NAMEX=FM$CFUX.NAMEX+FLAG*4;

   1860  2 001226   000002 236100                    LDQ     2,,PR0
         2 001227   777777 376007                    ANQ     -1,DL
         2 001230   200012 756100                    STQ     FLAG+2,,AUTO
         2 001231   200010 236100                    LDQ     FLAG,,AUTO
         2 001232   000002 736000                    QLS     2
         2 001233   200012 036100                    ADLQ    FLAG+2,,AUTO
         2 001234   000000 620006                    EAX0    0,QL
         2 001235   000002 440100                    SXL0    2,,PR0

      599     1861    3            FM$CFUX.NAMET=FM$CFUX.NAMET+4096;

   1861  2 001236   000003 221100                    LDX1    3,,PR0
         2 001237   010000 622011                    EAX2    4096,X1
         2 001240   000003 742100                    STX2    3,,PR0

      600     1862    3            P$=PINCRC(F$CFU$,FM$CFUX.NAMEX);

   1862  2 001241   000002 236100                    LDQ     2,,PR0
         2 001242   777777 376007                    ANQ     -1,DL
         2 001243   000020 736000                    QLS     16
         2 001244   000000 036000 xsym               ADLQ    F$CFU$
         2 001245   200003 756100                    STQ     P$,,AUTO

      601     1863    3            NAME$=PINCRC(F$CFU$,FM$CFUX.NAMES);

   1863  2 001246   000001 236100                    LDQ     1,,PR0
         2 001247   777777 376007                    ANQ     -1,DL
         2 001250   000020 736000                    QLS     16
         2 001251   000000 036000 xsym               ADLQ    F$CFU$
         2 001252   200007 756100                    STQ     NAME$,,AUTO

      602     1864    4            DO WHILE (NAME$<P$);
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:119  

   1864  2 001253   200003 116100                    CMPQ    P$,,AUTO
         2 001254   001323 603000 2                  TRC     s:1873

      603     1865    4               I=FM$CFUN.LNKX;

   1865  2 001255   200007 470500                    LDP0    NAME$,,AUTO
         2 001256   000100 101500                    MRL     fill='000'O
         2 001257   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         2 001260   200004 000004                    ADSC9   I,,AUTO                  cn=0,n=4

      604     1866    5               DO WHILE (I<FM$CFUX.CFUT);

   1866  2 001261   000000 471400 xsym               LDP1    F$CFU$
         2 001262   100002 236100                    LDQ     2,,PR1
         2 001263   000022 772000                    QRL     18
         2 001264   200004 116100                    CMPQ    I,,AUTO
         2 001265   001303 604400 2                  TMOZ    s:1870

      605     1867    5                  CFU$=PINCRW(F$CFU$,I);

   1867  2 001266   200004 236100                    LDQ     I,,AUTO
         2 001267   000022 736000                    QLS     18
         2 001270   000000 036000 xsym               ADLQ    F$CFU$
         2 001271   200006 756100                    STQ     CFU$,,AUTO

      606     1868    5                  I=FM$CFU.NAMEX;

   1868  2 001272   200006 470500                    LDP0    CFU$,,AUTO
         2 001273   000002 236100                    LDQ     2,,PR0
         2 001274   777777 376007                    ANQ     -1,DL
         2 001275   200004 756100                    STQ     I,,AUTO

      607     1869    5                  END;

   1869  2 001276   000000 471400 xsym               LDP1    F$CFU$
         2 001277   100002 236100                    LDQ     2,,PR1
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:120  
         2 001300   000022 772000                    QRL     18
         2 001301   200004 116100                    CMPQ    I,,AUTO
         2 001302   001266 605400 2                  TPNZ    s:1867

      608     1870    4               FM$CFU.NAMEX=NAMEX.X;

   1870  2 001303   200007 236100                    LDQ     NAME$,,AUTO
         2 001304   000020 772000                    QRL     16
         2 001305   000000 620006                    EAX0    0,QL
         2 001306   200006 470500                    LDP0    CFU$,,AUTO
         2 001307   000002 440100                    SXL0    2,,PR0

      609     1871    4               NAME$=PINCRC(NAME$,FM$CFUN.L+3);

   1871  2 001310   200007 470500                    LDP0    NAME$,,AUTO
         2 001311   000100 101500                    MRL     fill='000'O
         2 001312   000000 400001                    ADSC9   0,,PR0                   cn=2,n=1
         2 001313   200012 000004                    ADSC9   FLAG+2,,AUTO             cn=0,n=4
         2 001314   200012 236100                    LDQ     FLAG+2,,AUTO
         2 001315   000020 736000                    QLS     16
         2 001316   600000 036007                    ADLQ    -65536,DL
         2 001317   200007 036100                    ADLQ    NAME$,,AUTO
         2 001320   200007 756100                    STQ     NAME$,,AUTO

      610     1872    4               END;

   1872  2 001321   200003 116100                    CMPQ    P$,,AUTO
         2 001322   001255 602000 2                  TNC     s:1865

      611     1873    3            P$=PINCRW(F$CFU$,FM$CFUX.CFUT);

   1873  2 001323   000000 470400 xsym               LDP0    F$CFU$
         2 001324   000002 220100                    LDX0    2,,PR0
         2 001325   000000 636010                    EAQ     0,X0
         2 001326   000000 036000 xsym               ADLQ    F$CFU$
         2 001327   200003 756100                    STQ     P$,,AUTO

PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:121  
      612     1874    3            FM$CFUX.CFUT=FM$CFUX.CFUT+FLAG;

   1874  2 001330   000002 236100                    LDQ     2,,PR0
         2 001331   000022 772000                    QRL     18
         2 001332   200010 036100                    ADLQ    FLAG,,AUTO
         2 001333   000000 620006                    EAX0    0,QL
         2 001334   000002 740100                    STX0    2,,PR0

      613     1875    4            DO WHILE (P$<PINCRW(F$CFU$,FM$CFUX.CFUT));

   1875  2 001335   001352 710000 2                  TRA     s:1879

      614     1876    4               P$->FM$CFU.USECNT=1;

   1876  2 001336   000001 220003                    LDX0    1,DU
         2 001337   200003 470500                    LDP0    P$,,AUTO
         2 001340   000003 440100                    SXL0    3,,PR0

      615     1877    4               CALL FMR$ZA(P$);

   1877  2 001341   200003 630500                    EPPR0   P$,,AUTO
         2 001342   200012 450500                    STP0    FLAG+2,,AUTO
         2 001343   200012 630500                    EPPR0   FLAG+2,,AUTO
         2 001344   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001345   000000 701000 xent               TSX1    FMR$ZA
         2 001346   000000 011000                    NOP     0

      616     1878    4               P$=PINCRW(P$,SIZEW(FM$CFU));

   1878  2 001347   200003 236100                    LDQ     P$,,AUTO
         2 001350   000010 036003                    ADLQ    8,DU
         2 001351   200003 756100                    STQ     P$,,AUTO

      617     1879    4               END;

   1879  2 001352   000000 470400 xsym               LDP0    F$CFU$
         2 001353   000002 220100                    LDX0    2,,PR0
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:122  
         2 001354   000000 636010                    EAQ     0,X0
         2 001355   000000 036000 xsym               ADLQ    F$CFU$
         2 001356   200003 116100                    CMPQ    P$,,AUTO
         2 001357   001361 600000 2                  TZE     NOPGS1
         2 001360   001336 603000 2                  TRC     s:1876

      618     1880    3            END;

   1875  2 001361                       NOPGS1       null
      619     1881    2   NOPGS1:;
      620     1882                    /**/
      621     1883    2         END;

      622     1884    1      FM_GCT=FM_GCT+1;

   1884  2 001361   000000 054000 xsym               AOS     FM_GCT

      623     1885    1      FM$CFUX.GCT=FM_GCT;

   1885  2 001362   000000 720000 xsym               LXL0    FM_GCT
         2 001363   000000 470400 xsym               LDP0    F$CFU$
         2 001364   000000 740100                    STX0    0,,PR0

      624     1886    1      IF FM$CFUX.HEAD~=0

   1886  2 001365   000007 721100                    LXL1    7,,PR0
         2 001366   001375 600000 2                  TZE     s:1888
         2 001367   000002 722100                    LXL2    2,,PR0
         2 001370   000042 623012                    EAX3    34,X2
         2 001371   000003 103100                    CMPX3   3,,PR0
         2 001372   001374 600000 2                  TZE     s:1887
         2 001373   001375 603000 2                  TRC     s:1888

      625     1887    1        AND FM$CFUX.NAMEX+34<=FM$CFUX.NAMET THEN RETURN;

   1887  2 001374   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:123  
      626     1888    1      B$JIT.ERR=FMS$E$NOCFUS;

   1888  2 001375   000000 236000 1                  LDQ     FMS$E$NOCFUS
         2 001376   000000 471400 xsym               LDP1    B$JIT$
         2 001377   100012 756100                    STQ     10,,PR1

      627     1889    1      ALTRETURN;

   1889  2 001400   000000 702200 xent               TSX2  ! X66_AALT

FM_PCTFREEN
 Sect OctLoc
   0     000   000000 000062                                                    ...2

FM_PCTFREEC
 Sect OctLoc
   0     001   000000 000062                                                    ...2

FMS$E$NOCFUS
 Sect OctLoc
   1     000   061523 001572                                                    1...

(unnamed)
 Sect OctLoc
   3     000   000003 006000   000000 006000   000003 777774   757777 777777    ................
   3     004   000007 777770   000000 002000   000005 006000                    ............
      628     1890    1   END FMS$GARBCOL;
      629     1891        %EOD;

PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:124  
--  Include file information  --

   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   FM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMS$GARBCOL.
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:125  

 **** Variables and constants ****

  ****  Section 000  Data  FMS$GARBCOL

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     1-0-0/w UBIN        r     1 FM_PCTFREEC                0-0-0/w UBIN        r     1 FM_PCTFREEN

  ****  Section 001 RoData FMS$GARBCOL

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b STRC        r     1 FMS$E$NOCFUS

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     6-0-0/w PTR         r     1 CFU$                       6-0-0/w STRC        r     1 CFU$X
     5-0-0/w SBIN        r     1 CFUX                       5-0-0/w PTR         r     1 CFUX$
     3-0-0/w SBIN        r     1 ERR                       10-0-0/w SBIN        r     1 FLAG
     4-0-0/w SBIN        r     1 I                          7-0-0/w PTR         r     1 NAME$
     7-0-0/w STRC        r     1 NAMEX                      3-0-0/w PTR         r     1 P$
     3-0-0/w STRC        r     1 PX

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$DS1$                     0-0-0/w PTR         r     1 B$JIT$
     0-0-0/w PTR         r     1 F$CFU$                     0-0-0/w PTR         r     1 FM$SET$
     0-0-0/w SBIN        r     1 FM_GCT                     0-0-0/w UBIN        r     1 FM_SYSACCTX

PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:126  
  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c ACHR        r     1 A1                         0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w STRC(288)   r     1 FM$CFU                     0-0-0/w STRC(288)   r     1 FM$CFUA
     0-0-0/w STRC(288)   r     1 FM$CFUF                    0-0-0/c ASTR(27)    r     1 FM$CFUN
     0-0-0/w STRC(288)   r     1 FM$CFUX                    0-0-0/w STRC(288)   r     1 FM$SET(0:0)


   Procedure FMS$GARBCOL requires 769 words for executable code.
   Procedure FMS$GARBCOL requires 14 words of local(AUTO) storage.
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:127  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:128  
          MINI XREF LISTING

A1
        44**DCL      1784<<ASSIGN   1784>>ASSIGN
B$DS1$
      1681**DCL      1692<>CALL     1856<>CALL
B$JIT.ERR
      1575**DCL      1888<<ASSIGN
B$JIT.ERR.MID
      1576**DCL      1576--REDEF
B$JIT$
      1684**DCL      1570--IMP-PTR  1888>>ASSIGN
CFU$
        28**DCL        29--REDEF     435--IMP-PTR   441--IMP-PTR   444--IMP-PTR  1722<<ASSIGN   1723>>DOWHILE
      1724>>IF       1728>>ASSIGN   1729<<ASSIGN   1729>>ASSIGN   1740<<ASSIGN   1742>>DOWHILE  1743>>IF
      1747>>IF       1748>>ASSIGN   1749<>CALL     1753>>ASSIGN   1755<<ASSIGN   1755>>ASSIGN   1760>>DOWHILE
      1761>>IF       1765>>IF       1765>>IF       1766>>ASSIGN   1768<<ASSIGN   1768>>ASSIGN   1779<<ASSIGN
      1780>>ASSIGN   1782>>ASSIGN   1793<<ASSIGN   1795>>IF       1795>>IF       1795>>IF       1795>>IF
      1799>>IF       1803>>IF       1810<<ASSIGN   1810>>ASSIGN   1816>>IF       1830<<ASSIGN   1831>>DOWHILE
      1832>>IF       1832>>IF       1832>>IF       1832>>IF       1832>>IF       1834>>ASSIGN   1835<>CALL
      1838<>CALL     1842>>ASSIGN   1843>>IF       1843<>CALL     1845<<ASSIGN   1867<<ASSIGN   1868>>ASSIGN
      1870>>ASSIGN
CFU$X.X
        30**DCL      1724>>IF       1724>>IF       1724>>IF       1743>>IF       1743>>IF       1754>>ASSIGN
      1761>>IF       1761>>IF       1767>>ASSIGN   1794>>DOWHILE  1836>>IF
CFUX
        26**DCL        27--REDEF    1741<<ASSIGN   1743>>IF       1754<<ASSIGN   1761>>IF       1767<<ASSIGN
      1857<<ASSIGN   1858<>CALL
CFUX$
        27**DCL      1735<<ASSIGN   1736>>DOWHILE  1772<<ASSIGN   1775>>DOWHILE  1814<<ASSIGN   1819>>ASSIGN
      1823>>ASSIGN   1825<<ASSIGN
ERR
        24**DCL      1692<>CALL     1856<>CALL
F$CFU$
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:129  
        56**DCL       450--IMP-PTR  1693>>ASSIGN   1694>>ASSIGN   1695>>ASSIGN   1696>>ASSIGN   1697>>ASSIGN
      1704>>ASSIGN   1704>>ASSIGN   1705>>ASSIGN   1705>>ASSIGN   1706>>ASSIGN   1706>>ASSIGN   1717>>IF
      1717>>IF       1717>>IF       1717>>IF       1717>>IF       1717>>IF       1722>>ASSIGN   1722>>ASSIGN
      1723>>DOWHILE  1724>>IF       1724>>IF       1729>>ASSIGN   1731>>ASSIGN   1732>>ASSIGN   1732>>ASSIGN
      1732>>ASSIGN   1732>>ASSIGN   1734>>ASSIGN   1734>>ASSIGN   1735>>ASSIGN   1735>>ASSIGN   1737>>IF
      1740>>ASSIGN   1740>>ASSIGN   1742>>DOWHILE  1743>>IF       1750>>IF       1750>>IF       1755>>ASSIGN
      1760>>DOWHILE  1761>>IF       1765>>IF       1766>>ASSIGN   1768>>ASSIGN   1772>>ASSIGN   1772>>ASSIGN
      1773>>ASSIGN   1773>>ASSIGN   1777>>IF       1778>>DOWHILE  1779>>ASSIGN   1790>>ASSIGN   1793>>ASSIGN
      1794>>DOWHILE  1795>>IF       1799>>IF       1801>>ASSIGN   1801>>ASSIGN   1802>>DOWHILE  1805>>ASSIGN
      1807>>ASSIGN   1813>>ASSIGN   1829>>ASSIGN   1830>>ASSIGN   1830>>ASSIGN   1831>>DOWHILE  1832>>IF
      1845>>ASSIGN   1847>>ASSIGN   1847>>ASSIGN   1852>>IF       1852>>IF       1852>>IF       1852>>IF
      1857>>ASSIGN   1857>>ASSIGN   1858>>CALL     1858>>CALL     1859>>ASSIGN   1859>>ASSIGN   1860>>ASSIGN
      1860>>ASSIGN   1861>>ASSIGN   1861>>ASSIGN   1862>>ASSIGN   1862>>ASSIGN   1863>>ASSIGN   1863>>ASSIGN
      1866>>DOWHILE  1867>>ASSIGN   1873>>ASSIGN   1873>>ASSIGN   1874>>ASSIGN   1874>>ASSIGN   1875>>DOWHILE
      1875>>DOWHILE  1885>>ASSIGN   1886>>IF       1886>>IF       1886>>IF
FLAG
        35**DCL      1691<<ASSIGN   1692<>CALL     1696>>ASSIGN   1697>>ASSIGN   1698<<ASSIGN   1699>>DOWHILE
      1731<<ASSIGN   1742>>DOWHILE  1756<<ASSIGN   1756>>ASSIGN   1769<<ASSIGN   1769>>ASSIGN   1818<<ASSIGN
      1818>>ASSIGN   1832>>IF       1839<<ASSIGN   1839>>ASSIGN   1850>>IF       1850<<ASSIGN   1851<<ASSIGN
      1854<<ASSIGN   1855>>IF       1858<>CALL     1859>>ASSIGN   1860>>ASSIGN   1874>>ASSIGN
FM$CFU
       435**DCL      1702--ASSIGN   1731--ASSIGN   1793--ASSIGN   1795--IF       1810--ASSIGN   1878--ASSIGN
FM$CFU.ACCTX
       436**DCL       436--REDEF    1765>>IF       1765>>IF       1766>>ASSIGN   1795>>IF       1795>>IF
      1795>>IF       1799>>IF       1803>>IF
FM$CFU.FUN
       435**DCL      1795>>IF
FM$CFU.NAMEX
       436**DCL      1747>>IF       1748>>ASSIGN   1780>>ASSIGN   1782<<ASSIGN   1868>>ASSIGN   1870<<ASSIGN
FM$CFU.USECNT
       437**DCL      1700<<ASSIGN   1876<<ASSIGN
FM$CFUA.ACCT
       444**DCL      1832>>IF
FM$CFUA.AGE
       447**DCL      1832>>IF
FM$CFUA.DFLTALL
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:130  
       447**DCL      1695<<ASSIGN
FM$CFUA.FDFITSDA
       444**DCL      1832>>IF
FM$CFUA.GCCTL
       445**DCL      1728<<ASSIGN   1766<<ASSIGN   1799>>IF       1804<<ASSIGN   1832>>IF       1843>>IF
FM$CFUA.GMOD
       445**DCL      1832>>IF
FM$CFUA.LINKX
       444**DCL      1724>>IF       1729>>ASSIGN   1807>>ASSIGN   1834<<ASSIGN   1834>>ASSIGN   1845>>ASSIGN
FM$CFUF.W0
       441**DCL      1753<<ASSIGN
FM$CFUN.L
       455**DCL       455--IMP-SIZ  1737>>ASSIGN   1738>>ASSIGN   1751>>ASSIGN   1783>>ASSIGN   1787>>ASSIGN
      1871>>ASSIGN
FM$CFUN.LNKX
       455**DCL      1737>>IF       1751>>IF       1776>>ASSIGN   1865>>ASSIGN
FM$CFUX
       450**DCL      1693<<ASSIGN   1694--ASSIGN
FM$CFUX.ACCTS
       450**DCL      1722>>ASSIGN   1801>>ASSIGN   1830>>ASSIGN
FM$CFUX.ACCTX
       450**DCL      1724>>IF       1847<<ASSIGN
FM$CFUX.CFUT
       450**DCL      1696<<ASSIGN   1704<<ASSIGN   1705>>ASSIGN   1717>>IF       1724>>IF       1731>>ASSIGN
      1737>>IF       1743>>IF       1750>>IF       1761>>IF       1765>>IF       1777>>IF       1778>>DOWHILE
      1794>>DOWHILE  1795>>IF       1858>>CALL     1866>>DOWHILE  1873>>ASSIGN   1874<<ASSIGN   1874>>ASSIGN
      1875>>DOWHILE
FM$CFUX.GCT
       450**DCL      1832>>IF       1885<<ASSIGN
FM$CFUX.HEAD
       452**DCL      1740>>ASSIGN   1755>>ASSIGN   1768>>ASSIGN   1886>>IF
FM$CFUX.NAMES
       450**DCL      1705<<ASSIGN   1706>>ASSIGN   1717>>IF       1717>>IF       1732>>ASSIGN   1734>>ASSIGN
      1773>>ASSIGN   1852>>IF       1857>>ASSIGN   1859<<ASSIGN   1859>>ASSIGN   1863>>ASSIGN
FM$CFUX.NAMET
       451**DCL      1697<<ASSIGN   1717>>IF       1732>>ASSIGN   1732>>ASSIGN   1750>>IF       1852>>IF
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:131  
      1852>>IF       1857>>ASSIGN   1861<<ASSIGN   1861>>ASSIGN   1886>>IF
FM$CFUX.NAMEX
       451**DCL      1706<<ASSIGN   1717>>IF       1717>>IF       1732>>ASSIGN   1735>>ASSIGN   1772>>ASSIGN
      1790<<ASSIGN   1852>>IF       1860<<ASSIGN   1860>>ASSIGN   1862>>ASSIGN   1886>>IF
FM$CFUX.SETH
       451**DCL      1813>>ASSIGN
FM$CFUX.TAIL
       452**DCL      1743>>IF       1761>>IF
FM$SET
      1244**DCL      1813--ASSIGN   1826--ASSIGN
FM$SET.DCTX
      1244**DCL      1817>>IF
FM$SET.SETL
      1246**DCL      1819<<ASSIGN   1819>>ASSIGN   1826>>ASSIGN
FM$SET.SYSID
      1245**DCL      1817>>IF
FM$SET.USERLIST
      1245**DCL      1245--REDEF
FM$SET$
        57**DCL      1244--IMP-PTR  1813>>ASSIGN   1814>>ASSIGN   1815>>DOWHILE  1826>>ASSIGN
FMR$FN
        13**DCL-ENT  1749--CALL
FMR$SETGIP
        14**DCL-ENT  1688--CALL
FMR$SLIDE
        15**DCL-ENT  1858--CALL
FMR$ZA
        16**DCL-ENT  1701--CALL     1822--CALL     1838--CALL     1877--CALL
FMS$E$NOCFUS
      1240**DCL      1888>>ASSIGN
FM_GCT
        57**DCL      1689>>IF       1884<<ASSIGN   1884>>ASSIGN   1885>>ASSIGN
FM_PCTFREEC
        40**DCL      1715>>IF       1715<<ASSIGN   1731>>ASSIGN
FM_PCTFREEN
        39**DCL      1716>>IF       1716<<ASSIGN   1732>>ASSIGN   1852>>IF
PL6.E3A0      #003=FMS$GARBCOL File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:132  
FM_SYSACCTX
        57**DCL      1836>>IF       1837<<ASSIGN
I
        25**DCL        44--IMP-SIZ  1732<<ASSIGN   1737<<ASSIGN   1737>>ASSIGN   1742>>DOWHILE  1751<<ASSIGN
      1751>>ASSIGN   1776<<ASSIGN   1777>>IF       1778>>DOWHILE  1779>>ASSIGN   1780<<ASSIGN   1783<<ASSIGN
      1784>>ASSIGN   1784>>ASSIGN   1785>>ASSIGN   1787<<ASSIGN   1788>>ASSIGN   1865<<ASSIGN   1866>>DOWHILE
      1867>>ASSIGN   1868<<ASSIGN
MMH$GDS
        11**DCL-ENT  1692--CALL     1856--CALL
NAME$
        32**DCL        33--REDEF     455--IMP-PTR  1734<<ASSIGN   1736>>DOWHILE  1737>>IF       1737>>ASSIGN
      1738<<ASSIGN   1738>>ASSIGN   1738>>ASSIGN   1751>>IF       1751>>ASSIGN   1773<<ASSIGN   1774>>ASSIGN
      1775>>DOWHILE  1776>>ASSIGN   1783>>ASSIGN   1784>>ASSIGN   1787>>ASSIGN   1788<<ASSIGN   1788>>ASSIGN
      1863<<ASSIGN   1864>>DOWHILE  1865>>ASSIGN   1871<<ASSIGN   1871>>ASSIGN   1871>>ASSIGN
NAMEX.X
        34**DCL      1748<<ASSIGN   1750>>IF       1750>>IF       1751>>IF       1870>>ASSIGN
NOPGS1
      1875**LABEL    1856--CALLALT
P$
        21**DCL        22--REDEF      24--REDEF    1694<<ASSIGN   1700>>ASSIGN   1701<>CALL     1702<<ASSIGN
      1702>>ASSIGN   1702>>ASSIGN   1704>>ASSIGN   1774<<ASSIGN   1784>>ASSIGN   1785<<ASSIGN   1785>>ASSIGN
      1801<<ASSIGN   1802>>DOWHILE  1804>>ASSIGN   1805<<ASSIGN   1807<<ASSIGN   1807>>ASSIGN   1813<<ASSIGN
      1815>>DOWHILE  1816>>IF       1817>>IF       1817>>IF       1819>>ASSIGN   1820<>CALL     1821>>CALL
      1822<>CALL     1823<<ASSIGN   1825>>ASSIGN   1826<<ASSIGN   1826>>ASSIGN   1829<<ASSIGN   1834>>ASSIGN
      1842<<ASSIGN   1845>>ASSIGN   1847>>ASSIGN   1862<<ASSIGN   1864>>DOWHILE  1873<<ASSIGN   1875>>DOWHILE
      1876>>ASSIGN   1877<>CALL     1878<<ASSIGN   1878>>ASSIGN
PX.X
        23**DCL      1699>>DOWHILE  1782>>ASSIGN   1790>>ASSIGN   1803>>IF
SC_CFUSBAD
        17**DCL-ENT  1720--CALL     1727--CALL     1746--CALL     1764--CALL     1816--CALL
UQB$DELQIDX
        12**DCL-ENT  1820--CALL     1821--CALL     1835--CALL     1843--CALL

PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:133  
      630        1        /*T***********************************************************/
      631        2        /*T*                                                         */
      632        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      633        4        /*T*                                                         */
      634        5        /*T***********************************************************/
      635        6                    /*F*     NAME: FMS$RELACCT
      636        7                    *        PURPOSE: To release the ACCOUNT blocks that refer to the
      637        8                    *        SET whose index is the parameter. Granule counts are updated
      638        9                    *        if necessary.
      639       10                    *        CALL: CALL FMS$RELACCT(SETX);
      640       11                    *        Altreturns if files are still open (by this user if shared,
      641       12                    *        at all if exclusive) or if exclusive to another user.
      642       13                  *        If user is PIG or being deleted, no altreturn occurs if files are
      643       14                    *        still open.
      644       15                    */
      645       16        FMS$RELACCT:PROC(SETX)ALTRET;
      646       17                    /**/
      647       18        %INCLUDE B$JIT_C;
      648      332        %B$JIT0;
      649      421        %U$JIT1X;
      650      424        %M$JIT2X;
      651      427        %F$JIT3;
      652      432        %S$JIT4X;
      653      435        %J$JIT5;
      654      523        %A$JIT6X;
      655      526        %INCLUDE B$ROSEG;
      656      589        %INCLUDE JG_GHOSTS_C;
      657      679        %INCLUDE CP_6_SUBS;
      658     1219        %MACRO F$DCB(BASED=BASED);
      659     1220        %INCLUDE F$DCB;
      660     1269        %MEND;
      661     1270        %F$DCB(BASED="BASED(JDCB$)");
      662     1320        %INCLUDE FM$MACROS;
      663     1695        %FM$CFU(BASED="BASED(Q$)");
      664     1701        %FM$CFUF(BASED="BASED(Q$)");
      665     1704        %FM$CFUA(BASED="BASED(Q$)");
      666     1710        %FM$CFUX;
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:134  
      667     1715        %CODE04(BASED="BASED(R$)");
      668     1723        %CODE14(BASED="BASED(R$)");
      669     1733        %FM$SET(BASED="BASED(FM$SET$)");
      670     1738        %FM$GRAN;
      671     1742        %INCLUDE FR_ERRORS_C;
      672     1773        %SUB FCG#='0615'O;
      673     1774        %SUB MID#='23'O;
      674     1775        %ERRCODE(NAME=FMS$E$NOTUR,COD#=%E$NOTUR);
      675     1779        %ERRCODE(NAME=FMS$E$NRLOPN,COD#=%E$NRLOPN);
      676     1783                    /**/
      677     1784    1   DCL B$JIT$ PTR SYMREF READONLY;
      678     1785    1   DCL B$M$STAR$ PTR SYMREF READONLY;
      679     1786    1   DCL B$ROSEG$ PTR SYMREF READONLY;
      680     1787    1   DCL F$CFU$ PTR SYMREF READONLY;
      681     1788    1   DCL FM$SET$ REDEF F$CFU$ PTR;
      682     1789                    /**/
      683     1790    1   DCL FMC$RELSET ENTRY(1)ALTRET;
      684     1791    1   DCL FMD$FLSHBUF ENTRY(1);
      685     1792    1   DCL FMD$REDBUF ENTRY(6)ALTRET;
      686     1793    1   DCL FMD$WRTBUF ENTRY(1);
      687     1794    1   DCL FMO$LOCCODT ENTRY(2)ALTRET;
      688     1795    1   DCL FMR$FN ENTRY(1);
      689     1796    1   DCL FMR$L8 ENTRY;
      690     1797    1   DCL FMR$U8 ENTRY;
      691     1798    1   DCL FMR$Z8 ENTRY(1);
      692     1799    1   DCL FMS$GARBCOL ENTRY ALTRET;
      693     1800    1   DCL SC_LOSTCFU ENTRY CONV(2,0);
      694     1801    1   DCL SSS$SYSTIME ENTRY(1);
      695     1802    1   DCL UQB$DELQIDX ENTRY(1)ALTRET;
      696     1803                    /**/
      697     1804    1   DCL FM_PADSDA UBIN SYMREF;
      698     1805    1   DCL FM_SYSACCTX UBIN SYMREF;
      699     1806                    /**/
      700     1807    1   DCL SETX UBIN ALIGNED;
      701     1808    1   DCL JDCB$ PTR;
      702     1809    1   DCL ACCTX UBIN;
      703     1810    1   DCL SACCTX REDEF ACCTX SBIN;
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:135  
      704     1811    1   DCL Q$ PTR;
      705     1812    1   DCL 1 QX REDEF Q$, 2 X UBIN HALF UNAL, 2 * BIT(18);
      706     1813    1   DCL P$ PTR;
      707     1814    1   DCL 1 PX REDEF P$, 2 X UBIN HALF UNAL, 2 * BIT(18);
      708     1815    1   DCL R$ PTR;
      709     1816    1   DCL CODE UBIN;
      710     1817    1   DCL T$ PTR;
      711     1818    1   DCL T$$$ PTR;
      712     1819    1   DCL T$$ PTR BASED(T$$$) ALIGNED;
      713     1820        %EJECT;
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:136  
      714     1821    1      T$$$=ADDR(T$);
      715     1822    2      IF NOT FM$SET.XCL(SETX) THEN DO;
      716     1823    2         IF B$JIT.LNKCNT~=0 THEN GOTO FMSE$NRLOPN;
      717     1824    3         DO SACCTX=%M$MAXNEG# TO B$ROSEG$->B$ROSEG.NUMDCBS;
      718     1825    3            R$=B$ROSEG$->B$ROSEG.DCBPTR$->B$RODCB$(ACCTX);
      719     1826    3            IF R$~=ADDR(NIL) THEN
      720     1827    3               IF R$->F$DCB.FCD
      721     1828    3                 AND R$->F$DCB.IASN=%FILE#
      722     1829    3                 AND R$->F$DCB.SETX=SETX
      723     1830    3               THEN GOTO FMSE$NRLOPN;
      724     1831    3            END;
      725     1832    2         RETURN;/* ALL IS O.K. */
      726     1833    2         END;
      727     1834    1      IF FM$SET.SYSID(SETX)~=B$JIT.SYSID THEN GOTO FMSE$NOTUR;
      728     1835    1      IF B$JIT.DCB$=ADDR(NIL) THEN B$JIT.DCB$=B$M$STAR$;
      729     1836    1      JDCB$=B$JIT.DCB$;
      730     1837    1      F$DCB.GTYP=FMGTFD;
      731     1838    1      F$DCB.STARF='0'B;
      732     1839    1      F$DCB.SETX=SETX;
      733     1840    1      CALL FMR$L8;
      734     1841                    /* FIRST ZAP ANY UNUSED CFUS FOR THIS SET, SO
      735     1842                    THAT GARBCOL WILL MARK ACCT BLOCKS USED PROPERLY */
      736     1843    1      Q$=PINCRW(F$CFU$,FM$CFUX.HEAD);
      737     1844    2      DO WHILE(QX.X~=0);
      738     1845    2         IF FM$CFU.STARX.F=0
      739     1846    3         THEN IF PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.SETX=SETX THEN DO;
      740     1847    3               T$=Q$;
      741     1848    3               CALL FMR$FN(T$$);
      742     1849    3               FM$CFUF.W0=0;
      743     1850    3               END;
      744     1851    2         QX.X=Q$->FM$CFUX.HEAD;
      745     1852    2         END;
      746     1853    1      CALL FMS$GARBCOL;/* MARK USED ONES */
      747     1854    2      IF B$JIT.SYSID~=JG_PIG# AND B$JIT.STAR.DA(3)~=0 THEN DO;
      748     1855    2         QX.X=FM$CFUX.ACCTS;
      749     1856    3         DO WHILE(QX.X~=0);
      750     1857    4            IF FM$CFUA.SETX=SETX AND NOT FM$CFUA.GCCTL THEN DO;
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:137  
      751     1858    4               CALL FMR$U8;
      752     1859    4               GOTO FMSE$NRLOPN;
      753     1860    4               END;
      754     1861    3            QX.X=FM$CFUA.LINKX;
      755     1862    3            END;
      756     1863    2         END;
      757     1864    1      ACCTX=0;
      758     1865    1      R$=ADDR(ACCTX);
      759     1866                    /* FIRST RELINK THESE BLOCKS */
      760     1867    1      P$=F$CFU$;
      761     1868    1      QX.X=FM$CFUX.ACCTS;
      762     1869    2      DO WHILE(QX.X~=0);
      763     1870    3         IF FM$CFUA.SETX=SETX THEN DO;
      764     1871    3            R$->FM$CFUA.LINKX=P$->FM$CFUA.LINKX;
      765     1872    3            P$->FM$CFUA.LINKX=Q$->FM$CFUA.LINKX;
      766     1873    3            R$=Q$;
      767     1874    3            IF FM$CFUA.LINKX=0 THEN FM$CFUX.ACCTX=PX.X;
      768     1875    3            END;
      769     1876    2         ELSE P$=Q$;
      770     1877    2         QX.X=P$->FM$CFUA.LINKX;
      771     1878    2         END;
      772     1879    1      R$->FM$CFUA.LINKX=0;
      773     1880    1      CALL FMR$U8;
      774     1881    2      DO WHILE(ACCTX~=0);
      775     1882    2         QX.X=ACCTX;
      776     1883    2         IF ACCTX=FM_SYSACCTX THEN
      777     1884    2            FM_SYSACCTX=0; /* so we'll set it right when we get a new one */
      778     1885    2         ACCTX=FM$CFUA.LINKX;
      779     1886    3         IF FM$CFUA.GMOD~=0 AND FM$CFUA.ACCT>' ' THEN DO;
      780     1887    3            F$DCB.ACCT=FM$CFUA.ACCT;
      781     1888    3            CODE=14;
      782     1889    3            CALL GETCODE ALTRET(NOGRANUP);
      783     1890    3            CODE14.CGRANS=CODE14.MGRANS-FM$CFUA.GRANS;
      784     1891    3            CALL FMD$WRTBUF(4);
      785     1892    3            END;
      786     1893    2         T$=Q$;
      787     1894    2         CALL UQB$DELQIDX(T$$);
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:138  
      788     1895    2         IF FM$CFUA.GCCTL THEN CALL FMR$Z8(T$$);
      789     1896    3         ELSE DO;
      790     1897                    /* A LOST CFU POINTS TO THIS BLOCK */
      791     1898    3            CALL SC_LOSTCFU;
      792     1899                    /*S* SCREECH_CODE: FMS-S$LOSTCFU
      793     1900                         TYPE: SCREECH
      794     1901                         MESSAGE:Dismount entered with busy account blocks.
      795     1902                         REMARKS:This screech occurs if a dismount gets as far as having
      796     1903                                 no users left using the packset, but cannot complete
      797     1904                                 because some CFUs indicate otherwise.  It is usually a
      798     1905                                 result of some previous software or hardware failure that
      799     1906                                 managed to release a DCB without closing it.  The packset
      800     1907                                 being dismounted is indicated by the DCBS display in ANLZ.
      801     1908                                 A CFUs display of DP#set/?,DP#SET.? will display the "lost"
      802     1909                                 entries.
      803     1910                    */
      804     1911    3            FM$CFUA.SETX=0; /* THE SET IS GOUNG AWAY */
      805     1912    3            FM$CFUA.FDFITSDA=0;
      806     1913    3            FM$CFUA.FDCSDA=0;
      807     1914    3            END;
      808     1915    2   NOGRANUP:; END;
      809     1916    1      F$DCB.GTYP=FMGTPAD; /* UPDATE DISMOUNT TIME IF MOUNTED */
      810     1917    1      CODE=4;
      811     1918    1      CALL GETCODE ALTRET(NODISMT);
      812     1919    2      IF CODE04.SVMODIFY.TIME<CODE04.ACCESS.TIME THEN DO;
      813     1920    2         CALL SSS$SYSTIME(CODE04.SVMODIFY.TIME);
      814     1921    2         CALL FMD$WRTBUF(4);
      815     1922    2         END;
      816     1923    1      ELSE NODISMT: CALL FMD$FLSHBUF(4);
      817     1924    1      CALL FMC$RELSET(SETX);
      818     1925    1      RETURN;
      819     1926    1   FMSE$NRLOPN: B$JIT.ERR=FMS$E$NRLOPN;
      820     1927    1   FMSE$NOTUR: IF B$JIT.ERR='0'B THEN B$JIT.ERR=FMS$E$NOTUR;
      821     1928    1      ALTRETURN;
      822     1929
      823     1930    1   GETCODE: PROC ALTRET;
      824     1931    2      IF CODE=14 THEN T$=ADDR(FM$CFUA.FDFITSDA);
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:139  
      825     1932    2      ELSE T$=ADDR(FM_PADSDA);
      826     1933    2      CALL FMD$REDBUF(T$$,4,T$->FM$CFU,,0)ALTRET(RETALT);
      827     1934    2      T$=PINCRW(T$,SIZEW(FM$GRAN));
      828     1935    2      CALL FMO$LOCCODT(T$$,CODE) ALTRET(RETALT);
      829     1936    2      R$=T$;
      830     1937    2      RETURN;
      831     1938    2   RETALT: ALTRETURN;
      832     1939    2   END;
      833     1940    1   END FMS$RELACCT;

PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:140  
--  Include file information  --

   FR_ERRORS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FMS$RELACCT.

   Procedure FMS$RELACCT requires 309 words for executable code.
   Procedure FMS$RELACCT requires 20 words of local(AUTO) storage.

    No errors detected in file FMS$SCFU.:E05TSI    .

PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:141  

 Object Unit name= FMS$RELACCT                                File name= FMS$SCFU.:E05TOU
 UTS= JUL 29 '97 17:02:50.08 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      2      2  FMS$RELACCT
    1   Proc  even  none   309    465  FMS$RELACCT
    2  RoData even  none     5      5  FMS$RELACCT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  FMS$RELACCT
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:142  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 FMR$L8
         yes           Std       1 FMR$FN
 yes     yes           Std       0 FMS$GARBCOL
         yes           Std       1 FMR$Z8
         yes           Std       1 SSS$SYSTIME
 yes     yes           Std       1 FMC$RELSET
         yes           Std       1 FMD$FLSHBUF
         yes           Std       1 FMD$WRTBUF
         yes           Std       0 FMR$U8
 yes     yes           Std       1 UQB$DELQIDX
 yes     yes           Std       6 FMD$REDBUF
 yes     yes           Std       2 FMO$LOCCODT
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_LOSTCFU                       r    B$JIT$                           r    B$M$STAR$
r    B$ROSEG$                         r    F$CFU$                                FM_PADSDA
     FM_SYSACCTX                           B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:143  


      630        1        /*T***********************************************************/
      631        2        /*T*                                                         */
      632        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      633        4        /*T*                                                         */
      634        5        /*T***********************************************************/
      635        6                    /*F*     NAME: FMS$RELACCT
      636        7                    *        PURPOSE: To release the ACCOUNT blocks that refer to the
      637        8                    *        SET whose index is the parameter. Granule counts are updated
      638        9                    *        if necessary.
      639       10                    *        CALL: CALL FMS$RELACCT(SETX);
      640       11                    *        Altreturns if files are still open (by this user if shared,
      641       12                    *        at all if exclusive) or if exclusive to another user.
      642       13                  *       If user is PIG or being deleted, no altreturn occurs if files are
      643       14                    *        still open.
      644       15                    */
      645       16        FMS$RELACCT:PROC(SETX)ALTRET;

     16  1 000000   000000 700200 xent  FMS$RELACCT  TSX0  ! X66_AUTO_1
         1 000001   000024 000001                    ZERO    20,1

      646       17                    /**/
      647       18        %INCLUDE B$JIT_C;
      648      332        %B$JIT0;
      649      421        %U$JIT1X;
      650      424        %M$JIT2X;
      651      427        %F$JIT3;
      652      432        %S$JIT4X;
      653      435        %J$JIT5;
      654      523        %A$JIT6X;
      655      526        %INCLUDE B$ROSEG;
      656      589        %INCLUDE JG_GHOSTS_C;
      657      679        %INCLUDE CP_6_SUBS;
      658     1219        %MACRO F$DCB(BASED=BASED);
      659     1220        %INCLUDE F$DCB;
      660     1269        %MEND;
      661     1270        %F$DCB(BASED="BASED(JDCB$)");
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:144  
      662     1320        %INCLUDE FM$MACROS;
      663     1695        %FM$CFU(BASED="BASED(Q$)");
      664     1701        %FM$CFUF(BASED="BASED(Q$)");
      665     1704        %FM$CFUA(BASED="BASED(Q$)");
      666     1710        %FM$CFUX;
      667     1715        %CODE04(BASED="BASED(R$)");
      668     1723        %CODE14(BASED="BASED(R$)");
      669     1733        %FM$SET(BASED="BASED(FM$SET$)");
      670     1738        %FM$GRAN;
      671     1742        %INCLUDE FR_ERRORS_C;
      672     1773        %SUB FCG#='0615'O;
      673     1774        %SUB MID#='23'O;
      674     1775        %ERRCODE(NAME=FMS$E$NOTUR,COD#=%E$NOTUR);
      675     1779        %ERRCODE(NAME=FMS$E$NRLOPN,COD#=%E$NRLOPN);
      676     1783                    /**/
      677     1784    1   DCL B$JIT$ PTR SYMREF READONLY;
      678     1785    1   DCL B$M$STAR$ PTR SYMREF READONLY;
      679     1786    1   DCL B$ROSEG$ PTR SYMREF READONLY;
      680     1787    1   DCL F$CFU$ PTR SYMREF READONLY;
      681     1788    1   DCL FM$SET$ REDEF F$CFU$ PTR;
      682     1789                    /**/
      683     1790    1   DCL FMC$RELSET ENTRY(1)ALTRET;
      684     1791    1   DCL FMD$FLSHBUF ENTRY(1);
      685     1792    1   DCL FMD$REDBUF ENTRY(6)ALTRET;
      686     1793    1   DCL FMD$WRTBUF ENTRY(1);
      687     1794    1   DCL FMO$LOCCODT ENTRY(2)ALTRET;
      688     1795    1   DCL FMR$FN ENTRY(1);
      689     1796    1   DCL FMR$L8 ENTRY;
      690     1797    1   DCL FMR$U8 ENTRY;
      691     1798    1   DCL FMR$Z8 ENTRY(1);
      692     1799    1   DCL FMS$GARBCOL ENTRY ALTRET;
      693     1800    1   DCL SC_LOSTCFU ENTRY CONV(2,0);
      694     1801    1   DCL SSS$SYSTIME ENTRY(1);
      695     1802    1   DCL UQB$DELQIDX ENTRY(1)ALTRET;
      696     1803                    /**/
      697     1804    1   DCL FM_PADSDA UBIN SYMREF;
      698     1805    1   DCL FM_SYSACCTX UBIN SYMREF;
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:145  
      699     1806                    /**/
      700     1807    1   DCL SETX UBIN ALIGNED;
      701     1808    1   DCL JDCB$ PTR;
      702     1809    1   DCL ACCTX UBIN;
      703     1810    1   DCL SACCTX REDEF ACCTX SBIN;
      704     1811    1   DCL Q$ PTR;
      705     1812    1   DCL 1 QX REDEF Q$, 2 X UBIN HALF UNAL, 2 * BIT(18);
      706     1813    1   DCL P$ PTR;
      707     1814    1   DCL 1 PX REDEF P$, 2 X UBIN HALF UNAL, 2 * BIT(18);
      708     1815    1   DCL R$ PTR;
      709     1816    1   DCL CODE UBIN;
      710     1817    1   DCL T$ PTR;
      711     1818    1   DCL T$$$ PTR;
      712     1819    1   DCL T$$ PTR BASED(T$$$) ALIGNED;
      713     1820        %EJECT;
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:146  
      714     1821    1      T$$$=ADDR(T$);

   1821  1 000002   200012 630500                    EPPR0   T$,,AUTO
         1 000003   200013 450500                    STP0    T$$$,,AUTO

      715     1822    2      IF NOT FM$SET.XCL(SETX) THEN DO;

   1822  1 000004   200003 471500                    LDP1    @SETX,,AUTO
         1 000005   100000 235100                    LDA     0,,PR1
         1 000006   000003 735000                    ALS     3
         1 000007   000000 473400 xsym               LDP3    F$CFU$
         1 000010   300002 234105                    SZN     2,AL,PR3
         1 000011   000054 604000 1                  TMI     s:1834

      716     1823    2         IF B$JIT.LNKCNT~=0 THEN GOTO FMSE$NRLOPN;

   1823  1 000012   000000 474400 xsym               LDP4    B$JIT$
         1 000013   400314 236100                    LDQ     204,,PR4
         1 000014   000777 316007                    CANQ    511,DL
         1 000015   000405 601000 1                  TNZ     FMSE$NRLOPN

      717     1824    3         DO SACCTX=%M$MAXNEG# TO B$ROSEG$->B$ROSEG.NUMDCBS;

   1824  1 000016   000040 335007                    LCA     32,DL
         1 000017   200005 755100                    STA     ACCTX,,AUTO
         1 000020   000046 710000 1                  TRA     s:1831+1

      718     1825    3            R$=B$ROSEG$->B$ROSEG.DCBPTR$->B$RODCB$(ACCTX);

   1825  1 000021   000000 470400 xsym               LDP0    B$ROSEG$
         1 000022   000000 471500                    LDP1    0,,PR0
         1 000023   200005 720100                    LXL0    ACCTX,,AUTO
         1 000024   100000 236110                    LDQ     0,X0,PR1
         1 000025   200010 756100                    STQ     R$,,AUTO

      719     1826    3            IF R$~=ADDR(NIL) THEN

PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:147  
   1826  1 000026   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000027   000045 600000 1                  TZE     s:1831

      720     1827    3               IF R$->F$DCB.FCD

   1827  1 000030   200010 473500                    LDP3    R$,,AUTO
         1 000031   300031 236100                    LDQ     25,,PR3
         1 000032   020000 316007                    CANQ    8192,DL
         1 000033   000045 600000 1                  TZE     s:1831
         1 000034   300103 236100                    LDQ     67,,PR3
         1 000035   000777 376007                    ANQ     511,DL
         1 000036   000001 116007                    CMPQ    1,DL
         1 000037   000045 601000 1                  TNZ     s:1831
         1 000040   200003 474500                    LDP4    @SETX,,AUTO
         1 000041   300051 236100                    LDQ     41,,PR3
         1 000042   777777 376007                    ANQ     -1,DL
         1 000043   400000 116100                    CMPQ    0,,PR4
         1 000044   000405 600000 1                  TZE     FMSE$NRLOPN

      721     1828    3                 AND R$->F$DCB.IASN=%FILE#
      722     1829    3                 AND R$->F$DCB.SETX=SETX
      723     1830    3               THEN GOTO FMSE$NRLOPN;
      724     1831    3            END;

   1831  1 000045   200005 054100                    AOS     ACCTX,,AUTO
         1 000046   000000 470400 xsym               LDP0    B$ROSEG$
         1 000047   000002 236100                    LDQ     2,,PR0
         1 000050   000022 772000                    QRL     18
         1 000051   200005 116100                    CMPQ    ACCTX,,AUTO
         1 000052   000021 605000 1                  TPL     s:1825

      725     1832    2         RETURN;/* ALL IS O.K. */

   1832  1 000053   000000 702200 xent               TSX2  ! X66_ARET

      726     1833    2         END;
      727     1834    1      IF FM$SET.SYSID(SETX)~=B$JIT.SYSID THEN GOTO FMSE$NOTUR;
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:148  

   1834  1 000054   000000 474400 xsym               LDP4    B$JIT$
         1 000055   300002 236105                    LDQ     2,AL,PR3
         1 000056   400000 676100                    ERQ     0,,PR4
         1 000057   777777 376007                    ANQ     -1,DL
         1 000060   000410 601000 1                  TNZ     FMSE$NOTUR

      728     1835    1      IF B$JIT.DCB$=ADDR(NIL) THEN B$JIT.DCB$=B$M$STAR$;

   1835  1 000061   400232 236100                    LDQ     154,,PR4
         1 000062   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000063   000066 601000 1                  TNZ     s:1836

   1835  1 000064   000000 236000 xsym               LDQ     B$M$STAR$
         1 000065   400232 756100                    STQ     154,,PR4

      729     1836    1      JDCB$=B$JIT.DCB$;

   1836  1 000066   200004 756100                    STQ     JDCB$,,AUTO

      730     1837    1      F$DCB.GTYP=FMGTFD;

   1837  1 000067   200004 475500                    LDP5    JDCB$,,AUTO
         1 000070   500064 236100                    LDQ     52,,PR5
         1 000071   000000 376000 2                  ANQ     0
         1 000072   020000 276003                    ORQ     8192,DU
         1 000073   500064 756100                    STQ     52,,PR5

      731     1838    1      F$DCB.STARF='0'B;

   1838  1 000074   000001 236000 2                  LDQ     1
         1 000075   500064 356100                    ANSQ    52,,PR5

      732     1839    1      F$DCB.SETX=SETX;

   1839  1 000076   100000 720100                    LXL0    0,,PR1
         1 000077   500051 440100                    SXL0    41,,PR5
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:149  

      733     1840    1      CALL FMR$L8;

   1840  1 000100   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000101   000000 701000 xent               TSX1    FMR$L8
         1 000102   000000 011000                    NOP     0

      734     1841                    /* FIRST ZAP ANY UNUSED CFUS FOR THIS SET, SO
      735     1842                    THAT GARBCOL WILL MARK ACCT BLOCKS USED PROPERLY */
      736     1843    1      Q$=PINCRW(F$CFU$,FM$CFUX.HEAD);

   1843  1 000103   000000 470400 xsym               LDP0    F$CFU$
         1 000104   000007 720100                    LXL0    7,,PR0
         1 000105   000000 636010                    EAQ     0,X0
         1 000106   000000 036000 xsym               ADLQ    F$CFU$
         1 000107   200006 756100                    STQ     Q$,,AUTO

      737     1844    2      DO WHILE(QX.X~=0);

   1844  1 000110   200006 221100                    LDX1    Q$,,AUTO
         1 000111   000140 600000 1                  TZE     s:1853

      738     1845    2         IF FM$CFU.STARX.F=0

   1845  1 000112   200006 470500                    LDP0    Q$,,AUTO
         1 000113   000002 236100                    LDQ     2,,PR0
         1 000114   400000 316003                    CANQ    -131072,DU
         1 000115   000135 601000 1                  TNZ     s:1851

      739     1846    3         THEN IF PINCRW(F$CFU$,FM$CFU.ACCTX)->FM$CFUA.SETX=SETX THEN DO;

   1846  1 000116   000002 220100                    LDX0    2,,PR0
         1 000117   200003 471500                    LDP1    @SETX,,AUTO
         1 000120   000000 473400 xsym               LDP3    F$CFU$
         1 000121   300000 236110                    LDQ     0,X0,PR3
         1 000122   000022 772000                    QRL     18
         1 000123   100000 116100                    CMPQ    0,,PR1
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:150  
         1 000124   000135 601000 1                  TNZ     s:1851

      740     1847    3               T$=Q$;

   1847  1 000125   200006 236100                    LDQ     Q$,,AUTO
         1 000126   200012 756100                    STQ     T$,,AUTO

      741     1848    3               CALL FMR$FN(T$$);

   1848  1 000127   200013 630500                    EPPR0   T$$$,,AUTO
         1 000130   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000131   000000 701000 xent               TSX1    FMR$FN
         1 000132   000000 011000                    NOP     0

      742     1849    3               FM$CFUF.W0=0;

   1849  1 000133   200006 470500                    LDP0    Q$,,AUTO
         1 000134   000000 450100                    STZ     0,,PR0

      743     1850    3               END;

      744     1851    2         QX.X=Q$->FM$CFUX.HEAD;

   1851  1 000135   000007 720100                    LXL0    7,,PR0
         1 000136   200006 740100                    STX0    Q$,,AUTO

      745     1852    2         END;

   1852  1 000137   000112 601000 1                  TNZ     s:1845

      746     1853    1      CALL FMS$GARBCOL;/* MARK USED ONES */

   1853  1 000140   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000141   000000 701000 xent               TSX1    FMS$GARBCOL
         1 000142   000000 011000                    NOP     0

      747     1854    2      IF B$JIT.SYSID~=JG_PIG# AND B$JIT.STAR.DA(3)~=0 THEN DO;
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:151  

   1854  1 000143   000000 470400 xsym               LDP0    B$JIT$
         1 000144   000000 720100                    LXL0    0,,PR0
         1 000145   000007 100003                    CMPX0   7,DU
         1 000146   000175 600000 1                  TZE     s:1864
         1 000147   000225 235100                    LDA     149,,PR0
         1 000150   000175 600000 1                  TZE     s:1864

      748     1855    2         QX.X=FM$CFUX.ACCTS;

   1855  1 000151   000000 471400 xsym               LDP1    F$CFU$
         1 000152   100000 721100                    LXL1    0,,PR1
         1 000153   200006 741100                    STX1    Q$,,AUTO

      749     1856    3         DO WHILE(QX.X~=0);

   1856  1 000154   000175 600000 1                  TZE     s:1864

      750     1857    4            IF FM$CFUA.SETX=SETX AND NOT FM$CFUA.GCCTL THEN DO;

   1857  1 000155   200003 470500                    LDP0    @SETX,,AUTO
         1 000156   200006 471500                    LDP1    Q$,,AUTO
         1 000157   100000 236100                    LDQ     0,,PR1
         1 000160   000022 772000                    QRL     18
         1 000161   000000 116100                    CMPQ    0,,PR0
         1 000162   000172 601000 1                  TNZ     s:1861
         1 000163   100005 236100                    LDQ     5,,PR1
         1 000164   020000 316003                    CANQ    8192,DU
         1 000165   000172 601000 1                  TNZ     s:1861

      751     1858    4               CALL FMR$U8;

   1858  1 000166   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000167   000000 701000 xent               TSX1    FMR$U8
         1 000170   000000 011000                    NOP     0

      752     1859    4               GOTO FMSE$NRLOPN;
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:152  

   1859  1 000171   000405 710000 1                  TRA     FMSE$NRLOPN

      753     1860    4               END;
      754     1861    3            QX.X=FM$CFUA.LINKX;

   1861  1 000172   100000 720100                    LXL0    0,,PR1
         1 000173   200006 740100                    STX0    Q$,,AUTO

      755     1862    3            END;

   1862  1 000174   000155 601000 1                  TNZ     s:1857

      756     1863    2         END;

      757     1864    1      ACCTX=0;

   1864  1 000175   200005 450100                    STZ     ACCTX,,AUTO

      758     1865    1      R$=ADDR(ACCTX);

   1865  1 000176   200005 630500                    EPPR0   ACCTX,,AUTO
         1 000177   200010 450500                    STP0    R$,,AUTO

      759     1866                    /* FIRST RELINK THESE BLOCKS */
      760     1867    1      P$=F$CFU$;

   1867  1 000200   000000 236000 xsym               LDQ     F$CFU$
         1 000201   200007 756100                    STQ     P$,,AUTO

      761     1868    1      QX.X=FM$CFUX.ACCTS;

   1868  1 000202   000000 471400 xsym               LDP1    F$CFU$
         1 000203   100000 720100                    LXL0    0,,PR1
         1 000204   200006 740100                    STX0    Q$,,AUTO

      762     1869    2      DO WHILE(QX.X~=0);
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:153  

   1869  1 000205   000240 600000 1                  TZE     s:1879

      763     1870    3         IF FM$CFUA.SETX=SETX THEN DO;

   1870  1 000206   200003 470500                    LDP0    @SETX,,AUTO
         1 000207   200006 471500                    LDP1    Q$,,AUTO
         1 000210   100000 236100                    LDQ     0,,PR1
         1 000211   000022 772000                    QRL     18
         1 000212   000000 116100                    CMPQ    0,,PR0
         1 000213   000232 601000 1                  TNZ     s:1876

      764     1871    3            R$->FM$CFUA.LINKX=P$->FM$CFUA.LINKX;

   1871  1 000214   200007 473500                    LDP3    P$,,AUTO
         1 000215   300000 720100                    LXL0    0,,PR3
         1 000216   200010 474500                    LDP4    R$,,AUTO
         1 000217   400000 440100                    SXL0    0,,PR4

      765     1872    3            P$->FM$CFUA.LINKX=Q$->FM$CFUA.LINKX;

   1872  1 000220   100000 721100                    LXL1    0,,PR1
         1 000221   300000 441100                    SXL1    0,,PR3

      766     1873    3            R$=Q$;

   1873  1 000222   200006 236100                    LDQ     Q$,,AUTO
         1 000223   200010 756100                    STQ     R$,,AUTO

      767     1874    3            IF FM$CFUA.LINKX=0 THEN FM$CFUX.ACCTX=PX.X;

   1874  1 000224   100000 720100                    LXL0    0,,PR1
         1 000225   000234 601000 1                  TNZ     s:1877

   1874  1 000226   200007 222100                    LDX2    P$,,AUTO
         1 000227   000000 474400 xsym               LDP4    F$CFU$
         1 000230   400001 742100                    STX2    1,,PR4
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:154  

      768     1875    3            END;

   1875  1 000231   000234 710000 1                  TRA     s:1877

      769     1876    2         ELSE P$=Q$;

   1876  1 000232   200006 236100                    LDQ     Q$,,AUTO
         1 000233   200007 756100                    STQ     P$,,AUTO

      770     1877    2         QX.X=P$->FM$CFUA.LINKX;

   1877  1 000234   200007 473500                    LDP3    P$,,AUTO
         1 000235   300000 720100                    LXL0    0,,PR3
         1 000236   200006 740100                    STX0    Q$,,AUTO

      771     1878    2         END;

   1878  1 000237   000206 601000 1                  TNZ     s:1870

      772     1879    1      R$->FM$CFUA.LINKX=0;

   1879  1 000240   000000 221003                    LDX1    0,DU
         1 000241   200010 470500                    LDP0    R$,,AUTO
         1 000242   000000 441100                    SXL1    0,,PR0

      773     1880    1      CALL FMR$U8;

   1880  1 000243   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000244   000000 701000 xent               TSX1    FMR$U8
         1 000245   000000 011000                    NOP     0

      774     1881    2      DO WHILE(ACCTX~=0);

   1881  1 000246   200005 235100                    LDA     ACCTX,,AUTO
         1 000247   000343 600000 1                  TZE     s:1916

PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:155  
      775     1882    2         QX.X=ACCTX;

   1882  1 000250   200005 720100                    LXL0    ACCTX,,AUTO
         1 000251   200006 740100                    STX0    Q$,,AUTO

      776     1883    2         IF ACCTX=FM_SYSACCTX THEN

   1883  1 000252   200005 236100                    LDQ     ACCTX,,AUTO
         1 000253   000000 116000 xsym               CMPQ    FM_SYSACCTX
         1 000254   000256 601000 1                  TNZ     s:1885

      777     1884    2            FM_SYSACCTX=0; /* so we'll set it right when we get a new one */

   1884  1 000255   000000 450000 xsym               STZ     FM_SYSACCTX

      778     1885    2         ACCTX=FM$CFUA.LINKX;

   1885  1 000256   200006 470500                    LDP0    Q$,,AUTO
         1 000257   000000 236100                    LDQ     0,,PR0
         1 000260   777777 376007                    ANQ     -1,DL
         1 000261   200005 756100                    STQ     ACCTX,,AUTO

      779     1886    3         IF FM$CFUA.GMOD~=0 AND FM$CFUA.ACCT>' ' THEN DO;

   1886  1 000262   000005 236100                    LDQ     5,,PR0
         1 000263   100000 316003                    CANQ    32768,DU
         1 000264   000313 600000 1                  TZE     s:1893
         1 000265   040100 106400                    CMPC    fill='040'O
         1 000266   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000267   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         1 000270   000313 603000 1                  TRC     s:1893

      780     1887    3            F$DCB.ACCT=FM$CFUA.ACCT;

   1887  1 000271   200004 471500                    LDP1    JDCB$,,AUTO
         1 000272   040100 100500                    MLR     fill='040'O
         1 000273   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:156  
         1 000274   100020 000010                    ADSC9   16,,PR1                  cn=0,n=8

      781     1888    3            CODE=14;

   1888  1 000275   000016 235007                    LDA     14,DL
         1 000276   200011 755100                    STA     CODE,,AUTO

      782     1889    3            CALL GETCODE ALTRET(NOGRANUP);

   1889  1 000277   000416 701000 1                  TSX1    GETCODE
         1 000300   000341 702000 1                  TSX2    NOGRANUP

      783     1890    3            CODE14.CGRANS=CODE14.MGRANS-FM$CFUA.GRANS;

   1890  1 000301   200006 470500                    LDP0    Q$,,AUTO
         1 000302   200010 471500                    LDP1    R$,,AUTO
         1 000303   100001 236100                    LDQ     1,,PR1
         1 000304   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000305   000007 136100                    SBLQ    7,,PR0
         1 000306   100002 756100                    STQ     2,,PR1

      784     1891    3            CALL FMD$WRTBUF(4);

   1891  1 000307   000002 630400 2                  EPPR0   2
         1 000310   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000311   000000 701000 xent               TSX1    FMD$WRTBUF
         1 000312   000000 011000                    NOP     0

      785     1892    3            END;

      786     1893    2         T$=Q$;

   1893  1 000313   200006 236100                    LDQ     Q$,,AUTO
         1 000314   200012 756100                    STQ     T$,,AUTO

      787     1894    2         CALL UQB$DELQIDX(T$$);

PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:157  
   1894  1 000315   200013 630500                    EPPR0   T$$$,,AUTO
         1 000316   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000317   000000 701000 xent               TSX1    UQB$DELQIDX
         1 000320   000000 011000                    NOP     0

      788     1895    2         IF FM$CFUA.GCCTL THEN CALL FMR$Z8(T$$);

   1895  1 000321   200006 470500                    LDP0    Q$,,AUTO
         1 000322   000005 236100                    LDQ     5,,PR0
         1 000323   020000 316003                    CANQ    8192,DU
         1 000324   000332 600000 1                  TZE     s:1898

   1895  1 000325   200013 630500                    EPPR0   T$$$,,AUTO
         1 000326   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000327   000000 701000 xent               TSX1    FMR$Z8
         1 000330   000000 011000                    NOP     0
         1 000331   000341 710000 1                  TRA     NOGRANUP

      789     1896    3         ELSE DO;

      790     1897                    /* A LOST CFU POINTS TO THIS BLOCK */
      791     1898    3            CALL SC_LOSTCFU;

   1898  1 000332   000000 713400 xsym               CLIMB   SC_LOSTCFU
         1 000333   000000 600000 xsid               climb   nvectors=         0

      792     1899                    /*S* SCREECH_CODE: FMS-S$LOSTCFU
      793     1900                         TYPE: SCREECH
      794     1901                         MESSAGE:Dismount entered with busy account blocks.
      795     1902                         REMARKS:This screech occurs if a dismount gets as far as having
      796     1903                                 no users left using the packset, but cannot complete
      797     1904                                 because some CFUs indicate otherwise.  It is usually a
      798     1905                                 result of some previous software or hardware failure that
      799     1906                                 managed to release a DCB without closing it.  The packset
      800     1907                                 being dismounted is indicated by the DCBS display in ANLZ.
      801     1908                                A CFUs display of DP#set/?,DP#SET.? will display the "lost"
      802     1909                                 entries.
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:158  
      803     1910                    */
      804     1911    3            FM$CFUA.SETX=0; /* THE SET IS GOUNG AWAY */

   1911  1 000334   000000 220003                    LDX0    0,DU
         1 000335   200006 470500                    LDP0    Q$,,AUTO
         1 000336   000000 740100                    STX0    0,,PR0

      805     1912    3            FM$CFUA.FDFITSDA=0;

   1912  1 000337   000004 450100                    STZ     4,,PR0

      806     1913    3            FM$CFUA.FDCSDA=0;

   1913  1 000340   000003 450100                    STZ     3,,PR0

      807     1914    3            END;

   1895  1 000341                       NOGRANUP     null
      808     1915    2   NOGRANUP:; END;

   1915  1 000341   200005 235100                    LDA     ACCTX,,AUTO
         1 000342   000250 601000 1                  TNZ     s:1882

      809     1916    1      F$DCB.GTYP=FMGTPAD; /* UPDATE DISMOUNT TIME IF MOUNTED */

   1916  1 000343   200004 470500                    LDP0    JDCB$,,AUTO
         1 000344   000064 236100                    LDQ     52,,PR0
         1 000345   000000 376000 2                  ANQ     0
         1 000346   014000 276003                    ORQ     6144,DU
         1 000347   000064 756100                    STQ     52,,PR0

      810     1917    1      CODE=4;

   1917  1 000350   000004 235007                    LDA     4,DL
         1 000351   200011 755100                    STA     CODE,,AUTO

      811     1918    1      CALL GETCODE ALTRET(NODISMT);
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:159  

   1918  1 000352   000416 701000 1                  TSX1    GETCODE
         1 000353   000374 702000 1                  TSX2    NODISMT

      812     1919    2      IF CODE04.SVMODIFY.TIME<CODE04.ACCESS.TIME THEN DO;

   1919  1 000354   200010 470500                    LDP0    R$,,AUTO
         1 000355   000010 236100                    LDQ     8,,PR0
         1 000356   000000 116100                    CMPQ    0,,PR0
         1 000357   000374 603000 1                  TRC     NODISMT

      813     1920    2         CALL SSS$SYSTIME(CODE04.SVMODIFY.TIME);

   1920  1 000360   200010 236100                    LDQ     R$,,AUTO
         1 000361   000010 036003                    ADLQ    8,DU
         1 000362   200016 756100                    STQ     T$$$+3,,AUTO
         1 000363   200016 630500                    EPPR0   T$$$+3,,AUTO
         1 000364   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000365   000000 701000 xent               TSX1    SSS$SYSTIME
         1 000366   000000 011000                    NOP     0

      814     1921    2         CALL FMD$WRTBUF(4);

   1921  1 000367   000002 630400 2                  EPPR0   2
         1 000370   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000371   000000 701000 xent               TSX1    FMD$WRTBUF
         1 000372   000000 011000                    NOP     0

      815     1922    2         END;

   1922  1 000373   000400 710000 1                  TRA     s:1924

      816     1923    1      ELSE NODISMT: CALL FMD$FLSHBUF(4);

   1923  1 000374   000002 630400 2     NODISMT      EPPR0   2
         1 000375   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000376   000000 701000 xent               TSX1    FMD$FLSHBUF
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:160  
         1 000377   000000 011000                    NOP     0

      817     1924    1      CALL FMC$RELSET(SETX);

   1924  1 000400   200003 630500                    EPPR0   @SETX,,AUTO
         1 000401   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000402   000000 701000 xent               TSX1    FMC$RELSET
         1 000403   000000 011000                    NOP     0

      818     1925    1      RETURN;

   1925  1 000404   000000 702200 xent               TSX2  ! X66_ARET

      819     1926    1   FMSE$NRLOPN: B$JIT.ERR=FMS$E$NRLOPN;

   1926  1 000405   000001 236000 0     FMSE$NRLOPN  LDQ     FMS$E$NRLOPN
         1 000406   000000 470400 xsym               LDP0    B$JIT$
         1 000407   000012 756100                    STQ     10,,PR0

      820     1927    1   FMSE$NOTUR: IF B$JIT.ERR='0'B THEN B$JIT.ERR=FMS$E$NOTUR;

   1927  1 000410   000000 470400 xsym  FMSE$NOTUR   LDP0    B$JIT$
         1 000411   000012 235100                    LDA     10,,PR0
         1 000412   000415 601000 1                  TNZ     s:1928

   1927  1 000413   000000 236000 0                  LDQ     FMS$E$NOTUR
         1 000414   000012 756100                    STQ     10,,PR0

      821     1928    1      ALTRETURN;

   1928  1 000415   000000 702200 xent               TSX2  ! X66_AALT

      822     1929
      823     1930    1   GETCODE: PROC ALTRET;

   1930  1 000416   200014 741300       GETCODE      STX1  ! T$$$+1,,AUTO

PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:161  
      824     1931    2      IF CODE=14 THEN T$=ADDR(FM$CFUA.FDFITSDA);

   1931  1 000417   200011 235100                    LDA     CODE,,AUTO
         1 000420   000016 115007                    CMPA    14,DL
         1 000421   000426 601000 1                  TNZ     s:1932

   1931  1 000422   200006 236100                    LDQ     Q$,,AUTO
         1 000423   000004 036003                    ADLQ    4,DU
         1 000424   200012 756100                    STQ     T$,,AUTO
         1 000425   000430 710000 1                  TRA     s:1933

      825     1932    2      ELSE T$=ADDR(FM_PADSDA);

   1932  1 000426   000003 236000 2                  LDQ     3
         1 000427   200012 756100                    STQ     T$,,AUTO

      826     1933    2      CALL FMD$REDBUF(T$$,4,T$->FM$CFU,,0)ALTRET(RETALT);

   1933  1 000430   000004 236000 2                  LDQ     4
         1 000431   200022 756100                    STQ     T$$$+7,,AUTO
         1 000432   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000433   200012 235100                    LDA     T$,,AUTO
         1 000434   200020 757100                    STAQ    T$$$+5,,AUTO
         1 000435   000002 236000 2                  LDQ     2
         1 000436   200013 235100                    LDA     T$$$,,AUTO
         1 000437   200016 757100                    STAQ    T$$$+3,,AUTO
         1 000440   200016 630500                    EPPR0   T$$$+3,,AUTO
         1 000441   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000442   000000 701000 xent               TSX1    FMD$REDBUF
         1 000443   000463 702000 1                  TSX2    RETALT

      827     1934    2      T$=PINCRW(T$,SIZEW(FM$GRAN));

   1934  1 000444   200012 236100                    LDQ     T$,,AUTO
         1 000445   000005 036003                    ADLQ    5,DU
         1 000446   200012 756100                    STQ     T$,,AUTO

PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:162  
      828     1935    2      CALL FMO$LOCCODT(T$$,CODE) ALTRET(RETALT);

   1935  1 000447   200011 630500                    EPPR0   CODE,,AUTO
         1 000450   200017 450500                    STP0    T$$$+4,,AUTO
         1 000451   200013 236100                    LDQ     T$$$,,AUTO
         1 000452   200016 756100                    STQ     T$$$+3,,AUTO
         1 000453   200016 630500                    EPPR0   T$$$+3,,AUTO
         1 000454   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000455   000000 701000 xent               TSX1    FMO$LOCCODT
         1 000456   000463 702000 1                  TSX2    RETALT

      829     1936    2      R$=T$;

   1936  1 000457   200012 236100                    LDQ     T$,,AUTO
         1 000460   200010 756100                    STQ     R$,,AUTO

      830     1937    2      RETURN;

   1937  1 000461   200014 221300                    LDX1  ! T$$$+1,,AUTO
         1 000462   000001 702211                    TSX2  ! 1,X1

      831     1938    2   RETALT: ALTRETURN;

   1938  1 000463   200014 221300       RETALT       LDX1  ! T$$$+1,,AUTO
         1 000464   000000 702211                    TSX2  ! 0,X1

FMS$E$NOTUR
 Sect OctLoc
   0     000   061523 012222                                                    1...

FMS$E$NRLOPN
 Sect OctLoc
   0     001   061523 012212                                                    1...

(unnamed)
 Sect OctLoc
   2     000   743777 777777   577777 777777   000006 006000   000000 006000    ................
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:163  
   2     004   000002 006000                                                    ....
      832     1939    2   END;
      833     1940    1   END FMS$RELACCT;

PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:164  
--  Include file information  --

   FR_ERRORS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FMS$RELACCT.
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:165  

 **** Variables and constants ****

  ****  Section 000 RoData FMS$RELACCT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b STRC        r     1 FMS$E$NOTUR                1-0-0/b STRC        r     1 FMS$E$NRLOPN

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @SETX                      5-0-0/w UBIN        r     1 ACCTX
    11-0-0/w UBIN        r     1 CODE                       4-0-0/w PTR         r     1 JDCB$
     7-0-0/w PTR         r     1 P$                         7-0-0/w STRC        r     1 PX
     6-0-0/w PTR         r     1 Q$                         6-0-0/w STRC        r     1 QX
    10-0-0/w PTR         r     1 R$                         5-0-0/w SBIN        r     1 SACCTX
    *0-0-0/w UBIN        r     1 SETX                      12-0-0/w PTR         r     1 T$
    13-0-0/w PTR         r     1 T$$$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$M$STAR$
     0-0-0/w PTR         r     1 B$ROSEG$                   0-0-0/w PTR         r     1 F$CFU$
     0-0-0/w PTR         r     1 FM$SET$                    0-0-0/w UBIN        r     1 FM_PADSDA
     0-0-0/w UBIN        r     1 FM_SYSACCTX

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:166  
     0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w PTR         r     1 B$RODCB$(0:0)
     0-0-0/d STRC(3024)  r     1 B$ROSEG                    0-0-0/w STRC(396)   r     1 CODE04
     0-0-0/w STRC(288)   r     1 CODE14                     0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(288)   r     1 FM$CFU                     0-0-0/w STRC(288)   r     1 FM$CFUA
     0-0-0/w STRC(288)   r     1 FM$CFUF                    0-0-0/w STRC(288)   r     1 FM$CFUX
     0-0-0/w STRC(180)   r     1 FM$GRAN                    0-0-0/w STRC(288)   r     1 FM$SET(0:0)
     0-0-0/w PTR         r     1 T$$


   Procedure FMS$RELACCT requires 309 words for executable code.
   Procedure FMS$RELACCT requires 20 words of local(AUTO) storage.

    No errors detected in file FMS$SCFU.:E05TSI    .
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:167  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:168  
          MINI XREF LISTING

ACCTX
      1809**DCL      1810--REDEF    1825>>ASSIGN   1864<<ASSIGN   1865--ASSIGN   1881>>DOWHILE  1882>>ASSIGN
      1883>>IF       1885<<ASSIGN
B$JIT.DCB$
       428**DCL      1835>>IF       1835<<ASSIGN   1836>>ASSIGN
B$JIT.ERR
       338**DCL      1926<<ASSIGN   1927>>IF       1927<<ASSIGN
B$JIT.ERR.MID
       339**DCL       339--REDEF
B$JIT.LNKCNT
       457**DCL      1823>>IF
B$JIT.STAR.DA
       428**DCL      1854>>IF
B$JIT.SYSID
       338**DCL      1834>>IF       1854>>IF
B$JIT$
      1784**DCL       333--IMP-PTR  1823>>IF       1834>>IF       1835>>IF       1835>>ASSIGN   1836>>ASSIGN
      1854>>IF       1854>>IF       1926>>ASSIGN   1927>>IF       1927>>ASSIGN
B$M$STAR$
      1785**DCL      1835>>ASSIGN
B$RODCB$
       573**DCL      1825>>ASSIGN
B$ROSEG.DCBPTR$
       537**DCL      1825>>ASSIGN
B$ROSEG.NUMDCBS
       539**DCL      1824>>DOINDEX
B$ROSEG$
      1786**DCL      1824>>DOINDEX  1825>>ASSIGN
CODE
      1816**DCL      1888<<ASSIGN   1917<<ASSIGN   1931>>IF       1935<>CALL
CODE04.ACCESS.TIME
      1720**DCL      1919>>IF
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:169  
CODE04.SVMODIFY.TIME
      1721**DCL      1919>>IF       1920<>CALL
CODE14.CGRANS
      1731**DCL      1890<<ASSIGN
CODE14.MGRANS
      1731**DCL      1890>>ASSIGN
F$CFU$
      1787**DCL      1711--IMP-PTR  1788--REDEF    1843>>ASSIGN   1843>>ASSIGN   1846>>IF       1855>>ASSIGN
      1867>>ASSIGN   1868>>ASSIGN   1874>>ASSIGN
F$DCB.ACCT
      1281**DCL      1887<<ASSIGN
F$DCB.ACTPOS
      1296**DCL      1296--REDEF
F$DCB.ARS
      1271**DCL      1271--REDEF
F$DCB.ATTR
      1289**DCL      1290--REDEF
F$DCB.BORROW
      1304**DCL      1304--REDEF    1304--REDEF    1304--REDEF
F$DCB.DCBNAME.L
      1318**DCL      1318--IMP-SIZ
F$DCB.EOMCHAR
      1275**DCL      1275--REDEF
F$DCB.FCD
      1284**DCL      1827>>IF
F$DCB.FLDID
      1299**DCL      1299--REDEF
F$DCB.FORM$
      1293**DCL      1293--REDEF
F$DCB.FSECT
      1309**DCL      1309--REDEF
F$DCB.FSN
      1286**DCL      1286--REDEF    1286--REDEF    1287--REDEF
F$DCB.GTYP
      1300**DCL      1837<<ASSIGN   1916<<ASSIGN
F$DCB.HEADER$
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:170  
      1292**DCL      1292--REDEF
F$DCB.IASN
      1312**DCL      1827>>IF
F$DCB.IXTNSIZE
      1290**DCL      1290--REDEF
F$DCB.LASTSTA$
      1280**DCL      1280--REDEF
F$DCB.LVL
      1305**DCL      1305--REDEF
F$DCB.NAME.C
      1280**DCL      1280--REDEF
F$DCB.NOEOF
      1301**DCL      1301--REDEF
F$DCB.NRECS
      1291**DCL      1291--REDEF
F$DCB.NRECX
      1310**DCL      1310--REDEF
F$DCB.OHDR
      1302**DCL      1302--REDEF
F$DCB.ORG
      1285**DCL      1285--REDEF
F$DCB.PRECNO
      1308**DCL      1308--REDEF
F$DCB.RCSZ
      1313**DCL      1313--REDEF
F$DCB.RES
      1281**DCL      1281--REDEF
F$DCB.SETX
      1293**DCL      1293--REDEF    1827>>IF       1839<<ASSIGN
F$DCB.STARF
      1300**DCL      1838<<ASSIGN
F$DCB.TAB$
      1292**DCL      1293--REDEF
F$DCB.TDA
      1307**DCL      1307--REDEF
F$DCB.WSN
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:171  
      1282**DCL      1282--REDEF
FM$CFU
      1696**DCL      1933<>CALL
FM$CFU.ACCTX
      1697**DCL      1697--REDEF    1846>>IF
FM$CFU.STARX.F
      1697**DCL      1845>>IF
FM$CFUA.ACCT
      1705**DCL      1886>>IF       1887>>ASSIGN
FM$CFUA.FDCSDA
      1705**DCL      1913<<ASSIGN
FM$CFUA.FDFITSDA
      1705**DCL      1912<<ASSIGN   1931--ASSIGN
FM$CFUA.GCCTL
      1706**DCL      1857>>IF       1895>>IF
FM$CFUA.GMOD
      1706**DCL      1886>>IF
FM$CFUA.GRANS
      1708**DCL      1890>>ASSIGN
FM$CFUA.LINKX
      1705**DCL      1861>>ASSIGN   1871<<ASSIGN   1871>>ASSIGN   1872<<ASSIGN   1872>>ASSIGN   1874>>IF
      1877>>ASSIGN   1879<<ASSIGN   1885>>ASSIGN
FM$CFUA.SETX
      1705**DCL      1846>>IF       1857>>IF       1870>>IF       1911<<ASSIGN
FM$CFUF.W0
      1702**DCL      1849<<ASSIGN
FM$CFUX.ACCTS
      1711**DCL      1855>>ASSIGN   1868>>ASSIGN
FM$CFUX.ACCTX
      1711**DCL      1874<<ASSIGN
FM$CFUX.HEAD
      1713**DCL      1843>>ASSIGN   1851>>ASSIGN
FM$GRAN
      1739**DCL      1934--ASSIGN
FM$SET.SYSID
      1735**DCL      1834>>IF
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:172  
FM$SET.USERLIST
      1735**DCL      1735--REDEF
FM$SET.XCL
      1734**DCL      1822>>IF
FM$SET$
      1788**DCL      1734--IMP-PTR  1822>>IF       1834>>IF
FMC$RELSET
      1790**DCL-ENT  1924--CALL
FMD$FLSHBUF
      1791**DCL-ENT  1923--CALL
FMD$REDBUF
      1792**DCL-ENT  1933--CALL
FMD$WRTBUF
      1793**DCL-ENT  1891--CALL     1921--CALL
FMO$LOCCODT
      1794**DCL-ENT  1935--CALL
FMR$FN
      1795**DCL-ENT  1848--CALL
FMR$L8
      1796**DCL-ENT  1840--CALL
FMR$U8
      1797**DCL-ENT  1858--CALL     1880--CALL
FMR$Z8
      1798**DCL-ENT  1895--CALL
FMS$E$NOTUR
      1776**DCL      1927>>ASSIGN
FMS$E$NRLOPN
      1780**DCL      1926>>ASSIGN
FMS$GARBCOL
      1799**DCL-ENT  1853--CALL
FMSE$NOTUR
      1927**LABEL    1834--GOTO
FMSE$NRLOPN
      1926**LABEL    1823--GOTO     1830--GOTO     1859--GOTO
FM_PADSDA
      1804**DCL      1932--ASSIGN
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:173  
FM_SYSACCTX
      1805**DCL      1883>>IF       1884<<ASSIGN
GETCODE
      1930**PROC     1889--CALL     1918--CALL
JDCB$
      1808**DCL      1271--IMP-PTR  1836<<ASSIGN   1837>>ASSIGN   1838>>ASSIGN   1839>>ASSIGN   1887>>ASSIGN
      1916>>ASSIGN
NODISMT
      1923**LABEL    1918--CALLALT
NOGRANUP
      1895**LABEL    1889--CALLALT
P$
      1813**DCL      1814--REDEF    1867<<ASSIGN   1871>>ASSIGN   1872>>ASSIGN   1876<<ASSIGN   1877>>ASSIGN
PX.X
      1814**DCL      1874>>ASSIGN
Q$
      1811**DCL      1696--IMP-PTR  1702--IMP-PTR  1705--IMP-PTR  1812--REDEF    1843<<ASSIGN   1845>>IF
      1846>>IF       1847>>ASSIGN   1849>>ASSIGN   1851>>ASSIGN   1857>>IF       1857>>IF       1861>>ASSIGN
      1870>>IF       1872>>ASSIGN   1873>>ASSIGN   1874>>IF       1876>>ASSIGN   1885>>ASSIGN   1886>>IF
      1886>>IF       1887>>ASSIGN   1890>>ASSIGN   1893>>ASSIGN   1895>>IF       1911>>ASSIGN   1912>>ASSIGN
      1913>>ASSIGN   1931>>ASSIGN
QX.X
      1812**DCL      1844>>DOWHILE  1851<<ASSIGN   1855<<ASSIGN   1856>>DOWHILE  1861<<ASSIGN   1868<<ASSIGN
      1869>>DOWHILE  1877<<ASSIGN   1882<<ASSIGN
R$
      1815**DCL      1718--IMP-PTR  1726--IMP-PTR  1825<<ASSIGN   1826>>IF       1827>>IF       1827>>IF
      1827>>IF       1865<<ASSIGN   1871>>ASSIGN   1873<<ASSIGN   1879>>ASSIGN   1890>>ASSIGN   1890>>ASSIGN
      1919>>IF       1919>>IF       1920>>CALL     1936<<ASSIGN
RETALT IN PROCEDURE GETCODE
      1938**LABEL    1933--CALLALT  1935--CALLALT
SACCTX
      1810**DCL      1824<<DOINDEX
SC_LOSTCFU
      1800**DCL-ENT  1898--CALL
SETX
      1807**DCL        16--PROC     1822>>IF       1827>>IF       1834>>IF       1839>>ASSIGN   1846>>IF
PL6.E3A0      #004=FMS$RELACCT File=FMS$SCFU.:E05TSI                             TUE 07/29/97 17:02 Page:174  
      1857>>IF       1870>>IF       1924<>CALL
SSS$SYSTIME
      1801**DCL-ENT  1920--CALL
T$
      1817**DCL      1821--ASSIGN   1847<<ASSIGN   1893<<ASSIGN   1931<<ASSIGN   1932<<ASSIGN   1933>>CALL
      1934<<ASSIGN   1934>>ASSIGN   1936>>ASSIGN
T$$
      1819**DCL      1848<>CALL     1894<>CALL     1895<>CALL     1933<>CALL     1935<>CALL
T$$$
      1818**DCL      1819--IMP-PTR  1821<<ASSIGN   1848>>CALL     1894>>CALL     1895>>CALL     1933>>CALL
      1935>>CALL
UQB$DELQIDX
      1802**DCL-ENT  1894--CALL
