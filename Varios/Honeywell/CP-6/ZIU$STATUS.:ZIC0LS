
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:1    
        1        1        /*M*  ZIU$STATUS     IDSII          DISPLAY/CHANGE AREA STATUS  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*P*
        8        8              NAME: ZIU$STATUS
        9        9           PURPOSE: To display and or change certain area status conditions
       10       10                    found in the attribute block of an IDSII area file.
       11       11        */
       12       12        ZIU$STATUS: PROC ALTRET;
       13       13
       14       14    1   DCL AREA_OPENED BIT(1);
       15       15    1   DCL KEYFILE_LOCK BIT(1);
       16       16    1   DCL TSTAMP UBIN;
       17       17    1   DCL CHKSUM ENTRY;
       18       18    1   DCL SYS_FUNC_TSTAMP ENTRY ALTRET;
       19       19         %INCLUDE ZI_UWA_C;
       20      709         %ZI$UWAB;
       21     1049         %INCLUDE ZI$PG_STRUCTS;
       22     1152         %ATBLK_PG;
       23     1208         %DATA_PG;
       24     1227         %INCLUDE ZI$DIR;
       25     1384         %DIR;
       26     1528         %INCLUDE ZI_GLOBAL_DBUTIL;
       27     1706         %SYS_FUNC;
       28     1798         %MISC_DCLS;
       29     1851         %INCLUDE CP_6_SUBS;
       30     2391 S       %INCLUDE CP_6_C;
       31     2392         %F$DCB;
       32     2449         %INCLUDE ZI_PRSE_SUBS;
       33     2605         %INCLUDE ZI_ERRORS_SUBS;
       34     3125
       35     3126    1   DCL SYS_FUNC_OPEN ENTRY ALTRET;
       36     3127    1   DCL SYS_FUNC_READ ENTRY ALTRET;
       37     3128    1   DCL SYS_FUNC_WRIT ENTRY ALTRET;
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:2    
       38     3129    1   DCL SYS_FUNC_CLOS ENTRY ALTRET;
       39     3130    1   DCL SYS_FUNC_ERRMSG ENTRY ALTRET;
       40     3131
       41     3132        /*E* ERROR: ZIU-DBU#LCKD-C
       42     3133        MESSAGE: Data base file %FN %U1.  */
       43     3134        /*E* ERROR: ZIU-DBU#WARNLK-C
       44     3135        MESSAGE:  Note: It is still recommended to rebuild the keyfile
       45     3136                        through the REBUILD KEY directive. */
       46     3137        /*E* ERROR: ZIU-DBU#ERR_LK-C
       47     3138        MESSAGE: No data base locking or unlocking for INDEX area "%U1". */
       48     3139        %EJECT;
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:3    
       49     3140
       50     3141    1   ZIU$LOCK: ENTRY ALTRET;
       51     3142
       52     3143    1       DCBSF = ZI$DIR.AREA_NM.DCB#;
       53     3144    1       CALL OPEN_READ ALTRET(ALTRTN); /* OPEN AND READ ATBLK */
       54     3145
       55     3146    1       IF ZI$DIR.LOCKCODE=2 AND ATBLK_PG.STATUS.LOCKUPD THEN
       56     3147    2       DO;
       57     3148    2           CALL ERR_MSG(DBU#LCKD,'already locked to update users@');
       58     3149    2           STEPCC = 4;
       59     3150    2           END;
       60     3151    1       ELSE
       61     3152    1           IF ATBLK_PG.STATUS.LOCKED OR ATBLK_PG.STATUS.KFILE_CURR THEN
       62     3153    2           DO;
       63     3154    2               CALL ERR_MSG(DBU#LCKD,'already locked from all access@');
       64     3155    2               STEPCC = 4;
       65     3156    2               END;
       66     3157    1           ELSE
       67     3158    2           DO;
       68     3159    2               ATBLK_PG.TIME_LOCKED=TSTAMP;
       69     3160    2               ATBLK_PG.REASON_LOCKED.BY_USER='1'B;
       70     3161    2               IF ZI$DIR.LOCKCODE=2 THEN
       71     3162    2                   ATBLK_PG.STATUS.LOCKUPD='1'B;
       72     3163    2               ELSE
       73     3164    2                   ATBLK_PG.STATUS.LOCKED='1'B;
       74     3165    2               CALL WRITE_ATRIB ALTRET(ALTRTN); /* WRITE AND CLOSE AREA */
       75     3166    2               IF ZI$DIR.LOCKCODE=2 THEN
       76     3167    2                   CALL ERR_MSG(DBU#LCKD,'now locked (to update users)@');
       77     3168    2               ELSE
       78     3169    2                   CALL ERR_MSG(DBU#LCKD,'now locked@');
       79     3170    2               END;
       80     3171    1       GOTO RET;
       81     3172
       82     3173    1   ALTRTN: DCBSF = ZI$DIR.AREA_NM.DCB#;
       83     3174    1       IF ~AREA_OPENED AND DCBADDR(DCBSF)->F$DCB.FCD# THEN
       84     3175    1           CALL SYS_FUNC_CLOS;
       85     3176    1       IF (ZI$DIR.CODE=#LOCK OR ZI$DIR.CODE=#UNLOCK) AND
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:4    
       86     3177    1          ZI$DIR.AUTODUMP AND UWA.AC_REC.PG_TYPE>0 THEN
       87     3178    1           RETURN; /* DONT ALTRET ON LOCK ALL DIR FOR INDEX */
       88     3179    1       ALTRETURN;
       89     3180
       90     3181    1   RET: DCBSF = ZI$DIR.AREA_NM.DCB#;
       91     3182    1       IF ~AREA_OPENED THEN /* IF AREA WAS CLOSED BEFORE */
       92     3183    1           CALL SYS_FUNC_CLOS; /* RETURN WITH CLOSED. */
       93     3184    1       RETURN;
       94     3185
       95     3186        %EJECT;
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:5    
       96     3187    1   ZIU$UNLCK: ENTRY ALTRET;
       97     3188
       98     3189    1       DCBSF = ZI$DIR.AREA_NM.DCB#;
       99     3190    1       CALL OPEN_READ ALTRET(ALTRTN);
      100     3191
      101     3192    1       KEYFILE_LOCK=ATBLK_PG.STATUS.KFILE_CURR;
      102     3193    1       IF ZI$DIR.LOCKCODE=2 AND KEYFILE_LOCK='0'B THEN
      103     3194    1           CALL ERR_MSG(DBU#LCKD,'already keyfile-unlocked@');
      104     3195    1       ELSE
      105     3196    1           IF ZI$DIR.LOCKCODE=0 AND ATBLK_PG.LOCK_STATUS.ALL_LOCKS='0'B THEN
      106     3197    1               CALL ERR_MSG(DBU#LCKD,'already unlocked@');
      107     3198    1           ELSE
      108     3199    2           DO;
      109     3200    2               IF ZI$DIR.LOCKCODE=2 THEN
      110     3201    3               DO;
      111     3202    3                   ATBLK_PG.STATUS.KFILE_CURR='0'B;
      112     3203    3                   ATBLK_PG.REASON_LOCKED.LOAD_MODE='0'B;
      113     3204    3                   END;
      114     3205    2               ELSE
      115     3206    2                   ATBLK_PG.LOCK_STATUS.ALL_LOCKS='0'B;
      116     3207    2               IF ATBLK_PG.LOCK_STATUS.ALL_LOCKS='0'B THEN
      117     3208    2                   ATBLK_PG.TIME_LOCKED=0;
      118     3209    2               CALL WRITE_ATRIB ALTRET(ALTRTN);
      119     3210    2               IF ZI$DIR.LOCKCODE=2 THEN
      120     3211    2                   CALL ERR_MSG(DBU#LCKD,'now keyfile-unlocked@');
      121     3212    2               ELSE
      122     3213    2                   IF KEYFILE_LOCK THEN
      123     3214    2                       CALL ERR_MSG(DBU#LCKD,'and its keyfile now unlocked@');
      124     3215    2                   ELSE
      125     3216    2                       CALL ERR_MSG(DBU#LCKD,'now unlocked@');
      126     3217    2               IF KEYFILE_LOCK THEN
      127     3218    2                   CALL ERR_MSG(DBU#WARNLK);
      128     3219    2               END;
      129     3220    1       GOTO RET;
      130     3221        %EJECT;
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:6    
      131     3222    1   ZIU$TESTLOCK: ENTRY ALTRET;
      132     3223
      133     3224        /*D*
      134     3225            This routine checks if a database was locked.  If so, it sets
      135     3226            STEPCC=6.
      136     3227        */
      137     3228    1       DCBSF = ZI$DIR.AREA_NM.DCB#;
      138     3229    1       CALL OPEN_READ ALTRET(ALTRTN); /* open and read ALTBLK */
      139     3230    1       IF (~ ATBLK_PG.LOCK_STATUS.ALL_LOCKS OR
      140     3231    1          ~ ATBLK_PG.STATUS.LOCKUPD OR
      141     3232    1          ~ ATBLK_PG.STATUS.LOCKED ) AND
      142     3233    1          ATBLK_PG.TIME_LOCKED = 0
      143     3234    2       THEN DO; /* it was unlocked */
      144     3235    2           CALL ERR_MSG(DBU#LCKD,'is unlocked@');
      145     3236    2           END;
      146     3237    2       ELSE DO;
      147     3238    2           IF ZI$DIR.LOCKCODE = 2 OR ATBLK_PG.STATUS.LOCKUPD THEN
      148     3239    2               CALL ERR_MSG(DBU#LCKD,'is locked to update users@');
      149     3240    2           IF ATBLK_PG.STATUS.LOCKED OR ATBLK_PG.STATUS.KFILE_CURR THEN
      150     3241    2               CALL ERR_MSG(DBU#LCKD,'is locked to all access@');
      151     3242    2           STEPCC = 6; /* Set STEPCC to 6 before exit. */
      152     3243    2           END;
      153     3244    1       GOTO RET;
      154     3245
      155     3246        %EJECT;
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:7    
      156     3247
      157     3248    1   ZIU$KFILE: ENTRY ALTRET; /* RESET KEYFILE TO OFF */
      158     3249
      159     3250    1       DCBSF = ZI$DIR.AREA_NM.DCB#;
      160     3251    1       CALL OPEN_READ ALTRET(ALTRTN);
      161     3252    1       IF ATBLK_PG.STATUS.KFILE_CURR THEN
      162     3253    2       DO;
      163     3254    2           ATBLK_PG.STATUS.KFILE_CURR='0'B;
      164     3255    2           ATBLK_PG.REASON_LOCKED.LOAD_MODE='0'B;
      165     3256    2           CALL WRITE_ATRIB ALTRET(ALTRTN);
      166     3257    2           END;
      167     3258    1       GOTO RET; /* THIS SUB ENTERED FROM REBUILD KEY */
      168     3259
      169     3260        %EJECT;
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:8    
      170     3261
      171     3262    1   OPEN_READ: PROC ALTRET; /* INTERNAL SUBR: OPEN AND READ ATRIB */
      172     3263
      173     3264    2       AREA_OPENED = DCBADDR(DCBSF)->F$DCB.FCD#;
      174     3265    2       IF (ZI$DIR.CODE=#LOCK OR ZI$DIR.CODE=#UNLOCK) AND
      175     3266    2          UWA.AC_REC.PG_TYPE>0 THEN /* INDEX AREA */
      176     3267    3       DO; /* CANNOT BE LOCKED OR UNLOCKED */
      177     3268    3           ERR_INSERT(0)=ZI$DIR.AREA_NM.NAME;
      178     3269    3           CALL ERR_MSG(DBU#ERR_LK);
      179     3270    3           ALTRETURN;
      180     3271    3           END;
      181     3272    2       IF ~AREA_OPENED THEN
      182     3273    3       DO; /* SAVE OPEN STATUS, BE USED TO DETERMINE CLOSE OR NOT */
      183     3274    3           SHARESF = %NONE#;
      184     3275    3           ORGSF = %IDS#;
      185     3276    3           ACSSF = %DIRECT#;
      186     3277    3           ASNSF = %FILE#;
      187     3278    3           FUNSF = %UPDATE#;
      188     3279    3           FIDSF = ZI$DIR.AREA_NM.NAME.TEXT;
      189     3280    3           CALL SYS_FUNC_OPEN ALTRET(ALTRTN);
      190     3281    3           END;
      191     3282
      192     3283    2       IF DCBADDR(DCBSF)->F$DCB.ORG#~=%IDS# THEN
      193     3284    3       DO;
      194     3285    3           CALL ERR_MSG(DBU#CHKIDSREP);
      195     3286    3           ALTRETURN;
      196     3287    3           END;
      197     3288    2       BUFSF = VECTOR(I_O_BUF(0));
      198     3289    2       BUFLNSF = 4096;
      199     3290    2       FULLSF = %YES#;
      200     3291    2       WAITSF = %YES#;
      201     3292    2       ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;
      202     3293    2       KEYSF = %YES#;
      203     3294    2       KEYVSF.IDSKEY = 0;
      204     3295    2       CALL SYS_FUNC_READ ALTRET(ALTRTN);
      205     3296    2       ATBLK$ = ADDR(I_O_BUF(0));
      206     3297    2       TSTAMPSF = VECTOR(TSTAMP);
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:9    
      207     3298    2       DATESF = VECTOR(NIL);
      208     3299    2       SOURCESF = %CLOCK#;
      209     3300    2       DESTSF = %UTS#;
      210     3301    2       CALL SYS_FUNC_TSTAMP;
      211     3302    2       RETURN;
      212     3303
      213     3304    2   ALTRTN: ALTRETURN;
      214     3305    2   END OPEN_READ;
      215     3306        %EJECT;
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:10   
      216     3307
      217     3308    1   WRITE_ATRIB: PROC ALTRET;
      218     3309
      219     3310    2       IF ATBLK_PG.MISC_INFO.CHKSM THEN
      220     3311    3       DO;
      221     3312    3           DATA$ = ATBLK$;
      222     3313    3           CALL CHKSUM;
      223     3314    3           DATA_PG.CHKSUM_WD = ICHKSUM;
      224     3315    3           END;
      225     3316    2       DCBSF = ZI$DIR.AREA_NM.DCB#;
      226     3317    2       BUFSF = VECTOR(I_O_BUF(0));
      227     3318    2       BUFLNSF = 4096;
      228     3319    2       FULLSF = %YES#;
      229     3320    2       WAITSF = %YES#;
      230     3321    2       VFCSF = %NO#;
      231     3322    2       ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;
      232     3323    2       KEYSF = %YES#;
      233     3324    2       KEYVSF.IDSKEY = 0;
      234     3325    2       CALL SYS_FUNC_WRIT ALTRET(ALTRTN);
      235     3326
      236     3327    2       RETURN;
      237     3328
      238     3329    2   ALTRTN: ALTRETURN;
      239     3330    2   END WRITE_ATRIB;
      240     3331        %EJECT;
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:11   
      241     3332
      242     3333    1   ERR_MSG: PROC(ERR_CODE,U1);
      243     3334
      244     3335    2   DCL ERR_CODE SBIN ALIGNED;
      245     3336    2   DCL U1 CHAR(LEN) CALIGNED;
      246     3337    2   DCL LEN SBIN;
      247     3338
      248     3339    2       ERRCODESF.ERR# = ERR_CODE;
      249     3340    2       MSGCODE =ERRCODE_RDEF;
      250     3341    2       ERRFLGSF = 1;
      251     3342    2       IF ERR_CODE=DBU#WARNLK THEN
      252     3343    2           ERRFLGSF = 0; /* NO STAR FOR WARNING KEYFILE NOT REBUILT */
      253     3344    2       IF ADDR(U1)~=ADDR(NIL) THEN
      254     3345    3       DO;
      255     3346    3           LEN=31;
      256     3347    3           CALL INDEX(LEN,'@',U1);
      257     3348    3           ERR_INSERT.CNT(0)=LEN;
      258     3349    3           ERR_INSERT.TEXT(0)=U1;
      259     3350    3           END;
      260     3351    2       CALL SYS_FUNC_ERRMSG;
      261     3352    2   END ERR_MSG;
      262     3353    1   END ZIU$STATUS;
      263     3354        %EOD;

PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:12   
--  Include file information  --

   ZI_ERRORS_SUBS.:ZIC0TOU  is referenced.
   ZI_PRSE_SUBS.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   ZI_GLOBAL_DBUTIL.:ZIC0TOU  is referenced.
   ZI$DIR.:ZIC0TOU  is referenced.
   ZI$PG_STRUCTS.:ZIC0TOU  is referenced.
   ZI_UWA_C.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIU$STATUS.

   Procedure ZIU$STATUS requires 455 words for executable code.
   Procedure ZIU$STATUS requires 14 words of local(AUTO) storage.

PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:13   

 Object Unit name= ZIU$STATUS                                 File name= ZIU$STATUS.:ZIC0TOU
 UTS= SEP 05 '97 13:32:37.72 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$LO
    1  RoData even  UTS     69    105  ZIU$STATUS
    2   Proc  even  none   455    707  ZIU$STATUS
    3  RoData even  none    33     41  ZIU$STATUS

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        0  ZIU$STATUS
     2      3          yes     yes      Std        0  ZIU$LOCK
     2    160          yes     yes      Std        0  ZIU$UNLCK
     2    311          yes     yes      Std        0  ZIU$TESTLOCK
     2    402          yes     yes      Std        0  ZIU$KFILE
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:14   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       0 SYS_FUNC_CLOS
 yes     yes           Std       0 SYS_FUNC_OPEN
 yes     yes           Std       0 SYS_FUNC_READ
 yes     yes           Std       0 SYS_FUNC_TSTAMP
         yes           Std       0 CHKSUM
 yes     yes           Std       0 SYS_FUNC_WRIT
 yes     yes           Std       0 SYS_FUNC_ERRMSG
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     UWA                                   ATBLK$                                DATA$
     ZI$DIR                                SCHEMA_ACTIVE                         RECORD_LIST
     SET_LIST                              RETAIN_LIST                           DUMP_FID
     ALTKY                                 INIT_RG                               KEY_RNG
     ITEM_LIST                             BLKLSF                                KEYLSF
     KEYXSF                                DCBSF                                 ORGSF
     KEYSF                                 KEYVSF                                ACSSF
     NOTIMESF                              FUNSF                                 ASNSF
     TESTSF                                XTENSIZESF                            DISPSF
     WAITSF                                VFCSF                                 FULLSF
     BKUPSF                                BUFLNSF                               BUFSF
     SOURCESF                              DESTSF                                DATESF
     TIMESF                                UTSSF                                 DAYSF
     TSTAMPSF                              ENCRP_SEEDSF                          ERRCODESF
     MSGCODE                               INCL_ERR                              ERR_INSERT
     FIDSF_RD                              ACNT                                  EXISTSF
     SHARESF                               DCBNMSF                               KEYRSF
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:15   
     NO_KEYSF                              REASGNSF                              CARRY_ATTRIBUTESF
     SUBMESSF                              SPKY_OPNSF                            POSSF
     ERRFLGSF                              MERGESF                               FSA_FLAG
     RELGSF                                UNUSED                                HELPCODE
     COUNTSF                               INDEXSF                               GAP
     PSNSF                                 ACNTSF                                KEY_SHADWSF
     REC$                                  RB                                    RE
     IE                                    IB                                    CNT
     ICNT                                  RCNT                                  SCNT
     FIRST_SET                             RETCNT                                DMPCNT
     KCNT                                  ACNT_IDX                              I
     J                                     K                                     X
     STEPCC                                I_O_BUF$                              OUT_INDX
     I_O_SIZE                              REC_DATA_LN                           M$LO
     B$TCB$                                B$ROS$                                B$JIT$
     KEYFID                                I_O_KEY                               RESTART
     BREAK_FLAG                            ICHKSUM                               ITMCNT
     GAP1

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ROSID                                 NULLSID                               ISSID
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:16   


        1        1        /*M*  ZIU$STATUS     IDSII          DISPLAY/CHANGE AREA STATUS  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*P*
        8        8              NAME: ZIU$STATUS
        9        9           PURPOSE: To display and or change certain area status conditions
       10       10                    found in the attribute block of an IDSII area file.
       11       11        */
       12       12        ZIU$STATUS: PROC ALTRET;

     12  2 000000   000000 700200 xent  ZIU$STATUS   TSX0  ! X66_AUTO_0
         2 000001   000016 000000                    ZERO    14,0
         2 000002   000005 710000 2                  TRA     s:3143

       13       13
       14       14    1   DCL AREA_OPENED BIT(1);
       15       15    1   DCL KEYFILE_LOCK BIT(1);
       16       16    1   DCL TSTAMP UBIN;
       17       17    1   DCL CHKSUM ENTRY;
       18       18    1   DCL SYS_FUNC_TSTAMP ENTRY ALTRET;
       19       19         %INCLUDE ZI_UWA_C;
       20      709         %ZI$UWAB;
       21     1049         %INCLUDE ZI$PG_STRUCTS;
       22     1152         %ATBLK_PG;
       23     1208         %DATA_PG;
       24     1227         %INCLUDE ZI$DIR;
       25     1384         %DIR;
       26     1528         %INCLUDE ZI_GLOBAL_DBUTIL;
       27     1706         %SYS_FUNC;
       28     1798         %MISC_DCLS;
       29     1851         %INCLUDE CP_6_SUBS;
       30     2391 S       %INCLUDE CP_6_C;
       31     2392         %F$DCB;
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:17   
       32     2449         %INCLUDE ZI_PRSE_SUBS;
       33     2605         %INCLUDE ZI_ERRORS_SUBS;
       34     3125
       35     3126    1   DCL SYS_FUNC_OPEN ENTRY ALTRET;
       36     3127    1   DCL SYS_FUNC_READ ENTRY ALTRET;
       37     3128    1   DCL SYS_FUNC_WRIT ENTRY ALTRET;
       38     3129    1   DCL SYS_FUNC_CLOS ENTRY ALTRET;
       39     3130    1   DCL SYS_FUNC_ERRMSG ENTRY ALTRET;
       40     3131
       41     3132        /*E* ERROR: ZIU-DBU#LCKD-C
       42     3133        MESSAGE: Data base file %FN %U1.  */
       43     3134        /*E* ERROR: ZIU-DBU#WARNLK-C
       44     3135        MESSAGE:  Note: It is still recommended to rebuild the keyfile
       45     3136                        through the REBUILD KEY directive. */
       46     3137        /*E* ERROR: ZIU-DBU#ERR_LK-C
       47     3138        MESSAGE: No data base locking or unlocking for INDEX area "%U1". */
       48     3139        %EJECT;
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:18   
       49     3140
       50     3141    1   ZIU$LOCK: ENTRY ALTRET;

   3141  2 000003   000000 700200 xent  ZIU$LOCK     TSX0  ! X66_AUTO_0
         2 000004   000016 000000                    ZERO    14,0

       51     3142
       52     3143    1       DCBSF = ZI$DIR.AREA_NM.DCB#;

   3143  2 000005   000244 220000 xsym               LDX0    ZI$DIR+164
         2 000006   000000 740000 xsym               STX0    DCBSF

       53     3144    1       CALL OPEN_READ ALTRET(ALTRTN); /* OPEN AND READ ATBLK */

   3144  2 000007   000423 701000 2                  TSX1    OPEN_READ
         2 000010   000112 702000 2                  TSX2    ALTRTN

       54     3145
       55     3146    1       IF ZI$DIR.LOCKCODE=2 AND ATBLK_PG.STATUS.LOCKUPD THEN

   3146  2 000011   000125 236000 xsym               LDQ     ZI$DIR+85
         2 000012   016000 376007                    ANQ     7168,DL
         2 000013   004000 116007                    CMPQ    2048,DL
         2 000014   000032 601000 2                  TNZ     s:3152
         2 000015   000000 470400 xsym               LDP0    ATBLK$
         2 000016   000041 236100                    LDQ     33,,PR0
         2 000017   200000 316003                    CANQ    65536,DU
         2 000020   000032 600000 2                  TZE     s:3152

       56     3147    2       DO;

       57     3148    2           CALL ERR_MSG(DBU#LCKD,'already locked to update users@');

   3148  2 000021   000001 236000 3                  LDQ     1
         2 000022   200012 756100                    STQ     @ERR_CODE+1,,AUTO
         2 000023   000002 236000 3                  LDQ     2
         2 000024   200011 756100                    STQ     TSTAMP+4,,AUTO
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:19   
         2 000025   000641 701000 2                  TSX1    ERR_MSG
         2 000026   000000 011000                    NOP     0

       58     3149    2           STEPCC = 4;

   3149  2 000027   000004 235007                    LDA     4,DL
         2 000030   000000 755000 xsym               STA     STEPCC

       59     3150    2           END;

   3150  2 000031   000111 710000 2                  TRA     s:3171

       60     3151    1       ELSE
       61     3152    1           IF ATBLK_PG.STATUS.LOCKED OR ATBLK_PG.STATUS.KFILE_CURR THEN

   3152  2 000032   000000 470400 xsym               LDP0    ATBLK$
         2 000033   000041 234100                    SZN     33,,PR0
         2 000034   000040 604000 2                  TMI     s:3154
         2 000035   000041 236100                    LDQ     33,,PR0
         2 000036   100000 316003                    CANQ    32768,DU
         2 000037   000051 600000 2                  TZE     s:3159

       62     3153    2           DO;

       63     3154    2               CALL ERR_MSG(DBU#LCKD,'already locked from all access@');

   3154  2 000040   000003 236000 3                  LDQ     3
         2 000041   200012 756100                    STQ     @ERR_CODE+1,,AUTO
         2 000042   000002 236000 3                  LDQ     2
         2 000043   200011 756100                    STQ     TSTAMP+4,,AUTO
         2 000044   000641 701000 2                  TSX1    ERR_MSG
         2 000045   000000 011000                    NOP     0

       64     3155    2               STEPCC = 4;

   3155  2 000046   000004 235007                    LDA     4,DL
         2 000047   000000 755000 xsym               STA     STEPCC
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:20   

       65     3156    2               END;

   3156  2 000050   000111 710000 2                  TRA     s:3171

       66     3157    1           ELSE
       67     3158    2           DO;

       68     3159    2               ATBLK_PG.TIME_LOCKED=TSTAMP;

   3159  2 000051   200005 235100                    LDA     TSTAMP,,AUTO
         2 000052   000042 755100                    STA     34,,PR0

       69     3160    2               ATBLK_PG.REASON_LOCKED.BY_USER='1'B;

   3160  2 000053   400000 236003                    LDQ     -131072,DU
         2 000054   000043 256100                    ORSQ    35,,PR0

       70     3161    2               IF ZI$DIR.LOCKCODE=2 THEN

   3161  2 000055   000125 236000 xsym               LDQ     ZI$DIR+85
         2 000056   016000 376007                    ANQ     7168,DL
         2 000057   004000 116007                    CMPQ    2048,DL
         2 000060   000064 601000 2                  TNZ     s:3164

       71     3162    2                   ATBLK_PG.STATUS.LOCKUPD='1'B;

   3162  2 000061   200000 236003                    LDQ     65536,DU
         2 000062   000041 256100                    ORSQ    33,,PR0
         2 000063   000066 710000 2                  TRA     s:3165

       72     3163    2               ELSE
       73     3164    2                   ATBLK_PG.STATUS.LOCKED='1'B;

   3164  2 000064   400000 236003                    LDQ     -131072,DU
         2 000065   000041 256100                    ORSQ    33,,PR0

PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:21   
       74     3165    2               CALL WRITE_ATRIB ALTRET(ALTRTN); /* WRITE AND CLOSE AREA */

   3165  2 000066   000572 701000 2                  TSX1    WRITE_ATRIB
         2 000067   000112 702000 2                  TSX2    ALTRTN

       75     3166    2               IF ZI$DIR.LOCKCODE=2 THEN

   3166  2 000070   000125 236000 xsym               LDQ     ZI$DIR+85
         2 000071   016000 376007                    ANQ     7168,DL
         2 000072   004000 116007                    CMPQ    2048,DL
         2 000073   000103 601000 2                  TNZ     s:3169

       76     3167    2                   CALL ERR_MSG(DBU#LCKD,'now locked (to update users)@');

   3167  2 000074   000004 236000 3                  LDQ     4
         2 000075   200012 756100                    STQ     @ERR_CODE+1,,AUTO
         2 000076   000002 236000 3                  LDQ     2
         2 000077   200011 756100                    STQ     TSTAMP+4,,AUTO
         2 000100   000641 701000 2                  TSX1    ERR_MSG
         2 000101   000000 011000                    NOP     0
         2 000102   000111 710000 2                  TRA     s:3171

       77     3168    2               ELSE
       78     3169    2                   CALL ERR_MSG(DBU#LCKD,'now locked@');

   3169  2 000103   000005 236000 3                  LDQ     5
         2 000104   200012 756100                    STQ     @ERR_CODE+1,,AUTO
         2 000105   000002 236000 3                  LDQ     2
         2 000106   200011 756100                    STQ     TSTAMP+4,,AUTO
         2 000107   000641 701000 2                  TSX1    ERR_MSG
         2 000110   000000 011000                    NOP     0

       79     3170    2               END;

       80     3171    1       GOTO RET;

   3171  2 000111   000146 710000 2                  TRA     RET
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:22   

       81     3172
       82     3173    1   ALTRTN: DCBSF = ZI$DIR.AREA_NM.DCB#;

   3173  2 000112   000244 220000 xsym  ALTRTN       LDX0    ZI$DIR+164
         2 000113   000000 740000 xsym               STX0    DCBSF

       83     3174    1       IF ~AREA_OPENED AND DCBADDR(DCBSF)->F$DCB.FCD# THEN

   3174  2 000114   200003 236100                    LDQ     AREA_OPENED,,AUTO
         2 000115   400000 376003                    ANQ     -131072,DU
         2 000116   400000 676003                    ERQ     -131072,DU
         2 000117   000131 600000 2                  TZE     s:3176
         2 000120   000006 470400 3                  LDP0    6
         2 000121   000000 471500                    LDP1    0,,PR0
         2 000122   100000 473510                    LDP3    0,X0,PR1
         2 000123   300031 236100                    LDQ     25,,PR3
         2 000124   020000 316007                    CANQ    8192,DL
         2 000125   000131 600000 2                  TZE     s:3176

       84     3175    1           CALL SYS_FUNC_CLOS;

   3175  2 000126   000007 631400 3                  EPPR1   7
         2 000127   000000 701000 xent               TSX1    SYS_FUNC_CLOS
         2 000130   000000 011000                    NOP     0

       85     3176    1       IF (ZI$DIR.CODE=#LOCK OR ZI$DIR.CODE=#UNLOCK) AND

   3176  2 000131   000125 236000 xsym               LDQ     ZI$DIR+85
         2 000132   000010 376000 3                  ANQ     8
         2 000133   000011 116000 3                  CMPQ    9
         2 000134   000137 600000 2                  TZE     s:3176+6
         2 000135   000012 116000 3                  CMPQ    10
         2 000136   000145 601000 2                  TNZ     s:3179
         2 000137   000026 236000 xsym               LDQ     ZI$DIR+22
         2 000140   400000 316007                    CANQ    -131072,DL
         2 000141   000145 600000 2                  TZE     s:3179
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:23   
         2 000142   000237 235000 xsym               LDA     UWA+159
         2 000143   000145 604400 2                  TMOZ    s:3179

       86     3177    1          ZI$DIR.AUTODUMP AND UWA.AC_REC.PG_TYPE>0 THEN
       87     3178    1           RETURN; /* DONT ALTRET ON LOCK ALL DIR FOR INDEX */

   3178  2 000144   000000 702200 xent               TSX2  ! X66_ARET

       88     3179    1       ALTRETURN;

   3179  2 000145   000000 702200 xent               TSX2  ! X66_AALT

       89     3180
       90     3181    1   RET: DCBSF = ZI$DIR.AREA_NM.DCB#;

   3181  2 000146   000244 220000 xsym  RET          LDX0    ZI$DIR+164
         2 000147   000000 740000 xsym               STX0    DCBSF

       91     3182    1       IF ~AREA_OPENED THEN /* IF AREA WAS CLOSED BEFORE */

   3182  2 000150   200003 236100                    LDQ     AREA_OPENED,,AUTO
         2 000151   400000 376003                    ANQ     -131072,DU
         2 000152   400000 676003                    ERQ     -131072,DU
         2 000153   000157 600000 2                  TZE     s:3184

       92     3183    1           CALL SYS_FUNC_CLOS; /* RETURN WITH CLOSED. */

   3183  2 000154   000007 631400 3                  EPPR1   7
         2 000155   000000 701000 xent               TSX1    SYS_FUNC_CLOS
         2 000156   000000 011000                    NOP     0

       93     3184    1       RETURN;

   3184  2 000157   000000 702200 xent               TSX2  ! X66_ARET

       94     3185
       95     3186        %EJECT;
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:24   
       96     3187    1   ZIU$UNLCK: ENTRY ALTRET;

   3187  2 000160   000000 700200 xent  ZIU$UNLCK    TSX0  ! X66_AUTO_0
         2 000161   000016 000000                    ZERO    14,0

       97     3188
       98     3189    1       DCBSF = ZI$DIR.AREA_NM.DCB#;

   3189  2 000162   000244 220000 xsym               LDX0    ZI$DIR+164
         2 000163   000000 740000 xsym               STX0    DCBSF

       99     3190    1       CALL OPEN_READ ALTRET(ALTRTN);

   3190  2 000164   000423 701000 2                  TSX1    OPEN_READ
         2 000165   000112 702000 2                  TSX2    ALTRTN

      100     3191
      101     3192    1       KEYFILE_LOCK=ATBLK_PG.STATUS.KFILE_CURR;

   3192  2 000166   000000 470400 xsym               LDP0    ATBLK$
         2 000167   000041 236100                    LDQ     33,,PR0
         2 000170   000002 736000                    QLS     2
         2 000171   400000 376003                    ANQ     -131072,DU
         2 000172   200004 756100                    STQ     KEYFILE_LOCK,,AUTO

      102     3193    1       IF ZI$DIR.LOCKCODE=2 AND KEYFILE_LOCK='0'B THEN

   3193  2 000173   000125 236000 xsym               LDQ     ZI$DIR+85
         2 000174   016000 376007                    ANQ     7168,DL
         2 000175   004000 116007                    CMPQ    2048,DL
         2 000176   000210 601000 2                  TNZ     s:3196
         2 000177   200004 234100                    SZN     KEYFILE_LOCK,,AUTO
         2 000200   000210 604000 2                  TMI     s:3196

      103     3194    1           CALL ERR_MSG(DBU#LCKD,'already keyfile-unlocked@');

   3194  2 000201   000013 236000 3                  LDQ     11
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:25   
         2 000202   200012 756100                    STQ     @ERR_CODE+1,,AUTO
         2 000203   000002 236000 3                  LDQ     2
         2 000204   200011 756100                    STQ     TSTAMP+4,,AUTO
         2 000205   000641 701000 2                  TSX1    ERR_MSG
         2 000206   000000 011000                    NOP     0
         2 000207   000310 710000 2                  TRA     s:3220

      104     3195    1       ELSE
      105     3196    1           IF ZI$DIR.LOCKCODE=0 AND ATBLK_PG.LOCK_STATUS.ALL_LOCKS='0'B THEN

   3196  2 000210   000125 236000 xsym               LDQ     ZI$DIR+85
         2 000211   016000 316007                    CANQ    7168,DL
         2 000212   000225 601000 2                  TNZ     s:3200
         2 000213   000041 236100                    LDQ     33,,PR0
         2 000214   700000 316003                    CANQ    -32768,DU
         2 000215   000225 601000 2                  TNZ     s:3200

      106     3197    1               CALL ERR_MSG(DBU#LCKD,'already unlocked@');

   3197  2 000216   000014 236000 3                  LDQ     12
         2 000217   200012 756100                    STQ     @ERR_CODE+1,,AUTO
         2 000220   000002 236000 3                  LDQ     2
         2 000221   200011 756100                    STQ     TSTAMP+4,,AUTO
         2 000222   000641 701000 2                  TSX1    ERR_MSG
         2 000223   000000 011000                    NOP     0
         2 000224   000310 710000 2                  TRA     s:3220

      107     3198    1           ELSE
      108     3199    2           DO;

      109     3200    2               IF ZI$DIR.LOCKCODE=2 THEN

   3200  2 000225   000125 236000 xsym               LDQ     ZI$DIR+85
         2 000226   016000 376007                    ANQ     7168,DL
         2 000227   004000 116007                    CMPQ    2048,DL
         2 000230   000236 601000 2                  TNZ     s:3206

PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:26   
      110     3201    3               DO;

      111     3202    3                   ATBLK_PG.STATUS.KFILE_CURR='0'B;

   3202  2 000231   000015 236000 3                  LDQ     13
         2 000232   000041 356100                    ANSQ    33,,PR0

      112     3203    3                   ATBLK_PG.REASON_LOCKED.LOAD_MODE='0'B;

   3203  2 000233   000016 236000 3                  LDQ     14
         2 000234   000043 356100                    ANSQ    35,,PR0

      113     3204    3                   END;

   3204  2 000235   000240 710000 2                  TRA     s:3207

      114     3205    2               ELSE
      115     3206    2                   ATBLK_PG.LOCK_STATUS.ALL_LOCKS='0'B;

   3206  2 000236   000017 236000 3                  LDQ     15
         2 000237   000041 356100                    ANSQ    33,,PR0

      116     3207    2               IF ATBLK_PG.LOCK_STATUS.ALL_LOCKS='0'B THEN

   3207  2 000240   000041 236100                    LDQ     33,,PR0
         2 000241   700000 316003                    CANQ    -32768,DU
         2 000242   000244 601000 2                  TNZ     s:3209

      117     3208    2                   ATBLK_PG.TIME_LOCKED=0;

   3208  2 000243   000042 450100                    STZ     34,,PR0

      118     3209    2               CALL WRITE_ATRIB ALTRET(ALTRTN);

   3209  2 000244   000572 701000 2                  TSX1    WRITE_ATRIB
         2 000245   000112 702000 2                  TSX2    ALTRTN

PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:27   
      119     3210    2               IF ZI$DIR.LOCKCODE=2 THEN

   3210  2 000246   000125 236000 xsym               LDQ     ZI$DIR+85
         2 000247   016000 376007                    ANQ     7168,DL
         2 000250   004000 116007                    CMPQ    2048,DL
         2 000251   000261 601000 2                  TNZ     s:3213

      120     3211    2                   CALL ERR_MSG(DBU#LCKD,'now keyfile-unlocked@');

   3211  2 000252   000020 236000 3                  LDQ     16
         2 000253   200012 756100                    STQ     @ERR_CODE+1,,AUTO
         2 000254   000002 236000 3                  LDQ     2
         2 000255   200011 756100                    STQ     TSTAMP+4,,AUTO
         2 000256   000641 701000 2                  TSX1    ERR_MSG
         2 000257   000000 011000                    NOP     0
         2 000260   000300 710000 2                  TRA     s:3217

      121     3212    2               ELSE
      122     3213    2                   IF KEYFILE_LOCK THEN

   3213  2 000261   200004 234100                    SZN     KEYFILE_LOCK,,AUTO
         2 000262   000272 605000 2                  TPL     s:3216

      123     3214    2                       CALL ERR_MSG(DBU#LCKD,'and its keyfile now unlocked@');

   3214  2 000263   000021 236000 3                  LDQ     17
         2 000264   200012 756100                    STQ     @ERR_CODE+1,,AUTO
         2 000265   000002 236000 3                  LDQ     2
         2 000266   200011 756100                    STQ     TSTAMP+4,,AUTO
         2 000267   000641 701000 2                  TSX1    ERR_MSG
         2 000270   000000 011000                    NOP     0
         2 000271   000300 710000 2                  TRA     s:3217

      124     3215    2                   ELSE
      125     3216    2                       CALL ERR_MSG(DBU#LCKD,'now unlocked@');

   3216  2 000272   000022 236000 3                  LDQ     18
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:28   
         2 000273   200012 756100                    STQ     @ERR_CODE+1,,AUTO
         2 000274   000002 236000 3                  LDQ     2
         2 000275   200011 756100                    STQ     TSTAMP+4,,AUTO
         2 000276   000641 701000 2                  TSX1    ERR_MSG
         2 000277   000000 011000                    NOP     0

      126     3217    2               IF KEYFILE_LOCK THEN

   3217  2 000300   200004 234100                    SZN     KEYFILE_LOCK,,AUTO
         2 000301   000310 605000 2                  TPL     s:3220

      127     3218    2                   CALL ERR_MSG(DBU#WARNLK);

   3218  2 000302   000024 236000 3                  LDQ     20
         2 000303   200012 756100                    STQ     @ERR_CODE+1,,AUTO
         2 000304   000025 236000 3                  LDQ     21
         2 000305   200011 756100                    STQ     TSTAMP+4,,AUTO
         2 000306   000641 701000 2                  TSX1    ERR_MSG
         2 000307   000000 011000                    NOP     0

      128     3219    2               END;

      129     3220    1       GOTO RET;

   3220  2 000310   000146 710000 2                  TRA     RET

      130     3221        %EJECT;
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:29   
      131     3222    1   ZIU$TESTLOCK: ENTRY ALTRET;

   3222  2 000311   000000 700200 xent  ZIU$TESTLOCK TSX0  ! X66_AUTO_0
         2 000312   000016 000000                    ZERO    14,0

      132     3223
      133     3224        /*D*
      134     3225            This routine checks if a database was locked.  If so, it sets
      135     3226            STEPCC=6.
      136     3227        */
      137     3228    1       DCBSF = ZI$DIR.AREA_NM.DCB#;

   3228  2 000313   000244 220000 xsym               LDX0    ZI$DIR+164
         2 000314   000000 740000 xsym               STX0    DCBSF

      138     3229    1       CALL OPEN_READ ALTRET(ALTRTN); /* open and read ALTBLK */

   3229  2 000315   000423 701000 2                  TSX1    OPEN_READ
         2 000316   000112 702000 2                  TSX2    ALTRTN

      139     3230    1       IF (~ ATBLK_PG.LOCK_STATUS.ALL_LOCKS OR

   3230  2 000317   000000 470400 xsym               LDP0    ATBLK$
         2 000320   000041 236100                    LDQ     33,,PR0
         2 000321   700000 376003                    ANQ     -32768,DU
         2 000322   700000 676003                    ERQ     -32768,DU
         2 000323   000335 601000 2                  TNZ     s:3230+14
         2 000324   000041 236100                    LDQ     33,,PR0
         2 000325   000001 736000                    QLS     1
         2 000326   400000 376003                    ANQ     -131072,DU
         2 000327   400000 676003                    ERQ     -131072,DU
         2 000330   000335 601000 2                  TNZ     s:3230+14
         2 000331   000041 236100                    LDQ     33,,PR0
         2 000332   400000 376003                    ANQ     -131072,DU
         2 000333   400000 676003                    ERQ     -131072,DU
         2 000334   000346 600000 2                  TZE     s:3238
         2 000335   000042 235100                    LDA     34,,PR0
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:30   
         2 000336   000346 601000 2                  TNZ     s:3238

      140     3231    1          ~ ATBLK_PG.STATUS.LOCKUPD OR
      141     3232    1          ~ ATBLK_PG.STATUS.LOCKED ) AND
      142     3233    1          ATBLK_PG.TIME_LOCKED = 0
      143     3234    2       THEN DO; /* it was unlocked */

      144     3235    2           CALL ERR_MSG(DBU#LCKD,'is unlocked@');

   3235  2 000337   000026 236000 3                  LDQ     22
         2 000340   200012 756100                    STQ     @ERR_CODE+1,,AUTO
         2 000341   000002 236000 3                  LDQ     2
         2 000342   200011 756100                    STQ     TSTAMP+4,,AUTO
         2 000343   000641 701000 2                  TSX1    ERR_MSG
         2 000344   000000 011000                    NOP     0

      145     3236    2           END;

   3236  2 000345   000401 710000 2                  TRA     s:3244

      146     3237    2       ELSE DO;

      147     3238    2           IF ZI$DIR.LOCKCODE = 2 OR ATBLK_PG.STATUS.LOCKUPD THEN

   3238  2 000346   000125 236000 xsym               LDQ     ZI$DIR+85
         2 000347   016000 376007                    ANQ     7168,DL
         2 000350   004000 116007                    CMPQ    2048,DL
         2 000351   000355 600000 2                  TZE     s:3239
         2 000352   000041 236100                    LDQ     33,,PR0
         2 000353   200000 316003                    CANQ    65536,DU
         2 000354   000363 600000 2                  TZE     s:3240

      148     3239    2               CALL ERR_MSG(DBU#LCKD,'is locked to update users@');

   3239  2 000355   000027 236000 3                  LDQ     23
         2 000356   200012 756100                    STQ     @ERR_CODE+1,,AUTO
         2 000357   000002 236000 3                  LDQ     2
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:31   
         2 000360   200011 756100                    STQ     TSTAMP+4,,AUTO
         2 000361   000641 701000 2                  TSX1    ERR_MSG
         2 000362   000000 011000                    NOP     0

      149     3240    2           IF ATBLK_PG.STATUS.LOCKED OR ATBLK_PG.STATUS.KFILE_CURR THEN

   3240  2 000363   000000 470400 xsym               LDP0    ATBLK$
         2 000364   000041 234100                    SZN     33,,PR0
         2 000365   000371 604000 2                  TMI     s:3241
         2 000366   000041 236100                    LDQ     33,,PR0
         2 000367   100000 316003                    CANQ    32768,DU
         2 000370   000377 600000 2                  TZE     s:3242

      150     3241    2               CALL ERR_MSG(DBU#LCKD,'is locked to all access@');

   3241  2 000371   000030 236000 3                  LDQ     24
         2 000372   200012 756100                    STQ     @ERR_CODE+1,,AUTO
         2 000373   000002 236000 3                  LDQ     2
         2 000374   200011 756100                    STQ     TSTAMP+4,,AUTO
         2 000375   000641 701000 2                  TSX1    ERR_MSG
         2 000376   000000 011000                    NOP     0

      151     3242    2           STEPCC = 6; /* Set STEPCC to 6 before exit. */

   3242  2 000377   000006 235007                    LDA     6,DL
         2 000400   000000 755000 xsym               STA     STEPCC

      152     3243    2           END;

      153     3244    1       GOTO RET;

   3244  2 000401   000146 710000 2                  TRA     RET

      154     3245
      155     3246        %EJECT;
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:32   
      156     3247
      157     3248    1   ZIU$KFILE: ENTRY ALTRET; /* RESET KEYFILE TO OFF */

   3248  2 000402   000000 700200 xent  ZIU$KFILE    TSX0  ! X66_AUTO_0
         2 000403   000016 000000                    ZERO    14,0

      158     3249
      159     3250    1       DCBSF = ZI$DIR.AREA_NM.DCB#;

   3250  2 000404   000244 220000 xsym               LDX0    ZI$DIR+164
         2 000405   000000 740000 xsym               STX0    DCBSF

      160     3251    1       CALL OPEN_READ ALTRET(ALTRTN);

   3251  2 000406   000423 701000 2                  TSX1    OPEN_READ
         2 000407   000112 702000 2                  TSX2    ALTRTN

      161     3252    1       IF ATBLK_PG.STATUS.KFILE_CURR THEN

   3252  2 000410   000000 470400 xsym               LDP0    ATBLK$
         2 000411   000041 236100                    LDQ     33,,PR0
         2 000412   100000 316003                    CANQ    32768,DU
         2 000413   000422 600000 2                  TZE     s:3258

      162     3253    2       DO;

      163     3254    2           ATBLK_PG.STATUS.KFILE_CURR='0'B;

   3254  2 000414   000015 236000 3                  LDQ     13
         2 000415   000041 356100                    ANSQ    33,,PR0

      164     3255    2           ATBLK_PG.REASON_LOCKED.LOAD_MODE='0'B;

   3255  2 000416   000016 236000 3                  LDQ     14
         2 000417   000043 356100                    ANSQ    35,,PR0

      165     3256    2           CALL WRITE_ATRIB ALTRET(ALTRTN);
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:33   

   3256  2 000420   000572 701000 2                  TSX1    WRITE_ATRIB
         2 000421   000112 702000 2                  TSX2    ALTRTN

      166     3257    2           END;

      167     3258    1       GOTO RET; /* THIS SUB ENTERED FROM REBUILD KEY */

   3258  2 000422   000146 710000 2                  TRA     RET

      168     3259
      169     3260        %EJECT;
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:34   
      170     3261
      171     3262    1   OPEN_READ: PROC ALTRET; /* INTERNAL SUBR: OPEN AND READ ATRIB */

   3262  2 000423   200006 741300       OPEN_READ    STX1  ! TSTAMP+1,,AUTO

      172     3263
      173     3264    2       AREA_OPENED = DCBADDR(DCBSF)->F$DCB.FCD#;

   3264  2 000424   000006 470400 3                  LDP0    6
         2 000425   000000 471500                    LDP1    0,,PR0
         2 000426   000000 220000 xsym               LDX0    DCBSF
         2 000427   100000 473510                    LDP3    0,X0,PR1
         2 000430   300031 236100                    LDQ     25,,PR3
         2 000431   000026 736000                    QLS     22
         2 000432   400000 376003                    ANQ     -131072,DU
         2 000433   200003 756100                    STQ     AREA_OPENED,,AUTO

      174     3265    2       IF (ZI$DIR.CODE=#LOCK OR ZI$DIR.CODE=#UNLOCK) AND

   3265  2 000434   000125 236000 xsym               LDQ     ZI$DIR+85
         2 000435   000010 376000 3                  ANQ     8
         2 000436   000011 116000 3                  CMPQ    9
         2 000437   000442 600000 2                  TZE     s:3265+6
         2 000440   000012 116000 3                  CMPQ    10
         2 000441   000457 601000 2                  TNZ     s:3272
         2 000442   000237 235000 xsym               LDA     UWA+159
         2 000443   000457 604400 2                  TMOZ    s:3272

      175     3266    2          UWA.AC_REC.PG_TYPE>0 THEN /* INDEX AREA */
      176     3267    3       DO; /* CANNOT BE LOCKED OR UNLOCKED */

      177     3268    3           ERR_INSERT(0)=ZI$DIR.AREA_NM.NAME;

   3268  2 000444   000000 100400                    MLR     fill='000'O
         2 000445   000234 000037 xsym               ADSC9   ZI$DIR+156               cn=0,n=31
         2 000446   000000 000037 xsym               ADSC9   ERR_INSERT               cn=0,n=31

PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:35   
      178     3269    3           CALL ERR_MSG(DBU#ERR_LK);

   3269  2 000447   000024 236000 3                  LDQ     20
         2 000450   200012 756100                    STQ     @ERR_CODE+1,,AUTO
         2 000451   000032 236000 3                  LDQ     26
         2 000452   200011 756100                    STQ     TSTAMP+4,,AUTO
         2 000453   000641 701000 2                  TSX1    ERR_MSG
         2 000454   000000 011000                    NOP     0

      179     3270    3           ALTRETURN;

   3270  2 000455   200006 221300                    LDX1  ! TSTAMP+1,,AUTO
         2 000456   000000 702211                    TSX2  ! 0,X1

      180     3271    3           END;
      181     3272    2       IF ~AREA_OPENED THEN

   3272  2 000457   200003 236100                    LDQ     AREA_OPENED,,AUTO
         2 000460   400000 376003                    ANQ     -131072,DU
         2 000461   400000 676003                    ERQ     -131072,DU
         2 000462   000502 600000 2                  TZE     s:3283

      182     3273    3       DO; /* SAVE OPEN STATUS, BE USED TO DETERMINE CLOSE OR NOT */

      183     3274    3           SHARESF = %NONE#;

   3274  2 000463   600000 236003                    LDQ     -65536,DU
         2 000464   000000 756000 xsym               STQ     SHARESF

      184     3275    3           ORGSF = %IDS#;

   3275  2 000465   000007 235007                    LDA     7,DL
         2 000466   000000 755000 xsym               STA     ORGSF

      185     3276    3           ACSSF = %DIRECT#;

   3276  2 000467   000002 235007                    LDA     2,DL
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:36   
         2 000470   000000 755000 xsym               STA     ACSSF

      186     3277    3           ASNSF = %FILE#;

   3277  2 000471   000001 235007                    LDA     1,DL
         2 000472   000000 755000 xsym               STA     ASNSF

      187     3278    3           FUNSF = %UPDATE#;

   3278  2 000473   000000 755000 xsym               STA     FUNSF

      188     3279    3           FIDSF = ZI$DIR.AREA_NM.NAME.TEXT;

   3279  2 000474   040000 100400                    MLR     fill='040'O
         2 000475   000234 200036 xsym               ADSC9   ZI$DIR+156               cn=1,n=30
         2 000476   000000 000036 xsym               ADSC9   FIDSF_RD                 cn=0,n=30

      189     3280    3           CALL SYS_FUNC_OPEN ALTRET(ALTRTN);

   3280  2 000477   000007 631400 3                  EPPR1   7
         2 000500   000000 701000 xent               TSX1    SYS_FUNC_OPEN
         2 000501   000570 702000 2                  TSX2    ALTRTN

      190     3281    3           END;

      191     3282
      192     3283    2       IF DCBADDR(DCBSF)->F$DCB.ORG#~=%IDS# THEN

   3283  2 000502   000006 470400 3                  LDP0    6
         2 000503   000000 471500                    LDP1    0,,PR0
         2 000504   000000 220000 xsym               LDX0    DCBSF
         2 000505   100000 473510                    LDP3    0,X0,PR1
         2 000506   300032 236100                    LDQ     26,,PR3
         2 000507   777000 376003                    ANQ     -512,DU
         2 000510   007000 116003                    CMPQ    3584,DU
         2 000511   000522 600000 2                  TZE     s:3288

PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:37   
      193     3284    3       DO;

      194     3285    3           CALL ERR_MSG(DBU#CHKIDSREP);

   3285  2 000512   000024 236000 3                  LDQ     20
         2 000513   200012 756100                    STQ     @ERR_CODE+1,,AUTO
         2 000514   000034 236000 3                  LDQ     28
         2 000515   200011 756100                    STQ     TSTAMP+4,,AUTO
         2 000516   000641 701000 2                  TSX1    ERR_MSG
         2 000517   000000 011000                    NOP     0

      195     3286    3           ALTRETURN;

   3286  2 000520   200006 221300                    LDX1  ! TSTAMP+1,,AUTO
         2 000521   000000 702211                    TSX2  ! 0,X1

      196     3287    3           END;
      197     3288    2       BUFSF = VECTOR(I_O_BUF(0));

   3288  2 000522   000035 235000 3                  LDA     29
         2 000523   000000 236000 xsym               LDQ     I_O_BUF$
         2 000524   000000 755000 xsym               STA     BUFSF
         2 000525   000001 756000 xsym               STQ     BUFSF+1

      198     3289    2       BUFLNSF = 4096;

   3289  2 000526   010000 235007                    LDA     4096,DL
         2 000527   000000 755000 xsym               STA     BUFLNSF

      199     3290    2       FULLSF = %YES#;

   3290  2 000530   400000 236003                    LDQ     -131072,DU
         2 000531   000000 756000 xsym               STQ     FULLSF

      200     3291    2       WAITSF = %YES#;

   3291  2 000532   000000 756000 xsym               STQ     WAITSF
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:38   

      201     3292    2       ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;

   3292  2 000533   000027 236000 xsym               LDQ     ZI$DIR+23
         2 000534   000000 756000 xsym               STQ     ENCRP_SEEDSF

      202     3293    2       KEYSF = %YES#;

   3293  2 000535   400000 236003                    LDQ     -131072,DU
         2 000536   000000 756000 xsym               STQ     KEYSF

      203     3294    2       KEYVSF.IDSKEY = 0;

   3294  2 000537   000000 100400                    MLR     fill='000'O
         2 000540   000007 000004 3                  ADSC9   7                        cn=0,n=4
         2 000541   000000 200004 xsym               ADSC9   KEYVSF                   cn=1,n=4

      204     3295    2       CALL SYS_FUNC_READ ALTRET(ALTRTN);

   3295  2 000542   000007 631400 3                  EPPR1   7
         2 000543   000000 701000 xent               TSX1    SYS_FUNC_READ
         2 000544   000570 702000 2                  TSX2    ALTRTN

      205     3296    2       ATBLK$ = ADDR(I_O_BUF(0));

   3296  2 000545   000000 236000 xsym               LDQ     I_O_BUF$
         2 000546   000000 756000 xsym               STQ     ATBLK$

      206     3297    2       TSTAMPSF = VECTOR(TSTAMP);

   3297  2 000547   777640 235007                    LDA     -96,DL
         2 000550   200014 452500                    STP2    LEN+1,,AUTO
         2 000551   200014 236100                    LDQ     LEN+1,,AUTO
         2 000552   000005 036003                    ADLQ    5,DU
         2 000553   000000 755000 xsym               STA     TSTAMPSF
         2 000554   000001 756000 xsym               STQ     TSTAMPSF+1

PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:39   
      207     3298    2       DATESF = VECTOR(NIL);

   3298  2 000555   000036 237000 3                  LDAQ    30
         2 000556   000000 755000 xsym               STA     DATESF
         2 000557   000001 756000 xsym               STQ     DATESF+1

      208     3299    2       SOURCESF = %CLOCK#;

   3299  2 000560   000000 450000 xsym               STZ     SOURCESF

      209     3300    2       DESTSF = %UTS#;

   3300  2 000561   000004 235007                    LDA     4,DL
         2 000562   000000 755000 xsym               STA     DESTSF

      210     3301    2       CALL SYS_FUNC_TSTAMP;

   3301  2 000563   000007 631400 3                  EPPR1   7
         2 000564   000000 701000 xent               TSX1    SYS_FUNC_TSTAMP
         2 000565   000000 011000                    NOP     0

      211     3302    2       RETURN;

   3302  2 000566   200006 221300                    LDX1  ! TSTAMP+1,,AUTO
         2 000567   000001 702211                    TSX2  ! 1,X1

      212     3303
      213     3304    2   ALTRTN: ALTRETURN;

   3304  2 000570   200006 221300       ALTRTN       LDX1  ! TSTAMP+1,,AUTO
         2 000571   000000 702211                    TSX2  ! 0,X1

      214     3305    2   END OPEN_READ;
      215     3306        %EJECT;
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:40   
      216     3307
      217     3308    1   WRITE_ATRIB: PROC ALTRET;

   3308  2 000572   200006 741300       WRITE_ATRIB  STX1  ! TSTAMP+1,,AUTO

      218     3309
      219     3310    2       IF ATBLK_PG.MISC_INFO.CHKSM THEN

   3310  2 000573   000000 470400 xsym               LDP0    ATBLK$
         2 000574   000030 236100                    LDQ     24,,PR0
         2 000575   200000 316003                    CANQ    65536,DU
         2 000576   000607 600000 2                  TZE     s:3316

      220     3311    3       DO;

      221     3312    3           DATA$ = ATBLK$;

   3312  2 000577   000000 236000 xsym               LDQ     ATBLK$
         2 000600   000000 756000 xsym               STQ     DATA$

      222     3313    3           CALL CHKSUM;

   3313  2 000601   000007 631400 3                  EPPR1   7
         2 000602   000000 701000 xent               TSX1    CHKSUM
         2 000603   000000 011000                    NOP     0

      223     3314    3           DATA_PG.CHKSUM_WD = ICHKSUM;

   3314  2 000604   000000 470400 xsym               LDP0    DATA$
         2 000605   000000 235000 xsym               LDA     ICHKSUM
         2 000606   000002 755100                    STA     2,,PR0

      224     3315    3           END;

      225     3316    2       DCBSF = ZI$DIR.AREA_NM.DCB#;

   3316  2 000607   000244 220000 xsym               LDX0    ZI$DIR+164
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:41   
         2 000610   000000 740000 xsym               STX0    DCBSF

      226     3317    2       BUFSF = VECTOR(I_O_BUF(0));

   3317  2 000611   000035 235000 3                  LDA     29
         2 000612   000000 236000 xsym               LDQ     I_O_BUF$
         2 000613   000000 755000 xsym               STA     BUFSF
         2 000614   000001 756000 xsym               STQ     BUFSF+1

      227     3318    2       BUFLNSF = 4096;

   3318  2 000615   010000 235007                    LDA     4096,DL
         2 000616   000000 755000 xsym               STA     BUFLNSF

      228     3319    2       FULLSF = %YES#;

   3319  2 000617   400000 236003                    LDQ     -131072,DU
         2 000620   000000 756000 xsym               STQ     FULLSF

      229     3320    2       WAITSF = %YES#;

   3320  2 000621   000000 756000 xsym               STQ     WAITSF

      230     3321    2       VFCSF = %NO#;

   3321  2 000622   000000 450000 xsym               STZ     VFCSF

      231     3322    2       ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;

   3322  2 000623   000027 236000 xsym               LDQ     ZI$DIR+23
         2 000624   000000 756000 xsym               STQ     ENCRP_SEEDSF

      232     3323    2       KEYSF = %YES#;

   3323  2 000625   400000 236003                    LDQ     -131072,DU
         2 000626   000000 756000 xsym               STQ     KEYSF

PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:42   
      233     3324    2       KEYVSF.IDSKEY = 0;

   3324  2 000627   000000 100400                    MLR     fill='000'O
         2 000630   000007 000004 3                  ADSC9   7                        cn=0,n=4
         2 000631   000000 200004 xsym               ADSC9   KEYVSF                   cn=1,n=4

      234     3325    2       CALL SYS_FUNC_WRIT ALTRET(ALTRTN);

   3325  2 000632   000007 631400 3                  EPPR1   7
         2 000633   000000 701000 xent               TSX1    SYS_FUNC_WRIT
         2 000634   000637 702000 2                  TSX2    ALTRTN

      235     3326
      236     3327    2       RETURN;

   3327  2 000635   200006 221300                    LDX1  ! TSTAMP+1,,AUTO
         2 000636   000001 702211                    TSX2  ! 1,X1

      237     3328
      238     3329    2   ALTRTN: ALTRETURN;

   3329  2 000637   200006 221300       ALTRTN       LDX1  ! TSTAMP+1,,AUTO
         2 000640   000000 702211                    TSX2  ! 0,X1

      239     3330    2   END WRITE_ATRIB;
      240     3331        %EJECT;
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:43   
      241     3332
      242     3333    1   ERR_MSG: PROC(ERR_CODE,U1);

   3333  2 000641   200010 741300       ERR_MSG      STX1  ! TSTAMP+3,,AUTO

      243     3334
      244     3335    2   DCL ERR_CODE SBIN ALIGNED;
      245     3336    2   DCL U1 CHAR(LEN) CALIGNED;
      246     3337    2   DCL LEN SBIN;
      247     3338
      248     3339    2       ERRCODESF.ERR# = ERR_CODE;

   3339  2 000642   200011 470500                    LDP0    @ERR_CODE,,AUTO
         2 000643   000000 236100                    LDQ     0,,PR0
         2 000644   000003 736000                    QLS     3
         2 000645   000000 676000 xsym               ERQ     ERRCODESF
         2 000646   377770 376007                    ANQ     131064,DL
         2 000647   000000 656000 xsym               ERSQ    ERRCODESF

      249     3340    2       MSGCODE =ERRCODE_RDEF;

   3340  2 000650   000000 235000 xsym               LDA     ERRCODESF
         2 000651   000000 755000 xsym               STA     MSGCODE

      250     3341    2       ERRFLGSF = 1;

   3341  2 000652   001000 236003                    LDQ     512,DU
         2 000653   000000 756000 xsym               STQ     ERRFLGSF

      251     3342    2       IF ERR_CODE=DBU#WARNLK THEN

   3342  2 000654   000000 235100                    LDA     0,,PR0
         2 000655   022013 115007                    CMPA    9227,DL
         2 000656   000660 601000 2                  TNZ     s:3344

      252     3343    2           ERRFLGSF = 0; /* NO STAR FOR WARNING KEYFILE NOT REBUILT */

PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:44   
   3343  2 000657   000000 450000 xsym               STZ     ERRFLGSF

      253     3344    2       IF ADDR(U1)~=ADDR(NIL) THEN

   3344  2 000660   200012 236100                    LDQ     @U1,,AUTO
         2 000661   000024 116000 3                  CMPQ    20
         2 000662   000702 600000 2                  TZE     s:3351

      254     3345    3       DO;

      255     3346    3           LEN=31;

   3346  2 000663   000037 235007                    LDA     31,DL
         2 000664   200013 755100                    STA     LEN,,AUTO

      256     3347    3           CALL INDEX(LEN,'@',U1);

   3347  2 000665   200012 471500                    LDP1    @U1,,AUTO
         2 000666   000000 620005                    EAX0    0,AL
         2 000667   000000 124540                    SCM     mask='000'O
         2 000670   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         2 000671   000040 000001 3                  ADSC9   32                       cn=0,n=1
         2 000672   200013 000100                    ARG     LEN,,AUTO

      257     3348    3           ERR_INSERT.CNT(0)=LEN;

   3348  2 000673   200013 236100                    LDQ     LEN,,AUTO
         2 000674   000033 736000                    QLS     27
         2 000675   000000 552040 xsym               STBQ    ERR_INSERT,'40'O

      258     3349    3           ERR_INSERT.TEXT(0)=U1;

   3349  2 000676   200013 720100                    LXL0    LEN,,AUTO
         2 000677   040000 100540                    MLR     fill='040'O
         2 000700   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         2 000701   000000 200036 xsym               ADSC9   ERR_INSERT               cn=1,n=30

PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:45   
      259     3350    3           END;

      260     3351    2       CALL SYS_FUNC_ERRMSG;

   3351  2 000702   000007 631400 3                  EPPR1   7
         2 000703   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         2 000704   000000 011000                    NOP     0

      261     3352    2   END ERR_MSG;

   3352  2 000705   200010 221300                    LDX1  ! TSTAMP+3,,AUTO
         2 000706   000001 702211                    TSX2  ! 1,X1

(unnamed)
 Sect OctLoc
   1     000   141154 162145   141144 171040   154157 143153   145144 040164    already locked t
   1     004   157040 165160   144141 164145   040165 163145   162163 100040    o update users@
   1     010   141154 162145   141144 171040   154157 143153   145144 040146    already locked f
   1     014   162157 155040   141154 154040   141143 143145   163163 100040    rom all access@
   1     020   156157 167040   154157 143153   145144 040050   164157 040165    now locked (to u
   1     024   160144 141164   145040 165163   145162 163051   100040 040040    pdate users)@
   1     030   156157 167040   154157 143153   145144 100040   141154 162145    now locked@ alre
   1     034   141144 171040   153145 171146   151154 145055   165156 154157    ady keyfile-unlo
   1     040   143153 145144   100040 040040   141154 162145   141144 171040    cked@   already
   1     044   165156 154157   143153 145144   100040 040040   156157 167040    unlocked@   now
   1     050   153145 171146   151154 145055   165156 154157   143153 145144    keyfile-unlocked
   1     054   100040 040040   141156 144040   151164 163040   153145 171146    @   and its keyf
   1     060   151154 145040   156157 167040   165156 154157   143153 145144    ile now unlocked
   1     064   100040 040040   151163 040165   156154 157143   153145 144100    @   is unlocked@
   1     070   151163 040154   157143 153145   144040 164157   040165 160144    is locked to upd
   1     074   141164 145040   165163 145162   163100 040040   151163 040154    ate users@  is l
   1     100   157143 153145   144040 164157   040141 154154   040141 143143    ocked to all acc
   1     104   145163 163100                                                    ess@

(unnamed)
 Sect OctLoc
   3     000   000000 021521   000000 006000   000000 006000   000010 006000    ................
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:46   
   3     004   000020 006000   000030 006000   000000 006003   000000 000000    ................
   3     010   000007 600000   000002 400000   000002 600000   000033 006000    ................
   3     014   000042 006000   677777 777777   577777 777777   077777 777777    ."..........?...
   3     020   000047 006000   000055 006000   000061 006000   000000 022013    .'...-...1......
   3     024   000000 006014   000023 006000   000065 006000   000070 006000    .........5...8..
   3     030   000077 006000   000000 021713   000031 006000   000000 021676    .?..............
   3     034   000033 006000   001777 777640   000000 177640   000000 006014    ................
   3     040   100040 040040                                                    @
      262     3353    1   END ZIU$STATUS;
      263     3354        %EOD;

PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:47   
--  Include file information  --

   ZI_ERRORS_SUBS.:ZIC0TOU  is referenced.
   ZI_PRSE_SUBS.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   ZI_GLOBAL_DBUTIL.:ZIC0TOU  is referenced.
   ZI$DIR.:ZIC0TOU  is referenced.
   ZI$PG_STRUCTS.:ZIC0TOU  is referenced.
   ZI_UWA_C.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIU$STATUS.

   Procedure ZIU$STATUS requires 455 words for executable code.
   Procedure ZIU$STATUS requires 14 words of local(AUTO) storage.
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:48   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:49   
          MINI XREF LISTING

ACSSF
      1725**DCL      3276<<ASSIGN
ALTRTN
      3173**LABEL    3144--CALLALT  3165--CALLALT  3190--CALLALT  3209--CALLALT  3229--CALLALT  3251--CALLALT
      3256--CALLALT
ALTRTN IN PROCEDURE OPEN_READ
      3304**LABEL    3280--CALLALT  3295--CALLALT
ALTRTN IN PROCEDURE WRITE_ATRIB
      3329**LABEL    3325--CALLALT
AREA_OPENED
        14**DCL      3174>>IF       3182>>IF       3264<<ASSIGN   3272>>IF
ASNSF
      1728**DCL      3277<<ASSIGN
ATBLK$
      1153**DCL      1154--IMP-PTR  3146>>IF       3152>>IF       3152>>IF       3159>>ASSIGN   3160>>ASSIGN
      3162>>ASSIGN   3164>>ASSIGN   3192>>ASSIGN   3196>>IF       3202>>ASSIGN   3203>>ASSIGN   3206>>ASSIGN
      3207>>IF       3208>>ASSIGN   3230>>IF       3230>>IF       3230>>IF       3230>>IF       3238>>IF
      3240>>IF       3240>>IF       3252>>IF       3254>>ASSIGN   3255>>ASSIGN   3296<<ASSIGN   3310>>IF
      3312>>ASSIGN
ATBLK_PG.AREA_NM
      1179**DCL      1180--REDEF
ATBLK_PG.LOCK_STATUS.ALL_LOCKS
      1197**DCL      3196>>IF       3206<<ASSIGN   3207>>IF       3230>>IF
ATBLK_PG.MISC_INFO.CHKSM
      1184**DCL      3310>>IF
ATBLK_PG.REASON_LOCKED.BY_USER
      1201**DCL      3160<<ASSIGN
ATBLK_PG.REASON_LOCKED.LOAD_MODE
      1202**DCL      3203<<ASSIGN   3255<<ASSIGN
ATBLK_PG.STATUS
      1188**DCL      1196--REDEF
ATBLK_PG.STATUS.KFILE_CURR
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:50   
      1191**DCL      3152>>IF       3192>>ASSIGN   3202<<ASSIGN   3240>>IF       3252>>IF       3254<<ASSIGN
ATBLK_PG.STATUS.LOCKED
      1189**DCL      3152>>IF       3164<<ASSIGN   3230>>IF       3240>>IF
ATBLK_PG.STATUS.LOCKUPD
      1190**DCL      3146>>IF       3162<<ASSIGN   3230>>IF       3238>>IF
ATBLK_PG.TIME_LOCKED
      1199**DCL      3159<<ASSIGN   3208<<ASSIGN   3230>>IF
BUFLNSF
      1736**DCL      3289<<ASSIGN   3318<<ASSIGN
BUFSF
      1737**DCL      3288<<ASSIGN   3317<<ASSIGN
CHKSUM
        17**DCL-ENT  3313--CALL
COUNTSF
      1787**DCL      1788--REDEF
DATA$
      1209**DCL      1210--IMP-PTR  3312<<ASSIGN   3314>>ASSIGN
DATA_PG.ACT_DATA
      1222**DCL      1223--REDEF    1224--REDEF    1225--REDEF
DATA_PG.CHKSUM_WD
      1214**DCL      3314<<ASSIGN
DATESF
      1740**DCL      3298<<ASSIGN
DCBSF
      1716**DCL      3143<<ASSIGN   3173<<ASSIGN   3174--IF       3181<<ASSIGN   3189<<ASSIGN   3228<<ASSIGN
      3250<<ASSIGN   3264--ASSIGN   3283--IF       3316<<ASSIGN
DESTSF
      1739**DCL      3300<<ASSIGN
ENCRP_SEEDSF
      1745**DCL      1746--REDEF    3292<<ASSIGN   3322<<ASSIGN
ERRCODESF
      1747**DCL      1752--REDEF
ERRCODESF.ERR#
      1750**DCL      3339<<ASSIGN
ERRCODE_RDEF
      1752**DCL      3340>>ASSIGN
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:51   
ERRFLGSF
      1776**DCL      3341<<ASSIGN   3343<<ASSIGN
ERR_CODE IN PROCEDURE ERR_MSG
      3335**DCL      3333--PROC     3339>>ASSIGN   3342>>IF
ERR_INSERT
      1760**DCL      3268<<ASSIGN
ERR_INSERT.CNT
      1761**DCL      3348<<ASSIGN
ERR_INSERT.TEXT
      1762**DCL      3349<<ASSIGN
ERR_MSG
      3333**PROC     3148--CALL     3154--CALL     3167--CALL     3169--CALL     3194--CALL     3197--CALL
      3211--CALL     3214--CALL     3216--CALL     3218--CALL     3235--CALL     3239--CALL     3241--CALL
      3269--CALL     3285--CALL
F$DCB.ACTPOS
      2425**DCL      2425--REDEF
F$DCB.ARS#
      2399**DCL      2399--REDEF
F$DCB.ATTR
      2418**DCL      2419--REDEF
F$DCB.BORROW
      2433**DCL      2433--REDEF    2433--REDEF    2433--REDEF
F$DCB.DCBNAME.L
      2447**DCL      2447--IMP-SIZ
F$DCB.EOMCHAR#
      2403**DCL      2403--REDEF
F$DCB.FCD#
      2412**DCL      3174>>IF       3264>>ASSIGN
F$DCB.FLDID
      2428**DCL      2428--REDEF
F$DCB.FORM$
      2422**DCL      2422--REDEF
F$DCB.FSECT
      2438**DCL      2438--REDEF
F$DCB.FSN#
      2415**DCL      2415--REDEF    2415--REDEF    2416--REDEF
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:52   
F$DCB.HEADER$
      2421**DCL      2421--REDEF
F$DCB.IXTNSIZE#
      2419**DCL      2419--REDEF
F$DCB.LASTSTA$
      2408**DCL      2408--REDEF
F$DCB.LVL
      2434**DCL      2434--REDEF
F$DCB.NAME#.C
      2409**DCL      2409--REDEF
F$DCB.NOEOF
      2431**DCL      2431--REDEF
F$DCB.NRECS#
      2420**DCL      2420--REDEF
F$DCB.NRECX
      2439**DCL      2439--REDEF
F$DCB.OHDR
      2431**DCL      2431--REDEF
F$DCB.ORG#
      2414**DCL      2414--REDEF    3283>>IF
F$DCB.PRECNO
      2437**DCL      2437--REDEF
F$DCB.RCSZ
      2443**DCL      2443--REDEF
F$DCB.RES#
      2410**DCL      2410--REDEF
F$DCB.SETX
      2422**DCL      2422--REDEF
F$DCB.TAB$
      2422**DCL      2422--REDEF
F$DCB.TDA
      2436**DCL      2437--REDEF
F$DCB.WSN#
      2410**DCL      2410--REDEF
FIDSF
      1764**DCL      3279<<ASSIGN
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:53   
FIDSF_RD
      1763**DCL      1764--REDEF
FULLSF
      1734**DCL      3290<<ASSIGN   3319<<ASSIGN
FUNSF
      1727**DCL      3278<<ASSIGN
HELPCODE
      1781**DCL      1786--REDEF
ICHKSUM
      1846**DCL      1847--REDEF    3314>>ASSIGN
I_O_BUF
      1825**DCL      3288--ASSIGN   3296--ASSIGN   3317--ASSIGN
I_O_BUF$
      1824**DCL      1825--IMP-PTR  3288>>ASSIGN   3296>>ASSIGN   3317>>ASSIGN
KEYFILE_LOCK
        15**DCL      3192<<ASSIGN   3193>>IF       3213>>IF       3217>>IF
KEYSF
      1718**DCL      3293<<ASSIGN   3323<<ASSIGN
KEYVSF
      1719**DCL      1724--REDEF
KEYVSF.IDSKEY
      1722**DCL      3294<<ASSIGN   3324<<ASSIGN
KEYVSF.WD_ONE
      1721**DCL      1722--REDEF
LEN IN PROCEDURE ERR_MSG
      3337**DCL      3336--IMP-SIZ  3346<<ASSIGN   3347<<CALLBLT  3347>>CALLBLT  3348>>ASSIGN   3349>>ASSIGN
MSGCODE
      1753**DCL      1754--REDEF    3340<<ASSIGN
OPEN_READ
      3262**PROC     3144--CALL     3190--CALL     3229--CALL     3251--CALL
ORGSF
      1717**DCL      3275<<ASSIGN
REC$
      1805**DCL      1828--IMP-PTR
REC_DATA_LN
      1833**DCL      1832--IMP-SIZ
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:54   
RET
      3181**LABEL    3171--GOTO     3220--GOTO     3244--GOTO     3258--GOTO
SHARESF
      1767**DCL      3274<<ASSIGN
SOURCESF
      1738**DCL      3299<<ASSIGN
STEPCC
      1823**DCL      3149<<ASSIGN   3155<<ASSIGN   3242<<ASSIGN
SYS_FUNC_CLOS
      3129**DCL-ENT  3175--CALL     3183--CALL
SYS_FUNC_ERRMSG
      3130**DCL-ENT  3351--CALL
SYS_FUNC_OPEN
      3126**DCL-ENT  3280--CALL
SYS_FUNC_READ
      3127**DCL-ENT  3295--CALL
SYS_FUNC_TSTAMP
        18**DCL-ENT  3301--CALL
SYS_FUNC_WRIT
      3128**DCL-ENT  3325--CALL
TSTAMP
        16**DCL      3159>>ASSIGN   3297--ASSIGN
TSTAMPSF
      1744**DCL      3297<<ASSIGN
U1 IN PROCEDURE ERR_MSG
      3336**DCL      3333--PROC     3344--IF       3347>>CALLBLT  3349>>ASSIGN
UWA.AC_REC.CALC_NEXT
       825**DCL       826--REDEF
UWA.AC_REC.CALC_PRIOR
       834**DCL       835--REDEF
UWA.AC_REC.DEFAULTS
       783**DCL       784--REDEF
UWA.AC_REC.FILE_CODE
       788**DCL       789--REDEF
UWA.AC_REC.FLAG1.ERROR_TYPE
       785**DCL       786--REDEF
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:55   
UWA.AC_REC.PG_TYPE
       800**DCL       801--REDEF    3176>>IF       3265>>IF
UWA.AD_REC.ADDATE
       765**DCL       766--REDEF
VFCSF
      1733**DCL      3321<<ASSIGN
WAITSF
      1732**DCL      3291<<ASSIGN   3320<<ASSIGN
WRITE_ATRIB
      3308**PROC     3165--CALL     3209--CALL     3256--CALL
ZI$DIR.ALTKEY
      1456**DCL      1457--REDEF    1458--REDEF
ZI$DIR.AREAFID
      1422**DCL      1423--REDEF
ZI$DIR.AREA_NM.DCB#
      1489**DCL      3143>>ASSIGN   3173>>ASSIGN   3181>>ASSIGN   3189>>ASSIGN   3228>>ASSIGN   3250>>ASSIGN
      3316>>ASSIGN
ZI$DIR.AREA_NM.NAME
      1486**DCL      3268>>ASSIGN
ZI$DIR.AREA_NM.NAME.TEXT
      1488**DCL      3279>>ASSIGN
ZI$DIR.AUTODUMP
      1409**DCL      3176>>IF
ZI$DIR.CODE
      1438**DCL      3176>>IF       3176>>IF       3265>>IF       3265>>IF
ZI$DIR.DATE
      1461**DCL      1465--REDEF
ZI$DIR.DEST_SEED
      1417**DCL      1418--REDEF    1419--REDEF
ZI$DIR.ENCP_SEED
      1414**DCL      1415--REDEF    1416--REDEF    3292>>ASSIGN   3322>>ASSIGN
ZI$DIR.LOCKCODE
      1442**DCL      3146>>IF       3161>>IF       3166>>IF       3193>>IF       3196>>IF       3200>>IF
      3210>>IF       3238>>IF
ZI$DIR.REPRT_ZERO
      1448**DCL      1449--REDEF
PL6.E3A0      #001=ZIU$STATUS File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:56   
ZI$DIR.SCHFID
      1420**DCL      1421--REDEF
ZI$DIR.TIME
      1466**DCL      1471--REDEF

PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:57   
      264        1        /*T***********************************************************/
      265        2        /*T*                                                         */
      266        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      267        4        /*T*                                                         */
      268        5        /*T***********************************************************/
      269        6        /*
      270        7              ZIU$SYSCTL - CALL M$YC, PASS COMMAND TO IBEX
      271        8        */
      272        9        ZIU$SYSCTL: PROC ALTRET;
      273       10
      274       11    1   DCL RBUF CHAR(256) SYMREF;
      275       12    1   DCL PRINT_HDR BIT(1) SYMREF UNAL;
      276       13    1   DCL INITIAL_CALL BIT(1) SYMREF ALIGNED;
      277       14    1   DCL CURR_SCHNM CHAR(30) SYMREF CALIGNED;
      278       15    1   DCL READ_SW SBIN SYMREF;
      279       16
      280       17    1   DCL SYS_FUNC_CORRES ENTRY(2) ALTRET;
      281       18    1   DCL SYS_FUNC_CLOS ENTRY ALTRET;
      282       19    1   DCL SYS_FUNC_OPEN ENTRY ALTRET;
      283       20    1   DCL SYS_FUNC_ERRMSG ENTRY ALTRET;
      284       21    1   DCL DB_FUNC_FIN ENTRY ALTRET;
      285       22    1   DCL M$DO DCB;
      286       23    1   DCL SI_DCB UBIN HALF SYMREF HALIGNED;
      287       24    1   DCL LO_DCB UBIN HALF SYMREF HALIGNED;
      288       25    1   DCL UC_DCB UBIN HALF SYMREF HALIGNED;
      289       26    1   DCL DO_DCB UBIN HALF STATIC HALIGNED INIT(DCBNUM(M$DO));
      290       27
      291       28        %INCLUDE ZI$DIR;
      292      185         %DIR;
      293      329        %INCLUDE ZI_GLOBAL_DBUTIL;
      294      507         %SYS_FUNC;
      295      599         %MISC_DCLS;
      296      652
      297      653        %INCLUDE ZI_PRSE_SUBS;
      298      809
      299      810        %INCLUDE CP_6;
      300      891         %B$EXCFR;
PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:58   
      301      909         %B$TCB;
      302      912
      303      913         %FPT_YC(FPTN=SYSCTL,CMD=RBUF);
      304      930         %FPT_OPEN(REASSIGN=YES,SCRUB=YES,CTG=YES);
      305     1039
      306     1040    1       READ_SW = 0; /* READ_SW IS SET TO 1 IF M$YC ALTRETURNED */
      307     1041    1       CALL M$YC(SYSCTL) ALTRET(ALTRTN); /* UNSUCCEFUL CALL */
      308     1042
      309     1043    1       IF ZI$DIR.CODE=#IBEX_DISPLAY THEN
      310     1044    1           RETURN; /* NO NEED SPECIAL ATTENTION */
      311     1045
      312     1046    1       IF ZI$DIR.CODE=#IBEX_RESET AND
      313     1047    1          ZI$DIR.SCHEMA_NM.NAME.TEXT=' ' THEN /* RESET ALL DCBS */
      314     1048    2       DO;
      315     1049    2           CALL RE_SET(LO_DCB) ALTRET(ALTRTN);
      316     1050    2           CALL RE_SET(DO_DCB) ALTRET(ALTRTN);
      317     1051    2           CALL RE_SET(SI_DCB) ALTRET(ALTRTN);
      318     1052    2           CURR_SCHNM=' '; /* LET Q2UT TAKE CARE THE REST */
      319     1053    2           END;
      320     1054    1       ELSE
      321     1055    1           IF ZI$DIR.SCHEMA_NM.NAME.TEXT='M$LO' THEN
      322     1056    1               CALL RE_SET(LO_DCB) ALTRET(ALTRTN);
      323     1057    1           ELSE
      324     1058    1               IF ZI$DIR.SCHEMA_NM.NAME.TEXT='M$SI' THEN
      325     1059    1                   CALL RE_SET(SI_DCB) ALTRET(ALTRTN);
      326     1060    1               ELSE
      327     1061    1                   IF ZI$DIR.SCHEMA_NM.NAME.TEXT='M$DO' THEN
      328     1062    1                       CALL RE_SET(DO_DCB) ALTRET(ALTRTN);
      329     1063    1                   ELSE
      330     1064    1                       IF SCHEMA_ACTIVE AND /* IS IT SCHEMA DCB */
      331     1065    1                          ZI$DIR.SCHEMA_NM.NAME.TEXT=CURR_SCHNM THEN
      332     1066    1                           CURR_SCHNM=' ';
      333     1067    1       RETURN; /* AOK RETURN */
      334     1068    1   ALTRTN: READ_SW=1; /* SET A FLAG INDICATE M$YC FAIL */
      335     1069    1       RETURN; /* TAKE NORMAL RETURN */
      336     1070
      337     1071        /***/
PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:59   
      338     1072    1   /***/ RE_SET: PROC(DCB#) ALTRET;
      339     1073        /***/
      340     1074    2   DCL DCB# UBIN HALF HALIGNED;
      341     1075
      342     1076    2       DCBSF = DCB#;
      343     1077    2       FPT_OPEN.V.DCB#=DCB#;
      344     1078    2       CALL SYS_FUNC_CLOS ALTRET(ALT_CLOS);
      345     1079    2       CALL M$OPEN(FPT_OPEN) ALTRET(ALT); /* USE DEFAULT DCB + REASN */
      346     1080    2       IF DCB#=DO_DCB OR DCB#=LO_DCB THEN
      347     1081    2           INITIAL_CALL='1'B; /* SYS_FUNC_ERRMSG USES IT */
      348     1082    2       IF DCB#~=DO_DCB THEN /* M$SI OR M$LO */
      349     1083    3       DO;
      350     1084    3           PRINT_HDR='0'B;
      351     1085    3           CALL SYS_FUNC_CORRES(SI_DCB,UC_DCB) ALTRET(CHK_LO);
      352     1086    3           PRINT_HDR='1'B;
      353     1087    3   CHK_LO: CALL SYS_FUNC_CORRES(LO_DCB,UC_DCB) ALTRET(OK);
      354     1088    3           PRINT_HDR='1'B;
      355     1089    3           END;
      356     1090    2   OK: RETURN;
      357     1091    2   ALT_CLOS: ALTRETURN;
      358     1092    2   ALT: MONITOR_ERR=B$TCB$->B$TCB.ALT$->B$EXCFR.ERR;
      359     1093    2       INCL_ERR = '1'B;
      360     1094    2       CALL SYS_FUNC_ERRMSG;
      361     1095    2       ALTRETURN;
      362     1096    2   END RE_SET;
      363     1097
      364     1098    1   END ZIU$SYSCTL;
      365     1099        %EOD;

PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:60   
--  Include file information  --

   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   ZI_PRSE_SUBS.:ZIC0TOU  is referenced.
   ZI_GLOBAL_DBUTIL.:ZIC0TOU  is referenced.
   ZI$DIR.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIU$SYSCTL.

   Procedure ZIU$SYSCTL requires 147 words for executable code.
   Procedure ZIU$SYSCTL requires 10 words of local(AUTO) storage.

PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:61   

 Object Unit name= ZIU$SYSCTL                                 File name= ZIU$STATUS.:ZIC0TOU
 UTS= SEP 05 '97 13:32:52.96 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$DO
    1   Data  even  none    68    104  ZIU$SYSCTL
    2   DCB   even  none     0      0  M$LO
    3   DCB   even  none     0      0  M$UC
    4  RoData even  UTS      3      3  ZIU$SYSCTL
    5   Proc  even  none   147    223  ZIU$SYSCTL
    6  RoData even  none    12     14  ZIU$SYSCTL

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     5      0   yes    yes     yes      Std        0  ZIU$SYSCTL

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       0 SYS_FUNC_CLOS
 yes     yes           Std       2 SYS_FUNC_CORRES
 yes     yes           Std       0 SYS_FUNC_ERRMSG
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:62   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     RBUF                                  PRINT_HDR                             INITIAL_CALL
     CURR_SCHNM                            READ_SW                               M$DO
     SI_DCB                                LO_DCB                                UC_DCB
     ZI$DIR                                SCHEMA_ACTIVE                         RECORD_LIST
     SET_LIST                              RETAIN_LIST                           DUMP_FID
     ALTKY                                 INIT_RG                               KEY_RNG
     ITEM_LIST                             BLKLSF                                KEYLSF
     KEYXSF                                DCBSF                                 ORGSF
     KEYSF                                 KEYVSF                                ACSSF
     NOTIMESF                              FUNSF                                 ASNSF
     TESTSF                                XTENSIZESF                            DISPSF
     WAITSF                                VFCSF                                 FULLSF
     BKUPSF                                BUFLNSF                               BUFSF
     SOURCESF                              DESTSF                                DATESF
     TIMESF                                UTSSF                                 DAYSF
     TSTAMPSF                              ENCRP_SEEDSF                          ERRCODESF
     MSGCODE                               INCL_ERR                              ERR_INSERT
     FIDSF_RD                              ACNT                                  EXISTSF
     SHARESF                               DCBNMSF                               KEYRSF
     NO_KEYSF                              REASGNSF                              CARRY_ATTRIBUTESF
     SUBMESSF                              SPKY_OPNSF                            POSSF
     ERRFLGSF                              MERGESF                               FSA_FLAG
     RELGSF                                UNUSED                                HELPCODE
     COUNTSF                               INDEXSF                               GAP
     PSNSF                                 ACNTSF                                KEY_SHADWSF
     REC$                                  RB                                    RE
     IE                                    IB                                    CNT
     ICNT                                  RCNT                                  SCNT
     FIRST_SET                             RETCNT                                DMPCNT
     KCNT                                  ACNT_IDX                              I
     J                                     K                                     X
     STEPCC                                I_O_BUF$                              OUT_INDX
     I_O_SIZE                              REC_DATA_LN                           M$LO
PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:63   
     B$TCB$                                B$ROS$                                B$JIT$
     KEYFID                                I_O_KEY                               RESTART
     BREAK_FLAG                            ICHKSUM                               ITMCNT
     GAP1                                  M$UC

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:64   


      264        1        /*T***********************************************************/
      265        2        /*T*                                                         */
      266        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      267        4        /*T*                                                         */
      268        5        /*T***********************************************************/
      269        6        /*
      270        7              ZIU$SYSCTL - CALL M$YC, PASS COMMAND TO IBEX
      271        8        */
      272        9        ZIU$SYSCTL: PROC ALTRET;

      9  5 000000   000000 700200 xent  ZIU$SYSCTL   TSX0  ! X66_AUTO_0
         5 000001   000012 000000                    ZERO    10,0

      273       10
      274       11    1   DCL RBUF CHAR(256) SYMREF;
      275       12    1   DCL PRINT_HDR BIT(1) SYMREF UNAL;
      276       13    1   DCL INITIAL_CALL BIT(1) SYMREF ALIGNED;
      277       14    1   DCL CURR_SCHNM CHAR(30) SYMREF CALIGNED;
      278       15    1   DCL READ_SW SBIN SYMREF;
      279       16
      280       17    1   DCL SYS_FUNC_CORRES ENTRY(2) ALTRET;
      281       18    1   DCL SYS_FUNC_CLOS ENTRY ALTRET;
      282       19    1   DCL SYS_FUNC_OPEN ENTRY ALTRET;
      283       20    1   DCL SYS_FUNC_ERRMSG ENTRY ALTRET;
      284       21    1   DCL DB_FUNC_FIN ENTRY ALTRET;
      285       22    1   DCL M$DO DCB;
      286       23    1   DCL SI_DCB UBIN HALF SYMREF HALIGNED;
      287       24    1   DCL LO_DCB UBIN HALF SYMREF HALIGNED;
      288       25    1   DCL UC_DCB UBIN HALF SYMREF HALIGNED;
      289       26    1   DCL DO_DCB UBIN HALF STATIC HALIGNED INIT(DCBNUM(M$DO));
      290       27
      291       28        %INCLUDE ZI$DIR;
      292      185         %DIR;
      293      329        %INCLUDE ZI_GLOBAL_DBUTIL;
      294      507         %SYS_FUNC;
      295      599         %MISC_DCLS;
PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:65   
      296      652
      297      653        %INCLUDE ZI_PRSE_SUBS;
      298      809
      299      810        %INCLUDE CP_6;
      300      891         %B$EXCFR;
      301      909         %B$TCB;
      302      912
      303      913         %FPT_YC(FPTN=SYSCTL,CMD=RBUF);
      304      930         %FPT_OPEN(REASSIGN=YES,SCRUB=YES,CTG=YES);
      305     1039
      306     1040    1       READ_SW = 0; /* READ_SW IS SET TO 1 IF M$YC ALTRETURNED */

   1040  5 000002   000000 450000 xsym               STZ     READ_SW

      307     1041    1       CALL M$YC(SYSCTL) ALTRET(ALTRTN); /* UNSUCCEFUL CALL */

   1041  5 000003   000002 630400 1                  EPPR0   SYSCTL
         5 000004   400011 713400                    CLIMB   alt,+9
         5 000005   401000 401760                    pmme    nvectors=3
         5 000006   000107 702000 5                  TSX2    ALTRTN

      308     1042
      309     1043    1       IF ZI$DIR.CODE=#IBEX_DISPLAY THEN

   1043  5 000007   000125 236000 xsym               LDQ     ZI$DIR+85
         5 000010   000000 376000 6                  ANQ     0
         5 000011   000006 116003                    CMPQ    6,DU
         5 000012   000014 601000 5                  TNZ     s:1046

      310     1044    1           RETURN; /* NO NEED SPECIAL ATTENTION */

   1044  5 000013   000000 702200 xent               TSX2  ! X66_ARET

      311     1045
      312     1046    1       IF ZI$DIR.CODE=#IBEX_RESET AND

   1046  5 000014   000001 116000 6                  CMPQ    1
PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:66   
         5 000015   000042 601000 5                  TNZ     s:1055
         5 000016   040000 106400                    CMPC    fill='040'O
         5 000017   000223 200036 xsym               ADSC9   ZI$DIR+147               cn=1,n=30
         5 000020   000002 000001 6                  ADSC9   2                        cn=0,n=1
         5 000021   000042 601000 5                  TNZ     s:1055

      313     1047    1          ZI$DIR.SCHEMA_NM.NAME.TEXT=' ' THEN /* RESET ALL DCBS */
      314     1048    2       DO;

      315     1049    2           CALL RE_SET(LO_DCB) ALTRET(ALTRTN);

   1049  5 000022   000003 236000 6                  LDQ     3
         5 000023   200005 756100                    STQ     5,,AUTO
         5 000024   000112 701000 5                  TSX1    RE_SET
         5 000025   000107 702000 5                  TSX2    ALTRTN

      316     1050    2           CALL RE_SET(DO_DCB) ALTRET(ALTRTN);

   1050  5 000026   000004 236000 6                  LDQ     4
         5 000027   200005 756100                    STQ     5,,AUTO
         5 000030   000112 701000 5                  TSX1    RE_SET
         5 000031   000107 702000 5                  TSX2    ALTRTN

      317     1051    2           CALL RE_SET(SI_DCB) ALTRET(ALTRTN);

   1051  5 000032   000005 236000 6                  LDQ     5
         5 000033   200005 756100                    STQ     5,,AUTO
         5 000034   000112 701000 5                  TSX1    RE_SET
         5 000035   000107 702000 5                  TSX2    ALTRTN

      318     1052    2           CURR_SCHNM=' '; /* LET Q2UT TAKE CARE THE REST */

   1052  5 000036   040000 100400                    MLR     fill='040'O
         5 000037   000002 000001 6                  ADSC9   2                        cn=0,n=1
         5 000040   000000 000036 xsym               ADSC9   CURR_SCHNM               cn=0,n=30

      319     1053    2           END;
PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:67   

   1053  5 000041   000106 710000 5                  TRA     s:1067

      320     1054    1       ELSE
      321     1055    1           IF ZI$DIR.SCHEMA_NM.NAME.TEXT='M$LO' THEN

   1055  5 000042   040000 106400                    CMPC    fill='040'O
         5 000043   000223 200036 xsym               ADSC9   ZI$DIR+147               cn=1,n=30
         5 000044   000000 000004 4                  ADSC9   0                        cn=0,n=4
         5 000045   000053 601000 5                  TNZ     s:1058

      322     1056    1               CALL RE_SET(LO_DCB) ALTRET(ALTRTN);

   1056  5 000046   000003 236000 6                  LDQ     3
         5 000047   200005 756100                    STQ     5,,AUTO
         5 000050   000112 701000 5                  TSX1    RE_SET
         5 000051   000107 702000 5                  TSX2    ALTRTN
         5 000052   000106 710000 5                  TRA     s:1067

      323     1057    1           ELSE
      324     1058    1               IF ZI$DIR.SCHEMA_NM.NAME.TEXT='M$SI' THEN

   1058  5 000053   040000 106400                    CMPC    fill='040'O
         5 000054   000223 200036 xsym               ADSC9   ZI$DIR+147               cn=1,n=30
         5 000055   000001 000004 4                  ADSC9   1                        cn=0,n=4
         5 000056   000064 601000 5                  TNZ     s:1061

      325     1059    1                   CALL RE_SET(SI_DCB) ALTRET(ALTRTN);

   1059  5 000057   000005 236000 6                  LDQ     5
         5 000060   200005 756100                    STQ     5,,AUTO
         5 000061   000112 701000 5                  TSX1    RE_SET
         5 000062   000107 702000 5                  TSX2    ALTRTN
         5 000063   000106 710000 5                  TRA     s:1067

      326     1060    1               ELSE
      327     1061    1                   IF ZI$DIR.SCHEMA_NM.NAME.TEXT='M$DO' THEN
PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:68   

   1061  5 000064   040000 106400                    CMPC    fill='040'O
         5 000065   000223 200036 xsym               ADSC9   ZI$DIR+147               cn=1,n=30
         5 000066   000002 000004 4                  ADSC9   2                        cn=0,n=4
         5 000067   000075 601000 5                  TNZ     s:1064

      328     1062    1                       CALL RE_SET(DO_DCB) ALTRET(ALTRTN);

   1062  5 000070   000004 236000 6                  LDQ     4
         5 000071   200005 756100                    STQ     5,,AUTO
         5 000072   000112 701000 5                  TSX1    RE_SET
         5 000073   000107 702000 5                  TSX2    ALTRTN
         5 000074   000106 710000 5                  TRA     s:1067

      329     1063    1                   ELSE
      330     1064    1                       IF SCHEMA_ACTIVE AND /* IS IT SCHEMA DCB */

   1064  5 000075   000000 234000 xsym               SZN     SCHEMA_ACTIVE
         5 000076   000106 605000 5                  TPL     s:1067
         5 000077   040000 106400                    CMPC    fill='040'O
         5 000100   000223 200036 xsym               ADSC9   ZI$DIR+147               cn=1,n=30
         5 000101   000000 000036 xsym               ADSC9   CURR_SCHNM               cn=0,n=30
         5 000102   000106 601000 5                  TNZ     s:1067

      331     1065    1                          ZI$DIR.SCHEMA_NM.NAME.TEXT=CURR_SCHNM THEN
      332     1066    1                           CURR_SCHNM=' ';

   1066  5 000103   040000 100400                    MLR     fill='040'O
         5 000104   000002 000001 6                  ADSC9   2                        cn=0,n=1
         5 000105   000000 000036 xsym               ADSC9   CURR_SCHNM               cn=0,n=30

      333     1067    1       RETURN; /* AOK RETURN */

   1067  5 000106   000000 702200 xent               TSX2  ! X66_ARET

      334     1068    1   ALTRTN: READ_SW=1; /* SET A FLAG INDICATE M$YC FAIL */

PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:69   
   1068  5 000107   000001 235007       ALTRTN       LDA     1,DL
         5 000110   000000 755000 xsym               STA     READ_SW

      335     1069    1       RETURN; /* TAKE NORMAL RETURN */

   1069  5 000111   000000 702200 xent               TSX2  ! X66_ARET

      336     1070
      337     1071        /***/
      338     1072    1   /***/ RE_SET: PROC(DCB#) ALTRET;

   1072  5 000112   200004 741300       RE_SET       STX1  ! 4,,AUTO

      339     1073        /***/
      340     1074    2   DCL DCB# UBIN HALF HALIGNED;
      341     1075
      342     1076    2       DCBSF = DCB#;

   1076  5 000113   200005 470500                    LDP0    @DCB#,,AUTO
         5 000114   000000 100500                    MLR     fill='000'O
         5 000115   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         5 000116   000000 000002 xsym               ADSC9   DCBSF                    cn=0,n=2

      343     1077    2       FPT_OPEN.V.DCB#=DCB#;

   1077  5 000117   000000 100500                    MLR     fill='000'O
         5 000120   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         5 000121   000056 000002 1                  ADSC9   FPT_OPEN+36              cn=0,n=2

      344     1078    2       CALL SYS_FUNC_CLOS ALTRET(ALT_CLOS);

   1078  5 000122   000006 631400 6                  EPPR1   6
         5 000123   000000 701000 xent               TSX1    SYS_FUNC_CLOS
         5 000124   000206 702000 5                  TSX2    ALT_CLOS

      345     1079    2       CALL M$OPEN(FPT_OPEN) ALTRET(ALT); /* USE DEFAULT DCB + REASN */

PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:70   
   1079  5 000125   000012 630400 1                  EPPR0   FPT_OPEN
         5 000126   450000 713400                    CLIMB   alt,open
         5 000127   410400 401760                    pmme    nvectors=18
         5 000130   000210 702000 5                  TSX2    ALT

      346     1080    2       IF DCB#=DO_DCB OR DCB#=LO_DCB THEN

   1080  5 000131   000000 235000 1                  LDA     DO_DCB
         5 000132   000022 771000                    ARL     18
         5 000133   200006 755100                    STA     @DCB#+1,,AUTO
         5 000134   200005 470500                    LDP0    @DCB#,,AUTO
         5 000135   000100 101500                    MRL     fill='000'O
         5 000136   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         5 000137   200007 000004                    ADSC9   @DCB#+2,,AUTO            cn=0,n=4
         5 000140   200007 236100                    LDQ     @DCB#+2,,AUTO
         5 000141   200006 116100                    CMPQ    @DCB#+1,,AUTO
         5 000142   000154 600000 5                  TZE     s:1081
         5 000143   000000 235000 xsym               LDA     LO_DCB
         5 000144   000022 771000                    ARL     18
         5 000145   200010 755100                    STA     @DCB#+3,,AUTO
         5 000146   000100 101500                    MRL     fill='000'O
         5 000147   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         5 000150   200011 000004                    ADSC9   @DCB#+4,,AUTO            cn=0,n=4
         5 000151   200011 236100                    LDQ     @DCB#+4,,AUTO
         5 000152   200010 116100                    CMPQ    @DCB#+3,,AUTO
         5 000153   000156 601000 5                  TNZ     s:1082

      347     1081    2           INITIAL_CALL='1'B; /* SYS_FUNC_ERRMSG USES IT */

   1081  5 000154   400000 236003                    LDQ     -131072,DU
         5 000155   000000 756000 xsym               STQ     INITIAL_CALL

      348     1082    2       IF DCB#~=DO_DCB THEN /* M$SI OR M$LO */

   1082  5 000156   000000 235000 1                  LDA     DO_DCB
         5 000157   000022 771000                    ARL     18
         5 000160   200006 755100                    STA     @DCB#+1,,AUTO
PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:71   
         5 000161   000100 101500                    MRL     fill='000'O
         5 000162   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         5 000163   200007 000004                    ADSC9   @DCB#+2,,AUTO            cn=0,n=4
         5 000164   200007 236100                    LDQ     @DCB#+2,,AUTO
         5 000165   200006 116100                    CMPQ    @DCB#+1,,AUTO
         5 000166   000204 600000 5                  TZE     OK

      349     1083    3       DO;

      350     1084    3           PRINT_HDR='0'B;

   1084  5 000167   000000 450000 xsym               STZ     PRINT_HDR

      351     1085    3           CALL SYS_FUNC_CORRES(SI_DCB,UC_DCB) ALTRET(CHK_LO);

   1085  5 000170   000010 630400 6                  EPPR0   8
         5 000171   000007 631400 6                  EPPR1   7
         5 000172   000000 701000 xent               TSX1    SYS_FUNC_CORRES
         5 000173   000176 702000 5                  TSX2    CHK_LO

      352     1086    3           PRINT_HDR='1'B;

   1086  5 000174   400000 236003                    LDQ     -131072,DU
         5 000175   000000 756000 xsym               STQ     PRINT_HDR

      353     1087    3   CHK_LO: CALL SYS_FUNC_CORRES(LO_DCB,UC_DCB) ALTRET(OK);

   1087  5 000176   000012 630400 6     CHK_LO       EPPR0   10
         5 000177   000007 631400 6                  EPPR1   7
         5 000200   000000 701000 xent               TSX1    SYS_FUNC_CORRES
         5 000201   000204 702000 5                  TSX2    OK

      354     1088    3           PRINT_HDR='1'B;

   1088  5 000202   400000 236003                    LDQ     -131072,DU
         5 000203   000000 756000 xsym               STQ     PRINT_HDR

PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:72   
      355     1089    3           END;

      356     1090    2   OK: RETURN;

   1090  5 000204   200004 221300       OK           LDX1  ! 4,,AUTO
         5 000205   000001 702211                    TSX2  ! 1,X1

      357     1091    2   ALT_CLOS: ALTRETURN;

   1091  5 000206   200004 221300       ALT_CLOS     LDX1  ! 4,,AUTO
         5 000207   000000 702211                    TSX2  ! 0,X1

      358     1092    2   ALT: MONITOR_ERR=B$TCB$->B$TCB.ALT$->B$EXCFR.ERR;

   1092  5 000210   000000 470400 xsym  ALT          LDP0    B$TCB$
         5 000211   000000 471500                    LDP1    0,,PR0
         5 000212   100102 236100                    LDQ     66,,PR1
         5 000213   000000 756000 xsym               STQ     MSGCODE

      359     1093    2       INCL_ERR = '1'B;

   1093  5 000214   400000 236003                    LDQ     -131072,DU
         5 000215   000000 756000 xsym               STQ     INCL_ERR

      360     1094    2       CALL SYS_FUNC_ERRMSG;

   1094  5 000216   000006 631400 6                  EPPR1   6
         5 000217   000000 701000 xent               TSX1    SYS_FUNC_ERRMSG
         5 000220   000000 011000                    NOP     0

      361     1095    2       ALTRETURN;

   1095  5 000221   200004 221300                    LDX1  ! 4,,AUTO
         5 000222   000000 702211                    TSX2  ! 0,X1

DO_DCB
 Sect OctLoc
PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:73   
   1     000   000000 ******                                                    ....

SYSCTL
 Sect OctLoc
   1     002   000077 777640   000000 006000   000001 777640   000010 006000    .?..............
   1     006   000000 177640   000000 006014   000000 000000   0***** ******    ................

FPT_OPEN
 Sect OctLoc
   1     012   000025 777640   000056 006000   000000 177640   000000 006014    ................
   1     016   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     056*  000000 600102   000000 000000   252525 000000   000040 252520    ...B......... ..
   1     062   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   1     066   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     072   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1     076   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1     102   000000 000000   ****** ******                                    ........

(unnamed)
 Sect OctLoc
   4     000   115044 114117   115044 123111   115044 104117                    M$LOM$SIM$DO

(unnamed)
 Sect OctLoc
   6     000   000007 600000   000005 600000   040040 040040   000000 006000    ........    ....
   6     004   000000 006000   000000 006000   000000 000000   000002 000000    ................
   6     010   000000 006000   000000 006000   000000 006000   000000 006000    ................
      362     1096    2   END RE_SET;
      363     1097
      364     1098    1   END ZIU$SYSCTL;
      365     1099        %EOD;

PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:74   
--  Include file information  --

   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   ZI_PRSE_SUBS.:ZIC0TOU  is referenced.
   ZI_GLOBAL_DBUTIL.:ZIC0TOU  is referenced.
   ZI$DIR.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIU$SYSCTL.

   Procedure ZIU$SYSCTL requires 147 words for executable code.
   Procedure ZIU$SYSCTL requires 10 words of local(AUTO) storage.
PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:75   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:76   
          MINI XREF LISTING

ALT IN PROCEDURE RE_SET
      1092**LABEL    1079--CALLALT
ALTRTN
      1068**LABEL    1041--CALLALT  1049--CALLALT  1050--CALLALT  1051--CALLALT  1056--CALLALT  1059--CALLALT
      1062--CALLALT
ALT_CLOS IN PROCEDURE RE_SET
      1091**LABEL    1078--CALLALT
B$EXCFR.ASL
       892**DCL       892--REDEF
B$EXCFR.ERR
       906**DCL      1092>>ASSIGN
B$EXCFR.ERR.ERR#
       906**DCL       906--REDEF
B$EXCFR.EVID
       905**DCL       905--REDEF     906--REDEF
B$EXCFR.IR
       893**DCL       893--REDEF
B$EXCFR.PREVSZ
       892**DCL       892--REDEF
B$EXCFR.SUBC
       904**DCL       904--REDEF     905--REDEF     905--REDEF
B$TCB.ALT$
       910**DCL      1092>>ASSIGN
B$TCB$
       636**DCL      1092>>ASSIGN
CHK_LO IN PROCEDURE RE_SET
      1087**LABEL    1085--CALLALT
COUNTSF
       588**DCL       589--REDEF
CURR_SCHNM
        14**DCL      1052<<ASSIGN   1064>>IF       1066<<ASSIGN
DCB# IN PROCEDURE RE_SET
PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:77   
      1074**DCL      1072--PROC     1076>>ASSIGN   1077>>ASSIGN   1080>>IF       1080>>IF       1082>>IF
DCBSF
       517**DCL      1076<<ASSIGN
DO_DCB
        26**DCL      1050<>CALL     1062<>CALL     1080>>IF       1082>>IF
ENCRP_SEEDSF
       546**DCL       547--REDEF
ERRCODESF
       548**DCL       553--REDEF
FIDSF_RD
       564**DCL       565--REDEF
FPT_OPEN
       995**DCL      1079<>CALL
FPT_OPEN.ACSVEH_
       997**DCL       998--REDEF
FPT_OPEN.ALTKEYS_
      1003**DCL      1004--REDEF    1004--REDEF
FPT_OPEN.HDR_
      1002**DCL      1003--REDEF
FPT_OPEN.TAB_
      1001**DCL      1002--REDEF
FPT_OPEN.UHL_
       995**DCL       996--REDEF     996--REDEF
FPT_OPEN.V
      1004**DCL       995--DCLINIT
FPT_OPEN.V.DCB#
      1004**DCL      1077<<ASSIGN
FPT_OPEN.V.FSN#
      1035**DCL      1035--REDEF    1035--REDEF
FPT_OPEN.WSN_
      1001**DCL      1001--REDEF
HELPCODE
       582**DCL       587--REDEF
ICHKSUM
       647**DCL       648--REDEF
INCL_ERR
PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:78   
       560**DCL      1093<<ASSIGN
INITIAL_CALL
        13**DCL      1081<<ASSIGN
I_O_BUF$
       625**DCL       626--IMP-PTR
KEYVSF
       520**DCL       525--REDEF
KEYVSF.WD_ONE
       522**DCL       523--REDEF
LO_DCB
        24**DCL      1049<>CALL     1056<>CALL     1080>>IF       1087<>CALL
M$OPEN
       819**DCL-ENT  1079--CALL
M$YC
       833**DCL-ENT  1041--CALL
MONITOR_ERR
       555**DCL      1092<<ASSIGN
MSGCODE
       554**DCL       555--REDEF
OK IN PROCEDURE RE_SET
      1090**LABEL    1087--CALLALT
PRINT_HDR
        12**DCL      1084<<ASSIGN   1086<<ASSIGN   1088<<ASSIGN
RBUF
        11**DCL       926--DCLINIT
READ_SW
        15**DCL      1040<<ASSIGN   1068<<ASSIGN
REC$
       606**DCL       629--IMP-PTR
REC_DATA_LN
       634**DCL       633--IMP-SIZ
RE_SET
      1072**PROC     1049--CALL     1050--CALL     1051--CALL     1056--CALL     1059--CALL     1062--CALL
SCHEMA_ACTIVE
       302**DCL      1064>>IF
SI_DCB
PL6.E3A0      #002=ZIU$SYSCTL File=ZIU$STATUS.:ZIC0TSI                           FRI 09/05/97 13:32 Page:79   
        23**DCL      1051<>CALL     1059<>CALL     1085<>CALL
SYSCTL
       926**DCL      1041<>CALL
SYSCTL.V
       927**DCL       926--DCLINIT
SYS_FUNC_CLOS
        18**DCL-ENT  1078--CALL
SYS_FUNC_CORRES
        17**DCL-ENT  1085--CALL     1087--CALL
SYS_FUNC_ERRMSG
        20**DCL-ENT  1094--CALL
UC_DCB
        25**DCL      1085<>CALL     1087<>CALL
ZI$DIR.ALTKEY
       257**DCL       258--REDEF     259--REDEF
ZI$DIR.AREAFID
       223**DCL       224--REDEF
ZI$DIR.CODE
       239**DCL      1043>>IF       1046>>IF
ZI$DIR.DATE
       262**DCL       266--REDEF
ZI$DIR.DEST_SEED
       218**DCL       219--REDEF     220--REDEF
ZI$DIR.ENCP_SEED
       215**DCL       216--REDEF     217--REDEF
ZI$DIR.REPRT_ZERO
       249**DCL       250--REDEF
ZI$DIR.SCHEMA_NM.NAME.TEXT
       284**DCL      1046>>IF       1055>>IF       1058>>IF       1061>>IF       1064>>IF
ZI$DIR.SCHFID
       221**DCL       222--REDEF
ZI$DIR.TIME
       267**DCL       272--REDEF

PL6.E3A0      #003=GET_FILESIZE File=ZIU$STATUS.:ZIC0TSI                         FRI 09/05/97 13:33 Page:80   
      366        1        /*T***********************************************************/
      367        2        /*T*                                                         */
      368        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      369        4        /*T*                                                         */
      370        5        /*T***********************************************************/
      371        6        GET_FILESIZE: PROC ALTRET;
      372        7        /*       THIS PROC RETURN THE FILE SIZE FOR THE FILE WITH
      373        8                 FIT IN FILE_INFO TO XTENTSIZE     */
      374        9    1   DCL FILE_INFO(0:1023) SBIN SYMREF;
      375       10    1   DCL FIT$ PTR;
      376       11        %INCLUDE ZI_GLOBAL_DBUTIL;
      377      189        %SYS_FUNC; /* WE NEED XTENSIZESF */
      378      281        %INCLUDE FM$FIT;
      379      502        %CODE03 (BASED="BASED(FIT$)");
      380      509    1   DCL XSF$LOCCODE ENTRY(2) ALTRET;
      381      510
      382      511    1       FIT$ = ADDR(FILE_INFO(5)); /* PASS FPARA ADDR IN FIT */
      383      512    1       GOTO GET_IT;
      384      513    1   GET_FILESZ: ENTRY ALTRET;
      385      514    1       FIT$ = ADDR(FILE_INFO); /* NOT OPEN BLOCK MODE */
      386      515    1   GET_IT:
      387      516    1       XTENSIZESF = 3; /* SET TO FIT CODE 3 */
      388      517    1       CALL XSF$LOCCODE(FIT$,XTENSIZESF) ALTRET(ALTRTN);
      389      518    1       XTENSIZESF = CODE03.UGRANS + CODE03.NGAVAL; /* FILE SIZE */
      390      519    1       RETURN;
      391      520    1   ALTRTN:
      392      521    1       ALTRETURN; /* IF FAIL, THEN XTENSIZESF = 3 */
      393      522    1   END GET_FILESIZE;

PL6.E3A0      #003=GET_FILESIZE File=ZIU$STATUS.:ZIC0TSI                         FRI 09/05/97 13:33 Page:81   
--  Include file information  --

   FM$FIT.:LIB_E05  is referenced.
   ZI_GLOBAL_DBUTIL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure GET_FILESIZE.

   Procedure GET_FILESIZE requires 29 words for executable code.
   Procedure GET_FILESIZE requires 6 words of local(AUTO) storage.

    No errors detected in file ZIU$STATUS.:ZIC0TSI    .

PL6.E3A0      #003=GET_FILESIZE File=ZIU$STATUS.:ZIC0TSI                         FRI 09/05/97 13:33 Page:82   

 Object Unit name= GET_FILESIZE                               File name= ZIU$STATUS.:ZIC0TOU
 UTS= SEP 05 '97 13:33:02.08 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    29     35  GET_FILESIZE
    1  RoData even  none     5      5  GET_FILESIZE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        0  GET_FILESIZE
     0      5          yes     yes      Std        0  GET_FILESZ

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 XSF$LOCCODE
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #003=GET_FILESIZE File=ZIU$STATUS.:ZIC0TSI                         FRI 09/05/97 13:33 Page:83   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     FILE_INFO                             BLKLSF                                KEYLSF
     KEYXSF                                DCBSF                                 ORGSF
     KEYSF                                 KEYVSF                                ACSSF
     NOTIMESF                              FUNSF                                 ASNSF
     TESTSF                                XTENSIZESF                            DISPSF
     WAITSF                                VFCSF                                 FULLSF
     BKUPSF                                BUFLNSF                               BUFSF
     SOURCESF                              DESTSF                                DATESF
     TIMESF                                UTSSF                                 DAYSF
     TSTAMPSF                              ENCRP_SEEDSF                          ERRCODESF
     MSGCODE                               INCL_ERR                              ERR_INSERT
     FIDSF_RD                              ACNT                                  EXISTSF
     SHARESF                               DCBNMSF                               KEYRSF
     NO_KEYSF                              REASGNSF                              CARRY_ATTRIBUTESF
     SUBMESSF                              SPKY_OPNSF                            POSSF
     ERRFLGSF                              MERGESF                               FSA_FLAG
     RELGSF                                UNUSED                                HELPCODE
     COUNTSF                               INDEXSF                               GAP
     PSNSF                                 ACNTSF                                KEY_SHADWSF

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #003=GET_FILESIZE File=ZIU$STATUS.:ZIC0TSI                         FRI 09/05/97 13:33 Page:84   


      366        1        /*T***********************************************************/
      367        2        /*T*                                                         */
      368        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      369        4        /*T*                                                         */
      370        5        /*T***********************************************************/
      371        6        GET_FILESIZE: PROC ALTRET;

      6  0 000000   000000 700200 xent  GET_FILESIZE TSX0  ! X66_AUTO_0
         0 000001   000006 000000                    ZERO    6,0

      372        7        /*       THIS PROC RETURN THE FILE SIZE FOR THE FILE WITH
      373        8                 FIT IN FILE_INFO TO XTENTSIZE     */
      374        9    1   DCL FILE_INFO(0:1023) SBIN SYMREF;
      375       10    1   DCL FIT$ PTR;
      376       11        %INCLUDE ZI_GLOBAL_DBUTIL;
      377      189        %SYS_FUNC; /* WE NEED XTENSIZESF */
      378      281        %INCLUDE FM$FIT;
      379      502        %CODE03 (BASED="BASED(FIT$)");
      380      509    1   DCL XSF$LOCCODE ENTRY(2) ALTRET;
      381      510
      382      511    1       FIT$ = ADDR(FILE_INFO(5)); /* PASS FPARA ADDR IN FIT */

    511  0 000002   000000 236000 1                  LDQ     0
         0 000003   200003 756100                    STQ     FIT$,,AUTO

      383      512    1       GOTO GET_IT;

    512  0 000004   000011 710000 0                  TRA     GET_IT

      384      513    1   GET_FILESZ: ENTRY ALTRET;

    513  0 000005   000000 700200 xent  GET_FILESZ   TSX0  ! X66_AUTO_0
         0 000006   000006 000000                    ZERO    6,0

      385      514    1       FIT$ = ADDR(FILE_INFO); /* NOT OPEN BLOCK MODE */

PL6.E3A0      #003=GET_FILESIZE File=ZIU$STATUS.:ZIC0TSI                         FRI 09/05/97 13:33 Page:85   
    514  0 000007   000001 236000 1                  LDQ     1
         0 000010   200003 756100                    STQ     FIT$,,AUTO

      386      515    1   GET_IT:
      387      516    1       XTENSIZESF = 3; /* SET TO FIT CODE 3 */

    516  0 000011   000003 235007       GET_IT       LDA     3,DL
         0 000012   000000 755000 xsym               STA     XTENSIZESF

      388      517    1       CALL XSF$LOCCODE(FIT$,XTENSIZESF) ALTRET(ALTRTN);

    517  0 000013   000003 236000 1                  LDQ     3
         0 000014   200005 756100                    STQ     FIT$+2,,AUTO
         0 000015   200003 630500                    EPPR0   FIT$,,AUTO
         0 000016   200004 450500                    STP0    FIT$+1,,AUTO
         0 000017   200004 630500                    EPPR0   FIT$+1,,AUTO
         0 000020   000002 631400 1                  EPPR1   2
         0 000021   000000 701000 xent               TSX1    XSF$LOCCODE
         0 000022   000034 702000 0                  TSX2    ALTRTN

      389      518    1       XTENSIZESF = CODE03.UGRANS + CODE03.NGAVAL; /* FILE SIZE */

    518  0 000023   200003 470500                    LDP0    FIT$,,AUTO
         0 000024   000003 236100                    LDQ     3,,PR0
         0 000025   000004 376000 1                  ANQ     4
         0 000026   200004 756100                    STQ     FIT$+1,,AUTO
         0 000027   000000 236100                    LDQ     0,,PR0
         0 000030   000004 376000 1                  ANQ     4
         0 000031   200004 036100                    ADLQ    FIT$+1,,AUTO
         0 000032   000000 756000 xsym               STQ     XTENSIZESF

      390      519    1       RETURN;

    519  0 000033   000000 702200 xent               TSX2  ! X66_ARET

      391      520    1   ALTRTN:
      392      521    1       ALTRETURN; /* IF FAIL, THEN XTENSIZESF = 3 */
PL6.E3A0      #003=GET_FILESIZE File=ZIU$STATUS.:ZIC0TSI                         FRI 09/05/97 13:33 Page:86   

    521  0 000034   000000 702200 xent  ALTRTN       TSX2  ! X66_AALT

(unnamed)
 Sect OctLoc
   1     000   000005 006000   000000 006000   000002 000000   000000 006000    ................
   1     004   000777 777777                                                    ....
      393      522    1   END GET_FILESIZE;

PL6.E3A0      #003=GET_FILESIZE File=ZIU$STATUS.:ZIC0TSI                         FRI 09/05/97 13:33 Page:87   
--  Include file information  --

   FM$FIT.:LIB_E05  is referenced.
   ZI_GLOBAL_DBUTIL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure GET_FILESIZE.

   Procedure GET_FILESIZE requires 29 words for executable code.
   Procedure GET_FILESIZE requires 6 words of local(AUTO) storage.

    No errors detected in file ZIU$STATUS.:ZIC0TSI    .
PL6.E3A0      #003=GET_FILESIZE File=ZIU$STATUS.:ZIC0TSI                         FRI 09/05/97 13:33 Page:88   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=GET_FILESIZE File=ZIU$STATUS.:ZIC0TSI                         FRI 09/05/97 13:33 Page:89   
          MINI XREF LISTING

ALTRTN
       521**LABEL     517--CALLALT
CODE03.NGAVAL
       505**DCL       518>>ASSIGN
CODE03.UGRANS
       503**DCL       518>>ASSIGN
COUNTSF
       270**DCL       271--REDEF
ENCRP_SEEDSF
       228**DCL       229--REDEF
ERRCODESF
       230**DCL       235--REDEF
FIDSF_RD
       246**DCL       247--REDEF
FILE_INFO
         9**DCL       511--ASSIGN    514--ASSIGN
FIT$
        10**DCL       503--IMP-PTR   511<<ASSIGN    514<<ASSIGN    517<>CALL      518>>ASSIGN    518>>ASSIGN
GET_IT
       516**LABEL     512--GOTO
HELPCODE
       264**DCL       269--REDEF
KEYVSF
       202**DCL       207--REDEF
KEYVSF.WD_ONE
       204**DCL       205--REDEF
MSGCODE
       236**DCL       237--REDEF
XSF$LOCCODE
       509**DCL-ENT   517--CALL
XTENSIZESF
       213**DCL       516<<ASSIGN    517<>CALL      518<<ASSIGN
