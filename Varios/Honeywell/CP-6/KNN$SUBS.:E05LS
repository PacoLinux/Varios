VERSION E05

PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:1    
        1        1        /*M* KNN$RECVOSI - OSI network message decoder  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=3,ENU=0,ECU=0,CRM=70,CCC=YES,CSI=3,CTI=2,DCI=3,ECI=3,ENI=3,SDI=3 */
        8        8        /*P*    NAME:   KNN$RECVOSI
        9        9                PURPOSE: This module contains the procedure to decode OSI
       10       10                         network layer messages.
       11       11        */
       12       12
       13       13
       14       14        /*F*  NAME:    KNN$RECVOSI
       15       15
       16       16              PURPOSE: decode network pdus
       17       17              DESCRIPTION:
       18       18        */
       19       19
       20       20        %EJECT;
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:2    
       21       21        KNN$RECVOSI: PROC(KN$NETPARM) ALTRET;
       22       22
       23       23        %INCLUDE LCP_6;
       24     4302        %INCLUDE K_NETWORK_M;
       25     4571        %INCLUDE K_NETWORK_E;
       26     4660        %INCLUDE KNH_MACRO_C;
       27     4943        %INCLUDE K_ADDRESS_M;
       28     5446        %INCLUDE K_SCODE_C;
       29     5531        %INCLUDE KNN_NETWORK_M;
       30     5894        %INCLUDE KN_DATA_M;
       31     7680        %INCLUDE K_INTERFACE_M;
       32     8089        %INCLUDE KL_MACRO_C;
       33    11441        %INCLUDE KN_ERRORS_C;
       34    11505        %INCLUDE K_QDPHDRS_M;
       35    12387
       36    12388        %KN$NETPARM(NAME=KN$NETPARM,STCLASS="");
       37    12541
       38    12542    1   DCL KNN$SENDERR ENTRY(1) ALTRET;
       39    12543    1   DCL KNA$CHK_CHKSUM ENTRY(2) ALTRET;
       40    12544    1   DCL KNA$CALC_CHKSUM ENTRY(3) ALTRET;
       41    12545    1   DCL KNT$SEND_4HOST ENTRY(1) ALTRET;
       42    12546    1   DCL KNT$RECV_4HOST ENTRY(1) ALTRET;
       43    12547    1   DCL KNN$REASSEM ENTRY(3) ALTRET;
       44    12548    1   DCL KNN$DECODE_NSAP ENTRY(2) ALTRET;
       45    12549    1   DCL KNH$SEND ENTRY(1) ALTRET;
       46    12550    1   DCL SCREECH ENTRY(1);
       47    12551    1   DCL GHE$ERRLOG ENTRY(5) ALTRET;
       48    12552
       49    12553    1   DCL KNN_NODES UBIN SYMREF;
       50    12554    1   DCL KN_NODE# UBIN SYMREF;
       51    12555    1   DCL KNN_ROUTE$$ PTR SYMREF;
       52    12556    1   DCL KNN_LINKS UBIN SYMREF;
       53    12557    1   DCL KNN_LINK$$ PTR SYMREF;
       54    12558    1   DCL KNN_OSIROUTE$$ PTR SYMREF;
       55    12559    1   DCL KNN_OSIMAX# UBIN SYMREF;
       56    12560    1   DCL KNN_OSIROUTE# UBIN SYMREF;
       57    12561
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:3    
       58    12562        %K$NPDU_FIXED(STCLASS="BASED(KN$NETPARM.NHDR$)");
       59    12619        %K$NPDU_SEGMENT;
       60    12671        %K$NSAP(ADRTYP=NET);
       61    12723        %KNN$LINK(STCLASS="BASED(LINK$)");
       62    12974        %KNN$ROUTE(STCLASS="BASED(ROUTE$)");
       63    13046    1   DCL KNN$ROUTE$(0:0) PTR BASED(KNN_ROUTE$$);
       64    13047    1   DCL KNN$LINK$(0:0) PTR BASED(KNN_LINK$$);
       65    13048    1   DCL ADDRESS CHAR(SIZE) BASED;
       66    13049    1   DCL CHR(0:0) CHAR(1) BASED CALIGNED;
       67    13050    1   DCL CALLEDFROM$ EPTR BASED;
       68    13051
       69    13052        %K$NQDP_HDR (NAME=K$NQDP_HDR_C,MSGTYPE=OSI_DATA,ALGN=ALIGNED,STCLASS=CONSTANT);
       70    13129        %VLP_SCODE (FPTN=PRTCLERR,ERR#=%S$PRTCLERR,SEV=G_SEV_SCREECH#,
       71    13130                       STCLASS=CONSTANT,FCG=KN,MID=N,MON='1'B);
       72    13191
       73    13192        %VLP_ERRCODE(FPTN=E_DSCRD_RNS,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13192            %E$DSCRD_RNS);
       74    13238        /*E* ERROR: KNN-E$DSCRD_RNS
       75    13239             MESSAGE: OSI network pdu was discarded and no reason was specified.
       76    13240        */
       77    13241
       78    13242        %VLP_ERRCODE(FPTN=E_DSCRD_PPE,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13242            %E$DSCRD_PPE);
       79    13288        /*E* ERROR: KNN-E$DSCRD_PPE
       80    13289             MESSAGE: OSI network pdu was discarded due to a protocol procedure error
       81    13290        */
       82    13291
       83    13292        %VLP_ERRCODE(FPTN=E_DSCRD_IC,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=%E$DSCRD_IC
             13292            );
       84    13338        /*E* ERROR: KNN-E$DSCRD_IC
       85    13339             MESSAGE: OSI network pdu was discarded due to an Incorrect checksum
       86    13340         */
       87    13341
       88    13342        %VLP_ERRCODE(FPTN=E_DSCRD_CONGEST,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13342            %E$DSCRD_CONGEST);
       89    13388        /*E* ERROR: KNN-E$DSCRD_CONGEST
       90    13389             MESSAGE: OSI network pdu was discarded due to system congestion
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:4    
       91    13390        */
       92    13391
       93    13392        %VLP_ERRCODE(FPTN=E_DSCRD_HDRSNTX,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13392            %E$DSCRD_HDRSNTX);
       94    13438        /*E* ERROR: KNN-E$DSCRD_HDRSNTX
       95    13439             MESSAGE: Syntax error in the network header; pdu was discarded.
       96    13440        */
       97    13441
       98    13442        %VLP_ERRCODE(FPTN=E_DSCRD_CANTSEG,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13442            %E$DSCRD_CANTSEG);
       99    13488        /*E* ERROR: KNN-E$DSCRD_CANTSEG
      100    13489             MESSAGE: segmentation needed but not permitted, pdu was discarded.
      101    13490         */
      102    13491
      103    13492        %VLP_ERRCODE(FPTN=E_DSCRD_INCMPPDU,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13492            %E$DSCRD_INCMPPDU);
      104    13538        /*E* ERROR: KNN-E$DSCRD_INCMPPDU
      105    13539             MESSAGE: An Incomplete pdu was received; pdu was discarded.
      106    13540        */
      107    13541
      108    13542        %VLP_ERRCODE(FPTN=E_DSCRD_DUPOPT,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13542            %E$DSCRD_DUPOPT);
      109    13588        /*E* ERROR: KNN-E$DSCRD_DUPOPT
      110    13589             MESSAGE: duplicate option specified, pdu discarded.
      111    13590        */
      112    13591
      113    13592        %VLP_ERRCODE(FPTN=E_DSCRD_DSTUNREACH,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13592            %E$DSCRD_DSTUNREACH);
      114    13638        /*E* ERROR: KNN-E$DSCRD_DSTUNREACH
      115    13639             MESSAGE: destination unreachable, pdu discarded.
      116    13640        */
      117    13641
      118    13642        %VLP_ERRCODE(FPTN=E_DSCRD_DSTUNKNWN,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13642            %E$DSCRD_DSTUNKNWN);
      119    13688        /*E* ERROR: KNN-E$DSCRD_DSTUNKNWN
      120    13689             MESSAGE:  destination unknown, pdu discarded.
      121    13690        */
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:5    
      122    13691
      123    13692        %VLP_ERRCODE(FPTN=E_DSCRD_SRCRTEERR,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13692            %E$DSCRD_SRCRTEERR);
      124    13738        /*E* ERROR: KNN-E$DSCRD_SRCRTEERR
      125    13739             MESSAGE: Unspecified source routing error, discard pdu.
      126    13740        */
      127    13741
      128    13742        %VLP_ERRCODE(FPTN=E_DSCRD_SRCRTESNTX,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13742            %E$DSCRD_SRCRTESNTX);
      129    13788        /*E* ERROR: KNN-E$DSCRD_SRCRTESNTX
      130    13789             MESSAGE: Syntax error in source routing field, pdu discarded.
      131    13790        */
      132    13791
      133    13792        %VLP_ERRCODE(FPTN=E_DSCRD_SRCRTEUNKWN,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13792            %E$DSCRD_SRCRTEUNKWN);
      134    13838        /*E* ERROR: KNN-E$DSCRD_SRCRTEUNKWN
      135    13839             MESSAGE: Unknown address in source routing field pdu discarded.
      136    13840        */
      137    13841
      138    13842        %VLP_ERRCODE(FPTN=E_DSCRD_PTHNOTACPT,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13842            %E$DSCRD_PTHNOTACPT);
      139    13888        /*E* ERROR: KNN-E$DSCRD_PTHNOTACPT
      140    13889             MESSAGE: Path was not acceptable, pdu was discarded.
      141    13890        */
      142    13891
      143    13892        %VLP_ERRCODE(FPTN=E_DSCRD_LIFEEXPTRAN,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13892            %E$DSCRD_LIFEEXPTRAN);
      144    13938        /*E* ERROR: KNN-E$DSCRD_LIFEEXPTRAN
      145    13939             MESSAGE:  Lifetime expired in transit, pdu was discarded.
      146    13940        */
      147    13941
      148    13942        %VLP_ERRCODE(FPTN=E_DSCRD_LIFEEXPASSM,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13942            %E$DSCRD_LIFEEXPASSM);
      149    13988        /*E* ERROR: KNN-E$DSCRD_LIFEEXPASSM
      150    13989             MESSAGE: Lifetime expired during assembly, pdu was discarded.
      151    13990        */
      152    13991
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:6    
      153    13992        %VLP_ERRCODE(FPTN=E_DSCRD_OPTNON,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13992            %E$DSCRD_OPTNON);
      154    14038        /*E* ERROR: KNN-E$DSCRD_OPTNON
      155    14039             MESSAGE:  Unsupported option specified, pdu was discarded.
      156    14040        */
      157    14041
      158    14042        %VLP_ERRCODE(FPTN=E_DSCRD_OPTPRCLVERS,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             14042            %E$DSCRD_OPTPRCLVERS);
      159    14088        /*E* ERROR: KNN-E$DSCRD_OPTPRCLVERS
      160    14089             MESSAGE: * Unsupported protocol version specified, pdu was discarded.
      161    14090        */
      162    14091
      163    14092        %VLP_ERRCODE(FPTN=E_DSCRD_OPTSEC,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             14092            %E$DSCRD_OPTSEC);
      164    14138        /*E* ERROR: KNN-E$DSCRD_OPTSEC
      165    14139             MESSAGE:  Unsupported security option, pdu discarded.
      166    14140        */
      167    14141
      168    14142        %VLP_ERRCODE(FPTN=E_DSCRD_OPTSRCRTE,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             14142            %E$DSCRD_OPTSRCRTE);
      169    14188        /*E* ERROR: KNN-E$DSCRD_OPTSRCRTE
      170    14189             MESSAGE:  Unsupported Source routing option, pdu discarded
      171    14190        */
      172    14191
      173    14192        %VLP_ERRCODE(FPTN=E_DSCRD_OPTRECRTE,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             14192            %E$DSCRD_OPTRECRTE);
      174    14238        /*E* ERROR: KNN-E$DSCRD_OPTRECRTE
      175    14239             MESSAGE:  Unsupported record route option, pdu discarded.
      176    14240        */
      177    14241
      178    14242        %VLP_ERRCODE(FPTN=E_DSCRD_REASSEM,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             14242            %E$DSCRD_REASSEM);
      179    14288        /*E* ERROR: KNN-E$DSCRD_REASSEM
      180    14289             MESSAGE: Reassembly interface error, pdu discarded.
      181    14290        */
      182    14291
      183    14292        %K$NSAP(FPTN=DESTINATION,STCLASS=AUTO,ADRTYP=NET);
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:7    
      184    14344        %K$NSAP(FPTN=SOURCE,STCLASS=AUTO,ADRTYP=NET);
      185    14396        %LIST;
      186    14397        %FPT_NSAP(STCLASS=AUTO);
             14398        %LSET LISTDIR='0'B;
             14411    1   DCL 1 FPT_NSAP AUTO ALIGNED,
             14434    1        2 NSAP CALIGNED,
             14436    1     3 LEN UBIN BYTE CALIGNED /*(0)*/,
             14441    1     3 AFI UBIN BYTE UNAL /*(0)*/,
             14464    1        3 ADDRESS_N(0:19) CALIGNED UBIN(8) /*(0*0)*/,
             14465    1        3 ADDRESS REDEF ADDRESS_N CHAR(20) CALIGNED ;
      187    14469        %PLIST;
      188    14470        %K$NPDU_SEGMENT(NAME=SEGMENT,STCLASS=AUTO);
      189    14522        %KL_UPDOSI(FPTN=SRCROUTE,STCLASS=AUTO);/* node#,link# of src address*/
      190    14731        %KL_UPDOSI(FPTN=DSTROUTE,STCLASS=AUTO);/* node#,link# of dst address*/
      191    14940        %K$NQDP_HDR (NAME=NQDP_HDR,MSGTYPE=OSI_DATA,ALGN=ALIGNED,STCLASS=AUTO);
      192    15017
      193    15018        %VLP_ERRCODE(FPTN=ERR_CODE,STCLASS=AUTO);
      194    15064
      195    15065    1   DCL SIZE UBIN;
      196    15066    1   DCL OPTSZ UBIN BYTE;
      197    15067    1   DCL OPTVAL UBIN BYTE;
      198    15068    1   DCL DATASIZE SBIN;
      199    15069    1   DCL FIXEDSIZ UBIN;
      200    15070    1   DCL SEGLENGTH UBIN;
      201    15071    1   DCL D$ PTR;
      202    15072    1   DCL QQQ$ PTR;
      203    15073    1   DCL SAVE_FPT$ PTR;
      204    15074    1   DCL LINK$ PTR;
      205    15075    1   DCL ROUTE$ PTR;
      206    15076    1   DCL CURINDX UBIN;                       /*  is index into npdu      */
      207    15077    1   DCL DSTINDX UBIN; /* index into k$npdu_fixed to destination address + 1 */
      208    15078    1   DCL SRCINDX UBIN;                       /* source address index     */
      209    15079    1   DCL CODE UBIN BYTE;                     /* options code in pdu      */
      210    15080    1   DCL LI SBIN;                       /* decreasing header byte count  */
      211    15081    1   DCL I UBIN;
      212    15082    1   DCL J UBIN;
      213    15083    1   DCL ERRVAL(0:3) UBIN;                   /* values for errlogger     */
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:8    
      214    15084        /*
      215    15085             use these to keep worst case code from being generated.
      216    15086        */
      217    15087    1   DCL SNPATMPLT1 CHAR(8) ALIGNED;
      218    15088    1   DCL 1 SNPATMPLT2 REDEF SNPATMPLT1 ALIGNED,
      219    15089    1          2 NIBBLES(0:13) UNAL,
      220    15090    1             3 NIB UBIN(4) UNAL;
      221    15091
      222    15092    1   DCL SNPATMPLT3 CHAR(8) ALIGNED;
      223    15093    1   DCL 1 SNPATMPLT4 REDEF SNPATMPLT3 ALIGNED,
      224    15094    1          2 NIBBLES(0:13) UNAL,
      225    15095    1             3 NIB UBIN(4) UNAL;
      226    15096
      227    15097        %EJECT;
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:9    
      228    15098
      229    15099    1      QQQ$ = KN$NETPARM.LDCT$;
      230    15100    1      SAVE_FPT$ = KN$NETPARM.FPT$;
      231    15101    1      KN$NETPARM.FPT$ = ADDR(NIL);
      232    15102    1      SIZE = KN$NETPARM.NHDRSZ;
      233    15103    1      IF SIZE = 0 THEN RETURN;
      234    15104
      235    15105    1      IF SIZE < LENGTHC(K$NPDU_FIXED) THEN
      236    15106    1         CALL SCREECH(PRTCLERR);
      237    15107
      238    15108    1      LI = K$NPDU_FIXED.LENGTH;
      239    15109    1      IF LI > SIZE THEN
      240    15110    1         CALL SCREECH(PRTCLERR);
      241    15111
      242    15112    1      ERRVAL(3) = K$NPDU_FIXED.TYPE;       /* for the errlogger        */
      243    15113
      244    15114    1      SEGLENGTH = K$NPDU_FIXED.SEGLENX*256 + K$NPDU_FIXED.SEGLENY;
      245    15115    1      IF SIZE ~= SEGLENGTH THEN
      246    15116    1         CALL SCREECH(PRTCLERR);
      247    15117
      248    15118    1      DATASIZE = SEGLENGTH - LI;
      249    15119    1      LI = LI - LENGTHC(K$NPDU_FIXED);
      250    15120    1      FIXEDSIZ = LENGTHC(K$NPDU_FIXED);
      251    15121    1      CURINDX = FIXEDSIZ;
      252    15122
      253    15123    1      ADDR(DESTINATION.LEN)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1);
      254    15124    1      IF DESTINATION.LEN > LI THEN
      255    15125    1         CALL SCREECH(PRTCLERR);
      256    15126
      257    15127    1      D$ = ADDR(DESTINATION);
      258    15128    1      DSTINDX = CURINDX + 1; /* save the start of the destination address */
      259    15129    2      DO I = 1 TO DESTINATION.LEN;
      260    15130    2         SUBSTR(D$->ADDRESS,I,1) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX+I,1);
      261    15131    2         END;
      262    15132    1      CURINDX = CURINDX + I;
      263    15133
      264    15134    1      LI = LI - (DESTINATION.LEN+1);
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:10   
      265    15135
      266    15136    1      ADDR(SOURCE.LEN)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1);
      267    15137    1      SRCINDX = CURINDX+1;  /* save the start of the source address    */
      268    15138
      269    15139    1      IF SOURCE.LEN > LI THEN
      270    15140    1         CALL SCREECH(PRTCLERR);
      271    15141
      272    15142    1      D$ = ADDR(SOURCE);
      273    15143    2      DO I = 1 TO SOURCE.LEN;
      274    15144    2         SUBSTR(D$->ADDRESS,I,1) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX+I,1);
      275    15145    2         END;
      276    15146
      277    15147    1      CURINDX = CURINDX + I;
      278    15148
      279    15149    1      LI = LI - (SOURCE.LEN+1);
      280    15150
      281    15151        /*
      282    15152             The address are now ready to use.  From now on we can send error pdus
      283    15153             set up netparm to send errcode.
      284    15154        */
      285    15155
      286    15156
      287    15157    1      KN$NETPARM.DST_ADDR$ = ADDR(DESTINATION);
      288    15158    1      KN$NETPARM.SRC_ADDR$ = ADDR(SOURCE);
      289    15159
      290    15160    1      IF K$NPDU_FIXED.PROTOCOLID ~= %K_PRTCL_ID OR
      291    15161    2        K$NPDU_FIXED.VERSION ~= %K_PRTCL_ID_EXT THEN DO;
      292    15162    2         KN$NETPARM.ERRCODE = %K_DSCRD_HDRSNTX;
      293    15163    2         ERR_CODE = E_DSCRD_HDRSNTX;
      294    15164    2         GOTO ERR;
      295    15165    2         END;
      296    15166
      297    15167    2      IF K$NPDU_FIXED.CHECKSUMX ~= 0 OR K$NPDU_FIXED.CHECKSUMY ~= 0 THEN DO;
      298    15168    2         I = K$NPDU_FIXED.LENGTH;
      299    15169    3         CALL KNA$CHK_CHKSUM(ADDR(K$NPDU_FIXED),I) WHENALTRETURN DO;
      300    15170    3            KN$NETPARM.ERRCODE = %K_DSCRD_IC;
      301    15171    3            ERR_CODE = E_DSCRD_IC;
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:11   
      302    15172    3            GOTO ERR;
      303    15173    3            END;
      304    15174    2         END;
      305    15175
      306    15176    2      IF K$NPDU_FIXED.MS AND K$NPDU_FIXED.SP = '0'B THEN DO;
      307    15177    2         KN$NETPARM.ERRCODE = %K_DSCRD_CANTSEG;
      308    15178    2         ERR_CODE = E_DSCRD_CANTSEG;
      309    15179    2         GOTO ERR;
      310    15180    2         END;
      311    15181
      312    15182    2      IF K$NPDU_FIXED.SP = '0'B THEN DO;
      313    15183    2         SEGMENT.TOTLEN = SEGLENGTH;
      314    15184    2         SEGMENT.DATAID = 0;
      315    15185    2         SEGMENT.OFFSET = 0;
      316    15186    2         END;
      317    15187    2      ELSE DO;
      318    15188    3         IF LI < LENGTHC(K$NPDU_SEGMENT) THEN DO;
      319    15189    3            KN$NETPARM.ERRCODE = %K_DSCRD_HDRSNTX;
      320    15190    3            ERR_CODE = E_DSCRD_HDRSNTX;
      321    15191    3            GOTO ERR;
      322    15192    3            END;
      323    15193
      324    15194        /*
      325    15195             segment part at this point has got to be present.  otherwise we would have
      326    15196             returned.
      327    15197        */
      328    15198    3         DO I = 0 TO LENGTHC(K$NPDU_SEGMENT)-1;
      329    15199    3            SUBSTR(ADDR(SEGMENT.DATAID)->ADDRESS,I,1) = SUBSTR(ADDR(K$NPDU_FIXED)->
             15199                     ADDRESS,CURINDX+I,1);
      330    15200    3            END;
      331    15201    2         CURINDX = LENGTHC(K$NPDU_SEGMENT);
      332    15202    2         LI = LI - LENGTHC(SEGMENT);
      333    15203    2         END;
      334    15204
      335    15205    2      IF K$NPDU_FIXED.LIFETIME = 0 THEN DO;
      336    15206    2         KN$NETPARM.ERRCODE = %K_DSCRD_LIFEEXPTRAN;
      337    15207    2         ERR_CODE = E_DSCRD_LIFEEXPTRAN;
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:12   
      338    15208    2         GOTO ERR;
      339    15209    2         END;
      340    15210
      341    15211        /*
      342    15212             parse the options.
      343    15213        */
      344    15214
      345    15215
      346    15216    2      DO WHILE LI > 2;
      347    15217    2         ADDR(CODE)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1);
      348    15218    2         CURINDX = CURINDX + 1;
      349    15219    2         ADDR(OPTSZ)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1);
      350    15220    2         CURINDX = CURINDX + 1;
      351    15221    2         LI = LI-2-OPTSZ;
      352    15222    3         IF LI < 0 THEN DO;
      353    15223    3            KN$NETPARM.ERRCODE = %K_DSCRD_HDRSNTX;
      354    15224    3            ERR_CODE = E_DSCRD_HDRSNTX;
      355    15225    3            GOTO ERR;
      356    15226    3            END;
      357    15227
      358    15228    3         DO CASE(CODE);
      359    15229
      360    15230    3            CASE(%K_NPRM_PAD); /* pad characters to get header to a byte boundry*/
      361    15231
      362    15232    3            CASE(%K_NPRM_SEC);             /* security                 */
      363    15233    3            KN$NETPARM.ERRCODE = %K_DSCRD_OPTSEC;
      364    15234    3            ERR_CODE = E_DSCRD_OPTSEC;
      365    15235    3            GOTO ERR;
      366    15236
      367    15237    3            CASE(%K_NPRM_SRCRTE);          /* source routing           */
      368    15238    3            ADDR(OPTVAL)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1);
      369    15239        /*
      370    15240                partial source routing options are accepted but not implemented.
      371    15241                complete source routing pdus are discarded.
      372    15242        */
      373    15243    4            IF OPTVAL ~= %K_NPRM_SRCRTE_PSR THEN DO;
      374    15244    4               KN$NETPARM.ERRCODE = %K_DSCRD_OPTSRCRTE;
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:13   
      375    15245    4               ERR_CODE = E_DSCRD_OPTSRCRTE;
      376    15246    4               GOTO ERR;
      377    15247    4               END;
      378    15248
      379    15249    3            CASE(%K_NPRM_RECRTE);          /* record route             */
      380    15250    3            ADDR(OPTVAL)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1);
      381    15251    4            IF OPTVAL ~= %K_NPRM_RECRTE_PRR THEN DO;
      382    15252    4               KN$NETPARM.ERRCODE = %K_DSCRD_OPTRECRTE;
      383    15253    4               ERR_CODE = E_DSCRD_OPTRECRTE;
      384    15254    4               GOTO ERR;
      385    15255    4               END;
      386    15256
      387    15257    3            CASE(%K_NPRM_QOS);
      388    15258
      389    15259    3            CASE(%K_NPRM_PRIO);
      390    15260
      391    15261    3            CASE(ELSE);
      392    15262    3            KN$NETPARM.ERRCODE = %K_DSCRD_OPTNON;
      393    15263    3            ERR_CODE = E_DSCRD_OPTNON;
      394    15264    3            GOTO ERR;
      395    15265
      396    15266    3            END;                           /* case                     */
      397    15267    2         CURINDX = CURINDX + OPTSZ;
      398    15268    2         END;                              /* do while                 */
      399    15269    1      KN$NETPARM.THDRSZ = KN$NETPARM.NHDRSZ - K$NPDU_FIXED.LENGTH;
      400    15270    1      KN$NETPARM.THDR_C$ = PINCRC(KN$NETPARM.NHDR$,K$NPDU_FIXED.LENGTH);
      401    15271        /*
      402    15272          the message is now ready to be routed.  If this is the first hop from a host
      403    15273          node then transport has to be called to allow transport to complete its
      404    15274          context.  If it is the last hop before a host node transport must again be called.
      405    15275          Other cases are as follows:
      406    15276             if destination address is x121
      407    15277                search osiaddress list
      408    15278                if address is present get node/link#s.
      409    15279                   if node is our node
      410    15280                      build fpt
      411    15281                      call knh$send.
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:14   
      412    15282                   else
      413    15283                      find route
      414    15284                      if route available forward;else error noroute.
      415    15285                else search the link laddr list
      416    15286                   if addr present then
      417    15287                      get dstnode# out of dsp.
      418    15288                      if dstnode# our node# then call transport.
      419    15289                      else if dstnode# is link and host call recv4_host
      420    15290                           get route
      421    15291                           call knh$send
      422    15292                   else
      423    15293                      error(noroute)
      424    15294                else if cp6 addr and not type fep then send error(noroute)
      425    15295                     else
      426    15296                         get dstnode#
      427    15297                         if route available call knh$send.
      428    15298        */
      429    15299    2      CALL KNN$DECODE_NSAP(SOURCE,SRCROUTE) WHENALTRETURN DO;
      430    15300    2         RETURN;                 /* discard invalid source address     */
      431    15301    2         END;
      432    15302
      433    15303    1      KN$NETPARM.RECTYPE = K$NPDU_FIXED.LENGTH;
             15303               /* send full network header on error pdu */
      434    15304    2      CALL KNN$DECODE_NSAP(DESTINATION,DSTROUTE) WHENALTRETURN DO;
      435    15305    2         KN$NETPARM.ERRCODE = %K_DSCRD_DSTUNKNWN;
      436    15306    2         ERR_CODE = E_DSCRD_DSTUNKNWN;
      437    15307    2         GOTO ERR;
      438    15308    2         END;
      439    15309
      440    15310
      441    15311    2      IF DSTROUTE.FEP# > KNN_NODES THEN DO;
      442    15312    2         KN$NETPARM.ERRCODE = %K_DSCRD_DSTUNKNWN;
      443    15313    2         ERR_CODE = E_DSCRD_DSTUNKNWN;
      444    15314    2         GOTO ERR;
      445    15315    2         END;
      446    15316
      447    15317    2      IF DSTROUTE.QOS = 255 AND DSTROUTE.FEP# ~= KN_NODE# THEN DO;
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:15   
      448    15318    2         KN$NETPARM.ERRCODE = %K_DSCRD_DSTUNREACH;
      449    15319    2         ERR_CODE = E_DSCRD_DSTUNREACH;
      450    15320    2         GOTO ERR;
      451    15321    2         END;
      452    15322
      453    15323        /*
      454    15324             if both the source and destination nodes are link connected and host nodes
      455    15325             then do not call transport, do not pass go and do not collect $200.  Instead
      456    15326             send the message as is.
      457    15327        */
      458    15328    1      IF DSTROUTE.NS_TYPE = %K_TYPE_LNSAP AND
      459    15329    1        SRCROUTE.NS_TYPE = %K_TYPE_LNSAP AND
      460    15330    1        DSTROUTE.FEP# = SRCROUTE.FEP# AND
      461    15331    2        DSTROUTE.HOST# < KNN_NODES AND SRCROUTE.HOST# < KNN_NODES THEN DO;
      462    15332                                                /* no transport needed      */
      463    15333    2         IF KNN$ROUTE$(DSTROUTE.HOST#)->KNN$ROUTE.FLAGS.HOST_NODE
      464    15334    3           AND KNN$ROUTE$(SRCROUTE.HOST#)->KNN$ROUTE.FLAGS.HOST_NODE THEN DO;
      465    15335    3            ROUTE$ = KNN$ROUTE$(DSTROUTE.FEP#);
      466    15336    3            LINK$ = KNN$ROUTE.LINK$;
      467    15337    4            IF KNN$ROUTE.LINK$ = ADDR(NIL) OR KNN$LINK.LDCT$ = ADDR(NIL) THEN DO;
      468    15338    4               KN$NETPARM.ERRCODE = %K_DSCRD_DSTUNREACH;
      469    15339    4               ERR_CODE = E_DSCRD_DSTUNREACH;
      470    15340    4               GOTO ERR;
      471    15341    4               END;
      472    15342    3            KN$NETPARM.FPT$ = ADDR(NIL);
      473    15343    3            KN$NETPARM.LDCT$ = KNN$LINK.LDCT$;
      474    15344    3            CALL FORWARD ALTRET(ERR2);
      475    15345    3            GOTO EXITOSINET;
      476    15346    3            END;
      477    15347    2         END;                              /* src.fep# = dst.fep#      */
      478    15348
      479    15349        /*
      480    15350             if the destination node# is our node and the address was in the ositable
      481    15351             then this message is to be forwared to that link.
      482    15352        */
      483    15353
      484    15354
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:16   
      485    15355    2      IF DSTROUTE.FEP# = KN_NODE# THEN DO;
      486    15356        /*
      487    15357             check the pdu type if it is data forward it to the correct node.
      488    15358             if it is an error pdu generate an errorlog entry for it.
      489    15359             if it is those one of the amazing dynamic routing pdu discard it.
      490    15360        */
      491    15361    3         IF K$NPDU_FIXED.TYPE ~= %K_DT_PDU THEN DO;
      492    15362    4            IF K$NPDU_FIXED.TYPE = %K_ER_PDU THEN DO;
      493    15363    4               SUBSTR(ADDR(I)->ADDRESS,0,2) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,
             15363                        CURINDX,2);
      494    15364    4               CURINDX = CURINDX + 2;      /* size of errcode field    */
      495    15365    4               SIZE = MINIMUM(CURINDX,KN$NETPARM.NHDRSZ);
      496    15366    5               DO CASE (I);
      497    15367    5                  CASE(%K_DSCRD_RNS);      /* Reason not specified     */
      498    15368    5                  ERR_CODE = E_DSCRD_RNS;
      499    15369    5                  CASE(%K_DSCRD_PPE);      /* Protocol procedure error */
      500    15370    5                  ERR_CODE = E_DSCRD_PPE;
      501    15371    5                  CASE(%K_DSCRD_IC);       /* Incorrect checksum       */
      502    15372    5                  ERR_CODE = E_DSCRD_IC;
      503    15373    5                  CASE(%K_DSCRD_CONGEST); /* Pdu discarded due to congestion */
      504    15374    5                  ERR_CODE = E_DSCRD_CONGEST;
      505    15375    5                  CASE(%K_DSCRD_HDRSNTX);  /* Pdu header syntax error  */
      506    15376    5                  ERR_CODE = E_DSCRD_HDRSNTX;
      507    15377    5                  CASE(%K_DSCRD_CANTSEG); /* Segmentation needed but not permitted */
      508    15378    5                  ERR_CODE = E_DSCRD_CANTSEG;
      509    15379    5                  CASE(%K_DSCRD_INCMPPDU); /* Incomlete pdu received   */
      510    15380    5                  ERR_CODE = E_DSCRD_INCMPPDU;
      511    15381    5                  CASE(%K_DSCRD_DUPOPT);   /* Duplicate option         */
      512    15382    5                  ERR_CODE = E_DSCRD_DUPOPT;
      513    15383    5                  CASE(%K_DSCRD_DSTUNREACH); /* Destination reachable  */
      514    15384    5                  ERR_CODE = E_DSCRD_DSTUNREACH;
      515    15385    5                  CASE(%K_DSCRD_DSTUNKNWN); /* Destination unknown*/
      516    15386    5                  ERR_CODE = E_DSCRD_DSTUNKNWN;
      517    15387    5                  CASE(%K_DSCRD_SRCRTEERR); /* Unspecifed source routing error*/
      518    15388    5                  ERR_CODE = E_DSCRD_SRCRTEERR;
      519    15389    5                  CASE(%K_DSCRD_SRCRTESNTX); /* Syntax error in source routing field */
      520    15390    5                  ERR_CODE = E_DSCRD_SRCRTESNTX;
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:17   
      521    15391    5                  CASE(%K_DSCRD_SRCRTEUNKWN);
             15391                           /* Unknown address in source routing field */
      522    15392    5                  ERR_CODE = E_DSCRD_SRCRTEUNKWN;
      523    15393    5                  CASE(%K_DSCRD_PTHNOTACPT); /* Path not acceptable*/
      524    15394    5                  ERR_CODE = E_DSCRD_PTHNOTACPT;
      525    15395    5                  CASE(%K_DSCRD_LIFEEXPTRAN); /* Lifetime expired in transit*/
      526    15396    5                  ERR_CODE = E_DSCRD_LIFEEXPTRAN;
      527    15397    5                  CASE(%K_DSCRD_LIFEEXPASSM); /* Lifetime expired during assembly */
      528    15398    5                  ERR_CODE = E_DSCRD_LIFEEXPASSM;
      529    15399    5                  CASE(%K_DSCRD_OPTNON); /* Unsupported option not specified */
      530    15400    5                  ERR_CODE = E_DSCRD_OPTNON;
      531    15401    5                  CASE(%K_DSCRD_OPTPRCLVERS); /* Unsupported protocol version*/
      532    15402    5                  ERR_CODE = E_DSCRD_OPTPRCLVERS;
      533    15403    5                  CASE(%K_DSCRD_OPTSEC); /* Unsupported security option*/
      534    15404    5                  ERR_CODE = E_DSCRD_OPTSEC;
      535    15405    5                  CASE(%K_DSCRD_OPTSRCRTE); /* Unsupported source routing option*/
      536    15406    5                  ERR_CODE = E_DSCRD_OPTSRCRTE;
      537    15407    5                  CASE(%K_DSCRD_OPTRECRTE); /* Unsupported recording route option*/
      538    15408    5                  ERR_CODE = E_DSCRD_OPTRECRTE;
      539    15409    5                  CASE(%K_DSCRD_REASSEM);  /* Reassembly interface     */
      540    15410    5                  ERR_CODE = E_DSCRD_REASSEM;
      541    15411    5                  CASE(ELSE);
      542    15412    5                  ERR_CODE = E_DSCRD_RNS;
      543    15413    5                  END;                     /* do case (err_code)*/
      544    15414    4               ADDR(ERRVAL(0))->CALLEDFROM$ = ENTADDR(KNN$RECVOSI);
      545    15415    4               CALL GHE$ERRLOG(ERR_CODE,ERRVAL,K$NPDU_FIXED,SIZEC(K$NPDU_FIXED),'0'B);
      546    15416    4               GOTO EXITOSINET;
      547    15417    4               END;
      548    15418    3            ELSE
      549    15419    4               IF K$NPDU_FIXED.TYPE ~= %K_ESH_PDU OR K$NPDU_FIXED.TYPE ~= %K_ISH_PDU
             15419                        THEN DO;
      550    15420    4                  KN$NETPARM.ERRCODE = %K_DSCRD_HDRSNTX;
      551    15421    4                  ERR_CODE = E_DSCRD_HDRSNTX;
      552    15422    4                  GOTO ERR;
      553    15423    4                  END;
      554    15424
      555    15425    3            END;
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:18   
      556    15426
      557    15427    3         IF DSTROUTE.NS_TYPE = %K_TYPE_LNSAP THEN DO;
      558    15428        /*
      559    15429             the destination address is one of our addresses.  make sure that the
      560    15430             destination node specified is a host and that it is link connected
      561    15431        */
      562    15432    3            IF DSTROUTE.HOST# > KNN_NODES
      563    15433    3              OR NOT KNN$ROUTE$(DSTROUTE.HOST#)->KNN$ROUTE.FLAGS.LINK_CONNECTED
      564    15434    3              OR NOT KNN$ROUTE$(DSTROUTE.HOST#)->KNN$ROUTE.FLAGS.HOST_NODE
      565    15435    3              OR DSTROUTE.QOS = 255
      566    15436    3              OR KNN$ROUTE$(DSTROUTE.HOST#)->KNN$ROUTE.LINK$ = ADDR(NIL)
      567    15437    3              OR KNN$ROUTE$(DSTROUTE.HOST#)->KNN$ROUTE.LINK$->KNN$LINK.LDCT$ = ADDR(NIL
             15437                       )
      568    15438    4            THEN DO;
      569    15439    4               KN$NETPARM.ERRCODE = %K_DSCRD_DSTUNREACH;
      570    15440    4               ERR_CODE = E_DSCRD_DSTUNREACH;
      571    15441    4               GOTO ERR;
      572    15442    4               END;
      573    15443
      574    15444    3            KN$NETPARM.FUNCTION = %K_NDATA;
      575    15445    4            IF K$NPDU_FIXED.MS = '0'B AND SEGMENT.TOTLEN = SEGLENGTH THEN DO;
      576    15446    4               KN$NETPARM.NODE = DSTROUTE.HOST#;
      577    15447    5               CALL KNT$RECV_4HOST(KN$NETPARM) WHENRETURN DO;
      578    15448    5                  KN$NETPARM.THDRSZ = 0;
      579    15449    5                  END;
      580    15450    5               WHENALTRETURN DO;
      581    15451    5                  IF KN$NETPARM.ERRCODE ~= 0 THEN GOTO ERR2; /*altret*/
      582    15452    5                  ELSE                /* message buffered by trans     */
      583    15453    5                     GOTO EXITOSINET;
      584    15454    5                  END;
      585    15455    4               KN$NETPARM.LDCT$ = KNN$ROUTE$(DSTROUTE.HOST#)->KNN$ROUTE.LINK$->KNN$LINK
             15455                        .LDCT$;
      586    15456    4               NQDP_HDR = K$NQDP_HDR_C;
      587    15457    4               NQDP_HDR.DEST_NODE = DSTROUTE.HOST#+1;
      588    15458    4               NQDP_HDR.SOURCE_NODE = SRCROUTE.FEP#+1;
      589    15459    4               KN$NETPARM.NHDR$ = ADDR(NQDP_HDR);
      590    15460    4               KN$NETPARM.NHDRSZ = LENGTHC(NQDP_HDR);
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:19   
      591    15461    4               KN$NETPARM.UHDRSZ = 0;
      592    15462    4               KN$NETPARM.LDCT$ = KNN$ROUTE$(DSTROUTE.HOST#)->KNN$ROUTE.LINK$->KNN$LINK
             15462                        .LDCT$;
      593    15463    4               CALL FORWARD ALTRET(ERR2);
      594    15464    4               GOTO EXITOSINET;
      595    15465    4               END;
      596    15466    4            ELSE DO;
      597    15467    4               KN$NETPARM.NODE = DSTROUTE.HOST#;
      598    15468    5               CALL KNN$REASSEM(KN$NETPARM,DSTROUTE,SRCROUTE) WHENALTRETURN DO;
      599    15469    5                  IF KN$NETPARM.ERRCODE = 0 THEN
      600    15470        /*
      601    15471           message complete and delivered to transport and forwarded to the host.
      602    15472        */
      603    15473    5                     GOTO EXITOSINET;
      604    15474    5                  IF KN$NETPARM.ERRCODE = %K_DSCRD_REASSEM THEN
      605    15475    5                     ERR_CODE = E_DSCRD_REASSEM;
      606    15476    5                  ELSE
      607    15477    5                     ERR_CODE = E_DSCRD_CANTSEG;
      608    15478    5                  GOTO ERR;
      609    15479    5                  END;
      610    15480    4               END;
      611    15481    3            END;                           /* if dstforhost            */
      612    15482    3         ELSE DO;                          /* else type = rnsap        */
      613    15483             /*
      614    15484             search vc list for a currently active connection
      615    15485             */
      616    15486    4            DO J = 0 TO KNN_LINKS - 1;
      617    15487    4               LINK$ = KNN$LINK$(J);
      618    15488    4               IF KNN$LINK.FLAGS.VIRCIR
      619    15489    4                 AND KNN$LINK.NODE# >= %K_CNC_IS#
      620    15490    5                 AND DSTROUTE.SNPA.LEN = KNN$LINK.SNPA.LEN THEN DO;
      621    15491    5                  SNPATMPLT1 = DSTROUTE.SNPA.ADDRESS;
      622    15492    5                  SNPATMPLT3 = KNN$LINK.SNPA.ADDRESS;
      623    15493    6                  DO I = 0 TO DSTROUTE.SNPA.LEN - 1;
      624    15494    6                     IF SNPATMPLT2.NIBBLES.NIB(I) ~= SNPATMPLT4.NIBBLES.NIB(I) THEN
      625    15495    6                        GOTO NXTJ;
      626    15496    6                     END;                  /* i = 0 to len-1           */
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:20   
      627    15497    5                  KN$NETPARM.LDCT$ = KNN$LINK.LDCT$;
      628    15498    5                  CALL FORWARD ALTRET(ERR2);
      629    15499    5                  GOTO EXITOSINET;
      630    15500    5                  END;                     /*  if vircir et al         */
      631    15501    4   NXTJ:       ;
      632    15502    4               END;                        /* do j = 0 to knn_links    */
      633    15503                /*
      634    15504                no vc connection currently running.  try to find a substr match
      635    15505                */
      636    15506    4            DO J = 0 TO KNN_LINKS - 1;
      637    15507    4               LINK$ = KNN$LINK$(J);
      638    15508    5               IF NOT KNN$LINK.FLAGS.VIRCIR AND KNN$LINK.NODE# >= %K_CNC_IS# THEN DO;
      639    15509    5                  SNPATMPLT1 = DSTROUTE.SNPA.ADDRESS;
      640    15510    5                  SNPATMPLT3 = KNN$LINK.SNPA.ADDRESS;
      641    15511    6                  DO I = 0 TO MINIMUM(DSTROUTE.NSAP.LEN,KNN$LINK.SNPA.LEN)-1;
      642    15512    6                     IF SNPATMPLT2.NIBBLES.NIB(I) ~= SNPATMPLT4.NIBBLES.NIB(I) THEN
      643    15513    6                        GOTO NXTJ2;
      644    15514    6                     END;             /* do i = 0 to min(len,len)-1    */
      645    15515    5                  FPT_NSAP.NSAP.LEN = DSTROUTE.SNPA.LEN;
      646    15516    5                  FPT_NSAP.NSAP.ADDRESS = DSTROUTE.SNPA.ADDRESS;
      647    15517    5                  KN$NETPARM.FPT$ = ADDR(FPT_NSAP);
      648    15518    5                  KN$NETPARM.LDCT$ = KNN$LINK.LDCT$;
      649    15519    5                  CALL FORWARD ALTRET(ERR2);
      650    15520    5                  GOTO EXITOSINET;
      651    15521    5                  END;                     /* not vc and node# > is    */
      652    15522    4   NXTJ2:      ;
      653    15523    4               END;                   /* do j = 0 to knn_links - 1     */
      654    15524    3            END;                           /* else type = rnsap        */
      655    15525    2         END;                              /* If dstnode = KN_NODE#    */
      656    15526    2      ELSE DO;                   /* message not bound for our node     */
      657    15527
      658    15528    2         ROUTE$ = KNN$ROUTE$(DSTROUTE.FEP#);
      659    15529    2         LINK$ = KNN$ROUTE.LINK$;
      660    15530
      661    15531    2         IF KNN$ROUTE.CURRENT_QOS = 255
      662    15532    3           OR KNN$ROUTE.LINK$ = ADDR(NIL) OR KNN$LINK.LDCT$ = ADDR(NIL) THEN DO;
      663    15533    3            KN$NETPARM.ERRCODE = %K_DSCRD_DSTUNREACH;
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:21   
      664    15534    3            ERR_CODE = E_DSCRD_DSTUNREACH;
      665    15535    3            GOTO ERR;
      666    15536    3            END;
      667    15537    2         KN$NETPARM.LDCT$ = KNN$LINK.LDCT$;
      668    15538    2         CALL FORWARD ALTRET(ERR2);
      669    15539    2         END;               /* else message not bound for this node    */
      670    15540
      671    15541    1      GOTO EXITOSINET;
      672    15542
      673    15543    1   ERR:; /* message is to be discarded and a error pdu generated if possible*/
      674    15544    1      ADDR(ERRVAL(0))->CALLEDFROM$ = ENTADDR(KNN$RECVOSI);
      675    15545    1      CALL GHE$ERRLOG(ERR_CODE,ERRVAL,K$NPDU_FIXED,SIZEC(K$NPDU_FIXED),'0'B);
      676    15546        /*
      677    15547                switch the source and destination so that senderr
      678    15548                will send the error back to the bad pdus originator
      679    15549        */
      680    15550    1      KN$NETPARM.NODE = SRCROUTE.FEP#;
      681    15551    1      KN$NETPARM.SRC_ADDR$ = ADDR(DESTINATION);
      682    15552    1      KN$NETPARM.DST_ADDR$ = ADDR(SOURCE);
      683    15553    1      CALL KNN$SENDERR(KN$NETPARM);
      684    15554
      685    15555    1   EXITOSINET:;
      686    15556    1      KN$NETPARM.RECTYPE = 0; /* was set to indicate index at which error occurred*/
      687    15557    1      KN$NETPARM.FPT$ = SAVE_FPT$;
      688    15558    1      KN$NETPARM.LDCT$ = QQQ$;
      689    15559    1      RETURN;
      690    15560
      691    15561    1   ERR2:;                                  /* dont discard message, yet*/
      692    15562    1      KN$NETPARM.LDCT$ = QQQ$;
      693    15563    1      KN$NETPARM.FPT$ = SAVE_FPT$;
      694    15564    1      KN$NETPARM.RECTYPE = 0;
      695    15565    1      ALTRETURN;
      696    15566        %EJECT;
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:22   
      697    15567    1   FORWARD: PROC ALTRET;
      698    15568
      699    15569    3      IF KN$NETPARM.LDCT$ = ADDR(NIL) THEN DO;
      700    15570    3         KN$NETPARM.ERRCODE = %K_DSCRD_DSTUNREACH;
      701    15571    3         ERR_CODE = E_DSCRD_DSTUNREACH;
      702    15572    3         GOTO SENDERR;
      703    15573    3         END;
      704    15574    3      CALL KNH$SEND(KN$NETPARM) WHENALTRETURN DO;
      705    15575    4         IF KN$NETPARM.ERRCODE = %KN_ERR_Q2SMALL THEN DO;
      706    15576    4            KN$NETPARM.ERRCODE = %K_DSCRD_CONGEST; /* should really seg*/
      707    15577    4            ERR_CODE = E_DSCRD_CONGEST;
      708    15578    4   SENDERR: ;
      709    15579    4            ADDR(ERRVAL(0))->CALLEDFROM$ = ENTADDR(KNN$RECVOSI);
      710    15580    4            CALL GHE$ERRLOG(ERR_CODE,ERRVAL,K$NPDU_FIXED,SIZEC(K$NPDU_FIXED),'0'B);
      711    15581    4            KN$NETPARM.NODE = SRCROUTE.FEP#;
      712    15582    4            KN$NETPARM.SRC_ADDR$ = ADDR(SOURCE);
      713    15583    4            KN$NETPARM.DST_ADDR$ = ADDR(DESTINATION);
      714    15584    4            CALL KNN$SENDERR(KN$NETPARM);
      715    15585    4            END;
      716    15586    3         ELSE
      717    15587    3            ALTRETURN;
      718    15588    3         END;                              /* whenaltreturn            */
      719    15589    2   END FORWARD;
      720    15590    1   END KNN$RECVOSI;
      721    15591        %EOD;

PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:23   
--  Include file information  --

   K_QDPHDRS_M.:E05TOU  is referenced.
   KN_ERRORS_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   K_INTERFACE_M.:E05TOU  is referenced.
   KN_DATA_M.:E05TOU  is referenced.
   KNN_NETWORK_M.:E05TOU  is referenced.
   K_SCODE_C.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   K_NETWORK_E.:E05TOU  is referenced.
   K_NETWORK_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KNN$RECVOSI.

   Procedure KNN$RECVOSI requires 1928 words for executable code.
   Procedure KNN$RECVOSI requires 154 words of local(AUTO) storage.

PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:24   

 Object Unit name= KNN$RECVOSI                                File name= KNN$SUBS.:E05TOU
 UTS= JUL 30 '97 01:05:06.68 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS     49     31  KNN$RECVOSI
    1   Proc  even  none  1928    788  KNN$RECVOSI
    2  RoData even  none     2      2  KNN$RECVOSI

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  KNN$RECVOSI

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 SCREECH
 yes     yes           Std       1 KNT$RECV_4HOST
 yes     yes           Std       2 KNA$CHK_CHKSUM
 yes     yes           Std       2 KNN$DECODE_NSAP
 yes     yes           Std       1 KNN$SENDERR
 yes     yes           Std       5 GHE$ERRLOG
 yes     yes           Std       3 KNN$REASSEM
 yes     yes           Std       1 KNH$SEND
 yes     yes           Std       1 KNN$RECVOSI
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET
                       nStd      0 X6B_BLR
                       nStd      0 X6A_AALT
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:25   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KNN_NODES                             KN_NODE#                              KNN_ROUTE$$
     KNN_LINKS                             KNN_LINK$$                       r    G$ROS$
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:26   


        1        1        /*M* KNN$RECVOSI - OSI network message decoder  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=3,ENU=0,ECU=0,CRM=70,CCC=YES,CSI=3,CTI=2,DCI=3,ECI=3,ENI=3,SDI=3 */
        8        8        /*P*    NAME:   KNN$RECVOSI
        9        9                PURPOSE: This module contains the procedure to decode OSI
       10       10                         network layer messages.
       11       11        */
       12       12
       13       13
       14       14        /*F*  NAME:    KNN$RECVOSI
       15       15
       16       16              PURPOSE: decode network pdus
       17       17              DESCRIPTION:
       18       18        */
       19       19
       20       20        %EJECT;
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:27   
       21       21        KNN$RECVOSI: PROC(KN$NETPARM) ALTRET;

     21   1 000000  D380 0000 0000  xent KNN$RECVOSI     LNJ,B5   X6A_AUTO_1
          1 000003       009A 0001                       DC       154,1

       22       22
       23       23        %INCLUDE LCP_6;
       24     4302        %INCLUDE K_NETWORK_M;
       25     4571        %INCLUDE K_NETWORK_E;
       26     4660        %INCLUDE KNH_MACRO_C;
       27     4943        %INCLUDE K_ADDRESS_M;
       28     5446        %INCLUDE K_SCODE_C;
       29     5531        %INCLUDE KNN_NETWORK_M;
       30     5894        %INCLUDE KN_DATA_M;
       31     7680        %INCLUDE K_INTERFACE_M;
       32     8089        %INCLUDE KL_MACRO_C;
       33    11441        %INCLUDE KN_ERRORS_C;
       34    11505        %INCLUDE K_QDPHDRS_M;
       35    12387
       36    12388        %KN$NETPARM(NAME=KN$NETPARM,STCLASS="");
       37    12541
       38    12542    1   DCL KNN$SENDERR ENTRY(1) ALTRET;
       39    12543    1   DCL KNA$CHK_CHKSUM ENTRY(2) ALTRET;
       40    12544    1   DCL KNA$CALC_CHKSUM ENTRY(3) ALTRET;
       41    12545    1   DCL KNT$SEND_4HOST ENTRY(1) ALTRET;
       42    12546    1   DCL KNT$RECV_4HOST ENTRY(1) ALTRET;
       43    12547    1   DCL KNN$REASSEM ENTRY(3) ALTRET;
       44    12548    1   DCL KNN$DECODE_NSAP ENTRY(2) ALTRET;
       45    12549    1   DCL KNH$SEND ENTRY(1) ALTRET;
       46    12550    1   DCL SCREECH ENTRY(1);
       47    12551    1   DCL GHE$ERRLOG ENTRY(5) ALTRET;
       48    12552
       49    12553    1   DCL KNN_NODES UBIN SYMREF;
       50    12554    1   DCL KN_NODE# UBIN SYMREF;
       51    12555    1   DCL KNN_ROUTE$$ PTR SYMREF;
       52    12556    1   DCL KNN_LINKS UBIN SYMREF;
       53    12557    1   DCL KNN_LINK$$ PTR SYMREF;
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:28   
       54    12558    1   DCL KNN_OSIROUTE$$ PTR SYMREF;
       55    12559    1   DCL KNN_OSIMAX# UBIN SYMREF;
       56    12560    1   DCL KNN_OSIROUTE# UBIN SYMREF;
       57    12561
       58    12562        %K$NPDU_FIXED(STCLASS="BASED(KN$NETPARM.NHDR$)");
       59    12619        %K$NPDU_SEGMENT;
       60    12671        %K$NSAP(ADRTYP=NET);
       61    12723        %KNN$LINK(STCLASS="BASED(LINK$)");
       62    12974        %KNN$ROUTE(STCLASS="BASED(ROUTE$)");
       63    13046    1   DCL KNN$ROUTE$(0:0) PTR BASED(KNN_ROUTE$$);
       64    13047    1   DCL KNN$LINK$(0:0) PTR BASED(KNN_LINK$$);
       65    13048    1   DCL ADDRESS CHAR(SIZE) BASED;
       66    13049    1   DCL CHR(0:0) CHAR(1) BASED CALIGNED;
       67    13050    1   DCL CALLEDFROM$ EPTR BASED;
       68    13051
       69    13052        %K$NQDP_HDR (NAME=K$NQDP_HDR_C,MSGTYPE=OSI_DATA,ALGN=ALIGNED,STCLASS=CONSTANT);
       70    13129        %VLP_SCODE (FPTN=PRTCLERR,ERR#=%S$PRTCLERR,SEV=G_SEV_SCREECH#,
       71    13130                       STCLASS=CONSTANT,FCG=KN,MID=N,MON='1'B);
       72    13191
       73    13192        %VLP_ERRCODE(FPTN=E_DSCRD_RNS,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13192            %E$DSCRD_RNS);
       74    13238        /*E* ERROR: KNN-E$DSCRD_RNS
       75    13239             MESSAGE: OSI network pdu was discarded and no reason was specified.
       76    13240        */
       77    13241
       78    13242        %VLP_ERRCODE(FPTN=E_DSCRD_PPE,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13242            %E$DSCRD_PPE);
       79    13288        /*E* ERROR: KNN-E$DSCRD_PPE
       80    13289             MESSAGE: OSI network pdu was discarded due to a protocol procedure error
       81    13290        */
       82    13291
       83    13292       %VLP_ERRCODE(FPTN=E_DSCRD_IC,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=%E$DSCRD_IC
             13292            );
       84    13338        /*E* ERROR: KNN-E$DSCRD_IC
       85    13339             MESSAGE: OSI network pdu was discarded due to an Incorrect checksum
       86    13340         */
       87    13341
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:29   
       88    13342        %VLP_ERRCODE(FPTN=E_DSCRD_CONGEST,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13342            %E$DSCRD_CONGEST);
       89    13388        /*E* ERROR: KNN-E$DSCRD_CONGEST
       90    13389             MESSAGE: OSI network pdu was discarded due to system congestion
       91    13390        */
       92    13391
       93    13392        %VLP_ERRCODE(FPTN=E_DSCRD_HDRSNTX,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13392            %E$DSCRD_HDRSNTX);
       94    13438        /*E* ERROR: KNN-E$DSCRD_HDRSNTX
       95    13439             MESSAGE: Syntax error in the network header; pdu was discarded.
       96    13440        */
       97    13441
       98    13442        %VLP_ERRCODE(FPTN=E_DSCRD_CANTSEG,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13442            %E$DSCRD_CANTSEG);
       99    13488        /*E* ERROR: KNN-E$DSCRD_CANTSEG
      100    13489             MESSAGE: segmentation needed but not permitted, pdu was discarded.
      101    13490         */
      102    13491
      103    13492        %VLP_ERRCODE(FPTN=E_DSCRD_INCMPPDU,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13492            %E$DSCRD_INCMPPDU);
      104    13538        /*E* ERROR: KNN-E$DSCRD_INCMPPDU
      105    13539             MESSAGE: An Incomplete pdu was received; pdu was discarded.
      106    13540        */
      107    13541
      108    13542        %VLP_ERRCODE(FPTN=E_DSCRD_DUPOPT,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13542            %E$DSCRD_DUPOPT);
      109    13588        /*E* ERROR: KNN-E$DSCRD_DUPOPT
      110    13589             MESSAGE: duplicate option specified, pdu discarded.
      111    13590        */
      112    13591
      113    13592        %VLP_ERRCODE(FPTN=E_DSCRD_DSTUNREACH,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13592            %E$DSCRD_DSTUNREACH);
      114    13638        /*E* ERROR: KNN-E$DSCRD_DSTUNREACH
      115    13639             MESSAGE: destination unreachable, pdu discarded.
      116    13640        */
      117    13641
      118    13642        %VLP_ERRCODE(FPTN=E_DSCRD_DSTUNKNWN,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:30   
             13642            %E$DSCRD_DSTUNKNWN);
      119    13688        /*E* ERROR: KNN-E$DSCRD_DSTUNKNWN
      120    13689             MESSAGE:  destination unknown, pdu discarded.
      121    13690        */
      122    13691
      123    13692        %VLP_ERRCODE(FPTN=E_DSCRD_SRCRTEERR,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13692            %E$DSCRD_SRCRTEERR);
      124    13738        /*E* ERROR: KNN-E$DSCRD_SRCRTEERR
      125    13739             MESSAGE: Unspecified source routing error, discard pdu.
      126    13740        */
      127    13741
      128    13742        %VLP_ERRCODE(FPTN=E_DSCRD_SRCRTESNTX,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13742            %E$DSCRD_SRCRTESNTX);
      129    13788        /*E* ERROR: KNN-E$DSCRD_SRCRTESNTX
      130    13789             MESSAGE: Syntax error in source routing field, pdu discarded.
      131    13790        */
      132    13791
      133    13792        %VLP_ERRCODE(FPTN=E_DSCRD_SRCRTEUNKWN,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13792            %E$DSCRD_SRCRTEUNKWN);
      134    13838        /*E* ERROR: KNN-E$DSCRD_SRCRTEUNKWN
      135    13839             MESSAGE: Unknown address in source routing field pdu discarded.
      136    13840        */
      137    13841
      138    13842        %VLP_ERRCODE(FPTN=E_DSCRD_PTHNOTACPT,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13842            %E$DSCRD_PTHNOTACPT);
      139    13888        /*E* ERROR: KNN-E$DSCRD_PTHNOTACPT
      140    13889             MESSAGE: Path was not acceptable, pdu was discarded.
      141    13890        */
      142    13891
      143    13892        %VLP_ERRCODE(FPTN=E_DSCRD_LIFEEXPTRAN,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13892            %E$DSCRD_LIFEEXPTRAN);
      144    13938        /*E* ERROR: KNN-E$DSCRD_LIFEEXPTRAN
      145    13939             MESSAGE:  Lifetime expired in transit, pdu was discarded.
      146    13940        */
      147    13941
      148    13942        %VLP_ERRCODE(FPTN=E_DSCRD_LIFEEXPASSM,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13942            %E$DSCRD_LIFEEXPASSM);
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:31   
      149    13988        /*E* ERROR: KNN-E$DSCRD_LIFEEXPASSM
      150    13989             MESSAGE: Lifetime expired during assembly, pdu was discarded.
      151    13990        */
      152    13991
      153    13992        %VLP_ERRCODE(FPTN=E_DSCRD_OPTNON,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             13992            %E$DSCRD_OPTNON);
      154    14038        /*E* ERROR: KNN-E$DSCRD_OPTNON
      155    14039             MESSAGE:  Unsupported option specified, pdu was discarded.
      156    14040        */
      157    14041
      158    14042        %VLP_ERRCODE(FPTN=E_DSCRD_OPTPRCLVERS,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             14042            %E$DSCRD_OPTPRCLVERS);
      159    14088        /*E* ERROR: KNN-E$DSCRD_OPTPRCLVERS
      160    14089             MESSAGE: * Unsupported protocol version specified, pdu was discarded.
      161    14090        */
      162    14091
      163    14092        %VLP_ERRCODE(FPTN=E_DSCRD_OPTSEC,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             14092            %E$DSCRD_OPTSEC);
      164    14138        /*E* ERROR: KNN-E$DSCRD_OPTSEC
      165    14139             MESSAGE:  Unsupported security option, pdu discarded.
      166    14140        */
      167    14141
      168    14142        %VLP_ERRCODE(FPTN=E_DSCRD_OPTSRCRTE,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             14142            %E$DSCRD_OPTSRCRTE);
      169    14188        /*E* ERROR: KNN-E$DSCRD_OPTSRCRTE
      170    14189             MESSAGE:  Unsupported Source routing option, pdu discarded
      171    14190        */
      172    14191
      173    14192        %VLP_ERRCODE(FPTN=E_DSCRD_OPTRECRTE,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             14192            %E$DSCRD_OPTRECRTE);
      174    14238        /*E* ERROR: KNN-E$DSCRD_OPTRECRTE
      175    14239             MESSAGE:  Unsupported record route option, pdu discarded.
      176    14240        */
      177    14241
      178    14242        %VLP_ERRCODE(FPTN=E_DSCRD_REASSEM,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             14242            %E$DSCRD_REASSEM);
      179    14288        /*E* ERROR: KNN-E$DSCRD_REASSEM
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:32   
      180    14289             MESSAGE: Reassembly interface error, pdu discarded.
      181    14290        */
      182    14291
      183    14292        %K$NSAP(FPTN=DESTINATION,STCLASS=AUTO,ADRTYP=NET);
      184    14344        %K$NSAP(FPTN=SOURCE,STCLASS=AUTO,ADRTYP=NET);
      185    14396        %LIST;
      186    14397        %FPT_NSAP(STCLASS=AUTO);
             14398        %LSET LISTDIR='0'B;
             14411    1   DCL 1 FPT_NSAP AUTO ALIGNED,
             14434    1        2 NSAP CALIGNED,
             14436    1     3 LEN UBIN BYTE CALIGNED /*(0)*/,
             14441    1     3 AFI UBIN BYTE UNAL /*(0)*/,
             14464    1        3 ADDRESS_N(0:19) CALIGNED UBIN(8) /*(0*0)*/,
             14465    1        3 ADDRESS REDEF ADDRESS_N CHAR(20) CALIGNED ;
      187    14469        %PLIST;
      188    14470        %K$NPDU_SEGMENT(NAME=SEGMENT,STCLASS=AUTO);
      189    14522        %KL_UPDOSI(FPTN=SRCROUTE,STCLASS=AUTO);/* node#,link# of src address*/
      190    14731        %KL_UPDOSI(FPTN=DSTROUTE,STCLASS=AUTO);/* node#,link# of dst address*/
      191    14940        %K$NQDP_HDR (NAME=NQDP_HDR,MSGTYPE=OSI_DATA,ALGN=ALIGNED,STCLASS=AUTO);
      192    15017
      193    15018        %VLP_ERRCODE(FPTN=ERR_CODE,STCLASS=AUTO);
      194    15064
      195    15065    1   DCL SIZE UBIN;
      196    15066    1   DCL OPTSZ UBIN BYTE;
      197    15067    1   DCL OPTVAL UBIN BYTE;
      198    15068    1   DCL DATASIZE SBIN;
      199    15069    1   DCL FIXEDSIZ UBIN;
      200    15070    1   DCL SEGLENGTH UBIN;
      201    15071    1   DCL D$ PTR;
      202    15072    1   DCL QQQ$ PTR;
      203    15073    1   DCL SAVE_FPT$ PTR;
      204    15074    1   DCL LINK$ PTR;
      205    15075    1   DCL ROUTE$ PTR;
      206    15076    1   DCL CURINDX UBIN;                       /*  is index into npdu      */
      207    15077    1   DCL DSTINDX UBIN; /* index into k$npdu_fixed to destination address + 1 */
      208    15078    1   DCL SRCINDX UBIN;                       /* source address index     */
      209    15079    1   DCL CODE UBIN BYTE;                     /* options code in pdu      */
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:33   
      210    15080    1   DCL LI SBIN;                       /* decreasing header byte count  */
      211    15081    1   DCL I UBIN;
      212    15082    1   DCL J UBIN;
      213    15083    1   DCL ERRVAL(0:3) UBIN;                   /* values for errlogger     */
      214    15084        /*
      215    15085             use these to keep worst case code from being generated.
      216    15086        */
      217    15087    1   DCL SNPATMPLT1 CHAR(8) ALIGNED;
      218    15088    1   DCL 1 SNPATMPLT2 REDEF SNPATMPLT1 ALIGNED,
      219    15089    1          2 NIBBLES(0:13) UNAL,
      220    15090    1             3 NIB UBIN(4) UNAL;
      221    15091
      222    15092    1   DCL SNPATMPLT3 CHAR(8) ALIGNED;
      223    15093    1   DCL 1 SNPATMPLT4 REDEF SNPATMPLT3 ALIGNED,
      224    15094    1          2 NIBBLES(0:13) UNAL,
      225    15095    1             3 NIB UBIN(4) UNAL;
      226    15096
      227    15097        %EJECT;
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:34   
      228    15098
      229    15099    1      QQQ$ = KN$NETPARM.LDCT$;

  15099   1 000005  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 000007  DC86                                 LDB,B5   ,B6
          1 000008  DFC7 0072                            STB,B5   QQQ$,AUTO

      230    15100    1      SAVE_FPT$ = KN$NETPARM.FPT$;

  15100   1 00000A  CCC6 0019                            LDB,B4   25,B6
          1 00000C  CFC7 0074                            STB,B4   SAVE_FPT$,AUTO

      231    15101    1      KN$NETPARM.FPT$ = ADDR(NIL);

  15101   1 00000E  BB80 0000 0000                       LAB,B3   0
          1 000011  BFC6 0019                            STB,B3   25,B6

      232    15102    1      SIZE = KN$NETPARM.NHDRSZ;

  15102   1 000013  E846 0010                            LDR,R6   16,B6
          1 000015  EF47 006A                            STR,R6   SIZE,AUTO

      233    15103    1      IF SIZE = 0 THEN RETURN;

  15103   1 000017  6981 0004                            BNEZ,R6  s:15105,PREL

  15103   1 000019  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      234    15104
      235    15105    1      IF SIZE < LENGTHC(K$NPDU_FIXED) THEN

  15105   1 00001C  6D09                                 CMV,R6   9
          1 00001D  0281 000A                            BGE      s:15108,PREL

      236    15106    1         CALL SCREECH(PRTCLERR);

  15106   1 00001F  BB80 0000 0000  02                   LAB,B3   0
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:35   
          1 000022  CBF0 0100                            LAB,B4   256,IMO
          1 000024  E380 0000 0000  xent                 LNJ,B6   SCREECH
          1 000027       0001                            DC       s:15108,PREL

      237    15107
      238    15108    1      LI = K$NPDU_FIXED.LENGTH;

  15108   1 000028  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 00002A  DCC6 000E                            LDB,B5   14,B6
          1 00002C  E805                                 LDR,R6   ,B5
          1 00002D  E570 00FF                            AND,R6   255,IMO
          1 00002F  EF47 007E                            STR,R6   LI,AUTO

      239    15109    1      IF LI > SIZE THEN

  15109   1 000031  6801 000E                            BLZ,R6   s:15112,PREL
          1 000033  E947 006A                            CMR,R6   SIZE,AUTO
          1 000035  0381 000A                            BLE      s:15112,PREL

      240    15110    1         CALL SCREECH(PRTCLERR);

  15110   1 000037  BB80 0000 0000  02                   LAB,B3   0
          1 00003A  CBF0 0100                            LAB,B4   256,IMO
          1 00003C  E380 0000 0000  xent                 LNJ,B6   SCREECH
          1 00003F       0001                            DC       s:15112,PREL

      241    15111
      242    15112    1      ERRVAL(3) = K$NPDU_FIXED.TYPE;       /* for the errlogger        */

  15112   1 000040  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 000042  DCC6 000E                            LDB,B5   14,B6
          1 000044  E845 0002                            LDR,R6   2,B5
          1 000046  6048                                 SOR,R6   8
          1 000047  E570 001F                            AND,R6   31,IMO
          1 000049  EF47 0084                            STR,R6   ERRVAL+3,AUTO

      243    15113
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:36   
      244    15114    1      SEGLENGTH = K$NPDU_FIXED.SEGLENX*256 + K$NPDU_FIXED.SEGLENY;

  15114   1 00004B  DCC6 000E                            LDB,B5   14,B6
          1 00004D  D845 0002                            LDR,R5   2,B5
          1 00004F  5008                                 SOL,R5   8
          1 000050  C2C5 0003                            LLH,R4   3,B5
          1 000052  DA54                                 ADD,R5   R4
          1 000053  DF47 006F                            STR,R5   SEGLENGTH,AUTO

      245    15115    1      IF SIZE ~= SEGLENGTH THEN

  15115   1 000055  D947 006A                            CMR,R5   SIZE,AUTO
          1 000057  0901 000A                            BE       s:15118,PREL

      246    15116    1         CALL SCREECH(PRTCLERR);

  15116   1 000059  BB80 0000 0000  02                   LAB,B3   0
          1 00005C  CBF0 0100                            LAB,B4   256,IMO
          1 00005E  E380 0000 0000  xent                 LNJ,B6   SCREECH
          1 000061       0001                            DC       s:15118,PREL

      247    15117
      248    15118    1      DATASIZE = SEGLENGTH - LI;

  15118   1 000062  E847 006F                            LDR,R6   SEGLENGTH,AUTO
          1 000064  E247 007E                            SUB,R6   LI,AUTO
          1 000066  EF47 006D                            STR,R6   DATASIZE,AUTO

      249    15119    1      LI = LI - LENGTHC(K$NPDU_FIXED);

  15119   1 000068  D847 007E                            LDR,R5   LI,AUTO
          1 00006A  5EF7                                 ADV,R5   -9
          1 00006B  DF47 007E                            STR,R5   LI,AUTO

      250    15120    1      FIXEDSIZ = LENGTHC(K$NPDU_FIXED);

  15120   1 00006D  4C09                                 LDV,R4   9
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:37   
          1 00006E  CF47 006E                            STR,R4   FIXEDSIZ,AUTO

      251    15121    1      CURINDX = FIXEDSIZ;

  15121   1 000070  CF47 007A                            STR,R4   CURINDX,AUTO

      252    15122
      253    15123    1      ADDR(DESTINATION.LEN)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1);

  15123   1 000072  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 000074  DCC6 000E                            LDB,B5   14,B6
          1 000076  B854                                 LDR,R3   R4
          1 000077  A0B5                                 LDH,R2   ,B5,R3
          1 000078  A7C7 0006                            STH,R2   DESTINATION,AUTO

      254    15124    1      IF DESTINATION.LEN > LI THEN

  15124   1 00007A  92C7 0006                            LLH,R1   DESTINATION,AUTO
          1 00007C  9955                                 CMR,R1   R5
          1 00007D  0A81 000A                            BALE     s:15127,PREL

      255    15125    1         CALL SCREECH(PRTCLERR);

  15125   1 00007F  BB80 0000 0000  02                   LAB,B3   0
          1 000082  CBF0 0100                            LAB,B4   256,IMO
          1 000084  E380 0000 0000  xent                 LNJ,B6   SCREECH
          1 000087       0001                            DC       s:15127,PREL

      256    15126
      257    15127    1      D$ = ADDR(DESTINATION);

  15127   1 000088  EBC7 0006                            LAB,B6   DESTINATION,AUTO
          1 00008A  EFC7 0070                            STB,B6   D$,AUTO

      258    15128    1      DSTINDX = CURINDX + 1; /* save the start of the destination address */

  15128   1 00008C  E847 007A                            LDR,R6   CURINDX,AUTO
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:38   
          1 00008E  6E01                                 ADV,R6   1
          1 00008F  EF47 007B                            STR,R6   DSTINDX,AUTO

      259    15129    2      DO I = 1 TO DESTINATION.LEN;

  15129   1 000091  5C01                                 LDV,R5   1
          1 000092  DF47 007F                            STR,R5   I,AUTO
          1 000094  0F81 0012                            B        s:15131+2,PREL

      260    15130    2         SUBSTR(D$->ADDRESS,I,1) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX+I,1);

  15130   1 000096  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 000098  DCC6 000E                            LDB,B5   14,B6
          1 00009A  E847 007A                            LDR,R6   CURINDX,AUTO
          1 00009C  EA47 007F                            ADD,R6   I,AUTO
          1 00009E  B856                                 LDR,R3   R6
          1 00009F  E0B5                                 LDH,R6   ,B5,R3
          1 0000A0  CCC7 0070                            LDB,B4   D$,AUTO
          1 0000A2  B847 007F                            LDR,R3   I,AUTO
          1 0000A4  E7B4                                 STH,R6   ,B4,R3

      261    15131    2         END;

  15131   1 0000A5  8AC7 007F                            INC      I,AUTO
          1 0000A7  E2C7 0006                            LLH,R6   DESTINATION,AUTO
          1 0000A9  E947 007F                            CMR,R6   I,AUTO
          1 0000AB  02EB                                 BGE      s:15130,SPREL

      262    15132    1      CURINDX = CURINDX + I;

  15132   1 0000AC  D847 007A                            LDR,R5   CURINDX,AUTO
          1 0000AE  DA47 007F                            ADD,R5   I,AUTO
          1 0000B0  DF47 007A                            STR,R5   CURINDX,AUTO

      263    15133
      264    15134    1      LI = LI - (DESTINATION.LEN+1);

PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:39   
  15134   1 0000B2  E247 007E                            SUB,R6   LI,AUTO
          1 0000B4  8656                                 CPL      R6
          1 0000B5  EF47 007E                            STR,R6   LI,AUTO

      265    15135
      266    15136    1      ADDR(SOURCE.LEN)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1);

  15136   1 0000B7  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 0000B9  DCC6 000E                            LDB,B5   14,B6
          1 0000BB  B855                                 LDR,R3   R5
          1 0000BC  C0B5                                 LDH,R4   ,B5,R3
          1 0000BD  C7C7 0011                            STH,R4   SOURCE,AUTO

      267    15137    1      SRCINDX = CURINDX+1;  /* save the start of the source address    */

  15137   1 0000BF  3E01                                 ADV,R3   1
          1 0000C0  BF47 007C                            STR,R3   SRCINDX,AUTO

      268    15138
      269    15139    1      IF SOURCE.LEN > LI THEN

  15139   1 0000C2  A2C7 0011                            LLH,R2   SOURCE,AUTO
          1 0000C4  A956                                 CMR,R2   R6
          1 0000C5  0A81 000A                            BALE     s:15142,PREL

      270    15140    1         CALL SCREECH(PRTCLERR);

  15140   1 0000C7  BB80 0000 0000  02                   LAB,B3   0
          1 0000CA  CBF0 0100                            LAB,B4   256,IMO
          1 0000CC  E380 0000 0000  xent                 LNJ,B6   SCREECH
          1 0000CF       0001                            DC       s:15142,PREL

      271    15141
      272    15142    1      D$ = ADDR(SOURCE);

  15142   1 0000D0  EBC7 0011                            LAB,B6   SOURCE,AUTO
          1 0000D2  EFC7 0070                            STB,B6   D$,AUTO
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:40   

      273    15143    2      DO I = 1 TO SOURCE.LEN;

  15143   1 0000D4  6C01                                 LDV,R6   1
          1 0000D5  EF47 007F                            STR,R6   I,AUTO
          1 0000D7  0F81 0012                            B        s:15145+2,PREL

      274    15144    2         SUBSTR(D$->ADDRESS,I,1) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX+I,1);

  15144   1 0000D9  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 0000DB  DCC6 000E                            LDB,B5   14,B6
          1 0000DD  E847 007A                            LDR,R6   CURINDX,AUTO
          1 0000DF  EA47 007F                            ADD,R6   I,AUTO
          1 0000E1  B856                                 LDR,R3   R6
          1 0000E2  E0B5                                 LDH,R6   ,B5,R3
          1 0000E3  CCC7 0070                            LDB,B4   D$,AUTO
          1 0000E5  B847 007F                            LDR,R3   I,AUTO
          1 0000E7  E7B4                                 STH,R6   ,B4,R3

      275    15145    2         END;

  15145   1 0000E8  8AC7 007F                            INC      I,AUTO
          1 0000EA  E2C7 0011                            LLH,R6   SOURCE,AUTO
          1 0000EC  E947 007F                            CMR,R6   I,AUTO
          1 0000EE  02EB                                 BGE      s:15144,SPREL

      276    15146
      277    15147    1      CURINDX = CURINDX + I;

  15147   1 0000EF  D847 007A                            LDR,R5   CURINDX,AUTO
          1 0000F1  DA47 007F                            ADD,R5   I,AUTO
          1 0000F3  DF47 007A                            STR,R5   CURINDX,AUTO

      278    15148
      279    15149    1      LI = LI - (SOURCE.LEN+1);

  15149   1 0000F5  E247 007E                            SUB,R6   LI,AUTO
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:41   
          1 0000F7  8656                                 CPL      R6
          1 0000F8  EF47 007E                            STR,R6   LI,AUTO

      280    15150
      281    15151        /*
      282    15152             The address are now ready to use.  From now on we can send error pdus
      283    15153             set up netparm to send errcode.
      284    15154        */
      285    15155
      286    15156
      287    15157    1      KN$NETPARM.DST_ADDR$ = ADDR(DESTINATION);

  15157   1 0000FA  EBC7 0006                            LAB,B6   DESTINATION,AUTO
          1 0000FC  DCC7 0004                            LDB,B5   @KN$NETPARM,AUTO
          1 0000FE  EFC5 001F                            STB,B6   31,B5

      288    15158    1      KN$NETPARM.SRC_ADDR$ = ADDR(SOURCE);

  15158   1 000100  CBC7 0011                            LAB,B4   SOURCE,AUTO
          1 000102  CFC5 001D                            STB,B4   29,B5

      289    15159
      290    15160    1      IF K$NPDU_FIXED.PROTOCOLID ~= %K_PRTCL_ID OR

  15160   1 000104  BCC5 000E                            LDB,B3   14,B5
          1 000106  C283                                 LLH,R4   ,B3
          1 000107  C970 0081                            CMR,R4   129,IMO
          1 000109  0981 0006                            BNE      s:15162,PREL
          1 00010B  B2C3 0001                            LLH,R3   1,B3
          1 00010D  3D01                                 CMV,R3   1
          1 00010E  0901 000B                            BE       s:15167,PREL

      291    15161    2        K$NPDU_FIXED.VERSION ~= %K_PRTCL_ID_EXT THEN DO;

      292    15162    2         KN$NETPARM.ERRCODE = %K_DSCRD_HDRSNTX;

  15162   1 000110  3C04                                 LDV,R3   4
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:42   
          1 000111  BF45 0016                            STR,R3   22,B5

      293    15163    2         ERR_CODE = E_DSCRD_HDRSNTX;

  15163   1 000113  8C80 0000 000D  00                   LDI      E_DSCRD_HDRSNTX
          1 000116  8D47 0068                            SDI      ERR_CODE,AUTO

      294    15164    2         GOTO ERR;

  15164   1 000118  0F81 05AA                            B        s:15537,PREL

      295    15165    2         END;
      296    15166
      297    15167    2      IF K$NPDU_FIXED.CHECKSUMX ~= 0 OR K$NPDU_FIXED.CHECKSUMY ~= 0 THEN DO;

  15167   1 00011A  82C3 0003                            LB,'00FF'X        3,B3
  15167   1 00011C       00FF
          1 00011D  0501 0005                            BBT      s:15168,PREL
          1 00011F  A2C3 0004                            LLH,R2   4,B3
          1 000121  2901 0028                            BEZ,R2   s:15176,PREL

      298    15168    2         I = K$NPDU_FIXED.LENGTH;

  15168   1 000123  A803                                 LDR,R2   ,B3
          1 000124  A570 00FF                            AND,R2   255,IMO
          1 000126  AF47 007F                            STR,R2   I,AUTO

      299    15169    3         CALL KNA$CHK_CHKSUM(ADDR(K$NPDU_FIXED),I) WHENALTRETURN DO;

  15169   1 000128  ECC5 000E                            LDB,B6   14,B5
          1 00012A  EFC7 0090                            STB,B6   SNPATMPLT3+7,AUTO
          1 00012C  CBC7 007F                            LAB,B4   I,AUTO
          1 00012E  CFC7 0094                            STB,B4   SNPATMPLT3+11,AUTO
          1 000130  BBC7 0090                            LAB,B3   SNPATMPLT3+7,AUTO
          1 000132  BFC7 0092                            STB,B3   SNPATMPLT3+9,AUTO
          1 000134  BBC7 0092                            LAB,B3   SNPATMPLT3+9,AUTO
          1 000136  CBF0 0200                            LAB,B4   512,IMO
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:43   
          1 000138  E380 0000 0000  xent                 LNJ,B6   KNA$CHK_CHKSUM
          1 00013B       0003                            DC       s:15170,PREL
          1 00013C  0F81 000D                            B        s:15176,PREL

      300    15170    3            KN$NETPARM.ERRCODE = %K_DSCRD_IC;

  15170   1 00013E  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 000140  6C02                                 LDV,R6   2
          1 000141  EF46 0016                            STR,R6   22,B6

      301    15171    3            ERR_CODE = E_DSCRD_IC;

  15171   1 000143  8C80 0000 0009  00                   LDI      E_DSCRD_IC
          1 000146  8D47 0068                            SDI      ERR_CODE,AUTO

      302    15172    3            GOTO ERR;

  15172   1 000148  0F81 057A                            B        s:15537,PREL

      303    15173    3            END;
      304    15174    2         END;

      305    15175
      306    15176    2      IF K$NPDU_FIXED.MS AND K$NPDU_FIXED.SP = '0'B THEN DO;

  15176   1 00014A  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 00014C  DCC6 000E                            LDB,B5   14,B6
          1 00014E  82C5 0002                            LB,'4000'X        2,B5
          1 000150       4000
          1 000151  0581 000F                            BBF      s:15182,PREL
          1 000153  89C5 0002                            CMZ      2,B5
          1 000155  0801 000B                            BAL      s:15182,PREL

      307    15177    2         KN$NETPARM.ERRCODE = %K_DSCRD_CANTSEG;

  15177   1 000157  6C05                                 LDV,R6   5
          1 000158  EF46 0016                            STR,R6   22,B6
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:44   

      308    15178    2         ERR_CODE = E_DSCRD_CANTSEG;

  15178   1 00015A  8C80 0000 000F  00                   LDI      E_DSCRD_CANTSEG
          1 00015D  8D47 0068                            SDI      ERR_CODE,AUTO

      309    15179    2         GOTO ERR;

  15179   1 00015F  0F81 0563                            B        s:15537,PREL

      310    15180    2         END;
      311    15181
      312    15182    2      IF K$NPDU_FIXED.SP = '0'B THEN DO;

  15182   1 000161  89C5 0002                            CMZ      2,B5
          1 000163  0801 000B                            BAL      s:15188,PREL

      313    15183    2         SEGMENT.TOTLEN = SEGLENGTH;

  15183   1 000165  E847 006F                            LDR,R6   SEGLENGTH,AUTO
          1 000167  EF47 0029                            STR,R6   SEGMENT+2,AUTO

      314    15184    2         SEGMENT.DATAID = 0;

  15184   1 000169  8747 0027                            CL       SEGMENT,AUTO

      315    15185    2         SEGMENT.OFFSET = 0;

  15185   1 00016B  8747 0028                            CL       SEGMENT+1,AUTO

      316    15186    2         END;

  15186   1 00016D  0F81 0030                            B        s:15205,PREL

      317    15187    2      ELSE DO;

      318    15188    3         IF LI < LENGTHC(K$NPDU_SEGMENT) THEN DO;
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:45   

  15188   1 00016F  E847 007E                            LDR,R6   LI,AUTO
          1 000171  6D06                                 CMV,R6   6
          1 000172  0881 000B                            BAGE     s:15198,PREL

      319    15189    3            KN$NETPARM.ERRCODE = %K_DSCRD_HDRSNTX;

  15189   1 000174  5C04                                 LDV,R5   4
          1 000175  DF46 0016                            STR,R5   22,B6

      320    15190    3            ERR_CODE = E_DSCRD_HDRSNTX;

  15190   1 000177  8C80 0000 000D  00                   LDI      E_DSCRD_HDRSNTX
          1 00017A  8D47 0068                            SDI      ERR_CODE,AUTO

      321    15191    3            GOTO ERR;

  15191   1 00017C  0F81 0546                            B        s:15537,PREL

      322    15192    3            END;
      323    15193
      324    15194        /*
      325    15195             segment part at this point has got to be present.  otherwise we would have
      326    15196             returned.
      327    15197        */
      328    15198    3         DO I = 0 TO LENGTHC(K$NPDU_SEGMENT)-1;

  15198   1 00017E  8747 007F                            CL       I,AUTO
          1 000180  0F81 0011                            B        s:15200+2,PREL

      329    15199    3            SUBSTR(ADDR(SEGMENT.DATAID)->ADDRESS,I,1) = SUBSTR(ADDR(K$NPDU_FIXED)->
             15199                     ADDRESS,CURINDX+I,1);

  15199   1 000182  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 000184  DCC6 000E                            LDB,B5   14,B6
          1 000186  E847 007A                            LDR,R6   CURINDX,AUTO
          1 000188  EA47 007F                            ADD,R6   I,AUTO
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:46   
          1 00018A  B856                                 LDR,R3   R6
          1 00018B  E0B5                                 LDH,R6   ,B5,R3
          1 00018C  B847 007F                            LDR,R3   I,AUTO
          1 00018E  3E4E                                 ADV,R3   78
          1 00018F  E7B7                                 STH,R6   ,AUTO,R3

      330    15200    3            END;

  15200   1 000190  8AC7 007F                            INC      I,AUTO
          1 000192  E847 007F                            LDR,R6   I,AUTO
          1 000194  6D05                                 CMV,R6   5
          1 000195  03ED                                 BLE      s:15199,SPREL

      331    15201    2         CURINDX = LENGTHC(K$NPDU_SEGMENT);

  15201   1 000196  5C06                                 LDV,R5   6
          1 000197  DF47 007A                            STR,R5   CURINDX,AUTO

      332    15202    2         LI = LI - LENGTHC(SEGMENT);

  15202   1 000199  C847 007E                            LDR,R4   LI,AUTO
          1 00019B  4EFA                                 ADV,R4   -6
          1 00019C  CF47 007E                            STR,R4   LI,AUTO

      333    15203    2         END;

      334    15204
      335    15205    2      IF K$NPDU_FIXED.LIFETIME = 0 THEN DO;

  15205   1 00019E  DCC6 000E                            LDB,B5   14,B6
          1 0001A0  82C5 0001                            LB,'00FF'X        1,B5
          1 0001A2       00FF
          1 0001A3  0501 000C                            BBT      s:15216,PREL

      336    15206    2         KN$NETPARM.ERRCODE = %K_DSCRD_LIFEEXPTRAN;

  15206   1 0001A5  E870 00A0                            LDR,R6   160,IMO
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:47   
          1 0001A7  EF46 0016                            STR,R6   22,B6

      337    15207    2         ERR_CODE = E_DSCRD_LIFEEXPTRAN;

  15207   1 0001A9  8C80 0000 0021  00                   LDI      E_DSCRD_LIFEEXPTRAN
          1 0001AC  8D47 0068                            SDI      ERR_CODE,AUTO

      338    15208    2         GOTO ERR;

  15208   1 0001AE  0F81 0514                            B        s:15537,PREL

      339    15209    2         END;
      340    15210
      341    15211        /*
      342    15212             parse the options.
      343    15213        */
      344    15214
      345    15215
      346    15216    2      DO WHILE LI > 2;

  15216   1 0001B0  E847 007E                            LDR,R6   LI,AUTO
          1 0001B2  6D02                                 CMV,R6   2
          1 0001B3  0A81 008C                            BALE     s:15269,PREL

      347    15217    2         ADDR(CODE)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1);

  15217   1 0001B5  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 0001B7  DCC6 000E                            LDB,B5   14,B6
          1 0001B9  B847 007A                            LDR,R3   CURINDX,AUTO
          1 0001BB  E0B5                                 LDH,R6   ,B5,R3
          1 0001BC  E7C7 007D                            STH,R6   CODE,AUTO

      348    15218    2         CURINDX = CURINDX + 1;

  15218   1 0001BE  8AC7 007A                            INC      CURINDX,AUTO

      349    15219    2         ADDR(OPTSZ)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1);
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:48   

  15219   1 0001C0  DCC6 000E                            LDB,B5   14,B6
          1 0001C2  B847 007A                            LDR,R3   CURINDX,AUTO
          1 0001C4  D0B5                                 LDH,R5   ,B5,R3
          1 0001C5  D7C7 006B                            STH,R5   OPTSZ,AUTO

      350    15220    2         CURINDX = CURINDX + 1;

  15220   1 0001C7  8AC7 007A                            INC      CURINDX,AUTO

      351    15221    2         LI = LI-2-OPTSZ;

  15221   1 0001C9  C2C7 006B                            LLH,R4   OPTSZ,AUTO
          1 0001CB  C247 007E                            SUB,R4   LI,AUTO
          1 0001CD  8254                                 NEG      R4
          1 0001CE  4EFE                                 ADV,R4   -2
          1 0001CF  CF47 007E                            STR,R4   LI,AUTO

      352    15222    3         IF LI < 0 THEN DO;

  15222   1 0001D1  4881 000B                            BGEZ,R4  s:15228,PREL

      353    15223    3            KN$NETPARM.ERRCODE = %K_DSCRD_HDRSNTX;

  15223   1 0001D3  3C04                                 LDV,R3   4
          1 0001D4  BF46 0016                            STR,R3   22,B6

      354    15224    3            ERR_CODE = E_DSCRD_HDRSNTX;

  15224   1 0001D6  8C80 0000 000D  00                   LDI      E_DSCRD_HDRSNTX
          1 0001D9  8D47 0068                            SDI      ERR_CODE,AUTO

      355    15225    3            GOTO ERR;

  15225   1 0001DB  0F81 04E7                            B        s:15537,PREL

      356    15226    3            END;
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:49   
      357    15227
      358    15228    3         DO CASE(CODE);

  15228   1 0001DD  B2C7 007D                            LLH,R3   CODE,AUTO
          1 0001DF  BA70 FF3D                            ADD,R3   -195,IMO
          1 0001E1  3D0B                                 CMV,R3   11
          1 0001E2  0281 0049                            BGE      s:15262,PREL
          1 0001E4  A830 0000 01EA  01                   LDR,R2   s:15228+13,R3
          1 0001E7  83A0 0000 01F5  01                   JMP      s:15233,R2
          1 0001EA       0042                            DC       s:15267,PREL
          1 0001EB       0037                            DC       s:15262,PREL
          1 0001EC       0000                            DC       s:15233,PREL
          1 0001ED       0037                            DC       s:15262,PREL
          1 0001EE       0037                            DC       s:15262,PREL
          1 0001EF       000B                            DC       s:15238,PREL
          1 0001F0       0037                            DC       s:15262,PREL
          1 0001F1       0037                            DC       s:15262,PREL
          1 0001F2       0021                            DC       s:15250,PREL
          1 0001F3       0042                            DC       s:15267,PREL
          1 0001F4       0042                            DC       s:15267,PREL

      359    15229
      360    15230    3            CASE(%K_NPRM_PAD); /* pad characters to get header to a byte boundry*/

      361    15231
      362    15232    3            CASE(%K_NPRM_SEC);             /* security                 */

      363    15233    3            KN$NETPARM.ERRCODE = %K_DSCRD_OPTSEC;

  15233   1 0001F5  9870 00B2                            LDR,R1   178,IMO
          1 0001F7  9F46 0016                            STR,R1   22,B6

      364    15234    3            ERR_CODE = E_DSCRD_OPTSEC;

  15234   1 0001F9  8C80 0000 0029  00                   LDI      E_DSCRD_OPTSEC
          1 0001FC  8D47 0068                            SDI      ERR_CODE,AUTO

PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:50   
      365    15235    3            GOTO ERR;

  15235   1 0001FE  0F81 04C4                            B        s:15537,PREL

      366    15236
      367    15237    3            CASE(%K_NPRM_SRCRTE);          /* source routing           */

      368    15238    3            ADDR(OPTVAL)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1);

  15238   1 000200  DCC6 000E                            LDB,B5   14,B6
          1 000202  9847 007A                            LDR,R1   CURINDX,AUTO
          1 000204  E095                                 LDH,R6   ,B5,R1
          1 000205  E7C7 006C                            STH,R6   OPTVAL,AUTO

      369    15239        /*
      370    15240                partial source routing options are accepted but not implemented.
      371    15241                complete source routing pdus are discarded.
      372    15242        */
      373    15243    4            IF OPTVAL ~= %K_NPRM_SRCRTE_PSR THEN DO;

  15243   1 000207  E2C7 006C                            LLH,R6   OPTVAL,AUTO
          1 000209  6901 002D                            BEZ,R6   s:15267,PREL

      374    15244    4               KN$NETPARM.ERRCODE = %K_DSCRD_OPTSRCRTE;

  15244   1 00020B  E870 00B3                            LDR,R6   179,IMO
          1 00020D  EF46 0016                            STR,R6   22,B6

      375    15245    4               ERR_CODE = E_DSCRD_OPTSRCRTE;

  15245   1 00020F  8C80 0000 002B  00                   LDI      E_DSCRD_OPTSRCRTE
          1 000212  8D47 0068                            SDI      ERR_CODE,AUTO

      376    15246    4               GOTO ERR;

  15246   1 000214  0F81 04AE                            B        s:15537,PREL

PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:51   
      377    15247    4               END;
      378    15248
      379    15249    3            CASE(%K_NPRM_RECRTE);          /* record route             */

      380    15250    3            ADDR(OPTVAL)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1);

  15250   1 000216  DCC6 000E                            LDB,B5   14,B6
          1 000218  9847 007A                            LDR,R1   CURINDX,AUTO
          1 00021A  E095                                 LDH,R6   ,B5,R1
          1 00021B  E7C7 006C                            STH,R6   OPTVAL,AUTO

      381    15251    4            IF OPTVAL ~= %K_NPRM_RECRTE_PRR THEN DO;

  15251   1 00021D  E2C7 006C                            LLH,R6   OPTVAL,AUTO
          1 00021F  6901 0017                            BEZ,R6   s:15267,PREL

      382    15252    4               KN$NETPARM.ERRCODE = %K_DSCRD_OPTRECRTE;

  15252   1 000221  E870 00B4                            LDR,R6   180,IMO
          1 000223  EF46 0016                            STR,R6   22,B6

      383    15253    4               ERR_CODE = E_DSCRD_OPTRECRTE;

  15253   1 000225  8C80 0000 002D  00                   LDI      E_DSCRD_OPTRECRTE
          1 000228  8D47 0068                            SDI      ERR_CODE,AUTO

      384    15254    4               GOTO ERR;

  15254   1 00022A  0F81 0498                            B        s:15537,PREL

      385    15255    4               END;
      386    15256
      387    15257    3            CASE(%K_NPRM_QOS);

      388    15258
      389    15259    3            CASE(%K_NPRM_PRIO);

PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:52   
      390    15260
      391    15261    3            CASE(ELSE);

      392    15262    3            KN$NETPARM.ERRCODE = %K_DSCRD_OPTNON;

  15262   1 00022C  A870 00B0                            LDR,R2   176,IMO
          1 00022E  AF46 0016                            STR,R2   22,B6

      393    15263    3            ERR_CODE = E_DSCRD_OPTNON;

  15263   1 000230  8C80 0000 0025  00                   LDI      E_DSCRD_OPTNON
          1 000233  8D47 0068                            SDI      ERR_CODE,AUTO

      394    15264    3            GOTO ERR;

  15264   1 000235  0F81 048D                            B        s:15537,PREL

      395    15265
      396    15266    3            END;                           /* case                     */

      397    15267    2         CURINDX = CURINDX + OPTSZ;

  15267   1 000237  E2C7 006B                            LLH,R6   OPTSZ,AUTO
          1 000239  EA47 007A                            ADD,R6   CURINDX,AUTO
          1 00023B  EF47 007A                            STR,R6   CURINDX,AUTO

      398    15268    2         END;                              /* do while                 */

  15268   1 00023D  4D02                                 CMV,R4   2
          1 00023E  0A01 FF76                            BAG      s:15217,PREL

      399    15269    1      KN$NETPARM.THDRSZ = KN$NETPARM.NHDRSZ - K$NPDU_FIXED.LENGTH;

  15269   1 000240  DCC6 000E                            LDB,B5   14,B6
          1 000242  E805                                 LDR,R6   ,B5
          1 000243  E570 00FF                            AND,R6   255,IMO
          1 000245  E246 0010                            SUB,R6   16,B6
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:53   
          1 000247  8256                                 NEG      R6
          1 000248  EF46 000D                            STR,R6   13,B6

      400    15270    1      KN$NETPARM.THDR_C$ = PINCRC(KN$NETPARM.NHDR$,K$NPDU_FIXED.LENGTH);

  15270   1 00024A  B805                                 LDR,R3   ,B5
          1 00024B  B570 00FF                            AND,R3   255,IMO
          1 00024D  DFC7 0090                            STB,B5   SNPATMPLT3+7,AUTO
          1 00024F  8CC7 0090                            LDI      SNPATMPLT3+7,AUTO
          1 000251  7031                                 DCL,R7   1
          1 000252  8D47 0092                            SDI      SNPATMPLT3+9,AUTO
          1 000254  F853                                 LDR,R7   R3
          1 000255  6C00                                 LDV,R6   0
          1 000256  8447 0092                            AID      SNPATMPLT3+9,AUTO
          1 000258  7071                                 DCR,R7   1
          1 000259  8D46 000B                            SDI      11,B6

      401    15271        /*
      402    15272          the message is now ready to be routed.  If this is the first hop from a host
      403    15273          node then transport has to be called to allow transport to complete its
      404    15274          context. If it is the last hop before a host node transport must again be called.
      405    15275          Other cases are as follows:
      406    15276             if destination address is x121
      407    15277                search osiaddress list
      408    15278                if address is present get node/link#s.
      409    15279                   if node is our node
      410    15280                      build fpt
      411    15281                      call knh$send.
      412    15282                   else
      413    15283                      find route
      414    15284                      if route available forward;else error noroute.
      415    15285                else search the link laddr list
      416    15286                   if addr present then
      417    15287                      get dstnode# out of dsp.
      418    15288                      if dstnode# our node# then call transport.
      419    15289                      else if dstnode# is link and host call recv4_host
      420    15290                           get route
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:54   
      421    15291                           call knh$send
      422    15292                   else
      423    15293                      error(noroute)
      424    15294                else if cp6 addr and not type fep then send error(noroute)
      425    15295                     else
      426    15296                         get dstnode#
      427    15297                         if route available call knh$send.
      428    15298        */
      429    15299    2      CALL KNN$DECODE_NSAP(SOURCE,SRCROUTE) WHENALTRETURN DO;

  15299   1 00025B  DBC7 002A                            LAB,B5   SRCROUTE,AUTO
          1 00025D  DFC7 0092                            STB,B5   SNPATMPLT3+9,AUTO
          1 00025F  CBC7 0011                            LAB,B4   SOURCE,AUTO
          1 000261  CFC7 0090                            STB,B4   SNPATMPLT3+7,AUTO
          1 000263  BBC7 0090                            LAB,B3   SNPATMPLT3+7,AUTO
          1 000265  CBF0 0200                            LAB,B4   512,IMO
          1 000267  E380 0000 0000  xent                 LNJ,B6   KNN$DECODE_NSAP
          1 00026A       0003                            DC       s:15300,PREL
          1 00026B  0F81 0004                            B        s:15303,PREL

      430    15300    2         RETURN;                 /* discard invalid source address     */

  15300   1 00026D  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      431    15301    2         END;
      432    15302
      433    15303    1      KN$NETPARM.RECTYPE = K$NPDU_FIXED.LENGTH;
             15303               /* send full network header on error pdu */

  15303   1 000270  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 000272  DCC6 000E                            LDB,B5   14,B6
          1 000274  E805                                 LDR,R6   ,B5
          1 000275  E570 00FF                            AND,R6   255,IMO
          1 000277  EF46 0013                            STR,R6   19,B6

      434    15304    2      CALL KNN$DECODE_NSAP(DESTINATION,DSTROUTE) WHENALTRETURN DO;

PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:55   
  15304   1 000279  CBC7 0048                            LAB,B4   DSTROUTE,AUTO
          1 00027B  CFC7 0092                            STB,B4   SNPATMPLT3+9,AUTO
          1 00027D  DBC7 0006                            LAB,B5   DESTINATION,AUTO
          1 00027F  DFC7 0090                            STB,B5   SNPATMPLT3+7,AUTO
          1 000281  BBC7 0090                            LAB,B3   SNPATMPLT3+7,AUTO
          1 000283  CBF0 0200                            LAB,B4   512,IMO
          1 000285  E380 0000 0000  xent                 LNJ,B6   KNN$DECODE_NSAP
          1 000288       0003                            DC       s:15305,PREL
          1 000289  0F81 000E                            B        s:15311,PREL

      435    15305    2         KN$NETPARM.ERRCODE = %K_DSCRD_DSTUNKNWN;

  15305   1 00028B  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 00028D  E870 0081                            LDR,R6   129,IMO
          1 00028F  EF46 0016                            STR,R6   22,B6

      436    15306    2         ERR_CODE = E_DSCRD_DSTUNKNWN;

  15306   1 000291  8C80 0000 0017  00                   LDI      E_DSCRD_DSTUNKNWN
          1 000294  8D47 0068                            SDI      ERR_CODE,AUTO

      437    15307    2         GOTO ERR;

  15307   1 000296  0F81 042C                            B        s:15537,PREL

      438    15308    2         END;
      439    15309
      440    15310
      441    15311    2      IF DSTROUTE.FEP# > KNN_NODES THEN DO;

  15311   1 000298  E847 0049                            LDR,R6   DSTROUTE+1,AUTO
          1 00029A  E570 00FF                            AND,R6   255,IMO
          1 00029C  E900 0000 0000  xsym                 CMR,R6   KNN_NODES
          1 00029F  0381 000E                            BLE      s:15317,PREL

      442    15312    2         KN$NETPARM.ERRCODE = %K_DSCRD_DSTUNKNWN;

PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:56   
  15312   1 0002A1  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 0002A3  D870 0081                            LDR,R5   129,IMO
          1 0002A5  DF46 0016                            STR,R5   22,B6

      443    15313    2         ERR_CODE = E_DSCRD_DSTUNKNWN;

  15313   1 0002A7  8C80 0000 0017  00                   LDI      E_DSCRD_DSTUNKNWN
          1 0002AA  8D47 0068                            SDI      ERR_CODE,AUTO

      444    15314    2         GOTO ERR;

  15314   1 0002AC  0F81 0416                            B        s:15537,PREL

      445    15315    2         END;
      446    15316
      447    15317    2      IF DSTROUTE.QOS = 255 AND DSTROUTE.FEP# ~= KN_NODE# THEN DO;

  15317   1 0002AE  D847 004A                            LDR,R5   DSTROUTE+2,AUTO
          1 0002B0  D570 00FF                            AND,R5   255,IMO
          1 0002B2  D970 00FF                            CMR,R5   255,IMO
          1 0002B4  0981 0013                            BNE      s:15328,PREL
          1 0002B6  E900 0000 0000  xsym                 CMR,R6   KN_NODE#
          1 0002B9  0901 000E                            BE       s:15328,PREL

      448    15318    2         KN$NETPARM.ERRCODE = %K_DSCRD_DSTUNREACH;

  15318   1 0002BB  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 0002BD  C870 0080                            LDR,R4   128,IMO
          1 0002BF  CF46 0016                            STR,R4   22,B6

      449    15319    2         ERR_CODE = E_DSCRD_DSTUNREACH;

  15319   1 0002C1  8C80 0000 0015  00                   LDI      E_DSCRD_DSTUNREACH
          1 0002C4  8D47 0068                            SDI      ERR_CODE,AUTO

      450    15320    2         GOTO ERR;

PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:57   
  15320   1 0002C6  0F81 03FC                            B        s:15537,PREL

      451    15321    2         END;
      452    15322
      453    15323        /*
      454    15324             if both the source and destination nodes are link connected and host nodes
      455    15325             then do not call transport, do not pass go and do not collect $200.  Instead
      456    15326             send the message as is.
      457    15327        */
      458    15328    1      IF DSTROUTE.NS_TYPE = %K_TYPE_LNSAP AND

  15328   1 0002C8  C847 0048                            LDR,R4   DSTROUTE,AUTO
          1 0002CA  4044                                 SOR,R4   4
          1 0002CB  C570 000F                            AND,R4   15,IMO
          1 0002CD  4D01                                 CMV,R4   1
          1 0002CE  0981 0057                            BNE      s:15355,PREL
          1 0002D0  B847 002A                            LDR,R3   SRCROUTE,AUTO
          1 0002D2  3044                                 SOR,R3   4
          1 0002D3  B570 000F                            AND,R3   15,IMO
          1 0002D5  3D01                                 CMV,R3   1
          1 0002D6  0981 004F                            BNE      s:15355,PREL
          1 0002D8  A847 002B                            LDR,R2   SRCROUTE+1,AUTO
          1 0002DA  A570 00FF                            AND,R2   255,IMO
          1 0002DC  E952                                 CMR,R6   R2
          1 0002DD  0981 0048                            BNE      s:15355,PREL
          1 0002DF  92C7 0049                            LLH,R1   DSTROUTE+1,AUTO
          1 0002E1  9900 0000 0000  xsym                 CMR,R1   KNN_NODES
          1 0002E4  0281 0041                            BGE      s:15355,PREL
          1 0002E6  E2C7 002B                            LLH,R6   SRCROUTE+1,AUTO
          1 0002E8  E900 0000 0000  xsym                 CMR,R6   KNN_NODES
          1 0002EB  0281 003A                            BGE      s:15355,PREL

      459    15329    1        SRCROUTE.NS_TYPE = %K_TYPE_LNSAP AND
      460    15330    1        DSTROUTE.FEP# = SRCROUTE.FEP# AND
      461    15331    2        DSTROUTE.HOST# < KNN_NODES AND SRCROUTE.HOST# < KNN_NODES THEN DO;

      462    15332                                                /* no transport needed      */
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:58   
      463    15333    2         IF KNN$ROUTE$(DSTROUTE.HOST#)->KNN$ROUTE.FLAGS.HOST_NODE

  15333   1 0002ED  EC80 0000 0000  xsym                 LDB,B6   KNN_ROUTE$$
          1 0002F0  DC96                                 LDB,B5   ,B6,R1
          1 0002F1  89C5 0007                            CMZ      7,B5
          1 0002F3  0881 0032                            BAGE     s:15355,PREL
          1 0002F5  B856                                 LDR,R3   R6
          1 0002F6  CCB6                                 LDB,B4   ,B6,R3
          1 0002F7  89C4 0007                            CMZ      7,B4
          1 0002F9  0881 002C                            BAGE     s:15355,PREL

      464    15334    3           AND KNN$ROUTE$(SRCROUTE.HOST#)->KNN$ROUTE.FLAGS.HOST_NODE THEN DO;

      465    15335    3            ROUTE$ = KNN$ROUTE$(DSTROUTE.FEP#);

  15335   1 0002FB  B847 0049                            LDR,R3   DSTROUTE+1,AUTO
          1 0002FD  B570 00FF                            AND,R3   255,IMO
          1 0002FF  CCB6                                 LDB,B4   ,B6,R3
          1 000300  CFC7 0078                            STB,B4   ROUTE$,AUTO

      466    15336    3            LINK$ = KNN$ROUTE.LINK$;

  15336   1 000302  BC84                                 LDB,B3   ,B4
          1 000303  BFC7 0076                            STB,B3   LINK$,AUTO

      467    15337    4            IF KNN$ROUTE.LINK$ = ADDR(NIL) OR KNN$LINK.LDCT$ = ADDR(NIL) THEN DO;

  15337   1 000305  8D84                                 CMN      ,B4
          1 000306  0901 0004                            BE       s:15338,PREL
          1 000308  8D83                                 CMN      ,B3
          1 000309  0981 000E                            BNE      s:15342,PREL

      468    15338    4               KN$NETPARM.ERRCODE = %K_DSCRD_DSTUNREACH;

  15338   1 00030B  ACC7 0004                            LDB,B2   @KN$NETPARM,AUTO
          1 00030D  E870 0080                            LDR,R6   128,IMO
          1 00030F  EF42 0016                            STR,R6   22,B2
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:59   

      469    15339    4               ERR_CODE = E_DSCRD_DSTUNREACH;

  15339   1 000311  8C80 0000 0015  00                   LDI      E_DSCRD_DSTUNREACH
          1 000314  8D47 0068                            SDI      ERR_CODE,AUTO

      470    15340    4               GOTO ERR;

  15340   1 000316  0F81 03AC                            B        s:15537,PREL

      471    15341    4               END;
      472    15342    3            KN$NETPARM.FPT$ = ADDR(NIL);

  15342   1 000318  AB80 0000 0000                       LAB,B2   0
          1 00031B  9CC7 0004                            LDB,B1   @KN$NETPARM,AUTO
          1 00031D  AFC1 0019                            STB,B2   25,B1

      473    15343    3            KN$NETPARM.LDCT$ = KNN$LINK.LDCT$;

  15343   1 00031F  DC83                                 LDB,B5   ,B3
          1 000320  DF81                                 STB,B5   ,B1

      474    15344    3            CALL FORWARD ALTRET(ERR2);

  15344   1 000321  E3C0 03F7                            LNJ,B6   s:0,PREL
          1 000323       03E8                            DC       s:15558,PREL

      475    15345    3            GOTO EXITOSINET;

  15345   1 000324  0F81 03D8                            B        s:15552,PREL

      476    15346    3            END;
      477    15347    2         END;                              /* src.fep# = dst.fep#      */
      478    15348
      479    15349        /*
      480    15350             if the destination node# is our node and the address was in the ositable
      481    15351             then this message is to be forwared to that link.
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:60   
      482    15352        */
      483    15353
      484    15354
      485    15355    2      IF DSTROUTE.FEP# = KN_NODE# THEN DO;

  15355   1 000326  E847 0049                            LDR,R6   DSTROUTE+1,AUTO
          1 000328  E570 00FF                            AND,R6   255,IMO
          1 00032A  E900 0000 0000  xsym                 CMR,R6   KN_NODE#
          1 00032D  0981 0369                            BNE      s:15528,PREL

      486    15356        /*
      487    15357             check the pdu type if it is data forward it to the correct node.
      488    15358             if it is an error pdu generate an errorlog entry for it.
      489    15359             if it is those one of the amazing dynamic routing pdu discard it.
      490    15360        */
      491    15361    3         IF K$NPDU_FIXED.TYPE ~= %K_DT_PDU THEN DO;

  15361   1 00032F  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 000331  DCC6 000E                            LDB,B5   14,B6
          1 000333  B845 0002                            LDR,R3   2,B5
          1 000335  3048                                 SOR,R3   8
          1 000336  B570 001F                            AND,R3   31,IMO
          1 000338  3D1C                                 CMV,R3   28
          1 000339  0901 01B7                            BE       s:15427,PREL

      492    15362    4            IF K$NPDU_FIXED.TYPE = %K_ER_PDU THEN DO;

  15362   1 00033B  3D01                                 CMV,R3   1
          1 00033C  0981 01A4                            BNE      s:15419,PREL

      493    15363    4               SUBSTR(ADDR(I)->ADDRESS,0,2) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,
             15363                        CURINDX,2);

  15363   1 00033E  AB85                                 LAB,B2   ,B5
          1 00033F  A847 007A                            LDR,R2   CURINDX,AUTO
          1 000341  6C02                                 LDV,R6   2
          1 000342  BBC7 007F                            LAB,B3   I,AUTO
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:61   
          1 000344  3C00                                 LDV,R3   0
          1 000345  0008                                 MMM

      494    15364    4               CURINDX = CURINDX + 2;      /* size of errcode field    */

  15364   1 000346  E847 007A                            LDR,R6   CURINDX,AUTO
          1 000348  6E02                                 ADV,R6   2
          1 000349  EF47 007A                            STR,R6   CURINDX,AUTO

      495    15365    4               SIZE = MINIMUM(CURINDX,KN$NETPARM.NHDRSZ);

  15365   1 00034B  D846 0010                            LDR,R5   16,B6
          1 00034D  D956                                 CMR,R5   R6
          1 00034E  0381 0002                            BLE      s:15365+6,PREL
          1 000350  D856                                 LDR,R5   R6
          1 000351  DF47 006A                            STR,R5   SIZE,AUTO

      496    15366    5               DO CASE (I);

  15366   1 000353  B847 007F                            LDR,R3   I,AUTO
          1 000355  B970 00C1                            CMR,R3   193,IMO
          1 000357  0281 0162                            BGE      s:15412,PREL
          1 000359  A830 0000 035F  01                   LDR,R2   s:15366+12,R3
          1 00035C  83A0 0000 0420  01                   JMP      s:15368,R2
          1 00035F       0000                            DC       s:15368,PREL
          1 000360       0007                            DC       s:15370,PREL
          1 000361       000E                            DC       s:15372,PREL
          1 000362       0015                            DC       s:15374,PREL
          1 000363       001C                            DC       s:15376,PREL
          1 000364       0023                            DC       s:15378,PREL
          1 000365       002A                            DC       s:15380,PREL
          1 000366       0031                            DC       s:15382,PREL
          1 000367       009A                            DC       s:15412,PREL
          1 000368       009A                            DC       s:15412,PREL
          1 000369       009A                            DC       s:15412,PREL
          1 00036A       009A                            DC       s:15412,PREL
          1 00036B       009A                            DC       s:15412,PREL
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:62   
          1 00036C       009A                            DC       s:15412,PREL
          1 00036D       009A                            DC       s:15412,PREL
          1 00036E       009A                            DC       s:15412,PREL
          1 00036F       009A                            DC       s:15412,PREL
          1 000370       009A                            DC       s:15412,PREL
          1 000371       009A                            DC       s:15412,PREL
          1 000372       009A                            DC       s:15412,PREL
          1 000373       009A                            DC       s:15412,PREL
          1 000374       009A                            DC       s:15412,PREL
          1 000375       009A                            DC       s:15412,PREL
          1 000376       009A                            DC       s:15412,PREL
          1 000377       009A                            DC       s:15412,PREL
          1 000378       009A                            DC       s:15412,PREL
          1 000379       009A                            DC       s:15412,PREL
          1 00037A       009A                            DC       s:15412,PREL
          1 00037B       009A                            DC       s:15412,PREL
          1 00037C       009A                            DC       s:15412,PREL
          1 00037D       009A                            DC       s:15412,PREL
          1 00037E       009A                            DC       s:15412,PREL
          1 00037F       009A                            DC       s:15412,PREL
          1 000380       009A                            DC       s:15412,PREL
          1 000381       009A                            DC       s:15412,PREL
          1 000382       009A                            DC       s:15412,PREL
          1 000383       009A                            DC       s:15412,PREL
          1 000384       009A                            DC       s:15412,PREL
          1 000385       009A                            DC       s:15412,PREL
          1 000386       009A                            DC       s:15412,PREL
          1 000387       009A                            DC       s:15412,PREL
          1 000388       009A                            DC       s:15412,PREL
          1 000389       009A                            DC       s:15412,PREL
          1 00038A       009A                            DC       s:15412,PREL
          1 00038B       009A                            DC       s:15412,PREL
          1 00038C       009A                            DC       s:15412,PREL
          1 00038D       009A                            DC       s:15412,PREL
          1 00038E       009A                            DC       s:15412,PREL
          1 00038F       009A                            DC       s:15412,PREL
          1 000390       009A                            DC       s:15412,PREL
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:63   
          1 000391       009A                            DC       s:15412,PREL
          1 000392       009A                            DC       s:15412,PREL
          1 000393       009A                            DC       s:15412,PREL
          1 000394       009A                            DC       s:15412,PREL
          1 000395       009A                            DC       s:15412,PREL
          1 000396       009A                            DC       s:15412,PREL
          1 000397       009A                            DC       s:15412,PREL
          1 000398       009A                            DC       s:15412,PREL
          1 000399       009A                            DC       s:15412,PREL
          1 00039A       009A                            DC       s:15412,PREL
          1 00039B       009A                            DC       s:15412,PREL
          1 00039C       009A                            DC       s:15412,PREL
          1 00039D       009A                            DC       s:15412,PREL
          1 00039E       009A                            DC       s:15412,PREL
          1 00039F       009A                            DC       s:15412,PREL
          1 0003A0       009A                            DC       s:15412,PREL
          1 0003A1       009A                            DC       s:15412,PREL
          1 0003A2       009A                            DC       s:15412,PREL
          1 0003A3       009A                            DC       s:15412,PREL
          1 0003A4       009A                            DC       s:15412,PREL
          1 0003A5       009A                            DC       s:15412,PREL
          1 0003A6       009A                            DC       s:15412,PREL
          1 0003A7       009A                            DC       s:15412,PREL
          1 0003A8       009A                            DC       s:15412,PREL
          1 0003A9       009A                            DC       s:15412,PREL
          1 0003AA       009A                            DC       s:15412,PREL
          1 0003AB       009A                            DC       s:15412,PREL
          1 0003AC       009A                            DC       s:15412,PREL
          1 0003AD       009A                            DC       s:15412,PREL
          1 0003AE       009A                            DC       s:15412,PREL
          1 0003AF       009A                            DC       s:15412,PREL
          1 0003B0       009A                            DC       s:15412,PREL
          1 0003B1       009A                            DC       s:15412,PREL
          1 0003B2       009A                            DC       s:15412,PREL
          1 0003B3       009A                            DC       s:15412,PREL
          1 0003B4       009A                            DC       s:15412,PREL
          1 0003B5       009A                            DC       s:15412,PREL
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:64   
          1 0003B6       009A                            DC       s:15412,PREL
          1 0003B7       009A                            DC       s:15412,PREL
          1 0003B8       009A                            DC       s:15412,PREL
          1 0003B9       009A                            DC       s:15412,PREL
          1 0003BA       009A                            DC       s:15412,PREL
          1 0003BB       009A                            DC       s:15412,PREL
          1 0003BC       009A                            DC       s:15412,PREL
          1 0003BD       009A                            DC       s:15412,PREL
          1 0003BE       009A                            DC       s:15412,PREL
          1 0003BF       009A                            DC       s:15412,PREL
          1 0003C0       009A                            DC       s:15412,PREL
          1 0003C1       009A                            DC       s:15412,PREL
          1 0003C2       009A                            DC       s:15412,PREL
          1 0003C3       009A                            DC       s:15412,PREL
          1 0003C4       009A                            DC       s:15412,PREL
          1 0003C5       009A                            DC       s:15412,PREL
          1 0003C6       009A                            DC       s:15412,PREL
          1 0003C7       009A                            DC       s:15412,PREL
          1 0003C8       009A                            DC       s:15412,PREL
          1 0003C9       009A                            DC       s:15412,PREL
          1 0003CA       009A                            DC       s:15412,PREL
          1 0003CB       009A                            DC       s:15412,PREL
          1 0003CC       009A                            DC       s:15412,PREL
          1 0003CD       009A                            DC       s:15412,PREL
          1 0003CE       009A                            DC       s:15412,PREL
          1 0003CF       009A                            DC       s:15412,PREL
          1 0003D0       009A                            DC       s:15412,PREL
          1 0003D1       009A                            DC       s:15412,PREL
          1 0003D2       009A                            DC       s:15412,PREL
          1 0003D3       009A                            DC       s:15412,PREL
          1 0003D4       009A                            DC       s:15412,PREL
          1 0003D5       009A                            DC       s:15412,PREL
          1 0003D6       009A                            DC       s:15412,PREL
          1 0003D7       009A                            DC       s:15412,PREL
          1 0003D8       009A                            DC       s:15412,PREL
          1 0003D9       009A                            DC       s:15412,PREL
          1 0003DA       009A                            DC       s:15412,PREL
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:65   
          1 0003DB       009A                            DC       s:15412,PREL
          1 0003DC       009A                            DC       s:15412,PREL
          1 0003DD       009A                            DC       s:15412,PREL
          1 0003DE       009A                            DC       s:15412,PREL
          1 0003DF       0038                            DC       s:15384,PREL
          1 0003E0       003F                            DC       s:15386,PREL
          1 0003E1       009A                            DC       s:15412,PREL
          1 0003E2       009A                            DC       s:15412,PREL
          1 0003E3       009A                            DC       s:15412,PREL
          1 0003E4       009A                            DC       s:15412,PREL
          1 0003E5       009A                            DC       s:15412,PREL
          1 0003E6       009A                            DC       s:15412,PREL
          1 0003E7       009A                            DC       s:15412,PREL
          1 0003E8       009A                            DC       s:15412,PREL
          1 0003E9       009A                            DC       s:15412,PREL
          1 0003EA       009A                            DC       s:15412,PREL
          1 0003EB       009A                            DC       s:15412,PREL
          1 0003EC       009A                            DC       s:15412,PREL
          1 0003ED       009A                            DC       s:15412,PREL
          1 0003EE       009A                            DC       s:15412,PREL
          1 0003EF       0046                            DC       s:15388,PREL
          1 0003F0       004D                            DC       s:15390,PREL
          1 0003F1       0054                            DC       s:15392,PREL
          1 0003F2       005B                            DC       s:15394,PREL
          1 0003F3       009A                            DC       s:15412,PREL
          1 0003F4       009A                            DC       s:15412,PREL
          1 0003F5       009A                            DC       s:15412,PREL
          1 0003F6       009A                            DC       s:15412,PREL
          1 0003F7       009A                            DC       s:15412,PREL
          1 0003F8       009A                            DC       s:15412,PREL
          1 0003F9       009A                            DC       s:15412,PREL
          1 0003FA       009A                            DC       s:15412,PREL
          1 0003FB       009A                            DC       s:15412,PREL
          1 0003FC       009A                            DC       s:15412,PREL
          1 0003FD       009A                            DC       s:15412,PREL
          1 0003FE       009A                            DC       s:15412,PREL
          1 0003FF       0062                            DC       s:15396,PREL
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:66   
          1 000400       0069                            DC       s:15398,PREL
          1 000401       009A                            DC       s:15412,PREL
          1 000402       009A                            DC       s:15412,PREL
          1 000403       009A                            DC       s:15412,PREL
          1 000404       009A                            DC       s:15412,PREL
          1 000405       009A                            DC       s:15412,PREL
          1 000406       009A                            DC       s:15412,PREL
          1 000407       009A                            DC       s:15412,PREL
          1 000408       009A                            DC       s:15412,PREL
          1 000409       009A                            DC       s:15412,PREL
          1 00040A       009A                            DC       s:15412,PREL
          1 00040B       009A                            DC       s:15412,PREL
          1 00040C       009A                            DC       s:15412,PREL
          1 00040D       009A                            DC       s:15412,PREL
          1 00040E       009A                            DC       s:15412,PREL
          1 00040F       0070                            DC       s:15400,PREL
          1 000410       0077                            DC       s:15402,PREL
          1 000411       007E                            DC       s:15404,PREL
          1 000412       0085                            DC       s:15406,PREL
          1 000413       008C                            DC       s:15408,PREL
          1 000414       009A                            DC       s:15412,PREL
          1 000415       009A                            DC       s:15412,PREL
          1 000416       009A                            DC       s:15412,PREL
          1 000417       009A                            DC       s:15412,PREL
          1 000418       009A                            DC       s:15412,PREL
          1 000419       009A                            DC       s:15412,PREL
          1 00041A       009A                            DC       s:15412,PREL
          1 00041B       009A                            DC       s:15412,PREL
          1 00041C       009A                            DC       s:15412,PREL
          1 00041D       009A                            DC       s:15412,PREL
          1 00041E       009A                            DC       s:15412,PREL
          1 00041F       0093                            DC       s:15410,PREL

      497    15367    5                  CASE(%K_DSCRD_RNS);      /* Reason not specified     */

      498    15368    5                  ERR_CODE = E_DSCRD_RNS;

PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:67   
  15368   1 000420  8C80 0000 0005  00                   LDI      E_DSCRD_RNS
          1 000423  8D47 0068                            SDI      ERR_CODE,AUTO
          1 000425  0F81 0099                            B        s:15414,PREL

      499    15369    5                  CASE(%K_DSCRD_PPE);      /* Protocol procedure error */

      500    15370    5                  ERR_CODE = E_DSCRD_PPE;

  15370   1 000427  8C80 0000 0007  00                   LDI      E_DSCRD_PPE
          1 00042A  8D47 0068                            SDI      ERR_CODE,AUTO
          1 00042C  0F81 0092                            B        s:15414,PREL

      501    15371    5                  CASE(%K_DSCRD_IC);       /* Incorrect checksum       */

      502    15372    5                  ERR_CODE = E_DSCRD_IC;

  15372   1 00042E  8C80 0000 0009  00                   LDI      E_DSCRD_IC
          1 000431  8D47 0068                            SDI      ERR_CODE,AUTO
          1 000433  0F81 008B                            B        s:15414,PREL

      503    15373    5                  CASE(%K_DSCRD_CONGEST); /* Pdu discarded due to congestion */

      504    15374    5                  ERR_CODE = E_DSCRD_CONGEST;

  15374   1 000435  8C80 0000 000B  00                   LDI      E_DSCRD_CONGEST
          1 000438  8D47 0068                            SDI      ERR_CODE,AUTO
          1 00043A  0F81 0084                            B        s:15414,PREL

      505    15375    5                  CASE(%K_DSCRD_HDRSNTX);  /* Pdu header syntax error  */

      506    15376    5                  ERR_CODE = E_DSCRD_HDRSNTX;

  15376   1 00043C  8C80 0000 000D  00                   LDI      E_DSCRD_HDRSNTX
          1 00043F  8D47 0068                            SDI      ERR_CODE,AUTO
          1 000441  0F81 007D                            B        s:15414,PREL

      507    15377    5                  CASE(%K_DSCRD_CANTSEG); /* Segmentation needed but not permitted */
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:68   

      508    15378    5                  ERR_CODE = E_DSCRD_CANTSEG;

  15378   1 000443  8C80 0000 000F  00                   LDI      E_DSCRD_CANTSEG
          1 000446  8D47 0068                            SDI      ERR_CODE,AUTO
          1 000448  0F81 0076                            B        s:15414,PREL

      509    15379    5                  CASE(%K_DSCRD_INCMPPDU); /* Incomlete pdu received   */

      510    15380    5                  ERR_CODE = E_DSCRD_INCMPPDU;

  15380   1 00044A  8C80 0000 0011  00                   LDI      E_DSCRD_INCMPPDU
          1 00044D  8D47 0068                            SDI      ERR_CODE,AUTO
          1 00044F  0F81 006F                            B        s:15414,PREL

      511    15381    5                  CASE(%K_DSCRD_DUPOPT);   /* Duplicate option         */

      512    15382    5                  ERR_CODE = E_DSCRD_DUPOPT;

  15382   1 000451  8C80 0000 0013  00                   LDI      E_DSCRD_DUPOPT
          1 000454  8D47 0068                            SDI      ERR_CODE,AUTO
          1 000456  0F81 0068                            B        s:15414,PREL

      513    15383    5                  CASE(%K_DSCRD_DSTUNREACH); /* Destination reachable  */

      514    15384    5                  ERR_CODE = E_DSCRD_DSTUNREACH;

  15384   1 000458  8C80 0000 0015  00                   LDI      E_DSCRD_DSTUNREACH
          1 00045B  8D47 0068                            SDI      ERR_CODE,AUTO
          1 00045D  0F81 0061                            B        s:15414,PREL

      515    15385    5                  CASE(%K_DSCRD_DSTUNKNWN); /* Destination unknown*/

      516    15386    5                  ERR_CODE = E_DSCRD_DSTUNKNWN;

  15386   1 00045F  8C80 0000 0017  00                   LDI      E_DSCRD_DSTUNKNWN
          1 000462  8D47 0068                            SDI      ERR_CODE,AUTO
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:69   
          1 000464  0F81 005A                            B        s:15414,PREL

      517    15387    5                  CASE(%K_DSCRD_SRCRTEERR); /* Unspecifed source routing error*/

      518    15388    5                  ERR_CODE = E_DSCRD_SRCRTEERR;

  15388   1 000466  8C80 0000 0019  00                   LDI      E_DSCRD_SRCRTEERR
          1 000469  8D47 0068                            SDI      ERR_CODE,AUTO
          1 00046B  0F81 0053                            B        s:15414,PREL

      519    15389    5                 CASE(%K_DSCRD_SRCRTESNTX); /* Syntax error in source routing field */

      520    15390    5                  ERR_CODE = E_DSCRD_SRCRTESNTX;

  15390   1 00046D  8C80 0000 001B  00                   LDI      E_DSCRD_SRCRTESNTX
          1 000470  8D47 0068                            SDI      ERR_CODE,AUTO
          1 000472  0F81 004C                            B        s:15414,PREL

      521    15391    5                  CASE(%K_DSCRD_SRCRTEUNKWN);
             15391                           /* Unknown address in source routing field */

      522    15392    5                  ERR_CODE = E_DSCRD_SRCRTEUNKWN;

  15392   1 000474  8C80 0000 001D  00                   LDI      E_DSCRD_SRCRTEUNKWN
          1 000477  8D47 0068                            SDI      ERR_CODE,AUTO
          1 000479  0F81 0045                            B        s:15414,PREL

      523    15393    5                  CASE(%K_DSCRD_PTHNOTACPT); /* Path not acceptable*/

      524    15394    5                  ERR_CODE = E_DSCRD_PTHNOTACPT;

  15394   1 00047B  8C80 0000 001F  00                   LDI      E_DSCRD_PTHNOTACPT
          1 00047E  8D47 0068                            SDI      ERR_CODE,AUTO
          1 000480  0F81 003E                            B        s:15414,PREL

      525    15395    5                  CASE(%K_DSCRD_LIFEEXPTRAN); /* Lifetime expired in transit*/

PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:70   
      526    15396    5                  ERR_CODE = E_DSCRD_LIFEEXPTRAN;

  15396   1 000482  8C80 0000 0021  00                   LDI      E_DSCRD_LIFEEXPTRAN
          1 000485  8D47 0068                            SDI      ERR_CODE,AUTO
          1 000487  0F81 0037                            B        s:15414,PREL

      527    15397    5                  CASE(%K_DSCRD_LIFEEXPASSM); /* Lifetime expired during assembly */

      528    15398    5                  ERR_CODE = E_DSCRD_LIFEEXPASSM;

  15398   1 000489  8C80 0000 0023  00                   LDI      E_DSCRD_LIFEEXPASSM
          1 00048C  8D47 0068                            SDI      ERR_CODE,AUTO
          1 00048E  0F81 0030                            B        s:15414,PREL

      529    15399    5                  CASE(%K_DSCRD_OPTNON); /* Unsupported option not specified */

      530    15400    5                  ERR_CODE = E_DSCRD_OPTNON;

  15400   1 000490  8C80 0000 0025  00                   LDI      E_DSCRD_OPTNON
          1 000493  8D47 0068                            SDI      ERR_CODE,AUTO
          1 000495  0F81 0029                            B        s:15414,PREL

      531    15401    5                  CASE(%K_DSCRD_OPTPRCLVERS); /* Unsupported protocol version*/

      532    15402    5                  ERR_CODE = E_DSCRD_OPTPRCLVERS;

  15402   1 000497  8C80 0000 0027  00                   LDI      E_DSCRD_OPTPRCLVERS
          1 00049A  8D47 0068                            SDI      ERR_CODE,AUTO
          1 00049C  0F81 0022                            B        s:15414,PREL

      533    15403    5                  CASE(%K_DSCRD_OPTSEC); /* Unsupported security option*/

      534    15404    5                  ERR_CODE = E_DSCRD_OPTSEC;

  15404   1 00049E  8C80 0000 0029  00                   LDI      E_DSCRD_OPTSEC
          1 0004A1  8D47 0068                            SDI      ERR_CODE,AUTO
          1 0004A3  0F81 001B                            B        s:15414,PREL
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:71   

      535    15405    5                  CASE(%K_DSCRD_OPTSRCRTE); /* Unsupported source routing option*/

      536    15406    5                  ERR_CODE = E_DSCRD_OPTSRCRTE;

  15406   1 0004A5  8C80 0000 002B  00                   LDI      E_DSCRD_OPTSRCRTE
          1 0004A8  8D47 0068                            SDI      ERR_CODE,AUTO
          1 0004AA  0F81 0014                            B        s:15414,PREL

      537    15407    5                  CASE(%K_DSCRD_OPTRECRTE); /* Unsupported recording route option*/

      538    15408    5                  ERR_CODE = E_DSCRD_OPTRECRTE;

  15408   1 0004AC  8C80 0000 002D  00                   LDI      E_DSCRD_OPTRECRTE
          1 0004AF  8D47 0068                            SDI      ERR_CODE,AUTO
          1 0004B1  0F81 000D                            B        s:15414,PREL

      539    15409    5                  CASE(%K_DSCRD_REASSEM);  /* Reassembly interface     */

      540    15410    5                  ERR_CODE = E_DSCRD_REASSEM;

  15410   1 0004B3  8C80 0000 002F  00                   LDI      E_DSCRD_REASSEM
          1 0004B6  8D47 0068                            SDI      ERR_CODE,AUTO
          1 0004B8  0F81 0006                            B        s:15414,PREL

      541    15411    5                  CASE(ELSE);

      542    15412    5                  ERR_CODE = E_DSCRD_RNS;

  15412   1 0004BA  8C80 0000 0005  00                   LDI      E_DSCRD_RNS
          1 0004BD  8D47 0068                            SDI      ERR_CODE,AUTO

      543    15413    5                  END;                     /* do case (err_code)*/

      544    15414    4               ADDR(ERRVAL(0))->CALLEDFROM$ = ENTADDR(KNN$RECVOSI);

  15414   1 0004BF  CBC0 FB40                            LAB,B4   s:21,PREL
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:72   
          1 0004C1  CFC7 0081                            STB,B4   ERRVAL,AUTO

      545    15415    4               CALL GHE$ERRLOG(ERR_CODE,ERRVAL,K$NPDU_FIXED,SIZEC(K$NPDU_FIXED),'0'B);

  15415   1 0004C3  BCC6 000E                            LDB,B3   14,B6
          1 0004C5  9BF0 000A                            LAB,B1   10,IMO
          1 0004C7  EBF0 0000                            LAB,B6   0,IMO
          1 0004C9  EFC7 0098                            STB,B6   SNPATMPLT3+15,AUTO
          1 0004CB  9FC7 0096                            STB,B1   SNPATMPLT3+13,AUTO
          1 0004CD  BFC7 0094                            STB,B3   SNPATMPLT3+11,AUTO
          1 0004CF  EBC7 0081                            LAB,B6   ERRVAL,AUTO
          1 0004D1  EFC7 0092                            STB,B6   SNPATMPLT3+9,AUTO
          1 0004D3  EBC7 0068                            LAB,B6   ERR_CODE,AUTO
          1 0004D5  EFC7 0090                            STB,B6   SNPATMPLT3+7,AUTO
          1 0004D7  BBC7 0090                            LAB,B3   SNPATMPLT3+7,AUTO
          1 0004D9  CBF0 0500                            LAB,B4   1280,IMO
          1 0004DB  E380 0000 0000  xent                 LNJ,B6   GHE$ERRLOG
          1 0004DE       0001                            DC       s:15416,PREL

      546    15416    4               GOTO EXITOSINET;

  15416   1 0004DF  0F81 021D                            B        s:15552,PREL

      547    15417    4               END;
      548    15418    3            ELSE
      549    15419    4               IF K$NPDU_FIXED.TYPE ~= %K_ESH_PDU OR K$NPDU_FIXED.TYPE ~= %K_ISH_PDU
             15419                        THEN DO;

  15419   1 0004E1  3D02                                 CMV,R3   2
          1 0004E2  0981 0004                            BNE      s:15420,PREL
          1 0004E4  3D04                                 CMV,R3   4
          1 0004E5  0901 000B                            BE       s:15427,PREL

      550    15420    4                  KN$NETPARM.ERRCODE = %K_DSCRD_HDRSNTX;

  15420   1 0004E7  2C04                                 LDV,R2   4
          1 0004E8  AF46 0016                            STR,R2   22,B6
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:73   

      551    15421    4                  ERR_CODE = E_DSCRD_HDRSNTX;

  15421   1 0004EA  8C80 0000 000D  00                   LDI      E_DSCRD_HDRSNTX
          1 0004ED  8D47 0068                            SDI      ERR_CODE,AUTO

      552    15422    4                  GOTO ERR;

  15422   1 0004EF  0F81 01D3                            B        s:15537,PREL

      553    15423    4                  END;
      554    15424
      555    15425    3            END;
      556    15426
      557    15427    3         IF DSTROUTE.NS_TYPE = %K_TYPE_LNSAP THEN DO;

  15427   1 0004F1  4D01                                 CMV,R4   1
          1 0004F2  0981 00B7                            BNE      s:15486,PREL

      558    15428        /*
      559    15429             the destination address is one of our addresses.  make sure that the
      560    15430             destination node specified is a host and that it is link connected
      561    15431        */
      562    15432    3            IF DSTROUTE.HOST# > KNN_NODES

  15432   1 0004F4  A2C7 0049                            LLH,R2   DSTROUTE+1,AUTO
          1 0004F6  A900 0000 0000  xsym                 CMR,R2   KNN_NODES
          1 0004F9  0301 0019                            BG       s:15439,PREL
          1 0004FB  CC80 0000 0000  xsym                 LDB,B4   KNN_ROUTE$$
          1 0004FE  BCA4                                 LDB,B3   ,B4,R2
          1 0004FF  82C3 0007                            LB,'4000'X        7,B3
          1 000501       4000
          1 000502  0581 0010                            BBF      s:15439,PREL
          1 000504  89C3 0007                            CMZ      7,B3
          1 000506  0881 000C                            BAGE     s:15439,PREL
          1 000508  D970 00FF                            CMR,R5   255,IMO
          1 00050A  0901 0008                            BE       s:15439,PREL
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:74   
          1 00050C  8D83                                 CMN      ,B3
          1 00050D  0901 0005                            BE       s:15439,PREL
          1 00050F  AC83                                 LDB,B2   ,B3
          1 000510  8D82                                 CMN      ,B2
          1 000511  0981 000C                            BNE      s:15444,PREL

      563    15433    3              OR NOT KNN$ROUTE$(DSTROUTE.HOST#)->KNN$ROUTE.FLAGS.LINK_CONNECTED
      564    15434    3              OR NOT KNN$ROUTE$(DSTROUTE.HOST#)->KNN$ROUTE.FLAGS.HOST_NODE
      565    15435    3              OR DSTROUTE.QOS = 255
      566    15436    3              OR KNN$ROUTE$(DSTROUTE.HOST#)->KNN$ROUTE.LINK$ = ADDR(NIL)
      567    15437    3             OR KNN$ROUTE$(DSTROUTE.HOST#)->KNN$ROUTE.LINK$->KNN$LINK.LDCT$ = ADDR(NIL
             15437                       )
      568    15438    4            THEN DO;

      569    15439    4               KN$NETPARM.ERRCODE = %K_DSCRD_DSTUNREACH;

  15439   1 000513  9870 0080                            LDR,R1   128,IMO
          1 000515  9F46 0016                            STR,R1   22,B6

      570    15440    4               ERR_CODE = E_DSCRD_DSTUNREACH;

  15440   1 000517  8C80 0000 0015  00                   LDI      E_DSCRD_DSTUNREACH
          1 00051A  8D47 0068                            SDI      ERR_CODE,AUTO

      571    15441    4               GOTO ERR;

  15441   1 00051C  0F81 01A6                            B        s:15537,PREL

      572    15442    4               END;
      573    15443
      574    15444    3            KN$NETPARM.FUNCTION = %K_NDATA;

  15444   1 00051E  1C21                                 LDV,R1   33
          1 00051F  9F46 0014                            STR,R1   20,B6

      575    15445    4            IF K$NPDU_FIXED.MS = '0'B AND SEGMENT.TOTLEN = SEGLENGTH THEN DO;

PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:75   
  15445   1 000521  82C5 0002                            LB,'4000'X        2,B5
  15445   1 000523       4000
          1 000524  0501 0053                            BBT      s:15467,PREL
          1 000526  E847 0029                            LDR,R6   SEGMENT+2,AUTO
          1 000528  E947 006F                            CMR,R6   SEGLENGTH,AUTO
          1 00052A  0981 004D                            BNE      s:15467,PREL

      576    15446    4               KN$NETPARM.NODE = DSTROUTE.HOST#;

  15446   1 00052C  D2C7 0049                            LLH,R5   DSTROUTE+1,AUTO
          1 00052E  DF46 0015                            STR,R5   21,B6

      577    15447    5               CALL KNT$RECV_4HOST(KN$NETPARM) WHENRETURN DO;

  15447   1 000530  BBC7 0004                            LAB,B3   @KN$NETPARM,AUTO
          1 000532  CBF0 0100                            LAB,B4   256,IMO
          1 000534  E380 0000 0000  xent                 LNJ,B6   KNT$RECV_4HOST
          1 000537       0007                            DC       s:15451,PREL

      578    15448    5                  KN$NETPARM.THDRSZ = 0;

  15448   1 000538  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 00053A  8746 000D                            CL       13,B6

      579    15449    5                  END;

  15449   1 00053C  0F81 0009                            B        s:15455,PREL

      580    15450    5               WHENALTRETURN DO;

      581    15451    5                  IF KN$NETPARM.ERRCODE ~= 0 THEN GOTO ERR2; /*altret*/

  15451   1 00053E  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 000540  E846 0016                            LDR,R6   22,B6
          1 000542  6981 01C8                            BNEZ,R6  s:15558,PREL

      582    15452    5                  ELSE                /* message buffered by trans     */
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:76   
      583    15453    5                     GOTO EXITOSINET;

  15453   1 000544  0F81 01B8                            B        s:15552,PREL

      584    15454    5                  END;
      585    15455    4              KN$NETPARM.LDCT$ = KNN$ROUTE$(DSTROUTE.HOST#)->KNN$ROUTE.LINK$->KNN$LINK
             15455                        .LDCT$;

  15455   1 000546  DC80 0000 0000  xsym                 LDB,B5   KNN_ROUTE$$
          1 000549  B2C7 0049                            LLH,R3   DSTROUTE+1,AUTO
          1 00054B  CCB5                                 LDB,B4   ,B5,R3
          1 00054C  BC84                                 LDB,B3   ,B4
          1 00054D  AC83                                 LDB,B2   ,B3
          1 00054E  AF86                                 STB,B2   ,B6

      586    15456    4               NQDP_HDR = K$NQDP_HDR_C;

  15456   1 00054F  8C80 0000 0000  00                   LDI      K$NQDP_HDR_C
          1 000552  8D47 0066                            SDI      NQDP_HDR,AUTO

      587    15457    4               NQDP_HDR.DEST_NODE = DSTROUTE.HOST#+1;

  15457   1 000554  D2C7 0049                            LLH,R5   DSTROUTE+1,AUTO
          1 000556  5E01                                 ADV,R5   1
          1 000557  D7C7 0067                            STH,R5   NQDP_HDR+1,AUTO

      588    15458    4               NQDP_HDR.SOURCE_NODE = SRCROUTE.FEP#+1;

  15458   1 000559  C847 002B                            LDR,R4   SRCROUTE+1,AUTO
          1 00055B  C570 00FF                            AND,R4   255,IMO
          1 00055D  4E01                                 ADV,R4   1
          1 00055E  CAC7 0067                            SRM,R4,'00FF'X    NQDP_HDR+1,AUTO
          1 000560       00FF

      589    15459    4               KN$NETPARM.NHDR$ = ADDR(NQDP_HDR);

  15459   1 000561  DBC7 0066                            LAB,B5   NQDP_HDR,AUTO
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:77   
          1 000563  DFC6 000E                            STB,B5   14,B6

      590    15460    4               KN$NETPARM.NHDRSZ = LENGTHC(NQDP_HDR);

  15460   1 000565  5C04                                 LDV,R5   4
          1 000566  DF46 0010                            STR,R5   16,B6

      591    15461    4               KN$NETPARM.UHDRSZ = 0;

  15461   1 000568  8746 0007                            CL       7,B6

      592    15462    4              KN$NETPARM.LDCT$ = KNN$ROUTE$(DSTROUTE.HOST#)->KNN$ROUTE.LINK$->KNN$LINK
             15462                        .LDCT$;

  15462   1 00056A  CC80 0000 0000  xsym                 LDB,B4   KNN_ROUTE$$
          1 00056D  B2C7 0049                            LLH,R3   DSTROUTE+1,AUTO
          1 00056F  BCB4                                 LDB,B3   ,B4,R3
          1 000570  AC83                                 LDB,B2   ,B3
          1 000571  9C82                                 LDB,B1   ,B2
          1 000572  9F86                                 STB,B1   ,B6

      593    15463    4               CALL FORWARD ALTRET(ERR2);

  15463   1 000573  E3C0 01A5                            LNJ,B6   s:0,PREL
          1 000575       0196                            DC       s:15558,PREL

      594    15464    4               GOTO EXITOSINET;

  15464   1 000576  0F81 0186                            B        s:15552,PREL

      595    15465    4               END;
      596    15466    4            ELSE DO;

      597    15467    4               KN$NETPARM.NODE = DSTROUTE.HOST#;

  15467   1 000578  E2C7 0049                            LLH,R6   DSTROUTE+1,AUTO
          1 00057A  EF46 0015                            STR,R6   21,B6
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:78   

      598    15468    5               CALL KNN$REASSEM(KN$NETPARM,DSTROUTE,SRCROUTE) WHENALTRETURN DO;

  15468   1 00057C  BBC7 002A                            LAB,B3   SRCROUTE,AUTO
          1 00057E  BFC7 0094                            STB,B3   SNPATMPLT3+11,AUTO
          1 000580  DBC7 0048                            LAB,B5   DSTROUTE,AUTO
          1 000582  DFC7 0092                            STB,B5   SNPATMPLT3+9,AUTO
          1 000584  EFC7 0090                            STB,B6   SNPATMPLT3+7,AUTO
          1 000586  BBC7 0090                            LAB,B3   SNPATMPLT3+7,AUTO
          1 000588  CBF0 0300                            LAB,B4   768,IMO
          1 00058A  E380 0000 0000  xent                 LNJ,B6   KNN$REASSEM
          1 00058D       0003                            DC       s:15469,PREL
          1 00058E  0F81 0019                            B        s:15481,PREL

      599    15469    5                  IF KN$NETPARM.ERRCODE = 0 THEN

  15469   1 000590  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 000592  E846 0016                            LDR,R6   22,B6
          1 000594  6901 0168                            BEZ,R6   s:15552,PREL

      600    15470        /*
      601    15471           message complete and delivered to transport and forwarded to the host.
      602    15472        */
      603    15473    5                     GOTO EXITOSINET;
      604    15474    5                  IF KN$NETPARM.ERRCODE = %K_DSCRD_REASSEM THEN

  15474   1 000596  E970 00C0                            CMR,R6   192,IMO
          1 000598  0981 0008                            BNE      s:15477,PREL

      605    15475    5                     ERR_CODE = E_DSCRD_REASSEM;

  15475   1 00059A  8C80 0000 002F  00                   LDI      E_DSCRD_REASSEM
          1 00059D  8D47 0068                            SDI      ERR_CODE,AUTO
          1 00059F  0F81 0006                            B        s:15478,PREL

      606    15476    5                  ELSE
      607    15477    5                     ERR_CODE = E_DSCRD_CANTSEG;
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:79   

  15477   1 0005A1  8C80 0000 000F  00                   LDI      E_DSCRD_CANTSEG
          1 0005A4  8D47 0068                            SDI      ERR_CODE,AUTO

      608    15478    5                  GOTO ERR;

  15478   1 0005A6  0F81 011C                            B        s:15537,PREL

      609    15479    5                  END;
      610    15480    4               END;

      611    15481    3            END;                           /* if dstforhost            */

  15481   1 0005A8  0F81 0118                            B        s:15541,PREL

      612    15482    3         ELSE DO;                          /* else type = rnsap        */

      613    15483             /*
      614    15484             search vc list for a currently active connection
      615    15485             */
      616    15486    4            DO J = 0 TO KNN_LINKS - 1;

  15486   1 0005AA  8747 0080                            CL       J,AUTO
          1 0005AC  0F81 0065                            B        s:15493+2,PREL

      617    15487    4               LINK$ = KNN$LINK$(J);

  15487   1 0005AE  EC80 0000 0000  xsym                 LDB,B6   KNN_LINK$$
          1 0005B1  B847 0080                            LDR,R3   J,AUTO
          1 0005B3  DCB6                                 LDB,B5   ,B6,R3
          1 0005B4  DFC7 0076                            STB,B5   LINK$,AUTO

      618    15488    4               IF KNN$LINK.FLAGS.VIRCIR

  15488   1 0005B6  82C5 0003                            LB,'1000'X        3,B5
  15488   1 0005B8       1000
          1 0005B9  0581 0056                            BBF      s:15493,PREL
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:80   
          1 0005BB  E845 0002                            LDR,R6   2,B5
          1 0005BD  E970 00FD                            CMR,R6   253,IMO
          1 0005BF  0201 0050                            BL       s:15493,PREL
          1 0005C1  D2C7 0062                            LLH,R5   DSTROUTE+26,AUTO
          1 0005C3  C2C5 001F                            LLH,R4   31,B5
          1 0005C5  D954                                 CMR,R5   R4
          1 0005C6  0981 0049                            BNE      s:15493,PREL

      619    15489    4                 AND KNN$LINK.NODE# >= %K_CNC_IS#
      620    15490    5                 AND DSTROUTE.SNPA.LEN = KNN$LINK.SNPA.LEN THEN DO;

      621    15491    5                  SNPATMPLT1 = DSTROUTE.SNPA.ADDRESS;

  15491   1 0005C8  0021                                 ALR      ;
          1 0005C9       C707 0062                                ALPHANUM(DSTROUTE+26,AUTO,1,7),;
          1 0005CB       4807 0085                                ALPHANUM(SNPATMPLT1,AUTO,,8,FILL)

      622    15492    5                  SNPATMPLT3 = KNN$LINK.SNPA.ADDRESS;

  15492   1 0005CD  0021                                 ALR      ;
          1 0005CE       C705 001F                                ALPHANUM(31,B5,1,7),;
          1 0005D0       4807 0089                                ALPHANUM(SNPATMPLT3,AUTO,,8,FILL)

      623    15493    6                  DO I = 0 TO DSTROUTE.SNPA.LEN - 1;

  15493   1 0005D2  437F                                 CSYNC    s:15492+4,SPREL
          1 0005D3  8747 007F                            CL       I,AUTO
          1 0005D5  0F81 002A                            B        s:15496+2,PREL

      624    15494    6                     IF SNPATMPLT2.NIBBLES.NIB(I) ~= SNPATMPLT4.NIBBLES.NIB(I) THEN

  15494   1 0005D7  ABC7 0085                            LAB,B2   SNPATMPLT1,AUTO
          1 0005D9  A847 007F                            LDR,R2   I,AUTO
          1 0005DB  2002                                 SOL,R2   2
          1 0005DC  6C04                                 LDV,R6   4
          1 0005DD  BBC7 0090                            LAB,B3   SNPATMPLT3+7,AUTO
          1 0005DF  3C00                                 LDV,R3   0
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:81   
          1 0005E0  7C10                                 LDV,R7   16
          1 0005E1  D380 0000 0000  xent                 LNJ,B5   X6B_BLR
          1 0005E4  E847 0090                            LDR,R6   SNPATMPLT3+7,AUTO
          1 0005E6  604C                                 SOR,R6   12
          1 0005E7  EF47 0092                            STR,R6   SNPATMPLT3+9,AUTO
          1 0005E9  ABC7 0089                            LAB,B2   SNPATMPLT3,AUTO
          1 0005EB  A847 007F                            LDR,R2   I,AUTO
          1 0005ED  2002                                 SOL,R2   2
          1 0005EE  6C04                                 LDV,R6   4
          1 0005EF  BBC7 0090                            LAB,B3   SNPATMPLT3+7,AUTO
          1 0005F1  3C10                                 LDV,R3   16
          1 0005F2  7C10                                 LDV,R7   16
          1 0005F3  D380 0000 0000  xent                 LNJ,B5   X6B_BLR
          1 0005F6  E847 0091                            LDR,R6   SNPATMPLT3+8,AUTO
          1 0005F8  604C                                 SOR,R6   12
          1 0005F9  D847 0092                            LDR,R5   SNPATMPLT3+9,AUTO
          1 0005FB  E955                                 CMR,R6   R5
          1 0005FC  0981 0013                            BNE      s:15493,PREL

      625    15495    6                        GOTO NXTJ;
      626    15496    6                     END;                  /* i = 0 to len-1           */

  15496   1 0005FE  8AC7 007F                            INC      I,AUTO
          1 000600  E2C7 0062                            LLH,R6   DSTROUTE+26,AUTO
          1 000602  E947 007F                            CMR,R6   I,AUTO
          1 000604  0353                                 BG       s:15494,SPREL

      627    15497    5                  KN$NETPARM.LDCT$ = KNN$LINK.LDCT$;

  15497   1 000605  ECC7 0076                            LDB,B6   LINK$,AUTO
          1 000607  DC86                                 LDB,B5   ,B6
          1 000608  CCC7 0004                            LDB,B4   @KN$NETPARM,AUTO
          1 00060A  DF84                                 STB,B5   ,B4

      628    15498    5                  CALL FORWARD ALTRET(ERR2);

  15498   1 00060B  E3C0 010D                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:82   
          1 00060D       00FE                            DC       s:15558,PREL

      629    15499    5                  GOTO EXITOSINET;

  15499   1 00060E  0F81 00EE                            B        s:15552,PREL

  15493   1                              NXTJ            null
      630    15500    5                  END;                     /*  if vircir et al         */
      631    15501    4   NXTJ:       ;
      632    15502    4               END;                        /* do j = 0 to knn_links    */

  15502   1 000610  8AC7 0080            NXTJ            INC      J,AUTO
          1 000612  E847 0080                            LDR,R6   J,AUTO
          1 000614  E900 0000 0000  xsym                 CMR,R6   KNN_LINKS
          1 000617  0201 FF96                            BL       s:15487,PREL

      633    15503                /*
      634    15504                no vc connection currently running.  try to find a substr match
      635    15505                */
      636    15506    4            DO J = 0 TO KNN_LINKS - 1;

  15506   1 000619  8747 0080                            CL       J,AUTO
          1 00061B  0F81 0072                            B        s:15517+2,PREL

      637    15507    4               LINK$ = KNN$LINK$(J);

  15507   1 00061D  EC80 0000 0000  xsym                 LDB,B6   KNN_LINK$$
          1 000620  B847 0080                            LDR,R3   J,AUTO
          1 000622  DCB6                                 LDB,B5   ,B6,R3
          1 000623  DFC7 0076                            STB,B5   LINK$,AUTO

      638    15508    5               IF NOT KNN$LINK.FLAGS.VIRCIR AND KNN$LINK.NODE# >= %K_CNC_IS# THEN DO;

  15508   1 000625  82C5 0003                            LB,'1000'X        3,B5
  15508   1 000627       1000
          1 000628  0501 0063                            BBT      s:15517,PREL
          1 00062A  E845 0002                            LDR,R6   2,B5
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:83   
          1 00062C  E970 00FD                            CMR,R6   253,IMO
          1 00062E  0201 005D                            BL       s:15517,PREL

      639    15509    5                  SNPATMPLT1 = DSTROUTE.SNPA.ADDRESS;

  15509   1 000630  0021                                 ALR      ;
          1 000631       C707 0062                                ALPHANUM(DSTROUTE+26,AUTO,1,7),;
          1 000633       4807 0085                                ALPHANUM(SNPATMPLT1,AUTO,,8,FILL)

      640    15510    5                  SNPATMPLT3 = KNN$LINK.SNPA.ADDRESS;

  15510   1 000635  0021                                 ALR      ;
          1 000636       C705 001F                                ALPHANUM(31,B5,1,7),;
          1 000638       4807 0089                                ALPHANUM(SNPATMPLT3,AUTO,,8,FILL)

      641    15511    6                  DO I = 0 TO MINIMUM(DSTROUTE.NSAP.LEN,KNN$LINK.SNPA.LEN)-1;

  15511   1 00063A  437F                                 CSYNC    s:15510+4,SPREL
          1 00063B  8747 007F                            CL       I,AUTO
          1 00063D  0F81 002A                            B        s:15514+2,PREL

      642    15512    6                     IF SNPATMPLT2.NIBBLES.NIB(I) ~= SNPATMPLT4.NIBBLES.NIB(I) THEN

  15512   1 00063F  ABC7 0085                            LAB,B2   SNPATMPLT1,AUTO
          1 000641  A847 007F                            LDR,R2   I,AUTO
          1 000643  2002                                 SOL,R2   2
          1 000644  6C04                                 LDV,R6   4
          1 000645  BBC7 0090                            LAB,B3   SNPATMPLT3+7,AUTO
          1 000647  3C00                                 LDV,R3   0
          1 000648  7C10                                 LDV,R7   16
          1 000649  D380 0000 0000  xent                 LNJ,B5   X6B_BLR
          1 00064C  E847 0090                            LDR,R6   SNPATMPLT3+7,AUTO
          1 00064E  604C                                 SOR,R6   12
          1 00064F  EF47 0092                            STR,R6   SNPATMPLT3+9,AUTO
          1 000651  ABC7 0089                            LAB,B2   SNPATMPLT3,AUTO
          1 000653  A847 007F                            LDR,R2   I,AUTO
          1 000655  2002                                 SOL,R2   2
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:84   
          1 000656  6C04                                 LDV,R6   4
          1 000657  BBC7 0090                            LAB,B3   SNPATMPLT3+7,AUTO
          1 000659  3C10                                 LDV,R3   16
          1 00065A  7C10                                 LDV,R7   16
          1 00065B  D380 0000 0000  xent                 LNJ,B5   X6B_BLR
          1 00065E  E847 0091                            LDR,R6   SNPATMPLT3+8,AUTO
          1 000660  604C                                 SOR,R6   12
          1 000661  D847 0092                            LDR,R5   SNPATMPLT3+9,AUTO
          1 000663  E955                                 CMR,R6   R5
          1 000664  0981 0027                            BNE      s:15517,PREL

      643    15513    6                        GOTO NXTJ2;
      644    15514    6                     END;             /* do i = 0 to min(len,len)-1    */

  15514   1 000666  8AC7 007F                            INC      I,AUTO
          1 000668  ECC7 0076                            LDB,B6   LINK$,AUTO
          1 00066A  E2C6 001F                            LLH,R6   31,B6
          1 00066C  D2C7 004C                            LLH,R5   DSTROUTE+4,AUTO
          1 00066E  D956                                 CMR,R5   R6
          1 00066F  0281 0002                            BGE      s:15514+12,PREL
          1 000671  E855                                 LDR,R6   R5
          1 000672  E947 007F                            CMR,R6   I,AUTO
          1 000674  034B                                 BG       s:15512,SPREL

      645    15515    5                  FPT_NSAP.NSAP.LEN = DSTROUTE.SNPA.LEN;

  15515   1 000675  E2C7 0062                            LLH,R6   DSTROUTE+26,AUTO
          1 000677  E7C7 001C                            STH,R6   FPT_NSAP,AUTO

      646    15516    5                  FPT_NSAP.NSAP.ADDRESS = DSTROUTE.SNPA.ADDRESS;

  15516   1 000679  0021                                 ALR      ;
          1 00067A       C707 0062                                ALPHANUM(DSTROUTE+26,AUTO,1,7),;
          1 00067C       5407 001D                                ALPHANUM(FPT_NSAP+1,AUTO,,20,FILL)

      647    15517    5                  KN$NETPARM.FPT$ = ADDR(FPT_NSAP);

PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:85   
  15517   1 00067E  DBC7 001C                            LAB,B5   FPT_NSAP,AUTO
          1 000680  CCC7 0004                            LDB,B4   @KN$NETPARM,AUTO
          1 000682  437F                                 CSYNC    s:15517+3,SPREL
          1 000683  DFC4 0019                            STB,B5   25,B4

      648    15518    5                  KN$NETPARM.LDCT$ = KNN$LINK.LDCT$;

  15518   1 000685  BC86                                 LDB,B3   ,B6
          1 000686  BF84                                 STB,B3   ,B4

      649    15519    5                  CALL FORWARD ALTRET(ERR2);

  15519   1 000687  E3C0 0091                            LNJ,B6   s:0,PREL
          1 000689       0082                            DC       s:15558,PREL

      650    15520    5                  GOTO EXITOSINET;

  15520   1 00068A  0F81 0072                            B        s:15552,PREL

  15517   1                              NXTJ2           null
      651    15521    5                  END;                     /* not vc and node# > is    */
      652    15522    4   NXTJ2:      ;
      653    15523    4               END;                   /* do j = 0 to knn_links - 1     */

  15523   1 00068C  8AC7 0080            NXTJ2           INC      J,AUTO
          1 00068E  E847 0080                            LDR,R6   J,AUTO
          1 000690  E900 0000 0000  xsym                 CMR,R6   KNN_LINKS
          1 000693  0201 FF89                            BL       s:15507,PREL

      654    15524    3            END;                           /* else type = rnsap        */

      655    15525    2         END;                              /* If dstnode = KN_NODE#    */

  15525   1 000695  0F81 002B                            B        s:15541,PREL

      656    15526    2      ELSE DO;                   /* message not bound for our node     */

PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:86   
      657    15527
      658    15528    2         ROUTE$ = KNN$ROUTE$(DSTROUTE.FEP#);

  15528   1 000697  B856                                 LDR,R3   R6
          1 000698  EC80 0000 0000  xsym                 LDB,B6   KNN_ROUTE$$
          1 00069B  DCB6                                 LDB,B5   ,B6,R3
          1 00069C  DFC7 0078                            STB,B5   ROUTE$,AUTO

      659    15529    2         LINK$ = KNN$ROUTE.LINK$;

  15529   1 00069E  CC85                                 LDB,B4   ,B5
          1 00069F  CFC7 0076                            STB,B4   LINK$,AUTO

      660    15530
      661    15531    2         IF KNN$ROUTE.CURRENT_QOS = 255

  15531   1 0006A1  A845 0005                            LDR,R2   5,B5
          1 0006A3  A970 00FF                            CMR,R2   255,IMO
          1 0006A5  0901 0007                            BE       s:15533,PREL
          1 0006A7  8D85                                 CMN      ,B5
          1 0006A8  0901 0004                            BE       s:15533,PREL
          1 0006AA  8D84                                 CMN      ,B4
          1 0006AB  0981 000E                            BNE      s:15537,PREL

      662    15532    3           OR KNN$ROUTE.LINK$ = ADDR(NIL) OR KNN$LINK.LDCT$ = ADDR(NIL) THEN DO;

      663    15533    3            KN$NETPARM.ERRCODE = %K_DSCRD_DSTUNREACH;

  15533   1 0006AD  BCC7 0004                            LDB,B3   @KN$NETPARM,AUTO
          1 0006AF  9870 0080                            LDR,R1   128,IMO
          1 0006B1  9F43 0016                            STR,R1   22,B3

      664    15534    3            ERR_CODE = E_DSCRD_DSTUNREACH;

  15534   1 0006B3  8C80 0000 0015  00                   LDI      E_DSCRD_DSTUNREACH
          1 0006B6  8D47 0068                            SDI      ERR_CODE,AUTO

PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:87   
      665    15535    3            GOTO ERR;

  15535   1 0006B8  0F81 000A                            B        s:15537,PREL

      666    15536    3            END;
      667    15537    2         KN$NETPARM.LDCT$ = KNN$LINK.LDCT$;

  15537   1 0006BA  BC84                                 LDB,B3   ,B4
          1 0006BB  ACC7 0004                            LDB,B2   @KN$NETPARM,AUTO
          1 0006BD  BF82                                 STB,B3   ,B2

      668    15538    2         CALL FORWARD ALTRET(ERR2);

  15538   1 0006BE  E3C0 005A                            LNJ,B6   s:0,PREL
          1 0006C0       004B                            DC       s:15558,PREL

      669    15539    2         END;               /* else message not bound for this node    */

      670    15540
      671    15541    1      GOTO EXITOSINET;

  15541   1 0006C1  0F81 003B                            B        s:15552,PREL

  15537   1                              ERR             null
      672    15542
      673    15543    1   ERR:; /* message is to be discarded and a error pdu generated if possible*/
      674    15544    1      ADDR(ERRVAL(0))->CALLEDFROM$ = ENTADDR(KNN$RECVOSI);

  15544   1 0006C3  EBC0 F93C            ERR             LAB,B6   s:21,PREL
          1 0006C5  EFC7 0081                            STB,B6   ERRVAL,AUTO

      675    15545    1      CALL GHE$ERRLOG(ERR_CODE,ERRVAL,K$NPDU_FIXED,SIZEC(K$NPDU_FIXED),'0'B);

  15545   1 0006C7  DCC7 0004                            LDB,B5   @KN$NETPARM,AUTO
          1 0006C9  CCC5 000E                            LDB,B4   14,B5
          1 0006CB  BBF0 000A                            LAB,B3   10,IMO
          1 0006CD  ABF0 0000                            LAB,B2   0,IMO
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:88   
          1 0006CF  AFC7 0098                            STB,B2   SNPATMPLT3+15,AUTO
          1 0006D1  BFC7 0096                            STB,B3   SNPATMPLT3+13,AUTO
          1 0006D3  CFC7 0094                            STB,B4   SNPATMPLT3+11,AUTO
          1 0006D5  9BC7 0081                            LAB,B1   ERRVAL,AUTO
          1 0006D7  9FC7 0092                            STB,B1   SNPATMPLT3+9,AUTO
          1 0006D9  EBC7 0068                            LAB,B6   ERR_CODE,AUTO
          1 0006DB  EFC7 0090                            STB,B6   SNPATMPLT3+7,AUTO
          1 0006DD  BBC7 0090                            LAB,B3   SNPATMPLT3+7,AUTO
          1 0006DF  CBF0 0500                            LAB,B4   1280,IMO
          1 0006E1  E380 0000 0000  xent                 LNJ,B6   GHE$ERRLOG
          1 0006E4       0001                            DC       s:15550,PREL

      676    15546        /*
      677    15547                switch the source and destination so that senderr
      678    15548                will send the error back to the bad pdus originator
      679    15549        */
      680    15550    1      KN$NETPARM.NODE = SRCROUTE.FEP#;

  15550   1 0006E5  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 0006E7  E847 002B                            LDR,R6   SRCROUTE+1,AUTO
          1 0006E9  E570 00FF                            AND,R6   255,IMO
          1 0006EB  EF46 0015                            STR,R6   21,B6

      681    15551    1      KN$NETPARM.SRC_ADDR$ = ADDR(DESTINATION);

  15551   1 0006ED  DBC7 0006                            LAB,B5   DESTINATION,AUTO
          1 0006EF  DFC6 001D                            STB,B5   29,B6

      682    15552    1      KN$NETPARM.DST_ADDR$ = ADDR(SOURCE);

  15552   1 0006F1  CBC7 0011                            LAB,B4   SOURCE,AUTO
          1 0006F3  CFC6 001F                            STB,B4   31,B6

      683    15553    1      CALL KNN$SENDERR(KN$NETPARM);

  15553   1 0006F5  BBC7 0004                            LAB,B3   @KN$NETPARM,AUTO
          1 0006F7  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:89   
          1 0006F9  E380 0000 0000  xent                 LNJ,B6   KNN$SENDERR
          1 0006FC       0001                            DC       s:15552,PREL

  15552   1                              EXITOSINET      null
      684    15554
      685    15555    1   EXITOSINET:;
      686    15556    1      KN$NETPARM.RECTYPE = 0; /* was set to indicate index at which error occurred*/

  15556   1 0006FD  ECC7 0004            EXITOSINET      LDB,B6   @KN$NETPARM,AUTO
          1 0006FF  8746 0013                            CL       19,B6

      687    15557    1      KN$NETPARM.FPT$ = SAVE_FPT$;

  15557   1 000701  DCC7 0074                            LDB,B5   SAVE_FPT$,AUTO
          1 000703  DFC6 0019                            STB,B5   25,B6

      688    15558    1      KN$NETPARM.LDCT$ = QQQ$;

  15558   1 000705  CCC7 0072                            LDB,B4   QQQ$,AUTO
          1 000707  CF86                                 STB,B4   ,B6

      689    15559    1      RETURN;

  15559   1 000708  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

  15558   1                              ERR2            null
      690    15560
      691    15561    1   ERR2:;                                  /* dont discard message, yet*/
      692    15562    1      KN$NETPARM.LDCT$ = QQQ$;

  15562   1 00070B  ECC7 0072            ERR2            LDB,B6   QQQ$,AUTO
          1 00070D  DCC7 0004                            LDB,B5   @KN$NETPARM,AUTO
          1 00070F  EF85                                 STB,B6   ,B5

      693    15563    1      KN$NETPARM.FPT$ = SAVE_FPT$;

  15563   1 000710  CCC7 0074                            LDB,B4   SAVE_FPT$,AUTO
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:90   
          1 000712  CFC5 0019                            STB,B4   25,B5

      694    15564    1      KN$NETPARM.RECTYPE = 0;

  15564   1 000714  8745 0013                            CL       19,B5

      695    15565    1      ALTRETURN;

  15565   1 000716  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      696    15566        %EJECT;
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:91   
      697    15567    1   FORWARD: PROC ALTRET;

  15567   1 000719  EFC7 008E            FORWARD         STB,B6   SNPATMPLT3+5,AUTO

      698    15568
      699    15569    3      IF KN$NETPARM.LDCT$ = ADDR(NIL) THEN DO;

  15569   1 00071B  DCC7 0004                            LDB,B5   @KN$NETPARM,AUTO
          1 00071D  8D85                                 CMN      ,B5
          1 00071E  0981 000C                            BNE      s:15574,PREL

      700    15570    3         KN$NETPARM.ERRCODE = %K_DSCRD_DSTUNREACH;

  15570   1 000720  E870 0080                            LDR,R6   128,IMO
          1 000722  EF45 0016                            STR,R6   22,B5

      701    15571    3         ERR_CODE = E_DSCRD_DSTUNREACH;

  15571   1 000724  8C80 0000 0015  00                   LDI      E_DSCRD_DSTUNREACH
          1 000727  8D47 0068                            SDI      ERR_CODE,AUTO

      702    15572    3         GOTO SENDERR;

  15572   1 000729  0F81 001A                            B        s:15577,PREL

      703    15573    3         END;
      704    15574    3      CALL KNH$SEND(KN$NETPARM) WHENALTRETURN DO;

  15574   1 00072B  BBC7 0004                            LAB,B3   @KN$NETPARM,AUTO
          1 00072D  CBF0 0100                            LAB,B4   256,IMO
          1 00072F  E380 0000 0000  xent                 LNJ,B6   KNH$SEND
          1 000732       0003                            DC       s:15575,PREL
          1 000733  0F81 0050                            B        s:15589,PREL

      705    15575    4         IF KN$NETPARM.ERRCODE = %KN_ERR_Q2SMALL THEN DO;

  15575   1 000735  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:92   
          1 000737  E846 0016                            LDR,R6   22,B6
          1 000739  6D04                                 CMV,R6   4
          1 00073A  0981 0045                            BNE      s:15587,PREL

      706    15576    4            KN$NETPARM.ERRCODE = %K_DSCRD_CONGEST; /* should really seg*/

  15576   1 00073C  6C03                                 LDV,R6   3
          1 00073D  EF46 0016                            STR,R6   22,B6

      707    15577    4            ERR_CODE = E_DSCRD_CONGEST;

  15577   1 00073F  8C80 0000 000B  00                   LDI      E_DSCRD_CONGEST
          1 000742  8D47 0068                            SDI      ERR_CODE,AUTO

  15577   1                              SENDERR         null
      708    15578    4   SENDERR: ;
      709    15579    4            ADDR(ERRVAL(0))->CALLEDFROM$ = ENTADDR(KNN$RECVOSI);

  15579   1 000744  EBC0 F8BB            SENDERR         LAB,B6   s:21,PREL
          1 000746  EFC7 0081                            STB,B6   ERRVAL,AUTO

      710    15580    4            CALL GHE$ERRLOG(ERR_CODE,ERRVAL,K$NPDU_FIXED,SIZEC(K$NPDU_FIXED),'0'B);

  15580   1 000748  DCC7 0004                            LDB,B5   @KN$NETPARM,AUTO
          1 00074A  CCC5 000E                            LDB,B4   14,B5
          1 00074C  BBF0 000A                            LAB,B3   10,IMO
          1 00074E  ABF0 0000                            LAB,B2   0,IMO
          1 000750  AFC7 0098                            STB,B2   SNPATMPLT3+15,AUTO
          1 000752  BFC7 0096                            STB,B3   SNPATMPLT3+13,AUTO
          1 000754  CFC7 0094                            STB,B4   SNPATMPLT3+11,AUTO
          1 000756  9BC7 0081                            LAB,B1   ERRVAL,AUTO
          1 000758  9FC7 0092                            STB,B1   SNPATMPLT3+9,AUTO
          1 00075A  EBC7 0068                            LAB,B6   ERR_CODE,AUTO
          1 00075C  EFC7 0090                            STB,B6   SNPATMPLT3+7,AUTO
          1 00075E  BBC7 0090                            LAB,B3   SNPATMPLT3+7,AUTO
          1 000760  CBF0 0500                            LAB,B4   1280,IMO
          1 000762  E380 0000 0000  xent                 LNJ,B6   GHE$ERRLOG
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:93   
          1 000765       0001                            DC       s:15581,PREL

      711    15581    4            KN$NETPARM.NODE = SRCROUTE.FEP#;

  15581   1 000766  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 000768  E847 002B                            LDR,R6   SRCROUTE+1,AUTO
          1 00076A  E570 00FF                            AND,R6   255,IMO
          1 00076C  EF46 0015                            STR,R6   21,B6

      712    15582    4            KN$NETPARM.SRC_ADDR$ = ADDR(SOURCE);

  15582   1 00076E  DBC7 0011                            LAB,B5   SOURCE,AUTO
          1 000770  DFC6 001D                            STB,B5   29,B6

      713    15583    4            KN$NETPARM.DST_ADDR$ = ADDR(DESTINATION);

  15583   1 000772  CBC7 0006                            LAB,B4   DESTINATION,AUTO
          1 000774  CFC6 001F                            STB,B4   31,B6

      714    15584    4            CALL KNN$SENDERR(KN$NETPARM);

  15584   1 000776  BBC7 0004                            LAB,B3   @KN$NETPARM,AUTO
          1 000778  CBF0 0100                            LAB,B4   256,IMO
          1 00077A  E380 0000 0000  xent                 LNJ,B6   KNN$SENDERR
          1 00077D       0001                            DC       s:15585,PREL

      715    15585    4            END;

  15585   1 00077E  0F81 0005                            B        s:15589,PREL

      716    15586    3         ELSE
      717    15587    3            ALTRETURN;

  15587   1 000780  ECC7 008E                            LDB,B6   SNPATMPLT3+5,AUTO
          1 000782  B806                                 LDR,R3   ,B6
          1 000783  C3B6                                 LNJ,B4   ,B6,R3

PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:94   
      718    15588    3         END;                              /* whenaltreturn            */
      719    15589    2   END FORWARD;

  15589   1 000784  ECC7 008E                            LDB,B6   SNPATMPLT3+5,AUTO
          1 000786  C3C6 0001                            LNJ,B4   1,B6
      720    15590    1   END KNN$RECVOSI;
      721    15591        %EOD;

PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:95   
--  Include file information  --

   K_QDPHDRS_M.:E05TOU  is referenced.
   KN_ERRORS_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   K_INTERFACE_M.:E05TOU  is referenced.
   KN_DATA_M.:E05TOU  is referenced.
   KNN_NETWORK_M.:E05TOU  is referenced.
   K_SCODE_C.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   K_NETWORK_E.:E05TOU  is referenced.
   K_NETWORK_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KNN$RECVOSI.
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:96   

 **** Variables and constants ****

  ****  Section 000 RoData KNN$RECVOSI

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     F-0-0/w STRC(32)    r     1 E_DSCRD_CANTSEG            B-0-0/w STRC(32)    r     1 E_DSCRD_CONGEST
    17-0-0/w STRC(32)    r     1 E_DSCRD_DSTUNKNWN         15-0-0/w STRC(32)    r     1 E_DSCRD_DSTUNREACH
    13-0-0/w STRC(32)    r     1 E_DSCRD_DUPOPT             D-0-0/w STRC(32)    r     1 E_DSCRD_HDRSNTX
     9-0-0/w STRC(32)    r     1 E_DSCRD_IC                11-0-0/w STRC(32)    r     1 E_DSCRD_INCMPPDU
    23-0-0/w STRC(32)    r     1 E_DSCRD_LIFEEXPASSM       21-0-0/w STRC(32)    r     1 E_DSCRD_LIFEEXPTRAN
    25-0-0/w STRC(32)    r     1 E_DSCRD_OPTNON            27-0-0/w STRC(32)    r     1 E_DSCRD_OPTPRCLVERS
    2D-0-0/w STRC(32)    r     1 E_DSCRD_OPTRECRTE         29-0-0/w STRC(32)    r     1 E_DSCRD_OPTSEC
    2B-0-0/w STRC(32)    r     1 E_DSCRD_OPTSRCRTE          7-0-0/w STRC(32)    r     1 E_DSCRD_PPE
    1F-0-0/w STRC(32)    r     1 E_DSCRD_PTHNOTACPT        2F-0-0/w STRC(32)    r     1 E_DSCRD_REASSEM
     5-0-0/w STRC(32)    r     1 E_DSCRD_RNS               19-0-0/w STRC(32)    r     1 E_DSCRD_SRCRTEERR
    1B-0-0/w STRC(32)    r     1 E_DSCRD_SRCRTESNTX        1D-0-0/w STRC(32)    r     1 E_DSCRD_SRCRTEUNKWN
     0-0-0/w STRC(32)    r     1 K$NQDP_HDR_C               2-0-0/w STRC(48)    r     1 PRTCLERR

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @KN$NETPARM               7D-0-0/w UBIN(8)     r     1 CODE
    7A-0-0/w UBIN(16)    r     1 CURINDX                   70-0-0/w PTR         r     1 D$
    6D-0-0/w SBIN(16)    r     1 DATASIZE                   6-0-0/c STRC(176)   r     1 DESTINATION
    7B-0-0/w UBIN(16)    r     1 DSTINDX                   48-0-0/w STRC(480)   r     1 DSTROUTE
    81-0-0/w UBIN(16)    r     1 ERRVAL(0:3)               68-0-0/w STRC(32)    r     1 ERR_CODE
    6E-0-0/w UBIN(16)    r     1 FIXEDSIZ                  1C-0-0/w STRC(176)   r     1 FPT_NSAP
    7F-0-0/w UBIN(16)    r     1 I                         80-0-0/w UBIN(16)    r     1 J
    *0-0-0/w STRC(528)   r     1 KN$NETPARM                7E-0-0/w SBIN(16)    r     1 LI
    76-0-0/w PTR         r     1 LINK$                     66-0-0/w STRC(32)    r     1 NQDP_HDR
    6B-0-0/w UBIN(8)     r     1 OPTSZ                     6C-0-0/w UBIN(8)     r     1 OPTVAL
    72-0-0/w PTR         r     1 QQQ$                      78-0-0/w PTR         r     1 ROUTE$
    74-0-0/w PTR         r     1 SAVE_FPT$                 6F-0-0/w UBIN(16)    r     1 SEGLENGTH
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:97   
    27-0-0/w STRC(48)    r     1 SEGMENT                   6A-0-0/w UBIN(16)    r     1 SIZE
    85-0-0/w CHAR(8)     r     1 SNPATMPLT1                85-0-0/w STRC(56)    r     1 SNPATMPLT2
    89-0-0/w CHAR(8)     r     1 SNPATMPLT3                89-0-0/w STRC(56)    r     1 SNPATMPLT4
    11-0-0/c STRC(176)   r     1 SOURCE                    7C-0-0/w UBIN(16)    r     1 SRCINDX
    2A-0-0/w STRC(480)   r     1 SRCROUTE

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KNN_LINK$$                 0-0-0/w UBIN(16)    r     1 KNN_LINKS
     0-0-0/w UBIN(16)    r     1 KNN_NODES                  0-0-0/w PTR         r     1 KNN_ROUTE$$
     0-0-0/w UBIN(16)    r     1 KN_NODE#

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c ACHR        r     1 ADDRESS                    0-0-0/w EPTR        r     1 CALLEDFROM$
     0-0-0/c CHAR        r     1 CHR(0:0)                   0-0-0/w STRC(72)    r     1 K$NPDU_FIXED
     0-0-0/w STRC(48)    r     1 K$NPDU_SEGMENT             0-0-0/c STRC(608)   r     1 KNN$LINK
     0-0-0/w PTR         r     1 KNN$LINK$(0:0)
     0-0-0/w STRC(208)   r     1 KNN$ROUTE
     0-0-0/w PTR         r     1 KNN$ROUTE$(0:0)


   Procedure KNN$RECVOSI requires 1928 words for executable code.
   Procedure KNN$RECVOSI requires 154 words of local(AUTO) storage.
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:98   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:99   
          MINI XREF LISTING

ADDRESS
     13048**DCL     15123>>ASSIGN  15130<<ASSIGN  15130>>ASSIGN  15136>>ASSIGN  15144<<ASSIGN  15144>>ASSIGN
     15199<<ASSIGN  15199>>ASSIGN  15217>>ASSIGN  15219>>ASSIGN  15238>>ASSIGN  15250>>ASSIGN  15363<<ASSIGN
     15363>>ASSIGN
CALLEDFROM$
     13050**DCL     15414<<ASSIGN  15544<<ASSIGN  15579<<ASSIGN
CHR
     13049**DCL     15123<<ASSIGN  15136<<ASSIGN  15217<<ASSIGN  15219<<ASSIGN  15238<<ASSIGN  15250<<ASSIGN
CODE
     15079**DCL     15217--ASSIGN  15228>>DOCASE
CURINDX
     15076**DCL     15121<<ASSIGN  15123>>ASSIGN  15128>>ASSIGN  15130>>ASSIGN  15132<<ASSIGN  15132>>ASSIGN
     15136>>ASSIGN  15137>>ASSIGN  15144>>ASSIGN  15147<<ASSIGN  15147>>ASSIGN  15199>>ASSIGN  15201<<ASSIGN
     15217>>ASSIGN  15218<<ASSIGN  15218>>ASSIGN  15219>>ASSIGN  15220<<ASSIGN  15220>>ASSIGN  15238>>ASSIGN
     15250>>ASSIGN  15267<<ASSIGN  15267>>ASSIGN  15363>>ASSIGN  15364<<ASSIGN  15364>>ASSIGN  15365>>ASSIGN
D$
     15071**DCL     15127<<ASSIGN  15130>>ASSIGN  15142<<ASSIGN  15144>>ASSIGN
DATASIZE
     15068**DCL     15118<<ASSIGN
DESTINATION
     14308**DCL     15127--ASSIGN  15157--ASSIGN  15304<>CALL    15551--ASSIGN  15583--ASSIGN
DESTINATION.ADDRESS_N
     14340**DCL     14341--REDEF
DESTINATION.LEN
     14312**DCL     15123--ASSIGN  15124>>IF      15129>>DOINDEX 15134>>ASSIGN
DSTINDX
     15077**DCL     15128<<ASSIGN
DSTROUTE
     14748**DCL     15304<>CALL    15468<>CALL
DSTROUTE.FEP#
     14788**DCL     15311>>IF      15317>>IF      15328>>IF      15335>>ASSIGN  15355>>IF      15528>>ASSIGN
DSTROUTE.HOST#
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:100  
     14785**DCL     15328>>IF      15333>>IF      15432>>IF      15432>>IF      15432>>IF      15432>>IF
     15432>>IF      15446>>ASSIGN  15455>>ASSIGN  15457>>ASSIGN  15462>>ASSIGN  15467>>ASSIGN
DSTROUTE.LNSAP.ADDRESS_N
     14902**DCL     14903--REDEF
DSTROUTE.MYNODE#
     14783**DCL     14785--REDEF
DSTROUTE.NODE#
     14786**DCL     14788--REDEF
DSTROUTE.NSAP.ADDRESS_N
     14846**DCL     14847--REDEF
DSTROUTE.NSAP.LEN
     14818**DCL     15511>>DOINDEX
DSTROUTE.NS_TYPE
     14771**DCL     15328>>IF      15427>>IF
DSTROUTE.QOS
     14791**DCL     15317>>IF      15432>>IF
DSTROUTE.SNPA.ADDRESS
     14933**DCL     15491>>ASSIGN  15509>>ASSIGN  15516>>ASSIGN
DSTROUTE.SNPA.LEN
     14928**DCL     15488>>IF      15493>>DOINDEX 15515>>ASSIGN
ERR
     15537**LABEL   15164--GOTO    15172--GOTO    15179--GOTO    15191--GOTO    15208--GOTO    15225--GOTO
     15235--GOTO    15246--GOTO    15254--GOTO    15264--GOTO    15307--GOTO    15314--GOTO    15320--GOTO
     15340--GOTO    15422--GOTO    15441--GOTO    15478--GOTO    15535--GOTO
ERR2
     15558**LABEL   15344--CALLALT 15451--GOTO    15463--CALLALT 15498--CALLALT 15519--CALLALT 15538--CALLALT
ERRVAL
     15083**DCL     15112<<ASSIGN  15414--ASSIGN  15415<>CALL    15544--ASSIGN  15545<>CALL    15579--ASSIGN
     15580<>CALL
ERR_CODE
     15032**DCL     15163<<ASSIGN  15171<<ASSIGN  15178<<ASSIGN  15190<<ASSIGN  15207<<ASSIGN  15224<<ASSIGN
     15234<<ASSIGN  15245<<ASSIGN  15253<<ASSIGN  15263<<ASSIGN  15306<<ASSIGN  15313<<ASSIGN  15319<<ASSIGN
     15339<<ASSIGN  15368<<ASSIGN  15370<<ASSIGN  15372<<ASSIGN  15374<<ASSIGN  15376<<ASSIGN  15378<<ASSIGN
     15380<<ASSIGN  15382<<ASSIGN  15384<<ASSIGN  15386<<ASSIGN  15388<<ASSIGN  15390<<ASSIGN  15392<<ASSIGN
     15394<<ASSIGN  15396<<ASSIGN  15398<<ASSIGN  15400<<ASSIGN  15402<<ASSIGN  15404<<ASSIGN  15406<<ASSIGN
     15408<<ASSIGN  15410<<ASSIGN  15412<<ASSIGN  15415<>CALL    15421<<ASSIGN  15440<<ASSIGN  15475<<ASSIGN
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:101  
     15477<<ASSIGN  15534<<ASSIGN  15545<>CALL    15571<<ASSIGN  15577<<ASSIGN  15580<>CALL
EXITOSINET
     15552**LABEL   15345--GOTO    15416--GOTO    15453--GOTO    15464--GOTO    15473--GOTO    15499--GOTO
     15520--GOTO    15541--GOTO
E_DSCRD_CANTSEG
     13456**DCL     15178>>ASSIGN  15378>>ASSIGN  15477>>ASSIGN
E_DSCRD_CONGEST
     13356**DCL     15374>>ASSIGN  15577>>ASSIGN
E_DSCRD_DSTUNKNWN
     13656**DCL     15306>>ASSIGN  15313>>ASSIGN  15386>>ASSIGN
E_DSCRD_DSTUNREACH
     13606**DCL     15319>>ASSIGN  15339>>ASSIGN  15384>>ASSIGN  15440>>ASSIGN  15534>>ASSIGN  15571>>ASSIGN
E_DSCRD_DUPOPT
     13556**DCL     15382>>ASSIGN
E_DSCRD_HDRSNTX
     13406**DCL     15163>>ASSIGN  15190>>ASSIGN  15224>>ASSIGN  15376>>ASSIGN  15421>>ASSIGN
E_DSCRD_IC
     13306**DCL     15171>>ASSIGN  15372>>ASSIGN
E_DSCRD_INCMPPDU
     13506**DCL     15380>>ASSIGN
E_DSCRD_LIFEEXPASSM
     13956**DCL     15398>>ASSIGN
E_DSCRD_LIFEEXPTRAN
     13906**DCL     15207>>ASSIGN  15396>>ASSIGN
E_DSCRD_OPTNON
     14006**DCL     15263>>ASSIGN  15400>>ASSIGN
E_DSCRD_OPTPRCLVERS
     14056**DCL     15402>>ASSIGN
E_DSCRD_OPTRECRTE
     14206**DCL     15253>>ASSIGN  15408>>ASSIGN
E_DSCRD_OPTSEC
     14106**DCL     15234>>ASSIGN  15404>>ASSIGN
E_DSCRD_OPTSRCRTE
     14156**DCL     15245>>ASSIGN  15406>>ASSIGN
E_DSCRD_PPE
     13256**DCL     15370>>ASSIGN
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:102  
E_DSCRD_PTHNOTACPT
     13856**DCL     15394>>ASSIGN
E_DSCRD_REASSEM
     14256**DCL     15410>>ASSIGN  15475>>ASSIGN
E_DSCRD_RNS
     13206**DCL     15368>>ASSIGN  15412>>ASSIGN
E_DSCRD_SRCRTEERR
     13706**DCL     15388>>ASSIGN
E_DSCRD_SRCRTESNTX
     13756**DCL     15390>>ASSIGN
E_DSCRD_SRCRTEUNKWN
     13806**DCL     15392>>ASSIGN
FIXEDSIZ
     15069**DCL     15120<<ASSIGN  15121>>ASSIGN
FORWARD
     15567**PROC    15344--CALL    15463--CALL    15498--CALL    15519--CALL    15538--CALL
FPT_NSAP
     14411**DCL     15517--ASSIGN
FPT_NSAP.NSAP.ADDRESS
     14465**DCL     15516<<ASSIGN
FPT_NSAP.NSAP.ADDRESS_N
     14464**DCL     14465--REDEF
FPT_NSAP.NSAP.LEN
     14436**DCL     15515<<ASSIGN
GHE$ERRLOG
     12551**DCL-ENT 15415--CALL    15545--CALL    15580--CALL
I
     15081**DCL     15129<<DOINDEX 15130>>ASSIGN  15130>>ASSIGN  15132>>ASSIGN  15143<<DOINDEX 15144>>ASSIGN
     15144>>ASSIGN  15147>>ASSIGN  15168<<ASSIGN  15169<>CALL    15198<<DOINDEX 15199>>ASSIGN  15199>>ASSIGN
     15363--ASSIGN  15366>>DOCASE  15493<<DOINDEX 15494>>IF      15494>>IF      15511<<DOINDEX 15512>>IF
     15512>>IF
J
     15082**DCL     15486<<DOINDEX 15487>>ASSIGN  15506<<DOINDEX 15507>>ASSIGN
K$NPDU_FIXED
     12578**DCL     15105--IF      15119--ASSIGN  15120--ASSIGN  15123--ASSIGN  15130--ASSIGN  15136--ASSIGN
     15144--ASSIGN  15169--CALL    15199--ASSIGN  15217--ASSIGN  15219--ASSIGN  15238--ASSIGN  15250--ASSIGN
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:103  
     15363--ASSIGN  15415<>CALL    15415--CALL    15545<>CALL    15545--CALL    15580<>CALL    15580--CALL
K$NPDU_FIXED.CHECKSUMX
     12614**DCL     15167>>IF
K$NPDU_FIXED.CHECKSUMY
     12617**DCL     15167>>IF
K$NPDU_FIXED.LENGTH
     12584**DCL     15108>>ASSIGN  15168>>ASSIGN  15269>>ASSIGN  15270>>ASSIGN  15303>>ASSIGN
K$NPDU_FIXED.LIFETIME
     12588**DCL     15205>>IF
K$NPDU_FIXED.MS
     12596**DCL     15176>>IF      15445>>IF
K$NPDU_FIXED.PROTOCOLID
     12582**DCL     15160>>IF
K$NPDU_FIXED.SEGLENX
     12606**DCL     15114>>ASSIGN
K$NPDU_FIXED.SEGLENY
     12610**DCL     15114>>ASSIGN
K$NPDU_FIXED.SP
     12593**DCL     15176>>IF      15182>>IF
K$NPDU_FIXED.TYPE
     12604**DCL     15112>>ASSIGN  15361>>IF      15362>>IF      15419>>IF      15419>>IF
K$NPDU_FIXED.VERSION
     12586**DCL     15160>>IF
K$NPDU_SEGMENT
     12635**DCL     15188--IF      15198--DOINDEX 15201--ASSIGN
K$NQDP_HDR_C
     13073**DCL     15456>>ASSIGN
K$NSAP.ADDRESS_N
     12719**DCL     12720--REDEF
KN$NETPARM
     12401**DCL        21--PROC    15447<>CALL    15468<>CALL    15553<>CALL    15574<>CALL    15584<>CALL
KN$NETPARM.DST_ADDR$
     12535**DCL     15157<<ASSIGN  15552<<ASSIGN  15583<<ASSIGN
KN$NETPARM.ERRCODE
     12508**DCL     15162<<ASSIGN  15170<<ASSIGN  15177<<ASSIGN  15189<<ASSIGN  15206<<ASSIGN  15223<<ASSIGN
     15233<<ASSIGN  15244<<ASSIGN  15252<<ASSIGN  15262<<ASSIGN  15305<<ASSIGN  15312<<ASSIGN  15318<<ASSIGN
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:104  
     15338<<ASSIGN  15420<<ASSIGN  15439<<ASSIGN  15451>>IF      15469>>IF      15474>>IF      15533<<ASSIGN
     15570<<ASSIGN  15575>>IF      15576<<ASSIGN
KN$NETPARM.FPT$
     12520**DCL     15100>>ASSIGN  15101<<ASSIGN  15342<<ASSIGN  15517<<ASSIGN  15557<<ASSIGN  15563<<ASSIGN
KN$NETPARM.FUNCTION
     12496**DCL     15444<<ASSIGN
KN$NETPARM.LDCT$
     12402**DCL     15099>>ASSIGN  15343<<ASSIGN  15455<<ASSIGN  15462<<ASSIGN  15497<<ASSIGN  15518<<ASSIGN
     15537<<ASSIGN  15558<<ASSIGN  15562<<ASSIGN  15569>>IF
KN$NETPARM.MSG$
     12408**DCL     12413--REDEF
KN$NETPARM.NHDR$
     12460**DCL     12461--REDEF   12578--IMP-PTR 15108>>ASSIGN  15112>>ASSIGN  15114>>ASSIGN  15114>>ASSIGN
     15123>>ASSIGN  15130>>ASSIGN  15136>>ASSIGN  15144>>ASSIGN  15160>>IF      15160>>IF      15167>>IF
     15167>>IF      15168>>ASSIGN  15169>>CALL    15176>>IF      15176>>IF      15182>>IF      15199>>ASSIGN
     15205>>IF      15217>>ASSIGN  15219>>ASSIGN  15238>>ASSIGN  15250>>ASSIGN  15269>>ASSIGN  15270>>ASSIGN
     15270>>ASSIGN  15303>>ASSIGN  15361>>IF      15362>>IF      15363>>ASSIGN  15415>>CALL    15419>>IF
     15419>>IF      15445>>IF      15459<<ASSIGN  15545>>CALL    15580>>CALL
KN$NETPARM.NHDRSZ
     12466**DCL     15102>>ASSIGN  15269>>ASSIGN  15365>>ASSIGN  15460<<ASSIGN
KN$NETPARM.NODE
     12503**DCL     15446<<ASSIGN  15467<<ASSIGN  15550<<ASSIGN  15581<<ASSIGN
KN$NETPARM.RECTYPE
     12487**DCL     15303<<ASSIGN  15556<<ASSIGN  15564<<ASSIGN
KN$NETPARM.SHDR$
     12438**DCL     12439--REDEF
KN$NETPARM.SRC_ADDR$
     12530**DCL     15158<<ASSIGN  15551<<ASSIGN  15582<<ASSIGN
KN$NETPARM.THDR$
     12449**DCL     12450--REDEF
KN$NETPARM.THDRSZ
     12455**DCL     15269<<ASSIGN  15448<<ASSIGN
KN$NETPARM.THDR_C$
     12450**DCL     15270<<ASSIGN
KN$NETPARM.UHDR$
     12424**DCL     12425--REDEF
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:105  
KN$NETPARM.UHDRSZ
     12433**DCL     15461<<ASSIGN
KNA$CHK_CHKSUM
     12543**DCL-ENT 15169--CALL
KNH$SEND
     12549**DCL-ENT 15574--CALL
KNN$DECODE_NSAP
     12548**DCL-ENT 15299--CALL    15304--CALL
KNN$LINK.DEST.ADDRESS_N
     12911**DCL     12912--REDEF
KNN$LINK.FLAGS.VIRCIR
     12769**DCL     15488>>IF      15508>>IF
KNN$LINK.LADR.ADDRESS_N
     12854**DCL     12855--REDEF
KNN$LINK.LDCT$
     12725**DCL     12732--REDEF   15337>>IF      15343>>ASSIGN  15432>>IF      15455>>ASSIGN  15462>>ASSIGN
     15497>>ASSIGN  15518>>ASSIGN  15531>>IF      15537>>ASSIGN
KNN$LINK.NODE#
     12740**DCL     15488>>IF      15508>>IF
KNN$LINK.SNPA.ADDRESS
     12947**DCL     15492>>ASSIGN  15510>>ASSIGN
KNN$LINK.SNPA.LEN
     12942**DCL     15488>>IF      15511>>DOINDEX
KNN$LINK$
     13047**DCL     15487>>ASSIGN  15507>>ASSIGN
KNN$REASSEM
     12547**DCL-ENT 15468--CALL
KNN$RECVOSI
        21**PROC    15414--ASSIGN  15544--ASSIGN  15579--ASSIGN
KNN$ROUTE.CURRENT_QOS
     12993**DCL     15531>>IF
KNN$ROUTE.FLAGS.HOST_NODE
     13003**DCL     15333>>IF      15333>>IF      15432>>IF
KNN$ROUTE.FLAGS.LINK_CONNECTED
     13007**DCL     15432>>IF
KNN$ROUTE.LINK$
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:106  
     12976**DCL     15336>>ASSIGN  15337>>IF      15432>>IF      15432>>IF      15455>>ASSIGN  15462>>ASSIGN
     15529>>ASSIGN  15531>>IF
KNN$ROUTE$
     13046**DCL     15333>>IF      15333>>IF      15335>>ASSIGN  15432>>IF      15432>>IF      15432>>IF
     15432>>IF      15455>>ASSIGN  15462>>ASSIGN  15528>>ASSIGN
KNN$SENDERR
     12542**DCL-ENT 15553--CALL    15584--CALL
KNN_LINK$$
     12557**DCL     13047--IMP-PTR 15487>>ASSIGN  15507>>ASSIGN
KNN_LINKS
     12556**DCL     15486>>DOINDEX 15506>>DOINDEX
KNN_NODES
     12553**DCL     15311>>IF      15328>>IF      15328>>IF      15432>>IF
KNN_ROUTE$$
     12555**DCL     13046--IMP-PTR 15333>>IF      15333>>IF      15335>>ASSIGN  15432>>IF      15432>>IF
     15432>>IF      15432>>IF      15455>>ASSIGN  15462>>ASSIGN  15528>>ASSIGN
KNT$RECV_4HOST
     12546**DCL-ENT 15447--CALL
KN_NODE#
     12554**DCL     15317>>IF      15355>>IF
LI
     15080**DCL     15108<<ASSIGN  15109>>IF      15118>>ASSIGN  15119<<ASSIGN  15119>>ASSIGN  15124>>IF
     15134<<ASSIGN  15134>>ASSIGN  15139>>IF      15149<<ASSIGN  15149>>ASSIGN  15188>>IF      15202<<ASSIGN
     15202>>ASSIGN  15216>>DOWHILE 15221<<ASSIGN  15221>>ASSIGN  15222>>IF
LINK$
     15074**DCL     12724--IMP-PTR 15336<<ASSIGN  15337>>IF      15343>>ASSIGN  15487<<ASSIGN  15488>>IF
     15488>>IF      15488>>IF      15492>>ASSIGN  15497>>ASSIGN  15507<<ASSIGN  15508>>IF      15508>>IF
     15510>>ASSIGN  15511>>DOINDEX 15518>>ASSIGN  15529<<ASSIGN  15531>>IF      15537>>ASSIGN
NQDP_HDR
     14961**DCL     15456<<ASSIGN  15459--ASSIGN  15460--ASSIGN
NQDP_HDR.DEST_NODE
     14982**DCL     15457<<ASSIGN
NQDP_HDR.SOURCE_NODE
     14988**DCL     15458<<ASSIGN
NXTJ
     15493**LABEL   15495--GOTO
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:107  
NXTJ2
     15517**LABEL   15513--GOTO
OPTSZ
     15066**DCL     15219--ASSIGN  15221>>ASSIGN  15267>>ASSIGN
OPTVAL
     15067**DCL     15238--ASSIGN  15243>>IF      15250--ASSIGN  15251>>IF
PRTCLERR
     13157**DCL     15106<>CALL    15110<>CALL    15116<>CALL    15125<>CALL    15140<>CALL
QQQ$
     15072**DCL     15099<<ASSIGN  15558>>ASSIGN  15562>>ASSIGN
ROUTE$
     15075**DCL     12975--IMP-PTR 15335<<ASSIGN  15336>>ASSIGN  15337>>IF      15528<<ASSIGN  15529>>ASSIGN
     15531>>IF      15531>>IF
SAVE_FPT$
     15073**DCL     15100<<ASSIGN  15557>>ASSIGN  15563>>ASSIGN
SCREECH
     12550**DCL-ENT 15106--CALL    15110--CALL    15116--CALL    15125--CALL    15140--CALL
SEGLENGTH
     15070**DCL     15114<<ASSIGN  15115>>IF      15118>>ASSIGN  15183>>ASSIGN  15445>>IF
SEGMENT
     14486**DCL     15202--ASSIGN
SEGMENT.DATAID
     14495**DCL     15184<<ASSIGN  15199--ASSIGN
SEGMENT.OFFSET
     14504**DCL     15185<<ASSIGN
SEGMENT.TOTLEN
     14517**DCL     15183<<ASSIGN  15445>>IF
SENDERR IN PROCEDURE FORWARD
     15577**LABEL   15572--GOTO
SIZE
     15065**DCL     13048--IMP-SIZ 15102<<ASSIGN  15103>>IF      15105>>IF      15109>>IF      15115>>IF
     15123>>ASSIGN  15130>>ASSIGN  15130>>ASSIGN  15136>>ASSIGN  15144>>ASSIGN  15144>>ASSIGN  15199>>ASSIGN
     15199>>ASSIGN  15217>>ASSIGN  15219>>ASSIGN  15238>>ASSIGN  15250>>ASSIGN  15363>>ASSIGN  15363>>ASSIGN
     15365<<ASSIGN
SNPATMPLT1
     15087**DCL     15088--REDEF   15491<<ASSIGN  15509<<ASSIGN
PL6.E3A0      #001=KNN$RECVOSI File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:05 Page:108  
SNPATMPLT2.NIBBLES.NIB
     15090**DCL     15494>>IF      15512>>IF
SNPATMPLT3
     15092**DCL     15093--REDEF   15492<<ASSIGN  15510<<ASSIGN
SNPATMPLT4.NIBBLES.NIB
     15095**DCL     15494>>IF      15512>>IF
SOURCE
     14360**DCL     15142--ASSIGN  15158--ASSIGN  15299<>CALL    15552--ASSIGN  15582--ASSIGN
SOURCE.ADDRESS_N
     14392**DCL     14393--REDEF
SOURCE.LEN
     14364**DCL     15136--ASSIGN  15139>>IF      15143>>DOINDEX 15149>>ASSIGN
SRCINDX
     15078**DCL     15137<<ASSIGN
SRCROUTE
     14539**DCL     15299<>CALL    15468<>CALL
SRCROUTE.FEP#
     14579**DCL     15328>>IF      15458>>ASSIGN  15550>>ASSIGN  15581>>ASSIGN
SRCROUTE.HOST#
     14576**DCL     15328>>IF      15333>>IF
SRCROUTE.LNSAP.ADDRESS_N
     14693**DCL     14694--REDEF
SRCROUTE.MYNODE#
     14574**DCL     14576--REDEF
SRCROUTE.NODE#
     14577**DCL     14579--REDEF
SRCROUTE.NSAP.ADDRESS_N
     14637**DCL     14638--REDEF
SRCROUTE.NS_TYPE
     14562**DCL     15328>>IF

PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:109  
      722        1        /*M* KNN$SENDERR - OSI network error pdu encodeer */
      723        2        /*T***********************************************************/
      724        3        /*T*                                                         */
      725        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      726        5        /*T*                                                         */
      727        6        /*T***********************************************************/
      728        7        /*X* PLM=3,IND=3,ENU=0,ECU=0,CRM=70,CCC=YES,CSI=3,CTI=2,DCI=3,ECI=3,ENI=3,SDI=3 */
      729        8        /*P*    NAME:   KNN$SENDERR
      730        9                PURPOSE: This module contains the procedure to encode network layer
      731       10                         error messages.
      732       11        */
      733       12
      734       13
      735       14        /*F*  NAME:    KNN$SENDERR
      736       15
      737       16              PURPOSE: encode OSI network error pdus
      738       17              DESCRIPTION:
      739       18        */
      740       19        KNN$SENDERR: PROC(KN$NETPARM) ALTRET;
      741       20
      742       21        %INCLUDE LCP_6;
      743     4300        %INCLUDE K_NETWORK_M;
      744     4569        %INCLUDE K_NETWORK_E;
      745     4658        %INCLUDE KNH_MACRO_C;
      746     4941        %INCLUDE K_ADDRESS_M;
      747     5444        %INCLUDE K_SCODE_C;
      748     5529        %INCLUDE KNN_NETWORK_M;
      749     5892        %INCLUDE KN_DATA_M;
      750     7678        %INCLUDE K_INTERFACE_M;
      751     8087        %INCLUDE KL_MACRO_C;
      752    11439        %INCLUDE KN_ERRORS_C;
      753    11503
      754    11504    1   DCL KNA$CALC_CHKSUM ENTRY(3) ALTRET;
      755    11505    1   DCL KNN$DECODE_NSAP ENTRY(2) ALTRET;
      756    11506    1   DCL KNH$SEND ENTRY(1) ALTRET;
      757    11507    1   DCL SCREECH ENTRY(1);
      758    11508    1   DCL GHE$ERRLOG ENTRY(5) ALTRET;
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:110  
      759    11509
      760    11510        %KN$NETPARM(NAME=KN$NETPARM);
      761    11663
      762    11664        %VLP_SCODE (FPTN=PRTCLERR,ERR#=%S$PRTCLERR,SEV=G_SEV_SCREECH#,
      763    11665                       STCLASS=CONSTANT,FCG=KN,MID=N,MON='1'B);
      764    11726
      765    11727        %VLP_ERRCODE(FPTN=E_DSCRD_DSTUNKNWN,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             11727            %E$DSCRD_DSTUNKNWN);
      766    11773        %VLP_ERRCODE(FPTN=E_DSCRD_DSTUNREACH,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             11773            %E$DSCRD_DSTUNREACH);
      767    11819        %VLP_ERRCODE(FPTN=E_DSCRD_CONGEST,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             11819            %E$DSCRD_CONGEST);
      768    11865
      769    11866    1   DCL KNN_NODES UBIN SYMREF;
      770    11867    1   DCL KN_NODE# UBIN SYMREF;
      771    11868    1   DCL KNN_ROUTE$$ PTR SYMREF;
      772    11869    1   DCL KNN_LINKS UBIN SYMREF;
      773    11870    1   DCL KNN_LINK$$ PTR SYMREF;
      774    11871    1   DCL KNN_OSIROUTE$$ PTR SYMREF;
      775    11872    1   DCL KNN_OSIMAX# UBIN SYMREF;
      776    11873    1   DCL KNN_OSIROUTE# UBIN SYMREF;
      777    11874    1   DCL KNN_LIFETIME UBIN SYMREF;
      778    11875    1   DCL KNN_CHECKSUM UBIN SYMREF;
      779    11876    1   DCL KNN_DATAID UBIN SYMREF;
      780    11877
      781    11878        %K$NPDU_FIXED(STCLASS="BASED(KN$NETPARM.NHDR$)");
      782    11935        %K$NPDU_SEGMENT;
      783    11987        %K$NSAP(FPTN=DESTINATION,STCLASS="BASED(KN$NETPARM.DST_ADDR$)",ADRTYP=NET);
      784    12039        %K$NSAP(FPTN=SOURCE,STCLASS="BASED(KN$NETPARM.SRC_ADDR$)",ADRTYP=NET);
      785    12091        %KNN$LINK(STCLASS="BASED(LINK$)");
      786    12342        %KNN$ROUTE(STCLASS="BASED(ROUTE$)");
      787    12414    1   DCL KNN$ROUTE$(0:0) PTR BASED(KNN_ROUTE$$);
      788    12415    1   DCL KNN$LINK$(0:0) PTR BASED(KNN_LINK$$);
      789    12416    1   DCL ADDRESS CHAR(SIZE) BASED;
      790    12417    1   DCL CHR(0:0) CHAR(1) BASED CALIGNED;
      791    12418    1   DCL CALLEDFROM$ EPTR BASED;
      792    12419
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:111  
      793    12420        %FPT_NSAP(STCLASS=AUTO);
      794    12492        %K$NPDU_SEGMENT(NAME=SEGMENT,STCLASS=AUTO);
      795    12544        %KL_UPDOSI(FPTN=DSTROUTE,STCLASS=AUTO);
      796    12753        %K$NPDU_FIXED(NAME=FIXED,STCLASS=AUTO,LAST=",",ALGN=CALIGNED);
      797    12810    1          2 ERRPDU CHAR(255) UNAL; /*   buffer for src dest segment options and err */
      798    12811
      799    12812    1   DCL SNPATMPLT1 CHAR(8);
      800    12813    1   DCL 1 SNPATMPLT2 REDEF SNPATMPLT1 ALIGNED,
      801    12814    1          2 NIBBLES(0:13) UNAL,
      802    12815    1             3 NIB UBIN(4) UNAL;
      803    12816
      804    12817    1   DCL SNPATMPLT3 CHAR(8);
      805    12818    1   DCL 1 SNPATMPLT4 REDEF SNPATMPLT3 ALIGNED,
      806    12819    1          2 NIBBLES(0:13) UNAL,
      807    12820    1             3 NIB UBIN(4) UNAL;
      808    12821
      809    12822    1   DCL SIZE UBIN;
      810    12823    1   DCL TSIZE UBIN;
      811    12824    1   DCL OPTVAL UBIN BYTE;
      812    12825    1   DCL LINK$ PTR;
      813    12826    1   DCL ROUTE$ PTR;
      814    12827    1   DCL CURINDX UBIN;                       /*  is index into npdu      */
      815    12828    1   DCL CODE UBIN BYTE;                     /* options code in pdu      */
      816    12829    1   DCL SENDINGERR UBIN;
      817    12830    1   DCL I UBIN;
      818    12831    1   DCL J UBIN;
      819    12832    1   DCL ERRVAL(0:3) UBIN;
      820    12833
      821    12834        %EJECT;
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:112  
      822    12835
      823    12836    1      SENDINGERR = 1;
      824    12837    1      ADDR(ERRVAL(0))->CALLEDFROM$ = ENTADDR(KNN$SENDERR);
      825    12838    1      ERRVAL(2) = %K_ER_PDU;
      826    12839    1      IF K$NPDU_FIXED.TYPE = %K_ER_PDU OR NOT K$NPDU_FIXED.ER THEN
      827    12840    1         RETURN;
             12840                  /* dont generate errors if they dont want them.  dont generate errors*/
      828    12841    1      SIZE = KN$NETPARM.RECTYPE; /* a sleaze, really contains offset to error */
      829    12842
      830    12843    1      GOTO COMMON;
      831    12844
      832    12845
      833    12846    1   KNN$SENDOSI: ENTRY(KN$NETPARM) ALTRET;
      834    12847
      835    12848    1      SENDINGERR = 0;
      836    12849    1      ADDR(ERRVAL(0))->CALLEDFROM$ = ENTADDR(KNN$SENDOSI);
      837    12850    1      ERRVAL(2) = %K_DT_PDU;
      838    12851    1      SIZE = KN$NETPARM.THDRSZ;
      839    12852
      840    12853    1   COMMON:;
      841    12854
      842    12855    2      CALL KNN$DECODE_NSAP(DESTINATION,DSTROUTE) WHENALTRETURN DO;
      843    12856                                                /* do nothing per osi*/
      844    12857    2         CALL GHE$ERRLOG(E_DSCRD_DSTUNKNWN,ERRVAL,DESTINATION,SIZEC(DESTINATION),'0'B);
      845    12858    2         RETURN;
      846    12859    2         END;
      847    12860
      848    12861    1      KN$NETPARM.SRC_ADDR$ = ADDR(DSTROUTE.LNSAP);
      849    12862
      850    12863    2      IF DSTROUTE.FEP# ~= KN_NODE# THEN DO;
      851    12864    3         IF DSTROUTE.FEP# < KNN_NODES THEN DO;
      852    12865    3            ROUTE$ = KNN$ROUTE$(DSTROUTE.FEP#);
      853    12866    3            LINK$ = KNN$ROUTE.LINK$;
      854    12867    4            IF KNN$ROUTE.CURRENT_QOS = 255 OR KNN$LINK.LDCT$ = ADDR(NIL) THEN DO;
      855    12868    4               CALL GHE$ERRLOG(E_DSCRD_DSTUNREACH,ERRVAL,DSTROUTE,SIZEC(DSTROUTE),'0'B)
             12868                        ;
      856    12869    4               RETURN;
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:113  
      857    12870    4               END;
      858    12871    3            END;                           /* if fep# < knn_nodes      */
      859    12872    3         ELSE DO;
      860    12873    3            CALL GHE$ERRLOG(E_DSCRD_DSTUNKNWN,ERRVAL,DSTROUTE,SIZEC(DSTROUTE),'0'B);
      861    12874    3            RETURN;
      862    12875    3            END;
      863    12876    2         END;
      864    12877    2      ELSE DO;
      865    12878
      866    12879    3         IF DSTROUTE.NS_TYPE = %K_TYPE_LNSAP THEN DO;
      867    12880    3            CALL SCREECH(PRTCLERR);
      868    12881                                           /* this doesn't make any sense.*/
      869    12882    3            END;                           /* if lnsap                 */
      870    12883    3         ELSE DO;                          /* else type = rnsap        */
      871    12884             /*
      872    12885             search vc list for a currently active connection
      873    12886             */
      874    12887    4            DO J = 0 TO KNN_LINKS - 1;
      875    12888    4               LINK$ = KNN$LINK$(J);
      876    12889    4               IF KNN$LINK.FLAGS.VIRCIR
      877    12890    4                 AND KNN$LINK.NODE# >= %K_CNC_IS#
      878    12891    5                 AND DSTROUTE.SNPA.LEN = KNN$LINK.SNPA.LEN THEN DO;
      879    12892    5                  SNPATMPLT1 = DSTROUTE.SNPA.ADDRESS;
      880    12893    5                  SNPATMPLT3 = KNN$LINK.SNPA.ADDRESS;
      881    12894    6                  DO I = 0 TO DSTROUTE.SNPA.LEN - 1;
      882    12895    6                     IF SNPATMPLT2.NIBBLES.NIB(I) ~= SNPATMPLT4.NIBBLES.NIB(I) THEN
      883    12896    6                        GOTO NXTJ;
      884    12897    6                     END;                  /* i = 0 to len-1           */
      885    12898    5                  KN$NETPARM.LDCT$ = KNN$LINK.LDCT$;
      886    12899    5                  GOTO EXITOSINET;
      887    12900    5                  END;                     /*  if vircir et al         */
      888    12901    4   NXTJ:       ;
      889    12902    4               END;                        /* do j = 0 to knn_links    */
      890    12903                /*
      891    12904                no vc connection currently running.  try to find a substr match
      892    12905                */
      893    12906    4            DO J = 0 TO KNN_LINKS - 1;
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:114  
      894    12907    4               LINK$ = KNN$LINK$(J);
      895    12908    5               IF NOT KNN$LINK.FLAGS.VIRCIR AND KNN$LINK.NODE# >= %K_CNC_IS# THEN DO;
      896    12909    5                  SNPATMPLT1 = DSTROUTE.SNPA.ADDRESS;
      897    12910    5                  SNPATMPLT3 = KNN$LINK.SNPA.ADDRESS;
      898    12911    6                  DO I = 0 TO MINIMUM(DSTROUTE.NSAP.LEN,KNN$LINK.SNPA.LEN)-1;
      899    12912    6                     IF SNPATMPLT2.NIBBLES.NIB(I) ~= SNPATMPLT4.NIBBLES.NIB(I) THEN
      900    12913    6                        GOTO NXTJ2;
      901    12914    6                     END;             /* do i = 0 to min(len,len)-1    */
      902    12915    5                  FPT_NSAP.NSAP.LEN = DSTROUTE.SNPA.LEN;
      903    12916    5                  FPT_NSAP.NSAP.ADDRESS = DSTROUTE.SNPA.ADDRESS;
      904    12917    5                  KN$NETPARM.FPT$ = ADDR(FPT_NSAP);
      905    12918    5                  KN$NETPARM.LDCT$ = KNN$LINK.LDCT$;
      906    12919    5                  GOTO EXITOSINET;
      907    12920    5                  END;                     /* not vc and node# > is    */
      908    12921    4   NXTJ2:      ;
      909    12922    4               END;                   /* do j = 0 to knn_links - 1     */
      910    12923    3            RETURN;                   /* no route drop the message     */
      911    12924    3            END;                           /* else type = rnsap        */
      912    12925    2         END;                    /* else message bound for this node   */
      913    12926
      914    12927    1   EXITOSINET:;
      915    12928
      916    12929    1      CURINDX = LENGTHC(K$NPDU_FIXED);
      917    12930
      918    12931    1      FIXED.PROTOCOLID = %K_PRTCL_ID;
      919    12932    1      FIXED.VERSION = %K_PRTCL_ID_EXT;
      920    12933    1      FIXED.SP = '1'B;
      921    12934    1      FIXED.ER = '0'B;
      922    12935    1      FIXED.MS = '0'B;
      923    12936    1      FIXED.CHECKSUMX = 0;
      924    12937    1      FIXED.CHECKSUMY = 0;
      925    12938    1      FIXED.LIFETIME = KNN_LIFETIME;
      926    12939    1      IF SENDINGERR>0 THEN
      927    12940    1         FIXED.TYPE = %K_ER_PDU;
      928    12941    1      ELSE
      929    12942    1         FIXED.TYPE = %K_DT_PDU;
      930    12943    1      FIXED.LENGTH = LENGTHC(K$NPDU_FIXED)+(SOURCE.LEN+1)+(DESTINATION.LEN+1)+LENGTHC(
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:115  
             12943               SEGMENT)+(6*SENDINGERR); /*  for options*/
      931    12944    1      TSIZE = FIXED.LENGTH + SIZE;         /* size of data to be sent  */
      932    12945    1      FIXED.SEGLENX = TSIZE/256;
      933    12946    1      FIXED.SEGLENY = BITBIN(BINBIT(TSIZE,16)& '00FF'X);
      934    12947        /*
      935    12948             if we are sending an error pdu, then the destination address address is really
      936    12949             the source address.  Otherwise send to the destination.
      937    12950        */
      938    12951    2      IF SENDINGERR> 0 THEN DO;
      939    12952    2         SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,SOURCE.LEN+1) = SUBSTR(ADDR(SOURCE)->
             12952                  ADDRESS,0,SOURCE.LEN+1);
      940    12953    2         CURINDX = SOURCE.LEN + CURINDX + 1;
      941    12954
      942    12955    2         SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,DESTINATION.LEN+1) = SUBSTR(ADDR(
             12955                  DESTINATION)->ADDRESS,0,DESTINATION.LEN+1);
      943    12956    2         CURINDX = DESTINATION.LEN + CURINDX + 1;
      944    12957    2         END;
      945    12958    2      ELSE DO;
      946    12959    2         SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,DESTINATION.LEN+1) = SUBSTR(ADDR(
             12959                  DESTINATION)->ADDRESS,0,DESTINATION.LEN+1);
      947    12960    2         CURINDX = DESTINATION.LEN + CURINDX + 1;
      948    12961
      949    12962    2         SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,SOURCE.LEN+1) = SUBSTR(ADDR(SOURCE)->
             12962                  ADDRESS,0,SOURCE.LEN+1);
      950    12963    2         CURINDX = SOURCE.LEN + CURINDX + 1;
      951    12964    2         END;
      952    12965    1      KNN_DATAID = KNN_DATAID + 1;
      953    12966
      954    12967    1      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(KNN_DATAID)->ADDRESS,0,1);
      955    12968    1      CURINDX = CURINDX + 1;
      956    12969    1      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(KNN_DATAID)->ADDRESS,1,1);
      957    12970    1      CURINDX = CURINDX + 1;
      958    12971
      959    12972        /*
      960    12973             segment.offset.
      961    12974        */
      962    12975    1      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BITASC('0'B);
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:116  
      963    12976    1      CURINDX = CURINDX + 1;
      964    12977
      965    12978    1      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BITASC('0'B);
      966    12979    1      CURINDX = CURINDX + 1;
      967    12980
      968    12981        /*
      969    12982          total length
      970    12983        */
      971    12984    1      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(TSIZE)->ADDRESS,0,1);
      972    12985    1      CURINDX = CURINDX + 1;
      973    12986
      974    12987    1      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(TSIZE)->ADDRESS,1,1);
      975    12988    1      CURINDX = CURINDX + 1;
      976    12989
      977    12990    2      IF SENDINGERR > 0 THEN DO;
      978    12991                            /* reason is in right half of errcode field     */
      979    12992
      980    12993    2         SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BINASC(%K_NPRM_REASON);
      981    12994    2         CURINDX = CURINDX + 1;
      982    12995
      983    12996    2         SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BINASC(2); /* size of parameter */
      984    12997    2         CURINDX = CURINDX + 1;
      985    12998
      986    12999    2         SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(KN$NETPARM.ERRCODE)->
             12999                  ADDRESS,1,1);
      987    13000    2         CURINDX = CURINDX + 1;
      988    13001
      989    13002        /* use the right half of size to determine the size of the data being returned */
      990    13003
      991    13004    3         IF SIZE > 255 THEN DO;
      992    13005    3            SIZE = 0;
      993    13006    3            SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BITASC('0'B);
      994    13007    3            END;
      995    13008    2         ELSE
      996    13009    2            SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(SIZE)->ADDRESS,1,1);
      997    13010
      998    13011    2         CURINDX = CURINDX + 1;
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:117  
      999    13012
     1000    13013    2         SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,SIZE) = SUBSTR(KN$NETPARM.NHDR$->ADDRESS,0
             13013                  ,SIZE);
     1001    13014    2         CURINDX = CURINDX + SIZE;
     1002    13015
     1003    13016    2         IF SIZE + FIXED.LENGTH > LENGTHC(FIXED) THEN
     1004    13017    2            SIZE = LENGTHC(FIXED);
     1005    13018    2         ELSE
     1006    13019    2            SIZE = SIZE + FIXED.LENGTH;
     1007    13020    2         KN$NETPARM.THDRSZ = 0;
     1008    13021    2         KN$NETPARM.SHDRSZ = 0;
     1009    13022    2         END;
     1010    13023    1      ELSE
     1011    13024    1         SIZE = FIXED.LENGTH;
     1012    13025
     1013    13026
     1014    13027    2      IF KNN_CHECKSUM ~= 0 THEN DO;
     1015    13028    2         CALL KNA$CALC_CHKSUM(ADDR(FIXED),SIZE,%K_CHKSUM_OFFSET);
     1016    13029    2         IF FIXED.CHECKSUMX = 0 THEN FIXED.CHECKSUMX = 255;
     1017    13030    2         IF FIXED.CHECKSUMY = 0 THEN FIXED.CHECKSUMY = 255;
     1018    13031    2         END;
     1019    13032
     1020    13033    1      KN$NETPARM.UHDRSZ = 0;
     1021    13034    1      KN$NETPARM.NHDR$ = ADDR(FIXED);
     1022    13035    1      KN$NETPARM.NHDRSZ = SIZE;
     1023    13036    2      IF KN$NETPARM.LDCT$ = ADDR(NIL) THEN DO; /* KNN$RECVOSI saved fpt$ and ldct$ */
     1024    13037    2         CALL GHE$ERRLOG(E_DSCRD_DSTUNREACH,ERRVAL,FIXED,SIZEC(FIXED),'0'B);
     1025    13038    2         RETURN;
     1026    13039    2         END;
     1027    13040
     1028    13041
     1029    13042    2      CALL KNH$SEND(KN$NETPARM) WHENALTRETURN DO;
     1030    13043    3         IF KN$NETPARM.ERRCODE = %KN_ERR_Q2SMALL THEN DO;
     1031    13044    3            CALL GHE$ERRLOG(E_DSCRD_CONGEST,ERRVAL,K$NPDU_FIXED,SIZEC(K$NPDU_FIXED),
             13044                     '0'B);
     1032    13045    3            END;
     1033    13046    2         ELSE
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:118  
     1034    13047    2            ALTRETURN;
     1035    13048    2         END;                              /* whenaltreturn            */
     1036    13049    1   END KNN$SENDERR;
     1037    13050        %EOD;

PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:119  
--  Include file information  --

   KN_ERRORS_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   K_INTERFACE_M.:E05TOU  is referenced.
   KN_DATA_M.:E05TOU  is referenced.
   KNN_NETWORK_M.:E05TOU  is referenced.
   K_SCODE_C.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   K_NETWORK_E.:E05TOU  is referenced.
   K_NETWORK_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KNN$SENDERR.

   Procedure KNN$SENDERR requires 945 words for executable code.
   Procedure KNN$SENDERR requires 216 words of local(AUTO) storage.

PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:120  

 Object Unit name= KNN$SENDERR                                File name= KNN$SUBS.:E05TOU
 UTS= JUL 30 '97 01:06:44.96 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS      9      9  KNN$SENDERR
    1   Proc  even  none   945    3B1  KNN$SENDERR
    2  RoData even  none     2      2  KNN$SENDERR

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  KNN$SENDERR
     1     28          yes     yes      Std        1  KNN$SENDOSI

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 SCREECH
 yes     yes           Std       1 KNH$SEND
 yes     yes           Std       2 KNN$DECODE_NSAP
 yes     yes           Std       5 GHE$ERRLOG
 yes     yes           Std       3 KNA$CALC_CHKSUM
 yes     yes           Std       1 KNN$SENDERR
 yes     yes           Std       1 KNN$SENDOSI
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET
                       nStd      0 X6B_BLR
                       nStd      0 X6A_AALT
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:121  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KNN_NODES                             KN_NODE#                              KNN_ROUTE$$
     KNN_LINKS                             KNN_LINK$$                            KNN_LIFETIME
     KNN_CHECKSUM                          KNN_DATAID                       r    G$ROS$
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:122  


      722        1        /*M* KNN$SENDERR - OSI network error pdu encodeer */
      723        2        /*T***********************************************************/
      724        3        /*T*                                                         */
      725        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      726        5        /*T*                                                         */
      727        6        /*T***********************************************************/
      728        7        /*X* PLM=3,IND=3,ENU=0,ECU=0,CRM=70,CCC=YES,CSI=3,CTI=2,DCI=3,ECI=3,ENI=3,SDI=3 */
      729        8        /*P*    NAME:   KNN$SENDERR
      730        9                PURPOSE: This module contains the procedure to encode network layer
      731       10                         error messages.
      732       11        */
      733       12
      734       13
      735       14        /*F*  NAME:    KNN$SENDERR
      736       15
      737       16              PURPOSE: encode OSI network error pdus
      738       17              DESCRIPTION:
      739       18        */
      740       19        KNN$SENDERR: PROC(KN$NETPARM) ALTRET;

     19   1 000000  D380 0000 0000  xent KNN$SENDERR     LNJ,B5   X6A_AUTO_1
          1 000003       00D8 0001                       DC       216,1

      741       20
      742       21        %INCLUDE LCP_6;
      743     4300        %INCLUDE K_NETWORK_M;
      744     4569        %INCLUDE K_NETWORK_E;
      745     4658        %INCLUDE KNH_MACRO_C;
      746     4941        %INCLUDE K_ADDRESS_M;
      747     5444        %INCLUDE K_SCODE_C;
      748     5529        %INCLUDE KNN_NETWORK_M;
      749     5892        %INCLUDE KN_DATA_M;
      750     7678        %INCLUDE K_INTERFACE_M;
      751     8087        %INCLUDE KL_MACRO_C;
      752    11439        %INCLUDE KN_ERRORS_C;
      753    11503
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:123  
      754    11504    1   DCL KNA$CALC_CHKSUM ENTRY(3) ALTRET;
      755    11505    1   DCL KNN$DECODE_NSAP ENTRY(2) ALTRET;
      756    11506    1   DCL KNH$SEND ENTRY(1) ALTRET;
      757    11507    1   DCL SCREECH ENTRY(1);
      758    11508    1   DCL GHE$ERRLOG ENTRY(5) ALTRET;
      759    11509
      760    11510        %KN$NETPARM(NAME=KN$NETPARM);
      761    11663
      762    11664        %VLP_SCODE (FPTN=PRTCLERR,ERR#=%S$PRTCLERR,SEV=G_SEV_SCREECH#,
      763    11665                       STCLASS=CONSTANT,FCG=KN,MID=N,MON='1'B);
      764    11726
      765    11727        %VLP_ERRCODE(FPTN=E_DSCRD_DSTUNKNWN,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             11727            %E$DSCRD_DSTUNKNWN);
      766    11773        %VLP_ERRCODE(FPTN=E_DSCRD_DSTUNREACH,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             11773            %E$DSCRD_DSTUNREACH);
      767    11819        %VLP_ERRCODE(FPTN=E_DSCRD_CONGEST,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             11819            %E$DSCRD_CONGEST);
      768    11865
      769    11866    1   DCL KNN_NODES UBIN SYMREF;
      770    11867    1   DCL KN_NODE# UBIN SYMREF;
      771    11868    1   DCL KNN_ROUTE$$ PTR SYMREF;
      772    11869    1   DCL KNN_LINKS UBIN SYMREF;
      773    11870    1   DCL KNN_LINK$$ PTR SYMREF;
      774    11871    1   DCL KNN_OSIROUTE$$ PTR SYMREF;
      775    11872    1   DCL KNN_OSIMAX# UBIN SYMREF;
      776    11873    1   DCL KNN_OSIROUTE# UBIN SYMREF;
      777    11874    1   DCL KNN_LIFETIME UBIN SYMREF;
      778    11875    1   DCL KNN_CHECKSUM UBIN SYMREF;
      779    11876    1   DCL KNN_DATAID UBIN SYMREF;
      780    11877
      781    11878        %K$NPDU_FIXED(STCLASS="BASED(KN$NETPARM.NHDR$)");
      782    11935        %K$NPDU_SEGMENT;
      783    11987        %K$NSAP(FPTN=DESTINATION,STCLASS="BASED(KN$NETPARM.DST_ADDR$)",ADRTYP=NET);
      784    12039        %K$NSAP(FPTN=SOURCE,STCLASS="BASED(KN$NETPARM.SRC_ADDR$)",ADRTYP=NET);
      785    12091        %KNN$LINK(STCLASS="BASED(LINK$)");
      786    12342        %KNN$ROUTE(STCLASS="BASED(ROUTE$)");
      787    12414    1   DCL KNN$ROUTE$(0:0) PTR BASED(KNN_ROUTE$$);
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:124  
      788    12415    1   DCL KNN$LINK$(0:0) PTR BASED(KNN_LINK$$);
      789    12416    1   DCL ADDRESS CHAR(SIZE) BASED;
      790    12417    1   DCL CHR(0:0) CHAR(1) BASED CALIGNED;
      791    12418    1   DCL CALLEDFROM$ EPTR BASED;
      792    12419
      793    12420        %FPT_NSAP(STCLASS=AUTO);
      794    12492        %K$NPDU_SEGMENT(NAME=SEGMENT,STCLASS=AUTO);
      795    12544        %KL_UPDOSI(FPTN=DSTROUTE,STCLASS=AUTO);
      796    12753        %K$NPDU_FIXED(NAME=FIXED,STCLASS=AUTO,LAST=",",ALGN=CALIGNED);
      797    12810    1          2 ERRPDU CHAR(255) UNAL; /*   buffer for src dest segment options and err */
      798    12811
      799    12812    1   DCL SNPATMPLT1 CHAR(8);
      800    12813    1   DCL 1 SNPATMPLT2 REDEF SNPATMPLT1 ALIGNED,
      801    12814    1          2 NIBBLES(0:13) UNAL,
      802    12815    1             3 NIB UBIN(4) UNAL;
      803    12816
      804    12817    1   DCL SNPATMPLT3 CHAR(8);
      805    12818    1   DCL 1 SNPATMPLT4 REDEF SNPATMPLT3 ALIGNED,
      806    12819    1          2 NIBBLES(0:13) UNAL,
      807    12820    1             3 NIB UBIN(4) UNAL;
      808    12821
      809    12822    1   DCL SIZE UBIN;
      810    12823    1   DCL TSIZE UBIN;
      811    12824    1   DCL OPTVAL UBIN BYTE;
      812    12825    1   DCL LINK$ PTR;
      813    12826    1   DCL ROUTE$ PTR;
      814    12827    1   DCL CURINDX UBIN;                       /*  is index into npdu      */
      815    12828    1   DCL CODE UBIN BYTE;                     /* options code in pdu      */
      816    12829    1   DCL SENDINGERR UBIN;
      817    12830    1   DCL I UBIN;
      818    12831    1   DCL J UBIN;
      819    12832    1   DCL ERRVAL(0:3) UBIN;
      820    12833
      821    12834        %EJECT;
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:125  
      822    12835
      823    12836    1      SENDINGERR = 1;

  12836   1 000005  6C01                                 LDV,R6   1
          1 000006  EF47 00C7                            STR,R6   SENDINGERR,AUTO

      824    12837    1      ADDR(ERRVAL(0))->CALLEDFROM$ = ENTADDR(KNN$SENDERR);

  12837   1 000008  EBC0 FFF7                            LAB,B6   s:19,PREL
          1 00000A  EFC7 00CA                            STB,B6   ERRVAL,AUTO

      825    12838    1      ERRVAL(2) = %K_ER_PDU;

  12838   1 00000C  EF47 00CC                            STR,R6   ERRVAL+2,AUTO

      826    12839    1      IF K$NPDU_FIXED.TYPE = %K_ER_PDU OR NOT K$NPDU_FIXED.ER THEN

  12839   1 00000E  DCC7 0004                            LDB,B5   @KN$NETPARM,AUTO
          1 000010  CCC5 000E                            LDB,B4   14,B5
          1 000012  D844 0002                            LDR,R5   2,B4
          1 000014  5048                                 SOR,R5   8
          1 000015  D570 001F                            AND,R5   31,IMO
          1 000017  5D01                                 CMV,R5   1
          1 000018  0901 0006                            BE       s:12840,PREL
          1 00001A  82C4 0002                            LB,'2000'X        2,B4
          1 00001C       2000
          1 00001D  0501 0004                            BBT      s:12841,PREL

      827    12840    1         RETURN;
             12840                  /* dont generate errors if they dont want them.  dont generate errors*/

  12840   1 00001F  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      828    12841    1      SIZE = KN$NETPARM.RECTYPE; /* a sleaze, really contains offset to error */

  12841   1 000022  C845 0013                            LDR,R4   19,B5
          1 000024  CF47 00BE                            STR,R4   SIZE,AUTO
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:126  

      829    12842
      830    12843    1      GOTO COMMON;

  12843   1 000026  0F81 0015                            B        s:12851,PREL

      831    12844
      832    12845
      833    12846    1   KNN$SENDOSI: ENTRY(KN$NETPARM) ALTRET;

  12846   1 000028  D380 0000 0000  xent KNN$SENDOSI     LNJ,B5   X6A_AUTO_1
          1 00002B       00D8 0001                       DC       216,1

      834    12847
      835    12848    1      SENDINGERR = 0;

  12848   1 00002D  8747 00C7                            CL       SENDINGERR,AUTO

      836    12849    1      ADDR(ERRVAL(0))->CALLEDFROM$ = ENTADDR(KNN$SENDOSI);

  12849   1 00002F  EBC0 FFF8                            LAB,B6   s:12846,PREL
          1 000031  EFC7 00CA                            STB,B6   ERRVAL,AUTO

      837    12850    1      ERRVAL(2) = %K_DT_PDU;

  12850   1 000033  6C1C                                 LDV,R6   28
          1 000034  EF47 00CC                            STR,R6   ERRVAL+2,AUTO

      838    12851    1      SIZE = KN$NETPARM.THDRSZ;

  12851   1 000036  DCC7 0004                            LDB,B5   @KN$NETPARM,AUTO
          1 000038  D845 000D                            LDR,R5   13,B5
          1 00003A  DF47 00BE                            STR,R5   SIZE,AUTO

  12851   1                              COMMON          null
      839    12852
      840    12853    1   COMMON:;
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:127  
      841    12854
      842    12855    2      CALL KNN$DECODE_NSAP(DESTINATION,DSTROUTE) WHENALTRETURN DO;

  12855   1 00003C  CCC5 001F            COMMON          LDB,B4   31,B5
          1 00003E  BBC7 0014                            LAB,B3   DSTROUTE,AUTO
          1 000040  BFC7 00D0                            STB,B3   ERRVAL+6,AUTO
          1 000042  CFC7 00CE                            STB,B4   ERRVAL+4,AUTO
          1 000044  BBC7 00CE                            LAB,B3   ERRVAL+4,AUTO
          1 000046  CBF0 0200                            LAB,B4   512,IMO
          1 000048  E380 0000 0000  xent                 LNJ,B6   KNN$DECODE_NSAP
          1 00004B       0003                            DC       s:12857,PREL
          1 00004C  0F81 0023                            B        s:12861,PREL

      843    12856                                                /* do nothing per osi*/
      844    12857    2        CALL GHE$ERRLOG(E_DSCRD_DSTUNKNWN,ERRVAL,DESTINATION,SIZEC(DESTINATION),'0'B);

  12857   1 00004E  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 000050  DCC6 001F                            LDB,B5   31,B6
          1 000052  CBF0 0016                            LAB,B4   22,IMO
          1 000054  BBF0 0000                            LAB,B3   0,IMO
          1 000056  BFC7 00D6                            STB,B3   ERRVAL+12,AUTO
          1 000058  CFC7 00D4                            STB,B4   ERRVAL+10,AUTO
          1 00005A  DFC7 00D2                            STB,B5   ERRVAL+8,AUTO
          1 00005C  ABC7 00CA                            LAB,B2   ERRVAL,AUTO
          1 00005E  AFC7 00D0                            STB,B2   ERRVAL+6,AUTO
          1 000060  9B80 0000 0003  00                   LAB,B1   E_DSCRD_DSTUNKNWN
          1 000063  9FC7 00CE                            STB,B1   ERRVAL+4,AUTO
          1 000065  BBC7 00CE                            LAB,B3   ERRVAL+4,AUTO
          1 000067  CBF0 0500                            LAB,B4   1280,IMO
          1 000069  E380 0000 0000  xent                 LNJ,B6   GHE$ERRLOG
          1 00006C       0001                            DC       s:12858,PREL

      845    12858    2         RETURN;

  12858   1 00006D  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      846    12859    2         END;
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:128  
      847    12860
      848    12861    1      KN$NETPARM.SRC_ADDR$ = ADDR(DSTROUTE.LNSAP);

  12861   1 000070  EBC7 0023                            LAB,B6   DSTROUTE+15,AUTO
          1 000072  DCC7 0004                            LDB,B5   @KN$NETPARM,AUTO
          1 000074  EFC5 001D                            STB,B6   29,B5

      849    12862
      850    12863    2      IF DSTROUTE.FEP# ~= KN_NODE# THEN DO;

  12863   1 000076  E847 0015                            LDR,R6   DSTROUTE+1,AUTO
          1 000078  E570 00FF                            AND,R6   255,IMO
          1 00007A  E900 0000 0000  xsym                 CMR,R6   KN_NODE#
          1 00007D  0901 0059                            BE       s:12879,PREL

      851    12864    3         IF DSTROUTE.FEP# < KNN_NODES THEN DO;

  12864   1 00007F  E900 0000 0000  xsym                 CMR,R6   KNN_NODES
          1 000082  0281 0034                            BGE      s:12873,PREL

      852    12865    3            ROUTE$ = KNN$ROUTE$(DSTROUTE.FEP#);

  12865   1 000084  B856                                 LDR,R3   R6
          1 000085  CC80 0000 0000  xsym                 LDB,B4   KNN_ROUTE$$
          1 000088  BCB4                                 LDB,B3   ,B4,R3
          1 000089  BFC7 00C3                            STB,B3   ROUTE$,AUTO

      853    12866    3            LINK$ = KNN$ROUTE.LINK$;

  12866   1 00008B  AC83                                 LDB,B2   ,B3
          1 00008C  AFC7 00C1                            STB,B2   LINK$,AUTO

      854    12867    4            IF KNN$ROUTE.CURRENT_QOS = 255 OR KNN$LINK.LDCT$ = ADDR(NIL) THEN DO;

  12867   1 00008E  D843 0005                            LDR,R5   5,B3
          1 000090  D970 00FF                            CMR,R5   255,IMO
          1 000092  0901 0004                            BE       s:12868,PREL
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:129  
          1 000094  8D82                                 CMN      ,B2
          1 000095  0981 013C                            BNE      s:12917,PREL

      855    12868    4              CALL GHE$ERRLOG(E_DSCRD_DSTUNREACH,ERRVAL,DSTROUTE,SIZEC(DSTROUTE),'0'B)
             12868                        ;

  12868   1 000097  9BF0 003C                            LAB,B1   60,IMO
          1 000099  EBF0 0000                            LAB,B6   0,IMO
          1 00009B  EFC7 00D6                            STB,B6   ERRVAL+12,AUTO
          1 00009D  9FC7 00D4                            STB,B1   ERRVAL+10,AUTO
          1 00009F  EBC7 0014                            LAB,B6   DSTROUTE,AUTO
          1 0000A1  EFC7 00D2                            STB,B6   ERRVAL+8,AUTO
          1 0000A3  EBC7 00CA                            LAB,B6   ERRVAL,AUTO
          1 0000A5  EFC7 00D0                            STB,B6   ERRVAL+6,AUTO
          1 0000A7  EB80 0000 0005  00                   LAB,B6   E_DSCRD_DSTUNREACH
          1 0000AA  EFC7 00CE                            STB,B6   ERRVAL+4,AUTO
          1 0000AC  BBC7 00CE                            LAB,B3   ERRVAL+4,AUTO
          1 0000AE  CBF0 0500                            LAB,B4   1280,IMO
          1 0000B0  E380 0000 0000  xent                 LNJ,B6   GHE$ERRLOG
          1 0000B3       0001                            DC       s:12869,PREL

      856    12869    4               RETURN;

  12869   1 0000B4  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      857    12870    4               END;
      858    12871    3            END;                           /* if fep# < knn_nodes      */
      859    12872    3         ELSE DO;

      860    12873    3            CALL GHE$ERRLOG(E_DSCRD_DSTUNKNWN,ERRVAL,DSTROUTE,SIZEC(DSTROUTE),'0'B);

  12873   1 0000B7  CBF0 003C                            LAB,B4   60,IMO
          1 0000B9  BBF0 0000                            LAB,B3   0,IMO
          1 0000BB  BFC7 00D6                            STB,B3   ERRVAL+12,AUTO
          1 0000BD  CFC7 00D4                            STB,B4   ERRVAL+10,AUTO
          1 0000BF  EBC7 0014                            LAB,B6   DSTROUTE,AUTO
          1 0000C1  EFC7 00D2                            STB,B6   ERRVAL+8,AUTO
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:130  
          1 0000C3  ABC7 00CA                            LAB,B2   ERRVAL,AUTO
          1 0000C5  AFC7 00D0                            STB,B2   ERRVAL+6,AUTO
          1 0000C7  9B80 0000 0003  00                   LAB,B1   E_DSCRD_DSTUNKNWN
          1 0000CA  9FC7 00CE                            STB,B1   ERRVAL+4,AUTO
          1 0000CC  BBC7 00CE                            LAB,B3   ERRVAL+4,AUTO
          1 0000CE  CBF0 0500                            LAB,B4   1280,IMO
          1 0000D0  E380 0000 0000  xent                 LNJ,B6   GHE$ERRLOG
          1 0000D3       0001                            DC       s:12874,PREL

      861    12874    3            RETURN;

  12874   1 0000D4  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      862    12875    3            END;
      863    12876    2         END;
      864    12877    2      ELSE DO;

      865    12878
      866    12879    3         IF DSTROUTE.NS_TYPE = %K_TYPE_LNSAP THEN DO;

  12879   1 0000D7  D847 0014                            LDR,R5   DSTROUTE,AUTO
          1 0000D9  5044                                 SOR,R5   4
          1 0000DA  D570 000F                            AND,R5   15,IMO
          1 0000DC  5D01                                 CMV,R5   1
          1 0000DD  0981 000C                            BNE      s:12887,PREL

      867    12880    3            CALL SCREECH(PRTCLERR);

  12880   1 0000DF  BB80 0000 0000  02                   LAB,B3   0
          1 0000E2  CBF0 0100                            LAB,B4   256,IMO
          1 0000E4  E380 0000 0000  xent                 LNJ,B6   SCREECH
          1 0000E7       0001                            DC       s:12882,PREL

      868    12881                                           /* this doesn't make any sense.*/
      869    12882    3            END;                           /* if lnsap                 */

  12882   1 0000E8  0F81 00E9                            B        s:12917,PREL
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:131  

      870    12883    3         ELSE DO;                          /* else type = rnsap        */

      871    12884             /*
      872    12885             search vc list for a currently active connection
      873    12886             */
      874    12887    4            DO J = 0 TO KNN_LINKS - 1;

  12887   1 0000EA  8747 00C9                            CL       J,AUTO
          1 0000EC  0F81 0062                            B        s:12894+2,PREL

      875    12888    4               LINK$ = KNN$LINK$(J);

  12888   1 0000EE  EC80 0000 0000  xsym                 LDB,B6   KNN_LINK$$
          1 0000F1  B847 00C9                            LDR,R3   J,AUTO
          1 0000F3  DCB6                                 LDB,B5   ,B6,R3
          1 0000F4  DFC7 00C1                            STB,B5   LINK$,AUTO

      876    12889    4               IF KNN$LINK.FLAGS.VIRCIR

  12889   1 0000F6  82C5 0003                            LB,'1000'X        3,B5
  12889   1 0000F8       1000
          1 0000F9  0581 0053                            BBF      s:12894,PREL
          1 0000FB  E845 0002                            LDR,R6   2,B5
          1 0000FD  E970 00FD                            CMR,R6   253,IMO
          1 0000FF  0201 004D                            BL       s:12894,PREL
          1 000101  D2C7 002E                            LLH,R5   DSTROUTE+26,AUTO
          1 000103  C2C5 001F                            LLH,R4   31,B5
          1 000105  D954                                 CMR,R5   R4
          1 000106  0981 0046                            BNE      s:12894,PREL

      877    12890    4                 AND KNN$LINK.NODE# >= %K_CNC_IS#
      878    12891    5                 AND DSTROUTE.SNPA.LEN = KNN$LINK.SNPA.LEN THEN DO;

      879    12892    5                  SNPATMPLT1 = DSTROUTE.SNPA.ADDRESS;

  12892   1 000108  0021                                 ALR      ;
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:132  
          1 000109       C707 002E                                ALPHANUM(DSTROUTE+26,AUTO,1,7),;
          1 00010B       4807 00B6                                ALPHANUM(SNPATMPLT1,AUTO,,8,FILL)

      880    12893    5                  SNPATMPLT3 = KNN$LINK.SNPA.ADDRESS;

  12893   1 00010D  0021                                 ALR      ;
          1 00010E       C705 001F                                ALPHANUM(31,B5,1,7),;
          1 000110       4807 00BA                                ALPHANUM(SNPATMPLT3,AUTO,,8,FILL)

      881    12894    6                  DO I = 0 TO DSTROUTE.SNPA.LEN - 1;

  12894   1 000112  437F                                 CSYNC    s:12893+4,SPREL
          1 000113  8747 00C8                            CL       I,AUTO
          1 000115  0F81 002A                            B        s:12897+2,PREL

      882    12895    6                     IF SNPATMPLT2.NIBBLES.NIB(I) ~= SNPATMPLT4.NIBBLES.NIB(I) THEN

  12895   1 000117  ABC7 00B6                            LAB,B2   SNPATMPLT1,AUTO
          1 000119  A847 00C8                            LDR,R2   I,AUTO
          1 00011B  2002                                 SOL,R2   2
          1 00011C  6C04                                 LDV,R6   4
          1 00011D  BBC7 00CE                            LAB,B3   ERRVAL+4,AUTO
          1 00011F  3C00                                 LDV,R3   0
          1 000120  7C10                                 LDV,R7   16
          1 000121  D380 0000 0000  xent                 LNJ,B5   X6B_BLR
          1 000124  E847 00CE                            LDR,R6   ERRVAL+4,AUTO
          1 000126  604C                                 SOR,R6   12
          1 000127  EF47 00D0                            STR,R6   ERRVAL+6,AUTO
          1 000129  ABC7 00BA                            LAB,B2   SNPATMPLT3,AUTO
          1 00012B  A847 00C8                            LDR,R2   I,AUTO
          1 00012D  2002                                 SOL,R2   2
          1 00012E  6C04                                 LDV,R6   4
          1 00012F  BBC7 00CE                            LAB,B3   ERRVAL+4,AUTO
          1 000131  3C10                                 LDV,R3   16
          1 000132  7C10                                 LDV,R7   16
          1 000133  D380 0000 0000  xent                 LNJ,B5   X6B_BLR
          1 000136  E847 00CF                            LDR,R6   ERRVAL+5,AUTO
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:133  
          1 000138  604C                                 SOR,R6   12
          1 000139  D847 00D0                            LDR,R5   ERRVAL+6,AUTO
          1 00013B  E955                                 CMR,R6   R5
          1 00013C  0981 0010                            BNE      s:12894,PREL

      883    12896    6                        GOTO NXTJ;
      884    12897    6                     END;                  /* i = 0 to len-1           */

  12897   1 00013E  8AC7 00C8                            INC      I,AUTO
          1 000140  E2C7 002E                            LLH,R6   DSTROUTE+26,AUTO
          1 000142  E947 00C8                            CMR,R6   I,AUTO
          1 000144  0353                                 BG       s:12895,SPREL

      885    12898    5                  KN$NETPARM.LDCT$ = KNN$LINK.LDCT$;

  12898   1 000145  ECC7 00C1                            LDB,B6   LINK$,AUTO
          1 000147  DC86                                 LDB,B5   ,B6
          1 000148  CCC7 0004                            LDB,B4   @KN$NETPARM,AUTO
          1 00014A  DF84                                 STB,B5   ,B4

      886    12899    5                  GOTO EXITOSINET;

  12899   1 00014B  0F81 0086                            B        s:12917,PREL

  12894   1                              NXTJ            null
      887    12900    5                  END;                     /*  if vircir et al         */
      888    12901    4   NXTJ:       ;
      889    12902    4               END;                        /* do j = 0 to knn_links    */

  12902   1 00014D  8AC7 00C9            NXTJ            INC      J,AUTO
          1 00014F  E847 00C9                            LDR,R6   J,AUTO
          1 000151  E900 0000 0000  xsym                 CMR,R6   KNN_LINKS
          1 000154  0201 FF99                            BL       s:12888,PREL

      890    12903                /*
      891    12904                no vc connection currently running.  try to find a substr match
      892    12905                */
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:134  
      893    12906    4            DO J = 0 TO KNN_LINKS - 1;

  12906   1 000156  8747 00C9                            CL       J,AUTO
          1 000158  0F81 006F                            B        s:12917+2,PREL

      894    12907    4               LINK$ = KNN$LINK$(J);

  12907   1 00015A  EC80 0000 0000  xsym                 LDB,B6   KNN_LINK$$
          1 00015D  B847 00C9                            LDR,R3   J,AUTO
          1 00015F  DCB6                                 LDB,B5   ,B6,R3
          1 000160  DFC7 00C1                            STB,B5   LINK$,AUTO

      895    12908    5               IF NOT KNN$LINK.FLAGS.VIRCIR AND KNN$LINK.NODE# >= %K_CNC_IS# THEN DO;

  12908   1 000162  82C5 0003                            LB,'1000'X        3,B5
  12908   1 000164       1000
          1 000165  0501 0060                            BBT      s:12917,PREL
          1 000167  E845 0002                            LDR,R6   2,B5
          1 000169  E970 00FD                            CMR,R6   253,IMO
          1 00016B  0201 005A                            BL       s:12917,PREL

      896    12909    5                  SNPATMPLT1 = DSTROUTE.SNPA.ADDRESS;

  12909   1 00016D  0021                                 ALR      ;
          1 00016E       C707 002E                                ALPHANUM(DSTROUTE+26,AUTO,1,7),;
          1 000170       4807 00B6                                ALPHANUM(SNPATMPLT1,AUTO,,8,FILL)

      897    12910    5                  SNPATMPLT3 = KNN$LINK.SNPA.ADDRESS;

  12910   1 000172  0021                                 ALR      ;
          1 000173       C705 001F                                ALPHANUM(31,B5,1,7),;
          1 000175       4807 00BA                                ALPHANUM(SNPATMPLT3,AUTO,,8,FILL)

      898    12911    6                  DO I = 0 TO MINIMUM(DSTROUTE.NSAP.LEN,KNN$LINK.SNPA.LEN)-1;

  12911   1 000177  437F                                 CSYNC    s:12910+4,SPREL
          1 000178  8747 00C8                            CL       I,AUTO
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:135  
          1 00017A  0F81 002A                            B        s:12914+2,PREL

      899    12912    6                     IF SNPATMPLT2.NIBBLES.NIB(I) ~= SNPATMPLT4.NIBBLES.NIB(I) THEN

  12912   1 00017C  ABC7 00B6                            LAB,B2   SNPATMPLT1,AUTO
          1 00017E  A847 00C8                            LDR,R2   I,AUTO
          1 000180  2002                                 SOL,R2   2
          1 000181  6C04                                 LDV,R6   4
          1 000182  BBC7 00CE                            LAB,B3   ERRVAL+4,AUTO
          1 000184  3C00                                 LDV,R3   0
          1 000185  7C10                                 LDV,R7   16
          1 000186  D380 0000 0000  xent                 LNJ,B5   X6B_BLR
          1 000189  E847 00CE                            LDR,R6   ERRVAL+4,AUTO
          1 00018B  604C                                 SOR,R6   12
          1 00018C  EF47 00D0                            STR,R6   ERRVAL+6,AUTO
          1 00018E  ABC7 00BA                            LAB,B2   SNPATMPLT3,AUTO
          1 000190  A847 00C8                            LDR,R2   I,AUTO
          1 000192  2002                                 SOL,R2   2
          1 000193  6C04                                 LDV,R6   4
          1 000194  BBC7 00CE                            LAB,B3   ERRVAL+4,AUTO
          1 000196  3C10                                 LDV,R3   16
          1 000197  7C10                                 LDV,R7   16
          1 000198  D380 0000 0000  xent                 LNJ,B5   X6B_BLR
          1 00019B  E847 00CF                            LDR,R6   ERRVAL+5,AUTO
          1 00019D  604C                                 SOR,R6   12
          1 00019E  D847 00D0                            LDR,R5   ERRVAL+6,AUTO
          1 0001A0  E955                                 CMR,R6   R5
          1 0001A1  0981 0024                            BNE      s:12917,PREL

      900    12913    6                        GOTO NXTJ2;
      901    12914    6                     END;             /* do i = 0 to min(len,len)-1    */

  12914   1 0001A3  8AC7 00C8                            INC      I,AUTO
          1 0001A5  ECC7 00C1                            LDB,B6   LINK$,AUTO
          1 0001A7  E2C6 001F                            LLH,R6   31,B6
          1 0001A9  D2C7 0018                            LLH,R5   DSTROUTE+4,AUTO
          1 0001AB  D956                                 CMR,R5   R6
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:136  
          1 0001AC  0281 0002                            BGE      s:12914+12,PREL
          1 0001AE  E855                                 LDR,R6   R5
          1 0001AF  E947 00C8                            CMR,R6   I,AUTO
          1 0001B1  034B                                 BG       s:12912,SPREL

      902    12915    5                  FPT_NSAP.NSAP.LEN = DSTROUTE.SNPA.LEN;

  12915   1 0001B2  E2C7 002E                            LLH,R6   DSTROUTE+26,AUTO
          1 0001B4  E7C7 0006                            STH,R6   FPT_NSAP,AUTO

      903    12916    5                  FPT_NSAP.NSAP.ADDRESS = DSTROUTE.SNPA.ADDRESS;

  12916   1 0001B6  0021                                 ALR      ;
          1 0001B7       C707 002E                                ALPHANUM(DSTROUTE+26,AUTO,1,7),;
          1 0001B9       5407 0007                                ALPHANUM(FPT_NSAP+1,AUTO,,20,FILL)

      904    12917    5                  KN$NETPARM.FPT$ = ADDR(FPT_NSAP);

  12917   1 0001BB  DBC7 0006                            LAB,B5   FPT_NSAP,AUTO
          1 0001BD  CCC7 0004                            LDB,B4   @KN$NETPARM,AUTO
          1 0001BF  437F                                 CSYNC    s:12917+3,SPREL
          1 0001C0  DFC4 0019                            STB,B5   25,B4

      905    12918    5                  KN$NETPARM.LDCT$ = KNN$LINK.LDCT$;

  12918   1 0001C2  BC86                                 LDB,B3   ,B6
          1 0001C3  BF84                                 STB,B3   ,B4

      906    12919    5                  GOTO EXITOSINET;

  12919   1 0001C4  0F81 000D                            B        s:12917,PREL

  12917   1                              NXTJ2           null
      907    12920    5                  END;                     /* not vc and node# > is    */
      908    12921    4   NXTJ2:      ;
      909    12922    4               END;                   /* do j = 0 to knn_links - 1     */

PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:137  
  12922   1 0001C6  8AC7 00C9            NXTJ2           INC      J,AUTO
          1 0001C8  E847 00C9                            LDR,R6   J,AUTO
          1 0001CA  E900 0000 0000  xsym                 CMR,R6   KNN_LINKS
          1 0001CD  0201 FF8C                            BL       s:12907,PREL

      910    12923    3            RETURN;                   /* no route drop the message     */

  12923   1 0001CF  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

  12917   1                              EXITOSINET      null
      911    12924    3            END;                           /* else type = rnsap        */
      912    12925    2         END;                    /* else message bound for this node   */
      913    12926
      914    12927    1   EXITOSINET:;
      915    12928
      916    12929    1      CURINDX = LENGTHC(K$NPDU_FIXED);

  12929   1 0001D2  6C09                 EXITOSINET      LDV,R6   9
          1 0001D3  EF47 00C5                            STR,R6   CURINDX,AUTO

      917    12930
      918    12931    1      FIXED.PROTOCOLID = %K_PRTCL_ID;

  12931   1 0001D5  D870 0081                            LDR,R5   129,IMO
          1 0001D7  D7C7 0032                            STH,R5   FIXED,AUTO

      919    12932    1      FIXED.VERSION = %K_PRTCL_ID_EXT;

  12932   1 0001D9  4C01                                 LDV,R4   1
          1 0001DA  C7C7 0033                            STH,R4   FIXED+1,AUTO

      920    12933    1      FIXED.SP = '1'B;

  12933   1 0001DC  8947 0034                            LBT,'8000'X       FIXED+2,AUTO
  12933   1 0001DE       8000

      921    12934    1      FIXED.ER = '0'B;
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:138  

  12934   1 0001DF  8847 0034                            LBF,'2000'X       FIXED+2,AUTO
  12934   1 0001E1       2000

      922    12935    1      FIXED.MS = '0'B;

  12935   1 0001E2  8847 0034                            LBF,'4000'X       FIXED+2,AUTO
  12935   1 0001E4       4000

      923    12936    1      FIXED.CHECKSUMX = 0;

  12936   1 0001E5  8847 0035                            LBF,'00FF'X       FIXED+3,AUTO
  12936   1 0001E7       00FF

      924    12937    1      FIXED.CHECKSUMY = 0;

  12937   1 0001E8  87C7 0036                            CLH      FIXED+4,AUTO

      925    12938    1      FIXED.LIFETIME = KNN_LIFETIME;

  12938   1 0001EA  B800 0000 0000  xsym                 LDR,R3   KNN_LIFETIME
          1 0001ED  BAC7 0033                            SRM,R3,'00FF'X    FIXED+1,AUTO
          1 0001EF       00FF

      926    12939    1      IF SENDINGERR>0 THEN

  12939   1 0001F0  A847 00C7                            LDR,R2   SENDINGERR,AUTO
          1 0001F2  2901 0008                            BEZ,R2   s:12942,PREL

      927    12940    1         FIXED.TYPE = %K_ER_PDU;

  12940   1 0001F4  9870 0100                            LDR,R1   256,IMO
          1 0001F6  9AC7 0034                            SRM,R1,'1F00'X    FIXED+2,AUTO
          1 0001F8       1F00
          1 0001F9  0F81 0006                            B        s:12943,PREL

      928    12941    1      ELSE
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:139  
      929    12942    1         FIXED.TYPE = %K_DT_PDU;

  12942   1 0001FB  9870 1C00                            LDR,R1   7168,IMO
          1 0001FD  9AC7 0034                            SRM,R1,'1F00'X    FIXED+2,AUTO
          1 0001FF       1F00

      930    12943    1      FIXED.LENGTH = LENGTHC(K$NPDU_FIXED)+(SOURCE.LEN+1)+(DESTINATION.LEN+1)+LENGTHC(
             12943               SEGMENT)+(6*SENDINGERR); /*  for options*/

  12943   1 000200  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 000202  DCC6 001D                            LDB,B5   29,B6
          1 000204  CCC6 001F                            LDB,B4   31,B6
          1 000206  9285                                 LLH,R1   ,B5
          1 000207  E284                                 LLH,R6   ,B4
          1 000208  9A56                                 ADD,R1   R6
          1 000209  2F06                                 MLV,R2   6
          1 00020A  AA51                                 ADD,R2   R1
          1 00020B  2E11                                 ADV,R2   17
          1 00020C  AAC7 0032                            SRM,R2,'00FF'X    FIXED,AUTO
          1 00020E       00FF

      931    12944    1      TSIZE = FIXED.LENGTH + SIZE;         /* size of data to be sent  */

  12944   1 00020F  E847 0032                            LDR,R6   FIXED,AUTO
          1 000211  E570 00FF                            AND,R6   255,IMO
          1 000213  EA47 00BE                            ADD,R6   SIZE,AUTO
          1 000215  EF47 00BF                            STR,R6   TSIZE,AUTO

      932    12945    1      FIXED.SEGLENX = TSIZE/256;

  12945   1 000217  6048                                 SOR,R6   8
          1 000218  EAC7 0034                            SRM,R6,'00FF'X    FIXED+2,AUTO
          1 00021A       00FF

      933    12946    1      FIXED.SEGLENY = BITBIN(BINBIT(TSIZE,16)& '00FF'X);

  12946   1 00021B  E847 00BF                            LDR,R6   TSIZE,AUTO
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:140  
          1 00021D  E570 00FF                            AND,R6   255,IMO
          1 00021F  E7C7 0035                            STH,R6   FIXED+3,AUTO

      934    12947        /*
      935    12948             if we are sending an error pdu, then the destination address address is really
      936    12949             the source address.  Otherwise send to the destination.
      937    12950        */
      938    12951    2      IF SENDINGERR> 0 THEN DO;

  12951   1 000221  E847 00C7                            LDR,R6   SENDINGERR,AUTO
          1 000223  6901 0030                            BEZ,R6   s:12959,PREL

      939    12952    2         SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,SOURCE.LEN+1) = SUBSTR(ADDR(SOURCE)->
             12952                  ADDRESS,0,SOURCE.LEN+1);

  12952   1 000225  DCC6 001D                            LDB,B5   29,B6
          1 000227  A285                                 LLH,R2   ,B5
          1 000228  AB85                                 LAB,B2   ,B5
          1 000229  AF47 00CE                            STR,R2   ERRVAL+4,AUTO
          1 00022B  2C00                                 LDV,R2   0
          1 00022C  E847 00CE                            LDR,R6   ERRVAL+4,AUTO
          1 00022E  6E01                                 ADV,R6   1
          1 00022F  BB87                                 LAB,B3   ,AUTO
          1 000230  B847 00C5                            LDR,R3   CURINDX,AUTO
          1 000232  3E64                                 ADV,R3   100
          1 000233  0008                                 MMM

      940    12953    2         CURINDX = SOURCE.LEN + CURINDX + 1;

  12953   1 000234  CCC6 001D                            LDB,B4   29,B6
          1 000236  E284                                 LLH,R6   ,B4
          1 000237  EA47 00C5                            ADD,R6   CURINDX,AUTO
          1 000239  6E01                                 ADV,R6   1
          1 00023A  EF47 00C5                            STR,R6   CURINDX,AUTO

      941    12954
      942    12955    2         SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,DESTINATION.LEN+1) = SUBSTR(ADDR(
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:141  
             12955                  DESTINATION)->ADDRESS,0,DESTINATION.LEN+1);

  12955   1 00023C  9CC6 001F                            LDB,B1   31,B6
          1 00023E  B281                                 LLH,R3   ,B1
          1 00023F  AB81                                 LAB,B2   ,B1
          1 000240  2C00                                 LDV,R2   0
          1 000241  E853                                 LDR,R6   R3
          1 000242  6E01                                 ADV,R6   1
          1 000243  BB87                                 LAB,B3   ,AUTO
          1 000244  BF47 00CE                            STR,R3   ERRVAL+4,AUTO
          1 000246  B847 00C5                            LDR,R3   CURINDX,AUTO
          1 000248  3E64                                 ADV,R3   100
          1 000249  0008                                 MMM

      943    12956    2         CURINDX = DESTINATION.LEN + CURINDX + 1;

  12956   1 00024A  CCC6 001F                            LDB,B4   31,B6
          1 00024C  E284                                 LLH,R6   ,B4
          1 00024D  EA47 00C5                            ADD,R6   CURINDX,AUTO
          1 00024F  6E01                                 ADV,R6   1
          1 000250  EF47 00C5                            STR,R6   CURINDX,AUTO

      944    12957    2         END;

  12957   1 000252  0F81 002E                            B        s:12965,PREL

      945    12958    2      ELSE DO;

      946    12959    2         SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,DESTINATION.LEN+1) = SUBSTR(ADDR(
             12959                  DESTINATION)->ADDRESS,0,DESTINATION.LEN+1);

  12959   1 000254  DCC6 001F                            LDB,B5   31,B6
          1 000256  A285                                 LLH,R2   ,B5
          1 000257  AB85                                 LAB,B2   ,B5
          1 000258  AF47 00CE                            STR,R2   ERRVAL+4,AUTO
          1 00025A  2C00                                 LDV,R2   0
          1 00025B  E847 00CE                            LDR,R6   ERRVAL+4,AUTO
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:142  
          1 00025D  6E01                                 ADV,R6   1
          1 00025E  BB87                                 LAB,B3   ,AUTO
          1 00025F  B847 00C5                            LDR,R3   CURINDX,AUTO
          1 000261  3E64                                 ADV,R3   100
          1 000262  0008                                 MMM

      947    12960    2         CURINDX = DESTINATION.LEN + CURINDX + 1;

  12960   1 000263  CCC6 001F                            LDB,B4   31,B6
          1 000265  E284                                 LLH,R6   ,B4
          1 000266  EA47 00C5                            ADD,R6   CURINDX,AUTO
          1 000268  6E01                                 ADV,R6   1
          1 000269  EF47 00C5                            STR,R6   CURINDX,AUTO

      948    12961
      949    12962    2         SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,SOURCE.LEN+1) = SUBSTR(ADDR(SOURCE)->
             12962                  ADDRESS,0,SOURCE.LEN+1);

  12962   1 00026B  9CC6 001D                            LDB,B1   29,B6
          1 00026D  B281                                 LLH,R3   ,B1
          1 00026E  AB81                                 LAB,B2   ,B1
          1 00026F  2C00                                 LDV,R2   0
          1 000270  E853                                 LDR,R6   R3
          1 000271  6E01                                 ADV,R6   1
          1 000272  BB87                                 LAB,B3   ,AUTO
          1 000273  BF47 00CE                            STR,R3   ERRVAL+4,AUTO
          1 000275  B847 00C5                            LDR,R3   CURINDX,AUTO
          1 000277  3E64                                 ADV,R3   100
          1 000278  0008                                 MMM

      950    12963    2         CURINDX = SOURCE.LEN + CURINDX + 1;

  12963   1 000279  CCC6 001D                            LDB,B4   29,B6
          1 00027B  E284                                 LLH,R6   ,B4
          1 00027C  EA47 00C5                            ADD,R6   CURINDX,AUTO
          1 00027E  6E01                                 ADV,R6   1
          1 00027F  EF47 00C5                            STR,R6   CURINDX,AUTO
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:143  

      951    12964    2         END;

      952    12965    1      KNN_DATAID = KNN_DATAID + 1;

  12965   1 000281  8A80 0000 0000  xsym                 INC      KNN_DATAID

      953    12966
      954    12967    1      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(KNN_DATAID)->ADDRESS,0,1);

  12967   1 000284  B080 0000 0000  xsym                 LDH,R3   KNN_DATAID
          1 000287  A856                                 LDR,R2   R6
          1 000288  2E64                                 ADV,R2   100
          1 000289  B7A7                                 STH,R3   ,AUTO,R2

      955    12968    1      CURINDX = CURINDX + 1;

  12968   1 00028A  8AC7 00C5                            INC      CURINDX,AUTO

      956    12969    1      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(KNN_DATAID)->ADDRESS,1,1);

  12969   1 00028C  9800 0000 0000  xsym                 LDR,R1   KNN_DATAID
          1 00028F  1008                                 SOL,R1   8
          1 000290  1068                                 SAR,R1   8
          1 000291  B847 00C5                            LDR,R3   CURINDX,AUTO
          1 000293  3E64                                 ADV,R3   100
          1 000294  97B7                                 STH,R1   ,AUTO,R3

      957    12970    1      CURINDX = CURINDX + 1;

  12970   1 000295  8AC7 00C5                            INC      CURINDX,AUTO

      958    12971
      959    12972        /*
      960    12973             segment.offset.
      961    12974        */
      962    12975    1      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BITASC('0'B);
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:144  

  12975   1 000297  3C00                                 LDV,R3   0
          1 000298  A847 00C5                            LDR,R2   CURINDX,AUTO
          1 00029A  2E64                                 ADV,R2   100
          1 00029B  B7A7                                 STH,R3   ,AUTO,R2

      963    12976    1      CURINDX = CURINDX + 1;

  12976   1 00029C  8AC7 00C5                            INC      CURINDX,AUTO

      964    12977
      965    12978    1      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BITASC('0'B);

  12978   1 00029E  A847 00C5                            LDR,R2   CURINDX,AUTO
          1 0002A0  2E64                                 ADV,R2   100
          1 0002A1  B7A7                                 STH,R3   ,AUTO,R2

      966    12979    1      CURINDX = CURINDX + 1;

  12979   1 0002A2  8AC7 00C5                            INC      CURINDX,AUTO

      967    12980
      968    12981        /*
      969    12982          total length
      970    12983        */
      971    12984    1      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(TSIZE)->ADDRESS,0,1);

  12984   1 0002A4  A0C7 00BF                            LDH,R2   TSIZE,AUTO
          1 0002A6  B847 00C5                            LDR,R3   CURINDX,AUTO
          1 0002A8  3E64                                 ADV,R3   100
          1 0002A9  A7B7                                 STH,R2   ,AUTO,R3

      972    12985    1      CURINDX = CURINDX + 1;

  12985   1 0002AA  8AC7 00C5                            INC      CURINDX,AUTO

      973    12986
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:145  
      974    12987    1      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(TSIZE)->ADDRESS,1,1);

  12987   1 0002AC  B847 00BF                            LDR,R3   TSIZE,AUTO
          1 0002AE  3008                                 SOL,R3   8
          1 0002AF  3068                                 SAR,R3   8
          1 0002B0  A847 00C5                            LDR,R2   CURINDX,AUTO
          1 0002B2  2E64                                 ADV,R2   100
          1 0002B3  B7A7                                 STH,R3   ,AUTO,R2

      975    12988    1      CURINDX = CURINDX + 1;

  12988   1 0002B4  8AC7 00C5                            INC      CURINDX,AUTO

      976    12989
      977    12990    2      IF SENDINGERR > 0 THEN DO;

  12990   1 0002B6  B847 00C7                            LDR,R3   SENDINGERR,AUTO
          1 0002B8  3901 0061                            BEZ,R3   s:13024,PREL

      978    12991                            /* reason is in right half of errcode field     */
      979    12992
      980    12993    2         SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BINASC(%K_NPRM_REASON);

  12993   1 0002BA  2CC1                                 LDV,R2   -63
          1 0002BB  B847 00C5                            LDR,R3   CURINDX,AUTO
          1 0002BD  3E64                                 ADV,R3   100
          1 0002BE  A7B7                                 STH,R2   ,AUTO,R3

      981    12994    2         CURINDX = CURINDX + 1;

  12994   1 0002BF  8AC7 00C5                            INC      CURINDX,AUTO

      982    12995
      983    12996    2         SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BINASC(2); /* size of parameter */

  12996   1 0002C1  3C02                                 LDV,R3   2
          1 0002C2  A847 00C5                            LDR,R2   CURINDX,AUTO
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:146  
          1 0002C4  2E64                                 ADV,R2   100
          1 0002C5  B7A7                                 STH,R3   ,AUTO,R2

      984    12997    2         CURINDX = CURINDX + 1;

  12997   1 0002C6  8AC7 00C5                            INC      CURINDX,AUTO

      985    12998
      986    12999    2         SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(KN$NETPARM.ERRCODE)->
             12999                  ADDRESS,1,1);

  12999   1 0002C8  A846 0016                            LDR,R2   22,B6
          1 0002CA  2008                                 SOL,R2   8
          1 0002CB  2068                                 SAR,R2   8
          1 0002CC  B847 00C5                            LDR,R3   CURINDX,AUTO
          1 0002CE  3E64                                 ADV,R3   100
          1 0002CF  A7B7                                 STH,R2   ,AUTO,R3

      987    13000    2         CURINDX = CURINDX + 1;

  13000   1 0002D0  8AC7 00C5                            INC      CURINDX,AUTO

      988    13001
      989    13002        /* use the right half of size to determine the size of the data being returned */
      990    13003
      991    13004    3         IF SIZE > 255 THEN DO;

  13004   1 0002D2  B847 00BE                            LDR,R3   SIZE,AUTO
          1 0002D4  B970 00FF                            CMR,R3   255,IMO
          1 0002D6  0381 000A                            BLE      s:13009,PREL

      992    13005    3            SIZE = 0;

  13005   1 0002D8  8747 00BE                            CL       SIZE,AUTO

      993    13006    3            SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BITASC('0'B);

PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:147  
  13006   1 0002DA  3C00                                 LDV,R3   0
          1 0002DB  A847 00C5                            LDR,R2   CURINDX,AUTO
          1 0002DD  2E64                                 ADV,R2   100
          1 0002DE  B7A7                                 STH,R3   ,AUTO,R2

      994    13007    3            END;

  13007   1 0002DF  0F81 0009                            B        s:13011,PREL

      995    13008    2         ELSE
      996    13009    2            SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(SIZE)->ADDRESS,1,1);

  13009   1 0002E1  A847 00BE                            LDR,R2   SIZE,AUTO
          1 0002E3  2008                                 SOL,R2   8
          1 0002E4  2068                                 SAR,R2   8
          1 0002E5  B847 00C5                            LDR,R3   CURINDX,AUTO
          1 0002E7  3E64                                 ADV,R3   100
          1 0002E8  A7B7                                 STH,R2   ,AUTO,R3

      997    13010
      998    13011    2         CURINDX = CURINDX + 1;

  13011   1 0002E9  8AC7 00C5                            INC      CURINDX,AUTO

      999    13012
     1000    13013    2        SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,SIZE) = SUBSTR(KN$NETPARM.NHDR$->ADDRESS,0
             13013                  ,SIZE);

  13013   1 0002EB  CCC6 000E                            LDB,B4   14,B6
          1 0002ED  AB84                                 LAB,B2   ,B4
          1 0002EE  2C00                                 LDV,R2   0
          1 0002EF  E847 00BE                            LDR,R6   SIZE,AUTO
          1 0002F1  BB87                                 LAB,B3   ,AUTO
          1 0002F2  B847 00C5                            LDR,R3   CURINDX,AUTO
          1 0002F4  3E64                                 ADV,R3   100
          1 0002F5  0008                                 MMM

PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:148  
     1001    13014    2         CURINDX = CURINDX + SIZE;

  13014   1 0002F6  E847 00C5                            LDR,R6   CURINDX,AUTO
          1 0002F8  EA47 00BE                            ADD,R6   SIZE,AUTO
          1 0002FA  EF47 00C5                            STR,R6   CURINDX,AUTO

     1002    13015
     1003    13016    2         IF SIZE + FIXED.LENGTH > LENGTHC(FIXED) THEN

  13016   1 0002FC  B847 0032                            LDR,R3   FIXED,AUTO
          1 0002FE  B570 00FF                            AND,R3   255,IMO
          1 000300  BA47 00BE                            ADD,R3   SIZE,AUTO
          1 000302  B970 0108                            CMR,R3   264,IMO
          1 000304  0381 0007                            BLE      s:13019,PREL

     1004    13017    2            SIZE = LENGTHC(FIXED);

  13017   1 000306  B870 0108                            LDR,R3   264,IMO
          1 000308  BF47 00BE                            STR,R3   SIZE,AUTO
          1 00030A  0F81 0009                            B        s:13020,PREL

     1005    13018    2         ELSE
     1006    13019    2            SIZE = SIZE + FIXED.LENGTH;

  13019   1 00030C  B847 0032                            LDR,R3   FIXED,AUTO
          1 00030E  B570 00FF                            AND,R3   255,IMO
          1 000310  BA47 00BE                            ADD,R3   SIZE,AUTO
          1 000312  BF47 00BE                            STR,R3   SIZE,AUTO

     1007    13020    2         KN$NETPARM.THDRSZ = 0;

  13020   1 000314  8746 000D                            CL       13,B6

     1008    13021    2         KN$NETPARM.SHDRSZ = 0;

  13021   1 000316  8746 000A                            CL       10,B6

PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:149  
     1009    13022    2         END;

  13022   1 000318  0F81 0007                            B        s:13027,PREL

     1010    13023    1      ELSE
     1011    13024    1         SIZE = FIXED.LENGTH;

  13024   1 00031A  A847 0032                            LDR,R2   FIXED,AUTO
          1 00031C  A570 00FF                            AND,R2   255,IMO
          1 00031E  AF47 00BE                            STR,R2   SIZE,AUTO

     1012    13025
     1013    13026
     1014    13027    2      IF KNN_CHECKSUM ~= 0 THEN DO;

  13027   1 000320  E800 0000 0000  xsym                 LDR,R6   KNN_CHECKSUM
          1 000323  6901 0028                            BEZ,R6   s:13033,PREL

     1015    13028    2         CALL KNA$CALC_CHKSUM(ADDR(FIXED),SIZE,%K_CHKSUM_OFFSET);

  13028   1 000325  CBC7 0032                            LAB,B4   FIXED,AUTO
          1 000327  CFC7 00CE                            STB,B4   ERRVAL+4,AUTO
          1 000329  ABF0 0008                            LAB,B2   8,IMO
          1 00032B  AFC7 00D4                            STB,B2   ERRVAL+10,AUTO
          1 00032D  EBC7 00BE                            LAB,B6   SIZE,AUTO
          1 00032F  EFC7 00D2                            STB,B6   ERRVAL+8,AUTO
          1 000331  EBC7 00CE                            LAB,B6   ERRVAL+4,AUTO
          1 000333  EFC7 00D0                            STB,B6   ERRVAL+6,AUTO
          1 000335  BBC7 00D0                            LAB,B3   ERRVAL+6,AUTO
          1 000337  CBF0 0300                            LAB,B4   768,IMO
          1 000339  E380 0000 0000  xent                 LNJ,B6   KNA$CALC_CHKSUM
          1 00033C       0001                            DC       s:13029,PREL

     1016    13029    2         IF FIXED.CHECKSUMX = 0 THEN FIXED.CHECKSUMX = 255;

  13029   1 00033D  82C7 0035                            LB,'00FF'X        FIXED+3,AUTO
  13029   1 00033F       00FF
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:150  
          1 000340  0501 0004                            BBT      s:13030,PREL

  13029   1 000342  8947 0035                            LBT,'00FF'X       FIXED+3,AUTO
  13029   1 000344       00FF

     1017    13030    2         IF FIXED.CHECKSUMY = 0 THEN FIXED.CHECKSUMY = 255;

  13030   1 000345  E2C7 0036                            LLH,R6   FIXED+4,AUTO
          1 000347  6981 0004                            BNEZ,R6  s:13033,PREL

  13030   1 000349  8947 0036                            LBT,'FF00'X       FIXED+4,AUTO
  13030   1 00034B       FF00

     1018    13031    2         END;

     1019    13032
     1020    13033    1      KN$NETPARM.UHDRSZ = 0;

  13033   1 00034C  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 00034E  8746 0007                            CL       7,B6

     1021    13034    1      KN$NETPARM.NHDR$ = ADDR(FIXED);

  13034   1 000350  DBC7 0032                            LAB,B5   FIXED,AUTO
          1 000352  DFC6 000E                            STB,B5   14,B6

     1022    13035    1      KN$NETPARM.NHDRSZ = SIZE;

  13035   1 000354  E847 00BE                            LDR,R6   SIZE,AUTO
          1 000356  EF46 0010                            STR,R6   16,B6

     1023    13036    2      IF KN$NETPARM.LDCT$ = ADDR(NIL) THEN DO; /* KNN$RECVOSI saved fpt$ and ldct$ */

  13036   1 000358  8D86                                 CMN      ,B6
          1 000359  0981 0021                            BNE      s:13042,PREL

     1024    13037    2         CALL GHE$ERRLOG(E_DSCRD_DSTUNREACH,ERRVAL,FIXED,SIZEC(FIXED),'0'B);
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:151  

  13037   1 00035B  CBF0 0108                            LAB,B4   264,IMO
          1 00035D  BBF0 0000                            LAB,B3   0,IMO
          1 00035F  BFC7 00D6                            STB,B3   ERRVAL+12,AUTO
          1 000361  CFC7 00D4                            STB,B4   ERRVAL+10,AUTO
          1 000363  DBC7 0032                            LAB,B5   FIXED,AUTO
          1 000365  DFC7 00D2                            STB,B5   ERRVAL+8,AUTO
          1 000367  ABC7 00CA                            LAB,B2   ERRVAL,AUTO
          1 000369  AFC7 00D0                            STB,B2   ERRVAL+6,AUTO
          1 00036B  9B80 0000 0005  00                   LAB,B1   E_DSCRD_DSTUNREACH
          1 00036E  9FC7 00CE                            STB,B1   ERRVAL+4,AUTO
          1 000370  BBC7 00CE                            LAB,B3   ERRVAL+4,AUTO
          1 000372  CBF0 0500                            LAB,B4   1280,IMO
          1 000374  E380 0000 0000  xent                 LNJ,B6   GHE$ERRLOG
          1 000377       0001                            DC       s:13038,PREL

     1025    13038    2         RETURN;

  13038   1 000378  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1026    13039    2         END;
     1027    13040
     1028    13041
     1029    13042    2      CALL KNH$SEND(KN$NETPARM) WHENALTRETURN DO;

  13042   1 00037B  BBC7 0004                            LAB,B3   @KN$NETPARM,AUTO
          1 00037D  CBF0 0100                            LAB,B4   256,IMO
          1 00037F  E380 0000 0000  xent                 LNJ,B6   KNH$SEND
          1 000382       0003                            DC       s:13043,PREL
          1 000383  0F81 002A                            B        s:13049,PREL

     1030    13043    3         IF KN$NETPARM.ERRCODE = %KN_ERR_Q2SMALL THEN DO;

  13043   1 000385  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 000387  E846 0016                            LDR,R6   22,B6
          1 000389  6D04                                 CMV,R6   4
          1 00038A  0981 0020                            BNE      s:13047,PREL
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:152  

     1031    13044    3            CALL GHE$ERRLOG(E_DSCRD_CONGEST,ERRVAL,K$NPDU_FIXED,SIZEC(K$NPDU_FIXED),
             13044                     '0'B);

  13044   1 00038C  DCC6 000E                            LDB,B5   14,B6
          1 00038E  CBF0 000A                            LAB,B4   10,IMO
          1 000390  BBF0 0000                            LAB,B3   0,IMO
          1 000392  BFC7 00D6                            STB,B3   ERRVAL+12,AUTO
          1 000394  CFC7 00D4                            STB,B4   ERRVAL+10,AUTO
          1 000396  DFC7 00D2                            STB,B5   ERRVAL+8,AUTO
          1 000398  ABC7 00CA                            LAB,B2   ERRVAL,AUTO
          1 00039A  AFC7 00D0                            STB,B2   ERRVAL+6,AUTO
          1 00039C  9B80 0000 0007  00                   LAB,B1   E_DSCRD_CONGEST
          1 00039F  9FC7 00CE                            STB,B1   ERRVAL+4,AUTO
          1 0003A1  BBC7 00CE                            LAB,B3   ERRVAL+4,AUTO
          1 0003A3  CBF0 0500                            LAB,B4   1280,IMO
          1 0003A5  E380 0000 0000  xent                 LNJ,B6   GHE$ERRLOG
          1 0003A8       0001                            DC       s:13045,PREL

     1032    13045    3            END;

  13045   1 0003A9  0F81 0004                            B        s:13049,PREL

     1033    13046    2         ELSE
     1034    13047    2            ALTRETURN;

  13047   1 0003AB  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1035    13048    2         END;                              /* whenaltreturn            */
     1036    13049    1   END KNN$SENDERR;

  13049   1 0003AE  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     1037    13050        %EOD;

PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:153  
--  Include file information  --

   KN_ERRORS_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   K_INTERFACE_M.:E05TOU  is referenced.
   KN_DATA_M.:E05TOU  is referenced.
   KNN_NETWORK_M.:E05TOU  is referenced.
   K_SCODE_C.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   K_NETWORK_E.:E05TOU  is referenced.
   K_NETWORK_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KNN$SENDERR.
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:154  

 **** Variables and constants ****

  ****  Section 000 RoData KNN$SENDERR

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     7-0-0/w STRC(32)    r     1 E_DSCRD_CONGEST            3-0-0/w STRC(32)    r     1 E_DSCRD_DSTUNKNWN
     5-0-0/w STRC(32)    r     1 E_DSCRD_DSTUNREACH         0-0-0/w STRC(48)    r     1 PRTCLERR

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @KN$NETPARM               C5-0-0/w UBIN(16)    r     1 CURINDX
    14-0-0/w STRC(480)   r     1 DSTROUTE                  CA-0-0/w UBIN(16)    r     1 ERRVAL(0:3)
    32-0-0/c STRC(2112)  r     1 FIXED                      6-0-0/w STRC(176)   r     1 FPT_NSAP
    C8-0-0/w UBIN(16)    r     1 I                         C9-0-0/w UBIN(16)    r     1 J
    *0-0-0/w STRC(528)   r     1 KN$NETPARM                C1-0-0/w PTR         r     1 LINK$
    C3-0-0/w PTR         r     1 ROUTE$                    11-0-0/w STRC(48)    r     1 SEGMENT
    C7-0-0/w UBIN(16)    r     1 SENDINGERR                BE-0-0/w UBIN(16)    r     1 SIZE
    B6-0-0/w CHAR(8)     r     1 SNPATMPLT1                B6-0-0/w STRC(56)    r     1 SNPATMPLT2
    BA-0-0/w CHAR(8)     r     1 SNPATMPLT3                BA-0-0/w STRC(56)    r     1 SNPATMPLT4
    BF-0-0/w UBIN(16)    r     1 TSIZE

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN(16)    r     1 KNN_CHECKSUM               0-0-0/w UBIN(16)    r     1 KNN_DATAID
     0-0-0/w UBIN(16)    r     1 KNN_LIFETIME               0-0-0/w PTR         r     1 KNN_LINK$$
     0-0-0/w UBIN(16)    r     1 KNN_LINKS                  0-0-0/w UBIN(16)    r     1 KNN_NODES
     0-0-0/w PTR         r     1 KNN_ROUTE$$                0-0-0/w UBIN(16)    r     1 KN_NODE#

  ****  BASED and DCB variables  ****
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:155  

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c ACHR        r     1 ADDRESS                    0-0-0/w EPTR        r     1 CALLEDFROM$
     0-0-0/c STRC(176)   r     1 DESTINATION                0-0-0/w STRC(72)    r     1 K$NPDU_FIXED
     0-0-0/c STRC(608)   r     1 KNN$LINK
     0-0-0/w PTR         r     1 KNN$LINK$(0:0)
     0-0-0/w STRC(208)   r     1 KNN$ROUTE
     0-0-0/w PTR         r     1 KNN$ROUTE$(0:0)
     0-0-0/c STRC(176)   r     1 SOURCE


   Procedure KNN$SENDERR requires 945 words for executable code.
   Procedure KNN$SENDERR requires 216 words of local(AUTO) storage.
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:156  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:157  
          MINI XREF LISTING

ADDRESS
     12416**DCL     12952<<ASSIGN  12952>>ASSIGN  12955<<ASSIGN  12955>>ASSIGN  12959<<ASSIGN  12959>>ASSIGN
     12962<<ASSIGN  12962>>ASSIGN  12967<<ASSIGN  12967>>ASSIGN  12969<<ASSIGN  12969>>ASSIGN  12975<<ASSIGN
     12978<<ASSIGN  12984<<ASSIGN  12984>>ASSIGN  12987<<ASSIGN  12987>>ASSIGN  12993<<ASSIGN  12996<<ASSIGN
     12999<<ASSIGN  12999>>ASSIGN  13006<<ASSIGN  13009<<ASSIGN  13009>>ASSIGN  13013<<ASSIGN  13013>>ASSIGN
CALLEDFROM$
     12418**DCL     12837<<ASSIGN  12849<<ASSIGN
COMMON
     12851**LABEL   12843--GOTO
CURINDX
     12827**DCL     12929<<ASSIGN  12952>>ASSIGN  12953<<ASSIGN  12953>>ASSIGN  12955>>ASSIGN  12956<<ASSIGN
     12956>>ASSIGN  12959>>ASSIGN  12960<<ASSIGN  12960>>ASSIGN  12962>>ASSIGN  12963<<ASSIGN  12963>>ASSIGN
     12967>>ASSIGN  12968<<ASSIGN  12968>>ASSIGN  12969>>ASSIGN  12970<<ASSIGN  12970>>ASSIGN  12975>>ASSIGN
     12976<<ASSIGN  12976>>ASSIGN  12978>>ASSIGN  12979<<ASSIGN  12979>>ASSIGN  12984>>ASSIGN  12985<<ASSIGN
     12985>>ASSIGN  12987>>ASSIGN  12988<<ASSIGN  12988>>ASSIGN  12993>>ASSIGN  12994<<ASSIGN  12994>>ASSIGN
     12996>>ASSIGN  12997<<ASSIGN  12997>>ASSIGN  12999>>ASSIGN  13000<<ASSIGN  13000>>ASSIGN  13006>>ASSIGN
     13009>>ASSIGN  13011<<ASSIGN  13011>>ASSIGN  13013>>ASSIGN  13014<<ASSIGN  13014>>ASSIGN
DESTINATION
     12003**DCL     12855<>CALL    12857<>CALL    12857--CALL    12955--ASSIGN  12959--ASSIGN
DESTINATION.ADDRESS_N
     12035**DCL     12036--REDEF
DESTINATION.LEN
     12007**DCL     12943>>ASSIGN  12955>>ASSIGN  12955>>ASSIGN  12956>>ASSIGN  12959>>ASSIGN  12959>>ASSIGN
     12960>>ASSIGN
DSTROUTE
     12561**DCL     12855<>CALL    12868<>CALL    12868--CALL    12873<>CALL    12873--CALL
DSTROUTE.FEP#
     12601**DCL     12863>>IF      12864>>IF      12865>>ASSIGN
DSTROUTE.LNSAP
     12685**DCL     12861--ASSIGN
DSTROUTE.LNSAP.ADDRESS_N
     12715**DCL     12716--REDEF
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:158  
DSTROUTE.MYNODE#
     12596**DCL     12598--REDEF
DSTROUTE.NODE#
     12599**DCL     12601--REDEF
DSTROUTE.NSAP.ADDRESS_N
     12659**DCL     12660--REDEF
DSTROUTE.NSAP.LEN
     12631**DCL     12911>>DOINDEX
DSTROUTE.NS_TYPE
     12584**DCL     12879>>IF
DSTROUTE.SNPA.ADDRESS
     12746**DCL     12892>>ASSIGN  12909>>ASSIGN  12916>>ASSIGN
DSTROUTE.SNPA.LEN
     12741**DCL     12889>>IF      12894>>DOINDEX 12915>>ASSIGN
ERRVAL
     12832**DCL     12837--ASSIGN  12838<<ASSIGN  12849--ASSIGN  12850<<ASSIGN  12857<>CALL    12868<>CALL
     12873<>CALL    13037<>CALL    13044<>CALL
EXITOSINET
     12917**LABEL   12899--GOTO    12919--GOTO
E_DSCRD_CONGEST
     11833**DCL     13044<>CALL
E_DSCRD_DSTUNKNWN
     11741**DCL     12857<>CALL    12873<>CALL
E_DSCRD_DSTUNREACH
     11787**DCL     12868<>CALL    13037<>CALL
FIXED
     12769**DCL     12952--ASSIGN  12955--ASSIGN  12959--ASSIGN  12962--ASSIGN  12967--ASSIGN  12969--ASSIGN
     12975--ASSIGN  12978--ASSIGN  12984--ASSIGN  12987--ASSIGN  12993--ASSIGN  12996--ASSIGN  12999--ASSIGN
     13006--ASSIGN  13009--ASSIGN  13013--ASSIGN  13016--IF      13017--ASSIGN  13028--CALL    13034--ASSIGN
     13037<>CALL    13037--CALL
FIXED.CHECKSUMX
     12805**DCL     12936<<ASSIGN  13029>>IF      13029<<ASSIGN
FIXED.CHECKSUMY
     12808**DCL     12937<<ASSIGN  13030>>IF      13030<<ASSIGN
FIXED.ER
     12791**DCL     12934<<ASSIGN
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:159  
FIXED.LENGTH
     12775**DCL     12943<<ASSIGN  12944>>ASSIGN  13016>>IF      13019>>ASSIGN  13024>>ASSIGN
FIXED.LIFETIME
     12779**DCL     12938<<ASSIGN
FIXED.MS
     12787**DCL     12935<<ASSIGN
FIXED.PROTOCOLID
     12773**DCL     12931<<ASSIGN
FIXED.SEGLENX
     12797**DCL     12945<<ASSIGN
FIXED.SEGLENY
     12801**DCL     12946<<ASSIGN
FIXED.SP
     12784**DCL     12933<<ASSIGN
FIXED.TYPE
     12795**DCL     12940<<ASSIGN  12942<<ASSIGN
FIXED.VERSION
     12777**DCL     12932<<ASSIGN
FPT_NSAP
     12434**DCL     12917--ASSIGN
FPT_NSAP.NSAP.ADDRESS
     12488**DCL     12916<<ASSIGN
FPT_NSAP.NSAP.ADDRESS_N
     12487**DCL     12488--REDEF
FPT_NSAP.NSAP.LEN
     12459**DCL     12915<<ASSIGN
GHE$ERRLOG
     11508**DCL-ENT 12857--CALL    12868--CALL    12873--CALL    13037--CALL    13044--CALL
I
     12830**DCL     12894<<DOINDEX 12895>>IF      12895>>IF      12911<<DOINDEX 12912>>IF      12912>>IF
J
     12831**DCL     12887<<DOINDEX 12888>>ASSIGN  12906<<DOINDEX 12907>>ASSIGN
K$NPDU_FIXED
     11894**DCL     12929--ASSIGN  12943--ASSIGN  13044<>CALL    13044--CALL
K$NPDU_FIXED.ER
     11916**DCL     12839>>IF
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:160  
K$NPDU_FIXED.TYPE
     11920**DCL     12839>>IF
KN$NETPARM
     11523**DCL        19--PROC    12846--ENTRY   13042<>CALL
KN$NETPARM.DST_ADDR$
     11657**DCL     12003--IMP-PTR 12855>>CALL    12857>>CALL    12943>>ASSIGN  12955>>ASSIGN  12955>>ASSIGN
     12955>>ASSIGN  12956>>ASSIGN  12959>>ASSIGN  12959>>ASSIGN  12959>>ASSIGN  12960>>ASSIGN
KN$NETPARM.ERRCODE
     11630**DCL     12999--ASSIGN  13043>>IF
KN$NETPARM.FPT$
     11642**DCL     12917<<ASSIGN
KN$NETPARM.LDCT$
     11524**DCL     12898<<ASSIGN  12918<<ASSIGN  13036>>IF
KN$NETPARM.MSG$
     11530**DCL     11535--REDEF
KN$NETPARM.NHDR$
     11582**DCL     11583--REDEF   11894--IMP-PTR 12839>>IF      12839>>IF      13013>>ASSIGN  13034<<ASSIGN
     13044>>CALL
KN$NETPARM.NHDRSZ
     11588**DCL     13035<<ASSIGN
KN$NETPARM.RECTYPE
     11609**DCL     12841>>ASSIGN
KN$NETPARM.SHDR$
     11560**DCL     11561--REDEF
KN$NETPARM.SHDRSZ
     11566**DCL     13021<<ASSIGN
KN$NETPARM.SRC_ADDR$
     11652**DCL     12055--IMP-PTR 12861<<ASSIGN  12943>>ASSIGN  12952>>ASSIGN  12952>>ASSIGN  12952>>ASSIGN
     12953>>ASSIGN  12962>>ASSIGN  12962>>ASSIGN  12962>>ASSIGN  12963>>ASSIGN
KN$NETPARM.THDR$
     11571**DCL     11572--REDEF
KN$NETPARM.THDRSZ
     11577**DCL     12851>>ASSIGN  13020<<ASSIGN
KN$NETPARM.UHDR$
     11546**DCL     11547--REDEF
KN$NETPARM.UHDRSZ
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:161  
     11555**DCL     13033<<ASSIGN
KNA$CALC_CHKSUM
     11504**DCL-ENT 13028--CALL
KNH$SEND
     11506**DCL-ENT 13042--CALL
KNN$DECODE_NSAP
     11505**DCL-ENT 12855--CALL
KNN$LINK.DEST.ADDRESS_N
     12279**DCL     12280--REDEF
KNN$LINK.FLAGS.VIRCIR
     12137**DCL     12889>>IF      12908>>IF
KNN$LINK.LADR.ADDRESS_N
     12222**DCL     12223--REDEF
KNN$LINK.LDCT$
     12093**DCL     12100--REDEF   12867>>IF      12898>>ASSIGN  12918>>ASSIGN
KNN$LINK.NODE#
     12108**DCL     12889>>IF      12908>>IF
KNN$LINK.SNPA.ADDRESS
     12315**DCL     12893>>ASSIGN  12910>>ASSIGN
KNN$LINK.SNPA.LEN
     12310**DCL     12889>>IF      12911>>DOINDEX
KNN$LINK$
     12415**DCL     12888>>ASSIGN  12907>>ASSIGN
KNN$ROUTE.CURRENT_QOS
     12361**DCL     12867>>IF
KNN$ROUTE.LINK$
     12344**DCL     12866>>ASSIGN
KNN$ROUTE$
     12414**DCL     12865>>ASSIGN
KNN$SENDERR
        19**PROC    12837--ASSIGN
KNN$SENDOSI
     12846**ENTRY   12849--ASSIGN
KNN_CHECKSUM
     11875**DCL     13027>>IF
KNN_DATAID
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:162  
     11876**DCL     12965<<ASSIGN  12965>>ASSIGN  12967--ASSIGN  12969--ASSIGN
KNN_LIFETIME
     11874**DCL     12938>>ASSIGN
KNN_LINK$$
     11870**DCL     12415--IMP-PTR 12888>>ASSIGN  12907>>ASSIGN
KNN_LINKS
     11869**DCL     12887>>DOINDEX 12906>>DOINDEX
KNN_NODES
     11866**DCL     12864>>IF
KNN_ROUTE$$
     11868**DCL     12414--IMP-PTR 12865>>ASSIGN
KN_NODE#
     11867**DCL     12863>>IF
LINK$
     12825**DCL     12092--IMP-PTR 12866<<ASSIGN  12867>>IF      12888<<ASSIGN  12889>>IF      12889>>IF
     12889>>IF      12893>>ASSIGN  12898>>ASSIGN  12907<<ASSIGN  12908>>IF      12908>>IF      12910>>ASSIGN
     12911>>DOINDEX 12918>>ASSIGN
NXTJ
     12894**LABEL   12896--GOTO
NXTJ2
     12917**LABEL   12913--GOTO
PRTCLERR
     11692**DCL     12880<>CALL
ROUTE$
     12826**DCL     12343--IMP-PTR 12865<<ASSIGN  12866>>ASSIGN  12867>>IF
SCREECH
     11507**DCL-ENT 12880--CALL
SEGMENT
     12508**DCL     12943--ASSIGN
SENDINGERR
     12829**DCL     12836<<ASSIGN  12848<<ASSIGN  12939>>IF      12943>>ASSIGN  12951>>IF      12990>>IF
SIZE
     12822**DCL     12416--IMP-SIZ 12841<<ASSIGN  12851<<ASSIGN  12944>>ASSIGN  12952>>ASSIGN  12952>>ASSIGN
     12955>>ASSIGN  12955>>ASSIGN  12959>>ASSIGN  12959>>ASSIGN  12962>>ASSIGN  12962>>ASSIGN  12967>>ASSIGN
     12967>>ASSIGN  12969>>ASSIGN  12969>>ASSIGN  12975>>ASSIGN  12978>>ASSIGN  12984>>ASSIGN  12984>>ASSIGN
     12987>>ASSIGN  12987>>ASSIGN  12993>>ASSIGN  12996>>ASSIGN  12999>>ASSIGN  12999>>ASSIGN  13004>>IF
PL6.E3A0      #002=KNN$SENDERR File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:06 Page:163  
     13005<<ASSIGN  13006>>ASSIGN  13009>>ASSIGN  13009--ASSIGN  13009>>ASSIGN  13013>>ASSIGN  13013>>ASSIGN
     13013>>ASSIGN  13013>>ASSIGN  13014>>ASSIGN  13016>>IF      13017<<ASSIGN  13019<<ASSIGN  13019>>ASSIGN
     13024<<ASSIGN  13028<>CALL    13035>>ASSIGN
SNPATMPLT1
     12812**DCL     12813--REDEF   12892<<ASSIGN  12909<<ASSIGN
SNPATMPLT2.NIBBLES.NIB
     12815**DCL     12895>>IF      12912>>IF
SNPATMPLT3
     12817**DCL     12818--REDEF   12893<<ASSIGN  12910<<ASSIGN
SNPATMPLT4.NIBBLES.NIB
     12820**DCL     12895>>IF      12912>>IF
SOURCE
     12055**DCL     12952--ASSIGN  12962--ASSIGN
SOURCE.ADDRESS_N
     12087**DCL     12088--REDEF
SOURCE.LEN
     12059**DCL     12943>>ASSIGN  12952>>ASSIGN  12952>>ASSIGN  12953>>ASSIGN  12962>>ASSIGN  12962>>ASSIGN
     12963>>ASSIGN
TSIZE
     12823**DCL     12944<<ASSIGN  12945>>ASSIGN  12946>>ASSIGN  12984--ASSIGN  12987--ASSIGN

PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:164  
     1038        1        /*T***********************************************************/
     1039        2        /*T*                                                         */
     1040        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1041        4        /*T*                                                         */
     1042        5        /*T***********************************************************/
     1043        6        %EJECT;
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:165  
     1044        7
     1045        8        KNN$DECODE_NSAP: PROC(NSAP,ROUTE) ALTRET;
     1046        9        /*X* PLM=3,IND=3,ENU=0,ECU=0,CRM=70,CCC=YES,CSI=3,CTI=2,DCI=3,ECI=3,ENI=3,SDI=3 */
     1047       10        /*P*    NAME:   KNN$DECODE_NSAP
     1048       11                PURPOSE: This module contains the procedure to decode network layer
     1049       12                         NSAP addresses.
     1050       13        */
     1051       14
     1052       15
     1053       16        /*F*  NAME:    KNN$DECODE_NSAP
     1054       17
     1055       18              PURPOSE: Decodes nsap addresses as defined in iso8648 ad2.
     1056       19              DESCRIPTION: The routine first compares the nsap address to
     1057       20                      the list of network entity titles defined for this cp6
     1058       21                      network.  If a match is found the fep# and host# are
     1059       22                      returned.  If no match is found then the osiroute table
     1060       23                      is searched.  If a match is found the fep# of the boundry
     1061       24                      cp6 node is returned and the host# is set to 255.
     1062       25                      If no match is found then we do not know about this address
     1063       26                      yet and the altreturn is taken.
     1064       27        */
     1065       28
     1066       29
     1067       30        %INCLUDE KL_MACRO_C;
     1068     3382        %INCLUDE K_ADDRESS_M;
     1069     3885        %INCLUDE KNH_MACRO_C;
     1070     4168        %INCLUDE KNN_NETWORK_M;
     1071     4531
     1072     4532        %KL_UPDOSI(FPTN=ROUTE,STCLASS="");
     1073     4741        %K$NSAP(FPTN=NSAP,ADRTYP=NET,STCLASS="");
     1074     4793
     1075     4794    1   DCL KNN_OSIROUTE$$ PTR SYMREF;
     1076     4795    1   DCL KNN_OSIMAX# UBIN SYMREF;
     1077     4796
     1078     4797    1   DCL KNN_LINKS UBIN SYMREF;
     1079     4798    1   DCL KNN_ROUTE$$ PTR SYMREF;
     1080     4799    1   DCL KNN_NODES UBIN SYMREF;
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:166  
     1081     4800    1   DCL KN_NODE# UBIN SYMREF;
     1082     4801
     1083     4802    1   DCL KNN$ROUTE$(0:0) PTR BASED(KNN_ROUTE$$);
     1084     4803    1   DCL KNN$OSIROUTE$(0:0) PTR BASED(KNN_OSIROUTE$$);
     1085     4804        %KNN$OSIROUTE(STCLASS="BASED(OSI$)");
     1086     5021
     1087     5022        %KNN$ROUTE(STCLASS="BASED(ROUTE$)");
     1088     5094    1   DCL ADDRESS CHAR(100) BASED;
     1089     5095
     1090     5096    1   DCL ROUTE$ PTR;
     1091     5097    1   DCL OSI$ PTR;
     1092     5098    1   DCL NET$ PTR;
     1093     5099    1   DCL I UBIN;
     1094     5100    1   DCL J UBIN;
     1095     5101    1   DCL FOUNDONE BIT(1);
     1096     5102    1   DCL INDX(0:10) UBIN;
     1097     5103    1   DCL INX UBIN;
     1098     5104    1   DCL L UBIN;
     1099     5105    1   DCL NQOS UBIN;
     1100     5106    1   DCL CQOS UBIN;
     1101     5107    1   DCL SVINDX SBIN;
     1102     5108    1   DCL DSPLEN SBIN;
     1103     5109    1   DCL MINLEN SBIN;
     1104     5110    1   DCL PADCHAR UBIN(4);
     1105     5111    1   DCL STRPDS BIT(1);                      /* strip leading zeros      */
     1106     5112    1   DCL 1 NETADDR(0:39) ALIGNED,
     1107     5113    1          2 DIGIT UBIN(4) UNAL;
     1108     5114
     1109     5115
     1110     5116    1      FOUNDONE = '0'B;
     1111     5117
     1112     5118    2      DO I = 0 TO KNN_OSIMAX#-1;
     1113     5119    2         OSI$ = KNN$OSIROUTE$(I);
     1114     5120    2         IF NSAP.AFI = KNN$OSIROUTE.NSAP.AFI AND
     1115     5121    2           NSAP.LEN = KNN$OSIROUTE.NSAP.LEN AND
     1116     5122    2           SUBSTR(ADDR(NSAP)->ADDRESS,1,NSAP.LEN) =
     1117     5123    3           SUBSTR(ADDR(KNN$OSIROUTE.NSAP)->ADDRESS,1,KNN$OSIROUTE.NSAP.LEN) THEN DO;
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:167  
     1118     5124        /*
     1119     5125             if this address is a local nsap then get the destination host and fep
     1120     5126             numbers from the route table and return.
     1121     5127        */
     1122     5128    3            ROUTE.NS_TYPE = KNN$OSIROUTE.NS_TYPE;
     1123     5129    4            IF KNN$OSIROUTE.NS_TYPE = %K_TYPE_LNSAP THEN DO;
     1124     5130    4               ROUTE.FEP# = KNN$OSIROUTE.LINK.FEP#(0);
     1125     5131    4               ROUTE.HOST# = KNN$OSIROUTE.LINK.HOST#(0);
     1126     5132    4               IF ROUTE.HOST# > KNN_NODES
     1127     5133    4                 OR KNN$ROUTE$(ROUTE.HOST#)->KNN$ROUTE.LINK$ = ADDR(NIL)
     1128     5134    5                 OR KNN$ROUTE$(ROUTE.HOST#)->KNN$ROUTE.CURRENT_QOS = 255 THEN DO;
     1129     5135    5                  ROUTE.QOS = 255;
     1130     5136    5                  RETURN;
     1131     5137    5                  END;
     1132     5138
     1133     5139    5               IF ROUTE.FEP# = KN_NODE# THEN DO;
     1134     5140    5                  ROUTE.QOS = KNN$ROUTE$(ROUTE.HOST#)->KNN$ROUTE.CURRENT_QOS;
     1135     5141    5                  RETURN;
     1136     5142    5                  END;
     1137     5143
     1138     5144    4               END;                        /* if lnsap                 */
     1139     5145    4            ELSE DO;                  /* else it must be a remote nsap */
     1140     5146    4               J = 0;
     1141     5147    4               INX = 0;
     1142     5148    5               DO WHILE J < KNN_LINKS;
     1143     5149    6                  IF KNN$OSIROUTE.LINK.ACTIVE(J) THEN DO;
     1144     5150        /*
     1145     5151                      does a connection to this rnsap exist on this fep?
     1146     5152        */
     1147     5153    7                     IF KNN$OSIROUTE.LINK.FEP#(J) = KN_NODE# THEN DO;
     1148     5154    7                        ROUTE.FEP# = KNN$OSIROUTE.LINK.FEP#(J);
     1149     5155    7                        ROUTE.QOS = KNN$OSIROUTE.LINK.QOS(J);
     1150     5156    7                        ROUTE.SNPA = KNN$OSIROUTE.SNPA;
     1151     5157    7                        ROUTE.LNSAP = KNN$OSIROUTE.LNSAP;
     1152     5158    7                        ROUTE.NW_TYPE = KNN$OSIROUTE.NW_TYPE;
     1153     5159    7                        RETURN;
     1154     5160    7                        END; /* connection to rnsap exists on this fep */
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:168  
     1155     5161    6                     INDX(INX) = J;
     1156     5162    6                     INX = INX + 1;
     1157     5163    6                     END;
     1158     5164    5                  J = J+1;
     1159     5165    5                  END;                     /* do while j<knn_links*/
     1160     5166    5               IF INX > 0 THEN DO;    /* one or more possible routes   */
     1161     5167    5                  CQOS = 255;
     1162     5168    5                  SVINDX = -1;
     1163     5169    6                  DO J = 0 TO INX-1;
     1164     5170    6                     L = INDX(J);
     1165     5171    6                     IF (KNN$OSIROUTE.LINK.FEP#(L) < KNN_NODES AND
     1166     5172    6                       KNN$ROUTE$(KNN$OSIROUTE.LINK.FEP#(L))->KNN$ROUTE.LINK$ ~= ADDR(
              5172                                NIL)) OR
     1167     5173    7                       KNN$OSIROUTE.LINK.FEP#(L) = KN_NODE# THEN DO;
     1168     5174    7                        IF KNN$OSIROUTE.LINK.FEP#(L) = KN_NODE# THEN
     1169     5175    7                           NQOS = KNN$OSIROUTE.LINK.QOS(L);
     1170     5176    7                        ELSE
     1171     5177    7                           NQOS = KNN$ROUTE$(KNN$OSIROUTE.LINK.FEP#(L))->KNN$ROUTE.
              5177                                    CURRENT_QOS;
     1172     5178    8                        IF NQOS < CQOS THEN DO;
     1173     5179    8                           SVINDX = J;
     1174     5180    8                           CQOS = NQOS;
     1175     5181    8                           END;
     1176     5182    7                        END;               /* if node# < knn_nodes ...*/
     1177     5183    6                     END;                  /* do j = 0 to inx-1        */
     1178     5184    5                  END;                     /* if inx > 0               */
     1179     5185
     1180     5186    5               IF SVINDX = -1 THEN DO;
     1181     5187    5                  ROUTE.QOS = 255; /* sorry no route is currently available */
     1182     5188    5                  RETURN;
     1183     5189    5                  END;
     1184     5190    5               ELSE DO;
     1185     5191    5                  ROUTE.FEP# = KNN$OSIROUTE.LINK.FEP#(SVINDX);
     1186     5192    5                  ROUTE.QOS = CQOS;
     1187     5193    5                  RETURN;
     1188     5194    5                  END;
     1189     5195    4               END;                        /* else type = rnsap        */
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:169  
     1190     5196    3            END;                           /* if nsap et al            */
     1191     5197    2         END;                              /* do i                     */
     1192     5198    1      IF NOT FOUNDONE THEN ALTRETURN;
     1193     5199    1   END KNN$DECODE_NSAP;
     1194     5200        %EOD;

PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:170  
--  Include file information  --

   KNN_NETWORK_M.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KNN$DECODE_NSAP.

   Procedure KNN$DECODE_NSAP requires 393 words for executable code.
   Procedure KNN$DECODE_NSAP requires 87 words of local(AUTO) storage.

PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:171  

 Object Unit name= KNN$DECODE_NSAP                            File name= KNN$SUBS.:E05TOU
 UTS= JUL 30 '97 01:08:01.72 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none   393    189  KNN$DECODE_NSAP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        2  KNN$DECODE_NSAP

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X6A_AUTO_2
                       nStd      0 X6A_ARET
                       nStd      0 X6A_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KNN_OSIROUTE$$                        KNN_OSIMAX#                           KNN_LINKS
     KNN_ROUTE$$                           KNN_NODES                             KN_NODE#
r    G$ROS$
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:172  


     1038        1        /*T***********************************************************/
     1039        2        /*T*                                                         */
     1040        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1041        4        /*T*                                                         */
     1042        5        /*T***********************************************************/
     1043        6        %EJECT;
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:173  
     1044        7
     1045        8        KNN$DECODE_NSAP: PROC(NSAP,ROUTE) ALTRET;

      8   0 000000  D380 0000 0000  xent KNN$DECODE_NSAP LNJ,B5   X6A_AUTO_2
          0 000003       0057 0002                       DC       87,2

     1046        9        /*X* PLM=3,IND=3,ENU=0,ECU=0,CRM=70,CCC=YES,CSI=3,CTI=2,DCI=3,ECI=3,ENI=3,SDI=3 */
     1047       10        /*P*    NAME:   KNN$DECODE_NSAP
     1048       11                PURPOSE: This module contains the procedure to decode network layer
     1049       12                         NSAP addresses.
     1050       13        */
     1051       14
     1052       15
     1053       16        /*F*  NAME:    KNN$DECODE_NSAP
     1054       17
     1055       18              PURPOSE: Decodes nsap addresses as defined in iso8648 ad2.
     1056       19              DESCRIPTION: The routine first compares the nsap address to
     1057       20                      the list of network entity titles defined for this cp6
     1058       21                      network.  If a match is found the fep# and host# are
     1059       22                      returned.  If no match is found then the osiroute table
     1060       23                      is searched.  If a match is found the fep# of the boundry
     1061       24                      cp6 node is returned and the host# is set to 255.
     1062       25                      If no match is found then we do not know about this address
     1063       26                      yet and the altreturn is taken.
     1064       27        */
     1065       28
     1066       29
     1067       30        %INCLUDE KL_MACRO_C;
     1068     3382        %INCLUDE K_ADDRESS_M;
     1069     3885        %INCLUDE KNH_MACRO_C;
     1070     4168        %INCLUDE KNN_NETWORK_M;
     1071     4531
     1072     4532        %KL_UPDOSI(FPTN=ROUTE,STCLASS="");
     1073     4741        %K$NSAP(FPTN=NSAP,ADRTYP=NET,STCLASS="");
     1074     4793
     1075     4794    1   DCL KNN_OSIROUTE$$ PTR SYMREF;
     1076     4795    1   DCL KNN_OSIMAX# UBIN SYMREF;
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:174  
     1077     4796
     1078     4797    1   DCL KNN_LINKS UBIN SYMREF;
     1079     4798    1   DCL KNN_ROUTE$$ PTR SYMREF;
     1080     4799    1   DCL KNN_NODES UBIN SYMREF;
     1081     4800    1   DCL KN_NODE# UBIN SYMREF;
     1082     4801
     1083     4802    1   DCL KNN$ROUTE$(0:0) PTR BASED(KNN_ROUTE$$);
     1084     4803    1   DCL KNN$OSIROUTE$(0:0) PTR BASED(KNN_OSIROUTE$$);
     1085     4804        %KNN$OSIROUTE(STCLASS="BASED(OSI$)");
     1086     5021
     1087     5022        %KNN$ROUTE(STCLASS="BASED(ROUTE$)");
     1088     5094    1   DCL ADDRESS CHAR(100) BASED;
     1089     5095
     1090     5096    1   DCL ROUTE$ PTR;
     1091     5097    1   DCL OSI$ PTR;
     1092     5098    1   DCL NET$ PTR;
     1093     5099    1   DCL I UBIN;
     1094     5100    1   DCL J UBIN;
     1095     5101    1   DCL FOUNDONE BIT(1);
     1096     5102    1   DCL INDX(0:10) UBIN;
     1097     5103    1   DCL INX UBIN;
     1098     5104    1   DCL L UBIN;
     1099     5105    1   DCL NQOS UBIN;
     1100     5106    1   DCL CQOS UBIN;
     1101     5107    1   DCL SVINDX SBIN;
     1102     5108    1   DCL DSPLEN SBIN;
     1103     5109    1   DCL MINLEN SBIN;
     1104     5110    1   DCL PADCHAR UBIN(4);
     1105     5111    1   DCL STRPDS BIT(1);                      /* strip leading zeros      */
     1106     5112    1   DCL 1 NETADDR(0:39) ALIGNED,
     1107     5113    1          2 DIGIT UBIN(4) UNAL;
     1108     5114
     1109     5115
     1110     5116    1      FOUNDONE = '0'B;

   5116   0 000005  8747 0010                            CL       FOUNDONE,AUTO

PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:175  
     1111     5117
     1112     5118    2      DO I = 0 TO KNN_OSIMAX#-1;

   5118   0 000007  8747 000E                            CL       I,AUTO
          0 000009  0F81 016E                            B        s:5197+2,PREL

     1113     5119    2         OSI$ = KNN$OSIROUTE$(I);

   5119   0 00000B  EC80 0000 0000  xsym                 LDB,B6   KNN_OSIROUTE$$
          0 00000E  B847 000E                            LDR,R3   I,AUTO
          0 000010  DCB6                                 LDB,B5   ,B6,R3
          0 000011  DFC7 000A                            STB,B5   OSI$,AUTO

     1114     5120    2         IF NSAP.AFI = KNN$OSIROUTE.NSAP.AFI AND

   5120   0 000013  8CC7 0004                            LDI      @NSAP,AUTO
          0 000015  A856                                 LDR,R2   R6
          0 000016  E570 7FFF                            AND,R6   32767,IMO
          0 000018  8D47 004E                            SDI      SVINDX+46,AUTO
          0 00001A  CCC7 004E                            LDB,B4   SVINDX+46,AUTO
          0 00001C  204F                                 SOR,R2   15
          0 00001D  2E01                                 ADV,R2   1
          0 00001E  D2A4                                 LLH,R5   ,B4,R2
          0 00001F  C805                                 LDR,R4   ,B5
          0 000020  C570 00FF                            AND,R4   255,IMO
          0 000022  D954                                 CMR,R5   R4
          0 000023  0981 0152                            BNE      s:5197,PREL
          0 000025  8CC7 0004                            LDI      @NSAP,AUTO
          0 000027  A856                                 LDR,R2   R6
          0 000028  E570 7FFF                            AND,R6   32767,IMO
          0 00002A  8D47 0050                            SDI      SVINDX+48,AUTO
          0 00002C  BCC7 0050                            LDB,B3   SVINDX+48,AUTO
          0 00002E  204F                                 SOR,R2   15
          0 00002F  D2A3                                 LLH,R5   ,B3,R2
          0 000030  C285                                 LLH,R4   ,B5
          0 000031  D954                                 CMR,R5   R4
          0 000032  0981 0143                            BNE      s:5197,PREL
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:176  
          0 000034  8CC7 0004                            LDI      @NSAP,AUTO
          0 000036  A856                                 LDR,R2   R6
          0 000037  E570 7FFF                            AND,R6   32767,IMO
          0 000039  8D47 0052                            SDI      SVINDX+50,AUTO
          0 00003B  ACC7 0052                            LDB,B2   SVINDX+50,AUTO
          0 00003D  204F                                 SOR,R2   15
          0 00003E  8CC7 0004                            LDI      @NSAP,AUTO
          0 000040  9856                                 LDR,R1   R6
          0 000041  E570 7FFF                            AND,R6   32767,IMO
          0 000043  8D47 0054                            SDI      SVINDX+52,AUTO
          0 000045  9CC7 0054                            LDB,B1   SVINDX+52,AUTO
          0 000047  104F                                 SOR,R1   15
          0 000048  D291                                 LLH,R5   ,B1,R1
          0 000049  C285                                 LLH,R4   ,B5
          0 00004A  CF47 0056                            STR,R4   SVINDX+54,AUTO
          0 00004C  C855                                 LDR,R4   R5
          0 00004D  D847 0056                            LDR,R5   SVINDX+54,AUTO
          0 00004F  DA70 2000                            ADD,R5   8192,IMO
          0 000051  0022                                 ACM      ;
          0 000052       C022 0000                                ALPHANUM(0,B2,R2,1,R4,FILL),;
          0 000054       C005 0000                                ALPHANUM(0,B5,1,R5,FILL)
          0 000056  5301 011F                            CBNE     s:5197,PREL

     1115     5121    2           NSAP.LEN = KNN$OSIROUTE.NSAP.LEN AND
     1116     5122    2           SUBSTR(ADDR(NSAP)->ADDRESS,1,NSAP.LEN) =
     1117     5123    3           SUBSTR(ADDR(KNN$OSIROUTE.NSAP)->ADDRESS,1,KNN$OSIROUTE.NSAP.LEN) THEN DO;

     1118     5124        /*
     1119     5125             if this address is a local nsap then get the destination host and fep
     1120     5126             numbers from the route table and return.
     1121     5127        */
     1122     5128    3            ROUTE.NS_TYPE = KNN$OSIROUTE.NS_TYPE;

   5128   0 000058  ECC7 0006                            LDB,B6   @ROUTE,AUTO
          0 00005A  C845 001A                            LDR,R4   26,B5
          0 00005C  4048                                 SOR,R4   8
          0 00005D  CA86                                 SRM,R4,'00F0'X    ,B6
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:177  
          0 00005E       00F0

     1123     5129    4            IF KNN$OSIROUTE.NS_TYPE = %K_TYPE_LNSAP THEN DO;

   5129   0 00005F  E845 001A                            LDR,R6   26,B5
          0 000061  604C                                 SOR,R6   12
          0 000062  6D01                                 CMV,R6   1
          0 000063  0981 0049                            BNE      s:5146,PREL

     1124     5130    4               ROUTE.FEP# = KNN$OSIROUTE.LINK.FEP#(0);

   5130   0 000065  C2C5 001B                            LLH,R4   27,B5
          0 000067  CAC6 0001                            SRM,R4,'00FF'X    1,B6
          0 000069       00FF

     1125     5131    4               ROUTE.HOST# = KNN$OSIROUTE.LINK.HOST#(0);

   5131   0 00006A  E845 001B                            LDR,R6   27,B5
          0 00006C  E570 00FF                            AND,R6   255,IMO
          0 00006E  E7C6 0001                            STH,R6   1,B6

     1126     5132    4               IF ROUTE.HOST# > KNN_NODES

   5132   0 000070  E2C6 0001                            LLH,R6   1,B6
          0 000072  E900 0000 0000  xsym                 CMR,R6   KNN_NODES
          0 000075  0301 0017                            BG       s:5135,PREL
          0 000077  A856                                 LDR,R2   R6
          0 000078  EC80 0000 0000  xsym                 LDB,B6   KNN_ROUTE$$
          0 00007B  DCA6                                 LDB,B5   ,B6,R2
          0 00007C  8D85                                 CMN      ,B5
          0 00007D  0901 000F                            BE       s:5135,PREL
          0 00007F  ECC7 0006                            LDB,B6   @ROUTE,AUTO
          0 000081  92C6 0001                            LLH,R1   1,B6
          0 000083  DC80 0000 0000  xsym                 LDB,B5   KNN_ROUTE$$
          0 000086  EC95                                 LDB,B6   ,B5,R1
          0 000087  C846 0005                            LDR,R4   5,B6
          0 000089  C970 00FF                            CMR,R4   255,IMO
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:178  
          0 00008B  0981 0009                            BNE      s:5139,PREL

     1127     5133    4                 OR KNN$ROUTE$(ROUTE.HOST#)->KNN$ROUTE.LINK$ = ADDR(NIL)
     1128     5134    5                 OR KNN$ROUTE$(ROUTE.HOST#)->KNN$ROUTE.CURRENT_QOS = 255 THEN DO;

     1129     5135    5                  ROUTE.QOS = 255;

   5135   0 00008D  ECC7 0006                            LDB,B6   @ROUTE,AUTO
          0 00008F  8946 0002                            LBT,'00FF'X       2,B6
          0 000091       00FF

     1130     5136    5                  RETURN;

   5136   0 000092  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1131     5137    5                  END;
     1132     5138
     1133     5139    5               IF ROUTE.FEP# = KN_NODE# THEN DO;

   5139   0 000095  ECC7 0006                            LDB,B6   @ROUTE,AUTO
          0 000097  C846 0001                            LDR,R4   1,B6
          0 000099  C570 00FF                            AND,R4   255,IMO
          0 00009B  C900 0000 0000  xsym                 CMR,R4   KN_NODE#
          0 00009E  0981 00D7                            BNE      s:5197,PREL

     1134     5140    5                  ROUTE.QOS = KNN$ROUTE$(ROUTE.HOST#)->KNN$ROUTE.CURRENT_QOS;

   5140   0 0000A0  92C6 0001                            LLH,R1   1,B6
          0 0000A2  EC95                                 LDB,B6   ,B5,R1
          0 0000A3  C846 0005                            LDR,R4   5,B6
          0 0000A5  ECC7 0006                            LDB,B6   @ROUTE,AUTO
          0 0000A7  CAC6 0002                            SRM,R4,'00FF'X    2,B6
          0 0000A9       00FF

     1135     5141    5                  RETURN;

   5141   0 0000AA  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:179  

     1136     5142    5                  END;
     1137     5143
     1138     5144    4               END;                        /* if lnsap                 */
     1139     5145    4            ELSE DO;                  /* else it must be a remote nsap */

     1140     5146    4               J = 0;

   5146   0 0000AD  8747 000F                            CL       J,AUTO

     1141     5147    4               INX = 0;

   5147   0 0000AF  8747 001C                            CL       INX,AUTO

     1142     5148    5               DO WHILE J < KNN_LINKS;

   5148   0 0000B1  C847 000F                            LDR,R4   J,AUTO
          0 0000B3  C900 0000 0000  xsym                 CMR,R4   KNN_LINKS
          0 0000B6  0281 004A                            BGE      s:5166,PREL

     1143     5149    6                  IF KNN$OSIROUTE.LINK.ACTIVE(J) THEN DO;

   5149   0 0000B8  ECC7 000A                            LDB,B6   OSI$,AUTO
          0 0000BA  DBC6 001A                            LAB,B5   26,B6
          0 0000BC  B847 000F                            LDR,R3   J,AUTO
          0 0000BE  3F78                                 MLV,R3   120
          0 0000BF  3E08                                 ADV,R3   8
          0 0000C0  82B5                                 LB       ,B5,R3
          0 0000C1  0581 0036                            BBF      s:5164,PREL

     1144     5150        /*
     1145     5151                      does a connection to this rnsap exist on this fep?
     1146     5152        */
     1147     5153    7                     IF KNN$OSIROUTE.LINK.FEP#(J) = KN_NODE# THEN DO;

   5153   0 0000C3  A847 000F                            LDR,R2   J,AUTO
          0 0000C5  2F0F                                 MLV,R2   15
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:180  
          0 0000C6  2E36                                 ADV,R2   54
          0 0000C7  E2A6                                 LLH,R6   ,B6,R2
          0 0000C8  E900 0000 0000  xsym                 CMR,R6   KN_NODE#
          0 0000CB  0981 0024                            BNE      s:5161,PREL

     1148     5154    7                        ROUTE.FEP# = KNN$OSIROUTE.LINK.FEP#(J);

   5154   0 0000CD  DCC7 0006                            LDB,B5   @ROUTE,AUTO
          0 0000CF  EAC5 0001                            SRM,R6,'00FF'X    1,B5
          0 0000D1       00FF

     1149     5155    7                        ROUTE.QOS = KNN$OSIROUTE.LINK.QOS(J);

   5155   0 0000D2  9847 000F                            LDR,R1   J,AUTO
          0 0000D4  1F0F                                 MLV,R1   15
          0 0000D5  1E38                                 ADV,R1   56
          0 0000D6  E296                                 LLH,R6   ,B6,R1
          0 0000D7  EAC5 0002                            SRM,R6,'00FF'X    2,B5
          0 0000D9       00FF

     1150     5156    7                        ROUTE.SNPA = KNN$OSIROUTE.SNPA;

   5156   0 0000DA  AB86                                 LAB,B2   ,B6
          0 0000DB  2C16                                 LDV,R2   22
          0 0000DC  6C08                                 LDV,R6   8
          0 0000DD  BB85                                 LAB,B3   ,B5
          0 0000DE  3C34                                 LDV,R3   52
          0 0000DF  0008                                 MMM

     1151     5157    7                        ROUTE.LNSAP = KNN$OSIROUTE.LNSAP;

   5157   0 0000E0  ACC7 000A                            LDB,B2   OSI$,AUTO
          0 0000E2  2C1E                                 LDV,R2   30
          0 0000E3  6C16                                 LDV,R6   22
          0 0000E4  3C1E                                 LDV,R3   30
          0 0000E5  0008                                 MMM

PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:181  
     1152     5158    7                        ROUTE.NW_TYPE = KNN$OSIROUTE.NW_TYPE;

   5158   0 0000E6  CCC7 000A                            LDB,B4   OSI$,AUTO
          0 0000E8  E844 001A                            LDR,R6   26,B4
          0 0000EA  6048                                 SOR,R6   8
          0 0000EB  EA83                                 SRM,R6,'000F'X    ,B3
          0 0000EC       000F

     1153     5159    7                        RETURN;

   5159   0 0000ED  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1154     5160    7                        END; /* connection to rnsap exists on this fep */
     1155     5161    6                     INDX(INX) = J;

   5161   0 0000F0  9847 001C                            LDR,R1   INX,AUTO
          0 0000F2  1E11                                 ADV,R1   17
          0 0000F3  D847 000F                            LDR,R5   J,AUTO
          0 0000F5  DF17                                 STR,R5   ,AUTO,R1

     1156     5162    6                     INX = INX + 1;

   5162   0 0000F6  8AC7 001C                            INC      INX,AUTO

     1157     5163    6                     END;

     1158     5164    5                  J = J+1;

   5164   0 0000F8  8AC7 000F                            INC      J,AUTO

     1159     5165    5                  END;                     /* do while j<knn_links*/

   5165   0 0000FA  E847 000F                            LDR,R6   J,AUTO
          0 0000FC  E900 0000 0000  xsym                 CMR,R6   KNN_LINKS
          0 0000FF  0201 FFB8                            BL       s:5149,PREL

     1160     5166    5               IF INX > 0 THEN DO;    /* one or more possible routes   */
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:182  

   5166   0 000101  E847 001C                            LDR,R6   INX,AUTO
          0 000103  6901 0052                            BEZ,R6   s:5186,PREL

     1161     5167    5                  CQOS = 255;

   5167   0 000105  D870 00FF                            LDR,R5   255,IMO
          0 000107  DF47 001F                            STR,R5   CQOS,AUTO

     1162     5168    5                  SVINDX = -1;

   5168   0 000109  8947 0020                            LBT,'FFFF'X       SVINDX,AUTO
   5168   0 00010B       FFFF

     1163     5169    6                  DO J = 0 TO INX-1;

   5169   0 00010C  8747 000F                            CL       J,AUTO
          0 00010E  0F81 0041                            B        s:5183+2,PREL

     1164     5170    6                     L = INDX(J);

   5170   0 000110  B847 000F                            LDR,R3   J,AUTO
          0 000112  3E11                                 ADV,R3   17
          0 000113  E837                                 LDR,R6   ,AUTO,R3
          0 000114  EF47 001D                            STR,R6   L,AUTO

     1165     5171    6                     IF (KNN$OSIROUTE.LINK.FEP#(L) < KNN_NODES AND

   5171   0 000116  ECC7 000A                            LDB,B6   OSI$,AUTO
          0 000118  A856                                 LDR,R2   R6
          0 000119  2F0F                                 MLV,R2   15
          0 00011A  2E36                                 ADV,R2   54
          0 00011B  D2A6                                 LLH,R5   ,B6,R2
          0 00011C  D900 0000 0000  xsym                 CMR,R5   KNN_NODES
          0 00011F  0281 0009                            BGE      s:5171+19,PREL
          0 000121  9855                                 LDR,R1   R5
          0 000122  DC80 0000 0000  xsym                 LDB,B5   KNN_ROUTE$$
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:183  
          0 000125  CC95                                 LDB,B4   ,B5,R1
          0 000126  8D84                                 CMN      ,B4
          0 000127  0981 0006                            BNE      s:5174,PREL
          0 000129  D900 0000 0000  xsym                 CMR,R5   KN_NODE#
          0 00012C  0981 0021                            BNE      s:5183,PREL

     1166     5172    6                       KNN$ROUTE$(KNN$OSIROUTE.LINK.FEP#(L))->KNN$ROUTE.LINK$ ~= ADDR(
              5172                                NIL)) OR
     1167     5173    7                       KNN$OSIROUTE.LINK.FEP#(L) = KN_NODE# THEN DO;

     1168     5174    7                        IF KNN$OSIROUTE.LINK.FEP#(L) = KN_NODE# THEN

   5174   0 00012E  D900 0000 0000  xsym                 CMR,R5   KN_NODE#
          0 000131  0981 0009                            BNE      s:5177,PREL

     1169     5175    7                           NQOS = KNN$OSIROUTE.LINK.QOS(L);

   5175   0 000133  9856                                 LDR,R1   R6
          0 000134  1F0F                                 MLV,R1   15
          0 000135  1E38                                 ADV,R1   56
          0 000136  C296                                 LLH,R4   ,B6,R1
          0 000137  CF47 001E                            STR,R4   NQOS,AUTO
          0 000139  0F81 000A                            B        s:5178,PREL

     1170     5176    7                        ELSE
     1171     5177    7                           NQOS = KNN$ROUTE$(KNN$OSIROUTE.LINK.FEP#(L))->KNN$ROUTE.
              5177                                    CURRENT_QOS;

   5177   0 00013B  9855                                 LDR,R1   R5
          0 00013C  DC80 0000 0000  xsym                 LDB,B5   KNN_ROUTE$$
          0 00013F  CC95                                 LDB,B4   ,B5,R1
          0 000140  C844 0005                            LDR,R4   5,B4
          0 000142  CF47 001E                            STR,R4   NQOS,AUTO

     1172     5178    8                        IF NQOS < CQOS THEN DO;

   5178   0 000144  C947 001F                            CMR,R4   CQOS,AUTO
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:184  
          0 000146  0281 0007                            BGE      s:5183,PREL

     1173     5179    8                           SVINDX = J;

   5179   0 000148  9847 000F                            LDR,R1   J,AUTO
          0 00014A  9F47 0020                            STR,R1   SVINDX,AUTO

     1174     5180    8                           CQOS = NQOS;

   5180   0 00014C  CF47 001F                            STR,R4   CQOS,AUTO

     1175     5181    8                           END;

     1176     5182    7                        END;               /* if node# < knn_nodes ...*/

     1177     5183    6                     END;                  /* do j = 0 to inx-1        */

   5183   0 00014E  8AC7 000F                            INC      J,AUTO
          0 000150  E847 000F                            LDR,R6   J,AUTO
          0 000152  E947 001C                            CMR,R6   INX,AUTO
          0 000154  0201 FFBB                            BL       s:5170,PREL

     1178     5184    5                  END;                     /* if inx > 0               */

     1179     5185
     1180     5186    5               IF SVINDX = -1 THEN DO;

   5186   0 000156  E847 0020                            LDR,R6   SVINDX,AUTO
          0 000158  6DFF                                 CMV,R6   -1
          0 000159  0981 0009                            BNE      s:5191,PREL

     1181     5187    5                  ROUTE.QOS = 255; /* sorry no route is currently available */

   5187   0 00015B  ECC7 0006                            LDB,B6   @ROUTE,AUTO
          0 00015D  8946 0002                            LBT,'00FF'X       2,B6
          0 00015F       00FF

PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:185  
     1182     5188    5                  RETURN;

   5188   0 000160  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1183     5189    5                  END;
     1184     5190    5               ELSE DO;

     1185     5191    5                  ROUTE.FEP# = KNN$OSIROUTE.LINK.FEP#(SVINDX);

   5191   0 000163  ECC7 000A                            LDB,B6   OSI$,AUTO
          0 000165  B856                                 LDR,R3   R6
          0 000166  3F0F                                 MLV,R3   15
          0 000167  3E36                                 ADV,R3   54
          0 000168  D2B6                                 LLH,R5   ,B6,R3
          0 000169  DCC7 0006                            LDB,B5   @ROUTE,AUTO
          0 00016B  DAC5 0001                            SRM,R5,'00FF'X    1,B5
          0 00016D       00FF

     1186     5192    5                  ROUTE.QOS = CQOS;

   5192   0 00016E  D847 001F                            LDR,R5   CQOS,AUTO
          0 000170  DAC5 0002                            SRM,R5,'00FF'X    2,B5
          0 000172       00FF

     1187     5193    5                  RETURN;

   5193   0 000173  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1188     5194    5                  END;
     1189     5195    4               END;                        /* else type = rnsap        */
     1190     5196    3            END;                           /* if nsap et al            */
     1191     5197    2         END;                              /* do i                     */

   5197   0 000176  8AC7 000E                            INC      I,AUTO
          0 000178  E847 000E                            LDR,R6   I,AUTO
          0 00017A  E900 0000 0000  xsym                 CMR,R6   KNN_OSIMAX#
          0 00017D  0201 FE8D                            BL       s:5119,PREL
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:186  

     1192     5198    1      IF NOT FOUNDONE THEN ALTRETURN;

   5198   0 00017F  89C7 0010                            CMZ      FOUNDONE,AUTO
          0 000181  0801 0004                            BAL      s:5199,PREL

   5198   0 000183  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1193     5199    1   END KNN$DECODE_NSAP;

   5199   0 000186  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     1194     5200        %EOD;

PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:187  
--  Include file information  --

   KNN_NETWORK_M.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KNN$DECODE_NSAP.
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:188  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @NSAP                      6-0-0/w PTR         r     1 @ROUTE
    1F-0-0/w UBIN(16)    r     1 CQOS                      10-0-0/b BIT         r     1 FOUNDONE
     E-0-0/w UBIN(16)    r     1 I                         11-0-0/w UBIN(16)    r     1 INDX(0:10)
    1C-0-0/w UBIN(16)    r     1 INX                        F-0-0/w UBIN(16)    r     1 J
    1D-0-0/w UBIN(16)    r     1 L                         1E-0-0/w UBIN(16)    r     1 NQOS
    *0-0-0/c STRC(176)   r     1 NSAP                       A-0-0/w PTR         r     1 OSI$
    *0-0-0/w STRC(480)   r     1 ROUTE                      8-0-0/w PTR         r     1 ROUTE$
    20-0-0/w SBIN(16)    r     1 SVINDX

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN(16)    r     1 KNN_LINKS                  0-0-0/w UBIN(16)    r     1 KNN_NODES
     0-0-0/w UBIN(16)    r     1 KNN_OSIMAX#                0-0-0/w PTR         r     1 KNN_OSIROUTE$$
     0-0-0/w PTR         r     1 KNN_ROUTE$$                0-0-0/w UBIN(16)    r     1 KN_NODE#

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(100)   r     1 ADDRESS                    0-0-0/w STRC(544)   r     1 KNN$OSIROUTE
     0-0-0/w PTR         r     1 KNN$OSIROUTE$(0:0)
     0-0-0/w STRC(208)   r     1 KNN$ROUTE
     0-0-0/w PTR         r     1 KNN$ROUTE$(0:0)

PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:189  

   Procedure KNN$DECODE_NSAP requires 393 words for executable code.
   Procedure KNN$DECODE_NSAP requires 87 words of local(AUTO) storage.
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:190  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:191  
          MINI XREF LISTING

ADDRESS
      5094**DCL      5120>>IF       5120>>IF
CQOS
      5106**DCL      5167<<ASSIGN   5178>>IF       5180<<ASSIGN   5192>>ASSIGN
FOUNDONE
      5101**DCL      5116<<ASSIGN   5198>>IF
I
      5099**DCL      5118<<DOINDEX  5119>>ASSIGN
INDX
      5102**DCL      5161<<ASSIGN   5170>>ASSIGN
INX
      5103**DCL      5147<<ASSIGN   5161>>ASSIGN   5162<<ASSIGN   5162>>ASSIGN   5166>>IF       5169>>DOINDEX
J
      5100**DCL      5146<<ASSIGN   5148>>DOWHILE  5149>>IF       5153>>IF       5154>>ASSIGN   5155>>ASSIGN
      5161>>ASSIGN   5164<<ASSIGN   5164>>ASSIGN   5169<<DOINDEX  5170>>ASSIGN   5179>>ASSIGN
KNN$OSIROUTE.LINK.ACTIVE
      4992**DCL      5149>>IF
KNN$OSIROUTE.LINK.FEP#
      4997**DCL      5130>>ASSIGN   5153>>IF       5154>>ASSIGN   5171>>IF       5171>>IF       5171>>IF
      5174>>IF       5177>>ASSIGN   5191>>ASSIGN
KNN$OSIROUTE.LINK.HOST#
      5004**DCL      5131>>ASSIGN
KNN$OSIROUTE.LINK.QOS
      5008**DCL      5155>>ASSIGN   5175>>ASSIGN
KNN$OSIROUTE.LNSAP
      4932**DCL      5157>>ASSIGN
KNN$OSIROUTE.LNSAP.ADDRESS_N
      4962**DCL      4963--REDEF
KNN$OSIROUTE.NSAP
      4842**DCL      5120--IF
KNN$OSIROUTE.NSAP.ADDRESS_N
      4872**DCL      4873--REDEF
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:192  
KNN$OSIROUTE.NSAP.AFI
      4849**DCL      5120>>IF
KNN$OSIROUTE.NSAP.LEN
      4844**DCL      5120>>IF       5120>>IF
KNN$OSIROUTE.NS_TYPE
      4973**DCL      5128>>ASSIGN   5129>>IF
KNN$OSIROUTE.NW_TYPE
      4979**DCL      5158>>ASSIGN
KNN$OSIROUTE.SNPA
      4899**DCL      5156>>ASSIGN
KNN$OSIROUTE$
      4803**DCL      5119>>ASSIGN
KNN$ROUTE.CURRENT_QOS
      5041**DCL      5132>>IF       5140>>ASSIGN   5177>>ASSIGN
KNN$ROUTE.LINK$
      5024**DCL      5132>>IF       5171>>IF
KNN$ROUTE$
      4802**DCL      5132>>IF       5132>>IF       5140>>ASSIGN   5171>>IF       5177>>ASSIGN
KNN_LINKS
      4797**DCL      5148>>DOWHILE
KNN_NODES
      4799**DCL      5132>>IF       5171>>IF
KNN_OSIMAX#
      4795**DCL      5118>>DOINDEX
KNN_OSIROUTE$$
      4794**DCL      4803--IMP-PTR  5119>>ASSIGN
KNN_ROUTE$$
      4798**DCL      4802--IMP-PTR  5132>>IF       5132>>IF       5140>>ASSIGN   5171>>IF       5177>>ASSIGN
KN_NODE#
      4800**DCL      5139>>IF       5153>>IF       5171>>IF       5174>>IF
L
      5104**DCL      5170<<ASSIGN   5171>>IF       5171>>IF       5171>>IF       5174>>IF       5175>>ASSIGN
      5177>>ASSIGN
NQOS
      5105**DCL      5175<<ASSIGN   5177<<ASSIGN   5178>>IF       5180>>ASSIGN
NSAP
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:193  
      4757**DCL         8--PROC     5120--IF
NSAP.ADDRESS_N
      4789**DCL      4790--REDEF
NSAP.AFI
      4766**DCL      5120>>IF
NSAP.LEN
      4761**DCL      5120>>IF       5120>>IF
OSI$
      5097**DCL      4820--IMP-PTR  5119<<ASSIGN   5120>>IF       5120>>IF       5120>>IF       5120>>IF
      5128>>ASSIGN   5129>>IF       5130>>ASSIGN   5131>>ASSIGN   5149>>IF       5153>>IF       5154>>ASSIGN
      5155>>ASSIGN   5156>>ASSIGN   5157>>ASSIGN   5158>>ASSIGN   5171>>IF       5171>>IF       5171>>IF
      5174>>IF       5175>>ASSIGN   5177>>ASSIGN   5191>>ASSIGN
ROUTE
      4549**DCL         8--PROC
ROUTE.FEP#
      4589**DCL      5130<<ASSIGN   5139>>IF       5154<<ASSIGN   5191<<ASSIGN
ROUTE.HOST#
      4586**DCL      5131<<ASSIGN   5132>>IF       5132>>IF       5132>>IF       5140>>ASSIGN
ROUTE.LNSAP
      4673**DCL      5157<<ASSIGN
ROUTE.LNSAP.ADDRESS_N
      4703**DCL      4704--REDEF
ROUTE.MYNODE#
      4584**DCL      4586--REDEF
ROUTE.NODE#
      4587**DCL      4589--REDEF
ROUTE.NSAP.ADDRESS_N
      4647**DCL      4648--REDEF
ROUTE.NS_TYPE
      4572**DCL      5128<<ASSIGN
ROUTE.NW_TYPE
      4578**DCL      5158<<ASSIGN
ROUTE.QOS
      4592**DCL      5135<<ASSIGN   5140<<ASSIGN   5155<<ASSIGN   5187<<ASSIGN   5192<<ASSIGN
ROUTE.SNPA
      4727**DCL      5156<<ASSIGN
PL6.E3A0      #003=KNN$DECODE_NSAP File=KNN$SUBS.:E05TSI                         WED 07/30/97 01:08 Page:194  
ROUTE$
      5096**DCL      5023--IMP-PTR
SVINDX
      5107**DCL      5168<<ASSIGN   5179<<ASSIGN   5186>>IF       5191>>ASSIGN

PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:195  
     1195        1        /*T***********************************************************/
     1196        2        /*T*                                                         */
     1197        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1198        4        /*T*                                                         */
     1199        5        /*T***********************************************************/
     1200        6        %EJECT;
PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:196  
     1201        7        KNN$FORWARD: PROC(KN$NETPARM) ALTRET;
     1202        8
     1203        9        %INCLUDE LCP_6;
     1204     4288        %INCLUDE K_NETWORK_M;
     1205     4557        %INCLUDE K_NETWORK_E;
     1206     4646        %INCLUDE KNH_MACRO_C;
     1207     4929        %INCLUDE K_ADDRESS_M;
     1208     5432        %INCLUDE K_SCODE_C;
     1209     5517        %INCLUDE KNN_NETWORK_M;
     1210     5880        %INCLUDE KN_DATA_M;
     1211     7666        %INCLUDE K_INTERFACE_M;
     1212     8075        %INCLUDE KL_MACRO_C;
     1213    11427        %INCLUDE KL_ERRORS_C;
     1214    11469        %INCLUDE KN_ERRORS_C;
     1215    11533
     1216    11534    1   DCL KNN$SENDERR ENTRY(1) ALTRET;
     1217    11535    1   DCL KNA$CHK_CHKSUM ENTRY(2) ALTRET;
     1218    11536    1   DCL KNA$CALC_CHKSUM ENTRY(3) ALTRET;
     1219    11537    1   DCL KNT$TRANSPORT ENTRY(1) ALTRET;
     1220    11538    1   DCL KNT$SEND_4HOST ENTRY(1) ALTRET;
     1221    11539    1   DCL KNT$RECV_4HOST ENTRY(1) ALTRET;
     1222    11540    1   DCL KNN$REASSEM ENTRY(1) ALTRET;
     1223    11541    1   DCL KNN$GETOSI ENTRY(1) ALTRET;
     1224    11542    1   DCL KNH$SEND ENTRY(1) ALTRET;
     1225    11543    1   DCL SCREECH ENTRY(1);
     1226    11544    1   DCL GHE$ERRLOG ENTRY(5) ALTRET;
     1227    11545
     1228    11546        %KN$NETPARM(NAME=KN$NETPARM);
     1229    11699
     1230    11700
     1231    11701    1   DCL KNN_NODES UBIN SYMREF;
     1232    11702    1   DCL KN_NODE# UBIN SYMREF;
     1233    11703    1   DCL KNN_ROUTE$$ PTR SYMREF;
     1234    11704    1   DCL KNN_LINKS UBIN SYMREF;
     1235    11705    1   DCL KNN_LINK$$ PTR SYMREF;
     1236    11706    1   DCL KNN_OSIROUTE$$ PTR SYMREF;
     1237    11707    1   DCL KNN_OSIMAX# UBIN SYMREF;
PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:197  
     1238    11708    1   DCL KNN_OSIROUTE# UBIN SYMREF;
     1239    11709
     1240    11710        %K$NPDU_FIXED(STCLASS="BASED(KN$NETPARM.NHDR$)");
     1241    11767        %K$NPDU_SEGMENT;
     1242    11819        %K$NSAP;
     1243    11871    1   DCL KNN$ROUTE$(0:0) PTR BASED(KNN_ROUTE$$);
     1244    11872    1   DCL KNN$LINK$(0:0) PTR BASED(KNN_LINK$$);
     1245    11873    1   DCL CHR(0:0) CHAR(1) BASED CALIGNED;
     1246    11874    1   DCL CALLEDFROM$ EPTR BASED;
     1247    11875
     1248    11876
     1249    11877
     1250    11878    1   DCL SIZELEFT UBIN;
     1251    11879    1   DCL THISSIZE UBIN;
     1252    11880    1   DCL I SBIN;
     1253    11881    1   DCL ERRVAL(0:3) UBIN;
     1254    11882
     1255    11883        %VLP_ERRCODE(FPTN=E_DSCRD_LIFEEXPTRAN,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             11883            %E$DSCRD_LIFEEXPTRAN);
     1256    11929        %VLP_ERRCODE(FPTN=E_DSCRD_CANTSEG,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             11929            %E$DSCRD_CANTSEG);
     1257    11975
     1258    11976
     1259    11977    1      SIZELEFT = KN$NETPARM.NHDRSZ;
     1260    11978    2      DO WHILE SIZELEFT > 0;
     1261    11979    2         K$NPDU_FIXED.LIFETIME = K$NPDU_FIXED.LIFETIME - 1;
     1262    11980    3         IF K$NPDU_FIXED.LIFETIME = 0 THEN DO;
     1263    11981    3            KN$NETPARM.ERRCODE = %K_DSCRD_LIFEEXPTRAN;
     1264    11982    3            ADDR(ERRVAL(0))->CALLEDFROM$ = ENTADDR(KNN$FORWARD);
     1265    11983    3            CALL GHE$ERRLOG(E_DSCRD_LIFEEXPTRAN,ERRVAL,K$NPDU_FIXED,SIZEC(K$NPDU_FIXED)
             11983                     ,'0'B);
     1266    11984    3            GOTO ERR;
     1267    11985    3            END;
     1268    11986
     1269    11987    3         IF K$NPDU_FIXED.CHECKSUMX ~= 0 OR K$NPDU_FIXED.CHECKSUMY ~= 0 THEN DO;
     1270    11988    3            I = K$NPDU_FIXED.CHECKSUMX + 5;
     1271    11989    3            IF I > 255 THEN
PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:198  
     1272    11990    3               I = I-255;
     1273    11991    3            K$NPDU_FIXED.CHECKSUMX = I;
     1274    11992
     1275    11993    3            I = K$NPDU_FIXED.CHECKSUMY - 4;
     1276    11994    3            IF I <= 0 THEN
     1277    11995    3               I = I + 255;
     1278    11996    3            K$NPDU_FIXED.CHECKSUMY = I;
     1279    11997    3            END;
     1280    11998
     1281    11999    3         CALL KNH$SEND(KN$NETPARM) WHENALTRETURN DO;
     1282    12000    4            IF KN$NETPARM.ERRCODE = %KN_ERR_Q2SMALL THEN DO;
     1283    12001    5               IF K$NPDU_FIXED.SP = '0'B THEN DO;
     1284    12002    5                  KN$NETPARM.ERRCODE = %K_DSCRD_CANTSEG;
     1285    12003    5                  ADDR(ERRVAL(0))->CALLEDFROM$ = ENTADDR(KNN$FORWARD);
     1286    12004    5                  CALL GHE$ERRLOG(E_DSCRD_CANTSEG,ERRVAL,K$NPDU_FIXED,SIZEC(
             12004                           K$NPDU_FIXED),'0'B);
     1287    12005    5                  GOTO ERR;
     1288    12006    5                  END;
     1289    12007    5               ELSE DO;
     1290    12008        /*
     1291    12009             at this point we may want to fragment the message if the call to knh$send
     1292    12010             altrets with a KNT_ERR_NVR_CREDIT the message is bigger than the q.  Network
     1293    12011             should fragment the message
     1294    12012        */
     1295    12013    5                  KN$NETPARM.ERRCODE = %K_DSCRD_CANTSEG;
     1296    12014    5                  ADDR(ERRVAL(0))->CALLEDFROM$ = ENTADDR(KNN$FORWARD);
     1297    12015    5                  CALL GHE$ERRLOG(E_DSCRD_CANTSEG,ERRVAL,K$NPDU_FIXED,SIZEC(
             12015                           K$NPDU_FIXED),'0'B);
     1298    12016    5                  GOTO ERR;
     1299    12017    5                  END;
     1300    12018    4               END;
     1301    12019    3            END;                           /* whenaltreturn            */
     1302    12020    2         SIZELEFT = SIZELEFT - KN$NETPARM.NHDRSZ;
     1303    12021    2         END;                              /* Do while sizeleft > 0    */
     1304    12022    1      RETURN;
     1305    12023    1   ERR:
     1306    12024    1      CALL KNN$SENDERR(KN$NETPARM);
PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:199  
     1307    12025    1      ALTRETURN;
     1308    12026    1   END KNN$FORWARD;
     1309    12027        %EOD;

PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:200  
--  Include file information  --

   KN_ERRORS_C.:E05TOU  is referenced.
   KL_ERRORS_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   K_INTERFACE_M.:E05TOU  is referenced.
   KN_DATA_M.:E05TOU  is referenced.
   KNN_NETWORK_M.:E05TOU  is referenced.
   K_SCODE_C.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   K_NETWORK_E.:E05TOU  is referenced.
   K_NETWORK_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KNN$FORWARD.

   Procedure KNN$FORWARD requires 229 words for executable code.
   Procedure KNN$FORWARD requires 24 words of local(AUTO) storage.

PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:201  

 Object Unit name= KNN$FORWARD                                File name= KNN$SUBS.:E05TOU
 UTS= JUL 30 '97 01:08:27.48 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS      4      4  KNN$FORWARD
    1   Proc  even  none   229     E5  KNN$FORWARD

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  KNN$FORWARD

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KNH$SEND
 yes     yes           Std       5 GHE$ERRLOG
 yes     yes           Std       1 KNN$SENDERR
 yes     yes           Std       1 KNN$FORWARD
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET
                       nStd      0 X6A_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KNN_ROUTE$$                           KNN_LINK$$                       r    G$ROS$
PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:202  


     1195        1        /*T***********************************************************/
     1196        2        /*T*                                                         */
     1197        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1198        4        /*T*                                                         */
     1199        5        /*T***********************************************************/
     1200        6        %EJECT;
PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:203  
     1201        7        KNN$FORWARD: PROC(KN$NETPARM) ALTRET;

      7   1 000000  D380 0000 0000  xent KNN$FORWARD     LNJ,B5   X6A_AUTO_1
          1 000003       0018 0001                       DC       24,1

     1202        8
     1203        9        %INCLUDE LCP_6;
     1204     4288        %INCLUDE K_NETWORK_M;
     1205     4557        %INCLUDE K_NETWORK_E;
     1206     4646        %INCLUDE KNH_MACRO_C;
     1207     4929        %INCLUDE K_ADDRESS_M;
     1208     5432        %INCLUDE K_SCODE_C;
     1209     5517        %INCLUDE KNN_NETWORK_M;
     1210     5880        %INCLUDE KN_DATA_M;
     1211     7666        %INCLUDE K_INTERFACE_M;
     1212     8075        %INCLUDE KL_MACRO_C;
     1213    11427        %INCLUDE KL_ERRORS_C;
     1214    11469        %INCLUDE KN_ERRORS_C;
     1215    11533
     1216    11534    1   DCL KNN$SENDERR ENTRY(1) ALTRET;
     1217    11535    1   DCL KNA$CHK_CHKSUM ENTRY(2) ALTRET;
     1218    11536    1   DCL KNA$CALC_CHKSUM ENTRY(3) ALTRET;
     1219    11537    1   DCL KNT$TRANSPORT ENTRY(1) ALTRET;
     1220    11538    1   DCL KNT$SEND_4HOST ENTRY(1) ALTRET;
     1221    11539    1   DCL KNT$RECV_4HOST ENTRY(1) ALTRET;
     1222    11540    1   DCL KNN$REASSEM ENTRY(1) ALTRET;
     1223    11541    1   DCL KNN$GETOSI ENTRY(1) ALTRET;
     1224    11542    1   DCL KNH$SEND ENTRY(1) ALTRET;
     1225    11543    1   DCL SCREECH ENTRY(1);
     1226    11544    1   DCL GHE$ERRLOG ENTRY(5) ALTRET;
     1227    11545
     1228    11546        %KN$NETPARM(NAME=KN$NETPARM);
     1229    11699
     1230    11700
     1231    11701    1   DCL KNN_NODES UBIN SYMREF;
     1232    11702    1   DCL KN_NODE# UBIN SYMREF;
     1233    11703    1   DCL KNN_ROUTE$$ PTR SYMREF;
PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:204  
     1234    11704    1   DCL KNN_LINKS UBIN SYMREF;
     1235    11705    1   DCL KNN_LINK$$ PTR SYMREF;
     1236    11706    1   DCL KNN_OSIROUTE$$ PTR SYMREF;
     1237    11707    1   DCL KNN_OSIMAX# UBIN SYMREF;
     1238    11708    1   DCL KNN_OSIROUTE# UBIN SYMREF;
     1239    11709
     1240    11710        %K$NPDU_FIXED(STCLASS="BASED(KN$NETPARM.NHDR$)");
     1241    11767        %K$NPDU_SEGMENT;
     1242    11819        %K$NSAP;
     1243    11871    1   DCL KNN$ROUTE$(0:0) PTR BASED(KNN_ROUTE$$);
     1244    11872    1   DCL KNN$LINK$(0:0) PTR BASED(KNN_LINK$$);
     1245    11873    1   DCL CHR(0:0) CHAR(1) BASED CALIGNED;
     1246    11874    1   DCL CALLEDFROM$ EPTR BASED;
     1247    11875
     1248    11876
     1249    11877
     1250    11878    1   DCL SIZELEFT UBIN;
     1251    11879    1   DCL THISSIZE UBIN;
     1252    11880    1   DCL I SBIN;
     1253    11881    1   DCL ERRVAL(0:3) UBIN;
     1254    11882
     1255    11883        %VLP_ERRCODE(FPTN=E_DSCRD_LIFEEXPTRAN,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             11883            %E$DSCRD_LIFEEXPTRAN);
     1256    11929        %VLP_ERRCODE(FPTN=E_DSCRD_CANTSEG,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
             11929            %E$DSCRD_CANTSEG);
     1257    11975
     1258    11976
     1259    11977    1      SIZELEFT = KN$NETPARM.NHDRSZ;

  11977   1 000005  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 000007  E846 0010                            LDR,R6   16,B6
          1 000009  EF47 0006                            STR,R6   SIZELEFT,AUTO

     1260    11978    2      DO WHILE SIZELEFT > 0;

  11978   1 00000B  6901 00CB                            BEZ,R6   s:12022,PREL

PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:205  
     1261    11979    2         K$NPDU_FIXED.LIFETIME = K$NPDU_FIXED.LIFETIME - 1;

  11979   1 00000D  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 00000F  DCC6 000E                            LDB,B5   14,B6
          1 000011  E845 0001                            LDR,R6   1,B5
          1 000013  EA70 00FF                            ADD,R6   255,IMO
          1 000015  EAC5 0001                            SRM,R6,'00FF'X    1,B5
          1 000017       00FF

     1262    11980    3         IF K$NPDU_FIXED.LIFETIME = 0 THEN DO;

  11980   1 000018  DCC6 000E                            LDB,B5   14,B6
          1 00001A  82C5 0001                            LB,'00FF'X        1,B5
          1 00001C       00FF
          1 00001D  0501 0026                            BBT      s:11987,PREL

     1263    11981    3            KN$NETPARM.ERRCODE = %K_DSCRD_LIFEEXPTRAN;

  11981   1 00001F  E870 00A0                            LDR,R6   160,IMO
          1 000021  EF46 0016                            STR,R6   22,B6

     1264    11982    3            ADDR(ERRVAL(0))->CALLEDFROM$ = ENTADDR(KNN$FORWARD);

  11982   1 000023  CBC0 FFDC                            LAB,B4   s:7,PREL
          1 000025  CFC7 0009                            STB,B4   ERRVAL,AUTO

     1265    11983    3           CALL GHE$ERRLOG(E_DSCRD_LIFEEXPTRAN,ERRVAL,K$NPDU_FIXED,SIZEC(K$NPDU_FIXED)
             11983                     ,'0'B);

  11983   1 000027  BBF0 000A                            LAB,B3   10,IMO
          1 000029  ABF0 0000                            LAB,B2   0,IMO
          1 00002B  AFC7 0016                            STB,B2   ERRVAL+13,AUTO
          1 00002D  BFC7 0014                            STB,B3   ERRVAL+11,AUTO
          1 00002F  DFC7 0012                            STB,B5   ERRVAL+9,AUTO
          1 000031  9BC7 0009                            LAB,B1   ERRVAL,AUTO
          1 000033  9FC7 0010                            STB,B1   ERRVAL+7,AUTO
          1 000035  EB80 0000 0000  00                   LAB,B6   E_DSCRD_LIFEEXPTRAN
PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:206  
          1 000038  EFC7 000E                            STB,B6   ERRVAL+5,AUTO
          1 00003A  BBC7 000E                            LAB,B3   ERRVAL+5,AUTO
          1 00003C  CBF0 0500                            LAB,B4   1280,IMO
          1 00003E  E380 0000 0000  xent                 LNJ,B6   GHE$ERRLOG
          1 000041       0001                            DC       s:11984,PREL

     1266    11984    3            GOTO ERR;

  11984   1 000042  0F81 0097                            B        s:12024,PREL

     1267    11985    3            END;
     1268    11986
     1269    11987    3         IF K$NPDU_FIXED.CHECKSUMX ~= 0 OR K$NPDU_FIXED.CHECKSUMY ~= 0 THEN DO;

  11987   1 000044  82C5 0003                            LB,'00FF'X        3,B5
  11987   1 000046       00FF
          1 000047  0501 0005                            BBT      s:11988,PREL
          1 000049  E2C5 0004                            LLH,R6   4,B5
          1 00004B  6901 0022                            BEZ,R6   s:11999,PREL

     1270    11988    3            I = K$NPDU_FIXED.CHECKSUMX + 5;

  11988   1 00004D  E845 0003                            LDR,R6   3,B5
          1 00004F  E570 00FF                            AND,R6   255,IMO
          1 000051  6E05                                 ADV,R6   5
          1 000052  EF47 0008                            STR,R6   I,AUTO

     1271    11989    3            IF I > 255 THEN

  11989   1 000054  E970 00FF                            CMR,R6   255,IMO
          1 000056  0A81 0005                            BALE     s:11991,PREL

     1272    11990    3               I = I-255;

  11990   1 000058  EA70 FF01                            ADD,R6   -255,IMO
          1 00005A  EF47 0008                            STR,R6   I,AUTO

PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:207  
     1273    11991    3            K$NPDU_FIXED.CHECKSUMX = I;

  11991   1 00005C  EAC5 0003                            SRM,R6,'00FF'X    3,B5
  11991   1 00005E       00FF

     1274    11992
     1275    11993    3            I = K$NPDU_FIXED.CHECKSUMY - 4;

  11993   1 00005F  DCC6 000E                            LDB,B5   14,B6
          1 000061  E2C5 0004                            LLH,R6   4,B5
          1 000063  6EFC                                 ADV,R6   -4
          1 000064  EF47 0008                            STR,R6   I,AUTO

     1276    11994    3            IF I <= 0 THEN

  11994   1 000066  6A01 0005                            BGZ,R6   s:11996,PREL

     1277    11995    3               I = I + 255;

  11995   1 000068  EA70 00FF                            ADD,R6   255,IMO
          1 00006A  EF47 0008                            STR,R6   I,AUTO

     1278    11996    3            K$NPDU_FIXED.CHECKSUMY = I;

  11996   1 00006C  E7C5 0004                            STH,R6   4,B5

     1279    11997    3            END;

     1280    11998
     1281    11999    3         CALL KNH$SEND(KN$NETPARM) WHENALTRETURN DO;

  11999   1 00006E  BBC7 0004                            LAB,B3   @KN$NETPARM,AUTO
          1 000070  CBF0 0100                            LAB,B4   256,IMO
          1 000072  E380 0000 0000  xent                 LNJ,B6   KNH$SEND
          1 000075       0003                            DC       s:12000,PREL
          1 000076  0F81 0056                            B        s:12020,PREL

PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:208  
     1282    12000    4            IF KN$NETPARM.ERRCODE = %KN_ERR_Q2SMALL THEN DO;

  12000   1 000078  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 00007A  E846 0016                            LDR,R6   22,B6
          1 00007C  6D04                                 CMV,R6   4
          1 00007D  0981 004F                            BNE      s:12020,PREL

     1283    12001    5               IF K$NPDU_FIXED.SP = '0'B THEN DO;

  12001   1 00007F  DCC6 000E                            LDB,B5   14,B6
          1 000081  89C5 0002                            CMZ      2,B5
          1 000083  0801 0025                            BAL      s:12013,PREL

     1284    12002    5                  KN$NETPARM.ERRCODE = %K_DSCRD_CANTSEG;

  12002   1 000085  6C05                                 LDV,R6   5
          1 000086  EF46 0016                            STR,R6   22,B6

     1285    12003    5                  ADDR(ERRVAL(0))->CALLEDFROM$ = ENTADDR(KNN$FORWARD);

  12003   1 000088  CBC0 FF77                            LAB,B4   s:7,PREL
          1 00008A  CFC7 0009                            STB,B4   ERRVAL,AUTO

     1286    12004    5                  CALL GHE$ERRLOG(E_DSCRD_CANTSEG,ERRVAL,K$NPDU_FIXED,SIZEC(
             12004                           K$NPDU_FIXED),'0'B);

  12004   1 00008C  BBF0 000A                            LAB,B3   10,IMO
          1 00008E  ABF0 0000                            LAB,B2   0,IMO
          1 000090  AFC7 0016                            STB,B2   ERRVAL+13,AUTO
          1 000092  BFC7 0014                            STB,B3   ERRVAL+11,AUTO
          1 000094  DFC7 0012                            STB,B5   ERRVAL+9,AUTO
          1 000096  9BC7 0009                            LAB,B1   ERRVAL,AUTO
          1 000098  9FC7 0010                            STB,B1   ERRVAL+7,AUTO
          1 00009A  EB80 0000 0002  00                   LAB,B6   E_DSCRD_CANTSEG
          1 00009D  EFC7 000E                            STB,B6   ERRVAL+5,AUTO
          1 00009F  BBC7 000E                            LAB,B3   ERRVAL+5,AUTO
          1 0000A1  CBF0 0500                            LAB,B4   1280,IMO
PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:209  
          1 0000A3  E380 0000 0000  xent                 LNJ,B6   GHE$ERRLOG
          1 0000A6       0001                            DC       s:12005,PREL

     1287    12005    5                  GOTO ERR;

  12005   1 0000A7  0F81 0032                            B        s:12024,PREL

     1288    12006    5                  END;
     1289    12007    5               ELSE DO;

     1290    12008        /*
     1291    12009             at this point we may want to fragment the message if the call to knh$send
     1292    12010             altrets with a KNT_ERR_NVR_CREDIT the message is bigger than the q.  Network
     1293    12011             should fragment the message
     1294    12012        */
     1295    12013    5                  KN$NETPARM.ERRCODE = %K_DSCRD_CANTSEG;

  12013   1 0000A9  6C05                                 LDV,R6   5
          1 0000AA  EF46 0016                            STR,R6   22,B6

     1296    12014    5                  ADDR(ERRVAL(0))->CALLEDFROM$ = ENTADDR(KNN$FORWARD);

  12014   1 0000AC  CBC0 FF53                            LAB,B4   s:7,PREL
          1 0000AE  CFC7 0009                            STB,B4   ERRVAL,AUTO

     1297    12015    5                  CALL GHE$ERRLOG(E_DSCRD_CANTSEG,ERRVAL,K$NPDU_FIXED,SIZEC(
             12015                           K$NPDU_FIXED),'0'B);

  12015   1 0000B0  BBF0 000A                            LAB,B3   10,IMO
          1 0000B2  ABF0 0000                            LAB,B2   0,IMO
          1 0000B4  AFC7 0016                            STB,B2   ERRVAL+13,AUTO
          1 0000B6  BFC7 0014                            STB,B3   ERRVAL+11,AUTO
          1 0000B8  DFC7 0012                            STB,B5   ERRVAL+9,AUTO
          1 0000BA  9BC7 0009                            LAB,B1   ERRVAL,AUTO
          1 0000BC  9FC7 0010                            STB,B1   ERRVAL+7,AUTO
          1 0000BE  EB80 0000 0002  00                   LAB,B6   E_DSCRD_CANTSEG
          1 0000C1  EFC7 000E                            STB,B6   ERRVAL+5,AUTO
PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:210  
          1 0000C3  BBC7 000E                            LAB,B3   ERRVAL+5,AUTO
          1 0000C5  CBF0 0500                            LAB,B4   1280,IMO
          1 0000C7  E380 0000 0000  xent                 LNJ,B6   GHE$ERRLOG
          1 0000CA       0001                            DC       s:12016,PREL

     1298    12016    5                  GOTO ERR;

  12016   1 0000CB  0F81 000E                            B        s:12024,PREL

     1299    12017    5                  END;
     1300    12018    4               END;
     1301    12019    3            END;                           /* whenaltreturn            */
     1302    12020    2         SIZELEFT = SIZELEFT - KN$NETPARM.NHDRSZ;

  12020   1 0000CD  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          1 0000CF  E847 0006                            LDR,R6   SIZELEFT,AUTO
          1 0000D1  E246 0010                            SUB,R6   16,B6
          1 0000D3  EF47 0006                            STR,R6   SIZELEFT,AUTO

     1303    12021    2         END;                              /* Do while sizeleft > 0    */

  12021   1 0000D5  6981 FF37                            BNEZ,R6  s:11979,PREL

     1304    12022    1      RETURN;

  12022   1 0000D7  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1305    12023    1   ERR:
     1306    12024    1      CALL KNN$SENDERR(KN$NETPARM);

  12024   1 0000DA  BBC7 0004            ERR             LAB,B3   @KN$NETPARM,AUTO
          1 0000DC  CBF0 0100                            LAB,B4   256,IMO
          1 0000DE  E380 0000 0000  xent                 LNJ,B6   KNN$SENDERR
          1 0000E1       0001                            DC       s:12025,PREL

     1307    12025    1      ALTRETURN;

PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:211  
  12025   1 0000E2  C380 0000 0000  xent                 LNJ,B4   X6A_AALT
     1308    12026    1   END KNN$FORWARD;
     1309    12027        %EOD;

PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:212  
--  Include file information  --

   KN_ERRORS_C.:E05TOU  is referenced.
   KL_ERRORS_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   K_INTERFACE_M.:E05TOU  is referenced.
   KN_DATA_M.:E05TOU  is referenced.
   KNN_NETWORK_M.:E05TOU  is referenced.
   K_SCODE_C.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   K_NETWORK_E.:E05TOU  is referenced.
   K_NETWORK_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KNN$FORWARD.
PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:213  

 **** Variables and constants ****

  ****  Section 000 RoData KNN$FORWARD

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     2-0-0/w STRC(32)    r     1 E_DSCRD_CANTSEG            0-0-0/w STRC(32)    r     1 E_DSCRD_LIFEEXPTRAN

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @KN$NETPARM                9-0-0/w UBIN(16)    r     1 ERRVAL(0:3)
     8-0-0/w SBIN(16)    r     1 I                         *0-0-0/w STRC(528)   r     1 KN$NETPARM
     6-0-0/w UBIN(16)    r     1 SIZELEFT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KNN_LINK$$                 0-0-0/w PTR         r     1 KNN_ROUTE$$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w EPTR        r     1 CALLEDFROM$                0-0-0/w STRC(72)    r     1 K$NPDU_FIXED


   Procedure KNN$FORWARD requires 229 words for executable code.
   Procedure KNN$FORWARD requires 24 words of local(AUTO) storage.
PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:214  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:215  
          MINI XREF LISTING

CALLEDFROM$
     11874**DCL     11982<<ASSIGN  12003<<ASSIGN  12014<<ASSIGN
ERR
     12024**LABEL   11984--GOTO    12005--GOTO    12016--GOTO
ERRVAL
     11881**DCL     11982--ASSIGN  11983<>CALL    12003--ASSIGN  12004<>CALL    12014--ASSIGN  12015<>CALL
E_DSCRD_CANTSEG
     11943**DCL     12004<>CALL    12015<>CALL
E_DSCRD_LIFEEXPTRAN
     11897**DCL     11983<>CALL
GHE$ERRLOG
     11544**DCL-ENT 11983--CALL    12004--CALL    12015--CALL
I
     11880**DCL     11988<<ASSIGN  11989>>IF      11990<<ASSIGN  11990>>ASSIGN  11991>>ASSIGN  11993<<ASSIGN
     11994>>IF      11995<<ASSIGN  11995>>ASSIGN  11996>>ASSIGN
K$NPDU_FIXED
     11726**DCL     11983<>CALL    11983--CALL    12004<>CALL    12004--CALL    12015<>CALL    12015--CALL
K$NPDU_FIXED.CHECKSUMX
     11762**DCL     11987>>IF      11988>>ASSIGN  11991<<ASSIGN
K$NPDU_FIXED.CHECKSUMY
     11765**DCL     11987>>IF      11993>>ASSIGN  11996<<ASSIGN
K$NPDU_FIXED.LIFETIME
     11736**DCL     11979<<ASSIGN  11979>>ASSIGN  11980>>IF
K$NPDU_FIXED.SP
     11741**DCL     12001>>IF
K$NSAP.ADDRESS_N
     11867**DCL     11868--REDEF
KN$NETPARM
     11559**DCL         7--PROC    11999<>CALL    12024<>CALL
KN$NETPARM.ERRCODE
     11666**DCL     11981<<ASSIGN  12000>>IF      12002<<ASSIGN  12013<<ASSIGN
KN$NETPARM.MSG$
PL6.E3A0      #004=KNN$FORWARD File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:08 Page:216  
     11566**DCL     11571--REDEF
KN$NETPARM.NHDR$
     11618**DCL     11619--REDEF   11726--IMP-PTR 11979>>ASSIGN  11979>>ASSIGN  11980>>IF      11983>>CALL
     11987>>IF      11987>>IF      11988>>ASSIGN  11991>>ASSIGN  11993>>ASSIGN  11996>>ASSIGN  12001>>IF
     12004>>CALL    12015>>CALL
KN$NETPARM.NHDRSZ
     11624**DCL     11977>>ASSIGN  12020>>ASSIGN
KN$NETPARM.SHDR$
     11596**DCL     11597--REDEF
KN$NETPARM.THDR$
     11607**DCL     11608--REDEF
KN$NETPARM.UHDR$
     11582**DCL     11583--REDEF
KNH$SEND
     11542**DCL-ENT 11999--CALL
KNN$FORWARD
         7**PROC    11982--ASSIGN  12003--ASSIGN  12014--ASSIGN
KNN$SENDERR
     11534**DCL-ENT 12024--CALL
KNN_LINK$$
     11705**DCL     11872--IMP-PTR
KNN_ROUTE$$
     11703**DCL     11871--IMP-PTR
SIZELEFT
     11878**DCL     11977<<ASSIGN  11978>>DOWHILE 12020<<ASSIGN  12020>>ASSIGN

PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:217  
     1310        1        /*T***********************************************************/
     1311        2        /*T*                                                         */
     1312        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1313        4        /*T*                                                         */
     1314        5        /*T***********************************************************/
     1315        6        %EJECT;
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:218  
     1316        7        KNN$REASSEM: PROC(KN$NETPARM,DSTROUTE,SRCROUTE) ALTRET;
     1317        8
     1318        9        /*
     1319       10             NAME: KNN$REASSEM
     1320       11             DESCRIPTION: reassemble network fragments into a single transport fragment.
     1321       12        */
     1322       13        %INCLUDE LCP_6;
     1323     4292        %INCLUDE KN_DATA_M;
     1324     6078        %INCLUDE K_ADDRESS_M;
     1325     6581        %INCLUDE K_NETWORK_M;
     1326     6850        %INCLUDE K_NETWORK_E;
     1327     6939        %INCLUDE K_INTERFACE_M;
     1328     7348        %INCLUDE KNN_NETWORK_M;
     1329     7711        %INCLUDE GH_SCHD_M;
     1330     7855        %INCLUDE K_SCODE_C;
     1331     7940        %INCLUDE K_QDPHDRS_M;
     1332     8822        %INCLUDE KL_MACRO_C;
     1333    12174
     1334    12175    1   DCL KVB$GET2NSYS ENTRY(2) ALTRET;
     1335    12176    1   DCL KVB$RLS2NSYS ENTRY(2) ALTRET;
     1336    12177    1   DCL KNN$TIMER ENTRY;
     1337    12178    1   DCL KNT$RECV_4HOST ENTRY(1) ALTRET;
     1338    12179    1   DCL SCREECH ENTRY(1);
     1339    12180    1   DCL GHS$SET_TMR ENTRY(1);
     1340    12181    1   DCL GUS$MONTIMR ENTRY(4);
     1341    12182    1   DCL KNH$SEND ENTRY(1) ALTRET;
     1342    12183
     1343    12184        %KN$NETPARM(STCLASS=PARAM);
     1344    12337        %KL_UPDOSI(FPTN=DSTROUTE,STCLASS="");
     1345    12546        %KL_UPDOSI(FPTN=SRCROUTE,STCLASS="");
     1346    12755
     1347    12756        %K$NQDP_HDR (NAME=K$NQDP_HDR_C,MSGTYPE=OSI_DATA,ALGN=ALIGNED,STCLASS=CONSTANT);
     1348    12833        %VLP_SCODE (FPTN=PRTCLERR,ERR#=%S$PRTCLERR,SEV=G_SEV_SCREECH#,
     1349    12834                       STCLASS=CONSTANT,FCG=KN,MID=N,MON='1'B);
     1350    12895
     1351    12896        %K$NFRAG(STCLASS="BASED(TFRAG$)");
     1352    12930        %K$NHDR(STCLASS = "BASED(HDR$)");
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:219  
     1353    13108        %K$NPDU_SEGMENT(STCLASS="BASED(KN$NETPARM.FPT$)");
     1354    13160        %K$NSAP(FPTN=SOURCE,STCLASS="BASED(KN$NETPARM.SRC_ADDR$)",ADRTYP=NET);
     1355    13212        %K$NSAP(FPTN=DESTINATION,STCLASS="BASED(KN$NETPARM.DST_ADDR$)",ADRTYP=NET);
     1356    13264        %K$NPDU_FIXED(STCLASS="BASED(KN$NETPARM.NHDR$)");
     1357    13321        %GH$TMR_BLK(STCLASS=STATIC);
     1358    13344        %KNN$ROUTE(STCLASS=BASED);
     1359    13416        %KNN$LINK(STCLASS=BASED);
     1360    13667    1   DCL ADDRESS CHAR(SIZE) BASED;
     1361    13668    1   DCL KNN$ROUTE$(0:0) PTR BASED(KNN_ROUTE$$);
     1362    13669    1   DCL KNN$LINK$(0:0) PTR BASED(KNN_LINK$$);
     1363    13670    1   DCL UBINBSD UBIN WORD BASED;
     1364    13671
     1365    13672    1   DCL KNN_REASSEMTIME UBIN SYMREF;
     1366    13673    1   DCL KNN_RASSMHD$ PTR SYMREF;
     1367    13674    1   DCL KNN_RASSMTL$ PTR SYMREF;
     1368    13675    1   DCL KN_NODE# UBIN SYMREF;
     1369    13676    1   DCL KNN_ROUTE$$ PTR SYMREF;
     1370    13677    1   DCL KNN_LINK$$ PTR SYMREF;
     1371    13678    1   DCL KNN_REASSEM_CLOCK UBIN SYMREF;
     1372    13679    1   DCL KNN_LIFETIME_UNIT UBIN SYMREF;
     1373    13680
     1374    13681        %K$NQDP_HDR (NAME=NQDP_HDR,MSGTYPE=OSI_DATA,ALGN=ALIGNED,STCLASS=AUTO);
     1375    13758    1   DCL FIXED$ PTR;
     1376    13759    1   DCL SEG$ PTR;
     1377    13760    1   DCL TFRAG$ PTR;
     1378    13761    1   DCL DATA$ PTR;
     1379    13762    1   DCL HDR$ PTR;
     1380    13763    1   DCL SRC$ PTR;
     1381    13764    1   DCL DST$ PTR;
     1382    13765
     1383    13766    1   DCL DATASIZE UBIN;
     1384    13767    1   DCL I UBIN;
     1385    13768    1   DCL SIZE UBIN;
     1386    13769
     1387    13770
     1388    13771    1      DATASIZE = KN$NETPARM.NHDRSZ - K$NPDU_FIXED.LENGTH;
     1389    13772    1      HDR$ = KNN_RASSMHD$;
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:220  
     1390    13773    2      DO WHILE HDR$ ~= ADDR(NIL);
     1391    13774    2         IF K$NHDR.DATAID = K$NPDU_SEGMENT.DATAID AND
     1392    13775    2           SUBSTR(ADDR(SOURCE)->ADDRESS,0,SOURCE.LEN) =
     1393    13776    2           SUBSTR(ADDR(K$NHDR.SOURCE)->ADDRESS,0,SOURCE.LEN) AND
     1394    13777    2           SUBSTR(ADDR(DESTINATION)->ADDRESS,0,DESTINATION.LEN) =
     1395    13778    3           SUBSTR(ADDR(K$NHDR.DESTINATION)->ADDRESS,0,DESTINATION.LEN) THEN DO;
     1396    13779    3            TFRAG$ = K$NHDR.FRAG$;
     1397    13780    4            DO WHILE TFRAG$ ~= ADDR(NIL);
     1398    13781    5               IF K$NPDU_SEGMENT.OFFSET = K$NFRAG.OFFSET THEN DO;
     1399    13782    6                  IF K$NFRAG.LENGTH = DATASIZE THEN DO;
     1400    13783    6                     KN$NETPARM.ERRCODE = %K_DSCRD_REASSEM;
             13783                              /* discard duplicate packets*/
     1401    13784    6                     ALTRETURN;
     1402    13785    6                     END;
     1403    13786    5                  TFRAG$ = K$NFRAG.LINK$;
     1404    13787    5                  END;
     1405    13788    4               END;                        /* do while                 */
     1406    13789
     1407    13790    3            SIZE = SIZEW(K$NFRAG);
     1408    13791    4            CALL KVB$GET2NSYS(SIZE,TFRAG$) WHENALTRETURN DO;
     1409    13792    4               KN$NETPARM.ERRCODE = %K_DSCRD_CONGEST;
     1410    13793    4               ALTRETURN;
     1411    13794    4               END;
     1412    13795
     1413    13796    3            K$NFRAG.BFRSIZ = SIZE;
     1414    13797    3            K$NFRAG.OFFSET = K$NPDU_SEGMENT.OFFSET;
     1415    13798    3            K$NFRAG.LENGTH = DATASIZE;
     1416    13799    3            K$NFRAG.LINK$ = K$NHDR.FRAG$;
     1417    13800    3            K$NHDR.FRAG$ = TFRAG$;
     1418    13801    3            SUBSTR(K$NHDR.HDR$->ADDRESS,K$NHDR.DATAOFFSET+K$NPDU_SEGMENT.OFFSET,
             13801                     DATASIZE-1) =
     1419    13802    3              SUBSTR(KN$NETPARM.NHDR$->ADDRESS,KN$NETPARM.NHDRSZ-KN$NETPARM.THDRSZ,
             13802                       DATASIZE-1);
     1420    13803
     1421    13804        /*
     1422    13805             are we done receiving data
     1423    13806        */
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:221  
     1424    13807    3            K$NHDR.RECVSZ = K$NHDR.RECVSZ + DATASIZE;
     1425    13808    4            IF K$NHDR.RECVSZ = K$NHDR.DATASZ THEN DO;
     1426    13809    4               KN$NETPARM.FUNCTION = %K_NDATA;
     1427    13810    4               KN$NETPARM.NHDR$ = K$NHDR.HDR$;
     1428    13811    4               KN$NETPARM.THDR_C$ = PINCRC(K$NHDR.HDR$,K$NHDR.DATAOFFSET);
     1429    13812    4               KN$NETPARM.NHDRSZ = K$NHDR.DATASZ;
     1430    13813    4               KN$NETPARM.THDRSZ = K$NHDR.DATASZ - K$NHDR.DATAOFFSET;
     1431    13814    4               KN$NETPARM.UHDRSZ = 0;
     1432    13815    4               KN$NETPARM.RECTYPE = 0;
     1433    13816    5               CALL KNT$RECV_4HOST(KN$NETPARM) WHENRETURN DO;
     1434    13817    5                  KN$NETPARM.THDRSZ = 0;
     1435    13818    5                  END;
     1436    13819    5               WHENALTRETURN DO;
     1437    13820        /*
     1438    13821             either transport buffered the message or there was a real error.
     1439    13822        */
     1440    13823    5                  GOTO RLSMEM;
     1441    13824    5                  END;
     1442    13825        /*
     1443    13826             all of this code can probably be discarded.  Transport really call knn$send
     1444    13827             to get the message forwarded.
     1445    13828        */
     1446    13829    4               KN$NETPARM.LDCT$ = KNN$ROUTE$(KN$NETPARM.NODE)->KNN$ROUTE.LINK$->
             13829                        KNN$LINK.LDCT$;
     1447    13830    4               NQDP_HDR = K$NQDP_HDR_C;
     1448    13831    4               NQDP_HDR.DEST_NODE = KN$NETPARM.NODE+1;
     1449    13832    4               NQDP_HDR.SOURCE_NODE = KN_NODE#+1;
     1450    13833    4               KN$NETPARM.NHDR$ = ADDR(NQDP_HDR);
     1451    13834    4               KN$NETPARM.NHDRSZ = LENGTHC(NQDP_HDR);
     1452    13835    5               IF KN$NETPARM.LDCT$ = ADDR(NIL) THEN DO;
     1453    13836    5                  KN$NETPARM.ERRCODE = %K_DSCRD_DSTUNREACH;
     1454    13837    5                  END;
     1455    13838    5               ELSE DO;
     1456    13839    6                  CALL KNH$SEND(KN$NETPARM) WHENALTRETURN DO;
     1457    13840    7                     IF KN$NETPARM.ERRCODE = %KN_ERR_Q2SMALL THEN DO;
     1458    13841    7                        KN$NETPARM.ERRCODE = %K_DSCRD_CONGEST; /* should really seg*/
     1459    13842    7                        END;
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:222  
     1460    13843    6                     END;
     1461    13844    5                  END;
     1462    13845        /*
     1463    13846             release the memory
     1464    13847        */
     1465    13848    4   RLSMEM:
     1466    13849    5               IF K$NHDR.BLINK$ = ADDR(NIL) THEN DO;
     1467    13850        /*
     1468    13851             at head
     1469    13852        */
     1470    13853    5                  KNN_RASSMHD$ = K$NHDR.FLINK$;
     1471    13854    5                  IF KNN_RASSMHD$ ~= ADDR(NIL) THEN
     1472    13855    5                     KNN_RASSMHD$->K$NHDR.BLINK$ = ADDR(NIL);
     1473    13856    5                  END;
     1474    13857    4               ELSE
     1475    13858    4                  K$NHDR.BLINK$->K$NHDR.FLINK$ = K$NHDR.FLINK$;
     1476    13859
     1477    13860    5               IF K$NHDR.FLINK$ = ADDR(NIL) THEN DO; /* at the tail    */
     1478    13861    5                  KNN_RASSMTL$ = K$NHDR.BLINK$;
     1479    13862    5                  IF KNN_RASSMTL$ ~= ADDR(NIL) THEN
     1480    13863    5                     KNN_RASSMTL$->K$NHDR.FLINK$ = ADDR(NIL);
     1481    13864    5                  END;
     1482    13865    4               ELSE
     1483    13866    4                  K$NHDR.FLINK$->K$NHDR.BLINK$ = K$NHDR.BLINK$;
     1484    13867
     1485    13868    5               DO WHILE K$NHDR.FRAG$ ~= ADDR(NIL);
     1486    13869    5                  TFRAG$ = K$NHDR.FRAG$->K$NFRAG.LINK$;
     1487    13870    6                  CALL KVB$RLS2NSYS(K$NHDR.FRAG$->K$NFRAG) WHENALTRETURN DO;
     1488    13871    6                     CALL SCREECH(PRTCLERR);
     1489    13872    6                     END;
     1490    13873    5                  K$NHDR.FRAG$ = TFRAG$;
     1491    13874    5                  END;
     1492    13875
     1493    13876    5               CALL KVB$RLS2NSYS(K$NHDR.HDR$->ADDRESS) WHENALTRETURN DO;
     1494    13877    5                  CALL SCREECH(PRTCLERR);
     1495    13878    5                  END;
     1496    13879
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:223  
     1497    13880    5               CALL KVB$RLS2NSYS(K$NHDR) WHENALTRETURN DO;
     1498    13881    5                  CALL SCREECH(PRTCLERR);
     1499    13882    5                  END;
     1500    13883    4               IF KN$NETPARM.ERRCODE ~= 0 THEN ALTRETURN;
     1501    13884    4               END;                        /* datasz = expected size   */
     1502    13885    3            RETURN;
     1503    13886    3            END;
     1504    13887    2         HDR$ = K$NHDR.FLINK$;
     1505    13888    2         END;
     1506    13889
     1507    13890        /*
     1508    13891             no fragments for this dataid, yet.
     1509    13892        */
     1510    13893    1      SIZE = SIZEW(K$NHDR);
     1511    13894    2      CALL KVB$GET2NSYS(SIZE,HDR$) WHENALTRETURN DO;
     1512    13895    2         KN$NETPARM.ERRCODE = %K_DSCRD_CONGEST;
     1513    13896    2         ALTRETURN;
     1514    13897    2         END;
     1515    13898    1      K$NHDR.BFRSIZ = SIZE;                /*  returned from kvb*/
     1516    13899        /*
     1517    13900           get enough memory to hold complete fragment, network addresses plus one
     1518    13901           word for buffer size
     1519    13902        */
     1520    13903    1      SIZE = ((KN$NETPARM.NHDRSZ+1)/2)+1;
     1521    13904    2      CALL KVB$GET2NSYS(SIZE,K$NHDR.HDR$) WHENALTRETURN DO;
     1522    13905    2         KN$NETPARM.ERRCODE = %K_DSCRD_CONGEST;
     1523    13906    2         ALTRETURN;
     1524    13907    2         END;
     1525    13908    1      HDR$->UBINBSD = SIZE;
     1526    13909
     1527    13910    1      SIZE = SIZEW(K$NFRAG);
     1528    13911    2      CALL KVB$GET2NSYS(SIZE,TFRAG$) WHENALTRETURN DO;
     1529    13912    2         KN$NETPARM.ERRCODE = %K_DSCRD_CONGEST;
     1530    13913    2         ALTRETURN;
     1531    13914    2         END;
     1532    13915
     1533    13916    1      K$NFRAG.BFRSIZ = SIZE;
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:224  
     1534    13917    1      K$NHDR.DATAID = K$NPDU_SEGMENT.DATAID;
     1535    13918    1      K$NHDR.SRCNODE# = SRCROUTE.FEP#;
     1536    13919    1      K$NHDR.DSTNODE# = DSTROUTE.HOST#;
     1537    13920    1      K$NHDR.BLINK$ = ADDR(NIL);
     1538    13921    1      K$NHDR.FLINK$ = ADDR(NIL);
     1539    13922    1      K$NHDR.RECVSZ = DATASIZE;
     1540    13923    1      K$NHDR.DATASZ = K$NPDU_SEGMENT.TOTLEN - K$NPDU_FIXED.LENGTH;
     1541    13924    1      K$NHDR.REASSEMTIM = K$NPDU_FIXED.LIFETIME * 50;
     1542    13925    1      IF K$NHDR.REASSEMTIM > KNN_REASSEMTIME THEN
     1543    13926    1         K$NHDR.REASSEMTIM = KNN_REASSEMTIME;
     1544    13927
     1545    13928    1      SIZE = SOURCE.LEN;
     1546    13929    1      ADDR(K$NHDR.SOURCE)->ADDRESS = ADDR(SOURCE)->ADDRESS;
     1547    13930    1      SIZE = DESTINATION.LEN;
     1548    13931    1      ADDR(K$NHDR.DESTINATION)->ADDRESS = ADDR(DESTINATION)->ADDRESS;
     1549    13932
     1550    13933    1      K$NHDR.DATAOFFSET = K$NPDU_FIXED.LENGTH+2; /* two bytes for buddy buffer size*/
     1551    13934    1      K$NHDR.FRAG$ = TFRAG$;
     1552    13935    1      K$NFRAG.LINK$ = ADDR(NIL);
     1553    13936    1      K$NFRAG.OFFSET = K$NPDU_SEGMENT.OFFSET;
     1554    13937    1      K$NFRAG.LENGTH = DATASIZE;
     1555    13938        /*
     1556    13939           leave a word at the beginning of the buffer for the buddy space size
     1557    13940        */
     1558    13941    1      SUBSTR(K$NHDR.HDR$->ADDRESS,2,K$NPDU_FIXED.LENGTH) =
     1559    13942    1        SUBSTR(KN$NETPARM.NHDR$->ADDRESS,0,K$NPDU_FIXED.LENGTH);
     1560    13943
     1561    13944    1      SUBSTR(K$NHDR.HDR$->ADDRESS,K$NHDR.DATAOFFSET,K$NPDU_SEGMENT.OFFSET) =
     1562    13945    1        SUBSTR(KN$NETPARM.NHDR$->ADDRESS,K$NHDR.DATAOFFSET,K$NPDU_SEGMENT.OFFSET);
     1563    13946
     1564    13947    2      IF KNN_RASSMHD$ = ADDR(NIL) THEN DO;
     1565    13948    2         KNN_RASSMHD$ = HDR$;
     1566    13949    2         KNN_RASSMTL$ = HDR$;
     1567    13950    2         END;
     1568    13951    2      ELSE DO;
     1569    13952    2         KNN_RASSMTL$->K$NHDR.FLINK$ = HDR$;
     1570    13953    2         K$NHDR.BLINK$ = KNN_RASSMTL$;
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:225  
     1571    13954    2         KNN_RASSMTL$ = HDR$;
     1572    13955    2         END;
     1573    13956    2      IF KNN_REASSEM_CLOCK = 0 THEN DO; /* start the reassembly clock  */
     1574    13957    2         GH$TMR_BLK.PROC$ = ENTADDR(KNN$TIMER);
     1575    13958    2         GH$TMR_BLK.INTERVAL = KNN_LIFETIME_UNIT;
     1576    13959    2         CALL GHS$SET_TMR(GH$TMR_BLK);
     1577    13960    2         END;
     1578    13961    1      RETURN;
     1579    13962    1   END KNN$REASSEM;
     1580    13963
     1581    13964        %EOD;

PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:226  
--  Include file information  --

   KL_MACRO_C.:E05TOU  is referenced.
   K_QDPHDRS_M.:E05TOU  is referenced.
   K_SCODE_C.:E05TOU  is referenced.
   GH_SCHD_M.:E05TOU  is referenced.
   KNN_NETWORK_M.:E05TOU  is referenced.
   K_INTERFACE_M.:E05TOU  is referenced.
   K_NETWORK_E.:E05TOU  is referenced.
   K_NETWORK_M.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KN_DATA_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KNN$REASSEM.

   Procedure KNN$REASSEM requires 832 words for executable code.
   Procedure KNN$REASSEM requires 34 words of local(AUTO) storage.

PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:227  

 Object Unit name= KNN$REASSEM                                File name= KNN$SUBS.:E05TOU
 UTS= JUL 30 '97 01:09:09.36 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS      5      5  KNN$REASSEM
    1   Data  even  none    10      A  KNN$REASSEM
    2   Proc  even  none   832    340  KNN$REASSEM
    3  RoData even  none     6      6  KNN$REASSEM

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        3  KNN$REASSEM

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 KVB$GET2NSYS
 yes     yes           Std       1 KNT$RECV_4HOST
 yes     yes           Std       2 KVB$RLS2NSYS
 yes     yes           Std       1 KNH$SEND
         yes           Std       1 SCREECH
         yes           Std       0 KNN$TIMER
         yes           Std       1 GHS$SET_TMR
                       nStd      0 X6A_AUTO_3
                       nStd      0 X6A_AALT
                       nStd      0 X6A_ARET
                       nStd      0 X6D_MID
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:228  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KNN_REASSEMTIME                       KNN_RASSMHD$                          KNN_RASSMTL$
     KN_NODE#                              KNN_ROUTE$$                           KNN_LINK$$
     KNN_REASSEM_CLOCK                     KNN_LIFETIME_UNIT                r    G$ROS$
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:229  


     1310        1        /*T***********************************************************/
     1311        2        /*T*                                                         */
     1312        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1313        4        /*T*                                                         */
     1314        5        /*T***********************************************************/
     1315        6        %EJECT;
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:230  
     1316        7        KNN$REASSEM: PROC(KN$NETPARM,DSTROUTE,SRCROUTE) ALTRET;

      7   2 000000  D380 0000 0000  xent KNN$REASSEM     LNJ,B5   X6A_AUTO_3
          2 000003       0022 0003                       DC       34,3

     1317        8
     1318        9        /*
     1319       10             NAME: KNN$REASSEM
     1320       11             DESCRIPTION: reassemble network fragments into a single transport fragment.
     1321       12        */
     1322       13        %INCLUDE LCP_6;
     1323     4292        %INCLUDE KN_DATA_M;
     1324     6078        %INCLUDE K_ADDRESS_M;
     1325     6581        %INCLUDE K_NETWORK_M;
     1326     6850        %INCLUDE K_NETWORK_E;
     1327     6939        %INCLUDE K_INTERFACE_M;
     1328     7348        %INCLUDE KNN_NETWORK_M;
     1329     7711        %INCLUDE GH_SCHD_M;
     1330     7855        %INCLUDE K_SCODE_C;
     1331     7940        %INCLUDE K_QDPHDRS_M;
     1332     8822        %INCLUDE KL_MACRO_C;
     1333    12174
     1334    12175    1   DCL KVB$GET2NSYS ENTRY(2) ALTRET;
     1335    12176    1   DCL KVB$RLS2NSYS ENTRY(2) ALTRET;
     1336    12177    1   DCL KNN$TIMER ENTRY;
     1337    12178    1   DCL KNT$RECV_4HOST ENTRY(1) ALTRET;
     1338    12179    1   DCL SCREECH ENTRY(1);
     1339    12180    1   DCL GHS$SET_TMR ENTRY(1);
     1340    12181    1   DCL GUS$MONTIMR ENTRY(4);
     1341    12182    1   DCL KNH$SEND ENTRY(1) ALTRET;
     1342    12183
     1343    12184        %KN$NETPARM(STCLASS=PARAM);
     1344    12337        %KL_UPDOSI(FPTN=DSTROUTE,STCLASS="");
     1345    12546        %KL_UPDOSI(FPTN=SRCROUTE,STCLASS="");
     1346    12755
     1347    12756        %K$NQDP_HDR (NAME=K$NQDP_HDR_C,MSGTYPE=OSI_DATA,ALGN=ALIGNED,STCLASS=CONSTANT);
     1348    12833        %VLP_SCODE (FPTN=PRTCLERR,ERR#=%S$PRTCLERR,SEV=G_SEV_SCREECH#,
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:231  
     1349    12834                       STCLASS=CONSTANT,FCG=KN,MID=N,MON='1'B);
     1350    12895
     1351    12896        %K$NFRAG(STCLASS="BASED(TFRAG$)");
     1352    12930        %K$NHDR(STCLASS = "BASED(HDR$)");
     1353    13108        %K$NPDU_SEGMENT(STCLASS="BASED(KN$NETPARM.FPT$)");
     1354    13160        %K$NSAP(FPTN=SOURCE,STCLASS="BASED(KN$NETPARM.SRC_ADDR$)",ADRTYP=NET);
     1355    13212        %K$NSAP(FPTN=DESTINATION,STCLASS="BASED(KN$NETPARM.DST_ADDR$)",ADRTYP=NET);
     1356    13264        %K$NPDU_FIXED(STCLASS="BASED(KN$NETPARM.NHDR$)");
     1357    13321        %GH$TMR_BLK(STCLASS=STATIC);
     1358    13344        %KNN$ROUTE(STCLASS=BASED);
     1359    13416        %KNN$LINK(STCLASS=BASED);
     1360    13667    1   DCL ADDRESS CHAR(SIZE) BASED;
     1361    13668    1   DCL KNN$ROUTE$(0:0) PTR BASED(KNN_ROUTE$$);
     1362    13669    1   DCL KNN$LINK$(0:0) PTR BASED(KNN_LINK$$);
     1363    13670    1   DCL UBINBSD UBIN WORD BASED;
     1364    13671
     1365    13672    1   DCL KNN_REASSEMTIME UBIN SYMREF;
     1366    13673    1   DCL KNN_RASSMHD$ PTR SYMREF;
     1367    13674    1   DCL KNN_RASSMTL$ PTR SYMREF;
     1368    13675    1   DCL KN_NODE# UBIN SYMREF;
     1369    13676    1   DCL KNN_ROUTE$$ PTR SYMREF;
     1370    13677    1   DCL KNN_LINK$$ PTR SYMREF;
     1371    13678    1   DCL KNN_REASSEM_CLOCK UBIN SYMREF;
     1372    13679    1   DCL KNN_LIFETIME_UNIT UBIN SYMREF;
     1373    13680
     1374    13681        %K$NQDP_HDR (NAME=NQDP_HDR,MSGTYPE=OSI_DATA,ALGN=ALIGNED,STCLASS=AUTO);
     1375    13758    1   DCL FIXED$ PTR;
     1376    13759    1   DCL SEG$ PTR;
     1377    13760    1   DCL TFRAG$ PTR;
     1378    13761    1   DCL DATA$ PTR;
     1379    13762    1   DCL HDR$ PTR;
     1380    13763    1   DCL SRC$ PTR;
     1381    13764    1   DCL DST$ PTR;
     1382    13765
     1383    13766    1   DCL DATASIZE UBIN;
     1384    13767    1   DCL I UBIN;
     1385    13768    1   DCL SIZE UBIN;
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:232  
     1386    13769
     1387    13770
     1388    13771    1      DATASIZE = KN$NETPARM.NHDRSZ - K$NPDU_FIXED.LENGTH;

  13771   2 000005  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          2 000007  DCC6 000E                            LDB,B5   14,B6
          2 000009  E805                                 LDR,R6   ,B5
          2 00000A  E570 00FF                            AND,R6   255,IMO
          2 00000C  E246 0010                            SUB,R6   16,B6
          2 00000E  8256                                 NEG      R6
          2 00000F  EF47 001A                            STR,R6   DATASIZE,AUTO

     1389    13772    1      HDR$ = KNN_RASSMHD$;

  13772   2 000011  CC80 0000 0000  xsym                 LDB,B4   KNN_RASSMHD$
          2 000014  CFC7 0014                            STB,B4   HDR$,AUTO

     1390    13773    2      DO WHILE HDR$ ~= ADDR(NIL);

  13773   2 000016  0F81 01C8                            B        s:13888,PREL

     1391    13774    2         IF K$NHDR.DATAID = K$NPDU_SEGMENT.DATAID AND

  13774   2 000018  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          2 00001A  DCC6 0019                            LDB,B5   25,B6
          2 00001C  CCC7 0014                            LDB,B4   HDR$,AUTO
          2 00001E  E844 0027                            LDR,R6   39,B4
          2 000020  E905                                 CMR,R6   ,B5
          2 000021  0981 01B9                            BNE      s:13887,PREL
          2 000023  BCC6 001D                            LDB,B3   29,B6
          2 000025  D283                                 LLH,R5   ,B3
          2 000026  C855                                 LDR,R4   R5
          2 000027  DA70 2000                            ADD,R5   8192,IMO
          2 000029  0022                                 ACM      ;
          2 00002A       4003 0000                                ALPHANUM(0,B3,,R4,FILL),;
          2 00002C       4004 000A                                ALPHANUM(10,B4,,R5,FILL)
          2 00002E  5301 01AC                            CBNE     s:13887,PREL
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:233  
          2 000030  ACC6 001F                            LDB,B2   31,B6
          2 000032  D282                                 LLH,R5   ,B2
          2 000033  C855                                 LDR,R4   R5
          2 000034  DA70 2000                            ADD,R5   8192,IMO
          2 000036  0022                                 ACM      ;
          2 000037       4002 0000                                ALPHANUM(0,B2,,R4,FILL),;
          2 000039       4004 0015                                ALPHANUM(21,B4,,R5,FILL)
          2 00003B  5301 019F                            CBNE     s:13887,PREL

     1392    13775    2           SUBSTR(ADDR(SOURCE)->ADDRESS,0,SOURCE.LEN) =
     1393    13776    2           SUBSTR(ADDR(K$NHDR.SOURCE)->ADDRESS,0,SOURCE.LEN) AND
     1394    13777    2           SUBSTR(ADDR(DESTINATION)->ADDRESS,0,DESTINATION.LEN) =
     1395    13778    3           SUBSTR(ADDR(K$NHDR.DESTINATION)->ADDRESS,0,DESTINATION.LEN) THEN DO;

     1396    13779    3            TFRAG$ = K$NHDR.FRAG$;

  13779   2 00003D  9CC4 0006                            LDB,B1   6,B4
          2 00003F  9FC7 0010                            STB,B1   TFRAG$,AUTO

     1397    13780    4            DO WHILE TFRAG$ ~= ADDR(NIL);

  13780   2 000041  0F81 001E                            B        s:13788,PREL

     1398    13781    5               IF K$NPDU_SEGMENT.OFFSET = K$NFRAG.OFFSET THEN DO;

  13781   2 000043  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          2 000045  DCC6 0019                            LDB,B5   25,B6
          2 000047  CCC7 0010                            LDB,B4   TFRAG$,AUTO
          2 000049  E845 0001                            LDR,R6   1,B5
          2 00004B  E944 0003                            CMR,R6   3,B4
          2 00004D  0981 0012                            BNE      s:13788,PREL

     1399    13782    6                  IF K$NFRAG.LENGTH = DATASIZE THEN DO;

  13782   2 00004F  D844 0004                            LDR,R5   4,B4
          2 000051  D947 001A                            CMR,R5   DATASIZE,AUTO
          2 000053  0981 0008                            BNE      s:13786,PREL
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:234  

     1400    13783    6                     KN$NETPARM.ERRCODE = %K_DSCRD_REASSEM;
             13783                              /* discard duplicate packets*/

  13783   2 000055  C870 00C0                            LDR,R4   192,IMO
          2 000057  CF46 0016                            STR,R4   22,B6

     1401    13784    6                     ALTRETURN;

  13784   2 000059  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1402    13785    6                     END;
     1403    13786    5                  TFRAG$ = K$NFRAG.LINK$;

  13786   2 00005C  BCC4 0001                            LDB,B3   1,B4
          2 00005E  BFC7 0010                            STB,B3   TFRAG$,AUTO

     1404    13787    5                  END;

     1405    13788    4               END;                        /* do while                 */

  13788   2 000060  8DC7 0010                            CMN      TFRAG$,AUTO
          2 000062  09E1                                 BNE      s:13781,SPREL

     1406    13789
     1407    13790    3            SIZE = SIZEW(K$NFRAG);

  13790   2 000063  6C05                                 LDV,R6   5
          2 000064  EF47 001C                            STR,R6   SIZE,AUTO

     1408    13791    4            CALL KVB$GET2NSYS(SIZE,TFRAG$) WHENALTRETURN DO;

  13791   2 000066  DBC7 0010                            LAB,B5   TFRAG$,AUTO
          2 000068  DFC7 0020                            STB,B5   SIZE+4,AUTO
          2 00006A  CBC7 001C                            LAB,B4   SIZE,AUTO
          2 00006C  CFC7 001E                            STB,B4   SIZE+2,AUTO
          2 00006E  BBC7 001E                            LAB,B3   SIZE+2,AUTO
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:235  
          2 000070  CBF0 0200                            LAB,B4   512,IMO
          2 000072  E380 0000 0000  xent                 LNJ,B6   KVB$GET2NSYS
          2 000075       0003                            DC       s:13792,PREL
          2 000076  0F81 0009                            B        s:13796,PREL

     1409    13792    4               KN$NETPARM.ERRCODE = %K_DSCRD_CONGEST;

  13792   2 000078  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          2 00007A  6C03                                 LDV,R6   3
          2 00007B  EF46 0016                            STR,R6   22,B6

     1410    13793    4               ALTRETURN;

  13793   2 00007D  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1411    13794    4               END;
     1412    13795
     1413    13796    3            K$NFRAG.BFRSIZ = SIZE;

  13796   2 000080  ECC7 0010                            LDB,B6   TFRAG$,AUTO
          2 000082  E847 001C                            LDR,R6   SIZE,AUTO
          2 000084  EF06                                 STR,R6   ,B6

     1414    13797    3            K$NFRAG.OFFSET = K$NPDU_SEGMENT.OFFSET;

  13797   2 000085  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          2 000087  DCC6 0019                            LDB,B5   25,B6
          2 000089  CCC7 0010                            LDB,B4   TFRAG$,AUTO
          2 00008B  E845 0001                            LDR,R6   1,B5
          2 00008D  EF44 0003                            STR,R6   3,B4

     1415    13798    3            K$NFRAG.LENGTH = DATASIZE;

  13798   2 00008F  DCC7 0010                            LDB,B5   TFRAG$,AUTO
          2 000091  E847 001A                            LDR,R6   DATASIZE,AUTO
          2 000093  EF45 0004                            STR,R6   4,B5

PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:236  
     1416    13799    3            K$NFRAG.LINK$ = K$NHDR.FRAG$;

  13799   2 000095  DCC7 0014                            LDB,B5   HDR$,AUTO
          2 000097  CCC5 0006                            LDB,B4   6,B5
          2 000099  BCC7 0010                            LDB,B3   TFRAG$,AUTO
          2 00009B  CFC3 0001                            STB,B4   1,B3

     1417    13800    3            K$NHDR.FRAG$ = TFRAG$;

  13800   2 00009D  DCC7 0010                            LDB,B5   TFRAG$,AUTO
          2 00009F  CCC7 0014                            LDB,B4   HDR$,AUTO
          2 0000A1  DFC4 0006                            STB,B5   6,B4

     1418    13801    3            SUBSTR(K$NHDR.HDR$->ADDRESS,K$NHDR.DATAOFFSET+K$NPDU_SEGMENT.OFFSET,
             13801                     DATASIZE-1) =

  13801   2 0000A3  DCC7 0014                            LDB,B5   HDR$,AUTO
          2 0000A5  CCC5 0020                            LDB,B4   32,B5
          2 0000A7  BCC6 0019                            LDB,B3   25,B6
          2 0000A9  D845 0024                            LDR,R5   36,B5
          2 0000AB  DA43 0001                            ADD,R5   1,B3
          2 0000AD  ACC6 000E                            LDB,B2   14,B6
          2 0000AF  C846 0010                            LDR,R4   16,B6
          2 0000B1  C246 000D                            SUB,R4   13,B6
          2 0000B3  A854                                 LDR,R2   R4
          2 0000B4  6EFF                                 ADV,R6   -1
          2 0000B5  BB84                                 LAB,B3   ,B4
          2 0000B6  B855                                 LDR,R3   R5
          2 0000B7  0008                                 MMM

     1419    13802    3              SUBSTR(KN$NETPARM.NHDR$->ADDRESS,KN$NETPARM.NHDRSZ-KN$NETPARM.THDRSZ,
             13802                       DATASIZE-1);
     1420    13803
     1421    13804        /*
     1422    13805             are we done receiving data
     1423    13806        */
     1424    13807    3            K$NHDR.RECVSZ = K$NHDR.RECVSZ + DATASIZE;
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:237  

  13807   2 0000B8  DCC7 0014                            LDB,B5   HDR$,AUTO
          2 0000BA  E845 0026                            LDR,R6   38,B5
          2 0000BC  EA47 001A                            ADD,R6   DATASIZE,AUTO
          2 0000BE  EF45 0026                            STR,R6   38,B5

     1425    13808    4            IF K$NHDR.RECVSZ = K$NHDR.DATASZ THEN DO;

  13808   2 0000C0  E945 0025                            CMR,R6   37,B5
          2 0000C2  0981 0115                            BNE      s:13885,PREL

     1426    13809    4               KN$NETPARM.FUNCTION = %K_NDATA;

  13809   2 0000C4  5C21                                 LDV,R5   33
          2 0000C5  DF46 0014                            STR,R5   20,B6

     1427    13810    4               KN$NETPARM.NHDR$ = K$NHDR.HDR$;

  13810   2 0000C7  DCC7 0014                            LDB,B5   HDR$,AUTO
          2 0000C9  ACC5 0020                            LDB,B2   32,B5
          2 0000CB  AFC6 000E                            STB,B2   14,B6

     1428    13811    4               KN$NETPARM.THDR_C$ = PINCRC(K$NHDR.HDR$,K$NHDR.DATAOFFSET);

  13811   2 0000CD  DCC7 0014                            LDB,B5   HDR$,AUTO
          2 0000CF  B845 0024                            LDR,R3   36,B5
          2 0000D1  9CC5 0020                            LDB,B1   32,B5
          2 0000D3  9FC7 001E                            STB,B1   SIZE+2,AUTO
          2 0000D5  8CC7 001E                            LDI      SIZE+2,AUTO
          2 0000D7  7031                                 DCL,R7   1
          2 0000D8  8D47 0020                            SDI      SIZE+4,AUTO
          2 0000DA  F853                                 LDR,R7   R3
          2 0000DB  6C00                                 LDV,R6   0
          2 0000DC  8447 0020                            AID      SIZE+4,AUTO
          2 0000DE  7071                                 DCR,R7   1
          2 0000DF  8D46 000B                            SDI      11,B6

PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:238  
     1429    13812    4               KN$NETPARM.NHDRSZ = K$NHDR.DATASZ;

  13812   2 0000E1  DCC7 0014                            LDB,B5   HDR$,AUTO
          2 0000E3  C845 0025                            LDR,R4   37,B5
          2 0000E5  CF46 0010                            STR,R4   16,B6

     1430    13813    4               KN$NETPARM.THDRSZ = K$NHDR.DATASZ - K$NHDR.DATAOFFSET;

  13813   2 0000E7  DCC7 0014                            LDB,B5   HDR$,AUTO
          2 0000E9  A845 0025                            LDR,R2   37,B5
          2 0000EB  A245 0024                            SUB,R2   36,B5
          2 0000ED  AF46 000D                            STR,R2   13,B6

     1431    13814    4               KN$NETPARM.UHDRSZ = 0;

  13814   2 0000EF  8746 0007                            CL       7,B6

     1432    13815    4               KN$NETPARM.RECTYPE = 0;

  13815   2 0000F1  8746 0013                            CL       19,B6

     1433    13816    5               CALL KNT$RECV_4HOST(KN$NETPARM) WHENRETURN DO;

  13816   2 0000F3  BBC7 0004                            LAB,B3   @KN$NETPARM,AUTO
          2 0000F5  CBF0 0100                            LAB,B4   256,IMO
          2 0000F7  E380 0000 0000  xent                 LNJ,B6   KNT$RECV_4HOST
          2 0000FA       0007                            DC       s:13823,PREL

     1434    13817    5                  KN$NETPARM.THDRSZ = 0;

  13817   2 0000FB  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          2 0000FD  8746 000D                            CL       13,B6

     1435    13818    5                  END;

  13818   2 0000FF  0F81 0003                            B        s:13829,PREL

PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:239  
     1436    13819    5               WHENALTRETURN DO;

     1437    13820        /*
     1438    13821             either transport buffered the message or there was a real error.
     1439    13822        */
     1440    13823    5                  GOTO RLSMEM;

  13823   2 000101  0F81 003D                            B        s:13844,PREL

     1441    13824    5                  END;
     1442    13825        /*
     1443    13826             all of this code can probably be discarded.  Transport really call knn$send
     1444    13827             to get the message forwarded.
     1445    13828        */
     1446    13829    4               KN$NETPARM.LDCT$ = KNN$ROUTE$(KN$NETPARM.NODE)->KNN$ROUTE.LINK$->
             13829                        KNN$LINK.LDCT$;

  13829   2 000103  B846 0015                            LDR,R3   21,B6
          2 000105  DC80 0000 0000  xsym                 LDB,B5   KNN_ROUTE$$
          2 000108  CCB5                                 LDB,B4   ,B5,R3
          2 000109  BC84                                 LDB,B3   ,B4
          2 00010A  AC83                                 LDB,B2   ,B3
          2 00010B  AF86                                 STB,B2   ,B6

     1447    13830    4               NQDP_HDR = K$NQDP_HDR_C;

  13830   2 00010C  8C80 0000 0000  00                   LDI      K$NQDP_HDR_C
          2 00010F  8D47 000A                            SDI      NQDP_HDR,AUTO

     1448    13831    4               NQDP_HDR.DEST_NODE = KN$NETPARM.NODE+1;

  13831   2 000111  3E01                                 ADV,R3   1
          2 000112  B7C7 000B                            STH,R3   NQDP_HDR+1,AUTO

     1449    13832    4               NQDP_HDR.SOURCE_NODE = KN_NODE#+1;

  13832   2 000114  D800 0000 0000  xsym                 LDR,R5   KN_NODE#
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:240  
          2 000117  5E01                                 ADV,R5   1
          2 000118  DAC7 000B                            SRM,R5,'00FF'X    NQDP_HDR+1,AUTO
          2 00011A       00FF

     1450    13833    4               KN$NETPARM.NHDR$ = ADDR(NQDP_HDR);

  13833   2 00011B  DBC7 000A                            LAB,B5   NQDP_HDR,AUTO
          2 00011D  DFC6 000E                            STB,B5   14,B6

     1451    13834    4               KN$NETPARM.NHDRSZ = LENGTHC(NQDP_HDR);

  13834   2 00011F  4C04                                 LDV,R4   4
          2 000120  CF46 0010                            STR,R4   16,B6

     1452    13835    5               IF KN$NETPARM.LDCT$ = ADDR(NIL) THEN DO;

  13835   2 000122  8D86                                 CMN      ,B6
          2 000123  0981 0007                            BNE      s:13839,PREL

     1453    13836    5                  KN$NETPARM.ERRCODE = %K_DSCRD_DSTUNREACH;

  13836   2 000125  A870 0080                            LDR,R2   128,IMO
          2 000127  AF46 0016                            STR,R2   22,B6

     1454    13837    5                  END;

  13837   2 000129  0F81 0015                            B        s:13844,PREL

     1455    13838    5               ELSE DO;

     1456    13839    6                  CALL KNH$SEND(KN$NETPARM) WHENALTRETURN DO;

  13839   2 00012B  BBC7 0004                            LAB,B3   @KN$NETPARM,AUTO
          2 00012D  CBF0 0100                            LAB,B4   256,IMO
          2 00012F  E380 0000 0000  xent                 LNJ,B6   KNH$SEND
          2 000132       0003                            DC       s:13840,PREL
          2 000133  0F81 000B                            B        s:13844,PREL
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:241  

     1457    13840    7                     IF KN$NETPARM.ERRCODE = %KN_ERR_Q2SMALL THEN DO;

  13840   2 000135  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          2 000137  E846 0016                            LDR,R6   22,B6
          2 000139  6D04                                 CMV,R6   4
          2 00013A  0981 0004                            BNE      s:13844,PREL

     1458    13841    7                        KN$NETPARM.ERRCODE = %K_DSCRD_CONGEST; /* should really seg*/

  13841   2 00013C  6C03                                 LDV,R6   3
          2 00013D  EF46 0016                            STR,R6   22,B6

     1459    13842    7                        END;

     1460    13843    6                     END;

     1461    13844    5                  END;

     1462    13845        /*
     1463    13846             release the memory
     1464    13847        */
     1465    13848    4   RLSMEM:
     1466    13849    5               IF K$NHDR.BLINK$ = ADDR(NIL) THEN DO;

  13849   2 00013F  ECC7 0014            RLSMEM          LDB,B6   HDR$,AUTO
          2 000141  8DC6 0004                            CMN      4,B6
          2 000143  0981 0012                            BNE      s:13858,PREL

     1467    13850        /*
     1468    13851             at head
     1469    13852        */
     1470    13853    5                  KNN_RASSMHD$ = K$NHDR.FLINK$;

  13853   2 000145  DCC6 0002                            LDB,B5   2,B6
          2 000147  DF80 0000 0000  xsym                 STB,B5   KNN_RASSMHD$

PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:242  
     1471    13854    5                  IF KNN_RASSMHD$ ~= ADDR(NIL) THEN

  13854   2 00014A  8D80 0000 0000  xsym                 CMN      KNN_RASSMHD$
          2 00014D  0901 000E                            BE       s:13860,PREL

     1472    13855    5                     KNN_RASSMHD$->K$NHDR.BLINK$ = ADDR(NIL);

  13855   2 00014F  CB80 0000 0000                       LAB,B4   0
          2 000152  CFC5 0004                            STB,B4   4,B5

     1473    13856    5                  END;

  13856   2 000154  0F81 0007                            B        s:13860,PREL

     1474    13857    4               ELSE
     1475    13858    4                  K$NHDR.BLINK$->K$NHDR.FLINK$ = K$NHDR.FLINK$;

  13858   2 000156  DCC6 0004                            LDB,B5   4,B6
          2 000158  CCC6 0002                            LDB,B4   2,B6
          2 00015A  CFC5 0002                            STB,B4   2,B5

     1476    13859
     1477    13860    5               IF K$NHDR.FLINK$ = ADDR(NIL) THEN DO; /* at the tail    */

  13860   2 00015C  ECC7 0014                            LDB,B6   HDR$,AUTO
          2 00015E  8DC6 0002                            CMN      2,B6
          2 000160  0981 0012                            BNE      s:13866,PREL

     1478    13861    5                  KNN_RASSMTL$ = K$NHDR.BLINK$;

  13861   2 000162  DCC6 0004                            LDB,B5   4,B6
          2 000164  DF80 0000 0000  xsym                 STB,B5   KNN_RASSMTL$

     1479    13862    5                  IF KNN_RASSMTL$ ~= ADDR(NIL) THEN

  13862   2 000167  8D80 0000 0000  xsym                 CMN      KNN_RASSMTL$
          2 00016A  0901 000E                            BE       s:13868,PREL
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:243  

     1480    13863    5                     KNN_RASSMTL$->K$NHDR.FLINK$ = ADDR(NIL);

  13863   2 00016C  CB80 0000 0000                       LAB,B4   0
          2 00016F  CFC5 0002                            STB,B4   2,B5

     1481    13864    5                  END;

  13864   2 000171  0F81 0007                            B        s:13868,PREL

     1482    13865    4               ELSE
     1483    13866    4                  K$NHDR.FLINK$->K$NHDR.BLINK$ = K$NHDR.BLINK$;

  13866   2 000173  DCC6 0002                            LDB,B5   2,B6
          2 000175  CCC6 0004                            LDB,B4   4,B6
          2 000177  CFC5 0004                            STB,B4   4,B5

     1484    13867
     1485    13868    5               DO WHILE K$NHDR.FRAG$ ~= ADDR(NIL);

  13868   2 000179  0F81 0026                            B        s:13874,PREL

     1486    13869    5                  TFRAG$ = K$NHDR.FRAG$->K$NFRAG.LINK$;

  13869   2 00017B  ECC7 0014                            LDB,B6   HDR$,AUTO
          2 00017D  DCC6 0006                            LDB,B5   6,B6
          2 00017F  CCC5 0001                            LDB,B4   1,B5
          2 000181  CFC7 0010                            STB,B4   TFRAG$,AUTO

     1487    13870    6                  CALL KVB$RLS2NSYS(K$NHDR.FRAG$->K$NFRAG) WHENALTRETURN DO;

  13870   2 000183  DCC6 0006                            LDB,B5   6,B6
          2 000185  DFC7 001E                            STB,B5   SIZE+2,AUTO
          2 000187  BBC7 001E                            LAB,B3   SIZE+2,AUTO
          2 000189  CBF0 0100                            LAB,B4   256,IMO
          2 00018B  E380 0000 0000  xent                 LNJ,B6   KVB$RLS2NSYS
          2 00018E       0003                            DC       s:13871,PREL
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:244  
          2 00018F  0F81 000A                            B        s:13873,PREL

     1488    13871    6                     CALL SCREECH(PRTCLERR);

  13871   2 000191  BB80 0000 0000  03                   LAB,B3   0
          2 000194  CBF0 0100                            LAB,B4   256,IMO
          2 000196  E380 0000 0000  xent                 LNJ,B6   SCREECH
          2 000199       0001                            DC       s:13873,PREL

     1489    13872    6                     END;

     1490    13873    5                  K$NHDR.FRAG$ = TFRAG$;

  13873   2 00019A  ECC7 0010                            LDB,B6   TFRAG$,AUTO
          2 00019C  DCC7 0014                            LDB,B5   HDR$,AUTO
          2 00019E  EFC5 0006                            STB,B6   6,B5

     1491    13874    5                  END;

  13874   2 0001A0  ECC7 0014                            LDB,B6   HDR$,AUTO
          2 0001A2  8DC6 0006                            CMN      6,B6
          2 0001A4  09D7                                 BNE      s:13869,SPREL

     1492    13875
     1493    13876    5               CALL KVB$RLS2NSYS(K$NHDR.HDR$->ADDRESS) WHENALTRETURN DO;

  13876   2 0001A5  DCC6 0020                            LDB,B5   32,B6
          2 0001A7  DFC7 001E                            STB,B5   SIZE+2,AUTO
          2 0001A9  BBC7 001E                            LAB,B3   SIZE+2,AUTO
          2 0001AB  CBF0 0100                            LAB,B4   256,IMO
          2 0001AD  E380 0000 0000  xent                 LNJ,B6   KVB$RLS2NSYS
          2 0001B0       0003                            DC       s:13877,PREL
          2 0001B1  0F81 000A                            B        s:13880,PREL

     1494    13877    5                  CALL SCREECH(PRTCLERR);

  13877   2 0001B3  BB80 0000 0000  03                   LAB,B3   0
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:245  
          2 0001B6  CBF0 0100                            LAB,B4   256,IMO
          2 0001B8  E380 0000 0000  xent                 LNJ,B6   SCREECH
          2 0001BB       0001                            DC       s:13880,PREL

     1495    13878    5                  END;

     1496    13879
     1497    13880    5               CALL KVB$RLS2NSYS(K$NHDR) WHENALTRETURN DO;

  13880   2 0001BC  BBC7 0014                            LAB,B3   HDR$,AUTO
          2 0001BE  CBF0 0100                            LAB,B4   256,IMO
          2 0001C0  E380 0000 0000  xent                 LNJ,B6   KVB$RLS2NSYS
          2 0001C3       0003                            DC       s:13881,PREL
          2 0001C4  0F81 000A                            B        s:13883,PREL

     1498    13881    5                  CALL SCREECH(PRTCLERR);

  13881   2 0001C6  BB80 0000 0000  03                   LAB,B3   0
          2 0001C9  CBF0 0100                            LAB,B4   256,IMO
          2 0001CB  E380 0000 0000  xent                 LNJ,B6   SCREECH
          2 0001CE       0001                            DC       s:13883,PREL

     1499    13882    5                  END;

     1500    13883    4               IF KN$NETPARM.ERRCODE ~= 0 THEN ALTRETURN;

  13883   2 0001CF  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          2 0001D1  E846 0016                            LDR,R6   22,B6
          2 0001D3  6901 0004                            BEZ,R6   s:13885,PREL

  13883   2 0001D5  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1501    13884    4               END;                        /* datasz = expected size   */
     1502    13885    3            RETURN;

  13885   2 0001D8  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:246  
     1503    13886    3            END;
     1504    13887    2         HDR$ = K$NHDR.FLINK$;

  13887   2 0001DB  BCC4 0002                            LDB,B3   2,B4
          2 0001DD  BFC7 0014                            STB,B3   HDR$,AUTO

     1505    13888    2         END;

  13888   2 0001DF  8DC7 0014                            CMN      HDR$,AUTO
          2 0001E1  0981 FE36                            BNE      s:13774,PREL

     1506    13889
     1507    13890        /*
     1508    13891             no fragments for this dataid, yet.
     1509    13892        */
     1510    13893    1      SIZE = SIZEW(K$NHDR);

  13893   2 0001E3  6C29                                 LDV,R6   41
          2 0001E4  EF47 001C                            STR,R6   SIZE,AUTO

     1511    13894    2      CALL KVB$GET2NSYS(SIZE,HDR$) WHENALTRETURN DO;

  13894   2 0001E6  DBC7 0014                            LAB,B5   HDR$,AUTO
          2 0001E8  DFC7 0020                            STB,B5   SIZE+4,AUTO
          2 0001EA  CBC7 001C                            LAB,B4   SIZE,AUTO
          2 0001EC  CFC7 001E                            STB,B4   SIZE+2,AUTO
          2 0001EE  BBC7 001E                            LAB,B3   SIZE+2,AUTO
          2 0001F0  CBF0 0200                            LAB,B4   512,IMO
          2 0001F2  E380 0000 0000  xent                 LNJ,B6   KVB$GET2NSYS
          2 0001F5       0003                            DC       s:13895,PREL
          2 0001F6  0F81 0009                            B        s:13898,PREL

     1512    13895    2         KN$NETPARM.ERRCODE = %K_DSCRD_CONGEST;

  13895   2 0001F8  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          2 0001FA  6C03                                 LDV,R6   3
          2 0001FB  EF46 0016                            STR,R6   22,B6
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:247  

     1513    13896    2         ALTRETURN;

  13896   2 0001FD  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1514    13897    2         END;
     1515    13898    1      K$NHDR.BFRSIZ = SIZE;                /*  returned from kvb*/

  13898   2 000200  ECC7 0014                            LDB,B6   HDR$,AUTO
          2 000202  E847 001C                            LDR,R6   SIZE,AUTO
          2 000204  EF06                                 STR,R6   ,B6

     1516    13899        /*
     1517    13900           get enough memory to hold complete fragment, network addresses plus one
     1518    13901           word for buffer size
     1519    13902        */
     1520    13903    1      SIZE = ((KN$NETPARM.NHDRSZ+1)/2)+1;

  13903   2 000205  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          2 000207  E846 0010                            LDR,R6   16,B6
          2 000209  6E01                                 ADV,R6   1
          2 00020A  6041                                 SOR,R6   1
          2 00020B  6E01                                 ADV,R6   1
          2 00020C  EF47 001C                            STR,R6   SIZE,AUTO

     1521    13904    2      CALL KVB$GET2NSYS(SIZE,K$NHDR.HDR$) WHENALTRETURN DO;

  13904   2 00020E  DCC7 0014                            LDB,B5   HDR$,AUTO
          2 000210  CBC5 0020                            LAB,B4   32,B5
          2 000212  CFC7 0020                            STB,B4   SIZE+4,AUTO
          2 000214  BBC7 001C                            LAB,B3   SIZE,AUTO
          2 000216  BFC7 001E                            STB,B3   SIZE+2,AUTO
          2 000218  BBC7 001E                            LAB,B3   SIZE+2,AUTO
          2 00021A  CBF0 0200                            LAB,B4   512,IMO
          2 00021C  E380 0000 0000  xent                 LNJ,B6   KVB$GET2NSYS
          2 00021F       0003                            DC       s:13905,PREL
          2 000220  0F81 0009                            B        s:13908,PREL
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:248  

     1522    13905    2         KN$NETPARM.ERRCODE = %K_DSCRD_CONGEST;

  13905   2 000222  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          2 000224  6C03                                 LDV,R6   3
          2 000225  EF46 0016                            STR,R6   22,B6

     1523    13906    2         ALTRETURN;

  13906   2 000227  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1524    13907    2         END;
     1525    13908    1      HDR$->UBINBSD = SIZE;

  13908   2 00022A  ECC7 0014                            LDB,B6   HDR$,AUTO
          2 00022C  E847 001C                            LDR,R6   SIZE,AUTO
          2 00022E  EF06                                 STR,R6   ,B6

     1526    13909
     1527    13910    1      SIZE = SIZEW(K$NFRAG);

  13910   2 00022F  6C05                                 LDV,R6   5
          2 000230  EF47 001C                            STR,R6   SIZE,AUTO

     1528    13911    2      CALL KVB$GET2NSYS(SIZE,TFRAG$) WHENALTRETURN DO;

  13911   2 000232  EBC7 0010                            LAB,B6   TFRAG$,AUTO
          2 000234  EFC7 0020                            STB,B6   SIZE+4,AUTO
          2 000236  DBC7 001C                            LAB,B5   SIZE,AUTO
          2 000238  DFC7 001E                            STB,B5   SIZE+2,AUTO
          2 00023A  BBC7 001E                            LAB,B3   SIZE+2,AUTO
          2 00023C  CBF0 0200                            LAB,B4   512,IMO
          2 00023E  E380 0000 0000  xent                 LNJ,B6   KVB$GET2NSYS
          2 000241       0003                            DC       s:13912,PREL
          2 000242  0F81 0009                            B        s:13916,PREL

     1529    13912    2         KN$NETPARM.ERRCODE = %K_DSCRD_CONGEST;
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:249  

  13912   2 000244  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          2 000246  6C03                                 LDV,R6   3
          2 000247  EF46 0016                            STR,R6   22,B6

     1530    13913    2         ALTRETURN;

  13913   2 000249  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1531    13914    2         END;
     1532    13915
     1533    13916    1      K$NFRAG.BFRSIZ = SIZE;

  13916   2 00024C  ECC7 0010                            LDB,B6   TFRAG$,AUTO
          2 00024E  E847 001C                            LDR,R6   SIZE,AUTO
          2 000250  EF06                                 STR,R6   ,B6

     1534    13917    1      K$NHDR.DATAID = K$NPDU_SEGMENT.DATAID;

  13917   2 000251  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          2 000253  DCC6 0019                            LDB,B5   25,B6
          2 000255  CCC7 0014                            LDB,B4   HDR$,AUTO
          2 000257  E805                                 LDR,R6   ,B5
          2 000258  EF44 0027                            STR,R6   39,B4

     1535    13918    1      K$NHDR.SRCNODE# = SRCROUTE.FEP#;

  13918   2 00025A  DCC7 0008                            LDB,B5   @SRCROUTE,AUTO
          2 00025C  D845 0001                            LDR,R5   1,B5
          2 00025E  DAC4 0028                            SRM,R5,'00FF'X    40,B4
          2 000260       00FF

     1536    13919    1      K$NHDR.DSTNODE# = DSTROUTE.HOST#;

  13919   2 000261  BCC7 0006                            LDB,B3   @DSTROUTE,AUTO
          2 000263  D2C3 0001                            LLH,R5   1,B3
          2 000265  D7C4 0028                            STH,R5   40,B4
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:250  

     1537    13920    1      K$NHDR.BLINK$ = ADDR(NIL);

  13920   2 000267  AB80 0000 0000                       LAB,B2   0
          2 00026A  AFC4 0004                            STB,B2   4,B4

     1538    13921    1      K$NHDR.FLINK$ = ADDR(NIL);

  13921   2 00026C  CB80 0000 0000                       LAB,B4   0
          2 00026F  ACC7 0014                            LDB,B2   HDR$,AUTO
          2 000271  CFC2 0002                            STB,B4   2,B2

     1539    13922    1      K$NHDR.RECVSZ = DATASIZE;

  13922   2 000273  CCC7 0014                            LDB,B4   HDR$,AUTO
          2 000275  E847 001A                            LDR,R6   DATASIZE,AUTO
          2 000277  EF44 0026                            STR,R6   38,B4

     1540    13923    1      K$NHDR.DATASZ = K$NPDU_SEGMENT.TOTLEN - K$NPDU_FIXED.LENGTH;

  13923   2 000279  ACC6 0019                            LDB,B2   25,B6
          2 00027B  9CC6 000E                            LDB,B1   14,B6
          2 00027D  D801                                 LDR,R5   ,B1
          2 00027E  D570 00FF                            AND,R5   255,IMO
          2 000280  D242 0002                            SUB,R5   2,B2
          2 000282  8255                                 NEG      R5
          2 000283  DF44 0025                            STR,R5   37,B4

     1541    13924    1      K$NHDR.REASSEMTIM = K$NPDU_FIXED.LIFETIME * 50;

  13924   2 000285  ACC6 000E                            LDB,B2   14,B6
          2 000287  F842 0001                            LDR,R7   1,B2
          2 000289  F570 00FF                            AND,R7   255,IMO
          2 00028B  6C00                                 LDV,R6   0
          2 00028C  9B80 0000 0002  03                   LAB,B1   +2
          2 00028F  D380 0000 0000  xent                 LNJ,B5   X6D_MID
          2 000292  ECC7 0014                            LDB,B6   HDR$,AUTO
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:251  
          2 000294  8D46 0008                            SDI      8,B6

     1542    13925    1      IF K$NHDR.REASSEMTIM > KNN_REASSEMTIME THEN

  13925   2 000296  ECC7 0014                            LDB,B6   HDR$,AUTO
          2 000298  F800 0000 0000  xsym                 LDR,R7   KNN_REASSEMTIME
          2 00029B  6C00                                 LDV,R6   0
          2 00029C  84C6 0008                            SID      8,B6
          2 00029E  0601 0007                            BCT      s:13928,PREL

     1543    13926    1         K$NHDR.REASSEMTIM = KNN_REASSEMTIME;

  13926   2 0002A0  F800 0000 0000  xsym                 LDR,R7   KNN_REASSEMTIME
          2 0002A3  6C00                                 LDV,R6   0
          2 0002A4  8D46 0008                            SDI      8,B6

     1544    13927
     1545    13928    1      SIZE = SOURCE.LEN;

  13928   2 0002A6  ECC7 0004                            LDB,B6   @KN$NETPARM,AUTO
          2 0002A8  DCC6 001D                            LDB,B5   29,B6
          2 0002AA  E285                                 LLH,R6   ,B5
          2 0002AB  EF47 001C                            STR,R6   SIZE,AUTO

     1546    13929    1      ADDR(K$NHDR.SOURCE)->ADDRESS = ADDR(SOURCE)->ADDRESS;

  13929   2 0002AD  AB85                                 LAB,B2   ,B5
          2 0002AE  2C00                                 LDV,R2   0
          2 0002AF  BCC7 0014                            LDB,B3   HDR$,AUTO
          2 0002B1  3C14                                 LDV,R3   20
          2 0002B2  0008                                 MMM

     1547    13930    1      SIZE = DESTINATION.LEN;

  13930   2 0002B3  CCC6 001F                            LDB,B4   31,B6
          2 0002B5  E284                                 LLH,R6   ,B4
          2 0002B6  EF47 001C                            STR,R6   SIZE,AUTO
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:252  

     1548    13931    1      ADDR(K$NHDR.DESTINATION)->ADDRESS = ADDR(DESTINATION)->ADDRESS;

  13931   2 0002B8  AB84                                 LAB,B2   ,B4
          2 0002B9  2C00                                 LDV,R2   0
          2 0002BA  BCC7 0014                            LDB,B3   HDR$,AUTO
          2 0002BC  3C2A                                 LDV,R3   42
          2 0002BD  0008                                 MMM

     1549    13932
     1550    13933    1      K$NHDR.DATAOFFSET = K$NPDU_FIXED.LENGTH+2; /* two bytes for buddy buffer size*/

  13933   2 0002BE  BCC6 000E                            LDB,B3   14,B6
          2 0002C0  9CC7 0014                            LDB,B1   HDR$,AUTO
          2 0002C2  E803                                 LDR,R6   ,B3
          2 0002C3  E570 00FF                            AND,R6   255,IMO
          2 0002C5  6E02                                 ADV,R6   2
          2 0002C6  EF41 0024                            STR,R6   36,B1

     1551    13934    1      K$NHDR.FRAG$ = TFRAG$;

  13934   2 0002C8  BCC7 0010                            LDB,B3   TFRAG$,AUTO
          2 0002CA  BFC1 0006                            STB,B3   6,B1

     1552    13935    1      K$NFRAG.LINK$ = ADDR(NIL);

  13935   2 0002CC  BB80 0000 0000                       LAB,B3   0
          2 0002CF  9CC7 0010                            LDB,B1   TFRAG$,AUTO
          2 0002D1  BFC1 0001                            STB,B3   1,B1

     1553    13936    1      K$NFRAG.OFFSET = K$NPDU_SEGMENT.OFFSET;

  13936   2 0002D3  BCC6 0019                            LDB,B3   25,B6
          2 0002D5  9CC7 0010                            LDB,B1   TFRAG$,AUTO
          2 0002D7  E843 0001                            LDR,R6   1,B3
          2 0002D9  EF41 0003                            STR,R6   3,B1

PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:253  
     1554    13937    1      K$NFRAG.LENGTH = DATASIZE;

  13937   2 0002DB  BCC7 0010                            LDB,B3   TFRAG$,AUTO
          2 0002DD  E847 001A                            LDR,R6   DATASIZE,AUTO
          2 0002DF  EF43 0004                            STR,R6   4,B3

     1555    13938        /*
     1556    13939           leave a word at the beginning of the buffer for the buddy space size
     1557    13940        */
     1558    13941    1      SUBSTR(K$NHDR.HDR$->ADDRESS,2,K$NPDU_FIXED.LENGTH) =

  13941   2 0002E1  BCC7 0014                            LDB,B3   HDR$,AUTO
          2 0002E3  9CC3 0020                            LDB,B1   32,B3
          2 0002E5  DCC6 000E                            LDB,B5   14,B6
          2 0002E7  D805                                 LDR,R5   ,B5
          2 0002E8  D570 00FF                            AND,R5   255,IMO
          2 0002EA  AB85                                 LAB,B2   ,B5
          2 0002EB  2C00                                 LDV,R2   0
          2 0002EC  E855                                 LDR,R6   R5
          2 0002ED  BB81                                 LAB,B3   ,B1
          2 0002EE  3C02                                 LDV,R3   2
          2 0002EF  0008                                 MMM

     1559    13942    1        SUBSTR(KN$NETPARM.NHDR$->ADDRESS,0,K$NPDU_FIXED.LENGTH);
     1560    13943
     1561    13944    1      SUBSTR(K$NHDR.HDR$->ADDRESS,K$NHDR.DATAOFFSET,K$NPDU_SEGMENT.OFFSET) =

  13944   2 0002F0  BCC7 0014                            LDB,B3   HDR$,AUTO
          2 0002F2  9CC3 0020                            LDB,B1   32,B3
          2 0002F4  DCC6 0019                            LDB,B5   25,B6
          2 0002F6  E843 0024                            LDR,R6   36,B3
          2 0002F8  C845 0001                            LDR,R4   1,B5
          2 0002FA  ACC6 000E                            LDB,B2   14,B6
          2 0002FC  A856                                 LDR,R2   R6
          2 0002FD  EF47 001E                            STR,R6   SIZE+2,AUTO
          2 0002FF  E854                                 LDR,R6   R4
          2 000300  BB81                                 LAB,B3   ,B1
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:254  
          2 000301  B847 001E                            LDR,R3   SIZE+2,AUTO
          2 000303  0008                                 MMM

     1562    13945    1        SUBSTR(KN$NETPARM.NHDR$->ADDRESS,K$NHDR.DATAOFFSET,K$NPDU_SEGMENT.OFFSET);
     1563    13946
     1564    13947    2      IF KNN_RASSMHD$ = ADDR(NIL) THEN DO;

  13947   2 000304  8D80 0000 0000  xsym                 CMN      KNN_RASSMHD$
          2 000307  0981 000B                            BNE      s:13952,PREL

     1565    13948    2         KNN_RASSMHD$ = HDR$;

  13948   2 000309  DCC7 0014                            LDB,B5   HDR$,AUTO
          2 00030B  DF80 0000 0000  xsym                 STB,B5   KNN_RASSMHD$

     1566    13949    2         KNN_RASSMTL$ = HDR$;

  13949   2 00030E  DF80 0000 0000  xsym                 STB,B5   KNN_RASSMTL$

     1567    13950    2         END;

  13950   2 000311  0F81 0011                            B        s:13956,PREL

     1568    13951    2      ELSE DO;

     1569    13952    2         KNN_RASSMTL$->K$NHDR.FLINK$ = HDR$;

  13952   2 000313  DCC7 0014                            LDB,B5   HDR$,AUTO
          2 000315  BC80 0000 0000  xsym                 LDB,B3   KNN_RASSMTL$
          2 000318  DFC3 0002                            STB,B5   2,B3

     1570    13953    2         K$NHDR.BLINK$ = KNN_RASSMTL$;

  13953   2 00031A  ACC7 0014                            LDB,B2   HDR$,AUTO
          2 00031C  BFC2 0004                            STB,B3   4,B2

     1571    13954    2         KNN_RASSMTL$ = HDR$;
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:255  

  13954   2 00031E  DCC7 0014                            LDB,B5   HDR$,AUTO
          2 000320  DF80 0000 0000  xsym                 STB,B5   KNN_RASSMTL$

     1572    13955    2         END;

     1573    13956    2      IF KNN_REASSEM_CLOCK = 0 THEN DO; /* start the reassembly clock  */

  13956   2 000323  E800 0000 0000  xsym                 LDR,R6   KNN_REASSEM_CLOCK
          2 000326  6981 0016                            BNEZ,R6  s:13961,PREL

     1574    13957    2         GH$TMR_BLK.PROC$ = ENTADDR(KNN$TIMER);

  13957   2 000328  BB80 0000 0000  xent                 LAB,B3   KNN$TIMER
          2 00032B  BF80 0000 0000  01                   STB,B3   GH$TMR_BLK

     1575    13958    2         GH$TMR_BLK.INTERVAL = KNN_LIFETIME_UNIT;

  13958   2 00032E  C800 0000 0000  xsym                 LDR,R4   KNN_LIFETIME_UNIT
          2 000331  CF00 0000 0003  01                   STR,R4   GH$TMR_BLK+3

     1576    13959    2         CALL GHS$SET_TMR(GH$TMR_BLK);

  13959   2 000334  BB80 0000 0004  03                   LAB,B3   +4
          2 000337  CBF0 0100                            LAB,B4   256,IMO
          2 000339  E380 0000 0000  xent                 LNJ,B6   GHS$SET_TMR
          2 00033C       0001                            DC       s:13961,PREL

     1577    13960    2         END;

     1578    13961    1      RETURN;

  13961   2 00033D  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     1579    13962    1   END KNN$REASSEM;
     1580    13963
     1581    13964        %EOD;

PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:256  
--  Include file information  --

   KL_MACRO_C.:E05TOU  is referenced.
   K_QDPHDRS_M.:E05TOU  is referenced.
   K_SCODE_C.:E05TOU  is referenced.
   GH_SCHD_M.:E05TOU  is referenced.
   KNN_NETWORK_M.:E05TOU  is referenced.
   K_INTERFACE_M.:E05TOU  is referenced.
   K_NETWORK_E.:E05TOU  is referenced.
   K_NETWORK_M.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KN_DATA_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KNN$REASSEM.
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:257  

 **** Variables and constants ****

  ****  Section 000 RoData KNN$REASSEM

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(32)    r     1 K$NQDP_HDR_C               2-0-0/w STRC(48)    r     1 PRTCLERR

  ****  Section 001  Data  KNN$REASSEM

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(160)   r     1 GH$TMR_BLK

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     6-0-0/w PTR         r     1 @DSTROUTE                  4-0-0/w PTR         r     1 @KN$NETPARM
     8-0-0/w PTR         r     1 @SRCROUTE                 1A-0-0/w UBIN(16)    r     1 DATASIZE
    *0-0-0/w STRC(480)   r     1 DSTROUTE                  14-0-0/w PTR         r     1 HDR$
    *0-0-0/w STRC(528)   r     1 KN$NETPARM                 A-0-0/w STRC(32)    r     1 NQDP_HDR
    1C-0-0/w UBIN(16)    r     1 SIZE                      *0-0-0/w STRC(480)   r     1 SRCROUTE
    10-0-0/w PTR         r     1 TFRAG$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN(16)    r     1 KNN_LIFETIME_UNIT          0-0-0/w PTR         r     1 KNN_LINK$$
     0-0-0/w PTR         r     1 KNN_RASSMHD$               0-0-0/w PTR         r     1 KNN_RASSMTL$
     0-0-0/w UBIN(16)    r     1 KNN_REASSEMTIME            0-0-0/w UBIN(16)    r     1 KNN_REASSEM_CLOCK
     0-0-0/w PTR         r     1 KNN_ROUTE$$                0-0-0/w UBIN(16)    r     1 KN_NODE#
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:258  

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c ACHR        r     1 ADDRESS                    0-0-0/c STRC(176)   r     1 DESTINATION
     0-0-0/w STRC(80)    r     1 K$NFRAG                    0-0-0/w STRC(656)   r     1 K$NHDR
     0-0-0/w STRC(72)    r     1 K$NPDU_FIXED               0-0-0/w STRC(48)    r     1 K$NPDU_SEGMENT
     0-0-0/c STRC(608)   r     1 KNN$LINK                   0-0-0/w STRC(208)   r     1 KNN$ROUTE
     0-0-0/w PTR         r     1 KNN$ROUTE$(0:0)
     0-0-0/c STRC(176)   r     1 SOURCE                     0-0-0/w UBIN(16)    r     1 UBINBSD


   Procedure KNN$REASSEM requires 832 words for executable code.
   Procedure KNN$REASSEM requires 34 words of local(AUTO) storage.
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:259  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:260  
          MINI XREF LISTING

ADDRESS
     13667**DCL     13774>>IF      13774>>IF      13774>>IF      13774>>IF      13801<<ASSIGN  13801>>ASSIGN
     13876<>CALL    13929<<ASSIGN  13929>>ASSIGN  13931<<ASSIGN  13931>>ASSIGN  13941<<ASSIGN  13941>>ASSIGN
     13944<<ASSIGN  13944>>ASSIGN
DATASIZE
     13766**DCL     13771<<ASSIGN  13782>>IF      13798>>ASSIGN  13801>>ASSIGN  13801>>ASSIGN  13807>>ASSIGN
     13922>>ASSIGN  13937>>ASSIGN
DESTINATION
     13228**DCL     13774--IF      13931--ASSIGN
DESTINATION.ADDRESS_N
     13260**DCL     13261--REDEF
DESTINATION.LEN
     13232**DCL     13774>>IF      13774>>IF      13930>>ASSIGN
DSTROUTE
     12354**DCL         7--PROC
DSTROUTE.HOST#
     12391**DCL     13919>>ASSIGN
DSTROUTE.LNSAP.ADDRESS_N
     12508**DCL     12509--REDEF
DSTROUTE.MYNODE#
     12389**DCL     12391--REDEF
DSTROUTE.NODE#
     12392**DCL     12394--REDEF
DSTROUTE.NSAP.ADDRESS_N
     12452**DCL     12453--REDEF
GH$TMR_BLK
     13335**DCL     13959<>CALL
GH$TMR_BLK.ARG
     13339**DCL     13340--REDEF
GH$TMR_BLK.INTERVAL
     13340**DCL     13958<<ASSIGN
GH$TMR_BLK.PROC$
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:261  
     13339**DCL     13957<<ASSIGN
GHS$SET_TMR
     12180**DCL-ENT 13959--CALL
HDR$
     13762**DCL     12946--IMP-PTR 13772<<ASSIGN  13773>>DOWHILE 13774>>IF      13774>>IF      13774>>IF
     13779>>ASSIGN  13799>>ASSIGN  13800>>ASSIGN  13801>>ASSIGN  13801>>ASSIGN  13807>>ASSIGN  13807>>ASSIGN
     13808>>IF      13808>>IF      13810>>ASSIGN  13811>>ASSIGN  13811>>ASSIGN  13812>>ASSIGN  13813>>ASSIGN
     13813>>ASSIGN  13849>>IF      13853>>ASSIGN  13858>>ASSIGN  13858>>ASSIGN  13860>>IF      13861>>ASSIGN
     13866>>ASSIGN  13866>>ASSIGN  13868>>DOWHILE 13869>>ASSIGN  13870>>CALL    13873>>ASSIGN  13876>>CALL
     13880>>CALL    13887<<ASSIGN  13887>>ASSIGN  13894<>CALL    13898>>ASSIGN  13904>>CALL    13908>>ASSIGN
     13917>>ASSIGN  13918>>ASSIGN  13919>>ASSIGN  13920>>ASSIGN  13921>>ASSIGN  13922>>ASSIGN  13923>>ASSIGN
     13924>>ASSIGN  13925>>IF      13926>>ASSIGN  13929>>ASSIGN  13931>>ASSIGN  13933>>ASSIGN  13934>>ASSIGN
     13941>>ASSIGN  13944>>ASSIGN  13944>>ASSIGN  13944>>ASSIGN  13948>>ASSIGN  13949>>ASSIGN  13952>>ASSIGN
     13953>>ASSIGN  13954>>ASSIGN
K$NFRAG
     12912**DCL     13790--ASSIGN  13870<>CALL    13910--ASSIGN
K$NFRAG.BFRSIZ
     12916**DCL     13796<<ASSIGN  13916<<ASSIGN
K$NFRAG.LENGTH
     12925**DCL     13782>>IF      13798<<ASSIGN  13937<<ASSIGN
K$NFRAG.LINK$
     12917**DCL     13786>>ASSIGN  13799<<ASSIGN  13869>>ASSIGN  13935<<ASSIGN
K$NFRAG.OFFSET
     12921**DCL     13781>>IF      13797<<ASSIGN  13936<<ASSIGN
K$NHDR
     12946**DCL     13880<>CALL    13893--ASSIGN
K$NHDR.BFRSIZ
     12950**DCL     13898<<ASSIGN
K$NHDR.BLINK$
     12959**DCL     13849>>IF      13855<<ASSIGN  13858>>ASSIGN  13861>>ASSIGN  13866<<ASSIGN  13866>>ASSIGN
     13920<<ASSIGN  13953<<ASSIGN
K$NHDR.DATAID
     13097**DCL     13774>>IF      13917<<ASSIGN
K$NHDR.DATAOFFSET
     13084**DCL     13801>>ASSIGN  13811>>ASSIGN  13813>>ASSIGN  13933<<ASSIGN  13944>>ASSIGN  13944>>ASSIGN
K$NHDR.DATASZ
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:262  
     13089**DCL     13808>>IF      13812>>ASSIGN  13813>>ASSIGN  13923<<ASSIGN
K$NHDR.DESTINATION
     13042**DCL     13774--IF      13931--ASSIGN
K$NHDR.DESTINATION.ADDRESS_N
     13072**DCL     13073--REDEF
K$NHDR.DSTNODE#
     13101**DCL     13919<<ASSIGN
K$NHDR.FLINK$
     12955**DCL     13853>>ASSIGN  13858<<ASSIGN  13858>>ASSIGN  13860>>IF      13863<<ASSIGN  13866>>ASSIGN
     13887>>ASSIGN  13921<<ASSIGN  13952<<ASSIGN
K$NHDR.FRAG$
     12963**DCL     13779>>ASSIGN  13799>>ASSIGN  13800<<ASSIGN  13868>>DOWHILE 13869>>ASSIGN  13870>>CALL
     13873<<ASSIGN  13934<<ASSIGN
K$NHDR.HDR$
     13076**DCL     13801>>ASSIGN  13810>>ASSIGN  13811>>ASSIGN  13876>>CALL    13904<>CALL    13941>>ASSIGN
     13944>>ASSIGN
K$NHDR.REASSEMTIM
     12967**DCL     13924<<ASSIGN  13925>>IF      13926<<ASSIGN
K$NHDR.RECVSZ
     13093**DCL     13807<<ASSIGN  13807>>ASSIGN  13808>>IF      13922<<ASSIGN
K$NHDR.SOURCE
     12990**DCL     13774--IF      13929--ASSIGN
K$NHDR.SOURCE.ADDRESS_N
     13020**DCL     13021--REDEF
K$NHDR.SRCNODE#
     13106**DCL     13918<<ASSIGN
K$NPDU_FIXED.LENGTH
     13286**DCL     13771>>ASSIGN  13923>>ASSIGN  13933>>ASSIGN  13941>>ASSIGN  13941>>ASSIGN
K$NPDU_FIXED.LIFETIME
     13290**DCL     13924>>ASSIGN
K$NPDU_SEGMENT.DATAID
     13133**DCL     13774>>IF      13917>>ASSIGN
K$NPDU_SEGMENT.OFFSET
     13142**DCL     13781>>IF      13797>>ASSIGN  13801>>ASSIGN  13936>>ASSIGN  13944>>ASSIGN  13944>>ASSIGN
K$NPDU_SEGMENT.TOTLEN
     13155**DCL     13923>>ASSIGN
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:263  
K$NQDP_HDR_C
     12777**DCL     13830>>ASSIGN
KN$NETPARM
     12197**DCL         7--PROC    13816<>CALL    13839<>CALL
KN$NETPARM.DST_ADDR$
     12331**DCL     13228--IMP-PTR 13774>>IF      13774>>IF      13774>>IF      13930>>ASSIGN  13931>>ASSIGN
KN$NETPARM.ERRCODE
     12304**DCL     13783<<ASSIGN  13792<<ASSIGN  13836<<ASSIGN  13840>>IF      13841<<ASSIGN  13883>>IF
     13895<<ASSIGN  13905<<ASSIGN  13912<<ASSIGN
KN$NETPARM.FPT$
     12316**DCL     13124--IMP-PTR 13774>>IF      13781>>IF      13797>>ASSIGN  13801>>ASSIGN  13917>>ASSIGN
     13923>>ASSIGN  13936>>ASSIGN  13944>>ASSIGN  13944>>ASSIGN
KN$NETPARM.FUNCTION
     12292**DCL     13809<<ASSIGN
KN$NETPARM.LDCT$
     12198**DCL     13829<<ASSIGN  13835>>IF
KN$NETPARM.MSG$
     12204**DCL     12209--REDEF
KN$NETPARM.NHDR$
     12256**DCL     12257--REDEF   13280--IMP-PTR 13771>>ASSIGN  13801>>ASSIGN  13810<<ASSIGN  13833<<ASSIGN
     13923>>ASSIGN  13924>>ASSIGN  13933>>ASSIGN  13941>>ASSIGN  13941>>ASSIGN  13941>>ASSIGN  13944>>ASSIGN
KN$NETPARM.NHDRSZ
     12262**DCL     13771>>ASSIGN  13801>>ASSIGN  13812<<ASSIGN  13834<<ASSIGN  13903>>ASSIGN
KN$NETPARM.NODE
     12299**DCL     13829>>ASSIGN  13831>>ASSIGN
KN$NETPARM.RECTYPE
     12283**DCL     13815<<ASSIGN
KN$NETPARM.SHDR$
     12234**DCL     12235--REDEF
KN$NETPARM.SRC_ADDR$
     12326**DCL     13176--IMP-PTR 13774>>IF      13774>>IF      13774>>IF      13928>>ASSIGN  13929>>ASSIGN
KN$NETPARM.THDR$
     12245**DCL     12246--REDEF
KN$NETPARM.THDRSZ
     12251**DCL     13801>>ASSIGN  13813<<ASSIGN  13817<<ASSIGN
KN$NETPARM.THDR_C$
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:264  
     12246**DCL     13811<<ASSIGN
KN$NETPARM.UHDR$
     12220**DCL     12221--REDEF
KN$NETPARM.UHDRSZ
     12229**DCL     13814<<ASSIGN
KNH$SEND
     12182**DCL-ENT 13839--CALL
KNN$LINK.DEST.ADDRESS_N
     13604**DCL     13605--REDEF
KNN$LINK.LADR.ADDRESS_N
     13547**DCL     13548--REDEF
KNN$LINK.LDCT$
     13418**DCL     13425--REDEF   13829>>ASSIGN
KNN$ROUTE.LINK$
     13346**DCL     13829>>ASSIGN
KNN$ROUTE$
     13668**DCL     13829>>ASSIGN
KNN$TIMER
     12177**DCL-ENT 13957--ASSIGN
KNN_LIFETIME_UNIT
     13679**DCL     13958>>ASSIGN
KNN_LINK$$
     13677**DCL     13669--IMP-PTR
KNN_RASSMHD$
     13673**DCL     13772>>ASSIGN  13853<<ASSIGN  13854>>IF      13855>>ASSIGN  13947>>IF      13948<<ASSIGN
KNN_RASSMTL$
     13674**DCL     13861<<ASSIGN  13862>>IF      13863>>ASSIGN  13949<<ASSIGN  13952>>ASSIGN  13953>>ASSIGN
     13954<<ASSIGN
KNN_REASSEMTIME
     13672**DCL     13925>>IF      13926>>ASSIGN
KNN_REASSEM_CLOCK
     13678**DCL     13956>>IF
KNN_ROUTE$$
     13676**DCL     13668--IMP-PTR 13829>>ASSIGN
KNT$RECV_4HOST
     12178**DCL-ENT 13816--CALL
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:265  
KN_NODE#
     13675**DCL     13832>>ASSIGN
KVB$GET2NSYS
     12175**DCL-ENT 13791--CALL    13894--CALL    13904--CALL    13911--CALL
KVB$RLS2NSYS
     12176**DCL-ENT 13870--CALL    13876--CALL    13880--CALL
NQDP_HDR
     13702**DCL     13830<<ASSIGN  13833--ASSIGN  13834--ASSIGN
NQDP_HDR.DEST_NODE
     13723**DCL     13831<<ASSIGN
NQDP_HDR.SOURCE_NODE
     13729**DCL     13832<<ASSIGN
PRTCLERR
     12861**DCL     13871<>CALL    13877<>CALL    13881<>CALL
RLSMEM
     13849**LABEL   13823--GOTO
SCREECH
     12179**DCL-ENT 13871--CALL    13877--CALL    13881--CALL
SIZE
     13768**DCL     13667--IMP-SIZ 13774>>IF      13774>>IF      13774>>IF      13774>>IF      13790<<ASSIGN
     13791<>CALL    13796>>ASSIGN  13801>>ASSIGN  13801>>ASSIGN  13876>>CALL    13893<<ASSIGN  13894<>CALL
     13898>>ASSIGN  13903<<ASSIGN  13904<>CALL    13908>>ASSIGN  13910<<ASSIGN  13911<>CALL    13916>>ASSIGN
     13928<<ASSIGN  13929>>ASSIGN  13929>>ASSIGN  13930<<ASSIGN  13931>>ASSIGN  13931>>ASSIGN  13941>>ASSIGN
     13941>>ASSIGN  13944>>ASSIGN  13944>>ASSIGN
SOURCE
     13176**DCL     13774--IF      13929--ASSIGN
SOURCE.ADDRESS_N
     13208**DCL     13209--REDEF
SOURCE.LEN
     13180**DCL     13774>>IF      13774>>IF      13928>>ASSIGN
SRCROUTE
     12563**DCL         7--PROC
SRCROUTE.FEP#
     12603**DCL     13918>>ASSIGN
SRCROUTE.LNSAP.ADDRESS_N
     12717**DCL     12718--REDEF
PL6.E3A0      #005=KNN$REASSEM File=KNN$SUBS.:E05TSI                             WED 07/30/97 01:09 Page:266  
SRCROUTE.MYNODE#
     12598**DCL     12600--REDEF
SRCROUTE.NODE#
     12601**DCL     12603--REDEF
SRCROUTE.NSAP.ADDRESS_N
     12661**DCL     12662--REDEF
TFRAG$
     13760**DCL     12912--IMP-PTR 13779<<ASSIGN  13780>>DOWHILE 13781>>IF      13782>>IF      13786<<ASSIGN
     13786>>ASSIGN  13791<>CALL    13796>>ASSIGN  13797>>ASSIGN  13798>>ASSIGN  13799>>ASSIGN  13800>>ASSIGN
     13869<<ASSIGN  13873>>ASSIGN  13911<>CALL    13916>>ASSIGN  13934>>ASSIGN  13935>>ASSIGN  13936>>ASSIGN
     13937>>ASSIGN
UBINBSD
     13670**DCL     13908<<ASSIGN

PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:267  
     1582        1        /*T***********************************************************/
     1583        2        /*T*                                                         */
     1584        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1585        4        /*T*                                                         */
     1586        5        /*T***********************************************************/
     1587        6        %EJECT;
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:268  
     1588        7        KNN$TIMER: PROC;
     1589        8        /*
     1590        9             entry point for the monitor clock. each entry represents .5 seconds.
     1591       10             which is then decremented off of the reassemtim clock in the block
     1592       11             headers if any exist.  when time runs out send an error and delete the
     1593       12             exists fragments.
     1594       13        */
     1595       14
     1596       15        %INCLUDE LCP_6;
     1597     4294        %INCLUDE KN_DATA_M;
     1598     6080        %INCLUDE K_ADDRESS_M;
     1599     6583        %INCLUDE K_NETWORK_M;
     1600     6852        %INCLUDE K_NETWORK_E;
     1601     6941        %INCLUDE GH_GATE_M;
     1602     6982        %INCLUDE K_SCODE_C;
     1603     7067        %INCLUDE GH_SCHD_M;
     1604     7211        %INCLUDE KN_ERRORS_C;
     1605     7275
     1606     7276    1   DCL KVB$GET2NSYS ENTRY(2) ALTRET;
     1607     7277    1   DCL KVB$RLS2NSYS ENTRY(2) ALTRET;
     1608     7278    1   DCL GUS$MONTIMR ENTRY(4);
     1609     7279    1   DCL KNN$SENDERR ENTRY(1) ALTRET;
     1610     7280    1   DCL SCREECH ENTRY(1);
     1611     7281    1   DCL GHS$SET_TMR ENTRY(1);
     1612     7282    1   DCL GHE$ERRLOG ENTRY(5) ALTRET;
     1613     7283
     1614     7284        %KN$NETPARM(NAME=NETPARM_C,STCLASS=CONSTANT);
     1615     7437
     1616     7438        %VLP_SCODE (FPTN=PRTCLERR,ERR#=%S$PRTCLERR,SEV=G_SEV_SCREECH#,
     1617     7439                       STCLASS=CONSTANT,FCG=KN,MID=N,MON='1'B);
     1618     7500
     1619     7501        %VLP_ERRCODE(FPTN=E_DSCRD_LIFEEXPASSM,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
              7501            %E$DSCRD_LIFEEXPASSM);
     1620     7547
     1621     7548        %KN$NETPARM(NAME=NETPARM,STCLASS=AUTO);
     1622     7701        %K$NFRAG(STCLASS="BASED(TFRAG$)");
     1623     7735        %K$NHDR(STCLASS = "BASED(HDR$)");
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:269  
     1624     7913        %K$NPDU_SEGMENT(STCLASS="BASED(NETPARM.FPT$)");
     1625     7965        %K$NSAP(FPTN=SOURCE,STCLASS="BASED(NETPARM.SRC_ADDR$)");
     1626     8017        %K$NSAP(FPTN=DESTINATION,STCLASS="BASED(NETPARM.DST_ADDR$)");
     1627     8069        %K$NPDU_FIXED(STCLASS="BASED(NETPARM.NHDR$)");
     1628     8126        %GH$TMR_BLK(STCLASS=STATIC);
     1629     8149    1   DCL ADDRESS CHAR(SIZE) BASED;
     1630     8150    1   DCL ONEWORD UBIN WORD BASED;
     1631     8151    1   DCL CALLEDFROM$ EPTR BASED;
     1632     8152
     1633     8153    1   DCL KNN_REASSEMTIME UBIN SYMREF;
     1634     8154    1   DCL KV_B_POOL# UBIN SYMREF;
     1635     8155    1   DCL KNN_RASSMHD$ PTR SYMREF;
     1636     8156    1   DCL KNN_RASSMTL$ PTR SYMREF;
     1637     8157    1   DCL KNN_LIFETIME_UNIT UBIN SYMREF;
     1638     8158        %GATE(FPTN=KNN_LOCK,STCLASS="SYMREF");
     1639     8177
     1640     8178    1   DCL FIXED$ PTR;
     1641     8179    1   DCL SEG$ PTR;
     1642     8180    1   DCL DATA$ PTR;
     1643     8181    1   DCL HDR$ PTR;
     1644     8182    1   DCL TFRAG$ PTR;
     1645     8183    1   DCL SRC$ PTR;
     1646     8184    1   DCL DST$ PTR;
     1647     8185
     1648     8186    1   DCL DATASIZE UBIN;
     1649     8187    1   DCL I UBIN;
     1650     8188    1   DCL SIZE UBIN;
     1651     8189    1   DCL ERRVAL(0:3) UBIN;
     1652     8190
     1653     8191        %LOCK(G=KNN_LOCK);
     1654     8198    1      HDR$ = KNN_RASSMHD$;
     1655     8199    2      DO WHILE HDR$ ~= ADDR(NIL);
     1656     8200    2         K$NHDR.REASSEMTIM = K$NHDR.REASSEMTIM - 1;
     1657     8201    3         IF K$NHDR.REASSEMTIM = 0 THEN DO;
     1658     8202    3            NETPARM.NODE = K$NHDR.SRCNODE#;
     1659     8203        /*
     1660     8204                switch the souce and destination for senderr
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:270  
     1661     8205        */
     1662     8206    3            NETPARM.SRC_ADDR$ = ADDR(K$NHDR.DESTINATION);
     1663     8207    3            NETPARM.DST_ADDR$ = ADDR(K$NHDR.SOURCE);
     1664     8208    3            NETPARM.ERRCODE = %K_DSCRD_LIFEEXPASSM;
     1665     8209    3            NETPARM.RECTYPE = K$NPDU_FIXED.LENGTH; /* should contain offset to size */
     1666     8210    3            NETPARM.NHDR$ = K$NHDR.HDR$;
     1667     8211    3            NETPARM.NHDRSZ = K$NHDR.RECVSZ;
     1668     8212    3            CALL KNN$SENDERR(NETPARM);
     1669     8213    3            ADDR(ERRVAL(0))->CALLEDFROM$ = ENTADDR(KNN$TIMER);
     1670     8214    3            CALL GHE$ERRLOG(E_DSCRD_LIFEEXPASSM,ERRVAL,K$NPDU_FIXED,SIZEC(K$NPDU_FIXED)
              8214                     ,'0'B);
     1671     8215
     1672     8216    4            IF K$NHDR.BLINK$ = ADDR(NIL) THEN DO; /* at head           */
     1673     8217    4               KNN_RASSMHD$ = K$NHDR.FLINK$;
     1674     8218    4               IF KNN_RASSMHD$ ~= ADDR(NIL) THEN
     1675     8219    4                  KNN_RASSMHD$->K$NHDR.BLINK$ = ADDR(NIL);
     1676     8220    4               END;
     1677     8221    3            ELSE
     1678     8222    3               K$NHDR.BLINK$->K$NHDR.FLINK$ = K$NHDR.FLINK$;
     1679     8223
     1680     8224    4            IF K$NHDR.FLINK$ = ADDR(NIL) THEN DO;
     1681     8225    4               KNN_RASSMTL$ = K$NHDR.BLINK$;
     1682     8226    4               IF KNN_RASSMTL$ ~= ADDR(NIL) THEN
     1683     8227    4                  KNN_RASSMTL$->K$NHDR.FLINK$ = ADDR(NIL);
     1684     8228    4               END;
     1685     8229    3            ELSE
     1686     8230    3               K$NHDR.FLINK$->K$NHDR.BLINK$ = K$NHDR.BLINK$;
     1687     8231
     1688     8232    4            DO WHILE K$NHDR.FRAG$ ~= ADDR(NIL);
     1689     8233    4               TFRAG$ = K$NHDR.FRAG$->K$NFRAG.LINK$;
     1690     8234    5               CALL KVB$RLS2NSYS(TFRAG$->ONEWORD) WHENALTRETURN DO;
     1691     8235    5                  CALL SCREECH(PRTCLERR);
     1692     8236    5                  END;
     1693     8237    4               K$NHDR.FRAG$ = TFRAG$;
     1694     8238    4               END;
     1695     8239
     1696     8240    3            TFRAG$ = K$NHDR.HDR$;
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:271  
     1697     8241    4            CALL KVB$RLS2NSYS(TFRAG$->ONEWORD) WHENALTRETURN DO;
     1698     8242    4               CALL SCREECH(PRTCLERR);
     1699     8243    4               END;
     1700     8244
     1701     8245    4            CALL KVB$RLS2NSYS(HDR$->ONEWORD) WHENALTRETURN DO;
     1702     8246    4               CALL SCREECH(PRTCLERR);
     1703     8247    4               END;
     1704     8248    3            END;                           /* one timed out            */
     1705     8249    2         HDR$ = K$NHDR.FLINK$;
     1706     8250    2         END;                              /* while hdr$ = addr(nil)   */
     1707     8251    1      GH$TMR_BLK.PROC$ = ENTADDR(KNN$TIMER);
     1708     8252    1      GH$TMR_BLK.INTERVAL = KNN_LIFETIME_UNIT;
     1709     8253    1      CALL GHS$SET_TMR(GH$TMR_BLK);
     1710     8254        %UNLOCK(G=KNN_LOCK);
     1711     8261    1   END KNN$TIMER;

PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:272  
--  Include file information  --

   KN_ERRORS_C.:E05TOU  is referenced.
   GH_SCHD_M.:E05TOU  is referenced.
   K_SCODE_C.:E05TOU  is referenced.
   GH_GATE_M.:E05TOU  cannot be made into a system file and is referenced.
   K_NETWORK_E.:E05TOU  is referenced.
   K_NETWORK_M.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KN_DATA_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KNN$TIMER.

   Procedure KNN$TIMER requires 295 words for executable code.
   Procedure KNN$TIMER requires 68 words of local(AUTO) storage.

    No errors detected in file KNN$SUBS.:E05TSI    .

PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:273  

 Object Unit name= KNN$TIMER                                  File name= KNN$SUBS.:E05TOU
 UTS= JUL 30 '97 01:10:06.48 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS     38     26  KNN$TIMER
    1   Data  even  none    10      A  KNN$TIMER
    2   Proc  even  none   295    127  KNN$TIMER
    3  RoData even  none     6      6  KNN$TIMER

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     2      0   yes            yes      Std        0  KNN$TIMER

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 GHH$LOCK
 yes     yes           Std       2 KVB$RLS2NSYS
         yes           Std       1 SCREECH
 yes     yes           Std       1 GHH$UNLOCK
 yes     yes           Std       1 KNN$SENDERR
 yes     yes           Std       5 GHE$ERRLOG
         yes           Std       1 GHS$SET_TMR
         yes           Std       0 KNN$TIMER
                       nStd      0 X6A_AUTO_0
                       nStd      0 X6A_ARET
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:274  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KNN_RASSMHD$                          KNN_RASSMTL$                          KNN_LIFETIME_UNIT
     KNN_LOCK                         r    G$ROS$
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:275  


     1582        1        /*T***********************************************************/
     1583        2        /*T*                                                         */
     1584        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1585        4        /*T*                                                         */
     1586        5        /*T***********************************************************/
     1587        6        %EJECT;
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:276  
     1588        7        KNN$TIMER: PROC;

      7   2 000000  D380 0000 0000  xent KNN$TIMER       LNJ,B5   X6A_AUTO_0
          2 000003       0044 0000                       DC       68,0

     1589        8        /*
     1590        9             entry point for the monitor clock. each entry represents .5 seconds.
     1591       10             which is then decremented off of the reassemtim clock in the block
     1592       11             headers if any exist.  when time runs out send an error and delete the
     1593       12             exists fragments.
     1594       13        */
     1595       14
     1596       15        %INCLUDE LCP_6;
     1597     4294        %INCLUDE KN_DATA_M;
     1598     6080        %INCLUDE K_ADDRESS_M;
     1599     6583        %INCLUDE K_NETWORK_M;
     1600     6852        %INCLUDE K_NETWORK_E;
     1601     6941        %INCLUDE GH_GATE_M;
     1602     6982        %INCLUDE K_SCODE_C;
     1603     7067        %INCLUDE GH_SCHD_M;
     1604     7211        %INCLUDE KN_ERRORS_C;
     1605     7275
     1606     7276    1   DCL KVB$GET2NSYS ENTRY(2) ALTRET;
     1607     7277    1   DCL KVB$RLS2NSYS ENTRY(2) ALTRET;
     1608     7278    1   DCL GUS$MONTIMR ENTRY(4);
     1609     7279    1   DCL KNN$SENDERR ENTRY(1) ALTRET;
     1610     7280    1   DCL SCREECH ENTRY(1);
     1611     7281    1   DCL GHS$SET_TMR ENTRY(1);
     1612     7282    1   DCL GHE$ERRLOG ENTRY(5) ALTRET;
     1613     7283
     1614     7284        %KN$NETPARM(NAME=NETPARM_C,STCLASS=CONSTANT);
     1615     7437
     1616     7438        %VLP_SCODE (FPTN=PRTCLERR,ERR#=%S$PRTCLERR,SEV=G_SEV_SCREECH#,
     1617     7439                       STCLASS=CONSTANT,FCG=KN,MID=N,MON='1'B);
     1618     7500
     1619     7501        %VLP_ERRCODE(FPTN=E_DSCRD_LIFEEXPASSM,FCG=KN,MID=N,MON='1'B,STCLASS=CONSTANT,ERR#=
              7501            %E$DSCRD_LIFEEXPASSM);
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:277  
     1620     7547
     1621     7548        %KN$NETPARM(NAME=NETPARM,STCLASS=AUTO);
     1622     7701        %K$NFRAG(STCLASS="BASED(TFRAG$)");
     1623     7735        %K$NHDR(STCLASS = "BASED(HDR$)");
     1624     7913        %K$NPDU_SEGMENT(STCLASS="BASED(NETPARM.FPT$)");
     1625     7965        %K$NSAP(FPTN=SOURCE,STCLASS="BASED(NETPARM.SRC_ADDR$)");
     1626     8017        %K$NSAP(FPTN=DESTINATION,STCLASS="BASED(NETPARM.DST_ADDR$)");
     1627     8069        %K$NPDU_FIXED(STCLASS="BASED(NETPARM.NHDR$)");
     1628     8126        %GH$TMR_BLK(STCLASS=STATIC);
     1629     8149    1   DCL ADDRESS CHAR(SIZE) BASED;
     1630     8150    1   DCL ONEWORD UBIN WORD BASED;
     1631     8151    1   DCL CALLEDFROM$ EPTR BASED;
     1632     8152
     1633     8153    1   DCL KNN_REASSEMTIME UBIN SYMREF;
     1634     8154    1   DCL KV_B_POOL# UBIN SYMREF;
     1635     8155    1   DCL KNN_RASSMHD$ PTR SYMREF;
     1636     8156    1   DCL KNN_RASSMTL$ PTR SYMREF;
     1637     8157    1   DCL KNN_LIFETIME_UNIT UBIN SYMREF;
     1638     8158        %GATE(FPTN=KNN_LOCK,STCLASS="SYMREF");
     1639     8177
     1640     8178    1   DCL FIXED$ PTR;
     1641     8179    1   DCL SEG$ PTR;
     1642     8180    1   DCL DATA$ PTR;
     1643     8181    1   DCL HDR$ PTR;
     1644     8182    1   DCL TFRAG$ PTR;
     1645     8183    1   DCL SRC$ PTR;
     1646     8184    1   DCL DST$ PTR;
     1647     8185
     1648     8186    1   DCL DATASIZE UBIN;
     1649     8187    1   DCL I UBIN;
     1650     8188    1   DCL SIZE UBIN;
     1651     8189    1   DCL ERRVAL(0:3) UBIN;
     1652     8190
     1653     8191        %LOCK(G=KNN_LOCK);

   8196   2 000005  BB80 0000 0000  03                   LAB,B3   0
          2 000008  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:278  
          2 00000A  E380 0000 0000  xent                 LNJ,B6   GHH$LOCK
          2 00000D       0001                            DC       s:8198,PREL

     1654     8198    1      HDR$ = KNN_RASSMHD$;

   8198   2 00000E  EC80 0000 0000  xsym                 LDB,B6   KNN_RASSMHD$
          2 000011  EFC7 002B                            STB,B6   HDR$,AUTO

     1655     8199    2      DO WHILE HDR$ ~= ADDR(NIL);

   8199   2 000013  0F81 00EF                            B        s:8250,PREL

     1656     8200    2         K$NHDR.REASSEMTIM = K$NHDR.REASSEMTIM - 1;

   8200   2 000015  ECC7 002B                            LDB,B6   HDR$,AUTO
          2 000017  8CC6 0008                            LDI      8,B6
          2 000019  8470 FFFF FFFF                       AID      -1,IMO
          2 00001C  8D46 0008                            SDI      8,B6

     1657     8201    3         IF K$NHDR.REASSEMTIM = 0 THEN DO;

   8201   2 00001E  84F0 0000 0000                       SID      0,IMO
          2 000021  6981 00DB                            BNEZ,R6  s:8249,PREL
          2 000023  7981 00D9                            BNEZ,R7  s:8249,PREL

     1658     8202    3            NETPARM.NODE = K$NHDR.SRCNODE#;

   8202   2 000025  E846 0028                            LDR,R6   40,B6
          2 000027  E570 00FF                            AND,R6   255,IMO
          2 000029  EF47 0019                            STR,R6   NETPARM+21,AUTO

     1659     8203        /*
     1660     8204                switch the souce and destination for senderr
     1661     8205        */
     1662     8206    3            NETPARM.SRC_ADDR$ = ADDR(K$NHDR.DESTINATION);

   8206   2 00002B  DBC6 0015                            LAB,B5   21,B6
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:279  
          2 00002D  DFC7 0021                            STB,B5   NETPARM+29,AUTO

     1663     8207    3            NETPARM.DST_ADDR$ = ADDR(K$NHDR.SOURCE);

   8207   2 00002F  CBC6 000A                            LAB,B4   10,B6
          2 000031  CFC7 0023                            STB,B4   NETPARM+31,AUTO

     1664     8208    3            NETPARM.ERRCODE = %K_DSCRD_LIFEEXPASSM;

   8208   2 000033  D870 00A1                            LDR,R5   161,IMO
          2 000035  DF47 001A                            STR,R5   NETPARM+22,AUTO

     1665     8209    3            NETPARM.RECTYPE = K$NPDU_FIXED.LENGTH; /* should contain offset to size */

   8209   2 000037  BCC7 0012                            LDB,B3   NETPARM+14,AUTO
          2 000039  C803                                 LDR,R4   ,B3
          2 00003A  C570 00FF                            AND,R4   255,IMO
          2 00003C  CF47 0017                            STR,R4   NETPARM+19,AUTO

     1666     8210    3            NETPARM.NHDR$ = K$NHDR.HDR$;

   8210   2 00003E  ACC6 0020                            LDB,B2   32,B6
          2 000040  AFC7 0012                            STB,B2   NETPARM+14,AUTO

     1667     8211    3            NETPARM.NHDRSZ = K$NHDR.RECVSZ;

   8211   2 000042  B846 0026                            LDR,R3   38,B6
          2 000044  BF47 0014                            STR,R3   NETPARM+16,AUTO

     1668     8212    3            CALL KNN$SENDERR(NETPARM);

   8212   2 000046  BBC7 0004                            LAB,B3   NETPARM,AUTO
          2 000048  BFC7 003A                            STB,B3   ERRVAL+4,AUTO
          2 00004A  BBC7 003A                            LAB,B3   ERRVAL+4,AUTO
          2 00004C  CBF0 0100                            LAB,B4   256,IMO
          2 00004E  E380 0000 0000  xent                 LNJ,B6   KNN$SENDERR
          2 000051       0001                            DC       s:8213,PREL
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:280  

     1669     8213    3            ADDR(ERRVAL(0))->CALLEDFROM$ = ENTADDR(KNN$TIMER);

   8213   2 000052  EBC0 FFAD                            LAB,B6   s:7,PREL
          2 000054  EFC7 0036                            STB,B6   ERRVAL,AUTO

     1670     8214    3           CALL GHE$ERRLOG(E_DSCRD_LIFEEXPASSM,ERRVAL,K$NPDU_FIXED,SIZEC(K$NPDU_FIXED)
              8214                     ,'0'B);

   8214   2 000056  DBF0 000A                            LAB,B5   10,IMO
          2 000058  CBF0 0000                            LAB,B4   0,IMO
          2 00005A  CFC7 0042                            STB,B4   ERRVAL+12,AUTO
          2 00005C  DFC7 0040                            STB,B5   ERRVAL+10,AUTO
          2 00005E  BCC7 0012                            LDB,B3   NETPARM+14,AUTO
          2 000060  BFC7 003E                            STB,B3   ERRVAL+8,AUTO
          2 000062  ABC7 0036                            LAB,B2   ERRVAL,AUTO
          2 000064  AFC7 003C                            STB,B2   ERRVAL+6,AUTO
          2 000066  9B80 0000 0024  00                   LAB,B1   E_DSCRD_LIFEEXPASSM
          2 000069  9FC7 003A                            STB,B1   ERRVAL+4,AUTO
          2 00006B  BBC7 003A                            LAB,B3   ERRVAL+4,AUTO
          2 00006D  CBF0 0500                            LAB,B4   1280,IMO
          2 00006F  E380 0000 0000  xent                 LNJ,B6   GHE$ERRLOG
          2 000072       0001                            DC       s:8216,PREL

     1671     8215
     1672     8216    4            IF K$NHDR.BLINK$ = ADDR(NIL) THEN DO; /* at head           */

   8216   2 000073  ECC7 002B                            LDB,B6   HDR$,AUTO
          2 000075  8DC6 0004                            CMN      4,B6
          2 000077  0981 0012                            BNE      s:8222,PREL

     1673     8217    4               KNN_RASSMHD$ = K$NHDR.FLINK$;

   8217   2 000079  DCC6 0002                            LDB,B5   2,B6
          2 00007B  DF80 0000 0000  xsym                 STB,B5   KNN_RASSMHD$

     1674     8218    4               IF KNN_RASSMHD$ ~= ADDR(NIL) THEN
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:281  

   8218   2 00007E  8D80 0000 0000  xsym                 CMN      KNN_RASSMHD$
          2 000081  0901 000E                            BE       s:8224,PREL

     1675     8219    4                  KNN_RASSMHD$->K$NHDR.BLINK$ = ADDR(NIL);

   8219   2 000083  CB80 0000 0000                       LAB,B4   0
          2 000086  CFC5 0004                            STB,B4   4,B5

     1676     8220    4               END;

   8220   2 000088  0F81 0007                            B        s:8224,PREL

     1677     8221    3            ELSE
     1678     8222    3               K$NHDR.BLINK$->K$NHDR.FLINK$ = K$NHDR.FLINK$;

   8222   2 00008A  DCC6 0004                            LDB,B5   4,B6
          2 00008C  CCC6 0002                            LDB,B4   2,B6
          2 00008E  CFC5 0002                            STB,B4   2,B5

     1679     8223
     1680     8224    4            IF K$NHDR.FLINK$ = ADDR(NIL) THEN DO;

   8224   2 000090  8DC6 0002                            CMN      2,B6
          2 000092  0981 0012                            BNE      s:8230,PREL

     1681     8225    4               KNN_RASSMTL$ = K$NHDR.BLINK$;

   8225   2 000094  DCC6 0004                            LDB,B5   4,B6
          2 000096  DF80 0000 0000  xsym                 STB,B5   KNN_RASSMTL$

     1682     8226    4               IF KNN_RASSMTL$ ~= ADDR(NIL) THEN

   8226   2 000099  8D80 0000 0000  xsym                 CMN      KNN_RASSMTL$
          2 00009C  0901 000E                            BE       s:8232,PREL

     1683     8227    4                  KNN_RASSMTL$->K$NHDR.FLINK$ = ADDR(NIL);
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:282  

   8227   2 00009E  CB80 0000 0000                       LAB,B4   0
          2 0000A1  CFC5 0002                            STB,B4   2,B5

     1684     8228    4               END;

   8228   2 0000A3  0F81 0007                            B        s:8232,PREL

     1685     8229    3            ELSE
     1686     8230    3               K$NHDR.FLINK$->K$NHDR.BLINK$ = K$NHDR.BLINK$;

   8230   2 0000A5  DCC6 0002                            LDB,B5   2,B6
          2 0000A7  CCC6 0004                            LDB,B4   4,B6
          2 0000A9  CFC5 0004                            STB,B4   4,B5

     1687     8231
     1688     8232    4            DO WHILE K$NHDR.FRAG$ ~= ADDR(NIL);

   8232   2 0000AB  0F81 0022                            B        s:8238,PREL

     1689     8233    4               TFRAG$ = K$NHDR.FRAG$->K$NFRAG.LINK$;

   8233   2 0000AD  ECC7 002B                            LDB,B6   HDR$,AUTO
          2 0000AF  DCC6 0006                            LDB,B5   6,B6
          2 0000B1  CCC5 0001                            LDB,B4   1,B5
          2 0000B3  CFC7 002D                            STB,B4   TFRAG$,AUTO

     1690     8234    5               CALL KVB$RLS2NSYS(TFRAG$->ONEWORD) WHENALTRETURN DO;

   8234   2 0000B5  BBC7 002D                            LAB,B3   TFRAG$,AUTO
          2 0000B7  CBF0 0100                            LAB,B4   256,IMO
          2 0000B9  E380 0000 0000  xent                 LNJ,B6   KVB$RLS2NSYS
          2 0000BC       0003                            DC       s:8235,PREL
          2 0000BD  0F81 000A                            B        s:8237,PREL

     1691     8235    5                  CALL SCREECH(PRTCLERR);

PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:283  
   8235   2 0000BF  BB80 0000 0002  03                   LAB,B3   +2
          2 0000C2  CBF0 0100                            LAB,B4   256,IMO
          2 0000C4  E380 0000 0000  xent                 LNJ,B6   SCREECH
          2 0000C7       0001                            DC       s:8237,PREL

     1692     8236    5                  END;

     1693     8237    4               K$NHDR.FRAG$ = TFRAG$;

   8237   2 0000C8  ECC7 002D                            LDB,B6   TFRAG$,AUTO
          2 0000CA  DCC7 002B                            LDB,B5   HDR$,AUTO
          2 0000CC  EFC5 0006                            STB,B6   6,B5

     1694     8238    4               END;

   8238   2 0000CE  ECC7 002B                            LDB,B6   HDR$,AUTO
          2 0000D0  8DC6 0006                            CMN      6,B6
          2 0000D2  09DB                                 BNE      s:8233,SPREL

     1695     8239
     1696     8240    3            TFRAG$ = K$NHDR.HDR$;

   8240   2 0000D3  DCC6 0020                            LDB,B5   32,B6
          2 0000D5  DFC7 002D                            STB,B5   TFRAG$,AUTO

     1697     8241    4            CALL KVB$RLS2NSYS(TFRAG$->ONEWORD) WHENALTRETURN DO;

   8241   2 0000D7  BBC7 002D                            LAB,B3   TFRAG$,AUTO
          2 0000D9  CBF0 0100                            LAB,B4   256,IMO
          2 0000DB  E380 0000 0000  xent                 LNJ,B6   KVB$RLS2NSYS
          2 0000DE       0003                            DC       s:8242,PREL
          2 0000DF  0F81 000A                            B        s:8245,PREL

     1698     8242    4               CALL SCREECH(PRTCLERR);

   8242   2 0000E1  BB80 0000 0002  03                   LAB,B3   +2
          2 0000E4  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:284  
          2 0000E6  E380 0000 0000  xent                 LNJ,B6   SCREECH
          2 0000E9       0001                            DC       s:8245,PREL

     1699     8243    4               END;

     1700     8244
     1701     8245    4            CALL KVB$RLS2NSYS(HDR$->ONEWORD) WHENALTRETURN DO;

   8245   2 0000EA  BBC7 002B                            LAB,B3   HDR$,AUTO
          2 0000EC  CBF0 0100                            LAB,B4   256,IMO
          2 0000EE  E380 0000 0000  xent                 LNJ,B6   KVB$RLS2NSYS
          2 0000F1       0003                            DC       s:8246,PREL
          2 0000F2  0F81 000A                            B        s:8249,PREL

     1702     8246    4               CALL SCREECH(PRTCLERR);

   8246   2 0000F4  BB80 0000 0002  03                   LAB,B3   +2
          2 0000F7  CBF0 0100                            LAB,B4   256,IMO
          2 0000F9  E380 0000 0000  xent                 LNJ,B6   SCREECH
          2 0000FC       0001                            DC       s:8249,PREL

     1703     8247    4               END;

     1704     8248    3            END;                           /* one timed out            */

     1705     8249    2         HDR$ = K$NHDR.FLINK$;

   8249   2 0000FD  ECC7 002B                            LDB,B6   HDR$,AUTO
          2 0000FF  DCC6 0002                            LDB,B5   2,B6
          2 000101  DFC7 002B                            STB,B5   HDR$,AUTO

     1706     8250    2         END;                              /* while hdr$ = addr(nil)   */

   8250   2 000103  8DC7 002B                            CMN      HDR$,AUTO
          2 000105  0981 FF0F                            BNE      s:8200,PREL

     1707     8251    1      GH$TMR_BLK.PROC$ = ENTADDR(KNN$TIMER);
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:285  

   8251   2 000107  EBC0 FEF8                            LAB,B6   s:7,PREL
          2 000109  EF80 0000 0000  01                   STB,B6   GH$TMR_BLK

     1708     8252    1      GH$TMR_BLK.INTERVAL = KNN_LIFETIME_UNIT;

   8252   2 00010C  E800 0000 0000  xsym                 LDR,R6   KNN_LIFETIME_UNIT
          2 00010F  EF00 0000 0003  01                   STR,R6   GH$TMR_BLK+3

     1709     8253    1      CALL GHS$SET_TMR(GH$TMR_BLK);

   8253   2 000112  BB80 0000 0004  03                   LAB,B3   +4
          2 000115  CBF0 0100                            LAB,B4   256,IMO
          2 000117  E380 0000 0000  xent                 LNJ,B6   GHS$SET_TMR
          2 00011A       0001                            DC       s:8259,PREL

     1710     8254        %UNLOCK(G=KNN_LOCK);

   8259   2 00011B  BB80 0000 0000  03                   LAB,B3   0
          2 00011E  CBF0 0100                            LAB,B4   256,IMO
          2 000120  E380 0000 0000  xent                 LNJ,B6   GHH$UNLOCK
          2 000123       0001                            DC       s:8261,PREL

     1711     8261    1   END KNN$TIMER;

   8261   2 000124  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:286  
--  Include file information  --

   KN_ERRORS_C.:E05TOU  is referenced.
   GH_SCHD_M.:E05TOU  is referenced.
   K_SCODE_C.:E05TOU  is referenced.
   GH_GATE_M.:E05TOU  cannot be made into a system file and is referenced.
   K_NETWORK_E.:E05TOU  is referenced.
   K_NETWORK_M.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KN_DATA_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KNN$TIMER.
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:287  

 **** Variables and constants ****

  ****  Section 000 RoData KNN$TIMER

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    24-0-0/w STRC(32)    r     1 E_DSCRD_LIFEEXPASSM       21-0-0/w STRC(48)    r     1 PRTCLERR

  ****  Section 001  Data  KNN$TIMER

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(160)   r     1 GH$TMR_BLK

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    36-0-0/w UBIN(16)    r     1 ERRVAL(0:3)               2B-0-0/w PTR         r     1 HDR$
     4-0-0/w STRC(528)   r     1 NETPARM                   35-0-0/w UBIN(16)    r     1 SIZE
    2D-0-0/w PTR         r     1 TFRAG$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN(16)    r     1 KNN_LIFETIME_UNIT          0-0-0/w STRC(48)    r     1 KNN_LOCK
     0-0-0/w PTR         r     1 KNN_RASSMHD$               0-0-0/w PTR         r     1 KNN_RASSMTL$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:288  

     0-0-0/w EPTR        r     1 CALLEDFROM$                0-0-0/w STRC(80)    r     1 K$NFRAG
     0-0-0/w STRC(656)   r     1 K$NHDR                     0-0-0/w STRC(72)    r     1 K$NPDU_FIXED
     0-0-0/w UBIN(16)    r     1 ONEWORD


   Procedure KNN$TIMER requires 295 words for executable code.
   Procedure KNN$TIMER requires 68 words of local(AUTO) storage.

    No errors detected in file KNN$SUBS.:E05TSI    .
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:289  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:290  
          MINI XREF LISTING

CALLEDFROM$
      8151**DCL      8213<<ASSIGN
DESTINATION.ADDRESS_N
      8065**DCL      8066--REDEF
ERRVAL
      8189**DCL      8213--ASSIGN   8214<>CALL
E_DSCRD_LIFEEXPASSM
      7515**DCL      8214<>CALL
GH$TMR_BLK
      8140**DCL      8253<>CALL
GH$TMR_BLK.ARG
      8144**DCL      8145--REDEF
GH$TMR_BLK.INTERVAL
      8145**DCL      8252<<ASSIGN
GH$TMR_BLK.PROC$
      8144**DCL      8251<<ASSIGN
GHE$ERRLOG
      7282**DCL-ENT  8214--CALL
GHH$LOCK
      6981**DCL-ENT  8196--CALL
GHH$UNLOCK
      6981**DCL-ENT  8259--CALL
GHS$SET_TMR
      7281**DCL-ENT  8253--CALL
HDR$
      8181**DCL      7751--IMP-PTR  8198<<ASSIGN   8199>>DOWHILE  8200>>ASSIGN   8200>>ASSIGN   8201>>IF
      8202>>ASSIGN   8206>>ASSIGN   8207>>ASSIGN   8210>>ASSIGN   8211>>ASSIGN   8216>>IF       8217>>ASSIGN
      8222>>ASSIGN   8222>>ASSIGN   8224>>IF       8225>>ASSIGN   8230>>ASSIGN   8230>>ASSIGN   8232>>DOWHILE
      8233>>ASSIGN   8237>>ASSIGN   8240>>ASSIGN   8245>>CALL     8249<<ASSIGN   8249>>ASSIGN
K$NFRAG.LINK$
      7722**DCL      8233>>ASSIGN
K$NHDR.BLINK$
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:291  
      7764**DCL      8216>>IF       8219<<ASSIGN   8222>>ASSIGN   8225>>ASSIGN   8230<<ASSIGN   8230>>ASSIGN
K$NHDR.DESTINATION
      7847**DCL      8206--ASSIGN
K$NHDR.DESTINATION.ADDRESS_N
      7877**DCL      7878--REDEF
K$NHDR.FLINK$
      7760**DCL      8217>>ASSIGN   8222<<ASSIGN   8222>>ASSIGN   8224>>IF       8227<<ASSIGN   8230>>ASSIGN
      8249>>ASSIGN
K$NHDR.FRAG$
      7768**DCL      8232>>DOWHILE  8233>>ASSIGN   8237<<ASSIGN
K$NHDR.HDR$
      7881**DCL      8210>>ASSIGN   8240>>ASSIGN
K$NHDR.REASSEMTIM
      7772**DCL      8200<<ASSIGN   8200>>ASSIGN   8201>>IF
K$NHDR.RECVSZ
      7898**DCL      8211>>ASSIGN
K$NHDR.SOURCE
      7795**DCL      8207--ASSIGN
K$NHDR.SOURCE.ADDRESS_N
      7825**DCL      7826--REDEF
K$NHDR.SRCNODE#
      7911**DCL      8202>>ASSIGN
K$NPDU_FIXED
      8085**DCL      8214<>CALL     8214--CALL
K$NPDU_FIXED.LENGTH
      8091**DCL      8209>>ASSIGN
KNN$SENDERR
      7279**DCL-ENT  8212--CALL
KNN$TIMER
         7**PROC     8213--ASSIGN   8251--ASSIGN
KNN_LIFETIME_UNIT
      8157**DCL      8252>>ASSIGN
KNN_LOCK
      8170**DCL      8196<>CALL     8259<>CALL
KNN_RASSMHD$
      8155**DCL      8198>>ASSIGN   8217<<ASSIGN   8218>>IF       8219>>ASSIGN
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:292  
KNN_RASSMTL$
      8156**DCL      8225<<ASSIGN   8226>>IF       8227>>ASSIGN
KVB$RLS2NSYS
      7277**DCL-ENT  8234--CALL     8241--CALL     8245--CALL
NETPARM
      7561**DCL      8212<>CALL
NETPARM.DST_ADDR$
      7695**DCL      8033--IMP-PTR  8207<<ASSIGN
NETPARM.ERRCODE
      7668**DCL      8208<<ASSIGN
NETPARM.FPT$
      7680**DCL      7929--IMP-PTR
NETPARM.MSG$
      7568**DCL      7573--REDEF
NETPARM.NHDR$
      7620**DCL      7621--REDEF    8085--IMP-PTR  8209>>ASSIGN   8210<<ASSIGN   8214>>CALL
NETPARM.NHDRSZ
      7626**DCL      8211<<ASSIGN
NETPARM.NODE
      7663**DCL      8202<<ASSIGN
NETPARM.RECTYPE
      7647**DCL      8209<<ASSIGN
NETPARM.SHDR$
      7598**DCL      7599--REDEF
NETPARM.SRC_ADDR$
      7690**DCL      7981--IMP-PTR  8206<<ASSIGN
NETPARM.THDR$
      7609**DCL      7610--REDEF
NETPARM.UHDR$
      7584**DCL      7585--REDEF
NETPARM_C.MSG$
      7304**DCL      7309--REDEF
NETPARM_C.NHDR$
      7356**DCL      7357--REDEF
NETPARM_C.SHDR$
      7334**DCL      7335--REDEF
PL6.E3A0      #006=KNN$TIMER File=KNN$SUBS.:E05TSI                               WED 07/30/97 01:10 Page:293  
NETPARM_C.THDR$
      7345**DCL      7346--REDEF
NETPARM_C.UHDR$
      7320**DCL      7321--REDEF
ONEWORD
      8150**DCL      8234<>CALL     8241<>CALL     8245<>CALL
PRTCLERR
      7466**DCL      8235<>CALL     8242<>CALL     8246<>CALL
SCREECH
      7280**DCL-ENT  8235--CALL     8242--CALL     8246--CALL
SIZE
      8188**DCL      8149--IMP-SIZ
SOURCE.ADDRESS_N
      8013**DCL      8014--REDEF
TFRAG$
      8182**DCL      7717--IMP-PTR  8233<<ASSIGN   8234>>CALL     8237>>ASSIGN   8240<<ASSIGN   8241>>CALL
