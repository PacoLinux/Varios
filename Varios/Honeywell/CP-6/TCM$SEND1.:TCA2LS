VERSION A02

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:1    
        1        1        /*M*    TCM$SEND1   SMTP Mail Sender, part 1                        */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        TCM$NETSEND: PROC MAIN;
        9        9        %INCLUDE B$JIT;
       10      299        %INCLUDE B_ERRORS_C;
       11     1426        %INCLUDE CP_6;
       12     1507        %INCLUDE CP_6_SUBS;
       13     2047        %INCLUDE VM_MACRO_C;
       14     3315        %INCLUDE XSL_SOCKET_M;
       15     4076            %XSL_SOCKINIT( FPTN=TCM_SOCKINIT, MAXSOCK=1, BUFSIZE=4096, STCLASS=
              4076                "CONSTANT SYMDEF");
       16     4199        %INCLUDE XU_MACRO_C;
       17     7305        %INCLUDE XUD_UTS_M;
       18     7387            %XUD$UTS_ENTRIES;
       19     7419            %XUD_UTS_EQU;
       20     7430        %INCLUDE XUG_ENTRY;
       21     7461        %INCLUDE XUW_MACRO_C;
       22     7596
       23     7597            %F$DCB;
       24     7654            %B$TCB;
       25     7657            %B$ALT;
       26     7665
       27     7666    1       DCL B$DS3$ PTR SYMREF;
       28     7667    1       DCL B$DS5$ PTR SYMREF;
       29     7668    1       DCL B$TCB$ PTR SYMREF;
       30     7669    1       DCL B$JIT$ PTR SYMREF;
       31     7670
       32     7671    1       DCL XSL$SOCKINIT ENTRY(1) ALTRET;
       33     7672    1       DCL XUR$ERRMSG ENTRY(7) ALTRET;
       34     7673    1       DCL X$WILDCMP ENTRY(1) ALTRET;
       35     7674
       36     7675    1       DCL M$ME DCB;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:2    
       37     7676    1       DCL M$SI DCB;
       38     7677    1       DCL M$UI DCB;
       39     7678    1       DCL M$DO DCB;
       40     7679
       41     7680        /****** MONITOR SERVICE PARAMETERS ******/
       42     7681
       43     7682            %FPT_CLOSE( FPTN=CLOSE_SI, STCLASS=CONSTANT, DCB=M$SI, DISP=SAVE);
       44     7724            %FPT_WRITE( FPTN=WRITE_DO, DCB=M$DO);
       45     7755            %FPT_OPEN( FPTN=OPEN_UI, STCLASS=CONSTANT, DCB=M$UI);
       46     7864            %FPT_READ( FPTN=READ_UI, STCLASS=CONSTANT, DCB=M$UI, BUF=QUOTE_BUF);
       47     7903            %FPT_CLOSE( FPTN=CLOSE_UI, STCLASS=CONSTANT, DCB=M$UI, DISP=SAVE);
       48     7945            %FPT_OPEN( FPTN=OPEN_FOLDER, DCB=M$FOLDER, SCRUB=YES, ASN=FILE,
       49     7946                       FUN=UPDATE, SHARE=ALL, NAME=MAIL_CENTRAL, ACCT=TCM_ACCOUNT,
       50     7947                       STCLASS=CONSTANT);
       51     8056            %FPT_OPEN( FPTN=OPEN_MESSAGE, DCB=M$FOLDER, ASN=FILE,
       52     8057                       FUN=UPDATE, SHARE=NONE, ACCT=TCM_MESSACCT);
       53     8166            %FPT_OPEN( FPTN=OPEN_REGISTRY, STCLASS=CONSTANT, DCB=M$REGISTRY, ASN=FILE,
       54     8167                       FUN=IN, SHARE=ALL, NAME=MAIL_REGISTRY, ACCT=TCM_ACCOUNT);
       55     8276            %FPT_PRECORD( FPTN=POSITION_FOLDER, DCB=M$FOLDER);
       56     8297            %FPT_READ( FPTN=READ_FOLDER, DCB=M$FOLDER);
       57     8336            %FPT_READ( FPTN=READ_REGISTRY, DCB=M$REGISTRY);
       58     8375            %FPT_DELREC( FPTN=DELETE_FOLDER, DCB=M$FOLDER);
       59     8394            %FPT_WRITE( FPTN=WRITE_FOLDER, DCB=M$FOLDER);
       60     8425            %FPT_CLOSE( FPTN=CLOSE_FOLDER, DCB=M$FOLDER, DISP=SAVE, STCLASS=CONSTANT);
       61     8467            %FPT_CLOSE( FPTN=ZAP_FOLDER, DCB=M$FOLDER, DISP=RELEASE, STCLASS=CONSTANT);
       62     8509            %FPT_CLOSE( FPTN=CLOSE_REGISTRY, DCB=M$REGISTRY, DISP=SAVE, STCLASS=CONSTANT);
       63     8551            %FPT_ENQ( FPTN=ENQ_ON_PROFILE, STCLASS=CONSTANT, DCB=M$FOLDER,
       64     8552                      RNAME=VM_PRORES, SHARE=NONE);
       65     8570            %FPT_DEQ( FPTN=DEQ_ON_PROFILE, STCLASS=CONSTANT, DCB=M$FOLDER,
       66     8571                      RNAME=VM_PRORES);
       67     8588            %FPT_ENQ( FPTN=ENQ_ON_FILE, STCLASS=CONSTANT, DCB=M$FOLDER,
       68     8589                      RNAME=VM_FILERES, SHARE=NONE, WAIT_TIME=0);
       69     8607            %FPT_DEQ( FPTN=DEQ_ON_FILE, STCLASS=CONSTANT, DCB=M$FOLDER,
       70     8608                      RNAME=VM_FILERES);
       71     8625            %FPT_ENQ( FPTN=ENQ_ON_HEADER, STCLASS=CONSTANT, DCB=M$FOLDER,
       72     8626                      RNAME=VM_HEADRES, SHARE=NONE, WAIT_TIME=0);
       73     8644            %FPT_DEQ( FPTN=DEQ_ON_HEADER, STCLASS=CONSTANT, DCB=M$FOLDER,
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:3    
       74     8645                      RNAME=VM_HEADRES);
       75     8662            %FPT_OPEN( FPTN=OPEN_MAILMSG, STCLASS=CONSTANT, DCB=M$MSG, ASN=FILE,
       76     8663                       FUN=CREATE, EXIST=NEWFILE, CTG=YES, NAME=MAILMSG_NAME);
       77     8772            %FPT_WRITE( FPTN=WRITE_MAILMSG, DCB=M$MSG, BUF=MSGBUF);
       78     8803            %FPT_WRITE( FPTN=WRITE_MAILMSG_BLANK, STCLASS=CONSTANT,
       79     8804                    DCB=M$MSG, BUF=BLANK_LINE);
       80     8835            %FPT_CLOSE( FPTN=CLOSE_MAILMSG, DCB=M$MSG, STCLASS=CONSTANT);
       81     8877            %FPT_OPEN( FPTN=OPEN_HANGUP, STCLASS=CONSTANT, DCB=M$HANGUP, ASN=FILE,
       82     8878                       NAME=HANGUP_FILE, ACCT=TCM_ACCOUNT, FUN=UPDATE);
       83     8987            %FPT_CLOSE( FPTN=CLOSE_HANGUP, STCLASS=CONSTANT, DCB=M$HANGUP,
       84     8988                        DISP=RELEASE);
       85     9030            %FPT_OPEN( FPTN=OPEN_QUOTES, STCLASS=CONSTANT, DCB=M$QUOTES, ASN=FILE,
       86     9031                       FUN=CREATE, DISP=SCRATCH, ORG=KEYED, ACS=DIRECT);
       87     9140            %FPT_READ( FPTN=READ_QUOTES, STCLASS=CONSTANT, DCB=M$QUOTES,
       88     9141                       BUF=QUOTE_BUF, KEY=QUOTE_KEY, KEYS=YES);
       89     9180            %FPT_WRITE( FPTN=WRITE_QUOTES, STCLASS=STATIC, DCB=M$QUOTES,
       90     9181                        BUF=QUOTE_BUF, KEY=QUOTE_KEY);
       91     9212            %VLP_NAME( FPTN=HANGUP_FILE, STCLASS=CONSTANT, NAME='$$HANGUP');
       92     9239            %VLP_NAME( FPTN=MAILMSG_NAME, STCLASS=CONSTANT, NAME='*MAILMSG');
       93     9266            %VLP_NAME( FPTN=MAIL_CENTRAL, STCLASS=CONSTANT, NAME=':MAIL_CENTRAL');
       94     9293            %VLP_NAME( FPTN=MESS, STCLASS=CONSTANT, NAME=':MESS');
       95     9320            %VLP_NAME( FPTN=MAIL_REGISTRY, STCLASS=CONSTANT, NAME=':MAIL_REGISTRY');
       96     9347            %VLP_ACCT( FPTN=TCM_ACCOUNT, STCLASS="STATIC SYMDEF", ACCT=':SMTP');
       97     9360            %VLP_ACCT( FPTN=TCM_MESSACCT, STCLASS="STATIC SYMDEF", ACCT=':SMTP');
       98     9373            %FPT_LINK( FPTN=SEND_MAILMSG, STCLASS=CONSTANT,
       99     9374                       NAME=TCM_SEND_NAME, ACCT=TCM_SEND_ACCT, CMD=SEND_CMD);
      100     9392            %VLP_NAME( FPTN=TCM_SEND_NAME, STCLASS=CONSTANT SYMDEF, LEN=31, NAME='SEND');
      101     9419            %VLP_ACCT( FPTN=TCM_SEND_ACCT, STCLASS=CONSTANT SYMDEF, ACCT=':SYS');
      102     9432            %VLP_NAME( FPTN=SEND_CMD, STCLASS=CONSTANT,
      103     9433                       NAME="'SEND *MAILMSG (GATEWAY,MAIL=SMTP Mailer)'");
      104     9460            %FPT_READ( FPTN=READ_UC, DCB=M$UC, BUF=CMDBUF, STCLASS=CONSTANT);
      105     9499            %FPT_WRITE( FPTN=WRITE_ME, DCB=M$ME, BUF=CMDBUF);
      106     9530            %FPT_WRITE( FPTN=WRITE_ME_NULL, DCB=M$ME, STCLASS=CONSTANT);
      107     9561            %FPT_WRITE( FPTN=WRITE_ME_BLANK, DCB=M$ME, BUF=BLANK_LINE, STCLASS=CONSTANT);
      108     9592            %FPT_OPEN( FPTN=DRIBBLE_FILE, STCLASS=CONSTANT, DCB=M$ME,
      109     9593                       FUN=CREATE, EXIST=OLDFILE, ASN=FILE, CTG=YES,
      110     9594                       ORG=CONSEC, DISP=NAMED, NAME=DRIBBLE_NAME, ACCT=TCM_MESSACCT);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:4    
      111     9703            %VLP_NAME( FPTN=DRIBBLE_NAME, NAME=':DRIBSENT', STCLASS=CONSTANT);
      112     9730            %FPT_OPEN( FPTN=DRIBBLE_NO, DCB=M$ME, ASN=DEVICE, RES='NO', STCLASS=CONSTANT);
      113     9839            %FPT_TIME( FPTN=GET_SMTP_DATE, STCLASS=CONSTANT, SOURCE=UTS, DEST=EXT,
      114     9840                       DATE=DATEWORK, TSTAMP=MSG_TSTAMP, DAY=DAYBUF, TIME=TIMEBUF);
      115     9859            %FPT_TIME( FPTN=GET_TIME_NOW, SOURCE=CLOCK, DEST=EXT,
      116     9860                       DATE=DATEWORK, DAY=DAYBUF, TIME=TIMEBUF, STCLASS=CONSTANT);
      117     9879            %FPT_TIME( FPTN=GET_UTS_NOW, SOURCE=CLOCK, DEST=UTS,
      118     9880                    TSTAMP=TIME_NOW, STCLASS=CONSTANT);
      119     9899            %FPT_TIME( FPTN=GET_POSTED_TIME, STCLASS=CONSTANT,
      120     9900                       SOURCE=CLOCK, DEST=LOCAL, DATE=MSG_DATE, TIME=MSG_TIME);
      121     9919            %FPT_TIME( FPTN=GET_WAKEUP_TIME, STCLASS=CONSTANT,
      122     9920                       SOURCE=UTS, DEST=EXT, TSTAMP=TIME_NOW, TIME=TIMEBUF2);
      123     9939            %FPT_WAIT( FPTN=WAIT_A_SECOND, UNITS=1, STCLASS=CONSTANT);
      124     9953            %FPT_WAIT( FPTN=WAIT_A_WHILE);
      125     9967            %FPT_SCREECH( FPTN=SCREECH3, SCODE=SUA3, STCLASS="CONSTANT SYMDEF");
      126     9981            %FPT_SCREECH( FPTN=SCREECH4, SCODE=SUA4, STCLASS="CONSTANT SYMDEF");
      127     9995            %VLP_SUA( FPTN=SUA3, SEV=5, LDCTS=YES, CWSPT=YES,
      128     9996                    FCG='TC', MID='M', CODE=3333, STCLASS=CONSTANT);
      129    10066            %VLP_SUA( FPTN=SUA4, SEV=5, LDCTS=YES, CWSPT=YES,
      130    10067                    FCG='TC', MID='M', CODE=4444, STCLASS=CONSTANT);
      131    10137            %FPT_GDS( FPTN=GET_BUFFERS, STCLASS=CONSTANT,
      132    10138                      SEGSIZE=4096, RESULTS=MAIL_BUFFERS);
      133    10154            %FPT_FDS( FPTN=RELEASE_BUFFERS, STCLASS=CONSTANT,
      134    10155                      SEGSIZE=4096, RESULTS=MAIL_BUFFERS);
      135    10170            %FPT_GDS( FPTN=GET_ADDRESSES, STCLASS=CONSTANT,
      136    10171                      SEGSIZE=4096, RESULTS=MAIL_ADDRESSES);
      137    10187            %FPT_FDS( FPTN=RELEASE_ADDRESSES, STCLASS=CONSTANT,
      138    10188                      SEGSIZE=4096, RESULTS=MAIL_ADDRESSES);
      139    10203            %FPT_RESCTL( FPTN=RELEASE_PACKS, RPSN=PSN, STCLASS=CONSTANT);
      140    10220            %VLP_RPSN( FPTN=PSN, DISP=REM, N=50);
      141    10235            %FPT_PRIV( FPTN=JIT_PRIV, STCLASS="CONSTANT SYMDEF", PRIV=%PR_JIT#);
      142    10250            %FPT_ERRMSG( FPTN=GET_MAIL_ERROR_CODE, STCLASS=STATIC,
      143    10251                         BUF=MAIL_ERROR_CODE, FILENAME=VMERRMSG, FILEACCT=COLON_SYS,
      144    10252                         RESULTS=VLR_ERRMSG);
      145    10279            %VLP_NAME( FPTN=VMERRMSG, STCLASS=CONSTANT, NAME=':VMERRMSG');
      146    10306            %VLP_ACCT( FPTN=COLON_SYS, ACCT=':SYS', STCLASS=CONSTANT);
      147    10319            %VLR_ERRMSG;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:5    
      148    10341            %FPT_ALIB( LIBNAME=DELTA_NAME, RETRN=NO, STCLASS=CONSTANT);
      149    10358            %VLP_NAME( FPTN=DELTA_NAME, NAME='DELTA', STCLASS=CONSTANT);
      150    10385            %FPT_READ (FPTN=READ_SITE,KEY=VM_SITEKEY,KEYS=YES);
      151    10424
      152    10425        /* Status messages */
      153    10426        %MACRO MESSAGE( NAM=DUMMY, STC=CONSTANT, MSG="''");
      154    10427            %VLP_NAME( FPTN=NAM, STCLASS=STC, NAME=MSG);
      155    10428        %MEND;
      156    10429            %MESSAGE( NAM=IDLE, STC=STATIC, MSG="'Idle until HH:MM:SS'");
      157    10458            %MESSAGE( NAM=SEARCHING, MSG="'Searching for mail'");
      158    10487            %MESSAGE( NAM=CONNECTING, MSG="'Calling remote host'");
      159    10516            %MESSAGE( NAM=WAITING_FOR_SMTP_GREETING, MSG="'Looking for SMTP salutation'");
      160    10545            %MESSAGE( NAM=LOGGING_ON_TO_SMTP, MSG="'Establishing SMTP dialog'");
      161    10574            %MESSAGE( NAM=DECODING_HEADER, MSG="'Decoding CP-6 header'");
      162    10603            %MESSAGE( NAM=SENDING_ADDRESSES, MSG="'Sending addresses'");
      163    10632            %MESSAGE( NAM=SENDING_HEADER, MSG="'Sending message header'");
      164    10661            %MESSAGE( NAM=SENDING_MESSAGE_BODY, STC=STATIC,
      165    10662                      MSG="'Sending body line MMMM of NNNN'");
      166    10691            %MESSAGE( NAM=DRAINING_COMGROUP, STC=STATIC,
      167    10692                      MSG="'Draining; NNNN records remain'");
      168    10721            %MESSAGE( NAM=AWAITING_FINAL_ACK, MSG="'Awaiting acknowledgement'");
      169    10750            %MESSAGE( NAM=DELETING_MESSAGE, MSG="'Deleting message'");
      170    10779            %MESSAGE( NAM=REJECTING_MESSAGE, MSG=
             10779                "'Informing sender that message was rejected'");
      171    10808            %MESSAGE( NAM=ACKNOWLEDGING_MESSAGE, MSG=
             10808                "'Acknowledging that message has been forwarded'");
      172    10837            %MESSAGE( NAM=LOGGING_OFF_OF_SMTP, MSG="'Disconnecting from SMTP'");
      173    10866
      174    10867        %MACRO LOG( NAME=NAME, STATUS='?');
      175    10868            DCL 1 NAME CONSTANT,
      176    10869                 2 * SBIN WORD INIT( -1),
      177    10870                 2 TEXT CHAR(7) INIT( STATUS);
      178    10871        %MEND;
      179    10872            %LOG( NAME=NO_MODEM, STATUS='NoComm');
      180    10877            %LOG( NAME=NO_HOST, STATUS='NoHost');
      181    10882            %LOG( NAME=NO_SMTP, STATUS='NoSMTP');
      182    10887
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:6    
      183    10888        /**** GETCMD definitions ****/
      184    10889            %XUG_INIT( COMMANDS=NO, GOODCMD=YES);
      185    11302            %XUG_GETCMD( INDCB=M$SI, OUTDCB=M$DO, NODES=TCM_CONFIG_CMD,
      186    11303                         PROMPT=PROMPTSTRING);
      187    11641            %PARSE$OUT( STCLASS="BASED( OUT$)");
      188    11686            %PARSE$SYM( STCLASS="BASED( OUT$)");
      189    11724            %P_PCB( NAME=P$PCB, STCLASS="BASED( XUG_GETCMD.PCB$)");
      190    11923            %XUW_WILDCARD;
      191    12019
      192    12020        /* mailbox definitions */
      193    12021            %VM_KEYTYPES;
      194    12042            %VM_ADDTYPES;
      195    12046            %VM_BODYTYPES;
      196    12052            %VM_PROFILE( STCLASS="BASED( PROFILE$)");
      197    12139            %VM_PROKEY( STCLASS=CONSTANT);
      198    12154            %VM_HEADER( STCLASS="BASED( HEADER$)");
      199    12283            %VM_INFOKEY;
      200    12300            %VM_ADD_HEAD( STCLASS="BASED( ADDRESS$)");
      201    12329            %VM_UADDRESS( STCLASS="BASED( ALIAS$)");
      202    12366            %VM_LISTKEY;
      203    12382            %VM_BODYREC( STCLASS="BASED( BODY$)");
      204    12414            %VM_BODYKEY;
      205    12434            %VM_PRORES( STCLASS=CONSTANT);
      206    12448            %VM_PRORES( NAME=VM_FILERES, STCLASS=CONSTANT, RES='FILE');
      207    12462            %VM_HEADRES;
      208    12476            %VM_SITE (NAME=VM_SITE,STCLASS=" ");
      209    12500            %VM_SITEKEY (NAME=VM_SITEKEY,STCLASS=CONSTANT);
      210    12515        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:7    
      211    12516        /****** COMMON DEFINITIONS ******/
      212    12517
      213    12518        %INCLUDE TCM_COMMON_M;
      214    12549        %INCLUDE TCM_SEND_E;
      215    12655
      216    12656    1       DCL M$BOX DCB;
      217    12657    1       DCL M$CMD DCB;
      218    12658    1       DCL M$MSG DCB;
      219    12659    1       DCL M$FOLDER DCB;
      220    12660    1       DCL M$REGISTRY DCB;
      221    12661    1       DCL M$HANGUP DCB;
      222    12662    1       DCL M$QUOTES DCB;
      223    12663
      224    12664    1       DCL M$BOX$ PTR;
      225    12665    1       DCL M$CMD$ PTR;
      226    12666    1       DCL M$MSG$ PTR;
      227    12667    1       DCL M$REGISTRY$ PTR;
      228    12668    1       DCL M$FOLDER$ PTR;
      229    12669    1       DCL M$QUOTES$ PTR;
      230    12670    1       DCL M$SI$ PTR;
      231    12671
      232    12672    1       DCL TCM$START_SMTP ENTRY(4);
      233    12673    1       DCL TCM$READ_SMTP ENTRY(3) ALTRET;
      234    12674    1       DCL TCM$READ_SMTP_NULLOK ENTRY(3) ALTRET;
      235    12675    1       DCL TCM$WRITE_SMTP ENTRY(2) ALTRET;
      236    12676    1       DCL TCM$DRAIN_SMTP ENTRY(1);
      237    12677    1       DCL TCM$STOP_SMTP ENTRY;
      238    12678    1       DCL TCM$WRITE_AUDIT_LOG ENTRY(2);
      239    12679    1       DCL TCM$WRITE_AUDIT_ON ENTRY(2);
      240    12680    1       DCL TCM$WRITE_AUDIT_OFF ENTRY(2);
      241    12681
      242    12682    1       DCL TCM_SMTP_BAILOUT REMEMBER STATIC SYMDEF;
      243    12683    1       DCL TCM_SMTP_PROGRESS UBIN WORD STATIC SYMDEF;
      244    12684
      245    12685    1       DCL 1 NODENAME STATIC,
      246    12686    1            2 COUNT UBIN BYTE CALIGNED INIT(3),
      247    12687    1            2 TEXT CHAR(63) INIT( 'CP6');
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:8    
      248    12688    1       DCL 1 SITE_NAME STATIC,
      249    12689    1            2 COUNT UBIN BYTE CALIGNED INIT(3),
      250    12690    1            2 TEXT CHAR(63) INIT( 'CP6');
      251    12691
      252    12692    1       DCL PROMPTSTRING CHAR(0) CONSTANT INIT( '{} ');
      253    12693    1       DCL TCM_CONFIG_CMD UBIN WORD SYMREF READONLY;
      254    12694
      255    12695    1       DCL TCM_DRIBBLE BIT(36) STATIC SYMDEF INIT( %NO#);
      256    12696    1       DCL TCM_DRIBBLE_ME BIT(36) STATIC SYMDEF INIT( %NO#);
      257    12697    1       DCL TCM_TESTMODE BIT(1) STATIC SYMDEF INIT( %FALSE);
      258    12698    1       DCL FLOW_CONTROL_ENABLED BIT(1) ALIGNED;
      259    12699    1       DCL MSG_COUNT UBIN;
      260    12700    1       DCL VFC CHAR(1) STATIC INIT( ' ');
      261    12701
      262    12702    1       DCL VLEN UBIN;
      263    12703    1       DCL LOC  UBIN;
      264    12704    1       DCL LOCE UBIN;
      265    12705    1       DCL TVAL UBIN;
      266    12706    1       DCL FILL$ PTR;
      267    12707    1       DCL OUT$ PTR;
      268    12708    1       DCL TCM_PROGNAME CHAR(7) STATIC SYMDEF;
      269    12709    1       DCL TCM_STUCKEE CHAR(32) STATIC SYMDEF INIT( ' ');
      270    12710    1       DCL TCM_TZTEXT CHAR(6) STATIC SYMDEF INIT( ' PST  ');
      271    12711    1       DCL TCM_UTOFFSET SBIN STATIC SYMDEF INIT( %( -8 * %UTS_CSEC_HOUR#));
      272    12712    1       DCL TCM_LOGON CHAR(32) SYMREF;
      273    12713    1       DCL TCM_PHONE(0:3) CHAR(11) STATIC SYMDEF;
      274    12714    1       DCL CMN2UTS(0:9) SBIN CONSTANT INIT(
      275    12715    1           0, 0, -5, -4, -6, -5, -7, -6, -8, -7);
      276    12716    1       DCL TCP_FLAVOR BIT(1) STATIC;
      277    12717    1       DCL TERMINATING BIT(1);
      278    12718    1       DCL MAIL_BUFFERS VECTOR STATIC;
      279    12719    1       DCL MAIL_ADDRESSES VECTOR STATIC;
      280    12720    1       DCL TIME_NOW UBIN STATIC;
      281    12721    1       DCL TIME_THEN UBIN;
      282    12722    1       DCL UTS_DIFF SBIN;
      283    12723    1       DCL HEADER_ARS SBIN;
      284    12724    1       DCL SITENAME CHAR(31);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:9    
      285    12725    1       DCL SITES SBIN WORD;
      286    12726    1       DCL CURR_SITE SBIN WORD;
      287    12727    1       DCL THIS_SITE SBIN WORD;
      288    12728    1       DCL NODES SBIN WORD;
      289    12729    1       DCL THIS_NODE SBIN WORD;
      290    12730    1       DCL SAVED_ACCN CHAR(8);
      291    12731    1       DCL SAVED_UNAME CHAR(12);
      292    12732    1       DCL QUOTE_COUNT UBIN;
      293    12733    1       DCL MESSAGE_FILE BIT(1);
      294    12734    1       DCL USER_COUNT UBIN;
      295    12735    1       DCL TOTAL_READY UBIN;
      296    12736    1       DCL IS_OR_VIA UBIN;
      297    12737    1       DCL 1 HITS,
      298    12738    1            2 PRIMARY BIT(1),
      299    12739    1            2 C BIT(1),
      300    12740    1            2 BC BIT(1);
      301    12741
      302    12742    1       DCL 1 SITE(0:%MAX_SMTP_SITE),
      303    12743    1            2 NAME,
      304    12744    1             3 COUNT UBIN BYTE CALIGNED,
      305    12745    1             3 TEXT CHAR(31),
      306    12746    1            2 LOGON CHAR(32),
      307    12747    1            2 ADDRESS CHAR(32),
      308    12748    1            2 IDENT,
      309    12749    1             3 COUNT UBIN BYTE CALIGNED,
      310    12750    1             3 TEXT CHAR(31),
      311    12751    1            2 OWN_REVERSE_PATH,
      312    12752    1             3 COUNT UBIN BYTE CALIGNED,
      313    12753    1             3 TEXT CHAR(31),
      314    12754    1            2 INDIRECT_REVERSE_PATH,
      315    12755    1             3 COUNT UBIN BYTE CALIGNED,
      316    12756    1             3 TEXT CHAR(31),
      317    12757    1            2 TYPE UBIN WORD,
      318    12758    1            2 PENDING SBIN WORD,
      319    12759    1            2 TRY_INTERVAL UBIN WORD,
      320    12760    1            2 RETRY_INTERVAL UBIN WORD,
      321    12761    1            2 FROM_TIME UBIN WORD,
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:10   
      322    12762    1            2 TO_TIME UBIN WORD,
      323    12763    1            2 LAST_TRY UBIN WORD,
      324    12764    1            2 NEXT_TRY UBIN WORD,
      325    12765    1            2 LAST_STATUS UBIN,
      326    12766    1            2 RR_ACTION UBIN(2) UNAL,
      327    12767    1            2 DR_ACTION UBIN(2) UNAL;
      328    12768
      329    12769    1       DCL 1 NODE(0:%MAX_SMTP_NODE),
      330    12770    1            2 NAME CHAR(32),
      331    12771    1            2 SITE SBIN,
      332    12772    1            2 REVERSE_PATH,
      333    12773    1             3 COUNT UBIN BYTE CALIGNED,
      334    12774    1             3 TEXT CHAR(31),
      335    12775    1            2 FLAGS,
      336    12776    1             3 QUOTES BIT(1),
      337    12777    1            2 IS_OR_VIA UBIN;
      338    12778
      339    12779    1       DCL 1 USERS(0:%MAX_USERS),
      340    12780    1            2 LIST UBIN,
      341    12781    1            2 L UBIN,
      342    12782    1            2 T CHAR(%PATH_SIZE);
      343    12783
      344    12784    1       DCL 1 REWRITE(0:%MAX_REWRITES),
      345    12785    1            2 TYP SBIN,
      346    12786    1            2 * SBIN,
      347    12787    1            2 OLD,
      348    12788    1             3 LEN UBIN BYTE CALIGNED,
      349    12789    1             3 TXT CHAR(31) CALIGNED,
      350    12790    1            2 NEW,
      351    12791    1             3 LEN UBIN BYTE CALIGNED,
      352    12792    1             3 TXT CHAR(31) CALIGNED;
      353    12793    1       DCL REWRITES SBIN;
      354    12794
      355    12795    1       DCL SKIP_BLANKS(0:127) CONSTANT UBIN(9) CALIGNED INIT(
      356    12796                /** blank=0  alphanumeric=1  special=2  control=3 **/
      357    12797    1           3*32,0,1*15,2*10,1*7,2*26,1*6,2*26,1*4,3);
      358    12798
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:11   
      359    12799            /****** I/O BUFFERS ******/
      360    12800    1       DCL LINEBUF CHAR( %LINE_SIZE) STATIC INIT( ' ');
      361    12801    1       DCL LINELEN UBIN STATIC INIT( 1);
      362    12802    1       DCL LINE$ PTR CONSTANT INIT( ADDR( LINEBUF));
      363    12803    1       DCL LINE BASED( LINE$) CHAR( LINELEN);
      364    12804
      365    12805    1       DCL MAIL_ERROR_CODE(0:9) CHAR(120) STATIC;
      366    12806    1       DCL QUOTE_BUF CHAR( %LINE_SIZE) STATIC;
      367    12807    1       DCL 1 QUOTE_KEY STATIC,
      368    12808    1            2 L UBIN BYTE CALIGNED,
      369    12809    1            2 K UBIN(27) CALIGNED;
      370    12810
      371    12811    1       DCL CMDBUF CHAR( %LINE_SIZE) STATIC INIT( ' ');
      372    12812    1       DCL CMDBUF_ VECTOR CONSTANT INIT( VECTOR( CMDBUF));
      373    12813
      374    12814    1       DCL REPLY$ PTR CONSTANT INIT( ADDR( CMDBUF));
      375    12815    1       DCL REPLYLEN UBIN STATIC INIT( 1);
      376    12816    1       DCL REPLY BASED( REPLY$) CHAR( REPLYLEN);
      377    12817
      378    12818    1       DCL MSGBUF CHAR( %LINE_SIZE) STATIC INIT( ' ');
      379    12819    1       DCL MSGBUF_ VECTOR CONSTANT INIT( VECTOR( MSGBUF));
      380    12820
      381    12821    1       DCL PATHERR CONSTANT CHAR(0) INIT(
      382    12822    1           'SMTP path address not found in message header or user registry.');
      383    12823    1       DCL MULTIPLEADDRESSERR CONSTANT CHAR(0) INIT(
      384    12824    1           'Addressee is registered as a list with more than one address.');
      385    12825    1       DCL NOTMULTICSADDRESSERR CONSTANT CHAR(0) INIT(
      386    12826    1           'Addressee is registered as something other than an ARPA address');
      387    12827    1       DCL COPYERR CONSTANT CHAR(0) INIT(
      388    12828    1           'Copy list contains non-local user alias');
      389    12829    1       DCL ADDRERR CONSTANT CHAR(0) INIT(
      390    12830    1           'SMTP path address found in both To: and Subject: of message header');
      391    12831    1       DCL TOERR CONSTANT CHAR(0) INIT(
      392    12832    1           'MAILGRAM contains too many (more than 100) internet addressees');
      393    12833
      394    12834    1       DCL BLANK_LINE CONSTANT CHAR(1) INIT( ' ');
      395    12835    1       DCL BLANK_COUNT UBIN STATIC INIT( 0);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:12   
      396    12836
      397    12837    1       DCL TEMPBUF CHAR(4) STATIC INIT( ' ');
      398    12838    1       DCL TEMPBUF_ VECTOR CONSTANT INIT( VECTOR( TEMPBUF));
      399    12839
      400    12840            /****** MESSAGE HEADER KEYWORDS ******/
      401    12841    1       DCL HDRDATE CONSTANT CHAR(0) INIT( 'Sent: ');
      402    12842    1       DCL HDRNUMBER CONSTANT CHAR(0) INIT( 'Number: ');
      403    12843    1       DCL HDRTO CONSTANT CHAR(0) INIT( 'To: ');
      404    12844    1       DCL HDRFROM CONSTANT CHAR(0) INIT( 'From: ');
      405    12845    1       DCL HDRSUBJ CONSTANT CHAR(0) INIT( 'Subject: ');
      406    12846    1       DCL HDRADDR CONSTANT CHAR(0) INIT( 'Address: ');
      407    12847    1       DCL HDRRE CONSTANT CHAR(0) INIT( 'Re: ');
      408    12848    1       DCL HDRC CONSTANT CHAR(0) INIT( 'C: ');
      409    12849    1       DCL HDRBC CONSTANT CHAR(0) INIT( 'Bc: ');
      410    12850
      411    12851    1       DCL MSGDATE CONSTANT CHAR(0) INIT( 'Date: ');
      412    12852    1       DCL MSGTO CONSTANT CHAR(0) INIT( 'To: ');
      413    12853    1       DCL MSGREALLY_TO CONSTANT CHAR(0) INIT( 'Really-to: ');
      414    12854    1       DCL MSGCC CONSTANT CHAR(0) INIT( 'cc: ');
      415    12855    1       DCL MSGREAL_CC CONSTANT CHAR(0) INIT( 'Real-cc: ');
      416    12856    1       DCL MSGBCC CONSTANT CHAR(0) INIT( 'bcc: ');
      417    12857    1       DCL MSGREAL_BCC CONSTANT CHAR(0) INIT( 'Real-bcc: ');
      418    12858    1       DCL MSGFROM CONSTANT CHAR(0) INIT( 'From: ');
      419    12859    1       DCL MSGREPLY CONSTANT CHAR(0) INIT( 'Reply-to: ');
      420    12860    1       DCL MSGSUBJ CONSTANT CHAR(0) INIT( 'Subject: ');
      421    12861    1       DCL MSGRE CONSTANT CHAR(0) INIT( 'References: ');
      422    12862    1       DCL MSGQUOTE CONSTANT CHAR(0) INIT( 'Randomness: ');
      423    12863    1       DCL MSGID CONSTANT CHAR(0) INIT( 'Message-ID: ');
      424    12864    1       DCL MSGREFID CONSTANT CHAR(0) INIT( 'In-Reply-To: ');
      425    12865    1       DCL MSGACKTO CONSTANT CHAR(0) INIT( 'Acknowledge-To: ');
      426    12866    1       DCL MSGRRTO CONSTANT CHAR(0) INIT( 'Return-Receipt-To: ');
      427    12867
      428    12868            /****** MESSAGE HEADER FIELDS ******/
      429    12869        %MACRO HEADER( NAM=DUMMY, SIZ=80, LOC=0);
      430    12870        %IF TEXTCHAR(LOC) = '0';
      431    12871            %LSET N$ = CHARTEXT( CONCAT( TEXTCHAR(NAM), '$'));
      432    12872        %ELSE;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:13   
      433    12873            %LSET N$ = CHARTEXT( TEXTCHAR(LOC));
      434    12874        %ENDIF;
      435    12875        %LSET N = CHARTEXT( TEXTCHAR(NAM));
      436    12876        %LSET LISTEXP = '1'B;
      437    12877        %LSET LISTSUB = '1'B;
      438    12878        %LSET LISTMAC = '1'B;
      439    12879            DCL %N$ PTR CONSTANT INIT( ADDR( %N));
      440    12880            DCL 1 %N STATIC,
      441    12881                 2 L UBIN INIT(0),
      442    12882                 2 T CHAR( SIZ) INIT( ' ');
      443    12883        %MEND;
      444    12884            %HEADER( NAM=FROMNAME, LOC=FROM$);
             12894    1       DCL FROM$ PTR CONSTANT INIT( ADDR( FROMNAME));
             12895    1       DCL 1 FROMNAME STATIC,
             12896    1            2 L UBIN INIT(0),
             12897    1            2 T CHAR( 80) INIT( ' ');
      445    12899            %HEADER( NAM=FROMSIGN, LOC=FROMNAME$);
             12909    1       DCL FROMNAME$ PTR CONSTANT INIT( ADDR( FROMSIGN));
             12910    1       DCL 1 FROMSIGN STATIC,
             12911    1            2 L UBIN INIT(0),
             12912    1            2 T CHAR( 80) INIT( ' ');
      446    12914            %HEADER( NAM=FROMADDR);
             12924    1       DCL FROMADDR$ PTR CONSTANT INIT( ADDR( FROMADDR));
             12925    1       DCL 1 FROMADDR STATIC,
             12926    1            2 L UBIN INIT(0),
             12927    1            2 T CHAR( 80) INIT( ' ');
      447    12929            %HEADER( NAM=REPLY_TO);
             12939    1       DCL REPLY_TO$ PTR CONSTANT INIT( ADDR( REPLY_TO));
             12940    1       DCL 1 REPLY_TO STATIC,
             12941    1            2 L UBIN INIT(0),
             12942    1            2 T CHAR( 80) INIT( ' ');
      448    12944            %HEADER( NAM=REPLYSIGN, LOC=REPLYNAME$);
             12954    1       DCL REPLYNAME$ PTR CONSTANT INIT( ADDR( REPLYSIGN));
             12955    1       DCL 1 REPLYSIGN STATIC,
             12956    1            2 L UBIN INIT(0),
             12957    1            2 T CHAR( 80) INIT( ' ');
      449    12959            %HEADER( NAM=REPLYADDR);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:14   
             12969    1       DCL REPLYADDR$ PTR CONSTANT INIT( ADDR( REPLYADDR));
             12970    1       DCL 1 REPLYADDR STATIC,
             12971    1            2 L UBIN INIT(0),
             12972    1            2 T CHAR( 80) INIT( ' ');
      450    12974            %HEADER( NAM=PATH, SIZ=%PATH_SIZE);
             12984    1       DCL PATH$ PTR CONSTANT INIT( ADDR( PATH));
             12985    1       DCL 1 PATH STATIC,
             12986    1            2 L UBIN INIT(0),
             12987    1            2 T CHAR( 240) INIT( ' ');
      451    12989            %HEADER( NAM=TONAME, LOC=TO$, SIZ=%PATH_SIZE);
             12999    1       DCL TO$ PTR CONSTANT INIT( ADDR( TONAME));
             13000    1       DCL 1 TONAME STATIC,
             13001    1            2 L UBIN INIT(0),
             13002    1            2 T CHAR( 240) INIT( ' ');
      452    13004            %HEADER( NAM=BAD_ADDRESS, SIZ=%LINE_SIZE);
             13014    1       DCL BAD_ADDRESS$ PTR CONSTANT INIT( ADDR( BAD_ADDRESS));
             13015    1       DCL 1 BAD_ADDRESS STATIC,
             13016    1            2 L UBIN INIT(0),
             13017    1            2 T CHAR( 255) INIT( ' ');
      453    13019            %HEADER( NAM=SUBJECT, SIZ=%LINE_SIZE);
             13029    1       DCL SUBJECT$ PTR CONSTANT INIT( ADDR( SUBJECT));
             13030    1       DCL 1 SUBJECT STATIC,
             13031    1            2 L UBIN INIT(0),
             13032    1            2 T CHAR( 255) INIT( ' ');
      454    13034            %HEADER( NAM=RE, SIZ=%LINE_SIZE);
             13044    1       DCL RE$ PTR CONSTANT INIT( ADDR( RE));
             13045    1       DCL 1 RE STATIC,
             13046    1            2 L UBIN INIT(0),
             13047    1            2 T CHAR( 255) INIT( ' ');
      455    13049            %HEADER( NAM=SIGNATURE, SIZ=%LINE_SIZE);
             13059    1       DCL SIGNATURE$ PTR CONSTANT INIT( ADDR( SIGNATURE));
             13060    1       DCL 1 SIGNATURE STATIC,
             13061    1            2 L UBIN INIT(0),
             13062    1            2 T CHAR( 255) INIT( ' ');
      456    13064            %HEADER( NAM=COMMENT, SIZ=%LINE_SIZE);
             13074    1       DCL COMMENT$ PTR CONSTANT INIT( ADDR( COMMENT));
             13075    1       DCL 1 COMMENT STATIC,
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:15   
             13076    1            2 L UBIN INIT(0),
             13077    1            2 T CHAR( 255) INIT( ' ');
      457    13079            %HEADER( NAM=TOSITE, SIZ=%HOST_SIZE);
             13089    1       DCL TOSITE$ PTR CONSTANT INIT( ADDR( TOSITE));
             13090    1       DCL 1 TOSITE STATIC,
             13091    1            2 L UBIN INIT(0),
             13092    1            2 T CHAR( 64) INIT( ' ');
      458    13094
      459    13095    1       DCL MSG_NUMBER UBIN WORD;
      460    13096    1       DCL MSG_TSTAMP UBIN STATIC INIT( 0);
      461    13097    1       DCL MSG_DATE CHAR(8) STATIC INIT( 'MM/DD/YY');
      462    13098    1       DCL MSG_TIME CHAR(11) STATIC INIT( 'HH:MM:SS.SS');
      463    13099
      464    13100    1       DCL 1 DATEWORK STATIC,
      465    13101    1            2 MON CHAR(3) INIT( 'MON'),
      466    13102    1            2 MONMASK REDEF MON BIT(27) CALIGNED,
      467    13103    1            2 * CHAR(1) INIT( ' '),
      468    13104    1            2 DD CHAR(2) INIT( 'DD'),
      469    13105    1            2 * CHAR(2) INIT( ' '''),
      470    13106    1            2 YY CHAR(2) INIT( 'YY');
      471    13107    1       DCL DATESTRING REDEF DATEWORK CHAR(10);
      472    13108    1       DCL DATEBUF CHAR(10) STATIC INIT( 'DD MON YY');
      473    13109    1       DCL DAYBUF CHAR(3) STATIC INIT( 'DAY');
      474    13110    1       DCL DAYMASK REDEF DAYBUF BIT(27) CALIGNED;
      475    13111
      476    13112    1       DCL TIMEBUF CHAR(5) STATIC INIT( 'HH:MM');
      477    13113    1       DCL TIMEBUF2 CHAR(8) STATIC INIT( 'HH:MM:SS');
      478    13114
      479    13115    1       DCL PROFILE$ PTR;
      480    13116    1       DCL HEADER$ PTR;
      481    13117    1       DCL BODY$ PTR;
      482    13118    1       DCL ADDRESS$ PTR;
      483    13119    1       DCL ALIAS$ PTR;
      484    13120
      485    13121    1       DCL TCM_XLATE_TO_UC(0:511) CHAR(1) UNAL CONSTANT SYMDEF INIT(
      486    13122    1            BINASC(0),BINASC(1),BINASC(2),BINASC(3),        /* NUL SOH STX ETX */
      487    13123    1            BINASC(4),BINASC(5),BINASC(6),BINASC(7),        /* EOT ENQ ACK BEL */
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:16   
      488    13124    1            BINASC(8),BINASC(9),BINASC(10),BINASC(11),      /* BS HT LF VT */
      489    13125    1            BINASC(12),BINASC(13),BINASC(14),BINASC(15),    /* FF CR SO SI */
      490    13126    1            BINASC(16),BINASC(17),BINASC(18),BINASC(19),    /* DLE DC1 DC2 DC3 */
      491    13127    1            BINASC(20),BINASC(21),BINASC(22),BINASC(23),    /* DC4 NAK SYN ETB */
      492    13128    1            BINASC(24),BINASC(25),BINASC(26),BINASC(27),    /* CAN EM SUB ESC */
      493    13129    1            BINASC(28),BINASC(29),BINASC(30),BINASC(31),    /* FS GS RS US */
      494    13130    1            BINASC(32),BINASC(33),BINASC(34),BINASC(35),    /* SP ! " # */
      495    13131    1            BINASC(36),BINASC(37),BINASC(38),BINASC(39),    /* $ % & ' */
      496    13132    1            BINASC(40),BINASC(41),BINASC(42),BINASC(43),    /* ( ) * + */
      497    13133    1            BINASC(44),BINASC(45),BINASC(46),BINASC(47),    /* , - . / */
      498    13134    1            BINASC(48),BINASC(49),BINASC(50),BINASC(51),    /* 0 1 2 3 */
      499    13135    1            BINASC(52),BINASC(53),BINASC(54),BINASC(55),    /* 4 5 6 7 */
      500    13136    1            BINASC(56),BINASC(57),BINASC(58),BINASC(59),    /* 8 9 : ; */
      501    13137    1            BINASC(60),BINASC(61),BINASC(62),BINASC(63),    /* < = > ? */
      502    13138    1            BINASC(64),BINASC(65),BINASC(66),BINASC(67),    /* @ A B C */
      503    13139    1            BINASC(68),BINASC(69),BINASC(70),BINASC(71),    /* D E F G */
      504    13140    1            BINASC(72),BINASC(73),BINASC(74),BINASC(75),    /* H I J K */
      505    13141    1            BINASC(76),BINASC(77),BINASC(78),BINASC(79),    /* L M N O */
      506    13142    1            BINASC(80),BINASC(81),BINASC(82),BINASC(83),    /* P Q R S */
      507    13143    1            BINASC(84),BINASC(85),BINASC(86),BINASC(87),    /* T U V W */
      508    13144    1            BINASC(88),BINASC(89),BINASC(90),BINASC(91),    /* X Y Z [ */
      509    13145    1            BINASC(92),BINASC(93),BINASC(94),BINASC(95),    /* \ ] ^ _ */
      510    13146        /*
      511    13147            ***       THIS SECTION OF THE TABLE CONVERTS THE LOWER CASE
      512    13148            ***       ALPHABET TO UPPER CASE WHEN USED WITH XLATE FUNCTION.
      513    13149            ***       THE COMMENTARY REFLECTS THE NORMAL ASCII CHARACTER WHICH
      514    13150            ***       USUALLY HOLDS THE POSITION IN THE TABLE.
      515    13151        */
      516    13152    1            BINASC(96),BINASC(65),BINASC(66),BINASC(67),    /* ' a b c */
      517    13153    1            BINASC(68),BINASC(69),BINASC(70),BINASC(71),    /* d e f g */
      518    13154    1            BINASC(72),BINASC(73),BINASC(74),BINASC(75),    /* h i j k */
      519    13155    1            BINASC(76),BINASC(77),BINASC(78),BINASC(79),    /* l m n o */
      520    13156    1            BINASC(80),BINASC(81),BINASC(82),BINASC(83),    /* p q r s */
      521    13157    1            BINASC(84),BINASC(85),BINASC(86),BINASC(87),    /* t u v w */
      522    13158    1            BINASC(88),BINASC(89),BINASC(90),BINASC(123),   /* x y z { */
      523    13159    1            BINASC(124),BINASC(125),BINASC(126),BINASC(127),/* | } ~ DEL */
      524    13160    1                        BINASC(32)*384);                    /* ALL ELSE BLANK */
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:17   
      525    13161        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:18   
      526    13162            /****** PROGRAM INITIALIZATION ******/
      527    13163    1       CALL INDEX( LOC, '(DEBUG)', B$JIT.CCBUF)
      528    13164    2       WHENRETURN DO;
      529    13165    2           CALL M$ALIB( FPT_ALIB)
      530    13166    3           WHENALTRETURN DO;
      531    13167    3               END;
      532    13168    2           END;
      533    13169    2       WHENALTRETURN DO;
      534    13170    2           END;
      535    13171    1       CALL INDEX( LOC, '(TCP)', B$JIT.CCBUF)
      536    13172    2       WHENRETURN DO;
      537    13173    2           TCM_PROGNAME = 'NETSEND';
      538    13174    2           TCP_FLAVOR = '1'B;
      539    13175    2           END;
      540    13176    2       WHENALTRETURN DO;
      541    13177    2           TCM_PROGNAME = 'MULSEND';
      542    13178    2           TCP_FLAVOR = '0'B;
      543    13179    2           END;
      544    13180    1       CALL TCM$WRITE_AUDIT_ON;
      545    13181    1       M$BOX$ = DCBADDR( DCBNUM( M$BOX));
      546    13182    1       M$CMD$ = DCBADDR( DCBNUM( M$CMD));
      547    13183    1       M$MSG$ = DCBADDR( DCBNUM( M$MSG));
      548    13184    1       M$FOLDER$ = DCBADDR( DCBNUM( M$FOLDER));
      549    13185    1       M$REGISTRY$ = DCBADDR( DCBNUM( M$REGISTRY));
      550    13186    1       M$SI$ = DCBADDR( DCBNUM( M$SI));
      551    13187    2       IF M$SI$->F$DCB.ASN# = %DEVICE# THEN DO;
      552    13188    2           CMDBUF = 'No config file specified on invocation.  I quit.';
      553    13189    2           CALL WRITEDO;
      554    13190    2           CALL M$ERR;
      555    13191    2           END;
      556    13192    1       ELSE
      557    13193    1           TCM_MESSACCT.ACCT# = M$SI$->F$DCB.ACCT#;
      558    13194    1       IF TCM_DRIBBLE THEN
      559    13195    1           CALL M$OPEN( DRIBBLE_FILE);
      560    13196    1       ELSE
      561    13197    1           IF NOT TCM_DRIBBLE_ME THEN
      562    13198    1               CALL M$OPEN( DRIBBLE_NO);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:19   
      563    13199    1       CALL INITIALIZE_CONFIGURATION
      564    13200    2       WHENALTRETURN DO;
      565    13201    2           CALL M$SPRIV( JIT_PRIV);
      566    13202    2           B$JIT.PRIV.ACTIVE.EXMM = %YES#;  /* so we can SNAP */
      567    13203    2           CALL M$SCREECH( SCREECH3);  /* ..a SNAP, really */
      568    13204    2           CALL M$EXIT;
      569    13205    2           END;
      570    13206    1       CALL M$SPRIV( JIT_PRIV)
      571    13207    2       WHENRETURN DO;
      572    13208    2           B$JIT.PRIV.JOB.FMSEC = %YES#;  /* needed later for SEND */
      573    13209    2           END;
      574    13210    2       WHENALTRETURN DO;
      575    13211    2           END;
      576    13212    1       CALL INITIALIZE_QUOTATIONS;
      577    13213    1       REMEMBER BAILOUT IN TCM_SMTP_BAILOUT;
      578    13214    1       TERMINATING = %NO#;
      579    13215    1       CALL XSL$SOCKINIT( TCM_SOCKINIT);
      580    13216    2       DO UNTIL TERMINATING;
      581    13217    2           TCM_SMTP_PROGRESS = %SMTP_NOP;
      582    13218    2           CALL M$OPEN( OPEN_HANGUP)
      583    13219    3           WHENALTRETURN DO;
      584    13220    3               END;
      585    13221    3           IF DCBADDR( DCBNUM( M$HANGUP))->F$DCB.FCD# THEN DO;
      586    13222    3               TERMINATING = %YES#;
      587    13223    3               CALL M$CLOSE( CLOSE_HANGUP);
      588    13224    3               END;
      589    13225    3           ELSE DO;
      590    13226    4               DO CURR_SITE = 0 TO SITES - 1;
      591    13227    4                   SITE.PENDING( CURR_SITE) = 0;
      592    13228    4                   END;
      593    13229    3               CALL M$OPEN( OPEN_FOLDER) ALTRET( BAILOUT);
      594    13230    3               CALL M$ENQ( ENQ_ON_FILE) ALTRET( BAILOUT);
      595    13231    3               CALL M$OPEN( OPEN_REGISTRY) ALTRET( BAILOUT);
      596    13232    3               CALL INIT_FOLDER_DATA_POOL;
      597    13233    3               TOTAL_READY = 0;
      598    13234    3               MESSAGE_FILE = %NO#;
      599    13235    3               CALL SCAN_ALL_HEADERS;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:20   
      600    13236    3               CALL M$DEQ( DEQ_ON_FILE)
      601    13237    4               WHENALTRETURN DO;
      602    13238    4                   END;
      603    13239    3               CALL M$CLOSE( CLOSE_FOLDER)
      604    13240    4               WHENALTRETURN DO;
      605    13241    4                   END;
      606    13242    3               CALL POSITION_TO_FIRST_MESS;
      607    13243    4               DO FOREVER;
      608    13244    4                   CALL OPEN_NEXT_MESS ALTRET( FINISHED_WITH_MESS_FILES);
      609    13245    4                   CALL SCAN_ALL_HEADERS;
      610    13246    4                   CALL M$CLOSE( CLOSE_FOLDER);
      611    13247    4                   END;
      612    13248    3   FINISHED_WITH_MESS_FILES:
      613    13249    3               CALL CHOOSE_A_SITE;
      614    13250    4               IF CURR_SITE ~= -1 THEN DO;
      615    13251    4                   CALL M$TIME( GET_TIME_NOW);
      616    13252    4                   CALL CONCAT( CMDBUF, TCM_PROGNAME, ' awake: ', DATESTRING, ' ',
             13252                            TIMEBUF);
      617    13253    4                   CALL INDEX( TVAL, '  ', CMDBUF);
      618    13254    4                   WRITE_ME.BUF_.BOUND = TVAL - 1;
      619    13255    4                   CALL M$WRITE( WRITE_ME);
      620    13256    4                   CALL SMTP_SESSION ALTRET( BAILOUT);
      621    13257    4                   END;
      622    13258    3   BAILOUT:
      623    13259    3               CALL TCM$STOP_SMTP;
      624    13260    4               IF M$FOLDER$->F$DCB.FCD# THEN DO;
      625    13261    4                   CALL M$CLOSE( CLOSE_FOLDER)
      626    13262    5                   WHENALTRETURN DO;
      627    13263    5                       END;
      628    13264    4                   END;
      629    13265    4               IF M$REGISTRY$->F$DCB.FCD# THEN DO;
      630    13266    4                   CALL M$CLOSE( CLOSE_REGISTRY)
      631    13267    5                   WHENALTRETURN DO;
      632    13268    5                       END;
      633    13269    4                   END;
      634    13270    3               CALL RELEASE_FOLDER_DATA_POOL;
      635    13271    3               IDLE.L# = 4;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:21   
      636    13272    3               CALL STATUS_UPDATE( IDLE);
      637    13273    3               END;
      638    13274    3           IF NOT TERMINATING THEN DO;
      639    13275    4               IF CURR_SITE ~= -1 THEN DO;
      640    13276    4                   SITE.LAST_STATUS( CURR_SITE) = TCM_SMTP_PROGRESS;
      641    13277    4                   SITE.LAST_TRY( CURR_SITE) = TIME_NOW;
      642    13278    5                   DO CASE SITE.LAST_STATUS( CURR_SITE);
      643    13279    5                       CASE( %SMTP_BUSY);
      644    13280    5                           CALL TCM$WRITE_AUDIT_LOG(
      645    13281    5                                   NO_MODEM, SITE.NAME( CURR_SITE));
      646    13282    5                       CASE( %SMTP_NOHOST);
      647    13283    5                           CALL TCM$WRITE_AUDIT_LOG(
      648    13284    5                                   NO_HOST, SITE.NAME( CURR_SITE));
      649    13285    5                       CASE( %SMTP_CONNECTED);
      650    13286    5                           CALL TCM$WRITE_AUDIT_LOG(
      651    13287    5                                   NO_SMTP, SITE.NAME( CURR_SITE));
      652    13288    5                       CASE( ELSE);
      653    13289    5                       END;
      654    13290    4                   END;
      655    13291    3               CALL M$DISPRES( RELEASE_PACKS)
      656    13292    4               WHENRETURN DO;
      657    13293    4                   CALL M$RELRES( RELEASE_PACKS)
      658    13294    5                   WHENALTRETURN DO;
      659    13295    5                       END;
      660    13296    4                   END;
      661    13297    3               CALL M$TIME( GET_UTS_NOW);
      662    13298    3               CALL XUD$UTS_ADJUST( TIME_THEN, TIME_NOW, %UTS_CSEC_HOUR#);
      663    13299    4               DO THIS_SITE = 0 TO SITES - 1;
      664    13300    4                   IF SITE.LAST_STATUS( THIS_SITE) = %SMTP_NOHOST OR
      665    13301    4                           SITE.LAST_STATUS( THIS_SITE) = %SMTP_CONNECTED OR
      666    13302    4                           SITE.LAST_STATUS( THIS_SITE) = %SMTP_SESSION THEN
      667    13303    4                       CALL XUD$UTS_ADJUST(
      668    13304    4                               SITE.NEXT_TRY( THIS_SITE),
      669    13305    4                               SITE.LAST_TRY( THIS_SITE),
      670    13306    4                               %UTS_CSEC_MIN# * SITE.RETRY_INTERVAL( THIS_SITE));
      671    13307    4                   ELSE
      672    13308    4                       IF SITE.PENDING( THIS_SITE) <= 0 THEN
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:22   
      673    13309    4                           CALL XUD$UTS_ADJUST(
      674    13310    4                                   SITE.NEXT_TRY( THIS_SITE),
      675    13311    4                                   TIME_NOW,
      676    13312    4                                   %UTS_CSEC_MIN# * SITE.RETRY_INTERVAL( THIS_SITE));
      677    13313    4                   TIME_THEN = MINIMUM( SITE.NEXT_TRY( THIS_SITE), TIME_THEN);
      678    13314    4                   END;
      679    13315    3               IF TCM_SMTP_PROGRESS = %SMTP_BUSY THEN
      680    13316    3                   WAIT_A_WHILE.V.UNITS# = 300;
      681    13317    4               ELSE DO;
      682    13318    4                   CALL XUD$UTS_DIFF_SEC( UTS_DIFF, TIME_THEN, TIME_NOW);
      683    13319    4                   WAIT_A_WHILE.V.UNITS# = MAXIMUM( UTS_DIFF+1, 15);
      684    13320    4                   END;
      685    13321    3               XUG_GETCMD.DCB_PARAM# = DCBNUM( NIL);
      686    13322    3               XUG_GETCMD.DISP# = %SAVE#;
      687    13323    3               CALL XUG$CLOSE_DCBS( XUG_GETCMD);
      688    13324    3               IDLE.L# = 19;
      689    13325    3               CALL M$TIME( GET_UTS_NOW);
      690    13326    3               CALL XUD$UTS_ADJUST( TIME_NOW, TIME_NOW, 100*WAIT_A_WHILE.V.UNITS#);
      691    13327    3               CALL M$TIME( GET_WAKEUP_TIME);
      692    13328    3               SUBSTR( IDLE.NAME#, 11, 8) = TIMEBUF2;
      693    13329    3               CALL STATUS_UPDATE( IDLE);
      694    13330    3               CALL M$WAIT( WAIT_A_WHILE);
      695    13331    3               END;
      696    13332    2           END;
      697    13333    1   EOJ:
      698    13334            /****** PROGRAM TERMINIATION ******/
      699    13335    1       XUG_GETCMD.DCB_PARAM# = DCBNUM( NIL);
      700    13336    1       XUG_GETCMD.DISP# = %SAVE#;
      701    13337    1       CALL XUG$CLOSE_DCBS( XUG_GETCMD);
      702    13338    1       CALL TCM$WRITE_AUDIT_OFF;
      703    13339    1       RETURN /* TO IBEX */;
      704    13340        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:23   
      705    13341    1   INITIALIZE_CONFIGURATION: PROC ALTRET;
      706    13342
      707    13343    2       DCL ERROR_FLAG BIT(1);
      708    13344    2       DCL HAVE_A_CMD BIT(1);
      709    13345    2       DCL I SBIN;
      710    13346    2       DCL J SBIN;
      711    13347    2       DCL OPT$ PTR;
      712    13348    2       DCL SUB$ PTR;
      713    13349    2       DCL CHARS CHAR(512) BASED CALIGNED;
      714    13350
      715    13351    2       SITES = 0;
      716    13352    2       NODES = 0;
      717    13353    2       REWRITES = 0;
      718    13354    2       ERROR_FLAG = %NO#;
      719    13355    2       CALL XUG$INIT( XUG_GETCMD, XUG_INIT);
      720    13356    2   SCAN:
      721    13357    3       DO FOREVER;
      722    13358    3           HAVE_A_CMD = %NO#;
      723    13359    4           DO UNTIL( HAVE_A_CMD);
      724    13360    4               CALL XUG$GETCMD( XUG_GETCMD)
      725    13361    5               WHENRETURN DO;
      726    13362    5                   HAVE_A_CMD = %YES#;
      727    13363    5                   END;
      728    13364    5               WHENALTRETURN DO;
      729    13365    5                   IF XUG_GETCMD.ERR#.MON# AND
      730    13366    5                           XUG_GETCMD.ERR#.CODE# = %E$EOF THEN
      731    13367    5                       EXIT SCAN;
      732    13368    5                   ERROR_FLAG = %YES#;
      733    13369    5                   XUG_GETCMD.ERR_CODE = XUG_GETCMD.ERR#;
      734    13370    5                   CALL XUG$ECHOIF( XUG_GETCMD);
      735    13371    5                   CALL XUG$ERRMSG( XUG_GETCMD);
      736    13372    5                   IF XUG_GETCMD.ERR#.MON# THEN
      737    13373    5                       EXIT SCAN;
      738    13374    5                   END;
      739    13375    4               END;
      740    13376    3           OUT$ = XUG_GETCMD.OUT$;
      741    13377    3   CMD:
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:24   
      742    13378    4           DO CASE( OUT$BLK.CODE);
      743    13379    4               CASE( %NULL_CMD);
      744    13380                        /* do nothing */
      745    13381    4               CASE( %SET_CMD);
      746    13382    4                   OPT$ = OUT$BLK.SUBLK$(0);
      747    13383    4                   SUB$ = OPT$->OUT$BLK.SUBLK$(0);
      748    13384    5                   DO CASE( OPT$->OUT$BLK.CODE);
      749    13385    5                       CASE( %ACCOUNT);
      750    13386    5                           TCM_ACCOUNT.ACCT# = SUB$->OUT$SYM.TEXT;
      751    13387    5                       CASE( %MESSACCT);
      752    13388    5                           TCM_MESSACCT.ACCT# = SUB$->OUT$SYM.TEXT;
      753    13389    5                       CASE( %STUCKEE);
      754    13390    5                           TCM_STUCKEE = SUB$->OUT$SYM.TEXT;
      755    13391    5                       CASE( %LOGON);
      756    13392    5                           CALL CONCAT( TCM_LOGON,
      757    13393    5                                   SUB$->OUT$SYM.TEXT,
      758    13394    5                                   BITASC( '015'O));
      759    13395    5                       CASE( %TIMEZONE);
      760    13396    5                           I = SUB$->OUT$SYM.CPOS;
      761    13397    5                           J = P$PCB.HI_CHAR - I;
      762    13398    5                           CALL CONCAT( TCM_TZTEXT, ' ',
      763    13399    5                                   SUBSTR( P$PCB.TEXT$->CHARS, I, J));
      764    13400    6                           DO CASE( SUB$->OUT$SYM.CODE);
      765    13401    6                               CASE( %TZUTO);
      766    13402    6                                   CALL CHARBIN( I,
      767    13403    6                                           SUB$->OUT$BLK.SUBLK$(1)->OUT$SYM.TEXT);
      768    13404    6                                   TCM_UTOFFSET = ( ( I / 100) * %UTS_CSEC_HOUR#) +
      769    13405    6                                           MOD( I, 100) * %UTS_CSEC_MIN#;
      770    13406    6                                   IF SUB$->OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT > 0 THEN
      771    13407    6                                       IF '-' = SUBSTR( SUB$->OUT$BLK.SUBLK$(0)->
             13407                                                OUT$SYM.TEXT, 0, 1) THEN
      772    13408    6                                           TCM_UTOFFSET = -TCM_UTOFFSET;
      773    13409    6                               CASE( %TZMIL);
      774    13410    6                                   CALL INDEX( I,
      775    13411    6                                           SUBSTR( SUB$->OUT$SYM.TEXT, 0, 1),
      776    13412    6                                           'MLKIHGFEDCBAZNOPQRSTUVWXY');
      777    13413    6                                   TCM_UTOFFSET = ( I - 12) * %UTS_CSEC_HOUR#;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:25   
      778    13414    6                               CASE( %TZCMN);
      779    13415    6                                   TCM_UTOFFSET =
      780    13416    6                                           CMN2UTS( SUB$->OUT$BLK.SUBLK$(0)->OUT$SYM.
             13416                                                    CODE)
      781    13417    6                                           * %UTS_CSEC_HOUR#;
      782    13418    6                               END;
      783    13419    5                       CASE( %PHONE0, %PHONE1, %PHONE2, %PHONE3);
      784    13420    5                           TCM_PHONE( OPT$->OUT$BLK.CODE - %PHONE0) =
      785    13421    5                                   SUB$->OUT$SYM.TEXT;
      786    13422    5                       CASE( ELSE);
      787    13423                                /* do nothing; ignore this SET command */
      788    13424    5                       END;
      789    13425    4               CASE( %IAM_CMD);
      790    13426    4                   NODENAME.COUNT = OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT;
      791    13427    4                   NODENAME.TEXT = OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT;
      792    13428    4                   SITE_NAME.COUNT = NODENAME.COUNT;
      793    13429    4                   CALL XLATE( SITE_NAME.TEXT, TCM_XLATE_TO_UC, NODENAME.TEXT);
      794    13430    4               CASE( %SITE_CMD);
      795    13431    5                   IF SITES = %MAX_SMTP_SITE THEN DO;
      796    13432    5                       CMDBUF = 'Site table overflow;  site not recorded.';
      797    13433    5   TELLUSER:
      798    13434    5                       ERROR_FLAG = %YES#;
      799    13435    5                       CALL WRITEDO;
      800    13436    5                       EXIT CMD;
      801    13437    5                       END;
      802    13438    5                   DO I = 0 TO OUT$BLK.NSUBLKS - 1;
      803    13439    5                       OPT$ = OUT$BLK.SUBLK$( I);
      804    13440    6                       DO CASE( OUT$BLK.SUBLK$( I)->OUT$BLK.CODE);
      805    13441    6                           CASE( %SITENAME);
      806    13442    6                               SITE.NAME.COUNT( SITES) = OPT$->OUT$SYM.COUNT;
      807    13443    6                               CALL XLATE(SITE.NAME.TEXT( SITES), TCM_XLATE_TO_UC,
      808    13444    6                                       OPT$->OUT$SYM.TEXT);
      809    13445    6                               CALL CONCAT( SITE.LOGON( SITES),
      810    13446    6                                       OPT$->OUT$SYM.TEXT, ';');
      811    13447    6                               SITE.ADDRESS( SITES) = ' ';
      812    13448    6                               SITE.IDENT( SITES) = NODENAME;
      813    13449    6                               SITE.TYPE( SITES) = %SMTP_MULTICS;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:26   
      814    13450    6                               SITE.TRY_INTERVAL( SITES) = 5;
      815    13451    6                               SITE.RETRY_INTERVAL( SITES) = 15;
      816    13452    6                               SITE.FROM_TIME( SITES) = 0000;
      817    13453    6                               SITE.TO_TIME( SITES) = 2359;
      818    13454    6                               SITE.LAST_TRY( SITES) = 0;
      819    13455    6                               SITE.NEXT_TRY( SITES) = 0;
      820    13456    6                               SITE.LAST_STATUS( SITES) = %SMTP_NOP;
      821    13457    6                               SITE.OWN_REVERSE_PATH.COUNT( SITES) = 0;
      822    13458    6                               SITE.INDIRECT_REVERSE_PATH.COUNT( SITES) = 0;
      823    13459    6                               SITE.RR_ACTION( SITES) = %DEFAULT;
      824    13460    6                               SITE.DR_ACTION( SITES) = %DEFAULT;
      825    13461    6                           CASE( %LOGON_OPTION);
      826    13462    6                               SITE.LOGON( SITES) = OPT$->OUT$SYM.TEXT;
      827    13463    6                           CASE( %NETWORK_OPTION);
      828    13464    6                               SITE.ADDRESS( SITES) = OPT$->OUT$SYM.TEXT;
      829    13465    6                           CASE( %IP_ADDRESS);
      830    13466    6                               SITE.ADDRESS( SITES) = OPT$->OUT$SYM.TEXT;
      831    13467    6                           CASE( ELSE);
      832    13468    6                               IF OPT$->OUT$BLK.CODE >= %RES_ALEX THEN
      833    13469    6                                   SITE.TYPE( SITES) = OPT$->OUT$BLK.CODE;
      834    13470    6                           CASE( %TRY_OPTION);
      835    13471    6                               CALL CHARBIN( SITE.TRY_INTERVAL( SITES),
      836    13472    6                                       OPT$->OUT$SYM.TEXT);
      837    13473    6                           CASE( %RETRY_OPTION);
      838    13474    6                               CALL CHARBIN( SITE.RETRY_INTERVAL( SITES),
      839    13475    6                                       OPT$->OUT$SYM.TEXT);
      840    13476    6                           CASE( %FROM_OPTION);
      841    13477    6                               CALL CHARBIN( SITE.FROM_TIME( SITES),
      842    13478    6                                       OPT$->OUT$SYM.TEXT);
      843    13479    6                           CASE( %TO_OPTION);
      844    13480    6                               CALL CHARBIN( SITE.TO_TIME( SITES),
      845    13481    6                                       OPT$->OUT$SYM.TEXT);
      846    13482    6                           CASE( %IDENT_OPTION);
      847    13483    6                               SITE.IDENT.COUNT( SITES) =
      848    13484    6                                       OPT$->OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT;
      849    13485    6                               SITE.IDENT.TEXT( SITES) =
      850    13486    6                                       OPT$->OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:27   
      851    13487    6                           CASE( %OWN_REVERSE_PATH_OPTION);
      852    13488    6                               SITE.OWN_REVERSE_PATH.COUNT( SITES) =
      853    13489    6                                       OPT$->OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT;
      854    13490    6                               SITE.OWN_REVERSE_PATH.TEXT( SITES) =
      855    13491    6                                       OPT$->OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT;
      856    13492    6                           CASE( %INDIRECT_REVERSE_PATH_OPTION);
      857    13493    6                               SITE.INDIRECT_REVERSE_PATH.COUNT( SITES) =
      858    13494    6                                       OPT$->OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT;
      859    13495    6                               SITE.INDIRECT_REVERSE_PATH.TEXT( SITES) =
      860    13496    6                                       OPT$->OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT;
      861    13497    6                           CASE( %RR_ACTION_OPTION);
      862    13498    6                               SITE.RR_ACTION( SITES) = OPT$->OUT$BLK.SUBLK$(0)->
             13498                                        OUT$BLK.CODE;
      863    13499    6                           CASE( %DR_ACTION_OPTION);
      864    13500    6                               SITE.DR_ACTION( SITES) = OPT$->OUT$BLK.SUBLK$(0)->
             13500                                        OUT$BLK.CODE;
      865    13501    6                           END;
      866    13502    5                       END;
      867    13503    5                   IF SITE.OWN_REVERSE_PATH.COUNT( SITES) = 0 THEN DO;
      868    13504    5                       CALL CONCAT( SITE.OWN_REVERSE_PATH.TEXT( SITES), '@',
      869    13505    5                               SITE.IDENT.TEXT( SITES));
      870    13506    5                       SITE.OWN_REVERSE_PATH.COUNT( SITES) =
      871    13507    5                               SITE.IDENT.COUNT( SITES) + 1;
      872    13508    5                       END;
      873    13509    5                   IF SITE.INDIRECT_REVERSE_PATH.COUNT( SITES) = 0 THEN DO;
      874    13510    5                       CALL CONCAT( SITE.INDIRECT_REVERSE_PATH.TEXT( SITES), '%',
      875    13511    5                               SUBSTR( SITE.IDENT.TEXT( SITES), 0, SITE.IDENT.COUNT(
             13511                                        SITES)),
      876    13512    5                               '@', SITE.NAME.TEXT( SITES));
      877    13513    5                       SITE.INDIRECT_REVERSE_PATH.COUNT( SITES) =
      878    13514    5                               SITE.IDENT.COUNT( SITES) + SITE.NAME.COUNT( SITES) + 2;
      879    13515    5                       END;
      880    13516    4                   SITES = SITES + 1;
      881    13517    4               CASE( %NODE_CMD);
      882    13518    5                   IF NODES > %MAX_SMTP_NODE THEN DO;
      883    13519    5                       CMDBUF = 'Node table overflow;  node not stored.';
      884    13520    5                       GOTO TELLUSER;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:28   
      885    13521    5                       END;
      886    13522    4                   NODE.FLAGS( NODES) = '0'B;
      887    13523    5                   DO I = 0 TO OUT$BLK.NSUBLKS - 1;
      888    13524    5                       OPT$ = OUT$BLK.SUBLK$( I);
      889    13525    6                       DO CASE( OPT$->OUT$BLK.CODE);
      890    13526    6                           CASE( %NODENAME);
      891    13527    6                               CALL XLATE( NODE.NAME( NODES), TCM_XLATE_TO_UC,
      892    13528    6                                       OPT$->OUT$SYM.TEXT);
      893    13529    6                           CASE( %IS_OPTION, %VIA_OPTION);
      894    13530    6                               NODE.IS_OR_VIA( NODES) = OPT$->OUT$BLK.CODE;
      895    13531    6                           CASE( %SITENAME);
      896    13532    6                               NODE.SITE( NODES) = -1;
      897    13533    7                               DO J = 0 TO SITES - 1;
      898    13534    8                                   IF SITE.NAME.TEXT( J) = OPT$->OUT$SYM.TEXT THEN DO;
      899    13535    8                                       NODE.SITE( NODES) = J;
      900    13536    9                                       DO CASE( NODE.IS_OR_VIA( NODES));
      901    13537    9                                           CASE( %IS_OPTION);
      902    13538    9                                               NODE.REVERSE_PATH.COUNT( NODES) =
      903    13539    9                                                       SITE.OWN_REVERSE_PATH.COUNT( J);
      904    13540    9                                               NODE.REVERSE_PATH.TEXT( NODES) =
      905    13541    9                                                       SITE.OWN_REVERSE_PATH.TEXT( J);
      906    13542    9                                           CASE( %VIA_OPTION);
      907    13543    9                                               NODE.REVERSE_PATH.COUNT( NODES) =
      908    13544    9                                                       SITE.INDIRECT_REVERSE_PATH.COUNT
             13544                                                                ( J);
      909    13545    9                                               NODE.REVERSE_PATH.TEXT( NODES) =
      910    13546    9                                                       SITE.INDIRECT_REVERSE_PATH.TEXT(
             13546                                                                J);
      911    13547    9                                           END;
      912    13548    8                                       END;
      913    13549    7                                   END;
      914    13550    7                               IF NODE.SITE( NODES) = -1 THEN DO;
      915    13551    7                                   CMDBUF = 'No such site.';
      916    13552    7                                   GOTO TELLUSER;
      917    13553    7                                   END;
      918    13554    6                           CASE( %PATHNAME);
      919    13555    6                               NODE.REVERSE_PATH.COUNT( NODES) =
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:29   
      920    13556    6                                       OPT$->OUT$SYM.COUNT;
      921    13557    6                               NODE.REVERSE_PATH.TEXT( NODES) =
      922    13558    6                                       OPT$->OUT$SYM.TEXT;
      923    13559    6                           CASE( %QUOTES_OPTION);
      924    13560    6                               NODE.FLAGS.QUOTES( NODES) = %YES#;
      925    13561    6                           END;
      926    13562    5                       END;
      927    13563    4                   NODES = NODES + 1;
      928    13564    4               CASE( %ADDGATE_CMD, %DELSITE_CMD);
      929    13565                        /* do nothing; does not apply when sending mail */
      930    13566    4               CASE( %DELGATE_CMD);
      931    13567    5                   IF REWRITES > %MAX_REWRITES THEN DO;
      932    13568    5                       CMDBUF = 'DelGate table overflow;  command not stored.';
      933    13569    5                       GOTO TELLUSER;
      934    13570    5                       END;
      935    13571    4                   I = REWRITES;
      936    13572    4                   REWRITE.OLD.LEN( I) = OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT;
      937    13573    4                   CALL XLATE( REWRITE.OLD.TXT( I), TCM_XLATE_TO_UC,
      938    13574    4                           OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT);
      939    13575    4                   REWRITES = REWRITES + 1;
      940    13576    4               END;
      941    13577    3           END SCAN;
      942    13578    2       CALL M$CLOSE( CLOSE_SI)
      943    13579    3       WHENALTRETURN DO;
      944    13580    3           END;
      945    13581    2       IF ERROR_FLAG THEN
      946    13582    2           ALTRETURN;
      947    13583    2       RETURN;
      948    13584
      949    13585    2       END INITIALIZE_CONFIGURATION;
      950    13586        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:30   
      951    13587    1   INITIALIZE_QUOTATIONS: PROC;
      952    13588
      953    13589    2       DCL LINELEN UBIN WORD;
      954    13590
      955    13591    2       QUOTE_COUNT = 0;
      956    13592    2       QUOTE_KEY.L = 3;
      957    13593    2       QUOTE_KEY.K = 0;
      958    13594    2       IF NOT B$JIT.PRFLAGS.UI THEN
      959    13595    2           RETURN;
      960    13596    2       CALL M$OPEN( OPEN_UI)
      961    13597    3       WHENALTRETURN DO;
      962    13598    3           RETURN;
      963    13599    3           END;
      964    13600    2       CALL M$OPEN( OPEN_QUOTES)
      965    13601    3       WHENALTRETURN DO;
      966    13602    3           RETURN;
      967    13603    3           END;
      968    13604    2   READ_QUOTES:
      969    13605    3       DO UNTIL %NO#;
      970    13606    3           QUOTE_BUF = ' ';
      971    13607    3           CALL M$READ( READ_UI)
      972    13608    4           WHENALTRETURN DO;
      973    13609    4               EXIT READ_QUOTES;
      974    13610    4               END;
      975    13611    4           IF QUOTE_BUF = ' ' THEN DO;
      976    13612    4               IF MOD( QUOTE_KEY.K,1000) ~= 0 THEN
      977    13613    4                   QUOTE_KEY.K = 1000 * ( QUOTE_KEY.K / 1000 + 1);
      978    13614    4               END;
      979    13615    4           ELSE DO;
      980    13616    4               WRITE_QUOTES.BUF_ = VECTOR( SUBSTR( QUOTE_BUF, 0,
      981    13617    4                       DCBADDR( DCBNUM( M$UI))->F$DCB.ARS#));
      982    13618    4               CALL M$WRITE( WRITE_QUOTES);
      983    13619    4               QUOTE_KEY.K = QUOTE_KEY.K + 1;
      984    13620    4               END;
      985    13621    3           END;
      986    13622    2       QUOTE_COUNT = ( QUOTE_KEY.K + 999) / 1000;
      987    13623    2       CALL M$CLOSE( CLOSE_UI);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:31   
      988    13624    2       RETURN;
      989    13625
      990    13626    2       END INITIALIZE_QUOTATIONS;
      991    13627        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:32   
      992    13628    1   INIT_FOLDER_DATA_POOL: PROC;
      993    13629
      994    13630    2       MAIL_ADDRESSES = VECTOR( NIL);
      995    13631    2       VBASE( MAIL_ADDRESSES) = B$DS5$;
      996    13632    2       CALL M$GDS( GET_ADDRESSES);
      997    13633    2       MAIL_BUFFERS = VECTOR( NIL);
      998    13634    2       CALL M$GDS( GET_BUFFERS);
      999    13635    2       PROFILE$ = PINCRW( VBASE( MAIL_BUFFERS), 0);
     1000    13636    2       HEADER$ = PINCRW( VBASE( MAIL_BUFFERS), 1024);
     1001    13637    2       BODY$ = PINCRW( VBASE( MAIL_BUFFERS), 2048);
     1002    13638    2       ADDRESS$ = PINCRW( VBASE( MAIL_BUFFERS), 3072);
     1003    13639    2       MSG_NUMBER = 0;
     1004    13640    2       RETURN;
     1005    13641
     1006    13642    2   RELEASE_FOLDER_DATA_POOL: ENTRY;
     1007    13643
     1008    13644    2       CALL M$FDS( RELEASE_ADDRESSES);
     1009    13645    2       CALL M$FDS( RELEASE_BUFFERS);
     1010    13646
     1011    13647    2       PROFILE$ = ADDR( NIL);
     1012    13648    2       HEADER$ = ADDR( NIL);
     1013    13649    2       BODY$ = ADDR( NIL);
     1014    13650    2       ADDRESS$ = ADDR( NIL);
     1015    13651    2       RETURN;
     1016    13652
     1017    13653    2       END INIT_FOLDER_DATA_POOL;
     1018    13654        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:33   
     1019    13655    1   SCAN_ALL_HEADERS: PROC;
     1020    13656
     1021    13657    2       DCL OLDEST UBIN;
     1022    13658
     1023    13659    2       CALL M$TIME( GET_UTS_NOW);
     1024    13660    2       CALL M$TIME( GET_TIME_NOW);
     1025    13661    2       CALL CHARBIN( TVAL, SUBSTR( TIMEBUF, 0, 2));
     1026    13662    2       CALL CHARBIN( LOCE, SUBSTR( TIMEBUF, 3, 2));
     1027    13663    2       TVAL = TVAL * 100 + LOCE;
     1028    13664    2       OLDEST = TIME_NOW;
     1029    13665    3       DO UNTIL MESSAGE_FILE;
     1030    13666    3           CALL GET_MAIL_HEADER ALTRET( SCAN_DONE);
     1031    13667    3           CALL M$DEQ( DEQ_ON_HEADER)
     1032    13668    4           WHENALTRETURN DO;
     1033    13669    4               END;
     1034    13670    3           SITE.PENDING( THIS_SITE) = SITE.PENDING( THIS_SITE) + 1;
     1035    13671    3           TOTAL_READY = TOTAL_READY + 1;
     1036    13672    3           END;
     1037    13673    2   SCAN_DONE:
     1038    13674    2       RETURN;
     1039    13675
     1040    13676    2       END SCAN_ALL_HEADERS;
     1041    13677        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:34   
     1042    13678    1   CHOOSE_A_SITE: PROC;
     1043    13679
     1044    13680    2       CURR_SITE = -1;
     1045    13681    3       DO THIS_SITE = 0 TO SITES - 1;
     1046    13682    3           IF ( SITE.FROM_TIME( THIS_SITE) <= TVAL /* beg of open shift */ AND
     1047    13683    3                   SITE.TO_TIME( THIS_SITE) >= TVAL /* end of open shift */) OR
     1048    13684    3                   ( SITE.TO_TIME( THIS_SITE) <= TVAL /* beg of inverted shift */ AND
     1049    13685    3                   SITE.FROM_TIME( THIS_SITE) >= TVAL /* end of inverted shift */)
     1050    13686    4                   THEN DO;
     1051    13687    4               IF SITE.PENDING(THIS_SITE) > 0 AND
     1052    13688    4                       SITE.NEXT_TRY( THIS_SITE) <= TIME_NOW
             13688                                /* next (re)try permitted */ THEN
     1053    13689    4                   IF CURR_SITE = -1 THEN
     1054    13690    4                       CURR_SITE = THIS_SITE;
     1055    13691    4                   ELSE
     1056    13692    4                       IF SITE.LAST_TRY( THIS_SITE) < SITE.LAST_TRY( CURR_SITE) THEN
     1057    13693    4                           CURR_SITE = THIS_SITE;
     1058    13694    4               END;
     1059    13695    3           ELSE
     1060    13696    3               SITE.PENDING( THIS_SITE) = 0;
     1061    13697    3           END;
     1062    13698    2       RETURN;
     1063    13699
     1064    13700    2       END CHOOSE_A_SITE;
     1065    13701        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:35   
     1066    13702    1   GET_MAIL_HEADER: PROC ALTRET;
     1067    13703
     1068    13704    2       DCL HAVE_A_MESSAGE BIT(1);
     1069    13705    2       DCL OUT_OF_MESSAGES BIT(1);
     1070    13706
     1071    13707    2       HAVE_A_MESSAGE = %NO#;
     1072    13708    2       OUT_OF_MESSAGES = %NO#;
     1073    13709    3       DO UNTIL( HAVE_A_MESSAGE OR OUT_OF_MESSAGES);
     1074    13710    3           CALL FIND_MAIL_HEADER
     1075    13711    4           WHENALTRETURN DO;
     1076    13712    4               OUT_OF_MESSAGES = %YES#;
     1077    13713    4               END;
     1078    13714    3           IF NOT OUT_OF_MESSAGES THEN
     1079    13715    3   TRY_THIS_ONE:
     1080    13716    4                                       DO;
     1081    13717
     1082    13718                    /* Note: VM_HEADER.NUM_RECORDS may be of interest here,
     1083    13719                             if you are concerned about mailgram length.    */
     1084    13720    4               CALL PARSE_MAIL_HEADER
     1085    13721    5               WHENRETURN DO;
     1086    13722    5                   CALL SELECT_DESTINATION_SITE
     1087    13723    6                   WHENRETURN DO;
     1088    13724    6                       HAVE_A_MESSAGE = %YES#;
     1089    13725    6                       END;
     1090    13726    6                   WHENALTRETURN DO;
     1091    13727    6                       CALL DELETE_MESSAGE;
     1092    13728    6                       CALL POST_MESSAGE_REJECTION( SITE_NAME);
     1093    13729    6                       END;
     1094    13730    5                   END;
     1095    13731    5               WHENALTRETURN DO;
     1096    13732    5                   CALL DELETE_MESSAGE;
     1097    13733    5                   CALL POST_MESSAGE_REJECTION( SITE_NAME);
     1098    13734    5                   END;
     1099    13735    4               END TRY_THIS_ONE;
     1100    13736    3           IF MESSAGE_FILE THEN
     1101    13737    3                OUT_OF_MESSAGES = %YES#;
     1102    13738    3           END;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:36   
     1103    13739    2       IF NOT HAVE_A_MESSAGE THEN
     1104    13740    2           ALTRETURN;
     1105    13741    2       RETURN;
     1106    13742
     1107    13743    2       END GET_MAIL_HEADER;
     1108    13744        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:37   
     1109    13745    1   POSITION_TO_FIRST_MESS: PROC;
     1110    13746
     1111    13747    2       OPEN_MESSAGE.NAME_ = VECTOR( MESS);
     1112    13748    2       OPEN_MESSAGE.V.OPER.NXTF# = %NO#;
     1113    13749    2       OPEN_MESSAGE.V.OPER.TEST# = %YES#;
     1114    13750    2       OPEN_MESSAGE.V.INITZ.SCRUB# = %YES#;
     1115    13751    2       CALL M$OPEN( OPEN_MESSAGE)
     1116    13752    3       WHENALTRETURN DO;
     1117    13753    3           END;
     1118    13754    2       MESSAGE_FILE = %YES#;
     1119    13755    2       RETURN;
     1120    13756
     1121    13757    2       END;
     1122    13758
     1123    13759    1   OPEN_NEXT_MESS: PROC ALTRET;
     1124    13760
     1125    13761    2       OPEN_MESSAGE.NAME_ = VECTOR( NIL);
     1126    13762    2       OPEN_MESSAGE.V.OPER.NXTF# = %YES#;
     1127    13763    2       OPEN_MESSAGE.V.OPER.TEST# = %NO#;
     1128    13764    2       OPEN_MESSAGE.V.INITZ.SCRUB# = %NO#;
     1129    13765    2       USER_COUNT = 0;
     1130    13766    2       MSG_NUMBER = 0;
     1131    13767    2       CALL M$OPEN( OPEN_MESSAGE) ALTRET( OOPS);
     1132    13768    2       IF SUBSTR( M$FOLDER$->F$DCB.NAME#.C, 0, 5) = ':MESS' THEN
     1133    13769    2           RETURN;
     1134    13770    2       CALL M$CLOSE( CLOSE_FOLDER)
     1135    13771    3       WHENALTRETURN DO;
     1136    13772    3           END;
     1137    13773    2   OOPS:
     1138    13774    2       ALTRETURN;
     1139    13775
     1140    13776    2       END OPEN_NEXT_MESS;
     1141    13777        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:38   
     1142    13778    1   SELECT_DESTINATION_SITE: PROC ALTRET;
     1143    13779
     1144    13780    2       DCL SITE_END UBIN;
     1145    13781    2       DCL SITE_START UBIN;
     1146    13782    2       DCL SITE_STRING CHAR(32);
     1147    13783
     1148    13784    3       IF SUBSTR(PATH$->CV.T, 1, 1) = '@' /* there's a forward path */ THEN DO;
     1149    13785    3           CALL INDEX( SITE_END, ':', PATH$->CV.T);
     1150    13786    3           CALL INDEX( SITE_END, ',', SUBSTR( PATH$->CV.T, 0, SITE_END));
     1151    13787    3           CALL INDEX( SITE_END, '.', SUBSTR( PATH$->CV.T, 0, SITE_END));
     1152    13788    3           CALL XLATE( SITE_STRING, TCM_XLATE_TO_UC,
     1153    13789    3                   SUBSTR( PATH$->CV.T, 2, SITE_END - 2));
     1154    13790    3           SITE_END = SITE_END - 2;
     1155    13791    3           END;
     1156    13792    3       ELSE DO;
     1157    13793    3           CALL XLATE( SITE_STRING, TCM_XLATE_TO_UC, TOSITE$->CV.T);
     1158    13794    3           CALL INDEX( SITE_END, '.', TOSITE$->CV.T);
     1159    13795    3           END;
     1160    13796    2       XUW_WILDCARD.INPUT_ = VECTOR( SUBSTR( SITE_STRING, 0, SITE_END));
     1161    13797    2   FIND_NODE:
     1162    13798    3       DO;
     1163    13799    4           DO THIS_NODE = 0 TO NODES - 1;
     1164    13800    4               CALL INDEX( VLEN, ' ', NODE.NAME( THIS_NODE));
     1165    13801    4               XUW_WILDCARD.PATTERN_ =
     1166    13802    4                       VECTOR( SUBSTR( NODE.NAME( THIS_NODE), 0, VLEN));
     1167    13803    4               CALL X$WILDCMP( XUW_WILDCARD)
     1168    13804    5               WHENRETURN DO;
     1169    13805    5                   THIS_SITE = NODE.SITE( THIS_NODE);
     1170    13806    5                   IS_OR_VIA = NODE.IS_OR_VIA( THIS_NODE);
     1171    13807    5                   EXIT FIND_NODE;
     1172    13808    5                   END;
     1173    13809    4               END;
     1174    13810    3           REPLY = 'Can''t find a site to handle traffic to that node.';
     1175    13811    3           ALTRETURN;
     1176    13812    3           END FIND_NODE;
     1177    13813    2       RETURN;
     1178    13814
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:39   
     1179    13815    2       END SELECT_DESTINATION_SITE;
     1180    13816        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:40   
     1181    13817    1   SMTP_SESSION: PROC ALTRET;
     1182    13818
     1183    13819    2       DCL TRIES_LEFT SBIN;
     1184    13820
     1185    13821    2       CALL M$OPEN( OPEN_FOLDER) ALTRET( BAILOUT);
     1186    13822    2       CALL M$ENQ( ENQ_ON_FILE) ALTRET( BAILOUT);
     1187    13823    2       MESSAGE_FILE = %NO#;
     1188    13824            /****** LOGON TO SMTP ******/
     1189    13825    2       CALL STATUS_UPDATE( CONNECTING);
     1190    13826    2       CALL TCM$WRITE_AUDIT_LOG( , SITE.NAME( CURR_SITE));
     1191    13827    2       TCM_SMTP_PROGRESS = %SMTP_BUSY;
     1192    13828    2       CALL TCM$START_SMTP( SITE.LOGON( CURR_SITE), SITE.ADDRESS( CURR_SITE),
     1193    13829    2               SITE.TYPE( CURR_SITE), FLOW_CONTROL_ENABLED);
     1194    13830    2       CALL STATUS_UPDATE( WAITING_FOR_SMTP_GREETING);
     1195    13831    2       TCM_SMTP_PROGRESS = %SMTP_CONNECTED;
     1196    13832    2       IF NOT TCM_TESTMODE THEN
     1197    13833    3           DO UNTIL SUBSTR( CMDBUF, 0, 4) = '220 ';
     1198    13834    3               CALL TCM$READ_SMTP( CMDBUF_, REPLYLEN, 60)
     1199    13835    4               WHENALTRETURN DO;
     1200    13836    4                   ALTRETURN;
     1201    13837    4                   END;
     1202    13838    3               WRITE_ME.BUF_.BOUND = REPLYLEN;
     1203    13839    3               CALL M$WRITE( WRITE_ME);
     1204    13840    3               IF SUBSTR( CMDBUF, 0, LENGTHC( 'Dial line not active')) =
     1205    13841    3                       'Dial line not active' THEN
     1206    13842    3                   ALTRETURN;
     1207    13843    3           END;
     1208    13844    2       CALL STATUS_UPDATE( LOGGING_ON_TO_SMTP);
     1209    13845    3       DO TRIES_LEFT = 3 DOWNTO 0;
     1210    13846    3           CALL CONCAT( CMDBUF, 'HELO ', SITE.IDENT.TEXT( CURR_SITE));
     1211    13847    3           CALL SEND_SMTP_COMMAND( '2') ALTRET( NO_SMTP);
     1212    13848    3           IF SUBSTR( CMDBUF, 0, 3) = '250' THEN
     1213    13849    3               EXIT;
     1214    13850    3           ELSE
     1215    13851    3               IF TRIES_LEFT = 0 THEN
     1216    13852    3                   ALTRETURN;
     1217    13853    3           END;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:41   
     1218    13854    2       MSG_COUNT = 0;
     1219    13855    2       CALL TCM$WRITE_AUDIT_LOG( MSG_COUNT, SITE.NAME( CURR_SITE));
     1220    13856    2       TCM_SMTP_PROGRESS = %SMTP_SESSION;
     1221    13857    2       MSG_NUMBER = 0;
     1222    13858    3       DO FOREVER;  /** DO UNTIL ALL MAIL HAS BEEN PROCESSED **/
     1223    13859    3           CALL STATUS_UPDATE( DECODING_HEADER);
     1224    13860    3           CALL GET_MAIL_HEADER ALTRET( EOM);
     1225    13861    3           IF THIS_SITE = CURR_SITE /* going to current connection */ THEN
     1226    13862    3               CALL SEND_ONE_MAILGRAM;
     1227    13863    3           END;
     1228    13864    2   EOM:
     1229    13865    2       CALL M$CLOSE( CLOSE_FOLDER)
     1230    13866    3       WHENALTRETURN DO;
     1231    13867    3           END;
     1232    13868    2       CALL POSITION_TO_FIRST_MESS;
     1233    13869    3       DO FOREVER;
     1234    13870    3           CALL OPEN_NEXT_MESS ALTRET( EOMM);
     1235    13871    3           CALL STATUS_UPDATE( DECODING_HEADER);
     1236    13872    3           CALL GET_MAIL_HEADER ALTRET( EOMM);
     1237    13873    3           IF THIS_SITE = CURR_SITE /* going to current connection */ THEN
     1238    13874    3               CALL SEND_ONE_MAILGRAM;
     1239    13875    3           IF M$FOLDER$->F$DCB.FCD# THEN
     1240    13876    3               CALL M$CLOSE( CLOSE_FOLDER)
     1241    13877    4               WHENALTRETURN DO;
     1242    13878    4                   END;
     1243    13879    3           END;
     1244    13880    2   EOMM:
     1245    13881    2       CALL STATUS_UPDATE( LOGGING_OFF_OF_SMTP);
     1246    13882    2       CMDBUF = 'QUIT';
     1247    13883    2       CALL SEND_SMTP_COMMAND( '2');
     1248    13884    2       TCM_SMTP_PROGRESS = %SMTP_COMPLETE;
     1249    13885    2   NO_SMTP:
     1250    13886    2       RETURN;
     1251    13887    2   BAILOUT:
     1252    13888    2       ALTRETURN;
     1253    13889
     1254    13890    2       END SMTP_SESSION;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:42   
     1255    13891        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:43   
     1256    13892    1   SEND_ONE_MAILGRAM: PROC;
     1257    13893
     1258    13894    2       DCL COUNT UBIN;
     1259    13895    2       DCL GOT_ONE BIT(1);
     1260    13896    2       DCL I SBIN;
     1261    13897    2       DCL LEN SBIN;
     1262    13898    2       DCL INDX UBIN;
     1263    13899    2       DCL INDX1 UBIN;
     1264    13900    2       DCL INDX2 UBIN;
     1265    13901    2       DCL OFFSET UBIN;
     1266    13902    2       DCL QUOTE_NUMBER SBIN;
     1267    13903    2       DCL RR BIT(1);
     1268    13904    2       DCL TBUF CHAR(32);
     1269    13905    2       DCL TRIED_DIRECT_SEND BIT(1);
     1270    13906    2       DCL TVAL UBIN;
     1271    13907
     1272    13908    2       DCL II UBIN WORD;
     1273    13909    2       DCL JJ UBIN WORD;
     1274    13910    2       DCL SOURCE_STRG CHAR(%LINE_SIZE);
     1275    13911    2       DCL TARGET_STRG CHAR(%LINE_SIZE);
     1276    13912    2       DCL DONE_COMMA BIT(1);
     1277    13913    2       DCL LEN_SOURCE UBIN WORD;
     1278    13914    2       DCL LEN_TARGET UBIN WORD;
     1279    13915
     1280    13916            /****** INITIAL DIALOG WITH SMTP ******/
     1281    13917    2   BEGIN_SENDING:
     1282    13918    2       CALL STATUS_UPDATE( SENDING_ADDRESSES);
     1283    13919    2       TRIED_DIRECT_SEND = %NO#;
     1284    13920        /*  IF VM_HEADER.STATUS.ACK THEN DO;     COMMENTED OUT 5-12-88 MAG
     1285    13921                CALL CONCAT( CMDBUF, 'SEND FROM:<', FROMADDR$->CV.T, '@',
     1286    13922                      SUBSTR( SITE.IDENT.TEXT( CURR_SITE), 0, SITE.IDENT.COUNT( CURR_SITE)),
     1287    13923                        '>');
     1288    13924                CALL SEND_SMTP_COMMAND( '2')
     1289    13925                WHENRETURN DO;
     1290    13926                    TRIED_DIRECT_SEND = %YES#;
     1291    13927                    GOTO BYPASS_MAIL_FROM;
     1292    13928                    END;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:44   
     1293    13929                END;                             COMMENTED OUT 5-12-88 MAG */
     1294    13930    2   MAIL_FROM:
     1295    13931    2       IF VM_HEADER.NUM_TRACE_RECORDS > 0 THEN
     1296    13932    2           CALL SCAN_TRACE_RECORDS;
     1297    13933    2       ELSE
     1298    13934    2           CALL CONCAT( CMDBUF, 'MAIL FROM:<', FROMADDR$->CV.T, '@',
     1299    13935    2               SUBSTR( SITE.IDENT.TEXT( CURR_SITE), 0, SITE.IDENT.COUNT( CURR_SITE)),
     1300    13936    2               '>');
     1301    13937    2       CALL SEND_SMTP_COMMAND( '2') ALTRET( ERR);
     1302    13938    2       TRIED_DIRECT_SEND = %NO#;
     1303    13939    2   BYPASS_MAIL_FROM:
     1304    13940    3       IF MESSAGE_FILE THEN DO;
     1305    13941    3           GOT_ONE = %NO#;
     1306    13942    4           DO COUNT = 0 TO USER_COUNT - 1;
     1307    13943    4               IF ( HITS.BC AND USERS.LIST( COUNT) ~= %VM_TYPE_BC) OR
     1308    13944    4                       ( NOT HITS.BC AND USERS.LIST( COUNT) = %VM_TYPE_BC) THEN
     1309    13945    4                   GOTO SKIP_NON_BLIND_COPY;
     1310    13946    5               IF IS_OR_VIA = %VIA_OPTION THEN DO;
     1311    13947    5                   CALL INDEX1R( INDX, '@', USERS.T( COUNT)) ALTRET( NO_CHANGE);
     1312    13948    6                   IF REWRITES > 0 THEN DO;
     1313    13949    6                       CALL XLATE( TBUF, TCM_XLATE_TO_UC,
     1314    13950    6                               SUBSTR( USERS.T( COUNT), INDX, LEN));
     1315    13951    6                       LEN = SITE.NAME.COUNT( CURR_SITE);
     1316    13952    6                       IF SUBSTR( SITE.NAME.TEXT( CURR_SITE), 0, LEN) =
     1317    13953    6                               SUBSTR( TBUF, 1, LEN) THEN
     1318    13954    6                           EXIT;  /* no rewrite if only one hop */
     1319    13955    6   REWRITE_LOOP:
     1320    13956    7                       DO I = 0 TO REWRITES - 1;
     1321    13957    7                           LEN = REWRITE.OLD.LEN( I);
     1322    13958    7                           IF SUBSTR( TBUF, 0, LEN) =
     1323    13959    8                                   SUBSTR( REWRITE.OLD.TXT( I), 0, LEN) THEN DO;
     1324    13960    8                               SUBSTR( USERS.T( COUNT), INDX, LEN) = ' ';
     1325    13961    8                               USERS.L( COUNT) = USERS.L( COUNT) - LEN;
     1326    13962    8                               CALL INDEX1R( INDX1, '%', USERS.T( COUNT), INDX)
     1327    13963    9                               WHENRETURN DO;
     1328    13964    9                                   SUBSTR( USERS.T( COUNT), INDX1, 1) = '@';
     1329    13965    9                                   END;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:45   
     1330    13966    9                               WHENALTRETURN DO;
     1331    13967    9                                   END;
     1332    13968    8                               EXIT REWRITE_LOOP;
     1333    13969    8                               END;
     1334    13970    7                           END;
     1335    13971    6                       END;
     1336    13972    5                   CALL INDEX1R( INDX, '@', USERS.T( COUNT)) ALTRET( NO_CHANGE);
     1337    13973    5                   CALL INDEX( INDX1, '.', USERS.T( COUNT), INDX)
     1338    13974    6                   WHENRETURN DO;
     1339    13975    6                       GOTO NO_CHANGE;
     1340    13976    6                       END;
     1341    13977    6                   WHENALTRETURN DO;
     1342    13978    6                       END;
     1343    13979    5                   CALL INDEX1R( INDX1, '%', USERS.T( COUNT), INDX) ALTRET( NO_CHANGE);
     1344    13980    5                   SUBSTR( USERS.T( COUNT), INDX1, 1) = '@';
     1345    13981    5                   CALL INDEX( INDX2, '.', USERS.T( COUNT), INDX1)
     1346    13982    6                   WHENRETURN DO;
     1347    13983    7                       IF SUBSTR( USERS.T( COUNT), INDX + 1) = 'ARPA' THEN DO;
     1348    13984    7                           USERS.L( COUNT) = INDX;
     1349    13985    7                           SUBSTR( USERS.T( COUNT), INDX) = ' ';
     1350    13986    7                           END;
     1351    13987    6                       ELSE
     1352    13988    6                           SUBSTR( USERS.T( COUNT), INDX, 1) = '.';
     1353    13989    6                       END;
     1354    13990    6                   WHENALTRETURN DO;
     1355    13991    6                       SUBSTR( USERS.T( COUNT), INDX, 1) = '.';
     1356    13992    6                       END;
     1357    13993    5                   END;
     1358    13994    4   NO_CHANGE:
     1359    13995    4               CALL CONCAT( CMDBUF, 'RCPT TO:<', SUBSTR( USERS.T( COUNT), 0,
     1360    13996    4                       USERS.L( COUNT)), '>');
     1361    13997    4               CALL SEND_SMTP_COMMAND( '2')
     1362    13998    5               WHENRETURN DO;
     1363    13999    5                   GOT_ONE = %YES#;
     1364    14000    5                   END;
     1365    14001    5               WHENALTRETURN DO;
     1366    14002    6                   IF TRIED_DIRECT_SEND THEN DO;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:46   
     1367    14003    6                       CMDBUF = 'RSET';
     1368    14004    6                       CALL SEND_SMTP_COMMAND( '2');
     1369    14005    6                       GOTO MAIL_FROM;
     1370    14006    6                       END;
     1371    14007    5                   PATH$->CV.L = USERS.L( COUNT);
     1372    14008    5                   PATH$->CV.T = USERS.T( COUNT);
     1373    14009    5                   CALL POST_MESSAGE_REJECTION( SITE.NAME( CURR_SITE));
     1374    14010    5                   END;
     1375    14011    4   SKIP_NON_BLIND_COPY:
     1376    14012    4               END;
     1377    14013    3           IF NOT GOT_ONE THEN
     1378    14014    3               GOTO WRAP_IT_UP;
     1379    14015    3           END;
     1380    14016    3       ELSE DO;
     1381    14017    3           CALL CONCAT( CMDBUF, 'RCPT TO:', PATH$->CV.T);
     1382    14018    3           CALL SEND_SMTP_COMMAND( '2')
     1383    14019    4           WHENALTRETURN DO;
     1384    14020    5               IF TRIED_DIRECT_SEND THEN DO;
     1385    14021    5                   CMDBUF = 'RSET';
     1386    14022    5                   CALL SEND_SMTP_COMMAND( '2');
     1387    14023    5                   GOTO MAIL_FROM;
     1388    14024    5                   END;
     1389    14025    4               GOTO ERR;
     1390    14026    4               END;
     1391    14027    3           END;
     1392    14028    2       CMDBUF = 'DATA';
     1393    14029    2       CALL SEND_SMTP_COMMAND( '3') ALTRET( ERR);
     1394    14030    2       CALL STATUS_UPDATE( SENDING_HEADER);
     1395    14031            /****** SEND MESSAGE HEADER ******/
     1396    14032    2       BLANK_COUNT = 0;
     1397    14033    2       IF NOT TCP_FLAVOR THEN
     1398    14034    2           CALL M$WAIT( WAIT_A_SECOND);
     1399    14035    3       IF VM_HEADER.NUM_TRACE_RECORDS > 0 AND NOT VM_HEADER.STATUS.ERR THEN DO;
     1400    14036    3           CALL EMIT_TRACE_RECORDS;
     1401    14037    3           GOTO SEND_DATA;
     1402    14038    3           END;
     1403    14039    2       CALL CONCAT( CMDBUF, MSGDATE, DAYBUF, ', ', DATEBUF, TIMEBUF, TCM_TZTEXT);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:47   
     1404    14040    2       CALL SEND_SMTP_DATA;
     1405    14041    2       IF SUBSTR( PATH$->CV.T, 0, 2) = '<@' /*Force indirect return path!*/ THEN
     1406    14042    2           CALL CONCAT( CMDBUF, MSGFROM, FROMNAME$->CV.T, ' <', FROMADDR$->CV.T,
     1407    14043    2                   SUBSTR( SITE.INDIRECT_REVERSE_PATH.TEXT( CURR_SITE), 0,
     1408    14044    2                   SITE.INDIRECT_REVERSE_PATH.COUNT( CURR_SITE)), '>');
     1409    14045    2       ELSE
     1410    14046    2           CALL CONCAT( CMDBUF, MSGFROM, FROMNAME$->CV.T, ' <', FROMADDR$->CV.T,
     1411    14047    2                   SUBSTR( NODE.REVERSE_PATH.TEXT( THIS_NODE), 0,
     1412    14048    2                   NODE.REVERSE_PATH.COUNT( THIS_NODE)), '>');
     1413    14049    2       CALL SEND_SMTP_DATA;
     1414    14050    3       IF ( SITE.RR_ACTION( CURR_SITE) = %RELAY AND VM_HEADER.STATUS.RR) THEN DO;
     1415    14051    3           IF SUBSTR( PATH$->CV.T, 0, 2) = '<@' /*Force indirect return path!*/ THEN
     1416    14052    3               CALL CONCAT( CMDBUF, MSGACKTO, FROMADDR$->CV.T,
     1417    14053    3                       SUBSTR( SITE.INDIRECT_REVERSE_PATH.TEXT( CURR_SITE), 0,
     1418    14054    3                       SITE.INDIRECT_REVERSE_PATH.COUNT( CURR_SITE)));
     1419    14055    3           ELSE
     1420    14056    3               CALL CONCAT( CMDBUF, MSGACKTO, FROMADDR$->CV.T,
     1421    14057    3                       SUBSTR( NODE.REVERSE_PATH.TEXT( THIS_NODE), 0,
     1422    14058    3                       NODE.REVERSE_PATH.COUNT( THIS_NODE)));
     1423    14059    3           CALL SEND_SMTP_DATA;
     1424    14060    3           END;
     1425    14061    3       IF ( SITE.DR_ACTION( CURR_SITE) = %RELAY AND VM_HEADER.STATUS.DR) THEN DO;
     1426    14062    3           IF SUBSTR( PATH$->CV.T, 0, 2) = '<@' /*Force indirect return path!*/ THEN
     1427    14063    3               CALL CONCAT( CMDBUF, MSGRRTO, FROMADDR$->CV.T,
     1428    14064    3                       SUBSTR( SITE.INDIRECT_REVERSE_PATH.TEXT( CURR_SITE), 0,
     1429    14065    3                       SITE.INDIRECT_REVERSE_PATH.COUNT( CURR_SITE)));
     1430    14066    3           ELSE
     1431    14067    3               CALL CONCAT( CMDBUF, MSGRRTO, FROMADDR$->CV.T,
     1432    14068    3                       SUBSTR( NODE.REVERSE_PATH.TEXT( THIS_NODE), 0,
     1433    14069    3                       NODE.REVERSE_PATH.COUNT( THIS_NODE)));
     1434    14070    3           CALL SEND_SMTP_DATA;
     1435    14071    3           END;
     1436    14072    3       IF REPLYADDR$->CV.L ~= 0 AND REPLYADDR$->CV.T ~= FROMADDR$->CV.T THEN DO;
     1437    14073    3           IF SUBSTR( PATH$->CV.T, 0, 2) = '<@' /*Force indirect return path!*/ THEN
     1438    14074    3               CALL CONCAT( CMDBUF, MSGREPLY, REPLYNAME$->CV.T, ' <', REPLYADDR$->CV.T,
     1439    14075    3                       SUBSTR( SITE.INDIRECT_REVERSE_PATH.TEXT( CURR_SITE),
     1440    14076    3                       0, SITE.INDIRECT_REVERSE_PATH.COUNT( CURR_SITE)), '>');
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:48   
     1441    14077    4           ELSE DO;
     1442    14078    4               CALL INDEX( INDX, '@', REPLYADDR$->CV.T)
     1443    14079    5               WHENRETURN DO;  /* use user's ReplyTo: */
     1444    14080    5                   CALL CONCAT( CMDBUF, MSGREPLY, '<', REPLYADDR$->CV.T, '>');
     1445    14081    5                   END;
     1446    14082    5               WHENALTRETURN DO;  /* use reverse path */
     1447    14083    5                   CALL CONCAT( CMDBUF, MSGREPLY, REPLYNAME$->CV.T, ' <',
     1448    14084    5                           REPLYADDR$->CV.T, SUBSTR( NODE.REVERSE_PATH.TEXT( THIS_NODE)
             14084                                    ,
     1449    14085    5                           0, NODE.REVERSE_PATH.COUNT( THIS_NODE)), '>');
     1450    14086    5                   END;
     1451    14087    4               END;
     1452    14088    3           CALL SEND_SMTP_DATA;
     1453    14089    3           END;
     1454    14090    3       IF MESSAGE_FILE THEN DO;
     1455    14091    3           CALL EMIT_ADDRESSES( MSGTO, LENGTHC( MSGTO), %VM_TYPE_TO,
     1456    14092    3                   MSGREALLY_TO, LENGTHC( MSGREALLY_TO), VM_HEADER.TO$);
     1457    14093    3           CALL EMIT_ADDRESSES( MSGCC, LENGTHC( MSGCC), %VM_TYPE_C,
     1458    14094    3                   MSGREAL_CC, LENGTHC( MSGREAL_CC), VM_HEADER.COPY$);
     1459    14095    3           IF HITS.BC THEN
     1460    14096    3               CALL EMIT_ADDRESSES( MSGBCC, LENGTHC( MSGBCC), %VM_TYPE_BC,
     1461    14097    3                       MSGREAL_BCC, LENGTHC( MSGREAL_BCC), VM_HEADER.BLIND$);
     1462    14098    3           END;
     1463    14099    3       ELSE DO;
     1464    14100    4           IF TO$->CV.L = 0 THEN DO;
     1465    14101    4               CALL CONCAT( SOURCE_STRG, SUBSTR( PATH$->CV.T, 1, PATH$->CV.L - 2));
     1466    14102    4               CALL INDEX( II, ':', SOURCE_STRG)
     1467    14103    5               WHENRETURN DO;
     1468    14104    5                  CALL INDEX1R( JJ, '@', SOURCE_STRG);
     1469    14105    5                  CALL CONCAT(TARGET_STRG,SUBSTR(SOURCE_STRG,II+1,JJ-II-1), '%',
     1470    14106    5                              SUBSTR(SOURCE_STRG,JJ+1,PATH$->CV.L - 3 - JJ));
     1471    14107    5                  CALL CONCAT( SOURCE_STRG, SUBSTR( SOURCE_STRG, 0, II));
     1472    14108    5                  LEN_TARGET = PATH$->CV.L - 2 - II - 1;
     1473    14109    5                  LEN_SOURCE = II;
     1474    14110    5                  DONE_COMMA = '0'B;
     1475    14111    6                  DO UNTIL DONE_COMMA;
     1476    14112    6                     CALL INDEX1R( JJ, ',', SOURCE_STRG)
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:49   
     1477    14113    7                     WHENRETURN DO;
     1478    14114    7                        CALL CONCAT(SUBSTR( TARGET_STRG, LEN_TARGET, LEN_SOURCE-JJ-1),
             14114                                 '%',
     1479    14115    7                                    SUBSTR(SOURCE_STRG, JJ+2, LEN_SOURCE-JJ-2));
     1480    14116    7                        LEN_TARGET = LEN_TARGET + (LEN_SOURCE-JJ-1);
     1481    14117    7                        CALL CONCAT(SOURCE_STRG,SUBSTR(SOURCE_STRG,0,JJ));
     1482    14118    7                        LEN_SOURCE = JJ;
     1483    14119    7                     END;
     1484    14120    7                     WHENALTRETURN DO;
     1485    14121    7                        CALL CONCAT(SUBSTR(TARGET_STRG,LEN_TARGET,LEN_SOURCE),
             14121                                 SOURCE_STRG);
     1486    14122    7                        DONE_COMMA = '1'B;
     1487    14123    7                     END;
     1488    14124    6                  END;
     1489    14125    5                  CALL CONCAT( CMDBUF, MSGTO, TARGET_STRG);
     1490    14126    5               END;
     1491    14127    5               WHENALTRETURN DO;
     1492    14128    5                  CALL CONCAT( CMDBUF, MSGTO, SUBSTR( PATH$->CV.T, 1, PATH$->CV.L - 2))
             14128                           ;
     1493    14129    5               END;
     1494    14130    4           END;
     1495    14131    3           ELSE
     1496    14132    3               IF SUBSTR( TO$->CV.T, 0, 1) = '<' THEN
     1497    14133    3                   CALL CONCAT( CMDBUF, MSGTO, SUBSTR( TO$->CV.T, 1, TO$->CV.L - 2));
     1498    14134    3               ELSE
     1499    14135    3                   CALL CONCAT( CMDBUF, MSGTO, TO$->CV.T,' ', PATH$->CV.T);
     1500    14136    4           IF COMMENT$->CV.L > 0 THEN DO;
     1501    14137    4               CALL SEARCHR( OFFSET, TVAL, SKIP_BLANKS, CMDBUF);
     1502    14138    4               CALL INSERT( CMDBUF, OFFSET + 2, , '(', COMMENT$->CV.T, ')');
     1503    14139    4               END;
     1504    14140    3           CALL SEND_SMTP_DATA;
     1505    14141    3           END;
     1506    14142    3       IF SUBJECT$->CV.L > 0 THEN DO;
     1507    14143    3           CALL CONCAT( CMDBUF, MSGSUBJ, SUBJECT$->CV.T);
     1508    14144    3           CALL SEND_SMTP_DATA;
     1509    14145    3           END;
     1510    14146    3       IF RE$->CV.L > 0 THEN DO;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:50   
     1511    14147    3           CALL CONCAT( CMDBUF, MSGRE, RE$->CV.T);
     1512    14148    3           CALL SEND_SMTP_DATA;
     1513    14149    3           END;
     1514    14150    3       IF VM_HEADER.UNIQUE_ID$ ~= ADDR( NIL) THEN DO;
     1515    14151    3           CALL CONCAT( CMDBUF, MSGID, VM_HEADER.UNIQUE_ID$->TEXTC.T);
     1516    14152    3           CALL SEND_SMTP_DATA;
     1517    14153    3           END;
     1518    14154    3       IF VM_HEADER.REFERS_TO_ID$ ~= ADDR( NIL) THEN DO;
     1519    14155    3           CALL CONCAT( CMDBUF, MSGREFID, VM_HEADER.REFERS_TO_ID$->TEXTC.T);
     1520    14156    3           CALL SEND_SMTP_DATA;
     1521    14157    3           END;
     1522    14158    3       IF QUOTE_COUNT > 0 AND NODE.FLAGS.QUOTES( THIS_NODE) THEN DO;
     1523    14159    3           QUOTE_NUMBER = MOD( MSG_TSTAMP, QUOTE_COUNT);
     1524    14160    3           IF QUOTE_NUMBER < 0 THEN
     1525    14161    3               QUOTE_NUMBER = -QUOTE_NUMBER;
     1526    14162    3           QUOTE_KEY.K = QUOTE_NUMBER * 1000;
     1527    14163    3           QUOTE_KEY.L = 3;
     1528    14164    3   SEND_QUOTE:
     1529    14165    4           DO UNTIL %NO#;
     1530    14166    4               QUOTE_BUF = ' ';
     1531    14167    4               CALL M$READ( READ_QUOTES)
     1532    14168    5               WHENALTRETURN DO;
     1533    14169    5                   EXIT SEND_QUOTE;
     1534    14170    5                   END;
     1535    14171    4               IF MOD( QUOTE_KEY.K, 1000) = 0 THEN
     1536    14172    4                   CMDBUF = MSGQUOTE;
     1537    14173    4               ELSE
     1538    14174    4                   CMDBUF = ' ';
     1539    14175    4               SUBSTR( CMDBUF, LENGTHC( MSGQUOTE)) = QUOTE_BUF;
     1540    14176    4               CALL SEND_SMTP_DATA;
     1541    14177    4               QUOTE_KEY.K = QUOTE_KEY.K + 1;
     1542    14178    4               END SEND_QUOTE;
     1543    14179    3           END;
     1544    14180    2   SEND_DATA:
     1545    14181    2       CMDBUF = ' ';
     1546    14182    2       CALL SEND_SMTP_NULL;
     1547    14183            /****** SEND MESSAGE BODY ******/
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:51   
     1548    14184    2       IF VM_HEADER.STATUS.ERR THEN
     1549    14185    2           CALL SEND_ERROR_REPORT;
     1550    14186    2       ELSE
     1551    14187    2           CALL SEND_MESSAGE_BODY;
     1552    14188    2       CALL INDEX( OFFSET, ';', DRAINING_COMGROUP.NAME#);
     1553    14189    3       DO UNTIL COUNT < 10;
     1554    14190    3           CALL TCM$DRAIN_SMTP( COUNT);
     1555    14191    3           CALL BINCHAR( SUBSTR( DRAINING_COMGROUP.NAME#, OFFSET + 2, 4), COUNT);
     1556    14192    3           CALL STATUS_UPDATE( DRAINING_COMGROUP);
     1557    14193    3           IF COUNT >= 10 THEN
     1558    14194    3               CALL M$WAIT( WAIT_A_SECOND);
     1559    14195    3           END;
     1560    14196    2       CMDBUF = '.';
     1561    14197    2       CALL STATUS_UPDATE( AWAITING_FINAL_ACK);
     1562    14198    2       CALL SEND_SMTP_COMMAND( '2') ALTRET( ERR);
     1563    14199    2       IF ( SITE.RR_ACTION( CURR_SITE) = %DEFAULT AND VM_HEADER.STATUS.RR) OR
     1564    14200    2               ( SITE.DR_ACTION( CURR_SITE) = %DEFAULT AND VM_HEADER.STATUS.DR) THEN
     1565    14201    2           CALL POST_MESSAGE_ACKNOWLEDGEMENT( SITE.NAME( CURR_SITE));
     1566    14202    2       MSG_COUNT = MSG_COUNT + 1;
     1567    14203            /****** TELL SENDER IF SMTP REJECTS THE MESSAGE ******/
     1568    14204    3       DO NEVER;
     1569    14205    3   ERR:
     1570    14206    3           CALL POST_MESSAGE_REJECTION( SITE.NAME( CURR_SITE));
     1571    14207    3           END;
     1572    14208            /****** INDICATE MESSAGE HAS BEEN PROCESSED ******/
     1573    14209    2   WRAP_IT_UP:
     1574    14210    2       CALL TCM$WRITE_AUDIT_LOG( MSG_COUNT, SITE.NAME( CURR_SITE));
     1575    14211    3       IF MESSAGE_FILE AND HITS.BC AND ( HITS.PRIMARY OR HITS.C) THEN DO;
     1576    14212    3           VM_INFOKEY.COUNT = 5;
     1577    14213    3           VM_INFOKEY.MESSAGE_NUMBER = MSG_NUMBER;
     1578    14214    3           VM_INFOKEY.TYPE = %VM_TYPE_BC;
     1579    14215    3           DELETE_FOLDER.KEY_ = VECTOR( VM_INFOKEY);
     1580    14216    3           DELETE_FOLDER.LKEY_ = VECTOR( NIL);
     1581    14217    3           CALL M$DELREC( DELETE_FOLDER)
     1582    14218    4           WHENALTRETURN DO;
     1583    14219    4               END;
     1584    14220    3           HITS.BC = %NO#;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:52   
     1585    14221    3           GOTO BEGIN_SENDING;
     1586    14222    3           END;
     1587    14223    2       SITE.PENDING( CURR_SITE) = SITE.PENDING( CURR_SITE) - 1;
     1588    14224    2       CALL DELETE_MESSAGE;
     1589    14225    2       CMDBUF = 'RSET';
     1590    14226    2       CALL SEND_SMTP_COMMAND( '2');
     1591    14227    2       RETURN;
     1592    14228
     1593    14229    2       END SEND_ONE_MAILGRAM;
     1594    14230        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:53   
     1595    14231    1   EMIT_ADDRESSES: PROC( HEADER, HEADER_LENGTH, TYPE, REALLY, REALLY_LENGTH, TEXT$);
     1596    14232
     1597    14233    2       DCL COUNT UBIN;
     1598    14234    2       DCL GOT_ONE BIT(1);
     1599    14235    2       DCL HEADER CHAR( HEADER_LENGTH);
     1600    14236    2       DCL HEADER_LENGTH UBIN;
     1601    14237    2       DCL INDX UBIN;
     1602    14238    2       DCL REALLY CHAR( REALLY_LENGTH);
     1603    14239    2       DCL REALLY_LENGTH UBIN;
     1604    14240    2       DCL TEXT$ PTR;
     1605    14241    2       DCL TYPE UBIN;
     1606    14242
     1607    14243    2       GOT_ONE = %NO#;
     1608    14244    3       DO COUNT = 0 TO USER_COUNT - 1;
     1609    14245    4           IF USERS.LIST( COUNT) = TYPE AND USERS.L( COUNT) > 0 THEN DO;
     1610    14246    5               IF GOT_ONE THEN DO;
     1611    14247    5                   SUBSTR( CMDBUF, INDX) = ',';
     1612    14248    5                   CALL SEND_SMTP_DATA;
     1613    14249    5                   CMDBUF = ' ';
     1614    14250    5                   SUBSTR( CMDBUF, HEADER_LENGTH) = USERS.T( COUNT);
     1615    14251    5                   END;
     1616    14252    5               ELSE DO;
     1617    14253    5                   CALL CONCAT( CMDBUF, HEADER, USERS.T( COUNT));
     1618    14254    5                   GOT_ONE = %YES#;
     1619    14255    5                   END;
     1620    14256    4               INDX = USERS.L( COUNT) + HEADER_LENGTH;
     1621    14257    4               END;
     1622    14258    3           END;
     1623    14259    2       IF GOT_ONE THEN
     1624    14260    2           CALL SEND_SMTP_DATA;
     1625    14261    3       IF TEXT$ ~= ADDR( NIL) THEN DO;
     1626    14262    3           CALL CONCAT( CMDBUF, REALLY, TEXT$->TEXTC.T);
     1627    14263    3           CALL SEND_SMTP_DATA;
     1628    14264    3           END;
     1629    14265    2       RETURN;
     1630    14266
     1631    14267    2       END EMIT_ADDRESSES;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:54   
     1632    14268        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:55   
     1633    14269    1   SEND_MESSAGE_BODY: PROC( MAX#);
     1634    14270
     1635    14271    2       DCL MAX# UBIN;
     1636    14272    2       DCL OFFSET UBIN;
     1637    14273
     1638    14274    2       CALL INDEX( OFFSET, ' of ', SENDING_MESSAGE_BODY.NAME#);
     1639    14275    2       CALL BINCHAR( SUBSTR( SENDING_MESSAGE_BODY.NAME#, OFFSET + 4, 4),
     1640    14276    2               VM_HEADER.NUM_RECORDS);
     1641    14277    2       CALL INDEX( OFFSET, ' line ', SENDING_MESSAGE_BODY.NAME#);
     1642    14278    2       POSITION_FOLDER.KEY_ = VECTOR( VM_BODYKEY);
     1643    14279    2       POSITION_FOLDER.V.KEYS# = %YES#;
     1644    14280    2       POSITION_FOLDER.V.KEYR# = %NO#;
     1645    14281    2       POSITION_FOLDER.V.N# = 0;
     1646    14282    2       VM_BODYKEY.COUNT = 7;
     1647    14283    2       VM_BODYKEY.TYPE = %VM_TYPE_BODY;
     1648    14284    2       VM_BODYKEY.MESSAGE_NUMBER = MSG_NUMBER;
     1649    14285    2       VM_BODYKEY.REC_NUMBER = 0;
     1650    14286    2       CALL M$PRECORD( POSITION_FOLDER)
     1651    14287    3       WHENALTRETURN DO;
     1652    14288    3           END;
     1653    14289    2       READ_FOLDER.BUF_ = VECTOR( VM_BODYREC);
     1654    14290    2       READ_FOLDER.BUF_.BOUND = 4095;
     1655    14291    2       READ_FOLDER.KEY_ = VECTOR( VM_BODYKEY);
     1656    14292    2       READ_FOLDER.V.KEYS# = %NO#;
     1657    14293    2       READ_FOLDER.V.KEYR# = %YES#;
     1658    14294    3       DO FOREVER;  /** DO UNTIL END OF MESSAGE **/
     1659    14295    3           VM_BODYREC.VALUE.DATA = ' ';
     1660    14296    3           CALL M$READ( READ_FOLDER) ALTRET( EOT);
     1661    14297    3           IF VM_BODYKEY.TYPE ~= %VM_TYPE_BODY OR
     1662    14298    3                   VM_BODYKEY.MESSAGE_NUMBER ~= MSG_NUMBER OR
     1663    14299    3                   ( ADDR( MAX#) ~= ADDR( NIL) AND
     1664    14300    3                           MAX# <= VM_BODYKEY.REC_NUMBER) THEN
     1665    14301    3               EXIT;
     1666    14302    3           CALL BINCHAR( SUBSTR( SENDING_MESSAGE_BODY.NAME#, OFFSET + 6, 4),
     1667    14303    3                   VM_BODYKEY.REC_NUMBER);
     1668    14304    3           CALL STATUS_UPDATE( SENDING_MESSAGE_BODY);
     1669    14305                /** Do dot transparency **/
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:56   
     1670    14306    3           IF SUBSTR( VM_BODYREC.VALUE.DATA, 0, 1) = '.' THEN
     1671    14307    3               CALL CONCAT( CMDBUF, '.', VM_BODYREC.VALUE.DATA);
     1672    14308    3           ELSE
     1673    14309    3               CMDBUF = VM_BODYREC.VALUE.DATA;
     1674    14310    3           CALL SEND_SMTP_DATA;
     1675    14311    3           END;
     1676    14312    2   EOT:
     1677    14313    2       RETURN;
     1678    14314
     1679    14315    2       END SEND_MESSAGE_BODY;
     1680    14316        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:57   
     1681    14317    1   EMIT_TRACE_RECORDS: PROC;
     1682    14318
     1683    14319    2       DCL EMITTING BIT(1);
     1684    14320    2       DCL FRST SBIN;
     1685    14321    2       DCL LAST SBIN;
     1686    14322
     1687    14323    2       EMITTING = %YES#;
     1688    14324    2       GOTO COMMON;
     1689    14325
     1690    14326    2   SCAN_TRACE_RECORDS: ENTRY;
     1691    14327
     1692    14328    2       EMITTING = %NO#;
     1693    14329    2   COMMON:
     1694    14330    2       POSITION_FOLDER.KEY_ = VECTOR( VM_BODYKEY);
     1695    14331    2       POSITION_FOLDER.V.KEYS# = %YES#;
     1696    14332    2       POSITION_FOLDER.V.KEYR# = %NO#;
     1697    14333    2       POSITION_FOLDER.V.N# = 0;
     1698    14334    2       VM_BODYKEY.COUNT = 7;
     1699    14335    2       VM_BODYKEY.TYPE = %VM_TYPE_TRACE;
     1700    14336    2       VM_BODYKEY.MESSAGE_NUMBER = MSG_NUMBER;
     1701    14337    2       VM_BODYKEY.REC_NUMBER = 0;
     1702    14338    2       CALL M$PRECORD( POSITION_FOLDER)
     1703    14339    3       WHENALTRETURN DO;
     1704    14340    3           END;
     1705    14341    2       READ_FOLDER.BUF_ = VECTOR( VM_BODYREC);
     1706    14342    2       READ_FOLDER.BUF_.BOUND = 4095;
     1707    14343    2       READ_FOLDER.KEY_ = VECTOR( VM_BODYKEY);
     1708    14344    2       READ_FOLDER.V.KEYS# = %NO#;
     1709    14345    2       READ_FOLDER.V.KEYR# = %YES#;
     1710    14346    2   TRACELOOP:
     1711    14347    3       DO WHILE( '1'B);
     1712    14348    3           VM_BODYREC.VALUE.DATA = ' ';
     1713    14349    3           CALL M$READ( READ_FOLDER)
     1714    14350    4           WHENALTRETURN DO;
     1715    14351    4               EXIT TRACELOOP;
     1716    14352    4               END;
     1717    14353    3           IF VM_BODYKEY.TYPE ~= %VM_TYPE_TRACE OR
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:58   
     1718    14354    3                   VM_BODYKEY.MESSAGE_NUMBER ~= MSG_NUMBER THEN
     1719    14355    3               EXIT TRACELOOP;
     1720    14356    4           DO SELECT( SUBSTR( VM_BODYREC.VALUE.DATA, 0, 5));
     1721    14357    4               SELECT( 'Retur');
     1722    14358    5                   IF NOT EMITTING THEN DO;
     1723    14359    5                       CALL INDEX( FRST, '<', VM_BODYREC.VALUE.DATA);
     1724    14360    5                       CALL INDEX( LAST, '>', VM_BODYREC.VALUE.DATA);
     1725    14361    5                       IF MESSAGE_FILE THEN
     1726    14362    5                           CALL CONCAT( CMDBUF, 'MAIL FROM:<',
     1727    14363    5                                   SUBSTR( VM_BODYREC.VALUE.DATA, FRST+1, LAST-FRST-1),
     1728    14364    5                                   '>');
     1729    14365    6                       ELSE DO;
     1730    14366    6                           CALL CONCAT( CMDBUF, 'MAIL FROM:<SMTP_Mailer@',
     1731    14367    6                                   SUBSTR( SITE.IDENT.TEXT( CURR_SITE), 0,
     1732    14368    6                                   SITE.IDENT.COUNT( CURR_SITE)), '>');
     1733    14369    6                           PATH$->CV.L = 1+LAST-FRST;
     1734    14370    6                           PATH$->CV.T =
     1735    14371    6                                   SUBSTR( VM_BODYREC.VALUE.DATA, FRST, 1+LAST-FRST);
     1736    14372    6                           TO$->CV.L = 0;  /* use PATH for TO */
     1737    14373    6                           END;
     1738    14374    5                       EXIT TRACELOOP;
     1739    14375    5                       END;
     1740    14376    4               SELECT( ELSE);
     1741    14377    5                   IF EMITTING THEN DO;
     1742    14378    5                       CMDBUF = VM_BODYREC.VALUE.DATA;
     1743    14379    5                       CALL SEND_SMTP_DATA;
     1744    14380    5                       END;
     1745    14381    4               END;
     1746    14382    3           END;
     1747    14383    2       RETURN;
     1748    14384
     1749    14385    2       END EMIT_TRACE_RECORDS;
     1750    14386        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:59   
     1751    14387    1   SEND_ERROR_REPORT: PROC;
     1752    14388
     1753    14389    2       DCL TSTRING CHAR( %LINE_SIZE);
     1754    14390    2       DCL TVAL UBIN;
     1755    14391
     1756    14392    2       IF BAD_ADDRESS$->CV.L = 0 THEN
     1757    14393    2           CMDBUF = '-- Unable to deliver mail for the following reason:';
     1758    14394    3       ELSE DO;
     1759    14395    3           CALL CONCAT( CMDBUF, '-- Unable to deliver mail to "',
     1760    14396    3                   BAD_ADDRESS$->CV.T, '"');
     1761    14397    3   DEBLANK:
     1762    14398    4           DO WHILE '1'B;
     1763    14399    4               CALL INDEX( TVAL, '  ', CMDBUF) ALTRET( DEBLANKED);
     1764    14400    4               IF SUBSTR( CMDBUF, TVAL) = ' ' THEN
     1765    14401    4                   EXIT DEBLANK;
     1766    14402    4               CALL CONCAT( TSTRING, SUBSTR( CMDBUF, 0, TVAL), SUBSTR( CMDBUF, TVAL + 1
             14402                        ));
     1767    14403    4               CMDBUF = TSTRING;
     1768    14404    4               END DEBLANK;
     1769    14405    3   DEBLANKED:
     1770    14406    3           CALL SEND_SMTP_DATA;
     1771    14407    3           CMDBUF = '-- for the following reason:';
     1772    14408    3           END;
     1773    14409    2       CALL SEND_SMTP_DATA;
     1774    14410    2       GET_MAIL_ERROR_CODE.CODE_ = VECTOR( VM_HEADER.ERROR);
     1775    14411    2       CALL M$ERRMSG( GET_MAIL_ERROR_CODE);
     1776    14412    3       DO TVAL = 0 TO VLR_ERRMSG.RECCNT - 1;
     1777    14413    3           CMDBUF = MAIL_ERROR_CODE( TVAL);
     1778    14414    3           CALL SEND_SMTP_DATA;
     1779    14415    3           END;
     1780    14416    3       IF VM_HEADER.NUM_RECORDS > 0 THEN DO;
     1781    14417    3           CMDBUF = ' ';
     1782    14418    3           CALL SEND_SMTP_DATA;
     1783    14419    3           CMDBUF = '-- Text of undelivered message follows:';
     1784    14420    3           CALL SEND_SMTP_DATA;
     1785    14421    3           IF VM_HEADER.NUM_TRACE_RECORDS > 0 THEN
     1786    14422    3               CALL EMIT_TRACE_RECORDS;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:60   
     1787    14423    3           CMDBUF = ' ';
     1788    14424    3           CALL SEND_SMTP_DATA;
     1789    14425    3           CALL SEND_MESSAGE_BODY;
     1790    14426    3           END;
     1791    14427    2       RETURN;
     1792    14428
     1793    14429    2       END SEND_ERROR_REPORT;
     1794    14430        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:61   
     1795    14431    1   SEND_SMTP_COMMAND: PROC( REPLY_CODE) ALTRET;
     1796    14432
     1797    14433    2       DCL ALTRETURNED BIT(1);
     1798    14434    2       DCL MSGBUF CHAR( %LINE_SIZE);
     1799    14435    2       DCL REPLY_CODE CHAR(1);
     1800    14436    2       DCL RETRIES UBIN;
     1801    14437
     1802    14438            /****** Find command size, save command text ******/
     1803    14439    2       MSGBUF = CMDBUF;
     1804    14440    2       CALL GET_IOBUF_BOUND( CMDBUF, VLEN);
     1805    14441            /****** Loop. Send command up to 3 times, awaiting successful reply *****/
     1806    14442    3       DO RETRIES = 1 TO 3;
     1807    14443                /****** WRITE COMMAND AND READ REPLY ******/
     1808    14444    3           IF NOT TCP_FLAVOR THEN
     1809    14445    3               CALL M$WAIT( WAIT_A_SECOND);
     1810    14446    3           REPLYLEN = 0;
     1811    14447    3           ALTRETURNED = %NO#;
     1812    14448    3           CMDBUF = MSGBUF;
     1813    14449    3           WRITE_ME.BUF_.BOUND = VLEN;
     1814    14450    3           CALL M$WRITE( WRITE_ME);
     1815    14451    4           DO UNTIL REPLYLEN > 0 OR ALTRETURNED;
     1816    14452    5               IF TCM_TESTMODE THEN DO;
     1817    14453    5                   CALL M$READ( READ_UC);
     1818    14454    5                   REPLYLEN = DCBADDR( DCBNUM( M$UC))->F$DCB.ARS#;
     1819    14455    5                   END;
     1820    14456    5               ELSE DO;
     1821    14457    5                   CALL TCM$WRITE_SMTP( CMDBUF_, VLEN);
     1822    14458    5                   CALL TCM$READ_SMTP( CMDBUF_, REPLYLEN)
     1823    14459    6                   WHENALTRETURN DO;
     1824    14460    6                       ALTRETURNED = '1'B;
     1825    14461    6                       END;
     1826    14462    5                   REPLYLEN = REPLYLEN + 1;
     1827    14463    5                   WRITE_ME.BUF_.BOUND = REPLYLEN - 1;
     1828    14464    5                   CALL M$WRITE( WRITE_ME);
     1829    14465    5                   END;
     1830    14466    4               END;
     1831    14467    3           IF ALTRETURNED THEN
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:62   
     1832    14468    3               UNWIND TO TCM_SMTP_BAILOUT;
     1833    14469                /****** RETURN IF PROPER REPLY CODE, ELSE TRY AGAIN ******/
     1834    14470    3           IF SUBSTR( CMDBUF, 0, 1) = REPLY_CODE THEN
     1835    14471    3               RETURN;
     1836    14472    3           IF NOT TCP_FLAVOR THEN
     1837    14473    3               CALL M$WAIT( WAIT_A_SECOND);
     1838    14474    3           END;
     1839    14475            /* Check to see if the response we received was plausibly SMTP-ish (i.e.,
     1840    14476               the first character is a digit).  If not, we may no longer be talking
     1841    14477               with the SMTP receiver at the other end, so let's just shut down the
     1842    14478               link and try again later.                                        */
     1843    14479    2       IF SUBSTR( CMDBUF, 0, 1) < '1' OR SUBSTR( CMDBUF, 0, 1) > '5' THEN
     1844    14480    2           UNWIND TO TCM_SMTP_BAILOUT;
     1845    14481    2       ALTRETURN;
     1846    14482
     1847    14483    2       END SEND_SMTP_COMMAND;
     1848    14484        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:63   
     1849    14485    1   SEND_SMTP_DATA: PROC;
     1850    14486
     1851    14487    2       DCL CPS UBIN;
     1852    14488
     1853    14489    2       CALL GET_IOBUF_BOUND( CMDBUF, VLEN);
     1854    14490            /****** SUPRESS TRAILING BLANKS IN MESSAGE ******/
     1855    14491    2       IF VLEN = 0 AND ' ' = SUBSTR( CMDBUF, , 1) THEN
     1856    14492    2           BLANK_COUNT = BLANK_COUNT + 1;
     1857    14493    3       ELSE DO;
     1858    14494                /****** WRITE ANY PENDING BLANK LINES ******/
     1859    14495    4           DO WHILE BLANK_COUNT > 0;
     1860    14496    4               CALL M$WRITE( WRITE_ME_BLANK);
     1861    14497    4               IF NOT TCM_TESTMODE THEN
     1862    14498    4                   CALL TCM$WRITE_SMTP( TEMPBUF_, -1);
     1863    14499    4               BLANK_COUNT = BLANK_COUNT - 1;
     1864    14500    4               IF NOT FLOW_CONTROL_ENABLED THEN
     1865    14501    4                   CALL M$WAIT( WAIT_A_SECOND);
     1866    14502    4               END;
     1867    14503                /****** WRITE LINE TO SMTP ******/
     1868    14504    3           WRITE_ME.BUF_.BOUND = VLEN;
     1869    14505    3           CALL M$WRITE( WRITE_ME);
     1870    14506    3           IF NOT TCM_TESTMODE THEN
     1871    14507    3               CALL TCM$WRITE_SMTP( CMDBUF_, VLEN);
     1872    14508
     1873    14509        /*      IF FLOW_CONTROL_ENABLED THEN
     1874    14510                    CPS = 120;
     1875    14511                ELSE
     1876    14512                    CPS = 30;
     1877    14513                WAIT_A_WHILE.V.UNITS# = ( ( VLEN + ( CPS / 2)) / CPS) + 1;
     1878    14514                    CALL M$WAIT( WAIT_A_WHILE);
     1879    14515        */
     1880    14516    4           IF NOT FLOW_CONTROL_ENABLED THEN DO;
     1881    14517    4               WAIT_A_WHILE.V.UNITS# = ( VLEN + 15) / 30 + 1;
     1882    14518    4               CALL M$WAIT( WAIT_A_WHILE);
     1883    14519    4               END;
     1884    14520    3           END;
     1885    14521    2       RETURN;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:64   
     1886    14522
     1887    14523    2   SEND_SMTP_NULL: ENTRY;
     1888    14524
     1889    14525    2       CALL M$WRITE( WRITE_ME_NULL);
     1890    14526    3       IF NOT TCM_TESTMODE THEN DO;
     1891    14527    3           IF TCP_FLAVOR THEN
     1892    14528    3               CALL TCM$WRITE_SMTP( VECTOR( NIL), 0);
     1893    14529    3           ELSE
     1894    14530    3               CALL TCM$WRITE_SMTP( TEMPBUF_, -1);
     1895    14531    3           END;
     1896    14532    2       RETURN;
     1897    14533
     1898    14534    2       END SEND_SMTP_DATA;
     1899    14535        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:65   
     1900    14536    1   FIND_MAIL_HEADER: PROC ALTRET;
     1901    14537
     1902    14538    2       DCL HAVE_A_MESSAGE BIT(1);
     1903    14539
     1904    14540    2       CALL STATUS_UPDATE( SEARCHING);
     1905    14541    2       POSITION_FOLDER.KEY_ = VECTOR( VM_INFOKEY);
     1906    14542    2       POSITION_FOLDER.V.KEYS# = %YES#;
     1907    14543    2       POSITION_FOLDER.V.KEYR# = %NO#;
     1908    14544    2       IF MSG_NUMBER = 0 THEN
     1909    14545    2           POSITION_FOLDER.V.N# = 0;
     1910    14546    2       ELSE
     1911    14547    2           POSITION_FOLDER.V.N# = 1;
     1912    14548    2       VM_INFOKEY.COUNT = LENGTHC( VM_INFOKEY) - 1;
     1913    14549    2       VM_INFOKEY.TYPE = %VM_TYPE_HEAD;
     1914    14550    2       VM_INFOKEY.MESSAGE_NUMBER = MSG_NUMBER;
     1915    14551    2       CALL M$PRECORD( POSITION_FOLDER)
     1916    14552    3       WHENALTRETURN DO;
     1917    14553    3           END;
     1918    14554    2       READ_FOLDER.BUF_ = VECTOR( VM_HEADER);
     1919    14555    2       READ_FOLDER.BUF_.BOUND = 4095;
     1920    14556    2       READ_FOLDER.KEY_ = VECTOR( VM_INFOKEY);
     1921    14557    2       READ_FOLDER.V.KEYS# = %NO#;
     1922    14558    2       READ_FOLDER.V.KEYR# = %YES#;
     1923    14559    2       HAVE_A_MESSAGE = %NO#;
     1924    14560    3       DO UNTIL( HAVE_A_MESSAGE);
     1925    14561    3           CALL M$READ( READ_FOLDER)
     1926    14562    4           WHENALTRETURN DO;
     1927    14563    4               ALTRETURN;
     1928    14564    4               END;
     1929    14565    3           HEADER_ARS = M$FOLDER$->F$DCB.ARS#;
     1930    14566    3           IF VM_INFOKEY.COUNT = 0 /* hit EOF */ OR
     1931    14567    3                   VM_INFOKEY.TYPE ~= %VM_TYPE_HEAD /* other than header */ THEN
     1932    14568    3               ALTRETURN;
     1933    14569    3           IF NOT VM_HEADER.STATUS.DEL AND NOT VM_HEADER.STATUS.MARK AND
     1934    14570    4                   ( MESSAGE_FILE OR NOT VM_HEADER.STATUS.FCOPY) THEN DO;
     1935    14571    4               VM_HEADRES.RES# = VM_INFOKEY.MESSAGE_NUMBER;
     1936    14572    4               CALL M$ENQ( ENQ_ON_HEADER)
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:66   
     1937    14573    5               WHENALTRETURN DO; /* Still being delivered */
     1938    14574    5                   ALTRETURN;
     1939    14575    5                   END;
     1940    14576    4               HAVE_A_MESSAGE = %YES#;
     1941    14577        /* Now get the real site record */
     1942    14578    4               READ_SITE.V.DCB# = DCBNUM( M$FOLDER);
     1943    14579    4               READ_SITE.BUF_ = VECTOR(VM_SITE);
     1944    14580    4               CALL M$READ (READ_SITE)
     1945    14581    5               WHENALTRETURN DO;
     1946    14582    5                   ALTRETURN;
     1947    14583    5                   END;
     1948    14584    4               END;
     1949    14585    3            END;
     1950    14586    2       MSG_NUMBER = VM_INFOKEY.MESSAGE_NUMBER;
     1951    14587    2       MSG_TSTAMP = VM_HEADER.CREATION_DATE;
     1952    14588    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.BAD_ADDRESS$);
     1953    14589    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.BLIND$);
     1954    14590    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.COPY$);
     1955    14591    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.FILE_FOLDER$);
     1956    14592    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.FROM$);
     1957    14593    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.REFERENCE$);
     1958    14594    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.REPLY_TO$);
     1959    14595    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.RETURN_ADDRESS$);
     1960    14596    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.SIGNED$);
     1961    14597    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.SUBJECT$);
     1962    14598    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.TO$);
     1963    14599    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.REFERS_TO_ID$);
     1964    14600    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.UNIQUE_ID$);
     1965    14601    2       RETURN;
     1966    14602
     1967    14603    2       END FIND_MAIL_HEADER;
     1968    14604        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:67   
     1969    14605    1   ADJUST_POINTER: PROC( STRUCTURE, PTR$);
     1970    14606
     1971    14607    2       DCL PTR$ PTR;
     1972    14608    2       DCL 1 PTR# REDEF PTR$,
     1973    14609    2            2 WORDS UBIN HALF UNAL,
     1974    14610    2            2 CHARS UBIN(2) UNAL,
     1975    14611    2            2 BITS UBIN(4) UNAL,
     1976    14612    2            2 SEGID BIT(12);
     1977    14613    2       DCL STRUCTURE BIT(36);
     1978    14614
     1979    14615    2       IF PTR#.SEGID = '0'B THEN
     1980    14616    2           PTR$ = ADDR( NIL);
     1981    14617    2       ELSE
     1982    14618    2           IF PTR$ ~= ADDR( NIL) THEN
     1983    14619    2               PTR$ = PINCRB( ADDR( STRUCTURE),
     1984    14620    2                       PTR#.WORDS * 36 + PTR#.CHARS * 9 + PTR#.BITS);
     1985    14621    2       RETURN;
     1986    14622
     1987    14623    2       END ADJUST_POINTER;
     1988    14624        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:68   
     1989    14625    1   PARSE_MAIL_HEADER: PROC ALTRET;
     1990    14626
     1991    14627    2       DCL BLANK_INDEX UBIN WORD;
     1992    14628    2       DCL LPAREN UBIN WORD;
     1993    14629    2       DCL LPAREN1 UBIN WORD;
     1994    14630    2       DCL NAME_END UBIN WORD;
     1995    14631    2       DCL PDEPTH UBIN WORD;
     1996    14632    2       DCL RPAREN UBIN WORD;
     1997    14633    2       DCL SITE_INDEX UBIN WORD;
     1998    14634    2       DCL STARTSCAN UBIN WORD;
     1999    14635    2       DCL TEMP$ PTR;
     2000    14636    2       DCL TSTRING CHAR( %LINE_SIZE);
     2001    14637    2       DCL TVAL UBIN WORD;
     2002    14638
     2003    14639    2       CALL COPY( VM_HEADER.FROM$, FROM$, 80);
     2004    14640    2       CALL COPY( VM_HEADER.TO$, TO$, %PATH_SIZE);
     2005    14641    2       CALL COPY( VM_HEADER.REPLY_TO$, REPLY_TO$, %USER_SIZE);
     2006    14642    2       CALL COPY( VM_HEADER.SUBJECT$, SUBJECT$, %LINE_SIZE);
     2007    14643    2       CALL COPY( VM_HEADER.REFERENCE$, RE$, %LINE_SIZE);
     2008    14644    2       CALL COPY( VM_HEADER.SIGNED$, SIGNATURE$, %LINE_SIZE);
     2009    14645    2       CALL COPY( VM_HEADER.BAD_ADDRESS$, BAD_ADDRESS$, %LINE_SIZE);
     2010    14646    3       IF VM_HEADER.STATUS.ERR THEN DO;
     2011    14647    3           VM_HEADER.REFERS_TO_ID$ = VM_HEADER.UNIQUE_ID$;
     2012    14648    3           VM_HEADER.UNIQUE_ID$ = ADDR( NIL);
     2013    14649    3           IF VM_HEADER.FROM$ = ADDR( NIL) OR
     2014    14650    3                   SUBSTR( FROM$->CV.T, 0, 11) ~= 'SMTP Mailer' THEN
     2015    14651    3               IF VM_HEADER.REPLY_TO$ ~= ADDR( NIL) THEN
     2016    14652    3                   TONAME = REPLY_TO;
     2017    14653    3               ELSE
     2018    14654    3                   GOTO DEAD_LETTER;
     2019    14655    3           ELSE
     2020    14656    3               IF VM_HEADER.FROM$ ~= ADDR( NIL) THEN
     2021    14657    3                   TONAME = FROMNAME;
     2022    14658    4               ELSE DO;
     2023    14659    4   DEAD_LETTER:
     2024    14660    4                   TONAME.L = LENGTHC( 'Postmaster');
     2025    14661    4                   TONAME.T = 'Postmaster';
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:69   
     2026    14662    4                   END;
     2027    14663    3           RE = SUBJECT;
     2028    14664    3           SUBJECT.L = LENGTHC( 'Returned mail');
     2029    14665    3           SUBJECT.T = 'Returned mail';
     2030    14666    3           FROM$->CV.L = LENGTHC( 'SMTP Mailer');
     2031    14667    3           FROM$->CV.T = 'SMTP Mailer';
     2032    14668    3           REPLY_TO$->CV.L = LENGTHC( 'Postmaster');
     2033    14669    3           REPLY_TO$->CV.T = 'Postmaster';
     2034    14670    3           END;
     2035    14671    2       CALL MAKE_SMTP_ADDRESS( FROM$, FROMNAME$, FROMADDR$);
     2036    14672    2       CALL MAKE_SMTP_ADDRESS( REPLY_TO$, REPLYNAME$, REPLYADDR$);
     2037    14673    2       PATH.L = 0;
     2038    14674    2       PATH.T = ' ';
     2039    14675    2       TOSITE.L = 0;
     2040    14676    2       TOSITE.T = ' ';
     2041    14677    2       CALL M$TIME( GET_SMTP_DATE);
     2042    14678    2       DATEWORK.MONMASK = DATEWORK.MONMASK | '000040040'O;  /* MON->Mon */
     2043    14679    2       DAYMASK = DAYMASK | '000040040'O;  /* DAY->Day */
     2044    14680    2       CALL CONCAT( DATEBUF, DATEWORK.DD, ' ', DATEWORK.MON, ' ', DATEWORK.YY);
     2045    14681    3       IF MESSAGE_FILE THEN DO;
     2046    14682    3           CALL READ_ADDRESS_RECORDS
     2047    14683    4           WHENALTRETURN DO;
     2048    14684    4               ALTRETURN;
     2049    14685    4               END;
     2050    14686    3           RETURN;
     2051    14687    3           END;
     2052    14688            /****** EXTRACT FORWARD PATH FROM HEADER ******/
     2053    14689    3       IF SUBJECT$->CV.L > 0 THEN DO;
     2054    14690                /** CHECK FOR PATH IN SUBJECT **/
     2055    14691    3           CALL INDEX( LOC, '<', SUBJECT$->CV.T) ALTRET( CHECK_RE);
     2056    14692    4           IF LOC > 0 THEN DO;
     2057    14693                    /** STRIP PATH FROM END OF SUBJECT **/
     2058    14694    4               PATH$->CV.L = SUBJECT$->CV.L - LOC;
     2059    14695    4               PATH$->CV.T = SUBSTR( SUBJECT$->CV.T, LOC);
     2060    14696    4               SUBJECT$->CV.L = SUBJECT$->CV.L - PATH$->CV.L;
     2061    14697    4               IF SUBSTR( SUBJECT$->CV.T, SUBJECT$->CV.L - 1, 1) = ' ' THEN
     2062    14698    4                   SUBJECT$->CV.L = SUBJECT$->CV.L - 1;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:70   
     2063    14699    4               END;
     2064    14700    4           ELSE DO;
     2065    14701                    /** MOVE SUBJECT TO PATH **/
     2066    14702    4               PATH$->CV.L = SUBJECT$->CV.L;
     2067    14703    4               PATH$->CV.T = SUBJECT$->CV.T;
     2068    14704    4               SUBJECT$->CV.L = 0;
     2069    14705    4               END;
     2070    14706    3           CALL INDEX( LOC, '%', TO$->CV.T) ALTRET( PATH_OK);
     2071    14707    3           CMDBUF = ADDRERR;
     2072    14708    3           REPLYLEN = LENGTHC( ADDRERR);
     2073    14709    3           ALTRETURN;
     2074    14710    3   PATH_OK:
     2075    14711    3           TO$->CV.L = 0;
     2076    14712    3           END;
     2077    14713    3       ELSE DO;
     2078    14714    3   CHECK_RE:
     2079    14715    4           IF RE$->CV.L > 0 THEN DO;
     2080    14716                    /** CHECK FOR PATH IN REFERENCE **/
     2081    14717    4               CALL INDEX( LOC, '<', RE$->CV.T) ALTRET( CHECK_TO);
     2082    14718    5               IF LOC > 0 THEN DO;
     2083    14719                        /** STRIP PATH FROM END OF REFERENCE **/
     2084    14720    5                   PATH$->CV.L = RE$->CV.L - LOC;
     2085    14721    5                   PATH$->CV.T = SUBSTR( RE$->CV.T, LOC);
     2086    14722    5                   RE$->CV.L = RE$->CV.L - PATH$->CV.L;
     2087    14723    5                   IF SUBSTR( RE$->CV.T, RE$->CV.L - 1, 1) = ' ' THEN
     2088    14724    5                       RE$->CV.L = RE$->CV.L - 1;
     2089    14725    5                   END;
     2090    14726    5               ELSE DO;
     2091    14727                        /** MOVE REFERENCE TO PATH **/
     2092    14728    5                   PATH$->CV.L = RE$->CV.L;
     2093    14729    5                   PATH$->CV.T = RE$->CV.T;
     2094    14730    5                   RE$->CV.L = 0;
     2095    14731    5                   END;
     2096    14732    4               CALL INDEX( LOC, '%', TO$->CV.T) ALTRET( REPATH_OK);
     2097    14733    4               CMDBUF = ADDRERR;
     2098    14734    4               REPLYLEN = LENGTHC( ADDRERR);
     2099    14735    4               ALTRETURN;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:71   
     2100    14736    4   REPATH_OK:
     2101    14737    4               TO$->CV.L = 0;
     2102    14738    4               END;
     2103    14739    4           ELSE DO;
     2104    14740    4   CHECK_TO:
     2105    14741    5               IF TO$->CV.L > 0 THEN DO;
     2106    14742                        /** EXTRACT PATH FROM TO: FIELD **/
     2107    14743    5                   CALL INDEX( LOC, '"', TO$->CV.T)
     2108    14744    6                   WHENRETURN DO;
     2109    14745    6                       CALL INDEX( LOCE, '"', TO$->CV.T, LOC + 1) ALTRET( NO_PATH);
     2110    14746    6                       CALL INDEX( TVAL, '@',
     2111    14747    6                               SUBSTR( TO$->CV.T, LOC, LOCE - LOC + 1)) ALTRET( NO_PATH
             14747                                        );
     2112    14748        /* Recipient is identified within a comment in the TO: line.  Extract the
     2113    14749           path; if a name is present also, store it too. */
     2114    14750    6                       CALL INDEX( NAME_END, '<', TO$->CV.T, LOC)
     2115    14751    7                       WHENRETURN DO;
     2116    14752    7                           CALL INDEX( TVAL, '>', TO$->CV.T, NAME_END + 1) ALTRET(
             14752                                    NO_PATH);
     2117    14753    7                           PATH$->CV.L = TVAL - NAME_END + 1;
     2118    14754    7                           PATH$->CV.T = SUBSTR( TO$->CV.T, NAME_END, TVAL - NAME_END +
             14754                                    1);
     2119    14755    7                           TSTRING = SUBSTR( TO$->CV.T, LOC + 1, NAME_END - LOC - 1);
     2120    14756    7                           TO$->CV.L = NAME_END - LOC;
     2121    14757    7                           TO$->CV.T = TSTRING;
     2122    14758    8                           DO WHILE( TO$->CV.L > 0);
     2123    14759    8                               IF SUBSTR( TO$->CV.T, TO$->CV.L - 1) = ' ' THEN
     2124    14760    8                                   TO$->CV.L = TO$->CV.L - 1;
     2125    14761    8                               ELSE
     2126    14762    8                                   EXIT;
     2127    14763    8                               END;
     2128    14764    7                           END;
     2129    14765    7                       WHENALTRETURN DO;
     2130    14766    7                           PATH$->CV.L = LOCE - LOC + 1;
     2131    14767    7                           CALL CONCAT( PATH$->CV.T, '<',
     2132    14768    7                                   SUBSTR( TO$->CV.T, LOC + 1, LOCE - LOC - 1), '>');
     2133    14769    7                           TO$->CV.L = 0;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:72   
     2134    14770    7                           END;
     2135    14771    6                       END;
     2136    14772    6                   WHENALTRETURN DO;
     2137    14773    6                       CALL INDEX( LOC, '%', TO$->CV.T)
     2138    14774    7                       WHENALTRETURN DO;
     2139    14775    7                           CALL INDEX( LOC, '@', TO$->CV.T) ALTRET( NO_PATH);
     2140    14776    7                           END;
     2141    14777    6                       PATH$->CV.L = TO$->CV.L + 2;
     2142    14778    6                       CALL CONCAT( PATH$->CV.T, '<', TO$->CV.T, '>');
     2143    14779    6                       TO$->CV.L = 0;
     2144    14780    6                       END;
     2145    14781    5                   END;
     2146    14782    5               ELSE DO;
     2147    14783                        /** PATH NOT FOUND IN HEADER **/
     2148    14784    5   NO_PATH:
     2149    14785    5                   VM_LISTKEY.COUNT = TO$->CV.L + LENGTHC( VM_LISTKEY.TYPE);
     2150    14786    5                   CALL XLATE( VM_LISTKEY.TEXT, TCM_XLATE_TO_UC, TO$->CV.T);
     2151    14787    5                   READ_REGISTRY.BUF_ = VECTOR( VM_ADD_HEAD);
     2152    14788    5                   READ_REGISTRY.BUF_.BOUND = 4095;
     2153    14789    5                   READ_REGISTRY.KEY_ = VECTOR( VM_LISTKEY);
     2154    14790    5                   READ_REGISTRY.V.KEYS# = %YES#;
     2155    14791    5                   READ_REGISTRY.V.KEYR# = %NO#;
     2156    14792    5                   CALL M$READ( READ_REGISTRY)
     2157    14793    6                   WHENALTRETURN DO;
     2158    14794    6                       IF VM_HEADER.STATUS.ERR OR
     2159    14795    6                               VM_HEADER.STATUS.ANSWER OR
     2160    14796    6                               VM_HEADER.STATUS.ACK OR
     2161    14797    7                               VM_HEADER.STATUS.DELIVERY THEN DO;
     2162    14798    7                           CALL READ_ADDRESS_RECORDS
     2163    14799    8                           WHENRETURN DO;
     2164    14800    8                               RETURN;
     2165    14801    8                               END;
     2166    14802    7                           END;
     2167    14803    6                       CMDBUF = PATHERR;
     2168    14804    6                       REPLYLEN = LENGTHC( PATHERR);
     2169    14805    6                       ALTRETURN;
     2170    14806    6                       END;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:73   
     2171    14807    6                   IF VM_ADD_HEAD.NUM_ENTRIES > 1 THEN DO;
     2172    14808    6                       CMDBUF = MULTIPLEADDRESSERR;
     2173    14809    6                       REPLYLEN = LENGTHC( MULTIPLEADDRESSERR);
     2174    14810    6                       ALTRETURN;
     2175    14811    6                       END;
     2176    14812    5                   ALIAS$ = VM_ADD_HEAD.HEAD$;
     2177    14813    5                   CALL ADJUST_POINTER( VM_ADD_HEAD, ALIAS$);
     2178    14814    5                   IF VM_UADDRESS.TYPE ~= %VM_ADD_UNRESOLVED OR
     2179    14815    5                           VM_UADDRESS.SITENAME ~= ' ' OR
     2180    14816    6                           SUBSTR( VM_UADDRESS.USER_NAME.TEXT, 0, 1) ~= '<' THEN DO;
     2181    14817    6                       CMDBUF = NOTMULTICSADDRESSERR;
     2182    14818    6                       REPLYLEN = LENGTHC( NOTMULTICSADDRESSERR);
     2183    14819    6                       ALTRETURN;
     2184    14820    6                       END;
     2185    14821    5                   PATH$->CV.L = VM_UADDRESS.USER_NAME.COUNT;
     2186    14822    5                   PATH$->CV.T = VM_UADDRESS.USER_NAME.TEXT;
     2187    14823    5                   END;
     2188    14824    4               END;
     2189    14825    3           END;
     2190    14826            /** If no @ in path, convert rightmost % to @ */
     2191    14827    2       CALL INDEX( LOC, '@', PATH$->CV.T)
     2192    14828    3       WHENALTRETURN DO;
     2193    14829    3           CALL INDEX1R( LOC, '%', PATH$->CV.T)
     2194    14830    4           WHENRETURN DO;
     2195    14831    4               SUBSTR( PATH$->CV.T, LOC, 1) = '@';
     2196    14832    4               END;
     2197    14833    3           END;
     2198    14834        /* Look for (comments) in the path.  If any are found, strip them out, and
     2199    14835           save them for use in the TO: field of the outgoing mail.             */
     2200    14836    2       COMMENT$->CV.L = 0;
     2201    14837    2       CALL INDEX( LPAREN, '(', PATH$->CV.T);
     2202    14838    3       DO WHILE( LPAREN < PATH$->CV.L);
     2203    14839    3           PDEPTH = 1;
     2204    14840    3           STARTSCAN = LPAREN + 1;
     2205    14841    4           DO UNTIL PDEPTH = 0 OR PATH$->CV.L <= RPAREN;
     2206    14842    4               CALL INDEX( LPAREN1, '(', PATH$->CV.T, STARTSCAN);
     2207    14843    4               CALL INDEX( RPAREN, ')', PATH$->CV.T, STARTSCAN);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:74   
     2208    14844    5               IF LPAREN1 < RPAREN THEN DO;
     2209    14845    5                   PDEPTH = PDEPTH + 1;
     2210    14846    5                   STARTSCAN = LPAREN1 + 1;
     2211    14847    5                   END;
     2212    14848    5               ELSE DO;
     2213    14849    5                   PDEPTH = PDEPTH - 1;
     2214    14850    5                   STARTSCAN = RPAREN + 1;
     2215    14851    5                   END;
     2216    14852    4               END;
     2217    14853    3           TVAL = COMMENT$->CV.L;
     2218    14854    3           COMMENT$->CV.L = TVAL + ( RPAREN - LPAREN) - 1;
     2219    14855    3           SUBSTR( COMMENT$->CV.T, TVAL) = SUBSTR( PATH$->CV.T, LPAREN + 1);
     2220    14856    3           RPAREN = MINIMUM( PATH$->CV.L - 1, RPAREN);
     2221    14857    4           DO WHILE( LPAREN > 0);
     2222    14858    4               IF SUBSTR( PATH$->CV.T, LPAREN - 1, 1) = ' ' THEN
     2223    14859    4                   LPAREN = LPAREN - 1;
     2224    14860    4               ELSE
     2225    14861    4                   EXIT;
     2226    14862    4               END;
     2227    14863    4           DO WHILE( RPAREN < PATH$->CV.L - 1);
     2228    14864    4               IF SUBSTR( PATH$->CV.T, LPAREN + 1, 1) = ' ' THEN
     2229    14865    4                   RPAREN = RPAREN + 1;
     2230    14866    4               ELSE
     2231    14867    4                   EXIT;
     2232    14868    4               END;
     2233    14869    3           CALL CONCAT( TSTRING, SUBSTR( PATH$->CV.T, 0, LPAREN),
     2234    14870    3                   SUBSTR( PATH$->CV.T, RPAREN + 1));
     2235    14871    3           PATH$->CV.L = PATH$->CV.L - ( RPAREN - LPAREN + 1);
     2236    14872    3           PATH$->CV.T = TSTRING;
     2237    14873    3           CALL INDEX( LPAREN, '(', PATH$->CV.T);
     2238    14874    3           END;
     2239    14875            /****** EXTRACT RECIPIENT NAME FROM PATH IF NO TO: FIELD ******/
     2240    14876    3       IF TO$->CV.L = 0 AND COMMENT$->CV.L = 0 THEN DO;
     2241    14877                /** STRIP OFF ANY ROUTE LIST **/
     2242    14878    3           CALL INDEX( LOC, ':', PATH$->CV.T) ALTRET( NO_ROUTE);
     2243    14879    4           DO NEVER;
     2244    14880    4   NO_ROUTE:
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:75   
     2245    14881    4               LOC = 0;
     2246    14882    4               END;
     2247    14883                /** STRIP OFF HOST NAME **/
     2248    14884    3           CALL INDEX( LOCE, '@', PATH$->CV.T, LOC) ALTRET( NO_PATH);
     2249    14885    3           CALL INDEX( TVAL, '%', PATH$->CV.T, LOC)
     2250    14886    4           WHENRETURN DO;
     2251    14887    4               IF TVAL < LOCE THEN
     2252    14888    4                   LOCE = TVAL;
     2253    14889    4               END;
     2254    14890    3           TO$->CV.L = LOCE - LOC - 1;
     2255    14891    3           TO$->CV.T = SUBSTR( PATH$->CV.T, LOC + 1);
     2256    14892    3           END;
     2257    14893            /****** EXTRACT TO-SITE FROM FORWARD PATH ******/
     2258    14894    2       CALL INDEX1R( LOC, '@', PATH$->CV.T) ALTRET( NO_PATH);
     2259    14895    2       TOSITE$->CV.L = PATH$->CV.L - LOC - 2;
     2260    14896    2       TOSITE$->CV.T = SUBSTR( PATH$->CV.T, LOC + 1);
     2261    14897    2       RETURN;
     2262    14898
     2263    14899    2       END PARSE_MAIL_HEADER;
     2264    14900        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:76   
     2265    14901    1   READ_ADDRESS_RECORDS: PROC ALTRET;
     2266    14902
     2267    14903    2       DCL I UBIN;
     2268    14904    2       DCL INDX UBIN;
     2269    14905    2       DCL LIST UBIN;
     2270    14906
     2271    14907    2       USER_COUNT = 0;
     2272    14908    2       HITS = '0'B;
     2273    14909    2       READ_FOLDER.KEY_ = VECTOR( VM_INFOKEY);
     2274    14910    2       READ_FOLDER.BUF_ = MAIL_ADDRESSES;
     2275    14911    2       READ_FOLDER.V.KEYS# = %YES#;
     2276    14912    2       READ_FOLDER.V.KEYR# = %NO#;
     2277    14913    2       LIST = %VM_TYPE_TO;
     2278    14914    2   READIT:
     2279    14915    2       VM_INFOKEY.MESSAGE_NUMBER = MSG_NUMBER;
     2280    14916    2       VM_INFOKEY.COUNT = 5;
     2281    14917    2       VM_INFOKEY.TYPE = LIST + 1;
     2282    14918    2       CALL M$READ( READ_FOLDER) ALTRET( NEXT_ADDRESS_RECORD);
     2283    14919    2       ALIAS$ = VBASE( MAIL_ADDRESSES)->VM_ADD_HEAD.HEAD$;
     2284    14920    3       DO WHILE ALIAS$ ~= ADDR( NIL);
     2285    14921    4           IF VM_UADDRESS.TYPE = %VM_ADD_UNRESOLVED THEN DO;
     2286    14922    5               IF USER_COUNT > %MAX_USERS THEN DO;
     2287    14923    5                   CMDBUF = TOERR;
     2288    14924    5                   REPLYLEN = LENGTHC( TOERR);
     2289    14925    5                   ALTRETURN;
     2290    14926    5                   END;
     2291    14927    5               DO WHILE( VM_UADDRESS.USER_NAME.COUNT > 0 AND
     2292    14928    5                       SUBSTR( VM_UADDRESS.USER_NAME.TEXT, VM_UADDRESS.USER_NAME.COUNT
             14928                                - 1, 1) = ' ');
     2293    14929    5                   VM_UADDRESS.USER_NAME.COUNT = VM_UADDRESS.USER_NAME.COUNT - 1;
     2294    14930    5                   END;
     2295    14931    4               CALL INDEX( INDX, ' ',
     2296    14932    4                       SUBSTR( VM_UADDRESS.USER_NAME.TEXT, 0, VM_UADDRESS.USER_NAME.
             14932                                COUNT))
     2297    14933    5               WHENRETURN DO;
     2298    14934    5                   CALL CONCAT( USERS.T( USER_COUNT), '"',
     2299    14935    5                           SUBSTR( VM_UADDRESS.USER_NAME.TEXT, 0, VM_UADDRESS.USER_NAME
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:77   
             14935                                    .COUNT),
     2300    14936    5                           '"@', VM_UADDRESS.SITENAME);
     2301    14937    5                   END;
     2302    14938    5               WHENALTRETURN DO;
     2303    14939    5                   CALL CONCAT( USERS.T( USER_COUNT),
     2304    14940    5                           SUBSTR( VM_UADDRESS.USER_NAME.TEXT, 0, VM_UADDRESS.USER_NAME
             14940                                    .COUNT),
     2305    14941    5                           '@', VM_UADDRESS.SITENAME);
     2306    14942    5                   END;
     2307    14943    4               I = LENGTHC( USERS.T( USER_COUNT));
     2308    14944    5               DO WHILE( I > 0 AND SUBSTR( USERS.T( USER_COUNT), I - 1, 1) = ' ');
     2309    14945    5                   I = I - 1;
     2310    14946    5                   END;
     2311    14947    4               PATH$->CV.L = I;
     2312    14948    4               PATH$->CV.T = USERS.T( USER_COUNT);
     2313    14949    4               CALL INDEX1R( INDX, '@', USERS.T( USER_COUNT));
     2314    14950    4               TOSITE$->CV.L = I - INDX - 1;
     2315    14951    4               TOSITE$->CV.T = SUBSTR( USERS.T( USER_COUNT), INDX + 1);
     2316    14952    4               USERS.L( USER_COUNT) = I;
     2317    14953    4               USERS.LIST( USER_COUNT) = LIST;
     2318    14954    4               USER_COUNT = USER_COUNT + 1;
     2319    14955    5               DO SELECT( LIST);
     2320    14956    5                   SELECT( %VM_TYPE_TO);
     2321    14957    5                       HITS.PRIMARY = %YES#;
     2322    14958    5                   SELECT( %VM_TYPE_C);
     2323    14959    5                       HITS.C = %YES#;
     2324    14960    5                   SELECT( %VM_TYPE_BC);
     2325    14961    5                       HITS.BC = %YES#;
     2326    14962    5                   END;
     2327    14963    4               END;
     2328    14964    3           ALIAS$ = VM_UADDRESS.NEXT$;
     2329    14965    3           END;
     2330    14966    2   NEXT_ADDRESS_RECORD:
     2331    14967    3       DO SELECT( LIST);
     2332    14968    3           SELECT( %VM_TYPE_TO);
     2333    14969    3               LIST = %VM_TYPE_C;
     2334    14970    3           SELECT( %VM_TYPE_C);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:78   
     2335    14971    3               LIST = %VM_TYPE_BC;
     2336    14972    3           SELECT( %VM_TYPE_BC);
     2337    14973    3               RETURN;
     2338    14974    3           END;
     2339    14975    2       GOTO READIT;
     2340    14976
     2341    14977    2       END READ_ADDRESS_RECORDS;
     2342    14978        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:79   
     2343    14979    1   COPY: PROC( SOURCE$, DEST$, DEST_LEN);
     2344    14980
     2345    14981    2       DCL DEST$ PTR;
     2346    14982    2       DCL DEST_LEN UBIN;
     2347    14983    2       DCL SOURCE$ PTR;
     2348    14984
     2349    14985    2       DEST$->CV.L = DEST_LEN;
     2350    14986    2       DEST$->CV.T = ' ';
     2351    14987
     2352    14988    2       IF SOURCE$ = ADDR( NIL) THEN
     2353    14989    2           DEST$->CV.L = 0;
     2354    14990    3       ELSE DO;
     2355    14991    3           DEST$->CV.L = MINIMUM( SOURCE$->TEXTC.L, DEST_LEN);
     2356    14992    3           DEST$->CV.T = SOURCE$->TEXTC.T;
     2357    14993    3           END;
     2358    14994    2       RETURN;
     2359    14995
     2360    14996    2       END COPY;
     2361    14997        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:80   
     2362    14998    1   MAKE_SMTP_ADDRESS: PROC( CP6$, NAME$, ADDRESS$);
     2363    14999
     2364    15000    2       DCL ADDRESS$ PTR;
     2365    15001    2       DCL BLANK_INDEX UBIN WORD;
     2366    15002    2       DCL CP6$ PTR;
     2367    15003    2       DCL NAME$ PTR;
     2368    15004    2       DCL NAME_END UBIN WORD;
     2369    15005    2       DCL SITE_INDEX UBIN WORD;
     2370    15006    2       DCL TSTRING CHAR(80);
     2371    15007    2       DCL TVAL UBIN;
     2372    15008
     2373    15009    2       CALL INDEX1R( SITE_INDEX, '@', CP6$->CV.T) ALTRET( LOCAL);
     2374    15010    2       CALL XLATE( TSTRING, TCM_XLATE_TO_UC, SUBSTR( CP6$->CV.T, SITE_INDEX));
     2375    15011    3       IF SUBSTR( TSTRING, 1, CP6$->CV.L-SITE_INDEX-1) = VM_SITE.ORIGIN THEN DO;
     2376    15012    3           CP6$->CV.L = SITE_INDEX;
     2377    15013    3           GOTO LOCAL;
     2378    15014    3           END;
     2379    15015    2       NAME$->CV.L = SITE_INDEX;
     2380    15016    2       NAME$->CV.T = SUBSTR( CP6$->CV.T, 0, SITE_INDEX);
     2381    15017    2       ADDRESS$->CV.L = CP6$->CV.L;
     2382    15018    2       ADDRESS$->CV.T = CP6$->CV.T;
     2383    15019    2       SUBSTR(ADDRESS$->CV.T,SITE_INDEX,1) = '%';
     2384    15020    2       GOTO UNDERBLANK;
     2385    15021    2   LOCAL:
     2386    15022    3       IF SUBSTR( CP6$->CV.T, 0, 1) = '.' THEN DO;
     2387    15023                /* rewrite .account or .account/folder */
     2388    15024    3           CALL INDEX( TVAL, '/', CP6$->CV.T)
     2389    15025    4           WHENRETURN DO;
     2390    15026    4               CALL CONCAT( TSTRING,
     2391    15027    4                       SUBSTR( CP6$->CV.T, TVAL, CP6$->CV.L - TVAL),
     2392    15028    4                       SUBSTR( CP6$->CV.T, 0, TVAL));
     2393    15029    4               END;
     2394    15030    4           WHENALTRETURN DO;
     2395    15031    4               CALL CONCAT( TSTRING, '/CENTRAL', CP6$->CV.T);
     2396    15032    4               CP6$->CV.L = 8 + CP6$->CV.L;
     2397    15033    4               END;
     2398    15034    3           CP6$->CV.T = SUBSTR( TSTRING, 0, CP6$->CV.L);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:81   
     2399    15035    3           END;
     2400    15036            /* undo CP-6 MAIL 'feature' of enquoted names.. */
     2401    15037    3       IF SUBSTR( CP6$->CV.T, 0, 1) = '''' THEN DO;
     2402    15038    3           CALL INDEX1R( NAME_END, '''', CP6$->CV.T);
     2403    15039                /* handle the case where there is no end quote */
     2404    15040    3           IF (NAME_END = 0) THEN NAME_END = CP6$->CV.L;
     2405    15041    3           CALL CONCAT( TSTRING, SUBSTR( CP6$->CV.T, 1, NAME_END-1));
     2406    15042    3           CP6$->CV.L = NAME_END - 1;
     2407    15043    3           CP6$->CV.T = TSTRING;
     2408    15044    3           END;
     2409    15045    2       CALL SEARCHR( NAME_END, TVAL, SKIP_BLANKS, CP6$->CV.T);
     2410    15046    2       IF CP6$->CV.L > 0 THEN
     2411    15047    2           NAME_END = NAME_END + 1;
     2412    15048    2       NAME$->CV.L = NAME_END;
     2413    15049    2       NAME$->CV.T = SUBSTR( CP6$->CV.T, 0, NAME_END);
     2414    15050    2       ADDRESS$->CV.L = NAME_END;
     2415    15051    2       ADDRESS$->CV.T = SUBSTR( CP6$->CV.T, 0, NAME_END);
     2416    15052    2   UNDERBLANK:
     2417    15053        /* Scan name;  turn blanks into underscores so that our addresses will fit
     2418    15054           in with the ARPA conventions.  Inverse mapping is performed by NETMAIL
     2419    15055           when we receive stuff from ARPA.                                     */
     2420    15056    2       CALL INDEX( BLANK_INDEX, ' ', ADDRESS$->CV.T);
     2421    15057    3       DO WHILE( BLANK_INDEX < ADDRESS$->CV.L);
     2422    15058    3           SUBSTR( ADDRESS$->CV.T, BLANK_INDEX, 1) = '_';
     2423    15059    3           CALL INDEX( BLANK_INDEX, ' ', ADDRESS$->CV.T);
     2424    15060    3           END;
     2425    15061    2       RETURN;
     2426    15062
     2427    15063    2       END MAKE_SMTP_ADDRESS;
     2428    15064        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:82   
     2429    15065    1   WRITE_MAIL_MESSAGE: PROC;
     2430    15066
     2431    15067    2       CALL GET_IOBUF_BOUND( MSGBUF, VLEN);
     2432    15068    2       WRITE_MAILMSG.BUF_.BOUND = VLEN;
     2433    15069    2       CALL M$WRITE( WRITE_MAILMSG);
     2434    15070    2       RETURN;
     2435    15071
     2436    15072    2       END WRITE_MAIL_MESSAGE;
     2437    15073        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:83   
     2438    15074    1   DELETE_MESSAGE: PROC;
     2439    15075
     2440    15076    2       CALL STATUS_UPDATE( DELETING_MESSAGE);
     2441    15077    3       IF MESSAGE_FILE THEN DO;
     2442    15078    3           CALL M$CLOSE( ZAP_FOLDER)
     2443    15079    4           WHENALTRETURN DO;
     2444    15080    4               END;
     2445    15081    3           RETURN;
     2446    15082    3           END;
     2447    15083    2       READ_FOLDER.BUF_ = VECTOR( VM_HEADER);
     2448    15084    2       READ_FOLDER.BUF_.BOUND = 4095;
     2449    15085    2       READ_FOLDER.KEY_ = VECTOR( VM_INFOKEY);
     2450    15086    2       READ_FOLDER.V.KEYS# = %YES#;
     2451    15087    2       READ_FOLDER.V.KEYR# = %NO#;
     2452    15088    2       VM_INFOKEY.COUNT = LENGTHC( VM_INFOKEY) - 1;
     2453    15089    2       VM_INFOKEY.TYPE = %VM_TYPE_HEAD;
     2454    15090    2       VM_INFOKEY.MESSAGE_NUMBER = MSG_NUMBER;
     2455    15091    2       CALL M$READ( READ_FOLDER);
     2456    15092    2       VM_HEADER.STATUS.DEL = %YES#;
     2457    15093    2       VM_HEADER.STATUS.OLD = %YES#;
     2458    15094    2       VM_HEADER.STATUS.EXAM = %YES#;
     2459    15095    2       VM_HEADER.STATUS.RR = %NO#;
     2460    15096    2       WRITE_FOLDER.BUF_ = VECTOR( VM_HEADER);
     2461    15097    2       WRITE_FOLDER.BUF_.BOUND = M$FOLDER$->F$DCB.ARS# - 1;
     2462    15098    2       WRITE_FOLDER.KEY_ = VECTOR( VM_INFOKEY);
     2463    15099    2       WRITE_FOLDER.V.ONEWKEY# = %YES#;
     2464    15100    2       CALL M$WRITE( WRITE_FOLDER);
     2465    15101    2       CALL M$DEQ( DEQ_ON_HEADER)
     2466    15102    3       WHENALTRETURN DO;
     2467    15103    3           END;
     2468    15104    2       CALL M$ENQ( ENQ_ON_PROFILE);
     2469    15105    2       READ_FOLDER.BUF_ = VECTOR( VM_PROFILE);
     2470    15106    2       READ_FOLDER.BUF_.BOUND = 4095;
     2471    15107    2       READ_FOLDER.KEY_ = VECTOR( VM_PROKEY);
     2472    15108    2       READ_FOLDER.V.KEYS# = %YES#;
     2473    15109    2       READ_FOLDER.V.KEYR# = %NO#;
     2474    15110    2       CALL M$READ( READ_FOLDER);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:84   
     2475    15111    2       VM_PROFILE.NUM_DEL_MESSAGES = VM_PROFILE.NUM_DEL_MESSAGES + 1;
     2476    15112    2       VM_PROFILE.RECS_DELETED = VM_PROFILE.RECS_DELETED + VM_HEADER.NUM_RECORDS;
     2477    15113    2       WRITE_FOLDER.BUF_ = VECTOR( VM_PROFILE);
     2478    15114    2       WRITE_FOLDER.BUF_.BOUND = DCBADDR( DCBNUM( M$FOLDER))->F$DCB.ARS# - 1;
     2479    15115    2       WRITE_FOLDER.KEY_ = VECTOR( VM_PROKEY);
     2480    15116    2       WRITE_FOLDER.V.ONEWKEY# = %YES#;
     2481    15117    2       CALL M$WRITE( WRITE_FOLDER);
     2482    15118    2       CALL M$DEQ( DEQ_ON_PROFILE);
     2483    15119    2       RETURN;
     2484    15120
     2485    15121    2       END DELETE_MESSAGE;
     2486    15122        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:85   
     2487    15123    1   POST_MESSAGE_ACKNOWLEDGEMENT: PROC( SITENAME);
     2488    15124
     2489    15125    2       DCL 1 SITENAME,
     2490    15126    2            2 COUNT UBIN BYTE CALIGNED,
     2491    15127    2            2 TEXT CHAR( SITENAME.COUNT);
     2492    15128
     2493    15129    2       IF VM_HEADER.STATUS.ERR THEN
     2494    15130    2           RETURN;
     2495    15131    2       CALL STATUS_UPDATE( ACKNOWLEDGING_MESSAGE);
     2496    15132    2       IF FROM$->CV.T = 'SCOTTY' THEN
     2497    15133    2           RETURN;
     2498    15134    2       CALL M$OPEN( OPEN_MAILMSG);
     2499    15135    2       CALL CONCAT( MSGBUF, HDRTO, REPLY_TO$->CV.T);
     2500    15136    2       CALL WRITE_MAIL_MESSAGE;
     2501    15137    3       IF TCM_STUCKEE ~= ' ' THEN DO;
     2502    15138    3           CALL CONCAT( MSGBUF, 'Reply To:', TCM_STUCKEE);
     2503    15139    3           CALL WRITE_MAIL_MESSAGE;
     2504    15140    3           END;
     2505    15141    2       CALL CONCAT( MSGBUF, 'SUBJECT:Your SMTP mailgram was accepted at ', SITENAME.
             15141                TEXT);
     2506    15142    2       CALL WRITE_MAIL_MESSAGE;
     2507    15143    3       IF VM_HEADER.STATUS.DR OR VM_HEADER.STATUS.RR THEN DO;
     2508    15144    3           CALL CONCAT( MSGBUF, 'TYPE:RR');
     2509    15145    3           CALL WRITE_MAIL_MESSAGE;
     2510    15146    3           CALL CONCAT( MSGBUF, 'REF ID:', VM_HEADER.UNIQUE_ID$->TEXTC.T);
     2511    15147    3           CALL WRITE_MAIL_MESSAGE;
     2512    15148    4           IF VM_HEADER.REFERENCE$ ~= ADDR( NIL) THEN DO;
     2513    15149    4               CALL CONCAT( MSGBUF, 'RE:', VM_HEADER.REFERENCE$->TEXTC.T);
     2514    15150    4               CALL WRITE_MAIL_MESSAGE;
     2515    15151    4               END;
     2516    15152    3           END;
     2517    15153    3       IF TO$->CV.L > 0 THEN DO;
     2518    15154    3           CALL CONCAT( MSGBUF, '>> To: ', TO$->CV.T);
     2519    15155    3           CALL WRITE_MAIL_MESSAGE;
     2520    15156    3           END;
     2521    15157    3       IF SUBJECT$->CV.L > 0 THEN DO;
     2522    15158    3           CALL CONCAT( MSGBUF, '>> Subject: ', SUBJECT$->CV.T);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:86   
     2523    15159    3           CALL WRITE_MAIL_MESSAGE;
     2524    15160    3           END;
     2525    15161    3       IF VM_HEADER.UNIQUE_ID$ ~= ADDR( NIL) THEN DO;
     2526    15162    3           CALL CONCAT( MSGBUF, '>> Message-Id: ', VM_HEADER.UNIQUE_ID$->TEXTC.T);
     2527    15163    3           CALL WRITE_MAIL_MESSAGE;
     2528    15164    3           END;
     2529    15165    3       IF VM_HEADER.STATUS.DR THEN DO;
     2530    15166    3           MSGBUF = '>> DR: Yes';
     2531    15167    3           CALL WRITE_MAIL_MESSAGE;
     2532    15168    3           END;
     2533    15169    3       IF VM_HEADER.STATUS.RR THEN DO;
     2534    15170    3           MSGBUF = '>> RR: Yes';
     2535    15171    3           CALL WRITE_MAIL_MESSAGE;
     2536    15172    3           END;
     2537    15173    2       CALL M$WRITE( WRITE_MAILMSG_BLANK);
     2538    15174    2       CALL M$TIME( GET_POSTED_TIME);
     2539    15175    2       CALL CONCAT( MSGBUF, 'Accepted ', SUBSTR( MSG_DATE, 0, 5), ' ',
     2540    15176    2               SUBSTR( MSG_TIME, 0, 5), '.');
     2541    15177    2       CALL WRITE_MAIL_MESSAGE;
     2542    15178    2   COMMON:
     2543    15179    2       CALL M$CLOSE( CLOSE_MAILMSG);
     2544    15180    2       SAVED_ACCN = B$JIT.ACCN;
     2545    15181    2       IF B$JIT.PRIV.ACTIVE.JIT THEN
     2546    15182    2           B$JIT.ACCN = TCM_ACCOUNT.ACCT#;
     2547    15183    2       CALL M$LINK( SEND_MAILMSG)
     2548    15184    3       WHENALTRETURN DO;
     2549    15185    3           END;
     2550    15186    2       IF B$JIT.PRIV.ACTIVE.JIT THEN
     2551    15187    2           B$JIT.ACCN = SAVED_ACCN;
     2552    15188    2       RETURN;
     2553    15189
     2554    15190    2   POST_MESSAGE_REJECTION: ENTRY( SITENAME);
     2555    15191
     2556    15192    2       CALL STATUS_UPDATE( REJECTING_MESSAGE);
     2557    15193    2       IF FROM$->CV.T = 'SCOTTY' OR
     2558    15194    2               SUBSTR( FROM$->CV.T, 0, 11) = 'SMTP Mailer' OR
     2559    15195    2               VM_HEADER.STATUS.ERR THEN
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:87   
     2560    15196    2           RETURN;
     2561    15197    2       CALL M$OPEN( OPEN_MAILMSG);
     2562    15198    2       CALL CONCAT( MSGBUF, HDRTO, REPLY_TO$->CV.T);
     2563    15199    2       CALL WRITE_MAIL_MESSAGE;
     2564    15200    3       IF TCM_STUCKEE ~= ' ' THEN DO;
     2565    15201    3           CALL CONCAT( MSGBUF, 'Reply To:', TCM_STUCKEE);
     2566    15202    3           CALL WRITE_MAIL_MESSAGE;
     2567    15203    3           END;
     2568    15204    2       CALL CONCAT( MSGBUF, 'SUBJECT:Your SMTP mailgram was rejected at ', SITENAME.
             15204                TEXT);
     2569    15205    2       CALL WRITE_MAIL_MESSAGE;
     2570    15206    3       IF TO$->CV.L > 0 THEN DO;
     2571    15207    3           CALL CONCAT( MSGBUF, '>> To: ', TO$->CV.T);
     2572    15208    3           CALL WRITE_MAIL_MESSAGE;
     2573    15209    3           END;
     2574    15210    3       IF PATH$->CV.L > 0 THEN DO;
     2575    15211    3           CALL CONCAT( MSGBUF, '   DerivedPath = ', PATH$->CV.T);
     2576    15212    3           CALL WRITE_MAIL_MESSAGE;
     2577    15213    3           END;
     2578    15214    3       IF SUBJECT$->CV.L > 0 THEN DO;
     2579    15215    3           CALL CONCAT( MSGBUF, '>> Subject: ', SUBJECT$->CV.T);
     2580    15216    3           CALL WRITE_MAIL_MESSAGE;
     2581    15217    3           END;
     2582    15218    2       CALL M$WRITE( WRITE_MAILMSG_BLANK);
     2583    15219    2       CALL M$TIME( GET_POSTED_TIME);
     2584    15220    2       CALL CONCAT( MSGBUF, 'Rejected ', SUBSTR( MSG_DATE, 0, 5), ' ',
     2585    15221    2               SUBSTR( MSG_TIME, 0, 5), ' for the following reason:');
     2586    15222    2       CALL WRITE_MAIL_MESSAGE;
     2587    15223    2       MSGBUF = REPLY;
     2588    15224    2       CALL WRITE_MAIL_MESSAGE;
     2589    15225    2       GOTO COMMON;
     2590    15226
     2591    15227    2       END POST_MESSAGE_ACKNOWLEDGEMENT;
     2592    15228        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:88   
     2593    15229    1   STATUS_UPDATE: PROC( MSG);
     2594    15230
     2595    15231    2       DCL 1 MSG ALIGNED,
     2596    15232    2            2 COUNT UBIN BYTE CALIGNED,
     2597    15233    2            2 TEXT CHAR( MSG.COUNT);
     2598    15234
     2599    15235    3       IF B$JIT.PRIV.ACTIVE.JIT THEN DO;
     2600    15236    3           B$JIT.CCARS = MSG.COUNT + 1 + LENGTHC( TCM_PROGNAME);
     2601    15237    3           CALL CONCAT( B$JIT.CCBUF, TCM_PROGNAME, ':', MSG.TEXT);
     2602    15238    3           END;
     2603    15239    2       RETURN;
     2604    15240
     2605    15241    2       END STATUS_UPDATE;
     2606    15242        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:89   
     2607    15243    1   WRITEDO: PROC;
     2608    15244
     2609    15245    2       DCL VLEN UBIN;
     2610    15246
     2611    15247    2       CALL GET_IOBUF_BOUND( CMDBUF, VLEN);
     2612    15248    2       IF VLEN = 0 THEN
     2613    15249    2           WRITE_DO.BUF_ = VECTOR( NIL);
     2614    15250    2       ELSE
     2615    15251    2           WRITE_DO.BUF_ = VECTOR( SUBSTR( CMDBUF, 0, VLEN));
     2616    15252    2       CALL M$WRITE( WRITE_DO);
     2617    15253    2       RETURN;
     2618    15254
     2619    15255    2       END WRITEDO;
     2620    15256        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:90   
     2621    15257    1   GET_IOBUF_BOUND: PROC( BUF, VLEN);
     2622    15258
     2623    15259    2       DCL BUF CHAR( %LINE_SIZE);
     2624    15260    2       DCL VLEN UBIN;
     2625    15261
     2626    15262    2       CALL SEARCHR( VLEN, TVAL, SKIP_BLANKS, BUF) ALTRET( BLANK_LINE);
     2627    15263    2       RETURN;
     2628    15264    2   BLANK_LINE:
     2629    15265    2       VLEN = 0;
     2630    15266    2       RETURN;
     2631    15267
     2632    15268    2       END GET_IOBUF_BOUND;
     2633    15269
     2634    15270    1       END TCM$NETSEND;
     2635    15271        %EOD;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:91   
--  Include file information  --

   TCM_SEND_E.:TCA2TOU  is referenced.
   TCM_COMMON_M.:TCA2TOU  cannot be made into a system file and is referenced.
   XUW_MACRO_C.:LIBRARY  is referenced.
   XUG_ENTRY.:LIBRARY  cannot be made into a system file and is referenced.
   XUD_UTS_M.:TOOLE05  is referenced.
   XU_MACRO_C.:LIBRARY  is referenced.
   XSL_SOCKET_M.:TCA2TOU  is referenced.
   VM_MACRO_C.:LIBRARY  is referenced.
   CP_6_SUBS.:LIBRARY  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B_ERRORS_C.:LIBRARY  is referenced.
   B$JIT.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure TCM$NETSEND.

   Procedure TCM$NETSEND requires 6034 words for executable code.
   Procedure TCM$NETSEND requires 9688 words of local(AUTO) storage.

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:92   

 Object Unit name= TCM$NETSEND                                File name= TCM$SEND1.:TCA2TOU
 UTS= NOV 16 '97 14:18:13.96 SUN                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS   1694   3236  TCM$NETSEND
    2   DCB   even  none     0      0  M$ME
    3   DCB   even  none     0      0  M$SI
    4   DCB   even  none     0      0  M$UI
    5   DCB   even  none     0      0  M$DO
    6   Data  even  none  1833   3451  TCM$NETSEND
    7   DCB   even  none     0      0  M$BOX
    8   DCB   even  none     0      0  M$CMD
    9   DCB   even  none     0      0  M$MSG
   10   DCB   even  none     0      0  M$FOLDER
   11   DCB   even  none     0      0  M$REGISTRY
   12   DCB   even  none     0      0  M$HANGUP
   13   DCB   even  none     0      0  M$QUOTES
   14   Proc  even  none  6034  13622  TCM$NETSEND
   15  RoData even  none   131    203  TCM$NETSEND

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    14      0   yes            yes      Main       0  TCM$NETSEND
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:93   

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    1      0  TCM_SOCKINIT                       6    232  TCM_ACCOUNT
    6    234  TCM_MESSACCT                       1   1262  TCM_SEND_NAME
    1   1272  TCM_SEND_ACCT                      1   1650  SCREECH3
    1   1656  SCREECH4                           1   1742  JIT_PRIV
    6   1124  TCM_SMTP_BAILOUT                   6   1126  TCM_SMTP_PROGRESS
    6   1167  TCM_DRIBBLE                        6   1170  TCM_DRIBBLE_ME
    6   1171  TCM_TESTMODE                       6   1173  TCM_PROGNAME
    6   1175  TCM_STUCKEE                        6   1205  TCM_TZTEXT
    6   1207  TCM_UTOFFSET                       6   1210  TCM_PHONE
    1   2465  TCM_XLATE_TO_UC

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 XTX$ADAPT
         yes           Std       2 TCM$WRITE_AUDIT_ON
         yes           Std       0 TCM$STOP_SMTP
         yes           Std       1 XUG$CLOSE_DCBS
 yes     yes           Std       3 XUD$UTS_DIFF_SEC
         yes           Std       2 TCM$WRITE_AUDIT_OFF
         yes           Std       2 TCM$WRITE_AUDIT_LOG
 yes     yes           Std       1 XSL$SOCKINIT
 yes     yes           Std       3 XUD$UTS_ADJUST
 yes     yes           Std       2 XUG$INIT
 yes     yes           Std       1 XUG$GETCMD
 yes     yes           Std       1 XUG$ECHOIF
 yes     yes           Std       1 XUG$ERRMSG
 yes     yes           Std       1 X$WILDCMP
         yes           Std       4 TCM$START_SMTP
 yes     yes           Std       3 TCM$READ_SMTP
         yes           Std       1 TCM$DRAIN_SMTP
 yes     yes           Std       2 TCM$WRITE_SMTP
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:94   
                       nStd      0 X66_MAUTO
                       nStd      0 X66_INDEX
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_MARET
                       nStd      0 X66_MAUNWIND

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  B$DS5$                                B$JIT$
     M$ME                                  M$SI                                  M$UI
     M$DO                                  M$BOX                                 M$CMD
     M$MSG                                 M$FOLDER                              M$REGISTRY
     M$HANGUP                              M$QUOTES                         r    TCM_CONFIG_CMD
     TCM_LOGON                             B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID                                 ROSID
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:95   


        1        1        /*M*    TCM$SEND1   SMTP Mail Sender, part 1                        */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        TCM$NETSEND: PROC MAIN;

      8 14 000000   000000 700200 xent  TCM$NETSEND  TSX0  ! X66_MAUTO
        14 000001   022730 000000                    ZERO    9688,0

        9        9        %INCLUDE B$JIT;
       10      299        %INCLUDE B_ERRORS_C;
       11     1426        %INCLUDE CP_6;
       12     1507        %INCLUDE CP_6_SUBS;
       13     2047        %INCLUDE VM_MACRO_C;
       14     3315        %INCLUDE XSL_SOCKET_M;
       15     4076            %XSL_SOCKINIT( FPTN=TCM_SOCKINIT, MAXSOCK=1, BUFSIZE=4096, STCLASS=
              4076                "CONSTANT SYMDEF");
       16     4199        %INCLUDE XU_MACRO_C;
       17     7305        %INCLUDE XUD_UTS_M;
       18     7387            %XUD$UTS_ENTRIES;
       19     7419            %XUD_UTS_EQU;
       20     7430        %INCLUDE XUG_ENTRY;
       21     7461        %INCLUDE XUW_MACRO_C;
       22     7596
       23     7597            %F$DCB;
       24     7654            %B$TCB;
       25     7657            %B$ALT;
       26     7665
       27     7666    1       DCL B$DS3$ PTR SYMREF;
       28     7667    1       DCL B$DS5$ PTR SYMREF;
       29     7668    1       DCL B$TCB$ PTR SYMREF;
       30     7669    1       DCL B$JIT$ PTR SYMREF;
       31     7670
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:96   
       32     7671    1       DCL XSL$SOCKINIT ENTRY(1) ALTRET;
       33     7672    1       DCL XUR$ERRMSG ENTRY(7) ALTRET;
       34     7673    1       DCL X$WILDCMP ENTRY(1) ALTRET;
       35     7674
       36     7675    1       DCL M$ME DCB;
       37     7676    1       DCL M$SI DCB;
       38     7677    1       DCL M$UI DCB;
       39     7678    1       DCL M$DO DCB;
       40     7679
       41     7680        /****** MONITOR SERVICE PARAMETERS ******/
       42     7681
       43     7682            %FPT_CLOSE( FPTN=CLOSE_SI, STCLASS=CONSTANT, DCB=M$SI, DISP=SAVE);
       44     7724            %FPT_WRITE( FPTN=WRITE_DO, DCB=M$DO);
       45     7755            %FPT_OPEN( FPTN=OPEN_UI, STCLASS=CONSTANT, DCB=M$UI);
       46     7864            %FPT_READ( FPTN=READ_UI, STCLASS=CONSTANT, DCB=M$UI, BUF=QUOTE_BUF);
       47     7903            %FPT_CLOSE( FPTN=CLOSE_UI, STCLASS=CONSTANT, DCB=M$UI, DISP=SAVE);
       48     7945            %FPT_OPEN( FPTN=OPEN_FOLDER, DCB=M$FOLDER, SCRUB=YES, ASN=FILE,
       49     7946                       FUN=UPDATE, SHARE=ALL, NAME=MAIL_CENTRAL, ACCT=TCM_ACCOUNT,
       50     7947                       STCLASS=CONSTANT);
       51     8056            %FPT_OPEN( FPTN=OPEN_MESSAGE, DCB=M$FOLDER, ASN=FILE,
       52     8057                       FUN=UPDATE, SHARE=NONE, ACCT=TCM_MESSACCT);
       53     8166            %FPT_OPEN( FPTN=OPEN_REGISTRY, STCLASS=CONSTANT, DCB=M$REGISTRY, ASN=FILE,
       54     8167                       FUN=IN, SHARE=ALL, NAME=MAIL_REGISTRY, ACCT=TCM_ACCOUNT);
       55     8276            %FPT_PRECORD( FPTN=POSITION_FOLDER, DCB=M$FOLDER);
       56     8297            %FPT_READ( FPTN=READ_FOLDER, DCB=M$FOLDER);
       57     8336            %FPT_READ( FPTN=READ_REGISTRY, DCB=M$REGISTRY);
       58     8375            %FPT_DELREC( FPTN=DELETE_FOLDER, DCB=M$FOLDER);
       59     8394            %FPT_WRITE( FPTN=WRITE_FOLDER, DCB=M$FOLDER);
       60     8425            %FPT_CLOSE( FPTN=CLOSE_FOLDER, DCB=M$FOLDER, DISP=SAVE, STCLASS=CONSTANT);
       61     8467            %FPT_CLOSE( FPTN=ZAP_FOLDER, DCB=M$FOLDER, DISP=RELEASE, STCLASS=CONSTANT);
       62     8509            %FPT_CLOSE( FPTN=CLOSE_REGISTRY, DCB=M$REGISTRY, DISP=SAVE, STCLASS=CONSTANT);
       63     8551            %FPT_ENQ( FPTN=ENQ_ON_PROFILE, STCLASS=CONSTANT, DCB=M$FOLDER,
       64     8552                      RNAME=VM_PRORES, SHARE=NONE);
       65     8570            %FPT_DEQ( FPTN=DEQ_ON_PROFILE, STCLASS=CONSTANT, DCB=M$FOLDER,
       66     8571                      RNAME=VM_PRORES);
       67     8588            %FPT_ENQ( FPTN=ENQ_ON_FILE, STCLASS=CONSTANT, DCB=M$FOLDER,
       68     8589                      RNAME=VM_FILERES, SHARE=NONE, WAIT_TIME=0);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:97   
       69     8607            %FPT_DEQ( FPTN=DEQ_ON_FILE, STCLASS=CONSTANT, DCB=M$FOLDER,
       70     8608                      RNAME=VM_FILERES);
       71     8625            %FPT_ENQ( FPTN=ENQ_ON_HEADER, STCLASS=CONSTANT, DCB=M$FOLDER,
       72     8626                      RNAME=VM_HEADRES, SHARE=NONE, WAIT_TIME=0);
       73     8644            %FPT_DEQ( FPTN=DEQ_ON_HEADER, STCLASS=CONSTANT, DCB=M$FOLDER,
       74     8645                      RNAME=VM_HEADRES);
       75     8662            %FPT_OPEN( FPTN=OPEN_MAILMSG, STCLASS=CONSTANT, DCB=M$MSG, ASN=FILE,
       76     8663                       FUN=CREATE, EXIST=NEWFILE, CTG=YES, NAME=MAILMSG_NAME);
       77     8772            %FPT_WRITE( FPTN=WRITE_MAILMSG, DCB=M$MSG, BUF=MSGBUF);
       78     8803            %FPT_WRITE( FPTN=WRITE_MAILMSG_BLANK, STCLASS=CONSTANT,
       79     8804                    DCB=M$MSG, BUF=BLANK_LINE);
       80     8835            %FPT_CLOSE( FPTN=CLOSE_MAILMSG, DCB=M$MSG, STCLASS=CONSTANT);
       81     8877            %FPT_OPEN( FPTN=OPEN_HANGUP, STCLASS=CONSTANT, DCB=M$HANGUP, ASN=FILE,
       82     8878                       NAME=HANGUP_FILE, ACCT=TCM_ACCOUNT, FUN=UPDATE);
       83     8987            %FPT_CLOSE( FPTN=CLOSE_HANGUP, STCLASS=CONSTANT, DCB=M$HANGUP,
       84     8988                        DISP=RELEASE);
       85     9030            %FPT_OPEN( FPTN=OPEN_QUOTES, STCLASS=CONSTANT, DCB=M$QUOTES, ASN=FILE,
       86     9031                       FUN=CREATE, DISP=SCRATCH, ORG=KEYED, ACS=DIRECT);
       87     9140            %FPT_READ( FPTN=READ_QUOTES, STCLASS=CONSTANT, DCB=M$QUOTES,
       88     9141                       BUF=QUOTE_BUF, KEY=QUOTE_KEY, KEYS=YES);
       89     9180            %FPT_WRITE( FPTN=WRITE_QUOTES, STCLASS=STATIC, DCB=M$QUOTES,
       90     9181                        BUF=QUOTE_BUF, KEY=QUOTE_KEY);
       91     9212            %VLP_NAME( FPTN=HANGUP_FILE, STCLASS=CONSTANT, NAME='$$HANGUP');
       92     9239            %VLP_NAME( FPTN=MAILMSG_NAME, STCLASS=CONSTANT, NAME='*MAILMSG');
       93     9266            %VLP_NAME( FPTN=MAIL_CENTRAL, STCLASS=CONSTANT, NAME=':MAIL_CENTRAL');
       94     9293            %VLP_NAME( FPTN=MESS, STCLASS=CONSTANT, NAME=':MESS');
       95     9320            %VLP_NAME( FPTN=MAIL_REGISTRY, STCLASS=CONSTANT, NAME=':MAIL_REGISTRY');
       96     9347            %VLP_ACCT( FPTN=TCM_ACCOUNT, STCLASS="STATIC SYMDEF", ACCT=':SMTP');
       97     9360            %VLP_ACCT( FPTN=TCM_MESSACCT, STCLASS="STATIC SYMDEF", ACCT=':SMTP');
       98     9373            %FPT_LINK( FPTN=SEND_MAILMSG, STCLASS=CONSTANT,
       99     9374                       NAME=TCM_SEND_NAME, ACCT=TCM_SEND_ACCT, CMD=SEND_CMD);
      100     9392            %VLP_NAME( FPTN=TCM_SEND_NAME, STCLASS=CONSTANT SYMDEF, LEN=31, NAME='SEND');
      101     9419            %VLP_ACCT( FPTN=TCM_SEND_ACCT, STCLASS=CONSTANT SYMDEF, ACCT=':SYS');
      102     9432            %VLP_NAME( FPTN=SEND_CMD, STCLASS=CONSTANT,
      103     9433                       NAME="'SEND *MAILMSG (GATEWAY,MAIL=SMTP Mailer)'");
      104     9460            %FPT_READ( FPTN=READ_UC, DCB=M$UC, BUF=CMDBUF, STCLASS=CONSTANT);
      105     9499            %FPT_WRITE( FPTN=WRITE_ME, DCB=M$ME, BUF=CMDBUF);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:98   
      106     9530            %FPT_WRITE( FPTN=WRITE_ME_NULL, DCB=M$ME, STCLASS=CONSTANT);
      107     9561            %FPT_WRITE( FPTN=WRITE_ME_BLANK, DCB=M$ME, BUF=BLANK_LINE, STCLASS=CONSTANT);
      108     9592            %FPT_OPEN( FPTN=DRIBBLE_FILE, STCLASS=CONSTANT, DCB=M$ME,
      109     9593                       FUN=CREATE, EXIST=OLDFILE, ASN=FILE, CTG=YES,
      110     9594                       ORG=CONSEC, DISP=NAMED, NAME=DRIBBLE_NAME, ACCT=TCM_MESSACCT);
      111     9703            %VLP_NAME( FPTN=DRIBBLE_NAME, NAME=':DRIBSENT', STCLASS=CONSTANT);
      112     9730            %FPT_OPEN( FPTN=DRIBBLE_NO, DCB=M$ME, ASN=DEVICE, RES='NO', STCLASS=CONSTANT);
      113     9839            %FPT_TIME( FPTN=GET_SMTP_DATE, STCLASS=CONSTANT, SOURCE=UTS, DEST=EXT,
      114     9840                       DATE=DATEWORK, TSTAMP=MSG_TSTAMP, DAY=DAYBUF, TIME=TIMEBUF);
      115     9859            %FPT_TIME( FPTN=GET_TIME_NOW, SOURCE=CLOCK, DEST=EXT,
      116     9860                       DATE=DATEWORK, DAY=DAYBUF, TIME=TIMEBUF, STCLASS=CONSTANT);
      117     9879            %FPT_TIME( FPTN=GET_UTS_NOW, SOURCE=CLOCK, DEST=UTS,
      118     9880                    TSTAMP=TIME_NOW, STCLASS=CONSTANT);
      119     9899            %FPT_TIME( FPTN=GET_POSTED_TIME, STCLASS=CONSTANT,
      120     9900                       SOURCE=CLOCK, DEST=LOCAL, DATE=MSG_DATE, TIME=MSG_TIME);
      121     9919            %FPT_TIME( FPTN=GET_WAKEUP_TIME, STCLASS=CONSTANT,
      122     9920                       SOURCE=UTS, DEST=EXT, TSTAMP=TIME_NOW, TIME=TIMEBUF2);
      123     9939            %FPT_WAIT( FPTN=WAIT_A_SECOND, UNITS=1, STCLASS=CONSTANT);
      124     9953            %FPT_WAIT( FPTN=WAIT_A_WHILE);
      125     9967            %FPT_SCREECH( FPTN=SCREECH3, SCODE=SUA3, STCLASS="CONSTANT SYMDEF");
      126     9981            %FPT_SCREECH( FPTN=SCREECH4, SCODE=SUA4, STCLASS="CONSTANT SYMDEF");
      127     9995            %VLP_SUA( FPTN=SUA3, SEV=5, LDCTS=YES, CWSPT=YES,
      128     9996                    FCG='TC', MID='M', CODE=3333, STCLASS=CONSTANT);
      129    10066            %VLP_SUA( FPTN=SUA4, SEV=5, LDCTS=YES, CWSPT=YES,
      130    10067                    FCG='TC', MID='M', CODE=4444, STCLASS=CONSTANT);
      131    10137            %FPT_GDS( FPTN=GET_BUFFERS, STCLASS=CONSTANT,
      132    10138                      SEGSIZE=4096, RESULTS=MAIL_BUFFERS);
      133    10154            %FPT_FDS( FPTN=RELEASE_BUFFERS, STCLASS=CONSTANT,
      134    10155                      SEGSIZE=4096, RESULTS=MAIL_BUFFERS);
      135    10170            %FPT_GDS( FPTN=GET_ADDRESSES, STCLASS=CONSTANT,
      136    10171                      SEGSIZE=4096, RESULTS=MAIL_ADDRESSES);
      137    10187            %FPT_FDS( FPTN=RELEASE_ADDRESSES, STCLASS=CONSTANT,
      138    10188                      SEGSIZE=4096, RESULTS=MAIL_ADDRESSES);
      139    10203            %FPT_RESCTL( FPTN=RELEASE_PACKS, RPSN=PSN, STCLASS=CONSTANT);
      140    10220            %VLP_RPSN( FPTN=PSN, DISP=REM, N=50);
      141    10235            %FPT_PRIV( FPTN=JIT_PRIV, STCLASS="CONSTANT SYMDEF", PRIV=%PR_JIT#);
      142    10250            %FPT_ERRMSG( FPTN=GET_MAIL_ERROR_CODE, STCLASS=STATIC,
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:99   
      143    10251                         BUF=MAIL_ERROR_CODE, FILENAME=VMERRMSG, FILEACCT=COLON_SYS,
      144    10252                         RESULTS=VLR_ERRMSG);
      145    10279            %VLP_NAME( FPTN=VMERRMSG, STCLASS=CONSTANT, NAME=':VMERRMSG');
      146    10306            %VLP_ACCT( FPTN=COLON_SYS, ACCT=':SYS', STCLASS=CONSTANT);
      147    10319            %VLR_ERRMSG;
      148    10341            %FPT_ALIB( LIBNAME=DELTA_NAME, RETRN=NO, STCLASS=CONSTANT);
      149    10358            %VLP_NAME( FPTN=DELTA_NAME, NAME='DELTA', STCLASS=CONSTANT);
      150    10385            %FPT_READ (FPTN=READ_SITE,KEY=VM_SITEKEY,KEYS=YES);
      151    10424
      152    10425        /* Status messages */
      153    10426        %MACRO MESSAGE( NAM=DUMMY, STC=CONSTANT, MSG="''");
      154    10427            %VLP_NAME( FPTN=NAM, STCLASS=STC, NAME=MSG);
      155    10428        %MEND;
      156    10429            %MESSAGE( NAM=IDLE, STC=STATIC, MSG="'Idle until HH:MM:SS'");
      157    10458            %MESSAGE( NAM=SEARCHING, MSG="'Searching for mail'");
      158    10487            %MESSAGE( NAM=CONNECTING, MSG="'Calling remote host'");
      159    10516            %MESSAGE( NAM=WAITING_FOR_SMTP_GREETING, MSG="'Looking for SMTP salutation'");
      160    10545            %MESSAGE( NAM=LOGGING_ON_TO_SMTP, MSG="'Establishing SMTP dialog'");
      161    10574            %MESSAGE( NAM=DECODING_HEADER, MSG="'Decoding CP-6 header'");
      162    10603            %MESSAGE( NAM=SENDING_ADDRESSES, MSG="'Sending addresses'");
      163    10632            %MESSAGE( NAM=SENDING_HEADER, MSG="'Sending message header'");
      164    10661            %MESSAGE( NAM=SENDING_MESSAGE_BODY, STC=STATIC,
      165    10662                      MSG="'Sending body line MMMM of NNNN'");
      166    10691            %MESSAGE( NAM=DRAINING_COMGROUP, STC=STATIC,
      167    10692                      MSG="'Draining; NNNN records remain'");
      168    10721            %MESSAGE( NAM=AWAITING_FINAL_ACK, MSG="'Awaiting acknowledgement'");
      169    10750            %MESSAGE( NAM=DELETING_MESSAGE, MSG="'Deleting message'");
      170    10779            %MESSAGE( NAM=REJECTING_MESSAGE, MSG=
             10779                "'Informing sender that message was rejected'");
      171    10808            %MESSAGE( NAM=ACKNOWLEDGING_MESSAGE, MSG=
             10808                "'Acknowledging that message has been forwarded'");
      172    10837            %MESSAGE( NAM=LOGGING_OFF_OF_SMTP, MSG="'Disconnecting from SMTP'");
      173    10866
      174    10867        %MACRO LOG( NAME=NAME, STATUS='?');
      175    10868            DCL 1 NAME CONSTANT,
      176    10869                 2 * SBIN WORD INIT( -1),
      177    10870                 2 TEXT CHAR(7) INIT( STATUS);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:100  
      178    10871        %MEND;
      179    10872            %LOG( NAME=NO_MODEM, STATUS='NoComm');
      180    10877            %LOG( NAME=NO_HOST, STATUS='NoHost');
      181    10882            %LOG( NAME=NO_SMTP, STATUS='NoSMTP');
      182    10887
      183    10888        /**** GETCMD definitions ****/
      184    10889            %XUG_INIT( COMMANDS=NO, GOODCMD=YES);
      185    11302            %XUG_GETCMD( INDCB=M$SI, OUTDCB=M$DO, NODES=TCM_CONFIG_CMD,
      186    11303                         PROMPT=PROMPTSTRING);
      187    11641            %PARSE$OUT( STCLASS="BASED( OUT$)");
      188    11686            %PARSE$SYM( STCLASS="BASED( OUT$)");
      189    11724            %P_PCB( NAME=P$PCB, STCLASS="BASED( XUG_GETCMD.PCB$)");
      190    11923            %XUW_WILDCARD;
      191    12019
      192    12020        /* mailbox definitions */
      193    12021            %VM_KEYTYPES;
      194    12042            %VM_ADDTYPES;
      195    12046            %VM_BODYTYPES;
      196    12052            %VM_PROFILE( STCLASS="BASED( PROFILE$)");
      197    12139            %VM_PROKEY( STCLASS=CONSTANT);
      198    12154            %VM_HEADER( STCLASS="BASED( HEADER$)");
      199    12283            %VM_INFOKEY;
      200    12300            %VM_ADD_HEAD( STCLASS="BASED( ADDRESS$)");
      201    12329            %VM_UADDRESS( STCLASS="BASED( ALIAS$)");
      202    12366            %VM_LISTKEY;
      203    12382            %VM_BODYREC( STCLASS="BASED( BODY$)");
      204    12414            %VM_BODYKEY;
      205    12434            %VM_PRORES( STCLASS=CONSTANT);
      206    12448            %VM_PRORES( NAME=VM_FILERES, STCLASS=CONSTANT, RES='FILE');
      207    12462            %VM_HEADRES;
      208    12476            %VM_SITE (NAME=VM_SITE,STCLASS=" ");
      209    12500            %VM_SITEKEY (NAME=VM_SITEKEY,STCLASS=CONSTANT);
      210    12515        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:101  
      211    12516        /****** COMMON DEFINITIONS ******/
      212    12517
      213    12518        %INCLUDE TCM_COMMON_M;
      214    12549        %INCLUDE TCM_SEND_E;
      215    12655
      216    12656    1       DCL M$BOX DCB;
      217    12657    1       DCL M$CMD DCB;
      218    12658    1       DCL M$MSG DCB;
      219    12659    1       DCL M$FOLDER DCB;
      220    12660    1       DCL M$REGISTRY DCB;
      221    12661    1       DCL M$HANGUP DCB;
      222    12662    1       DCL M$QUOTES DCB;
      223    12663
      224    12664    1       DCL M$BOX$ PTR;
      225    12665    1       DCL M$CMD$ PTR;
      226    12666    1       DCL M$MSG$ PTR;
      227    12667    1       DCL M$REGISTRY$ PTR;
      228    12668    1       DCL M$FOLDER$ PTR;
      229    12669    1       DCL M$QUOTES$ PTR;
      230    12670    1       DCL M$SI$ PTR;
      231    12671
      232    12672    1       DCL TCM$START_SMTP ENTRY(4);
      233    12673    1       DCL TCM$READ_SMTP ENTRY(3) ALTRET;
      234    12674    1       DCL TCM$READ_SMTP_NULLOK ENTRY(3) ALTRET;
      235    12675    1       DCL TCM$WRITE_SMTP ENTRY(2) ALTRET;
      236    12676    1       DCL TCM$DRAIN_SMTP ENTRY(1);
      237    12677    1       DCL TCM$STOP_SMTP ENTRY;
      238    12678    1       DCL TCM$WRITE_AUDIT_LOG ENTRY(2);
      239    12679    1       DCL TCM$WRITE_AUDIT_ON ENTRY(2);
      240    12680    1       DCL TCM$WRITE_AUDIT_OFF ENTRY(2);
      241    12681
      242    12682    1       DCL TCM_SMTP_BAILOUT REMEMBER STATIC SYMDEF;
      243    12683    1       DCL TCM_SMTP_PROGRESS UBIN WORD STATIC SYMDEF;
      244    12684
      245    12685    1       DCL 1 NODENAME STATIC,
      246    12686    1            2 COUNT UBIN BYTE CALIGNED INIT(3),
      247    12687    1            2 TEXT CHAR(63) INIT( 'CP6');
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:102  
      248    12688    1       DCL 1 SITE_NAME STATIC,
      249    12689    1            2 COUNT UBIN BYTE CALIGNED INIT(3),
      250    12690    1            2 TEXT CHAR(63) INIT( 'CP6');
      251    12691
      252    12692    1       DCL PROMPTSTRING CHAR(0) CONSTANT INIT( '{} ');
      253    12693    1       DCL TCM_CONFIG_CMD UBIN WORD SYMREF READONLY;
      254    12694
      255    12695    1       DCL TCM_DRIBBLE BIT(36) STATIC SYMDEF INIT( %NO#);
      256    12696    1       DCL TCM_DRIBBLE_ME BIT(36) STATIC SYMDEF INIT( %NO#);
      257    12697    1       DCL TCM_TESTMODE BIT(1) STATIC SYMDEF INIT( %FALSE);
      258    12698    1       DCL FLOW_CONTROL_ENABLED BIT(1) ALIGNED;
      259    12699    1       DCL MSG_COUNT UBIN;
      260    12700    1       DCL VFC CHAR(1) STATIC INIT( ' ');
      261    12701
      262    12702    1       DCL VLEN UBIN;
      263    12703    1       DCL LOC  UBIN;
      264    12704    1       DCL LOCE UBIN;
      265    12705    1       DCL TVAL UBIN;
      266    12706    1       DCL FILL$ PTR;
      267    12707    1       DCL OUT$ PTR;
      268    12708    1       DCL TCM_PROGNAME CHAR(7) STATIC SYMDEF;
      269    12709    1       DCL TCM_STUCKEE CHAR(32) STATIC SYMDEF INIT( ' ');
      270    12710    1       DCL TCM_TZTEXT CHAR(6) STATIC SYMDEF INIT( ' PST  ');
      271    12711    1       DCL TCM_UTOFFSET SBIN STATIC SYMDEF INIT( %( -8 * %UTS_CSEC_HOUR#));
      272    12712    1       DCL TCM_LOGON CHAR(32) SYMREF;
      273    12713    1       DCL TCM_PHONE(0:3) CHAR(11) STATIC SYMDEF;
      274    12714    1       DCL CMN2UTS(0:9) SBIN CONSTANT INIT(
      275    12715    1           0, 0, -5, -4, -6, -5, -7, -6, -8, -7);
      276    12716    1       DCL TCP_FLAVOR BIT(1) STATIC;
      277    12717    1       DCL TERMINATING BIT(1);
      278    12718    1       DCL MAIL_BUFFERS VECTOR STATIC;
      279    12719    1       DCL MAIL_ADDRESSES VECTOR STATIC;
      280    12720    1       DCL TIME_NOW UBIN STATIC;
      281    12721    1       DCL TIME_THEN UBIN;
      282    12722    1       DCL UTS_DIFF SBIN;
      283    12723    1       DCL HEADER_ARS SBIN;
      284    12724    1       DCL SITENAME CHAR(31);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:103  
      285    12725    1       DCL SITES SBIN WORD;
      286    12726    1       DCL CURR_SITE SBIN WORD;
      287    12727    1       DCL THIS_SITE SBIN WORD;
      288    12728    1       DCL NODES SBIN WORD;
      289    12729    1       DCL THIS_NODE SBIN WORD;
      290    12730    1       DCL SAVED_ACCN CHAR(8);
      291    12731    1       DCL SAVED_UNAME CHAR(12);
      292    12732    1       DCL QUOTE_COUNT UBIN;
      293    12733    1       DCL MESSAGE_FILE BIT(1);
      294    12734    1       DCL USER_COUNT UBIN;
      295    12735    1       DCL TOTAL_READY UBIN;
      296    12736    1       DCL IS_OR_VIA UBIN;
      297    12737    1       DCL 1 HITS,
      298    12738    1            2 PRIMARY BIT(1),
      299    12739    1            2 C BIT(1),
      300    12740    1            2 BC BIT(1);
      301    12741
      302    12742    1       DCL 1 SITE(0:%MAX_SMTP_SITE),
      303    12743    1            2 NAME,
      304    12744    1             3 COUNT UBIN BYTE CALIGNED,
      305    12745    1             3 TEXT CHAR(31),
      306    12746    1            2 LOGON CHAR(32),
      307    12747    1            2 ADDRESS CHAR(32),
      308    12748    1            2 IDENT,
      309    12749    1             3 COUNT UBIN BYTE CALIGNED,
      310    12750    1             3 TEXT CHAR(31),
      311    12751    1            2 OWN_REVERSE_PATH,
      312    12752    1             3 COUNT UBIN BYTE CALIGNED,
      313    12753    1             3 TEXT CHAR(31),
      314    12754    1            2 INDIRECT_REVERSE_PATH,
      315    12755    1             3 COUNT UBIN BYTE CALIGNED,
      316    12756    1             3 TEXT CHAR(31),
      317    12757    1            2 TYPE UBIN WORD,
      318    12758    1            2 PENDING SBIN WORD,
      319    12759    1            2 TRY_INTERVAL UBIN WORD,
      320    12760    1            2 RETRY_INTERVAL UBIN WORD,
      321    12761    1            2 FROM_TIME UBIN WORD,
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:104  
      322    12762    1            2 TO_TIME UBIN WORD,
      323    12763    1            2 LAST_TRY UBIN WORD,
      324    12764    1            2 NEXT_TRY UBIN WORD,
      325    12765    1            2 LAST_STATUS UBIN,
      326    12766    1            2 RR_ACTION UBIN(2) UNAL,
      327    12767    1            2 DR_ACTION UBIN(2) UNAL;
      328    12768
      329    12769    1       DCL 1 NODE(0:%MAX_SMTP_NODE),
      330    12770    1            2 NAME CHAR(32),
      331    12771    1            2 SITE SBIN,
      332    12772    1            2 REVERSE_PATH,
      333    12773    1             3 COUNT UBIN BYTE CALIGNED,
      334    12774    1             3 TEXT CHAR(31),
      335    12775    1            2 FLAGS,
      336    12776    1             3 QUOTES BIT(1),
      337    12777    1            2 IS_OR_VIA UBIN;
      338    12778
      339    12779    1       DCL 1 USERS(0:%MAX_USERS),
      340    12780    1            2 LIST UBIN,
      341    12781    1            2 L UBIN,
      342    12782    1            2 T CHAR(%PATH_SIZE);
      343    12783
      344    12784    1       DCL 1 REWRITE(0:%MAX_REWRITES),
      345    12785    1            2 TYP SBIN,
      346    12786    1            2 * SBIN,
      347    12787    1            2 OLD,
      348    12788    1             3 LEN UBIN BYTE CALIGNED,
      349    12789    1             3 TXT CHAR(31) CALIGNED,
      350    12790    1            2 NEW,
      351    12791    1             3 LEN UBIN BYTE CALIGNED,
      352    12792    1             3 TXT CHAR(31) CALIGNED;
      353    12793    1       DCL REWRITES SBIN;
      354    12794
      355    12795    1       DCL SKIP_BLANKS(0:127) CONSTANT UBIN(9) CALIGNED INIT(
      356    12796                /** blank=0  alphanumeric=1  special=2  control=3 **/
      357    12797    1           3*32,0,1*15,2*10,1*7,2*26,1*6,2*26,1*4,3);
      358    12798
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:105  
      359    12799            /****** I/O BUFFERS ******/
      360    12800    1       DCL LINEBUF CHAR( %LINE_SIZE) STATIC INIT( ' ');
      361    12801    1       DCL LINELEN UBIN STATIC INIT( 1);
      362    12802    1       DCL LINE$ PTR CONSTANT INIT( ADDR( LINEBUF));
      363    12803    1       DCL LINE BASED( LINE$) CHAR( LINELEN);
      364    12804
      365    12805    1       DCL MAIL_ERROR_CODE(0:9) CHAR(120) STATIC;
      366    12806    1       DCL QUOTE_BUF CHAR( %LINE_SIZE) STATIC;
      367    12807    1       DCL 1 QUOTE_KEY STATIC,
      368    12808    1            2 L UBIN BYTE CALIGNED,
      369    12809    1            2 K UBIN(27) CALIGNED;
      370    12810
      371    12811    1       DCL CMDBUF CHAR( %LINE_SIZE) STATIC INIT( ' ');
      372    12812    1       DCL CMDBUF_ VECTOR CONSTANT INIT( VECTOR( CMDBUF));
      373    12813
      374    12814    1       DCL REPLY$ PTR CONSTANT INIT( ADDR( CMDBUF));
      375    12815    1       DCL REPLYLEN UBIN STATIC INIT( 1);
      376    12816    1       DCL REPLY BASED( REPLY$) CHAR( REPLYLEN);
      377    12817
      378    12818    1       DCL MSGBUF CHAR( %LINE_SIZE) STATIC INIT( ' ');
      379    12819    1       DCL MSGBUF_ VECTOR CONSTANT INIT( VECTOR( MSGBUF));
      380    12820
      381    12821    1       DCL PATHERR CONSTANT CHAR(0) INIT(
      382    12822    1           'SMTP path address not found in message header or user registry.');
      383    12823    1       DCL MULTIPLEADDRESSERR CONSTANT CHAR(0) INIT(
      384    12824    1           'Addressee is registered as a list with more than one address.');
      385    12825    1       DCL NOTMULTICSADDRESSERR CONSTANT CHAR(0) INIT(
      386    12826    1           'Addressee is registered as something other than an ARPA address');
      387    12827    1       DCL COPYERR CONSTANT CHAR(0) INIT(
      388    12828    1           'Copy list contains non-local user alias');
      389    12829    1       DCL ADDRERR CONSTANT CHAR(0) INIT(
      390    12830    1           'SMTP path address found in both To: and Subject: of message header');
      391    12831    1       DCL TOERR CONSTANT CHAR(0) INIT(
      392    12832    1           'MAILGRAM contains too many (more than 100) internet addressees');
      393    12833
      394    12834    1       DCL BLANK_LINE CONSTANT CHAR(1) INIT( ' ');
      395    12835    1       DCL BLANK_COUNT UBIN STATIC INIT( 0);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:106  
      396    12836
      397    12837    1       DCL TEMPBUF CHAR(4) STATIC INIT( ' ');
      398    12838    1       DCL TEMPBUF_ VECTOR CONSTANT INIT( VECTOR( TEMPBUF));
      399    12839
      400    12840            /****** MESSAGE HEADER KEYWORDS ******/
      401    12841    1       DCL HDRDATE CONSTANT CHAR(0) INIT( 'Sent: ');
      402    12842    1       DCL HDRNUMBER CONSTANT CHAR(0) INIT( 'Number: ');
      403    12843    1       DCL HDRTO CONSTANT CHAR(0) INIT( 'To: ');
      404    12844    1       DCL HDRFROM CONSTANT CHAR(0) INIT( 'From: ');
      405    12845    1       DCL HDRSUBJ CONSTANT CHAR(0) INIT( 'Subject: ');
      406    12846    1       DCL HDRADDR CONSTANT CHAR(0) INIT( 'Address: ');
      407    12847    1       DCL HDRRE CONSTANT CHAR(0) INIT( 'Re: ');
      408    12848    1       DCL HDRC CONSTANT CHAR(0) INIT( 'C: ');
      409    12849    1       DCL HDRBC CONSTANT CHAR(0) INIT( 'Bc: ');
      410    12850
      411    12851    1       DCL MSGDATE CONSTANT CHAR(0) INIT( 'Date: ');
      412    12852    1       DCL MSGTO CONSTANT CHAR(0) INIT( 'To: ');
      413    12853    1       DCL MSGREALLY_TO CONSTANT CHAR(0) INIT( 'Really-to: ');
      414    12854    1       DCL MSGCC CONSTANT CHAR(0) INIT( 'cc: ');
      415    12855    1       DCL MSGREAL_CC CONSTANT CHAR(0) INIT( 'Real-cc: ');
      416    12856    1       DCL MSGBCC CONSTANT CHAR(0) INIT( 'bcc: ');
      417    12857    1       DCL MSGREAL_BCC CONSTANT CHAR(0) INIT( 'Real-bcc: ');
      418    12858    1       DCL MSGFROM CONSTANT CHAR(0) INIT( 'From: ');
      419    12859    1       DCL MSGREPLY CONSTANT CHAR(0) INIT( 'Reply-to: ');
      420    12860    1       DCL MSGSUBJ CONSTANT CHAR(0) INIT( 'Subject: ');
      421    12861    1       DCL MSGRE CONSTANT CHAR(0) INIT( 'References: ');
      422    12862    1       DCL MSGQUOTE CONSTANT CHAR(0) INIT( 'Randomness: ');
      423    12863    1       DCL MSGID CONSTANT CHAR(0) INIT( 'Message-ID: ');
      424    12864    1       DCL MSGREFID CONSTANT CHAR(0) INIT( 'In-Reply-To: ');
      425    12865    1       DCL MSGACKTO CONSTANT CHAR(0) INIT( 'Acknowledge-To: ');
      426    12866    1       DCL MSGRRTO CONSTANT CHAR(0) INIT( 'Return-Receipt-To: ');
      427    12867
      428    12868            /****** MESSAGE HEADER FIELDS ******/
      429    12869        %MACRO HEADER( NAM=DUMMY, SIZ=80, LOC=0);
      430    12870        %IF TEXTCHAR(LOC) = '0';
      431    12871            %LSET N$ = CHARTEXT( CONCAT( TEXTCHAR(NAM), '$'));
      432    12872        %ELSE;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:107  
      433    12873            %LSET N$ = CHARTEXT( TEXTCHAR(LOC));
      434    12874        %ENDIF;
      435    12875        %LSET N = CHARTEXT( TEXTCHAR(NAM));
      436    12876        %LSET LISTEXP = '1'B;
      437    12877        %LSET LISTSUB = '1'B;
      438    12878        %LSET LISTMAC = '1'B;
      439    12879            DCL %N$ PTR CONSTANT INIT( ADDR( %N));
      440    12880            DCL 1 %N STATIC,
      441    12881                 2 L UBIN INIT(0),
      442    12882                 2 T CHAR( SIZ) INIT( ' ');
      443    12883        %MEND;
      444    12884            %HEADER( NAM=FROMNAME, LOC=FROM$);
             12894    1       DCL FROM$ PTR CONSTANT INIT( ADDR( FROMNAME));
             12895    1       DCL 1 FROMNAME STATIC,
             12896    1            2 L UBIN INIT(0),
             12897    1            2 T CHAR( 80) INIT( ' ');
      445    12899            %HEADER( NAM=FROMSIGN, LOC=FROMNAME$);
             12909    1       DCL FROMNAME$ PTR CONSTANT INIT( ADDR( FROMSIGN));
             12910    1       DCL 1 FROMSIGN STATIC,
             12911    1            2 L UBIN INIT(0),
             12912    1            2 T CHAR( 80) INIT( ' ');
      446    12914            %HEADER( NAM=FROMADDR);
             12924    1       DCL FROMADDR$ PTR CONSTANT INIT( ADDR( FROMADDR));
             12925    1       DCL 1 FROMADDR STATIC,
             12926    1            2 L UBIN INIT(0),
             12927    1            2 T CHAR( 80) INIT( ' ');
      447    12929            %HEADER( NAM=REPLY_TO);
             12939    1       DCL REPLY_TO$ PTR CONSTANT INIT( ADDR( REPLY_TO));
             12940    1       DCL 1 REPLY_TO STATIC,
             12941    1            2 L UBIN INIT(0),
             12942    1            2 T CHAR( 80) INIT( ' ');
      448    12944            %HEADER( NAM=REPLYSIGN, LOC=REPLYNAME$);
             12954    1       DCL REPLYNAME$ PTR CONSTANT INIT( ADDR( REPLYSIGN));
             12955    1       DCL 1 REPLYSIGN STATIC,
             12956    1            2 L UBIN INIT(0),
             12957    1            2 T CHAR( 80) INIT( ' ');
      449    12959            %HEADER( NAM=REPLYADDR);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:108  
             12969    1       DCL REPLYADDR$ PTR CONSTANT INIT( ADDR( REPLYADDR));
             12970    1       DCL 1 REPLYADDR STATIC,
             12971    1            2 L UBIN INIT(0),
             12972    1            2 T CHAR( 80) INIT( ' ');
      450    12974            %HEADER( NAM=PATH, SIZ=%PATH_SIZE);
             12984    1       DCL PATH$ PTR CONSTANT INIT( ADDR( PATH));
             12985    1       DCL 1 PATH STATIC,
             12986    1            2 L UBIN INIT(0),
             12987    1            2 T CHAR( 240) INIT( ' ');
      451    12989            %HEADER( NAM=TONAME, LOC=TO$, SIZ=%PATH_SIZE);
             12999    1       DCL TO$ PTR CONSTANT INIT( ADDR( TONAME));
             13000    1       DCL 1 TONAME STATIC,
             13001    1            2 L UBIN INIT(0),
             13002    1            2 T CHAR( 240) INIT( ' ');
      452    13004            %HEADER( NAM=BAD_ADDRESS, SIZ=%LINE_SIZE);
             13014    1       DCL BAD_ADDRESS$ PTR CONSTANT INIT( ADDR( BAD_ADDRESS));
             13015    1       DCL 1 BAD_ADDRESS STATIC,
             13016    1            2 L UBIN INIT(0),
             13017    1            2 T CHAR( 255) INIT( ' ');
      453    13019            %HEADER( NAM=SUBJECT, SIZ=%LINE_SIZE);
             13029    1       DCL SUBJECT$ PTR CONSTANT INIT( ADDR( SUBJECT));
             13030    1       DCL 1 SUBJECT STATIC,
             13031    1            2 L UBIN INIT(0),
             13032    1            2 T CHAR( 255) INIT( ' ');
      454    13034            %HEADER( NAM=RE, SIZ=%LINE_SIZE);
             13044    1       DCL RE$ PTR CONSTANT INIT( ADDR( RE));
             13045    1       DCL 1 RE STATIC,
             13046    1            2 L UBIN INIT(0),
             13047    1            2 T CHAR( 255) INIT( ' ');
      455    13049            %HEADER( NAM=SIGNATURE, SIZ=%LINE_SIZE);
             13059    1       DCL SIGNATURE$ PTR CONSTANT INIT( ADDR( SIGNATURE));
             13060    1       DCL 1 SIGNATURE STATIC,
             13061    1            2 L UBIN INIT(0),
             13062    1            2 T CHAR( 255) INIT( ' ');
      456    13064            %HEADER( NAM=COMMENT, SIZ=%LINE_SIZE);
             13074    1       DCL COMMENT$ PTR CONSTANT INIT( ADDR( COMMENT));
             13075    1       DCL 1 COMMENT STATIC,
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:109  
             13076    1            2 L UBIN INIT(0),
             13077    1            2 T CHAR( 255) INIT( ' ');
      457    13079            %HEADER( NAM=TOSITE, SIZ=%HOST_SIZE);
             13089    1       DCL TOSITE$ PTR CONSTANT INIT( ADDR( TOSITE));
             13090    1       DCL 1 TOSITE STATIC,
             13091    1            2 L UBIN INIT(0),
             13092    1            2 T CHAR( 64) INIT( ' ');
      458    13094
      459    13095    1       DCL MSG_NUMBER UBIN WORD;
      460    13096    1       DCL MSG_TSTAMP UBIN STATIC INIT( 0);
      461    13097    1       DCL MSG_DATE CHAR(8) STATIC INIT( 'MM/DD/YY');
      462    13098    1       DCL MSG_TIME CHAR(11) STATIC INIT( 'HH:MM:SS.SS');
      463    13099
      464    13100    1       DCL 1 DATEWORK STATIC,
      465    13101    1            2 MON CHAR(3) INIT( 'MON'),
      466    13102    1            2 MONMASK REDEF MON BIT(27) CALIGNED,
      467    13103    1            2 * CHAR(1) INIT( ' '),
      468    13104    1            2 DD CHAR(2) INIT( 'DD'),
      469    13105    1            2 * CHAR(2) INIT( ' '''),
      470    13106    1            2 YY CHAR(2) INIT( 'YY');
      471    13107    1       DCL DATESTRING REDEF DATEWORK CHAR(10);
      472    13108    1       DCL DATEBUF CHAR(10) STATIC INIT( 'DD MON YY');
      473    13109    1       DCL DAYBUF CHAR(3) STATIC INIT( 'DAY');
      474    13110    1       DCL DAYMASK REDEF DAYBUF BIT(27) CALIGNED;
      475    13111
      476    13112    1       DCL TIMEBUF CHAR(5) STATIC INIT( 'HH:MM');
      477    13113    1       DCL TIMEBUF2 CHAR(8) STATIC INIT( 'HH:MM:SS');
      478    13114
      479    13115    1       DCL PROFILE$ PTR;
      480    13116    1       DCL HEADER$ PTR;
      481    13117    1       DCL BODY$ PTR;
      482    13118    1       DCL ADDRESS$ PTR;
      483    13119    1       DCL ALIAS$ PTR;
      484    13120
      485    13121    1       DCL TCM_XLATE_TO_UC(0:511) CHAR(1) UNAL CONSTANT SYMDEF INIT(
      486    13122    1            BINASC(0),BINASC(1),BINASC(2),BINASC(3),        /* NUL SOH STX ETX */
      487    13123    1            BINASC(4),BINASC(5),BINASC(6),BINASC(7),        /* EOT ENQ ACK BEL */
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:110  
      488    13124    1            BINASC(8),BINASC(9),BINASC(10),BINASC(11),      /* BS HT LF VT */
      489    13125    1            BINASC(12),BINASC(13),BINASC(14),BINASC(15),    /* FF CR SO SI */
      490    13126    1            BINASC(16),BINASC(17),BINASC(18),BINASC(19),    /* DLE DC1 DC2 DC3 */
      491    13127    1            BINASC(20),BINASC(21),BINASC(22),BINASC(23),    /* DC4 NAK SYN ETB */
      492    13128    1            BINASC(24),BINASC(25),BINASC(26),BINASC(27),    /* CAN EM SUB ESC */
      493    13129    1            BINASC(28),BINASC(29),BINASC(30),BINASC(31),    /* FS GS RS US */
      494    13130    1            BINASC(32),BINASC(33),BINASC(34),BINASC(35),    /* SP ! " # */
      495    13131    1            BINASC(36),BINASC(37),BINASC(38),BINASC(39),    /* $ % & ' */
      496    13132    1            BINASC(40),BINASC(41),BINASC(42),BINASC(43),    /* ( ) * + */
      497    13133    1            BINASC(44),BINASC(45),BINASC(46),BINASC(47),    /* , - . / */
      498    13134    1            BINASC(48),BINASC(49),BINASC(50),BINASC(51),    /* 0 1 2 3 */
      499    13135    1            BINASC(52),BINASC(53),BINASC(54),BINASC(55),    /* 4 5 6 7 */
      500    13136    1            BINASC(56),BINASC(57),BINASC(58),BINASC(59),    /* 8 9 : ; */
      501    13137    1            BINASC(60),BINASC(61),BINASC(62),BINASC(63),    /* < = > ? */
      502    13138    1            BINASC(64),BINASC(65),BINASC(66),BINASC(67),    /* @ A B C */
      503    13139    1            BINASC(68),BINASC(69),BINASC(70),BINASC(71),    /* D E F G */
      504    13140    1            BINASC(72),BINASC(73),BINASC(74),BINASC(75),    /* H I J K */
      505    13141    1            BINASC(76),BINASC(77),BINASC(78),BINASC(79),    /* L M N O */
      506    13142    1            BINASC(80),BINASC(81),BINASC(82),BINASC(83),    /* P Q R S */
      507    13143    1            BINASC(84),BINASC(85),BINASC(86),BINASC(87),    /* T U V W */
      508    13144    1            BINASC(88),BINASC(89),BINASC(90),BINASC(91),    /* X Y Z [ */
      509    13145    1            BINASC(92),BINASC(93),BINASC(94),BINASC(95),    /* \ ] ^ _ */
      510    13146        /*
      511    13147            ***       THIS SECTION OF THE TABLE CONVERTS THE LOWER CASE
      512    13148            ***       ALPHABET TO UPPER CASE WHEN USED WITH XLATE FUNCTION.
      513    13149            ***       THE COMMENTARY REFLECTS THE NORMAL ASCII CHARACTER WHICH
      514    13150            ***       USUALLY HOLDS THE POSITION IN THE TABLE.
      515    13151        */
      516    13152    1            BINASC(96),BINASC(65),BINASC(66),BINASC(67),    /* ' a b c */
      517    13153    1            BINASC(68),BINASC(69),BINASC(70),BINASC(71),    /* d e f g */
      518    13154    1            BINASC(72),BINASC(73),BINASC(74),BINASC(75),    /* h i j k */
      519    13155    1            BINASC(76),BINASC(77),BINASC(78),BINASC(79),    /* l m n o */
      520    13156    1            BINASC(80),BINASC(81),BINASC(82),BINASC(83),    /* p q r s */
      521    13157    1            BINASC(84),BINASC(85),BINASC(86),BINASC(87),    /* t u v w */
      522    13158    1            BINASC(88),BINASC(89),BINASC(90),BINASC(123),   /* x y z { */
      523    13159    1            BINASC(124),BINASC(125),BINASC(126),BINASC(127),/* | } ~ DEL */
      524    13160    1                        BINASC(32)*384);                    /* ALL ELSE BLANK */
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:111  
      525    13161        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:112  
      526    13162            /****** PROGRAM INITIALIZATION ******/
      527    13163    1       CALL INDEX( LOC, '(DEBUG)', B$JIT.CCBUF)

  13163 14 000002   200105 631500                    EPPR1   LOC,,AUTO
        14 000003   002665 633400 1                  EPPR3   TCM_XLATE_TO_UC+128
        14 000004   000007 223003                    LDX3    7,DU
        14 000005   000000 470400 xsym               LDP0    B$JIT$
        14 000006   000033 630500                    EPPR0   27,,PR0
        14 000007   000400 220003                    LDX0    256,DU
        14 000010   000000 236003                    LDQ     0,DU
        14 000011   000000 701000 xent               TSX1    X66_INDEX
        14 000012   000021 710000 14                 TRA     s:13171

      528    13164    2       WHENRETURN DO;

      529    13165    2           CALL M$ALIB( FPT_ALIB)

  13165 14 000013   001754 630400 1                  EPPR0   FPT_ALIB
        14 000014   400007 713400                    CLIMB   alt,+7
        14 000015   401400 401760                    pmme    nvectors=4
        14 000016   000020 702000 14                 TSX2    s:13168
        14 000017   000020 710000 14                 TRA     s:13168

      530    13166    3           WHENALTRETURN DO;

      531    13167    3               END;

      532    13168    2           END;

  13168 14 000020   000021 710000 14                 TRA     s:13171

      533    13169    2       WHENALTRETURN DO;

      534    13170    2           END;

      535    13171    1       CALL INDEX( LOC, '(TCP)', B$JIT.CCBUF)

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:113  
  13171 14 000021   200105 631500                    EPPR1   LOC,,AUTO
        14 000022   002667 633400 1                  EPPR3   TCM_XLATE_TO_UC+130
        14 000023   000005 223003                    LDX3    5,DU
        14 000024   000000 470400 xsym               LDP0    B$JIT$
        14 000025   000033 630500                    EPPR0   27,,PR0
        14 000026   000400 220003                    LDX0    256,DU
        14 000027   000000 236003                    LDQ     0,DU
        14 000030   000000 701000 xent               TSX1    X66_INDEX
        14 000031   000040 710000 14                 TRA     s:13177

      536    13172    2       WHENRETURN DO;

      537    13173    2           TCM_PROGNAME = 'NETSEND';

  13173 14 000032   040000 100400                    MLR     fill='040'O
        14 000033   002671 000007 1                  ADSC9   TCM_XLATE_TO_UC+132      cn=0,n=7
        14 000034   001173 000007 6                  ADSC9   TCM_PROGNAME             cn=0,n=7

      538    13174    2           TCP_FLAVOR = '1'B;

  13174 14 000035   400000 236003                    LDQ     -131072,DU
        14 000036   001223 756000 6                  STQ     TCP_FLAVOR

      539    13175    2           END;

  13175 14 000037   000044 710000 14                 TRA     s:13180

      540    13176    2       WHENALTRETURN DO;

      541    13177    2           TCM_PROGNAME = 'MULSEND';

  13177 14 000040   040000 100400                    MLR     fill='040'O
        14 000041   002673 000007 1                  ADSC9   TCM_XLATE_TO_UC+134      cn=0,n=7
        14 000042   001173 000007 6                  ADSC9   TCM_PROGNAME             cn=0,n=7

      542    13178    2           TCP_FLAVOR = '0'B;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:114  
  13178 14 000043   001223 450000 6                  STZ     TCP_FLAVOR

      543    13179    2           END;

      544    13180    1       CALL TCM$WRITE_AUDIT_ON;

  13180 14 000044   000002 631400 xsym               EPPR1   B_VECTNIL+2
        14 000045   000000 701000 xent               TSX1    TCM$WRITE_AUDIT_ON
        14 000046   000000 011000                    NOP     0

      545    13181    1       M$BOX$ = DCBADDR( DCBNUM( M$BOX));

  13181 14 000047   000000 236007 xsym               LDQ     M$BOX,DL
        14 000050   000000 470400 15                 LDP0    0
        14 000051   000000 471500                    LDP1    0,,PR0
        14 000052   100000 236106                    LDQ     0,QL,PR1
        14 000053   200073 756100                    STQ     M$BOX$,,AUTO

      546    13182    1       M$CMD$ = DCBADDR( DCBNUM( M$CMD));

  13182 14 000054   000000 236007 xsym               LDQ     M$CMD,DL
        14 000055   100000 236106                    LDQ     0,QL,PR1
        14 000056   200074 756100                    STQ     M$CMD$,,AUTO

      547    13183    1       M$MSG$ = DCBADDR( DCBNUM( M$MSG));

  13183 14 000057   000000 236007 xsym               LDQ     M$MSG,DL
        14 000060   100000 236106                    LDQ     0,QL,PR1
        14 000061   200075 756100                    STQ     M$MSG$,,AUTO

      548    13184    1       M$FOLDER$ = DCBADDR( DCBNUM( M$FOLDER));

  13184 14 000062   000000 236007 xsym               LDQ     M$FOLDER,DL
        14 000063   100000 236106                    LDQ     0,QL,PR1
        14 000064   200077 756100                    STQ     M$FOLDER$,,AUTO

      549    13185    1       M$REGISTRY$ = DCBADDR( DCBNUM( M$REGISTRY));
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:115  

  13185 14 000065   000000 236007 xsym               LDQ     M$REGISTRY,DL
        14 000066   100000 236106                    LDQ     0,QL,PR1
        14 000067   200076 756100                    STQ     M$REGISTRY$,,AUTO

      550    13186    1       M$SI$ = DCBADDR( DCBNUM( M$SI));

  13186 14 000070   000000 236007 xsym               LDQ     M$SI,DL
        14 000071   100000 236106                    LDQ     0,QL,PR1
        14 000072   200101 756100                    STQ     M$SI$,,AUTO

      551    13187    2       IF M$SI$->F$DCB.ASN# = %DEVICE# THEN DO;

  13187 14 000073   200101 473500                    LDP3    M$SI$,,AUTO
        14 000074   300032 236100                    LDQ     26,,PR3
        14 000075   777000 376007                    ANQ     -512,DL
        14 000076   003000 116007                    CMPQ    1536,DL
        14 000077   000110 601000 14                 TNZ     s:13193

      552    13188    2           CMDBUF = 'No config file specified on invocation.  I quit.';

  13188 14 000100   040000 100400                    MLR     fill='040'O
        14 000101   002675 000060 1                  ADSC9   TCM_XLATE_TO_UC+136      cn=0,n=48
        14 000102   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

      553    13189    2           CALL WRITEDO;

  13189 14 000103   013551 701000 14                 TSX1    WRITEDO
        14 000104   000000 011000                    NOP     0

      554    13190    2           CALL M$ERR;

  13190 14 000105   000002 713400                    CLIMB   err
        14 000106   000000 401760                    pmme    nvectors=0

      555    13191    2           END;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:116  
  13191 14 000107   000112 710000 14                 TRA     s:13194

      556    13192    1       ELSE
      557    13193    1           TCM_MESSACCT.ACCT# = M$SI$->F$DCB.ACCT#;

  13193 14 000110   300020 237100                    LDAQ    16,,PR3
        14 000111   000234 757000 6                  STAQ    TCM_MESSACCT

      558    13194    1       IF TCM_DRIBBLE THEN

  13194 14 000112   001167 235000 6                  LDA     TCM_DRIBBLE
        14 000113   000120 600000 14                 TZE     s:13197

      559    13195    1           CALL M$OPEN( DRIBBLE_FILE);

  13195 14 000114   001356 630400 1                  EPPR0   DRIBBLE_FILE
        14 000115   050000 713400                    CLIMB   open
        14 000116   410400 401760                    pmme    nvectors=18
        14 000117   000125 710000 14                 TRA     s:13199

      560    13196    1       ELSE
      561    13197    1           IF NOT TCM_DRIBBLE_ME THEN

  13197 14 000120   001170 236000 6                  LDQ     TCM_DRIBBLE_ME
        14 000121   000125 601000 14                 TNZ     s:13199

      562    13198    1               CALL M$OPEN( DRIBBLE_NO);

  13198 14 000122   001454 630400 1                  EPPR0   DRIBBLE_NO
        14 000123   050000 713400                    CLIMB   open
        14 000124   410400 401760                    pmme    nvectors=18

      563    13199    1       CALL INITIALIZE_CONFIGURATION

  13199 14 000125   000700 701000 14                 TSX1    INITIALIZE_CONFIGURATION
        14 000126   000130 702000 14                 TSX2    s:13201
        14 000127   000143 710000 14                 TRA     s:13206
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:117  

      564    13200    2       WHENALTRETURN DO;

      565    13201    2           CALL M$SPRIV( JIT_PRIV);

  13201 14 000130   001742 630400 1                  EPPR0   JIT_PRIV
        14 000131   020012 713400                    CLIMB   8202
        14 000132   400000 401760                    pmme    nvectors=1

      566    13202    2           B$JIT.PRIV.ACTIVE.EXMM = %YES#;  /* so we can SNAP */

  13202 14 000133   000000 470400 xsym               LDP0    B$JIT$
        14 000134   000002 236007                    LDQ     2,DL
        14 000135   000013 256100                    ORSQ    11,,PR0

      567    13203    2           CALL M$SCREECH( SCREECH3);  /* ..a SNAP, really */

  13203 14 000136   001650 630400 1                  EPPR0   SCREECH3
        14 000137   000013 713400                    CLIMB   11
        14 000140   401000 401760                    pmme    nvectors=3

      568    13204    2           CALL M$EXIT;

  13204 14 000141   000001 713400                    CLIMB   exit
        14 000142   000000 401760                    pmme    nvectors=0

      569    13205    2           END;

      570    13206    1       CALL M$SPRIV( JIT_PRIV)

  13206 14 000143   001742 630400 1                  EPPR0   JIT_PRIV
        14 000144   420012 713400                    CLIMB   alt,+8202
        14 000145   400000 401760                    pmme    nvectors=1
        14 000146   000153 702000 14                 TSX2    s:13212

      571    13207    2       WHENRETURN DO;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:118  
      572    13208    2           B$JIT.PRIV.JOB.FMSEC = %YES#;  /* needed later for SEND */

  13208 14 000147   000000 470400 xsym               LDP0    B$JIT$
        14 000150   100000 236003                    LDQ     32768,DU
        14 000151   000015 256100                    ORSQ    13,,PR0

      573    13209    2           END;

  13209 14 000152   000153 710000 14                 TRA     s:13212

      574    13210    2       WHENALTRETURN DO;

      575    13211    2           END;

      576    13212    1       CALL INITIALIZE_QUOTATIONS;

  13212 14 000153   002346 701000 14                 TSX1    INITIALIZE_QUOTATIONS
        14 000154   000000 011000                    NOP     0

      577    13213    1       REMEMBER BAILOUT IN TCM_SMTP_BAILOUT;

  13213 14 000155   000336 635000 14                 EAA     BAILOUT
        14 000156   001124 452400 6                  STP2    TCM_SMTP_BAILOUT
        14 000157   001125 755000 6                  STA     TCM_SMTP_BAILOUT+1

      578    13214    1       TERMINATING = %NO#;

  13214 14 000160   200112 450100                    STZ     TERMINATING,,AUTO

      579    13215    1       CALL XSL$SOCKINIT( TCM_SOCKINIT);

  13215 14 000161   000001 630400 15                 EPPR0   1
        14 000162   000017 631400 xsym               EPPR1   B_VECTNIL+15
        14 000163   000000 701000 xent               TSX1    XSL$SOCKINIT
        14 000164   000000 011000                    NOP     0

      580    13216    2       DO UNTIL TERMINATING;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:119  

      581    13217    2           TCM_SMTP_PROGRESS = %SMTP_NOP;

  13217 14 000165   001126 450000 6                  STZ     TCM_SMTP_PROGRESS

      582    13218    2           CALL M$OPEN( OPEN_HANGUP)

  13218 14 000166   000762 630400 1                  EPPR0   OPEN_HANGUP
        14 000167   450000 713400                    CLIMB   alt,open
        14 000170   410400 401760                    pmme    nvectors=18
        14 000171   000173 702000 14                 TSX2    s:13221
        14 000172   000173 710000 14                 TRA     s:13221

      583    13219    3           WHENALTRETURN DO;

      584    13220    3               END;

      585    13221    3           IF DCBADDR( DCBNUM( M$HANGUP))->F$DCB.FCD# THEN DO;

  13221 14 000173   000000 236007 xsym               LDQ     M$HANGUP,DL
        14 000174   000000 470400 15                 LDP0    0
        14 000175   000000 471500                    LDP1    0,,PR0
        14 000176   100000 473506                    LDP3    0,QL,PR1
        14 000177   300031 236100                    LDQ     25,,PR3
        14 000200   020000 316007                    CANQ    8192,DL
        14 000201   000210 600000 14                 TZE     s:13226

      586    13222    3               TERMINATING = %YES#;

  13222 14 000202   400000 236003                    LDQ     -131072,DU
        14 000203   200112 756100                    STQ     TERMINATING,,AUTO

      587    13223    3               CALL M$CLOSE( CLOSE_HANGUP);

  13223 14 000204   001054 630400 1                  EPPR0   CLOSE_HANGUP
        14 000205   050001 713400                    CLIMB   close
        14 000206   406000 401760                    pmme    nvectors=13
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:120  

      588    13224    3               END;

  13224 14 000207   000373 710000 14                 TRA     s:13274

      589    13225    3           ELSE DO;

      590    13226    4               DO CURR_SITE = 0 TO SITES - 1;

  13226 14 000210   200127 450100                    STZ     CURR_SITE,,AUTO
        14 000211   000216 710000 14                 TRA     s:13228+1

      591    13227    4                   SITE.PENDING( CURR_SITE) = 0;

  13227 14 000212   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 000213   000072 402007                    MPY     58,DL
        14 000214   200227 450106                    STZ     SITE+49,QL,AUTO

      592    13228    4                   END;

  13228 14 000215   200127 054100                    AOS     CURR_SITE,,AUTO
        14 000216   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 000217   200126 116100                    CMPQ    SITES,,AUTO
        14 000220   000212 604000 14                 TMI     s:13227

      593    13229    3               CALL M$OPEN( OPEN_FOLDER) ALTRET( BAILOUT);

  13229 14 000221   000212 630400 1                  EPPR0   OPEN_FOLDER
        14 000222   450000 713400                    CLIMB   alt,open
        14 000223   410400 401760                    pmme    nvectors=18
        14 000224   000336 702000 14                 TSX2    BAILOUT

      594    13230    3               CALL M$ENQ( ENQ_ON_FILE) ALTRET( BAILOUT);

  13230 14 000225   000552 630400 1                  EPPR0   ENQ_ON_FILE
        14 000226   420002 713400                    CLIMB   alt,+8194
        14 000227   401000 401760                    pmme    nvectors=3
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:121  
        14 000230   000336 702000 14                 TSX2    BAILOUT

      595    13231    3               CALL M$OPEN( OPEN_REGISTRY) ALTRET( BAILOUT);

  13231 14 000231   000304 630400 1                  EPPR0   OPEN_REGISTRY
        14 000232   450000 713400                    CLIMB   alt,open
        14 000233   410400 401760                    pmme    nvectors=18
        14 000234   000336 702000 14                 TSX2    BAILOUT

      596    13232    3               CALL INIT_FOLDER_DATA_POOL;

  13232 14 000235   002464 701000 14                 TSX1    INIT_FOLDER_DATA_POOL
        14 000236   000000 011000                    NOP     0

      597    13233    3               TOTAL_READY = 0;

  13233 14 000237   200143 450100                    STZ     TOTAL_READY,,AUTO

      598    13234    3               MESSAGE_FILE = %NO#;

  13234 14 000240   200141 450100                    STZ     MESSAGE_FILE,,AUTO

      599    13235    3               CALL SCAN_ALL_HEADERS;

  13235 14 000241   002534 701000 14                 TSX1    SCAN_ALL_HEADERS
        14 000242   000000 011000                    NOP     0

      600    13236    3               CALL M$DEQ( DEQ_ON_FILE)

  13236 14 000243   000564 630400 1                  EPPR0   DEQ_ON_FILE
        14 000244   420003 713400                    CLIMB   alt,+8195
        14 000245   401000 401760                    pmme    nvectors=3
        14 000246   000250 702000 14                 TSX2    s:13239
        14 000247   000250 710000 14                 TRA     s:13239

      601    13237    4               WHENALTRETURN DO;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:122  
      602    13238    4                   END;

      603    13239    3               CALL M$CLOSE( CLOSE_FOLDER)

  13239 14 000250   000376 630400 1                  EPPR0   CLOSE_FOLDER
        14 000251   450001 713400                    CLIMB   alt,close
        14 000252   406000 401760                    pmme    nvectors=13
        14 000253   000255 702000 14                 TSX2    s:13242
        14 000254   000255 710000 14                 TRA     s:13242

      604    13240    4               WHENALTRETURN DO;

      605    13241    4                   END;

      606    13242    3               CALL POSITION_TO_FIRST_MESS;

  13242 14 000255   002755 701000 14                 TSX1    POSITION_TO_FIRST_MESS
        14 000256   000000 011000                    NOP     0

      607    13243    4               DO FOREVER;

      608    13244    4                   CALL OPEN_NEXT_MESS ALTRET( FINISHED_WITH_MESS_FILES);

  13244 14 000257   002777 701000 14                 TSX1    OPEN_NEXT_MESS
        14 000260   000267 702000 14                 TSX2    FINISHED_WITH_MESS_FILES

      609    13245    4                   CALL SCAN_ALL_HEADERS;

  13245 14 000261   002534 701000 14                 TSX1    SCAN_ALL_HEADERS
        14 000262   000000 011000                    NOP     0

      610    13246    4                   CALL M$CLOSE( CLOSE_FOLDER);

  13246 14 000263   000376 630400 1                  EPPR0   CLOSE_FOLDER
        14 000264   050001 713400                    CLIMB   close
        14 000265   406000 401760                    pmme    nvectors=13

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:123  
      611    13247    4                   END;

  13247 14 000266   000257 710000 14                 TRA     s:13244

      612    13248    3   FINISHED_WITH_MESS_FILES:
      613    13249    3               CALL CHOOSE_A_SITE;

  13249 14 000267   002604 701000 14    FINISHED_WI* TSX1    CHOOSE_A_SITE
        14 000270   000000 011000                    NOP     0

      614    13250    4               IF CURR_SITE ~= -1 THEN DO;

  13250 14 000271   200127 235100                    LDA     CURR_SITE,,AUTO
        14 000272   000027 115000 xsym               CMPA    B_VECTNIL+23
        14 000273   000336 600000 14                 TZE     BAILOUT

      615    13251    4                   CALL M$TIME( GET_TIME_NOW);

  13251 14 000274   001562 630400 1                  EPPR0   GET_TIME_NOW
        14 000275   020004 713400                    CLIMB   8196
        14 000276   402000 401760                    pmme    nvectors=5

      616    13252    4                   CALL CONCAT( CMDBUF, TCM_PROGNAME, ' awake: ', DATESTRING, ' ',
             13252                            TIMEBUF);

  13252 14 000277   040000 100400                    MLR     fill='040'O
        14 000300   001173 000007 6                  ADSC9   TCM_PROGNAME             cn=0,n=7
        14 000301   002107 000007 6                  ADSC9   CMDBUF                   cn=0,n=7
        14 000302   040000 100400                    MLR     fill='040'O
        14 000303   002711 000010 1                  ADSC9   TCM_XLATE_TO_UC+148      cn=0,n=8
        14 000304   002110 600010 6                  ADSC9   CMDBUF+1                 cn=3,n=8
        14 000305   040000 100400                    MLR     fill='040'O
        14 000306   003436 000012 6                  ADSC9   DATEWORK                 cn=0,n=10
        14 000307   002112 600012 6                  ADSC9   CMDBUF+3                 cn=3,n=10
        14 000310   000040 236003                    LDQ     32,DU
        14 000311   002115 552020 6                  STBQ    CMDBUF+6,'20'O
        14 000312   040000 100400                    MLR     fill='040'O
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:124  
        14 000313   003445 000005 6                  ADSC9   TIMEBUF                  cn=0,n=5
        14 000314   002115 400345 6                  ADSC9   CMDBUF+6                 cn=2,n=229

      617    13253    4                   CALL INDEX( TVAL, '  ', CMDBUF);

  13253 14 000315   000000 120400                    SCD
        14 000316   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255
        14 000317   002713 000002 1                  ADSC9   TCM_XLATE_TO_UC+150      cn=0,n=2
        14 000320   200107 000100                    ARG     TVAL,,AUTO
        14 000321   000323 607000 14                 TTF     s:13254
        14 000322   200107 054100                    AOS     TVAL,,AUTO

      618    13254    4                   WRITE_ME.BUF_.BOUND = TVAL - 1;

  13254 14 000323   200107 236100                    LDQ     TVAL,,AUTO
        14 000324   000001 136007                    SBLQ    1,DL
        14 000325   000020 736000                    QLS     16
        14 000326   000242 676000 6                  ERQ     WRITE_ME+4
        14 000327   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 000330   000242 656000 6                  ERSQ    WRITE_ME+4

      619    13255    4                   CALL M$WRITE( WRITE_ME);

  13255 14 000331   000236 630400 6                  EPPR0   WRITE_ME
        14 000332   040001 713400                    CLIMB   write
        14 000333   401400 401760                    pmme    nvectors=4

      620    13256    4                   CALL SMTP_SESSION ALTRET( BAILOUT);

  13256 14 000334   003170 701000 14                 TSX1    SMTP_SESSION
        14 000335   000336 702000 14                 TSX2    BAILOUT

      621    13257    4                   END;

      622    13258    3   BAILOUT:
      623    13259    3               CALL TCM$STOP_SMTP;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:125  
  13259 14 000336   000002 631400 xsym  BAILOUT      EPPR1   B_VECTNIL+2
        14 000337   000000 701000 xent               TSX1    TCM$STOP_SMTP
        14 000340   000000 011000                    NOP     0

      624    13260    4               IF M$FOLDER$->F$DCB.FCD# THEN DO;

  13260 14 000341   200077 470500                    LDP0    M$FOLDER$,,AUTO
        14 000342   000031 236100                    LDQ     25,,PR0
        14 000343   020000 316007                    CANQ    8192,DL
        14 000344   000352 600000 14                 TZE     s:13265

      625    13261    4                   CALL M$CLOSE( CLOSE_FOLDER)

  13261 14 000345   000376 630400 1                  EPPR0   CLOSE_FOLDER
        14 000346   450001 713400                    CLIMB   alt,close
        14 000347   406000 401760                    pmme    nvectors=13
        14 000350   000352 702000 14                 TSX2    s:13265
        14 000351   000352 710000 14                 TRA     s:13265

      626    13262    5                   WHENALTRETURN DO;

      627    13263    5                       END;

      628    13264    4                   END;

      629    13265    4               IF M$REGISTRY$->F$DCB.FCD# THEN DO;

  13265 14 000352   200076 470500                    LDP0    M$REGISTRY$,,AUTO
        14 000353   000031 236100                    LDQ     25,,PR0
        14 000354   020000 316007                    CANQ    8192,DL
        14 000355   000363 600000 14                 TZE     s:13270

      630    13266    4                   CALL M$CLOSE( CLOSE_REGISTRY)

  13266 14 000356   000472 630400 1                  EPPR0   CLOSE_REGISTRY
        14 000357   450001 713400                    CLIMB   alt,close
        14 000360   406000 401760                    pmme    nvectors=13
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:126  
        14 000361   000363 702000 14                 TSX2    s:13270
        14 000362   000363 710000 14                 TRA     s:13270

      631    13267    5                   WHENALTRETURN DO;

      632    13268    5                       END;

      633    13269    4                   END;

      634    13270    3               CALL RELEASE_FOLDER_DATA_POOL;

  13270 14 000363   002516 701000 14                 TSX1    RELEASE_FOLDER_DATA_POOL
        14 000364   000000 011000                    NOP     0

      635    13271    3               IDLE.L# = 4;

  13271 14 000365   004000 236003                    LDQ     2048,DU
        14 000366   000652 552040 6                  STBQ    IDLE,'40'O

      636    13272    3               CALL STATUS_UPDATE( IDLE);

  13272 14 000367   000002 236000 15                 LDQ     2
        14 000370   222715 756100                    STQ     LAST+2,,AUTO
        14 000371   013522 701000 14                 TSX1    STATUS_UPDATE
        14 000372   000000 011000                    NOP     0

      637    13273    3               END;

      638    13274    3           IF NOT TERMINATING THEN DO;

  13274 14 000373   200112 234100                    SZN     TERMINATING,,AUTO
        14 000374   000663 604000 14                 TMI     s:13332

      639    13275    4               IF CURR_SITE ~= -1 THEN DO;

  13275 14 000375   200127 235100                    LDA     CURR_SITE,,AUTO
        14 000376   000027 115000 xsym               CMPA    B_VECTNIL+23
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:127  
        14 000377   000451 600000 14                 TZE     s:13291

      640    13276    4                   SITE.LAST_STATUS( CURR_SITE) = TCM_SMTP_PROGRESS;

  13276 14 000400   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 000401   000072 402007                    MPY     58,DL
        14 000402   001126 235000 6                  LDA     TCM_SMTP_PROGRESS
        14 000403   200236 755106                    STA     SITE+56,QL,AUTO

      641    13277    4                   SITE.LAST_TRY( CURR_SITE) = TIME_NOW;

  13277 14 000404   001230 235000 6                  LDA     TIME_NOW
        14 000405   200234 755106                    STA     SITE+54,QL,AUTO

      642    13278    5                   DO CASE SITE.LAST_STATUS( CURR_SITE);

  13278 14 000406   200236 235106                    LDA     SITE+56,QL,AUTO
        14 000407   000004 115007                    CMPA    4,DL
        14 000410   000412 602005 14                 TNC     s:13278+4,AL
        14 000411   000451 710000 14                 TRA     s:13291
        14 000412   000451 710000 14                 TRA     s:13291
        14 000413   000416 710000 14                 TRA     s:13280
        14 000414   000427 710000 14                 TRA     s:13283
        14 000415   000440 710000 14                 TRA     s:13286

      643    13279    5                       CASE( %SMTP_BUSY);

      644    13280    5                           CALL TCM$WRITE_AUDIT_LOG(

  13280 14 000416   200146 630506                    EPPR0   SITE,QL,AUTO
        14 000417   222723 450500                    STP0    @VLEN+3,,AUTO
        14 000420   000003 236000 15                 LDQ     3
        14 000421   222722 756100                    STQ     @VLEN+2,,AUTO
        14 000422   222722 630500                    EPPR0   @VLEN+2,,AUTO
        14 000423   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 000424   000000 701000 xent               TSX1    TCM$WRITE_AUDIT_LOG
        14 000425   000000 011000                    NOP     0
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:128  
        14 000426   000451 710000 14                 TRA     s:13291

      645    13281    5                                   NO_MODEM, SITE.NAME( CURR_SITE));
      646    13282    5                       CASE( %SMTP_NOHOST);

      647    13283    5                           CALL TCM$WRITE_AUDIT_LOG(

  13283 14 000427   200146 630506                    EPPR0   SITE,QL,AUTO
        14 000430   222723 450500                    STP0    @VLEN+3,,AUTO
        14 000431   000004 236000 15                 LDQ     4
        14 000432   222722 756100                    STQ     @VLEN+2,,AUTO
        14 000433   222722 630500                    EPPR0   @VLEN+2,,AUTO
        14 000434   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 000435   000000 701000 xent               TSX1    TCM$WRITE_AUDIT_LOG
        14 000436   000000 011000                    NOP     0
        14 000437   000451 710000 14                 TRA     s:13291

      648    13284    5                                   NO_HOST, SITE.NAME( CURR_SITE));
      649    13285    5                       CASE( %SMTP_CONNECTED);

      650    13286    5                           CALL TCM$WRITE_AUDIT_LOG(

  13286 14 000440   200146 630506                    EPPR0   SITE,QL,AUTO
        14 000441   222723 450500                    STP0    @VLEN+3,,AUTO
        14 000442   000005 236000 15                 LDQ     5
        14 000443   222722 756100                    STQ     @VLEN+2,,AUTO
        14 000444   222722 630500                    EPPR0   @VLEN+2,,AUTO
        14 000445   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 000446   000000 701000 xent               TSX1    TCM$WRITE_AUDIT_LOG
        14 000447   000000 011000                    NOP     0
        14 000450   000451 710000 14                 TRA     s:13291

      651    13287    5                                   NO_SMTP, SITE.NAME( CURR_SITE));
      652    13288    5                       CASE( ELSE);

      653    13289    5                       END;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:129  
      654    13290    4                   END;

      655    13291    3               CALL M$DISPRES( RELEASE_PACKS)

  13291 14 000451   001720 630400 1                  EPPR0   RELEASE_PACKS
        14 000452   550002 713400                    CLIMB   alt,+53250
        14 000453   402400 401760                    pmme    nvectors=6
        14 000454   000462 702000 14                 TSX2    s:13297

      656    13292    4               WHENRETURN DO;

      657    13293    4                   CALL M$RELRES( RELEASE_PACKS)

  13293 14 000455   001720 630400 1                  EPPR0   RELEASE_PACKS
        14 000456   550003 713400                    CLIMB   alt,+53251
        14 000457   402400 401760                    pmme    nvectors=6
        14 000460   000462 702000 14                 TSX2    s:13297
        14 000461   000462 710000 14                 TRA     s:13297

      658    13294    5                   WHENALTRETURN DO;

      659    13295    5                       END;

      660    13296    4                   END;

      661    13297    3               CALL M$TIME( GET_UTS_NOW);

  13297 14 000462   001576 630400 1                  EPPR0   GET_UTS_NOW
        14 000463   020004 713400                    CLIMB   8196
        14 000464   402000 401760                    pmme    nvectors=5

      662    13298    3               CALL XUD$UTS_ADJUST( TIME_THEN, TIME_NOW, %UTS_CSEC_HOUR#);

  13298 14 000465   000007 236000 15                 LDQ     7
        14 000466   222724 756100                    STQ     @VLEN+4,,AUTO
        14 000467   000010 236000 15                 LDQ     8
        14 000470   222723 756100                    STQ     @VLEN+3,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:130  
        14 000471   200113 630500                    EPPR0   TIME_THEN,,AUTO
        14 000472   222722 450500                    STP0    @VLEN+2,,AUTO
        14 000473   222722 630500                    EPPR0   @VLEN+2,,AUTO
        14 000474   000021 631400 xsym               EPPR1   B_VECTNIL+17
        14 000475   000000 701000 xent               TSX1    XUD$UTS_ADJUST
        14 000476   000000 011000                    NOP     0

      663    13299    4               DO THIS_SITE = 0 TO SITES - 1;

  13299 14 000477   200130 450100                    STZ     THIS_SITE,,AUTO
        14 000500   000565 710000 14                 TRA     s:13314+1

      664    13300    4                   IF SITE.LAST_STATUS( THIS_SITE) = %SMTP_NOHOST OR

  13300 14 000501   200130 236100                    LDQ     THIS_SITE,,AUTO
        14 000502   000072 402007                    MPY     58,DL
        14 000503   200236 235106                    LDA     SITE+56,QL,AUTO
        14 000504   000002 115007                    CMPA    2,DL
        14 000505   000512 600000 14                 TZE     s:13303
        14 000506   000003 115007                    CMPA    3,DL
        14 000507   000512 600000 14                 TZE     s:13303
        14 000510   000004 115007                    CMPA    4,DL
        14 000511   000532 601000 14                 TNZ     s:13308

      665    13301    4                           SITE.LAST_STATUS( THIS_SITE) = %SMTP_CONNECTED OR
      666    13302    4                           SITE.LAST_STATUS( THIS_SITE) = %SMTP_SESSION THEN
      667    13303    4                       CALL XUD$UTS_ADJUST(

  13303 14 000512   200231 236106                    LDQ     SITE+51,QL,AUTO
        14 000513   013560 402007                    MPY     6000,DL
        14 000514   222722 756100                    STQ     @VLEN+2,,AUTO
        14 000515   222722 630500                    EPPR0   @VLEN+2,,AUTO
        14 000516   222725 450500                    STP0    @VLEN+5,,AUTO
        14 000517   200130 236100                    LDQ     THIS_SITE,,AUTO
        14 000520   000072 402007                    MPY     58,DL
        14 000521   200234 631506                    EPPR1   SITE+54,QL,AUTO
        14 000522   222724 451500                    STP1    @VLEN+4,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:131  
        14 000523   200235 633506                    EPPR3   SITE+55,QL,AUTO
        14 000524   222723 453500                    STP3    @VLEN+3,,AUTO
        14 000525   222723 630500                    EPPR0   @VLEN+3,,AUTO
        14 000526   000021 631400 xsym               EPPR1   B_VECTNIL+17
        14 000527   000000 701000 xent               TSX1    XUD$UTS_ADJUST
        14 000530   000000 011000                    NOP     0
        14 000531   000553 710000 14                 TRA     s:13313

      668    13304    4                               SITE.NEXT_TRY( THIS_SITE),
      669    13305    4                               SITE.LAST_TRY( THIS_SITE),
      670    13306    4                               %UTS_CSEC_MIN# * SITE.RETRY_INTERVAL( THIS_SITE));
      671    13307    4                   ELSE
      672    13308    4                       IF SITE.PENDING( THIS_SITE) <= 0 THEN

  13308 14 000532   200227 235106                    LDA     SITE+49,QL,AUTO
        14 000533   000553 605400 14                 TPNZ    s:13313

      673    13309    4                           CALL XUD$UTS_ADJUST(

  13309 14 000534   200231 236106                    LDQ     SITE+51,QL,AUTO
        14 000535   013560 402007                    MPY     6000,DL
        14 000536   222722 756100                    STQ     @VLEN+2,,AUTO
        14 000537   222722 630500                    EPPR0   @VLEN+2,,AUTO
        14 000540   222725 450500                    STP0    @VLEN+5,,AUTO
        14 000541   000010 236000 15                 LDQ     8
        14 000542   222724 756100                    STQ     @VLEN+4,,AUTO
        14 000543   200130 236100                    LDQ     THIS_SITE,,AUTO
        14 000544   000072 402007                    MPY     58,DL
        14 000545   200235 631506                    EPPR1   SITE+55,QL,AUTO
        14 000546   222723 451500                    STP1    @VLEN+3,,AUTO
        14 000547   222723 630500                    EPPR0   @VLEN+3,,AUTO
        14 000550   000021 631400 xsym               EPPR1   B_VECTNIL+17
        14 000551   000000 701000 xent               TSX1    XUD$UTS_ADJUST
        14 000552   000000 011000                    NOP     0

      674    13310    4                                   SITE.NEXT_TRY( THIS_SITE),
      675    13311    4                                   TIME_NOW,
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:132  
      676    13312    4                                   %UTS_CSEC_MIN# * SITE.RETRY_INTERVAL( THIS_SITE));
      677    13313    4                   TIME_THEN = MINIMUM( SITE.NEXT_TRY( THIS_SITE), TIME_THEN);

  13313 14 000553   200130 236100                    LDQ     THIS_SITE,,AUTO
        14 000554   000072 402007                    MPY     58,DL
        14 000555   000000 620006                    EAX0    0,QL
        14 000556   200113 236100                    LDQ     TIME_THEN,,AUTO
        14 000557   200235 116110                    CMPQ    SITE+55,X0,AUTO
        14 000560   000563 602000 14                 TNC     s:13313+8
        14 000561   000563 600000 14                 TZE     s:13313+8
        14 000562   200235 236110                    LDQ     SITE+55,X0,AUTO
        14 000563   200113 756100                    STQ     TIME_THEN,,AUTO

      678    13314    4                   END;

  13314 14 000564   200130 054100                    AOS     THIS_SITE,,AUTO
        14 000565   200130 236100                    LDQ     THIS_SITE,,AUTO
        14 000566   200126 116100                    CMPQ    SITES,,AUTO
        14 000567   000501 604000 14                 TMI     s:13300

      679    13315    3               IF TCM_SMTP_PROGRESS = %SMTP_BUSY THEN

  13315 14 000570   001126 235000 6                  LDA     TCM_SMTP_PROGRESS
        14 000571   000001 115007                    CMPA    1,DL
        14 000572   000576 601000 14                 TNZ     s:13318

      680    13316    3                   WAIT_A_WHILE.V.UNITS# = 300;

  13316 14 000573   000454 235007                    LDA     300,DL
        14 000574   000256 755000 6                  STA     WAIT_A_WHILE+4
        14 000575   000616 710000 14                 TRA     s:13321

      681    13317    4               ELSE DO;

      682    13318    4                   CALL XUD$UTS_DIFF_SEC( UTS_DIFF, TIME_THEN, TIME_NOW);

  13318 14 000576   000010 236000 15                 LDQ     8
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:133  
        14 000577   222724 756100                    STQ     @VLEN+4,,AUTO
        14 000600   200113 630500                    EPPR0   TIME_THEN,,AUTO
        14 000601   222723 450500                    STP0    @VLEN+3,,AUTO
        14 000602   200114 631500                    EPPR1   UTS_DIFF,,AUTO
        14 000603   222722 451500                    STP1    @VLEN+2,,AUTO
        14 000604   222722 630500                    EPPR0   @VLEN+2,,AUTO
        14 000605   000021 631400 xsym               EPPR1   B_VECTNIL+17
        14 000606   000000 701000 xent               TSX1    XUD$UTS_DIFF_SEC
        14 000607   000000 011000                    NOP     0

      683    13319    4                   WAIT_A_WHILE.V.UNITS# = MAXIMUM( UTS_DIFF+1, 15);

  13319 14 000610   200114 236100                    LDQ     UTS_DIFF,,AUTO
        14 000611   000001 036007                    ADLQ    1,DL
        14 000612   000017 116007                    CMPQ    15,DL
        14 000613   000615 605000 14                 TPL     s:13319+5
        14 000614   000017 236007                    LDQ     15,DL
        14 000615   000256 756000 6                  STQ     WAIT_A_WHILE+4

      684    13320    4                   END;

      685    13321    3               XUG_GETCMD.DCB_PARAM# = DCBNUM( NIL);

  13321 14 000616   000760 450000 6                  STZ     XUG_GETCMD+12

      686    13322    3               XUG_GETCMD.DISP# = %SAVE#;

  13322 14 000617   000002 235007                    LDA     2,DL
        14 000620   000762 755000 6                  STA     XUG_GETCMD+14

      687    13323    3               CALL XUG$CLOSE_DCBS( XUG_GETCMD);

  13323 14 000621   000011 630400 15                 EPPR0   9
        14 000622   000017 631400 xsym               EPPR1   B_VECTNIL+15
        14 000623   000000 701000 xent               TSX1    XUG$CLOSE_DCBS
        14 000624   000000 011000                    NOP     0

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:134  
      688    13324    3               IDLE.L# = 19;

  13324 14 000625   023000 236003                    LDQ     9728,DU
        14 000626   000652 552040 6                  STBQ    IDLE,'40'O

      689    13325    3               CALL M$TIME( GET_UTS_NOW);

  13325 14 000627   001576 630400 1                  EPPR0   GET_UTS_NOW
        14 000630   020004 713400                    CLIMB   8196
        14 000631   402000 401760                    pmme    nvectors=5

      690    13326    3               CALL XUD$UTS_ADJUST( TIME_NOW, TIME_NOW, 100*WAIT_A_WHILE.V.UNITS#);

  13326 14 000632   000256 236000 6                  LDQ     WAIT_A_WHILE+4
        14 000633   000144 402007                    MPY     100,DL
        14 000634   222722 756100                    STQ     @VLEN+2,,AUTO
        14 000635   222722 630500                    EPPR0   @VLEN+2,,AUTO
        14 000636   222725 450500                    STP0    @VLEN+5,,AUTO
        14 000637   000010 236000 15                 LDQ     8
        14 000640   222724 756100                    STQ     @VLEN+4,,AUTO
        14 000641   222723 756100                    STQ     @VLEN+3,,AUTO
        14 000642   222723 630500                    EPPR0   @VLEN+3,,AUTO
        14 000643   000021 631400 xsym               EPPR1   B_VECTNIL+17
        14 000644   000000 701000 xent               TSX1    XUD$UTS_ADJUST
        14 000645   000000 011000                    NOP     0

      691    13327    3               CALL M$TIME( GET_WAKEUP_TIME);

  13327 14 000646   001626 630400 1                  EPPR0   GET_WAKEUP_TIME
        14 000647   020004 713400                    CLIMB   8196
        14 000650   402000 401760                    pmme    nvectors=5

      692    13328    3               SUBSTR( IDLE.NAME#, 11, 8) = TIMEBUF2;

  13328 14 000651   040000 100400                    MLR     fill='040'O
        14 000652   003447 000010 6                  ADSC9   TIMEBUF2                 cn=0,n=8
        14 000653   000655 000010 6                  ADSC9   IDLE+3                   cn=0,n=8
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:135  

      693    13329    3               CALL STATUS_UPDATE( IDLE);

  13329 14 000654   000002 236000 15                 LDQ     2
        14 000655   222715 756100                    STQ     LAST+2,,AUTO
        14 000656   013522 701000 14                 TSX1    STATUS_UPDATE
        14 000657   000000 011000                    NOP     0

      694    13330    3               CALL M$WAIT( WAIT_A_WHILE);

  13330 14 000660   000252 630400 6                  EPPR0   WAIT_A_WHILE
        14 000661   020006 713400                    CLIMB   8198
        14 000662   400400 401760                    pmme    nvectors=2

      695    13331    3               END;

      696    13332    2           END;

  13332 14 000663   200112 234100                    SZN     TERMINATING,,AUTO
        14 000664   000165 605000 14                 TPL     s:13217

      697    13333    1   EOJ:
      698    13334            /****** PROGRAM TERMINIATION ******/
      699    13335    1       XUG_GETCMD.DCB_PARAM# = DCBNUM( NIL);

  13335 14 000665   000760 450000 6     EOJ          STZ     XUG_GETCMD+12

      700    13336    1       XUG_GETCMD.DISP# = %SAVE#;

  13336 14 000666   000002 235007                    LDA     2,DL
        14 000667   000762 755000 6                  STA     XUG_GETCMD+14

      701    13337    1       CALL XUG$CLOSE_DCBS( XUG_GETCMD);

  13337 14 000670   000011 630400 15                 EPPR0   9
        14 000671   000017 631400 xsym               EPPR1   B_VECTNIL+15
        14 000672   000000 701000 xent               TSX1    XUG$CLOSE_DCBS
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:136  
        14 000673   000000 011000                    NOP     0

      702    13338    1       CALL TCM$WRITE_AUDIT_OFF;

  13338 14 000674   000002 631400 xsym               EPPR1   B_VECTNIL+2
        14 000675   000000 701000 xent               TSX1    TCM$WRITE_AUDIT_OFF
        14 000676   000000 011000                    NOP     0

      703    13339    1       RETURN /* TO IBEX */;

  13339 14 000677   000000 702200 xent               TSX2  ! X66_MARET

      704    13340        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:137  
      705    13341    1   INITIALIZE_CONFIGURATION: PROC ALTRET;

  13341 14 000700   222352 741300       INITIALIZE_* STX1  ! ALIAS$+2,,AUTO

      706    13342
      707    13343    2       DCL ERROR_FLAG BIT(1);
      708    13344    2       DCL HAVE_A_CMD BIT(1);
      709    13345    2       DCL I SBIN;
      710    13346    2       DCL J SBIN;
      711    13347    2       DCL OPT$ PTR;
      712    13348    2       DCL SUB$ PTR;
      713    13349    2       DCL CHARS CHAR(512) BASED CALIGNED;
      714    13350
      715    13351    2       SITES = 0;

  13351 14 000701   200126 450100                    STZ     SITES,,AUTO

      716    13352    2       NODES = 0;

  13352 14 000702   200131 450100                    STZ     NODES,,AUTO

      717    13353    2       REWRITES = 0;

  13353 14 000703   222342 450100                    STZ     REWRITES,,AUTO

      718    13354    2       ERROR_FLAG = %NO#;

  13354 14 000704   222353 450100                    STZ     ERROR_FLAG,,AUTO

      719    13355    2       CALL XUG$INIT( XUG_GETCMD, XUG_INIT);

  13355 14 000705   000012 630400 15                 EPPR0   10
        14 000706   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 000707   000000 701000 xent               TSX1    XUG$INIT
        14 000710   000000 011000                    NOP     0

      720    13356    2   SCAN:
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:138  
      721    13357    3       DO FOREVER;

  13357 14 000711                       SCAN         null
      722    13358    3           HAVE_A_CMD = %NO#;

  13358 14 000711   222354 450100                    STZ     HAVE_A_CMD,,AUTO

      723    13359    4           DO UNTIL( HAVE_A_CMD);

      724    13360    4               CALL XUG$GETCMD( XUG_GETCMD)

  13360 14 000712   000011 630400 15                 EPPR0   9
        14 000713   000017 631400 xsym               EPPR1   B_VECTNIL+15
        14 000714   000000 701000 xent               TSX1    XUG$GETCMD
        14 000715   000721 702000 14                 TSX2    s:13365

      725    13361    5               WHENRETURN DO;

      726    13362    5                   HAVE_A_CMD = %YES#;

  13362 14 000716   400000 236003                    LDQ     -131072,DU
        14 000717   222354 756100                    STQ     HAVE_A_CMD,,AUTO

      727    13363    5                   END;

  13363 14 000720   000747 710000 14                 TRA     s:13375

      728    13364    5               WHENALTRETURN DO;

      729    13365    5                   IF XUG_GETCMD.ERR#.MON# AND

  13365 14 000721   000745 236000 6                  LDQ     XUG_GETCMD+1
        14 000722   400000 316007                    CANQ    -131072,DL
        14 000723   000730 600000 14                 TZE     s:13368
        14 000724   000745 236000 6                  LDQ     XUG_GETCMD+1
        14 000725   377770 376007                    ANQ     131064,DL
        14 000726   000060 116007                    CMPQ    48,DL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:139  
        14 000727   002333 600000 14                 TZE     s:13578

      730    13366    5                           XUG_GETCMD.ERR#.CODE# = %E$EOF THEN
      731    13367    5                       EXIT SCAN;
      732    13368    5                   ERROR_FLAG = %YES#;

  13368 14 000730   400000 236003                    LDQ     -131072,DU
        14 000731   222353 756100                    STQ     ERROR_FLAG,,AUTO

      733    13369    5                   XUG_GETCMD.ERR_CODE = XUG_GETCMD.ERR#;

  13369 14 000732   000745 236000 6                  LDQ     XUG_GETCMD+1
        14 000733   000754 756000 6                  STQ     XUG_GETCMD+8

      734    13370    5                   CALL XUG$ECHOIF( XUG_GETCMD);

  13370 14 000734   000011 630400 15                 EPPR0   9
        14 000735   000017 631400 xsym               EPPR1   B_VECTNIL+15
        14 000736   000000 701000 xent               TSX1    XUG$ECHOIF
        14 000737   000000 011000                    NOP     0

      735    13371    5                   CALL XUG$ERRMSG( XUG_GETCMD);

  13371 14 000740   000011 630400 15                 EPPR0   9
        14 000741   000017 631400 xsym               EPPR1   B_VECTNIL+15
        14 000742   000000 701000 xent               TSX1    XUG$ERRMSG
        14 000743   000000 011000                    NOP     0

      736    13372    5                   IF XUG_GETCMD.ERR#.MON# THEN

  13372 14 000744   000745 236000 6                  LDQ     XUG_GETCMD+1
        14 000745   400000 316007                    CANQ    -131072,DL
        14 000746   002333 601000 14                 TNZ     s:13578

      737    13373    5                       EXIT SCAN;
      738    13374    5                   END;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:140  
      739    13375    4               END;

  13375 14 000747   222354 234100                    SZN     HAVE_A_CMD,,AUTO
        14 000750   000712 605000 14                 TPL     s:13360

      740    13376    3           OUT$ = XUG_GETCMD.OUT$;

  13376 14 000751   000745 236000 6                  LDQ     XUG_GETCMD+1
        14 000752   200111 756100                    STQ     OUT$,,AUTO

      741    13377    3   CMD:
      742    13378    4           DO CASE( OUT$BLK.CODE);

  13378 14 000753   200111 470500       CMD          LDP0    OUT$,,AUTO
        14 000754   000000 236100                    LDQ     0,,PR0
        14 000755   777777 376007                    ANQ     -1,DL
        14 000756   000145 136007                    SBLQ    101,DL
        14 000757   000007 116007                    CMPQ    7,DL
        14 000760   000762 602006 14                 TNC     CMD+7,QL
        14 000761   000711 710000 14                 TRA     SCAN
        14 000762   001211 710000 14                 TRA     s:13426
        14 000763   001231 710000 14                 TRA     s:13431
        14 000764   002033 710000 14                 TRA     s:13518
        14 000765   002332 710000 14                 TRA     s:13577
        14 000766   002300 710000 14                 TRA     s:13567
        14 000767   002332 710000 14                 TRA     s:13577
        14 000770   000771 710000 14                 TRA     s:13382

      743    13379    4               CASE( %NULL_CMD);

      744    13380                        /* do nothing */
      745    13381    4               CASE( %SET_CMD);

      746    13382    4                   OPT$ = OUT$BLK.SUBLK$(0);

  13382 14 000771   000003 236100                    LDQ     3,,PR0
        14 000772   222357 756100                    STQ     OPT$,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:141  

      747    13383    4                   SUB$ = OPT$->OUT$BLK.SUBLK$(0);

  13383 14 000773   222357 471500                    LDP1    OPT$,,AUTO
        14 000774   100003 236100                    LDQ     3,,PR1
        14 000775   222360 756100                    STQ     SUB$,,AUTO

      748    13384    5                   DO CASE( OPT$->OUT$BLK.CODE);

  13384 14 000776   100000 236100                    LDQ     0,,PR1
        14 000777   777777 376007                    ANQ     -1,DL
        14 001000   000361 136007                    SBLQ    241,DL
        14 001001   000011 116007                    CMPQ    9,DL
        14 001002   001004 602006 14                 TNC     s:13384+6,QL
        14 001003   000711 710000 14                 TRA     SCAN
        14 001004   001015 710000 14                 TRA     s:13386
        14 001005   001025 710000 14                 TRA     s:13388
        14 001006   001035 710000 14                 TRA     s:13390
        14 001007   001045 710000 14                 TRA     s:13392
        14 001010   001064 710000 14                 TRA     s:13396
        14 001011   001174 710000 14                 TRA     s:13420
        14 001012   001174 710000 14                 TRA     s:13420
        14 001013   001174 710000 14                 TRA     s:13420
        14 001014   001174 710000 14                 TRA     s:13420

      749    13385    5                       CASE( %ACCOUNT);

      750    13386    5                           TCM_ACCOUNT.ACCT# = SUB$->OUT$SYM.TEXT;

  13386 14 001015   222360 473500                    LDP3    SUB$,,AUTO
        14 001016   300004 236100                    LDQ     4,,PR3
        14 001017   000033 772000                    QRL     27
        14 001020   000000 620006                    EAX0    0,QL
        14 001021   040000 100540                    MLR     fill='040'O
        14 001022   300004 200010                    ADSC9   4,,PR3                   cn=1,n=*X0
        14 001023   000232 000010 6                  ADSC9   TCM_ACCOUNT              cn=0,n=8
        14 001024   000711 710000 14                 TRA     SCAN
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:142  

      751    13387    5                       CASE( %MESSACCT);

      752    13388    5                           TCM_MESSACCT.ACCT# = SUB$->OUT$SYM.TEXT;

  13388 14 001025   222360 473500                    LDP3    SUB$,,AUTO
        14 001026   300004 236100                    LDQ     4,,PR3
        14 001027   000033 772000                    QRL     27
        14 001030   000000 620006                    EAX0    0,QL
        14 001031   040000 100540                    MLR     fill='040'O
        14 001032   300004 200010                    ADSC9   4,,PR3                   cn=1,n=*X0
        14 001033   000234 000010 6                  ADSC9   TCM_MESSACCT             cn=0,n=8
        14 001034   000711 710000 14                 TRA     SCAN

      753    13389    5                       CASE( %STUCKEE);

      754    13390    5                           TCM_STUCKEE = SUB$->OUT$SYM.TEXT;

  13390 14 001035   222360 473500                    LDP3    SUB$,,AUTO
        14 001036   300004 236100                    LDQ     4,,PR3
        14 001037   000033 772000                    QRL     27
        14 001040   000000 620006                    EAX0    0,QL
        14 001041   040000 100540                    MLR     fill='040'O
        14 001042   300004 200010                    ADSC9   4,,PR3                   cn=1,n=*X0
        14 001043   001175 000040 6                  ADSC9   TCM_STUCKEE              cn=0,n=32
        14 001044   000711 710000 14                 TRA     SCAN

      755    13391    5                       CASE( %LOGON);

      756    13392    5                           CALL CONCAT( TCM_LOGON,

  13392 14 001045   222360 473500                    LDP3    SUB$,,AUTO
        14 001046   300004 236100                    LDQ     4,,PR3
        14 001047   000033 772000                    QRL     27
        14 001050   000000 620006                    EAX0    0,QL
        14 001051   040000 100540                    MLR     fill='040'O
        14 001052   300004 200010                    ADSC9   4,,PR3                   cn=1,n=*X0
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:143  
        14 001053   000000 000040 xsym               ADSC9   TCM_LOGON                cn=0,n=32
        14 001054   000040 116007                    CMPQ    32,DL
        14 001055   001063 603000 14                 TRC     s:13392+14
        14 001056   777737 620006                    EAX0    -33,QL
        14 001057   777777 660003                    ERX0    -1,DU
        14 001060   040046 100400                    MLR     fill='040'O
        14 001061   000014 000001 15                 ADSC9   12                       cn=0,n=1
        14 001062   000000 000010 xsym               ADSC9   TCM_LOGON,Q              cn=0,n=*X0
        14 001063   000711 710000 14                 TRA     SCAN

      757    13393    5                                   SUB$->OUT$SYM.TEXT,
      758    13394    5                                   BITASC( '015'O));
      759    13395    5                       CASE( %TIMEZONE);

      760    13396    5                           I = SUB$->OUT$SYM.CPOS;

  13396 14 001064   222360 473500                    LDP3    SUB$,,AUTO
        14 001065   300002 235100                    LDA     2,,PR3
        14 001066   222355 755100                    STA     I,,AUTO

      761    13397    5                           J = P$PCB.HI_CHAR - I;

  13397 14 001067   000747 474400 6                  LDP4    XUG_GETCMD+3
        14 001070   400012 236100                    LDQ     10,,PR4
        14 001071   222355 136100                    SBLQ    I,,AUTO
        14 001072   222356 756100                    STQ     J,,AUTO

      762    13398    5                           CALL CONCAT( TCM_TZTEXT, ' ',

  13398 14 001073   400000 475500                    LDP5    0,,PR4
        14 001074   040000 236003                    LDQ     16384,DU
        14 001075   001205 756000 6                  STQ     TCM_TZTEXT
        14 001076   222356 720100                    LXL0    J,,AUTO
        14 001077   040000 100545                    MLR     fill='040'O
        14 001100   500000 000010                    ADSC9   0,A,PR5                  cn=0,n=*X0
        14 001101   001205 200005 6                  ADSC9   TCM_TZTEXT               cn=1,n=5

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:144  
      763    13399    5                                   SUBSTR( P$PCB.TEXT$->CHARS, I, J));
      764    13400    6                           DO CASE( SUB$->OUT$SYM.CODE);

  13400 14 001102   222360 470500                    LDP0    SUB$,,AUTO
        14 001103   000000 236100                    LDQ     0,,PR0
        14 001104   777777 376007                    ANQ     -1,DL
        14 001105   000170 136007                    SBLQ    120,DL
        14 001106   000003 116007                    CMPQ    3,DL
        14 001107   001111 602006 14                 TNC     s:13400+7,QL
        14 001110   000711 710000 14                 TRA     SCAN
        14 001111   001114 710000 14                 TRA     s:13402
        14 001112   001153 710000 14                 TRA     s:13410
        14 001113   001166 710000 14                 TRA     s:13415

      765    13401    6                               CASE( %TZUTO);

      766    13402    6                                   CALL CHARBIN( I,

  13402 14 001114   000004 471500                    LDP1    4,,PR0
        14 001115   100004 236100                    LDQ     4,,PR1
        14 001116   000033 772000                    QRL     27
        14 001117   000000 620006                    EAX0    0,QL
        14 001120   000100 305540                    DTB
        14 001121   100004 230010                    NDSC9   4,,PR1                   cn=1,s=nosgn,sf=0,n=*X0
        14 001122   222355 000004                    NDSC9   I,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

      767    13403    6                                           SUB$->OUT$BLK.SUBLK$(1)->OUT$SYM.TEXT);
      768    13404    6                                   TCM_UTOFFSET = ( ( I / 100) * %UTS_CSEC_HOUR#) +

  13404 14 001123   222355 236100                    LDQ     I,,AUTO
        14 001124   000144 506007                    DIV     100,DL
        14 001125   222722 756100                    STQ     @VLEN+2,,AUTO
        14 001126   222355 236100                    LDQ     I,,AUTO
        14 001127   000144 506007                    DIV     100,DL
        14 001130   222723 755100                    STA     @VLEN+3,,AUTO
        14 001131   222722 236100                    LDQ     @VLEN+2,,AUTO
        14 001132   000074 402007                    MPY     60,DL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:145  
        14 001133   222723 036100                    ADLQ    @VLEN+3,,AUTO
        14 001134   013560 402007                    MPY     6000,DL
        14 001135   001207 756000 6                  STQ     TCM_UTOFFSET

      769    13405    6                                           MOD( I, 100) * %UTS_CSEC_MIN#;
      770    13406    6                                   IF SUB$->OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT > 0 THEN

  13406 14 001136   000003 471500                    LDP1    3,,PR0
        14 001137   100004 236100                    LDQ     4,,PR1
        14 001140   777000 316003                    CANQ    -512,DU
        14 001141   000711 600000 14                 TZE     SCAN

      771    13407    6                                       IF '-' = SUBSTR( SUB$->OUT$BLK.SUBLK$(0)->
             13407                                                OUT$SYM.TEXT, 0, 1) THEN

  13407 14 001142   100004 236100                    LDQ     4,,PR1
        14 001143   000033 772000                    QRL     27
        14 001144   100004 236100                    LDQ     4,,PR1
        14 001145   000777 376003                    ANQ     511,DU
        14 001146   000055 116003                    CMPQ    45,DU
        14 001147   000711 601000 14                 TNZ     SCAN

      772    13408    6                                           TCM_UTOFFSET = -TCM_UTOFFSET;

  13408 14 001150   001207 335000 6                  LCA     TCM_UTOFFSET
        14 001151   001207 755000 6                  STA     TCM_UTOFFSET
        14 001152   000711 710000 14                 TRA     SCAN

      773    13409    6                               CASE( %TZMIL);

      774    13410    6                                   CALL INDEX( I,

  13410 14 001153   000004 236100                    LDQ     4,,PR0
        14 001154   000033 772000                    QRL     27
        14 001155   000100 124400                    SCM     mask='000'O
        14 001156   002714 000031 1                  ADSC9   TCM_XLATE_TO_UC+151      cn=0,n=25
        14 001157   000004 200001                    ADSC9   4,,PR0                   cn=1,n=1
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:146  
        14 001160   222355 000100                    ARG     I,,AUTO

      775    13411    6                                           SUBSTR( SUB$->OUT$SYM.TEXT, 0, 1),
      776    13412    6                                           'MLKIHGFEDCBAZNOPQRSTUVWXY');
      777    13413    6                                   TCM_UTOFFSET = ( I - 12) * %UTS_CSEC_HOUR#;

  13413 14 001161   222355 236100                    LDQ     I,,AUTO
        14 001162   000006 402000 15                 MPY     6
        14 001163   000015 136000 15                 SBLQ    13
        14 001164   001207 756000 6                  STQ     TCM_UTOFFSET
        14 001165   000711 710000 14                 TRA     SCAN

      778    13414    6                               CASE( %TZCMN);

      779    13415    6                                   TCM_UTOFFSET =

  13415 14 001166   000003 471500                    LDP1    3,,PR0
        14 001167   100000 720100                    LXL0    0,,PR1
        14 001170   002132 236010 1                  LDQ     CMN2UTS,X0
        14 001171   000006 402000 15                 MPY     6
        14 001172   001207 756000 6                  STQ     TCM_UTOFFSET

      780    13416    6                                           CMN2UTS( SUB$->OUT$BLK.SUBLK$(0)->OUT$SYM.
             13416                                                    CODE)
      781    13417    6                                           * %UTS_CSEC_HOUR#;
      782    13418    6                               END;

  13418 14 001173   000711 710000 14                 TRA     SCAN

      783    13419    5                       CASE( %PHONE0, %PHONE1, %PHONE2, %PHONE3);

      784    13420    5                           TCM_PHONE( OPT$->OUT$BLK.CODE - %PHONE0) =

  13420 14 001174   100000 236100                    LDQ     0,,PR1
        14 001175   777777 376007                    ANQ     -1,DL
        14 001176   000013 402007                    MPY     11,DL
        14 001177   222360 473500                    LDP3    SUB$,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:147  
        14 001200   222722 756100                    STQ     @VLEN+2,,AUTO
        14 001201   300004 236100                    LDQ     4,,PR3
        14 001202   000033 772000                    QRL     27
        14 001203   000000 620006                    EAX0    0,QL
        14 001204   222722 235100                    LDA     @VLEN+2,,AUTO
        14 001205   040005 100540                    MLR     fill='040'O
        14 001206   300004 200010                    ADSC9   4,,PR3                   cn=1,n=*X0
        14 001207   777743 400013 6                  ADSC9   TIMEBUF2-1860,A          cn=2,n=11
        14 001210   000711 710000 14                 TRA     SCAN

      785    13421    5                                   SUB$->OUT$SYM.TEXT;
      786    13422    5                       CASE( ELSE);

      787    13423                                /* do nothing; ignore this SET command */
      788    13424    5                       END;

      789    13425    4               CASE( %IAM_CMD);

      790    13426    4                   NODENAME.COUNT = OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT;

  13426 14 001211   000003 471500                    LDP1    3,,PR0
        14 001212   100004 236100                    LDQ     4,,PR1
        14 001213   001127 552040 6                  STBQ    NODENAME,'40'O

      791    13427    4                   NODENAME.TEXT = OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT;

  13427 14 001214   100004 236100                    LDQ     4,,PR1
        14 001215   000033 772000                    QRL     27
        14 001216   000000 620006                    EAX0    0,QL
        14 001217   040000 100540                    MLR     fill='040'O
        14 001220   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
        14 001221   001127 200077 6                  ADSC9   NODENAME                 cn=1,n=63

      792    13428    4                   SITE_NAME.COUNT = NODENAME.COUNT;

  13428 14 001222   001127 236000 6                  LDQ     NODENAME
        14 001223   001147 552040 6                  STBQ    SITE_NAME,'40'O
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:148  

      793    13429    4                   CALL XLATE( SITE_NAME.TEXT, TCM_XLATE_TO_UC, NODENAME.TEXT);

  13429 14 001224   040000 160400                    MVT     fill='040'O
        14 001225   001127 200077 6                  ADSC9   NODENAME                 cn=1,n=63
        14 001226   001147 200077 6                  ADSC9   SITE_NAME                cn=1,n=63
        14 001227   002465 000000 1                  ARG     TCM_XLATE_TO_UC
        14 001230   000711 710000 14                 TRA     SCAN

      794    13430    4               CASE( %SITE_CMD);

      795    13431    5                   IF SITES = %MAX_SMTP_SITE THEN DO;

  13431 14 001231   200126 235100                    LDA     SITES,,AUTO
        14 001232   000011 115007                    CMPA    9,DL
        14 001233   001244 601000 14                 TNZ     s:13438

      796    13432    5                       CMDBUF = 'Site table overflow;  site not recorded.';

  13432 14 001234   040000 100400                    MLR     fill='040'O
        14 001235   002723 000050 1                  ADSC9   TCM_XLATE_TO_UC+158      cn=0,n=40
        14 001236   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

      797    13433    5   TELLUSER:
      798    13434    5                       ERROR_FLAG = %YES#;

  13434 14 001237   400000 236003       TELLUSER     LDQ     -131072,DU
        14 001240   222353 756100                    STQ     ERROR_FLAG,,AUTO

      799    13435    5                       CALL WRITEDO;

  13435 14 001241   013551 701000 14                 TSX1    WRITEDO
        14 001242   000000 011000                    NOP     0

      800    13436    5                       EXIT CMD;

  13436 14 001243   002332 710000 14                 TRA     s:13577
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:149  

      801    13437    5                       END;
      802    13438    5                   DO I = 0 TO OUT$BLK.NSUBLKS - 1;

  13438 14 001244   222355 450100                    STZ     I,,AUTO
        14 001245   001674 710000 14                 TRA     s:13502+1

      803    13439    5                       OPT$ = OUT$BLK.SUBLK$( I);

  13439 14 001246   200111 470500                    LDP0    OUT$,,AUTO
        14 001247   222355 720100                    LXL0    I,,AUTO
        14 001250   000003 236110                    LDQ     3,X0,PR0
        14 001251   222357 756100                    STQ     OPT$,,AUTO

      804    13440    6                       DO CASE( OUT$BLK.SUBLK$( I)->OUT$BLK.CODE);

  13440 14 001252   000003 471510                    LDP1    3,X0,PR0
        14 001253   100000 236100                    LDQ     0,,PR1
        14 001254   777777 376007                    ANQ     -1,DL
        14 001255   000310 136007                    SBLQ    200,DL
        14 001256   000037 116007                    CMPQ    31,DL
        14 001257   001261 602006 14                 TNC     s:13440+7,QL
        14 001260   001462 710000 14                 TRA     s:13468
        14 001261   001424 710000 14                 TRA     s:13462
        14 001262   001436 710000 14                 TRA     s:13464
        14 001263   001525 710000 14                 TRA     s:13477
        14 001264   001541 710000 14                 TRA     s:13480
        14 001265   001475 710000 14                 TRA     s:13471
        14 001266   001511 710000 14                 TRA     s:13474
        14 001267   001555 710000 14                 TRA     s:13483
        14 001270   001600 710000 14                 TRA     s:13488
        14 001271   001623 710000 14                 TRA     s:13493
        14 001272   001450 710000 14                 TRA     s:13466
        14 001273   001462 710000 14                 TRA     s:13468
        14 001274   001462 710000 14                 TRA     s:13468
        14 001275   001462 710000 14                 TRA     s:13468
        14 001276   001646 710000 14                 TRA     s:13498
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:150  
        14 001277   001661 710000 14                 TRA     s:13500
        14 001300   001462 710000 14                 TRA     s:13468
        14 001301   001462 710000 14                 TRA     s:13468
        14 001302   001462 710000 14                 TRA     s:13468
        14 001303   001462 710000 14                 TRA     s:13468
        14 001304   001462 710000 14                 TRA     s:13468
        14 001305   001462 710000 14                 TRA     s:13468
        14 001306   001462 710000 14                 TRA     s:13468
        14 001307   001462 710000 14                 TRA     s:13468
        14 001310   001462 710000 14                 TRA     s:13468
        14 001311   001462 710000 14                 TRA     s:13468
        14 001312   001462 710000 14                 TRA     s:13468
        14 001313   001462 710000 14                 TRA     s:13468
        14 001314   001462 710000 14                 TRA     s:13468
        14 001315   001462 710000 14                 TRA     s:13468
        14 001316   001462 710000 14                 TRA     s:13468
        14 001317   001320 710000 14                 TRA     s:13442

      805    13441    6                           CASE( %SITENAME);

      806    13442    6                               SITE.NAME.COUNT( SITES) = OPT$->OUT$SYM.COUNT;

  13442 14 001320   200126 236100                    LDQ     SITES,,AUTO
        14 001321   000072 402007                    MPY     58,DL
        14 001322   222357 473500                    LDP3    OPT$,,AUTO
        14 001323   000000 621006                    EAX1    0,QL
        14 001324   300004 236100                    LDQ     4,,PR3
        14 001325   200146 676111                    ERQ     SITE,X1,AUTO
        14 001326   777000 376003                    ANQ     -512,DU
        14 001327   200146 656111                    ERSQ    SITE,X1,AUTO

      807    13443    6                               CALL XLATE(SITE.NAME.TEXT( SITES), TCM_XLATE_TO_UC,

  13443 14 001330   300004 236100                    LDQ     4,,PR3
        14 001331   000033 772000                    QRL     27
        14 001332   000000 622006                    EAX2    0,QL
        14 001333   200126 236100                    LDQ     SITES,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:151  
        14 001334   000350 402007                    MPY     232,DL
        14 001335   040106 160540                    MVT     fill='040'O
        14 001336   300004 200012                    ADSC9   4,,PR3                   cn=1,n=*X2
        14 001337   200146 200037                    ADSC9   SITE,Q,AUTO              cn=1,n=31
        14 001340   002465 000000 1                  ARG     TCM_XLATE_TO_UC

      808    13444    6                                       OPT$->OUT$SYM.TEXT);
      809    13445    6                               CALL CONCAT( SITE.LOGON( SITES),

  13445 14 001341   300004 236100                    LDQ     4,,PR3
        14 001342   000033 772000                    QRL     27
        14 001343   000000 622006                    EAX2    0,QL
        14 001344   200126 236100                    LDQ     SITES,,AUTO
        14 001345   000350 402007                    MPY     232,DL
        14 001346   040106 100540                    MLR     fill='040'O
        14 001347   300004 200012                    ADSC9   4,,PR3                   cn=1,n=*X2
        14 001350   200156 000040                    ADSC9   SITE+8,Q,AUTO            cn=0,n=32
        14 001351   000000 636012                    EAQ     0,X2
        14 001352   000022 772000                    QRL     18
        14 001353   000040 116007                    CMPQ    32,DL
        14 001354   001370 603000 14                 TRC     s:13447
        14 001355   000000 635012                    EAA     0,X2
        14 001356   000022 771000                    ARL     18
        14 001357   222722 755100                    STA     @VLEN+2,,AUTO
        14 001360   200126 236100                    LDQ     SITES,,AUTO
        14 001361   000350 402007                    MPY     232,DL
        14 001362   222722 036100                    ADLQ    @VLEN+2,,AUTO
        14 001363   777737 622012                    EAX2    -33,X2
        14 001364   777777 662003                    ERX2    -1,DU
        14 001365   040146 100400                    MLR     fill='040'O
        14 001366   000016 000001 15                 ADSC9   14                       cn=0,n=1
        14 001367   200156 000012                    ADSC9   SITE+8,Q,AUTO            cn=0,n=*X2

      810    13446    6                                       OPT$->OUT$SYM.TEXT, ';');
      811    13447    6                               SITE.ADDRESS( SITES) = ' ';

  13447 14 001370   200126 236100                    LDQ     SITES,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:152  
        14 001371   000350 402007                    MPY     232,DL
        14 001372   040106 100400                    MLR     fill='040'O
        14 001373   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 001374   200166 000040                    ADSC9   SITE+16,Q,AUTO           cn=0,n=32

      812    13448    6                               SITE.IDENT( SITES) = NODENAME;

  13448 14 001375   000106 100400                    MLR     fill='000'O
        14 001376   001127 000040 6                  ADSC9   NODENAME                 cn=0,n=32
        14 001377   200176 000040                    ADSC9   SITE+24,Q,AUTO           cn=0,n=32

      813    13449    6                               SITE.TYPE( SITES) = %SMTP_MULTICS;

  13449 14 001400   001111 235007                    LDA     585,DL
        14 001401   200226 755111                    STA     SITE+48,X1,AUTO

      814    13450    6                               SITE.TRY_INTERVAL( SITES) = 5;

  13450 14 001402   000005 235007                    LDA     5,DL
        14 001403   200230 755111                    STA     SITE+50,X1,AUTO

      815    13451    6                               SITE.RETRY_INTERVAL( SITES) = 15;

  13451 14 001404   000017 235007                    LDA     15,DL
        14 001405   200231 755111                    STA     SITE+51,X1,AUTO

      816    13452    6                               SITE.FROM_TIME( SITES) = 0000;

  13452 14 001406   200232 450111                    STZ     SITE+52,X1,AUTO

      817    13453    6                               SITE.TO_TIME( SITES) = 2359;

  13453 14 001407   004467 235007                    LDA     2359,DL
        14 001410   200233 755111                    STA     SITE+53,X1,AUTO

      818    13454    6                               SITE.LAST_TRY( SITES) = 0;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:153  
  13454 14 001411   200234 450111                    STZ     SITE+54,X1,AUTO

      819    13455    6                               SITE.NEXT_TRY( SITES) = 0;

  13455 14 001412   200235 450111                    STZ     SITE+55,X1,AUTO

      820    13456    6                               SITE.LAST_STATUS( SITES) = %SMTP_NOP;

  13456 14 001413   200236 450111                    STZ     SITE+56,X1,AUTO

      821    13457    6                               SITE.OWN_REVERSE_PATH.COUNT( SITES) = 0;

  13457 14 001414   000032 236000 xsym               LDQ     B_VECTNIL+26
        14 001415   200206 356111                    ANSQ    SITE+32,X1,AUTO

      822    13458    6                               SITE.INDIRECT_REVERSE_PATH.COUNT( SITES) = 0;

  13458 14 001416   200216 356111                    ANSQ    SITE+40,X1,AUTO

      823    13459    6                               SITE.RR_ACTION( SITES) = %DEFAULT;

  13459 14 001417   000017 236000 15                 LDQ     15
        14 001420   200237 356111                    ANSQ    SITE+57,X1,AUTO

      824    13460    6                               SITE.DR_ACTION( SITES) = %DEFAULT;

  13460 14 001421   000020 236000 15                 LDQ     16
        14 001422   200237 356111                    ANSQ    SITE+57,X1,AUTO
        14 001423   001673 710000 14                 TRA     s:13502

      825    13461    6                           CASE( %LOGON_OPTION);

      826    13462    6                               SITE.LOGON( SITES) = OPT$->OUT$SYM.TEXT;

  13462 14 001424   222357 473500                    LDP3    OPT$,,AUTO
        14 001425   300004 236100                    LDQ     4,,PR3
        14 001426   000033 772000                    QRL     27
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:154  
        14 001427   000000 621006                    EAX1    0,QL
        14 001430   200126 236100                    LDQ     SITES,,AUTO
        14 001431   000350 402007                    MPY     232,DL
        14 001432   040106 100540                    MLR     fill='040'O
        14 001433   300004 200011                    ADSC9   4,,PR3                   cn=1,n=*X1
        14 001434   200156 000040                    ADSC9   SITE+8,Q,AUTO            cn=0,n=32
        14 001435   001673 710000 14                 TRA     s:13502

      827    13463    6                           CASE( %NETWORK_OPTION);

      828    13464    6                               SITE.ADDRESS( SITES) = OPT$->OUT$SYM.TEXT;

  13464 14 001436   222357 473500                    LDP3    OPT$,,AUTO
        14 001437   300004 236100                    LDQ     4,,PR3
        14 001440   000033 772000                    QRL     27
        14 001441   000000 621006                    EAX1    0,QL
        14 001442   200126 236100                    LDQ     SITES,,AUTO
        14 001443   000350 402007                    MPY     232,DL
        14 001444   040106 100540                    MLR     fill='040'O
        14 001445   300004 200011                    ADSC9   4,,PR3                   cn=1,n=*X1
        14 001446   200166 000040                    ADSC9   SITE+16,Q,AUTO           cn=0,n=32
        14 001447   001673 710000 14                 TRA     s:13502

      829    13465    6                           CASE( %IP_ADDRESS);

      830    13466    6                               SITE.ADDRESS( SITES) = OPT$->OUT$SYM.TEXT;

  13466 14 001450   222357 473500                    LDP3    OPT$,,AUTO
        14 001451   300004 236100                    LDQ     4,,PR3
        14 001452   000033 772000                    QRL     27
        14 001453   000000 621006                    EAX1    0,QL
        14 001454   200126 236100                    LDQ     SITES,,AUTO
        14 001455   000350 402007                    MPY     232,DL
        14 001456   040106 100540                    MLR     fill='040'O
        14 001457   300004 200011                    ADSC9   4,,PR3                   cn=1,n=*X1
        14 001460   200166 000040                    ADSC9   SITE+16,Q,AUTO           cn=0,n=32
        14 001461   001673 710000 14                 TRA     s:13502
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:155  

      831    13467    6                           CASE( ELSE);

      832    13468    6                               IF OPT$->OUT$BLK.CODE >= %RES_ALEX THEN

  13468 14 001462   222357 473500                    LDP3    OPT$,,AUTO
        14 001463   300000 721100                    LXL1    0,,PR3
        14 001464   001000 101003                    CMPX1   512,DU
        14 001465   001673 602000 14                 TNC     s:13502

      833    13469    6                                   SITE.TYPE( SITES) = OPT$->OUT$BLK.CODE;

  13469 14 001466   200126 236100                    LDQ     SITES,,AUTO
        14 001467   000072 402007                    MPY     58,DL
        14 001470   000000 622006                    EAX2    0,QL
        14 001471   300000 236100                    LDQ     0,,PR3
        14 001472   777777 376007                    ANQ     -1,DL
        14 001473   200226 756112                    STQ     SITE+48,X2,AUTO
        14 001474   001673 710000 14                 TRA     s:13502

      834    13470    6                           CASE( %TRY_OPTION);

      835    13471    6                               CALL CHARBIN( SITE.TRY_INTERVAL( SITES),

  13471 14 001475   222357 473500                    LDP3    OPT$,,AUTO
        14 001476   300004 236100                    LDQ     4,,PR3
        14 001477   000033 772000                    QRL     27
        14 001500   000000 621006                    EAX1    0,QL
        14 001501   000100 305540                    DTB
        14 001502   300004 230011                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X1
        14 001503   222722 000010                    NDSC9   @VLEN+2,,AUTO            cn=0,s=lsgnf,sf=0,n=8
        14 001504   200126 236100                    LDQ     SITES,,AUTO
        14 001505   000072 402007                    MPY     58,DL
        14 001506   222723 235100                    LDA     @VLEN+3,,AUTO
        14 001507   200230 755106                    STA     SITE+50,QL,AUTO
        14 001510   001673 710000 14                 TRA     s:13502

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:156  
      836    13472    6                                       OPT$->OUT$SYM.TEXT);
      837    13473    6                           CASE( %RETRY_OPTION);

      838    13474    6                               CALL CHARBIN( SITE.RETRY_INTERVAL( SITES),

  13474 14 001511   222357 473500                    LDP3    OPT$,,AUTO
        14 001512   300004 236100                    LDQ     4,,PR3
        14 001513   000033 772000                    QRL     27
        14 001514   000000 621006                    EAX1    0,QL
        14 001515   000100 305540                    DTB
        14 001516   300004 230011                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X1
        14 001517   222722 000010                    NDSC9   @VLEN+2,,AUTO            cn=0,s=lsgnf,sf=0,n=8
        14 001520   200126 236100                    LDQ     SITES,,AUTO
        14 001521   000072 402007                    MPY     58,DL
        14 001522   222723 235100                    LDA     @VLEN+3,,AUTO
        14 001523   200231 755106                    STA     SITE+51,QL,AUTO
        14 001524   001673 710000 14                 TRA     s:13502

      839    13475    6                                       OPT$->OUT$SYM.TEXT);
      840    13476    6                           CASE( %FROM_OPTION);

      841    13477    6                               CALL CHARBIN( SITE.FROM_TIME( SITES),

  13477 14 001525   222357 473500                    LDP3    OPT$,,AUTO
        14 001526   300004 236100                    LDQ     4,,PR3
        14 001527   000033 772000                    QRL     27
        14 001530   000000 621006                    EAX1    0,QL
        14 001531   000100 305540                    DTB
        14 001532   300004 230011                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X1
        14 001533   222722 000010                    NDSC9   @VLEN+2,,AUTO            cn=0,s=lsgnf,sf=0,n=8
        14 001534   200126 236100                    LDQ     SITES,,AUTO
        14 001535   000072 402007                    MPY     58,DL
        14 001536   222723 235100                    LDA     @VLEN+3,,AUTO
        14 001537   200232 755106                    STA     SITE+52,QL,AUTO
        14 001540   001673 710000 14                 TRA     s:13502

      842    13478    6                                       OPT$->OUT$SYM.TEXT);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:157  
      843    13479    6                           CASE( %TO_OPTION);

      844    13480    6                               CALL CHARBIN( SITE.TO_TIME( SITES),

  13480 14 001541   222357 473500                    LDP3    OPT$,,AUTO
        14 001542   300004 236100                    LDQ     4,,PR3
        14 001543   000033 772000                    QRL     27
        14 001544   000000 621006                    EAX1    0,QL
        14 001545   000100 305540                    DTB
        14 001546   300004 230011                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X1
        14 001547   222722 000010                    NDSC9   @VLEN+2,,AUTO            cn=0,s=lsgnf,sf=0,n=8
        14 001550   200126 236100                    LDQ     SITES,,AUTO
        14 001551   000072 402007                    MPY     58,DL
        14 001552   222723 235100                    LDA     @VLEN+3,,AUTO
        14 001553   200233 755106                    STA     SITE+53,QL,AUTO
        14 001554   001673 710000 14                 TRA     s:13502

      845    13481    6                                       OPT$->OUT$SYM.TEXT);
      846    13482    6                           CASE( %IDENT_OPTION);

      847    13483    6                               SITE.IDENT.COUNT( SITES) =

  13483 14 001555   200126 236100                    LDQ     SITES,,AUTO
        14 001556   000072 402007                    MPY     58,DL
        14 001557   222357 473500                    LDP3    OPT$,,AUTO
        14 001560   300003 474500                    LDP4    3,,PR3
        14 001561   000000 621006                    EAX1    0,QL
        14 001562   400004 236100                    LDQ     4,,PR4
        14 001563   200176 676111                    ERQ     SITE+24,X1,AUTO
        14 001564   777000 376003                    ANQ     -512,DU
        14 001565   200176 656111                    ERSQ    SITE+24,X1,AUTO

      848    13484    6                                       OPT$->OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT;
      849    13485    6                               SITE.IDENT.TEXT( SITES) =

  13485 14 001566   300003 471500                    LDP1    3,,PR3
        14 001567   100004 236100                    LDQ     4,,PR1
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:158  
        14 001570   000033 772000                    QRL     27
        14 001571   000000 622006                    EAX2    0,QL
        14 001572   200126 236100                    LDQ     SITES,,AUTO
        14 001573   000350 402007                    MPY     232,DL
        14 001574   040106 100540                    MLR     fill='040'O
        14 001575   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        14 001576   200176 200037                    ADSC9   SITE+24,Q,AUTO           cn=1,n=31
        14 001577   001673 710000 14                 TRA     s:13502

      850    13486    6                                       OPT$->OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT;
      851    13487    6                           CASE( %OWN_REVERSE_PATH_OPTION);

      852    13488    6                               SITE.OWN_REVERSE_PATH.COUNT( SITES) =

  13488 14 001600   200126 236100                    LDQ     SITES,,AUTO
        14 001601   000072 402007                    MPY     58,DL
        14 001602   222357 473500                    LDP3    OPT$,,AUTO
        14 001603   300003 474500                    LDP4    3,,PR3
        14 001604   000000 621006                    EAX1    0,QL
        14 001605   400004 236100                    LDQ     4,,PR4
        14 001606   200206 676111                    ERQ     SITE+32,X1,AUTO
        14 001607   777000 376003                    ANQ     -512,DU
        14 001610   200206 656111                    ERSQ    SITE+32,X1,AUTO

      853    13489    6                                       OPT$->OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT;
      854    13490    6                               SITE.OWN_REVERSE_PATH.TEXT( SITES) =

  13490 14 001611   300003 471500                    LDP1    3,,PR3
        14 001612   100004 236100                    LDQ     4,,PR1
        14 001613   000033 772000                    QRL     27
        14 001614   000000 622006                    EAX2    0,QL
        14 001615   200126 236100                    LDQ     SITES,,AUTO
        14 001616   000350 402007                    MPY     232,DL
        14 001617   040106 100540                    MLR     fill='040'O
        14 001620   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        14 001621   200206 200037                    ADSC9   SITE+32,Q,AUTO           cn=1,n=31
        14 001622   001673 710000 14                 TRA     s:13502
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:159  

      855    13491    6                                       OPT$->OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT;
      856    13492    6                           CASE( %INDIRECT_REVERSE_PATH_OPTION);

      857    13493    6                               SITE.INDIRECT_REVERSE_PATH.COUNT( SITES) =

  13493 14 001623   200126 236100                    LDQ     SITES,,AUTO
        14 001624   000072 402007                    MPY     58,DL
        14 001625   222357 473500                    LDP3    OPT$,,AUTO
        14 001626   300003 474500                    LDP4    3,,PR3
        14 001627   000000 621006                    EAX1    0,QL
        14 001630   400004 236100                    LDQ     4,,PR4
        14 001631   200216 676111                    ERQ     SITE+40,X1,AUTO
        14 001632   777000 376003                    ANQ     -512,DU
        14 001633   200216 656111                    ERSQ    SITE+40,X1,AUTO

      858    13494    6                                       OPT$->OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT;
      859    13495    6                               SITE.INDIRECT_REVERSE_PATH.TEXT( SITES) =

  13495 14 001634   300003 471500                    LDP1    3,,PR3
        14 001635   100004 236100                    LDQ     4,,PR1
        14 001636   000033 772000                    QRL     27
        14 001637   000000 622006                    EAX2    0,QL
        14 001640   200126 236100                    LDQ     SITES,,AUTO
        14 001641   000350 402007                    MPY     232,DL
        14 001642   040106 100540                    MLR     fill='040'O
        14 001643   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        14 001644   200216 200037                    ADSC9   SITE+40,Q,AUTO           cn=1,n=31
        14 001645   001673 710000 14                 TRA     s:13502

      860    13496    6                                       OPT$->OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT;
      861    13497    6                           CASE( %RR_ACTION_OPTION);

      862    13498    6                               SITE.RR_ACTION( SITES) = OPT$->OUT$BLK.SUBLK$(0)->
             13498                                        OUT$BLK.CODE;

  13498 14 001646   200126 236100                    LDQ     SITES,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:160  
        14 001647   000072 402007                    MPY     58,DL
        14 001650   222357 473500                    LDP3    OPT$,,AUTO
        14 001651   300003 474500                    LDP4    3,,PR3
        14 001652   000000 621006                    EAX1    0,QL
        14 001653   400000 236100                    LDQ     0,,PR4
        14 001654   000042 736000                    QLS     34
        14 001655   200237 676111                    ERQ     SITE+57,X1,AUTO
        14 001656   600000 376003                    ANQ     -65536,DU
        14 001657   200237 656111                    ERSQ    SITE+57,X1,AUTO
        14 001660   001673 710000 14                 TRA     s:13502

      863    13499    6                           CASE( %DR_ACTION_OPTION);

      864    13500    6                               SITE.DR_ACTION( SITES) = OPT$->OUT$BLK.SUBLK$(0)->
             13500                                        OUT$BLK.CODE;

  13500 14 001661   200126 236100                    LDQ     SITES,,AUTO
        14 001662   000072 402007                    MPY     58,DL
        14 001663   222357 473500                    LDP3    OPT$,,AUTO
        14 001664   300003 474500                    LDP4    3,,PR3
        14 001665   000000 621006                    EAX1    0,QL
        14 001666   400000 236100                    LDQ     0,,PR4
        14 001667   000040 736000                    QLS     32
        14 001670   200237 676111                    ERQ     SITE+57,X1,AUTO
        14 001671   140000 376003                    ANQ     49152,DU
        14 001672   200237 656111                    ERSQ    SITE+57,X1,AUTO

      865    13501    6                           END;

      866    13502    5                       END;

  13502 14 001673   222355 054100                    AOS     I,,AUTO
        14 001674   000001 236100                    LDQ     1,,PR0
        14 001675   000022 772000                    QRL     18
        14 001676   222355 116100                    CMPQ    I,,AUTO
        14 001677   001246 605400 14                 TPNZ    s:13439

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:161  
      867    13503    5                   IF SITE.OWN_REVERSE_PATH.COUNT( SITES) = 0 THEN DO;

  13503 14 001700   200126 236100                    LDQ     SITES,,AUTO
        14 001701   000072 402007                    MPY     58,DL
        14 001702   200206 236106                    LDQ     SITE+32,QL,AUTO
        14 001703   777000 316003                    CANQ    -512,DU
        14 001704   001733 601000 14                 TNZ     s:13509

      868    13504    5                       CALL CONCAT( SITE.OWN_REVERSE_PATH.TEXT( SITES), '@',

  13504 14 001705   200126 236100                    LDQ     SITES,,AUTO
        14 001706   000072 402007                    MPY     58,DL
        14 001707   000000 620006                    EAX0    0,QL
        14 001710   200206 236106                    LDQ     SITE+32,QL,AUTO
        14 001711   000021 376000 15                 ANQ     17
        14 001712   000100 276003                    ORQ     64,DU
        14 001713   200206 756110                    STQ     SITE+32,X0,AUTO
        14 001714   200126 236100                    LDQ     SITES,,AUTO
        14 001715   000350 402007                    MPY     232,DL
        14 001716   040106 100506                    MLR     fill='040'O
        14 001717   200176 200036                    ADSC9   SITE+24,Q,AUTO           cn=1,n=30
        14 001720   200206 400036                    ADSC9   SITE+32,Q,AUTO           cn=2,n=30

      869    13505    5                               SITE.IDENT.TEXT( SITES));
      870    13506    5                       SITE.OWN_REVERSE_PATH.COUNT( SITES) =

  13506 14 001721   200126 236100                    LDQ     SITES,,AUTO
        14 001722   000072 402007                    MPY     58,DL
        14 001723   000000 620006                    EAX0    0,QL
        14 001724   200176 236106                    LDQ     SITE+24,QL,AUTO
        14 001725   000033 772000                    QRL     27
        14 001726   000001 036007                    ADLQ    1,DL
        14 001727   000033 736000                    QLS     27
        14 001730   200206 676110                    ERQ     SITE+32,X0,AUTO
        14 001731   777000 376003                    ANQ     -512,DU
        14 001732   200206 656110                    ERSQ    SITE+32,X0,AUTO

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:162  
      871    13507    5                               SITE.IDENT.COUNT( SITES) + 1;
      872    13508    5                       END;

      873    13509    5                   IF SITE.INDIRECT_REVERSE_PATH.COUNT( SITES) = 0 THEN DO;

  13509 14 001733   200126 236100                    LDQ     SITES,,AUTO
        14 001734   000072 402007                    MPY     58,DL
        14 001735   200216 236106                    LDQ     SITE+40,QL,AUTO
        14 001736   777000 316003                    CANQ    -512,DU
        14 001737   002031 601000 14                 TNZ     s:13516

      874    13510    5                       CALL CONCAT( SITE.INDIRECT_REVERSE_PATH.TEXT( SITES), '%',

  13510 14 001740   200126 236100                    LDQ     SITES,,AUTO
        14 001741   000072 402007                    MPY     58,DL
        14 001742   200176 236106                    LDQ     SITE+24,QL,AUTO
        14 001743   000033 772000                    QRL     27
        14 001744   000000 620006                    EAX0    0,QL
        14 001745   200126 236100                    LDQ     SITES,,AUTO
        14 001746   000072 402007                    MPY     58,DL
        14 001747   000000 621006                    EAX1    0,QL
        14 001750   200216 236106                    LDQ     SITE+40,QL,AUTO
        14 001751   000021 376000 15                 ANQ     17
        14 001752   000045 276003                    ORQ     37,DU
        14 001753   200216 756111                    STQ     SITE+40,X1,AUTO
        14 001754   200126 236100                    LDQ     SITES,,AUTO
        14 001755   000350 402007                    MPY     232,DL
        14 001756   040106 100546                    MLR     fill='040'O
        14 001757   200176 200010                    ADSC9   SITE+24,Q,AUTO           cn=1,n=*X0
        14 001760   200216 400036                    ADSC9   SITE+40,Q,AUTO           cn=2,n=30
        14 001761   000000 636010                    EAQ     0,X0
        14 001762   000022 772000                    QRL     18
        14 001763   000036 116007                    CMPQ    30,DL
        14 001764   002016 603000 14                 TRC     s:13513
        14 001765   000000 635010                    EAA     0,X0
        14 001766   000022 771000                    ARL     18
        14 001767   222722 755100                    STA     @VLEN+2,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:163  
        14 001770   200126 236100                    LDQ     SITES,,AUTO
        14 001771   000350 402007                    MPY     232,DL
        14 001772   222722 036100                    ADLQ    @VLEN+2,,AUTO
        14 001773   222723 740100                    STX0    @VLEN+3,,AUTO
        14 001774   777741 620010                    EAX0    -31,X0
        14 001775   777777 660003                    ERX0    -1,DU
        14 001776   040146 100400                    MLR     fill='040'O
        14 001777   000022 000001 15                 ADSC9   18                       cn=0,n=1
        14 002000   200216 400010                    ADSC9   SITE+40,Q,AUTO           cn=2,n=*X0
        14 002001   222724 756100                    STQ     @VLEN+4,,AUTO
        14 002002   222723 236100                    LDQ     @VLEN+3,,AUTO
        14 002003   000022 772000                    QRL     18
        14 002004   000035 116007                    CMPQ    29,DL
        14 002005   002016 603000 14                 TRC     s:13513
        14 002006   200126 236100                    LDQ     SITES,,AUTO
        14 002007   000350 402007                    MPY     232,DL
        14 002010   000035 220003                    LDX0    29,DU
        14 002011   222723 120100                    SBLX0   @VLEN+3,,AUTO
        14 002012   222724 235100                    LDA     @VLEN+4,,AUTO
        14 002013   040145 100506                    MLR     fill='040'O
        14 002014   200146 200037                    ADSC9   SITE,Q,AUTO              cn=1,n=31
        14 002015   200216 600010                    ADSC9   SITE+40,A,AUTO           cn=3,n=*X0

      875    13511    5                               SUBSTR( SITE.IDENT.TEXT( SITES), 0, SITE.IDENT.COUNT(
             13511                                        SITES)),
      876    13512    5                               '@', SITE.NAME.TEXT( SITES));
      877    13513    5                       SITE.INDIRECT_REVERSE_PATH.COUNT( SITES) =

  13513 14 002016   200146 236111                    LDQ     SITE,X1,AUTO
        14 002017   000033 772000                    QRL     27
        14 002020   222722 756100                    STQ     @VLEN+2,,AUTO
        14 002021   200176 236111                    LDQ     SITE+24,X1,AUTO
        14 002022   000033 772000                    QRL     27
        14 002023   222722 036100                    ADLQ    @VLEN+2,,AUTO
        14 002024   000002 036007                    ADLQ    2,DL
        14 002025   000033 736000                    QLS     27
        14 002026   200216 676111                    ERQ     SITE+40,X1,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:164  
        14 002027   777000 376003                    ANQ     -512,DU
        14 002030   200216 656111                    ERSQ    SITE+40,X1,AUTO

      878    13514    5                               SITE.IDENT.COUNT( SITES) + SITE.NAME.COUNT( SITES) + 2;
      879    13515    5                       END;

      880    13516    4                   SITES = SITES + 1;

  13516 14 002031   200126 054100                    AOS     SITES,,AUTO
        14 002032   000711 710000 14                 TRA     SCAN

      881    13517    4               CASE( %NODE_CMD);

      882    13518    5                   IF NODES > %MAX_SMTP_NODE THEN DO;

  13518 14 002033   200131 235100                    LDA     NODES,,AUTO
        14 002034   000035 115007                    CMPA    29,DL
        14 002035   002042 604400 14                 TMOZ    s:13522

      883    13519    5                       CMDBUF = 'Node table overflow;  node not stored.';

  13519 14 002036   040000 100400                    MLR     fill='040'O
        14 002037   002735 000046 1                  ADSC9   TCM_XLATE_TO_UC+168      cn=0,n=38
        14 002040   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

      884    13520    5                       GOTO TELLUSER;

  13520 14 002041   001237 710000 14                 TRA     TELLUSER

      885    13521    5                       END;
      886    13522    4                   NODE.FLAGS( NODES) = '0'B;

  13522 14 002042   200131 236100                    LDQ     NODES,,AUTO
        14 002043   000023 402007                    MPY     19,DL
        14 002044   201273 450106                    STZ     NODE+17,QL,AUTO

      887    13523    5                   DO I = 0 TO OUT$BLK.NSUBLKS - 1;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:165  

  13523 14 002045   222355 450100                    STZ     I,,AUTO
        14 002046   002271 710000 14                 TRA     s:13562+1

      888    13524    5                       OPT$ = OUT$BLK.SUBLK$( I);

  13524 14 002047   200111 470500                    LDP0    OUT$,,AUTO
        14 002050   222355 720100                    LXL0    I,,AUTO
        14 002051   000003 236110                    LDQ     3,X0,PR0
        14 002052   222357 756100                    STQ     OPT$,,AUTO

      889    13525    6                       DO CASE( OPT$->OUT$BLK.CODE);

  13525 14 002053   222357 471500                    LDP1    OPT$,,AUTO
        14 002054   100000 236100                    LDQ     0,,PR1
        14 002055   777777 376007                    ANQ     -1,DL
        14 002056   000322 136007                    SBLQ    210,DL
        14 002057   000027 116007                    CMPQ    23,DL
        14 002060   002062 602006 14                 TNC     s:13525+7,QL
        14 002061   002270 710000 14                 TRA     s:13562
        14 002062   002123 710000 14                 TRA     s:13530
        14 002063   002123 710000 14                 TRA     s:13530
        14 002064   002263 710000 14                 TRA     s:13560
        14 002065   002270 710000 14                 TRA     s:13562
        14 002066   002270 710000 14                 TRA     s:13562
        14 002067   002270 710000 14                 TRA     s:13562
        14 002070   002270 710000 14                 TRA     s:13562
        14 002071   002270 710000 14                 TRA     s:13562
        14 002072   002270 710000 14                 TRA     s:13562
        14 002073   002270 710000 14                 TRA     s:13562
        14 002074   002270 710000 14                 TRA     s:13562
        14 002075   002270 710000 14                 TRA     s:13562
        14 002076   002270 710000 14                 TRA     s:13562
        14 002077   002270 710000 14                 TRA     s:13562
        14 002100   002270 710000 14                 TRA     s:13562
        14 002101   002270 710000 14                 TRA     s:13562
        14 002102   002270 710000 14                 TRA     s:13562
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:166  
        14 002103   002270 710000 14                 TRA     s:13562
        14 002104   002270 710000 14                 TRA     s:13562
        14 002105   002270 710000 14                 TRA     s:13562
        14 002106   002132 710000 14                 TRA     s:13532
        14 002107   002111 710000 14                 TRA     s:13527
        14 002110   002243 710000 14                 TRA     s:13555

      890    13526    6                           CASE( %NODENAME);

      891    13527    6                               CALL XLATE( NODE.NAME( NODES), TCM_XLATE_TO_UC,

  13527 14 002111   100004 236100                    LDQ     4,,PR1
        14 002112   000033 772000                    QRL     27
        14 002113   000000 621006                    EAX1    0,QL
        14 002114   200131 236100                    LDQ     NODES,,AUTO
        14 002115   000114 402007                    MPY     76,DL
        14 002116   040106 160540                    MVT     fill='040'O
        14 002117   100004 200011                    ADSC9   4,,PR1                   cn=1,n=*X1
        14 002120   201252 000040                    ADSC9   NODE,Q,AUTO              cn=0,n=32
        14 002121   002465 000000 1                  ARG     TCM_XLATE_TO_UC
        14 002122   002270 710000 14                 TRA     s:13562

      892    13528    6                                       OPT$->OUT$SYM.TEXT);
      893    13529    6                           CASE( %IS_OPTION, %VIA_OPTION);

      894    13530    6                               NODE.IS_OR_VIA( NODES) = OPT$->OUT$BLK.CODE;

  13530 14 002123   200131 236100                    LDQ     NODES,,AUTO
        14 002124   000023 402007                    MPY     19,DL
        14 002125   000000 621006                    EAX1    0,QL
        14 002126   100000 236100                    LDQ     0,,PR1
        14 002127   777777 376007                    ANQ     -1,DL
        14 002130   201274 756111                    STQ     NODE+18,X1,AUTO
        14 002131   002270 710000 14                 TRA     s:13562

      895    13531    6                           CASE( %SITENAME);

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:167  
      896    13532    6                               NODE.SITE( NODES) = -1;

  13532 14 002132   200131 236100                    LDQ     NODES,,AUTO
        14 002133   000023 402007                    MPY     19,DL
        14 002134   000001 335007                    LCA     1,DL
        14 002135   201262 755106                    STA     NODE+8,QL,AUTO

      897    13533    7                               DO J = 0 TO SITES - 1;

  13533 14 002136   222356 450100                    STZ     J,,AUTO
        14 002137   002227 710000 14                 TRA     s:13549+1

      898    13534    8                                   IF SITE.NAME.TEXT( J) = OPT$->OUT$SYM.TEXT THEN DO;

  13534 14 002140   222357 470500                    LDP0    OPT$,,AUTO
        14 002141   000004 236100                    LDQ     4,,PR0
        14 002142   000033 772000                    QRL     27
        14 002143   000000 620006                    EAX0    0,QL
        14 002144   222356 236100                    LDQ     J,,AUTO
        14 002145   000350 402007                    MPY     232,DL
        14 002146   040140 106506                    CMPC    fill='040'O
        14 002147   200146 200037                    ADSC9   SITE,Q,AUTO              cn=1,n=31
        14 002150   000004 200010                    ADSC9   4,,PR0                   cn=1,n=*X0
        14 002151   002226 601000 14                 TNZ     s:13549

      899    13535    8                                       NODE.SITE( NODES) = J;

  13535 14 002152   200131 236100                    LDQ     NODES,,AUTO
        14 002153   000023 402007                    MPY     19,DL
        14 002154   222356 235100                    LDA     J,,AUTO
        14 002155   201262 755106                    STA     NODE+8,QL,AUTO

      900    13536    9                                       DO CASE( NODE.IS_OR_VIA( NODES));

  13536 14 002156   201274 235106                    LDA     NODE+18,QL,AUTO
        14 002157   000322 135007                    SBLA    210,DL
        14 002160   000002 115007                    CMPA    2,DL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:168  
        14 002161   002163 602005 14                 TNC     s:13536+5,AL
        14 002162   002226 710000 14                 TRA     s:13549
        14 002163   002165 710000 14                 TRA     s:13538
        14 002164   002206 710000 14                 TRA     s:13543

      901    13537    9                                           CASE( %IS_OPTION);

      902    13538    9                                               NODE.REVERSE_PATH.COUNT( NODES) =

  13538 14 002165   000000 620006                    EAX0    0,QL
        14 002166   222356 236100                    LDQ     J,,AUTO
        14 002167   000072 402007                    MPY     58,DL
        14 002170   200206 236106                    LDQ     SITE+32,QL,AUTO
        14 002171   201263 676110                    ERQ     NODE+9,X0,AUTO
        14 002172   777000 376003                    ANQ     -512,DU
        14 002173   201263 656110                    ERSQ    NODE+9,X0,AUTO

      903    13539    9                                                      SITE.OWN_REVERSE_PATH.COUNT( J);
      904    13540    9                                               NODE.REVERSE_PATH.TEXT( NODES) =

  13540 14 002174   222356 236100                    LDQ     J,,AUTO
        14 002175   000350 402007                    MPY     232,DL
        14 002176   222722 756100                    STQ     @VLEN+2,,AUTO
        14 002177   200131 236100                    LDQ     NODES,,AUTO
        14 002200   000114 402007                    MPY     76,DL
        14 002201   222722 235100                    LDA     @VLEN+2,,AUTO
        14 002202   040106 100505                    MLR     fill='040'O
        14 002203   200206 200037                    ADSC9   SITE+32,A,AUTO           cn=1,n=31
        14 002204   201263 200037                    ADSC9   NODE+9,Q,AUTO            cn=1,n=31
        14 002205   002226 710000 14                 TRA     s:13549

      905    13541    9                                                       SITE.OWN_REVERSE_PATH.TEXT( J);
      906    13542    9                                           CASE( %VIA_OPTION);

      907    13543    9                                               NODE.REVERSE_PATH.COUNT( NODES) =

  13543 14 002206   000000 620006                    EAX0    0,QL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:169  
        14 002207   222356 236100                    LDQ     J,,AUTO
        14 002210   000072 402007                    MPY     58,DL
        14 002211   200216 236106                    LDQ     SITE+40,QL,AUTO
        14 002212   201263 676110                    ERQ     NODE+9,X0,AUTO
        14 002213   777000 376003                    ANQ     -512,DU
        14 002214   201263 656110                    ERSQ    NODE+9,X0,AUTO

      908    13544    9                                                      SITE.INDIRECT_REVERSE_PATH.COUNT
             13544                                                                ( J);
      909    13545    9                                               NODE.REVERSE_PATH.TEXT( NODES) =

  13545 14 002215   222356 236100                    LDQ     J,,AUTO
        14 002216   000350 402007                    MPY     232,DL
        14 002217   222722 756100                    STQ     @VLEN+2,,AUTO
        14 002220   200131 236100                    LDQ     NODES,,AUTO
        14 002221   000114 402007                    MPY     76,DL
        14 002222   222722 235100                    LDA     @VLEN+2,,AUTO
        14 002223   040106 100505                    MLR     fill='040'O
        14 002224   200216 200037                    ADSC9   SITE+40,A,AUTO           cn=1,n=31
        14 002225   201263 200037                    ADSC9   NODE+9,Q,AUTO            cn=1,n=31

      910    13546    9                                                      SITE.INDIRECT_REVERSE_PATH.TEXT(
             13546                                                                J);
      911    13547    9                                           END;

      912    13548    8                                       END;

      913    13549    7                                   END;

  13549 14 002226   222356 054100                    AOS     J,,AUTO
        14 002227   222356 236100                    LDQ     J,,AUTO
        14 002230   200126 116100                    CMPQ    SITES,,AUTO
        14 002231   002140 604000 14                 TMI     s:13534

      914    13550    7                               IF NODE.SITE( NODES) = -1 THEN DO;

  13550 14 002232   200131 236100                    LDQ     NODES,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:170  
        14 002233   000023 402007                    MPY     19,DL
        14 002234   201262 235106                    LDA     NODE+8,QL,AUTO
        14 002235   000027 115000 xsym               CMPA    B_VECTNIL+23
        14 002236   002270 601000 14                 TNZ     s:13562

      915    13551    7                                   CMDBUF = 'No such site.';

  13551 14 002237   040000 100400                    MLR     fill='040'O
        14 002240   002747 000015 1                  ADSC9   TCM_XLATE_TO_UC+178      cn=0,n=13
        14 002241   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

      916    13552    7                                   GOTO TELLUSER;

  13552 14 002242   001237 710000 14                 TRA     TELLUSER

      917    13553    7                                   END;
      918    13554    6                           CASE( %PATHNAME);

      919    13555    6                               NODE.REVERSE_PATH.COUNT( NODES) =

  13555 14 002243   200131 236100                    LDQ     NODES,,AUTO
        14 002244   000023 402007                    MPY     19,DL
        14 002245   000000 621006                    EAX1    0,QL
        14 002246   100004 236100                    LDQ     4,,PR1
        14 002247   201263 676111                    ERQ     NODE+9,X1,AUTO
        14 002250   777000 376003                    ANQ     -512,DU
        14 002251   201263 656111                    ERSQ    NODE+9,X1,AUTO

      920    13556    6                                       OPT$->OUT$SYM.COUNT;
      921    13557    6                               NODE.REVERSE_PATH.TEXT( NODES) =

  13557 14 002252   100004 236100                    LDQ     4,,PR1
        14 002253   000033 772000                    QRL     27
        14 002254   000000 622006                    EAX2    0,QL
        14 002255   200131 236100                    LDQ     NODES,,AUTO
        14 002256   000114 402007                    MPY     76,DL
        14 002257   040106 100540                    MLR     fill='040'O
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:171  
        14 002260   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
        14 002261   201263 200037                    ADSC9   NODE+9,Q,AUTO            cn=1,n=31
        14 002262   002270 710000 14                 TRA     s:13562

      922    13558    6                                       OPT$->OUT$SYM.TEXT;
      923    13559    6                           CASE( %QUOTES_OPTION);

      924    13560    6                               NODE.FLAGS.QUOTES( NODES) = %YES#;

  13560 14 002263   200131 236100                    LDQ     NODES,,AUTO
        14 002264   000023 402007                    MPY     19,DL
        14 002265   000000 621006                    EAX1    0,QL
        14 002266   400000 236003                    LDQ     -131072,DU
        14 002267   201273 256111                    ORSQ    NODE+17,X1,AUTO

      925    13561    6                           END;

      926    13562    5                       END;

  13562 14 002270   222355 054100                    AOS     I,,AUTO
        14 002271   200111 470500                    LDP0    OUT$,,AUTO
        14 002272   000001 236100                    LDQ     1,,PR0
        14 002273   000022 772000                    QRL     18
        14 002274   222355 116100                    CMPQ    I,,AUTO
        14 002275   002047 605400 14                 TPNZ    s:13524

      927    13563    4                   NODES = NODES + 1;

  13563 14 002276   200131 054100                    AOS     NODES,,AUTO
        14 002277   000711 710000 14                 TRA     SCAN

      928    13564    4               CASE( %ADDGATE_CMD, %DELSITE_CMD);

      929    13565                        /* do nothing; does not apply when sending mail */
      930    13566    4               CASE( %DELGATE_CMD);

      931    13567    5                   IF REWRITES > %MAX_REWRITES THEN DO;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:172  

  13567 14 002300   222342 235100                    LDA     REWRITES,,AUTO
        14 002301   000024 115007                    CMPA    20,DL
        14 002302   002307 604400 14                 TMOZ    s:13571

      932    13568    5                       CMDBUF = 'DelGate table overflow;  command not stored.';

  13568 14 002303   040000 100400                    MLR     fill='040'O
        14 002304   002753 000054 1                  ADSC9   TCM_XLATE_TO_UC+182      cn=0,n=44
        14 002305   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

      933    13569    5                       GOTO TELLUSER;

  13569 14 002306   001237 710000 14                 TRA     TELLUSER

      934    13570    5                       END;
      935    13571    4                   I = REWRITES;

  13571 14 002307   222355 755100                    STA     I,,AUTO

      936    13572    4                   REWRITE.OLD.LEN( I) = OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT;

  13572 14 002310   222355 236100                    LDQ     I,,AUTO
        14 002311   000022 402007                    MPY     18,DL
        14 002312   000003 471500                    LDP1    3,,PR0
        14 002313   000000 620006                    EAX0    0,QL
        14 002314   100004 236100                    LDQ     4,,PR1
        14 002315   221552 676110                    ERQ     REWRITE+2,X0,AUTO
        14 002316   777000 376003                    ANQ     -512,DU
        14 002317   221552 656110                    ERSQ    REWRITE+2,X0,AUTO

      937    13573    4                   CALL XLATE( REWRITE.OLD.TXT( I), TCM_XLATE_TO_UC,

  13573 14 002320   100004 236100                    LDQ     4,,PR1
        14 002321   000033 772000                    QRL     27
        14 002322   000000 621006                    EAX1    0,QL
        14 002323   222355 236100                    LDQ     I,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:173  
        14 002324   000110 402007                    MPY     72,DL
        14 002325   040106 160540                    MVT     fill='040'O
        14 002326   100004 200011                    ADSC9   4,,PR1                   cn=1,n=*X1
        14 002327   221552 200037                    ADSC9   REWRITE+2,Q,AUTO         cn=1,n=31
        14 002330   002465 000000 1                  ARG     TCM_XLATE_TO_UC

      938    13574    4                           OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT);
      939    13575    4                   REWRITES = REWRITES + 1;

  13575 14 002331   222342 054100                    AOS     REWRITES,,AUTO

      940    13576    4               END;

      941    13577    3           END SCAN;

  13577 14 002332   000711 710000 14                 TRA     SCAN

      942    13578    2       CALL M$CLOSE( CLOSE_SI)

  13578 14 002333   000006 630400 1                  EPPR0   CLOSE_SI
        14 002334   450001 713400                    CLIMB   alt,close
        14 002335   406000 401760                    pmme    nvectors=13
        14 002336   002340 702000 14                 TSX2    s:13581
        14 002337   002340 710000 14                 TRA     s:13581

      943    13579    3       WHENALTRETURN DO;

      944    13580    3           END;

      945    13581    2       IF ERROR_FLAG THEN

  13581 14 002340   222353 234100                    SZN     ERROR_FLAG,,AUTO
        14 002341   002344 605000 14                 TPL     s:13583

      946    13582    2           ALTRETURN;

  13582 14 002342   222352 221300                    LDX1  ! ALIAS$+2,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:174  
        14 002343   000000 702211                    TSX2  ! 0,X1

      947    13583    2       RETURN;

  13583 14 002344   222352 221300                    LDX1  ! ALIAS$+2,,AUTO
        14 002345   000001 702211                    TSX2  ! 1,X1

      948    13584
      949    13585    2       END INITIALIZE_CONFIGURATION;
      950    13586        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:175  
      951    13587    1   INITIALIZE_QUOTATIONS: PROC;

  13587 14 002346   222352 741300       INITIALIZE_* STX1  ! ALIAS$+2,,AUTO

      952    13588
      953    13589    2       DCL LINELEN UBIN WORD;
      954    13590
      955    13591    2       QUOTE_COUNT = 0;

  13591 14 002347   200140 450100                    STZ     QUOTE_COUNT,,AUTO

      956    13592    2       QUOTE_KEY.L = 3;

  13592 14 002350   003000 236003                    LDQ     1536,DU
        14 002351   002106 552040 6                  STBQ    QUOTE_KEY,'40'O

      957    13593    2       QUOTE_KEY.K = 0;

  13593 14 002352   000000 236003                    LDQ     0,DU
        14 002353   002106 552034 6                  STBQ    QUOTE_KEY,'34'O

      958    13594    2       IF NOT B$JIT.PRFLAGS.UI THEN

  13594 14 002354   000000 470400 xsym               LDP0    B$JIT$
        14 002355   000030 236100                    LDQ     24,,PR0
        14 002356   200000 316003                    CANQ    65536,DU
        14 002357   002361 601000 14                 TNZ     s:13596

      959    13595    2           RETURN;

  13595 14 002360   000001 702211                    TSX2  ! 1,X1

      960    13596    2       CALL M$OPEN( OPEN_UI)

  13596 14 002361   000044 630400 1                  EPPR0   OPEN_UI
        14 002362   450000 713400                    CLIMB   alt,open
        14 002363   410400 401760                    pmme    nvectors=18
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:176  
        14 002364   002366 702000 14                 TSX2    s:13598
        14 002365   002370 710000 14                 TRA     s:13600

      961    13597    3       WHENALTRETURN DO;

      962    13598    3           RETURN;

  13598 14 002366   222352 221300                    LDX1  ! ALIAS$+2,,AUTO
        14 002367   000001 702211                    TSX2  ! 1,X1

      963    13599    3           END;
      964    13600    2       CALL M$OPEN( OPEN_QUOTES)

  13600 14 002370   001112 630400 1                  EPPR0   OPEN_QUOTES
        14 002371   450000 713400                    CLIMB   alt,open
        14 002372   410400 401760                    pmme    nvectors=18
        14 002373   002375 702000 14                 TSX2    s:13602
        14 002374   002377 710000 14                 TRA     READ_QUOTES

      965    13601    3       WHENALTRETURN DO;

      966    13602    3           RETURN;

  13602 14 002375   222352 221300                    LDX1  ! ALIAS$+2,,AUTO
        14 002376   000001 702211                    TSX2  ! 1,X1

      967    13603    3           END;
      968    13604    2   READ_QUOTES:
      969    13605    3       DO UNTIL %NO#;

  13605 14 002377                       READ_QUOTES  null
      970    13606    3           QUOTE_BUF = ' ';

  13606 14 002377   040000 100400                    MLR     fill='040'O
        14 002400   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 002401   002006 000377 6                  ADSC9   QUOTE_BUF                cn=0,n=255

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:177  
      971    13607    3           CALL M$READ( READ_UI)

  13607 14 002402   000136 630400 1                  EPPR0   READ_UI
        14 002403   440000 713400                    CLIMB   alt,read
        14 002404   401400 401760                    pmme    nvectors=4
        14 002405   002407 702000 14                 TSX2    s:13609
        14 002406   002410 710000 14                 TRA     s:13611

      972    13608    4           WHENALTRETURN DO;

      973    13609    4               EXIT READ_QUOTES;

  13609 14 002407   002452 710000 14                 TRA     s:13622

      974    13610    4               END;
      975    13611    4           IF QUOTE_BUF = ' ' THEN DO;

  13611 14 002410   040000 106400                    CMPC    fill='040'O
        14 002411   002006 000377 6                  ADSC9   QUOTE_BUF                cn=0,n=255
        14 002412   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 002413   002431 601000 14                 TNZ     s:13616

      976    13612    4               IF MOD( QUOTE_KEY.K,1000) ~= 0 THEN

  13612 14 002414   002106 236000 6                  LDQ     QUOTE_KEY
        14 002415   000032 376000 xsym               ANQ     B_VECTNIL+26
        14 002416   001750 506007                    DIV     1000,DL
        14 002417   000044 733000                    LRS     36
        14 002420   000000 116003                    CMPQ    0,DU
        14 002421   002451 600000 14                 TZE     s:13621

      977    13613    4                   QUOTE_KEY.K = 1000 * ( QUOTE_KEY.K / 1000 + 1);

  13613 14 002422   002106 236000 6                  LDQ     QUOTE_KEY
        14 002423   000032 376000 xsym               ANQ     B_VECTNIL+26
        14 002424   001750 506007                    DIV     1000,DL
        14 002425   001750 402007                    MPY     1000,DL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:178  
        14 002426   001750 036007                    ADLQ    1000,DL
        14 002427   002106 552034 6                  STBQ    QUOTE_KEY,'34'O

      978    13614    4               END;

  13614 14 002430   002451 710000 14                 TRA     s:13621

      979    13615    4           ELSE DO;

      980    13616    4               WRITE_QUOTES.BUF_ = VECTOR( SUBSTR( QUOTE_BUF, 0,

  13616 14 002431   000000 236007 xsym               LDQ     M$UI,DL
        14 002432   000000 470400 15                 LDP0    0
        14 002433   000000 471500                    LDP1    0,,PR0
        14 002434   100000 473506                    LDP3    0,QL,PR1
        14 002435   300000 720100                    LXL0    0,,PR3
        14 002436   000000 635010                    EAA     0,X0
        14 002437   000002 771000                    ARL     2
        14 002440   000140 135007                    SBLA    96,DL
        14 002441   000023 236000 15                 LDQ     19
        14 002442   000222 757000 6                  STAQ    WRITE_QUOTES+4

      981    13617    4                       DCBADDR( DCBNUM( M$UI))->F$DCB.ARS#));
      982    13618    4               CALL M$WRITE( WRITE_QUOTES);

  13618 14 002443   000216 630400 6                  EPPR0   WRITE_QUOTES
        14 002444   040001 713400                    CLIMB   write
        14 002445   401400 401760                    pmme    nvectors=4

      983    13619    4               QUOTE_KEY.K = QUOTE_KEY.K + 1;

  13619 14 002446   002106 236000 6                  LDQ     QUOTE_KEY
        14 002447   000001 036007                    ADLQ    1,DL
        14 002450   002106 552034 6                  STBQ    QUOTE_KEY,'34'O

      984    13620    4               END;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:179  
      985    13621    3           END;

  13621 14 002451   002377 710000 14                 TRA     READ_QUOTES

      986    13622    2       QUOTE_COUNT = ( QUOTE_KEY.K + 999) / 1000;

  13622 14 002452   002106 236000 6                  LDQ     QUOTE_KEY
        14 002453   000032 376000 xsym               ANQ     B_VECTNIL+26
        14 002454   001747 036007                    ADLQ    999,DL
        14 002455   001750 506007                    DIV     1000,DL
        14 002456   200140 756100                    STQ     QUOTE_COUNT,,AUTO

      987    13623    2       CALL M$CLOSE( CLOSE_UI);

  13623 14 002457   000154 630400 1                  EPPR0   CLOSE_UI
        14 002460   050001 713400                    CLIMB   close
        14 002461   406000 401760                    pmme    nvectors=13

      988    13624    2       RETURN;

  13624 14 002462   222352 221300                    LDX1  ! ALIAS$+2,,AUTO
        14 002463   000001 702211                    TSX2  ! 1,X1

      989    13625
      990    13626    2       END INITIALIZE_QUOTATIONS;
      991    13627        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:180  
      992    13628    1   INIT_FOLDER_DATA_POOL: PROC;

  13628 14 002464   222352 741300       INIT_FOLDER* STX1  ! ALIAS$+2,,AUTO

      993    13629
      994    13630    2       MAIL_ADDRESSES = VECTOR( NIL);

  13630 14 002465   000024 237000 15                 LDAQ    20
        14 002466   001226 757000 6                  STAQ    MAIL_ADDRESSES

      995    13631    2       VBASE( MAIL_ADDRESSES) = B$DS5$;

  13631 14 002467   000000 236000 xsym               LDQ     B$DS5$
        14 002470   001227 756000 6                  STQ     MAIL_ADDRESSES+1

      996    13632    2       CALL M$GDS( GET_ADDRESSES);

  13632 14 002471   001704 630400 1                  EPPR0   GET_ADDRESSES
        14 002472   030001 713400                    CLIMB   gds
        14 002473   400400 401760                    pmme    nvectors=2

      997    13633    2       MAIL_BUFFERS = VECTOR( NIL);

  13633 14 002474   000024 237000 15                 LDAQ    20
        14 002475   001224 757000 6                  STAQ    MAIL_BUFFERS

      998    13634    2       CALL M$GDS( GET_BUFFERS);

  13634 14 002476   001670 630400 1                  EPPR0   GET_BUFFERS
        14 002477   030001 713400                    CLIMB   gds
        14 002500   400400 401760                    pmme    nvectors=2

      999    13635    2       PROFILE$ = PINCRW( VBASE( MAIL_BUFFERS), 0);

  13635 14 002501   001225 236000 6                  LDQ     MAIL_BUFFERS+1
        14 002502   222344 756100                    STQ     PROFILE$,,AUTO

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:181  
     1000    13636    2       HEADER$ = PINCRW( VBASE( MAIL_BUFFERS), 1024);

  13636 14 002503   002000 036003                    ADLQ    1024,DU
        14 002504   222345 756100                    STQ     HEADER$,,AUTO

     1001    13637    2       BODY$ = PINCRW( VBASE( MAIL_BUFFERS), 2048);

  13637 14 002505   001225 236000 6                  LDQ     MAIL_BUFFERS+1
        14 002506   004000 036003                    ADLQ    2048,DU
        14 002507   222346 756100                    STQ     BODY$,,AUTO

     1002    13638    2       ADDRESS$ = PINCRW( VBASE( MAIL_BUFFERS), 3072);

  13638 14 002510   001225 236000 6                  LDQ     MAIL_BUFFERS+1
        14 002511   006000 036003                    ADLQ    3072,DU
        14 002512   222347 756100                    STQ     ADDRESS$,,AUTO

     1003    13639    2       MSG_NUMBER = 0;

  13639 14 002513   222343 450100                    STZ     MSG_NUMBER,,AUTO

     1004    13640    2       RETURN;

  13640 14 002514   222352 221300                    LDX1  ! ALIAS$+2,,AUTO
        14 002515   000001 702211                    TSX2  ! 1,X1

     1005    13641
     1006    13642    2   RELEASE_FOLDER_DATA_POOL: ENTRY;

  13642 14 002516   222352 741300       RELEASE_FOL* STX1  ! ALIAS$+2,,AUTO

     1007    13643
     1008    13644    2       CALL M$FDS( RELEASE_ADDRESSES);

  13644 14 002517   001712 630400 1                  EPPR0   RELEASE_ADDRESSES
        14 002520   030002 713400                    CLIMB   fds
        14 002521   400400 401760                    pmme    nvectors=2
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:182  

     1009    13645    2       CALL M$FDS( RELEASE_BUFFERS);

  13645 14 002522   001676 630400 1                  EPPR0   RELEASE_BUFFERS
        14 002523   030002 713400                    CLIMB   fds
        14 002524   400400 401760                    pmme    nvectors=2

     1010    13646
     1011    13647    2       PROFILE$ = ADDR( NIL);

  13647 14 002525   000001 236000 xsym               LDQ     B_VECTNIL+1
        14 002526   222344 756100                    STQ     PROFILE$,,AUTO

     1012    13648    2       HEADER$ = ADDR( NIL);

  13648 14 002527   222345 756100                    STQ     HEADER$,,AUTO

     1013    13649    2       BODY$ = ADDR( NIL);

  13649 14 002530   222346 756100                    STQ     BODY$,,AUTO

     1014    13650    2       ADDRESS$ = ADDR( NIL);

  13650 14 002531   222347 756100                    STQ     ADDRESS$,,AUTO

     1015    13651    2       RETURN;

  13651 14 002532   222352 221300                    LDX1  ! ALIAS$+2,,AUTO
        14 002533   000001 702211                    TSX2  ! 1,X1

     1016    13652
     1017    13653    2       END INIT_FOLDER_DATA_POOL;
     1018    13654        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:183  
     1019    13655    1   SCAN_ALL_HEADERS: PROC;

  13655 14 002534   222352 741300       SCAN_ALL_HE* STX1  ! ALIAS$+2,,AUTO

     1020    13656
     1021    13657    2       DCL OLDEST UBIN;
     1022    13658
     1023    13659    2       CALL M$TIME( GET_UTS_NOW);

  13659 14 002535   001576 630400 1                  EPPR0   GET_UTS_NOW
        14 002536   020004 713400                    CLIMB   8196
        14 002537   402000 401760                    pmme    nvectors=5

     1024    13660    2       CALL M$TIME( GET_TIME_NOW);

  13660 14 002540   001562 630400 1                  EPPR0   GET_TIME_NOW
        14 002541   020004 713400                    CLIMB   8196
        14 002542   402000 401760                    pmme    nvectors=5

     1025    13661    2       CALL CHARBIN( TVAL, SUBSTR( TIMEBUF, 0, 2));

  13661 14 002543   000100 305400                    DTB
        14 002544   003445 030002 6                  NDSC9   TIMEBUF                  cn=0,s=nosgn,sf=0,n=2
        14 002545   222722 000010                    NDSC9   @VLEN+2,,AUTO            cn=0,s=lsgnf,sf=0,n=8
        14 002546   222723 235100                    LDA     @VLEN+3,,AUTO
        14 002547   200107 755100                    STA     TVAL,,AUTO

     1026    13662    2       CALL CHARBIN( LOCE, SUBSTR( TIMEBUF, 3, 2));

  13662 14 002550   000100 305400                    DTB
        14 002551   003445 630002 6                  NDSC9   TIMEBUF                  cn=3,s=nosgn,sf=0,n=2
        14 002552   222722 000010                    NDSC9   @VLEN+2,,AUTO            cn=0,s=lsgnf,sf=0,n=8
        14 002553   222723 236100                    LDQ     @VLEN+3,,AUTO
        14 002554   200106 756100                    STQ     LOCE,,AUTO

     1027    13663    2       TVAL = TVAL * 100 + LOCE;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:184  
  13663 14 002555   200107 236100                    LDQ     TVAL,,AUTO
        14 002556   000144 402007                    MPY     100,DL
        14 002557   200106 036100                    ADLQ    LOCE,,AUTO
        14 002560   200107 756100                    STQ     TVAL,,AUTO

     1028    13664    2       OLDEST = TIME_NOW;

  13664 14 002561   001230 235000 6                  LDA     TIME_NOW
        14 002562   222353 755100                    STA     OLDEST,,AUTO

     1029    13665    3       DO UNTIL MESSAGE_FILE;

     1030    13666    3           CALL GET_MAIL_HEADER ALTRET( SCAN_DONE);

  13666 14 002563   002701 701000 14                 TSX1    GET_MAIL_HEADER
        14 002564   002602 702000 14                 TSX2    SCAN_DONE

     1031    13667    3           CALL M$DEQ( DEQ_ON_HEADER)

  13667 14 002565   000606 630400 1                  EPPR0   DEQ_ON_HEADER
        14 002566   420003 713400                    CLIMB   alt,+8195
        14 002567   401000 401760                    pmme    nvectors=3
        14 002570   002572 702000 14                 TSX2    s:13670
        14 002571   002572 710000 14                 TRA     s:13670

     1032    13668    4           WHENALTRETURN DO;

     1033    13669    4               END;

     1034    13670    3           SITE.PENDING( THIS_SITE) = SITE.PENDING( THIS_SITE) + 1;

  13670 14 002572   200130 236100                    LDQ     THIS_SITE,,AUTO
        14 002573   000072 402007                    MPY     58,DL
        14 002574   200227 054106                    AOS     SITE+49,QL,AUTO

     1035    13671    3           TOTAL_READY = TOTAL_READY + 1;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:185  
  13671 14 002575   200143 235100                    LDA     TOTAL_READY,,AUTO
        14 002576   000001 035007                    ADLA    1,DL
        14 002577   200143 755100                    STA     TOTAL_READY,,AUTO

     1036    13672    3           END;

  13672 14 002600   200141 234100                    SZN     MESSAGE_FILE,,AUTO
        14 002601   002563 605000 14                 TPL     s:13666

     1037    13673    2   SCAN_DONE:
     1038    13674    2       RETURN;

  13674 14 002602   222352 221300       SCAN_DONE    LDX1  ! ALIAS$+2,,AUTO
        14 002603   000001 702211                    TSX2  ! 1,X1

     1039    13675
     1040    13676    2       END SCAN_ALL_HEADERS;
     1041    13677        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:186  
     1042    13678    1   CHOOSE_A_SITE: PROC;

  13678 14 002604   222352 741300       CHOOSE_A_SI* STX1  ! ALIAS$+2,,AUTO

     1043    13679
     1044    13680    2       CURR_SITE = -1;

  13680 14 002605   000001 335007                    LCA     1,DL
        14 002606   200127 755100                    STA     CURR_SITE,,AUTO

     1045    13681    3       DO THIS_SITE = 0 TO SITES - 1;

  13681 14 002607   200130 450100                    STZ     THIS_SITE,,AUTO
        14 002610   002674 710000 14                 TRA     s:13697+1

     1046    13682    3           IF ( SITE.FROM_TIME( THIS_SITE) <= TVAL /* beg of open shift */ AND

  13682 14 002611   200130 236100                    LDQ     THIS_SITE,,AUTO
        14 002612   000072 402007                    MPY     58,DL
        14 002613   200232 236106                    LDQ     SITE+52,QL,AUTO
        14 002614   200107 116100                    CMPQ    TVAL,,AUTO
        14 002615   002617 600000 14                 TZE     s:13682+6
        14 002616   002624 603000 14                 TRC     s:13682+11
        14 002617   200130 236100                    LDQ     THIS_SITE,,AUTO
        14 002620   000072 402007                    MPY     58,DL
        14 002621   200233 236106                    LDQ     SITE+53,QL,AUTO
        14 002622   200107 116100                    CMPQ    TVAL,,AUTO
        14 002623   002637 603000 14                 TRC     s:13687
        14 002624   200130 236100                    LDQ     THIS_SITE,,AUTO
        14 002625   000072 402007                    MPY     58,DL
        14 002626   200233 236106                    LDQ     SITE+53,QL,AUTO
        14 002627   200107 116100                    CMPQ    TVAL,,AUTO
        14 002630   002632 600000 14                 TZE     s:13682+17
        14 002631   002670 603000 14                 TRC     s:13696
        14 002632   200130 236100                    LDQ     THIS_SITE,,AUTO
        14 002633   000072 402007                    MPY     58,DL
        14 002634   200232 236106                    LDQ     SITE+52,QL,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:187  
        14 002635   200107 116100                    CMPQ    TVAL,,AUTO
        14 002636   002670 602000 14                 TNC     s:13696

     1047    13683    3                   SITE.TO_TIME( THIS_SITE) >= TVAL /* end of open shift */) OR
     1048    13684    3                   ( SITE.TO_TIME( THIS_SITE) <= TVAL /* beg of inverted shift */ AND
     1049    13685    3                   SITE.FROM_TIME( THIS_SITE) >= TVAL /* end of inverted shift */)
     1050    13686    4                   THEN DO;

     1051    13687    4               IF SITE.PENDING(THIS_SITE) > 0 AND

  13687 14 002637   200130 236100                    LDQ     THIS_SITE,,AUTO
        14 002640   000072 402007                    MPY     58,DL
        14 002641   200227 235106                    LDA     SITE+49,QL,AUTO
        14 002642   002673 604400 14                 TMOZ    s:13697
        14 002643   200235 236106                    LDQ     SITE+55,QL,AUTO
        14 002644   001230 116000 6                  CMPQ    TIME_NOW
        14 002645   002647 600000 14                 TZE     s:13689
        14 002646   002673 603000 14                 TRC     s:13697

     1052    13688    4                       SITE.NEXT_TRY( THIS_SITE) <= TIME_NOW
             13688                                /* next (re)try permitted */ THEN
     1053    13689    4                   IF CURR_SITE = -1 THEN

  13689 14 002647   200127 235100                    LDA     CURR_SITE,,AUTO
        14 002650   000027 115000 xsym               CMPA    B_VECTNIL+23
        14 002651   002655 601000 14                 TNZ     s:13692

     1054    13690    4                       CURR_SITE = THIS_SITE;

  13690 14 002652   200130 236100                    LDQ     THIS_SITE,,AUTO
        14 002653   200127 756100                    STQ     CURR_SITE,,AUTO
        14 002654   002673 710000 14                 TRA     s:13697

     1055    13691    4                   ELSE
     1056    13692    4                       IF SITE.LAST_TRY( THIS_SITE) < SITE.LAST_TRY( CURR_SITE) THEN

  13692 14 002655   200127 236100                    LDQ     CURR_SITE,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:188  
        14 002656   000072 402007                    MPY     58,DL
        14 002657   000000 620006                    EAX0    0,QL
        14 002660   200130 236100                    LDQ     THIS_SITE,,AUTO
        14 002661   000072 402007                    MPY     58,DL
        14 002662   200234 236106                    LDQ     SITE+54,QL,AUTO
        14 002663   200234 116110                    CMPQ    SITE+54,X0,AUTO
        14 002664   002673 603000 14                 TRC     s:13697

     1057    13693    4                           CURR_SITE = THIS_SITE;

  13693 14 002665   200130 235100                    LDA     THIS_SITE,,AUTO
        14 002666   200127 755100                    STA     CURR_SITE,,AUTO

     1058    13694    4               END;

  13694 14 002667   002673 710000 14                 TRA     s:13697

     1059    13695    3           ELSE
     1060    13696    3               SITE.PENDING( THIS_SITE) = 0;

  13696 14 002670   200130 236100                    LDQ     THIS_SITE,,AUTO
        14 002671   000072 402007                    MPY     58,DL
        14 002672   200227 450106                    STZ     SITE+49,QL,AUTO

     1061    13697    3           END;

  13697 14 002673   200130 054100                    AOS     THIS_SITE,,AUTO
        14 002674   200130 236100                    LDQ     THIS_SITE,,AUTO
        14 002675   200126 116100                    CMPQ    SITES,,AUTO
        14 002676   002611 604000 14                 TMI     s:13682

     1062    13698    2       RETURN;

  13698 14 002677   222352 221300                    LDX1  ! ALIAS$+2,,AUTO
        14 002700   000001 702211                    TSX2  ! 1,X1

     1063    13699
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:189  
     1064    13700    2       END CHOOSE_A_SITE;
     1065    13701        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:190  
     1066    13702    1   GET_MAIL_HEADER: PROC ALTRET;

  13702 14 002701   222354 741300       GET_MAIL_HE* STX1  ! HAVE_A_CMD,,AUTO

     1067    13703
     1068    13704    2       DCL HAVE_A_MESSAGE BIT(1);
     1069    13705    2       DCL OUT_OF_MESSAGES BIT(1);
     1070    13706
     1071    13707    2       HAVE_A_MESSAGE = %NO#;

  13707 14 002702   222355 450100                    STZ     HAVE_A_MESSAGE,,AUTO

     1072    13708    2       OUT_OF_MESSAGES = %NO#;

  13708 14 002703   222356 450100                    STZ     OUT_OF_MESSAGES,,AUTO

     1073    13709    3       DO UNTIL( HAVE_A_MESSAGE OR OUT_OF_MESSAGES);

     1074    13710    3           CALL FIND_MAIL_HEADER

  13710 14 002704   007550 701000 14                 TSX1    FIND_MAIL_HEADER
        14 002705   002707 702000 14                 TSX2    s:13712
        14 002706   002711 710000 14                 TRA     s:13714

     1075    13711    4           WHENALTRETURN DO;

     1076    13712    4               OUT_OF_MESSAGES = %YES#;

  13712 14 002707   400000 236003                    LDQ     -131072,DU
        14 002710   222356 756100                    STQ     OUT_OF_MESSAGES,,AUTO

     1077    13713    4               END;

     1078    13714    3           IF NOT OUT_OF_MESSAGES THEN

  13714 14 002711   222356 234100                    SZN     OUT_OF_MESSAGES,,AUTO
        14 002712   002737 604000 14                 TMI     s:13736
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:191  

     1079    13715    3   TRY_THIS_ONE:
     1080    13716    4                                       DO;

  13716 14 002713                       TRY_THIS_ONE null
     1081    13717
     1082    13718                    /* Note: VM_HEADER.NUM_RECORDS may be of interest here,
     1083    13719                             if you are concerned about mailgram length.    */
     1084    13720    4               CALL PARSE_MAIL_HEADER

  13720 14 002713   010121 701000 14                 TSX1    PARSE_MAIL_HEADER
        14 002714   002731 702000 14                 TSX2    s:13732

     1085    13721    5               WHENRETURN DO;

     1086    13722    5                   CALL SELECT_DESTINATION_SITE

  13722 14 002715   003034 701000 14                 TSX1    SELECT_DESTINATION_SITE
        14 002716   002722 702000 14                 TSX2    s:13727

     1087    13723    6                   WHENRETURN DO;

     1088    13724    6                       HAVE_A_MESSAGE = %YES#;

  13724 14 002717   400000 236003                    LDQ     -131072,DU
        14 002720   222355 756100                    STQ     HAVE_A_MESSAGE,,AUTO

     1089    13725    6                       END;

  13725 14 002721   002730 710000 14                 TRA     s:13730

     1090    13726    6                   WHENALTRETURN DO;

     1091    13727    6                       CALL DELETE_MESSAGE;

  13727 14 002722   012622 701000 14                 TSX1    DELETE_MESSAGE
        14 002723   000000 011000                    NOP     0
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:192  

     1092    13728    6                       CALL POST_MESSAGE_REJECTION( SITE_NAME);

  13728 14 002724   000026 236000 15                 LDQ     22
        14 002725   222607 756100                    STQ     LEN_TARGET+2,,AUTO
        14 002726   013327 701000 14                 TSX1    POST_MESSAGE_REJECTION
        14 002727   000000 011000                    NOP     0

     1093    13729    6                       END;

     1094    13730    5                   END;

  13730 14 002730   002737 710000 14                 TRA     s:13736

     1095    13731    5               WHENALTRETURN DO;

     1096    13732    5                   CALL DELETE_MESSAGE;

  13732 14 002731   012622 701000 14                 TSX1    DELETE_MESSAGE
        14 002732   000000 011000                    NOP     0

     1097    13733    5                   CALL POST_MESSAGE_REJECTION( SITE_NAME);

  13733 14 002733   000026 236000 15                 LDQ     22
        14 002734   222607 756100                    STQ     LEN_TARGET+2,,AUTO
        14 002735   013327 701000 14                 TSX1    POST_MESSAGE_REJECTION
        14 002736   000000 011000                    NOP     0

     1098    13734    5                   END;

     1099    13735    4               END TRY_THIS_ONE;

     1100    13736    3           IF MESSAGE_FILE THEN

  13736 14 002737   200141 234100                    SZN     MESSAGE_FILE,,AUTO
        14 002740   002743 605000 14                 TPL     s:13738

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:193  
     1101    13737    3                OUT_OF_MESSAGES = %YES#;

  13737 14 002741   400000 236003                    LDQ     -131072,DU
        14 002742   222356 756100                    STQ     OUT_OF_MESSAGES,,AUTO

     1102    13738    3           END;

  13738 14 002743   222355 234100                    SZN     HAVE_A_MESSAGE,,AUTO
        14 002744   002747 604000 14                 TMI     s:13739
        14 002745   222356 234100                    SZN     OUT_OF_MESSAGES,,AUTO
        14 002746   002704 605000 14                 TPL     s:13710

     1103    13739    2       IF NOT HAVE_A_MESSAGE THEN

  13739 14 002747   222355 234100                    SZN     HAVE_A_MESSAGE,,AUTO
        14 002750   002753 604000 14                 TMI     s:13741

     1104    13740    2           ALTRETURN;

  13740 14 002751   222354 221300                    LDX1  ! HAVE_A_CMD,,AUTO
        14 002752   000000 702211                    TSX2  ! 0,X1

     1105    13741    2       RETURN;

  13741 14 002753   222354 221300                    LDX1  ! HAVE_A_CMD,,AUTO
        14 002754   000001 702211                    TSX2  ! 1,X1

     1106    13742
     1107    13743    2       END GET_MAIL_HEADER;
     1108    13744        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:194  
     1109    13745    1   POSITION_TO_FIRST_MESS: PROC;

  13745 14 002755   222354 741300       POSITION_TO* STX1  ! HAVE_A_CMD,,AUTO

     1110    13746
     1111    13747    2       OPEN_MESSAGE.NAME_ = VECTOR( MESS);

  13747 14 002756   000030 237000 15                 LDAQ    24
        14 002757   000022 757000 6                  STAQ    OPEN_MESSAGE+6

     1112    13748    2       OPEN_MESSAGE.V.OPER.NXTF# = %NO#;

  13748 14 002760   000032 236000 15                 LDQ     26
        14 002761   000060 356000 6                  ANSQ    OPEN_MESSAGE+36

     1113    13749    2       OPEN_MESSAGE.V.OPER.TEST# = %YES#;

  13749 14 002762   020000 236007                    LDQ     8192,DL
        14 002763   000060 256000 6                  ORSQ    OPEN_MESSAGE+36

     1114    13750    2       OPEN_MESSAGE.V.INITZ.SCRUB# = %YES#;

  13750 14 002764   400000 236007                    LDQ     -131072,DL
        14 002765   000060 256000 6                  ORSQ    OPEN_MESSAGE+36

     1115    13751    2       CALL M$OPEN( OPEN_MESSAGE)

  13751 14 002766   000014 630400 6                  EPPR0   OPEN_MESSAGE
        14 002767   450000 713400                    CLIMB   alt,open
        14 002770   410400 401760                    pmme    nvectors=18
        14 002771   002773 702000 14                 TSX2    s:13754
        14 002772   002773 710000 14                 TRA     s:13754

     1116    13752    3       WHENALTRETURN DO;

     1117    13753    3           END;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:195  
     1118    13754    2       MESSAGE_FILE = %YES#;

  13754 14 002773   400000 236003                    LDQ     -131072,DU
        14 002774   200141 756100                    STQ     MESSAGE_FILE,,AUTO

     1119    13755    2       RETURN;

  13755 14 002775   222354 221300                    LDX1  ! HAVE_A_CMD,,AUTO
        14 002776   000001 702211                    TSX2  ! 1,X1

     1120    13756
     1121    13757    2       END;
     1122    13758
     1123    13759    1   OPEN_NEXT_MESS: PROC ALTRET;

  13759 14 002777   222354 741300       OPEN_NEXT_M* STX1  ! HAVE_A_CMD,,AUTO

     1124    13760
     1125    13761    2       OPEN_MESSAGE.NAME_ = VECTOR( NIL);

  13761 14 003000   000024 237000 15                 LDAQ    20
        14 003001   000022 757000 6                  STAQ    OPEN_MESSAGE+6

     1126    13762    2       OPEN_MESSAGE.V.OPER.NXTF# = %YES#;

  13762 14 003002   004000 236007                    LDQ     2048,DL
        14 003003   000060 256000 6                  ORSQ    OPEN_MESSAGE+36

     1127    13763    2       OPEN_MESSAGE.V.OPER.TEST# = %NO#;

  13763 14 003004   000033 236000 15                 LDQ     27
        14 003005   000060 356000 6                  ANSQ    OPEN_MESSAGE+36

     1128    13764    2       OPEN_MESSAGE.V.INITZ.SCRUB# = %NO#;

  13764 14 003006   000034 236000 15                 LDQ     28
        14 003007   000060 356000 6                  ANSQ    OPEN_MESSAGE+36
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:196  

     1129    13765    2       USER_COUNT = 0;

  13765 14 003010   200142 450100                    STZ     USER_COUNT,,AUTO

     1130    13766    2       MSG_NUMBER = 0;

  13766 14 003011   222343 450100                    STZ     MSG_NUMBER,,AUTO

     1131    13767    2       CALL M$OPEN( OPEN_MESSAGE) ALTRET( OOPS);

  13767 14 003012   000014 630400 6                  EPPR0   OPEN_MESSAGE
        14 003013   450000 713400                    CLIMB   alt,open
        14 003014   410400 401760                    pmme    nvectors=18
        14 003015   003032 702000 14                 TSX2    OOPS

     1132    13768    2       IF SUBSTR( M$FOLDER$->F$DCB.NAME#.C, 0, 5) = ':MESS' THEN

  13768 14 003016   200077 470500                    LDP0    M$FOLDER$,,AUTO
        14 003017   040000 106500                    CMPC    fill='040'O
        14 003020   000010 200005                    ADSC9   8,,PR0                   cn=1,n=5
        14 003021   002766 000005 1                  ADSC9   TCM_XLATE_TO_UC+193      cn=0,n=5
        14 003022   003025 601000 14                 TNZ     s:13770

     1133    13769    2           RETURN;

  13769 14 003023   222354 221300                    LDX1  ! HAVE_A_CMD,,AUTO
        14 003024   000001 702211                    TSX2  ! 1,X1

     1134    13770    2       CALL M$CLOSE( CLOSE_FOLDER)

  13770 14 003025   000376 630400 1                  EPPR0   CLOSE_FOLDER
        14 003026   450001 713400                    CLIMB   alt,close
        14 003027   406000 401760                    pmme    nvectors=13
        14 003030   003032 702000 14                 TSX2    OOPS
        14 003031   003032 710000 14                 TRA     OOPS

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:197  
     1135    13771    3       WHENALTRETURN DO;

     1136    13772    3           END;

     1137    13773    2   OOPS:
     1138    13774    2       ALTRETURN;

  13774 14 003032   222354 221300       OOPS         LDX1  ! HAVE_A_CMD,,AUTO
        14 003033   000000 702211                    TSX2  ! 0,X1

     1139    13775
     1140    13776    2       END OPEN_NEXT_MESS;
     1141    13777        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:198  
     1142    13778    1   SELECT_DESTINATION_SITE: PROC ALTRET;

  13778 14 003034   222360 741300       SELECT_DEST* STX1  ! SUB$,,AUTO

     1143    13779
     1144    13780    2       DCL SITE_END UBIN;
     1145    13781    2       DCL SITE_START UBIN;
     1146    13782    2       DCL SITE_STRING CHAR(32);
     1147    13783
     1148    13784    3       IF SUBSTR(PATH$->CV.T, 1, 1) = '@' /* there's a forward path */ THEN DO;

  13784 14 003035   002455 470400 1                  LDP0    PATH$
        14 003036   000000 720100                    LXL0    0,,PR0
        14 003037   000001 236100                    LDQ     1,,PR0
        14 003040   000777 376003                    ANQ     511,DU
        14 003041   000100 116003                    CMPQ    64,DU
        14 003042   003073 601000 14                 TNZ     s:13793

     1149    13785    3           CALL INDEX( SITE_END, ':', PATH$->CV.T);

  13785 14 003043   000000 124540                    SCM     mask='000'O
        14 003044   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 003045   000035 000001 15                 ADSC9   29                       cn=0,n=1
        14 003046   222361 000100                    ARG     SITE_END,,AUTO

     1150    13786    3           CALL INDEX( SITE_END, ',', SUBSTR( PATH$->CV.T, 0, SITE_END));

  13786 14 003047   222361 722100                    LXL2    SITE_END,,AUTO
        14 003050   000000 124540                    SCM     mask='000'O
        14 003051   000001 000012                    ADSC9   1,,PR0                   cn=0,n=*X2
        14 003052   000036 000001 15                 ADSC9   30                       cn=0,n=1
        14 003053   222361 000100                    ARG     SITE_END,,AUTO

     1151    13787    3           CALL INDEX( SITE_END, '.', SUBSTR( PATH$->CV.T, 0, SITE_END));

  13787 14 003054   222361 722100                    LXL2    SITE_END,,AUTO
        14 003055   000000 124540                    SCM     mask='000'O
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:199  
        14 003056   000001 000012                    ADSC9   1,,PR0                   cn=0,n=*X2
        14 003057   000037 000001 15                 ADSC9   31                       cn=0,n=1
        14 003060   222361 000100                    ARG     SITE_END,,AUTO

     1152    13788    3           CALL XLATE( SITE_STRING, TCM_XLATE_TO_UC,

  13788 14 003061   222361 722100                    LXL2    SITE_END,,AUTO
        14 003062   777776 623012                    EAX3    -2,X2
        14 003063   040100 160540                    MVT     fill='040'O
        14 003064   000001 400013                    ADSC9   1,,PR0                   cn=2,n=*X3
        14 003065   222363 000040                    ADSC9   SITE_STRING,,AUTO        cn=0,n=32
        14 003066   002465 000000 1                  ARG     TCM_XLATE_TO_UC

     1153    13789    3                   SUBSTR( PATH$->CV.T, 2, SITE_END - 2));
     1154    13790    3           SITE_END = SITE_END - 2;

  13790 14 003067   222361 235100                    LDA     SITE_END,,AUTO
        14 003070   000002 135007                    SBLA    2,DL
        14 003071   222361 755100                    STA     SITE_END,,AUTO

     1155    13791    3           END;

  13791 14 003072   003106 710000 14                 TRA     s:13796

     1156    13792    3       ELSE DO;

     1157    13793    3           CALL XLATE( SITE_STRING, TCM_XLATE_TO_UC, TOSITE$->CV.T);

  13793 14 003073   002464 471400 1                  LDP1    TOSITE$
        14 003074   100000 722100                    LXL2    0,,PR1
        14 003075   040100 160540                    MVT     fill='040'O
        14 003076   100001 000012                    ADSC9   1,,PR1                   cn=0,n=*X2
        14 003077   222363 000040                    ADSC9   SITE_STRING,,AUTO        cn=0,n=32
        14 003100   002465 000000 1                  ARG     TCM_XLATE_TO_UC

     1158    13794    3           CALL INDEX( SITE_END, '.', TOSITE$->CV.T);

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:200  
  13794 14 003101   100000 720100                    LXL0    0,,PR1
        14 003102   000000 124540                    SCM     mask='000'O
        14 003103   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0
        14 003104   000037 000001 15                 ADSC9   31                       cn=0,n=1
        14 003105   222361 000100                    ARG     SITE_END,,AUTO

     1159    13795    3           END;

     1160    13796    2       XUW_WILDCARD.INPUT_ = VECTOR( SUBSTR( SITE_STRING, 0, SITE_END));

  13796 14 003106   222361 235100                    LDA     SITE_END,,AUTO
        14 003107   000020 735000                    ALS     16
        14 003110   000140 135007                    SBLA    96,DL
        14 003111   222722 452500                    STP2    @VLEN+2,,AUTO
        14 003112   222722 236100                    LDQ     @VLEN+2,,AUTO
        14 003113   022363 036003                    ADLQ    9459,DU
        14 003114   001020 757000 6                  STAQ    XUW_WILDCARD+2

     1161    13797    2   FIND_NODE:
     1162    13798    3       DO;

  13798 14 003115                       FIND_NODE    null
     1163    13799    4           DO THIS_NODE = 0 TO NODES - 1;

  13799 14 003115   200132 450100                    STZ     THIS_NODE,,AUTO
        14 003116   003154 710000 14                 TRA     s:13809+1

     1164    13800    4               CALL INDEX( VLEN, ' ', NODE.NAME( THIS_NODE));

  13800 14 003117   200132 236100                    LDQ     THIS_NODE,,AUTO
        14 003120   000114 402007                    MPY     76,DL
        14 003121   000000 124506                    SCM     mask='000'O
        14 003122   201252 000040                    ADSC9   NODE,Q,AUTO              cn=0,n=32
        14 003123   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 003124   200104 000100                    ARG     VLEN,,AUTO

     1165    13801    4               XUW_WILDCARD.PATTERN_ =
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:201  

  13801 14 003125   200104 235100                    LDA     VLEN,,AUTO
        14 003126   000020 735000                    ALS     16
        14 003127   000140 135007                    SBLA    96,DL
        14 003130   222722 452500                    STP2    @VLEN+2,,AUTO
        14 003131   200132 236100                    LDQ     THIS_NODE,,AUTO
        14 003132   222723 755100                    STA     @VLEN+3,,AUTO
        14 003133   000023 402003                    MPY     19,DU
        14 003134   001252 036003                    ADLQ    682,DU
        14 003135   222722 036100                    ADLQ    @VLEN+2,,AUTO
        14 003136   222723 235100                    LDA     @VLEN+3,,AUTO
        14 003137   001016 757000 6                  STAQ    XUW_WILDCARD

     1166    13802    4                       VECTOR( SUBSTR( NODE.NAME( THIS_NODE), 0, VLEN));
     1167    13803    4               CALL X$WILDCMP( XUW_WILDCARD)

  13803 14 003140   000040 630400 15                 EPPR0   32
        14 003141   000017 631400 xsym               EPPR1   B_VECTNIL+15
        14 003142   000000 701000 xent               TSX1    X$WILDCMP
        14 003143   003153 702000 14                 TSX2    s:13809

     1168    13804    5               WHENRETURN DO;

     1169    13805    5                   THIS_SITE = NODE.SITE( THIS_NODE);

  13805 14 003144   200132 236100                    LDQ     THIS_NODE,,AUTO
        14 003145   000023 402007                    MPY     19,DL
        14 003146   201262 235106                    LDA     NODE+8,QL,AUTO
        14 003147   200130 755100                    STA     THIS_SITE,,AUTO

     1170    13806    5                   IS_OR_VIA = NODE.IS_OR_VIA( THIS_NODE);

  13806 14 003150   201274 235106                    LDA     NODE+18,QL,AUTO
        14 003151   200144 755100                    STA     IS_OR_VIA,,AUTO

     1171    13807    5                   EXIT FIND_NODE;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:202  
  13807 14 003152   003166 710000 14                 TRA     s:13813

     1172    13808    5                   END;
     1173    13809    4               END;

  13809 14 003153   200132 054100                    AOS     THIS_NODE,,AUTO
        14 003154   200132 236100                    LDQ     THIS_NODE,,AUTO
        14 003155   200131 116100                    CMPQ    NODES,,AUTO
        14 003156   003117 604000 14                 TMI     s:13800

     1174    13810    3           REPLY = 'Can''t find a site to handle traffic to that node.';

  13810 14 003157   002210 470400 1                  LDP0    REPLY$
        14 003160   002207 720000 6                  LXL0    REPLYLEN
        14 003161   040140 100400                    MLR     fill='040'O
        14 003162   002770 000061 1                  ADSC9   TCM_XLATE_TO_UC+195      cn=0,n=49
        14 003163   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0

     1175    13811    3           ALTRETURN;

  13811 14 003164   222360 221300                    LDX1  ! SUB$,,AUTO
        14 003165   000000 702211                    TSX2  ! 0,X1

     1176    13812    3           END FIND_NODE;
     1177    13813    2       RETURN;

  13813 14 003166   222360 221300                    LDX1  ! SUB$,,AUTO
        14 003167   000001 702211                    TSX2  ! 1,X1

     1178    13814
     1179    13815    2       END SELECT_DESTINATION_SITE;
     1180    13816        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:203  
     1181    13817    1   SMTP_SESSION: PROC ALTRET;

  13817 14 003170   222352 741300       SMTP_SESSION STX1  ! ALIAS$+2,,AUTO

     1182    13818
     1183    13819    2       DCL TRIES_LEFT SBIN;
     1184    13820
     1185    13821    2       CALL M$OPEN( OPEN_FOLDER) ALTRET( BAILOUT);

  13821 14 003171   000212 630400 1                  EPPR0   OPEN_FOLDER
        14 003172   450000 713400                    CLIMB   alt,open
        14 003173   410400 401760                    pmme    nvectors=18
        14 003174   003444 702000 14                 TSX2    BAILOUT

     1186    13822    2       CALL M$ENQ( ENQ_ON_FILE) ALTRET( BAILOUT);

  13822 14 003175   000552 630400 1                  EPPR0   ENQ_ON_FILE
        14 003176   420002 713400                    CLIMB   alt,+8194
        14 003177   401000 401760                    pmme    nvectors=3
        14 003200   003444 702000 14                 TSX2    BAILOUT

     1187    13823    2       MESSAGE_FILE = %NO#;

  13823 14 003201   200141 450100                    STZ     MESSAGE_FILE,,AUTO

     1188    13824            /****** LOGON TO SMTP ******/
     1189    13825    2       CALL STATUS_UPDATE( CONNECTING);

  13825 14 003202   000041 236000 15                 LDQ     33
        14 003203   222715 756100                    STQ     LAST+2,,AUTO
        14 003204   013522 701000 14                 TSX1    STATUS_UPDATE
        14 003205   000000 011000                    NOP     0

     1190    13826    2       CALL TCM$WRITE_AUDIT_LOG( , SITE.NAME( CURR_SITE));

  13826 14 003206   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 003207   000072 402007                    MPY     58,DL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:204  
        14 003210   200146 630506                    EPPR0   SITE,QL,AUTO
        14 003211   222723 450500                    STP0    @VLEN+3,,AUTO
        14 003212   000001 236000 xsym               LDQ     B_VECTNIL+1
        14 003213   222722 756100                    STQ     @VLEN+2,,AUTO
        14 003214   222722 630500                    EPPR0   @VLEN+2,,AUTO
        14 003215   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 003216   000000 701000 xent               TSX1    TCM$WRITE_AUDIT_LOG
        14 003217   000000 011000                    NOP     0

     1191    13827    2       TCM_SMTP_PROGRESS = %SMTP_BUSY;

  13827 14 003220   000001 235007                    LDA     1,DL
        14 003221   001126 755000 6                  STA     TCM_SMTP_PROGRESS

     1192    13828    2       CALL TCM$START_SMTP( SITE.LOGON( CURR_SITE), SITE.ADDRESS( CURR_SITE),

  13828 14 003222   200102 630500                    EPPR0   FLOW_CONTROL_ENABLED,,AUTO
        14 003223   222725 450500                    STP0    @VLEN+5,,AUTO
        14 003224   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 003225   000072 402007                    MPY     58,DL
        14 003226   200226 631506                    EPPR1   SITE+48,QL,AUTO
        14 003227   222724 451500                    STP1    @VLEN+4,,AUTO
        14 003230   200166 633506                    EPPR3   SITE+16,QL,AUTO
        14 003231   222723 453500                    STP3    @VLEN+3,,AUTO
        14 003232   200156 634506                    EPPR4   SITE+8,QL,AUTO
        14 003233   222722 454500                    STP4    @VLEN+2,,AUTO
        14 003234   222722 630500                    EPPR0   @VLEN+2,,AUTO
        14 003235   000022 631400 xsym               EPPR1   B_VECTNIL+18
        14 003236   000000 701000 xent               TSX1    TCM$START_SMTP
        14 003237   000000 011000                    NOP     0

     1193    13829    2               SITE.TYPE( CURR_SITE), FLOW_CONTROL_ENABLED);
     1194    13830    2       CALL STATUS_UPDATE( WAITING_FOR_SMTP_GREETING);

  13830 14 003240   000042 236000 15                 LDQ     34
        14 003241   222715 756100                    STQ     LAST+2,,AUTO
        14 003242   013522 701000 14                 TSX1    STATUS_UPDATE
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:205  
        14 003243   000000 011000                    NOP     0

     1195    13831    2       TCM_SMTP_PROGRESS = %SMTP_CONNECTED;

  13831 14 003244   000003 235007                    LDA     3,DL
        14 003245   001126 755000 6                  STA     TCM_SMTP_PROGRESS

     1196    13832    2       IF NOT TCM_TESTMODE THEN

  13832 14 003246   001171 234000 6                  SZN     TCM_TESTMODE
        14 003247   003300 604000 14                 TMI     s:13844

     1197    13833    3           DO UNTIL SUBSTR( CMDBUF, 0, 4) = '220 ';

     1198    13834    3               CALL TCM$READ_SMTP( CMDBUF_, REPLYLEN, 60)

  13834 14 003250   000044 630400 15                 EPPR0   36
        14 003251   000021 631400 xsym               EPPR1   B_VECTNIL+17
        14 003252   000000 701000 xent               TSX1    TCM$READ_SMTP
        14 003253   003255 702000 14                 TSX2    s:13836
        14 003254   003257 710000 14                 TRA     s:13838

     1199    13835    4               WHENALTRETURN DO;

     1200    13836    4                   ALTRETURN;

  13836 14 003255   222352 221300                    LDX1  ! ALIAS$+2,,AUTO
        14 003256   000000 702211                    TSX2  ! 0,X1

     1201    13837    4                   END;
     1202    13838    3               WRITE_ME.BUF_.BOUND = REPLYLEN;

  13838 14 003257   002207 236000 6                  LDQ     REPLYLEN
        14 003260   000020 736000                    QLS     16
        14 003261   000242 676000 6                  ERQ     WRITE_ME+4
        14 003262   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 003263   000242 656000 6                  ERSQ    WRITE_ME+4
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:206  

     1203    13839    3               CALL M$WRITE( WRITE_ME);

  13839 14 003264   000236 630400 6                  EPPR0   WRITE_ME
        14 003265   040001 713400                    CLIMB   write
        14 003266   401400 401760                    pmme    nvectors=4

     1204    13840    3               IF SUBSTR( CMDBUF, 0, LENGTHC( 'Dial line not active')) =

  13840 14 003267   040000 106400                    CMPC    fill='040'O
        14 003270   002107 000024 6                  ADSC9   CMDBUF                   cn=0,n=20
        14 003271   003005 000024 1                  ADSC9   TCM_XLATE_TO_UC+208      cn=0,n=20
        14 003272   003275 601000 14                 TNZ     s:13843

     1205    13841    3                       'Dial line not active' THEN
     1206    13842    3                   ALTRETURN;

  13842 14 003273   222352 221300                    LDX1  ! ALIAS$+2,,AUTO
        14 003274   000000 702211                    TSX2  ! 0,X1

     1207    13843    3           END;

  13843 14 003275   002107 236000 6                  LDQ     CMDBUF
        14 003276   003012 116000 1                  CMPQ    TCM_XLATE_TO_UC+213
        14 003277   003250 601000 14                 TNZ     s:13834

     1208    13844    2       CALL STATUS_UPDATE( LOGGING_ON_TO_SMTP);

  13844 14 003300   000047 236000 15                 LDQ     39
        14 003301   222715 756100                    STQ     LAST+2,,AUTO
        14 003302   013522 701000 14                 TSX1    STATUS_UPDATE
        14 003303   000000 011000                    NOP     0

     1209    13845    3       DO TRIES_LEFT = 3 DOWNTO 0;

  13845 14 003304   000003 235007                    LDA     3,DL
        14 003305   222353 755100                    STA     TRIES_LEFT,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:207  

     1210    13846    3           CALL CONCAT( CMDBUF, 'HELO ', SITE.IDENT.TEXT( CURR_SITE));

  13846 14 003306   040000 100400                    MLR     fill='040'O
        14 003307   003013 000005 1                  ADSC9   TCM_XLATE_TO_UC+214      cn=0,n=5
        14 003310   002107 000005 6                  ADSC9   CMDBUF                   cn=0,n=5
        14 003311   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 003312   000350 402007                    MPY     232,DL
        14 003313   040000 100506                    MLR     fill='040'O
        14 003314   200176 200037                    ADSC9   SITE+24,Q,AUTO           cn=1,n=31
        14 003315   002110 200372 6                  ADSC9   CMDBUF+1                 cn=1,n=250

     1211    13847    3           CALL SEND_SMTP_COMMAND( '2') ALTRET( NO_SMTP);

  13847 14 003316   000051 236000 15                 LDQ     41
        14 003317   222607 756100                    STQ     LEN_TARGET+2,,AUTO
        14 003320   007243 701000 14                 TSX1    SEND_SMTP_COMMAND
        14 003321   003442 702000 14                 TSX2    NO_SMTP

     1212    13848    3           IF SUBSTR( CMDBUF, 0, 3) = '250' THEN

  13848 14 003322   002107 236000 6                  LDQ     CMDBUF
        14 003323   003015 676000 1                  ERQ     TCM_XLATE_TO_UC+216
        14 003324   000052 376000 15                 ANQ     42
        14 003325   003335 600000 14                 TZE     s:13854

     1213    13849    3               EXIT;
     1214    13850    3           ELSE
     1215    13851    3               IF TRIES_LEFT = 0 THEN

  13851 14 003326   222353 235100                    LDA     TRIES_LEFT,,AUTO
        14 003327   003332 601000 14                 TNZ     s:13853

     1216    13852    3                   ALTRETURN;

  13852 14 003330   222352 221300                    LDX1  ! ALIAS$+2,,AUTO
        14 003331   000000 702211                    TSX2  ! 0,X1
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:208  

     1217    13853    3           END;

  13853 14 003332   000001 336007                    LCQ     1,DL
        14 003333   222353 056100                    ASQ     TRIES_LEFT,,AUTO
        14 003334   003306 605000 14                 TPL     s:13846

     1218    13854    2       MSG_COUNT = 0;

  13854 14 003335   200103 450100                    STZ     MSG_COUNT,,AUTO

     1219    13855    2       CALL TCM$WRITE_AUDIT_LOG( MSG_COUNT, SITE.NAME( CURR_SITE));

  13855 14 003336   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 003337   000072 402007                    MPY     58,DL
        14 003340   200146 630506                    EPPR0   SITE,QL,AUTO
        14 003341   222723 450500                    STP0    @VLEN+3,,AUTO
        14 003342   200103 631500                    EPPR1   MSG_COUNT,,AUTO
        14 003343   222722 451500                    STP1    @VLEN+2,,AUTO
        14 003344   222722 630500                    EPPR0   @VLEN+2,,AUTO
        14 003345   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 003346   000000 701000 xent               TSX1    TCM$WRITE_AUDIT_LOG
        14 003347   000000 011000                    NOP     0

     1220    13856    2       TCM_SMTP_PROGRESS = %SMTP_SESSION;

  13856 14 003350   000004 235007                    LDA     4,DL
        14 003351   001126 755000 6                  STA     TCM_SMTP_PROGRESS

     1221    13857    2       MSG_NUMBER = 0;

  13857 14 003352   222343 450100                    STZ     MSG_NUMBER,,AUTO

     1222    13858    3       DO FOREVER;  /** DO UNTIL ALL MAIL HAS BEEN PROCESSED **/

     1223    13859    3           CALL STATUS_UPDATE( DECODING_HEADER);

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:209  
  13859 14 003353   000053 236000 15                 LDQ     43
        14 003354   222715 756100                    STQ     LAST+2,,AUTO
        14 003355   013522 701000 14                 TSX1    STATUS_UPDATE
        14 003356   000000 011000                    NOP     0

     1224    13860    3           CALL GET_MAIL_HEADER ALTRET( EOM);

  13860 14 003357   002701 701000 14                 TSX1    GET_MAIL_HEADER
        14 003360   003367 702000 14                 TSX2    EOM

     1225    13861    3           IF THIS_SITE = CURR_SITE /* going to current connection */ THEN

  13861 14 003361   200130 236100                    LDQ     THIS_SITE,,AUTO
        14 003362   200127 116100                    CMPQ    CURR_SITE,,AUTO
        14 003363   003353 601000 14                 TNZ     s:13859

     1226    13862    3               CALL SEND_ONE_MAILGRAM;

  13862 14 003364   003446 701000 14                 TSX1    SEND_ONE_MAILGRAM
        14 003365   000000 011000                    NOP     0

     1227    13863    3           END;

  13863 14 003366   003353 710000 14                 TRA     s:13859

     1228    13864    2   EOM:
     1229    13865    2       CALL M$CLOSE( CLOSE_FOLDER)

  13865 14 003367   000376 630400 1     EOM          EPPR0   CLOSE_FOLDER
        14 003370   450001 713400                    CLIMB   alt,close
        14 003371   406000 401760                    pmme    nvectors=13
        14 003372   003374 702000 14                 TSX2    s:13868
        14 003373   003374 710000 14                 TRA     s:13868

     1230    13866    3       WHENALTRETURN DO;

     1231    13867    3           END;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:210  

     1232    13868    2       CALL POSITION_TO_FIRST_MESS;

  13868 14 003374   002755 701000 14                 TSX1    POSITION_TO_FIRST_MESS
        14 003375   000000 011000                    NOP     0

     1233    13869    3       DO FOREVER;

     1234    13870    3           CALL OPEN_NEXT_MESS ALTRET( EOMM);

  13870 14 003376   002777 701000 14                 TSX1    OPEN_NEXT_MESS
        14 003377   003425 702000 14                 TSX2    EOMM

     1235    13871    3           CALL STATUS_UPDATE( DECODING_HEADER);

  13871 14 003400   000053 236000 15                 LDQ     43
        14 003401   222715 756100                    STQ     LAST+2,,AUTO
        14 003402   013522 701000 14                 TSX1    STATUS_UPDATE
        14 003403   000000 011000                    NOP     0

     1236    13872    3           CALL GET_MAIL_HEADER ALTRET( EOMM);

  13872 14 003404   002701 701000 14                 TSX1    GET_MAIL_HEADER
        14 003405   003425 702000 14                 TSX2    EOMM

     1237    13873    3           IF THIS_SITE = CURR_SITE /* going to current connection */ THEN

  13873 14 003406   200130 236100                    LDQ     THIS_SITE,,AUTO
        14 003407   200127 116100                    CMPQ    CURR_SITE,,AUTO
        14 003410   003413 601000 14                 TNZ     s:13875

     1238    13874    3               CALL SEND_ONE_MAILGRAM;

  13874 14 003411   003446 701000 14                 TSX1    SEND_ONE_MAILGRAM
        14 003412   000000 011000                    NOP     0

     1239    13875    3           IF M$FOLDER$->F$DCB.FCD# THEN
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:211  

  13875 14 003413   200077 470500                    LDP0    M$FOLDER$,,AUTO
        14 003414   000031 236100                    LDQ     25,,PR0
        14 003415   020000 316007                    CANQ    8192,DL
        14 003416   003376 600000 14                 TZE     s:13870

     1240    13876    3               CALL M$CLOSE( CLOSE_FOLDER)

  13876 14 003417   000376 630400 1                  EPPR0   CLOSE_FOLDER
        14 003420   450001 713400                    CLIMB   alt,close
        14 003421   406000 401760                    pmme    nvectors=13
        14 003422   003424 702000 14                 TSX2    s:13879
        14 003423   003424 710000 14                 TRA     s:13879

     1241    13877    4               WHENALTRETURN DO;

     1242    13878    4                   END;

     1243    13879    3           END;

  13879 14 003424   003376 710000 14                 TRA     s:13870

     1244    13880    2   EOMM:
     1245    13881    2       CALL STATUS_UPDATE( LOGGING_OFF_OF_SMTP);

  13881 14 003425   000054 236000 15    EOMM         LDQ     44
        14 003426   222715 756100                    STQ     LAST+2,,AUTO
        14 003427   013522 701000 14                 TSX1    STATUS_UPDATE
        14 003430   000000 011000                    NOP     0

     1246    13882    2       CMDBUF = 'QUIT';

  13882 14 003431   040000 100400                    MLR     fill='040'O
        14 003432   003016 000004 1                  ADSC9   TCM_XLATE_TO_UC+217      cn=0,n=4
        14 003433   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     1247    13883    2       CALL SEND_SMTP_COMMAND( '2');
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:212  

  13883 14 003434   000051 236000 15                 LDQ     41
        14 003435   222607 756100                    STQ     LEN_TARGET+2,,AUTO
        14 003436   007243 701000 14                 TSX1    SEND_SMTP_COMMAND
        14 003437   000000 011000                    NOP     0

     1248    13884    2       TCM_SMTP_PROGRESS = %SMTP_COMPLETE;

  13884 14 003440   000005 235007                    LDA     5,DL
        14 003441   001126 755000 6                  STA     TCM_SMTP_PROGRESS

     1249    13885    2   NO_SMTP:
     1250    13886    2       RETURN;

  13886 14 003442   222352 221300       NO_SMTP      LDX1  ! ALIAS$+2,,AUTO
        14 003443   000001 702211                    TSX2  ! 1,X1

     1251    13887    2   BAILOUT:
     1252    13888    2       ALTRETURN;

  13888 14 003444   222352 221300       BAILOUT      LDX1  ! ALIAS$+2,,AUTO
        14 003445   000000 702211                    TSX2  ! 0,X1

     1253    13889
     1254    13890    2       END SMTP_SESSION;
     1255    13891        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:213  
     1256    13892    1   SEND_ONE_MAILGRAM: PROC;

  13892 14 003446   222354 741300       SEND_ONE_MA* STX1  ! HAVE_A_CMD,,AUTO

     1257    13893
     1258    13894    2       DCL COUNT UBIN;
     1259    13895    2       DCL GOT_ONE BIT(1);
     1260    13896    2       DCL I SBIN;
     1261    13897    2       DCL LEN SBIN;
     1262    13898    2       DCL INDX UBIN;
     1263    13899    2       DCL INDX1 UBIN;
     1264    13900    2       DCL INDX2 UBIN;
     1265    13901    2       DCL OFFSET UBIN;
     1266    13902    2       DCL QUOTE_NUMBER SBIN;
     1267    13903    2       DCL RR BIT(1);
     1268    13904    2       DCL TBUF CHAR(32);
     1269    13905    2       DCL TRIED_DIRECT_SEND BIT(1);
     1270    13906    2       DCL TVAL UBIN;
     1271    13907
     1272    13908    2       DCL II UBIN WORD;
     1273    13909    2       DCL JJ UBIN WORD;
     1274    13910    2       DCL SOURCE_STRG CHAR(%LINE_SIZE);
     1275    13911    2       DCL TARGET_STRG CHAR(%LINE_SIZE);
     1276    13912    2       DCL DONE_COMMA BIT(1);
     1277    13913    2       DCL LEN_SOURCE UBIN WORD;
     1278    13914    2       DCL LEN_TARGET UBIN WORD;
     1279    13915
     1280    13916            /****** INITIAL DIALOG WITH SMTP ******/
     1281    13917    2   BEGIN_SENDING:
     1282    13918    2       CALL STATUS_UPDATE( SENDING_ADDRESSES);

  13918 14 003447   000055 236000 15    BEGIN_SENDI* LDQ     45
        14 003450   222715 756100                    STQ     LAST+2,,AUTO
        14 003451   013522 701000 14                 TSX1    STATUS_UPDATE
        14 003452   000000 011000                    NOP     0

     1283    13919    2       TRIED_DIRECT_SEND = %NO#;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:214  

  13919 14 003453   222377 450100                    STZ     TRIED_DIRECT_SEND,,AUTO

     1284    13920        /*  IF VM_HEADER.STATUS.ACK THEN DO;     COMMENTED OUT 5-12-88 MAG
     1285    13921                CALL CONCAT( CMDBUF, 'SEND FROM:<', FROMADDR$->CV.T, '@',
     1286    13922                     SUBSTR( SITE.IDENT.TEXT( CURR_SITE), 0, SITE.IDENT.COUNT( CURR_SITE)),
     1287    13923                        '>');
     1288    13924                CALL SEND_SMTP_COMMAND( '2')
     1289    13925                WHENRETURN DO;
     1290    13926                    TRIED_DIRECT_SEND = %YES#;
     1291    13927                    GOTO BYPASS_MAIL_FROM;
     1292    13928                    END;
     1293    13929                END;                             COMMENTED OUT 5-12-88 MAG */
     1294    13930    2   MAIL_FROM:
     1295    13931    2       IF VM_HEADER.NUM_TRACE_RECORDS > 0 THEN

  13931 14 003454   222345 470500       MAIL_FROM    LDP0    HEADER$,,AUTO
        14 003455   000034 235100                    LDA     28,,PR0
        14 003456   003462 600000 14                 TZE     s:13934

     1296    13932    2           CALL SCAN_TRACE_RECORDS;

  13932 14 003457   006637 701000 14                 TSX1    SCAN_TRACE_RECORDS
        14 003460   000000 011000                    NOP     0
        14 003461   003555 710000 14                 TRA     s:13937

     1297    13933    2       ELSE
     1298    13934    2           CALL CONCAT( CMDBUF, 'MAIL FROM:<', FROMADDR$->CV.T, '@',

  13934 14 003462   002451 471400 1                  LDP1    FROMADDR$
        14 003463   100000 720100                    LXL0    0,,PR1
        14 003464   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 003465   000072 402007                    MPY     58,DL
        14 003466   200176 236106                    LDQ     SITE+24,QL,AUTO
        14 003467   000033 772000                    QRL     27
        14 003470   040000 100400                    MLR     fill='040'O
        14 003471   003017 000013 1                  ADSC9   TCM_XLATE_TO_UC+218      cn=0,n=11
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:215  
        14 003472   002107 000013 6                  ADSC9   CMDBUF                   cn=0,n=11
        14 003473   040000 100540                    MLR     fill='040'O
        14 003474   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0
        14 003475   002111 600364 6                  ADSC9   CMDBUF+2                 cn=3,n=244
        14 003476   000000 621006                    EAX1    0,QL
        14 003477   000000 636010                    EAQ     0,X0
        14 003500   000022 772000                    QRL     18
        14 003501   000364 116007                    CMPQ    244,DL
        14 003502   003555 603000 14                 TRC     s:13937
        14 003503   222722 740100                    STX0    @VLEN+2,,AUTO
        14 003504   777413 620010                    EAX0    -245,X0
        14 003505   777777 660003                    ERX0    -1,DU
        14 003506   222722 235100                    LDA     @VLEN+2,,AUTO
        14 003507   000022 771000                    ARL     18
        14 003510   040045 100400                    MLR     fill='040'O
        14 003511   000022 000001 15                 ADSC9   18                       cn=0,n=1
        14 003512   002111 600010 6                  ADSC9   CMDBUF+2,A               cn=3,n=*X0
        14 003513   222722 236100                    LDQ     @VLEN+2,,AUTO
        14 003514   000022 772000                    QRL     18
        14 003515   000363 116007                    CMPQ    243,DL
        14 003516   003555 603000 14                 TRC     s:13937
        14 003517   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 003520   000350 402007                    MPY     232,DL
        14 003521   000363 220003                    LDX0    243,DU
        14 003522   222722 120100                    SBLX0   @VLEN+2,,AUTO
        14 003523   222722 235100                    LDA     @VLEN+2,,AUTO
        14 003524   000022 771000                    ARL     18
        14 003525   040045 100546                    MLR     fill='040'O
        14 003526   200176 200011                    ADSC9   SITE+24,Q,AUTO           cn=1,n=*X1
        14 003527   002112 000010 6                  ADSC9   CMDBUF+3,A               cn=0,n=*X0
        14 003530   000000 635011                    EAA     0,X1
        14 003531   000022 771000                    ARL     18
        14 003532   222723 755100                    STA     @VLEN+3,,AUTO
        14 003533   222722 236100                    LDQ     @VLEN+2,,AUTO
        14 003534   000022 772000                    QRL     18
        14 003535   222723 036100                    ADLQ    @VLEN+3,,AUTO
        14 003536   000363 116007                    CMPQ    243,DL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:216  
        14 003537   003555 603000 14                 TRC     s:13937
        14 003540   000000 635011                    EAA     0,X1
        14 003541   000022 771000                    ARL     18
        14 003542   222724 755100                    STA     @VLEN+4,,AUTO
        14 003543   222725 756100                    STQ     @VLEN+5,,AUTO
        14 003544   222722 236100                    LDQ     @VLEN+2,,AUTO
        14 003545   000022 772000                    QRL     18
        14 003546   222724 036100                    ADLQ    @VLEN+4,,AUTO
        14 003547   222725 721100                    LXL1    @VLEN+5,,AUTO
        14 003550   777414 621011                    EAX1    -244,X1
        14 003551   777777 661003                    ERX1    -1,DU
        14 003552   040046 100400                    MLR     fill='040'O
        14 003553   000056 000001 15                 ADSC9   46                       cn=0,n=1
        14 003554   002112 000011 6                  ADSC9   CMDBUF+3,Q               cn=0,n=*X1

     1299    13935    2               SUBSTR( SITE.IDENT.TEXT( CURR_SITE), 0, SITE.IDENT.COUNT( CURR_SITE)),
     1300    13936    2               '>');
     1301    13937    2       CALL SEND_SMTP_COMMAND( '2') ALTRET( ERR);

  13937 14 003555   000051 236000 15                 LDQ     41
        14 003556   222607 756100                    STQ     LEN_TARGET+2,,AUTO
        14 003557   007243 701000 14                 TSX1    SEND_SMTP_COMMAND
        14 003560   006172 702000 14                 TSX2    ERR

     1302    13938    2       TRIED_DIRECT_SEND = %NO#;

  13938 14 003561   222377 450100                    STZ     TRIED_DIRECT_SEND,,AUTO

     1303    13939    2   BYPASS_MAIL_FROM:
     1304    13940    3       IF MESSAGE_FILE THEN DO;

  13940 14 003562   200141 234100       BYPASS_MAIL* SZN     MESSAGE_FILE,,AUTO
        14 003563   004175 605000 14                 TPL     s:14017

     1305    13941    3           GOT_ONE = %NO#;

  13941 14 003564   222356 450100                    STZ     GOT_ONE,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:217  

     1306    13942    4           DO COUNT = 0 TO USER_COUNT - 1;

  13942 14 003565   222355 450100                    STZ     COUNT,,AUTO
        14 003566   004167 710000 14                 TRA     SKIP_NON_BLIND_COPY+3

     1307    13943    4               IF ( HITS.BC AND USERS.LIST( COUNT) ~= %VM_TYPE_BC) OR

  13943 14 003567   200145 236100                    LDQ     HITS,,AUTO
        14 003570   100000 316003                    CANQ    32768,DU
        14 003571   003577 600000 14                 TZE     s:13943+8
        14 003572   222355 236100                    LDQ     COUNT,,AUTO
        14 003573   000076 402007                    MPY     62,DL
        14 003574   202344 235106                    LDA     USERS,QL,AUTO
        14 003575   000040 115007                    CMPA    32,DL
        14 003576   004164 601000 14                 TNZ     SKIP_NON_BLIND_COPY
        14 003577   200145 236100                    LDQ     HITS,,AUTO
        14 003600   100000 316003                    CANQ    32768,DU
        14 003601   003607 601000 14                 TNZ     s:13946
        14 003602   222355 236100                    LDQ     COUNT,,AUTO
        14 003603   000076 402007                    MPY     62,DL
        14 003604   202344 235106                    LDA     USERS,QL,AUTO
        14 003605   000040 115007                    CMPA    32,DL
        14 003606   004164 600000 14                 TZE     SKIP_NON_BLIND_COPY

     1308    13944    4                       ( NOT HITS.BC AND USERS.LIST( COUNT) = %VM_TYPE_BC) THEN
     1309    13945    4                   GOTO SKIP_NON_BLIND_COPY;
     1310    13946    5               IF IS_OR_VIA = %VIA_OPTION THEN DO;

  13946 14 003607   200144 235100                    LDA     IS_OR_VIA,,AUTO
        14 003610   000323 115007                    CMPA    211,DL
        14 003611   004073 601000 14                 TNZ     NO_CHANGE

     1311    13947    5                   CALL INDEX1R( INDX, '@', USERS.T( COUNT)) ALTRET( NO_CHANGE);

  13947 14 003612   222355 236100                    LDQ     COUNT,,AUTO
        14 003613   000370 402007                    MPY     248,DL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:218  
        14 003614   000000 125506                    SCMR    mask='000'O
        14 003615   202346 000360                    ADSC9   USERS+2,Q,AUTO           cn=0,n=240
        14 003616   000022 000001 15                 ADSC9   18                       cn=0,n=1
        14 003617   222361 000100                    ARG     INDX,,AUTO
        14 003620   004073 606400 14                 TTN     NO_CHANGE
        14 003621   000357 236007                    LDQ     239,DL
        14 003622   222361 156100                    SSQ     INDX,,AUTO

     1312    13948    6                   IF REWRITES > 0 THEN DO;

  13948 14 003623   222342 235100                    LDA     REWRITES,,AUTO
        14 003624   003734 604400 14                 TMOZ    s:13972

     1313    13949    6                       CALL XLATE( TBUF, TCM_XLATE_TO_UC,

  13949 14 003625   222355 236100                    LDQ     COUNT,,AUTO
        14 003626   000370 402007                    MPY     248,DL
        14 003627   222361 036100                    ADLQ    INDX,,AUTO
        14 003630   222360 720100                    LXL0    LEN,,AUTO
        14 003631   040100 160546                    MVT     fill='040'O
        14 003632   202346 000010                    ADSC9   USERS+2,Q,AUTO           cn=0,n=*X0
        14 003633   222367 000040                    ADSC9   TBUF,,AUTO               cn=0,n=32
        14 003634   002465 000000 1                  ARG     TCM_XLATE_TO_UC

     1314    13950    6                               SUBSTR( USERS.T( COUNT), INDX, LEN));
     1315    13951    6                       LEN = SITE.NAME.COUNT( CURR_SITE);

  13951 14 003635   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 003636   000072 402007                    MPY     58,DL
        14 003637   200146 236106                    LDQ     SITE,QL,AUTO
        14 003640   000033 772000                    QRL     27
        14 003641   222360 756100                    STQ     LEN,,AUTO

     1316    13952    6                       IF SUBSTR( SITE.NAME.TEXT( CURR_SITE), 0, LEN) =

  13952 14 003642   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 003643   000350 402007                    MPY     232,DL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:219  
        14 003644   222360 720100                    LXL0    LEN,,AUTO
        14 003645   040140 106546                    CMPC    fill='040'O
        14 003646   200146 200010                    ADSC9   SITE,Q,AUTO              cn=1,n=*X0
        14 003647   222367 200010                    ADSC9   TBUF,,AUTO               cn=1,n=*X0
        14 003650   003734 600000 14                 TZE     s:13972

     1317    13953    6                               SUBSTR( TBUF, 1, LEN) THEN
     1318    13954    6                           EXIT;  /* no rewrite if only one hop */
     1319    13955    6   REWRITE_LOOP:
     1320    13956    7                       DO I = 0 TO REWRITES - 1;

  13956 14 003651   222357 450100       REWRITE_LOOP STZ     I,,AUTO
        14 003652   003731 710000 14                 TRA     s:13970+1

     1321    13957    7                           LEN = REWRITE.OLD.LEN( I);

  13957 14 003653   222357 236100                    LDQ     I,,AUTO
        14 003654   000022 402007                    MPY     18,DL
        14 003655   221552 236106                    LDQ     REWRITE+2,QL,AUTO
        14 003656   000033 772000                    QRL     27
        14 003657   222360 756100                    STQ     LEN,,AUTO

     1322    13958    7                           IF SUBSTR( TBUF, 0, LEN) =

  13958 14 003660   222357 236100                    LDQ     I,,AUTO
        14 003661   000110 402007                    MPY     72,DL
        14 003662   222360 720100                    LXL0    LEN,,AUTO
        14 003663   040146 106540                    CMPC    fill='040'O
        14 003664   222367 000010                    ADSC9   TBUF,,AUTO               cn=0,n=*X0
        14 003665   221552 200010                    ADSC9   REWRITE+2,Q,AUTO         cn=1,n=*X0
        14 003666   003730 601000 14                 TNZ     s:13970

     1323    13959    8                                   SUBSTR( REWRITE.OLD.TXT( I), 0, LEN) THEN DO;

     1324    13960    8                               SUBSTR( USERS.T( COUNT), INDX, LEN) = ' ';

  13960 14 003667   222355 236100                    LDQ     COUNT,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:220  
        14 003670   000370 402007                    MPY     248,DL
        14 003671   222361 036100                    ADLQ    INDX,,AUTO
        14 003672   040146 100400                    MLR     fill='040'O
        14 003673   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 003674   202346 000010                    ADSC9   USERS+2,Q,AUTO           cn=0,n=*X0

     1325    13961    8                               USERS.L( COUNT) = USERS.L( COUNT) - LEN;

  13961 14 003675   222355 236100                    LDQ     COUNT,,AUTO
        14 003676   000076 402007                    MPY     62,DL
        14 003677   000000 621006                    EAX1    0,QL
        14 003700   202345 236106                    LDQ     USERS+1,QL,AUTO
        14 003701   222360 136100                    SBLQ    LEN,,AUTO
        14 003702   202345 756111                    STQ     USERS+1,X1,AUTO

     1326    13962    8                               CALL INDEX1R( INDX1, '%', USERS.T( COUNT), INDX)

  13962 14 003703   222355 236100                    LDQ     COUNT,,AUTO
        14 003704   000370 402007                    MPY     248,DL
        14 003705   222722 756100                    STQ     @VLEN+2,,AUTO
        14 003706   222361 236100                    LDQ     INDX,,AUTO
        14 003707   222361 722100                    LXL2    INDX,,AUTO
        14 003710   222722 235100                    LDA     @VLEN+2,,AUTO
        14 003711   000000 125545                    SCMR    mask='000'O
        14 003712   202346 000012                    ADSC9   USERS+2,A,AUTO           cn=0,n=*X2
        14 003713   000057 000001 15                 ADSC9   47                       cn=0,n=1
        14 003714   222362 000100                    ARG     INDX1,,AUTO
        14 003715   003727 606400 14                 TTN     s:13968
        14 003716   222362 054100                    AOS     INDX1,,AUTO
        14 003717   222362 156100                    SSQ     INDX1,,AUTO

     1327    13963    9                               WHENRETURN DO;

     1328    13964    9                                   SUBSTR( USERS.T( COUNT), INDX1, 1) = '@';

  13964 14 003720   222355 236100                    LDQ     COUNT,,AUTO
        14 003721   000370 402007                    MPY     248,DL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:221  
        14 003722   222362 036100                    ADLQ    INDX1,,AUTO
        14 003723   040106 100400                    MLR     fill='040'O
        14 003724   000022 000001 15                 ADSC9   18                       cn=0,n=1
        14 003725   202346 000001                    ADSC9   USERS+2,Q,AUTO           cn=0,n=1

     1329    13965    9                                   END;

  13965 14 003726   003727 710000 14                 TRA     s:13968

     1330    13966    9                               WHENALTRETURN DO;

     1331    13967    9                                   END;

     1332    13968    8                               EXIT REWRITE_LOOP;

  13968 14 003727   003734 710000 14                 TRA     s:13972

     1333    13969    8                               END;
     1334    13970    7                           END;

  13970 14 003730   222357 054100                    AOS     I,,AUTO
        14 003731   222357 236100                    LDQ     I,,AUTO
        14 003732   222342 116100                    CMPQ    REWRITES,,AUTO
        14 003733   003653 604000 14                 TMI     s:13957

     1335    13971    6                       END;

     1336    13972    5                   CALL INDEX1R( INDX, '@', USERS.T( COUNT)) ALTRET( NO_CHANGE);

  13972 14 003734   222355 236100                    LDQ     COUNT,,AUTO
        14 003735   000370 402007                    MPY     248,DL
        14 003736   000000 125506                    SCMR    mask='000'O
        14 003737   202346 000360                    ADSC9   USERS+2,Q,AUTO           cn=0,n=240
        14 003740   000022 000001 15                 ADSC9   18                       cn=0,n=1
        14 003741   222361 000100                    ARG     INDX,,AUTO
        14 003742   004073 606400 14                 TTN     NO_CHANGE
        14 003743   000357 236007                    LDQ     239,DL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:222  
        14 003744   222361 156100                    SSQ     INDX,,AUTO

     1337    13973    5                   CALL INDEX( INDX1, '.', USERS.T( COUNT), INDX)

  13973 14 003745   222355 236100                    LDQ     COUNT,,AUTO
        14 003746   000370 402007                    MPY     248,DL
        14 003747   222361 036100                    ADLQ    INDX,,AUTO
        14 003750   222361 720100                    LXL0    INDX,,AUTO
        14 003751   777417 620010                    EAX0    -241,X0
        14 003752   777777 660003                    ERX0    -1,DU
        14 003753   222722 756100                    STQ     @VLEN+2,,AUTO
        14 003754   222361 236100                    LDQ     INDX,,AUTO
        14 003755   222722 235100                    LDA     @VLEN+2,,AUTO
        14 003756   000000 124545                    SCM     mask='000'O
        14 003757   202346 000010                    ADSC9   USERS+2,A,AUTO           cn=0,n=*X0
        14 003760   000037 000001 15                 ADSC9   31                       cn=0,n=1
        14 003761   222362 000100                    ARG     INDX1,,AUTO
        14 003762   222362 056100                    ASQ     INDX1,,AUTO
        14 003763   003765 606400 14                 TTN     s:13979

     1338    13974    6                   WHENRETURN DO;

     1339    13975    6                       GOTO NO_CHANGE;

  13975 14 003764   004073 710000 14                 TRA     NO_CHANGE

     1340    13976    6                       END;
     1341    13977    6                   WHENALTRETURN DO;

     1342    13978    6                       END;

     1343    13979    5                  CALL INDEX1R( INDX1, '%', USERS.T( COUNT), INDX) ALTRET( NO_CHANGE);

  13979 14 003765   222355 236100                    LDQ     COUNT,,AUTO
        14 003766   000370 402007                    MPY     248,DL
        14 003767   222722 756100                    STQ     @VLEN+2,,AUTO
        14 003770   222361 236100                    LDQ     INDX,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:223  
        14 003771   222361 720100                    LXL0    INDX,,AUTO
        14 003772   222722 235100                    LDA     @VLEN+2,,AUTO
        14 003773   000000 125545                    SCMR    mask='000'O
        14 003774   202346 000010                    ADSC9   USERS+2,A,AUTO           cn=0,n=*X0
        14 003775   000057 000001 15                 ADSC9   47                       cn=0,n=1
        14 003776   222362 000100                    ARG     INDX1,,AUTO
        14 003777   004073 606400 14                 TTN     NO_CHANGE
        14 004000   222362 054100                    AOS     INDX1,,AUTO
        14 004001   222362 156100                    SSQ     INDX1,,AUTO

     1344    13980    5                   SUBSTR( USERS.T( COUNT), INDX1, 1) = '@';

  13980 14 004002   222355 236100                    LDQ     COUNT,,AUTO
        14 004003   000370 402007                    MPY     248,DL
        14 004004   222362 036100                    ADLQ    INDX1,,AUTO
        14 004005   040106 100400                    MLR     fill='040'O
        14 004006   000022 000001 15                 ADSC9   18                       cn=0,n=1
        14 004007   202346 000001                    ADSC9   USERS+2,Q,AUTO           cn=0,n=1

     1345    13981    5                   CALL INDEX( INDX2, '.', USERS.T( COUNT), INDX1)

  13981 14 004010   222355 236100                    LDQ     COUNT,,AUTO
        14 004011   000370 402007                    MPY     248,DL
        14 004012   222362 036100                    ADLQ    INDX1,,AUTO
        14 004013   222362 721100                    LXL1    INDX1,,AUTO
        14 004014   777417 621011                    EAX1    -241,X1
        14 004015   777777 661003                    ERX1    -1,DU
        14 004016   222722 756100                    STQ     @VLEN+2,,AUTO
        14 004017   222362 236100                    LDQ     INDX1,,AUTO
        14 004020   222722 235100                    LDA     @VLEN+2,,AUTO
        14 004021   000000 124545                    SCM     mask='000'O
        14 004022   202346 000011                    ADSC9   USERS+2,A,AUTO           cn=0,n=*X1
        14 004023   000037 000001 15                 ADSC9   31                       cn=0,n=1
        14 004024   222363 000100                    ARG     INDX2,,AUTO
        14 004025   222363 056100                    ASQ     INDX2,,AUTO
        14 004026   004065 606400 14                 TTN     s:13991

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:224  
     1346    13982    6                   WHENRETURN DO;

     1347    13983    7                       IF SUBSTR( USERS.T( COUNT), INDX + 1) = 'ARPA' THEN DO;

  13983 14 004027   222355 236100                    LDQ     COUNT,,AUTO
        14 004030   000370 402007                    MPY     248,DL
        14 004031   222361 036100                    ADLQ    INDX,,AUTO
        14 004032   777420 620010                    EAX0    -240,X0
        14 004033   777777 660003                    ERX0    -1,DU
        14 004034   040000 106546                    CMPC    fill='040'O
        14 004035   202346 200010                    ADSC9   USERS+2,Q,AUTO           cn=1,n=*X0
        14 004036   003022 000004 1                  ADSC9   TCM_XLATE_TO_UC+221      cn=0,n=4
        14 004037   004056 601000 14                 TNZ     s:13988

     1348    13984    7                           USERS.L( COUNT) = INDX;

  13984 14 004040   222355 236100                    LDQ     COUNT,,AUTO
        14 004041   000076 402007                    MPY     62,DL
        14 004042   222361 235100                    LDA     INDX,,AUTO
        14 004043   202345 755106                    STA     USERS+1,QL,AUTO

     1349    13985    7                           SUBSTR( USERS.T( COUNT), INDX) = ' ';

  13985 14 004044   222355 236100                    LDQ     COUNT,,AUTO
        14 004045   000370 402007                    MPY     248,DL
        14 004046   222361 036100                    ADLQ    INDX,,AUTO
        14 004047   222361 722100                    LXL2    INDX,,AUTO
        14 004050   777417 622012                    EAX2    -241,X2
        14 004051   777777 662003                    ERX2    -1,DU
        14 004052   040146 100400                    MLR     fill='040'O
        14 004053   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 004054   202346 000012                    ADSC9   USERS+2,Q,AUTO           cn=0,n=*X2

     1350    13986    7                           END;

  13986 14 004055   004064 710000 14                 TRA     s:13989

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:225  
     1351    13987    6                       ELSE
     1352    13988    6                           SUBSTR( USERS.T( COUNT), INDX, 1) = '.';

  13988 14 004056   222355 236100                    LDQ     COUNT,,AUTO
        14 004057   000370 402007                    MPY     248,DL
        14 004060   222361 036100                    ADLQ    INDX,,AUTO
        14 004061   040106 100400                    MLR     fill='040'O
        14 004062   000037 000001 15                 ADSC9   31                       cn=0,n=1
        14 004063   202346 000001                    ADSC9   USERS+2,Q,AUTO           cn=0,n=1

     1353    13989    6                       END;

  13989 14 004064   004073 710000 14                 TRA     NO_CHANGE

     1354    13990    6                   WHENALTRETURN DO;

     1355    13991    6                       SUBSTR( USERS.T( COUNT), INDX, 1) = '.';

  13991 14 004065   222355 236100                    LDQ     COUNT,,AUTO
        14 004066   000370 402007                    MPY     248,DL
        14 004067   222361 036100                    ADLQ    INDX,,AUTO
        14 004070   040106 100400                    MLR     fill='040'O
        14 004071   000037 000001 15                 ADSC9   31                       cn=0,n=1
        14 004072   202346 000001                    ADSC9   USERS+2,Q,AUTO           cn=0,n=1

     1356    13992    6                       END;

     1357    13993    5                   END;

     1358    13994    4   NO_CHANGE:
     1359    13995    4               CALL CONCAT( CMDBUF, 'RCPT TO:<', SUBSTR( USERS.T( COUNT), 0,

  13995 14 004073   222355 236100       NO_CHANGE    LDQ     COUNT,,AUTO
        14 004074   000076 402007                    MPY     62,DL
        14 004075   202345 720106                    LXL0    USERS+1,QL,AUTO
        14 004076   040000 100400                    MLR     fill='040'O
        14 004077   003023 000011 1                  ADSC9   TCM_XLATE_TO_UC+222      cn=0,n=9
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:226  
        14 004100   002107 000011 6                  ADSC9   CMDBUF                   cn=0,n=9
        14 004101   222355 236100                    LDQ     COUNT,,AUTO
        14 004102   000370 402007                    MPY     248,DL
        14 004103   040000 100546                    MLR     fill='040'O
        14 004104   202346 000010                    ADSC9   USERS+2,Q,AUTO           cn=0,n=*X0
        14 004105   002111 200366 6                  ADSC9   CMDBUF+2                 cn=1,n=246
        14 004106   000000 636010                    EAQ     0,X0
        14 004107   000022 772000                    QRL     18
        14 004110   000366 116007                    CMPQ    246,DL
        14 004111   004122 603000 14                 TRC     s:13997
        14 004112   222722 740100                    STX0    @VLEN+2,,AUTO
        14 004113   777411 620010                    EAX0    -247,X0
        14 004114   777777 660003                    ERX0    -1,DU
        14 004115   222722 235100                    LDA     @VLEN+2,,AUTO
        14 004116   000022 771000                    ARL     18
        14 004117   040045 100400                    MLR     fill='040'O
        14 004120   000056 000001 15                 ADSC9   46                       cn=0,n=1
        14 004121   002111 200010 6                  ADSC9   CMDBUF+2,A               cn=1,n=*X0

     1360    13996    4                       USERS.L( COUNT)), '>');
     1361    13997    4               CALL SEND_SMTP_COMMAND( '2')

  13997 14 004122   000051 236000 15                 LDQ     41
        14 004123   222607 756100                    STQ     LEN_TARGET+2,,AUTO
        14 004124   007243 701000 14                 TSX1    SEND_SMTP_COMMAND
        14 004125   004131 702000 14                 TSX2    s:14002

     1362    13998    5               WHENRETURN DO;

     1363    13999    5                   GOT_ONE = %YES#;

  13999 14 004126   400000 236003                    LDQ     -131072,DU
        14 004127   222356 756100                    STQ     GOT_ONE,,AUTO

     1364    14000    5                   END;

  14000 14 004130   004164 710000 14                 TRA     SKIP_NON_BLIND_COPY
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:227  

     1365    14001    5               WHENALTRETURN DO;

     1366    14002    6                   IF TRIED_DIRECT_SEND THEN DO;

  14002 14 004131   222377 234100                    SZN     TRIED_DIRECT_SEND,,AUTO
        14 004132   004143 605000 14                 TPL     s:14007

     1367    14003    6                       CMDBUF = 'RSET';

  14003 14 004133   040000 100400                    MLR     fill='040'O
        14 004134   003026 000004 1                  ADSC9   TCM_XLATE_TO_UC+225      cn=0,n=4
        14 004135   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     1368    14004    6                       CALL SEND_SMTP_COMMAND( '2');

  14004 14 004136   000051 236000 15                 LDQ     41
        14 004137   222607 756100                    STQ     LEN_TARGET+2,,AUTO
        14 004140   007243 701000 14                 TSX1    SEND_SMTP_COMMAND
        14 004141   000000 011000                    NOP     0

     1369    14005    6                       GOTO MAIL_FROM;

  14005 14 004142   003454 710000 14                 TRA     MAIL_FROM

     1370    14006    6                       END;
     1371    14007    5                   PATH$->CV.L = USERS.L( COUNT);

  14007 14 004143   222355 236100                    LDQ     COUNT,,AUTO
        14 004144   000076 402007                    MPY     62,DL
        14 004145   002455 470400 1                  LDP0    PATH$
        14 004146   202345 235106                    LDA     USERS+1,QL,AUTO
        14 004147   000000 755100                    STA     0,,PR0

     1372    14008    5                   PATH$->CV.T = USERS.T( COUNT);

  14008 14 004150   000000 720100                    LXL0    0,,PR0
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:228  
        14 004151   222355 236100                    LDQ     COUNT,,AUTO
        14 004152   000370 402007                    MPY     248,DL
        14 004153   040140 100506                    MLR     fill='040'O
        14 004154   202346 000360                    ADSC9   USERS+2,Q,AUTO           cn=0,n=240
        14 004155   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0

     1373    14009    5                   CALL POST_MESSAGE_REJECTION( SITE.NAME( CURR_SITE));

  14009 14 004156   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 004157   000072 402007                    MPY     58,DL
        14 004160   200146 631506                    EPPR1   SITE,QL,AUTO
        14 004161   222607 451500                    STP1    LEN_TARGET+2,,AUTO
        14 004162   013327 701000 14                 TSX1    POST_MESSAGE_REJECTION
        14 004163   000000 011000                    NOP     0

     1374    14010    5                   END;

     1375    14011    4   SKIP_NON_BLIND_COPY:
     1376    14012    4               END;

  14012 14 004164   222355 235100       SKIP_NON_BL* LDA     COUNT,,AUTO
        14 004165   000001 035007                    ADLA    1,DL
        14 004166   222355 755100                    STA     COUNT,,AUTO
        14 004167   222355 236100                    LDQ     COUNT,,AUTO
        14 004170   200142 116100                    CMPQ    USER_COUNT,,AUTO
        14 004171   003567 602000 14                 TNC     s:13943

     1377    14013    3           IF NOT GOT_ONE THEN

  14013 14 004172   222356 234100                    SZN     GOT_ONE,,AUTO
        14 004173   006200 605000 14                 TPL     WRAP_IT_UP

     1378    14014    3               GOTO WRAP_IT_UP;
     1379    14015    3           END;

  14015 14 004174   004225 710000 14                 TRA     s:14028

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:229  
     1380    14016    3       ELSE DO;

     1381    14017    3           CALL CONCAT( CMDBUF, 'RCPT TO:', PATH$->CV.T);

  14017 14 004175   002455 470400 1                  LDP0    PATH$
        14 004176   000000 720100                    LXL0    0,,PR0
        14 004177   040000 100400                    MLR     fill='040'O
        14 004200   003023 000010 1                  ADSC9   TCM_XLATE_TO_UC+222      cn=0,n=8
        14 004201   002107 000010 6                  ADSC9   CMDBUF                   cn=0,n=8
        14 004202   040000 100540                    MLR     fill='040'O
        14 004203   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 004204   002111 000367 6                  ADSC9   CMDBUF+2                 cn=0,n=247

     1382    14018    3           CALL SEND_SMTP_COMMAND( '2')

  14018 14 004205   000051 236000 15                 LDQ     41
        14 004206   222607 756100                    STQ     LEN_TARGET+2,,AUTO
        14 004207   007243 701000 14                 TSX1    SEND_SMTP_COMMAND
        14 004210   004212 702000 14                 TSX2    s:14020
        14 004211   004225 710000 14                 TRA     s:14028

     1383    14019    4           WHENALTRETURN DO;

     1384    14020    5               IF TRIED_DIRECT_SEND THEN DO;

  14020 14 004212   222377 234100                    SZN     TRIED_DIRECT_SEND,,AUTO
        14 004213   004224 605000 14                 TPL     s:14025

     1385    14021    5                   CMDBUF = 'RSET';

  14021 14 004214   040000 100400                    MLR     fill='040'O
        14 004215   003026 000004 1                  ADSC9   TCM_XLATE_TO_UC+225      cn=0,n=4
        14 004216   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     1386    14022    5                   CALL SEND_SMTP_COMMAND( '2');

  14022 14 004217   000051 236000 15                 LDQ     41
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:230  
        14 004220   222607 756100                    STQ     LEN_TARGET+2,,AUTO
        14 004221   007243 701000 14                 TSX1    SEND_SMTP_COMMAND
        14 004222   000000 011000                    NOP     0

     1387    14023    5                   GOTO MAIL_FROM;

  14023 14 004223   003454 710000 14                 TRA     MAIL_FROM

     1388    14024    5                   END;
     1389    14025    4               GOTO ERR;

  14025 14 004224   006172 710000 14                 TRA     ERR

     1390    14026    4               END;
     1391    14027    3           END;

     1392    14028    2       CMDBUF = 'DATA';

  14028 14 004225   040000 100400                    MLR     fill='040'O
        14 004226   003027 000004 1                  ADSC9   TCM_XLATE_TO_UC+226      cn=0,n=4
        14 004227   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     1393    14029    2       CALL SEND_SMTP_COMMAND( '3') ALTRET( ERR);

  14029 14 004230   000061 236000 15                 LDQ     49
        14 004231   222607 756100                    STQ     LEN_TARGET+2,,AUTO
        14 004232   007243 701000 14                 TSX1    SEND_SMTP_COMMAND
        14 004233   006172 702000 14                 TSX2    ERR

     1394    14030    2       CALL STATUS_UPDATE( SENDING_HEADER);

  14030 14 004234   000062 236000 15                 LDQ     50
        14 004235   222715 756100                    STQ     LAST+2,,AUTO
        14 004236   013522 701000 14                 TSX1    STATUS_UPDATE
        14 004237   000000 011000                    NOP     0

     1395    14031            /****** SEND MESSAGE HEADER ******/
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:231  
     1396    14032    2       BLANK_COUNT = 0;

  14032 14 004240   002310 450000 6                  STZ     BLANK_COUNT

     1397    14033    2       IF NOT TCP_FLAVOR THEN

  14033 14 004241   001223 234000 6                  SZN     TCP_FLAVOR
        14 004242   004246 604000 14                 TMI     s:14035

     1398    14034    2           CALL M$WAIT( WAIT_A_SECOND);

  14034 14 004243   001642 630400 1                  EPPR0   WAIT_A_SECOND
        14 004244   020006 713400                    CLIMB   8198
        14 004245   400400 401760                    pmme    nvectors=2

     1399    14035    3       IF VM_HEADER.NUM_TRACE_RECORDS > 0 AND NOT VM_HEADER.STATUS.ERR THEN DO;

  14035 14 004246   222345 470500                    LDP0    HEADER$,,AUTO
        14 004247   000034 235100                    LDA     28,,PR0
        14 004250   004256 600000 14                 TZE     s:14039
        14 004251   000012 234100                    SZN     10,,PR0
        14 004252   004256 604000 14                 TMI     s:14039

     1400    14036    3           CALL EMIT_TRACE_RECORDS;

  14036 14 004253   006633 701000 14                 TSX1    EMIT_TRACE_RECORDS
        14 004254   000000 011000                    NOP     0

     1401    14037    3           GOTO SEND_DATA;

  14037 14 004255   006046 710000 14                 TRA     SEND_DATA

     1402    14038    3           END;
     1403    14039    2       CALL CONCAT( CMDBUF, MSGDATE, DAYBUF, ', ', DATEBUF, TIMEBUF, TCM_TZTEXT);

  14039 14 004256   040000 100400                    MLR     fill='040'O
        14 004257   002372 000006 1                  ADSC9   MSGDATE                  cn=0,n=6
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:232  
        14 004260   002107 000006 6                  ADSC9   CMDBUF                   cn=0,n=6
        14 004261   040000 100400                    MLR     fill='040'O
        14 004262   003444 000003 6                  ADSC9   DAYBUF                   cn=0,n=3
        14 004263   002110 400003 6                  ADSC9   CMDBUF+1                 cn=2,n=3
        14 004264   003030 236000 1                  LDQ     TCM_XLATE_TO_UC+227
        14 004265   000011 772000                    QRL     9
        14 004266   002111 552030 6                  STBQ    CMDBUF+2,'30'O
        14 004267   040000 100400                    MLR     fill='040'O
        14 004270   003441 000012 6                  ADSC9   DATEBUF                  cn=0,n=10
        14 004271   002111 600012 6                  ADSC9   CMDBUF+2                 cn=3,n=10
        14 004272   040000 100400                    MLR     fill='040'O
        14 004273   003445 000005 6                  ADSC9   TIMEBUF                  cn=0,n=5
        14 004274   002114 200005 6                  ADSC9   CMDBUF+5                 cn=1,n=5
        14 004275   040000 100400                    MLR     fill='040'O
        14 004276   001205 000006 6                  ADSC9   TCM_TZTEXT               cn=0,n=6
        14 004277   002115 400345 6                  ADSC9   CMDBUF+6                 cn=2,n=229

     1404    14040    2       CALL SEND_SMTP_DATA;

  14040 14 004300   007420 701000 14                 TSX1    SEND_SMTP_DATA
        14 004301   000000 011000                    NOP     0

     1405    14041    2       IF SUBSTR( PATH$->CV.T, 0, 2) = '<@' /*Force indirect return path!*/ THEN

  14041 14 004302   002455 470400 1                  LDP0    PATH$
        14 004303   000000 720100                    LXL0    0,,PR0
        14 004304   000001 221100                    LDX1    1,,PR0
        14 004305   003031 101000 1                  CMPX1   TCM_XLATE_TO_UC+228
        14 004306   004422 601000 14                 TNZ     s:14046

     1406    14042    2           CALL CONCAT( CMDBUF, MSGFROM, FROMNAME$->CV.T, ' <', FROMADDR$->CV.T,

  14042 14 004307   002450 471400 1                  LDP1    FROMNAME$
        14 004310   100000 722100                    LXL2    0,,PR1
        14 004311   002451 473400 1                  LDP3    FROMADDR$
        14 004312   300000 723100                    LXL3    0,,PR3
        14 004313   200127 236100                    LDQ     CURR_SITE,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:233  
        14 004314   000072 402007                    MPY     58,DL
        14 004315   200216 236106                    LDQ     SITE+40,QL,AUTO
        14 004316   000033 772000                    QRL     27
        14 004317   040000 100400                    MLR     fill='040'O
        14 004320   002411 000006 1                  ADSC9   MSGFROM                  cn=0,n=6
        14 004321   002107 000006 6                  ADSC9   CMDBUF                   cn=0,n=6
        14 004322   040000 100540                    MLR     fill='040'O
        14 004323   100001 000012                    ADSC9   1,,PR1                   cn=0,n=*X2
        14 004324   002110 400371 6                  ADSC9   CMDBUF+1                 cn=2,n=249
        14 004325   000000 620006                    EAX0    0,QL
        14 004326   000000 636012                    EAQ     0,X2
        14 004327   000022 772000                    QRL     18
        14 004330   000371 116007                    CMPQ    249,DL
        14 004331   004421 603000 14                 TRC     s:14042+74
        14 004332   222722 742100                    STX2    @VLEN+2,,AUTO
        14 004333   777406 622012                    EAX2    -250,X2
        14 004334   777777 662003                    ERX2    -1,DU
        14 004335   222722 235100                    LDA     @VLEN+2,,AUTO
        14 004336   000022 771000                    ARL     18
        14 004337   040045 100400                    MLR     fill='040'O
        14 004340   003032 000002 1                  ADSC9   TCM_XLATE_TO_UC+229      cn=0,n=2
        14 004341   002110 400012 6                  ADSC9   CMDBUF+1,A               cn=2,n=*X2
        14 004342   222722 236100                    LDQ     @VLEN+2,,AUTO
        14 004343   000022 772000                    QRL     18
        14 004344   000367 116007                    CMPQ    247,DL
        14 004345   004421 603000 14                 TRC     s:14042+74
        14 004346   777410 621006                    EAX1    -248,QL
        14 004347   777777 661003                    ERX1    -1,DU
        14 004350   040046 100540                    MLR     fill='040'O
        14 004351   300001 000013                    ADSC9   1,,PR3                   cn=0,n=*X3
        14 004352   002111 000011 6                  ADSC9   CMDBUF+2,Q               cn=0,n=*X1
        14 004353   000000 635013                    EAA     0,X3
        14 004354   000022 771000                    ARL     18
        14 004355   222723 755100                    STA     @VLEN+3,,AUTO
        14 004356   222723 036100                    ADLQ    @VLEN+3,,AUTO
        14 004357   000367 116007                    CMPQ    247,DL
        14 004360   004421 603000 14                 TRC     s:14042+74
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:234  
        14 004361   000000 635013                    EAA     0,X3
        14 004362   000022 771000                    ARL     18
        14 004363   222724 755100                    STA     @VLEN+4,,AUTO
        14 004364   222725 756100                    STQ     @VLEN+5,,AUTO
        14 004365   222722 236100                    LDQ     @VLEN+2,,AUTO
        14 004366   000022 772000                    QRL     18
        14 004367   222724 036100                    ADLQ    @VLEN+4,,AUTO
        14 004370   222726 756100                    STQ     @VLEN+6,,AUTO
        14 004371   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 004372   000350 402007                    MPY     232,DL
        14 004373   222725 722100                    LXL2    @VLEN+5,,AUTO
        14 004374   777410 622012                    EAX2    -248,X2
        14 004375   777777 662003                    ERX2    -1,DU
        14 004376   222726 235100                    LDA     @VLEN+6,,AUTO
        14 004377   040045 100546                    MLR     fill='040'O
        14 004400   200216 200010                    ADSC9   SITE+40,Q,AUTO           cn=1,n=*X0
        14 004401   002111 000012 6                  ADSC9   CMDBUF+2,A               cn=0,n=*X2
        14 004402   000000 636010                    EAQ     0,X0
        14 004403   000022 772000                    QRL     18
        14 004404   222725 036100                    ADLQ    @VLEN+5,,AUTO
        14 004405   000367 116007                    CMPQ    247,DL
        14 004406   004421 603000 14                 TRC     s:14042+74
        14 004407   222727 756100                    STQ     @VLEN+7,,AUTO
        14 004410   000000 636010                    EAQ     0,X0
        14 004411   000022 772000                    QRL     18
        14 004412   222726 036100                    ADLQ    @VLEN+6,,AUTO
        14 004413   222727 720100                    LXL0    @VLEN+7,,AUTO
        14 004414   777410 620010                    EAX0    -248,X0
        14 004415   777777 660003                    ERX0    -1,DU
        14 004416   040046 100400                    MLR     fill='040'O
        14 004417   000056 000001 15                 ADSC9   46                       cn=0,n=1
        14 004420   002111 000010 6                  ADSC9   CMDBUF+2,Q               cn=0,n=*X0
        14 004421   004534 710000 14                 TRA     s:14049

     1407    14043    2                   SUBSTR( SITE.INDIRECT_REVERSE_PATH.TEXT( CURR_SITE), 0,
     1408    14044    2                   SITE.INDIRECT_REVERSE_PATH.COUNT( CURR_SITE)), '>');
     1409    14045    2       ELSE
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:235  
     1410    14046    2           CALL CONCAT( CMDBUF, MSGFROM, FROMNAME$->CV.T, ' <', FROMADDR$->CV.T,

  14046 14 004422   002450 471400 1                  LDP1    FROMNAME$
        14 004423   100000 722100                    LXL2    0,,PR1
        14 004424   002451 473400 1                  LDP3    FROMADDR$
        14 004425   300000 723100                    LXL3    0,,PR3
        14 004426   200132 236100                    LDQ     THIS_NODE,,AUTO
        14 004427   000023 402007                    MPY     19,DL
        14 004430   201263 236106                    LDQ     NODE+9,QL,AUTO
        14 004431   000033 772000                    QRL     27
        14 004432   040000 100400                    MLR     fill='040'O
        14 004433   002411 000006 1                  ADSC9   MSGFROM                  cn=0,n=6
        14 004434   002107 000006 6                  ADSC9   CMDBUF                   cn=0,n=6
        14 004435   040000 100540                    MLR     fill='040'O
        14 004436   100001 000012                    ADSC9   1,,PR1                   cn=0,n=*X2
        14 004437   002110 400371 6                  ADSC9   CMDBUF+1                 cn=2,n=249
        14 004440   000000 620006                    EAX0    0,QL
        14 004441   000000 636012                    EAQ     0,X2
        14 004442   000022 772000                    QRL     18
        14 004443   000371 116007                    CMPQ    249,DL
        14 004444   004534 603000 14                 TRC     s:14049
        14 004445   222722 742100                    STX2    @VLEN+2,,AUTO
        14 004446   777406 622012                    EAX2    -250,X2
        14 004447   777777 662003                    ERX2    -1,DU
        14 004450   222722 235100                    LDA     @VLEN+2,,AUTO
        14 004451   000022 771000                    ARL     18
        14 004452   040045 100400                    MLR     fill='040'O
        14 004453   003032 000002 1                  ADSC9   TCM_XLATE_TO_UC+229      cn=0,n=2
        14 004454   002110 400012 6                  ADSC9   CMDBUF+1,A               cn=2,n=*X2
        14 004455   222722 236100                    LDQ     @VLEN+2,,AUTO
        14 004456   000022 772000                    QRL     18
        14 004457   000367 116007                    CMPQ    247,DL
        14 004460   004534 603000 14                 TRC     s:14049
        14 004461   777410 621006                    EAX1    -248,QL
        14 004462   777777 661003                    ERX1    -1,DU
        14 004463   040046 100540                    MLR     fill='040'O
        14 004464   300001 000013                    ADSC9   1,,PR3                   cn=0,n=*X3
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:236  
        14 004465   002111 000011 6                  ADSC9   CMDBUF+2,Q               cn=0,n=*X1
        14 004466   000000 635013                    EAA     0,X3
        14 004467   000022 771000                    ARL     18
        14 004470   222723 755100                    STA     @VLEN+3,,AUTO
        14 004471   222723 036100                    ADLQ    @VLEN+3,,AUTO
        14 004472   000367 116007                    CMPQ    247,DL
        14 004473   004534 603000 14                 TRC     s:14049
        14 004474   000000 635013                    EAA     0,X3
        14 004475   000022 771000                    ARL     18
        14 004476   222724 755100                    STA     @VLEN+4,,AUTO
        14 004477   222725 756100                    STQ     @VLEN+5,,AUTO
        14 004500   222722 236100                    LDQ     @VLEN+2,,AUTO
        14 004501   000022 772000                    QRL     18
        14 004502   222724 036100                    ADLQ    @VLEN+4,,AUTO
        14 004503   222726 756100                    STQ     @VLEN+6,,AUTO
        14 004504   200132 236100                    LDQ     THIS_NODE,,AUTO
        14 004505   000114 402007                    MPY     76,DL
        14 004506   222725 722100                    LXL2    @VLEN+5,,AUTO
        14 004507   777410 622012                    EAX2    -248,X2
        14 004510   777777 662003                    ERX2    -1,DU
        14 004511   222726 235100                    LDA     @VLEN+6,,AUTO
        14 004512   040045 100546                    MLR     fill='040'O
        14 004513   201263 200010                    ADSC9   NODE+9,Q,AUTO            cn=1,n=*X0
        14 004514   002111 000012 6                  ADSC9   CMDBUF+2,A               cn=0,n=*X2
        14 004515   000000 636010                    EAQ     0,X0
        14 004516   000022 772000                    QRL     18
        14 004517   222725 036100                    ADLQ    @VLEN+5,,AUTO
        14 004520   000367 116007                    CMPQ    247,DL
        14 004521   004534 603000 14                 TRC     s:14049
        14 004522   222727 756100                    STQ     @VLEN+7,,AUTO
        14 004523   000000 636010                    EAQ     0,X0
        14 004524   000022 772000                    QRL     18
        14 004525   222726 036100                    ADLQ    @VLEN+6,,AUTO
        14 004526   222727 720100                    LXL0    @VLEN+7,,AUTO
        14 004527   777410 620010                    EAX0    -248,X0
        14 004530   777777 660003                    ERX0    -1,DU
        14 004531   040046 100400                    MLR     fill='040'O
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:237  
        14 004532   000056 000001 15                 ADSC9   46                       cn=0,n=1
        14 004533   002111 000010 6                  ADSC9   CMDBUF+2,Q               cn=0,n=*X0

     1411    14047    2                   SUBSTR( NODE.REVERSE_PATH.TEXT( THIS_NODE), 0,
     1412    14048    2                   NODE.REVERSE_PATH.COUNT( THIS_NODE)), '>');
     1413    14049    2       CALL SEND_SMTP_DATA;

  14049 14 004534   007420 701000 14                 TSX1    SEND_SMTP_DATA
        14 004535   000000 011000                    NOP     0

     1414    14050    3       IF ( SITE.RR_ACTION( CURR_SITE) = %RELAY AND VM_HEADER.STATUS.RR) THEN DO;

  14050 14 004536   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 004537   000072 402007                    MPY     58,DL
        14 004540   200237 236106                    LDQ     SITE+57,QL,AUTO
        14 004541   600000 376003                    ANQ     -65536,DU
        14 004542   400000 116003                    CMPQ    -131072,DU
        14 004543   004646 601000 14                 TNZ     s:14061
        14 004544   222345 470500                    LDP0    HEADER$,,AUTO
        14 004545   000012 236100                    LDQ     10,,PR0
        14 004546   020000 316003                    CANQ    8192,DU
        14 004547   004646 600000 14                 TZE     s:14061

     1415    14051    3           IF SUBSTR( PATH$->CV.T, 0, 2) = '<@' /*Force indirect return path!*/ THEN

  14051 14 004550   002455 471400 1                  LDP1    PATH$
        14 004551   100000 720100                    LXL0    0,,PR1
        14 004552   100001 221100                    LDX1    1,,PR1
        14 004553   003031 101000 1                  CMPX1   TCM_XLATE_TO_UC+228
        14 004554   004611 601000 14                 TNZ     s:14056

     1416    14052    3               CALL CONCAT( CMDBUF, MSGACKTO, FROMADDR$->CV.T,

  14052 14 004555   002451 473400 1                  LDP3    FROMADDR$
        14 004556   300000 722100                    LXL2    0,,PR3
        14 004557   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 004560   000072 402007                    MPY     58,DL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:238  
        14 004561   200216 236106                    LDQ     SITE+40,QL,AUTO
        14 004562   000033 772000                    QRL     27
        14 004563   040000 100400                    MLR     fill='040'O
        14 004564   002436 000020 1                  ADSC9   MSGACKTO                 cn=0,n=16
        14 004565   002107 000020 6                  ADSC9   CMDBUF                   cn=0,n=16
        14 004566   040000 100540                    MLR     fill='040'O
        14 004567   300001 000012                    ADSC9   1,,PR3                   cn=0,n=*X2
        14 004570   002113 000357 6                  ADSC9   CMDBUF+4                 cn=0,n=239
        14 004571   000000 620006                    EAX0    0,QL
        14 004572   000000 636012                    EAQ     0,X2
        14 004573   000022 772000                    QRL     18
        14 004574   000357 116007                    CMPQ    239,DL
        14 004575   004610 603000 14                 TRC     s:14052+27
        14 004576   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 004577   000350 402007                    MPY     232,DL
        14 004600   222722 742100                    STX2    @VLEN+2,,AUTO
        14 004601   777420 622012                    EAX2    -240,X2
        14 004602   777777 662003                    ERX2    -1,DU
        14 004603   222722 235100                    LDA     @VLEN+2,,AUTO
        14 004604   000022 771000                    ARL     18
        14 004605   040045 100546                    MLR     fill='040'O
        14 004606   200216 200010                    ADSC9   SITE+40,Q,AUTO           cn=1,n=*X0
        14 004607   002113 000012 6                  ADSC9   CMDBUF+4,A               cn=0,n=*X2
        14 004610   004644 710000 14                 TRA     s:14059

     1417    14053    3                       SUBSTR( SITE.INDIRECT_REVERSE_PATH.TEXT( CURR_SITE), 0,
     1418    14054    3                       SITE.INDIRECT_REVERSE_PATH.COUNT( CURR_SITE)));
     1419    14055    3           ELSE
     1420    14056    3               CALL CONCAT( CMDBUF, MSGACKTO, FROMADDR$->CV.T,

  14056 14 004611   002451 473400 1                  LDP3    FROMADDR$
        14 004612   300000 722100                    LXL2    0,,PR3
        14 004613   200132 236100                    LDQ     THIS_NODE,,AUTO
        14 004614   000023 402007                    MPY     19,DL
        14 004615   201263 236106                    LDQ     NODE+9,QL,AUTO
        14 004616   000033 772000                    QRL     27
        14 004617   040000 100400                    MLR     fill='040'O
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:239  
        14 004620   002436 000020 1                  ADSC9   MSGACKTO                 cn=0,n=16
        14 004621   002107 000020 6                  ADSC9   CMDBUF                   cn=0,n=16
        14 004622   040000 100540                    MLR     fill='040'O
        14 004623   300001 000012                    ADSC9   1,,PR3                   cn=0,n=*X2
        14 004624   002113 000357 6                  ADSC9   CMDBUF+4                 cn=0,n=239
        14 004625   000000 620006                    EAX0    0,QL
        14 004626   000000 636012                    EAQ     0,X2
        14 004627   000022 772000                    QRL     18
        14 004630   000357 116007                    CMPQ    239,DL
        14 004631   004644 603000 14                 TRC     s:14059
        14 004632   200132 236100                    LDQ     THIS_NODE,,AUTO
        14 004633   000114 402007                    MPY     76,DL
        14 004634   222722 742100                    STX2    @VLEN+2,,AUTO
        14 004635   777420 622012                    EAX2    -240,X2
        14 004636   777777 662003                    ERX2    -1,DU
        14 004637   222722 235100                    LDA     @VLEN+2,,AUTO
        14 004640   000022 771000                    ARL     18
        14 004641   040045 100546                    MLR     fill='040'O
        14 004642   201263 200010                    ADSC9   NODE+9,Q,AUTO            cn=1,n=*X0
        14 004643   002113 000012 6                  ADSC9   CMDBUF+4,A               cn=0,n=*X2

     1421    14057    3                       SUBSTR( NODE.REVERSE_PATH.TEXT( THIS_NODE), 0,
     1422    14058    3                       NODE.REVERSE_PATH.COUNT( THIS_NODE)));
     1423    14059    3           CALL SEND_SMTP_DATA;

  14059 14 004644   007420 701000 14                 TSX1    SEND_SMTP_DATA
        14 004645   000000 011000                    NOP     0

     1424    14060    3           END;

     1425    14061    3       IF ( SITE.DR_ACTION( CURR_SITE) = %RELAY AND VM_HEADER.STATUS.DR) THEN DO;

  14061 14 004646   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 004647   000072 402007                    MPY     58,DL
        14 004650   200237 236106                    LDQ     SITE+57,QL,AUTO
        14 004651   140000 376003                    ANQ     49152,DU
        14 004652   100000 116003                    CMPQ    32768,DU
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:240  
        14 004653   004756 601000 14                 TNZ     s:14072
        14 004654   222345 470500                    LDP0    HEADER$,,AUTO
        14 004655   000012 236100                    LDQ     10,,PR0
        14 004656   000004 316003                    CANQ    4,DU
        14 004657   004756 600000 14                 TZE     s:14072

     1426    14062    3           IF SUBSTR( PATH$->CV.T, 0, 2) = '<@' /*Force indirect return path!*/ THEN

  14062 14 004660   002455 471400 1                  LDP1    PATH$
        14 004661   100000 720100                    LXL0    0,,PR1
        14 004662   100001 221100                    LDX1    1,,PR1
        14 004663   003031 101000 1                  CMPX1   TCM_XLATE_TO_UC+228
        14 004664   004721 601000 14                 TNZ     s:14067

     1427    14063    3               CALL CONCAT( CMDBUF, MSGRRTO, FROMADDR$->CV.T,

  14063 14 004665   002451 473400 1                  LDP3    FROMADDR$
        14 004666   300000 722100                    LXL2    0,,PR3
        14 004667   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 004670   000072 402007                    MPY     58,DL
        14 004671   200216 236106                    LDQ     SITE+40,QL,AUTO
        14 004672   000033 772000                    QRL     27
        14 004673   040000 100400                    MLR     fill='040'O
        14 004674   002442 000023 1                  ADSC9   MSGRRTO                  cn=0,n=19
        14 004675   002107 000023 6                  ADSC9   CMDBUF                   cn=0,n=19
        14 004676   040000 100540                    MLR     fill='040'O
        14 004677   300001 000012                    ADSC9   1,,PR3                   cn=0,n=*X2
        14 004700   002113 600354 6                  ADSC9   CMDBUF+4                 cn=3,n=236
        14 004701   000000 620006                    EAX0    0,QL
        14 004702   000000 636012                    EAQ     0,X2
        14 004703   000022 772000                    QRL     18
        14 004704   000354 116007                    CMPQ    236,DL
        14 004705   004720 603000 14                 TRC     s:14063+27
        14 004706   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 004707   000350 402007                    MPY     232,DL
        14 004710   222722 742100                    STX2    @VLEN+2,,AUTO
        14 004711   777423 622012                    EAX2    -237,X2
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:241  
        14 004712   777777 662003                    ERX2    -1,DU
        14 004713   222722 235100                    LDA     @VLEN+2,,AUTO
        14 004714   000022 771000                    ARL     18
        14 004715   040045 100546                    MLR     fill='040'O
        14 004716   200216 200010                    ADSC9   SITE+40,Q,AUTO           cn=1,n=*X0
        14 004717   002113 600012 6                  ADSC9   CMDBUF+4,A               cn=3,n=*X2
        14 004720   004754 710000 14                 TRA     s:14070

     1428    14064    3                       SUBSTR( SITE.INDIRECT_REVERSE_PATH.TEXT( CURR_SITE), 0,
     1429    14065    3                       SITE.INDIRECT_REVERSE_PATH.COUNT( CURR_SITE)));
     1430    14066    3           ELSE
     1431    14067    3               CALL CONCAT( CMDBUF, MSGRRTO, FROMADDR$->CV.T,

  14067 14 004721   002451 473400 1                  LDP3    FROMADDR$
        14 004722   300000 722100                    LXL2    0,,PR3
        14 004723   200132 236100                    LDQ     THIS_NODE,,AUTO
        14 004724   000023 402007                    MPY     19,DL
        14 004725   201263 236106                    LDQ     NODE+9,QL,AUTO
        14 004726   000033 772000                    QRL     27
        14 004727   040000 100400                    MLR     fill='040'O
        14 004730   002442 000023 1                  ADSC9   MSGRRTO                  cn=0,n=19
        14 004731   002107 000023 6                  ADSC9   CMDBUF                   cn=0,n=19
        14 004732   040000 100540                    MLR     fill='040'O
        14 004733   300001 000012                    ADSC9   1,,PR3                   cn=0,n=*X2
        14 004734   002113 600354 6                  ADSC9   CMDBUF+4                 cn=3,n=236
        14 004735   000000 620006                    EAX0    0,QL
        14 004736   000000 636012                    EAQ     0,X2
        14 004737   000022 772000                    QRL     18
        14 004740   000354 116007                    CMPQ    236,DL
        14 004741   004754 603000 14                 TRC     s:14070
        14 004742   200132 236100                    LDQ     THIS_NODE,,AUTO
        14 004743   000114 402007                    MPY     76,DL
        14 004744   222722 742100                    STX2    @VLEN+2,,AUTO
        14 004745   777423 622012                    EAX2    -237,X2
        14 004746   777777 662003                    ERX2    -1,DU
        14 004747   222722 235100                    LDA     @VLEN+2,,AUTO
        14 004750   000022 771000                    ARL     18
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:242  
        14 004751   040045 100546                    MLR     fill='040'O
        14 004752   201263 200010                    ADSC9   NODE+9,Q,AUTO            cn=1,n=*X0
        14 004753   002113 600012 6                  ADSC9   CMDBUF+4,A               cn=3,n=*X2

     1432    14068    3                       SUBSTR( NODE.REVERSE_PATH.TEXT( THIS_NODE), 0,
     1433    14069    3                       NODE.REVERSE_PATH.COUNT( THIS_NODE)));
     1434    14070    3           CALL SEND_SMTP_DATA;

  14070 14 004754   007420 701000 14                 TSX1    SEND_SMTP_DATA
        14 004755   000000 011000                    NOP     0

     1435    14071    3           END;

     1436    14072    3       IF REPLYADDR$->CV.L ~= 0 AND REPLYADDR$->CV.T ~= FROMADDR$->CV.T THEN DO;

  14072 14 004756   002454 470400 1                  LDP0    REPLYADDR$
        14 004757   000000 235100                    LDA     0,,PR0
        14 004760   005254 600000 14                 TZE     s:14090
        14 004761   000000 720100                    LXL0    0,,PR0
        14 004762   002451 471400 1                  LDP1    FROMADDR$
        14 004763   100000 721100                    LXL1    0,,PR1
        14 004764   040140 106540                    CMPC    fill='040'O
        14 004765   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 004766   100001 000011                    ADSC9   1,,PR1                   cn=0,n=*X1
        14 004767   005254 600000 14                 TZE     s:14090

     1437    14073    3           IF SUBSTR( PATH$->CV.T, 0, 2) = '<@' /*Force indirect return path!*/ THEN

  14073 14 004770   002455 473400 1                  LDP3    PATH$
        14 004771   300000 722100                    LXL2    0,,PR3
        14 004772   300001 223100                    LDX3    1,,PR3
        14 004773   003031 103000 1                  CMPX3   TCM_XLATE_TO_UC+228
        14 004774   005106 601000 14                 TNZ     s:14078

     1438    14074    3              CALL CONCAT( CMDBUF, MSGREPLY, REPLYNAME$->CV.T, ' <', REPLYADDR$->CV.T,

  14074 14 004775   002453 474400 1                  LDP4    REPLYNAME$
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:243  
        14 004776   400000 724100                    LXL4    0,,PR4
        14 004777   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 005000   000072 402007                    MPY     58,DL
        14 005001   200216 236106                    LDQ     SITE+40,QL,AUTO
        14 005002   000033 772000                    QRL     27
        14 005003   040000 100400                    MLR     fill='040'O
        14 005004   002413 000012 1                  ADSC9   MSGREPLY                 cn=0,n=10
        14 005005   002107 000012 6                  ADSC9   CMDBUF                   cn=0,n=10
        14 005006   040000 100540                    MLR     fill='040'O
        14 005007   400001 000014                    ADSC9   1,,PR4                   cn=0,n=*X4
        14 005010   002111 400365 6                  ADSC9   CMDBUF+2                 cn=2,n=245
        14 005011   000000 621006                    EAX1    0,QL
        14 005012   000000 636014                    EAQ     0,X4
        14 005013   000022 772000                    QRL     18
        14 005014   000365 116007                    CMPQ    245,DL
        14 005015   005105 603000 14                 TRC     s:14074+72
        14 005016   222722 744100                    STX4    @VLEN+2,,AUTO
        14 005017   777412 624014                    EAX4    -246,X4
        14 005020   777777 664003                    ERX4    -1,DU
        14 005021   222722 235100                    LDA     @VLEN+2,,AUTO
        14 005022   000022 771000                    ARL     18
        14 005023   040045 100400                    MLR     fill='040'O
        14 005024   003032 000002 1                  ADSC9   TCM_XLATE_TO_UC+229      cn=0,n=2
        14 005025   002111 400014 6                  ADSC9   CMDBUF+2,A               cn=2,n=*X4
        14 005026   222722 236100                    LDQ     @VLEN+2,,AUTO
        14 005027   000022 772000                    QRL     18
        14 005030   000363 116007                    CMPQ    243,DL
        14 005031   005105 603000 14                 TRC     s:14074+72
        14 005032   777414 622006                    EAX2    -244,QL
        14 005033   777777 662003                    ERX2    -1,DU
        14 005034   040046 100540                    MLR     fill='040'O
        14 005035   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 005036   002112 000012 6                  ADSC9   CMDBUF+3,Q               cn=0,n=*X2
        14 005037   000000 635010                    EAA     0,X0
        14 005040   000022 771000                    ARL     18
        14 005041   222723 755100                    STA     @VLEN+3,,AUTO
        14 005042   222723 036100                    ADLQ    @VLEN+3,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:244  
        14 005043   000363 116007                    CMPQ    243,DL
        14 005044   005105 603000 14                 TRC     s:14074+72
        14 005045   000000 635010                    EAA     0,X0
        14 005046   000022 771000                    ARL     18
        14 005047   222724 755100                    STA     @VLEN+4,,AUTO
        14 005050   222725 756100                    STQ     @VLEN+5,,AUTO
        14 005051   222722 236100                    LDQ     @VLEN+2,,AUTO
        14 005052   000022 772000                    QRL     18
        14 005053   222724 036100                    ADLQ    @VLEN+4,,AUTO
        14 005054   222726 756100                    STQ     @VLEN+6,,AUTO
        14 005055   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 005056   000350 402007                    MPY     232,DL
        14 005057   222725 720100                    LXL0    @VLEN+5,,AUTO
        14 005060   777414 620010                    EAX0    -244,X0
        14 005061   777777 660003                    ERX0    -1,DU
        14 005062   222726 235100                    LDA     @VLEN+6,,AUTO
        14 005063   040045 100546                    MLR     fill='040'O
        14 005064   200216 200011                    ADSC9   SITE+40,Q,AUTO           cn=1,n=*X1
        14 005065   002112 000010 6                  ADSC9   CMDBUF+3,A               cn=0,n=*X0
        14 005066   000000 636011                    EAQ     0,X1
        14 005067   000022 772000                    QRL     18
        14 005070   222725 036100                    ADLQ    @VLEN+5,,AUTO
        14 005071   000363 116007                    CMPQ    243,DL
        14 005072   005105 603000 14                 TRC     s:14074+72
        14 005073   222727 756100                    STQ     @VLEN+7,,AUTO
        14 005074   000000 636011                    EAQ     0,X1
        14 005075   000022 772000                    QRL     18
        14 005076   222726 036100                    ADLQ    @VLEN+6,,AUTO
        14 005077   222727 721100                    LXL1    @VLEN+7,,AUTO
        14 005100   777414 621011                    EAX1    -244,X1
        14 005101   777777 661003                    ERX1    -1,DU
        14 005102   040046 100400                    MLR     fill='040'O
        14 005103   000056 000001 15                 ADSC9   46                       cn=0,n=1
        14 005104   002112 000011 6                  ADSC9   CMDBUF+3,Q               cn=0,n=*X1
        14 005105   005252 710000 14                 TRA     s:14088

     1439    14075    3                       SUBSTR( SITE.INDIRECT_REVERSE_PATH.TEXT( CURR_SITE),
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:245  
     1440    14076    3                       0, SITE.INDIRECT_REVERSE_PATH.COUNT( CURR_SITE)), '>');
     1441    14077    4           ELSE DO;

     1442    14078    4               CALL INDEX( INDX, '@', REPLYADDR$->CV.T)

  14078 14 005106   000000 124540                    SCM     mask='000'O
        14 005107   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 005110   000022 000001 15                 ADSC9   18                       cn=0,n=1
        14 005111   222361 000100                    ARG     INDX,,AUTO
        14 005112   005140 606400 14                 TTN     s:14083

     1443    14079    5               WHENRETURN DO;  /* use user's ReplyTo: */

     1444    14080    5                   CALL CONCAT( CMDBUF, MSGREPLY, '<', REPLYADDR$->CV.T, '>');

  14080 14 005113   040000 100400                    MLR     fill='040'O
        14 005114   002413 000012 1                  ADSC9   MSGREPLY                 cn=0,n=10
        14 005115   002107 000012 6                  ADSC9   CMDBUF                   cn=0,n=10
        14 005116   074000 236007                    LDQ     30720,DL
        14 005117   002111 552010 6                  STBQ    CMDBUF+2,'10'O
        14 005120   040000 100540                    MLR     fill='040'O
        14 005121   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 005122   002111 600364 6                  ADSC9   CMDBUF+2                 cn=3,n=244
        14 005123   000000 636010                    EAQ     0,X0
        14 005124   000022 772000                    QRL     18
        14 005125   000364 116007                    CMPQ    244,DL
        14 005126   005137 603000 14                 TRC     s:14081
        14 005127   222722 740100                    STX0    @VLEN+2,,AUTO
        14 005130   777413 620010                    EAX0    -245,X0
        14 005131   777777 660003                    ERX0    -1,DU
        14 005132   222722 235100                    LDA     @VLEN+2,,AUTO
        14 005133   000022 771000                    ARL     18
        14 005134   040045 100400                    MLR     fill='040'O
        14 005135   000056 000001 15                 ADSC9   46                       cn=0,n=1
        14 005136   002111 600010 6                  ADSC9   CMDBUF+2,A               cn=3,n=*X0

     1445    14081    5                   END;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:246  

  14081 14 005137   005252 710000 14                 TRA     s:14088

     1446    14082    5               WHENALTRETURN DO;  /* use reverse path */

     1447    14083    5                   CALL CONCAT( CMDBUF, MSGREPLY, REPLYNAME$->CV.T, ' <',

  14083 14 005140   002453 470400 1                  LDP0    REPLYNAME$
        14 005141   000000 720100                    LXL0    0,,PR0
        14 005142   002454 471400 1                  LDP1    REPLYADDR$
        14 005143   100000 721100                    LXL1    0,,PR1
        14 005144   200132 236100                    LDQ     THIS_NODE,,AUTO
        14 005145   000023 402007                    MPY     19,DL
        14 005146   201263 236106                    LDQ     NODE+9,QL,AUTO
        14 005147   000033 772000                    QRL     27
        14 005150   040000 100400                    MLR     fill='040'O
        14 005151   002413 000012 1                  ADSC9   MSGREPLY                 cn=0,n=10
        14 005152   002107 000012 6                  ADSC9   CMDBUF                   cn=0,n=10
        14 005153   040000 100540                    MLR     fill='040'O
        14 005154   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 005155   002111 400365 6                  ADSC9   CMDBUF+2                 cn=2,n=245
        14 005156   000000 622006                    EAX2    0,QL
        14 005157   000000 636010                    EAQ     0,X0
        14 005160   000022 772000                    QRL     18
        14 005161   000365 116007                    CMPQ    245,DL
        14 005162   005252 603000 14                 TRC     s:14088
        14 005163   222722 740100                    STX0    @VLEN+2,,AUTO
        14 005164   777412 620010                    EAX0    -246,X0
        14 005165   777777 660003                    ERX0    -1,DU
        14 005166   222722 235100                    LDA     @VLEN+2,,AUTO
        14 005167   000022 771000                    ARL     18
        14 005170   040045 100400                    MLR     fill='040'O
        14 005171   003032 000002 1                  ADSC9   TCM_XLATE_TO_UC+229      cn=0,n=2
        14 005172   002111 400010 6                  ADSC9   CMDBUF+2,A               cn=2,n=*X0
        14 005173   222722 236100                    LDQ     @VLEN+2,,AUTO
        14 005174   000022 772000                    QRL     18
        14 005175   000363 116007                    CMPQ    243,DL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:247  
        14 005176   005252 603000 14                 TRC     s:14088
        14 005177   777414 620006                    EAX0    -244,QL
        14 005200   777777 660003                    ERX0    -1,DU
        14 005201   040046 100540                    MLR     fill='040'O
        14 005202   100001 000011                    ADSC9   1,,PR1                   cn=0,n=*X1
        14 005203   002112 000010 6                  ADSC9   CMDBUF+3,Q               cn=0,n=*X0
        14 005204   000000 635011                    EAA     0,X1
        14 005205   000022 771000                    ARL     18
        14 005206   222723 755100                    STA     @VLEN+3,,AUTO
        14 005207   222723 036100                    ADLQ    @VLEN+3,,AUTO
        14 005210   000363 116007                    CMPQ    243,DL
        14 005211   005252 603000 14                 TRC     s:14088
        14 005212   000000 635011                    EAA     0,X1
        14 005213   000022 771000                    ARL     18
        14 005214   222724 755100                    STA     @VLEN+4,,AUTO
        14 005215   222725 756100                    STQ     @VLEN+5,,AUTO
        14 005216   222722 236100                    LDQ     @VLEN+2,,AUTO
        14 005217   000022 772000                    QRL     18
        14 005220   222724 036100                    ADLQ    @VLEN+4,,AUTO
        14 005221   222726 756100                    STQ     @VLEN+6,,AUTO
        14 005222   200132 236100                    LDQ     THIS_NODE,,AUTO
        14 005223   000114 402007                    MPY     76,DL
        14 005224   222725 721100                    LXL1    @VLEN+5,,AUTO
        14 005225   777414 621011                    EAX1    -244,X1
        14 005226   777777 661003                    ERX1    -1,DU
        14 005227   222726 235100                    LDA     @VLEN+6,,AUTO
        14 005230   040045 100546                    MLR     fill='040'O
        14 005231   201263 200012                    ADSC9   NODE+9,Q,AUTO            cn=1,n=*X2
        14 005232   002112 000011 6                  ADSC9   CMDBUF+3,A               cn=0,n=*X1
        14 005233   000000 636012                    EAQ     0,X2
        14 005234   000022 772000                    QRL     18
        14 005235   222725 036100                    ADLQ    @VLEN+5,,AUTO
        14 005236   000363 116007                    CMPQ    243,DL
        14 005237   005252 603000 14                 TRC     s:14088
        14 005240   222727 756100                    STQ     @VLEN+7,,AUTO
        14 005241   000000 636012                    EAQ     0,X2
        14 005242   000022 772000                    QRL     18
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:248  
        14 005243   222726 036100                    ADLQ    @VLEN+6,,AUTO
        14 005244   222727 722100                    LXL2    @VLEN+7,,AUTO
        14 005245   777414 622012                    EAX2    -244,X2
        14 005246   777777 662003                    ERX2    -1,DU
        14 005247   040046 100400                    MLR     fill='040'O
        14 005250   000056 000001 15                 ADSC9   46                       cn=0,n=1
        14 005251   002112 000012 6                  ADSC9   CMDBUF+3,Q               cn=0,n=*X2

     1448    14084    5                          REPLYADDR$->CV.T, SUBSTR( NODE.REVERSE_PATH.TEXT( THIS_NODE)
             14084                                    ,
     1449    14085    5                           0, NODE.REVERSE_PATH.COUNT( THIS_NODE)), '>');
     1450    14086    5                   END;

     1451    14087    4               END;

     1452    14088    3           CALL SEND_SMTP_DATA;

  14088 14 005252   007420 701000 14                 TSX1    SEND_SMTP_DATA
        14 005253   000000 011000                    NOP     0

     1453    14089    3           END;

     1454    14090    3       IF MESSAGE_FILE THEN DO;

  14090 14 005254   200141 234100                    SZN     MESSAGE_FILE,,AUTO
        14 005255   005323 605000 14                 TPL     s:14100

     1455    14091    3           CALL EMIT_ADDRESSES( MSGTO, LENGTHC( MSGTO), %VM_TYPE_TO,

  14091 14 005256   222345 236100                    LDQ     HEADER$,,AUTO
        14 005257   000031 036003                    ADLQ    25,DU
        14 005260   222614 756100                    STQ     @REALLY_LENGTH+1,,AUTO
        14 005261   000064 237000 15                 LDAQ    52
        14 005262   222612 757100                    STAQ    MSGBUF+1,,AUTO
        14 005263   000066 237000 15                 LDAQ    54
        14 005264   222610 757100                    STAQ    @SITENAME+1,,AUTO
        14 005265   000070 236000 15                 LDQ     56
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:249  
        14 005266   222607 756100                    STQ     LEN_TARGET+2,,AUTO
        14 005267   006266 701000 14                 TSX1    EMIT_ADDRESSES
        14 005270   000000 011000                    NOP     0

     1456    14092    3                   MSGREALLY_TO, LENGTHC( MSGREALLY_TO), VM_HEADER.TO$);
     1457    14093    3           CALL EMIT_ADDRESSES( MSGCC, LENGTHC( MSGCC), %VM_TYPE_C,

  14093 14 005271   222345 236100                    LDQ     HEADER$,,AUTO
        14 005272   000021 036003                    ADLQ    17,DU
        14 005273   222614 756100                    STQ     @REALLY_LENGTH+1,,AUTO
        14 005274   000072 237000 15                 LDAQ    58
        14 005275   222612 757100                    STAQ    MSGBUF+1,,AUTO
        14 005276   000074 237000 15                 LDAQ    60
        14 005277   222610 757100                    STAQ    @SITENAME+1,,AUTO
        14 005300   000076 236000 15                 LDQ     62
        14 005301   222607 756100                    STQ     LEN_TARGET+2,,AUTO
        14 005302   006266 701000 14                 TSX1    EMIT_ADDRESSES
        14 005303   000000 011000                    NOP     0

     1458    14094    3                   MSGREAL_CC, LENGTHC( MSGREAL_CC), VM_HEADER.COPY$);
     1459    14095    3           IF HITS.BC THEN

  14095 14 005304   200145 236100                    LDQ     HITS,,AUTO
        14 005305   100000 316003                    CANQ    32768,DU
        14 005306   005652 600000 14                 TZE     s:14142

     1460    14096    3               CALL EMIT_ADDRESSES( MSGBCC, LENGTHC( MSGBCC), %VM_TYPE_BC,

  14096 14 005307   222345 236100                    LDQ     HEADER$,,AUTO
        14 005310   000020 036003                    ADLQ    16,DU
        14 005311   222614 756100                    STQ     @REALLY_LENGTH+1,,AUTO
        14 005312   000100 237000 15                 LDAQ    64
        14 005313   222612 757100                    STAQ    MSGBUF+1,,AUTO
        14 005314   000102 237000 15                 LDAQ    66
        14 005315   222610 757100                    STAQ    @SITENAME+1,,AUTO
        14 005316   000104 236000 15                 LDQ     68
        14 005317   222607 756100                    STQ     LEN_TARGET+2,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:250  
        14 005320   006266 701000 14                 TSX1    EMIT_ADDRESSES
        14 005321   000000 011000                    NOP     0

     1461    14097    3                       MSGREAL_BCC, LENGTHC( MSGREAL_BCC), VM_HEADER.BLIND$);
     1462    14098    3           END;

  14098 14 005322   005652 710000 14                 TRA     s:14142

     1463    14099    3       ELSE DO;

     1464    14100    4           IF TO$->CV.L = 0 THEN DO;

  14100 14 005323   002456 470400 1                  LDP0    TO$
        14 005324   000000 235100                    LDA     0,,PR0
        14 005325   005523 601000 14                 TNZ     s:14132

     1465    14101    4               CALL CONCAT( SOURCE_STRG, SUBSTR( PATH$->CV.T, 1, PATH$->CV.L - 2));

  14101 14 005326   002455 471400 1                  LDP1    PATH$
        14 005327   100000 720100                    LXL0    0,,PR1
        14 005330   777776 621010                    EAX1    -2,X0
        14 005331   040100 100540                    MLR     fill='040'O
        14 005332   100001 200011                    ADSC9   1,,PR1                   cn=1,n=*X1
        14 005333   222403 000377                    ADSC9   SOURCE_STRG,,AUTO        cn=0,n=255

     1466    14102    4               CALL INDEX( II, ':', SOURCE_STRG)

  14102 14 005334   000000 124500                    SCM     mask='000'O
        14 005335   222403 000377                    ADSC9   SOURCE_STRG,,AUTO        cn=0,n=255
        14 005336   000035 000001 15                 ADSC9   29                       cn=0,n=1
        14 005337   222401 000100                    ARG     II,,AUTO
        14 005340   005512 606400 14                 TTN     s:14128

     1467    14103    5               WHENRETURN DO;

     1468    14104    5                  CALL INDEX1R( JJ, '@', SOURCE_STRG);

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:251  
  14104 14 005341   000000 125500                    SCMR    mask='000'O
        14 005342   222403 000377                    ADSC9   SOURCE_STRG,,AUTO        cn=0,n=255
        14 005343   000022 000001 15                 ADSC9   18                       cn=0,n=1
        14 005344   222402 000100                    ARG     JJ,,AUTO
        14 005345   005350 606400 14                 TTN     s:14105
        14 005346   000376 236007                    LDQ     254,DL
        14 005347   222402 156100                    SSQ     JJ,,AUTO

     1469    14105    5                  CALL CONCAT(TARGET_STRG,SUBSTR(SOURCE_STRG,II+1,JJ-II-1), '%',

  14105 14 005350   222402 236100                    LDQ     JJ,,AUTO
        14 005351   222401 136100                    SBLQ    II,,AUTO
        14 005352   222722 756100                    STQ     @VLEN+2,,AUTO
        14 005353   100000 236100                    LDQ     0,,PR1
        14 005354   222402 136100                    SBLQ    JJ,,AUTO
        14 005355   222722 720100                    LXL0    @VLEN+2,,AUTO
        14 005356   777777 621010                    EAX1    -1,X0
        14 005357   222401 235100                    LDA     II,,AUTO
        14 005360   040100 100545                    MLR     fill='040'O
        14 005361   222403 200011                    ADSC9   SOURCE_STRG,A,AUTO       cn=1,n=*X1
        14 005362   222503 000377                    ADSC9   TARGET_STRG,,AUTO        cn=0,n=255
        14 005363   222723 756100                    STQ     @VLEN+3,,AUTO
        14 005364   222722 236100                    LDQ     @VLEN+2,,AUTO
        14 005365   000400 116007                    CMPQ    256,DL
        14 005366   005406 605000 14                 TPL     s:14107
        14 005367   777377 622006                    EAX2    -257,QL
        14 005370   777777 662003                    ERX2    -1,DU
        14 005371   040146 100400                    MLR     fill='040'O
        14 005372   000057 000001 15                 ADSC9   47                       cn=0,n=1
        14 005373   222502 600012                    ADSC9   NAME_END+1,Q,AUTO        cn=3,n=*X2
        14 005374   000377 116007                    CMPQ    255,DL
        14 005375   005406 605000 14                 TPL     s:14107
        14 005376   222723 723100                    LXL3    @VLEN+3,,AUTO
        14 005377   777775 624013                    EAX4    -3,X3
        14 005400   777400 625006                    EAX5    -256,QL
        14 005401   777777 665003                    ERX5    -1,DU
        14 005402   222402 235100                    LDA     JJ,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:252  
        14 005403   040146 100545                    MLR     fill='040'O
        14 005404   222403 200014                    ADSC9   SOURCE_STRG,A,AUTO       cn=1,n=*X4
        14 005405   222503 000015                    ADSC9   TARGET_STRG,Q,AUTO       cn=0,n=*X5

     1470    14106    5                              SUBSTR(SOURCE_STRG,JJ+1,PATH$->CV.L - 3 - JJ));
     1471    14107    5                  CALL CONCAT( SOURCE_STRG, SUBSTR( SOURCE_STRG, 0, II));

  14107 14 005406   222401 720100                    LXL0    II,,AUTO
        14 005407   040100 100540                    MLR     fill='040'O
        14 005410   222403 000010                    ADSC9   SOURCE_STRG,,AUTO        cn=0,n=*X0
        14 005411   222403 000377                    ADSC9   SOURCE_STRG,,AUTO        cn=0,n=255

     1472    14108    5                  LEN_TARGET = PATH$->CV.L - 2 - II - 1;

  14108 14 005412   100000 236100                    LDQ     0,,PR1
        14 005413   222401 136100                    SBLQ    II,,AUTO
        14 005414   000003 136007                    SBLQ    3,DL
        14 005415   222605 756100                    STQ     LEN_TARGET,,AUTO

     1473    14109    5                  LEN_SOURCE = II;

  14109 14 005416   222401 235100                    LDA     II,,AUTO
        14 005417   222604 755100                    STA     LEN_SOURCE,,AUTO

     1474    14110    5                  DONE_COMMA = '0'B;

  14110 14 005420   222603 450100                    STZ     DONE_COMMA,,AUTO

     1475    14111    6                  DO UNTIL DONE_COMMA;

     1476    14112    6                     CALL INDEX1R( JJ, ',', SOURCE_STRG)

  14112 14 005421   000000 125500                    SCMR    mask='000'O
        14 005422   222403 000377                    ADSC9   SOURCE_STRG,,AUTO        cn=0,n=255
        14 005423   000036 000001 15                 ADSC9   30                       cn=0,n=1
        14 005424   222402 000100                    ARG     JJ,,AUTO
        14 005425   005473 606400 14                 TTN     s:14121
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:253  
        14 005426   000376 236007                    LDQ     254,DL
        14 005427   222402 156100                    SSQ     JJ,,AUTO

     1477    14113    7                     WHENRETURN DO;

     1478    14114    7                        CALL CONCAT(SUBSTR( TARGET_STRG, LEN_TARGET, LEN_SOURCE-JJ-1),
             14114                                 '%',

  14114 14 005430   222604 236100                    LDQ     LEN_SOURCE,,AUTO
        14 005431   222402 136100                    SBLQ    JJ,,AUTO
        14 005432   222722 756100                    STQ     @VLEN+2,,AUTO
        14 005433   222604 236100                    LDQ     LEN_SOURCE,,AUTO
        14 005434   222402 136100                    SBLQ    JJ,,AUTO
        14 005435   222722 720100                    LXL0    @VLEN+2,,AUTO
        14 005436   777777 621010                    EAX1    -1,X0
        14 005437   222605 235100                    LDA     LEN_TARGET,,AUTO
        14 005440   040145 100400                    MLR     fill='040'O
        14 005441   000057 000001 15                 ADSC9   47                       cn=0,n=1
        14 005442   222503 000011                    ADSC9   TARGET_STRG,A,AUTO       cn=0,n=*X1
        14 005443   222723 756100                    STQ     @VLEN+3,,AUTO
        14 005444   222722 236100                    LDQ     @VLEN+2,,AUTO
        14 005445   000002 116007                    CMPQ    2,DL
        14 005446   005457 604400 14                 TMOZ    s:14116
        14 005447   222723 722100                    LXL2    @VLEN+3,,AUTO
        14 005450   777776 623012                    EAX3    -2,X2
        14 005451   777776 624006                    EAX4    -2,QL
        14 005452   222402 235100                    LDA     JJ,,AUTO
        14 005453   222605 236100                    LDQ     LEN_TARGET,,AUTO
        14 005454   040146 100545                    MLR     fill='040'O
        14 005455   222403 400013                    ADSC9   SOURCE_STRG,A,AUTO       cn=2,n=*X3
        14 005456   222503 200014                    ADSC9   TARGET_STRG,Q,AUTO       cn=1,n=*X4

     1479    14115    7                                    SUBSTR(SOURCE_STRG, JJ+2, LEN_SOURCE-JJ-2));
     1480    14116    7                        LEN_TARGET = LEN_TARGET + (LEN_SOURCE-JJ-1);

  14116 14 005457   222604 236100                    LDQ     LEN_SOURCE,,AUTO
        14 005460   222402 136100                    SBLQ    JJ,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:254  
        14 005461   222605 036100                    ADLQ    LEN_TARGET,,AUTO
        14 005462   000001 136007                    SBLQ    1,DL
        14 005463   222605 756100                    STQ     LEN_TARGET,,AUTO

     1481    14117    7                        CALL CONCAT(SOURCE_STRG,SUBSTR(SOURCE_STRG,0,JJ));

  14117 14 005464   222402 720100                    LXL0    JJ,,AUTO
        14 005465   040100 100540                    MLR     fill='040'O
        14 005466   222403 000010                    ADSC9   SOURCE_STRG,,AUTO        cn=0,n=*X0
        14 005467   222403 000377                    ADSC9   SOURCE_STRG,,AUTO        cn=0,n=255

     1482    14118    7                        LEN_SOURCE = JJ;

  14118 14 005470   222402 235100                    LDA     JJ,,AUTO
        14 005471   222604 755100                    STA     LEN_SOURCE,,AUTO

     1483    14119    7                     END;

  14119 14 005472   005502 710000 14                 TRA     s:14124

     1484    14120    7                     WHENALTRETURN DO;

     1485    14121    7                        CALL CONCAT(SUBSTR(TARGET_STRG,LEN_TARGET,LEN_SOURCE),
             14121                                 SOURCE_STRG);

  14121 14 005473   222604 720100                    LXL0    LEN_SOURCE,,AUTO
        14 005474   222605 235100                    LDA     LEN_TARGET,,AUTO
        14 005475   040145 100500                    MLR     fill='040'O
        14 005476   222403 000377                    ADSC9   SOURCE_STRG,,AUTO        cn=0,n=255
        14 005477   222503 000010                    ADSC9   TARGET_STRG,A,AUTO       cn=0,n=*X0

     1486    14122    7                        DONE_COMMA = '1'B;

  14122 14 005500   400000 236003                    LDQ     -131072,DU
        14 005501   222603 756100                    STQ     DONE_COMMA,,AUTO

     1487    14123    7                     END;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:255  

     1488    14124    6                  END;

  14124 14 005502   222603 234100                    SZN     DONE_COMMA,,AUTO
        14 005503   005421 605000 14                 TPL     s:14112

     1489    14125    5                  CALL CONCAT( CMDBUF, MSGTO, TARGET_STRG);

  14125 14 005504   002374 236000 1                  LDQ     MSGTO
        14 005505   002107 756000 6                  STQ     CMDBUF
        14 005506   040000 100500                    MLR     fill='040'O
        14 005507   222503 000373                    ADSC9   TARGET_STRG,,AUTO        cn=0,n=251
        14 005510   002110 000373 6                  ADSC9   CMDBUF+1                 cn=0,n=251

     1490    14126    5               END;

  14126 14 005511   005522 710000 14                 TRA     s:14130

     1491    14127    5               WHENALTRETURN DO;

     1492    14128    5                 CALL CONCAT( CMDBUF, MSGTO, SUBSTR( PATH$->CV.T, 1, PATH$->CV.L - 2))
             14128                           ;

  14128 14 005512   002455 470400 1                  LDP0    PATH$
        14 005513   000000 720100                    LXL0    0,,PR0
        14 005514   777776 621010                    EAX1    -2,X0
        14 005515   002374 236000 1                  LDQ     MSGTO
        14 005516   002107 756000 6                  STQ     CMDBUF
        14 005517   040000 100540                    MLR     fill='040'O
        14 005520   000001 200011                    ADSC9   1,,PR0                   cn=1,n=*X1
        14 005521   002110 000373 6                  ADSC9   CMDBUF+1                 cn=0,n=251

     1493    14129    5               END;

     1494    14130    4           END;

  14130 14 005522   005573 710000 14                 TRA     s:14136
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:256  

     1495    14131    3           ELSE
     1496    14132    3               IF SUBSTR( TO$->CV.T, 0, 1) = '<' THEN

  14132 14 005523   000000 720100                    LXL0    0,,PR0
        14 005524   000001 236100                    LDQ     1,,PR0
        14 005525   777000 376003                    ANQ     -512,DU
        14 005526   074000 116003                    CMPQ    30720,DU
        14 005527   005537 601000 14                 TNZ     s:14135

     1497    14133    3                   CALL CONCAT( CMDBUF, MSGTO, SUBSTR( TO$->CV.T, 1, TO$->CV.L - 2));

  14133 14 005530   777776 621010                    EAX1    -2,X0
        14 005531   002374 236000 1                  LDQ     MSGTO
        14 005532   002107 756000 6                  STQ     CMDBUF
        14 005533   040000 100540                    MLR     fill='040'O
        14 005534   000001 200011                    ADSC9   1,,PR0                   cn=1,n=*X1
        14 005535   002110 000373 6                  ADSC9   CMDBUF+1                 cn=0,n=251
        14 005536   005573 710000 14                 TRA     s:14136

     1498    14134    3               ELSE
     1499    14135    3                   CALL CONCAT( CMDBUF, MSGTO, TO$->CV.T,' ', PATH$->CV.T);

  14135 14 005537   002455 471400 1                  LDP1    PATH$
        14 005540   100000 721100                    LXL1    0,,PR1
        14 005541   002374 236000 1                  LDQ     MSGTO
        14 005542   002107 756000 6                  STQ     CMDBUF
        14 005543   040000 100540                    MLR     fill='040'O
        14 005544   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 005545   002110 000373 6                  ADSC9   CMDBUF+1                 cn=0,n=251
        14 005546   000000 636010                    EAQ     0,X0
        14 005547   000022 772000                    QRL     18
        14 005550   000373 116007                    CMPQ    251,DL
        14 005551   005573 603000 14                 TRC     s:14136
        14 005552   222722 740100                    STX0    @VLEN+2,,AUTO
        14 005553   777404 620010                    EAX0    -252,X0
        14 005554   777777 660003                    ERX0    -1,DU
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:257  
        14 005555   222722 235100                    LDA     @VLEN+2,,AUTO
        14 005556   000022 771000                    ARL     18
        14 005557   040045 100400                    MLR     fill='040'O
        14 005560   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 005561   002110 000010 6                  ADSC9   CMDBUF+1,A               cn=0,n=*X0
        14 005562   222722 236100                    LDQ     @VLEN+2,,AUTO
        14 005563   000022 772000                    QRL     18
        14 005564   000372 116007                    CMPQ    250,DL
        14 005565   005573 603000 14                 TRC     s:14136
        14 005566   777405 620006                    EAX0    -251,QL
        14 005567   777777 660003                    ERX0    -1,DU
        14 005570   040046 100540                    MLR     fill='040'O
        14 005571   100001 000011                    ADSC9   1,,PR1                   cn=0,n=*X1
        14 005572   002110 200010 6                  ADSC9   CMDBUF+1,Q               cn=1,n=*X0

     1500    14136    4           IF COMMENT$->CV.L > 0 THEN DO;

  14136 14 005573   002463 470400 1                  LDP0    COMMENT$
        14 005574   000000 235100                    LDA     0,,PR0
        14 005575   005650 600000 14                 TZE     s:14140

     1501    14137    4               CALL SEARCHR( OFFSET, TVAL, SKIP_BLANKS, CMDBUF);

  14137 14 005576   000000 165400                    TCTR
        14 005577   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255
        14 005600   002144 000000 1                  ARG     SKIP_BLANKS
        14 005601   222364 000100                    ARG     OFFSET,,AUTO
        14 005602   222364 236100                    LDQ     OFFSET,,AUTO
        14 005603   000044 737000                    LLS     36
        14 005604   000033 771000                    ARL     27
        14 005605   222400 755100                    STA     TVAL,,AUTO
        14 005606   222364 551140                    STBA    OFFSET,'40'O,AUTO
        14 005607   005612 606400 14                 TTN     s:14138
        14 005610   000376 236007                    LDQ     254,DL
        14 005611   222364 156100                    SSQ     OFFSET,,AUTO

     1502    14138    4               CALL INSERT( CMDBUF, OFFSET + 2, , '(', COMMENT$->CV.T, ')');
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:258  

  14138 14 005612   000000 720100                    LXL0    0,,PR0
        14 005613   222364 721100                    LXL1    OFFSET,,AUTO
        14 005614   777402 621011                    EAX1    -254,X1
        14 005615   777777 661003                    ERX1    -1,DU
        14 005616   222364 236100                    LDQ     OFFSET,,AUTO
        14 005617   040046 100400                    MLR     fill='040'O
        14 005620   000105 000001 15                 ADSC9   69                       cn=0,n=1
        14 005621   002107 400011 6                  ADSC9   CMDBUF,Q                 cn=2,n=*X1
        14 005622   000374 116007                    CMPQ    252,DL
        14 005623   005650 603000 14                 TRC     s:14140
        14 005624   777403 622006                    EAX2    -253,QL
        14 005625   777777 662003                    ERX2    -1,DU
        14 005626   040046 100540                    MLR     fill='040'O
        14 005627   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 005630   002107 600012 6                  ADSC9   CMDBUF,Q                 cn=3,n=*X2
        14 005631   000000 636010                    EAQ     0,X0
        14 005632   000022 772000                    QRL     18
        14 005633   222364 036100                    ADLQ    OFFSET,,AUTO
        14 005634   000374 116007                    CMPQ    252,DL
        14 005635   005650 603000 14                 TRC     s:14140
        14 005636   222722 756100                    STQ     @VLEN+2,,AUTO
        14 005637   000000 636010                    EAQ     0,X0
        14 005640   000022 772000                    QRL     18
        14 005641   222364 036100                    ADLQ    OFFSET,,AUTO
        14 005642   222722 720100                    LXL0    @VLEN+2,,AUTO
        14 005643   777403 620010                    EAX0    -253,X0
        14 005644   777777 660003                    ERX0    -1,DU
        14 005645   040046 100400                    MLR     fill='040'O
        14 005646   000106 000001 15                 ADSC9   70                       cn=0,n=1
        14 005647   002107 600010 6                  ADSC9   CMDBUF,Q                 cn=3,n=*X0

     1503    14139    4               END;

     1504    14140    3           CALL SEND_SMTP_DATA;

  14140 14 005650   007420 701000 14                 TSX1    SEND_SMTP_DATA
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:259  
        14 005651   000000 011000                    NOP     0

     1505    14141    3           END;

     1506    14142    3       IF SUBJECT$->CV.L > 0 THEN DO;

  14142 14 005652   002460 470400 1                  LDP0    SUBJECT$
        14 005653   000000 235100                    LDA     0,,PR0
        14 005654   005666 600000 14                 TZE     s:14146

     1507    14143    3           CALL CONCAT( CMDBUF, MSGSUBJ, SUBJECT$->CV.T);

  14143 14 005655   000000 720100                    LXL0    0,,PR0
        14 005656   040000 100400                    MLR     fill='040'O
        14 005657   002416 000011 1                  ADSC9   MSGSUBJ                  cn=0,n=9
        14 005660   002107 000011 6                  ADSC9   CMDBUF                   cn=0,n=9
        14 005661   040000 100540                    MLR     fill='040'O
        14 005662   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 005663   002111 200366 6                  ADSC9   CMDBUF+2                 cn=1,n=246

     1508    14144    3           CALL SEND_SMTP_DATA;

  14144 14 005664   007420 701000 14                 TSX1    SEND_SMTP_DATA
        14 005665   000000 011000                    NOP     0

     1509    14145    3           END;

     1510    14146    3       IF RE$->CV.L > 0 THEN DO;

  14146 14 005666   002461 470400 1                  LDP0    RE$
        14 005667   000000 235100                    LDA     0,,PR0
        14 005670   005702 600000 14                 TZE     s:14150

     1511    14147    3           CALL CONCAT( CMDBUF, MSGRE, RE$->CV.T);

  14147 14 005671   000000 720100                    LXL0    0,,PR0
        14 005672   040000 100400                    MLR     fill='040'O
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:260  
        14 005673   002421 000014 1                  ADSC9   MSGRE                    cn=0,n=12
        14 005674   002107 000014 6                  ADSC9   CMDBUF                   cn=0,n=12
        14 005675   040000 100540                    MLR     fill='040'O
        14 005676   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 005677   002112 000363 6                  ADSC9   CMDBUF+3                 cn=0,n=243

     1512    14148    3           CALL SEND_SMTP_DATA;

  14148 14 005700   007420 701000 14                 TSX1    SEND_SMTP_DATA
        14 005701   000000 011000                    NOP     0

     1513    14149    3           END;

     1514    14150    3       IF VM_HEADER.UNIQUE_ID$ ~= ADDR( NIL) THEN DO;

  14150 14 005702   222345 470500                    LDP0    HEADER$,,AUTO
        14 005703   000032 236100                    LDQ     26,,PR0
        14 005704   000001 116000 xsym               CMPQ    B_VECTNIL+1
        14 005705   005723 600000 14                 TZE     s:14154

     1515    14151    3           CALL CONCAT( CMDBUF, MSGID, VM_HEADER.UNIQUE_ID$->TEXTC.T);

  14151 14 005706   000032 471500                    LDP1    26,,PR0
        14 005707   000100 101500                    MRL     fill='000'O
        14 005710   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        14 005711   222722 000002                    ADSC9   @VLEN+2,,AUTO            cn=0,n=2
        14 005712   222722 220100                    LDX0    @VLEN+2,,AUTO
        14 005713   040000 100400                    MLR     fill='040'O
        14 005714   002427 000014 1                  ADSC9   MSGID                    cn=0,n=12
        14 005715   002107 000014 6                  ADSC9   CMDBUF                   cn=0,n=12
        14 005716   040000 100540                    MLR     fill='040'O
        14 005717   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0
        14 005720   002112 000363 6                  ADSC9   CMDBUF+3                 cn=0,n=243

     1516    14152    3           CALL SEND_SMTP_DATA;

  14152 14 005721   007420 701000 14                 TSX1    SEND_SMTP_DATA
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:261  
        14 005722   000000 011000                    NOP     0

     1517    14153    3           END;

     1518    14154    3       IF VM_HEADER.REFERS_TO_ID$ ~= ADDR( NIL) THEN DO;

  14154 14 005723   222345 470500                    LDP0    HEADER$,,AUTO
        14 005724   000033 236100                    LDQ     27,,PR0
        14 005725   000001 116000 xsym               CMPQ    B_VECTNIL+1
        14 005726   005744 600000 14                 TZE     s:14158

     1519    14155    3           CALL CONCAT( CMDBUF, MSGREFID, VM_HEADER.REFERS_TO_ID$->TEXTC.T);

  14155 14 005727   000033 471500                    LDP1    27,,PR0
        14 005730   000100 101500                    MRL     fill='000'O
        14 005731   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        14 005732   222722 000002                    ADSC9   @VLEN+2,,AUTO            cn=0,n=2
        14 005733   222722 220100                    LDX0    @VLEN+2,,AUTO
        14 005734   040000 100400                    MLR     fill='040'O
        14 005735   002432 000015 1                  ADSC9   MSGREFID                 cn=0,n=13
        14 005736   002107 000015 6                  ADSC9   CMDBUF                   cn=0,n=13
        14 005737   040000 100540                    MLR     fill='040'O
        14 005740   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0
        14 005741   002112 200362 6                  ADSC9   CMDBUF+3                 cn=1,n=242

     1520    14156    3           CALL SEND_SMTP_DATA;

  14156 14 005742   007420 701000 14                 TSX1    SEND_SMTP_DATA
        14 005743   000000 011000                    NOP     0

     1521    14157    3           END;

     1522    14158    3       IF QUOTE_COUNT > 0 AND NODE.FLAGS.QUOTES( THIS_NODE) THEN DO;

  14158 14 005744   200140 235100                    LDA     QUOTE_COUNT,,AUTO
        14 005745   006046 600000 14                 TZE     SEND_DATA
        14 005746   200132 236100                    LDQ     THIS_NODE,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:262  
        14 005747   000023 402007                    MPY     19,DL
        14 005750   201273 234106                    SZN     NODE+17,QL,AUTO
        14 005751   006046 605000 14                 TPL     SEND_DATA

     1523    14159    3           QUOTE_NUMBER = MOD( MSG_TSTAMP, QUOTE_COUNT);

  14159 14 005752   003430 236000 6                  LDQ     MSG_TSTAMP
        14 005753   005770 605000 14                 TPL     s:14159+14
        14 005754   200140 235100                    LDA     QUOTE_COUNT,,AUTO
        14 005755   005764 604000 14                 TMI     s:14159+10
        14 005756   000001 115007                    CMPA    1,DL
        14 005757   005772 600000 14                 TZE     s:14159+16
        14 005760   000000 235003                    LDA     0,DU
        14 005761   000001 737000                    LLS     1
        14 005762   200140 507100                    DVF     QUOTE_COUNT,,AUTO
        14 005763   005772 710000 14                 TRA     s:14159+16
        14 005764   200140 116100                    CMPQ    QUOTE_COUNT,,AUTO
        14 005765   005772 604000 14                 TMI     s:14159+16
        14 005766   200140 136100                    SBLQ    QUOTE_COUNT,,AUTO
        14 005767   005772 710000 14                 TRA     s:14159+16
        14 005770   200140 235100                    LDA     QUOTE_COUNT,,AUTO
        14 005771   005774 605000 14                 TPL     s:14159+18
        14 005772   000044 737000                    LLS     36
        14 005773   005775 710000 14                 TRA     s:14159+19
        14 005774   200140 506100                    DIV     QUOTE_COUNT,,AUTO
        14 005775   222365 755100                    STA     QUOTE_NUMBER,,AUTO

     1524    14160    3           IF QUOTE_NUMBER < 0 THEN

  14160 14 005776   000000 115003                    CMPA    0,DU
        14 005777   006002 605000 14                 TPL     s:14162

     1525    14161    3               QUOTE_NUMBER = -QUOTE_NUMBER;

  14161 14 006000   000000 531000                    NEG     0
        14 006001   222365 755100                    STA     QUOTE_NUMBER,,AUTO

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:263  
     1526    14162    3           QUOTE_KEY.K = QUOTE_NUMBER * 1000;

  14162 14 006002   222365 236100                    LDQ     QUOTE_NUMBER,,AUTO
        14 006003   001750 402007                    MPY     1000,DL
        14 006004   002106 552034 6                  STBQ    QUOTE_KEY,'34'O

     1527    14163    3           QUOTE_KEY.L = 3;

  14163 14 006005   003000 236003                    LDQ     1536,DU
        14 006006   002106 552040 6                  STBQ    QUOTE_KEY,'40'O

     1528    14164    3   SEND_QUOTE:
     1529    14165    4           DO UNTIL %NO#;

  14165 14 006007                       SEND_QUOTE   null
     1530    14166    4               QUOTE_BUF = ' ';

  14166 14 006007   040000 100400                    MLR     fill='040'O
        14 006010   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 006011   002006 000377 6                  ADSC9   QUOTE_BUF                cn=0,n=255

     1531    14167    4               CALL M$READ( READ_QUOTES)

  14167 14 006012   001204 630400 1                  EPPR0   READ_QUOTES
        14 006013   440000 713400                    CLIMB   alt,read
        14 006014   401400 401760                    pmme    nvectors=4
        14 006015   006017 702000 14                 TSX2    s:14169
        14 006016   006020 710000 14                 TRA     s:14171

     1532    14168    5               WHENALTRETURN DO;

     1533    14169    5                   EXIT SEND_QUOTE;

  14169 14 006017   006046 710000 14                 TRA     SEND_DATA

     1534    14170    5                   END;
     1535    14171    4               IF MOD( QUOTE_KEY.K, 1000) = 0 THEN
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:264  

  14171 14 006020   002106 236000 6                  LDQ     QUOTE_KEY
        14 006021   000032 376000 xsym               ANQ     B_VECTNIL+26
        14 006022   001750 506007                    DIV     1000,DL
        14 006023   000044 733000                    LRS     36
        14 006024   000000 116003                    CMPQ    0,DU
        14 006025   006032 601000 14                 TNZ     s:14174

     1536    14172    4                   CMDBUF = MSGQUOTE;

  14172 14 006026   040000 100400                    MLR     fill='040'O
        14 006027   002424 000014 1                  ADSC9   MSGQUOTE                 cn=0,n=12
        14 006030   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255
        14 006031   006035 710000 14                 TRA     s:14175

     1537    14173    4               ELSE
     1538    14174    4                   CMDBUF = ' ';

  14174 14 006032   040000 100400                    MLR     fill='040'O
        14 006033   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 006034   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     1539    14175    4               SUBSTR( CMDBUF, LENGTHC( MSGQUOTE)) = QUOTE_BUF;

  14175 14 006035   040000 100400                    MLR     fill='040'O
        14 006036   002006 000363 6                  ADSC9   QUOTE_BUF                cn=0,n=243
        14 006037   002112 000363 6                  ADSC9   CMDBUF+3                 cn=0,n=243

     1540    14176    4               CALL SEND_SMTP_DATA;

  14176 14 006040   007420 701000 14                 TSX1    SEND_SMTP_DATA
        14 006041   000000 011000                    NOP     0

     1541    14177    4               QUOTE_KEY.K = QUOTE_KEY.K + 1;

  14177 14 006042   002106 236000 6                  LDQ     QUOTE_KEY
        14 006043   000001 036007                    ADLQ    1,DL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:265  
        14 006044   002106 552034 6                  STBQ    QUOTE_KEY,'34'O

     1542    14178    4               END SEND_QUOTE;

  14178 14 006045   006007 710000 14                 TRA     SEND_QUOTE

     1543    14179    3           END;

     1544    14180    2   SEND_DATA:
     1545    14181    2       CMDBUF = ' ';

  14181 14 006046   040000 100400       SEND_DATA    MLR     fill='040'O
        14 006047   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 006050   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     1546    14182    2       CALL SEND_SMTP_NULL;

  14182 14 006051   007525 701000 14                 TSX1    SEND_SMTP_NULL
        14 006052   000000 011000                    NOP     0

     1547    14183            /****** SEND MESSAGE BODY ******/
     1548    14184    2       IF VM_HEADER.STATUS.ERR THEN

  14184 14 006053   222345 470500                    LDP0    HEADER$,,AUTO
        14 006054   000012 234100                    SZN     10,,PR0
        14 006055   006061 605000 14                 TPL     s:14187

     1549    14185    2           CALL SEND_ERROR_REPORT;

  14185 14 006056   007055 701000 14                 TSX1    SEND_ERROR_REPORT
        14 006057   000000 011000                    NOP     0
        14 006060   006065 710000 14                 TRA     s:14188

     1550    14186    2       ELSE
     1551    14187    2           CALL SEND_MESSAGE_BODY;

  14187 14 006061   000001 236000 xsym               LDQ     B_VECTNIL+1
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:266  
        14 006062   222711 756100                    STQ     TVAL+2,,AUTO
        14 006063   006445 701000 14                 TSX1    SEND_MESSAGE_BODY
        14 006064   000000 011000                    NOP     0

     1552    14188    2       CALL INDEX( OFFSET, ';', DRAINING_COMGROUP.NAME#);

  14188 14 006065   000000 124400                    SCM     mask='000'O
        14 006066   000667 200035 6                  ADSC9   DRAINING_COMGROUP        cn=1,n=29
        14 006067   000016 000001 15                 ADSC9   14                       cn=0,n=1
        14 006070   222364 000100                    ARG     OFFSET,,AUTO

     1553    14189    3       DO UNTIL COUNT < 10;

     1554    14190    3           CALL TCM$DRAIN_SMTP( COUNT);

  14190 14 006071   222355 630500                    EPPR0   COUNT,,AUTO
        14 006072   222722 450500                    STP0    @VLEN+2,,AUTO
        14 006073   222722 630500                    EPPR0   @VLEN+2,,AUTO
        14 006074   000017 631400 xsym               EPPR1   B_VECTNIL+15
        14 006075   000000 701000 xent               TSX1    TCM$DRAIN_SMTP
        14 006076   000000 011000                    NOP     0

     1555    14191    3           CALL BINCHAR( SUBSTR( DRAINING_COMGROUP.NAME#, OFFSET + 2, 4), COUNT);

  14191 14 006077   222355 235100                    LDA     COUNT,,AUTO
        14 006100   000044 773000                    LRL     36
        14 006101   222722 757100                    STAQ    @VLEN+2,,AUTO
        14 006102   222364 235100                    LDA     OFFSET,,AUTO
        14 006103   000005 301500                    BTD
        14 006104   222722 000010                    NDSC9   @VLEN+2,,AUTO            cn=0,s=lsgnf,sf=0,n=8
        14 006105   000667 630004 6                  NDSC9   DRAINING_COMGROUP,A      cn=3,s=nosgn,sf=0,n=4

     1556    14192    3           CALL STATUS_UPDATE( DRAINING_COMGROUP);

  14192 14 006106   000107 236000 15                 LDQ     71
        14 006107   222715 756100                    STQ     LAST+2,,AUTO
        14 006110   013522 701000 14                 TSX1    STATUS_UPDATE
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:267  
        14 006111   000000 011000                    NOP     0

     1557    14193    3           IF COUNT >= 10 THEN

  14193 14 006112   222355 235100                    LDA     COUNT,,AUTO
        14 006113   000012 115007                    CMPA    10,DL
        14 006114   006120 602000 14                 TNC     s:14195

     1558    14194    3               CALL M$WAIT( WAIT_A_SECOND);

  14194 14 006115   001642 630400 1                  EPPR0   WAIT_A_SECOND
        14 006116   020006 713400                    CLIMB   8198
        14 006117   400400 401760                    pmme    nvectors=2

     1559    14195    3           END;

  14195 14 006120   222355 235100                    LDA     COUNT,,AUTO
        14 006121   000012 115007                    CMPA    10,DL
        14 006122   006071 603000 14                 TRC     s:14190

     1560    14196    2       CMDBUF = '.';

  14196 14 006123   040000 100400                    MLR     fill='040'O
        14 006124   000037 000001 15                 ADSC9   31                       cn=0,n=1
        14 006125   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     1561    14197    2       CALL STATUS_UPDATE( AWAITING_FINAL_ACK);

  14197 14 006126   000110 236000 15                 LDQ     72
        14 006127   222715 756100                    STQ     LAST+2,,AUTO
        14 006130   013522 701000 14                 TSX1    STATUS_UPDATE
        14 006131   000000 011000                    NOP     0

     1562    14198    2       CALL SEND_SMTP_COMMAND( '2') ALTRET( ERR);

  14198 14 006132   000051 236000 15                 LDQ     41
        14 006133   222607 756100                    STQ     LEN_TARGET+2,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:268  
        14 006134   007243 701000 14                 TSX1    SEND_SMTP_COMMAND
        14 006135   006172 702000 14                 TSX2    ERR

     1563    14199    2       IF ( SITE.RR_ACTION( CURR_SITE) = %DEFAULT AND VM_HEADER.STATUS.RR) OR

  14199 14 006136   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 006137   000072 402007                    MPY     58,DL
        14 006140   200237 236106                    LDQ     SITE+57,QL,AUTO
        14 006141   600000 316003                    CANQ    -65536,DU
        14 006142   006147 601000 14                 TNZ     s:14199+9
        14 006143   222345 470500                    LDP0    HEADER$,,AUTO
        14 006144   000012 236100                    LDQ     10,,PR0
        14 006145   020000 316003                    CANQ    8192,DU
        14 006146   006160 601000 14                 TNZ     s:14201
        14 006147   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 006150   000072 402007                    MPY     58,DL
        14 006151   200237 236106                    LDQ     SITE+57,QL,AUTO
        14 006152   140000 316003                    CANQ    49152,DU
        14 006153   006166 601000 14                 TNZ     s:14202
        14 006154   222345 470500                    LDP0    HEADER$,,AUTO
        14 006155   000012 236100                    LDQ     10,,PR0
        14 006156   000004 316003                    CANQ    4,DU
        14 006157   006166 600000 14                 TZE     s:14202

     1564    14200    2               ( SITE.DR_ACTION( CURR_SITE) = %DEFAULT AND VM_HEADER.STATUS.DR) THEN
     1565    14201    2           CALL POST_MESSAGE_ACKNOWLEDGEMENT( SITE.NAME( CURR_SITE));

  14201 14 006160   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 006161   000072 402007                    MPY     58,DL
        14 006162   200146 631506                    EPPR1   SITE,QL,AUTO
        14 006163   222607 451500                    STP1    LEN_TARGET+2,,AUTO
        14 006164   013012 701000 14                 TSX1    POST_MESSAGE_ACKNOWLEDGEMENT
        14 006165   000000 011000                    NOP     0

     1566    14202    2       MSG_COUNT = MSG_COUNT + 1;

  14202 14 006166   200103 235100                    LDA     MSG_COUNT,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:269  
        14 006167   000001 035007                    ADLA    1,DL
        14 006170   200103 755100                    STA     MSG_COUNT,,AUTO

     1567    14203            /****** TELL SENDER IF SMTP REJECTS THE MESSAGE ******/
     1568    14204    3       DO NEVER;

  14204 14 006171   006200 710000 14                 TRA     WRAP_IT_UP

     1569    14205    3   ERR:
     1570    14206    3           CALL POST_MESSAGE_REJECTION( SITE.NAME( CURR_SITE));

  14206 14 006172   200127 236100       ERR          LDQ     CURR_SITE,,AUTO
        14 006173   000072 402007                    MPY     58,DL
        14 006174   200146 630506                    EPPR0   SITE,QL,AUTO
        14 006175   222607 450500                    STP0    LEN_TARGET+2,,AUTO
        14 006176   013327 701000 14                 TSX1    POST_MESSAGE_REJECTION
        14 006177   000000 011000                    NOP     0

     1571    14207    3           END;

     1572    14208            /****** INDICATE MESSAGE HAS BEEN PROCESSED ******/
     1573    14209    2   WRAP_IT_UP:
     1574    14210    2       CALL TCM$WRITE_AUDIT_LOG( MSG_COUNT, SITE.NAME( CURR_SITE));

  14210 14 006200   200127 236100       WRAP_IT_UP   LDQ     CURR_SITE,,AUTO
        14 006201   000072 402007                    MPY     58,DL
        14 006202   200146 630506                    EPPR0   SITE,QL,AUTO
        14 006203   222723 450500                    STP0    @VLEN+3,,AUTO
        14 006204   200103 631500                    EPPR1   MSG_COUNT,,AUTO
        14 006205   222722 451500                    STP1    @VLEN+2,,AUTO
        14 006206   222722 630500                    EPPR0   @VLEN+2,,AUTO
        14 006207   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 006210   000000 701000 xent               TSX1    TCM$WRITE_AUDIT_LOG
        14 006211   000000 011000                    NOP     0

     1575    14211    3       IF MESSAGE_FILE AND HITS.BC AND ( HITS.PRIMARY OR HITS.C) THEN DO;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:270  
  14211 14 006212   200141 234100                    SZN     MESSAGE_FILE,,AUTO
        14 006213   006246 605000 14                 TPL     s:14223
        14 006214   200145 236100                    LDQ     HITS,,AUTO
        14 006215   100000 316003                    CANQ    32768,DU
        14 006216   006246 600000 14                 TZE     s:14223
        14 006217   200145 234100                    SZN     HITS,,AUTO
        14 006220   006223 604000 14                 TMI     s:14212
        14 006221   200000 316003                    CANQ    65536,DU
        14 006222   006246 600000 14                 TZE     s:14223

     1576    14212    3           VM_INFOKEY.COUNT = 5;

  14212 14 006223   005000 236003                    LDQ     2560,DU
        14 006224   001032 552040 6                  STBQ    VM_INFOKEY,'40'O

     1577    14213    3           VM_INFOKEY.MESSAGE_NUMBER = MSG_NUMBER;

  14213 14 006225   000000 100500                    MLR     fill='000'O
        14 006226   222343 000004                    ADSC9   MSG_NUMBER,,AUTO         cn=0,n=4
        14 006227   001032 400004 6                  ADSC9   VM_INFOKEY               cn=2,n=4

     1578    14214    3           VM_INFOKEY.TYPE = %VM_TYPE_BC;

  14214 14 006230   000040 236003                    LDQ     32,DU
        14 006231   001032 552020 6                  STBQ    VM_INFOKEY,'20'O

     1579    14215    3           DELETE_FOLDER.KEY_ = VECTOR( VM_INFOKEY);

  14215 14 006232   000112 237000 15                 LDAQ    74
        14 006233   000156 757000 6                  STAQ    DELETE_FOLDER+2

     1580    14216    3           DELETE_FOLDER.LKEY_ = VECTOR( NIL);

  14216 14 006234   000024 237000 15                 LDAQ    20
        14 006235   000160 757000 6                  STAQ    DELETE_FOLDER+4

     1581    14217    3           CALL M$DELREC( DELETE_FOLDER)
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:271  

  14217 14 006236   000154 630400 6                  EPPR0   DELETE_FOLDER
        14 006237   440002 713400                    CLIMB   alt,+16386
        14 006240   401400 401760                    pmme    nvectors=4
        14 006241   006243 702000 14                 TSX2    s:14220
        14 006242   006243 710000 14                 TRA     s:14220

     1582    14218    4           WHENALTRETURN DO;

     1583    14219    4               END;

     1584    14220    3           HITS.BC = %NO#;

  14220 14 006243   000114 236000 15                 LDQ     76
        14 006244   200145 356100                    ANSQ    HITS,,AUTO

     1585    14221    3           GOTO BEGIN_SENDING;

  14221 14 006245   003447 710000 14                 TRA     BEGIN_SENDING

     1586    14222    3           END;
     1587    14223    2       SITE.PENDING( CURR_SITE) = SITE.PENDING( CURR_SITE) - 1;

  14223 14 006246   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 006247   000072 402007                    MPY     58,DL
        14 006250   000000 620006                    EAX0    0,QL
        14 006251   000001 336007                    LCQ     1,DL
        14 006252   200227 056110                    ASQ     SITE+49,X0,AUTO

     1588    14224    2       CALL DELETE_MESSAGE;

  14224 14 006253   012622 701000 14                 TSX1    DELETE_MESSAGE
        14 006254   000000 011000                    NOP     0

     1589    14225    2       CMDBUF = 'RSET';

  14225 14 006255   040000 100400                    MLR     fill='040'O
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:272  
        14 006256   003026 000004 1                  ADSC9   TCM_XLATE_TO_UC+225      cn=0,n=4
        14 006257   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     1590    14226    2       CALL SEND_SMTP_COMMAND( '2');

  14226 14 006260   000051 236000 15                 LDQ     41
        14 006261   222607 756100                    STQ     LEN_TARGET+2,,AUTO
        14 006262   007243 701000 14                 TSX1    SEND_SMTP_COMMAND
        14 006263   000000 011000                    NOP     0

     1591    14227    2       RETURN;

  14227 14 006264   222354 221300                    LDX1  ! HAVE_A_CMD,,AUTO
        14 006265   000001 702211                    TSX2  ! 1,X1

     1592    14228
     1593    14229    2       END SEND_ONE_MAILGRAM;
     1594    14230        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:273  
     1595    14231    1   EMIT_ADDRESSES: PROC( HEADER, HEADER_LENGTH, TYPE, REALLY, REALLY_LENGTH, TEXT$);

  14231 14 006266   222606 741300       EMIT_ADDRES* STX1  ! LEN_TARGET+1,,AUTO

     1596    14232
     1597    14233    2       DCL COUNT UBIN;
     1598    14234    2       DCL GOT_ONE BIT(1);
     1599    14235    2       DCL HEADER CHAR( HEADER_LENGTH);
     1600    14236    2       DCL HEADER_LENGTH UBIN;
     1601    14237    2       DCL INDX UBIN;
     1602    14238    2       DCL REALLY CHAR( REALLY_LENGTH);
     1603    14239    2       DCL REALLY_LENGTH UBIN;
     1604    14240    2       DCL TEXT$ PTR;
     1605    14241    2       DCL TYPE UBIN;
     1606    14242
     1607    14243    2       GOT_ONE = %NO#;

  14243 14 006267   222616 450100                    STZ     GOT_ONE,,AUTO

     1608    14244    3       DO COUNT = 0 TO USER_COUNT - 1;

  14244 14 006270   222615 450100                    STZ     COUNT,,AUTO
        14 006271   006377 710000 14                 TRA     s:14258+3

     1609    14245    4           IF USERS.LIST( COUNT) = TYPE AND USERS.L( COUNT) > 0 THEN DO;

  14245 14 006272   222611 470500                    LDP0    @TYPE,,AUTO
        14 006273   222615 236100                    LDQ     COUNT,,AUTO
        14 006274   000076 402007                    MPY     62,DL
        14 006275   202344 236106                    LDQ     USERS,QL,AUTO
        14 006276   000000 116100                    CMPQ    0,,PR0
        14 006277   006374 601000 14                 TNZ     s:14258
        14 006300   222615 236100                    LDQ     COUNT,,AUTO
        14 006301   000076 402007                    MPY     62,DL
        14 006302   202345 235106                    LDA     USERS+1,QL,AUTO
        14 006303   006374 600000 14                 TZE     s:14258

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:274  
     1610    14246    5               IF GOT_ONE THEN DO;

  14246 14 006304   222616 234100                    SZN     GOT_ONE,,AUTO
        14 006305   006340 605000 14                 TPL     s:14253

     1611    14247    5                   SUBSTR( CMDBUF, INDX) = ',';

  14247 14 006306   222617 720100                    LXL0    INDX,,AUTO
        14 006307   777400 620010                    EAX0    -256,X0
        14 006310   777777 660003                    ERX0    -1,DU
        14 006311   222617 235100                    LDA     INDX,,AUTO
        14 006312   040045 100400                    MLR     fill='040'O
        14 006313   000036 000001 15                 ADSC9   30                       cn=0,n=1
        14 006314   002107 000010 6                  ADSC9   CMDBUF,A                 cn=0,n=*X0

     1612    14248    5                   CALL SEND_SMTP_DATA;

  14248 14 006315   007420 701000 14                 TSX1    SEND_SMTP_DATA
        14 006316   000000 011000                    NOP     0

     1613    14249    5                   CMDBUF = ' ';

  14249 14 006317   040000 100400                    MLR     fill='040'O
        14 006320   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 006321   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     1614    14250    5                   SUBSTR( CMDBUF, HEADER_LENGTH) = USERS.T( COUNT);

  14250 14 006322   222610 470500                    LDP0    @HEADER_LENGTH,,AUTO
        14 006323   000000 235100                    LDA     0,,PR0
        14 006324   222722 755100                    STA     @VLEN+2,,AUTO
        14 006325   000000 235100                    LDA     0,,PR0
        14 006326   000027 675000 xsym               ERA     B_VECTNIL+23
        14 006327   000400 035007                    ADLA    256,DL
        14 006330   222615 236100                    LDQ     COUNT,,AUTO
        14 006331   000000 620005                    EAX0    0,AL
        14 006332   000370 402007                    MPY     248,DL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:275  
        14 006333   222722 235100                    LDA     @VLEN+2,,AUTO
        14 006334   040045 100506                    MLR     fill='040'O
        14 006335   202346 000360                    ADSC9   USERS+2,Q,AUTO           cn=0,n=240
        14 006336   002107 000010 6                  ADSC9   CMDBUF,A                 cn=0,n=*X0

     1615    14251    5                   END;

  14251 14 006337   006366 710000 14                 TRA     s:14256

     1616    14252    5               ELSE DO;

     1617    14253    5                   CALL CONCAT( CMDBUF, HEADER, USERS.T( COUNT));

  14253 14 006340   222610 471500                    LDP1    @HEADER_LENGTH,,AUTO
        14 006341   100000 720100                    LXL0    0,,PR1
        14 006342   222607 473500                    LDP3    @HEADER,,AUTO
        14 006343   040000 100540                    MLR     fill='040'O
        14 006344   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0
        14 006345   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255
        14 006346   000000 636010                    EAQ     0,X0
        14 006347   000022 772000                    QRL     18
        14 006350   000377 116007                    CMPQ    255,DL
        14 006351   006364 603000 14                 TRC     s:14254
        14 006352   222615 236100                    LDQ     COUNT,,AUTO
        14 006353   000370 402007                    MPY     248,DL
        14 006354   222722 740100                    STX0    @VLEN+2,,AUTO
        14 006355   777400 620010                    EAX0    -256,X0
        14 006356   777777 660003                    ERX0    -1,DU
        14 006357   222722 235100                    LDA     @VLEN+2,,AUTO
        14 006360   000022 771000                    ARL     18
        14 006361   040045 100506                    MLR     fill='040'O
        14 006362   202346 000360                    ADSC9   USERS+2,Q,AUTO           cn=0,n=240
        14 006363   002107 000010 6                  ADSC9   CMDBUF,A                 cn=0,n=*X0

     1618    14254    5                   GOT_ONE = %YES#;

  14254 14 006364   400000 236003                    LDQ     -131072,DU
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:276  
        14 006365   222616 756100                    STQ     GOT_ONE,,AUTO

     1619    14255    5                   END;

     1620    14256    4               INDX = USERS.L( COUNT) + HEADER_LENGTH;

  14256 14 006366   222610 470500                    LDP0    @HEADER_LENGTH,,AUTO
        14 006367   222615 236100                    LDQ     COUNT,,AUTO
        14 006370   000076 402007                    MPY     62,DL
        14 006371   202345 236106                    LDQ     USERS+1,QL,AUTO
        14 006372   000000 036100                    ADLQ    0,,PR0
        14 006373   222617 756100                    STQ     INDX,,AUTO

     1621    14257    4               END;

     1622    14258    3           END;

  14258 14 006374   222615 235100                    LDA     COUNT,,AUTO
        14 006375   000001 035007                    ADLA    1,DL
        14 006376   222615 755100                    STA     COUNT,,AUTO
        14 006377   222615 236100                    LDQ     COUNT,,AUTO
        14 006400   200142 116100                    CMPQ    USER_COUNT,,AUTO
        14 006401   006272 602000 14                 TNC     s:14245

     1623    14259    2       IF GOT_ONE THEN

  14259 14 006402   222616 234100                    SZN     GOT_ONE,,AUTO
        14 006403   006406 605000 14                 TPL     s:14261

     1624    14260    2           CALL SEND_SMTP_DATA;

  14260 14 006404   007420 701000 14                 TSX1    SEND_SMTP_DATA
        14 006405   000000 011000                    NOP     0

     1625    14261    3       IF TEXT$ ~= ADDR( NIL) THEN DO;

  14261 14 006406   222614 470500                    LDP0    @TEXT$,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:277  
        14 006407   000000 236100                    LDQ     0,,PR0
        14 006410   000001 116000 xsym               CMPQ    B_VECTNIL+1
        14 006411   006443 600000 14                 TZE     s:14265

     1626    14262    3           CALL CONCAT( CMDBUF, REALLY, TEXT$->TEXTC.T);

  14262 14 006412   222613 471500                    LDP1    @REALLY_LENGTH,,AUTO
        14 006413   100000 720100                    LXL0    0,,PR1
        14 006414   000000 473500                    LDP3    0,,PR0
        14 006415   000100 101500                    MRL     fill='000'O
        14 006416   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
        14 006417   222722 000002                    ADSC9   @VLEN+2,,AUTO            cn=0,n=2
        14 006420   222722 221100                    LDX1    @VLEN+2,,AUTO
        14 006421   222612 474500                    LDP4    @REALLY,,AUTO
        14 006422   040000 100540                    MLR     fill='040'O
        14 006423   400000 000010                    ADSC9   0,,PR4                   cn=0,n=*X0
        14 006424   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255
        14 006425   000000 636010                    EAQ     0,X0
        14 006426   000022 772000                    QRL     18
        14 006427   000377 116007                    CMPQ    255,DL
        14 006430   006441 603000 14                 TRC     s:14263
        14 006431   222723 740100                    STX0    @VLEN+3,,AUTO
        14 006432   777400 620010                    EAX0    -256,X0
        14 006433   777777 660003                    ERX0    -1,DU
        14 006434   222723 235100                    LDA     @VLEN+3,,AUTO
        14 006435   000022 771000                    ARL     18
        14 006436   040045 100540                    MLR     fill='040'O
        14 006437   300000 200011                    ADSC9   0,,PR3                   cn=1,n=*X1
        14 006440   002107 000010 6                  ADSC9   CMDBUF,A                 cn=0,n=*X0

     1627    14263    3           CALL SEND_SMTP_DATA;

  14263 14 006441   007420 701000 14                 TSX1    SEND_SMTP_DATA
        14 006442   000000 011000                    NOP     0

     1628    14264    3           END;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:278  
     1629    14265    2       RETURN;

  14265 14 006443   222606 221300                    LDX1  ! LEN_TARGET+1,,AUTO
        14 006444   000001 702211                    TSX2  ! 1,X1

     1630    14266
     1631    14267    2       END EMIT_ADDRESSES;
     1632    14268        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:279  
     1633    14269    1   SEND_MESSAGE_BODY: PROC( MAX#);

  14269 14 006445   222710 741300       SEND_MESSAG* STX1  ! TVAL+1,,AUTO

     1634    14270
     1635    14271    2       DCL MAX# UBIN;
     1636    14272    2       DCL OFFSET UBIN;
     1637    14273
     1638    14274    2       CALL INDEX( OFFSET, ' of ', SENDING_MESSAGE_BODY.NAME#);

  14274 14 006446   222712 631500                    EPPR1   OFFSET,,AUTO
        14 006447   003033 633400 1                  EPPR3   TCM_XLATE_TO_UC+230
        14 006450   000004 223003                    LDX3    4,DU
        14 006451   000657 630400 6                  EPPR0   SENDING_MESSAGE_BODY
        14 006452   000001 220003                    LDX0    1,DU
        14 006453   000000 500510                    A9BD    0,X0,PR0
        14 006454   000036 220003                    LDX0    30,DU
        14 006455   000000 236003                    LDQ     0,DU
        14 006456   000000 701000 xent               TSX1    X66_INDEX
        14 006457   000000 011000                    NOP     0

     1639    14275    2       CALL BINCHAR( SUBSTR( SENDING_MESSAGE_BODY.NAME#, OFFSET + 4, 4),

  14275 14 006460   222345 470500                    LDP0    HEADER$,,AUTO
        14 006461   000011 235100                    LDA     9,,PR0
        14 006462   000044 773000                    LRL     36
        14 006463   222722 757100                    STAQ    @VLEN+2,,AUTO
        14 006464   222712 235100                    LDA     OFFSET,,AUTO
        14 006465   000005 301500                    BTD
        14 006466   222722 000010                    NDSC9   @VLEN+2,,AUTO            cn=0,s=lsgnf,sf=0,n=8
        14 006467   000660 230004 6                  NDSC9   SENDING_MESSAGE_BODY+1,A cn=1,s=nosgn,sf=0,n=4

     1640    14276    2               VM_HEADER.NUM_RECORDS);
     1641    14277    2       CALL INDEX( OFFSET, ' line ', SENDING_MESSAGE_BODY.NAME#);

  14277 14 006470   222712 631500                    EPPR1   OFFSET,,AUTO
        14 006471   003006 633400 1                  EPPR3   TCM_XLATE_TO_UC+209
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:280  
        14 006472   000006 223003                    LDX3    6,DU
        14 006473   000657 630400 6                  EPPR0   SENDING_MESSAGE_BODY
        14 006474   000001 221003                    LDX1    1,DU
        14 006475   000000 500511                    A9BD    0,X1,PR0
        14 006476   000000 236003                    LDQ     0,DU
        14 006477   000000 701000 xent               TSX1    X66_INDEX
        14 006500   000000 011000                    NOP     0

     1642    14278    2       POSITION_FOLDER.KEY_ = VECTOR( VM_BODYKEY);

  14278 14 006501   000116 237000 15                 LDAQ    78
        14 006502   000110 757000 6                  STAQ    POSITION_FOLDER+2

     1643    14279    2       POSITION_FOLDER.V.KEYS# = %YES#;

  14279 14 006503   400000 236007                    LDQ     -131072,DL
        14 006504   000114 256000 6                  ORSQ    POSITION_FOLDER+6

     1644    14280    2       POSITION_FOLDER.V.KEYR# = %NO#;

  14280 14 006505   000115 236000 15                 LDQ     77
        14 006506   000114 356000 6                  ANSQ    POSITION_FOLDER+6

     1645    14281    2       POSITION_FOLDER.V.N# = 0;

  14281 14 006507   000115 450000 6                  STZ     POSITION_FOLDER+7

     1646    14282    2       VM_BODYKEY.COUNT = 7;

  14282 14 006510   007000 236003                    LDQ     3584,DU
        14 006511   001117 552040 6                  STBQ    VM_BODYKEY,'40'O

     1647    14283    2       VM_BODYKEY.TYPE = %VM_TYPE_BODY;

  14283 14 006512   000060 236003                    LDQ     48,DU
        14 006513   001117 552020 6                  STBQ    VM_BODYKEY,'20'O

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:281  
     1648    14284    2       VM_BODYKEY.MESSAGE_NUMBER = MSG_NUMBER;

  14284 14 006514   000000 100500                    MLR     fill='000'O
        14 006515   222343 000004                    ADSC9   MSG_NUMBER,,AUTO         cn=0,n=4
        14 006516   001117 400004 6                  ADSC9   VM_BODYKEY               cn=2,n=4

     1649    14285    2       VM_BODYKEY.REC_NUMBER = 0;

  14285 14 006517   000000 221003                    LDX1    0,DU
        14 006520   001120 441000 6                  SXL1    VM_BODYKEY+1

     1650    14286    2       CALL M$PRECORD( POSITION_FOLDER)

  14286 14 006521   000106 630400 6                  EPPR0   POSITION_FOLDER
        14 006522   440003 713400                    CLIMB   alt,+16387
        14 006523   401000 401760                    pmme    nvectors=3
        14 006524   006526 702000 14                 TSX2    s:14289
        14 006525   006526 710000 14                 TRA     s:14289

     1651    14287    3       WHENALTRETURN DO;

     1652    14288    3           END;

     1653    14289    2       READ_FOLDER.BUF_ = VECTOR( VM_BODYREC);

  14289 14 006526   000120 235000 15                 LDA     80
        14 006527   222346 236100                    LDQ     BODY$,,AUTO
        14 006530   000124 757000 6                  STAQ    READ_FOLDER+4

     1654    14290    2       READ_FOLDER.BUF_.BOUND = 4095;

  14290 14 006531   000124 236000 6                  LDQ     READ_FOLDER+4
        14 006532   177777 376007                    ANQ     65535,DL
        14 006533   000121 276000 15                 ORQ     81
        14 006534   000124 756000 6                  STQ     READ_FOLDER+4

     1655    14291    2       READ_FOLDER.KEY_ = VECTOR( VM_BODYKEY);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:282  

  14291 14 006535   000116 237000 15                 LDAQ    78
        14 006536   000122 757000 6                  STAQ    READ_FOLDER+2

     1656    14292    2       READ_FOLDER.V.KEYS# = %NO#;

  14292 14 006537   000115 236000 15                 LDQ     77
        14 006540   000130 356000 6                  ANSQ    READ_FOLDER+8

     1657    14293    2       READ_FOLDER.V.KEYR# = %YES#;

  14293 14 006541   100000 236007                    LDQ     32768,DL
        14 006542   000130 256000 6                  ORSQ    READ_FOLDER+8

     1658    14294    3       DO FOREVER;  /** DO UNTIL END OF MESSAGE **/

     1659    14295    3           VM_BODYREC.VALUE.DATA = ' ';

  14295 14 006543   222346 470500                    LDP0    BODY$,,AUTO
        14 006544   040100 100400                    MLR     fill='040'O
        14 006545   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 006546   000002 000454                    ADSC9   2,,PR0                   cn=0,n=300

     1660    14296    3           CALL M$READ( READ_FOLDER) ALTRET( EOT);

  14296 14 006547   000120 630400 6                  EPPR0   READ_FOLDER
        14 006550   440000 713400                    CLIMB   alt,read
        14 006551   401400 401760                    pmme    nvectors=4
        14 006552   006631 702000 14                 TSX2    EOT

     1661    14297    3           IF VM_BODYKEY.TYPE ~= %VM_TYPE_BODY OR

  14297 14 006553   001117 236000 6                  LDQ     VM_BODYKEY
        14 006554   000777 376003                    ANQ     511,DU
        14 006555   000060 116003                    CMPQ    48,DU
        14 006556   006631 601000 14                 TNZ     EOT
        14 006557   001117 235000 6                  LDA     VM_BODYKEY
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:283  
        14 006560   001120 236000 6                  LDQ     VM_BODYKEY+1
        14 006561   000022 773000                    LRL     18
        14 006562   222343 116100                    CMPQ    MSG_NUMBER,,AUTO
        14 006563   006631 601000 14                 TNZ     EOT
        14 006564   222711 236100                    LDQ     @MAX#,,AUTO
        14 006565   000001 116000 xsym               CMPQ    B_VECTNIL+1
        14 006566   006574 600000 14                 TZE     s:14302
        14 006567   222711 470500                    LDP0    @MAX#,,AUTO
        14 006570   001120 236000 6                  LDQ     VM_BODYKEY+1
        14 006571   777777 376007                    ANQ     -1,DL
        14 006572   000000 116100                    CMPQ    0,,PR0
        14 006573   006631 603000 14                 TRC     EOT

     1662    14298    3                   VM_BODYKEY.MESSAGE_NUMBER ~= MSG_NUMBER OR
     1663    14299    3                   ( ADDR( MAX#) ~= ADDR( NIL) AND
     1664    14300    3                           MAX# <= VM_BODYKEY.REC_NUMBER) THEN
     1665    14301    3               EXIT;
     1666    14302    3           CALL BINCHAR( SUBSTR( SENDING_MESSAGE_BODY.NAME#, OFFSET + 6, 4),

  14302 14 006574   001120 236000 6                  LDQ     VM_BODYKEY+1
        14 006575   777777 376007                    ANQ     -1,DL
        14 006576   000000 235003                    LDA     0,DU
        14 006577   222722 757100                    STAQ    @VLEN+2,,AUTO
        14 006600   222712 235100                    LDA     OFFSET,,AUTO
        14 006601   000005 301500                    BTD
        14 006602   222722 000010                    NDSC9   @VLEN+2,,AUTO            cn=0,s=lsgnf,sf=0,n=8
        14 006603   000660 630004 6                  NDSC9   SENDING_MESSAGE_BODY+1,A cn=3,s=nosgn,sf=0,n=4

     1667    14303    3                   VM_BODYKEY.REC_NUMBER);
     1668    14304    3           CALL STATUS_UPDATE( SENDING_MESSAGE_BODY);

  14304 14 006604   000122 236000 15                 LDQ     82
        14 006605   222715 756100                    STQ     LAST+2,,AUTO
        14 006606   013522 701000 14                 TSX1    STATUS_UPDATE
        14 006607   000000 011000                    NOP     0

     1669    14305                /** Do dot transparency **/
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:284  
     1670    14306    3           IF SUBSTR( VM_BODYREC.VALUE.DATA, 0, 1) = '.' THEN

  14306 14 006610   222346 470500                    LDP0    BODY$,,AUTO
        14 006611   000002 236100                    LDQ     2,,PR0
        14 006612   777000 376003                    ANQ     -512,DU
        14 006613   056000 116003                    CMPQ    23552,DU
        14 006614   006623 601000 14                 TNZ     s:14309

     1671    14307    3               CALL CONCAT( CMDBUF, '.', VM_BODYREC.VALUE.DATA);

  14307 14 006615   056000 236003                    LDQ     23552,DU
        14 006616   002107 756000 6                  STQ     CMDBUF
        14 006617   040000 100500                    MLR     fill='040'O
        14 006620   000002 000376                    ADSC9   2,,PR0                   cn=0,n=254
        14 006621   002107 200376 6                  ADSC9   CMDBUF                   cn=1,n=254
        14 006622   006626 710000 14                 TRA     s:14310

     1672    14308    3           ELSE
     1673    14309    3               CMDBUF = VM_BODYREC.VALUE.DATA;

  14309 14 006623   040000 100500                    MLR     fill='040'O
        14 006624   000002 000377                    ADSC9   2,,PR0                   cn=0,n=255
        14 006625   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     1674    14310    3           CALL SEND_SMTP_DATA;

  14310 14 006626   007420 701000 14                 TSX1    SEND_SMTP_DATA
        14 006627   000000 011000                    NOP     0

     1675    14311    3           END;

  14311 14 006630   006543 710000 14                 TRA     s:14295

     1676    14312    2   EOT:
     1677    14313    2       RETURN;

  14313 14 006631   222710 221300       EOT          LDX1  ! TVAL+1,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:285  
        14 006632   000001 702211                    TSX2  ! 1,X1

     1678    14314
     1679    14315    2       END SEND_MESSAGE_BODY;
     1680    14316        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:286  
     1681    14317    1   EMIT_TRACE_RECORDS: PROC;

  14317 14 006633   222710 741300       EMIT_TRACE_* STX1  ! TVAL+1,,AUTO

     1682    14318
     1683    14319    2       DCL EMITTING BIT(1);
     1684    14320    2       DCL FRST SBIN;
     1685    14321    2       DCL LAST SBIN;
     1686    14322
     1687    14323    2       EMITTING = %YES#;

  14323 14 006634   400000 236003                    LDQ     -131072,DU
        14 006635   222711 756100                    STQ     EMITTING,,AUTO

     1688    14324    2       GOTO COMMON;

  14324 14 006636   006641 710000 14                 TRA     COMMON

     1689    14325
     1690    14326    2   SCAN_TRACE_RECORDS: ENTRY;

  14326 14 006637   222710 741300       SCAN_TRACE_* STX1  ! TVAL+1,,AUTO

     1691    14327
     1692    14328    2       EMITTING = %NO#;

  14328 14 006640   222711 450100                    STZ     EMITTING,,AUTO

     1693    14329    2   COMMON:
     1694    14330    2       POSITION_FOLDER.KEY_ = VECTOR( VM_BODYKEY);

  14330 14 006641   000116 237000 15    COMMON       LDAQ    78
        14 006642   000110 757000 6                  STAQ    POSITION_FOLDER+2

     1695    14331    2       POSITION_FOLDER.V.KEYS# = %YES#;

  14331 14 006643   400000 236007                    LDQ     -131072,DL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:287  
        14 006644   000114 256000 6                  ORSQ    POSITION_FOLDER+6

     1696    14332    2       POSITION_FOLDER.V.KEYR# = %NO#;

  14332 14 006645   000115 236000 15                 LDQ     77
        14 006646   000114 356000 6                  ANSQ    POSITION_FOLDER+6

     1697    14333    2       POSITION_FOLDER.V.N# = 0;

  14333 14 006647   000115 450000 6                  STZ     POSITION_FOLDER+7

     1698    14334    2       VM_BODYKEY.COUNT = 7;

  14334 14 006650   007000 236003                    LDQ     3584,DU
        14 006651   001117 552040 6                  STBQ    VM_BODYKEY,'40'O

     1699    14335    2       VM_BODYKEY.TYPE = %VM_TYPE_TRACE;

  14335 14 006652   000054 236003                    LDQ     44,DU
        14 006653   001117 552020 6                  STBQ    VM_BODYKEY,'20'O

     1700    14336    2       VM_BODYKEY.MESSAGE_NUMBER = MSG_NUMBER;

  14336 14 006654   000000 100500                    MLR     fill='000'O
        14 006655   222343 000004                    ADSC9   MSG_NUMBER,,AUTO         cn=0,n=4
        14 006656   001117 400004 6                  ADSC9   VM_BODYKEY               cn=2,n=4

     1701    14337    2       VM_BODYKEY.REC_NUMBER = 0;

  14337 14 006657   000000 220003                    LDX0    0,DU
        14 006660   001120 440000 6                  SXL0    VM_BODYKEY+1

     1702    14338    2       CALL M$PRECORD( POSITION_FOLDER)

  14338 14 006661   000106 630400 6                  EPPR0   POSITION_FOLDER
        14 006662   440003 713400                    CLIMB   alt,+16387
        14 006663   401000 401760                    pmme    nvectors=3
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:288  
        14 006664   006666 702000 14                 TSX2    s:14341
        14 006665   006666 710000 14                 TRA     s:14341

     1703    14339    3       WHENALTRETURN DO;

     1704    14340    3           END;

     1705    14341    2       READ_FOLDER.BUF_ = VECTOR( VM_BODYREC);

  14341 14 006666   000120 235000 15                 LDA     80
        14 006667   222346 236100                    LDQ     BODY$,,AUTO
        14 006670   000124 757000 6                  STAQ    READ_FOLDER+4

     1706    14342    2       READ_FOLDER.BUF_.BOUND = 4095;

  14342 14 006671   000124 236000 6                  LDQ     READ_FOLDER+4
        14 006672   177777 376007                    ANQ     65535,DL
        14 006673   000121 276000 15                 ORQ     81
        14 006674   000124 756000 6                  STQ     READ_FOLDER+4

     1707    14343    2       READ_FOLDER.KEY_ = VECTOR( VM_BODYKEY);

  14343 14 006675   000116 237000 15                 LDAQ    78
        14 006676   000122 757000 6                  STAQ    READ_FOLDER+2

     1708    14344    2       READ_FOLDER.V.KEYS# = %NO#;

  14344 14 006677   000115 236000 15                 LDQ     77
        14 006700   000130 356000 6                  ANSQ    READ_FOLDER+8

     1709    14345    2       READ_FOLDER.V.KEYR# = %YES#;

  14345 14 006701   100000 236007                    LDQ     32768,DL
        14 006702   000130 256000 6                  ORSQ    READ_FOLDER+8

     1710    14346    2   TRACELOOP:
     1711    14347    3       DO WHILE( '1'B);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:289  

  14347 14 006703                       TRACELOOP    null
     1712    14348    3           VM_BODYREC.VALUE.DATA = ' ';

  14348 14 006703   222346 470500                    LDP0    BODY$,,AUTO
        14 006704   040100 100400                    MLR     fill='040'O
        14 006705   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 006706   000002 000454                    ADSC9   2,,PR0                   cn=0,n=300

     1713    14349    3           CALL M$READ( READ_FOLDER)

  14349 14 006707   000120 630400 6                  EPPR0   READ_FOLDER
        14 006710   440000 713400                    CLIMB   alt,read
        14 006711   401400 401760                    pmme    nvectors=4
        14 006712   006714 702000 14                 TSX2    s:14351
        14 006713   006715 710000 14                 TRA     s:14353

     1714    14350    4           WHENALTRETURN DO;

     1715    14351    4               EXIT TRACELOOP;

  14351 14 006714   007053 710000 14                 TRA     s:14383

     1716    14352    4               END;
     1717    14353    3           IF VM_BODYKEY.TYPE ~= %VM_TYPE_TRACE OR

  14353 14 006715   001117 236000 6                  LDQ     VM_BODYKEY
        14 006716   000777 376003                    ANQ     511,DU
        14 006717   000054 116003                    CMPQ    44,DU
        14 006720   007053 601000 14                 TNZ     s:14383
        14 006721   001117 235000 6                  LDA     VM_BODYKEY
        14 006722   001120 236000 6                  LDQ     VM_BODYKEY+1
        14 006723   000022 773000                    LRL     18
        14 006724   222343 116100                    CMPQ    MSG_NUMBER,,AUTO
        14 006725   007053 601000 14                 TNZ     s:14383

     1718    14354    3                   VM_BODYKEY.MESSAGE_NUMBER ~= MSG_NUMBER THEN
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:290  
     1719    14355    3               EXIT TRACELOOP;
     1720    14356    4           DO SELECT( SUBSTR( VM_BODYREC.VALUE.DATA, 0, 5));

  14356 14 006726   222346 470500                    LDP0    BODY$,,AUTO
        14 006727   040000 106500                    CMPC    fill='040'O
        14 006730   000002 000005                    ADSC9   2,,PR0                   cn=0,n=5
        14 006731   003034 000005 1                  ADSC9   TCM_XLATE_TO_UC+231      cn=0,n=5
        14 006732   007043 601000 14                 TNZ     s:14377
        14 006733   006734 710000 14                 TRA     s:14358

     1721    14357    4               SELECT( 'Retur');

     1722    14358    5                   IF NOT EMITTING THEN DO;

  14358 14 006734   222711 234100                    SZN     EMITTING,,AUTO
        14 006735   006703 604000 14                 TMI     TRACELOOP

     1723    14359    5                       CALL INDEX( FRST, '<', VM_BODYREC.VALUE.DATA);

  14359 14 006736   000000 124500                    SCM     mask='000'O
        14 006737   000002 000454                    ADSC9   2,,PR0                   cn=0,n=300
        14 006740   000123 000001 15                 ADSC9   83                       cn=0,n=1
        14 006741   222712 000100                    ARG     FRST,,AUTO

     1724    14360    5                       CALL INDEX( LAST, '>', VM_BODYREC.VALUE.DATA);

  14360 14 006742   000000 124500                    SCM     mask='000'O
        14 006743   000002 000454                    ADSC9   2,,PR0                   cn=0,n=300
        14 006744   000056 000001 15                 ADSC9   46                       cn=0,n=1
        14 006745   222713 000100                    ARG     LAST,,AUTO

     1725    14361    5                       IF MESSAGE_FILE THEN

  14361 14 006746   200141 234100                    SZN     MESSAGE_FILE,,AUTO
        14 006747   006772 605000 14                 TPL     s:14366

     1726    14362    5                           CALL CONCAT( CMDBUF, 'MAIL FROM:<',
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:291  

  14362 14 006750   222713 236100                    LDQ     LAST,,AUTO
        14 006751   222712 136100                    SBLQ    FRST,,AUTO
        14 006752   040000 100400                    MLR     fill='040'O
        14 006753   003017 000013 1                  ADSC9   TCM_XLATE_TO_UC+218      cn=0,n=11
        14 006754   002107 000013 6                  ADSC9   CMDBUF                   cn=0,n=11
        14 006755   777777 620006                    EAX0    -1,QL
        14 006756   222712 235100                    LDA     FRST,,AUTO
        14 006757   040000 100545                    MLR     fill='040'O
        14 006760   000002 200010                    ADSC9   2,A,PR0                  cn=1,n=*X0
        14 006761   002111 600364 6                  ADSC9   CMDBUF+2                 cn=3,n=244
        14 006762   000365 116007                    CMPQ    245,DL
        14 006763   006771 605000 14                 TPL     s:14362+17
        14 006764   777412 620006                    EAX0    -246,QL
        14 006765   777777 660003                    ERX0    -1,DU
        14 006766   040046 100400                    MLR     fill='040'O
        14 006767   000056 000001 15                 ADSC9   46                       cn=0,n=1
        14 006770   002111 400010 6                  ADSC9   CMDBUF+2,Q               cn=2,n=*X0
        14 006771   007042 710000 14                 TRA     s:14374

     1727    14363    5                                  SUBSTR( VM_BODYREC.VALUE.DATA, FRST+1, LAST-FRST-1),
     1728    14364    5                                   '>');
     1729    14365    6                       ELSE DO;

     1730    14366    6                           CALL CONCAT( CMDBUF, 'MAIL FROM:<SMTP_Mailer@',

  14366 14 006772   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 006773   000072 402007                    MPY     58,DL
        14 006774   200176 236106                    LDQ     SITE+24,QL,AUTO
        14 006775   000033 772000                    QRL     27
        14 006776   040000 100400                    MLR     fill='040'O
        14 006777   003036 000027 1                  ADSC9   TCM_XLATE_TO_UC+233      cn=0,n=23
        14 007000   002107 000027 6                  ADSC9   CMDBUF                   cn=0,n=23
        14 007001   000000 620006                    EAX0    0,QL
        14 007002   200127 236100                    LDQ     CURR_SITE,,AUTO
        14 007003   000350 402007                    MPY     232,DL
        14 007004   040000 100546                    MLR     fill='040'O
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:292  
        14 007005   200176 200010                    ADSC9   SITE+24,Q,AUTO           cn=1,n=*X0
        14 007006   002114 600350 6                  ADSC9   CMDBUF+5                 cn=3,n=232
        14 007007   000000 636010                    EAQ     0,X0
        14 007010   000022 772000                    QRL     18
        14 007011   000350 116007                    CMPQ    232,DL
        14 007012   007023 603000 14                 TRC     s:14369
        14 007013   222722 740100                    STX0    @VLEN+2,,AUTO
        14 007014   777427 620010                    EAX0    -233,X0
        14 007015   777777 660003                    ERX0    -1,DU
        14 007016   222722 235100                    LDA     @VLEN+2,,AUTO
        14 007017   000022 771000                    ARL     18
        14 007020   040045 100400                    MLR     fill='040'O
        14 007021   000056 000001 15                 ADSC9   46                       cn=0,n=1
        14 007022   002114 600010 6                  ADSC9   CMDBUF+5,A               cn=3,n=*X0

     1731    14367    6                                   SUBSTR( SITE.IDENT.TEXT( CURR_SITE), 0,
     1732    14368    6                                   SITE.IDENT.COUNT( CURR_SITE)), '>');
     1733    14369    6                           PATH$->CV.L = 1+LAST-FRST;

  14369 14 007023   222713 236100                    LDQ     LAST,,AUTO
        14 007024   222712 136100                    SBLQ    FRST,,AUTO
        14 007025   000001 036007                    ADLQ    1,DL
        14 007026   002455 471400 1                  LDP1    PATH$
        14 007027   100000 756100                    STQ     0,,PR1

     1734    14370    6                           PATH$->CV.T =

  14370 14 007030   100000 720100                    LXL0    0,,PR1
        14 007031   222713 236100                    LDQ     LAST,,AUTO
        14 007032   222712 136100                    SBLQ    FRST,,AUTO
        14 007033   000001 621006                    EAX1    1,QL
        14 007034   222712 235100                    LDA     FRST,,AUTO
        14 007035   040140 100545                    MLR     fill='040'O
        14 007036   000002 000011                    ADSC9   2,A,PR0                  cn=0,n=*X1
        14 007037   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0

     1735    14371    6                                   SUBSTR( VM_BODYREC.VALUE.DATA, FRST, 1+LAST-FRST);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:293  
     1736    14372    6                           TO$->CV.L = 0;  /* use PATH for TO */

  14372 14 007040   002456 473400 1                  LDP3    TO$
        14 007041   300000 450100                    STZ     0,,PR3

     1737    14373    6                           END;

     1738    14374    5                       EXIT TRACELOOP;

  14374 14 007042   007053 710000 14                 TRA     s:14383

     1739    14375    5                       END;
     1740    14376    4               SELECT( ELSE);

     1741    14377    5                   IF EMITTING THEN DO;

  14377 14 007043   222711 234100                    SZN     EMITTING,,AUTO
        14 007044   006703 605000 14                 TPL     TRACELOOP

     1742    14378    5                       CMDBUF = VM_BODYREC.VALUE.DATA;

  14378 14 007045   040000 100500                    MLR     fill='040'O
        14 007046   000002 000377                    ADSC9   2,,PR0                   cn=0,n=255
        14 007047   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     1743    14379    5                       CALL SEND_SMTP_DATA;

  14379 14 007050   007420 701000 14                 TSX1    SEND_SMTP_DATA
        14 007051   000000 011000                    NOP     0

     1744    14380    5                       END;

     1745    14381    4               END;

     1746    14382    3           END;

  14382 14 007052   006703 710000 14                 TRA     TRACELOOP
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:294  

     1747    14383    2       RETURN;

  14383 14 007053   222710 221300                    LDX1  ! TVAL+1,,AUTO
        14 007054   000001 702211                    TSX2  ! 1,X1

     1748    14384
     1749    14385    2       END EMIT_TRACE_RECORDS;
     1750    14386        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:295  
     1751    14387    1   SEND_ERROR_REPORT: PROC;

  14387 14 007055   222606 741300       SEND_ERROR_* STX1  ! LEN_TARGET+1,,AUTO

     1752    14388
     1753    14389    2       DCL TSTRING CHAR( %LINE_SIZE);
     1754    14390    2       DCL TVAL UBIN;
     1755    14391
     1756    14392    2       IF BAD_ADDRESS$->CV.L = 0 THEN

  14392 14 007056   002457 470400 1                  LDP0    BAD_ADDRESS$
        14 007057   000000 235100                    LDA     0,,PR0
        14 007060   007065 601000 14                 TNZ     s:14395

     1757    14393    2           CMDBUF = '-- Unable to deliver mail for the following reason:';

  14393 14 007061   040000 100400                    MLR     fill='040'O
        14 007062   003044 000063 1                  ADSC9   TCM_XLATE_TO_UC+239      cn=0,n=51
        14 007063   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255
        14 007064   007154 710000 14                 TRA     s:14409

     1758    14394    3       ELSE DO;

     1759    14395    3           CALL CONCAT( CMDBUF, '-- Unable to deliver mail to "',

  14395 14 007065   000000 720100                    LXL0    0,,PR0
        14 007066   040000 100400                    MLR     fill='040'O
        14 007067   003061 000036 1                  ADSC9   TCM_XLATE_TO_UC+252      cn=0,n=30
        14 007070   002107 000036 6                  ADSC9   CMDBUF                   cn=0,n=30
        14 007071   040000 100540                    MLR     fill='040'O
        14 007072   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 007073   002116 400341 6                  ADSC9   CMDBUF+7                 cn=2,n=225
        14 007074   000000 636010                    EAQ     0,X0
        14 007075   000022 772000                    QRL     18
        14 007076   000341 116007                    CMPQ    225,DL
        14 007077   007110 603000 14                 TRC     DEBLANK
        14 007100   222722 740100                    STX0    @VLEN+2,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:296  
        14 007101   777436 620010                    EAX0    -226,X0
        14 007102   777777 660003                    ERX0    -1,DU
        14 007103   222722 235100                    LDA     @VLEN+2,,AUTO
        14 007104   000022 771000                    ARL     18
        14 007105   040045 100400                    MLR     fill='040'O
        14 007106   000124 000001 15                 ADSC9   84                       cn=0,n=1
        14 007107   002116 400010 6                  ADSC9   CMDBUF+7,A               cn=2,n=*X0

     1760    14396    3                   BAD_ADDRESS$->CV.T, '"');
     1761    14397    3   DEBLANK:
     1762    14398    4           DO WHILE '1'B;

  14398 14 007110                       DEBLANK      null
     1763    14399    4               CALL INDEX( TVAL, '  ', CMDBUF) ALTRET( DEBLANKED);

  14399 14 007110   000000 120400                    SCD
        14 007111   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255
        14 007112   002713 000002 1                  ADSC9   TCM_XLATE_TO_UC+150      cn=0,n=2
        14 007113   222707 000100                    ARG     TVAL,,AUTO
        14 007114   007117 607000 14                 TTF     s:14400
        14 007115   222707 054100                    AOS     TVAL,,AUTO
        14 007116   007147 710000 14                 TRA     DEBLANKED

     1764    14400    4               IF SUBSTR( CMDBUF, TVAL) = ' ' THEN

  14400 14 007117   222707 720100                    LXL0    TVAL,,AUTO
        14 007120   777400 620010                    EAX0    -256,X0
        14 007121   777777 660003                    ERX0    -1,DU
        14 007122   222707 235100                    LDA     TVAL,,AUTO
        14 007123   040000 106445                    CMPC    fill='040'O
        14 007124   002107 000010 6                  ADSC9   CMDBUF,A                 cn=0,n=*X0
        14 007125   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 007126   007147 600000 14                 TZE     DEBLANKED

     1765    14401    4                   EXIT DEBLANK;
     1766    14402    4              CALL CONCAT( TSTRING, SUBSTR( CMDBUF, 0, TVAL), SUBSTR( CMDBUF, TVAL + 1
             14402                        ));
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:297  

  14402 14 007127   000000 621005                    EAX1    0,AL
        14 007130   040100 100440                    MLR     fill='040'O
        14 007131   002107 000011 6                  ADSC9   CMDBUF                   cn=0,n=*X1
        14 007132   222607 000377                    ADSC9   TSTRING,,AUTO            cn=0,n=255
        14 007133   222707 236100                    LDQ     TVAL,,AUTO
        14 007134   000377 116007                    CMPQ    255,DL
        14 007135   007143 603000 14                 TRC     s:14403
        14 007136   777401 621006                    EAX1    -255,QL
        14 007137   777777 661003                    ERX1    -1,DU
        14 007140   040146 100446                    MLR     fill='040'O
        14 007141   002107 200011 6                  ADSC9   CMDBUF,Q                 cn=1,n=*X1
        14 007142   222607 000010                    ADSC9   TSTRING,Q,AUTO           cn=0,n=*X0

     1767    14403    4               CMDBUF = TSTRING;

  14403 14 007143   040000 100500                    MLR     fill='040'O
        14 007144   222607 000377                    ADSC9   TSTRING,,AUTO            cn=0,n=255
        14 007145   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     1768    14404    4               END DEBLANK;

  14404 14 007146   007110 710000 14                 TRA     DEBLANK

     1769    14405    3   DEBLANKED:
     1770    14406    3           CALL SEND_SMTP_DATA;

  14406 14 007147   007420 701000 14    DEBLANKED    TSX1    SEND_SMTP_DATA
        14 007150   000000 011000                    NOP     0

     1771    14407    3           CMDBUF = '-- for the following reason:';

  14407 14 007151   040000 100400                    MLR     fill='040'O
        14 007152   003071 000034 1                  ADSC9   TCM_XLATE_TO_UC+260      cn=0,n=28
        14 007153   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     1772    14408    3           END;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:298  

     1773    14409    2       CALL SEND_SMTP_DATA;

  14409 14 007154   007420 701000 14                 TSX1    SEND_SMTP_DATA
        14 007155   000000 011000                    NOP     0

     1774    14410    2       GET_MAIL_ERROR_CODE.CODE_ = VECTOR( VM_HEADER.ERROR);

  14410 14 007156   777640 235007                    LDA     -96,DL
        14 007157   222345 236100                    LDQ     HEADER$,,AUTO
        14 007160   000014 036003                    ADLQ    12,DU
        14 007161   000600 757000 6                  STAQ    GET_MAIL_ERROR_CODE+2

     1775    14411    2       CALL M$ERRMSG( GET_MAIL_ERROR_CODE);

  14411 14 007162   000576 630400 6                  EPPR0   GET_MAIL_ERROR_CODE
        14 007163   020000 713400                    CLIMB   8192
        14 007164   405000 401760                    pmme    nvectors=11

     1776    14412    3       DO TVAL = 0 TO VLR_ERRMSG.RECCNT - 1;

  14412 14 007165   222707 450100                    STZ     TVAL,,AUTO
        14 007166   007201 710000 14                 TRA     s:14415+3

     1777    14413    3           CMDBUF = MAIL_ERROR_CODE( TVAL);

  14413 14 007167   222707 236100                    LDQ     TVAL,,AUTO
        14 007170   000170 402007                    MPY     120,DL
        14 007171   040000 100406                    MLR     fill='040'O
        14 007172   001332 000170 6                  ADSC9   MAIL_ERROR_CODE,Q        cn=0,n=120
        14 007173   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     1778    14414    3           CALL SEND_SMTP_DATA;

  14414 14 007174   007420 701000 14                 TSX1    SEND_SMTP_DATA
        14 007175   000000 011000                    NOP     0

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:299  
     1779    14415    3           END;

  14415 14 007176   222707 235100                    LDA     TVAL,,AUTO
        14 007177   000001 035007                    ADLA    1,DL
        14 007200   222707 755100                    STA     TVAL,,AUTO
        14 007201   000630 236000 6                  LDQ     VLR_ERRMSG
        14 007202   000777 376007                    ANQ     511,DL
        14 007203   222707 116100                    CMPQ    TVAL,,AUTO
        14 007204   007206 600000 14                 TZE     s:14416
        14 007205   007167 603000 14                 TRC     s:14413

     1780    14416    3       IF VM_HEADER.NUM_RECORDS > 0 THEN DO;

  14416 14 007206   222345 470500                    LDP0    HEADER$,,AUTO
        14 007207   000011 235100                    LDA     9,,PR0
        14 007210   007241 600000 14                 TZE     s:14427

     1781    14417    3           CMDBUF = ' ';

  14417 14 007211   040000 100400                    MLR     fill='040'O
        14 007212   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 007213   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     1782    14418    3           CALL SEND_SMTP_DATA;

  14418 14 007214   007420 701000 14                 TSX1    SEND_SMTP_DATA
        14 007215   000000 011000                    NOP     0

     1783    14419    3           CMDBUF = '-- Text of undelivered message follows:';

  14419 14 007216   040000 100400                    MLR     fill='040'O
        14 007217   003100 000047 1                  ADSC9   TCM_XLATE_TO_UC+267      cn=0,n=39
        14 007220   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     1784    14420    3           CALL SEND_SMTP_DATA;

  14420 14 007221   007420 701000 14                 TSX1    SEND_SMTP_DATA
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:300  
        14 007222   000000 011000                    NOP     0

     1785    14421    3           IF VM_HEADER.NUM_TRACE_RECORDS > 0 THEN

  14421 14 007223   222345 470500                    LDP0    HEADER$,,AUTO
        14 007224   000034 235100                    LDA     28,,PR0
        14 007225   007230 600000 14                 TZE     s:14423

     1786    14422    3               CALL EMIT_TRACE_RECORDS;

  14422 14 007226   006633 701000 14                 TSX1    EMIT_TRACE_RECORDS
        14 007227   000000 011000                    NOP     0

     1787    14423    3           CMDBUF = ' ';

  14423 14 007230   040000 100400                    MLR     fill='040'O
        14 007231   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 007232   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     1788    14424    3           CALL SEND_SMTP_DATA;

  14424 14 007233   007420 701000 14                 TSX1    SEND_SMTP_DATA
        14 007234   000000 011000                    NOP     0

     1789    14425    3           CALL SEND_MESSAGE_BODY;

  14425 14 007235   000001 236000 xsym               LDQ     B_VECTNIL+1
        14 007236   222711 756100                    STQ     EMITTING,,AUTO
        14 007237   006445 701000 14                 TSX1    SEND_MESSAGE_BODY
        14 007240   000000 011000                    NOP     0

     1790    14426    3           END;

     1791    14427    2       RETURN;

  14427 14 007241   222606 221300                    LDX1  ! LEN_TARGET+1,,AUTO
        14 007242   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:301  

     1792    14428
     1793    14429    2       END SEND_ERROR_REPORT;
     1794    14430        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:302  
     1795    14431    1   SEND_SMTP_COMMAND: PROC( REPLY_CODE) ALTRET;

  14431 14 007243   222606 741300       SEND_SMTP_C* STX1  ! LEN_TARGET+1,,AUTO

     1796    14432
     1797    14433    2       DCL ALTRETURNED BIT(1);
     1798    14434    2       DCL MSGBUF CHAR( %LINE_SIZE);
     1799    14435    2       DCL REPLY_CODE CHAR(1);
     1800    14436    2       DCL RETRIES UBIN;
     1801    14437
     1802    14438            /****** Find command size, save command text ******/
     1803    14439    2       MSGBUF = CMDBUF;

  14439 14 007244   040100 100400                    MLR     fill='040'O
        14 007245   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255
        14 007246   222611 000377                    ADSC9   MSGBUF,,AUTO             cn=0,n=255

     1804    14440    2       CALL GET_IOBUF_BOUND( CMDBUF, VLEN);

  14440 14 007247   200104 630500                    EPPR0   VLEN,,AUTO
        14 007250   222720 450500                    STP0    @BUF+1,,AUTO
        14 007251   000125 236000 15                 LDQ     85
        14 007252   222717 756100                    STQ     @MSG+2,,AUTO
        14 007253   013576 701000 14                 TSX1    GET_IOBUF_BOUND
        14 007254   000000 011000                    NOP     0

     1805    14441            /****** Loop. Send command up to 3 times, awaiting successful reply *****/
     1806    14442    3       DO RETRIES = 1 TO 3;

  14442 14 007255   000001 235007                    LDA     1,DL
        14 007256   222711 755100                    STA     RETRIES,,AUTO

     1807    14443                /****** WRITE COMMAND AND READ REPLY ******/
     1808    14444    3           IF NOT TCP_FLAVOR THEN

  14444 14 007257   001223 234000 6                  SZN     TCP_FLAVOR
        14 007260   007264 604000 14                 TMI     s:14446
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:303  

     1809    14445    3               CALL M$WAIT( WAIT_A_SECOND);

  14445 14 007261   001642 630400 1                  EPPR0   WAIT_A_SECOND
        14 007262   020006 713400                    CLIMB   8198
        14 007263   400400 401760                    pmme    nvectors=2

     1810    14446    3           REPLYLEN = 0;

  14446 14 007264   002207 450000 6                  STZ     REPLYLEN

     1811    14447    3           ALTRETURNED = %NO#;

  14447 14 007265   222610 450100                    STZ     ALTRETURNED,,AUTO

     1812    14448    3           CMDBUF = MSGBUF;

  14448 14 007266   040000 100500                    MLR     fill='040'O
        14 007267   222611 000377                    ADSC9   MSGBUF,,AUTO             cn=0,n=255
        14 007270   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     1813    14449    3           WRITE_ME.BUF_.BOUND = VLEN;

  14449 14 007271   200104 236100                    LDQ     VLEN,,AUTO
        14 007272   000020 736000                    QLS     16
        14 007273   000242 676000 6                  ERQ     WRITE_ME+4
        14 007274   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 007275   000242 656000 6                  ERSQ    WRITE_ME+4

     1814    14450    3           CALL M$WRITE( WRITE_ME);

  14450 14 007276   000236 630400 6                  EPPR0   WRITE_ME
        14 007277   040001 713400                    CLIMB   write
        14 007300   401400 401760                    pmme    nvectors=4

     1815    14451    4           DO UNTIL REPLYLEN > 0 OR ALTRETURNED;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:304  
     1816    14452    5               IF TCM_TESTMODE THEN DO;

  14452 14 007301   001171 234000 6                  SZN     TCM_TESTMODE
        14 007302   007315 605000 14                 TPL     s:14457

     1817    14453    5                   CALL M$READ( READ_UC);

  14453 14 007303   001310 630400 1                  EPPR0   READ_UC
        14 007304   040000 713400                    CLIMB   read
        14 007305   401400 401760                    pmme    nvectors=4

     1818    14454    5                   REPLYLEN = DCBADDR( DCBNUM( M$UC))->F$DCB.ARS#;

  14454 14 007306   000000 236007 xsym               LDQ     M$UC,DL
        14 007307   000000 470400 15                 LDP0    0
        14 007310   000000 471500                    LDP1    0,,PR0
        14 007311   100000 473506                    LDP3    0,QL,PR1
        14 007312   300000 235100                    LDA     0,,PR3
        14 007313   002207 755000 6                  STA     REPLYLEN

     1819    14455    5                   END;

  14455 14 007314   007350 710000 14                 TRA     s:14466

     1820    14456    5               ELSE DO;

     1821    14457    5                   CALL TCM$WRITE_SMTP( CMDBUF_, VLEN);

  14457 14 007315   200104 630500                    EPPR0   VLEN,,AUTO
        14 007316   222723 450500                    STP0    @VLEN+3,,AUTO
        14 007317   000044 236000 15                 LDQ     36
        14 007320   222722 756100                    STQ     @VLEN+2,,AUTO
        14 007321   222722 630500                    EPPR0   @VLEN+2,,AUTO
        14 007322   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 007323   000000 701000 xent               TSX1    TCM$WRITE_SMTP
        14 007324   000000 011000                    NOP     0

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:305  
     1822    14458    5                   CALL TCM$READ_SMTP( CMDBUF_, REPLYLEN)

  14458 14 007325   000044 630400 15                 EPPR0   36
        14 007326   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 007327   000000 701000 xent               TSX1    TCM$READ_SMTP
        14 007330   007332 702000 14                 TSX2    s:14460
        14 007331   007334 710000 14                 TRA     s:14462

     1823    14459    6                   WHENALTRETURN DO;

     1824    14460    6                       ALTRETURNED = '1'B;

  14460 14 007332   400000 236003                    LDQ     -131072,DU
        14 007333   222610 756100                    STQ     ALTRETURNED,,AUTO

     1825    14461    6                       END;

     1826    14462    5                   REPLYLEN = REPLYLEN + 1;

  14462 14 007334   002207 235000 6                  LDA     REPLYLEN
        14 007335   000001 035007                    ADLA    1,DL
        14 007336   002207 755000 6                  STA     REPLYLEN

     1827    14463    5                   WRITE_ME.BUF_.BOUND = REPLYLEN - 1;

  14463 14 007337   002207 236000 6                  LDQ     REPLYLEN
        14 007340   000001 136007                    SBLQ    1,DL
        14 007341   000020 736000                    QLS     16
        14 007342   000242 676000 6                  ERQ     WRITE_ME+4
        14 007343   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 007344   000242 656000 6                  ERSQ    WRITE_ME+4

     1828    14464    5                   CALL M$WRITE( WRITE_ME);

  14464 14 007345   000236 630400 6                  EPPR0   WRITE_ME
        14 007346   040001 713400                    CLIMB   write
        14 007347   401400 401760                    pmme    nvectors=4
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:306  

     1829    14465    5                   END;

     1830    14466    4               END;

  14466 14 007350   002207 235000 6                  LDA     REPLYLEN
        14 007351   007354 601000 14                 TNZ     s:14467
        14 007352   222610 234100                    SZN     ALTRETURNED,,AUTO
        14 007353   007301 605000 14                 TPL     s:14452

     1831    14467    3           IF ALTRETURNED THEN

  14467 14 007354   222610 234100                    SZN     ALTRETURNED,,AUTO
        14 007355   007361 605000 14                 TPL     s:14470

     1832    14468    3               UNWIND TO TCM_SMTP_BAILOUT;

  14468 14 007356   001124 237200 6                  LDAQ  ! TCM_SMTP_BAILOUT
        14 007357   000000 700200 xent               TSX0  ! X66_MAUNWIND
        14 007360   000000 000200                    ZERO    0,128

     1833    14469                /****** RETURN IF PROPER REPLY CODE, ELSE TRY AGAIN ******/
     1834    14470    3           IF SUBSTR( CMDBUF, 0, 1) = REPLY_CODE THEN

  14470 14 007361   222607 470500                    LDP0    @REPLY_CODE,,AUTO
        14 007362   040100 106400                    CMPC    fill='040'O
        14 007363   002107 000001 6                  ADSC9   CMDBUF                   cn=0,n=1
        14 007364   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        14 007365   007370 601000 14                 TNZ     s:14472

     1835    14471    3               RETURN;

  14471 14 007366   222606 221300                    LDX1  ! LEN_TARGET+1,,AUTO
        14 007367   000001 702211                    TSX2  ! 1,X1

     1836    14472    3           IF NOT TCP_FLAVOR THEN

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:307  
  14472 14 007370   001223 234000 6                  SZN     TCP_FLAVOR
        14 007371   007375 604000 14                 TMI     s:14474

     1837    14473    3               CALL M$WAIT( WAIT_A_SECOND);

  14473 14 007372   001642 630400 1                  EPPR0   WAIT_A_SECOND
        14 007373   020006 713400                    CLIMB   8198
        14 007374   400400 401760                    pmme    nvectors=2

     1838    14474    3           END;

  14474 14 007375   222711 235100                    LDA     RETRIES,,AUTO
        14 007376   000001 035007                    ADLA    1,DL
        14 007377   222711 755100                    STA     RETRIES,,AUTO
        14 007400   000004 115007                    CMPA    4,DL
        14 007401   007257 602000 14                 TNC     s:14444

     1839    14475            /* Check to see if the response we received was plausibly SMTP-ish (i.e.,
     1840    14476               the first character is a digit).  If not, we may no longer be talking
     1841    14477               with the SMTP receiver at the other end, so let's just shut down the
     1842    14478               link and try again later.                                        */
     1843    14479    2       IF SUBSTR( CMDBUF, 0, 1) < '1' OR SUBSTR( CMDBUF, 0, 1) > '5' THEN

  14479 14 007402   002107 236000 6                  LDQ     CMDBUF
        14 007403   777000 376003                    ANQ     -512,DU
        14 007404   061000 116003                    CMPQ    25088,DU
        14 007405   007413 602000 14                 TNC     s:14480
        14 007406   002107 236000 6                  LDQ     CMDBUF
        14 007407   777000 376003                    ANQ     -512,DU
        14 007410   065000 116003                    CMPQ    27136,DU
        14 007411   007416 602000 14                 TNC     s:14481
        14 007412   007416 600000 14                 TZE     s:14481

     1844    14480    2           UNWIND TO TCM_SMTP_BAILOUT;

  14480 14 007413   001124 237200 6                  LDAQ  ! TCM_SMTP_BAILOUT
        14 007414   000000 700200 xent               TSX0  ! X66_MAUNWIND
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:308  
        14 007415   000000 000200                    ZERO    0,128

     1845    14481    2       ALTRETURN;

  14481 14 007416   222606 221300                    LDX1  ! LEN_TARGET+1,,AUTO
        14 007417   000000 702211                    TSX2  ! 0,X1

     1846    14482
     1847    14483    2       END SEND_SMTP_COMMAND;
     1848    14484        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:309  
     1849    14485    1   SEND_SMTP_DATA: PROC;

  14485 14 007420   222714 741300       SEND_SMTP_D* STX1  ! LAST+1,,AUTO

     1850    14486
     1851    14487    2       DCL CPS UBIN;
     1852    14488
     1853    14489    2       CALL GET_IOBUF_BOUND( CMDBUF, VLEN);

  14489 14 007421   200104 630500                    EPPR0   VLEN,,AUTO
        14 007422   222720 450500                    STP0    @BUF+1,,AUTO
        14 007423   000125 236000 15                 LDQ     85
        14 007424   222717 756100                    STQ     @MSG+2,,AUTO
        14 007425   013576 701000 14                 TSX1    GET_IOBUF_BOUND
        14 007426   000000 011000                    NOP     0

     1854    14490            /****** SUPRESS TRAILING BLANKS IN MESSAGE ******/
     1855    14491    2       IF VLEN = 0 AND ' ' = SUBSTR( CMDBUF, , 1) THEN

  14491 14 007427   200104 235100                    LDA     VLEN,,AUTO
        14 007430   007441 601000 14                 TNZ     s:14495
        14 007431   002107 236000 6                  LDQ     CMDBUF
        14 007432   777000 376003                    ANQ     -512,DU
        14 007433   040000 116003                    CMPQ    16384,DU
        14 007434   007441 601000 14                 TNZ     s:14495

     1856    14492    2           BLANK_COUNT = BLANK_COUNT + 1;

  14492 14 007435   002310 236000 6                  LDQ     BLANK_COUNT
        14 007436   000001 036007                    ADLQ    1,DL
        14 007437   002310 756000 6                  STQ     BLANK_COUNT
        14 007440   007523 710000 14                 TRA     s:14521

     1857    14493    3       ELSE DO;

     1858    14494                /****** WRITE ANY PENDING BLANK LINES ******/
     1859    14495    4           DO WHILE BLANK_COUNT > 0;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:310  

  14495 14 007441   002310 236000 6                  LDQ     BLANK_COUNT
        14 007442   007466 600000 14                 TZE     s:14504

     1860    14496    4               CALL M$WRITE( WRITE_ME_BLANK);

  14496 14 007443   001342 630400 1                  EPPR0   WRITE_ME_BLANK
        14 007444   040001 713400                    CLIMB   write
        14 007445   401400 401760                    pmme    nvectors=4

     1861    14497    4               IF NOT TCM_TESTMODE THEN

  14497 14 007446   001171 234000 6                  SZN     TCM_TESTMODE
        14 007447   007454 604000 14                 TMI     s:14499

     1862    14498    4                   CALL TCM$WRITE_SMTP( TEMPBUF_, -1);

  14498 14 007450   000126 630400 15                 EPPR0   86
        14 007451   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 007452   000000 701000 xent               TSX1    TCM$WRITE_SMTP
        14 007453   000000 011000                    NOP     0

     1863    14499    4               BLANK_COUNT = BLANK_COUNT - 1;

  14499 14 007454   002310 235000 6                  LDA     BLANK_COUNT
        14 007455   000001 135007                    SBLA    1,DL
        14 007456   002310 755000 6                  STA     BLANK_COUNT

     1864    14500    4               IF NOT FLOW_CONTROL_ENABLED THEN

  14500 14 007457   200102 234100                    SZN     FLOW_CONTROL_ENABLED,,AUTO
        14 007460   007464 604000 14                 TMI     s:14502

     1865    14501    4                   CALL M$WAIT( WAIT_A_SECOND);

  14501 14 007461   001642 630400 1                  EPPR0   WAIT_A_SECOND
        14 007462   020006 713400                    CLIMB   8198
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:311  
        14 007463   400400 401760                    pmme    nvectors=2

     1866    14502    4               END;

  14502 14 007464   002310 235000 6                  LDA     BLANK_COUNT
        14 007465   007443 601000 14                 TNZ     s:14496

     1867    14503                /****** WRITE LINE TO SMTP ******/
     1868    14504    3           WRITE_ME.BUF_.BOUND = VLEN;

  14504 14 007466   200104 236100                    LDQ     VLEN,,AUTO
        14 007467   000020 736000                    QLS     16
        14 007470   000242 676000 6                  ERQ     WRITE_ME+4
        14 007471   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 007472   000242 656000 6                  ERSQ    WRITE_ME+4

     1869    14505    3           CALL M$WRITE( WRITE_ME);

  14505 14 007473   000236 630400 6                  EPPR0   WRITE_ME
        14 007474   040001 713400                    CLIMB   write
        14 007475   401400 401760                    pmme    nvectors=4

     1870    14506    3           IF NOT TCM_TESTMODE THEN

  14506 14 007476   001171 234000 6                  SZN     TCM_TESTMODE
        14 007477   007510 604000 14                 TMI     s:14516

     1871    14507    3               CALL TCM$WRITE_SMTP( CMDBUF_, VLEN);

  14507 14 007500   200104 630500                    EPPR0   VLEN,,AUTO
        14 007501   222723 450500                    STP0    @VLEN+3,,AUTO
        14 007502   000044 236000 15                 LDQ     36
        14 007503   222722 756100                    STQ     @VLEN+2,,AUTO
        14 007504   222722 630500                    EPPR0   @VLEN+2,,AUTO
        14 007505   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 007506   000000 701000 xent               TSX1    TCM$WRITE_SMTP
        14 007507   000000 011000                    NOP     0
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:312  

     1872    14508
     1873    14509        /*      IF FLOW_CONTROL_ENABLED THEN
     1874    14510                    CPS = 120;
     1875    14511                ELSE
     1876    14512                    CPS = 30;
     1877    14513                WAIT_A_WHILE.V.UNITS# = ( ( VLEN + ( CPS / 2)) / CPS) + 1;
     1878    14514                    CALL M$WAIT( WAIT_A_WHILE);
     1879    14515        */
     1880    14516    4           IF NOT FLOW_CONTROL_ENABLED THEN DO;

  14516 14 007510   200102 234100                    SZN     FLOW_CONTROL_ENABLED,,AUTO
        14 007511   007523 604000 14                 TMI     s:14521

     1881    14517    4               WAIT_A_WHILE.V.UNITS# = ( VLEN + 15) / 30 + 1;

  14517 14 007512   200104 236100                    LDQ     VLEN,,AUTO
        14 007513   000017 036007                    ADLQ    15,DL
        14 007514   000001 772000                    QRL     1
        14 007515   000017 506007                    DIV     15,DL
        14 007516   000001 036007                    ADLQ    1,DL
        14 007517   000256 756000 6                  STQ     WAIT_A_WHILE+4

     1882    14518    4               CALL M$WAIT( WAIT_A_WHILE);

  14518 14 007520   000252 630400 6                  EPPR0   WAIT_A_WHILE
        14 007521   020006 713400                    CLIMB   8198
        14 007522   400400 401760                    pmme    nvectors=2

     1883    14519    4               END;

     1884    14520    3           END;

     1885    14521    2       RETURN;

  14521 14 007523   222714 221300                    LDX1  ! LAST+1,,AUTO
        14 007524   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:313  

     1886    14522
     1887    14523    2   SEND_SMTP_NULL: ENTRY;

  14523 14 007525   222714 741300       SEND_SMTP_N* STX1  ! LAST+1,,AUTO

     1888    14524
     1889    14525    2       CALL M$WRITE( WRITE_ME_NULL);

  14525 14 007526   001326 630400 1                  EPPR0   WRITE_ME_NULL
        14 007527   040001 713400                    CLIMB   write
        14 007530   401400 401760                    pmme    nvectors=4

     1890    14526    3       IF NOT TCM_TESTMODE THEN DO;

  14526 14 007531   001171 234000 6                  SZN     TCM_TESTMODE
        14 007532   007546 604000 14                 TMI     s:14532

     1891    14527    3           IF TCP_FLAVOR THEN

  14527 14 007533   001223 234000 6                  SZN     TCP_FLAVOR
        14 007534   007542 605000 14                 TPL     s:14530

     1892    14528    3               CALL TCM$WRITE_SMTP( VECTOR( NIL), 0);

  14528 14 007535   000130 630400 15                 EPPR0   88
        14 007536   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 007537   000000 701000 xent               TSX1    TCM$WRITE_SMTP
        14 007540   000000 011000                    NOP     0
        14 007541   007546 710000 14                 TRA     s:14532

     1893    14529    3           ELSE
     1894    14530    3               CALL TCM$WRITE_SMTP( TEMPBUF_, -1);

  14530 14 007542   000126 630400 15                 EPPR0   86
        14 007543   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 007544   000000 701000 xent               TSX1    TCM$WRITE_SMTP
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:314  
        14 007545   000000 011000                    NOP     0

     1895    14531    3           END;

     1896    14532    2       RETURN;

  14532 14 007546   222714 221300                    LDX1  ! LAST+1,,AUTO
        14 007547   000001 702211                    TSX2  ! 1,X1

     1897    14533
     1898    14534    2       END SEND_SMTP_DATA;
     1899    14535        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:315  
     1900    14536    1   FIND_MAIL_HEADER: PROC ALTRET;

  14536 14 007550   222360 741300       FIND_MAIL_H* STX1  ! LEN,,AUTO

     1901    14537
     1902    14538    2       DCL HAVE_A_MESSAGE BIT(1);
     1903    14539
     1904    14540    2       CALL STATUS_UPDATE( SEARCHING);

  14540 14 007551   000132 236000 15                 LDQ     90
        14 007552   222715 756100                    STQ     LAST+2,,AUTO
        14 007553   013522 701000 14                 TSX1    STATUS_UPDATE
        14 007554   000000 011000                    NOP     0

     1905    14541    2       POSITION_FOLDER.KEY_ = VECTOR( VM_INFOKEY);

  14541 14 007555   000112 237000 15                 LDAQ    74
        14 007556   000110 757000 6                  STAQ    POSITION_FOLDER+2

     1906    14542    2       POSITION_FOLDER.V.KEYS# = %YES#;

  14542 14 007557   400000 236007                    LDQ     -131072,DL
        14 007560   000114 256000 6                  ORSQ    POSITION_FOLDER+6

     1907    14543    2       POSITION_FOLDER.V.KEYR# = %NO#;

  14543 14 007561   000115 236000 15                 LDQ     77
        14 007562   000114 356000 6                  ANSQ    POSITION_FOLDER+6

     1908    14544    2       IF MSG_NUMBER = 0 THEN

  14544 14 007563   222343 235100                    LDA     MSG_NUMBER,,AUTO
        14 007564   007567 601000 14                 TNZ     s:14547

     1909    14545    2           POSITION_FOLDER.V.N# = 0;

  14545 14 007565   000115 450000 6                  STZ     POSITION_FOLDER+7
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:316  
        14 007566   007571 710000 14                 TRA     s:14548

     1910    14546    2       ELSE
     1911    14547    2           POSITION_FOLDER.V.N# = 1;

  14547 14 007567   000001 235007                    LDA     1,DL
        14 007570   000115 755000 6                  STA     POSITION_FOLDER+7

     1912    14548    2       VM_INFOKEY.COUNT = LENGTHC( VM_INFOKEY) - 1;

  14548 14 007571   005000 236003                    LDQ     2560,DU
        14 007572   001032 552040 6                  STBQ    VM_INFOKEY,'40'O

     1913    14549    2       VM_INFOKEY.TYPE = %VM_TYPE_HEAD;

  14549 14 007573   000010 236003                    LDQ     8,DU
        14 007574   001032 552020 6                  STBQ    VM_INFOKEY,'20'O

     1914    14550    2       VM_INFOKEY.MESSAGE_NUMBER = MSG_NUMBER;

  14550 14 007575   000000 100500                    MLR     fill='000'O
        14 007576   222343 000004                    ADSC9   MSG_NUMBER,,AUTO         cn=0,n=4
        14 007577   001032 400004 6                  ADSC9   VM_INFOKEY               cn=2,n=4

     1915    14551    2       CALL M$PRECORD( POSITION_FOLDER)

  14551 14 007600   000106 630400 6                  EPPR0   POSITION_FOLDER
        14 007601   440003 713400                    CLIMB   alt,+16387
        14 007602   401000 401760                    pmme    nvectors=3
        14 007603   007605 702000 14                 TSX2    s:14554
        14 007604   007605 710000 14                 TRA     s:14554

     1916    14552    3       WHENALTRETURN DO;

     1917    14553    3           END;

     1918    14554    2       READ_FOLDER.BUF_ = VECTOR( VM_HEADER);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:317  

  14554 14 007605   000133 235000 15                 LDA     91
        14 007606   222345 236100                    LDQ     HEADER$,,AUTO
        14 007607   000124 757000 6                  STAQ    READ_FOLDER+4

     1919    14555    2       READ_FOLDER.BUF_.BOUND = 4095;

  14555 14 007610   000124 236000 6                  LDQ     READ_FOLDER+4
        14 007611   177777 376007                    ANQ     65535,DL
        14 007612   000121 276000 15                 ORQ     81
        14 007613   000124 756000 6                  STQ     READ_FOLDER+4

     1920    14556    2       READ_FOLDER.KEY_ = VECTOR( VM_INFOKEY);

  14556 14 007614   000112 237000 15                 LDAQ    74
        14 007615   000122 757000 6                  STAQ    READ_FOLDER+2

     1921    14557    2       READ_FOLDER.V.KEYS# = %NO#;

  14557 14 007616   000115 236000 15                 LDQ     77
        14 007617   000130 356000 6                  ANSQ    READ_FOLDER+8

     1922    14558    2       READ_FOLDER.V.KEYR# = %YES#;

  14558 14 007620   100000 236007                    LDQ     32768,DL
        14 007621   000130 256000 6                  ORSQ    READ_FOLDER+8

     1923    14559    2       HAVE_A_MESSAGE = %NO#;

  14559 14 007622   222361 450100                    STZ     HAVE_A_MESSAGE,,AUTO

     1924    14560    3       DO UNTIL( HAVE_A_MESSAGE);

     1925    14561    3           CALL M$READ( READ_FOLDER)

  14561 14 007623   000120 630400 6                  EPPR0   READ_FOLDER
        14 007624   440000 713400                    CLIMB   alt,read
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:318  
        14 007625   401400 401760                    pmme    nvectors=4
        14 007626   007630 702000 14                 TSX2    s:14563
        14 007627   007632 710000 14                 TRA     s:14565

     1926    14562    4           WHENALTRETURN DO;

     1927    14563    4               ALTRETURN;

  14563 14 007630   222360 221300                    LDX1  ! LEN,,AUTO
        14 007631   000000 702211                    TSX2  ! 0,X1

     1928    14564    4               END;
     1929    14565    3           HEADER_ARS = M$FOLDER$->F$DCB.ARS#;

  14565 14 007632   200077 470500                    LDP0    M$FOLDER$,,AUTO
        14 007633   000000 235100                    LDA     0,,PR0
        14 007634   200115 755100                    STA     HEADER_ARS,,AUTO

     1930    14566    3           IF VM_INFOKEY.COUNT = 0 /* hit EOF */ OR

  14566 14 007635   001032 236000 6                  LDQ     VM_INFOKEY
        14 007636   777000 316003                    CANQ    -512,DU
        14 007637   007644 600000 14                 TZE     s:14568
        14 007640   001032 236000 6                  LDQ     VM_INFOKEY
        14 007641   000777 376003                    ANQ     511,DU
        14 007642   000010 116003                    CMPQ    8,DU
        14 007643   007646 600000 14                 TZE     s:14569

     1931    14567    3                   VM_INFOKEY.TYPE ~= %VM_TYPE_HEAD /* other than header */ THEN
     1932    14568    3               ALTRETURN;

  14568 14 007644   222360 221300                    LDX1  ! LEN,,AUTO
        14 007645   000000 702211                    TSX2  ! 0,X1

     1933    14569    3           IF NOT VM_HEADER.STATUS.DEL AND NOT VM_HEADER.STATUS.MARK AND

  14569 14 007646   222345 471500                    LDP1    HEADER$,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:319  
        14 007647   100012 236100                    LDQ     10,,PR1
        14 007650   000400 316003                    CANQ    256,DU
        14 007651   007713 601000 14                 TNZ     s:14585
        14 007652   000100 316003                    CANQ    64,DU
        14 007653   007713 601000 14                 TNZ     s:14585
        14 007654   200141 234100                    SZN     MESSAGE_FILE,,AUTO
        14 007655   007660 604000 14                 TMI     s:14571
        14 007656   000200 316003                    CANQ    128,DU
        14 007657   007713 601000 14                 TNZ     s:14585

     1934    14570    4                   ( MESSAGE_FILE OR NOT VM_HEADER.STATUS.FCOPY) THEN DO;

     1935    14571    4               VM_HEADRES.RES# = VM_INFOKEY.MESSAGE_NUMBER;

  14571 14 007660   000000 100400                    MLR     fill='000'O
        14 007661   001032 400004 6                  ADSC9   VM_INFOKEY               cn=2,n=4
        14 007662   001121 200004 6                  ADSC9   VM_HEADRES               cn=1,n=4

     1936    14572    4               CALL M$ENQ( ENQ_ON_HEADER)

  14572 14 007663   000574 630400 1                  EPPR0   ENQ_ON_HEADER
        14 007664   420002 713400                    CLIMB   alt,+8194
        14 007665   401000 401760                    pmme    nvectors=3
        14 007666   007670 702000 14                 TSX2    s:14574
        14 007667   007672 710000 14                 TRA     s:14576

     1937    14573    5               WHENALTRETURN DO; /* Still being delivered */

     1938    14574    5                   ALTRETURN;

  14574 14 007670   222360 221300                    LDX1  ! LEN,,AUTO
        14 007671   000000 702211                    TSX2  ! 0,X1

     1939    14575    5                   END;
     1940    14576    4               HAVE_A_MESSAGE = %YES#;

  14576 14 007672   400000 236003                    LDQ     -131072,DU
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:320  
        14 007673   222361 756100                    STQ     HAVE_A_MESSAGE,,AUTO

     1941    14577        /* Now get the real site record */
     1942    14578    4               READ_SITE.V.DCB# = DCBNUM( M$FOLDER);

  14578 14 007674   000000 236007 xsym               LDQ     M$FOLDER,DL
        14 007675   000000 620006                    EAX0    0,QL
        14 007676   000644 740000 6                  STX0    READ_SITE+8

     1943    14579    4               READ_SITE.BUF_ = VECTOR(VM_SITE);

  14579 14 007677   000134 235000 15                 LDA     92
        14 007700   222722 452500                    STP2    @VLEN+2,,AUTO
        14 007701   222722 236100                    LDQ     @VLEN+2,,AUTO
        14 007702   000003 036003                    ADLQ    3,DU
        14 007703   000640 757000 6                  STAQ    READ_SITE+4

     1944    14580    4               CALL M$READ (READ_SITE)

  14580 14 007704   000634 630400 6                  EPPR0   READ_SITE
        14 007705   440000 713400                    CLIMB   alt,read
        14 007706   401400 401760                    pmme    nvectors=4
        14 007707   007711 702000 14                 TSX2    s:14582
        14 007710   007713 710000 14                 TRA     s:14585

     1945    14581    5               WHENALTRETURN DO;

     1946    14582    5                   ALTRETURN;

  14582 14 007711   222360 221300                    LDX1  ! LEN,,AUTO
        14 007712   000000 702211                    TSX2  ! 0,X1

     1947    14583    5                   END;
     1948    14584    4               END;

     1949    14585    3            END;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:321  
  14585 14 007713   222361 234100                    SZN     HAVE_A_MESSAGE,,AUTO
        14 007714   007623 605000 14                 TPL     s:14561

     1950    14586    2       MSG_NUMBER = VM_INFOKEY.MESSAGE_NUMBER;

  14586 14 007715   001032 235000 6                  LDA     VM_INFOKEY
        14 007716   001033 236000 6                  LDQ     VM_INFOKEY+1
        14 007717   000022 773000                    LRL     18
        14 007720   222343 756100                    STQ     MSG_NUMBER,,AUTO

     1951    14587    2       MSG_TSTAMP = VM_HEADER.CREATION_DATE;

  14587 14 007721   222345 470500                    LDP0    HEADER$,,AUTO
        14 007722   000001 235100                    LDA     1,,PR0
        14 007723   003430 755000 6                  STA     MSG_TSTAMP

     1952    14588    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.BAD_ADDRESS$);

  14588 14 007724   222345 236100                    LDQ     HEADER$,,AUTO
        14 007725   000017 036003                    ADLQ    15,DU
        14 007726   222476 756100                    STQ     @CP6$+1,,AUTO
        14 007727   222345 236100                    LDQ     HEADER$,,AUTO
        14 007730   222475 756100                    STQ     TVAL+3,,AUTO
        14 007731   010061 701000 14                 TSX1    ADJUST_POINTER
        14 007732   000000 011000                    NOP     0

     1953    14589    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.BLIND$);

  14589 14 007733   222345 236100                    LDQ     HEADER$,,AUTO
        14 007734   000020 036003                    ADLQ    16,DU
        14 007735   222476 756100                    STQ     @CP6$+1,,AUTO
        14 007736   222345 236100                    LDQ     HEADER$,,AUTO
        14 007737   222475 756100                    STQ     TVAL+3,,AUTO
        14 007740   010061 701000 14                 TSX1    ADJUST_POINTER
        14 007741   000000 011000                    NOP     0

     1954    14590    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.COPY$);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:322  

  14590 14 007742   222345 236100                    LDQ     HEADER$,,AUTO
        14 007743   000021 036003                    ADLQ    17,DU
        14 007744   222476 756100                    STQ     @CP6$+1,,AUTO
        14 007745   222345 236100                    LDQ     HEADER$,,AUTO
        14 007746   222475 756100                    STQ     TVAL+3,,AUTO
        14 007747   010061 701000 14                 TSX1    ADJUST_POINTER
        14 007750   000000 011000                    NOP     0

     1955    14591    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.FILE_FOLDER$);

  14591 14 007751   222345 236100                    LDQ     HEADER$,,AUTO
        14 007752   000022 036003                    ADLQ    18,DU
        14 007753   222476 756100                    STQ     @CP6$+1,,AUTO
        14 007754   222345 236100                    LDQ     HEADER$,,AUTO
        14 007755   222475 756100                    STQ     TVAL+3,,AUTO
        14 007756   010061 701000 14                 TSX1    ADJUST_POINTER
        14 007757   000000 011000                    NOP     0

     1956    14592    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.FROM$);

  14592 14 007760   222345 236100                    LDQ     HEADER$,,AUTO
        14 007761   000023 036003                    ADLQ    19,DU
        14 007762   222476 756100                    STQ     @CP6$+1,,AUTO
        14 007763   222345 236100                    LDQ     HEADER$,,AUTO
        14 007764   222475 756100                    STQ     TVAL+3,,AUTO
        14 007765   010061 701000 14                 TSX1    ADJUST_POINTER
        14 007766   000000 011000                    NOP     0

     1957    14593    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.REFERENCE$);

  14593 14 007767   222345 236100                    LDQ     HEADER$,,AUTO
        14 007770   000024 036003                    ADLQ    20,DU
        14 007771   222476 756100                    STQ     @CP6$+1,,AUTO
        14 007772   222345 236100                    LDQ     HEADER$,,AUTO
        14 007773   222475 756100                    STQ     TVAL+3,,AUTO
        14 007774   010061 701000 14                 TSX1    ADJUST_POINTER
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:323  
        14 007775   000000 011000                    NOP     0

     1958    14594    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.REPLY_TO$);

  14594 14 007776   222345 236100                    LDQ     HEADER$,,AUTO
        14 007777   000025 036003                    ADLQ    21,DU
        14 010000   222476 756100                    STQ     @CP6$+1,,AUTO
        14 010001   222345 236100                    LDQ     HEADER$,,AUTO
        14 010002   222475 756100                    STQ     TVAL+3,,AUTO
        14 010003   010061 701000 14                 TSX1    ADJUST_POINTER
        14 010004   000000 011000                    NOP     0

     1959    14595    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.RETURN_ADDRESS$);

  14595 14 010005   222345 236100                    LDQ     HEADER$,,AUTO
        14 010006   000026 036003                    ADLQ    22,DU
        14 010007   222476 756100                    STQ     @CP6$+1,,AUTO
        14 010010   222345 236100                    LDQ     HEADER$,,AUTO
        14 010011   222475 756100                    STQ     TVAL+3,,AUTO
        14 010012   010061 701000 14                 TSX1    ADJUST_POINTER
        14 010013   000000 011000                    NOP     0

     1960    14596    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.SIGNED$);

  14596 14 010014   222345 236100                    LDQ     HEADER$,,AUTO
        14 010015   000027 036003                    ADLQ    23,DU
        14 010016   222476 756100                    STQ     @CP6$+1,,AUTO
        14 010017   222345 236100                    LDQ     HEADER$,,AUTO
        14 010020   222475 756100                    STQ     TVAL+3,,AUTO
        14 010021   010061 701000 14                 TSX1    ADJUST_POINTER
        14 010022   000000 011000                    NOP     0

     1961    14597    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.SUBJECT$);

  14597 14 010023   222345 236100                    LDQ     HEADER$,,AUTO
        14 010024   000030 036003                    ADLQ    24,DU
        14 010025   222476 756100                    STQ     @CP6$+1,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:324  
        14 010026   222345 236100                    LDQ     HEADER$,,AUTO
        14 010027   222475 756100                    STQ     TVAL+3,,AUTO
        14 010030   010061 701000 14                 TSX1    ADJUST_POINTER
        14 010031   000000 011000                    NOP     0

     1962    14598    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.TO$);

  14598 14 010032   222345 236100                    LDQ     HEADER$,,AUTO
        14 010033   000031 036003                    ADLQ    25,DU
        14 010034   222476 756100                    STQ     @CP6$+1,,AUTO
        14 010035   222345 236100                    LDQ     HEADER$,,AUTO
        14 010036   222475 756100                    STQ     TVAL+3,,AUTO
        14 010037   010061 701000 14                 TSX1    ADJUST_POINTER
        14 010040   000000 011000                    NOP     0

     1963    14599    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.REFERS_TO_ID$);

  14599 14 010041   222345 236100                    LDQ     HEADER$,,AUTO
        14 010042   000033 036003                    ADLQ    27,DU
        14 010043   222476 756100                    STQ     @CP6$+1,,AUTO
        14 010044   222345 236100                    LDQ     HEADER$,,AUTO
        14 010045   222475 756100                    STQ     TVAL+3,,AUTO
        14 010046   010061 701000 14                 TSX1    ADJUST_POINTER
        14 010047   000000 011000                    NOP     0

     1964    14600    2       CALL ADJUST_POINTER( VM_HEADER, VM_HEADER.UNIQUE_ID$);

  14600 14 010050   222345 236100                    LDQ     HEADER$,,AUTO
        14 010051   000032 036003                    ADLQ    26,DU
        14 010052   222476 756100                    STQ     @CP6$+1,,AUTO
        14 010053   222345 236100                    LDQ     HEADER$,,AUTO
        14 010054   222475 756100                    STQ     TVAL+3,,AUTO
        14 010055   010061 701000 14                 TSX1    ADJUST_POINTER
        14 010056   000000 011000                    NOP     0

     1965    14601    2       RETURN;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:325  
  14601 14 010057   222360 221300                    LDX1  ! LEN,,AUTO
        14 010060   000001 702211                    TSX2  ! 1,X1

     1966    14602
     1967    14603    2       END FIND_MAIL_HEADER;
     1968    14604        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:326  
     1969    14605    1   ADJUST_POINTER: PROC( STRUCTURE, PTR$);

  14605 14 010061   222474 741300       ADJUST_POIN* STX1  ! TVAL+2,,AUTO

     1970    14606
     1971    14607    2       DCL PTR$ PTR;
     1972    14608    2       DCL 1 PTR# REDEF PTR$,
     1973    14609    2            2 WORDS UBIN HALF UNAL,
     1974    14610    2            2 CHARS UBIN(2) UNAL,
     1975    14611    2            2 BITS UBIN(4) UNAL,
     1976    14612    2            2 SEGID BIT(12);
     1977    14613    2       DCL STRUCTURE BIT(36);
     1978    14614
     1979    14615    2       IF PTR#.SEGID = '0'B THEN

  14615 14 010062   222476 470500                    LDP0    @PTR$,,AUTO
        14 010063   000000 236100                    LDQ     0,,PR0
        14 010064   007777 316007                    CANQ    4095,DL
        14 010065   010071 601000 14                 TNZ     s:14618

     1980    14616    2           PTR$ = ADDR( NIL);

  14616 14 010066   000001 236000 xsym               LDQ     B_VECTNIL+1
        14 010067   000000 756100                    STQ     0,,PR0
        14 010070   010117 710000 14                 TRA     s:14621

     1981    14617    2       ELSE
     1982    14618    2           IF PTR$ ~= ADDR( NIL) THEN

  14618 14 010071   000000 236100                    LDQ     0,,PR0
        14 010072   000001 116000 xsym               CMPQ    B_VECTNIL+1
        14 010073   010117 600000 14                 TZE     s:14621

     1983    14619    2               PTR$ = PINCRB( ADDR( STRUCTURE),

  14619 14 010074   000000 236100                    LDQ     0,,PR0
        14 010075   000020 772000                    QRL     16
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:327  
        14 010076   000003 376007                    ANQ     3,DL
        14 010077   222722 756100                    STQ     @VLEN+2,,AUTO
        14 010100   000000 236100                    LDQ     0,,PR0
        14 010101   000020 772000                    QRL     16
        14 010102   000135 376000 15                 ANQ     93
        14 010103   222722 036100                    ADLQ    @VLEN+2,,AUTO
        14 010104   222723 756100                    STQ     @VLEN+3,,AUTO
        14 010105   000000 236100                    LDQ     0,,PR0
        14 010106   000014 772000                    QRL     12
        14 010107   000017 376007                    ANQ     15,DL
        14 010110   222724 756100                    STQ     @VLEN+4,,AUTO
        14 010111   222723 236100                    LDQ     @VLEN+3,,AUTO
        14 010112   000011 402007                    MPY     9,DL
        14 010113   222724 036100                    ADLQ    @VLEN+4,,AUTO
        14 010114   222475 471500                    LDP1    @STRUCTURE,,AUTO
        14 010115   100000 503506                    ABD     0,QL,PR1
        14 010116   000000 451500                    STP1    0,,PR0

     1984    14620    2                       PTR#.WORDS * 36 + PTR#.CHARS * 9 + PTR#.BITS);
     1985    14621    2       RETURN;

  14621 14 010117   222474 221300                    LDX1  ! TVAL+2,,AUTO
        14 010120   000001 702211                    TSX2  ! 1,X1

     1986    14622
     1987    14623    2       END ADJUST_POINTER;
     1988    14624        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:328  
     1989    14625    1   PARSE_MAIL_HEADER: PROC ALTRET;

  14625 14 010121   222360 741300       PARSE_MAIL_* STX1  ! LEN,,AUTO

     1990    14626
     1991    14627    2       DCL BLANK_INDEX UBIN WORD;
     1992    14628    2       DCL LPAREN UBIN WORD;
     1993    14629    2       DCL LPAREN1 UBIN WORD;
     1994    14630    2       DCL NAME_END UBIN WORD;
     1995    14631    2       DCL PDEPTH UBIN WORD;
     1996    14632    2       DCL RPAREN UBIN WORD;
     1997    14633    2       DCL SITE_INDEX UBIN WORD;
     1998    14634    2       DCL STARTSCAN UBIN WORD;
     1999    14635    2       DCL TEMP$ PTR;
     2000    14636    2       DCL TSTRING CHAR( %LINE_SIZE);
     2001    14637    2       DCL TVAL UBIN WORD;
     2002    14638
     2003    14639    2       CALL COPY( VM_HEADER.FROM$, FROM$, 80);

  14639 14 010122   000140 237000 15                 LDAQ    96
        14 010123   222476 757100                    STAQ    @PTR$,,AUTO
        14 010124   222345 236100                    LDQ     HEADER$,,AUTO
        14 010125   000023 036003                    ADLQ    19,DU
        14 010126   222475 756100                    STQ     @STRUCTURE,,AUTO
        14 010127   012205 701000 14                 TSX1    COPY
        14 010130   000000 011000                    NOP     0

     2004    14640    2       CALL COPY( VM_HEADER.TO$, TO$, %PATH_SIZE);

  14640 14 010131   000142 237000 15                 LDAQ    98
        14 010132   222476 757100                    STAQ    @PTR$,,AUTO
        14 010133   222345 236100                    LDQ     HEADER$,,AUTO
        14 010134   000031 036003                    ADLQ    25,DU
        14 010135   222475 756100                    STQ     @STRUCTURE,,AUTO
        14 010136   012205 701000 14                 TSX1    COPY
        14 010137   000000 011000                    NOP     0

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:329  
     2005    14641    2       CALL COPY( VM_HEADER.REPLY_TO$, REPLY_TO$, %USER_SIZE);

  14641 14 010140   000146 237000 15                 LDAQ    102
        14 010141   222476 757100                    STAQ    @PTR$,,AUTO
        14 010142   222345 236100                    LDQ     HEADER$,,AUTO
        14 010143   000025 036003                    ADLQ    21,DU
        14 010144   222475 756100                    STQ     @STRUCTURE,,AUTO
        14 010145   012205 701000 14                 TSX1    COPY
        14 010146   000000 011000                    NOP     0

     2006    14642    2       CALL COPY( VM_HEADER.SUBJECT$, SUBJECT$, %LINE_SIZE);

  14642 14 010147   000150 237000 15                 LDAQ    104
        14 010150   222476 757100                    STAQ    @PTR$,,AUTO
        14 010151   222345 236100                    LDQ     HEADER$,,AUTO
        14 010152   000030 036003                    ADLQ    24,DU
        14 010153   222475 756100                    STQ     @STRUCTURE,,AUTO
        14 010154   012205 701000 14                 TSX1    COPY
        14 010155   000000 011000                    NOP     0

     2007    14643    2       CALL COPY( VM_HEADER.REFERENCE$, RE$, %LINE_SIZE);

  14643 14 010156   000152 237000 15                 LDAQ    106
        14 010157   222476 757100                    STAQ    @PTR$,,AUTO
        14 010160   222345 236100                    LDQ     HEADER$,,AUTO
        14 010161   000024 036003                    ADLQ    20,DU
        14 010162   222475 756100                    STQ     @STRUCTURE,,AUTO
        14 010163   012205 701000 14                 TSX1    COPY
        14 010164   000000 011000                    NOP     0

     2008    14644    2       CALL COPY( VM_HEADER.SIGNED$, SIGNATURE$, %LINE_SIZE);

  14644 14 010165   000154 237000 15                 LDAQ    108
        14 010166   222476 757100                    STAQ    @PTR$,,AUTO
        14 010167   222345 236100                    LDQ     HEADER$,,AUTO
        14 010170   000027 036003                    ADLQ    23,DU
        14 010171   222475 756100                    STQ     @STRUCTURE,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:330  
        14 010172   012205 701000 14                 TSX1    COPY
        14 010173   000000 011000                    NOP     0

     2009    14645    2       CALL COPY( VM_HEADER.BAD_ADDRESS$, BAD_ADDRESS$, %LINE_SIZE);

  14645 14 010174   000156 237000 15                 LDAQ    110
        14 010175   222476 757100                    STAQ    @PTR$,,AUTO
        14 010176   222345 236100                    LDQ     HEADER$,,AUTO
        14 010177   000017 036003                    ADLQ    15,DU
        14 010200   222475 756100                    STQ     @STRUCTURE,,AUTO
        14 010201   012205 701000 14                 TSX1    COPY
        14 010202   000000 011000                    NOP     0

     2010    14646    3       IF VM_HEADER.STATUS.ERR THEN DO;

  14646 14 010203   222345 470500                    LDP0    HEADER$,,AUTO
        14 010204   000012 234100                    SZN     10,,PR0
        14 010205   010273 605000 14                 TPL     s:14671

     2011    14647    3           VM_HEADER.REFERS_TO_ID$ = VM_HEADER.UNIQUE_ID$;

  14647 14 010206   000032 236100                    LDQ     26,,PR0
        14 010207   000033 756100                    STQ     27,,PR0

     2012    14648    3           VM_HEADER.UNIQUE_ID$ = ADDR( NIL);

  14648 14 010210   000001 236000 xsym               LDQ     B_VECTNIL+1
        14 010211   000032 756100                    STQ     26,,PR0

     2013    14649    3           IF VM_HEADER.FROM$ = ADDR( NIL) OR

  14649 14 010212   000023 236100                    LDQ     19,,PR0
        14 010213   000001 116000 xsym               CMPQ    B_VECTNIL+1
        14 010214   010223 600000 14                 TZE     s:14651
        14 010215   002447 471400 1                  LDP1    FROM$
        14 010216   100000 720100                    LXL0    0,,PR1
        14 010217   040000 106500                    CMPC    fill='040'O
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:331  
        14 010220   100001 000013                    ADSC9   1,,PR1                   cn=0,n=11
        14 010221   003112 000013 1                  ADSC9   TCM_XLATE_TO_UC+277      cn=0,n=11
        14 010222   010232 600000 14                 TZE     s:14656

     2014    14650    3                   SUBSTR( FROM$->CV.T, 0, 11) ~= 'SMTP Mailer' THEN
     2015    14651    3               IF VM_HEADER.REPLY_TO$ ~= ADDR( NIL) THEN

  14651 14 010223   000025 236100                    LDQ     21,,PR0
        14 010224   000001 116000 xsym               CMPQ    B_VECTNIL+1
        14 010225   010240 600000 14                 TZE     DEAD_LETTER

     2016    14652    3                   TONAME = REPLY_TO;

  14652 14 010226   000000 100400                    MLR     fill='000'O
        14 010227   002411 000124 6                  ADSC9   REPLY_TO                 cn=0,n=84
        14 010230   002605 000364 6                  ADSC9   TONAME                   cn=0,n=244
        14 010231   010245 710000 14                 TRA     s:14663

     2017    14653    3               ELSE
     2018    14654    3                   GOTO DEAD_LETTER;
     2019    14655    3           ELSE
     2020    14656    3               IF VM_HEADER.FROM$ ~= ADDR( NIL) THEN

  14656 14 010232   000001 116000 xsym               CMPQ    B_VECTNIL+1
        14 010233   010240 600000 14                 TZE     DEAD_LETTER

     2021    14657    3                   TONAME = FROMNAME;

  14657 14 010234   000000 100400                    MLR     fill='000'O
        14 010235   002312 000124 6                  ADSC9   FROMNAME                 cn=0,n=84
        14 010236   002605 000364 6                  ADSC9   TONAME                   cn=0,n=244
        14 010237   010245 710000 14                 TRA     s:14663

     2022    14658    4               ELSE DO;

     2023    14659    4   DEAD_LETTER:
     2024    14660    4                   TONAME.L = LENGTHC( 'Postmaster');
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:332  

  14660 14 010240   000012 235007       DEAD_LETTER  LDA     10,DL
        14 010241   002605 755000 6                  STA     TONAME

     2025    14661    4                   TONAME.T = 'Postmaster';

  14661 14 010242   040000 100400                    MLR     fill='040'O
        14 010243   003115 000012 1                  ADSC9   TCM_XLATE_TO_UC+280      cn=0,n=10
        14 010244   002606 000360 6                  ADSC9   TONAME+1                 cn=0,n=240

     2026    14662    4                   END;

     2027    14663    3           RE = SUBJECT;

  14663 14 010245   000000 100400                    MLR     fill='000'O
        14 010246   003003 000403 6                  ADSC9   SUBJECT                  cn=0,n=259
        14 010247   003104 000403 6                  ADSC9   RE                       cn=0,n=259

     2028    14664    3           SUBJECT.L = LENGTHC( 'Returned mail');

  14664 14 010250   000015 235007                    LDA     13,DL
        14 010251   003003 755000 6                  STA     SUBJECT

     2029    14665    3           SUBJECT.T = 'Returned mail';

  14665 14 010252   040000 100400                    MLR     fill='040'O
        14 010253   003120 000015 1                  ADSC9   TCM_XLATE_TO_UC+283      cn=0,n=13
        14 010254   003004 000377 6                  ADSC9   SUBJECT+1                cn=0,n=255

     2030    14666    3           FROM$->CV.L = LENGTHC( 'SMTP Mailer');

  14666 14 010255   000013 236007                    LDQ     11,DL
        14 010256   002447 471400 1                  LDP1    FROM$
        14 010257   100000 756100                    STQ     0,,PR1

     2031    14667    3           FROM$->CV.T = 'SMTP Mailer';

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:333  
  14667 14 010260   100000 720100                    LXL0    0,,PR1
        14 010261   040140 100400                    MLR     fill='040'O
        14 010262   003112 000013 1                  ADSC9   TCM_XLATE_TO_UC+277      cn=0,n=11
        14 010263   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0

     2032    14668    3           REPLY_TO$->CV.L = LENGTHC( 'Postmaster');

  14668 14 010264   000012 235007                    LDA     10,DL
        14 010265   002452 473400 1                  LDP3    REPLY_TO$
        14 010266   300000 755100                    STA     0,,PR3

     2033    14669    3           REPLY_TO$->CV.T = 'Postmaster';

  14669 14 010267   300000 720100                    LXL0    0,,PR3
        14 010270   040140 100400                    MLR     fill='040'O
        14 010271   003115 000012 1                  ADSC9   TCM_XLATE_TO_UC+280      cn=0,n=10
        14 010272   300001 000010                    ADSC9   1,,PR3                   cn=0,n=*X0

     2034    14670    3           END;

     2035    14671    2       CALL MAKE_SMTP_ADDRESS( FROM$, FROMNAME$, FROMADDR$);

  14671 14 010273   000160 237000 15                 LDAQ    112
        14 010274   222476 757100                    STAQ    @PTR$,,AUTO
        14 010275   000140 236000 15                 LDQ     96
        14 010276   222475 756100                    STQ     @STRUCTURE,,AUTO
        14 010277   012256 701000 14                 TSX1    MAKE_SMTP_ADDRESS
        14 010300   000000 011000                    NOP     0

     2036    14672    2       CALL MAKE_SMTP_ADDRESS( REPLY_TO$, REPLYNAME$, REPLYADDR$);

  14672 14 010301   000162 237000 15                 LDAQ    114
        14 010302   222476 757100                    STAQ    @PTR$,,AUTO
        14 010303   000146 236000 15                 LDQ     102
        14 010304   222475 756100                    STQ     @STRUCTURE,,AUTO
        14 010305   012256 701000 14                 TSX1    MAKE_SMTP_ADDRESS
        14 010306   000000 011000                    NOP     0
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:334  

     2037    14673    2       PATH.L = 0;

  14673 14 010307   002510 450000 6                  STZ     PATH

     2038    14674    2       PATH.T = ' ';

  14674 14 010310   040000 100400                    MLR     fill='040'O
        14 010311   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 010312   002511 000360 6                  ADSC9   PATH+1                   cn=0,n=240

     2039    14675    2       TOSITE.L = 0;

  14675 14 010313   003407 450000 6                  STZ     TOSITE

     2040    14676    2       TOSITE.T = ' ';

  14676 14 010314   040000 100400                    MLR     fill='040'O
        14 010315   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 010316   003410 000100 6                  ADSC9   TOSITE+1                 cn=0,n=64

     2041    14677    2       CALL M$TIME( GET_SMTP_DATE);

  14677 14 010317   001546 630400 1                  EPPR0   GET_SMTP_DATE
        14 010320   020004 713400                    CLIMB   8196
        14 010321   402000 401760                    pmme    nvectors=5

     2042    14678    2       DATEWORK.MONMASK = DATEWORK.MONMASK | '000040040'O;  /* MON->Mon */

  14678 14 010322   003436 236000 6                  LDQ     DATEWORK
        14 010323   000052 376000 15                 ANQ     42
        14 010324   003124 276000 1                  ORQ     TCM_XLATE_TO_UC+287
        14 010325   003436 552070 6                  STBQ    DATEWORK,'70'O

     2043    14679    2       DAYMASK = DAYMASK | '000040040'O;  /* DAY->Day */

  14679 14 010326   003444 236000 6                  LDQ     DAYBUF
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:335  
        14 010327   000052 376000 15                 ANQ     42
        14 010330   003124 276000 1                  ORQ     TCM_XLATE_TO_UC+287
        14 010331   003444 552070 6                  STBQ    DAYBUF,'70'O

     2044    14680    2       CALL CONCAT( DATEBUF, DATEWORK.DD, ' ', DATEWORK.MON, ' ', DATEWORK.YY);

  14680 14 010332   003437 220000 6                  LDX0    DATEWORK+1
        14 010333   003441 740000 6                  STX0    DATEBUF
        14 010334   040000 236007                    LDQ     16384,DL
        14 010335   003441 552010 6                  STBQ    DATEBUF,'10'O
        14 010336   040000 100400                    MLR     fill='040'O
        14 010337   003436 000003 6                  ADSC9   DATEWORK                 cn=0,n=3
        14 010340   003441 600003 6                  ADSC9   DATEBUF                  cn=3,n=3
        14 010341   003442 552010 6                  STBQ    DATEBUF+1,'10'O
        14 010342   040000 100400                    MLR     fill='040'O
        14 010343   003440 000002 6                  ADSC9   DATEWORK+2               cn=0,n=2
        14 010344   003442 600003 6                  ADSC9   DATEBUF+1                cn=3,n=3

     2045    14681    3       IF MESSAGE_FILE THEN DO;

  14681 14 010345   200141 234100                    SZN     MESSAGE_FILE,,AUTO
        14 010346   010356 605000 14                 TPL     s:14689

     2046    14682    3           CALL READ_ADDRESS_RECORDS

  14682 14 010347   011627 701000 14                 TSX1    READ_ADDRESS_RECORDS
        14 010350   010352 702000 14                 TSX2    s:14684
        14 010351   010354 710000 14                 TRA     s:14686

     2047    14683    4           WHENALTRETURN DO;

     2048    14684    4               ALTRETURN;

  14684 14 010352   222360 221300                    LDX1  ! LEN,,AUTO
        14 010353   000000 702211                    TSX2  ! 0,X1

     2049    14685    4               END;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:336  
     2050    14686    3           RETURN;

  14686 14 010354   222360 221300                    LDX1  ! LEN,,AUTO
        14 010355   000001 702211                    TSX2  ! 1,X1

     2051    14687    3           END;
     2052    14688            /****** EXTRACT FORWARD PATH FROM HEADER ******/
     2053    14689    3       IF SUBJECT$->CV.L > 0 THEN DO;

  14689 14 010356   002460 470400 1                  LDP0    SUBJECT$
        14 010357   000000 235100                    LDA     0,,PR0
        14 010360   010453 600000 14                 TZE     CHECK_RE

     2054    14690                /** CHECK FOR PATH IN SUBJECT **/
     2055    14691    3           CALL INDEX( LOC, '<', SUBJECT$->CV.T) ALTRET( CHECK_RE);

  14691 14 010361   000000 720100                    LXL0    0,,PR0
        14 010362   000000 124540                    SCM     mask='000'O
        14 010363   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 010364   000123 000001 15                 ADSC9   83                       cn=0,n=1
        14 010365   200105 000100                    ARG     LOC,,AUTO
        14 010366   010453 606400 14                 TTN     CHECK_RE

     2056    14692    4           IF LOC > 0 THEN DO;

  14692 14 010367   200105 236100                    LDQ     LOC,,AUTO
        14 010370   010422 600000 14                 TZE     s:14702

     2057    14693                    /** STRIP PATH FROM END OF SUBJECT **/
     2058    14694    4               PATH$->CV.L = SUBJECT$->CV.L - LOC;

  14694 14 010371   000000 236100                    LDQ     0,,PR0
        14 010372   200105 136100                    SBLQ    LOC,,AUTO
        14 010373   002455 471400 1                  LDP1    PATH$
        14 010374   100000 756100                    STQ     0,,PR1

     2059    14695    4               PATH$->CV.T = SUBSTR( SUBJECT$->CV.T, LOC);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:337  

  14695 14 010375   100000 720100                    LXL0    0,,PR1
        14 010376   000000 721100                    LXL1    0,,PR0
        14 010377   000000 636011                    EAQ     0,X1
        14 010400   000022 772000                    QRL     18
        14 010401   200105 136100                    SBLQ    LOC,,AUTO
        14 010402   000000 622006                    EAX2    0,QL
        14 010403   200105 235100                    LDA     LOC,,AUTO
        14 010404   040140 100545                    MLR     fill='040'O
        14 010405   000001 000012                    ADSC9   1,A,PR0                  cn=0,n=*X2
        14 010406   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0

     2060    14696    4               SUBJECT$->CV.L = SUBJECT$->CV.L - PATH$->CV.L;

  14696 14 010407   000000 236100                    LDQ     0,,PR0
        14 010410   100000 136100                    SBLQ    0,,PR1
        14 010411   000000 756100                    STQ     0,,PR0

     2061    14697    4               IF SUBSTR( SUBJECT$->CV.T, SUBJECT$->CV.L - 1, 1) = ' ' THEN

  14697 14 010412   000000 720100                    LXL0    0,,PR0
        14 010413   040000 106506                    CMPC    fill='040'O
        14 010414   000000 600001                    ADSC9   0,Q,PR0                  cn=3,n=1
        14 010415   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 010416   010432 601000 14                 TNZ     s:14706

     2062    14698    4                   SUBJECT$->CV.L = SUBJECT$->CV.L - 1;

  14698 14 010417   000001 136007                    SBLQ    1,DL
        14 010420   000000 756100                    STQ     0,,PR0

     2063    14699    4               END;

  14699 14 010421   010432 710000 14                 TRA     s:14706

     2064    14700    4           ELSE DO;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:338  
     2065    14701                    /** MOVE SUBJECT TO PATH **/
     2066    14702    4               PATH$->CV.L = SUBJECT$->CV.L;

  14702 14 010422   002455 471400 1                  LDP1    PATH$
        14 010423   100000 755100                    STA     0,,PR1

     2067    14703    4               PATH$->CV.T = SUBJECT$->CV.T;

  14703 14 010424   100000 720100                    LXL0    0,,PR1
        14 010425   000000 721100                    LXL1    0,,PR0
        14 010426   040140 100540                    MLR     fill='040'O
        14 010427   000001 000011                    ADSC9   1,,PR0                   cn=0,n=*X1
        14 010430   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0

     2068    14704    4               SUBJECT$->CV.L = 0;

  14704 14 010431   000000 450100                    STZ     0,,PR0

     2069    14705    4               END;

     2070    14706    3           CALL INDEX( LOC, '%', TO$->CV.T) ALTRET( PATH_OK);

  14706 14 010432   002456 473400 1                  LDP3    TO$
        14 010433   300000 720100                    LXL0    0,,PR3
        14 010434   000000 124540                    SCM     mask='000'O
        14 010435   300001 000010                    ADSC9   1,,PR3                   cn=0,n=*X0
        14 010436   000057 000001 15                 ADSC9   47                       cn=0,n=1
        14 010437   200105 000100                    ARG     LOC,,AUTO
        14 010440   010450 606400 14                 TTN     PATH_OK

     2071    14707    3           CMDBUF = ADDRERR;

  14707 14 010441   040000 100400                    MLR     fill='040'O
        14 010442   002306 000102 1                  ADSC9   ADDRERR                  cn=0,n=66
        14 010443   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     2072    14708    3           REPLYLEN = LENGTHC( ADDRERR);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:339  

  14708 14 010444   000102 235007                    LDA     66,DL
        14 010445   002207 755000 6                  STA     REPLYLEN

     2073    14709    3           ALTRETURN;

  14709 14 010446   222360 221300                    LDX1  ! LEN,,AUTO
        14 010447   000000 702211                    TSX2  ! 0,X1

     2074    14710    3   PATH_OK:
     2075    14711    3           TO$->CV.L = 0;

  14711 14 010450   002456 470400 1     PATH_OK      LDP0    TO$
        14 010451   000000 450100                    STZ     0,,PR0

     2076    14712    3           END;

  14712 14 010452   011203 710000 14                 TRA     s:14827

     2077    14713    3       ELSE DO;

     2078    14714    3   CHECK_RE:
     2079    14715    4           IF RE$->CV.L > 0 THEN DO;

  14715 14 010453   002461 470400 1     CHECK_RE     LDP0    RE$
        14 010454   000000 235100                    LDA     0,,PR0
        14 010455   010550 600000 14                 TZE     CHECK_TO

     2080    14716                    /** CHECK FOR PATH IN REFERENCE **/
     2081    14717    4               CALL INDEX( LOC, '<', RE$->CV.T) ALTRET( CHECK_TO);

  14717 14 010456   000000 720100                    LXL0    0,,PR0
        14 010457   000000 124540                    SCM     mask='000'O
        14 010460   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 010461   000123 000001 15                 ADSC9   83                       cn=0,n=1
        14 010462   200105 000100                    ARG     LOC,,AUTO
        14 010463   010550 606400 14                 TTN     CHECK_TO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:340  

     2082    14718    5               IF LOC > 0 THEN DO;

  14718 14 010464   200105 236100                    LDQ     LOC,,AUTO
        14 010465   010517 600000 14                 TZE     s:14728

     2083    14719                        /** STRIP PATH FROM END OF REFERENCE **/
     2084    14720    5                   PATH$->CV.L = RE$->CV.L - LOC;

  14720 14 010466   000000 236100                    LDQ     0,,PR0
        14 010467   200105 136100                    SBLQ    LOC,,AUTO
        14 010470   002455 471400 1                  LDP1    PATH$
        14 010471   100000 756100                    STQ     0,,PR1

     2085    14721    5                   PATH$->CV.T = SUBSTR( RE$->CV.T, LOC);

  14721 14 010472   100000 720100                    LXL0    0,,PR1
        14 010473   000000 721100                    LXL1    0,,PR0
        14 010474   000000 636011                    EAQ     0,X1
        14 010475   000022 772000                    QRL     18
        14 010476   200105 136100                    SBLQ    LOC,,AUTO
        14 010477   000000 622006                    EAX2    0,QL
        14 010500   200105 235100                    LDA     LOC,,AUTO
        14 010501   040140 100545                    MLR     fill='040'O
        14 010502   000001 000012                    ADSC9   1,A,PR0                  cn=0,n=*X2
        14 010503   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0

     2086    14722    5                   RE$->CV.L = RE$->CV.L - PATH$->CV.L;

  14722 14 010504   000000 236100                    LDQ     0,,PR0
        14 010505   100000 136100                    SBLQ    0,,PR1
        14 010506   000000 756100                    STQ     0,,PR0

     2087    14723    5                   IF SUBSTR( RE$->CV.T, RE$->CV.L - 1, 1) = ' ' THEN

  14723 14 010507   000000 720100                    LXL0    0,,PR0
        14 010510   040000 106506                    CMPC    fill='040'O
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:341  
        14 010511   000000 600001                    ADSC9   0,Q,PR0                  cn=3,n=1
        14 010512   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 010513   010527 601000 14                 TNZ     s:14732

     2088    14724    5                       RE$->CV.L = RE$->CV.L - 1;

  14724 14 010514   000001 136007                    SBLQ    1,DL
        14 010515   000000 756100                    STQ     0,,PR0

     2089    14725    5                   END;

  14725 14 010516   010527 710000 14                 TRA     s:14732

     2090    14726    5               ELSE DO;

     2091    14727                        /** MOVE REFERENCE TO PATH **/
     2092    14728    5                   PATH$->CV.L = RE$->CV.L;

  14728 14 010517   002455 471400 1                  LDP1    PATH$
        14 010520   100000 755100                    STA     0,,PR1

     2093    14729    5                   PATH$->CV.T = RE$->CV.T;

  14729 14 010521   100000 720100                    LXL0    0,,PR1
        14 010522   000000 721100                    LXL1    0,,PR0
        14 010523   040140 100540                    MLR     fill='040'O
        14 010524   000001 000011                    ADSC9   1,,PR0                   cn=0,n=*X1
        14 010525   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0

     2094    14730    5                   RE$->CV.L = 0;

  14730 14 010526   000000 450100                    STZ     0,,PR0

     2095    14731    5                   END;

     2096    14732    4               CALL INDEX( LOC, '%', TO$->CV.T) ALTRET( REPATH_OK);

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:342  
  14732 14 010527   002456 473400 1                  LDP3    TO$
        14 010530   300000 720100                    LXL0    0,,PR3
        14 010531   000000 124540                    SCM     mask='000'O
        14 010532   300001 000010                    ADSC9   1,,PR3                   cn=0,n=*X0
        14 010533   000057 000001 15                 ADSC9   47                       cn=0,n=1
        14 010534   200105 000100                    ARG     LOC,,AUTO
        14 010535   010545 606400 14                 TTN     REPATH_OK

     2097    14733    4               CMDBUF = ADDRERR;

  14733 14 010536   040000 100400                    MLR     fill='040'O
        14 010537   002306 000102 1                  ADSC9   ADDRERR                  cn=0,n=66
        14 010540   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     2098    14734    4               REPLYLEN = LENGTHC( ADDRERR);

  14734 14 010541   000102 235007                    LDA     66,DL
        14 010542   002207 755000 6                  STA     REPLYLEN

     2099    14735    4               ALTRETURN;

  14735 14 010543   222360 221300                    LDX1  ! LEN,,AUTO
        14 010544   000000 702211                    TSX2  ! 0,X1

     2100    14736    4   REPATH_OK:
     2101    14737    4               TO$->CV.L = 0;

  14737 14 010545   002456 470400 1     REPATH_OK    LDP0    TO$
        14 010546   000000 450100                    STZ     0,,PR0

     2102    14738    4               END;

  14738 14 010547   011203 710000 14                 TRA     s:14827

     2103    14739    4           ELSE DO;

     2104    14740    4   CHECK_TO:
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:343  
     2105    14741    5               IF TO$->CV.L > 0 THEN DO;

  14741 14 010550   002456 470400 1     CHECK_TO     LDP0    TO$
        14 010551   000000 235100                    LDA     0,,PR0
        14 010552   011042 600000 14                 TZE     NO_PATH

     2106    14742                        /** EXTRACT PATH FROM TO: FIELD **/
     2107    14743    5                   CALL INDEX( LOC, '"', TO$->CV.T)

  14743 14 010553   000000 720100                    LXL0    0,,PR0
        14 010554   000000 124540                    SCM     mask='000'O
        14 010555   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 010556   000124 000001 15                 ADSC9   84                       cn=0,n=1
        14 010557   200105 000100                    ARG     LOC,,AUTO
        14 010560   010762 606400 14                 TTN     s:14773

     2108    14744    6                   WHENRETURN DO;

     2109    14745    6                       CALL INDEX( LOCE, '"', TO$->CV.T, LOC + 1) ALTRET( NO_PATH);

  14745 14 010561   000000 636010                    EAQ     0,X0
        14 010562   000022 772000                    QRL     18
        14 010563   200105 136100                    SBLQ    LOC,,AUTO
        14 010564   777777 621006                    EAX1    -1,QL
        14 010565   200105 236100                    LDQ     LOC,,AUTO
        14 010566   000001 036007                    ADLQ    1,DL
        14 010567   200105 235100                    LDA     LOC,,AUTO
        14 010570   000000 124545                    SCM     mask='000'O
        14 010571   000001 200011                    ADSC9   1,A,PR0                  cn=1,n=*X1
        14 010572   000124 000001 15                 ADSC9   84                       cn=0,n=1
        14 010573   200106 000100                    ARG     LOCE,,AUTO
        14 010574   200106 056100                    ASQ     LOCE,,AUTO
        14 010575   011042 606400 14                 TTN     NO_PATH

     2110    14746    6                       CALL INDEX( TVAL, '@',

  14746 14 010576   200106 236100                    LDQ     LOCE,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:344  
        14 010577   200105 136100                    SBLQ    LOC,,AUTO
        14 010600   000001 621006                    EAX1    1,QL
        14 010601   000000 124545                    SCM     mask='000'O
        14 010602   000001 000011                    ADSC9   1,A,PR0                  cn=0,n=*X1
        14 010603   000022 000001 15                 ADSC9   18                       cn=0,n=1
        14 010604   222472 000100                    ARG     TVAL,,AUTO
        14 010605   011042 606400 14                 TTN     NO_PATH

     2111    14747    6                              SUBSTR( TO$->CV.T, LOC, LOCE - LOC + 1)) ALTRET( NO_PATH
             14747                                        );
     2112    14748        /* Recipient is identified within a comment in the TO: line.  Extract the
     2113    14749           path; if a name is present also, store it too. */
     2114    14750    6                       CALL INDEX( NAME_END, '<', TO$->CV.T, LOC)

  14750 14 010606   000000 636010                    EAQ     0,X0
        14 010607   000022 772000                    QRL     18
        14 010610   200105 136100                    SBLQ    LOC,,AUTO
        14 010611   222722 756100                    STQ     @VLEN+2,,AUTO
        14 010612   200105 236100                    LDQ     LOC,,AUTO
        14 010613   222722 720100                    LXL0    @VLEN+2,,AUTO
        14 010614   000000 124545                    SCM     mask='000'O
        14 010615   000001 000010                    ADSC9   1,A,PR0                  cn=0,n=*X0
        14 010616   000123 000001 15                 ADSC9   83                       cn=0,n=1
        14 010617   222364 000100                    ARG     NAME_END,,AUTO
        14 010620   222364 056100                    ASQ     NAME_END,,AUTO
        14 010621   010716 606400 14                 TTN     s:14766

     2115    14751    7                       WHENRETURN DO;

     2116    14752    7                           CALL INDEX( TVAL, '>', TO$->CV.T, NAME_END + 1) ALTRET(
             14752                                    NO_PATH);

  14752 14 010622   000000 720100                    LXL0    0,,PR0
        14 010623   000000 636010                    EAQ     0,X0
        14 010624   000022 772000                    QRL     18
        14 010625   222364 136100                    SBLQ    NAME_END,,AUTO
        14 010626   777777 621006                    EAX1    -1,QL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:345  
        14 010627   222364 236100                    LDQ     NAME_END,,AUTO
        14 010630   000001 036007                    ADLQ    1,DL
        14 010631   222364 235100                    LDA     NAME_END,,AUTO
        14 010632   000000 124545                    SCM     mask='000'O
        14 010633   000001 200011                    ADSC9   1,A,PR0                  cn=1,n=*X1
        14 010634   000056 000001 15                 ADSC9   46                       cn=0,n=1
        14 010635   222472 000100                    ARG     TVAL,,AUTO
        14 010636   222472 056100                    ASQ     TVAL,,AUTO
        14 010637   011042 606400 14                 TTN     NO_PATH

     2117    14753    7                           PATH$->CV.L = TVAL - NAME_END + 1;

  14753 14 010640   222472 236100                    LDQ     TVAL,,AUTO
        14 010641   222364 136100                    SBLQ    NAME_END,,AUTO
        14 010642   000001 036007                    ADLQ    1,DL
        14 010643   002455 471400 1                  LDP1    PATH$
        14 010644   100000 756100                    STQ     0,,PR1

     2118    14754    7                          PATH$->CV.T = SUBSTR( TO$->CV.T, NAME_END, TVAL - NAME_END +
             14754                                    1);

  14754 14 010645   100000 720100                    LXL0    0,,PR1
        14 010646   000000 721100                    LXL1    0,,PR0
        14 010647   222472 236100                    LDQ     TVAL,,AUTO
        14 010650   222364 136100                    SBLQ    NAME_END,,AUTO
        14 010651   000001 622006                    EAX2    1,QL
        14 010652   040140 100545                    MLR     fill='040'O
        14 010653   000001 000012                    ADSC9   1,A,PR0                  cn=0,n=*X2
        14 010654   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0

     2119    14755    7                           TSTRING = SUBSTR( TO$->CV.T, LOC + 1, NAME_END - LOC - 1);

  14755 14 010655   000000 721100                    LXL1    0,,PR0
        14 010656   222364 236100                    LDQ     NAME_END,,AUTO
        14 010657   200105 136100                    SBLQ    LOC,,AUTO
        14 010660   777777 622006                    EAX2    -1,QL
        14 010661   200105 236100                    LDQ     LOC,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:346  
        14 010662   040100 100546                    MLR     fill='040'O
        14 010663   000001 200012                    ADSC9   1,Q,PR0                  cn=1,n=*X2
        14 010664   222372 000377                    ADSC9   TSTRING,,AUTO            cn=0,n=255

     2120    14756    7                           TO$->CV.L = NAME_END - LOC;

  14756 14 010665   222364 236100                    LDQ     NAME_END,,AUTO
        14 010666   200105 136100                    SBLQ    LOC,,AUTO
        14 010667   000000 756100                    STQ     0,,PR0

     2121    14757    7                           TO$->CV.T = TSTRING;

  14757 14 010670   000000 720100                    LXL0    0,,PR0
        14 010671   040140 100500                    MLR     fill='040'O
        14 010672   222372 000377                    ADSC9   TSTRING,,AUTO            cn=0,n=255
        14 010673   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0

     2122    14758    8                           DO WHILE( TO$->CV.L > 0);

  14758 14 010674   000000 116003                    CMPQ    0,DU
        14 010675   010715 600000 14                 TZE     s:14764

     2123    14759    8                               IF SUBSTR( TO$->CV.T, TO$->CV.L - 1) = ' ' THEN

  14759 14 010676   002456 470400 1                  LDP0    TO$
        14 010677   000000 720100                    LXL0    0,,PR0
        14 010700   000000 636010                    EAQ     0,X0
        14 010701   000022 772000                    QRL     18
        14 010702   000000 136100                    SBLQ    0,,PR0
        14 010703   000000 235100                    LDA     0,,PR0
        14 010704   000001 621006                    EAX1    1,QL
        14 010705   040000 106545                    CMPC    fill='040'O
        14 010706   000000 600011                    ADSC9   0,A,PR0                  cn=3,n=*X1
        14 010707   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 010710   010715 601000 14                 TNZ     s:14764

     2124    14760    8                                   TO$->CV.L = TO$->CV.L - 1;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:347  

  14760 14 010711   000001 135007                    SBLA    1,DL
        14 010712   000000 755100                    STA     0,,PR0
        14 010713   010714 710000 14                 TRA     s:14763

     2125    14761    8                               ELSE
     2126    14762    8                                   EXIT;
     2127    14763    8                               END;

  14763 14 010714   010676 601000 14                 TNZ     s:14759

     2128    14764    7                           END;

  14764 14 010715   010761 710000 14                 TRA     s:14771

     2129    14765    7                       WHENALTRETURN DO;

     2130    14766    7                           PATH$->CV.L = LOCE - LOC + 1;

  14766 14 010716   200106 236100                    LDQ     LOCE,,AUTO
        14 010717   200105 136100                    SBLQ    LOC,,AUTO
        14 010720   000001 036007                    ADLQ    1,DL
        14 010721   002455 470400 1                  LDP0    PATH$
        14 010722   000000 756100                    STQ     0,,PR0

     2131    14767    7                           CALL CONCAT( PATH$->CV.T, '<',

  14767 14 010723   000000 720100                    LXL0    0,,PR0
        14 010724   002456 471400 1                  LDP1    TO$
        14 010725   100000 721100                    LXL1    0,,PR1
        14 010726   200106 236100                    LDQ     LOCE,,AUTO
        14 010727   200105 136100                    SBLQ    LOC,,AUTO
        14 010730   040140 100400                    MLR     fill='040'O
        14 010731   000123 000001 15                 ADSC9   83                       cn=0,n=1
        14 010732   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 010733   222722 756100                    STQ     @VLEN+2,,AUTO
        14 010734   000000 636010                    EAQ     0,X0
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:348  
        14 010735   000022 772000                    QRL     18
        14 010736   000002 116007                    CMPQ    2,DL
        14 010737   010760 602000 14                 TNC     s:14769
        14 010740   222722 721100                    LXL1    @VLEN+2,,AUTO
        14 010741   777777 622011                    EAX2    -1,X1
        14 010742   777777 623010                    EAX3    -1,X0
        14 010743   200105 235100                    LDA     LOC,,AUTO
        14 010744   040140 100545                    MLR     fill='040'O
        14 010745   100001 200012                    ADSC9   1,A,PR1                  cn=1,n=*X2
        14 010746   000001 200013                    ADSC9   1,,PR0                   cn=1,n=*X3
        14 010747   000000 636010                    EAQ     0,X0
        14 010750   000022 772000                    QRL     18
        14 010751   222722 136100                    SBLQ    @VLEN+2,,AUTO
        14 010752   010760 604400 14                 TMOZ    s:14769
        14 010753   000000 620006                    EAX0    0,QL
        14 010754   222722 236100                    LDQ     @VLEN+2,,AUTO
        14 010755   040146 100400                    MLR     fill='040'O
        14 010756   000056 000001 15                 ADSC9   46                       cn=0,n=1
        14 010757   000001 000010                    ADSC9   1,Q,PR0                  cn=0,n=*X0

     2132    14768    7                                   SUBSTR( TO$->CV.T, LOC + 1, LOCE - LOC - 1), '>');
     2133    14769    7                           TO$->CV.L = 0;

  14769 14 010760   100000 450100                    STZ     0,,PR1

     2134    14770    7                           END;

     2135    14771    6                       END;

  14771 14 010761   011041 710000 14                 TRA     s:14781

     2136    14772    6                   WHENALTRETURN DO;

     2137    14773    6                       CALL INDEX( LOC, '%', TO$->CV.T)

  14773 14 010762   002456 470400 1                  LDP0    TO$
        14 010763   000000 720100                    LXL0    0,,PR0
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:349  
        14 010764   000000 124540                    SCM     mask='000'O
        14 010765   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 010766   000057 000001 15                 ADSC9   47                       cn=0,n=1
        14 010767   200105 000100                    ARG     LOC,,AUTO
        14 010770   010772 606400 14                 TTN     s:14775
        14 010771   011001 710000 14                 TRA     s:14777

     2138    14774    7                       WHENALTRETURN DO;

     2139    14775    7                           CALL INDEX( LOC, '@', TO$->CV.T) ALTRET( NO_PATH);

  14775 14 010772   002456 470400 1                  LDP0    TO$
        14 010773   000000 720100                    LXL0    0,,PR0
        14 010774   000000 124540                    SCM     mask='000'O
        14 010775   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 010776   000022 000001 15                 ADSC9   18                       cn=0,n=1
        14 010777   200105 000100                    ARG     LOC,,AUTO
        14 011000   011042 606400 14                 TTN     NO_PATH

     2140    14776    7                           END;

     2141    14777    6                       PATH$->CV.L = TO$->CV.L + 2;

  14777 14 011001   002455 471400 1                  LDP1    PATH$
        14 011002   000000 235100                    LDA     0,,PR0
        14 011003   000002 035007                    ADLA    2,DL
        14 011004   100000 755100                    STA     0,,PR1

     2142    14778    6                       CALL CONCAT( PATH$->CV.T, '<', TO$->CV.T, '>');

  14778 14 011005   100000 720100                    LXL0    0,,PR1
        14 011006   000000 721100                    LXL1    0,,PR0
        14 011007   040140 100400                    MLR     fill='040'O
        14 011010   000123 000001 15                 ADSC9   83                       cn=0,n=1
        14 011011   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0
        14 011012   000000 636010                    EAQ     0,X0
        14 011013   000022 772000                    QRL     18
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:350  
        14 011014   000002 116007                    CMPQ    2,DL
        14 011015   011040 602000 14                 TNC     s:14779
        14 011016   777777 622010                    EAX2    -1,X0
        14 011017   040140 100540                    MLR     fill='040'O
        14 011020   000001 000011                    ADSC9   1,,PR0                   cn=0,n=*X1
        14 011021   100001 200012                    ADSC9   1,,PR1                   cn=1,n=*X2
        14 011022   000000 636011                    EAQ     0,X1
        14 011023   000022 772000                    QRL     18
        14 011024   222722 756100                    STQ     @VLEN+2,,AUTO
        14 011025   000000 636010                    EAQ     0,X0
        14 011026   000022 772000                    QRL     18
        14 011027   222722 136100                    SBLQ    @VLEN+2,,AUTO
        14 011030   000001 116007                    CMPQ    1,DL
        14 011031   011040 604400 14                 TMOZ    s:14779
        14 011032   777777 620006                    EAX0    -1,QL
        14 011033   000000 635011                    EAA     0,X1
        14 011034   000022 771000                    ARL     18
        14 011035   040145 100400                    MLR     fill='040'O
        14 011036   000056 000001 15                 ADSC9   46                       cn=0,n=1
        14 011037   100001 200010                    ADSC9   1,A,PR1                  cn=1,n=*X0

     2143    14779    6                       TO$->CV.L = 0;

  14779 14 011040   000000 450100                    STZ     0,,PR0

     2144    14780    6                       END;

     2145    14781    5                   END;

  14781 14 011041   011203 710000 14                 TRA     s:14827

     2146    14782    5               ELSE DO;

     2147    14783                        /** PATH NOT FOUND IN HEADER **/
     2148    14784    5   NO_PATH:
     2149    14785    5                   VM_LISTKEY.COUNT = TO$->CV.L + LENGTHC( VM_LISTKEY.TYPE);

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:351  
  14785 14 011042   002456 470400 1     NO_PATH      LDP0    TO$
        14 011043   000000 236100                    LDQ     0,,PR0
        14 011044   000001 036007                    ADLQ    1,DL
        14 011045   000033 736000                    QLS     27
        14 011046   001034 552040 6                  STBQ    VM_LISTKEY,'40'O

     2150    14786    5                   CALL XLATE( VM_LISTKEY.TEXT, TCM_XLATE_TO_UC, TO$->CV.T);

  14786 14 011047   000000 720100                    LXL0    0,,PR0
        14 011050   040000 160540                    MVT     fill='040'O
        14 011051   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 011052   001034 400310 6                  ADSC9   VM_LISTKEY               cn=2,n=200
        14 011053   002465 000000 1                  ARG     TCM_XLATE_TO_UC

     2151    14787    5                   READ_REGISTRY.BUF_ = VECTOR( VM_ADD_HEAD);

  14787 14 011054   000164 235000 15                 LDA     116
        14 011055   222347 236100                    LDQ     ADDRESS$,,AUTO
        14 011056   000142 757000 6                  STAQ    READ_REGISTRY+4

     2152    14788    5                   READ_REGISTRY.BUF_.BOUND = 4095;

  14788 14 011057   000142 236000 6                  LDQ     READ_REGISTRY+4
        14 011060   177777 376007                    ANQ     65535,DL
        14 011061   000121 276000 15                 ORQ     81
        14 011062   000142 756000 6                  STQ     READ_REGISTRY+4

     2153    14789    5                   READ_REGISTRY.KEY_ = VECTOR( VM_LISTKEY);

  14789 14 011063   000166 237000 15                 LDAQ    118
        14 011064   000140 757000 6                  STAQ    READ_REGISTRY+2

     2154    14790    5                   READ_REGISTRY.V.KEYS# = %YES#;

  14790 14 011065   200000 236007                    LDQ     65536,DL
        14 011066   000146 256000 6                  ORSQ    READ_REGISTRY+8

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:352  
     2155    14791    5                   READ_REGISTRY.V.KEYR# = %NO#;

  14791 14 011067   000165 236000 15                 LDQ     117
        14 011070   000146 356000 6                  ANSQ    READ_REGISTRY+8

     2156    14792    5                   CALL M$READ( READ_REGISTRY)

  14792 14 011071   000136 630400 6                  EPPR0   READ_REGISTRY
        14 011072   440000 713400                    CLIMB   alt,read
        14 011073   401400 401760                    pmme    nvectors=4
        14 011074   011076 702000 14                 TSX2    s:14794
        14 011075   011123 710000 14                 TRA     s:14807

     2157    14793    6                   WHENALTRETURN DO;

     2158    14794    6                       IF VM_HEADER.STATUS.ERR OR

  14794 14 011076   222345 470500                    LDP0    HEADER$,,AUTO
        14 011077   000012 234100                    SZN     10,,PR0
        14 011100   011110 604000 14                 TMI     s:14798
        14 011101   000012 236100                    LDQ     10,,PR0
        14 011102   200000 316003                    CANQ    65536,DU
        14 011103   011110 601000 14                 TNZ     s:14798
        14 011104   100000 316003                    CANQ    32768,DU
        14 011105   011110 601000 14                 TNZ     s:14798
        14 011106   000002 316003                    CANQ    2,DU
        14 011107   011114 600000 14                 TZE     s:14803

     2159    14795    6                               VM_HEADER.STATUS.ANSWER OR
     2160    14796    6                               VM_HEADER.STATUS.ACK OR
     2161    14797    7                               VM_HEADER.STATUS.DELIVERY THEN DO;

     2162    14798    7                           CALL READ_ADDRESS_RECORDS

  14798 14 011110   011627 701000 14                 TSX1    READ_ADDRESS_RECORDS
        14 011111   011114 702000 14                 TSX2    s:14803

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:353  
     2163    14799    8                           WHENRETURN DO;

     2164    14800    8                               RETURN;

  14800 14 011112   222360 221300                    LDX1  ! LEN,,AUTO
        14 011113   000001 702211                    TSX2  ! 1,X1

     2165    14801    8                               END;
     2166    14802    7                           END;

     2167    14803    6                       CMDBUF = PATHERR;

  14803 14 011114   040000 100400                    MLR     fill='040'O
        14 011115   002214 000077 1                  ADSC9   PATHERR                  cn=0,n=63
        14 011116   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     2168    14804    6                       REPLYLEN = LENGTHC( PATHERR);

  14804 14 011117   000077 235007                    LDA     63,DL
        14 011120   002207 755000 6                  STA     REPLYLEN

     2169    14805    6                       ALTRETURN;

  14805 14 011121   222360 221300                    LDX1  ! LEN,,AUTO
        14 011122   000000 702211                    TSX2  ! 0,X1

     2170    14806    6                       END;
     2171    14807    6                   IF VM_ADD_HEAD.NUM_ENTRIES > 1 THEN DO;

  14807 14 011123   222347 470500                    LDP0    ADDRESS$,,AUTO
        14 011124   000001 235100                    LDA     1,,PR0
        14 011125   000002 115007                    CMPA    2,DL
        14 011126   011136 602000 14                 TNC     s:14812

     2172    14808    6                       CMDBUF = MULTIPLEADDRESSERR;

  14808 14 011127   040000 100400                    MLR     fill='040'O
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:354  
        14 011130   002234 000075 1                  ADSC9   MULTIPLEADDRESSERR       cn=0,n=61
        14 011131   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     2173    14809    6                       REPLYLEN = LENGTHC( MULTIPLEADDRESSERR);

  14809 14 011132   000075 235007                    LDA     61,DL
        14 011133   002207 755000 6                  STA     REPLYLEN

     2174    14810    6                       ALTRETURN;

  14810 14 011134   222360 221300                    LDX1  ! LEN,,AUTO
        14 011135   000000 702211                    TSX2  ! 0,X1

     2175    14811    6                       END;
     2176    14812    5                   ALIAS$ = VM_ADD_HEAD.HEAD$;

  14812 14 011136   000003 236100                    LDQ     3,,PR0
        14 011137   222350 756100                    STQ     ALIAS$,,AUTO

     2177    14813    5                   CALL ADJUST_POINTER( VM_ADD_HEAD, ALIAS$);

  14813 14 011140   222350 631500                    EPPR1   ALIAS$,,AUTO
        14 011141   222476 451500                    STP1    @PTR$,,AUTO
        14 011142   222347 236100                    LDQ     ADDRESS$,,AUTO
        14 011143   222475 756100                    STQ     @STRUCTURE,,AUTO
        14 011144   010061 701000 14                 TSX1    ADJUST_POINTER
        14 011145   000000 011000                    NOP     0

     2178    14814    5                   IF VM_UADDRESS.TYPE ~= %VM_ADD_UNRESOLVED OR

  14814 14 011146   222350 470500                    LDP0    ALIAS$,,AUTO
        14 011147   000002 236100                    LDQ     2,,PR0
        14 011150   000777 376003                    ANQ     511,DU
        14 011151   000002 116003                    CMPQ    2,DU
        14 011152   011163 601000 14                 TNZ     s:14817
        14 011153   040000 106500                    CMPC    fill='040'O
        14 011154   000017 600010                    ADSC9   15,,PR0                  cn=3,n=8
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:355  
        14 011155   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 011156   011163 601000 14                 TNZ     s:14817
        14 011157   000022 236100                    LDQ     18,,PR0
        14 011160   777000 376003                    ANQ     -512,DU
        14 011161   074000 116003                    CMPQ    30720,DU
        14 011162   011172 600000 14                 TZE     s:14821

     2179    14815    5                           VM_UADDRESS.SITENAME ~= ' ' OR
     2180    14816    6                           SUBSTR( VM_UADDRESS.USER_NAME.TEXT, 0, 1) ~= '<' THEN DO;

     2181    14817    6                       CMDBUF = NOTMULTICSADDRESSERR;

  14817 14 011163   040000 100400                    MLR     fill='040'O
        14 011164   002254 000077 1                  ADSC9   NOTMULTICSADDRESSERR     cn=0,n=63
        14 011165   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     2182    14818    6                       REPLYLEN = LENGTHC( NOTMULTICSADDRESSERR);

  14818 14 011166   000077 235007                    LDA     63,DL
        14 011167   002207 755000 6                  STA     REPLYLEN

     2183    14819    6                       ALTRETURN;

  14819 14 011170   222360 221300                    LDX1  ! LEN,,AUTO
        14 011171   000000 702211                    TSX2  ! 0,X1

     2184    14820    6                       END;
     2185    14821    5                   PATH$->CV.L = VM_UADDRESS.USER_NAME.COUNT;

  14821 14 011172   002455 471400 1                  LDP1    PATH$
        14 011173   000021 236100                    LDQ     17,,PR0
        14 011174   000777 376007                    ANQ     511,DL
        14 011175   100000 756100                    STQ     0,,PR1

     2186    14822    5                   PATH$->CV.T = VM_UADDRESS.USER_NAME.TEXT;

  14822 14 011176   100000 720100                    LXL0    0,,PR1
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:356  
        14 011177   222350 470500                    LDP0    ALIAS$,,AUTO
        14 011200   040140 100500                    MLR     fill='040'O
        14 011201   000022 000310                    ADSC9   18,,PR0                  cn=0,n=200
        14 011202   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0

     2187    14823    5                   END;

     2188    14824    4               END;

     2189    14825    3           END;

     2190    14826            /** If no @ in path, convert rightmost % to @ */
     2191    14827    2       CALL INDEX( LOC, '@', PATH$->CV.T)

  14827 14 011203   002455 470400 1                  LDP0    PATH$
        14 011204   000000 720100                    LXL0    0,,PR0
        14 011205   000000 124540                    SCM     mask='000'O
        14 011206   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 011207   000022 000001 15                 ADSC9   18                       cn=0,n=1
        14 011210   200105 000100                    ARG     LOC,,AUTO
        14 011211   011213 606400 14                 TTN     s:14829
        14 011212   011232 710000 14                 TRA     s:14836

     2192    14828    3       WHENALTRETURN DO;

     2193    14829    3           CALL INDEX1R( LOC, '%', PATH$->CV.T)

  14829 14 011213   002455 470400 1                  LDP0    PATH$
        14 011214   000000 720100                    LXL0    0,,PR0
        14 011215   000000 636010                    EAQ     0,X0
        14 011216   000022 772000                    QRL     18
        14 011217   000000 125540                    SCMR    mask='000'O
        14 011220   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 011221   000057 000001 15                 ADSC9   47                       cn=0,n=1
        14 011222   200105 000100                    ARG     LOC,,AUTO
        14 011223   011232 606400 14                 TTN     s:14836
        14 011224   200105 054100                    AOS     LOC,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:357  
        14 011225   200105 156100                    SSQ     LOC,,AUTO

     2194    14830    4           WHENRETURN DO;

     2195    14831    4               SUBSTR( PATH$->CV.T, LOC, 1) = '@';

  14831 14 011226   200105 235100                    LDA     LOC,,AUTO
        14 011227   040105 100400                    MLR     fill='040'O
        14 011230   000022 000001 15                 ADSC9   18                       cn=0,n=1
        14 011231   000001 000001                    ADSC9   1,A,PR0                  cn=0,n=1

     2196    14832    4               END;

     2197    14833    3           END;

     2198    14834        /* Look for (comments) in the path.  If any are found, strip them out, and
     2199    14835           save them for use in the TO: field of the outgoing mail.             */
     2200    14836    2       COMMENT$->CV.L = 0;

  14836 14 011232   002463 470400 1                  LDP0    COMMENT$
        14 011233   000000 450100                    STZ     0,,PR0

     2201    14837    2       CALL INDEX( LPAREN, '(', PATH$->CV.T);

  14837 14 011234   002455 471400 1                  LDP1    PATH$
        14 011235   100000 720100                    LXL0    0,,PR1
        14 011236   000000 124540                    SCM     mask='000'O
        14 011237   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0
        14 011240   000105 000001 15                 ADSC9   69                       cn=0,n=1
        14 011241   222362 000100                    ARG     LPAREN,,AUTO

     2202    14838    3       DO WHILE( LPAREN < PATH$->CV.L);

  14838 14 011242   222362 236100                    LDQ     LPAREN,,AUTO
        14 011243   100000 116100                    CMPQ    0,,PR1
        14 011244   011474 603000 14                 TRC     s:14876

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:358  
     2203    14839    3           PDEPTH = 1;

  14839 14 011245   000001 235007                    LDA     1,DL
        14 011246   222365 755100                    STA     PDEPTH,,AUTO

     2204    14840    3           STARTSCAN = LPAREN + 1;

  14840 14 011247   222362 236100                    LDQ     LPAREN,,AUTO
        14 011250   000001 036007                    ADLQ    1,DL
        14 011251   222370 756100                    STQ     STARTSCAN,,AUTO

     2205    14841    4           DO UNTIL PDEPTH = 0 OR PATH$->CV.L <= RPAREN;

     2206    14842    4               CALL INDEX( LPAREN1, '(', PATH$->CV.T, STARTSCAN);

  14842 14 011252   002455 470400 1                  LDP0    PATH$
        14 011253   000000 720100                    LXL0    0,,PR0
        14 011254   000000 636010                    EAQ     0,X0
        14 011255   000022 772000                    QRL     18
        14 011256   222370 136100                    SBLQ    STARTSCAN,,AUTO
        14 011257   222722 756100                    STQ     @VLEN+2,,AUTO
        14 011260   222370 236100                    LDQ     STARTSCAN,,AUTO
        14 011261   222722 720100                    LXL0    @VLEN+2,,AUTO
        14 011262   222370 235100                    LDA     STARTSCAN,,AUTO
        14 011263   000000 124545                    SCM     mask='000'O
        14 011264   000001 000010                    ADSC9   1,A,PR0                  cn=0,n=*X0
        14 011265   000105 000001 15                 ADSC9   69                       cn=0,n=1
        14 011266   222363 000100                    ARG     LPAREN1,,AUTO
        14 011267   222363 056100                    ASQ     LPAREN1,,AUTO

     2207    14843    4               CALL INDEX( RPAREN, ')', PATH$->CV.T, STARTSCAN);

  14843 14 011270   000000 720100                    LXL0    0,,PR0
        14 011271   000000 636010                    EAQ     0,X0
        14 011272   000022 772000                    QRL     18
        14 011273   222370 136100                    SBLQ    STARTSCAN,,AUTO
        14 011274   222722 756100                    STQ     @VLEN+2,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:359  
        14 011275   222370 236100                    LDQ     STARTSCAN,,AUTO
        14 011276   222722 720100                    LXL0    @VLEN+2,,AUTO
        14 011277   000000 124545                    SCM     mask='000'O
        14 011300   000001 000010                    ADSC9   1,A,PR0                  cn=0,n=*X0
        14 011301   000106 000001 15                 ADSC9   70                       cn=0,n=1
        14 011302   222366 000100                    ARG     RPAREN,,AUTO
        14 011303   222366 056100                    ASQ     RPAREN,,AUTO

     2208    14844    5               IF LPAREN1 < RPAREN THEN DO;

  14844 14 011304   222363 236100                    LDQ     LPAREN1,,AUTO
        14 011305   222366 116100                    CMPQ    RPAREN,,AUTO
        14 011306   011315 603000 14                 TRC     s:14849

     2209    14845    5                   PDEPTH = PDEPTH + 1;

  14845 14 011307   222365 235100                    LDA     PDEPTH,,AUTO
        14 011310   000001 035007                    ADLA    1,DL
        14 011311   222365 755100                    STA     PDEPTH,,AUTO

     2210    14846    5                   STARTSCAN = LPAREN1 + 1;

  14846 14 011312   000001 036007                    ADLQ    1,DL
        14 011313   222370 756100                    STQ     STARTSCAN,,AUTO

     2211    14847    5                   END;

  14847 14 011314   011323 710000 14                 TRA     s:14852

     2212    14848    5               ELSE DO;

     2213    14849    5                   PDEPTH = PDEPTH - 1;

  14849 14 011315   222365 235100                    LDA     PDEPTH,,AUTO
        14 011316   000001 135007                    SBLA    1,DL
        14 011317   222365 755100                    STA     PDEPTH,,AUTO

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:360  
     2214    14850    5                   STARTSCAN = RPAREN + 1;

  14850 14 011320   222366 235100                    LDA     RPAREN,,AUTO
        14 011321   000001 035007                    ADLA    1,DL
        14 011322   222370 755100                    STA     STARTSCAN,,AUTO

     2215    14851    5                   END;

     2216    14852    4               END;

  14852 14 011323   222365 235100                    LDA     PDEPTH,,AUTO
        14 011324   011330 600000 14                 TZE     s:14853
        14 011325   222366 236100                    LDQ     RPAREN,,AUTO
        14 011326   000000 116100                    CMPQ    0,,PR0
        14 011327   011252 602000 14                 TNC     s:14842

     2217    14853    3           TVAL = COMMENT$->CV.L;

  14853 14 011330   002463 471400 1                  LDP1    COMMENT$
        14 011331   100000 235100                    LDA     0,,PR1
        14 011332   222472 755100                    STA     TVAL,,AUTO

     2218    14854    3           COMMENT$->CV.L = TVAL + ( RPAREN - LPAREN) - 1;

  14854 14 011333   222366 236100                    LDQ     RPAREN,,AUTO
        14 011334   222362 136100                    SBLQ    LPAREN,,AUTO
        14 011335   222472 036100                    ADLQ    TVAL,,AUTO
        14 011336   000001 136007                    SBLQ    1,DL
        14 011337   100000 756100                    STQ     0,,PR1

     2219    14855    3           SUBSTR( COMMENT$->CV.T, TVAL) = SUBSTR( PATH$->CV.T, LPAREN + 1);

  14855 14 011340   100000 720100                    LXL0    0,,PR1
        14 011341   000000 636010                    EAQ     0,X0
        14 011342   000022 772000                    QRL     18
        14 011343   222472 136100                    SBLQ    TVAL,,AUTO
        14 011344   000000 721100                    LXL1    0,,PR0
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:361  
        14 011345   222722 756100                    STQ     @VLEN+2,,AUTO
        14 011346   000000 636011                    EAQ     0,X1
        14 011347   000022 772000                    QRL     18
        14 011350   222362 136100                    SBLQ    LPAREN,,AUTO
        14 011351   777777 620006                    EAX0    -1,QL
        14 011352   222362 236100                    LDQ     LPAREN,,AUTO
        14 011353   222722 721100                    LXL1    @VLEN+2,,AUTO
        14 011354   040145 100546                    MLR     fill='040'O
        14 011355   000001 200010                    ADSC9   1,Q,PR0                  cn=1,n=*X0
        14 011356   100001 000011                    ADSC9   1,A,PR1                  cn=0,n=*X1

     2220    14856    3           RPAREN = MINIMUM( PATH$->CV.L - 1, RPAREN);

  14856 14 011357   000000 236100                    LDQ     0,,PR0
        14 011360   000001 136007                    SBLQ    1,DL
        14 011361   011366 604000 14                 TMI     s:14856+7
        14 011362   222366 116100                    CMPQ    RPAREN,,AUTO
        14 011363   011366 602000 14                 TNC     s:14856+7
        14 011364   011366 600000 14                 TZE     s:14856+7
        14 011365   222366 236100                    LDQ     RPAREN,,AUTO
        14 011366   222366 756100                    STQ     RPAREN,,AUTO

     2221    14857    4           DO WHILE( LPAREN > 0);

  14857 14 011367   222362 235100                    LDA     LPAREN,,AUTO
        14 011370   011404 600000 14                 TZE     s:14863

     2222    14858    4               IF SUBSTR( PATH$->CV.T, LPAREN - 1, 1) = ' ' THEN

  14858 14 011371   002455 470400 1                  LDP0    PATH$
        14 011372   000000 720100                    LXL0    0,,PR0
        14 011373   222362 235100                    LDA     LPAREN,,AUTO
        14 011374   040000 106505                    CMPC    fill='040'O
        14 011375   000000 600001                    ADSC9   0,A,PR0                  cn=3,n=1
        14 011376   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 011377   011404 601000 14                 TNZ     s:14863

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:362  
     2223    14859    4                   LPAREN = LPAREN - 1;

  14859 14 011400   000001 135007                    SBLA    1,DL
        14 011401   222362 755100                    STA     LPAREN,,AUTO
        14 011402   011403 710000 14                 TRA     s:14862

     2224    14860    4               ELSE
     2225    14861    4                   EXIT;
     2226    14862    4               END;

  14862 14 011403   011371 601000 14                 TNZ     s:14858

     2227    14863    4           DO WHILE( RPAREN < PATH$->CV.L - 1);

  14863 14 011404   011420 710000 14                 TRA     s:14868

     2228    14864    4               IF SUBSTR( PATH$->CV.T, LPAREN + 1, 1) = ' ' THEN

  14864 14 011405   002455 470400 1                  LDP0    PATH$
        14 011406   000000 720100                    LXL0    0,,PR0
        14 011407   222362 235100                    LDA     LPAREN,,AUTO
        14 011410   040000 106505                    CMPC    fill='040'O
        14 011411   000001 200001                    ADSC9   1,A,PR0                  cn=1,n=1
        14 011412   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 011413   011426 601000 14                 TNZ     s:14869

     2229    14865    4                   RPAREN = RPAREN + 1;

  14865 14 011414   222366 236100                    LDQ     RPAREN,,AUTO
        14 011415   000001 036007                    ADLQ    1,DL
        14 011416   222366 756100                    STQ     RPAREN,,AUTO
        14 011417   011420 710000 14                 TRA     s:14868

     2230    14866    4               ELSE
     2231    14867    4                   EXIT;
     2232    14868    4               END;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:363  
  14868 14 011420   000000 236100                    LDQ     0,,PR0
        14 011421   000001 136007                    SBLQ    1,DL
        14 011422   011426 604000 14                 TMI     s:14869
        14 011423   222366 116100                    CMPQ    RPAREN,,AUTO
        14 011424   011426 600000 14                 TZE     s:14869
        14 011425   011405 603000 14                 TRC     s:14864

     2233    14869    3           CALL CONCAT( TSTRING, SUBSTR( PATH$->CV.T, 0, LPAREN),

  14869 14 011426   000000 720100                    LXL0    0,,PR0
        14 011427   000000 636010                    EAQ     0,X0
        14 011430   000022 772000                    QRL     18
        14 011431   222366 136100                    SBLQ    RPAREN,,AUTO
        14 011432   000000 621005                    EAX1    0,AL
        14 011433   040100 100540                    MLR     fill='040'O
        14 011434   000001 000011                    ADSC9   1,,PR0                   cn=0,n=*X1
        14 011435   222372 000377                    ADSC9   TSTRING,,AUTO            cn=0,n=255
        14 011436   222722 756100                    STQ     @VLEN+2,,AUTO
        14 011437   222362 236100                    LDQ     LPAREN,,AUTO
        14 011440   000377 116007                    CMPQ    255,DL
        14 011441   011452 603000 14                 TRC     s:14871
        14 011442   222722 720100                    LXL0    @VLEN+2,,AUTO
        14 011443   777777 621010                    EAX1    -1,X0
        14 011444   777400 622006                    EAX2    -256,QL
        14 011445   777777 662003                    ERX2    -1,DU
        14 011446   222366 235100                    LDA     RPAREN,,AUTO
        14 011447   040146 100545                    MLR     fill='040'O
        14 011450   000001 200011                    ADSC9   1,A,PR0                  cn=1,n=*X1
        14 011451   222372 000012                    ADSC9   TSTRING,Q,AUTO           cn=0,n=*X2

     2234    14870    3                   SUBSTR( PATH$->CV.T, RPAREN + 1));
     2235    14871    3           PATH$->CV.L = PATH$->CV.L - ( RPAREN - LPAREN + 1);

  14871 14 011452   222366 236100                    LDQ     RPAREN,,AUTO
        14 011453   222362 136100                    SBLQ    LPAREN,,AUTO
        14 011454   222722 756100                    STQ     @VLEN+2,,AUTO
        14 011455   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:364  
        14 011456   222722 136100                    SBLQ    @VLEN+2,,AUTO
        14 011457   000001 136007                    SBLQ    1,DL
        14 011460   000000 756100                    STQ     0,,PR0

     2236    14872    3           PATH$->CV.T = TSTRING;

  14872 14 011461   000000 720100                    LXL0    0,,PR0
        14 011462   040140 100500                    MLR     fill='040'O
        14 011463   222372 000377                    ADSC9   TSTRING,,AUTO            cn=0,n=255
        14 011464   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0

     2237    14873    3           CALL INDEX( LPAREN, '(', PATH$->CV.T);

  14873 14 011465   000000 124540                    SCM     mask='000'O
        14 011466   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 011467   000105 000001 15                 ADSC9   69                       cn=0,n=1
        14 011470   222362 000100                    ARG     LPAREN,,AUTO

     2238    14874    3           END;

  14874 14 011471   222362 116100                    CMPQ    LPAREN,,AUTO
        14 011472   011474 600000 14                 TZE     s:14876
        14 011473   011245 603000 14                 TRC     s:14839

     2239    14875            /****** EXTRACT RECIPIENT NAME FROM PATH IF NO TO: FIELD ******/
     2240    14876    3       IF TO$->CV.L = 0 AND COMMENT$->CV.L = 0 THEN DO;

  14876 14 011474   002456 470400 1                  LDP0    TO$
        14 011475   000000 235100                    LDA     0,,PR0
        14 011476   011573 601000 14                 TNZ     s:14894
        14 011477   002463 471400 1                  LDP1    COMMENT$
        14 011500   100000 235100                    LDA     0,,PR1
        14 011501   011573 601000 14                 TNZ     s:14894

     2241    14877                /** STRIP OFF ANY ROUTE LIST **/
     2242    14878    3           CALL INDEX( LOC, ':', PATH$->CV.T) ALTRET( NO_ROUTE);

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:365  
  14878 14 011502   002455 473400 1                  LDP3    PATH$
        14 011503   300000 720100                    LXL0    0,,PR3
        14 011504   000000 124540                    SCM     mask='000'O
        14 011505   300001 000010                    ADSC9   1,,PR3                   cn=0,n=*X0
        14 011506   000035 000001 15                 ADSC9   29                       cn=0,n=1
        14 011507   200105 000100                    ARG     LOC,,AUTO
        14 011510   011512 606400 14                 TTN     NO_ROUTE

     2243    14879    4           DO NEVER;

  14879 14 011511   011513 710000 14                 TRA     s:14884

     2244    14880    4   NO_ROUTE:
     2245    14881    4               LOC = 0;

  14881 14 011512   200105 450100       NO_ROUTE     STZ     LOC,,AUTO

     2246    14882    4               END;

     2247    14883                /** STRIP OFF HOST NAME **/
     2248    14884    3           CALL INDEX( LOCE, '@', PATH$->CV.T, LOC) ALTRET( NO_PATH);

  14884 14 011513   002455 470400 1                  LDP0    PATH$
        14 011514   000000 720100                    LXL0    0,,PR0
        14 011515   000000 636010                    EAQ     0,X0
        14 011516   000022 772000                    QRL     18
        14 011517   200105 136100                    SBLQ    LOC,,AUTO
        14 011520   222722 756100                    STQ     @VLEN+2,,AUTO
        14 011521   200105 236100                    LDQ     LOC,,AUTO
        14 011522   222722 720100                    LXL0    @VLEN+2,,AUTO
        14 011523   200105 235100                    LDA     LOC,,AUTO
        14 011524   000000 124545                    SCM     mask='000'O
        14 011525   000001 000010                    ADSC9   1,A,PR0                  cn=0,n=*X0
        14 011526   000022 000001 15                 ADSC9   18                       cn=0,n=1
        14 011527   200106 000100                    ARG     LOCE,,AUTO
        14 011530   200106 056100                    ASQ     LOCE,,AUTO
        14 011531   011042 606400 14                 TTN     NO_PATH
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:366  

     2249    14885    3           CALL INDEX( TVAL, '%', PATH$->CV.T, LOC)

  14885 14 011532   000000 720100                    LXL0    0,,PR0
        14 011533   000000 636010                    EAQ     0,X0
        14 011534   000022 772000                    QRL     18
        14 011535   200105 136100                    SBLQ    LOC,,AUTO
        14 011536   222722 756100                    STQ     @VLEN+2,,AUTO
        14 011537   200105 236100                    LDQ     LOC,,AUTO
        14 011540   222722 720100                    LXL0    @VLEN+2,,AUTO
        14 011541   000000 124545                    SCM     mask='000'O
        14 011542   000001 000010                    ADSC9   1,A,PR0                  cn=0,n=*X0
        14 011543   000057 000001 15                 ADSC9   47                       cn=0,n=1
        14 011544   222472 000100                    ARG     TVAL,,AUTO
        14 011545   222472 056100                    ASQ     TVAL,,AUTO
        14 011546   011553 606400 14                 TTN     s:14890

     2250    14886    4           WHENRETURN DO;

     2251    14887    4               IF TVAL < LOCE THEN

  14887 14 011547   222472 236100                    LDQ     TVAL,,AUTO
        14 011550   200106 116100                    CMPQ    LOCE,,AUTO
        14 011551   011553 603000 14                 TRC     s:14890

     2252    14888    4                   LOCE = TVAL;

  14888 14 011552   200106 756100                    STQ     LOCE,,AUTO

     2253    14889    4               END;

     2254    14890    3           TO$->CV.L = LOCE - LOC - 1;

  14890 14 011553   200106 236100                    LDQ     LOCE,,AUTO
        14 011554   200105 136100                    SBLQ    LOC,,AUTO
        14 011555   000001 136007                    SBLQ    1,DL
        14 011556   002456 470400 1                  LDP0    TO$
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:367  
        14 011557   000000 756100                    STQ     0,,PR0

     2255    14891    3           TO$->CV.T = SUBSTR( PATH$->CV.T, LOC + 1);

  14891 14 011560   000000 720100                    LXL0    0,,PR0
        14 011561   002455 471400 1                  LDP1    PATH$
        14 011562   100000 721100                    LXL1    0,,PR1
        14 011563   000000 636011                    EAQ     0,X1
        14 011564   000022 772000                    QRL     18
        14 011565   200105 136100                    SBLQ    LOC,,AUTO
        14 011566   777777 622006                    EAX2    -1,QL
        14 011567   200105 235100                    LDA     LOC,,AUTO
        14 011570   040140 100545                    MLR     fill='040'O
        14 011571   100001 200012                    ADSC9   1,A,PR1                  cn=1,n=*X2
        14 011572   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0

     2256    14892    3           END;

     2257    14893            /****** EXTRACT TO-SITE FROM FORWARD PATH ******/
     2258    14894    2       CALL INDEX1R( LOC, '@', PATH$->CV.T) ALTRET( NO_PATH);

  14894 14 011573   002455 471400 1                  LDP1    PATH$
        14 011574   100000 720100                    LXL0    0,,PR1
        14 011575   000000 636010                    EAQ     0,X0
        14 011576   000022 772000                    QRL     18
        14 011577   000000 125540                    SCMR    mask='000'O
        14 011600   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0
        14 011601   000022 000001 15                 ADSC9   18                       cn=0,n=1
        14 011602   200105 000100                    ARG     LOC,,AUTO
        14 011603   011042 606400 14                 TTN     NO_PATH
        14 011604   200105 054100                    AOS     LOC,,AUTO
        14 011605   200105 156100                    SSQ     LOC,,AUTO

     2259    14895    2       TOSITE$->CV.L = PATH$->CV.L - LOC - 2;

  14895 14 011606   100000 236100                    LDQ     0,,PR1
        14 011607   200105 136100                    SBLQ    LOC,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:368  
        14 011610   000002 136007                    SBLQ    2,DL
        14 011611   002464 473400 1                  LDP3    TOSITE$
        14 011612   300000 756100                    STQ     0,,PR3

     2260    14896    2       TOSITE$->CV.T = SUBSTR( PATH$->CV.T, LOC + 1);

  14896 14 011613   300000 720100                    LXL0    0,,PR3
        14 011614   100000 721100                    LXL1    0,,PR1
        14 011615   000000 636011                    EAQ     0,X1
        14 011616   000022 772000                    QRL     18
        14 011617   200105 136100                    SBLQ    LOC,,AUTO
        14 011620   777777 622006                    EAX2    -1,QL
        14 011621   200105 235100                    LDA     LOC,,AUTO
        14 011622   040140 100545                    MLR     fill='040'O
        14 011623   100001 200012                    ADSC9   1,A,PR1                  cn=1,n=*X2
        14 011624   300001 000010                    ADSC9   1,,PR3                   cn=0,n=*X0

     2261    14897    2       RETURN;

  14897 14 011625   222360 221300                    LDX1  ! LEN,,AUTO
        14 011626   000001 702211                    TSX2  ! 1,X1

     2262    14898
     2263    14899    2       END PARSE_MAIL_HEADER;
     2264    14900        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:369  
     2265    14901    1   READ_ADDRESS_RECORDS: PROC ALTRET;

  14901 14 011627   222474 741300       READ_ADDRES* STX1  ! TVAL+2,,AUTO

     2266    14902
     2267    14903    2       DCL I UBIN;
     2268    14904    2       DCL INDX UBIN;
     2269    14905    2       DCL LIST UBIN;
     2270    14906
     2271    14907    2       USER_COUNT = 0;

  14907 14 011630   200142 450100                    STZ     USER_COUNT,,AUTO

     2272    14908    2       HITS = '0'B;

  14908 14 011631   200145 450100                    STZ     HITS,,AUTO

     2273    14909    2       READ_FOLDER.KEY_ = VECTOR( VM_INFOKEY);

  14909 14 011632   000112 237000 15                 LDAQ    74
        14 011633   000122 757000 6                  STAQ    READ_FOLDER+2

     2274    14910    2       READ_FOLDER.BUF_ = MAIL_ADDRESSES;

  14910 14 011634   001226 237000 6                  LDAQ    MAIL_ADDRESSES
        14 011635   000124 757000 6                  STAQ    READ_FOLDER+4

     2275    14911    2       READ_FOLDER.V.KEYS# = %YES#;

  14911 14 011636   200000 236007                    LDQ     65536,DL
        14 011637   000130 256000 6                  ORSQ    READ_FOLDER+8

     2276    14912    2       READ_FOLDER.V.KEYR# = %NO#;

  14912 14 011640   000165 236000 15                 LDQ     117
        14 011641   000130 356000 6                  ANSQ    READ_FOLDER+8

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:370  
     2277    14913    2       LIST = %VM_TYPE_TO;

  14913 14 011642   000020 235007                    LDA     16,DL
        14 011643   222477 755100                    STA     LIST,,AUTO

     2278    14914    2   READIT:
     2279    14915    2       VM_INFOKEY.MESSAGE_NUMBER = MSG_NUMBER;

  14915 14 011644   000000 100500       READIT       MLR     fill='000'O
        14 011645   222343 000004                    ADSC9   MSG_NUMBER,,AUTO         cn=0,n=4
        14 011646   001032 400004 6                  ADSC9   VM_INFOKEY               cn=2,n=4

     2280    14916    2       VM_INFOKEY.COUNT = 5;

  14916 14 011647   005000 236003                    LDQ     2560,DU
        14 011650   001032 552040 6                  STBQ    VM_INFOKEY,'40'O

     2281    14917    2       VM_INFOKEY.TYPE = LIST + 1;

  14917 14 011651   222477 236100                    LDQ     LIST,,AUTO
        14 011652   000001 036007                    ADLQ    1,DL
        14 011653   000022 736000                    QLS     18
        14 011654   001032 552020 6                  STBQ    VM_INFOKEY,'20'O

     2282    14918    2       CALL M$READ( READ_FOLDER) ALTRET( NEXT_ADDRESS_RECORD);

  14918 14 011655   000120 630400 6                  EPPR0   READ_FOLDER
        14 011656   440000 713400                    CLIMB   alt,read
        14 011657   401400 401760                    pmme    nvectors=4
        14 011660   012162 702000 14                 TSX2    NEXT_ADDRESS_RECORD

     2283    14919    2       ALIAS$ = VBASE( MAIL_ADDRESSES)->VM_ADD_HEAD.HEAD$;

  14919 14 011661   001227 470400 6                  LDP0    MAIL_ADDRESSES+1
        14 011662   000003 236100                    LDQ     3,,PR0
        14 011663   222350 756100                    STQ     ALIAS$,,AUTO

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:371  
     2284    14920    3       DO WHILE ALIAS$ ~= ADDR( NIL);

  14920 14 011664   012160 710000 14                 TRA     s:14965

     2285    14921    4           IF VM_UADDRESS.TYPE = %VM_ADD_UNRESOLVED THEN DO;

  14921 14 011665   222350 470500                    LDP0    ALIAS$,,AUTO
        14 011666   000002 236100                    LDQ     2,,PR0
        14 011667   000777 376003                    ANQ     511,DU
        14 011670   000002 116003                    CMPQ    2,DU
        14 011671   012155 601000 14                 TNZ     s:14964

     2286    14922    5               IF USER_COUNT > %MAX_USERS THEN DO;

  14922 14 011672   200142 235100                    LDA     USER_COUNT,,AUTO
        14 011673   000176 115007                    CMPA    126,DL
        14 011674   011704 602000 14                 TNC     s:14927

     2287    14923    5                   CMDBUF = TOERR;

  14923 14 011675   040000 100400                    MLR     fill='040'O
        14 011676   002327 000076 1                  ADSC9   TOERR                    cn=0,n=62
        14 011677   002107 000377 6                  ADSC9   CMDBUF                   cn=0,n=255

     2288    14924    5                   REPLYLEN = LENGTHC( TOERR);

  14924 14 011700   000076 236007                    LDQ     62,DL
        14 011701   002207 756000 6                  STQ     REPLYLEN

     2289    14925    5                   ALTRETURN;

  14925 14 011702   222474 221300                    LDX1  ! TVAL+2,,AUTO
        14 011703   000000 702211                    TSX2  ! 0,X1

     2290    14926    5                   END;
     2291    14927    5               DO WHILE( VM_UADDRESS.USER_NAME.COUNT > 0 AND

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:372  
  14927 14 011704   011711 710000 14                 TRA     s:14930

     2292    14928    5                       SUBSTR( VM_UADDRESS.USER_NAME.TEXT, VM_UADDRESS.USER_NAME.COUNT
             14928                                - 1, 1) = ' ');
     2293    14929    5                   VM_UADDRESS.USER_NAME.COUNT = VM_UADDRESS.USER_NAME.COUNT - 1;

  14929 14 011705   222350 470500                    LDP0    ALIAS$,,AUTO
        14 011706   000021 236100                    LDQ     17,,PR0
        14 011707   000777 036007                    ADLQ    511,DL
        14 011710   000021 552104                    STBQ    17,'04'O,PR0

     2294    14930    5                   END;

  14930 14 011711   222350 470500                    LDP0    ALIAS$,,AUTO
        14 011712   000021 236100                    LDQ     17,,PR0
        14 011713   000777 316007                    CANQ    511,DL
        14 011714   011723 600000 14                 TZE     s:14931
        14 011715   000021 236100                    LDQ     17,,PR0
        14 011716   000777 376007                    ANQ     511,DL
        14 011717   040000 106506                    CMPC    fill='040'O
        14 011720   000021 600001                    ADSC9   17,Q,PR0                 cn=3,n=1
        14 011721   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 011722   011705 600000 14                 TZE     s:14929

     2295    14931    4               CALL INDEX( INDX, ' ',

  14931 14 011723   000021 720100                    LXL0    17,,PR0
        14 011724   000777 360003                    ANX0    511,DU
        14 011725   000000 124540                    SCM     mask='000'O
        14 011726   000022 000010                    ADSC9   18,,PR0                  cn=0,n=*X0
        14 011727   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 011730   222476 000100                    ARG     INDX,,AUTO
        14 011731   012002 606400 14                 TTN     s:14939

     2296    14932    4                       SUBSTR( VM_UADDRESS.USER_NAME.TEXT, 0, VM_UADDRESS.USER_NAME.
             14932                                COUNT))
     2297    14933    5               WHENRETURN DO;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:373  

     2298    14934    5                   CALL CONCAT( USERS.T( USER_COUNT), '"',

  14934 14 011732   000021 720100                    LXL0    17,,PR0
        14 011733   000777 360003                    ANX0    511,DU
        14 011734   200142 236100                    LDQ     USER_COUNT,,AUTO
        14 011735   000076 402007                    MPY     62,DL
        14 011736   000000 621006                    EAX1    0,QL
        14 011737   042000 236003                    LDQ     17408,DU
        14 011740   202346 756111                    STQ     USERS+2,X1,AUTO
        14 011741   200142 236100                    LDQ     USER_COUNT,,AUTO
        14 011742   000370 402007                    MPY     248,DL
        14 011743   040106 100540                    MLR     fill='040'O
        14 011744   000022 000010                    ADSC9   18,,PR0                  cn=0,n=*X0
        14 011745   202346 200357                    ADSC9   USERS+2,Q,AUTO           cn=1,n=239
        14 011746   000000 636010                    EAQ     0,X0
        14 011747   000022 772000                    QRL     18
        14 011750   000357 116007                    CMPQ    239,DL
        14 011751   012001 603000 14                 TRC     s:14937
        14 011752   000000 635010                    EAA     0,X0
        14 011753   000022 771000                    ARL     18
        14 011754   222722 755100                    STA     @VLEN+2,,AUTO
        14 011755   200142 236100                    LDQ     USER_COUNT,,AUTO
        14 011756   000370 402007                    MPY     248,DL
        14 011757   222722 036100                    ADLQ    @VLEN+2,,AUTO
        14 011760   222723 740100                    STX0    @VLEN+3,,AUTO
        14 011761   777420 620010                    EAX0    -240,X0
        14 011762   777777 660003                    ERX0    -1,DU
        14 011763   040146 100400                    MLR     fill='040'O
        14 011764   003125 000002 1                  ADSC9   TCM_XLATE_TO_UC+288      cn=0,n=2
        14 011765   202346 200010                    ADSC9   USERS+2,Q,AUTO           cn=1,n=*X0
        14 011766   222724 756100                    STQ     @VLEN+4,,AUTO
        14 011767   222723 236100                    LDQ     @VLEN+3,,AUTO
        14 011770   000022 772000                    QRL     18
        14 011771   000355 116007                    CMPQ    237,DL
        14 011772   012001 603000 14                 TRC     s:14937
        14 011773   777422 620006                    EAX0    -238,QL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:374  
        14 011774   777777 660003                    ERX0    -1,DU
        14 011775   222724 235100                    LDA     @VLEN+4,,AUTO
        14 011776   040145 100500                    MLR     fill='040'O
        14 011777   000017 600010                    ADSC9   15,,PR0                  cn=3,n=8
        14 012000   202346 600010                    ADSC9   USERS+2,A,AUTO           cn=3,n=*X0

     2299    14935    5                          SUBSTR( VM_UADDRESS.USER_NAME.TEXT, 0, VM_UADDRESS.USER_NAME
             14935                                    .COUNT),
     2300    14936    5                           '"@', VM_UADDRESS.SITENAME);
     2301    14937    5                   END;

  14937 14 012001   012045 710000 14                 TRA     s:14943

     2302    14938    5               WHENALTRETURN DO;

     2303    14939    5                   CALL CONCAT( USERS.T( USER_COUNT),

  14939 14 012002   222350 470500                    LDP0    ALIAS$,,AUTO
        14 012003   000021 720100                    LXL0    17,,PR0
        14 012004   000777 360003                    ANX0    511,DU
        14 012005   200142 236100                    LDQ     USER_COUNT,,AUTO
        14 012006   000370 402007                    MPY     248,DL
        14 012007   040106 100540                    MLR     fill='040'O
        14 012010   000022 000010                    ADSC9   18,,PR0                  cn=0,n=*X0
        14 012011   202346 000360                    ADSC9   USERS+2,Q,AUTO           cn=0,n=240
        14 012012   000000 636010                    EAQ     0,X0
        14 012013   000022 772000                    QRL     18
        14 012014   000360 116007                    CMPQ    240,DL
        14 012015   012045 603000 14                 TRC     s:14943
        14 012016   000000 635010                    EAA     0,X0
        14 012017   000022 771000                    ARL     18
        14 012020   222722 755100                    STA     @VLEN+2,,AUTO
        14 012021   200142 236100                    LDQ     USER_COUNT,,AUTO
        14 012022   000370 402007                    MPY     248,DL
        14 012023   222722 036100                    ADLQ    @VLEN+2,,AUTO
        14 012024   222723 740100                    STX0    @VLEN+3,,AUTO
        14 012025   777417 620010                    EAX0    -241,X0
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:375  
        14 012026   777777 660003                    ERX0    -1,DU
        14 012027   040146 100400                    MLR     fill='040'O
        14 012030   000022 000001 15                 ADSC9   18                       cn=0,n=1
        14 012031   202346 000010                    ADSC9   USERS+2,Q,AUTO           cn=0,n=*X0
        14 012032   222724 756100                    STQ     @VLEN+4,,AUTO
        14 012033   222723 236100                    LDQ     @VLEN+3,,AUTO
        14 012034   000022 772000                    QRL     18
        14 012035   000357 116007                    CMPQ    239,DL
        14 012036   012045 603000 14                 TRC     s:14943
        14 012037   777420 620006                    EAX0    -240,QL
        14 012040   777777 660003                    ERX0    -1,DU
        14 012041   222724 235100                    LDA     @VLEN+4,,AUTO
        14 012042   040145 100500                    MLR     fill='040'O
        14 012043   000017 600010                    ADSC9   15,,PR0                  cn=3,n=8
        14 012044   202346 200010                    ADSC9   USERS+2,A,AUTO           cn=1,n=*X0

     2304    14940    5                          SUBSTR( VM_UADDRESS.USER_NAME.TEXT, 0, VM_UADDRESS.USER_NAME
             14940                                    .COUNT),
     2305    14941    5                           '@', VM_UADDRESS.SITENAME);
     2306    14942    5                   END;

     2307    14943    4               I = LENGTHC( USERS.T( USER_COUNT));

  14943 14 012045   000360 235007                    LDA     240,DL
        14 012046   222475 755100                    STA     I,,AUTO

     2308    14944    5               DO WHILE( I > 0 AND SUBSTR( USERS.T( USER_COUNT), I - 1, 1) = ' ');

  14944 14 012047   012053 710000 14                 TRA     s:14946

     2309    14945    5                   I = I - 1;

  14945 14 012050   222475 235100                    LDA     I,,AUTO
        14 012051   000001 135007                    SBLA    1,DL
        14 012052   222475 755100                    STA     I,,AUTO

     2310    14946    5                   END;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:376  

  14946 14 012053   012063 600000 14                 TZE     s:14947
        14 012054   200142 236100                    LDQ     USER_COUNT,,AUTO
        14 012055   000370 402007                    MPY     248,DL
        14 012056   222475 036100                    ADLQ    I,,AUTO
        14 012057   040000 106506                    CMPC    fill='040'O
        14 012060   202345 600001                    ADSC9   USERS+1,Q,AUTO           cn=3,n=1
        14 012061   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 012062   012050 600000 14                 TZE     s:14945

     2311    14947    4               PATH$->CV.L = I;

  14947 14 012063   002455 470400 1                  LDP0    PATH$
        14 012064   222475 235100                    LDA     I,,AUTO
        14 012065   000000 755100                    STA     0,,PR0

     2312    14948    4               PATH$->CV.T = USERS.T( USER_COUNT);

  14948 14 012066   000000 720100                    LXL0    0,,PR0
        14 012067   200142 236100                    LDQ     USER_COUNT,,AUTO
        14 012070   000370 402007                    MPY     248,DL
        14 012071   040140 100506                    MLR     fill='040'O
        14 012072   202346 000360                    ADSC9   USERS+2,Q,AUTO           cn=0,n=240
        14 012073   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0

     2313    14949    4               CALL INDEX1R( INDX, '@', USERS.T( USER_COUNT));

  14949 14 012074   000000 125506                    SCMR    mask='000'O
        14 012075   202346 000360                    ADSC9   USERS+2,Q,AUTO           cn=0,n=240
        14 012076   000022 000001 15                 ADSC9   18                       cn=0,n=1
        14 012077   222476 000100                    ARG     INDX,,AUTO
        14 012100   012103 606400 14                 TTN     s:14950
        14 012101   000357 236007                    LDQ     239,DL
        14 012102   222476 156100                    SSQ     INDX,,AUTO

     2314    14950    4               TOSITE$->CV.L = I - INDX - 1;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:377  
  14950 14 012103   222475 236100                    LDQ     I,,AUTO
        14 012104   222476 136100                    SBLQ    INDX,,AUTO
        14 012105   000001 136007                    SBLQ    1,DL
        14 012106   002464 471400 1                  LDP1    TOSITE$
        14 012107   100000 756100                    STQ     0,,PR1

     2315    14951    4               TOSITE$->CV.T = SUBSTR( USERS.T( USER_COUNT), INDX + 1);

  14951 14 012110   100000 720100                    LXL0    0,,PR1
        14 012111   200142 236100                    LDQ     USER_COUNT,,AUTO
        14 012112   000370 402007                    MPY     248,DL
        14 012113   222476 036100                    ADLQ    INDX,,AUTO
        14 012114   222476 721100                    LXL1    INDX,,AUTO
        14 012115   777420 621011                    EAX1    -240,X1
        14 012116   777777 661003                    ERX1    -1,DU
        14 012117   040140 100546                    MLR     fill='040'O
        14 012120   202346 200011                    ADSC9   USERS+2,Q,AUTO           cn=1,n=*X1
        14 012121   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0

     2316    14952    4               USERS.L( USER_COUNT) = I;

  14952 14 012122   200142 236100                    LDQ     USER_COUNT,,AUTO
        14 012123   000076 402007                    MPY     62,DL
        14 012124   222475 235100                    LDA     I,,AUTO
        14 012125   202345 755106                    STA     USERS+1,QL,AUTO

     2317    14953    4               USERS.LIST( USER_COUNT) = LIST;

  14953 14 012126   222477 235100                    LDA     LIST,,AUTO
        14 012127   202344 755106                    STA     USERS,QL,AUTO

     2318    14954    4               USER_COUNT = USER_COUNT + 1;

  14954 14 012130   200142 235100                    LDA     USER_COUNT,,AUTO
        14 012131   000001 035007                    ADLA    1,DL
        14 012132   200142 755100                    STA     USER_COUNT,,AUTO

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:378  
     2319    14955    5               DO SELECT( LIST);

  14955 14 012133   222477 236100                    LDQ     LIST,,AUTO
        14 012134   000030 116007                    CMPQ    24,DL
        14 012135   012142 602000 14                 TNC     s:14955+7
        14 012136   012150 600000 14                 TZE     s:14959
        14 012137   000040 116007                    CMPQ    32,DL
        14 012140   012155 601000 14                 TNZ     s:14964
        14 012141   012153 710000 14                 TRA     s:14961
        14 012142   000020 116007                    CMPQ    16,DL
        14 012143   012155 601000 14                 TNZ     s:14964
        14 012144   012145 710000 14                 TRA     s:14957

     2320    14956    5                   SELECT( %VM_TYPE_TO);

     2321    14957    5                       HITS.PRIMARY = %YES#;

  14957 14 012145   400000 236003                    LDQ     -131072,DU
        14 012146   200145 256100                    ORSQ    HITS,,AUTO
        14 012147   012155 710000 14                 TRA     s:14964

     2322    14958    5                   SELECT( %VM_TYPE_C);

     2323    14959    5                       HITS.C = %YES#;

  14959 14 012150   200000 236003                    LDQ     65536,DU
        14 012151   200145 256100                    ORSQ    HITS,,AUTO
        14 012152   012155 710000 14                 TRA     s:14964

     2324    14960    5                   SELECT( %VM_TYPE_BC);

     2325    14961    5                       HITS.BC = %YES#;

  14961 14 012153   100000 236003                    LDQ     32768,DU
        14 012154   200145 256100                    ORSQ    HITS,,AUTO

     2326    14962    5                   END;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:379  

     2327    14963    4               END;

     2328    14964    3           ALIAS$ = VM_UADDRESS.NEXT$;

  14964 14 012155   222350 470500                    LDP0    ALIAS$,,AUTO
        14 012156   000000 236100                    LDQ     0,,PR0
        14 012157   222350 756100                    STQ     ALIAS$,,AUTO

     2329    14965    3           END;

  14965 14 012160   000001 116000 xsym               CMPQ    B_VECTNIL+1
        14 012161   011665 601000 14                 TNZ     s:14921

     2330    14966    2   NEXT_ADDRESS_RECORD:
     2331    14967    3       DO SELECT( LIST);

  14967 14 012162   222477 236100       NEXT_ADDRES* LDQ     LIST,,AUTO
        14 012163   000030 116007                    CMPQ    24,DL
        14 012164   012171 602000 14                 TNC     NEXT_ADDRESS_RECORD+7
        14 012165   012177 600000 14                 TZE     s:14971
        14 012166   000040 116007                    CMPQ    32,DL
        14 012167   012204 601000 14                 TNZ     s:14975
        14 012170   012202 710000 14                 TRA     s:14973
        14 012171   000020 116007                    CMPQ    16,DL
        14 012172   012204 601000 14                 TNZ     s:14975
        14 012173   012174 710000 14                 TRA     s:14969

     2332    14968    3           SELECT( %VM_TYPE_TO);

     2333    14969    3               LIST = %VM_TYPE_C;

  14969 14 012174   000030 235007                    LDA     24,DL
        14 012175   222477 755100                    STA     LIST,,AUTO
        14 012176   012204 710000 14                 TRA     s:14975

     2334    14970    3           SELECT( %VM_TYPE_C);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:380  

     2335    14971    3               LIST = %VM_TYPE_BC;

  14971 14 012177   000040 235007                    LDA     32,DL
        14 012200   222477 755100                    STA     LIST,,AUTO
        14 012201   012204 710000 14                 TRA     s:14975

     2336    14972    3           SELECT( %VM_TYPE_BC);

     2337    14973    3               RETURN;

  14973 14 012202   222474 221300                    LDX1  ! TVAL+2,,AUTO
        14 012203   000001 702211                    TSX2  ! 1,X1

     2338    14974    3           END;

     2339    14975    2       GOTO READIT;

  14975 14 012204   011644 710000 14                 TRA     READIT

     2340    14976
     2341    14977    2       END READ_ADDRESS_RECORDS;
     2342    14978        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:381  
     2343    14979    1   COPY: PROC( SOURCE$, DEST$, DEST_LEN);

  14979 14 012205   222474 741300       COPY         STX1  ! TVAL+2,,AUTO

     2344    14980
     2345    14981    2       DCL DEST$ PTR;
     2346    14982    2       DCL DEST_LEN UBIN;
     2347    14983    2       DCL SOURCE$ PTR;
     2348    14984
     2349    14985    2       DEST$->CV.L = DEST_LEN;

  14985 14 012206   222476 470500                    LDP0    @DEST$,,AUTO
        14 012207   000000 471500                    LDP1    0,,PR0
        14 012210   222477 473500                    LDP3    @DEST_LEN,,AUTO
        14 012211   300000 235100                    LDA     0,,PR3
        14 012212   100000 755100                    STA     0,,PR1

     2350    14986    2       DEST$->CV.T = ' ';

  14986 14 012213   000000 471500                    LDP1    0,,PR0
        14 012214   100000 720100                    LXL0    0,,PR1
        14 012215   040140 100400                    MLR     fill='040'O
        14 012216   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 012217   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0

     2351    14987
     2352    14988    2       IF SOURCE$ = ADDR( NIL) THEN

  14988 14 012220   222475 471500                    LDP1    @SOURCE$,,AUTO
        14 012221   100000 236100                    LDQ     0,,PR1
        14 012222   000001 116000 xsym               CMPQ    B_VECTNIL+1
        14 012223   012227 601000 14                 TNZ     s:14991

     2353    14989    2           DEST$->CV.L = 0;

  14989 14 012224   000000 474500                    LDP4    0,,PR0
        14 012225   400000 450100                    STZ     0,,PR4
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:382  
        14 012226   012254 710000 14                 TRA     s:14994

     2354    14990    3       ELSE DO;

     2355    14991    3           DEST$->CV.L = MINIMUM( SOURCE$->TEXTC.L, DEST_LEN);

  14991 14 012227   000000 474500                    LDP4    0,,PR0
        14 012230   100000 475500                    LDP5    0,,PR1
        14 012231   000100 101500                    MRL     fill='000'O
        14 012232   500000 000001                    ADSC9   0,,PR5                   cn=0,n=1
        14 012233   222722 000004                    ADSC9   @VLEN+2,,AUTO            cn=0,n=4
        14 012234   222722 236100                    LDQ     @VLEN+2,,AUTO
        14 012235   300000 116100                    CMPQ    0,,PR3
        14 012236   012241 602000 14                 TNC     s:14991+10
        14 012237   012241 600000 14                 TZE     s:14991+10
        14 012240   300000 236100                    LDQ     0,,PR3
        14 012241   400000 756100                    STQ     0,,PR4

     2356    14992    3           DEST$->CV.T = SOURCE$->TEXTC.T;

  14992 14 012242   000000 474500                    LDP4    0,,PR0
        14 012243   400000 720100                    LXL0    0,,PR4
        14 012244   100000 475500                    LDP5    0,,PR1
        14 012245   000100 101500                    MRL     fill='000'O
        14 012246   500000 000001                    ADSC9   0,,PR5                   cn=0,n=1
        14 012247   222722 000002                    ADSC9   @VLEN+2,,AUTO            cn=0,n=2
        14 012250   222722 221100                    LDX1    @VLEN+2,,AUTO
        14 012251   040140 100540                    MLR     fill='040'O
        14 012252   500000 200011                    ADSC9   0,,PR5                   cn=1,n=*X1
        14 012253   400001 000010                    ADSC9   1,,PR4                   cn=0,n=*X0

     2357    14993    3           END;

     2358    14994    2       RETURN;

  14994 14 012254   222474 221300                    LDX1  ! TVAL+2,,AUTO
        14 012255   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:383  

     2359    14995
     2360    14996    2       END COPY;
     2361    14997        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:384  
     2362    14998    1   MAKE_SMTP_ADDRESS: PROC( CP6$, NAME$, ADDRESS$);

  14998 14 012256   222474 741300       MAKE_SMTP_A* STX1  ! TVAL+2,,AUTO

     2363    14999
     2364    15000    2       DCL ADDRESS$ PTR;
     2365    15001    2       DCL BLANK_INDEX UBIN WORD;
     2366    15002    2       DCL CP6$ PTR;
     2367    15003    2       DCL NAME$ PTR;
     2368    15004    2       DCL NAME_END UBIN WORD;
     2369    15005    2       DCL SITE_INDEX UBIN WORD;
     2370    15006    2       DCL TSTRING CHAR(80);
     2371    15007    2       DCL TVAL UBIN;
     2372    15008
     2373    15009    2       CALL INDEX1R( SITE_INDEX, '@', CP6$->CV.T) ALTRET( LOCAL);

  15009 14 012257   222475 470500                    LDP0    @CP6$,,AUTO
        14 012260   000000 471500                    LDP1    0,,PR0
        14 012261   100000 720100                    LXL0    0,,PR1
        14 012262   000000 636010                    EAQ     0,X0
        14 012263   000022 772000                    QRL     18
        14 012264   000000 125540                    SCMR    mask='000'O
        14 012265   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0
        14 012266   000022 000001 15                 ADSC9   18                       cn=0,n=1
        14 012267   222502 000100                    ARG     SITE_INDEX,,AUTO
        14 012270   012353 606400 14                 TTN     LOCAL
        14 012271   222502 054100                    AOS     SITE_INDEX,,AUTO
        14 012272   222502 156100                    SSQ     SITE_INDEX,,AUTO

     2374    15010    2       CALL XLATE( TSTRING, TCM_XLATE_TO_UC, SUBSTR( CP6$->CV.T, SITE_INDEX));

  15010 14 012273   000000 636010                    EAQ     0,X0
        14 012274   000022 772000                    QRL     18
        14 012275   222502 136100                    SBLQ    SITE_INDEX,,AUTO
        14 012276   000000 622006                    EAX2    0,QL
        14 012277   222502 235100                    LDA     SITE_INDEX,,AUTO
        14 012300   040100 160545                    MVT     fill='040'O
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:385  
        14 012301   100001 000012                    ADSC9   1,A,PR1                  cn=0,n=*X2
        14 012302   222503 000120                    ADSC9   TSTRING,,AUTO            cn=0,n=80
        14 012303   002465 000000 1                  ARG     TCM_XLATE_TO_UC

     2375    15011    3       IF SUBSTR( TSTRING, 1, CP6$->CV.L-SITE_INDEX-1) = VM_SITE.ORIGIN THEN DO;

  15011 14 012304   100000 236100                    LDQ     0,,PR1
        14 012305   222502 136100                    SBLQ    SITE_INDEX,,AUTO
        14 012306   777777 622006                    EAX2    -1,QL
        14 012307   040100 106540                    CMPC    fill='040'O
        14 012310   222503 200012                    ADSC9   TSTRING,,AUTO            cn=1,n=*X2
        14 012311   200005 000010                    ADSC9   VM_SITE+2,,AUTO          cn=0,n=8
        14 012312   012315 601000 14                 TNZ     s:15015

     2376    15012    3           CP6$->CV.L = SITE_INDEX;

  15012 14 012313   100000 755100                    STA     0,,PR1

     2377    15013    3           GOTO LOCAL;

  15013 14 012314   012353 710000 14                 TRA     LOCAL

     2378    15014    3           END;
     2379    15015    2       NAME$->CV.L = SITE_INDEX;

  15015 14 012315   222476 473500                    LDP3    @NAME$,,AUTO
        14 012316   300000 474500                    LDP4    0,,PR3
        14 012317   400000 755100                    STA     0,,PR4

     2380    15016    2       NAME$->CV.T = SUBSTR( CP6$->CV.T, 0, SITE_INDEX);

  15016 14 012320   300000 471500                    LDP1    0,,PR3
        14 012321   100000 720100                    LXL0    0,,PR1
        14 012322   000000 474500                    LDP4    0,,PR0
        14 012323   400000 721100                    LXL1    0,,PR4
        14 012324   000000 622005                    EAX2    0,AL
        14 012325   040140 100540                    MLR     fill='040'O
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:386  
        14 012326   400001 000012                    ADSC9   1,,PR4                   cn=0,n=*X2
        14 012327   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0

     2381    15017    2       ADDRESS$->CV.L = CP6$->CV.L;

  15017 14 012330   222477 471500                    LDP1    @ADDRESS$,,AUTO
        14 012331   100000 474500                    LDP4    0,,PR1
        14 012332   000000 475500                    LDP5    0,,PR0
        14 012333   500000 235100                    LDA     0,,PR5
        14 012334   400000 755100                    STA     0,,PR4

     2382    15018    2       ADDRESS$->CV.T = CP6$->CV.T;

  15018 14 012335   100000 474500                    LDP4    0,,PR1
        14 012336   400000 720100                    LXL0    0,,PR4
        14 012337   000000 475500                    LDP5    0,,PR0
        14 012340   500000 721100                    LXL1    0,,PR5
        14 012341   040140 100540                    MLR     fill='040'O
        14 012342   500001 000011                    ADSC9   1,,PR5                   cn=0,n=*X1
        14 012343   400001 000010                    ADSC9   1,,PR4                   cn=0,n=*X0

     2383    15019    2       SUBSTR(ADDRESS$->CV.T,SITE_INDEX,1) = '%';

  15019 14 012344   100000 474500                    LDP4    0,,PR1
        14 012345   400000 720100                    LXL0    0,,PR4
        14 012346   222502 235100                    LDA     SITE_INDEX,,AUTO
        14 012347   040105 100400                    MLR     fill='040'O
        14 012350   000057 000001 15                 ADSC9   47                       cn=0,n=1
        14 012351   400001 000001                    ADSC9   1,A,PR4                  cn=0,n=1

     2384    15020    2       GOTO UNDERBLANK;

  15020 14 012352   012546 710000 14                 TRA     UNDERBLANK

     2385    15021    2   LOCAL:
     2386    15022    3       IF SUBSTR( CP6$->CV.T, 0, 1) = '.' THEN DO;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:387  
  15022 14 012353   222475 470500       LOCAL        LDP0    @CP6$,,AUTO
        14 012354   000000 471500                    LDP1    0,,PR0
        14 012355   100000 720100                    LXL0    0,,PR1
        14 012356   100001 236100                    LDQ     1,,PR1
        14 012357   777000 376003                    ANQ     -512,DU
        14 012360   056000 116003                    CMPQ    23552,DU
        14 012361   012434 601000 14                 TNZ     s:15037

     2387    15023                /* rewrite .account or .account/folder */
     2388    15024    3           CALL INDEX( TVAL, '/', CP6$->CV.T)

  15024 14 012362   000000 124540                    SCM     mask='000'O
        14 012363   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0
        14 012364   000170 000001 15                 ADSC9   120                      cn=0,n=1
        14 012365   222527 000100                    ARG     TVAL,,AUTO
        14 012366   012407 606400 14                 TTN     s:15031

     2389    15025    4           WHENRETURN DO;

     2390    15026    4               CALL CONCAT( TSTRING,

  15026 14 012367   100000 236100                    LDQ     0,,PR1
        14 012370   222527 136100                    SBLQ    TVAL,,AUTO
        14 012371   000000 621006                    EAX1    0,QL
        14 012372   222527 235100                    LDA     TVAL,,AUTO
        14 012373   040100 100545                    MLR     fill='040'O
        14 012374   100001 000011                    ADSC9   1,A,PR1                  cn=0,n=*X1
        14 012375   222503 000120                    ADSC9   TSTRING,,AUTO            cn=0,n=80
        14 012376   000120 116007                    CMPQ    80,DL
        14 012377   012406 605000 14                 TPL     s:15029
        14 012400   777657 621006                    EAX1    -81,QL
        14 012401   777777 661003                    ERX1    -1,DU
        14 012402   000000 622005                    EAX2    0,AL
        14 012403   040146 100540                    MLR     fill='040'O
        14 012404   100001 000012                    ADSC9   1,,PR1                   cn=0,n=*X2
        14 012405   222503 000011                    ADSC9   TSTRING,Q,AUTO           cn=0,n=*X1

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:388  
     2391    15027    4                       SUBSTR( CP6$->CV.T, TVAL, CP6$->CV.L - TVAL),
     2392    15028    4                       SUBSTR( CP6$->CV.T, 0, TVAL));
     2393    15029    4               END;

  15029 14 012406   012425 710000 14                 TRA     s:15034

     2394    15030    4           WHENALTRETURN DO;

     2395    15031    4               CALL CONCAT( TSTRING, '/CENTRAL', CP6$->CV.T);

  15031 14 012407   222475 470500                    LDP0    @CP6$,,AUTO
        14 012410   000000 471500                    LDP1    0,,PR0
        14 012411   100000 720100                    LXL0    0,,PR1
        14 012412   003126 237000 1                  LDAQ    TCM_XLATE_TO_UC+289
        14 012413   222503 755100                    STA     TSTRING,,AUTO
        14 012414   222504 756100                    STQ     TSTRING+1,,AUTO
        14 012415   040100 100540                    MLR     fill='040'O
        14 012416   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0
        14 012417   222505 000110                    ADSC9   TSTRING+2,,AUTO          cn=0,n=72

     2396    15032    4               CP6$->CV.L = 8 + CP6$->CV.L;

  15032 14 012420   222475 470500                    LDP0    @CP6$,,AUTO
        14 012421   000000 471500                    LDP1    0,,PR0
        14 012422   100000 235100                    LDA     0,,PR1
        14 012423   000010 035007                    ADLA    8,DL
        14 012424   100000 755100                    STA     0,,PR1

     2397    15033    4               END;

     2398    15034    3           CP6$->CV.T = SUBSTR( TSTRING, 0, CP6$->CV.L);

  15034 14 012425   000000 471500                    LDP1    0,,PR0
        14 012426   100000 720100                    LXL0    0,,PR1
        14 012427   222722 740100                    STX0    @VLEN+2,,AUTO
        14 012430   222722 221100                    LDX1    @VLEN+2,,AUTO
        14 012431   040140 100540                    MLR     fill='040'O
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:389  
        14 012432   222503 000010                    ADSC9   TSTRING,,AUTO            cn=0,n=*X0
        14 012433   100001 000011                    ADSC9   1,,PR1                   cn=0,n=*X1

     2399    15035    3           END;

     2400    15036            /* undo CP-6 MAIL 'feature' of enquoted names.. */
     2401    15037    3       IF SUBSTR( CP6$->CV.T, 0, 1) = '''' THEN DO;

  15037 14 012434   000000 471500                    LDP1    0,,PR0
        14 012435   100000 720100                    LXL0    0,,PR1
        14 012436   100001 236100                    LDQ     1,,PR1
        14 012437   777000 376003                    ANQ     -512,DU
        14 012440   047000 116003                    CMPQ    19968,DU
        14 012441   012472 601000 14                 TNZ     s:15045

     2402    15038    3           CALL INDEX1R( NAME_END, '''', CP6$->CV.T);

  15038 14 012442   000000 636010                    EAQ     0,X0
        14 012443   000022 772000                    QRL     18
        14 012444   000000 125540                    SCMR    mask='000'O
        14 012445   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0
        14 012446   000171 000001 15                 ADSC9   121                      cn=0,n=1
        14 012447   222501 000100                    ARG     NAME_END,,AUTO
        14 012450   012453 606400 14                 TTN     s:15040
        14 012451   222501 054100                    AOS     NAME_END,,AUTO
        14 012452   222501 156100                    SSQ     NAME_END,,AUTO

     2403    15039                /* handle the case where there is no end quote */
     2404    15040    3           IF (NAME_END = 0) THEN NAME_END = CP6$->CV.L;

  15040 14 012453   222501 235100                    LDA     NAME_END,,AUTO
        14 012454   012457 601000 14                 TNZ     s:15041

  15040 14 012455   100000 235100                    LDA     0,,PR1
        14 012456   222501 755100                    STA     NAME_END,,AUTO

     2405    15041    3           CALL CONCAT( TSTRING, SUBSTR( CP6$->CV.T, 1, NAME_END-1));
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:390  

  15041 14 012457   777777 621005                    EAX1    -1,AL
        14 012460   040100 100540                    MLR     fill='040'O
        14 012461   100001 200011                    ADSC9   1,,PR1                   cn=1,n=*X1
        14 012462   222503 000120                    ADSC9   TSTRING,,AUTO            cn=0,n=80

     2406    15042    3           CP6$->CV.L = NAME_END - 1;

  15042 14 012463   000001 135007                    SBLA    1,DL
        14 012464   100000 755100                    STA     0,,PR1

     2407    15043    3           CP6$->CV.T = TSTRING;

  15043 14 012465   000000 471500                    LDP1    0,,PR0
        14 012466   100000 720100                    LXL0    0,,PR1
        14 012467   040140 100500                    MLR     fill='040'O
        14 012470   222503 000120                    ADSC9   TSTRING,,AUTO            cn=0,n=80
        14 012471   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0

     2408    15044    3           END;

     2409    15045    2       CALL SEARCHR( NAME_END, TVAL, SKIP_BLANKS, CP6$->CV.T);

  15045 14 012472   000000 471500                    LDP1    0,,PR0
        14 012473   100000 720100                    LXL0    0,,PR1
        14 012474   000000 636010                    EAQ     0,X0
        14 012475   000022 772000                    QRL     18
        14 012476   000000 165540                    TCTR
        14 012477   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0
        14 012500   002144 000000 1                  ARG     SKIP_BLANKS
        14 012501   222501 000100                    ARG     NAME_END,,AUTO
        14 012502   222501 235100                    LDA     NAME_END,,AUTO
        14 012503   000033 771000                    ARL     27
        14 012504   222527 755100                    STA     TVAL,,AUTO
        14 012505   222501 551140                    STBA    NAME_END,'40'O,AUTO
        14 012506   012511 606400 14                 TTN     s:15046
        14 012507   222501 054100                    AOS     NAME_END,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:391  
        14 012510   222501 156100                    SSQ     NAME_END,,AUTO

     2410    15046    2       IF CP6$->CV.L > 0 THEN

  15046 14 012511   000000 116003                    CMPQ    0,DU
        14 012512   012516 600000 14                 TZE     s:15048

     2411    15047    2           NAME_END = NAME_END + 1;

  15047 14 012513   222501 235100                    LDA     NAME_END,,AUTO
        14 012514   000001 035007                    ADLA    1,DL
        14 012515   222501 755100                    STA     NAME_END,,AUTO

     2412    15048    2       NAME$->CV.L = NAME_END;

  15048 14 012516   222476 473500                    LDP3    @NAME$,,AUTO
        14 012517   300000 474500                    LDP4    0,,PR3
        14 012520   222501 235100                    LDA     NAME_END,,AUTO
        14 012521   400000 755100                    STA     0,,PR4

     2413    15049    2       NAME$->CV.T = SUBSTR( CP6$->CV.T, 0, NAME_END);

  15049 14 012522   300000 471500                    LDP1    0,,PR3
        14 012523   100000 720100                    LXL0    0,,PR1
        14 012524   000000 474500                    LDP4    0,,PR0
        14 012525   400000 721100                    LXL1    0,,PR4
        14 012526   000000 622005                    EAX2    0,AL
        14 012527   040140 100540                    MLR     fill='040'O
        14 012530   400001 000012                    ADSC9   1,,PR4                   cn=0,n=*X2
        14 012531   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0

     2414    15050    2       ADDRESS$->CV.L = NAME_END;

  15050 14 012532   222477 471500                    LDP1    @ADDRESS$,,AUTO
        14 012533   100000 474500                    LDP4    0,,PR1
        14 012534   222501 235100                    LDA     NAME_END,,AUTO
        14 012535   400000 755100                    STA     0,,PR4
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:392  

     2415    15051    2       ADDRESS$->CV.T = SUBSTR( CP6$->CV.T, 0, NAME_END);

  15051 14 012536   100000 474500                    LDP4    0,,PR1
        14 012537   400000 720100                    LXL0    0,,PR4
        14 012540   000000 475500                    LDP5    0,,PR0
        14 012541   500000 721100                    LXL1    0,,PR5
        14 012542   000000 622005                    EAX2    0,AL
        14 012543   040140 100540                    MLR     fill='040'O
        14 012544   500001 000012                    ADSC9   1,,PR5                   cn=0,n=*X2
        14 012545   400001 000010                    ADSC9   1,,PR4                   cn=0,n=*X0

     2416    15052    2   UNDERBLANK:
     2417    15053        /* Scan name;  turn blanks into underscores so that our addresses will fit
     2418    15054           in with the ARPA conventions.  Inverse mapping is performed by NETMAIL
     2419    15055           when we receive stuff from ARPA.                                     */
     2420    15056    2       CALL INDEX( BLANK_INDEX, ' ', ADDRESS$->CV.T);

  15056 14 012546   100000 474500       UNDERBLANK   LDP4    0,,PR1
        14 012547   400000 720100                    LXL0    0,,PR4
        14 012550   000000 124540                    SCM     mask='000'O
        14 012551   400001 000010                    ADSC9   1,,PR4                   cn=0,n=*X0
        14 012552   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 012553   222500 000100                    ARG     BLANK_INDEX,,AUTO

     2421    15057    3       DO WHILE( BLANK_INDEX < ADDRESS$->CV.L);

  15057 14 012554   222500 236100                    LDQ     BLANK_INDEX,,AUTO
        14 012555   400000 116100                    CMPQ    0,,PR4
        14 012556   012577 603000 14                 TRC     s:15061

     2422    15058    3           SUBSTR( ADDRESS$->CV.T, BLANK_INDEX, 1) = '_';

  15058 14 012557   222477 470500                    LDP0    @ADDRESS$,,AUTO
        14 012560   000000 471500                    LDP1    0,,PR0
        14 012561   100000 720100                    LXL0    0,,PR1
        14 012562   222500 235100                    LDA     BLANK_INDEX,,AUTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:393  
        14 012563   040105 100400                    MLR     fill='040'O
        14 012564   000172 000001 15                 ADSC9   122                      cn=0,n=1
        14 012565   100001 000001                    ADSC9   1,A,PR1                  cn=0,n=1

     2423    15059    3           CALL INDEX( BLANK_INDEX, ' ', ADDRESS$->CV.T);

  15059 14 012566   000000 471500                    LDP1    0,,PR0
        14 012567   100000 720100                    LXL0    0,,PR1
        14 012570   000000 124540                    SCM     mask='000'O
        14 012571   100001 000010                    ADSC9   1,,PR1                   cn=0,n=*X0
        14 012572   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 012573   222500 000100                    ARG     BLANK_INDEX,,AUTO

     2424    15060    3           END;

  15060 14 012574   222500 236100                    LDQ     BLANK_INDEX,,AUTO
        14 012575   100000 116100                    CMPQ    0,,PR1
        14 012576   012557 602000 14                 TNC     s:15058

     2425    15061    2       RETURN;

  15061 14 012577   222474 221300                    LDX1  ! TVAL+2,,AUTO
        14 012600   000001 702211                    TSX2  ! 1,X1

     2426    15062
     2427    15063    2       END MAKE_SMTP_ADDRESS;
     2428    15064        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:394  
     2429    15065    1   WRITE_MAIL_MESSAGE: PROC;

  15065 14 012601   222610 741300       WRITE_MAIL_* STX1  ! ALTRETURNED,,AUTO

     2430    15066
     2431    15067    2       CALL GET_IOBUF_BOUND( MSGBUF, VLEN);

  15067 14 012602   200104 630500                    EPPR0   VLEN,,AUTO
        14 012603   222720 450500                    STP0    @BUF+1,,AUTO
        14 012604   000173 236000 15                 LDQ     123
        14 012605   222717 756100                    STQ     @MSG+2,,AUTO
        14 012606   013576 701000 14                 TSX1    GET_IOBUF_BOUND
        14 012607   000000 011000                    NOP     0

     2432    15068    2       WRITE_MAILMSG.BUF_.BOUND = VLEN;

  15068 14 012610   200104 236100                    LDQ     VLEN,,AUTO
        14 012611   000020 736000                    QLS     16
        14 012612   000206 676000 6                  ERQ     WRITE_MAILMSG+4
        14 012613   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 012614   000206 656000 6                  ERSQ    WRITE_MAILMSG+4

     2433    15069    2       CALL M$WRITE( WRITE_MAILMSG);

  15069 14 012615   000202 630400 6                  EPPR0   WRITE_MAILMSG
        14 012616   040001 713400                    CLIMB   write
        14 012617   401400 401760                    pmme    nvectors=4

     2434    15070    2       RETURN;

  15070 14 012620   222610 221300                    LDX1  ! ALTRETURNED,,AUTO
        14 012621   000001 702211                    TSX2  ! 1,X1

     2435    15071
     2436    15072    2       END WRITE_MAIL_MESSAGE;
     2437    15073        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:395  
     2438    15074    1   DELETE_MESSAGE: PROC;

  15074 14 012622   222606 741300       DELETE_MESS* STX1  ! LEN_TARGET+1,,AUTO

     2439    15075
     2440    15076    2       CALL STATUS_UPDATE( DELETING_MESSAGE);

  15076 14 012623   000174 236000 15                 LDQ     124
        14 012624   222715 756100                    STQ     LAST+2,,AUTO
        14 012625   013522 701000 14                 TSX1    STATUS_UPDATE
        14 012626   000000 011000                    NOP     0

     2441    15077    3       IF MESSAGE_FILE THEN DO;

  15077 14 012627   200141 234100                    SZN     MESSAGE_FILE,,AUTO
        14 012630   012640 605000 14                 TPL     s:15083

     2442    15078    3           CALL M$CLOSE( ZAP_FOLDER)

  15078 14 012631   000434 630400 1                  EPPR0   ZAP_FOLDER
        14 012632   450001 713400                    CLIMB   alt,close
        14 012633   406000 401760                    pmme    nvectors=13
        14 012634   012636 702000 14                 TSX2    s:15081
        14 012635   012636 710000 14                 TRA     s:15081

     2443    15079    4           WHENALTRETURN DO;

     2444    15080    4               END;

     2445    15081    3           RETURN;

  15081 14 012636   222606 221300                    LDX1  ! LEN_TARGET+1,,AUTO
        14 012637   000001 702211                    TSX2  ! 1,X1

     2446    15082    3           END;
     2447    15083    2       READ_FOLDER.BUF_ = VECTOR( VM_HEADER);

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:396  
  15083 14 012640   000133 235000 15                 LDA     91
        14 012641   222345 236100                    LDQ     HEADER$,,AUTO
        14 012642   000124 757000 6                  STAQ    READ_FOLDER+4

     2448    15084    2       READ_FOLDER.BUF_.BOUND = 4095;

  15084 14 012643   000124 236000 6                  LDQ     READ_FOLDER+4
        14 012644   177777 376007                    ANQ     65535,DL
        14 012645   000121 276000 15                 ORQ     81
        14 012646   000124 756000 6                  STQ     READ_FOLDER+4

     2449    15085    2       READ_FOLDER.KEY_ = VECTOR( VM_INFOKEY);

  15085 14 012647   000112 237000 15                 LDAQ    74
        14 012650   000122 757000 6                  STAQ    READ_FOLDER+2

     2450    15086    2       READ_FOLDER.V.KEYS# = %YES#;

  15086 14 012651   200000 236007                    LDQ     65536,DL
        14 012652   000130 256000 6                  ORSQ    READ_FOLDER+8

     2451    15087    2       READ_FOLDER.V.KEYR# = %NO#;

  15087 14 012653   000165 236000 15                 LDQ     117
        14 012654   000130 356000 6                  ANSQ    READ_FOLDER+8

     2452    15088    2       VM_INFOKEY.COUNT = LENGTHC( VM_INFOKEY) - 1;

  15088 14 012655   005000 236003                    LDQ     2560,DU
        14 012656   001032 552040 6                  STBQ    VM_INFOKEY,'40'O

     2453    15089    2       VM_INFOKEY.TYPE = %VM_TYPE_HEAD;

  15089 14 012657   000010 236003                    LDQ     8,DU
        14 012660   001032 552020 6                  STBQ    VM_INFOKEY,'20'O

     2454    15090    2       VM_INFOKEY.MESSAGE_NUMBER = MSG_NUMBER;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:397  

  15090 14 012661   000000 100500                    MLR     fill='000'O
        14 012662   222343 000004                    ADSC9   MSG_NUMBER,,AUTO         cn=0,n=4
        14 012663   001032 400004 6                  ADSC9   VM_INFOKEY               cn=2,n=4

     2455    15091    2       CALL M$READ( READ_FOLDER);

  15091 14 012664   000120 630400 6                  EPPR0   READ_FOLDER
        14 012665   040000 713400                    CLIMB   read
        14 012666   401400 401760                    pmme    nvectors=4

     2456    15092    2       VM_HEADER.STATUS.DEL = %YES#;

  15092 14 012667   222345 470500                    LDP0    HEADER$,,AUTO
        14 012670   000400 236003                    LDQ     256,DU
        14 012671   000012 256100                    ORSQ    10,,PR0

     2457    15093    2       VM_HEADER.STATUS.OLD = %YES#;

  15093 14 012672   004000 236003                    LDQ     2048,DU
        14 012673   000012 256100                    ORSQ    10,,PR0

     2458    15094    2       VM_HEADER.STATUS.EXAM = %YES#;

  15094 14 012674   001000 236003                    LDQ     512,DU
        14 012675   000012 256100                    ORSQ    10,,PR0

     2459    15095    2       VM_HEADER.STATUS.RR = %NO#;

  15095 14 012676   000175 236000 15                 LDQ     125
        14 012677   000012 356100                    ANSQ    10,,PR0

     2460    15096    2       WRITE_FOLDER.BUF_ = VECTOR( VM_HEADER);

  15096 14 012700   000133 235000 15                 LDA     91
        14 012701   222345 236100                    LDQ     HEADER$,,AUTO
        14 012702   000172 757000 6                  STAQ    WRITE_FOLDER+4
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:398  

     2461    15097    2       WRITE_FOLDER.BUF_.BOUND = M$FOLDER$->F$DCB.ARS# - 1;

  15097 14 012703   200077 471500                    LDP1    M$FOLDER$,,AUTO
        14 012704   100000 236100                    LDQ     0,,PR1
        14 012705   000001 136007                    SBLQ    1,DL
        14 012706   000020 736000                    QLS     16
        14 012707   000172 676000 6                  ERQ     WRITE_FOLDER+4
        14 012710   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 012711   000172 656000 6                  ERSQ    WRITE_FOLDER+4

     2462    15098    2       WRITE_FOLDER.KEY_ = VECTOR( VM_INFOKEY);

  15098 14 012712   000112 237000 15                 LDAQ    74
        14 012713   000170 757000 6                  STAQ    WRITE_FOLDER+2

     2463    15099    2       WRITE_FOLDER.V.ONEWKEY# = %YES#;

  15099 14 012714   000400 236007                    LDQ     256,DL
        14 012715   000176 256000 6                  ORSQ    WRITE_FOLDER+8

     2464    15100    2       CALL M$WRITE( WRITE_FOLDER);

  15100 14 012716   000166 630400 6                  EPPR0   WRITE_FOLDER
        14 012717   040001 713400                    CLIMB   write
        14 012720   401400 401760                    pmme    nvectors=4

     2465    15101    2       CALL M$DEQ( DEQ_ON_HEADER)

  15101 14 012721   000606 630400 1                  EPPR0   DEQ_ON_HEADER
        14 012722   420003 713400                    CLIMB   alt,+8195
        14 012723   401000 401760                    pmme    nvectors=3
        14 012724   012726 702000 14                 TSX2    s:15104
        14 012725   012726 710000 14                 TRA     s:15104

     2466    15102    3       WHENALTRETURN DO;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:399  
     2467    15103    3           END;

     2468    15104    2       CALL M$ENQ( ENQ_ON_PROFILE);

  15104 14 012726   000530 630400 1                  EPPR0   ENQ_ON_PROFILE
        14 012727   020002 713400                    CLIMB   8194
        14 012730   401000 401760                    pmme    nvectors=3

     2469    15105    2       READ_FOLDER.BUF_ = VECTOR( VM_PROFILE);

  15105 14 012731   000176 235000 15                 LDA     126
        14 012732   222344 236100                    LDQ     PROFILE$,,AUTO
        14 012733   000124 757000 6                  STAQ    READ_FOLDER+4

     2470    15106    2       READ_FOLDER.BUF_.BOUND = 4095;

  15106 14 012734   000124 236000 6                  LDQ     READ_FOLDER+4
        14 012735   177777 376007                    ANQ     65535,DL
        14 012736   000121 276000 15                 ORQ     81
        14 012737   000124 756000 6                  STQ     READ_FOLDER+4

     2471    15107    2       READ_FOLDER.KEY_ = VECTOR( VM_PROKEY);

  15107 14 012740   000200 237000 15                 LDAQ    128
        14 012741   000122 757000 6                  STAQ    READ_FOLDER+2

     2472    15108    2       READ_FOLDER.V.KEYS# = %YES#;

  15108 14 012742   200000 236007                    LDQ     65536,DL
        14 012743   000130 256000 6                  ORSQ    READ_FOLDER+8

     2473    15109    2       READ_FOLDER.V.KEYR# = %NO#;

  15109 14 012744   000165 236000 15                 LDQ     117
        14 012745   000130 356000 6                  ANSQ    READ_FOLDER+8

     2474    15110    2       CALL M$READ( READ_FOLDER);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:400  

  15110 14 012746   000120 630400 6                  EPPR0   READ_FOLDER
        14 012747   040000 713400                    CLIMB   read
        14 012750   401400 401760                    pmme    nvectors=4

     2475    15111    2       VM_PROFILE.NUM_DEL_MESSAGES = VM_PROFILE.NUM_DEL_MESSAGES + 1;

  15111 14 012751   222344 470500                    LDP0    PROFILE$,,AUTO
        14 012752   000007 235100                    LDA     7,,PR0
        14 012753   000001 035007                    ADLA    1,DL
        14 012754   000007 755100                    STA     7,,PR0

     2476    15112    2       VM_PROFILE.RECS_DELETED = VM_PROFILE.RECS_DELETED + VM_HEADER.NUM_RECORDS;

  15112 14 012755   222345 471500                    LDP1    HEADER$,,AUTO
        14 012756   000135 236100                    LDQ     93,,PR0
        14 012757   100011 036100                    ADLQ    9,,PR1
        14 012760   000135 756100                    STQ     93,,PR0

     2477    15113    2       WRITE_FOLDER.BUF_ = VECTOR( VM_PROFILE);

  15113 14 012761   000176 235000 15                 LDA     126
        14 012762   222344 236100                    LDQ     PROFILE$,,AUTO
        14 012763   000172 757000 6                  STAQ    WRITE_FOLDER+4

     2478    15114    2       WRITE_FOLDER.BUF_.BOUND = DCBADDR( DCBNUM( M$FOLDER))->F$DCB.ARS# - 1;

  15114 14 012764   000000 236007 xsym               LDQ     M$FOLDER,DL
        14 012765   000000 473400 15                 LDP3    0
        14 012766   300000 474500                    LDP4    0,,PR3
        14 012767   400000 475506                    LDP5    0,QL,PR4
        14 012770   500000 236100                    LDQ     0,,PR5
        14 012771   000001 136007                    SBLQ    1,DL
        14 012772   000020 736000                    QLS     16
        14 012773   000172 676000 6                  ERQ     WRITE_FOLDER+4
        14 012774   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 012775   000172 656000 6                  ERSQ    WRITE_FOLDER+4
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:401  

     2479    15115    2       WRITE_FOLDER.KEY_ = VECTOR( VM_PROKEY);

  15115 14 012776   000200 237000 15                 LDAQ    128
        14 012777   000170 757000 6                  STAQ    WRITE_FOLDER+2

     2480    15116    2       WRITE_FOLDER.V.ONEWKEY# = %YES#;

  15116 14 013000   000400 236007                    LDQ     256,DL
        14 013001   000176 256000 6                  ORSQ    WRITE_FOLDER+8

     2481    15117    2       CALL M$WRITE( WRITE_FOLDER);

  15117 14 013002   000166 630400 6                  EPPR0   WRITE_FOLDER
        14 013003   040001 713400                    CLIMB   write
        14 013004   401400 401760                    pmme    nvectors=4

     2482    15118    2       CALL M$DEQ( DEQ_ON_PROFILE);

  15118 14 013005   000542 630400 1                  EPPR0   DEQ_ON_PROFILE
        14 013006   020003 713400                    CLIMB   8195
        14 013007   401000 401760                    pmme    nvectors=3

     2483    15119    2       RETURN;

  15119 14 013010   222606 221300                    LDX1  ! LEN_TARGET+1,,AUTO
        14 013011   000001 702211                    TSX2  ! 1,X1

     2484    15120
     2485    15121    2       END DELETE_MESSAGE;
     2486    15122        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:402  
     2487    15123    1   POST_MESSAGE_ACKNOWLEDGEMENT: PROC( SITENAME);

  15123 14 013012   222606 741300       POST_MESSAG* STX1  ! LEN_TARGET+1,,AUTO

     2488    15124
     2489    15125    2       DCL 1 SITENAME,
     2490    15126    2            2 COUNT UBIN BYTE CALIGNED,
     2491    15127    2            2 TEXT CHAR( SITENAME.COUNT);
     2492    15128
     2493    15129    2       IF VM_HEADER.STATUS.ERR THEN

  15129 14 013013   222345 470500                    LDP0    HEADER$,,AUTO
        14 013014   000012 234100                    SZN     10,,PR0
        14 013015   013017 605000 14                 TPL     s:15131

     2494    15130    2           RETURN;

  15130 14 013016   000001 702211                    TSX2  ! 1,X1

     2495    15131    2       CALL STATUS_UPDATE( ACKNOWLEDGING_MESSAGE);

  15131 14 013017   000177 236000 15                 LDQ     127
        14 013020   222715 756100                    STQ     LAST+2,,AUTO
        14 013021   013522 701000 14                 TSX1    STATUS_UPDATE
        14 013022   000000 011000                    NOP     0

     2496    15132    2       IF FROM$->CV.T = 'SCOTTY' THEN

  15132 14 013023   002447 470400 1                  LDP0    FROM$
        14 013024   000000 720100                    LXL0    0,,PR0
        14 013025   040000 106540                    CMPC    fill='040'O
        14 013026   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 013027   003130 000006 1                  ADSC9   TCM_XLATE_TO_UC+291      cn=0,n=6
        14 013030   013033 601000 14                 TNZ     s:15134

     2497    15133    2           RETURN;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:403  
  15133 14 013031   222606 221300                    LDX1  ! LEN_TARGET+1,,AUTO
        14 013032   000001 702211                    TSX2  ! 1,X1

     2498    15134    2       CALL M$OPEN( OPEN_MAILMSG);

  15134 14 013033   000616 630400 1                  EPPR0   OPEN_MAILMSG
        14 013034   050000 713400                    CLIMB   open
        14 013035   410400 401760                    pmme    nvectors=18

     2499    15135    2       CALL CONCAT( MSGBUF, HDRTO, REPLY_TO$->CV.T);

  15135 14 013036   002452 470400 1                  LDP0    REPLY_TO$
        14 013037   000000 720100                    LXL0    0,,PR0
        14 013040   002356 236000 1                  LDQ     HDRTO
        14 013041   002210 756000 6                  STQ     MSGBUF
        14 013042   040000 100540                    MLR     fill='040'O
        14 013043   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 013044   002211 000373 6                  ADSC9   MSGBUF+1                 cn=0,n=251

     2500    15136    2       CALL WRITE_MAIL_MESSAGE;

  15136 14 013045   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013046   000000 011000                    NOP     0

     2501    15137    3       IF TCM_STUCKEE ~= ' ' THEN DO;

  15137 14 013047   040000 106400                    CMPC    fill='040'O
        14 013050   001175 000040 6                  ADSC9   TCM_STUCKEE              cn=0,n=32
        14 013051   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 013052   013063 600000 14                 TZE     s:15141

     2502    15138    3           CALL CONCAT( MSGBUF, 'Reply To:', TCM_STUCKEE);

  15138 14 013053   040000 100400                    MLR     fill='040'O
        14 013054   003132 000011 1                  ADSC9   TCM_XLATE_TO_UC+293      cn=0,n=9
        14 013055   002210 000011 6                  ADSC9   MSGBUF                   cn=0,n=9
        14 013056   040000 100400                    MLR     fill='040'O
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:404  
        14 013057   001175 000040 6                  ADSC9   TCM_STUCKEE              cn=0,n=32
        14 013060   002212 200366 6                  ADSC9   MSGBUF+2                 cn=1,n=246

     2503    15139    3           CALL WRITE_MAIL_MESSAGE;

  15139 14 013061   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013062   000000 011000                    NOP     0

     2504    15140    3           END;

     2505    15141    2       CALL CONCAT( MSGBUF, 'SUBJECT:Your SMTP mailgram was accepted at ', SITENAME.
             15141                TEXT);

  15141 14 013063   222607 470500                    LDP0    @SITENAME,,AUTO
        14 013064   000100 101500                    MRL     fill='000'O
        14 013065   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        14 013066   222722 000002                    ADSC9   @VLEN+2,,AUTO            cn=0,n=2
        14 013067   222722 220100                    LDX0    @VLEN+2,,AUTO
        14 013070   040000 100400                    MLR     fill='040'O
        14 013071   003135 000053 1                  ADSC9   TCM_XLATE_TO_UC+296      cn=0,n=43
        14 013072   002210 000053 6                  ADSC9   MSGBUF                   cn=0,n=43
        14 013073   040000 100540                    MLR     fill='040'O
        14 013074   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
        14 013075   002222 600324 6                  ADSC9   MSGBUF+10                cn=3,n=212

     2506    15142    2       CALL WRITE_MAIL_MESSAGE;

  15142 14 013076   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013077   000000 011000                    NOP     0

     2507    15143    3       IF VM_HEADER.STATUS.DR OR VM_HEADER.STATUS.RR THEN DO;

  15143 14 013100   222345 470500                    LDP0    HEADER$,,AUTO
        14 013101   000012 236100                    LDQ     10,,PR0
        14 013102   000004 316003                    CANQ    4,DU
        14 013103   013106 601000 14                 TNZ     s:15144
        14 013104   020000 316003                    CANQ    8192,DU
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:405  
        14 013105   013153 600000 14                 TZE     s:15153

     2508    15144    3           CALL CONCAT( MSGBUF, 'TYPE:RR');

  15144 14 013106   040000 100400                    MLR     fill='040'O
        14 013107   003150 000007 1                  ADSC9   TCM_XLATE_TO_UC+307      cn=0,n=7
        14 013110   002210 000377 6                  ADSC9   MSGBUF                   cn=0,n=255

     2509    15145    3           CALL WRITE_MAIL_MESSAGE;

  15145 14 013111   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013112   000000 011000                    NOP     0

     2510    15146    3           CALL CONCAT( MSGBUF, 'REF ID:', VM_HEADER.UNIQUE_ID$->TEXTC.T);

  15146 14 013113   222345 470500                    LDP0    HEADER$,,AUTO
        14 013114   000032 471500                    LDP1    26,,PR0
        14 013115   000100 101500                    MRL     fill='000'O
        14 013116   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        14 013117   222722 000002                    ADSC9   @VLEN+2,,AUTO            cn=0,n=2
        14 013120   222722 220100                    LDX0    @VLEN+2,,AUTO
        14 013121   040000 100400                    MLR     fill='040'O
        14 013122   003152 000007 1                  ADSC9   TCM_XLATE_TO_UC+309      cn=0,n=7
        14 013123   002210 000007 6                  ADSC9   MSGBUF                   cn=0,n=7
        14 013124   040000 100540                    MLR     fill='040'O
        14 013125   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0
        14 013126   002211 600370 6                  ADSC9   MSGBUF+1                 cn=3,n=248

     2511    15147    3           CALL WRITE_MAIL_MESSAGE;

  15147 14 013127   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013130   000000 011000                    NOP     0

     2512    15148    4           IF VM_HEADER.REFERENCE$ ~= ADDR( NIL) THEN DO;

  15148 14 013131   222345 470500                    LDP0    HEADER$,,AUTO
        14 013132   000024 236100                    LDQ     20,,PR0
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:406  
        14 013133   000001 116000 xsym               CMPQ    B_VECTNIL+1
        14 013134   013153 600000 14                 TZE     s:15153

     2513    15149    4               CALL CONCAT( MSGBUF, 'RE:', VM_HEADER.REFERENCE$->TEXTC.T);

  15149 14 013135   000024 471500                    LDP1    20,,PR0
        14 013136   000100 101500                    MRL     fill='000'O
        14 013137   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        14 013140   222722 000002                    ADSC9   @VLEN+2,,AUTO            cn=0,n=2
        14 013141   222722 220100                    LDX0    @VLEN+2,,AUTO
        14 013142   003154 236000 1                  LDQ     TCM_XLATE_TO_UC+311
        14 013143   000052 376000 15                 ANQ     42
        14 013144   000040 276007                    ORQ     32,DL
        14 013145   002210 756000 6                  STQ     MSGBUF
        14 013146   040000 100540                    MLR     fill='040'O
        14 013147   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0
        14 013150   002210 600374 6                  ADSC9   MSGBUF                   cn=3,n=252

     2514    15150    4               CALL WRITE_MAIL_MESSAGE;

  15150 14 013151   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013152   000000 011000                    NOP     0

     2515    15151    4               END;

     2516    15152    3           END;

     2517    15153    3       IF TO$->CV.L > 0 THEN DO;

  15153 14 013153   002456 470400 1                  LDP0    TO$
        14 013154   000000 235100                    LDA     0,,PR0
        14 013155   013167 600000 14                 TZE     s:15157

     2518    15154    3           CALL CONCAT( MSGBUF, '>> To: ', TO$->CV.T);

  15154 14 013156   000000 720100                    LXL0    0,,PR0
        14 013157   040000 100400                    MLR     fill='040'O
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:407  
        14 013160   003155 000007 1                  ADSC9   TCM_XLATE_TO_UC+312      cn=0,n=7
        14 013161   002210 000007 6                  ADSC9   MSGBUF                   cn=0,n=7
        14 013162   040000 100540                    MLR     fill='040'O
        14 013163   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 013164   002211 600370 6                  ADSC9   MSGBUF+1                 cn=3,n=248

     2519    15155    3           CALL WRITE_MAIL_MESSAGE;

  15155 14 013165   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013166   000000 011000                    NOP     0

     2520    15156    3           END;

     2521    15157    3       IF SUBJECT$->CV.L > 0 THEN DO;

  15157 14 013167   002460 470400 1                  LDP0    SUBJECT$
        14 013170   000000 235100                    LDA     0,,PR0
        14 013171   013203 600000 14                 TZE     s:15161

     2522    15158    3           CALL CONCAT( MSGBUF, '>> Subject: ', SUBJECT$->CV.T);

  15158 14 013172   000000 720100                    LXL0    0,,PR0
        14 013173   040000 100400                    MLR     fill='040'O
        14 013174   003157 000014 1                  ADSC9   TCM_XLATE_TO_UC+314      cn=0,n=12
        14 013175   002210 000014 6                  ADSC9   MSGBUF                   cn=0,n=12
        14 013176   040000 100540                    MLR     fill='040'O
        14 013177   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 013200   002213 000363 6                  ADSC9   MSGBUF+3                 cn=0,n=243

     2523    15159    3           CALL WRITE_MAIL_MESSAGE;

  15159 14 013201   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013202   000000 011000                    NOP     0

     2524    15160    3           END;

     2525    15161    3       IF VM_HEADER.UNIQUE_ID$ ~= ADDR( NIL) THEN DO;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:408  

  15161 14 013203   222345 470500                    LDP0    HEADER$,,AUTO
        14 013204   000032 236100                    LDQ     26,,PR0
        14 013205   000001 116000 xsym               CMPQ    B_VECTNIL+1
        14 013206   013224 600000 14                 TZE     s:15165

     2526    15162    3           CALL CONCAT( MSGBUF, '>> Message-Id: ', VM_HEADER.UNIQUE_ID$->TEXTC.T);

  15162 14 013207   000032 471500                    LDP1    26,,PR0
        14 013210   000100 101500                    MRL     fill='000'O
        14 013211   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        14 013212   222722 000002                    ADSC9   @VLEN+2,,AUTO            cn=0,n=2
        14 013213   222722 220100                    LDX0    @VLEN+2,,AUTO
        14 013214   040000 100400                    MLR     fill='040'O
        14 013215   003162 000017 1                  ADSC9   TCM_XLATE_TO_UC+317      cn=0,n=15
        14 013216   002210 000017 6                  ADSC9   MSGBUF                   cn=0,n=15
        14 013217   040000 100540                    MLR     fill='040'O
        14 013220   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0
        14 013221   002213 600360 6                  ADSC9   MSGBUF+3                 cn=3,n=240

     2527    15163    3           CALL WRITE_MAIL_MESSAGE;

  15163 14 013222   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013223   000000 011000                    NOP     0

     2528    15164    3           END;

     2529    15165    3       IF VM_HEADER.STATUS.DR THEN DO;

  15165 14 013224   222345 470500                    LDP0    HEADER$,,AUTO
        14 013225   000012 236100                    LDQ     10,,PR0
        14 013226   000004 316003                    CANQ    4,DU
        14 013227   013235 600000 14                 TZE     s:15169

     2530    15166    3           MSGBUF = '>> DR: Yes';

  15166 14 013230   040000 100400                    MLR     fill='040'O
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:409  
        14 013231   003166 000012 1                  ADSC9   TCM_XLATE_TO_UC+321      cn=0,n=10
        14 013232   002210 000377 6                  ADSC9   MSGBUF                   cn=0,n=255

     2531    15167    3           CALL WRITE_MAIL_MESSAGE;

  15167 14 013233   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013234   000000 011000                    NOP     0

     2532    15168    3           END;

     2533    15169    3       IF VM_HEADER.STATUS.RR THEN DO;

  15169 14 013235   222345 470500                    LDP0    HEADER$,,AUTO
        14 013236   000012 236100                    LDQ     10,,PR0
        14 013237   020000 316003                    CANQ    8192,DU
        14 013240   013246 600000 14                 TZE     s:15173

     2534    15170    3           MSGBUF = '>> RR: Yes';

  15170 14 013241   040000 100400                    MLR     fill='040'O
        14 013242   003171 000012 1                  ADSC9   TCM_XLATE_TO_UC+324      cn=0,n=10
        14 013243   002210 000377 6                  ADSC9   MSGBUF                   cn=0,n=255

     2535    15171    3           CALL WRITE_MAIL_MESSAGE;

  15171 14 013244   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013245   000000 011000                    NOP     0

     2536    15172    3           END;

     2537    15173    2       CALL M$WRITE( WRITE_MAILMSG_BLANK);

  15173 14 013246   000710 630400 1                  EPPR0   WRITE_MAILMSG_BLANK
        14 013247   040001 713400                    CLIMB   write
        14 013250   401400 401760                    pmme    nvectors=4

     2538    15174    2       CALL M$TIME( GET_POSTED_TIME);
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:410  

  15174 14 013251   001612 630400 1                  EPPR0   GET_POSTED_TIME
        14 013252   020004 713400                    CLIMB   8196
        14 013253   402000 401760                    pmme    nvectors=5

     2539    15175    2       CALL CONCAT( MSGBUF, 'Accepted ', SUBSTR( MSG_DATE, 0, 5), ' ',

  15175 14 013254   040000 100400                    MLR     fill='040'O
        14 013255   003174 000011 1                  ADSC9   TCM_XLATE_TO_UC+327      cn=0,n=9
        14 013256   002210 000011 6                  ADSC9   MSGBUF                   cn=0,n=9
        14 013257   040000 100400                    MLR     fill='040'O
        14 013260   003431 000005 6                  ADSC9   MSG_DATE                 cn=0,n=5
        14 013261   002212 200005 6                  ADSC9   MSGBUF+2                 cn=1,n=5
        14 013262   040000 236007                    LDQ     16384,DL
        14 013263   002213 552010 6                  STBQ    MSGBUF+3,'10'O
        14 013264   040000 100400                    MLR     fill='040'O
        14 013265   003433 000005 6                  ADSC9   MSG_TIME                 cn=0,n=5
        14 013266   002213 600005 6                  ADSC9   MSGBUF+3                 cn=3,n=5
        14 013267   040000 100400                    MLR     fill='040'O
        14 013270   000037 000001 15                 ADSC9   31                       cn=0,n=1
        14 013271   002215 000353 6                  ADSC9   MSGBUF+5                 cn=0,n=235

     2540    15176    2               SUBSTR( MSG_TIME, 0, 5), '.');
     2541    15177    2       CALL WRITE_MAIL_MESSAGE;

  15177 14 013272   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013273   000000 011000                    NOP     0

     2542    15178    2   COMMON:
     2543    15179    2       CALL M$CLOSE( CLOSE_MAILMSG);

  15179 14 013274   000724 630400 1     COMMON       EPPR0   CLOSE_MAILMSG
        14 013275   050001 713400                    CLIMB   close
        14 013276   406000 401760                    pmme    nvectors=13

     2544    15180    2       SAVED_ACCN = B$JIT.ACCN;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:411  
  15180 14 013277   000000 470400 xsym               LDP0    B$JIT$
        14 013300   040100 100500                    MLR     fill='040'O
        14 013301   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
        14 013302   200133 000010                    ADSC9   SAVED_ACCN,,AUTO         cn=0,n=8

     2545    15181    2       IF B$JIT.PRIV.ACTIVE.JIT THEN

  15181 14 013303   000013 236100                    LDQ     11,,PR0
        14 013304   000040 316007                    CANQ    32,DL
        14 013305   013311 600000 14                 TZE     s:15183

     2546    15182    2           B$JIT.ACCN = TCM_ACCOUNT.ACCT#;

  15182 14 013306   000232 237000 6                  LDAQ    TCM_ACCOUNT
        14 013307   000001 755100                    STA     1,,PR0
        14 013310   000002 756100                    STQ     2,,PR0

     2547    15183    2       CALL M$LINK( SEND_MAILMSG)

  15183 14 013311   001242 630400 1                  EPPR0   SEND_MAILMSG
        14 013312   400005 713400                    CLIMB   alt,+5
        14 013313   403000 401760                    pmme    nvectors=7
        14 013314   013316 702000 14                 TSX2    s:15186
        14 013315   013316 710000 14                 TRA     s:15186

     2548    15184    3       WHENALTRETURN DO;

     2549    15185    3           END;

     2550    15186    2       IF B$JIT.PRIV.ACTIVE.JIT THEN

  15186 14 013316   000000 470400 xsym               LDP0    B$JIT$
        14 013317   000013 236100                    LDQ     11,,PR0
        14 013320   000040 316007                    CANQ    32,DL
        14 013321   013325 600000 14                 TZE     s:15188

     2551    15187    2           B$JIT.ACCN = SAVED_ACCN;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:412  

  15187 14 013322   040100 100500                    MLR     fill='040'O
        14 013323   200133 000010                    ADSC9   SAVED_ACCN,,AUTO         cn=0,n=8
        14 013324   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8

     2552    15188    2       RETURN;

  15188 14 013325   222606 221300                    LDX1  ! LEN_TARGET+1,,AUTO
        14 013326   000001 702211                    TSX2  ! 1,X1

     2553    15189
     2554    15190    2   POST_MESSAGE_REJECTION: ENTRY( SITENAME);

  15190 14 013327   222606 741300       POST_MESSAG* STX1  ! LEN_TARGET+1,,AUTO

     2555    15191
     2556    15192    2       CALL STATUS_UPDATE( REJECTING_MESSAGE);

  15192 14 013330   000202 236000 15                 LDQ     130
        14 013331   222715 756100                    STQ     LAST+2,,AUTO
        14 013332   013522 701000 14                 TSX1    STATUS_UPDATE
        14 013333   000000 011000                    NOP     0

     2557    15193    2       IF FROM$->CV.T = 'SCOTTY' OR

  15193 14 013334   002447 470400 1                  LDP0    FROM$
        14 013335   000000 720100                    LXL0    0,,PR0
        14 013336   040000 106540                    CMPC    fill='040'O
        14 013337   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 013340   003130 000006 1                  ADSC9   TCM_XLATE_TO_UC+291      cn=0,n=6
        14 013341   013351 600000 14                 TZE     s:15196
        14 013342   040000 106500                    CMPC    fill='040'O
        14 013343   000001 000013                    ADSC9   1,,PR0                   cn=0,n=11
        14 013344   003112 000013 1                  ADSC9   TCM_XLATE_TO_UC+277      cn=0,n=11
        14 013345   013351 600000 14                 TZE     s:15196
        14 013346   222345 471500                    LDP1    HEADER$,,AUTO
        14 013347   100012 234100                    SZN     10,,PR1
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:413  
        14 013350   013353 605000 14                 TPL     s:15197

     2558    15194    2               SUBSTR( FROM$->CV.T, 0, 11) = 'SMTP Mailer' OR
     2559    15195    2               VM_HEADER.STATUS.ERR THEN
     2560    15196    2           RETURN;

  15196 14 013351   222606 221300                    LDX1  ! LEN_TARGET+1,,AUTO
        14 013352   000001 702211                    TSX2  ! 1,X1

     2561    15197    2       CALL M$OPEN( OPEN_MAILMSG);

  15197 14 013353   000616 630400 1                  EPPR0   OPEN_MAILMSG
        14 013354   050000 713400                    CLIMB   open
        14 013355   410400 401760                    pmme    nvectors=18

     2562    15198    2       CALL CONCAT( MSGBUF, HDRTO, REPLY_TO$->CV.T);

  15198 14 013356   002452 470400 1                  LDP0    REPLY_TO$
        14 013357   000000 720100                    LXL0    0,,PR0
        14 013360   002356 236000 1                  LDQ     HDRTO
        14 013361   002210 756000 6                  STQ     MSGBUF
        14 013362   040000 100540                    MLR     fill='040'O
        14 013363   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 013364   002211 000373 6                  ADSC9   MSGBUF+1                 cn=0,n=251

     2563    15199    2       CALL WRITE_MAIL_MESSAGE;

  15199 14 013365   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013366   000000 011000                    NOP     0

     2564    15200    3       IF TCM_STUCKEE ~= ' ' THEN DO;

  15200 14 013367   040000 106400                    CMPC    fill='040'O
        14 013370   001175 000040 6                  ADSC9   TCM_STUCKEE              cn=0,n=32
        14 013371   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        14 013372   013403 600000 14                 TZE     s:15204

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:414  
     2565    15201    3           CALL CONCAT( MSGBUF, 'Reply To:', TCM_STUCKEE);

  15201 14 013373   040000 100400                    MLR     fill='040'O
        14 013374   003132 000011 1                  ADSC9   TCM_XLATE_TO_UC+293      cn=0,n=9
        14 013375   002210 000011 6                  ADSC9   MSGBUF                   cn=0,n=9
        14 013376   040000 100400                    MLR     fill='040'O
        14 013377   001175 000040 6                  ADSC9   TCM_STUCKEE              cn=0,n=32
        14 013400   002212 200366 6                  ADSC9   MSGBUF+2                 cn=1,n=246

     2566    15202    3           CALL WRITE_MAIL_MESSAGE;

  15202 14 013401   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013402   000000 011000                    NOP     0

     2567    15203    3           END;

     2568    15204    2       CALL CONCAT( MSGBUF, 'SUBJECT:Your SMTP mailgram was rejected at ', SITENAME.
             15204                TEXT);

  15204 14 013403   222607 470500                    LDP0    @SITENAME,,AUTO
        14 013404   000100 101500                    MRL     fill='000'O
        14 013405   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        14 013406   222722 000002                    ADSC9   @VLEN+2,,AUTO            cn=0,n=2
        14 013407   222722 220100                    LDX0    @VLEN+2,,AUTO
        14 013410   040000 100400                    MLR     fill='040'O
        14 013411   003177 000053 1                  ADSC9   TCM_XLATE_TO_UC+330      cn=0,n=43
        14 013412   002210 000053 6                  ADSC9   MSGBUF                   cn=0,n=43
        14 013413   040000 100540                    MLR     fill='040'O
        14 013414   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
        14 013415   002222 600324 6                  ADSC9   MSGBUF+10                cn=3,n=212

     2569    15205    2       CALL WRITE_MAIL_MESSAGE;

  15205 14 013416   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013417   000000 011000                    NOP     0

     2570    15206    3       IF TO$->CV.L > 0 THEN DO;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:415  

  15206 14 013420   002456 470400 1                  LDP0    TO$
        14 013421   000000 235100                    LDA     0,,PR0
        14 013422   013434 600000 14                 TZE     s:15210

     2571    15207    3           CALL CONCAT( MSGBUF, '>> To: ', TO$->CV.T);

  15207 14 013423   000000 720100                    LXL0    0,,PR0
        14 013424   040000 100400                    MLR     fill='040'O
        14 013425   003212 000007 1                  ADSC9   TCM_XLATE_TO_UC+341      cn=0,n=7
        14 013426   002210 000007 6                  ADSC9   MSGBUF                   cn=0,n=7
        14 013427   040000 100540                    MLR     fill='040'O
        14 013430   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 013431   002211 600370 6                  ADSC9   MSGBUF+1                 cn=3,n=248

     2572    15208    3           CALL WRITE_MAIL_MESSAGE;

  15208 14 013432   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013433   000000 011000                    NOP     0

     2573    15209    3           END;

     2574    15210    3       IF PATH$->CV.L > 0 THEN DO;

  15210 14 013434   002455 470400 1                  LDP0    PATH$
        14 013435   000000 235100                    LDA     0,,PR0
        14 013436   013450 600000 14                 TZE     s:15214

     2575    15211    3           CALL CONCAT( MSGBUF, '   DerivedPath = ', PATH$->CV.T);

  15211 14 013437   000000 720100                    LXL0    0,,PR0
        14 013440   040000 100400                    MLR     fill='040'O
        14 013441   003214 000021 1                  ADSC9   TCM_XLATE_TO_UC+343      cn=0,n=17
        14 013442   002210 000021 6                  ADSC9   MSGBUF                   cn=0,n=17
        14 013443   040000 100540                    MLR     fill='040'O
        14 013444   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 013445   002214 200356 6                  ADSC9   MSGBUF+4                 cn=1,n=238
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:416  

     2576    15212    3           CALL WRITE_MAIL_MESSAGE;

  15212 14 013446   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013447   000000 011000                    NOP     0

     2577    15213    3           END;

     2578    15214    3       IF SUBJECT$->CV.L > 0 THEN DO;

  15214 14 013450   002460 470400 1                  LDP0    SUBJECT$
        14 013451   000000 235100                    LDA     0,,PR0
        14 013452   013464 600000 14                 TZE     s:15218

     2579    15215    3           CALL CONCAT( MSGBUF, '>> Subject: ', SUBJECT$->CV.T);

  15215 14 013453   000000 720100                    LXL0    0,,PR0
        14 013454   040000 100400                    MLR     fill='040'O
        14 013455   003221 000014 1                  ADSC9   TCM_XLATE_TO_UC+348      cn=0,n=12
        14 013456   002210 000014 6                  ADSC9   MSGBUF                   cn=0,n=12
        14 013457   040000 100540                    MLR     fill='040'O
        14 013460   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
        14 013461   002213 000363 6                  ADSC9   MSGBUF+3                 cn=0,n=243

     2580    15216    3           CALL WRITE_MAIL_MESSAGE;

  15216 14 013462   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013463   000000 011000                    NOP     0

     2581    15217    3           END;

     2582    15218    2       CALL M$WRITE( WRITE_MAILMSG_BLANK);

  15218 14 013464   000710 630400 1                  EPPR0   WRITE_MAILMSG_BLANK
        14 013465   040001 713400                    CLIMB   write
        14 013466   401400 401760                    pmme    nvectors=4

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:417  
     2583    15219    2       CALL M$TIME( GET_POSTED_TIME);

  15219 14 013467   001612 630400 1                  EPPR0   GET_POSTED_TIME
        14 013470   020004 713400                    CLIMB   8196
        14 013471   402000 401760                    pmme    nvectors=5

     2584    15220    2       CALL CONCAT( MSGBUF, 'Rejected ', SUBSTR( MSG_DATE, 0, 5), ' ',

  15220 14 013472   040000 100400                    MLR     fill='040'O
        14 013473   003224 000011 1                  ADSC9   TCM_XLATE_TO_UC+351      cn=0,n=9
        14 013474   002210 000011 6                  ADSC9   MSGBUF                   cn=0,n=9
        14 013475   040000 100400                    MLR     fill='040'O
        14 013476   003431 000005 6                  ADSC9   MSG_DATE                 cn=0,n=5
        14 013477   002212 200005 6                  ADSC9   MSGBUF+2                 cn=1,n=5
        14 013500   040000 236007                    LDQ     16384,DL
        14 013501   002213 552010 6                  STBQ    MSGBUF+3,'10'O
        14 013502   040000 100400                    MLR     fill='040'O
        14 013503   003433 000005 6                  ADSC9   MSG_TIME                 cn=0,n=5
        14 013504   002213 600005 6                  ADSC9   MSGBUF+3                 cn=3,n=5
        14 013505   040000 100400                    MLR     fill='040'O
        14 013506   003227 000032 1                  ADSC9   TCM_XLATE_TO_UC+354      cn=0,n=26
        14 013507   002215 000353 6                  ADSC9   MSGBUF+5                 cn=0,n=235

     2585    15221    2               SUBSTR( MSG_TIME, 0, 5), ' for the following reason:');
     2586    15222    2       CALL WRITE_MAIL_MESSAGE;

  15222 14 013510   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013511   000000 011000                    NOP     0

     2587    15223    2       MSGBUF = REPLY;

  15223 14 013512   002210 470400 1                  LDP0    REPLY$
        14 013513   002207 720000 6                  LXL0    REPLYLEN
        14 013514   040000 100540                    MLR     fill='040'O
        14 013515   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
        14 013516   002210 000377 6                  ADSC9   MSGBUF                   cn=0,n=255

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:418  
     2588    15224    2       CALL WRITE_MAIL_MESSAGE;

  15224 14 013517   012601 701000 14                 TSX1    WRITE_MAIL_MESSAGE
        14 013520   000000 011000                    NOP     0

     2589    15225    2       GOTO COMMON;

  15225 14 013521   013274 710000 14                 TRA     COMMON

     2590    15226
     2591    15227    2       END POST_MESSAGE_ACKNOWLEDGEMENT;
     2592    15228        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:419  
     2593    15229    1   STATUS_UPDATE: PROC( MSG);

  15229 14 013522   222714 741300       STATUS_UPDA* STX1  ! LAST+1,,AUTO

     2594    15230
     2595    15231    2       DCL 1 MSG ALIGNED,
     2596    15232    2            2 COUNT UBIN BYTE CALIGNED,
     2597    15233    2            2 TEXT CHAR( MSG.COUNT);
     2598    15234
     2599    15235    3       IF B$JIT.PRIV.ACTIVE.JIT THEN DO;

  15235 14 013523   000000 470400 xsym               LDP0    B$JIT$
        14 013524   000013 236100                    LDQ     11,,PR0
        14 013525   000040 316007                    CANQ    32,DL
        14 013526   013547 600000 14                 TZE     s:15239

     2600    15236    3           B$JIT.CCARS = MSG.COUNT + 1 + LENGTHC( TCM_PROGNAME);

  15236 14 013527   222715 471500                    LDP1    @MSG,,AUTO
        14 013530   100000 236100                    LDQ     0,,PR1
        14 013531   000033 772000                    QRL     27
        14 013532   000010 620006                    EAX0    8,QL
        14 013533   000032 740100                    STX0    26,,PR0

     2601    15237    3           CALL CONCAT( B$JIT.CCBUF, TCM_PROGNAME, ':', MSG.TEXT);

  15237 14 013534   100000 236100                    LDQ     0,,PR1
        14 013535   000033 772000                    QRL     27
        14 013536   040100 100400                    MLR     fill='040'O
        14 013537   001173 000007 6                  ADSC9   TCM_PROGNAME             cn=0,n=7
        14 013540   000033 000007                    ADSC9   27,,PR0                  cn=0,n=7
        14 013541   000000 621006                    EAX1    0,QL
        14 013542   000072 236007                    LDQ     58,DL
        14 013543   000034 552104                    STBQ    28,'04'O,PR0
        14 013544   040100 100540                    MLR     fill='040'O
        14 013545   100000 200011                    ADSC9   0,,PR1                   cn=1,n=*X1
        14 013546   000035 000370                    ADSC9   29,,PR0                  cn=0,n=248
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:420  

     2602    15238    3           END;

     2603    15239    2       RETURN;

  15239 14 013547   222714 221300                    LDX1  ! LAST+1,,AUTO
        14 013550   000001 702211                    TSX2  ! 1,X1

     2604    15240
     2605    15241    2       END STATUS_UPDATE;
     2606    15242        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:421  
     2607    15243    1   WRITEDO: PROC;

  15243 14 013551   222362 741300       WRITEDO      STX1  ! LPAREN,,AUTO

     2608    15244
     2609    15245    2       DCL VLEN UBIN;
     2610    15246
     2611    15247    2       CALL GET_IOBUF_BOUND( CMDBUF, VLEN);

  15247 14 013552   222363 630500                    EPPR0   VLEN,,AUTO
        14 013553   222720 450500                    STP0    @BUF+1,,AUTO
        14 013554   000125 236000 15                 LDQ     85
        14 013555   222717 756100                    STQ     @MSG+2,,AUTO
        14 013556   013576 701000 14                 TSX1    GET_IOBUF_BOUND
        14 013557   000000 011000                    NOP     0

     2612    15248    2       IF VLEN = 0 THEN

  15248 14 013560   222363 235100                    LDA     VLEN,,AUTO
        14 013561   013565 601000 14                 TNZ     s:15251

     2613    15249    2           WRITE_DO.BUF_ = VECTOR( NIL);

  15249 14 013562   000024 237000 15                 LDAQ    20
        14 013563   000004 757000 6                  STAQ    WRITE_DO+4
        14 013564   013571 710000 14                 TRA     s:15252

     2614    15250    2       ELSE
     2615    15251    2           WRITE_DO.BUF_ = VECTOR( SUBSTR( CMDBUF, 0, VLEN));

  15251 14 013565   000020 735000                    ALS     16
        14 013566   000140 135007                    SBLA    96,DL
        14 013567   000125 236000 15                 LDQ     85
        14 013570   000004 757000 6                  STAQ    WRITE_DO+4

     2616    15252    2       CALL M$WRITE( WRITE_DO);

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:422  
  15252 14 013571   000000 630400 6                  EPPR0   WRITE_DO
        14 013572   040001 713400                    CLIMB   write
        14 013573   401400 401760                    pmme    nvectors=4

     2617    15253    2       RETURN;

  15253 14 013574   222362 221300                    LDX1  ! LPAREN,,AUTO
        14 013575   000001 702211                    TSX2  ! 1,X1

     2618    15254
     2619    15255    2       END WRITEDO;
     2620    15256        %EJECT;
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:423  
     2621    15257    1   GET_IOBUF_BOUND: PROC( BUF, VLEN);

  15257 14 013576   222716 741300       GET_IOBUF_B* STX1  ! @MSG+1,,AUTO

     2622    15258
     2623    15259    2       DCL BUF CHAR( %LINE_SIZE);
     2624    15260    2       DCL VLEN UBIN;
     2625    15261
     2626    15262    2       CALL SEARCHR( VLEN, TVAL, SKIP_BLANKS, BUF) ALTRET( BLANK_LINE);

  15262 14 013577   222717 470500                    LDP0    @BUF,,AUTO
        14 013600   222720 471500                    LDP1    @VLEN,,AUTO
        14 013601   000000 165500                    TCTR
        14 013602   000000 000377                    ADSC9   0,,PR0                   cn=0,n=255
        14 013603   002144 000000 1                  ARG     SKIP_BLANKS
        14 013604   100000 000100                    ARG     0,,PR1
        14 013605   100000 235100                    LDA     0,,PR1
        14 013606   000033 771000                    ARL     27
        14 013607   200107 755100                    STA     TVAL,,AUTO
        14 013610   100000 551140                    STBA    0,'40'O,PR1
        14 013611   013616 606400 14                 TTN     BLANK_LINE
        14 013612   000376 236007                    LDQ     254,DL
        14 013613   100000 156100                    SSQ     0,,PR1

     2627    15263    2       RETURN;

  15263 14 013614   222716 221300                    LDX1  ! @MSG+1,,AUTO
        14 013615   000001 702211                    TSX2  ! 1,X1

     2628    15264    2   BLANK_LINE:
     2629    15265    2       VLEN = 0;

  15265 14 013616   222720 470500       BLANK_LINE   LDP0    @VLEN,,AUTO
        14 013617   000000 450100                    STZ     0,,PR0

     2630    15266    2       RETURN;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:424  
  15266 14 013620   222716 221300                    LDX1  ! @MSG+1,,AUTO
        14 013621   000001 702211                    TSX2  ! 1,X1

TCM_SOCKINIT
 Sect OctLoc
   1     000   000000 000001   777777 777777   000000 010000   000000 006014    ................
   1     004   000000 000000   000002 000000                                    ........

CLOSE_SI
 Sect OctLoc
   1     006   000003 777640   000040 006000   000000 177640   000000 006014    ..... ..........
   1     012   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     036*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   1     042   000220 000000   000000 000000                                    ........

OPEN_UI
 Sect OctLoc
   1     044   000025 777640   000110 006000   000000 177640   000000 006014    .....H..........
   1     050   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     110*  000000 000042   000000 000000   252525 000000   000040 252520    ..."......... ..
   1     114   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   1     120   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     124   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1     130   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1     134   000000 000000   ****** ******                                    ........

READ_UI
 Sect OctLoc
   1     136   000005 777640   000146 006000   000000 177640   000000 006014    .....f..........
   1     142   000077 577640   002006 006000   000000 177640   000000 006014    .?..............
   1     146   000000 400000   000000 000000   000000 000000   000000 000000    ................
   1     152   000000 000000   000000 000000                                    ........

CLOSE_UI
 Sect OctLoc
   1     154   000003 777640   000206 006000   000000 177640   000000 006014    ................
   1     160   000000 177640   000000 006014   000000 177640   000000 006014    ................
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:425  
   1     204*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   1     210   000220 000000   000000 000000                                    ........

OPEN_FOLDER
 Sect OctLoc
   1     212   000025 777640   000256 006000   000000 177640   000000 006014    ................
   1     216   000000 177640   000000 006014   000003 377640   001230 006000    ................
   1     222   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     236*  000001 777640   000232 006000   000000 177640   000000 006014    ................
   1     242   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     256*  000000 400052   000000 001001   252525 000000   000040 252520    ...*......... ..
   1     262   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   1     266   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     272   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1     276   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1     302   000000 000000   ****** ******                                    ........

OPEN_REGISTRY
 Sect OctLoc
   1     304   000025 777640   000350 006000   000000 177640   000000 006014    ................
   1     310   000000 177640   000000 006014   000003 577640   001236 006000    ................
   1     314   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     330*  000001 777640   000232 006000   000000 177640   000000 006014    ................
   1     334   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     350*  000000 000052   000000 002001   252525 000000   000040 252520    ...*......... ..
   1     354   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   1     360   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     364   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1     370   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1     374   000000 000000   ****** ******                                    ........

CLOSE_FOLDER
 Sect OctLoc
   1     376   000003 777640   000430 006000   000000 177640   000000 006014    ................
   1     402   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     426*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   1     432   000220 000000   000000 000000                                    ........
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:426  

ZAP_FOLDER
 Sect OctLoc
   1     434   000003 777640   000466 006000   000000 177640   000000 006014    ................
   1     440   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     464*  000000 177640   000000 006014   000000 000001   000000 000040    ...............
   1     470   000220 000000   000000 000000                                    ........

CLOSE_REGISTRY
 Sect OctLoc
   1     472   000003 777640   000524 006000   000000 177640   000000 006014    ................
   1     476   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     522*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   1     526   000220 000000   000000 000000                                    ........

ENQ_ON_PROFILE
 Sect OctLoc
   1     530   000003 777640   000536 006000   000001 777640   002124 006000    .............T..
   1     534   000000 177640   000000 006014   000000 540000   777777 777777    ................
   1     540   000000 000000   000000 000000                                    ........

DEQ_ON_PROFILE
 Sect OctLoc
   1     542   000001 777640   000550 006000   000001 777640   002124 006000    .............T..
   1     546   000000 177640   000000 006014   000000 400000   000000 000000    ................

ENQ_ON_FILE
 Sect OctLoc
   1     552   000003 777640   000560 006000   000001 177640   002126 006000    .............V..
   1     556   000000 177640   000000 006014   000000 540000   000000 000000    ................
   1     562   000000 000000   000000 000000                                    ........

DEQ_ON_FILE
 Sect OctLoc
   1     564   000001 777640   000572 006000   000001 177640   002126 006000    .............V..
   1     570   000000 177640   000000 006014   000000 400000   000000 000000    ................

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:427  
ENQ_ON_HEADER
 Sect OctLoc
   1     574   000003 777640   000602 006000   000001 177640   001121 006000    .............Q..
   1     600   000000 177640   000000 006014   000000 540000   000000 000000    ................
   1     604   000000 000000   000000 000000                                    ........

DEQ_ON_HEADER
 Sect OctLoc
   1     606   000001 777640   000614 006000   000001 177640   001121 006000    .............Q..
   1     612   000000 177640   000000 006014   000000 400000   000000 000000    ................

OPEN_MAILMSG
 Sect OctLoc
   1     616   000025 777640   000662 006000   000000 177640   000000 006014    ................
   1     622   000000 177640   000000 006014   000002 177640   001225 006000    ................
   1     626   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     662*  000000 000702   000000 003001   252525 000000   000040 252520    ............. ..
   1     666   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   1     672   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     676   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1     702   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1     706   000000 000000   ****** ******                                    ........

WRITE_MAILMSG_BLANK
 Sect OctLoc
   1     710   000003 777640   000720 006000   000000 177640   000000 006014    ................
   1     714   000000 177640   002347 006000   000000 177640   000000 006014    ................
   1     720   000000 400400   000000 000000   000000 000000   000000 000000    ................

CLOSE_MAILMSG
 Sect OctLoc
   1     724   000003 777640   000756 006000   000000 177640   000000 006014    ................
   1     730   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     754*  000000 177640   000000 006014   000000 000000   000000 000040    ...............
   1     760   000220 000000   000000 000000                                    ........

OPEN_HANGUP
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:428  
 Sect OctLoc
   1     762   000025 777640   001026 006000   000000 177640   000000 006014    ................
   1     766   000000 177640   000000 006014   000002 177640   001222 006000    ................
   1     772   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    1006*  000001 777640   000232 006000   000000 177640   000000 006014    ................
   1    1012   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    1026*  000000 000042   000000 001001   252525 000000   000040 252520    ..."......... ..
   1    1032   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   1    1036   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1    1042   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1    1046   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1    1052   000000 000000   ****** ******                                    ........

CLOSE_HANGUP
 Sect OctLoc
   1    1054   000003 777640   001106 006000   000000 177640   000000 006014    .....F..........
   1    1060   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    1104*  000000 177640   000000 006014   000000 000001   000000 000040    ...............
   1    1110   000220 000000   000000 000000                                    ........

OPEN_QUOTES
 Sect OctLoc
   1    1112   000025 777640   001156 006000   000000 177640   000000 006014    .....n..........
   1    1116   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    1156*  000000 000042   000000 003001   252525 002002   000040 252520    ..."......... ..
   1    1162   000040 040040   000000 000001   000000 777777   000000 000000    .   ............
   1    1166   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1    1172   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1    1176   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1    1202   000000 000000   ****** ******                                    ........

READ_QUOTES
 Sect OctLoc
   1    1204   000005 777640   001214 006000   000000 777640   002106 006000    .............F..
   1    1210   000077 577640   002006 006000   000000 177640   000000 006014    .?..............
   1    1214   000000 600000   000000 000000   000000 000000   000000 000000    ................
   1    1220   000000 000000   000000 000000                                    ........
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:429  

HANGUP_FILE
 Sect OctLoc
   1    1222   010044 044110   101116 107125   120*** ******                    .$$HANGUP...

MAILMSG_NAME
 Sect OctLoc
   1    1225   010052 115101   111114 115123   107*** ******                    .*MAILMSG...

MAIL_CENTRAL
 Sect OctLoc
   1    1230   015072 115101   111114 137103   105116 124122   101114 ******    .:MAIL_CENTRAL..

MESS
 Sect OctLoc
   1    1234   005072 115105   123123 ******                                    .:MESS..

MAIL_REGISTRY
 Sect OctLoc
   1    1236   016072 115101   111114 137122   105107 111123   124122 131***    .:MAIL_REGISTRY.

SEND_MAILMSG
 Sect OctLoc
   1    1242   000007 777640   001262 006000   000001 777640   001272 006000    ................
   1    1246   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    1252   000012 177640   001274 006000   000000 177640   000000 006014    ................
   1    1256   000001 777640   001260 006000   600000 000000   000000 000000    ................

TCM_SEND_NAME
 Sect OctLoc
   1    1262   004123 105116   104040 040040   040040 040040   040040 040040    .SEND
   1    1266   040040 040040   040040 040040   040040 040040   040040 040040

TCM_SEND_ACCT
 Sect OctLoc
   1    1272   072123 131123   040040 040040                                    :SYS

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:430  
SEND_CMD
 Sect OctLoc
   1    1274   050123 105116   104040 052115   101111 114115   123107 040050    (SEND *MAILMSG (
   1    1300   107101 124105   127101 131054   115101 111114   075123 115124    GATEWAY,MAIL=SMT
   1    1304   120040 115141   151154 145162   051*** ******                    P Mailer)...

READ_UC
 Sect OctLoc
   1    1310   000005 777640   001320 006000   000000 177640   000000 006014    ................
   1    1314   000077 577640   002107 006000   000000 177640   000000 006014    .?...G..........
   1    1320   000000 400000   000000 000000   000000 000000   000000 000000    ................
   1    1324   000000 000000   000000 000000                                    ........

WRITE_ME_NULL
 Sect OctLoc
   1    1326   000003 777640   001336 006000   000000 177640   000000 006014    ................
   1    1332   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    1336   000000 400400   000000 000000   000000 000000   000000 000000    ................

WRITE_ME_BLANK
 Sect OctLoc
   1    1342   000003 777640   001352 006000   000000 177640   000000 006014    ................
   1    1346   000000 177640   002347 006000   000000 177640   000000 006014    ................
   1    1352   000000 400400   000000 000000   000000 000000   000000 000000    ................

DRIBBLE_FILE
 Sect OctLoc
   1    1356   000025 777640   001422 006000   000000 177640   000000 006014    ................
   1    1362   000000 177640   000000 006014   000002 377640   001450 006000    ................
   1    1366   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    1402*  000001 777640   000234 006000   000000 177640   000000 006014    ................
   1    1406   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    1422*  000000 000502   000000 003001   252525 001000   000040 252520    ............. ..
   1    1426   000040 040040   000000 000002   000000 777777   000000 000000    .   ............
   1    1432   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1    1436   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1    1442   040040 040040   000000 000000   000000 000000   000000 000000        ............
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:431  
   1    1446   000000 000000   ****** ******                                    ........

DRIBBLE_NAME
 Sect OctLoc
   1    1450   011072 104122   111102 123105   116124 ******                    .:DRIBSENT..

DRIBBLE_NO
 Sect OctLoc
   1    1454   000025 777640   001520 006000   000000 177640   000000 006014    ................
   1    1460   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    1520*  000000 000042   000000 000003   252525 000000   000040 252520    ..."......... ..
   1    1524   116117 040040   000000 000000   000000 777777   000000 000000    NO  ............
   1    1530   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1    1534   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1    1540   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1    1544   000000 000000   ****** ******                                    ........

GET_SMTP_DATE
 Sect OctLoc
   1    1546   000001 777640   001560 006000   000002 377640   003436 006000    ................
   1    1552   000001 177640   003445 006000   000000 577640   003444 006000    ................
   1    1556   000000 777640   003430 006000   004001 000000   ****** ******    ................

GET_TIME_NOW
 Sect OctLoc
   1    1562   000001 777640   001574 006000   000002 377640   003436 006000    ................
   1    1566   000001 177640   003445 006000   000000 577640   003444 006000    ................
   1    1572   000000 177640   000000 006014   000001 000000   ****** ******    ................

GET_UTS_NOW
 Sect OctLoc
   1    1576   000001 777640   001610 006000   000000 177640   000000 006014    ................
   1    1602   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    1606   000000 777640   001230 006000   000004 000000   ****** ******    ................

GET_POSTED_TIME
 Sect OctLoc
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:432  
   1    1612   000001 777640   001624 006000   000001 777640   003431 006000    ................
   1    1616   000002 577640   003433 006000   000000 177640   000000 006014    ................
   1    1622   000000 177640   000000 006014   000003 000000   ****** ******    ................

GET_WAKEUP_TIME
 Sect OctLoc
   1    1626   000001 777640   001640 006000   000000 177640   000000 006014    ................
   1    1632   000001 777640   003447 006000   000000 177640   000000 006014    ................
   1    1636   000000 777640   001230 006000   004001 000000   ****** ******    ................

WAIT_A_SECOND
 Sect OctLoc
   1    1642   000001 777640   001646 006000   000000 177640   000000 006014    ................
   1    1646   000000 000001   000000 000001                                    ........

SCREECH3
 Sect OctLoc
   1    1650   000001 777640   001664 006000   000000 177640   000000 006014    ................
   1    1654   000000 177640   000000 006014                                    ........

(unnamed)
 Sect OctLoc
   1    1656   000001 777640   001666 006000   000000 177640   000000 006014    ................
   1    1662   000000 177640   000000 006014                                    ........

SUA3
 Sect OctLoc
   1    1664   240315 464055   001160 107760                                    ...-.pG.

SUA4
 Sect OctLoc
   1    1666   240315 505345   001160 107760                                    .....pG.

GET_BUFFERS
 Sect OctLoc
   1    1670   000001 777640   001674 006000   000001 777640   001224 006000    ................
   1    1674   000600 010000   ****** ******                                    ........
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:433  

RELEASE_BUFFERS
 Sect OctLoc
   1    1676   000001 777640   001702 006000   000001 777640   001224 006000    ................
   1    1702   000000 010000   ****** ******                                    ........

GET_ADDRESSES
 Sect OctLoc
   1    1704   000001 777640   001710 006000   000001 777640   001226 006000    ................
   1    1710   000600 010000   ****** ******                                    ........

RELEASE_ADDRESSES
 Sect OctLoc
   1    1712   000001 777640   001716 006000   000001 777640   001226 006000    ................
   1    1716   000000 010000   ****** ******                                    ........

RELEASE_PACKS
 Sect OctLoc
   1    1720   000005 777640   001734 006000   000000 177640   000000 006014    ................
   1    1724   000000 177640   000000 006014   000315 777640   000260 006000    ................
   1    1730   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    1734   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1    1740   000000 000000   000000 000000                                    ........

JIT_PRIV
 Sect OctLoc
   1    1742   000001 777640   001744 006000   000000 000040   000000 000000    ........... ....

VMERRMSG
 Sect OctLoc
   1    1746   011072 126115   105122 122115   123107 ******                    .:VMERRMSG..

COLON_SYS
 Sect OctLoc
   1    1751   072123 131123   040040 040040                                    :SYS

FPT_ALIB
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:434  
 Sect OctLoc
   1    1754   000001 377640   001766 006000   000000 177640   000000 006014    ................
   1    1760   000000 177640   000000 006014   000001 777640   001764 006000    ................
   1    1764   000000 000000   000000 000000                                    ........

DELTA_NAME
 Sect OctLoc
   1    1766   005104 105114   124101 ******                                    .DELTA..

SEARCHING
 Sect OctLoc
   1    1770   022123 145141   162143 150151   156147 040146   157162 040155    .Searching for m
   1    1774   141151 154***                                                    ail.

CONNECTING
 Sect OctLoc
   1    1775   023103 141154   154151 156147   040162 145155   157164 145040    .Calling remote
   1    2001   150157 163164                                                    host

WAITING_FOR_SMTP_GREETING
 Sect OctLoc
   1    2002   033114 157157   153151 156147   040146 157162   040123 115124    .Looking for SMT
   1    2006   120040 163141   154165 164141   164151 157156                    P salutation

LOGGING_ON_TO_SMTP
 Sect OctLoc
   1    2011   030105 163164   141142 154151   163150 151156   147040 123115    .Establishing SM
   1    2015   124120 040144   151141 154157   147*** ******                    TP dialog...

DECODING_HEADER
 Sect OctLoc
   1    2020   024104 145143   157144 151156   147040 103120   055066 040150    .Decoding CP-6 h
   1    2024   145141 144145   162*** ******                                    eader...

SENDING_ADDRESSES
 Sect OctLoc
   1    2026   021123 145156   144151 156147   040141 144144   162145 163163    .Sending address
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:435  
   1    2032   145163 ******                                                    es..

SENDING_HEADER
 Sect OctLoc
   1    2033   026123 145156   144151 156147   040155 145163   163141 147145    .Sending message
   1    2037   040150 145141   144145 162***                                     header.

AWAITING_FINAL_ACK
 Sect OctLoc
   1    2041   030101 167141   151164 151156   147040 141143   153156 157167    .Awaiting acknow
   1    2045   154145 144147   145155 145156   164*** ******                    ledgement...

DELETING_MESSAGE
 Sect OctLoc
   1    2050   020104 145154   145164 151156   147040 155145   163163 141147    .Deleting messag
   1    2054   145*** ******                                                    e...

REJECTING_MESSAGE
 Sect OctLoc
   1    2055   052111 156146   157162 155151   156147 040163   145156 144145    *Informing sende
   1    2061   162040 164150   141164 040155   145163 163141   147145 040167    r that message w
   1    2065   141163 040162   145152 145143   164145 144***                    as rejected.

ACKNOWLEDGING_MESSAGE
 Sect OctLoc
   1    2070   055101 143153   156157 167154   145144 147151   156147 040164    -Acknowledging t
   1    2074   150141 164040   155145 163163   141147 145040   150141 163040    hat message has
   1    2100   142145 145156   040146 157162   167141 162144   145144 ******    been forwarded..

LOGGING_OFF_OF_SMTP
 Sect OctLoc
   1    2104   027104 151163   143157 156156   145143 164151   156147 040146    .Disconnecting f
   1    2110   162157 155040   123115 124120                                    rom SMTP

NO_MODEM
 Sect OctLoc
   1    2112   777777 777777   116157 103157   155155 040***                    ....NoComm .
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:436  

NO_HOST
 Sect OctLoc
   1    2115   777777 777777   116157 110157   163164 040***                    ....NoHost .

NO_SMTP
 Sect OctLoc
   1    2120   777777 777777   116157 123115   124120 040***                    ....NoSMTP .

VM_PROKEY
 Sect OctLoc
   1    2123   001001 ******                                                    ....

VM_PRORES
 Sect OctLoc
   1    2124   007120 122117   106111 114105                                    .PROFILE

VM_FILERES
 Sect OctLoc
   1    2126   004106 111114   105*** ******                                    .FILE...

VM_SITEKEY
 Sect OctLoc
   1    2130   001012 ******                                                    ....

PROMPTSTRING
 Sect OctLoc
   1    2131   173175 040***                                                    {} .

CMN2UTS
 Sect OctLoc
   1    2132   000000 000000   000000 000000   777777 777773   777777 777774    ................
   1    2136   777777 777772   777777 777773   777777 777771   777777 777772    ................
   1    2142   777777 777770   777777 777771                                    ........

SKIP_BLANKS
 Sect OctLoc
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:437  
   1    2144   003003 003003   003003 003003   003003 003003   003003 003003    ................
   1    2154*  000001 001001   001001 001001   001001 001001   001001 001001    ................
   1    2160   002002 002002   002002 002002   002002 001001   001001 001001    ................
   1    2164   001002 002002   002002 002002   002002 002002   002002 002002    ................
   1    2170   002002 002002   002002 002002   002002 002001   001001 001001    ................
   1    2174   001002 002002   002002 002002   002002 002002   002002 002002    ................
   1    2200   002002 002002   002002 002002   002002 002001   001001 001003    ................

LINE$
 Sect OctLoc
   1    2204   001231 006000                                                    ....

(unnamed)
 Sect OctLoc
   1    2206   000077 577640   002107 006000                                    .?...G..

REPLY$
 Sect OctLoc
   1    2210   002107 006000                                                    .G..

(unnamed)
 Sect OctLoc
   1    2211   ****** ******   000077 577640   002210 006000                    .....?......

PATHERR
 Sect OctLoc
   1    2214   123115 124120   040160 141164   150040 141144   144162 145163    SMTP path addres
   1    2220   163040 156157   164040 146157   165156 144040   151156 040155    s not found in m
   1    2224   145163 163141   147145 040150   145141 144145   162040 157162    essage header or
   1    2230   040165 163145   162040 162145   147151 163164   162171 056***     user registry..

MULTIPLEADDRESSERR
 Sect OctLoc
   1    2234   101144 144162   145163 163145   145040 151163   040162 145147    Addressee is reg
   1    2240   151163 164145   162145 144040   141163 040141   040154 151163    istered as a lis
   1    2244   164040 167151   164150 040155   157162 145040   164150 141156    t with more than
   1    2250   040157 156145   040141 144144   162145 163163   056*** ******     one address....
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:438  

NOTMULTICSADDRESSERR
 Sect OctLoc
   1    2254   101144 144162   145163 163145   145040 151163   040162 145147    Addressee is reg
   1    2260   151163 164145   162145 144040   141163 040163   157155 145164    istered as somet
   1    2264   150151 156147   040157 164150   145162 040164   150141 156040    hing other than
   1    2270   141156 040101   122120 101040   141144 144162   145163 163***    an ARPA address.

(unnamed)
 Sect OctLoc
   1    2274   103157 160171   040154 151163   164040 143157   156164 141151    Copy list contai
   1    2300   156163 040156   157156 055154   157143 141154   040165 163145    ns non-local use
   1    2304   162040 141154   151141 163***                                    r alias.

ADDRERR
 Sect OctLoc
   1    2306   123115 124120   040160 141164   150040 141144   144162 145163    SMTP path addres
   1    2312   163040 146157   165156 144040   151156 040142   157164 150040    s found in both
   1    2316   124157 072040   141156 144040   123165 142152   145143 164072    To: and Subject:
   1    2322   040157 146040   155145 163163   141147 145040   150145 141144     of message head
   1    2326   145162 ******                                                    er..

TOERR
 Sect OctLoc
   1    2327   115101 111114   107122 101115   040143 157156   164141 151156    MAILGRAM contain
   1    2333   163040 164157   157040 155141   156171 040050   155157 162145    s too many (more
   1    2337   040164 150141   156040 061060   060051 040151   156164 145162     than 100) inter
   1    2343   156145 164040   141144 144162   145163 163145   145163 ******    net addressees..

BLANK_LINE
 Sect OctLoc
   1    2347   040*** ******                                                     ...

(unnamed)
 Sect OctLoc
   1    2350   000000 777640   002311 006000   123145 156164   072040 ******    ........Sent: ..
   1    2354   116165 155142   145162 072040                                    Number:
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:439  

HDRTO
 Sect OctLoc
   1    2356   124157 072040                                                    To:

(unnamed)
 Sect OctLoc
   1    2357   106162 157155   072040 ******   123165 142152   145143 164072    From: ..Subject:
   1    2363   040*** ******   101144 144162   145163 163072   040*** ******     ...Address: ...
   1    2367   122145 072040   103072 040***   102143 072040                    Re: C: .Bc:

MSGDATE
 Sect OctLoc
   1    2372   104141 164145   072040 ******                                    Date: ..

MSGTO
 Sect OctLoc
   1    2374   124157 072040                                                    To:

MSGREALLY_TO
 Sect OctLoc
   1    2375   122145 141154   154171 055164   157072 040***                    Really-to: .

MSGCC
 Sect OctLoc
   1    2400   143143 072040                                                    cc:

MSGREAL_CC
 Sect OctLoc
   1    2401   122145 141154   055143 143072   040*** ******                    Real-cc: ...

MSGBCC
 Sect OctLoc
   1    2404   142143 143072   040*** ******                                    bcc: ...

MSGREAL_BCC
 Sect OctLoc
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:440  
   1    2406   122145 141154   055142 143143   072040 ******                    Real-bcc: ..

MSGFROM
 Sect OctLoc
   1    2411   106162 157155   072040 ******                                    From: ..

MSGREPLY
 Sect OctLoc
   1    2413   122145 160154   171055 164157   072040 ******                    Reply-to: ..

MSGSUBJ
 Sect OctLoc
   1    2416   123165 142152   145143 164072   040*** ******                    Subject: ...

MSGRE
 Sect OctLoc
   1    2421   122145 146145   162145 156143   145163 072040                    References:

MSGQUOTE
 Sect OctLoc
   1    2424   122141 156144   157155 156145   163163 072040                    Randomness:

MSGID
 Sect OctLoc
   1    2427   115145 163163   141147 145055   111104 072040                    Message-ID:

MSGREFID
 Sect OctLoc
   1    2432   111156 055122   145160 154171   055124 157072   040*** ******    In-Reply-To: ...

MSGACKTO
 Sect OctLoc
   1    2436   101143 153156   157167 154145   144147 145055   124157 072040    Acknowledge-To:

MSGRRTO
 Sect OctLoc
   1    2442   122145 164165   162156 055122   145143 145151   160164 055124    Return-Receipt-T
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:441  
   1    2446   157072 040***                                                    o: .

FROM$
 Sect OctLoc
   1    2447   002312 006000                                                    ....

FROMNAME$
 Sect OctLoc
   1    2450   002337 006000                                                    ....

FROMADDR$
 Sect OctLoc
   1    2451   002364 006000                                                    ....

REPLY_TO$
 Sect OctLoc
   1    2452   002411 006000                                                    ....

REPLYNAME$
 Sect OctLoc
   1    2453   002436 006000                                                    ....

REPLYADDR$
 Sect OctLoc
   1    2454   002463 006000                                                    ....

PATH$
 Sect OctLoc
   1    2455   002510 006000                                                    ....

TO$
 Sect OctLoc
   1    2456   002605 006000                                                    ....

BAD_ADDRESS$
 Sect OctLoc
   1    2457   002702 006000                                                    ....
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:442  

SUBJECT$
 Sect OctLoc
   1    2460   003003 006000                                                    ....

RE$
 Sect OctLoc
   1    2461   003104 006000                                                    .D..

SIGNATURE$
 Sect OctLoc
   1    2462   003205 006000                                                    ....

COMMENT$
 Sect OctLoc
   1    2463   003306 006000                                                    ....

TOSITE$
 Sect OctLoc
   1    2464   003407 006000                                                    ....

TCM_XLATE_TO_UC
 Sect OctLoc
   1    2465   000001 002003   004005 006007   010011 012013   014015 016017    ................
   1    2471   020021 022023   024025 026027   030031 032033   034035 036037    ................
   1    2475   040041 042043   044045 046047   050051 052053   054055 056057     !"#$%&'()*+,-./
   1    2501   060061 062063   064065 066067   070071 072073   074075 076077    0123456789:;<=>?
   1    2505   100101 102103   104105 106107   110111 112113   114115 116117    @ABCDEFGHIJKLMNO
   1    2511   120121 122123   124125 126127   130131 132133   134135 136137    PQRSTUVWXYZ[\]^_
   1    2515   140101 102103   104105 106107   110111 112113   114115 116117    `ABCDEFGHIJKLMNO
   1    2521   120121 122123   124125 126127   130131 132173   174175 176177    PQRSTUVWXYZ{|}~.
   1    2525   040040 040040   040040 040040   040040 040040   040040 040040
   1    2661*  040040 040040   040040 040040   040040 040040   040040 040040

(unnamed)
 Sect OctLoc
   1    2665   050104 105102   125107 051040   050124 103120   051040 040040    (DEBUG) (TCP)
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:443  
   1    2671   116105 124123   105116 104040   115125 114123   105116 104040    NETSEND MULSEND
   1    2675   116157 040143   157156 146151   147040 146151   154145 040163    No config file s
   1    2701   160145 143151   146151 145144   040157 156040   151156 166157    pecified on invo
   1    2705   143141 164151   157156 056040   040111 040161   165151 164056    cation.  I quit.
   1    2711   040141 167141   153145 072040   040040 040040   115114 113111     awake:     MLKI
   1    2715   110107 106105   104103 102101   132116 117120   121122 123124    HGFEDCBAZNOPQRST
   1    2721   125126 127130   131040 040040   123151 164145   040164 141142    UVWXY   Site tab
   1    2725   154145 040157   166145 162146   154157 167073   040040 163151    le overflow;  si
   1    2731   164145 040156   157164 040162   145143 157162   144145 144056    te not recorded.
   1    2735   116157 144145   040164 141142   154145 040157   166145 162146    Node table overf
   1    2741   154157 167073   040040 156157   144145 040156   157164 040163    low;  node not s
   1    2745   164157 162145   144056 040040   116157 040163   165143 150040    tored.  No such
   1    2751   163151 164145   056040 040040   104145 154107   141164 145040    site.   DelGate
   1    2755   164141 142154   145040 157166   145162 146154   157167 073040    table overflow;
   1    2761   040143 157155   155141 156144   040156 157164   040163 164157     command not sto
   1    2765   162145 144056   072115 105123   123040 040040   103141 156047    red.:MESS   Can'
   1    2771   164040 146151   156144 040141   040163 151164   145040 164157    t find a site to
   1    2775   040150 141156   144154 145040   164162 141146   146151 143040     handle traffic
   1    3001   164157 040164   150141 164040   156157 144145   056040 040040    to that node.
   1    3005   104151 141154   040154 151156   145040 156157   164040 141143    Dial line not ac
   1    3011   164151 166145   062062 060040   110105 114117   040040 040040    tive220 HELO
   1    3015   062065 060040   121125 111124   115101 111114   040106 122117    250 QUITMAIL FRO
   1    3021   115072 074040   101122 120101   122103 120124   040124 117072    M:< ARPARCPT TO:
   1    3025   074040 040040   122123 105124   104101 124101   054040 040040    <   RSETDATA,
   1    3031   074100 040040   040074 040040   040157 146040   122145 164165    <@   <   of Retu
   1    3035   162040 040040   115101 111114   040106 122117   115072 074123    r   MAIL FROM:<S
   1    3041   115124 120137   115141 151154   145162 100040   055055 040125    MTP_Mailer@ -- U
   1    3045   156141 142154   145040 164157   040144 145154   151166 145162    nable to deliver
   1    3051   040155 141151   154040 146157   162040 164150   145040 146157     mail for the fo
   1    3055   154154 157167   151156 147040   162145 141163   157156 072040    llowing reason:
   1    3061   055055 040125   156141 142154   145040 164157   040144 145154    -- Unable to del
   1    3065   151166 145162   040155 141151   154040 164157   040042 040040    iver mail to "
   1    3071   055055 040146   157162 040164   150145 040146   157154 154157    -- for the follo
   1    3075   167151 156147   040162 145141   163157 156072   055055 040124    wing reason:-- T
   1    3101   145170 164040   157146 040165   156144 145154   151166 145162    ext of undeliver
   1    3105   145144 040155   145163 163141   147145 040146   157154 154157    ed message follo
   1    3111   167163 072040   123115 124120   040115 141151   154145 162040    ws: SMTP Mailer
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:444  
   1    3115   120157 163164   155141 163164   145162 040040   122145 164165    Postmaster  Retu
   1    3121   162156 145144   040155 141151   154040 040040   000040 040000    rned mail   .  .
   1    3125   042100 040040   057103 105116   124122 101114   123103 117124    "@  /CENTRALSCOT
   1    3131   124131 040040   122145 160154   171040 124157   072040 040040    TY  Reply To:
   1    3135   123125 102112   105103 124072   131157 165162   040123 115124    SUBJECT:Your SMT
   1    3141   120040 155141   151154 147162   141155 040167   141163 040141    P mailgram was a
   1    3145   143143 145160   164145 144040   141164 040040   124131 120105    ccepted at  TYPE
   1    3151   072122 122040   122105 106040   111104 072040   122105 072040    :RR REF ID: RE:
   1    3155   076076 040124   157072 040040   076076 040123   165142 152145    >> To:  >> Subje
   1    3161   143164 072040   076076 040115   145163 163141   147145 055111    ct: >> Message-I
   1    3165   144072 040040   076076 040104   122072 040131   145163 040040    d:  >> DR: Yes
   1    3171   076076 040122   122072 040131   145163 040040   101143 143145    >> RR: Yes  Acce
   1    3175   160164 145144   040040 040040   123125 102112   105103 124072    pted    SUBJECT:
   1    3201   131157 165162   040123 115124   120040 155141   151154 147162    Your SMTP mailgr
   1    3205   141155 040167   141163 040162   145152 145143   164145 144040    am was rejected
   1    3211   141164 040040   076076 040124   157072 040040   040040 040104    at  >> To:     D
   1    3215   145162 151166   145144 120141   164150 040075   040040 040040    erivedPath =
   1    3221   076076 040123   165142 152145   143164 072040   122145 152145    >> Subject: Reje
   1    3225   143164 145144   040040 040040   040146 157162   040164 150145    cted     for the
   1    3231   040146 157154   154157 167151   156147 040162   145141 163157     following reaso
   1    3235   156072 040040                                                    n:

WRITE_DO
 Sect OctLoc
   6     000   000003 777640   000010 006000   000000 177640   000000 006014    ................
   6     004   000000 177640   000000 006014   000000 177640   000000 006014    ................
   6     010   000000 400400   000000 000000   000000 000000   000000 000000    ................

OPEN_MESSAGE
 Sect OctLoc
   6     014   000025 777640   000060 006000   000000 177640   000000 006014    .....0..........
   6     020   000000 177640   000000 006014   000000 177640   000000 006014    ................
   6     040*  000001 777640   000234 006000   000000 177640   000000 006014    ................
   6     044   000000 177640   000000 006014   000000 177640   000000 006014    ................
   6     060*  000000 000072   000000 001001   252525 000000   000040 252520    ...:......... ..
   6     064   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   6     070   000000 000000   000000 000000   000000 000000   000000 000000    ................
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:445  
   6     074   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   6     100   040040 040040   000000 000000   000000 000000   000000 000000        ............
   6     104   000000 000000   ****** ******                                    ........

POSITION_FOLDER
 Sect OctLoc
   6     106   000003 777640   000114 006000   000000 177640   000000 006014    .....L..........
   6     112   000000 177640   000000 006014   000000 000000   000000 000000    ................
   6     116   000000 000000   0***** ******                                    ........

READ_FOLDER
 Sect OctLoc
   6     120   000005 777640   000130 006000   000000 177640   000000 006014    .....X..........
   6     124   000000 177640   000000 006014   000000 177640   000000 006014    ................
   6     130   000000 400000   000000 000000   000000 000000   000000 000000    ................
   6     134   000000 000000   000000 000000                                    ........

READ_REGISTRY
 Sect OctLoc
   6     136   000005 777640   000146 006000   000000 177640   000000 006014    .....f..........
   6     142   000000 177640   000000 006014   000000 177640   000000 006014    ................
   6     146   000000 400000   000000 000000   000000 000000   000000 000000    ................
   6     152   000000 000000   000000 000000                                    ........

DELETE_FOLDER
 Sect OctLoc
   6     154   000001 777640   000164 006000   000000 177640   000000 006014    .....t..........
   6     160   000000 177640   000000 006014   000000 177640   000000 006014    ................
   6     164   000000 000000   000000 000000                                    ........

WRITE_FOLDER
 Sect OctLoc
   6     166   000003 777640   000176 006000   000000 177640   000000 006014    .....~..........
   6     172   000000 177640   000000 006014   000000 177640   000000 006014    ................
   6     176   000000 400400   000000 000000   000000 000000   000000 000000    ................

WRITE_MAILMSG
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:446  
 Sect OctLoc
   6     202   000003 777640   000212 006000   000000 177640   000000 006014    ................
   6     206   000077 577640   002210 006000   000000 177640   000000 006014    .?..............
   6     212   000000 400400   000000 000000   000000 000000   000000 000000    ................

WRITE_QUOTES
 Sect OctLoc
   6     216   000003 777640   000226 006000   000000 777640   002106 006000    .............F..
   6     222   000077 577640   002006 006000   000000 177640   000000 006014    .?..............
   6     226   000000 400400   000000 000000   000000 000000   000000 000000    ................

TCM_ACCOUNT
 Sect OctLoc
   6     232   072123 115124   120040 040040                                    :SMTP

TCM_MESSACCT
 Sect OctLoc
   6     234   072123 115124   120040 040040                                    :SMTP

WRITE_ME
 Sect OctLoc
   6     236   000003 777640   000246 006000   000000 177640   000000 006014    ................
   6     242   000077 577640   002107 006000   000000 177640   000000 006014    .?...G..........
   6     246   000000 400400   000000 000000   000000 000000   000000 000000    ................

WAIT_A_WHILE
 Sect OctLoc
   6     252   000001 777640   000256 006000   000000 177640   000000 006014    ................
   6     256   000000 000000   000000 000001                                    ........

PSN
 Sect OctLoc
   6     260   000000 000062   000000 000000   040040 040040   040040 001002    ...2....      ..
   6     264   000000 000000   000000 000000   040040 040040   040040 000002    ........      ..
   6     574*  000000 000000   000000 000000                                    ........

GET_MAIL_ERROR_CODE
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:447  
 Sect OctLoc
   6     576   000003 777640   000624 006000   000000 177640   000000 006014    ................
   6     602   000453 777640   001332 006000   000002 377640   001746 006000    ................
   6     606   000001 777640   001751 006000   000000 177640   000000 006014    ................
   6     612   000000 177640   000000 006014   000000 177640   000000 006014    ................
   6     616   000000 177640   000000 006014   000003 777640   000630 006000    ................
   6     622   000000 177640   000000 006014   000000 000000   000000 000000    ................
   6     626   375000 030001   040000 000000                                    .... ...

VLR_ERRMSG
 Sect OctLoc
   6     630   00000* ***000   000000 000000   000000 000000   ****** ******    ................

READ_SITE
 Sect OctLoc
   6     634   000005 777640   000644 006000   000000 377640   002130 006000    .............X..
   6     640   000000 177640   000000 006014   000000 177640   000000 006014    ................
   6     644   000000 600000   000000 000000   000000 000000   000000 000000    ................
   6     650   000000 000000   000000 000000                                    ........

IDLE
 Sect OctLoc
   6     652   023111 144154   145040 165156   164151 154040   110110 072115    .Idle until HH:M
   6     656   115072 123123                                                    M:SS

SENDING_MESSAGE_BODY
 Sect OctLoc
   6     657   036123 145156   144151 156147   040142 157144   171040 154151    .Sending body li
   6     663   156145 040115   115115 115040   157146 040116   116116 116***    ne MMMM of NNNN.

DRAINING_COMGROUP
 Sect OctLoc
   6     667   035104 162141   151156 151156   147073 040116   116116 116040    .Draining; NNNN
   6     673   162145 143157   162144 163040   162145 155141   151156 ******    records remain..

XUG_INIT
 Sect OctLoc
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:448  
   6     700   000000 000000   000000 000000   000000 000000   000000 000000    ................
   6     710*  000000 177640   000000 006014   000000 177640   000000 006014    ................
   6     714   000000 006014   000000 177640   000000 006014   000000 006014    ................
   6     720   000000 006014   000000 177640   000000 006014   000000 000454    ................
   6     724   000144 000144   000000 000000   070000 000000   000000 000000    .d.d....8.......
   6     730   000000 000000   000000 000000   000000 000000   000000 006014    ................
   6     734   000000 006014   000000 006014   000000 006014   000000 006014    ................
   6     740   00000* ******   000000 000000   000000 000000   000000 000000    ................

XUG_GETCMD
 Sect OctLoc
   6     744   000000 006000   000000 006014   000000 006014   000000 006014    ................
   6     750   000000 006014   000000 006014   240000 000000   04000* ***000    ............ ...
   6     754   000000 000000   000000 000000   000000 000000   000000 000000    ................
   6     760   000000 000000   000000 000000   000000 000000   000000 177640    ................
   6     764   000000 006014   000000 177640   000000 006014   000000 177640    ................
   6     770   000000 006014   000000 577640   002131 006000   000000 177640    .........Y......
   6     774   000000 006014   000000 000000   000000 000000   000000 000000    ................
   6    1000   000000 177640   000000 006014   000000 006014   000000 000000    ................
   6    1004   000000 006014   000000 006014   000000 006014   000000 006014    ................
   6    1010   000000 006014   000000 006014   000000 000000   000000 000000    ................
   6    1014   000000 000000   000000 000000                                    ........

XUW_WILDCARD
 Sect OctLoc
   6    1016   000000 177640   000000 006014   000000 177640   000000 006014    ................
   6    1026*  000000 000000   077000 000000   000000 000000   000000 000000    ....?...........

VM_INFOKEY
 Sect OctLoc
   6    1032   005000 000000   000000 ******                                    ........

VM_LISTKEY
 Sect OctLoc
   6    1034   311074 ******   ****** ******   ****** ******   ****** ******    .<..............
   6    1114*  ****** ******   ****** ******   ****** ******                    ............

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:449  
VM_BODYKEY
 Sect OctLoc
   6    1117   007060 000000   000000 000000                                    .0......

VM_HEADRES
 Sect OctLoc
   6    1121   004000 000000   000*** ******                                    ........

NODENAME
 Sect OctLoc
   6    1127   003103 120066   040040 040040   040040 040040   040040 040040    .CP6
   6    1133   040040 040040   040040 040040   040040 040040   040040 040040
   6    1143*  040040 040040   040040 040040   040040 040040   040040 040040

SITE_NAME
 Sect OctLoc
   6    1147   003103 120066   040040 040040   040040 040040   040040 040040    .CP6
   6    1153   040040 040040   040040 040040   040040 040040   040040 040040
   6    1163*  040040 040040   040040 040040   040040 040040   040040 040040

TCM_DRIBBLE
 Sect OctLoc
   6    1167   000000 000000                                                    ....

TCM_DRIBBLE_ME
 Sect OctLoc
   6    1170   000000 000000                                                    ....

TCM_TESTMODE
 Sect OctLoc
   6    1171   0***** ******                                                    ....

(unnamed)
 Sect OctLoc
   6    1172   040*** ******                                                     ...

TCM_STUCKEE
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:450  
 Sect OctLoc
   6    1175   040040 040040   040040 040040   040040 040040   040040 040040
   6    1201   040040 040040   040040 040040   040040 040040   040040 040040

TCM_TZTEXT
 Sect OctLoc
   6    1205   040120 123124   040040 ******                                     PST  ..

TCM_UTOFFSET
 Sect OctLoc
   6    1207   777765 007000                                                    ....

TCM_PHONE
 Sect OctLoc
   6    1210   ****** ******   ****** ******   ****** ******   ****** ******    ................

LINEBUF
 Sect OctLoc
   6    1231   040040 040040   040040 040040   040040 040040   040040 040040
   6    1325*  040040 040040   040040 040040   040040 040040   040040 040***                   .

LINELEN
 Sect OctLoc
   6    1331   000000 000001                                                    ....

MAIL_ERROR_CODE
 Sect OctLoc
   6    1332   ****** ******   ****** ******   ****** ******   ****** ******    ................

QUOTE_BUF
 Sect OctLoc
   6    2006   ****** ******   ****** ******   ****** ******   ****** ******    ................

CMDBUF
 Sect OctLoc
   6    2107   040040 040040   040040 040040   040040 040040   040040 040040
   6    2203*  040040 040040   040040 040040   040040 040040   040040 040***                   .
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:451  

REPLYLEN
 Sect OctLoc
   6    2207   000000 000001                                                    ....

MSGBUF
 Sect OctLoc
   6    2210   040040 040040   040040 040040   040040 040040   040040 040040
   6    2304*  040040 040040   040040 040040   040040 040040   040040 040***                   .

BLANK_COUNT
 Sect OctLoc
   6    2310   000000 000000                                                    ....

TEMPBUF
 Sect OctLoc
   6    2311   040040 040040

FROMNAME
 Sect OctLoc
   6    2312   000000 000000   040040 040040   040040 040040   040040 040040    ....
   6    2316   040040 040040   040040 040040   040040 040040   040040 040040
   6    2336*  040040 040040

FROMSIGN
 Sect OctLoc
   6    2337   000000 000000   040040 040040   040040 040040   040040 040040    ....
   6    2343   040040 040040   040040 040040   040040 040040   040040 040040
   6    2363*  040040 040040

FROMADDR
 Sect OctLoc
   6    2364   000000 000000   040040 040040   040040 040040   040040 040040    ....
   6    2370   040040 040040   040040 040040   040040 040040   040040 040040
   6    2410*  040040 040040

REPLY_TO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:452  
 Sect OctLoc
   6    2411   000000 000000   040040 040040   040040 040040   040040 040040    ....
   6    2415   040040 040040   040040 040040   040040 040040   040040 040040
   6    2435*  040040 040040

REPLYSIGN
 Sect OctLoc
   6    2436   000000 000000   040040 040040   040040 040040   040040 040040    ....
   6    2442   040040 040040   040040 040040   040040 040040   040040 040040
   6    2462*  040040 040040

REPLYADDR
 Sect OctLoc
   6    2463   000000 000000   040040 040040   040040 040040   040040 040040    ....
   6    2467   040040 040040   040040 040040   040040 040040   040040 040040
   6    2507*  040040 040040

PATH
 Sect OctLoc
   6    2510   000000 000000   040040 040040   040040 040040   040040 040040    ....
   6    2514   040040 040040   040040 040040   040040 040040   040040 040040
   6    2604*  040040 040040

TONAME
 Sect OctLoc
   6    2605   000000 000000   040040 040040   040040 040040   040040 040040    ....
   6    2611   040040 040040   040040 040040   040040 040040   040040 040040
   6    2701*  040040 040040

BAD_ADDRESS
 Sect OctLoc
   6    2702   000000 000000   040040 040040   040040 040040   040040 040040    ....
   6    2706   040040 040040   040040 040040   040040 040040   040040 040040
   6    3002*  040040 040***                                                       .

SUBJECT
 Sect OctLoc
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:453  
   6    3003   000000 000000   040040 040040   040040 040040   040040 040040    ....
   6    3007   040040 040040   040040 040040   040040 040040   040040 040040
   6    3103*  040040 040***                                                       .

RE
 Sect OctLoc
   6    3104   000000 000000   040040 040040   040040 040040   040040 040040    ....
   6    3110   040040 040040   040040 040040   040040 040040   040040 040040
   6    3204*  040040 040***                                                       .

SIGNATURE
 Sect OctLoc
   6    3205   000000 000000   040040 040040   040040 040040   040040 040040    ....
   6    3211   040040 040040   040040 040040   040040 040040   040040 040040
   6    3305*  040040 040***                                                       .

COMMENT
 Sect OctLoc
   6    3306   000000 000000   040040 040040   040040 040040   040040 040040    ....
   6    3312   040040 040040   040040 040040   040040 040040   040040 040040
   6    3406*  040040 040***                                                       .

TOSITE
 Sect OctLoc
   6    3407   000000 000000   040040 040040   040040 040040   040040 040040    ....
   6    3413   040040 040040   040040 040040   040040 040040   040040 040040
   6    3427*  040040 040040

MSG_TSTAMP
 Sect OctLoc
   6    3430   000000 000000                                                    ....

MSG_DATE
 Sect OctLoc
   6    3431   115115 057104   104057 131131                                    MM/DD/YY

MSG_TIME
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:454  
 Sect OctLoc
   6    3433   110110 072115   115072 123123   056123 123***                    HH:MM:SS.SS.

DATEWORK
 Sect OctLoc
   6    3436   115117 116040   104104 040047   131131 ******                    MON DD 'YY..

DATEBUF
 Sect OctLoc
   6    3441   104104 040115   117116 040131   131040 ******                    DD MON YY ..

DAYBUF
 Sect OctLoc
   6    3444   104101 131***                                                    DAY.

TIMEBUF
 Sect OctLoc
   6    3445   110110 072115   115*** ******                                    HH:MM...

TIMEBUF2
 Sect OctLoc
   6    3447   110110 072115   115072 123123                                    HH:MM:SS

(unnamed)
 Sect OctLoc
  15     000   000000 006003   000000 006000   000652 006000   002112 006000    .............J..
  15     004   002115 006000   002120 006000   000001 277100   000006 006000    .M...P.....@....
  15     010   001230 006000   000744 006000   000744 006000   000700 006000    ................
  15     014   015040 040040   000020 365400   073040 040040   177777 777777    .   ....;   ....
  15     020   637777 777777   777000 777777   100040 040040   002006 006000    ........@   ....
  15     024   000000 177640   000000 006014   001147 006000   000000 000000    .........g......
  15     030   000001 377640   001234 006000   777777 773777   777777 757777    ................
  15     034   777777 377777   072040 040040   054040 040040   056040 040040    ....:   ,   .
  15     040   001016 006000   001775 006000   002002 006000   000000 000074    ...............<
  15     044   002206 006000   002207 006000   000043 006000   002011 006000    .........#......
  15     050   062040 040040   000050 006000   777777 777000   002020 006000    2   .(..........
  15     054   002104 006000   002026 006000   076040 040040   045040 040040    .D......>   %
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:455  
  15     060   063040 040040   000060 006000   002033 006000   000000 000020    3   .0..........
  15     064   002375 006000   000015 006000   000006 006000   000063 006000    .............3..
  15     070   002374 006000   000000 000030   002401 006000   000013 006000    ................
  15     074   000006 006000   000071 006000   002400 006000   000000 000040    .....9.........
  15     100   002406 006000   000014 006000   000007 006000   000077 006000    .............?..
  15     104   002404 006000   050040 040040   051040 040040   000667 006000    ....(   )   ....
  15     110   002041 006000   000000 000000   000001 377640   001032 006000    .!..............
  15     114   677777 777777   777777 577777   000001 777640   001117 006000    .............O..
  15     120   000114 777640   001777 600000   000657 006000   074040 040040    .L..........<
  15     124   042040 040040   002107 006000   002350 006000   000027 006000    "   .G..........
  15     130   000024 006000   000002 006000   001770 006000   000044 777640    .............$..
  15     134   000067 777640   000003 777774   000000 000120   000000 000360    .7.........P....
  15     140   002447 006000   000136 006000   002456 006000   000137 006000    .....^......._..
  15     144   000000 000100   000000 000377   002452 006000   000144 006000    ...@.........d..
  15     150   002460 006000   000145 006000   002461 006000   000145 006000    .....e.......e..
  15     154   002462 006000   000145 006000   002457 006000   000145 006000    .....e.......e..
  15     160   002450 006000   002451 006000   002453 006000   002454 006000    ................
  15     164   000006 777640   777777 677777   000062 377640   001034 006000    .........2......
  15     170   057040 040040   047040 040040   137040 040040   002210 006000    /   '   _   ....
  15     174   002050 006000   757777 777777   000160 777640   002070 006000    .(.......p...8..
  15     200   000000 377640   002123 006000   002055 006000                    .....S...-..
     2631    15267
     2632    15268    2       END GET_IOBUF_BOUND;
     2633    15269
     2634    15270    1       END TCM$NETSEND;
     2635    15271        %EOD;

PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:456  
--  Include file information  --

   TCM_SEND_E.:TCA2TOU  is referenced.
   TCM_COMMON_M.:TCA2TOU  cannot be made into a system file and is referenced.
   XUW_MACRO_C.:LIBRARY  is referenced.
   XUG_ENTRY.:LIBRARY  cannot be made into a system file and is referenced.
   XUD_UTS_M.:TOOLE05  is referenced.
   XU_MACRO_C.:LIBRARY  is referenced.
   XSL_SOCKET_M.:TCA2TOU  is referenced.
   VM_MACRO_C.:LIBRARY  is referenced.
   CP_6_SUBS.:LIBRARY  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B_ERRORS_C.:LIBRARY  is referenced.
   B$JIT.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure TCM$NETSEND.
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:457  

 **** Variables and constants ****

  ****  Section 001 RoData TCM$NETSEND

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

  2070-0-0/c STRC(414)   r     1 ACKNOWLEDGING_MESSAGE
  2306-0-0/c CHAR(66)    r     1 ADDRERR                 2041-0-0/c STRC(225)   r     1 AWAITING_FINAL_ACK
  2457-0-0/w PTR         r     1 BAD_ADDRESS$            2347-0-0/c CHAR        r     1 BLANK_LINE
   376-0-0/d STRC(1080)  r     1 CLOSE_FOLDER            1054-0-0/d STRC(1080)  r     1 CLOSE_HANGUP
   724-0-0/d STRC(1080)  r     1 CLOSE_MAILMSG            472-0-0/d STRC(1080)  r     1 CLOSE_REGISTRY
     6-0-0/d STRC(1080)  r     1 CLOSE_SI                 154-0-0/d STRC(1080)  r     1 CLOSE_UI
  2206-0-0/d VECT        r     1 CMDBUF_
  2132-0-0/w SBIN        r     1 CMN2UTS(0:9)
  1751-0-0/c STRC(72)    r     1 COLON_SYS               2463-0-0/w PTR         r     1 COMMENT$
  1775-0-0/c STRC(180)   r     1 CONNECTING              2020-0-0/c STRC(189)   r     1 DECODING_HEADER
  2050-0-0/c STRC(153)   r     1 DELETING_MESSAGE        1766-0-0/c STRC(54)    r     1 DELTA_NAME
   564-0-0/d STRC(288)   r     1 DEQ_ON_FILE              606-0-0/d STRC(288)   r     1 DEQ_ON_HEADER
   542-0-0/d STRC(288)   r     1 DEQ_ON_PROFILE          1356-0-0/d STRC(2088)  r     1 DRIBBLE_FILE
  1450-0-0/c STRC(90)    r     1 DRIBBLE_NAME            1454-0-0/d STRC(2088)  r     1 DRIBBLE_NO
   552-0-0/d STRC(360)   r     1 ENQ_ON_FILE              574-0-0/d STRC(360)   r     1 ENQ_ON_HEADER
   530-0-0/d STRC(360)   r     1 ENQ_ON_PROFILE          1754-0-0/d STRC(360)   r     1 FPT_ALIB
  2447-0-0/w PTR         r     1 FROM$                   2451-0-0/w PTR         r     1 FROMADDR$
  2450-0-0/w PTR         r     1 FROMNAME$               1704-0-0/d STRC(216)   r     1 GET_ADDRESSES
  1670-0-0/d STRC(216)   r     1 GET_BUFFERS             1612-0-0/d STRC(432)   r     1 GET_POSTED_TIME
  1546-0-0/d STRC(432)   r     1 GET_SMTP_DATE           1562-0-0/d STRC(432)   r     1 GET_TIME_NOW
  1576-0-0/d STRC(432)   r     1 GET_UTS_NOW             1626-0-0/d STRC(432)   r     1 GET_WAKEUP_TIME
  1222-0-0/c STRC(81)    r     1 HANGUP_FILE             2356-0-0/c CHAR(4)     r     1 HDRTO
  1742-0-0/d STRC(144)   r     1 JIT_PRIV                2204-0-0/w PTR         r     1 LINE$
  2104-0-0/c STRC(216)   r     1 LOGGING_OFF_OF_SMTP     2011-0-0/c STRC(225)   r     1 LOGGING_ON_TO_SMTP
  1225-0-0/c STRC(81)    r     1 MAILMSG_NAME            1230-0-0/c STRC(126)   r     1 MAIL_CENTRAL
  1236-0-0/c STRC(135)   r     1 MAIL_REGISTRY           1234-0-0/c STRC(54)    r     1 MESS
  2436-0-0/c CHAR(16)    r     1 MSGACKTO                2404-0-0/c CHAR(5)     r     1 MSGBCC
  2400-0-0/c CHAR(4)     r     1 MSGCC                   2372-0-0/c CHAR(6)     r     1 MSGDATE
  2411-0-0/c CHAR(6)     r     1 MSGFROM                 2427-0-0/c CHAR(12)    r     1 MSGID
  2424-0-0/c CHAR(12)    r     1 MSGQUOTE                2421-0-0/c CHAR(12)    r     1 MSGRE
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:458  
  2375-0-0/c CHAR(11)    r     1 MSGREALLY_TO            2406-0-0/c CHAR(10)    r     1 MSGREAL_BCC
  2401-0-0/c CHAR(9)     r     1 MSGREAL_CC              2432-0-0/c CHAR(13)    r     1 MSGREFID
  2413-0-0/c CHAR(10)    r     1 MSGREPLY                2442-0-0/c CHAR(19)    r     1 MSGRRTO
  2416-0-0/c CHAR(9)     r     1 MSGSUBJ                 2374-0-0/c CHAR(4)     r     1 MSGTO
  2234-0-0/c CHAR(61)    r     1 MULTIPLEADDRESSERR      2254-0-0/c CHAR(63)    r     1 NOTMULTICSADDRESSERR
  2115-0-0/w STRC(99)    r     1 NO_HOST                 2112-0-0/w STRC(99)    r     1 NO_MODEM
  2120-0-0/w STRC(99)    r     1 NO_SMTP                  212-0-0/d STRC(2088)  r     1 OPEN_FOLDER
   762-0-0/d STRC(2088)  r     1 OPEN_HANGUP              616-0-0/d STRC(2088)  r     1 OPEN_MAILMSG
  1112-0-0/d STRC(2088)  r     1 OPEN_QUOTES              304-0-0/d STRC(2088)  r     1 OPEN_REGISTRY
    44-0-0/d STRC(2088)  r     1 OPEN_UI                 2455-0-0/w PTR         r     1 PATH$
  2214-0-0/c CHAR(63)    r     1 PATHERR                 2131-0-0/c CHAR(3)     r     1 PROMPTSTRING
  2461-0-0/w PTR         r     1 RE$                     1204-0-0/d STRC(504)   r     1 READ_QUOTES
  1310-0-0/d STRC(504)   r     1 READ_UC                  136-0-0/d STRC(504)   r     1 READ_UI
  2055-0-0/c STRC(387)   r     1 REJECTING_MESSAGE       1712-0-0/d STRC(216)   r     1 RELEASE_ADDRESSES
  1676-0-0/d STRC(216)   r     1 RELEASE_BUFFERS         1720-0-0/d STRC(648)   r     1 RELEASE_PACKS
  2210-0-0/w PTR         r     1 REPLY$                  2454-0-0/w PTR         r     1 REPLYADDR$
  2453-0-0/w PTR         r     1 REPLYNAME$              2452-0-0/w PTR         r     1 REPLY_TO$
  1650-0-0/d STRC(216)   r     1 SCREECH3                1770-0-0/c STRC(171)   r     1 SEARCHING
  2026-0-0/c STRC(162)   r     1 SENDING_ADDRESSES       2033-0-0/c STRC(207)   r     1 SENDING_HEADER
  1274-0-0/c STRC(369)   r     1 SEND_CMD                1242-0-0/d STRC(576)   r     1 SEND_MAILMSG
  2462-0-0/w PTR         r     1 SIGNATURE$
  2144-0-0/c UBIN(9)     r     1 SKIP_BLANKS(0:127)
  1664-0-0/d STRC(72)    r     1 SUA3                    1666-0-0/d STRC(72)    r     1 SUA4
  2460-0-0/w PTR         r     1 SUBJECT$                1272-0-0/c STRC(72)    r     1 TCM_SEND_ACCT
  1262-0-0/c STRC(288)   r     1 TCM_SEND_NAME              0-0-0/w STRC(216)   r     1 TCM_SOCKINIT
  2465-0-0/c CHAR        r     1 TCM_XLATE_TO_UC(0:511)
  2350-0-0/d VECT        r     1 TEMPBUF_                2456-0-0/w PTR         r     1 TO$
  2327-0-0/c CHAR(62)    r     1 TOERR                   2464-0-0/w PTR         r     1 TOSITE$
  1746-0-0/c STRC(90)    r     1 VMERRMSG                2126-0-0/c STRC(45)    r     1 VM_FILERES
  2123-0-0/c STRC(18)    r     1 VM_PROKEY               2124-0-0/c STRC(72)    r     1 VM_PRORES
  2130-0-0/c STRC(18)    r     1 VM_SITEKEY
  2002-0-0/c STRC(252)   r     1 WAITING_FOR_SMTP_GREETING
  1642-0-0/d STRC(216)   r     1 WAIT_A_SECOND            710-0-0/d STRC(432)   r     1 WRITE_MAILMSG_BLANK
  1342-0-0/d STRC(432)   r     1 WRITE_ME_BLANK          1326-0-0/d STRC(432)   r     1 WRITE_ME_NULL
   434-0-0/d STRC(1080)  r     1 ZAP_FOLDER

  ****  Section 006  Data  TCM$NETSEND
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:459  

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

  2702-0-0/w STRC(2331)  r     1 BAD_ADDRESS             2310-0-0/w UBIN        r     1 BLANK_COUNT
  2107-0-0/c CHAR(255)   r     1 CMDBUF                  3306-0-0/w STRC(2331)  r     1 COMMENT
  3441-0-0/c CHAR(10)    r     1 DATEBUF                 3436-0-0/c CHAR(10)    r     1 DATESTRING
  3436-0-0/c STRC(90)    r     1 DATEWORK                3444-0-0/c CHAR(3)     r     1 DAYBUF
  3444-0-0/c BIT (27)    r     1 DAYMASK                  154-0-0/d STRC(360)   r     1 DELETE_FOLDER
   667-0-0/c STRC(270)   r     1 DRAINING_COMGROUP       2364-0-0/w STRC(756)   r     1 FROMADDR
  2312-0-0/w STRC(756)   r     1 FROMNAME                2337-0-0/w STRC(756)   r     1 FROMSIGN
   576-0-0/d STRC(936)   r     1 GET_MAIL_ERROR_CODE      652-0-0/c STRC(180)   r     1 IDLE
  1231-0-0/c CHAR(255)   r     1 LINEBUF                 1331-0-0/w UBIN        r     1 LINELEN
  1226-0-0/d VECT        r     1 MAIL_ADDRESSES          1224-0-0/d VECT        r     1 MAIL_BUFFERS
  1332-0-0/c CHAR(120)   r     1 MAIL_ERROR_CODE(0:9)
  2210-0-0/c CHAR(255)   r     1 MSGBUF                  3431-0-0/c CHAR(8)     r     1 MSG_DATE
  3433-0-0/c CHAR(11)    r     1 MSG_TIME                3430-0-0/w UBIN        r     1 MSG_TSTAMP
  1127-0-0/c STRC(576)   r     1 NODENAME                  14-0-0/d STRC(2088)  r     1 OPEN_MESSAGE
  2510-0-0/w STRC(2196)  r     1 PATH                     106-0-0/d STRC(360)   r     1 POSITION_FOLDER
   260-0-0/d STRC(7416)  r     1 PSN                     2006-0-0/c CHAR(255)   r     1 QUOTE_BUF
  2106-0-0/c STRC        r     1 QUOTE_KEY               3104-0-0/w STRC(2331)  r     1 RE
   120-0-0/d STRC(504)   r     1 READ_FOLDER              136-0-0/d STRC(504)   r     1 READ_REGISTRY
   634-0-0/d STRC(504)   r     1 READ_SITE               2463-0-0/w STRC(756)   r     1 REPLYADDR
  2207-0-0/w UBIN        r     1 REPLYLEN                2436-0-0/w STRC(756)   r     1 REPLYSIGN
  2411-0-0/w STRC(756)   r     1 REPLY_TO                 657-0-0/c STRC(279)   r     1 SENDING_MESSAGE_BODY
  3205-0-0/w STRC(2331)  r     1 SIGNATURE               1147-0-0/c STRC(576)   r     1 SITE_NAME
  3003-0-0/w STRC(2331)  r     1 SUBJECT                  232-0-0/c STRC(72)    r     1 TCM_ACCOUNT
  1167-0-0/b BIT         r     1 TCM_DRIBBLE             1170-0-0/b BIT         r     1 TCM_DRIBBLE_ME
   234-0-0/c STRC(72)    r     1 TCM_MESSACCT
  1210-0-0/c CHAR(11)    r     1 TCM_PHONE(0:3)
  1173-0-0/c CHAR(7)     r     1 TCM_PROGNAME            1124-0-0/d REMB        r     1 TCM_SMTP_BAILOUT
  1126-0-0/w UBIN        r     1 TCM_SMTP_PROGRESS       1175-0-0/c CHAR(32)    r     1 TCM_STUCKEE
  1171-0-0/b BIT         r     1 TCM_TESTMODE            1205-0-0/c CHAR(6)     r     1 TCM_TZTEXT
  1207-0-0/w SBIN        r     1 TCM_UTOFFSET            1223-0-0/b BIT         r     1 TCP_FLAVOR
  2311-0-0/c CHAR(4)     r     1 TEMPBUF                 3445-0-0/c CHAR(5)     r     1 TIMEBUF
  3447-0-0/c CHAR(8)     r     1 TIMEBUF2                1230-0-0/w UBIN        r     1 TIME_NOW
  2605-0-0/w STRC(2196)  r     1 TONAME                  3407-0-0/w STRC(612)   r     1 TOSITE
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:460  
   630-0-0/d STRC(144)   r     1 VLR_ERRMSG              1117-0-0/c STRC(72)    r     1 VM_BODYKEY
  1121-0-0/c STRC(45)    r     1 VM_HEADRES              1032-0-0/c STRC(54)    r     1 VM_INFOKEY
  1034-0-0/c STRC(1818)  r     1 VM_LISTKEY               252-0-0/d STRC(216)   r     1 WAIT_A_WHILE
     0-0-0/d STRC(432)   r     1 WRITE_DO                 166-0-0/d STRC(432)   r     1 WRITE_FOLDER
   202-0-0/d STRC(432)   r     1 WRITE_MAILMSG            236-0-0/d STRC(432)   r     1 WRITE_ME
   216-0-0/d STRC(432)   r     1 WRITE_QUOTES             744-0-0/d STRC(1512)  r     1 XUG_GETCMD
   700-0-0/d STRC(1296)  r     1 XUG_INIT                1016-0-0/d STRC(432)   r     1 XUW_WILDCARD

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

 22477-0-0/w PTR         r     1 @ADDRESS$              22717-0-0/w PTR         r     1 @BUF
 22475-0-0/w PTR         r     1 @CP6$                  22476-0-0/w PTR         r     1 @DEST$
 22477-0-0/w PTR         r     1 @DEST_LEN              22607-0-0/w PTR         r     1 @HEADER
 22610-0-0/w PTR         r     1 @HEADER_LENGTH         22711-0-0/w PTR         r     1 @MAX#
 22715-0-0/w PTR         r     1 @MSG                   22476-0-0/w PTR         r     1 @NAME$
 22476-0-0/w PTR         r     1 @PTR$                  22612-0-0/w PTR         r     1 @REALLY
 22613-0-0/w PTR         r     1 @REALLY_LENGTH         22607-0-0/w PTR         r     1 @REPLY_CODE
 22607-0-0/w PTR         r     1 @SITENAME              22475-0-0/w PTR         r     1 @SOURCE$
 22475-0-0/w PTR         r     1 @STRUCTURE             22614-0-0/w PTR         r     1 @TEXT$
 22611-0-0/w PTR         r     1 @TYPE                  22720-0-0/w PTR         r     1 @VLEN
 22347-0-0/w PTR         r     1 ADDRESS$                  *0-0-0/w PTR         r     1 ADDRESS$
 22350-0-0/w PTR         r     1 ALIAS$                 22610-0-0/b BIT         r     1 ALTRETURNED
 22500-0-0/w UBIN        r     1 BLANK_INDEX            22346-0-0/w PTR         r     1 BODY$
    *0-0-0/c CHAR(255)   r     1 BUF                    22355-0-0/w UBIN        r     1 COUNT
 22615-0-0/w UBIN        r     1 COUNT                     *0-0-0/w PTR         r     1 CP6$
   127-0-0/w SBIN        r     1 CURR_SITE                 *0-0-0/w PTR         r     1 DEST$
    *0-0-0/w UBIN        r     1 DEST_LEN               22603-0-0/b BIT         r     1 DONE_COMMA
 22711-0-0/b BIT         r     1 EMITTING               22353-0-0/b BIT         r     1 ERROR_FLAG
   102-0-0/w BIT         r     1 FLOW_CONTROL_ENABLED   22712-0-0/w SBIN        r     1 FRST
 22356-0-0/b BIT         r     1 GOT_ONE                22616-0-0/b BIT         r     1 GOT_ONE
 22354-0-0/b BIT         r     1 HAVE_A_CMD             22355-0-0/b BIT         r     1 HAVE_A_MESSAGE
 22361-0-0/b BIT         r     1 HAVE_A_MESSAGE            *0-0-0/c ACHR        r     1 HEADER
 22345-0-0/w PTR         r     1 HEADER$                  115-0-0/w SBIN        r     1 HEADER_ARS
    *0-0-0/w UBIN        r     1 HEADER_LENGTH            145-0-0/b STRC(3)     r     1 HITS
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:461  
 22355-0-0/w SBIN        r     1 I                      22357-0-0/w SBIN        r     1 I
 22475-0-0/w UBIN        r     1 I                      22401-0-0/w UBIN        r     1 II
 22361-0-0/w UBIN        r     1 INDX                   22617-0-0/w UBIN        r     1 INDX
 22476-0-0/w UBIN        r     1 INDX                   22362-0-0/w UBIN        r     1 INDX1
 22363-0-0/w UBIN        r     1 INDX2                    144-0-0/w UBIN        r     1 IS_OR_VIA
 22356-0-0/w SBIN        r     1 J                      22402-0-0/w UBIN        r     1 JJ
 22713-0-0/w SBIN        r     1 LAST                   22360-0-0/w SBIN        r     1 LEN
 22604-0-0/w UBIN        r     1 LEN_SOURCE             22605-0-0/w UBIN        r     1 LEN_TARGET
 22477-0-0/w UBIN        r     1 LIST                     105-0-0/w UBIN        r     1 LOC
   106-0-0/w UBIN        r     1 LOCE                   22362-0-0/w UBIN        r     1 LPAREN
 22363-0-0/w UBIN        r     1 LPAREN1                   73-0-0/w PTR         r     1 M$BOX$
    74-0-0/w PTR         r     1 M$CMD$                    77-0-0/w PTR         r     1 M$FOLDER$
    75-0-0/w PTR         r     1 M$MSG$                    76-0-0/w PTR         r     1 M$REGISTRY$
   101-0-0/w PTR         r     1 M$SI$                     *0-0-0/w UBIN        r     1 MAX#
   141-0-0/b BIT         r     1 MESSAGE_FILE              *0-0-0/w ASTR(9)     r     1 MSG
 22611-0-0/c CHAR(255)   r     1 MSGBUF                   103-0-0/w UBIN        r     1 MSG_COUNT
 22343-0-0/w UBIN        r     1 MSG_NUMBER                *0-0-0/w PTR         r     1 NAME$
 22364-0-0/w UBIN        r     1 NAME_END               22501-0-0/w UBIN        r     1 NAME_END
  1252-0-0/w STRC(684)   r     1 NODE(0:29)               131-0-0/w SBIN        r     1 NODES
 22364-0-0/w UBIN        r     1 OFFSET                 22712-0-0/w UBIN        r     1 OFFSET
 22353-0-0/w UBIN        r     1 OLDEST                 22357-0-0/w PTR         r     1 OPT$
   111-0-0/w PTR         r     1 OUT$                   22356-0-0/b BIT         r     1 OUT_OF_MESSAGES
 22365-0-0/w UBIN        r     1 PDEPTH                 22344-0-0/w PTR         r     1 PROFILE$
    *0-0-0/w STRC        r     1 PTR#                      *0-0-0/w PTR         r     1 PTR$
   140-0-0/w UBIN        r     1 QUOTE_COUNT            22365-0-0/w SBIN        r     1 QUOTE_NUMBER
    *0-0-0/c ACHR        r     1 REALLY                    *0-0-0/w UBIN        r     1 REALLY_LENGTH
    *0-0-0/c CHAR        r     1 REPLY_CODE             22711-0-0/w UBIN        r     1 RETRIES
 21550-0-0/w STRC(648)   r     1 REWRITE(0:20)          22342-0-0/w SBIN        r     1 REWRITES
 22366-0-0/w UBIN        r     1 RPAREN                   133-0-0/c CHAR(8)     r     1 SAVED_ACCN
   146-0-0/w STRC(2056)  r     1 SITE(0:9)                 *0-0-0/c ASTR(9)     r     1 SITENAME
   126-0-0/w SBIN        r     1 SITES                  22361-0-0/w UBIN        r     1 SITE_END
 22502-0-0/w UBIN        r     1 SITE_INDEX             22363-0-0/c CHAR(32)    r     1 SITE_STRING
    *0-0-0/w PTR         r     1 SOURCE$                22403-0-0/c CHAR(255)   r     1 SOURCE_STRG
 22370-0-0/w UBIN        r     1 STARTSCAN                 *0-0-0/b BIT         r     1 STRUCTURE
 22360-0-0/w PTR         r     1 SUB$                   22503-0-0/c CHAR(255)   r     1 TARGET_STRG
 22367-0-0/c CHAR(32)    r     1 TBUF                     112-0-0/b BIT         r     1 TERMINATING
    *0-0-0/w PTR         r     1 TEXT$                    132-0-0/w SBIN        r     1 THIS_NODE
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:462  
   130-0-0/w SBIN        r     1 THIS_SITE                113-0-0/w UBIN        r     1 TIME_THEN
   143-0-0/w UBIN        r     1 TOTAL_READY            22377-0-0/b BIT         r     1 TRIED_DIRECT_SEND
 22353-0-0/w SBIN        r     1 TRIES_LEFT             22607-0-0/c CHAR(255)   r     1 TSTRING
 22372-0-0/c CHAR(255)   r     1 TSTRING                22503-0-0/c CHAR(80)    r     1 TSTRING
   107-0-0/w UBIN        r     1 TVAL                   22400-0-0/w UBIN        r     1 TVAL
 22707-0-0/w UBIN        r     1 TVAL                   22472-0-0/w UBIN        r     1 TVAL
 22527-0-0/w UBIN        r     1 TVAL                      *0-0-0/w UBIN        r     1 TYPE
  2344-0-0/w STRC(2232)  r     1 USERS(0:125)             142-0-0/w UBIN        r     1 USER_COUNT
   114-0-0/w SBIN        r     1 UTS_DIFF                 104-0-0/w UBIN        r     1 VLEN
 22363-0-0/w UBIN        r     1 VLEN                      *0-0-0/w UBIN        r     1 VLEN
     3-0-0/w STRC(2016)  r     1 VM_SITE

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$DS5$                     0-0-0/w PTR         r     1 B$JIT$
     0-0-0/w UBIN        r     1 TCM_CONFIG_CMD             0-0-0/c CHAR(32)    r     1 TCM_LOGON

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/c CHAR(512)   r     1 CHARS
     0-0-0/w ASTR        r     1 CV                         0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0N  NULL        r     1 M$BOX                      0-0-0N  NULL        r     1 M$CMD
     0-0-0N  NULL        r     1 M$DO                       0-0-0N  NULL        r     1 M$FOLDER
     0-0-0N  NULL        r     1 M$HANGUP                   0-0-0N  NULL        r     1 M$ME
     0-0-0N  NULL        r     1 M$MSG                      0-0-0N  NULL        r     1 M$QUOTES
     0-0-0N  NULL        r     1 M$REGISTRY                 0-0-0N  NULL        r     1 M$SI
     0-0-0N  NULL        r     1 M$UC                       0-0-0N  NULL        r     1 M$UI
     0-0-0/w STRC(144)   r     1 OUT$BLK                    0-0-0/w ASTR(153)   r     1 OUT$SYM
     0-0-0/w STRC(504)   r     1 P$PCB                      0-0-0/c ACHR        r     1 REPLY
     0-0-0/c ASTR(9)     r     1 TEXTC                      0-0-0/w STRC(252)   r     1 VM_ADD_HEAD
     0-0-0/w STRC(2772)  r     1 VM_BODYREC                 0-0-0/w STRC(1332)  r     1 VM_HEADER
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:463  
     0-0-0/w STRC(4068)  r     1 VM_PROFILE                 0-0-0/w STRC(2448)  r     1 VM_UADDRESS


   Procedure TCM$NETSEND requires 6034 words for executable code.
   Procedure TCM$NETSEND requires 9688 words of local(AUTO) storage.
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:464  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:465  
          MINI XREF LISTING

ACKNOWLEDGING_MESSAGE
     10834**DCL     15131<>CALL
ADDRERR
     12829**DCL     14707>>ASSIGN  14708--ASSIGN  14733>>ASSIGN  14734--ASSIGN
ADDRESS$
     13118**DCL     12310--IMP-PTR 13638<<ASSIGN  13650<<ASSIGN  14787>>ASSIGN  14807>>IF      14812>>ASSIGN
     14813>>CALL
ADDRESS$ IN PROCEDURE MAKE_SMTP_ADDRESS
     15000**DCL     14998--PROC    15017>>ASSIGN  15018>>ASSIGN  15018>>ASSIGN  15019>>ASSIGN  15019>>ASSIGN
     15050>>ASSIGN  15051>>ASSIGN  15051>>ASSIGN  15056>>CALLBLT 15056>>CALLBLT 15057>>DOWHILE 15058>>ASSIGN
     15058>>ASSIGN  15059>>CALLBLT 15059>>CALLBLT
ADJUST_POINTER
     14605**PROC    14588--CALL    14589--CALL    14590--CALL    14591--CALL    14592--CALL    14593--CALL
     14594--CALL    14595--CALL    14596--CALL    14597--CALL    14598--CALL    14599--CALL    14600--CALL
     14813--CALL
ALIAS$
     13119**DCL     12339--IMP-PTR 14812<<ASSIGN  14813<>CALL    14814>>IF      14814>>IF      14814>>IF
     14821>>ASSIGN  14822>>ASSIGN  14919<<ASSIGN  14920>>DOWHILE 14921>>IF      14927>>DOWHILE 14927>>DOWHILE
     14927>>DOWHILE 14929>>ASSIGN  14929>>ASSIGN  14931>>CALLBLT 14931>>CALLBLT 14934>>CALLBLT 14934>>CALLBLT
     14934>>CALLBLT 14939>>CALLBLT 14939>>CALLBLT 14939>>CALLBLT 14964<<ASSIGN  14964>>ASSIGN
ALTRETURNED IN PROCEDURE SEND_SMTP_COMMAND
     14433**DCL     14447<<ASSIGN  14451>>DOUNTIL 14460<<ASSIGN  14467>>IF
AWAITING_FINAL_ACK
     10747**DCL     14197<>CALL
B$ALT.CODE
      7659**DCL      7659--REDEF    7660--REDEF    7660--REDEF
B$ALT.ERR.ERR#
      7661**DCL      7661--REDEF
B$ALT.EVID
      7660**DCL      7660--REDEF    7660--REDEF
B$DS5$
      7667**DCL     13631>>ASSIGN
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:466  
B$JIT.ACCN
        23**DCL     15180>>ASSIGN  15182<<ASSIGN  15187<<ASSIGN
B$JIT.CCARS
       111**DCL     15236<<ASSIGN
B$JIT.CCBUF
       111**DCL     13163>>CALLBLT 13171>>CALLBLT 15237<<CALLBLT
B$JIT.CPFLAGS1.SLEAZE
       117**DCL       117--REDEF
B$JIT.ERR.MID
        24**DCL        24--REDEF
B$JIT.JRESPEAK
       185**DCL       186--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
       294**DCL       294--REDEF     295--REDEF
B$JIT.PNR
       198**DCL       198--REDEF
B$JIT.PRFLAGS.UI
       107**DCL     13594>>IF
B$JIT.PRIV.ACTIVE.EXMM
        28**DCL     13202<<ASSIGN
B$JIT.PRIV.ACTIVE.JIT
        28**DCL     15181>>IF      15186>>IF      15235>>IF
B$JIT.PRIV.JOB.FMSEC
        68**DCL     13208<<ASSIGN
B$JIT.TSLINE
       292**DCL       293--REDEF
B$JIT$
      7669**DCL        18--IMP-PTR 13163>>CALLBLT 13171>>CALLBLT 13202>>ASSIGN  13208>>ASSIGN  13594>>IF
     15180>>ASSIGN  15181>>IF      15182>>ASSIGN  15186>>IF      15187>>ASSIGN  15235>>IF      15236>>ASSIGN
     15237>>CALLBLT
BAD_ADDRESS
     13015**DCL     13014--DCLINIT
BAD_ADDRESS$
     13014**DCL     14392>>IF      14395>>CALLBLT 14395>>CALLBLT 14645<>CALL
BAILOUT
     13259**LABEL   13213--REMEMBR 13229--CALLALT 13230--CALLALT 13231--CALLALT 13256--CALLALT
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:467  
BAILOUT IN PROCEDURE SMTP_SESSION
     13888**LABEL   13821--CALLALT 13822--CALLALT
BEGIN_SENDING IN PROCEDURE SEND_ONE_MAILGRAM
     13918**LABEL   14221--GOTO
BLANK_COUNT
     12835**DCL     14032<<ASSIGN  14492<<ASSIGN  14492>>ASSIGN  14495>>DOWHILE 14499<<ASSIGN  14499>>ASSIGN
BLANK_INDEX IN PROCEDURE MAKE_SMTP_ADDRESS
     15001**DCL     15056<<CALLBLT 15057>>DOWHILE 15058>>ASSIGN  15059<<CALLBLT
BLANK_LINE
     12834**DCL      8822--DCLINIT  8823--DCLINIT  9579--DCLINIT  9580--DCLINIT
BLANK_LINE IN PROCEDURE GET_IOBUF_BOUND
     15265**LABEL   15262--CALLALT
BODY$
     13117**DCL     12392--IMP-PTR 13637<<ASSIGN  13649<<ASSIGN  14289>>ASSIGN  14295>>ASSIGN  14306>>IF
     14307>>CALLBLT 14309>>ASSIGN  14341>>ASSIGN  14348>>ASSIGN  14356>>DOSELCT 14359>>CALLBLT 14360>>CALLBLT
     14362>>CALLBLT 14370>>ASSIGN  14378>>ASSIGN
BUF IN PROCEDURE GET_IOBUF_BOUND
     15259**DCL     15257--PROC    15262>>CALLBLT
CHARS IN PROCEDURE INITIALIZE_CONFIGURATION
     13349**DCL     13398>>CALLBLT
CHECK_RE IN PROCEDURE PARSE_MAIL_HEADER
     14715**LABEL   14691--CALLALT
CHECK_TO IN PROCEDURE PARSE_MAIL_HEADER
     14741**LABEL   14717--CALLALT
CHOOSE_A_SITE
     13678**PROC    13249--CALL
CLOSE_FOLDER
      8448**DCL     13239<>CALL    13246<>CALL    13261<>CALL    13770<>CALL    13865<>CALL    13876<>CALL
CLOSE_FOLDER.SN_
      8448**DCL      8448--REDEF
CLOSE_FOLDER.UTL_
      8449**DCL      8449--REDEF
CLOSE_FOLDER.V
      8453**DCL      8448--DCLINIT
CLOSE_FOLDER.V.EXPIRE#
      8463**DCL      8463--REDEF
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:468  
CLOSE_FOLDER.V.TYPE#
      8461**DCL      8461--REDEF
CLOSE_FOLDER.V.XTNSIZE#
      8458**DCL      8458--REDEF    8460--REDEF
CLOSE_HANGUP
      9011**DCL     13223<>CALL
CLOSE_HANGUP.SN_
      9011**DCL      9011--REDEF
CLOSE_HANGUP.UTL_
      9012**DCL      9012--REDEF
CLOSE_HANGUP.V
      9016**DCL      9011--DCLINIT
CLOSE_HANGUP.V.EXPIRE#
      9026**DCL      9026--REDEF
CLOSE_HANGUP.V.TYPE#
      9024**DCL      9024--REDEF
CLOSE_HANGUP.V.XTNSIZE#
      9021**DCL      9021--REDEF    9023--REDEF
CLOSE_MAILMSG
      8858**DCL     15179<>CALL
CLOSE_MAILMSG.SN_
      8858**DCL      8858--REDEF
CLOSE_MAILMSG.UTL_
      8859**DCL      8859--REDEF
CLOSE_MAILMSG.V
      8863**DCL      8858--DCLINIT
CLOSE_MAILMSG.V.EXPIRE#
      8873**DCL      8873--REDEF
CLOSE_MAILMSG.V.TYPE#
      8871**DCL      8871--REDEF
CLOSE_MAILMSG.V.XTNSIZE#
      8868**DCL      8868--REDEF    8870--REDEF
CLOSE_REGISTRY
      8532**DCL     13266<>CALL
CLOSE_REGISTRY.SN_
      8532**DCL      8532--REDEF
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:469  
CLOSE_REGISTRY.UTL_
      8533**DCL      8533--REDEF
CLOSE_REGISTRY.V
      8537**DCL      8532--DCLINIT
CLOSE_REGISTRY.V.EXPIRE#
      8547**DCL      8547--REDEF
CLOSE_REGISTRY.V.TYPE#
      8545**DCL      8545--REDEF
CLOSE_REGISTRY.V.XTNSIZE#
      8542**DCL      8542--REDEF    8544--REDEF
CLOSE_SI
      7705**DCL     13578<>CALL
CLOSE_SI.SN_
      7705**DCL      7705--REDEF
CLOSE_SI.UTL_
      7706**DCL      7706--REDEF
CLOSE_SI.V
      7710**DCL      7705--DCLINIT
CLOSE_SI.V.EXPIRE#
      7720**DCL      7720--REDEF
CLOSE_SI.V.TYPE#
      7718**DCL      7718--REDEF
CLOSE_SI.V.XTNSIZE#
      7715**DCL      7715--REDEF    7717--REDEF
CLOSE_UI
      7926**DCL     13623<>CALL
CLOSE_UI.SN_
      7926**DCL      7926--REDEF
CLOSE_UI.UTL_
      7927**DCL      7927--REDEF
CLOSE_UI.V
      7931**DCL      7926--DCLINIT
CLOSE_UI.V.EXPIRE#
      7941**DCL      7941--REDEF
CLOSE_UI.V.TYPE#
      7939**DCL      7939--REDEF
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:470  
CLOSE_UI.V.XTNSIZE#
      7936**DCL      7936--REDEF    7938--REDEF
CMD IN PROCEDURE INITIALIZE_CONFIGURATION
     13378**LABEL   13436--EXIT
CMDBUF
     12811**DCL      9479--DCLINIT  9480--DCLINIT  9517--DCLINIT  9518--DCLINIT 12812--DCLINIT 12814--DCLINIT
     13188<<ASSIGN  13252<<CALLBLT 13253>>CALLBLT 13432<<ASSIGN  13519<<ASSIGN  13551<<ASSIGN  13568<<ASSIGN
     13833>>DOUNTIL 13840>>IF      13846<<CALLBLT 13848>>IF      13882<<ASSIGN  13934<<CALLBLT 13995<<CALLBLT
     14003<<ASSIGN  14017<<CALLBLT 14021<<ASSIGN  14028<<ASSIGN  14039<<CALLBLT 14042<<CALLBLT 14046<<CALLBLT
     14052<<CALLBLT 14056<<CALLBLT 14063<<CALLBLT 14067<<CALLBLT 14074<<CALLBLT 14080<<CALLBLT 14083<<CALLBLT
     14125<<CALLBLT 14128<<CALLBLT 14133<<CALLBLT 14135<<CALLBLT 14137>>CALLBLT 14138<<CALLBLT 14143<<CALLBLT
     14147<<CALLBLT 14151<<CALLBLT 14155<<CALLBLT 14172<<ASSIGN  14174<<ASSIGN  14175<<ASSIGN  14181<<ASSIGN
     14196<<ASSIGN  14225<<ASSIGN  14247<<ASSIGN  14249<<ASSIGN  14250<<ASSIGN  14253<<CALLBLT 14262<<CALLBLT
     14307<<CALLBLT 14309<<ASSIGN  14362<<CALLBLT 14366<<CALLBLT 14378<<ASSIGN  14393<<ASSIGN  14395<<CALLBLT
     14399>>CALLBLT 14400>>IF      14402>>CALLBLT 14402>>CALLBLT 14403<<ASSIGN  14407<<ASSIGN  14413<<ASSIGN
     14417<<ASSIGN  14419<<ASSIGN  14423<<ASSIGN  14439>>ASSIGN  14440<>CALL    14448<<ASSIGN  14470>>IF
     14479>>IF      14479>>IF      14489<>CALL    14491>>IF      14707<<ASSIGN  14733<<ASSIGN  14803<<ASSIGN
     14808<<ASSIGN  14817<<ASSIGN  14923<<ASSIGN  15247<>CALL    15251--ASSIGN
CMDBUF_
     12812**DCL     13834<>CALL    14457<>CALL    14458<>CALL    14507<>CALL
CMN2UTS
     12714**DCL     13415>>ASSIGN
COLON_SYS
     10317**DCL     10264--DCLINIT
COMMENT
     13075**DCL     13074--DCLINIT
COMMENT$
     13074**DCL     14136>>IF      14138>>CALLBLT 14138>>CALLBLT 14836>>ASSIGN  14853>>ASSIGN  14854>>ASSIGN
     14855>>ASSIGN  14855>>ASSIGN  14876>>IF
COMMON IN PROCEDURE EMIT_TRACE_RECORDS
     14330**LABEL   14324--GOTO
COMMON IN PROCEDURE POST_MESSAGE_ACKNOWLEDGEMENT
     15179**LABEL   15225--GOTO
CONNECTING
     10513**DCL     13825<>CALL
COPY
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:471  
     14979**PROC    14639--CALL    14640--CALL    14641--CALL    14642--CALL    14643--CALL    14644--CALL
     14645--CALL
COUNT IN PROCEDURE EMIT_ADDRESSES
     14233**DCL     14244<<DOINDEX 14245>>IF      14245>>IF      14250>>ASSIGN  14253>>CALLBLT 14256>>ASSIGN
COUNT IN PROCEDURE SEND_ONE_MAILGRAM
     13894**DCL     13942<<DOINDEX 13943>>IF      13943>>IF      13947>>CALLBLT 13949>>CALLBLT 13960>>ASSIGN
     13961>>ASSIGN  13961>>ASSIGN  13962>>CALLBLT 13964>>ASSIGN  13972>>CALLBLT 13973>>CALLBLT 13979>>CALLBLT
     13980>>ASSIGN  13981>>CALLBLT 13983>>IF      13984>>ASSIGN  13985>>ASSIGN  13988>>ASSIGN  13991>>ASSIGN
     13995>>CALLBLT 13995>>CALLBLT 14007>>ASSIGN  14008>>ASSIGN  14189>>DOUNTIL 14190<>CALL    14191>>CALLBLT
     14193>>IF
CP6$ IN PROCEDURE MAKE_SMTP_ADDRESS
     15002**DCL     14998--PROC    15009>>CALLBLT 15009>>CALLBLT 15010>>CALLBLT 15010>>CALLBLT 15011>>IF
     15012>>ASSIGN  15016>>ASSIGN  15016>>ASSIGN  15017>>ASSIGN  15018>>ASSIGN  15018>>ASSIGN  15022>>IF
     15022>>IF      15024>>CALLBLT 15024>>CALLBLT 15026>>CALLBLT 15026>>CALLBLT 15026>>CALLBLT 15026>>CALLBLT
     15026>>CALLBLT 15031>>CALLBLT 15031>>CALLBLT 15032>>ASSIGN  15032>>ASSIGN  15034>>ASSIGN  15034>>ASSIGN
     15034>>ASSIGN  15037>>IF      15037>>IF      15038>>CALLBLT 15038>>CALLBLT 15040>>ASSIGN  15041>>CALLBLT
     15041>>CALLBLT 15042>>ASSIGN  15043>>ASSIGN  15043>>ASSIGN  15045>>CALLBLT 15045>>CALLBLT 15046>>IF
     15049>>ASSIGN  15049>>ASSIGN  15051>>ASSIGN  15051>>ASSIGN
CURR_SITE
     12726**DCL     13226<<DOINDEX 13227>>ASSIGN  13250>>IF      13275>>IF      13276>>ASSIGN  13277>>ASSIGN
     13278>>DOCASE  13280>>CALL    13283>>CALL    13286>>CALL    13680<<ASSIGN  13689>>IF      13690<<ASSIGN
     13692>>IF      13693<<ASSIGN  13826>>CALL    13828>>CALL    13828>>CALL    13828>>CALL    13846>>CALLBLT
     13855>>CALL    13861>>IF      13873>>IF      13934>>CALLBLT 13934>>CALLBLT 13951>>ASSIGN  13952>>IF
     14009>>CALL    14042>>CALLBLT 14042>>CALLBLT 14050>>IF      14052>>CALLBLT 14052>>CALLBLT 14061>>IF
     14063>>CALLBLT 14063>>CALLBLT 14074>>CALLBLT 14074>>CALLBLT 14199>>IF      14199>>IF      14201>>CALL
     14206>>CALL    14210>>CALL    14223>>ASSIGN  14223>>ASSIGN  14366>>CALLBLT 14366>>CALLBLT
CV.L
     12541**DCL     12542--IMP-SIZ 13784>>IF      13785>>CALLBLT 13786>>CALLBLT 13787>>CALLBLT 13788>>CALLBLT
     13793>>CALLBLT 13794>>CALLBLT 13934>>CALLBLT 14007<<ASSIGN  14008>>ASSIGN  14017>>CALLBLT 14041>>IF
     14042>>CALLBLT 14042>>CALLBLT 14046>>CALLBLT 14046>>CALLBLT 14051>>IF      14052>>CALLBLT 14056>>CALLBLT
     14062>>IF      14063>>CALLBLT 14067>>CALLBLT 14072>>IF      14072>>IF      14072>>IF      14073>>IF
     14074>>CALLBLT 14074>>CALLBLT 14078>>CALLBLT 14080>>CALLBLT 14083>>CALLBLT 14083>>CALLBLT 14100>>IF
     14101>>CALLBLT 14101>>CALLBLT 14105>>CALLBLT 14108>>ASSIGN  14128>>CALLBLT 14128>>CALLBLT 14132>>IF
     14133>>CALLBLT 14133>>CALLBLT 14135>>CALLBLT 14135>>CALLBLT 14136>>IF      14138>>CALLBLT 14142>>IF
     14143>>CALLBLT 14146>>IF      14147>>CALLBLT 14369<<ASSIGN  14370>>ASSIGN  14372<<ASSIGN  14392>>IF
     14395>>CALLBLT 14649>>IF      14666<<ASSIGN  14667>>ASSIGN  14668<<ASSIGN  14669>>ASSIGN  14689>>IF
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:472  
     14691>>CALLBLT 14694<<ASSIGN  14694>>ASSIGN  14695>>ASSIGN  14695>>ASSIGN  14696<<ASSIGN  14696>>ASSIGN
     14696>>ASSIGN  14697>>IF      14697>>IF      14698<<ASSIGN  14698>>ASSIGN  14702<<ASSIGN  14702>>ASSIGN
     14703>>ASSIGN  14703>>ASSIGN  14704<<ASSIGN  14706>>CALLBLT 14711<<ASSIGN  14715>>IF      14717>>CALLBLT
     14720<<ASSIGN  14720>>ASSIGN  14721>>ASSIGN  14721>>ASSIGN  14722<<ASSIGN  14722>>ASSIGN  14722>>ASSIGN
     14723>>IF      14723>>IF      14724<<ASSIGN  14724>>ASSIGN  14728<<ASSIGN  14728>>ASSIGN  14729>>ASSIGN
     14729>>ASSIGN  14730<<ASSIGN  14732>>CALLBLT 14737<<ASSIGN  14741>>IF      14743>>CALLBLT 14745>>CALLBLT
     14746>>CALLBLT 14750>>CALLBLT 14752>>CALLBLT 14753<<ASSIGN  14754>>ASSIGN  14754>>ASSIGN  14755>>ASSIGN
     14756<<ASSIGN  14757>>ASSIGN  14758>>DOWHILE 14759>>IF      14759>>IF      14760<<ASSIGN  14760>>ASSIGN
     14766<<ASSIGN  14767>>CALLBLT 14767>>CALLBLT 14769<<ASSIGN  14773>>CALLBLT 14775>>CALLBLT 14777<<ASSIGN
     14777>>ASSIGN  14778>>CALLBLT 14778>>CALLBLT 14779<<ASSIGN  14785>>ASSIGN  14786>>CALLBLT 14821<<ASSIGN
     14822>>ASSIGN  14827>>CALLBLT 14829>>CALLBLT 14831>>ASSIGN  14836<<ASSIGN  14837>>CALLBLT 14838>>DOWHILE
     14841>>DOUNTIL 14842>>CALLBLT 14843>>CALLBLT 14853>>ASSIGN  14854<<ASSIGN  14855>>ASSIGN  14855>>ASSIGN
     14856>>ASSIGN  14858>>IF      14863>>DOWHILE 14864>>IF      14869>>CALLBLT 14869>>CALLBLT 14871<<ASSIGN
     14871>>ASSIGN  14872>>ASSIGN  14873>>CALLBLT 14876>>IF      14876>>IF      14878>>CALLBLT 14884>>CALLBLT
     14885>>CALLBLT 14890<<ASSIGN  14891>>ASSIGN  14891>>ASSIGN  14894>>CALLBLT 14895<<ASSIGN  14895>>ASSIGN
     14896>>ASSIGN  14896>>ASSIGN  14947<<ASSIGN  14948>>ASSIGN  14950<<ASSIGN  14951>>ASSIGN  14985<<ASSIGN
     14986>>ASSIGN  14989<<ASSIGN  14991<<ASSIGN  14992>>ASSIGN  15009>>CALLBLT 15010>>CALLBLT 15011>>IF
     15012<<ASSIGN  15015<<ASSIGN  15016>>ASSIGN  15016>>ASSIGN  15017<<ASSIGN  15017>>ASSIGN  15018>>ASSIGN
     15018>>ASSIGN  15019>>ASSIGN  15022>>IF      15024>>CALLBLT 15026>>CALLBLT 15026>>CALLBLT 15026>>CALLBLT
     15031>>CALLBLT 15032<<ASSIGN  15032>>ASSIGN  15034>>ASSIGN  15034>>ASSIGN  15037>>IF      15038>>CALLBLT
     15040>>ASSIGN  15041>>CALLBLT 15042<<ASSIGN  15043>>ASSIGN  15045>>CALLBLT 15046>>IF      15048<<ASSIGN
     15049>>ASSIGN  15049>>ASSIGN  15050<<ASSIGN  15051>>ASSIGN  15051>>ASSIGN  15056>>CALLBLT 15057>>DOWHILE
     15058>>ASSIGN  15059>>CALLBLT 15132>>IF      15135>>CALLBLT 15153>>IF      15154>>CALLBLT 15157>>IF
     15158>>CALLBLT 15193>>IF      15193>>IF      15198>>CALLBLT 15206>>IF      15207>>CALLBLT 15210>>IF
     15211>>CALLBLT 15214>>IF      15215>>CALLBLT
CV.T
     12542**DCL     13784>>IF      13785>>CALLBLT 13786>>CALLBLT 13787>>CALLBLT 13788>>CALLBLT 13793>>CALLBLT
     13794>>CALLBLT 13934>>CALLBLT 14008<<ASSIGN  14017>>CALLBLT 14041>>IF      14042>>CALLBLT 14042>>CALLBLT
     14046>>CALLBLT 14046>>CALLBLT 14051>>IF      14052>>CALLBLT 14056>>CALLBLT 14062>>IF      14063>>CALLBLT
     14067>>CALLBLT 14072>>IF      14072>>IF      14073>>IF      14074>>CALLBLT 14074>>CALLBLT 14078>>CALLBLT
     14080>>CALLBLT 14083>>CALLBLT 14083>>CALLBLT 14101>>CALLBLT 14128>>CALLBLT 14132>>IF      14133>>CALLBLT
     14135>>CALLBLT 14135>>CALLBLT 14138>>CALLBLT 14143>>CALLBLT 14147>>CALLBLT 14370<<ASSIGN  14395>>CALLBLT
     14649>>IF      14667<<ASSIGN  14669<<ASSIGN  14691>>CALLBLT 14695<<ASSIGN  14695>>ASSIGN  14697>>IF
     14703<<ASSIGN  14703>>ASSIGN  14706>>CALLBLT 14717>>CALLBLT 14721<<ASSIGN  14721>>ASSIGN  14723>>IF
     14729<<ASSIGN  14729>>ASSIGN  14732>>CALLBLT 14743>>CALLBLT 14745>>CALLBLT 14746>>CALLBLT 14750>>CALLBLT
     14752>>CALLBLT 14754<<ASSIGN  14754>>ASSIGN  14755>>ASSIGN  14757<<ASSIGN  14759>>IF      14767<<CALLBLT
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:473  
     14767>>CALLBLT 14773>>CALLBLT 14775>>CALLBLT 14778<<CALLBLT 14778>>CALLBLT 14786>>CALLBLT 14822<<ASSIGN
     14827>>CALLBLT 14829>>CALLBLT 14831<<ASSIGN  14837>>CALLBLT 14842>>CALLBLT 14843>>CALLBLT 14855<<ASSIGN
     14855>>ASSIGN  14858>>IF      14864>>IF      14869>>CALLBLT 14869>>CALLBLT 14872<<ASSIGN  14873>>CALLBLT
     14878>>CALLBLT 14884>>CALLBLT 14885>>CALLBLT 14891<<ASSIGN  14891>>ASSIGN  14894>>CALLBLT 14896<<ASSIGN
     14896>>ASSIGN  14948<<ASSIGN  14951<<ASSIGN  14986<<ASSIGN  14992<<ASSIGN  15009>>CALLBLT 15010>>CALLBLT
     15016<<ASSIGN  15016>>ASSIGN  15018<<ASSIGN  15018>>ASSIGN  15019<<ASSIGN  15022>>IF      15024>>CALLBLT
     15026>>CALLBLT 15026>>CALLBLT 15031>>CALLBLT 15034<<ASSIGN  15037>>IF      15038>>CALLBLT 15041>>CALLBLT
     15043<<ASSIGN  15045>>CALLBLT 15049<<ASSIGN  15049>>ASSIGN  15051<<ASSIGN  15051>>ASSIGN  15056>>CALLBLT
     15058<<ASSIGN  15059>>CALLBLT 15132>>IF      15135>>CALLBLT 15154>>CALLBLT 15158>>CALLBLT 15193>>IF
     15193>>IF      15198>>CALLBLT 15207>>CALLBLT 15211>>CALLBLT 15215>>CALLBLT
DATEBUF
     13108**DCL     14039>>CALLBLT 14680<<CALLBLT
DATESTRING
     13107**DCL     13252>>CALLBLT
DATEWORK
     13100**DCL      9851--DCLINIT  9852--DCLINIT  9871--DCLINIT  9872--DCLINIT 13107--REDEF
DATEWORK.DD
     13104**DCL     14680>>CALLBLT
DATEWORK.MON
     13101**DCL     13102--REDEF   14680>>CALLBLT
DATEWORK.MONMASK
     13102**DCL     14678<<ASSIGN  14678>>ASSIGN
DATEWORK.YY
     13106**DCL     14680>>CALLBLT
DAYBUF
     13109**DCL      9854--DCLINIT  9874--DCLINIT 13110--REDEF   14039>>CALLBLT
DAYMASK
     13110**DCL     14679<<ASSIGN  14679>>ASSIGN
DEAD_LETTER IN PROCEDURE PARSE_MAIL_HEADER
     14660**LABEL   14654--GOTO
DEBLANK IN PROCEDURE SEND_ERROR_REPORT
     14398**LABEL   14401--EXIT
DEBLANKED IN PROCEDURE SEND_ERROR_REPORT
     14406**LABEL   14399--CALLALT
DECODING_HEADER
     10600**DCL     13859<>CALL    13871<>CALL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:474  
DELETE_FOLDER
      8386**DCL     14217<>CALL
DELETE_FOLDER.KEY_
      8386**DCL     14215<<ASSIGN
DELETE_FOLDER.LKEY_
      8388**DCL     14216<<ASSIGN
DELETE_FOLDER.V
      8389**DCL      8386--DCLINIT
DELETE_MESSAGE
     15074**PROC    13727--CALL    13732--CALL    14224--CALL
DELETING_MESSAGE
     10776**DCL     15076<>CALL
DELTA_NAME
     10383**DCL     10352--DCLINIT
DEQ_ON_FILE
      8619**DCL     13236<>CALL
DEQ_ON_FILE.V
      8620**DCL      8619--DCLINIT
DEQ_ON_HEADER
      8656**DCL     13667<>CALL    15101<>CALL
DEQ_ON_HEADER.V
      8657**DCL      8656--DCLINIT
DEQ_ON_PROFILE
      8582**DCL     15118<>CALL
DEQ_ON_PROFILE.V
      8583**DCL      8582--DCLINIT
DEST$ IN PROCEDURE COPY
     14981**DCL     14979--PROC    14985>>ASSIGN  14986>>ASSIGN  14986>>ASSIGN  14989>>ASSIGN  14991>>ASSIGN
     14992>>ASSIGN  14992>>ASSIGN
DEST_LEN IN PROCEDURE COPY
     14982**DCL     14979--PROC    14985>>ASSIGN  14991>>ASSIGN
DONE_COMMA IN PROCEDURE SEND_ONE_MAILGRAM
     13912**DCL     14110<<ASSIGN  14111>>DOUNTIL 14122<<ASSIGN
DRAINING_COMGROUP
     10718**DCL     14192<>CALL
DRAINING_COMGROUP.NAME#
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:475  
     10718**DCL     14188>>CALLBLT 14191<<CALLBLT
DRIBBLE_FILE
      9659**DCL     13195<>CALL
DRIBBLE_FILE.ACSVEH_
      9661**DCL      9662--REDEF
DRIBBLE_FILE.ALTKEYS_
      9667**DCL      9668--REDEF    9668--REDEF
DRIBBLE_FILE.HDR_
      9666**DCL      9667--REDEF
DRIBBLE_FILE.TAB_
      9665**DCL      9666--REDEF
DRIBBLE_FILE.UHL_
      9659**DCL      9660--REDEF    9660--REDEF
DRIBBLE_FILE.V
      9668**DCL      9659--DCLINIT
DRIBBLE_FILE.V.FSN#
      9699**DCL      9699--REDEF    9699--REDEF
DRIBBLE_FILE.WSN_
      9665**DCL      9665--REDEF
DRIBBLE_NAME
      9728**DCL      9660--DCLINIT
DRIBBLE_NO
      9795**DCL     13198<>CALL
DRIBBLE_NO.ACSVEH_
      9797**DCL      9798--REDEF
DRIBBLE_NO.ALTKEYS_
      9803**DCL      9804--REDEF    9804--REDEF
DRIBBLE_NO.HDR_
      9802**DCL      9803--REDEF
DRIBBLE_NO.TAB_
      9801**DCL      9802--REDEF
DRIBBLE_NO.UHL_
      9795**DCL      9796--REDEF    9796--REDEF
DRIBBLE_NO.V
      9804**DCL      9795--DCLINIT
DRIBBLE_NO.V.FSN#
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:476  
      9835**DCL      9835--REDEF    9835--REDEF
DRIBBLE_NO.WSN_
      9801**DCL      9801--REDEF
EMITTING IN PROCEDURE EMIT_TRACE_RECORDS
     14319**DCL     14323<<ASSIGN  14328<<ASSIGN  14358>>IF      14377>>IF
EMIT_ADDRESSES
     14231**PROC    14091--CALL    14093--CALL    14096--CALL
EMIT_TRACE_RECORDS
     14317**PROC    14036--CALL    14422--CALL
ENQ_ON_FILE
      8600**DCL     13230<>CALL    13822<>CALL
ENQ_ON_FILE.V
      8601**DCL      8600--DCLINIT
ENQ_ON_HEADER
      8637**DCL     14572<>CALL
ENQ_ON_HEADER.V
      8638**DCL      8637--DCLINIT
ENQ_ON_PROFILE
      8563**DCL     15104<>CALL
ENQ_ON_PROFILE.V
      8564**DCL      8563--DCLINIT
EOM IN PROCEDURE SMTP_SESSION
     13865**LABEL   13860--CALLALT
EOMM IN PROCEDURE SMTP_SESSION
     13881**LABEL   13870--CALLALT 13872--CALLALT
EOT IN PROCEDURE SEND_MESSAGE_BODY
     14313**LABEL   14296--CALLALT
ERR IN PROCEDURE SEND_ONE_MAILGRAM
     14206**LABEL   13937--CALLALT 14025--GOTO    14029--CALLALT 14198--CALLALT
ERROR_FLAG IN PROCEDURE INITIALIZE_CONFIGURATION
     13343**DCL     13354<<ASSIGN  13368<<ASSIGN  13434<<ASSIGN  13581>>IF
F$DCB.ACCT#
      7614**DCL     13193>>ASSIGN
F$DCB.ACTPOS
      7630**DCL      7630--REDEF
F$DCB.ARS#
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:477  
      7604**DCL      7604--REDEF   13616>>ASSIGN  14454>>ASSIGN  14565>>ASSIGN  15097>>ASSIGN  15114>>ASSIGN
F$DCB.ASN#
      7619**DCL     13187>>IF
F$DCB.ATTR
      7623**DCL      7624--REDEF
F$DCB.BORROW
      7638**DCL      7638--REDEF    7638--REDEF    7638--REDEF
F$DCB.DCBNAME.L
      7652**DCL      7652--IMP-SIZ
F$DCB.EOMCHAR#
      7608**DCL      7608--REDEF
F$DCB.FCD#
      7617**DCL     13221>>IF      13260>>IF      13265>>IF      13875>>IF
F$DCB.FLDID
      7633**DCL      7633--REDEF
F$DCB.FORM$
      7627**DCL      7627--REDEF
F$DCB.FSECT
      7643**DCL      7643--REDEF
F$DCB.FSN#
      7620**DCL      7620--REDEF    7620--REDEF    7621--REDEF
F$DCB.HEADER$
      7626**DCL      7626--REDEF
F$DCB.IXTNSIZE#
      7624**DCL      7624--REDEF
F$DCB.LASTSTA$
      7613**DCL      7613--REDEF
F$DCB.LVL
      7639**DCL      7639--REDEF
F$DCB.NAME#.C
      7614**DCL      7614--REDEF   13768>>IF
F$DCB.NOEOF
      7636**DCL      7636--REDEF
F$DCB.NRECS#
      7625**DCL      7625--REDEF
F$DCB.NRECX
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:478  
      7644**DCL      7644--REDEF
F$DCB.OHDR
      7636**DCL      7636--REDEF
F$DCB.ORG#
      7619**DCL      7619--REDEF
F$DCB.PRECNO
      7642**DCL      7642--REDEF
F$DCB.RCSZ
      7648**DCL      7648--REDEF
F$DCB.RES#
      7615**DCL      7615--REDEF
F$DCB.SETX
      7627**DCL      7627--REDEF
F$DCB.TAB$
      7627**DCL      7627--REDEF
F$DCB.TDA
      7641**DCL      7642--REDEF
F$DCB.WSN#
      7615**DCL      7615--REDEF
FIND_MAIL_HEADER
     14536**PROC    13710--CALL
FIND_NODE IN PROCEDURE SELECT_DESTINATION_SITE
     13798**LABEL   13807--EXIT
FINISHED_WITH_MESS_FILES
     13249**LABEL   13244--CALLALT
FLOW_CONTROL_ENABLED
     12698**DCL     13828<>CALL    14500>>IF      14516>>IF
FPT_ALIB
     10352**DCL     13165<>CALL
FPT_ALIB.V
     10353**DCL     10353--DCLINIT
FROM$
     12894**DCL     14639<>CALL    14649>>IF      14649>>IF      14666>>ASSIGN  14667>>ASSIGN  14667>>ASSIGN
     14671<>CALL    15132>>IF      15132>>IF      15193>>IF      15193>>IF      15193>>IF      15193>>IF
FROMADDR
     12925**DCL     12924--DCLINIT
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:479  
FROMADDR$
     12924**DCL     13934>>CALLBLT 13934>>CALLBLT 14042>>CALLBLT 14042>>CALLBLT 14046>>CALLBLT 14046>>CALLBLT
     14052>>CALLBLT 14052>>CALLBLT 14056>>CALLBLT 14056>>CALLBLT 14063>>CALLBLT 14063>>CALLBLT 14067>>CALLBLT
     14067>>CALLBLT 14072>>IF      14072>>IF      14671<>CALL
FROMNAME
     12895**DCL     12894--DCLINIT 14657>>ASSIGN
FROMNAME$
     12909**DCL     14042>>CALLBLT 14042>>CALLBLT 14046>>CALLBLT 14046>>CALLBLT 14671<>CALL
FROMSIGN
     12910**DCL     12909--DCLINIT
FRST IN PROCEDURE EMIT_TRACE_RECORDS
     14320**DCL     14359<<CALLBLT 14362>>CALLBLT 14362>>CALLBLT 14369>>ASSIGN  14370>>ASSIGN  14370>>ASSIGN
GET_ADDRESSES
     10182**DCL     13632<>CALL
GET_ADDRESSES.V
     10182**DCL     10182--DCLINIT
GET_BUFFERS
     10149**DCL     13634<>CALL
GET_BUFFERS.V
     10149**DCL     10149--DCLINIT
GET_IOBUF_BOUND
     15257**PROC    14440--CALL    14489--CALL    15067--CALL    15247--CALL
GET_MAIL_ERROR_CODE
     10263**DCL     14411<>CALL
GET_MAIL_ERROR_CODE.CODE_
     10263**DCL     14410<<ASSIGN
GET_MAIL_ERROR_CODE.V
     10267**DCL     10263--DCLINIT
GET_MAIL_HEADER
     13702**PROC    13666--CALL    13860--CALL    13872--CALL
GET_POSTED_TIME
      9911**DCL     15174<>CALL    15219<>CALL
GET_POSTED_TIME.V
      9915**DCL      9911--DCLINIT
GET_SMTP_DATE
      9851**DCL     14677<>CALL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:480  
GET_SMTP_DATE.V
      9855**DCL      9851--DCLINIT
GET_TIME_NOW
      9871**DCL     13251<>CALL    13660<>CALL
GET_TIME_NOW.V
      9875**DCL      9871--DCLINIT
GET_UTS_NOW
      9891**DCL     13297<>CALL    13325<>CALL    13659<>CALL
GET_UTS_NOW.V
      9895**DCL      9891--DCLINIT
GET_WAKEUP_TIME
      9931**DCL     13327<>CALL
GET_WAKEUP_TIME.V
      9935**DCL      9931--DCLINIT
GOT_ONE IN PROCEDURE EMIT_ADDRESSES
     14234**DCL     14243<<ASSIGN  14246>>IF      14254<<ASSIGN  14259>>IF
GOT_ONE IN PROCEDURE SEND_ONE_MAILGRAM
     13895**DCL     13941<<ASSIGN  13999<<ASSIGN  14013>>IF
HANGUP_FILE
      9237**DCL      8944--DCLINIT
HAVE_A_CMD IN PROCEDURE INITIALIZE_CONFIGURATION
     13344**DCL     13358<<ASSIGN  13359>>DOUNTIL 13362<<ASSIGN
HAVE_A_MESSAGE IN PROCEDURE FIND_MAIL_HEADER
     14538**DCL     14559<<ASSIGN  14560>>DOUNTIL 14576<<ASSIGN
HAVE_A_MESSAGE IN PROCEDURE GET_MAIL_HEADER
     13704**DCL     13707<<ASSIGN  13709>>DOUNTIL 13724<<ASSIGN  13739>>IF
HDRTO
     12843**DCL     15135>>CALLBLT 15198>>CALLBLT
HEADER IN PROCEDURE EMIT_ADDRESSES
     14235**DCL     14231--PROC    14253>>CALLBLT
HEADER$
     13116**DCL     12164--IMP-PTR 13636<<ASSIGN  13648<<ASSIGN  13931>>IF      14035>>IF      14035>>IF
     14050>>IF      14061>>IF      14091>>CALL    14093>>CALL    14096>>CALL    14150>>IF      14151>>CALLBLT
     14151>>CALLBLT 14154>>IF      14155>>CALLBLT 14155>>CALLBLT 14184>>IF      14199>>IF      14199>>IF
     14275>>CALLBLT 14410>>ASSIGN  14416>>IF      14421>>IF      14554>>ASSIGN  14569>>IF      14569>>IF
     14569>>IF      14587>>ASSIGN  14588>>CALL    14588>>CALL    14589>>CALL    14589>>CALL    14590>>CALL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:481  
     14590>>CALL    14591>>CALL    14591>>CALL    14592>>CALL    14592>>CALL    14593>>CALL    14593>>CALL
     14594>>CALL    14594>>CALL    14595>>CALL    14595>>CALL    14596>>CALL    14596>>CALL    14597>>CALL
     14597>>CALL    14598>>CALL    14598>>CALL    14599>>CALL    14599>>CALL    14600>>CALL    14600>>CALL
     14639>>CALL    14640>>CALL    14641>>CALL    14642>>CALL    14643>>CALL    14644>>CALL    14645>>CALL
     14646>>IF      14647>>ASSIGN  14647>>ASSIGN  14648>>ASSIGN  14649>>IF      14651>>IF      14656>>IF
     14794>>IF      14794>>IF      14794>>IF      14794>>IF      15083>>ASSIGN  15092>>ASSIGN  15093>>ASSIGN
     15094>>ASSIGN  15095>>ASSIGN  15096>>ASSIGN  15112>>ASSIGN  15129>>IF      15143>>IF      15143>>IF
     15146>>CALLBLT 15146>>CALLBLT 15148>>IF      15149>>CALLBLT 15149>>CALLBLT 15161>>IF      15162>>CALLBLT
     15162>>CALLBLT 15165>>IF      15169>>IF      15193>>IF
HEADER_ARS
     12723**DCL     14565<<ASSIGN
HEADER_LENGTH IN PROCEDURE EMIT_ADDRESSES
     14236**DCL     14231--PROC    14235--IMP-SIZ 14250>>ASSIGN  14253>>CALLBLT 14256>>ASSIGN
HITS
     12737**DCL     14908<<ASSIGN
HITS.BC
     12740**DCL     13943>>IF      13943>>IF      14095>>IF      14211>>IF      14220<<ASSIGN  14961<<ASSIGN
HITS.C
     12739**DCL     14211>>IF      14959<<ASSIGN
HITS.PRIMARY
     12738**DCL     14211>>IF      14957<<ASSIGN
I IN PROCEDURE INITIALIZE_CONFIGURATION
     13345**DCL     13396<<ASSIGN  13397>>ASSIGN  13398>>CALLBLT 13402<<CALLBLT 13404>>ASSIGN  13404>>ASSIGN
     13410<<CALLBLT 13413>>ASSIGN  13438<<DOINDEX 13439>>ASSIGN  13440>>DOCASE  13523<<DOINDEX 13524>>ASSIGN
     13571<<ASSIGN  13572>>ASSIGN  13573>>CALLBLT
I IN PROCEDURE READ_ADDRESS_RECORDS
     14903**DCL     14943<<ASSIGN  14944>>DOWHILE 14944>>DOWHILE 14945<<ASSIGN  14945>>ASSIGN  14947>>ASSIGN
     14950>>ASSIGN  14952>>ASSIGN
I IN PROCEDURE SEND_ONE_MAILGRAM
     13896**DCL     13956<<DOINDEX 13957>>ASSIGN  13958>>IF
IDLE
     10455**DCL     13272<>CALL    13329<>CALL
IDLE.L#
     10455**DCL     13271<<ASSIGN  13324<<ASSIGN
IDLE.NAME#
     10455**DCL     13328<<ASSIGN
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:482  
II IN PROCEDURE SEND_ONE_MAILGRAM
     13908**DCL     14102<<CALLBLT 14105>>CALLBLT 14105>>CALLBLT 14107>>CALLBLT 14108>>ASSIGN  14109>>ASSIGN
INDX IN PROCEDURE EMIT_ADDRESSES
     14237**DCL     14247>>ASSIGN  14256<<ASSIGN
INDX IN PROCEDURE READ_ADDRESS_RECORDS
     14904**DCL     14931<<CALLBLT 14949<<CALLBLT 14950>>ASSIGN  14951>>ASSIGN
INDX IN PROCEDURE SEND_ONE_MAILGRAM
     13898**DCL     13947<<CALLBLT 13949>>CALLBLT 13960>>ASSIGN  13962>>CALLBLT 13972<<CALLBLT 13973>>CALLBLT
     13979>>CALLBLT 13983>>IF      13984>>ASSIGN  13985>>ASSIGN  13988>>ASSIGN  13991>>ASSIGN  14078<<CALLBLT
INDX1 IN PROCEDURE SEND_ONE_MAILGRAM
     13899**DCL     13962<<CALLBLT 13964>>ASSIGN  13973<<CALLBLT 13979<<CALLBLT 13980>>ASSIGN  13981>>CALLBLT
INDX2 IN PROCEDURE SEND_ONE_MAILGRAM
     13900**DCL     13981<<CALLBLT
INITIALIZE_CONFIGURATION
     13341**PROC    13199--CALL
INITIALIZE_QUOTATIONS
     13587**PROC    13212--CALL
INIT_FOLDER_DATA_POOL
     13628**PROC    13232--CALL
IS_OR_VIA
     12736**DCL     13806<<ASSIGN  13946>>IF
J IN PROCEDURE INITIALIZE_CONFIGURATION
     13346**DCL     13397<<ASSIGN  13398>>CALLBLT 13533<<DOINDEX 13534>>IF      13535>>ASSIGN  13538>>ASSIGN
     13540>>ASSIGN  13543>>ASSIGN  13545>>ASSIGN
JIT_PRIV
     10246**DCL     13201<>CALL    13206<>CALL
JIT_PRIV.V
     10246**DCL     10246--DCLINIT
JJ IN PROCEDURE SEND_ONE_MAILGRAM
     13909**DCL     14104<<CALLBLT 14105>>CALLBLT 14105>>CALLBLT 14105>>CALLBLT 14112<<CALLBLT 14114>>CALLBLT
     14114>>CALLBLT 14114>>CALLBLT 14116>>ASSIGN  14117>>CALLBLT 14118>>ASSIGN
LAST IN PROCEDURE EMIT_TRACE_RECORDS
     14321**DCL     14360<<CALLBLT 14362>>CALLBLT 14369>>ASSIGN  14370>>ASSIGN
LEN IN PROCEDURE SEND_ONE_MAILGRAM
     13897**DCL     13949>>CALLBLT 13951<<ASSIGN  13952>>IF      13952>>IF      13957<<ASSIGN  13958>>IF
     13958>>IF      13960>>ASSIGN  13961>>ASSIGN
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:483  
LEN_SOURCE IN PROCEDURE SEND_ONE_MAILGRAM
     13913**DCL     14109<<ASSIGN  14114>>CALLBLT 14114>>CALLBLT 14116>>ASSIGN  14118<<ASSIGN  14121>>CALLBLT
LEN_TARGET IN PROCEDURE SEND_ONE_MAILGRAM
     13914**DCL     14108<<ASSIGN  14114>>CALLBLT 14116<<ASSIGN  14116>>ASSIGN  14121>>CALLBLT
LINE$
     12802**DCL     12803--IMP-PTR
LINEBUF
     12800**DCL     12802--DCLINIT
LINELEN
     12801**DCL     12803--IMP-SIZ
LIST IN PROCEDURE READ_ADDRESS_RECORDS
     14905**DCL     14913<<ASSIGN  14917>>ASSIGN  14953>>ASSIGN  14955>>DOSELCT 14967>>DOSELCT 14969<<ASSIGN
     14971<<ASSIGN
LOC
     12703**DCL     13163<<CALLBLT 13171<<CALLBLT 14691<<CALLBLT 14692>>IF      14694>>ASSIGN  14695>>ASSIGN
     14706<<CALLBLT 14717<<CALLBLT 14718>>IF      14720>>ASSIGN  14721>>ASSIGN  14732<<CALLBLT 14743<<CALLBLT
     14745>>CALLBLT 14746>>CALLBLT 14746>>CALLBLT 14750>>CALLBLT 14755>>ASSIGN  14755>>ASSIGN  14756>>ASSIGN
     14766>>ASSIGN  14767>>CALLBLT 14767>>CALLBLT 14773<<CALLBLT 14775<<CALLBLT 14827<<CALLBLT 14829<<CALLBLT
     14831>>ASSIGN  14878<<CALLBLT 14881<<ASSIGN  14884>>CALLBLT 14885>>CALLBLT 14890>>ASSIGN  14891>>ASSIGN
     14894<<CALLBLT 14895>>ASSIGN  14896>>ASSIGN
LOCAL IN PROCEDURE MAKE_SMTP_ADDRESS
     15022**LABEL   15009--CALLALT 15013--GOTO
LOCE
     12704**DCL     13662<<CALLBLT 13663>>ASSIGN  14745<<CALLBLT 14746>>CALLBLT 14766>>ASSIGN  14767>>CALLBLT
     14884<<CALLBLT 14887>>IF      14888<<ASSIGN  14890>>ASSIGN
LOGGING_OFF_OF_SMTP
     10863**DCL     13881<>CALL
LOGGING_ON_TO_SMTP
     10571**DCL     13844<>CALL
LPAREN IN PROCEDURE PARSE_MAIL_HEADER
     14628**DCL     14837<<CALLBLT 14838>>DOWHILE 14840>>ASSIGN  14854>>ASSIGN  14855>>ASSIGN  14857>>DOWHILE
     14858>>IF      14859<<ASSIGN  14859>>ASSIGN  14864>>IF      14869>>CALLBLT 14871>>ASSIGN  14873<<CALLBLT
LPAREN1 IN PROCEDURE PARSE_MAIL_HEADER
     14629**DCL     14842<<CALLBLT 14844>>IF      14846>>ASSIGN
M$ALIB
      1448**DCL-ENT 13165--CALL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:484  
M$BOX
     12656**DCL     13181--ASSIGN
M$BOX$
     12664**DCL     13181<<ASSIGN
M$CLOSE
      1435**DCL-ENT 13223--CALL    13239--CALL    13246--CALL    13261--CALL    13266--CALL    13578--CALL
     13623--CALL    13770--CALL    13865--CALL    13876--CALL    15078--CALL    15179--CALL
M$CMD
     12657**DCL     13182--ASSIGN
M$CMD$
     12665**DCL     13182<<ASSIGN
M$DELREC
      1437**DCL-ENT 14217--CALL
M$DEQ
      1502**DCL-ENT 13236--CALL    13667--CALL    15101--CALL    15118--CALL
M$DISPRES
      1442**DCL-ENT 13291--CALL
M$ENQ
      1501**DCL-ENT 13230--CALL    13822--CALL    14572--CALL    15104--CALL
M$ERR
      1447**DCL-ENT 13190--CALL
M$ERRMSG
      1498**DCL-ENT 14411--CALL
M$EXIT
      1447**DCL-ENT 13204--CALL
M$FDS
      1470**DCL-ENT 13644--CALL    13645--CALL
M$FOLDER
     12659**DCL     13184--ASSIGN  14578>>ASSIGN  15114--ASSIGN
M$FOLDER$
     12668**DCL     13184<<ASSIGN  13260>>IF      13768>>IF      13875>>IF      14565>>ASSIGN  15097>>ASSIGN
M$GDS
      1470**DCL-ENT 13632--CALL    13634--CALL
M$HANGUP
     12661**DCL     13221--IF
M$LINK
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:485  
      1447**DCL-ENT 15183--CALL
M$MSG
     12658**DCL     13183--ASSIGN
M$MSG$
     12666**DCL     13183<<ASSIGN
M$OPEN
      1435**DCL-ENT 13195--CALL    13198--CALL    13218--CALL    13229--CALL    13231--CALL    13596--CALL
     13600--CALL    13751--CALL    13767--CALL    13821--CALL    15134--CALL    15197--CALL
M$PRECORD
      1439**DCL-ENT 14286--CALL    14338--CALL    14551--CALL
M$READ
      1436**DCL-ENT 13607--CALL    14167--CALL    14296--CALL    14349--CALL    14453--CALL    14561--CALL
     14580--CALL    14792--CALL    14918--CALL    15091--CALL    15110--CALL
M$REGISTRY
     12660**DCL     13185--ASSIGN
M$REGISTRY$
     12667**DCL     13185<<ASSIGN  13265>>IF
M$RELRES
      1442**DCL-ENT 13293--CALL
M$SCREECH
      1449**DCL-ENT 13203--CALL
M$SI
      7676**DCL     13186--ASSIGN
M$SI$
     12670**DCL     13186<<ASSIGN  13187>>IF      13193>>ASSIGN
M$SPRIV
      1494**DCL-ENT 13201--CALL    13206--CALL
M$TIME
      1502**DCL-ENT 13251--CALL    13297--CALL    13325--CALL    13327--CALL    13659--CALL    13660--CALL
     14677--CALL    15174--CALL    15219--CALL
M$UC
      1459**DCL     14454--ASSIGN
M$UI
      7677**DCL     13616--ASSIGN
M$WAIT
      1493**DCL-ENT 13330--CALL    14034--CALL    14194--CALL    14445--CALL    14473--CALL    14501--CALL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:486  
     14518--CALL
M$WRITE
      1436**DCL-ENT 13255--CALL    13618--CALL    13839--CALL    14450--CALL    14464--CALL    14496--CALL
     14505--CALL    14525--CALL    15069--CALL    15100--CALL    15117--CALL    15173--CALL    15218--CALL
     15252--CALL
MAILMSG_NAME
      9264**DCL      8729--DCLINIT
MAIL_ADDRESSES
     12719**DCL     10182--DCLINIT 10199--DCLINIT 13630<<ASSIGN  13631<<ASSIGN  14910>>ASSIGN  14919>>ASSIGN
MAIL_BUFFERS
     12718**DCL     10149--DCLINIT 10166--DCLINIT 13633<<ASSIGN  13635>>ASSIGN  13636>>ASSIGN  13637>>ASSIGN
     13638>>ASSIGN
MAIL_CENTRAL
      9291**DCL      8013--DCLINIT
MAIL_ERROR_CODE
     12805**DCL     10264--DCLINIT 14413>>ASSIGN
MAIL_FROM IN PROCEDURE SEND_ONE_MAILGRAM
     13931**LABEL   14005--GOTO    14023--GOTO
MAIL_REGISTRY
      9345**DCL      8233--DCLINIT
MAKE_SMTP_ADDRESS
     14998**PROC    14671--CALL    14672--CALL
MAX# IN PROCEDURE SEND_MESSAGE_BODY
     14271**DCL     14269--PROC    14297--IF      14297>>IF
MESS
      9318**DCL     13747--ASSIGN
MESSAGE_FILE
     12733**DCL     13234<<ASSIGN  13665>>DOUNTIL 13736>>IF      13754<<ASSIGN  13823<<ASSIGN  13940>>IF
     14090>>IF      14211>>IF      14361>>IF      14569>>IF      14681>>IF      15077>>IF
MSG IN PROCEDURE STATUS_UPDATE
     15231**DCL     15229--PROC
MSG.COUNT IN PROCEDURE STATUS_UPDATE
     15232**DCL     15233--IMP-SIZ 15236>>ASSIGN  15237>>CALLBLT
MSG.TEXT IN PROCEDURE STATUS_UPDATE
     15233**DCL     15237>>CALLBLT
MSGACKTO
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:487  
     12865**DCL     14052>>CALLBLT 14056>>CALLBLT
MSGBCC
     12856**DCL     14096<>CALL    14096--CALL
MSGBUF
     12818**DCL      8790--DCLINIT  8791--DCLINIT 12819--DCLINIT 15067<>CALL    15135<<CALLBLT 15138<<CALLBLT
     15141<<CALLBLT 15144<<CALLBLT 15146<<CALLBLT 15149<<CALLBLT 15154<<CALLBLT 15158<<CALLBLT 15162<<CALLBLT
     15166<<ASSIGN  15170<<ASSIGN  15175<<CALLBLT 15198<<CALLBLT 15201<<CALLBLT 15204<<CALLBLT 15207<<CALLBLT
     15211<<CALLBLT 15215<<CALLBLT 15220<<CALLBLT 15223<<ASSIGN
MSGBUF IN PROCEDURE SEND_SMTP_COMMAND
     14434**DCL     14439<<ASSIGN  14448>>ASSIGN
MSGCC
     12854**DCL     14093<>CALL    14093--CALL
MSGDATE
     12851**DCL     14039>>CALLBLT
MSGFROM
     12858**DCL     14042>>CALLBLT 14046>>CALLBLT
MSGID
     12863**DCL     14151>>CALLBLT
MSGQUOTE
     12862**DCL     14172>>ASSIGN  14175--ASSIGN
MSGRE
     12861**DCL     14147>>CALLBLT
MSGREALLY_TO
     12853**DCL     14091<>CALL    14091--CALL
MSGREAL_BCC
     12857**DCL     14096<>CALL    14096--CALL
MSGREAL_CC
     12855**DCL     14093<>CALL    14093--CALL
MSGREFID
     12864**DCL     14155>>CALLBLT
MSGREPLY
     12859**DCL     14074>>CALLBLT 14080>>CALLBLT 14083>>CALLBLT
MSGRRTO
     12866**DCL     14063>>CALLBLT 14067>>CALLBLT
MSGSUBJ
     12860**DCL     14143>>CALLBLT
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:488  
MSGTO
     12852**DCL     14091<>CALL    14091--CALL    14125>>CALLBLT 14128>>CALLBLT 14133>>CALLBLT 14135>>CALLBLT
MSG_COUNT
     12699**DCL     13854<<ASSIGN  13855<>CALL    14202<<ASSIGN  14202>>ASSIGN  14210<>CALL
MSG_DATE
     13097**DCL      9911--DCLINIT  9912--DCLINIT 15175>>CALLBLT 15220>>CALLBLT
MSG_NUMBER
     13095**DCL     13639<<ASSIGN  13766<<ASSIGN  13857<<ASSIGN  14213>>ASSIGN  14284>>ASSIGN  14297>>IF
     14336>>ASSIGN  14353>>IF      14544>>IF      14550>>ASSIGN  14586<<ASSIGN  14915>>ASSIGN  15090>>ASSIGN
MSG_TIME
     13098**DCL      9913--DCLINIT  9914--DCLINIT 15175>>CALLBLT 15220>>CALLBLT
MSG_TSTAMP
     13096**DCL      9855--DCLINIT 14159>>ASSIGN  14587<<ASSIGN
MULTIPLEADDRESSERR
     12823**DCL     14808>>ASSIGN  14809--ASSIGN
NAME$ IN PROCEDURE MAKE_SMTP_ADDRESS
     15003**DCL     14998--PROC    15015>>ASSIGN  15016>>ASSIGN  15016>>ASSIGN  15048>>ASSIGN  15049>>ASSIGN
     15049>>ASSIGN
NAME_END IN PROCEDURE MAKE_SMTP_ADDRESS
     15004**DCL     15038<<CALLBLT 15040>>IF      15040<<ASSIGN  15041>>CALLBLT 15042>>ASSIGN  15045<<CALLBLT
     15047<<ASSIGN  15047>>ASSIGN  15048>>ASSIGN  15049>>ASSIGN  15050>>ASSIGN  15051>>ASSIGN
NAME_END IN PROCEDURE PARSE_MAIL_HEADER
     14630**DCL     14750<<CALLBLT 14752>>CALLBLT 14753>>ASSIGN  14754>>ASSIGN  14754>>ASSIGN  14755>>ASSIGN
     14756>>ASSIGN
NEXT_ADDRESS_RECORD IN PROCEDURE READ_ADDRESS_RECORDS
     14967**LABEL   14918--CALLALT
NODE.FLAGS
     12775**DCL     13522<<ASSIGN
NODE.FLAGS.QUOTES
     12776**DCL     13560<<ASSIGN  14158>>IF
NODE.IS_OR_VIA
     12777**DCL     13530<<ASSIGN  13536>>DOCASE  13806>>ASSIGN
NODE.NAME
     12770**DCL     13527<<CALLBLT 13800>>CALLBLT 13801--ASSIGN
NODE.REVERSE_PATH.COUNT
     12773**DCL     13538<<ASSIGN  13543<<ASSIGN  13555<<ASSIGN  14046>>CALLBLT 14056>>CALLBLT 14067>>CALLBLT
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:489  
     14083>>CALLBLT
NODE.REVERSE_PATH.TEXT
     12774**DCL     13540<<ASSIGN  13545<<ASSIGN  13557<<ASSIGN  14046>>CALLBLT 14056>>CALLBLT 14067>>CALLBLT
     14083>>CALLBLT
NODE.SITE
     12771**DCL     13532<<ASSIGN  13535<<ASSIGN  13550>>IF      13805>>ASSIGN
NODENAME
     12685**DCL     13448>>ASSIGN
NODENAME.COUNT
     12686**DCL     13426<<ASSIGN  13428>>ASSIGN
NODENAME.TEXT
     12687**DCL     13427<<ASSIGN  13429>>CALLBLT
NODES
     12728**DCL     13352<<ASSIGN  13518>>IF      13522>>ASSIGN  13527>>CALLBLT 13530>>ASSIGN  13532>>ASSIGN
     13535>>ASSIGN  13536>>DOCASE  13538>>ASSIGN  13540>>ASSIGN  13543>>ASSIGN  13545>>ASSIGN  13550>>IF
     13555>>ASSIGN  13557>>ASSIGN  13560>>ASSIGN  13563<<ASSIGN  13563>>ASSIGN  13799>>DOINDEX
NOTMULTICSADDRESSERR
     12825**DCL     14817>>ASSIGN  14818--ASSIGN
NO_CHANGE IN PROCEDURE SEND_ONE_MAILGRAM
     13995**LABEL   13947--CALLALT 13972--CALLALT 13975--GOTO    13979--CALLALT
NO_HOST
     10878**DCL     13283<>CALL
NO_MODEM
     10873**DCL     13280<>CALL
NO_PATH IN PROCEDURE PARSE_MAIL_HEADER
     14785**LABEL   14745--CALLALT 14746--CALLALT 14752--CALLALT 14775--CALLALT 14884--CALLALT 14894--CALLALT
NO_ROUTE IN PROCEDURE PARSE_MAIL_HEADER
     14881**LABEL   14878--CALLALT
NO_SMTP
     10883**DCL     13286<>CALL
NO_SMTP IN PROCEDURE SMTP_SESSION
     13886**LABEL   13847--CALLALT
OFFSET IN PROCEDURE SEND_MESSAGE_BODY
     14272**DCL     14274<<CALLBLT 14275>>CALLBLT 14277<<CALLBLT 14302>>CALLBLT
OFFSET IN PROCEDURE SEND_ONE_MAILGRAM
     13901**DCL     14137<<CALLBLT 14138>>CALLBLT 14188<<CALLBLT 14191>>CALLBLT
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:490  
OLDEST IN PROCEDURE SCAN_ALL_HEADERS
     13657**DCL     13664<<ASSIGN
OOPS IN PROCEDURE OPEN_NEXT_MESS
     13774**LABEL   13767--CALLALT
OPEN_FOLDER
      8012**DCL     13229<>CALL    13821<>CALL
OPEN_FOLDER.ACSVEH_
      8014**DCL      8015--REDEF
OPEN_FOLDER.ALTKEYS_
      8020**DCL      8021--REDEF    8021--REDEF
OPEN_FOLDER.HDR_
      8019**DCL      8020--REDEF
OPEN_FOLDER.TAB_
      8018**DCL      8019--REDEF
OPEN_FOLDER.UHL_
      8012**DCL      8013--REDEF    8013--REDEF
OPEN_FOLDER.V
      8021**DCL      8012--DCLINIT
OPEN_FOLDER.V.FSN#
      8052**DCL      8052--REDEF    8052--REDEF
OPEN_FOLDER.WSN_
      8018**DCL      8018--REDEF
OPEN_HANGUP
      8943**DCL     13218<>CALL
OPEN_HANGUP.ACSVEH_
      8945**DCL      8946--REDEF
OPEN_HANGUP.ALTKEYS_
      8951**DCL      8952--REDEF    8952--REDEF
OPEN_HANGUP.HDR_
      8950**DCL      8951--REDEF
OPEN_HANGUP.TAB_
      8949**DCL      8950--REDEF
OPEN_HANGUP.UHL_
      8943**DCL      8944--REDEF    8944--REDEF
OPEN_HANGUP.V
      8952**DCL      8943--DCLINIT
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:491  
OPEN_HANGUP.V.FSN#
      8983**DCL      8983--REDEF    8983--REDEF
OPEN_HANGUP.WSN_
      8949**DCL      8949--REDEF
OPEN_MAILMSG
      8728**DCL     15134<>CALL    15197<>CALL
OPEN_MAILMSG.ACSVEH_
      8730**DCL      8731--REDEF
OPEN_MAILMSG.ALTKEYS_
      8736**DCL      8737--REDEF    8737--REDEF
OPEN_MAILMSG.HDR_
      8735**DCL      8736--REDEF
OPEN_MAILMSG.TAB_
      8734**DCL      8735--REDEF
OPEN_MAILMSG.UHL_
      8728**DCL      8729--REDEF    8729--REDEF
OPEN_MAILMSG.V
      8737**DCL      8728--DCLINIT
OPEN_MAILMSG.V.FSN#
      8768**DCL      8768--REDEF    8768--REDEF
OPEN_MAILMSG.WSN_
      8734**DCL      8734--REDEF
OPEN_MESSAGE
      8122**DCL     13751<>CALL    13767<>CALL
OPEN_MESSAGE.ACSVEH_
      8124**DCL      8125--REDEF
OPEN_MESSAGE.ALTKEYS_
      8130**DCL      8131--REDEF    8131--REDEF
OPEN_MESSAGE.HDR_
      8129**DCL      8130--REDEF
OPEN_MESSAGE.NAME_
      8123**DCL     13747<<ASSIGN  13761<<ASSIGN
OPEN_MESSAGE.TAB_
      8128**DCL      8129--REDEF
OPEN_MESSAGE.UHL_
      8122**DCL      8123--REDEF    8123--REDEF
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:492  
OPEN_MESSAGE.V
      8131**DCL      8122--DCLINIT
OPEN_MESSAGE.V.FSN#
      8162**DCL      8162--REDEF    8162--REDEF
OPEN_MESSAGE.V.INITZ.SCRUB#
      8132**DCL     13750<<ASSIGN  13764<<ASSIGN
OPEN_MESSAGE.V.OPER.NXTF#
      8134**DCL     13748<<ASSIGN  13762<<ASSIGN
OPEN_MESSAGE.V.OPER.TEST#
      8133**DCL     13749<<ASSIGN  13763<<ASSIGN
OPEN_MESSAGE.WSN_
      8128**DCL      8128--REDEF
OPEN_NEXT_MESS
     13759**PROC    13244--CALL    13870--CALL
OPEN_QUOTES
      9096**DCL     13600<>CALL
OPEN_QUOTES.ACSVEH_
      9098**DCL      9099--REDEF
OPEN_QUOTES.ALTKEYS_
      9104**DCL      9105--REDEF    9105--REDEF
OPEN_QUOTES.HDR_
      9103**DCL      9104--REDEF
OPEN_QUOTES.TAB_
      9102**DCL      9103--REDEF
OPEN_QUOTES.UHL_
      9096**DCL      9097--REDEF    9097--REDEF
OPEN_QUOTES.V
      9105**DCL      9096--DCLINIT
OPEN_QUOTES.V.FSN#
      9136**DCL      9136--REDEF    9136--REDEF
OPEN_QUOTES.WSN_
      9102**DCL      9102--REDEF
OPEN_REGISTRY
      8232**DCL     13231<>CALL
OPEN_REGISTRY.ACSVEH_
      8234**DCL      8235--REDEF
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:493  
OPEN_REGISTRY.ALTKEYS_
      8240**DCL      8241--REDEF    8241--REDEF
OPEN_REGISTRY.HDR_
      8239**DCL      8240--REDEF
OPEN_REGISTRY.TAB_
      8238**DCL      8239--REDEF
OPEN_REGISTRY.UHL_
      8232**DCL      8233--REDEF    8233--REDEF
OPEN_REGISTRY.V
      8241**DCL      8232--DCLINIT
OPEN_REGISTRY.V.FSN#
      8272**DCL      8272--REDEF    8272--REDEF
OPEN_REGISTRY.WSN_
      8238**DCL      8238--REDEF
OPEN_UI
      7820**DCL     13596<>CALL
OPEN_UI.ACSVEH_
      7822**DCL      7823--REDEF
OPEN_UI.ALTKEYS_
      7828**DCL      7829--REDEF    7829--REDEF
OPEN_UI.HDR_
      7827**DCL      7828--REDEF
OPEN_UI.TAB_
      7826**DCL      7827--REDEF
OPEN_UI.UHL_
      7820**DCL      7821--REDEF    7821--REDEF
OPEN_UI.V
      7829**DCL      7820--DCLINIT
OPEN_UI.V.FSN#
      7860**DCL      7860--REDEF    7860--REDEF
OPEN_UI.WSN_
      7826**DCL      7826--REDEF
OPT$ IN PROCEDURE INITIALIZE_CONFIGURATION
     13347**DCL     13382<<ASSIGN  13383>>ASSIGN  13384>>DOCASE  13420>>ASSIGN  13439<<ASSIGN  13442>>ASSIGN
     13443>>CALLBLT 13443>>CALLBLT 13445>>CALLBLT 13445>>CALLBLT 13462>>ASSIGN  13462>>ASSIGN  13464>>ASSIGN
     13464>>ASSIGN  13466>>ASSIGN  13466>>ASSIGN  13468>>IF      13469>>ASSIGN  13471>>CALLBLT 13471>>CALLBLT
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:494  
     13474>>CALLBLT 13474>>CALLBLT 13477>>CALLBLT 13477>>CALLBLT 13480>>CALLBLT 13480>>CALLBLT 13483>>ASSIGN
     13485>>ASSIGN  13485>>ASSIGN  13488>>ASSIGN  13490>>ASSIGN  13490>>ASSIGN  13493>>ASSIGN  13495>>ASSIGN
     13495>>ASSIGN  13498>>ASSIGN  13500>>ASSIGN  13524<<ASSIGN  13525>>DOCASE  13527>>CALLBLT 13527>>CALLBLT
     13530>>ASSIGN  13534>>IF      13534>>IF      13555>>ASSIGN  13557>>ASSIGN  13557>>ASSIGN
OUT$
     12707**DCL     11647--IMP-PTR 11693--IMP-PTR 13376<<ASSIGN  13378>>DOCASE  13382>>ASSIGN  13426>>ASSIGN
     13427>>ASSIGN  13427>>ASSIGN  13438>>DOINDEX 13439>>ASSIGN  13440>>DOCASE  13523>>DOINDEX 13524>>ASSIGN
     13572>>ASSIGN  13573>>CALLBLT 13573>>CALLBLT
OUT$BLK.CODE
     11655**DCL     13378>>DOCASE  13384>>DOCASE  13420>>ASSIGN  13440>>DOCASE  13468>>IF      13469>>ASSIGN
     13498>>ASSIGN  13500>>ASSIGN  13525>>DOCASE  13530>>ASSIGN
OUT$BLK.NSUBLKS
     11659**DCL     13438>>DOINDEX 13523>>DOINDEX
OUT$BLK.SUBLK$
     11680**DCL     13382>>ASSIGN  13383>>ASSIGN  13402>>CALLBLT 13402>>CALLBLT 13406>>IF      13407>>IF
     13407>>IF      13415>>ASSIGN  13426>>ASSIGN  13427>>ASSIGN  13427>>ASSIGN  13439>>ASSIGN  13440>>DOCASE
     13483>>ASSIGN  13485>>ASSIGN  13485>>ASSIGN  13488>>ASSIGN  13490>>ASSIGN  13490>>ASSIGN  13493>>ASSIGN
     13495>>ASSIGN  13495>>ASSIGN  13498>>ASSIGN  13500>>ASSIGN  13524>>ASSIGN  13572>>ASSIGN  13573>>CALLBLT
     13573>>CALLBLT
OUT$SYM.CODE
     11699**DCL     13400>>DOCASE  13415>>ASSIGN
OUT$SYM.COUNT
     11716**DCL     11719--IMP-SIZ 13386>>ASSIGN  13388>>ASSIGN  13390>>ASSIGN  13392>>CALLBLT 13402>>CALLBLT
     13406>>IF      13407>>IF      13410>>CALLBLT 13420>>ASSIGN  13426>>ASSIGN  13427>>ASSIGN  13442>>ASSIGN
     13443>>CALLBLT 13445>>CALLBLT 13462>>ASSIGN  13464>>ASSIGN  13466>>ASSIGN  13471>>CALLBLT 13474>>CALLBLT
     13477>>CALLBLT 13480>>CALLBLT 13483>>ASSIGN  13485>>ASSIGN  13488>>ASSIGN  13490>>ASSIGN  13493>>ASSIGN
     13495>>ASSIGN  13527>>CALLBLT 13534>>IF      13555>>ASSIGN  13557>>ASSIGN  13572>>ASSIGN  13573>>CALLBLT
OUT$SYM.CPOS
     11708**DCL     13396>>ASSIGN
OUT$SYM.TEXT
     11719**DCL     13386>>ASSIGN  13388>>ASSIGN  13390>>ASSIGN  13392>>CALLBLT 13402>>CALLBLT 13407>>IF
     13410>>CALLBLT 13420>>ASSIGN  13427>>ASSIGN  13443>>CALLBLT 13445>>CALLBLT 13462>>ASSIGN  13464>>ASSIGN
     13466>>ASSIGN  13471>>CALLBLT 13474>>CALLBLT 13477>>CALLBLT 13480>>CALLBLT 13485>>ASSIGN  13490>>ASSIGN
     13495>>ASSIGN  13527>>CALLBLT 13534>>IF      13557>>ASSIGN  13573>>CALLBLT
OUT_OF_MESSAGES IN PROCEDURE GET_MAIL_HEADER
     13705**DCL     13708<<ASSIGN  13709>>DOUNTIL 13712<<ASSIGN  13714>>IF      13737<<ASSIGN
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:495  
P$PCB.HI_CHAR
     11893**DCL     13397>>ASSIGN
P$PCB.TEXT$
     11743**DCL     13398>>CALLBLT
PARSE_MAIL_HEADER
     14625**PROC    13720--CALL
PATH
     12985**DCL     12984--DCLINIT
PATH.L
     12986**DCL     14673<<ASSIGN
PATH.T
     12987**DCL     14674<<ASSIGN
PATH$
     12984**DCL     13784>>IF      13784>>IF      13785>>CALLBLT 13785>>CALLBLT 13786>>CALLBLT 13786>>CALLBLT
     13787>>CALLBLT 13787>>CALLBLT 13788>>CALLBLT 13788>>CALLBLT 14007>>ASSIGN  14008>>ASSIGN  14008>>ASSIGN
     14017>>CALLBLT 14017>>CALLBLT 14041>>IF      14041>>IF      14051>>IF      14051>>IF      14062>>IF
     14062>>IF      14073>>IF      14073>>IF      14101>>CALLBLT 14101>>CALLBLT 14101>>CALLBLT 14105>>CALLBLT
     14108>>ASSIGN  14128>>CALLBLT 14128>>CALLBLT 14128>>CALLBLT 14135>>CALLBLT 14135>>CALLBLT 14369>>ASSIGN
     14370>>ASSIGN  14370>>ASSIGN  14694>>ASSIGN  14695>>ASSIGN  14695>>ASSIGN  14696>>ASSIGN  14702>>ASSIGN
     14703>>ASSIGN  14703>>ASSIGN  14720>>ASSIGN  14721>>ASSIGN  14721>>ASSIGN  14722>>ASSIGN  14728>>ASSIGN
     14729>>ASSIGN  14729>>ASSIGN  14753>>ASSIGN  14754>>ASSIGN  14754>>ASSIGN  14766>>ASSIGN  14767>>CALLBLT
     14767>>CALLBLT 14777>>ASSIGN  14778>>CALLBLT 14778>>CALLBLT 14821>>ASSIGN  14822>>ASSIGN  14822>>ASSIGN
     14827>>CALLBLT 14827>>CALLBLT 14829>>CALLBLT 14829>>CALLBLT 14831>>ASSIGN  14831>>ASSIGN  14837>>CALLBLT
     14837>>CALLBLT 14838>>DOWHILE 14841>>DOUNTIL 14842>>CALLBLT 14842>>CALLBLT 14843>>CALLBLT 14843>>CALLBLT
     14855>>ASSIGN  14855>>ASSIGN  14856>>ASSIGN  14858>>IF      14858>>IF      14863>>DOWHILE 14864>>IF
     14864>>IF      14869>>CALLBLT 14869>>CALLBLT 14869>>CALLBLT 14869>>CALLBLT 14871>>ASSIGN  14871>>ASSIGN
     14872>>ASSIGN  14872>>ASSIGN  14873>>CALLBLT 14873>>CALLBLT 14878>>CALLBLT 14878>>CALLBLT 14884>>CALLBLT
     14884>>CALLBLT 14885>>CALLBLT 14885>>CALLBLT 14891>>ASSIGN  14891>>ASSIGN  14894>>CALLBLT 14894>>CALLBLT
     14895>>ASSIGN  14896>>ASSIGN  14896>>ASSIGN  14947>>ASSIGN  14948>>ASSIGN  14948>>ASSIGN  15210>>IF
     15211>>CALLBLT 15211>>CALLBLT
PATHERR
     12821**DCL     14803>>ASSIGN  14804--ASSIGN
PATH_OK IN PROCEDURE PARSE_MAIL_HEADER
     14711**LABEL   14706--CALLALT
PDEPTH IN PROCEDURE PARSE_MAIL_HEADER
     14631**DCL     14839<<ASSIGN  14841>>DOUNTIL 14845<<ASSIGN  14845>>ASSIGN  14849<<ASSIGN  14849>>ASSIGN
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:496  
POSITION_FOLDER
      8287**DCL     14286<>CALL    14338<>CALL    14551<>CALL
POSITION_FOLDER.KEY_
      8287**DCL     14278<<ASSIGN  14330<<ASSIGN  14541<<ASSIGN
POSITION_FOLDER.V
      8289**DCL      8287--DCLINIT
POSITION_FOLDER.V.KEYR#
      8290**DCL     14280<<ASSIGN  14332<<ASSIGN  14543<<ASSIGN
POSITION_FOLDER.V.KEYS#
      8290**DCL     14279<<ASSIGN  14331<<ASSIGN  14542<<ASSIGN
POSITION_FOLDER.V.N#
      8293**DCL     14281<<ASSIGN  14333<<ASSIGN  14545<<ASSIGN  14547<<ASSIGN
POSITION_TO_FIRST_MESS
     13745**PROC    13242--CALL    13868--CALL
POST_MESSAGE_ACKNOWLEDGEMENT
     15123**PROC    14201--CALL
POST_MESSAGE_REJECTION IN PROCEDURE POST_MESSAGE_ACKNOWLEDGEMENT
     15190**ENTRY   13728--CALL    13733--CALL    14009--CALL    14206--CALL
PROFILE$
     13115**DCL     12062--IMP-PTR 13635<<ASSIGN  13647<<ASSIGN  15105>>ASSIGN  15111>>ASSIGN  15111>>ASSIGN
     15112>>ASSIGN  15112>>ASSIGN  15113>>ASSIGN
PROMPTSTRING
     12692**DCL     11525--DCLINIT
PSN
     10231**DCL     10215--DCLINIT
PTR#.BITS IN PROCEDURE ADJUST_POINTER
     14611**DCL     14619>>ASSIGN
PTR#.CHARS IN PROCEDURE ADJUST_POINTER
     14610**DCL     14619>>ASSIGN
PTR#.SEGID IN PROCEDURE ADJUST_POINTER
     14612**DCL     14615>>IF
PTR#.WORDS IN PROCEDURE ADJUST_POINTER
     14609**DCL     14619>>ASSIGN
PTR$ IN PROCEDURE ADJUST_POINTER
     14607**DCL     14605--PROC    14608--REDEF   14616<<ASSIGN  14618>>IF      14619<<ASSIGN
QUOTE_BUF
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:497  
     12806**DCL      7883--DCLINIT  7884--DCLINIT  9160--DCLINIT  9161--DCLINIT  9199--DCLINIT  9200--DCLINIT
     13606<<ASSIGN  13611>>IF      13616--ASSIGN  14166<<ASSIGN  14175>>ASSIGN
QUOTE_COUNT
     12732**DCL     13591<<ASSIGN  13622<<ASSIGN  14158>>IF      14159>>ASSIGN
QUOTE_KEY
     12807**DCL      9158--DCLINIT  9159--DCLINIT  9198--DCLINIT
QUOTE_KEY.K
     12809**DCL     13593<<ASSIGN  13612>>IF      13613<<ASSIGN  13613>>ASSIGN  13619<<ASSIGN  13619>>ASSIGN
     13622>>ASSIGN  14162<<ASSIGN  14171>>IF      14177<<ASSIGN  14177>>ASSIGN
QUOTE_KEY.L
     12808**DCL     13592<<ASSIGN  14163<<ASSIGN
QUOTE_NUMBER IN PROCEDURE SEND_ONE_MAILGRAM
     13902**DCL     14159<<ASSIGN  14160>>IF      14161<<ASSIGN  14161>>ASSIGN  14162>>ASSIGN
RE
     13045**DCL     13044--DCLINIT 14663<<ASSIGN
RE$
     13044**DCL     14146>>IF      14147>>CALLBLT 14147>>CALLBLT 14643<>CALL    14715>>IF      14717>>CALLBLT
     14717>>CALLBLT 14720>>ASSIGN  14721>>ASSIGN  14721>>ASSIGN  14722>>ASSIGN  14722>>ASSIGN  14723>>IF
     14723>>IF      14723>>IF      14724>>ASSIGN  14724>>ASSIGN  14728>>ASSIGN  14729>>ASSIGN  14729>>ASSIGN
     14730>>ASSIGN
READIT IN PROCEDURE READ_ADDRESS_RECORDS
     14915**LABEL   14975--GOTO
READ_ADDRESS_RECORDS
     14901**PROC    14682--CALL    14798--CALL
READ_FOLDER
      8314**DCL     14296<>CALL    14349<>CALL    14561<>CALL    14918<>CALL    15091<>CALL    15110<>CALL
READ_FOLDER.BUF_
      8316**DCL     14289<<ASSIGN  14341<<ASSIGN  14554<<ASSIGN  14910<<ASSIGN  15083<<ASSIGN  15105<<ASSIGN
READ_FOLDER.BUF_.BOUND
      8316**DCL     14290<<ASSIGN  14342<<ASSIGN  14555<<ASSIGN  15084<<ASSIGN  15106<<ASSIGN
READ_FOLDER.KEY_
      8314**DCL     14291<<ASSIGN  14343<<ASSIGN  14556<<ASSIGN  14909<<ASSIGN  15085<<ASSIGN  15107<<ASSIGN
READ_FOLDER.STATION_
      8317**DCL      8318--REDEF
READ_FOLDER.V
      8318**DCL      8314--DCLINIT
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:498  
READ_FOLDER.V.DVBYTE.REREAD#
      8329**DCL      8329--REDEF
READ_FOLDER.V.INDX#
      8327**DCL      8327--REDEF
READ_FOLDER.V.KEYR#
      8319**DCL     14293<<ASSIGN  14345<<ASSIGN  14558<<ASSIGN  14912<<ASSIGN  15087<<ASSIGN  15109<<ASSIGN
READ_FOLDER.V.KEYS#
      8319**DCL     14292<<ASSIGN  14344<<ASSIGN  14557<<ASSIGN  14911<<ASSIGN  15086<<ASSIGN  15108<<ASSIGN
READ_QUOTES
      9158**DCL     14167<>CALL
READ_QUOTES.STATION_
      9161**DCL      9162--REDEF
READ_QUOTES.V
      9162**DCL      9158--DCLINIT
READ_QUOTES.V.DVBYTE.REREAD#
      9173**DCL      9173--REDEF
READ_QUOTES.V.INDX#
      9171**DCL      9171--REDEF
READ_QUOTES IN PROCEDURE INITIALIZE_QUOTATIONS
     13605**LABEL   13609--EXIT
READ_REGISTRY
      8353**DCL     14792<>CALL
READ_REGISTRY.BUF_
      8355**DCL     14787<<ASSIGN
READ_REGISTRY.BUF_.BOUND
      8355**DCL     14788<<ASSIGN
READ_REGISTRY.KEY_
      8353**DCL     14789<<ASSIGN
READ_REGISTRY.STATION_
      8356**DCL      8357--REDEF
READ_REGISTRY.V
      8357**DCL      8353--DCLINIT
READ_REGISTRY.V.DVBYTE.REREAD#
      8368**DCL      8368--REDEF
READ_REGISTRY.V.INDX#
      8366**DCL      8366--REDEF
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:499  
READ_REGISTRY.V.KEYR#
      8358**DCL     14791<<ASSIGN
READ_REGISTRY.V.KEYS#
      8358**DCL     14790<<ASSIGN
READ_SITE
     10402**DCL     14580<>CALL
READ_SITE.BUF_
     10404**DCL     14579<<ASSIGN
READ_SITE.STATION_
     10405**DCL     10406--REDEF
READ_SITE.V
     10406**DCL     10402--DCLINIT
READ_SITE.V.DCB#
     10406**DCL     14578<<ASSIGN
READ_SITE.V.DVBYTE.REREAD#
     10417**DCL     10417--REDEF
READ_SITE.V.INDX#
     10415**DCL     10415--REDEF
READ_UC
      9477**DCL     14453<>CALL
READ_UC.STATION_
      9480**DCL      9481--REDEF
READ_UC.V
      9481**DCL      9477--DCLINIT
READ_UC.V.DVBYTE.REREAD#
      9492**DCL      9492--REDEF
READ_UC.V.INDX#
      9490**DCL      9490--REDEF
READ_UI
      7881**DCL     13607<>CALL
READ_UI.STATION_
      7884**DCL      7885--REDEF
READ_UI.V
      7885**DCL      7881--DCLINIT
READ_UI.V.DVBYTE.REREAD#
      7896**DCL      7896--REDEF
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:500  
READ_UI.V.INDX#
      7894**DCL      7894--REDEF
REALLY IN PROCEDURE EMIT_ADDRESSES
     14238**DCL     14231--PROC    14262>>CALLBLT
REALLY_LENGTH IN PROCEDURE EMIT_ADDRESSES
     14239**DCL     14231--PROC    14238--IMP-SIZ 14262>>CALLBLT
REJECTING_MESSAGE
     10805**DCL     15192<>CALL
RELEASE_ADDRESSES
     10199**DCL     13644<>CALL
RELEASE_ADDRESSES.V
     10199**DCL     10199--DCLINIT
RELEASE_BUFFERS
     10166**DCL     13645<>CALL
RELEASE_BUFFERS.V
     10166**DCL     10166--DCLINIT
RELEASE_FOLDER_DATA_POOL IN PROCEDURE INIT_FOLDER_DATA_POOL
     13642**ENTRY   13270--CALL
RELEASE_PACKS
     10214**DCL     13291<>CALL    13293<>CALL
RELEASE_PACKS.V
     10216**DCL     10214--DCLINIT
REPATH_OK IN PROCEDURE PARSE_MAIL_HEADER
     14737**LABEL   14732--CALLALT
REPLY
     12816**DCL     13810<<ASSIGN  15223>>ASSIGN
REPLY$
     12814**DCL     12816--IMP-PTR 13810>>ASSIGN  15223>>ASSIGN
REPLYADDR
     12970**DCL     12969--DCLINIT
REPLYADDR$
     12969**DCL     14072>>IF      14072>>IF      14072>>IF      14074>>CALLBLT 14074>>CALLBLT 14078>>CALLBLT
     14078>>CALLBLT 14080>>CALLBLT 14080>>CALLBLT 14083>>CALLBLT 14083>>CALLBLT 14672<>CALL
REPLYLEN
     12815**DCL     12816--IMP-SIZ 13810>>ASSIGN  13834<>CALL    13838>>ASSIGN  14446<<ASSIGN  14451>>DOUNTIL
     14454<<ASSIGN  14458<>CALL    14462<<ASSIGN  14462>>ASSIGN  14463>>ASSIGN  14708<<ASSIGN  14734<<ASSIGN
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:501  
     14804<<ASSIGN  14809<<ASSIGN  14818<<ASSIGN  14924<<ASSIGN  15223>>ASSIGN
REPLYNAME$
     12954**DCL     14074>>CALLBLT 14074>>CALLBLT 14083>>CALLBLT 14083>>CALLBLT 14672<>CALL
REPLYSIGN
     12955**DCL     12954--DCLINIT
REPLY_CODE IN PROCEDURE SEND_SMTP_COMMAND
     14435**DCL     14431--PROC    14470>>IF
REPLY_TO
     12940**DCL     12939--DCLINIT 14652>>ASSIGN
REPLY_TO$
     12939**DCL     14641<>CALL    14668>>ASSIGN  14669>>ASSIGN  14669>>ASSIGN  14672<>CALL    15135>>CALLBLT
     15135>>CALLBLT 15198>>CALLBLT 15198>>CALLBLT
RETRIES IN PROCEDURE SEND_SMTP_COMMAND
     14436**DCL     14442<<DOINDEX
REWRITE.OLD.LEN
     12788**DCL     13572<<ASSIGN  13957>>ASSIGN
REWRITE.OLD.TXT
     12789**DCL     13573<<CALLBLT 13958>>IF
REWRITES
     12793**DCL     13353<<ASSIGN  13567>>IF      13571>>ASSIGN  13575<<ASSIGN  13575>>ASSIGN  13948>>IF
     13956>>DOINDEX
REWRITE_LOOP IN PROCEDURE SEND_ONE_MAILGRAM
     13956**LABEL   13968--EXIT
RPAREN IN PROCEDURE PARSE_MAIL_HEADER
     14632**DCL     14841>>DOUNTIL 14843<<CALLBLT 14844>>IF      14850>>ASSIGN  14854>>ASSIGN  14856<<ASSIGN
     14856>>ASSIGN  14863>>DOWHILE 14865<<ASSIGN  14865>>ASSIGN  14869>>CALLBLT 14871>>ASSIGN
SAVED_ACCN
     12730**DCL     15180<<ASSIGN  15187>>ASSIGN
SCAN IN PROCEDURE INITIALIZE_CONFIGURATION
     13357**LABEL   13367--EXIT    13373--EXIT
SCAN_ALL_HEADERS
     13655**PROC    13235--CALL    13245--CALL
SCAN_DONE IN PROCEDURE SCAN_ALL_HEADERS
     13674**LABEL   13666--CALLALT
SCAN_TRACE_RECORDS IN PROCEDURE EMIT_TRACE_RECORDS
     14326**ENTRY   13932--CALL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:502  
SCREECH3
      9978**DCL     13203<>CALL
SEARCHING
     10484**DCL     14540<>CALL
SELECT_DESTINATION_SITE
     13778**PROC    13722--CALL
SENDING_ADDRESSES
     10629**DCL     13918<>CALL
SENDING_HEADER
     10658**DCL     14030<>CALL
SENDING_MESSAGE_BODY
     10688**DCL     14304<>CALL
SENDING_MESSAGE_BODY.NAME#
     10688**DCL     14274>>CALLBLT 14275<<CALLBLT 14277>>CALLBLT 14302<<CALLBLT
SEND_CMD
      9458**DCL      9388--DCLINIT
SEND_DATA IN PROCEDURE SEND_ONE_MAILGRAM
     14181**LABEL   14037--GOTO
SEND_ERROR_REPORT
     14387**PROC    14185--CALL
SEND_MAILMSG
      9387**DCL     15183<>CALL
SEND_MAILMSG.V
      9389**DCL      9389--DCLINIT
SEND_MESSAGE_BODY
     14269**PROC    14187--CALL    14425--CALL
SEND_ONE_MAILGRAM
     13892**PROC    13862--CALL    13874--CALL
SEND_QUOTE IN PROCEDURE SEND_ONE_MAILGRAM
     14165**LABEL   14169--EXIT
SEND_SMTP_COMMAND
     14431**PROC    13847--CALL    13883--CALL    13937--CALL    13997--CALL    14004--CALL    14018--CALL
     14022--CALL    14029--CALL    14198--CALL    14226--CALL
SEND_SMTP_DATA
     14485**PROC    14040--CALL    14049--CALL    14059--CALL    14070--CALL    14088--CALL    14140--CALL
     14144--CALL    14148--CALL    14152--CALL    14156--CALL    14176--CALL    14248--CALL    14260--CALL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:503  
     14263--CALL    14310--CALL    14379--CALL    14406--CALL    14409--CALL    14414--CALL    14418--CALL
     14420--CALL    14424--CALL
SEND_SMTP_NULL IN PROCEDURE SEND_SMTP_DATA
     14523**ENTRY   14182--CALL
SIGNATURE
     13060**DCL     13059--DCLINIT
SIGNATURE$
     13059**DCL     14644<>CALL
SITE.ADDRESS
     12747**DCL     13447<<ASSIGN  13464<<ASSIGN  13466<<ASSIGN  13828<>CALL
SITE.DR_ACTION
     12767**DCL     13460<<ASSIGN  13500<<ASSIGN  14061>>IF      14199>>IF
SITE.FROM_TIME
     12761**DCL     13452<<ASSIGN  13477<<CALLBLT 13682>>IF      13682>>IF
SITE.IDENT
     12748**DCL     13448<<ASSIGN
SITE.IDENT.COUNT
     12749**DCL     13483<<ASSIGN  13506>>ASSIGN  13510>>CALLBLT 13513>>ASSIGN  13934>>CALLBLT 14366>>CALLBLT
SITE.IDENT.TEXT
     12750**DCL     13485<<ASSIGN  13504>>CALLBLT 13510>>CALLBLT 13846>>CALLBLT 13934>>CALLBLT 14366>>CALLBLT
SITE.INDIRECT_REVERSE_PATH.COUNT
     12755**DCL     13458<<ASSIGN  13493<<ASSIGN  13509>>IF      13513<<ASSIGN  13543>>ASSIGN  14042>>CALLBLT
     14052>>CALLBLT 14063>>CALLBLT 14074>>CALLBLT
SITE.INDIRECT_REVERSE_PATH.TEXT
     12756**DCL     13495<<ASSIGN  13510<<CALLBLT 13545>>ASSIGN  14042>>CALLBLT 14052>>CALLBLT 14063>>CALLBLT
     14074>>CALLBLT
SITE.LAST_STATUS
     12765**DCL     13276<<ASSIGN  13278>>DOCASE  13300>>IF      13300>>IF      13300>>IF      13456<<ASSIGN
SITE.LAST_TRY
     12763**DCL     13277<<ASSIGN  13303<>CALL    13454<<ASSIGN  13692>>IF      13692>>IF
SITE.LOGON
     12746**DCL     13445<<CALLBLT 13462<<ASSIGN  13828<>CALL
SITE.NAME
     12743**DCL     13280<>CALL    13283<>CALL    13286<>CALL    13826<>CALL    13855<>CALL    14009<>CALL
     14201<>CALL    14206<>CALL    14210<>CALL
SITE.NAME.COUNT
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:504  
     12744**DCL     13442<<ASSIGN  13513>>ASSIGN  13951>>ASSIGN
SITE.NAME.TEXT
     12745**DCL     13443<<CALLBLT 13510>>CALLBLT 13534>>IF      13952>>IF
SITE.NEXT_TRY
     12764**DCL     13303<>CALL    13309<>CALL    13313>>ASSIGN  13455<<ASSIGN  13687>>IF
SITE.OWN_REVERSE_PATH.COUNT
     12752**DCL     13457<<ASSIGN  13488<<ASSIGN  13503>>IF      13506<<ASSIGN  13538>>ASSIGN
SITE.OWN_REVERSE_PATH.TEXT
     12753**DCL     13490<<ASSIGN  13504<<CALLBLT 13540>>ASSIGN
SITE.PENDING
     12758**DCL     13227<<ASSIGN  13308>>IF      13670<<ASSIGN  13670>>ASSIGN  13687>>IF      13696<<ASSIGN
     14223<<ASSIGN  14223>>ASSIGN
SITE.RETRY_INTERVAL
     12760**DCL     13303>>CALL    13309>>CALL    13451<<ASSIGN  13474<<CALLBLT
SITE.RR_ACTION
     12766**DCL     13459<<ASSIGN  13498<<ASSIGN  14050>>IF      14199>>IF
SITE.TO_TIME
     12762**DCL     13453<<ASSIGN  13480<<CALLBLT 13682>>IF      13682>>IF
SITE.TRY_INTERVAL
     12759**DCL     13450<<ASSIGN  13471<<CALLBLT
SITE.TYPE
     12757**DCL     13449<<ASSIGN  13469<<ASSIGN  13828<>CALL
SITENAME IN PROCEDURE POST_MESSAGE_ACKNOWLEDGEMENT
     15125**DCL     15123--PROC    15190--ENTRY
SITENAME.COUNT IN PROCEDURE POST_MESSAGE_ACKNOWLEDGEMENT
     15126**DCL     15127--IMP-SIZ 15141>>CALLBLT 15204>>CALLBLT
SITENAME.TEXT IN PROCEDURE POST_MESSAGE_ACKNOWLEDGEMENT
     15127**DCL     15141>>CALLBLT 15204>>CALLBLT
SITES
     12725**DCL     13226>>DOINDEX 13299>>DOINDEX 13351<<ASSIGN  13431>>IF      13442>>ASSIGN  13443>>CALLBLT
     13445>>CALLBLT 13447>>ASSIGN  13448>>ASSIGN  13449>>ASSIGN  13450>>ASSIGN  13451>>ASSIGN  13452>>ASSIGN
     13453>>ASSIGN  13454>>ASSIGN  13455>>ASSIGN  13456>>ASSIGN  13457>>ASSIGN  13458>>ASSIGN  13459>>ASSIGN
     13460>>ASSIGN  13462>>ASSIGN  13464>>ASSIGN  13466>>ASSIGN  13469>>ASSIGN  13471>>CALLBLT 13474>>CALLBLT
     13477>>CALLBLT 13480>>CALLBLT 13483>>ASSIGN  13485>>ASSIGN  13488>>ASSIGN  13490>>ASSIGN  13493>>ASSIGN
     13495>>ASSIGN  13498>>ASSIGN  13500>>ASSIGN  13503>>IF      13504>>CALLBLT 13504>>CALLBLT 13506>>ASSIGN
     13506>>ASSIGN  13509>>IF      13510>>CALLBLT 13510>>CALLBLT 13510>>CALLBLT 13510>>CALLBLT 13513>>ASSIGN
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:505  
     13513>>ASSIGN  13513>>ASSIGN  13516<<ASSIGN  13516>>ASSIGN  13533>>DOINDEX 13681>>DOINDEX
SITE_END IN PROCEDURE SELECT_DESTINATION_SITE
     13780**DCL     13785<<CALLBLT 13786<<CALLBLT 13786>>CALLBLT 13787<<CALLBLT 13787>>CALLBLT 13788>>CALLBLT
     13790<<ASSIGN  13790>>ASSIGN  13794<<CALLBLT 13796>>ASSIGN
SITE_INDEX IN PROCEDURE MAKE_SMTP_ADDRESS
     15005**DCL     15009<<CALLBLT 15010>>CALLBLT 15011>>IF      15012>>ASSIGN  15015>>ASSIGN  15016>>ASSIGN
     15019>>ASSIGN
SITE_NAME
     12688**DCL     13728<>CALL    13733<>CALL
SITE_NAME.COUNT
     12689**DCL     13428<<ASSIGN
SITE_NAME.TEXT
     12690**DCL     13429<<CALLBLT
SITE_STRING IN PROCEDURE SELECT_DESTINATION_SITE
     13782**DCL     13788<<CALLBLT 13793<<CALLBLT 13796--ASSIGN
SKIP_BLANKS
     12795**DCL     14137>>CALLBLT 15045>>CALLBLT 15262>>CALLBLT
SKIP_NON_BLIND_COPY IN PROCEDURE SEND_ONE_MAILGRAM
     14012**LABEL   13945--GOTO
SMTP_SESSION
     13817**PROC    13256--CALL
SOURCE$ IN PROCEDURE COPY
     14983**DCL     14979--PROC    14988>>IF      14991>>ASSIGN  14992>>ASSIGN  14992>>ASSIGN
SOURCE_STRG IN PROCEDURE SEND_ONE_MAILGRAM
     13910**DCL     14101<<CALLBLT 14102>>CALLBLT 14104>>CALLBLT 14105>>CALLBLT 14105>>CALLBLT 14107<<CALLBLT
     14107>>CALLBLT 14112>>CALLBLT 14114>>CALLBLT 14117<<CALLBLT 14117>>CALLBLT 14121>>CALLBLT
STARTSCAN IN PROCEDURE PARSE_MAIL_HEADER
     14634**DCL     14840<<ASSIGN  14842>>CALLBLT 14843>>CALLBLT 14846<<ASSIGN  14850<<ASSIGN
STATUS_UPDATE
     15229**PROC    13272--CALL    13329--CALL    13825--CALL    13830--CALL    13844--CALL    13859--CALL
     13871--CALL    13881--CALL    13918--CALL    14030--CALL    14192--CALL    14197--CALL    14304--CALL
     14540--CALL    15076--CALL    15131--CALL    15192--CALL
STRUCTURE IN PROCEDURE ADJUST_POINTER
     14613**DCL     14605--PROC    14619--ASSIGN
SUA3
     10019**DCL      9978--DCLINIT
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:506  
SUA4
     10090**DCL      9992--DCLINIT
SUB$ IN PROCEDURE INITIALIZE_CONFIGURATION
     13348**DCL     13383<<ASSIGN  13386>>ASSIGN  13386>>ASSIGN  13388>>ASSIGN  13388>>ASSIGN  13390>>ASSIGN
     13390>>ASSIGN  13392>>CALLBLT 13392>>CALLBLT 13396>>ASSIGN  13400>>DOCASE  13402>>CALLBLT 13402>>CALLBLT
     13406>>IF      13407>>IF      13407>>IF      13410>>CALLBLT 13410>>CALLBLT 13415>>ASSIGN  13420>>ASSIGN
     13420>>ASSIGN
SUBJECT
     13030**DCL     13029--DCLINIT 14663>>ASSIGN
SUBJECT.L
     13031**DCL     14664<<ASSIGN
SUBJECT.T
     13032**DCL     14665<<ASSIGN
SUBJECT$
     13029**DCL     14142>>IF      14143>>CALLBLT 14143>>CALLBLT 14642<>CALL    14689>>IF      14691>>CALLBLT
     14691>>CALLBLT 14694>>ASSIGN  14695>>ASSIGN  14695>>ASSIGN  14696>>ASSIGN  14696>>ASSIGN  14697>>IF
     14697>>IF      14697>>IF      14698>>ASSIGN  14698>>ASSIGN  14702>>ASSIGN  14703>>ASSIGN  14703>>ASSIGN
     14704>>ASSIGN  15157>>IF      15158>>CALLBLT 15158>>CALLBLT 15214>>IF      15215>>CALLBLT 15215>>CALLBLT
TARGET_STRG IN PROCEDURE SEND_ONE_MAILGRAM
     13911**DCL     14105<<CALLBLT 14114<<CALLBLT 14121<<CALLBLT 14125>>CALLBLT
TBUF IN PROCEDURE SEND_ONE_MAILGRAM
     13904**DCL     13949<<CALLBLT 13952>>IF      13958>>IF
TCM$DRAIN_SMTP
     12676**DCL-ENT 14190--CALL
TCM$READ_SMTP
     12673**DCL-ENT 13834--CALL    14458--CALL
TCM$START_SMTP
     12672**DCL-ENT 13828--CALL
TCM$STOP_SMTP
     12677**DCL-ENT 13259--CALL
TCM$WRITE_AUDIT_LOG
     12678**DCL-ENT 13280--CALL    13283--CALL    13286--CALL    13826--CALL    13855--CALL    14210--CALL
TCM$WRITE_AUDIT_OFF
     12680**DCL-ENT 13338--CALL
TCM$WRITE_AUDIT_ON
     12679**DCL-ENT 13180--CALL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:507  
TCM$WRITE_SMTP
     12675**DCL-ENT 14457--CALL    14498--CALL    14507--CALL    14528--CALL    14530--CALL
TCM_ACCOUNT
      9358**DCL      8017--DCLINIT  8237--DCLINIT  8948--DCLINIT
TCM_ACCOUNT.ACCT#
      9358**DCL     13386<<ASSIGN  15182>>ASSIGN
TCM_CONFIG_CMD
     12693**DCL     11317--DCLINIT
TCM_DRIBBLE
     12695**DCL     13194>>IF
TCM_DRIBBLE_ME
     12696**DCL     13197>>IF
TCM_LOGON
     12712**DCL     13392<<CALLBLT
TCM_MESSACCT
      9371**DCL      8127--DCLINIT  9664--DCLINIT
TCM_MESSACCT.ACCT#
      9371**DCL     13193<<ASSIGN  13388<<ASSIGN
TCM_PHONE
     12713**DCL     13420<<ASSIGN
TCM_PROGNAME
     12708**DCL     13173<<ASSIGN  13177<<ASSIGN  13252>>CALLBLT 15236--ASSIGN  15237>>CALLBLT
TCM_SEND_ACCT
      9430**DCL      9387--DCLINIT
TCM_SEND_NAME
      9417**DCL      9387--DCLINIT
TCM_SMTP_BAILOUT
     12682**DCL     13213<<REMEMBR 14468>>UNWIND  14480>>UNWIND
TCM_SMTP_PROGRESS
     12683**DCL     13217<<ASSIGN  13276>>ASSIGN  13315>>IF      13827<<ASSIGN  13831<<ASSIGN  13856<<ASSIGN
     13884<<ASSIGN
TCM_SOCKINIT
      4093**DCL     13215<>CALL
TCM_STUCKEE
     12709**DCL     13390<<ASSIGN  15137>>IF      15138>>CALLBLT 15200>>IF      15201>>CALLBLT
TCM_TESTMODE
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:508  
     12697**DCL     13832>>IF      14452>>IF      14497>>IF      14506>>IF      14526>>IF
TCM_TZTEXT
     12710**DCL     13398<<CALLBLT 14039>>CALLBLT
TCM_UTOFFSET
     12711**DCL     13404<<ASSIGN  13408<<ASSIGN  13408>>ASSIGN  13413<<ASSIGN  13415<<ASSIGN
TCM_XLATE_TO_UC
     13121**DCL     13429>>CALLBLT 13443>>CALLBLT 13527>>CALLBLT 13573>>CALLBLT 13788>>CALLBLT 13793>>CALLBLT
     13949>>CALLBLT 14786>>CALLBLT 15010>>CALLBLT
TCP_FLAVOR
     12716**DCL     13174<<ASSIGN  13178<<ASSIGN  14033>>IF      14444>>IF      14472>>IF      14527>>IF
TELLUSER IN PROCEDURE INITIALIZE_CONFIGURATION
     13434**LABEL   13520--GOTO    13552--GOTO    13569--GOTO
TEMPBUF
     12837**DCL     12838--DCLINIT
TEMPBUF_
     12838**DCL     14498<>CALL    14530<>CALL
TERMINATING
     12717**DCL     13214<<ASSIGN  13216>>DOUNTIL 13222<<ASSIGN  13274>>IF
TEXT$ IN PROCEDURE EMIT_ADDRESSES
     14240**DCL     14231--PROC    14261>>IF      14262>>CALLBLT 14262>>CALLBLT
TEXTC.L
     12545**DCL     12546--IMP-SIZ 14151>>CALLBLT 14155>>CALLBLT 14262>>CALLBLT 14991>>ASSIGN  14992>>ASSIGN
     15146>>CALLBLT 15149>>CALLBLT 15162>>CALLBLT
TEXTC.T
     12546**DCL     14151>>CALLBLT 14155>>CALLBLT 14262>>CALLBLT 14992>>ASSIGN  15146>>CALLBLT 15149>>CALLBLT
     15162>>CALLBLT
THIS_NODE
     12729**DCL     13799<<DOINDEX 13800>>CALLBLT 13801>>ASSIGN  13805>>ASSIGN  13806>>ASSIGN  14046>>CALLBLT
     14046>>CALLBLT 14056>>CALLBLT 14056>>CALLBLT 14067>>CALLBLT 14067>>CALLBLT 14083>>CALLBLT 14083>>CALLBLT
     14158>>IF
THIS_SITE
     12727**DCL     13299<<DOINDEX 13300>>IF      13300>>IF      13300>>IF      13303>>CALL    13303>>CALL
     13303>>CALL    13308>>IF      13309>>CALL    13309>>CALL    13313>>ASSIGN  13670>>ASSIGN  13670>>ASSIGN
     13681<<DOINDEX 13682>>IF      13682>>IF      13682>>IF      13682>>IF      13687>>IF      13687>>IF
     13690>>ASSIGN  13692>>IF      13693>>ASSIGN  13696>>ASSIGN  13805<<ASSIGN  13861>>IF      13873>>IF
TIMEBUF
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:509  
     13112**DCL      9853--DCLINIT  9854--DCLINIT  9873--DCLINIT  9874--DCLINIT 13252>>CALLBLT 13661>>CALLBLT
     13662>>CALLBLT 14039>>CALLBLT
TIMEBUF2
     13113**DCL      9933--DCLINIT  9934--DCLINIT 13328>>ASSIGN
TIME_NOW
     12720**DCL      9895--DCLINIT  9935--DCLINIT 13277>>ASSIGN  13298<>CALL    13309<>CALL    13318<>CALL
     13326<>CALL    13326<>CALL    13664>>ASSIGN  13687>>IF
TIME_THEN
     12721**DCL     13298<>CALL    13313<<ASSIGN  13313>>ASSIGN  13318<>CALL
TO$
     12999**DCL     14100>>IF      14132>>IF      14132>>IF      14133>>CALLBLT 14133>>CALLBLT 14133>>CALLBLT
     14135>>CALLBLT 14135>>CALLBLT 14372>>ASSIGN  14640<>CALL    14706>>CALLBLT 14706>>CALLBLT 14711>>ASSIGN
     14732>>CALLBLT 14732>>CALLBLT 14737>>ASSIGN  14741>>IF      14743>>CALLBLT 14743>>CALLBLT 14745>>CALLBLT
     14745>>CALLBLT 14746>>CALLBLT 14746>>CALLBLT 14750>>CALLBLT 14750>>CALLBLT 14752>>CALLBLT 14752>>CALLBLT
     14754>>ASSIGN  14754>>ASSIGN  14755>>ASSIGN  14755>>ASSIGN  14756>>ASSIGN  14757>>ASSIGN  14757>>ASSIGN
     14758>>DOWHILE 14759>>IF      14759>>IF      14759>>IF      14760>>ASSIGN  14760>>ASSIGN  14767>>CALLBLT
     14767>>CALLBLT 14769>>ASSIGN  14773>>CALLBLT 14773>>CALLBLT 14775>>CALLBLT 14775>>CALLBLT 14777>>ASSIGN
     14778>>CALLBLT 14778>>CALLBLT 14779>>ASSIGN  14785>>ASSIGN  14786>>CALLBLT 14786>>CALLBLT 14876>>IF
     14890>>ASSIGN  14891>>ASSIGN  14891>>ASSIGN  15153>>IF      15154>>CALLBLT 15154>>CALLBLT 15206>>IF
     15207>>CALLBLT 15207>>CALLBLT
TOERR
     12831**DCL     14923>>ASSIGN  14924--ASSIGN
TONAME
     13000**DCL     12999--DCLINIT 14652<<ASSIGN  14657<<ASSIGN
TONAME.L
     13001**DCL     14660<<ASSIGN
TONAME.T
     13002**DCL     14661<<ASSIGN
TOSITE
     13090**DCL     13089--DCLINIT
TOSITE.L
     13091**DCL     14675<<ASSIGN
TOSITE.T
     13092**DCL     14676<<ASSIGN
TOSITE$
     13089**DCL     13793>>CALLBLT 13793>>CALLBLT 13794>>CALLBLT 13794>>CALLBLT 14895>>ASSIGN  14896>>ASSIGN
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:510  
     14896>>ASSIGN  14950>>ASSIGN  14951>>ASSIGN  14951>>ASSIGN
TOTAL_READY
     12735**DCL     13233<<ASSIGN  13671<<ASSIGN  13671>>ASSIGN
TRACELOOP IN PROCEDURE EMIT_TRACE_RECORDS
     14347**LABEL   14351--EXIT    14355--EXIT    14374--EXIT
TRIED_DIRECT_SEND IN PROCEDURE SEND_ONE_MAILGRAM
     13905**DCL     13919<<ASSIGN  13938<<ASSIGN  14002>>IF      14020>>IF
TRIES_LEFT IN PROCEDURE SMTP_SESSION
     13819**DCL     13845<<DOINDEX 13851>>IF
TSTRING IN PROCEDURE MAKE_SMTP_ADDRESS
     15006**DCL     15010<<CALLBLT 15011>>IF      15026<<CALLBLT 15031<<CALLBLT 15034>>ASSIGN  15041<<CALLBLT
     15043>>ASSIGN
TSTRING IN PROCEDURE PARSE_MAIL_HEADER
     14636**DCL     14755<<ASSIGN  14757>>ASSIGN  14869<<CALLBLT 14872>>ASSIGN
TSTRING IN PROCEDURE SEND_ERROR_REPORT
     14389**DCL     14402<<CALLBLT 14403>>ASSIGN
TVAL
     12705**DCL     13253<<CALLBLT 13254>>ASSIGN  13661<<CALLBLT 13663<<ASSIGN  13663>>ASSIGN  13682>>IF
     13682>>IF      13682>>IF      13682>>IF      15262<<CALLBLT
TVAL IN PROCEDURE MAKE_SMTP_ADDRESS
     15007**DCL     15024<<CALLBLT 15026>>CALLBLT 15026>>CALLBLT 15026>>CALLBLT 15045<<CALLBLT
TVAL IN PROCEDURE PARSE_MAIL_HEADER
     14637**DCL     14746<<CALLBLT 14752<<CALLBLT 14753>>ASSIGN  14754>>ASSIGN  14853<<ASSIGN  14854>>ASSIGN
     14855>>ASSIGN  14885<<CALLBLT 14887>>IF      14888>>ASSIGN
TVAL IN PROCEDURE SEND_ERROR_REPORT
     14390**DCL     14399<<CALLBLT 14400>>IF      14402>>CALLBLT 14402>>CALLBLT 14412<<DOINDEX 14413>>ASSIGN
TVAL IN PROCEDURE SEND_ONE_MAILGRAM
     13906**DCL     14137<<CALLBLT
TYPE IN PROCEDURE EMIT_ADDRESSES
     14241**DCL     14231--PROC    14245>>IF
UNDERBLANK IN PROCEDURE MAKE_SMTP_ADDRESS
     15056**LABEL   15020--GOTO
USERS.L
     12781**DCL     13961<<ASSIGN  13961>>ASSIGN  13984<<ASSIGN  13995>>CALLBLT 14007>>ASSIGN  14245>>IF
     14256>>ASSIGN  14952<<ASSIGN
USERS.LIST
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:511  
     12780**DCL     13943>>IF      13943>>IF      14245>>IF      14953<<ASSIGN
USERS.T
     12782**DCL     13947>>CALLBLT 13949>>CALLBLT 13960<<ASSIGN  13962>>CALLBLT 13964<<ASSIGN  13972>>CALLBLT
     13973>>CALLBLT 13979>>CALLBLT 13980<<ASSIGN  13981>>CALLBLT 13983>>IF      13985<<ASSIGN  13988<<ASSIGN
     13991<<ASSIGN  13995>>CALLBLT 14008>>ASSIGN  14250>>ASSIGN  14253>>CALLBLT 14934<<CALLBLT 14939<<CALLBLT
     14943--ASSIGN  14944>>DOWHILE 14948>>ASSIGN  14949>>CALLBLT 14951>>ASSIGN
USER_COUNT
     12734**DCL     13765<<ASSIGN  13942>>DOINDEX 14244>>DOINDEX 14907<<ASSIGN  14922>>IF      14934>>CALLBLT
     14939>>CALLBLT 14943>>ASSIGN  14944>>DOWHILE 14948>>ASSIGN  14949>>CALLBLT 14951>>ASSIGN  14952>>ASSIGN
     14953>>ASSIGN  14954<<ASSIGN  14954>>ASSIGN
UTS_DIFF
     12722**DCL     13318<>CALL    13319>>ASSIGN
VLEN
     12702**DCL     13800<<CALLBLT 13801>>ASSIGN  14440<>CALL    14449>>ASSIGN  14457<>CALL    14489<>CALL
     14491>>IF      14504>>ASSIGN  14507<>CALL    14517>>ASSIGN  15067<>CALL    15068>>ASSIGN
VLEN IN PROCEDURE GET_IOBUF_BOUND
     15260**DCL     15257--PROC    15262<<CALLBLT 15265<<ASSIGN
VLEN IN PROCEDURE WRITEDO
     15245**DCL     15247<>CALL    15248>>IF      15251>>ASSIGN
VLR_ERRMSG
     10330**DCL     10267--DCLINIT
VLR_ERRMSG.RECCNT
     10334**DCL     14412>>DOINDEX
VMERRMSG
     10304**DCL     10264--DCLINIT
VM_ADD_HEAD
     12310**DCL     14787--ASSIGN  14813<>CALL
VM_ADD_HEAD.HEAD$
     12320**DCL     14812>>ASSIGN  14919>>ASSIGN
VM_ADD_HEAD.NUM_ENTRIES
     12313**DCL     14807>>IF
VM_BODYKEY
     12424**DCL     14278--ASSIGN  14291--ASSIGN  14330--ASSIGN  14343--ASSIGN
VM_BODYKEY.COUNT
     12425**DCL     14282<<ASSIGN  14334<<ASSIGN
VM_BODYKEY.MESSAGE_NUMBER
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:512  
     12428**DCL     14284<<ASSIGN  14297>>IF      14336<<ASSIGN  14353>>IF
VM_BODYKEY.REC_NUMBER
     12430**DCL     14285<<ASSIGN  14297>>IF      14302>>CALLBLT 14337<<ASSIGN
VM_BODYKEY.TYPE
     12426**DCL     14283<<ASSIGN  14297>>IF      14335<<ASSIGN  14353>>IF
VM_BODYREC
     12392**DCL     14289--ASSIGN  14341--ASSIGN
VM_BODYREC.VALUE.DATA
     12410**DCL     14295<<ASSIGN  14306>>IF      14307>>CALLBLT 14309>>ASSIGN  14348<<ASSIGN  14356>>DOSELCT
     14359>>CALLBLT 14360>>CALLBLT 14362>>CALLBLT 14370>>ASSIGN  14378>>ASSIGN
VM_FILERES
     12458**DCL      8600--DCLINIT  8619--DCLINIT
VM_HEADER
     12164**DCL     14554--ASSIGN  14588<>CALL    14589<>CALL    14590<>CALL    14591<>CALL    14592<>CALL
     14593<>CALL    14594<>CALL    14595<>CALL    14596<>CALL    14597<>CALL    14598<>CALL    14599<>CALL
     14600<>CALL    15083--ASSIGN  15096--ASSIGN
VM_HEADER.BAD_ADDRESS$
     12248**DCL     14588<>CALL    14645<>CALL
VM_HEADER.BLIND$
     12250**DCL     14096<>CALL    14589<>CALL
VM_HEADER.COPY$
     12252**DCL     14093<>CALL    14590<>CALL
VM_HEADER.CREATION_DATE
     12167**DCL     14587>>ASSIGN
VM_HEADER.ERROR
     12237**DCL     14410--ASSIGN
VM_HEADER.FILE_FOLDER$
     12254**DCL     14591<>CALL
VM_HEADER.FROM$
     12256**DCL     14592<>CALL    14639<>CALL    14649>>IF      14656>>IF
VM_HEADER.NUM_RECORDS
     12175**DCL     14275>>CALLBLT 14416>>IF      15112>>ASSIGN
VM_HEADER.NUM_TRACE_RECORDS
     12274**DCL     13931>>IF      14035>>IF      14421>>IF
VM_HEADER.REFERENCE$
     12258**DCL     14593<>CALL    14643<>CALL    15148>>IF      15149>>CALLBLT 15149>>CALLBLT
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:513  
VM_HEADER.REFERS_TO_ID$
     12272**DCL     14154>>IF      14155>>CALLBLT 14155>>CALLBLT 14599<>CALL    14647<<ASSIGN
VM_HEADER.REPLY_TO$
     12260**DCL     14594<>CALL    14641<>CALL    14651>>IF
VM_HEADER.RETURN_ADDRESS$
     12262**DCL     14595<>CALL
VM_HEADER.SIGNED$
     12264**DCL     14596<>CALL    14644<>CALL
VM_HEADER.STATUS.ACK
     12183**DCL     14794>>IF
VM_HEADER.STATUS.ANSWER
     12181**DCL     14794>>IF
VM_HEADER.STATUS.DEL
     12199**DCL     14569>>IF      15092<<ASSIGN
VM_HEADER.STATUS.DELIVERY
     12213**DCL     14794>>IF
VM_HEADER.STATUS.DR
     12211**DCL     14061>>IF      14199>>IF      15143>>IF      15165>>IF
VM_HEADER.STATUS.ERR
     12178**DCL     14035>>IF      14184>>IF      14646>>IF      14794>>IF      15129>>IF      15193>>IF
VM_HEADER.STATUS.EXAM
     12197**DCL     15094<<ASSIGN
VM_HEADER.STATUS.FCOPY
     12201**DCL     14569>>IF
VM_HEADER.STATUS.MARK
     12203**DCL     14569>>IF
VM_HEADER.STATUS.OLD
     12191**DCL     15093<<ASSIGN
VM_HEADER.STATUS.RR
     12187**DCL     14050>>IF      14199>>IF      15095<<ASSIGN  15143>>IF      15169>>IF
VM_HEADER.SUBJECT$
     12266**DCL     14597<>CALL    14642<>CALL
VM_HEADER.TO$
     12268**DCL     14091<>CALL    14598<>CALL    14640<>CALL
VM_HEADER.UNIQUE_ID$
     12270**DCL     14150>>IF      14151>>CALLBLT 14151>>CALLBLT 14600<>CALL    14647>>ASSIGN  14648<<ASSIGN
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:514  
     15146>>CALLBLT 15146>>CALLBLT 15161>>IF      15162>>CALLBLT 15162>>CALLBLT
VM_HEADRES
     12472**DCL      8637--DCLINIT  8656--DCLINIT
VM_HEADRES.RES#
     12474**DCL     14571<<ASSIGN
VM_INFOKEY
     12293**DCL     14215--ASSIGN  14541--ASSIGN  14548--ASSIGN  14556--ASSIGN  14909--ASSIGN  15085--ASSIGN
     15088--ASSIGN  15098--ASSIGN
VM_INFOKEY.COUNT
     12294**DCL     14212<<ASSIGN  14548<<ASSIGN  14566>>IF      14916<<ASSIGN  15088<<ASSIGN
VM_INFOKEY.MESSAGE_NUMBER
     12297**DCL     14213<<ASSIGN  14550<<ASSIGN  14571>>ASSIGN  14586>>ASSIGN  14915<<ASSIGN  15090<<ASSIGN
VM_INFOKEY.TYPE
     12295**DCL     14214<<ASSIGN  14549<<ASSIGN  14566>>IF      14917<<ASSIGN  15089<<ASSIGN
VM_LISTKEY
     12376**DCL     14789--ASSIGN
VM_LISTKEY.COUNT
     12377**DCL     14785<<ASSIGN
VM_LISTKEY.TEXT
     12380**DCL     14786<<CALLBLT
VM_LISTKEY.TYPE
     12378**DCL     14785--ASSIGN
VM_PROFILE
     12062**DCL     15105--ASSIGN  15113--ASSIGN
VM_PROFILE.NUM_DEL_MESSAGES
     12103**DCL     15111<<ASSIGN  15111>>ASSIGN
VM_PROFILE.RECS_DELETED
     12124**DCL     15112<<ASSIGN  15112>>ASSIGN
VM_PROKEY
     12149**DCL     15107--ASSIGN  15115--ASSIGN
VM_PRORES
     12444**DCL      8563--DCLINIT  8582--DCLINIT
VM_SITE
     12486**DCL     14579--ASSIGN
VM_SITE.ORIGIN
     12494**DCL     15011>>IF
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:515  
VM_SITEKEY
     12510**DCL     10402--DCLINIT 10403--DCLINIT
VM_UADDRESS.FOLDER
     12354**DCL     12355--REDEF
VM_UADDRESS.NEXT$
     12340**DCL     14964>>ASSIGN
VM_UADDRESS.SITENAME
     12361**DCL     14814>>IF      14934>>CALLBLT 14939>>CALLBLT
VM_UADDRESS.TYPE
     12351**DCL     14814>>IF      14921>>IF
VM_UADDRESS.USER_NAME.COUNT
     12363**DCL     14821>>ASSIGN  14927>>DOWHILE 14927>>DOWHILE 14929<<ASSIGN  14929>>ASSIGN  14931>>CALLBLT
     14934>>CALLBLT 14939>>CALLBLT
VM_UADDRESS.USER_NAME.TEXT
     12364**DCL     14814>>IF      14822>>ASSIGN  14927>>DOWHILE 14931>>CALLBLT 14934>>CALLBLT 14939>>CALLBLT
WAITING_FOR_SMTP_GREETING
     10542**DCL     13830<>CALL
WAIT_A_SECOND
      9950**DCL     14034<>CALL    14194<>CALL    14445<>CALL    14473<>CALL    14501<>CALL
WAIT_A_SECOND.V
      9951**DCL      9950--DCLINIT
WAIT_A_WHILE
      9964**DCL     13330<>CALL    14518<>CALL
WAIT_A_WHILE.V
      9965**DCL      9964--DCLINIT
WAIT_A_WHILE.V.UNITS#
      9965**DCL     13316<<ASSIGN  13319<<ASSIGN  13326>>CALL    14517<<ASSIGN
WRAP_IT_UP IN PROCEDURE SEND_ONE_MAILGRAM
     14210**LABEL   14014--GOTO
WRITEDO
     15243**PROC    13189--CALL    13435--CALL
WRITE_DO
      7741**DCL     15252<>CALL
WRITE_DO.BUF_
      7741**DCL     15249<<ASSIGN  15251<<ASSIGN
WRITE_DO.STATION_
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:516  
      7743**DCL      7743--REDEF
WRITE_DO.V
      7744**DCL      7741--DCLINIT
WRITE_DO.V.DVBYTE.VFC#
      7750**DCL      7750--REDEF
WRITE_FOLDER
      8411**DCL     15100<>CALL    15117<>CALL
WRITE_FOLDER.BUF_
      8411**DCL     15096<<ASSIGN  15113<<ASSIGN
WRITE_FOLDER.BUF_.BOUND
      8411**DCL     15097<<ASSIGN  15114<<ASSIGN
WRITE_FOLDER.KEY_
      8411**DCL     15098<<ASSIGN  15115<<ASSIGN
WRITE_FOLDER.STATION_
      8413**DCL      8413--REDEF
WRITE_FOLDER.V
      8414**DCL      8411--DCLINIT
WRITE_FOLDER.V.DVBYTE.VFC#
      8420**DCL      8420--REDEF
WRITE_FOLDER.V.ONEWKEY#
      8416**DCL     15099<<ASSIGN  15116<<ASSIGN
WRITE_MAILMSG
      8789**DCL     15069<>CALL
WRITE_MAILMSG.BUF_.BOUND
      8789**DCL     15068<<ASSIGN
WRITE_MAILMSG.STATION_
      8791**DCL      8791--REDEF
WRITE_MAILMSG.V
      8792**DCL      8789--DCLINIT
WRITE_MAILMSG.V.DVBYTE.VFC#
      8798**DCL      8798--REDEF
WRITE_MAILMSG_BLANK
      8821**DCL     15173<>CALL    15218<>CALL
WRITE_MAILMSG_BLANK.STATION_
      8823**DCL      8823--REDEF
WRITE_MAILMSG_BLANK.V
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:517  
      8824**DCL      8821--DCLINIT
WRITE_MAILMSG_BLANK.V.DVBYTE.VFC#
      8830**DCL      8830--REDEF
WRITE_MAIL_MESSAGE
     15065**PROC    15136--CALL    15139--CALL    15142--CALL    15145--CALL    15147--CALL    15150--CALL
     15155--CALL    15159--CALL    15163--CALL    15167--CALL    15171--CALL    15177--CALL    15199--CALL
     15202--CALL    15205--CALL    15208--CALL    15212--CALL    15216--CALL    15222--CALL    15224--CALL
WRITE_ME
      9516**DCL     13255<>CALL    13839<>CALL    14450<>CALL    14464<>CALL    14505<>CALL
WRITE_ME.BUF_.BOUND
      9516**DCL     13254<<ASSIGN  13838<<ASSIGN  14449<<ASSIGN  14463<<ASSIGN  14504<<ASSIGN
WRITE_ME.STATION_
      9518**DCL      9518--REDEF
WRITE_ME.V
      9519**DCL      9516--DCLINIT
WRITE_ME.V.DVBYTE.VFC#
      9525**DCL      9525--REDEF
WRITE_ME_BLANK
      9578**DCL     14496<>CALL
WRITE_ME_BLANK.STATION_
      9580**DCL      9580--REDEF
WRITE_ME_BLANK.V
      9581**DCL      9578--DCLINIT
WRITE_ME_BLANK.V.DVBYTE.VFC#
      9587**DCL      9587--REDEF
WRITE_ME_NULL
      9547**DCL     14525<>CALL
WRITE_ME_NULL.STATION_
      9549**DCL      9549--REDEF
WRITE_ME_NULL.V
      9550**DCL      9547--DCLINIT
WRITE_ME_NULL.V.DVBYTE.VFC#
      9556**DCL      9556--REDEF
WRITE_QUOTES
      9198**DCL     13618<>CALL
WRITE_QUOTES.BUF_
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:518  
      9198**DCL     13616<<ASSIGN
WRITE_QUOTES.STATION_
      9200**DCL      9200--REDEF
WRITE_QUOTES.V
      9201**DCL      9198--DCLINIT
WRITE_QUOTES.V.DVBYTE.VFC#
      9207**DCL      9207--REDEF
X$WILDCMP
      7673**DCL-ENT 13803--CALL
XSL$SOCKINIT
      7671**DCL-ENT 13215--CALL
XTX$ADAPT
     10906**DCL-ENT 11222--DCLINIT
XUD$UTS_ADJUST
      7406**DCL-ENT 13298--CALL    13303--CALL    13309--CALL    13326--CALL
XUD$UTS_DIFF_SEC
      7394**DCL-ENT 13318--CALL
XUG$CLOSE_DCBS
      7446**DCL-ENT 13323--CALL    13337--CALL
XUG$ECHOIF
      7439**DCL-ENT 13370--CALL
XUG$ERRMSG
      7444**DCL-ENT 13371--CALL
XUG$GETCMD
      7437**DCL-ENT 13360--CALL
XUG$INIT
      7441**DCL-ENT 13355--CALL
XUG_GETCMD
     11316**DCL     13323<>CALL    13337<>CALL    13355<>CALL    13360<>CALL    13370<>CALL    13371<>CALL
XUG_GETCMD.DCB_PARAM#
     11496**DCL     13321<<ASSIGN  13335<<ASSIGN
XUG_GETCMD.DISP#
     11507**DCL     13322<<ASSIGN  13336<<ASSIGN
XUG_GETCMD.ERR#
     11327**DCL     13369>>ASSIGN
XUG_GETCMD.ERR#.CODE#
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:519  
     11330**DCL     13365>>IF
XUG_GETCMD.ERR#.MON#
     11329**DCL     13365>>IF      13372>>IF
XUG_GETCMD.ERR_CODE
     11464**DCL     13369<<ASSIGN
XUG_GETCMD.OUT$
     11321**DCL     11327--REDEF   13376>>ASSIGN
XUG_GETCMD.PCB$
     11341**DCL     11742--IMP-PTR 13397>>ASSIGN  13398>>CALLBLT
XUG_INIT
     10911**DCL     13355<>CALL
XUW_WILDCARD
     11985**DCL     13803<>CALL
XUW_WILDCARD.INPUT_
     11991**DCL     13796<<ASSIGN
XUW_WILDCARD.PATTERN_
     11986**DCL     13801<<ASSIGN
ZAP_FOLDER
      8490**DCL     15078<>CALL
ZAP_FOLDER.SN_
      8490**DCL      8490--REDEF
ZAP_FOLDER.UTL_
      8491**DCL      8491--REDEF
ZAP_FOLDER.V
      8495**DCL      8490--DCLINIT
ZAP_FOLDER.V.EXPIRE#
      8505**DCL      8505--REDEF
ZAP_FOLDER.V.TYPE#
      8503**DCL      8503--REDEF
ZAP_FOLDER.V.XTNSIZE#
      8500**DCL      8500--REDEF    8502--REDEF
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:520  
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:521  
              MINI UREF LISTING

B$DS3$    7666**DCL
B$TCB    7655**DCL
B$TCB$    7668**DCL
BLANK_INDEX IN PROCEDURE PARSE_MAIL_HEADER  14627**DCL
BYPASS_MAIL_FROM IN PROCEDURE SEND_ONE_MAILGRAM  13940**LABEL
COPYERR   12827**DCL
CPS IN PROCEDURE SEND_SMTP_DATA  14487**DCL
EOJ   13335**LABEL
FILL$   12706**DCL
HDRADDR   12846**DCL
HDRBC   12849**DCL
HDRC   12848**DCL
HDRDATE   12841**DCL
HDRFROM   12844**DCL
HDRNUMBER   12842**DCL
HDRRE   12847**DCL
HDRSUBJ   12845**DCL
LINE   12803**DCL
LINELEN IN PROCEDURE INITIALIZE_QUOTATIONS  13589**DCL
M$ACCT    1452**DCL-ENT
M$ACTIVATE    1455**DCL-ENT
M$ASUSER    1450**DCL-ENT
M$ATTACH    1457**DCL-ENT
M$BADPP    1475**DCL-ENT
M$CGCTL    1456**DCL-ENT
M$CGINFO    1456**DCL-ENT
M$CHECK    1437**DCL-ENT
M$CHGUNIT    1495**DCL-ENT
M$CLRSTK    1493**DCL-ENT
M$CMDVAR    1504**DCL-ENT
M$CONFIG    1465**DCL-ENT
M$CORRES    1440**DCL-ENT
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:522  
M$CPEXIT    1449**DCL-ENT
M$CVM    1473**DCL-ENT
M$CVOL    1438**DCL-ENT
M$DCLFLD    1465**DCL-ENT
M$DEACTIVATE    1455**DCL-ENT
M$DETACH    1457**DCL-ENT
M$DEVICE    1439**DCL-ENT
M$DISPLAY    1502**DCL-ENT
M$DLIB    1448**DCL-ENT
M$DO    7678**DCL
M$DRIBBLE    1465**DCL-ENT
M$DRTN    1493**DCL-ENT
M$DSUSER    1450**DCL-ENT
M$EOM    1460**DCL-ENT
M$ERASE    1466**DCL-ENT
M$EVENT    1490**DCL-ENT
M$EXHUME    1499**DCL-ENT
M$EXTEND    1439**DCL-ENT
M$FDP    1471**DCL-ENT
M$FEBOOT    1463**DCL-ENT
M$FECTL    1464**DCL-ENT
M$FEDUMP    1463**DCL-ENT
M$FID    1498**DCL-ENT
M$FINDPROC    1452**DCL-ENT
M$FSUSER    1450**DCL-ENT
M$FVP    1472**DCL-ENT
M$FWCG    1456**DCL-ENT
M$GBPL    1476**DCL-ENT
M$GDDL    1472**DCL-ENT
M$GDP    1471**DCL-ENT
M$GETDCB    1441**DCL-ENT
M$GETMOUSE    1481**DCL-ENT
M$GETPM    1482**DCL-ENT
M$GJOB    1500**DCL-ENT
M$GLINEATTR    1460**DCL-ENT
M$GOODPP    1475**DCL-ENT
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:523  
M$GPLATEN    1468**DCL-ENT
M$GPROMPT    1467**DCL-ENT
M$GTRMATTR    1461**DCL-ENT
M$GTRMCTL    1459**DCL-ENT
M$GTRMTAB    1462**DCL-ENT
M$GVP    1471**DCL-ENT
M$HELP    1498**DCL-ENT
M$INT    1490**DCL-ENT
M$INTRTN    1451**DCL-ENT
M$IOQ    1486**DCL-ENT
M$JOBSTATS    1500**DCL-ENT
M$KEYIN    1440**DCL-ENT
M$LDEV    1435**DCL-ENT
M$LDTRC    1448**DCL-ENT
M$LIMIT    1441**DCL-ENT
M$LINES    1440**DCL-ENT
M$MADMUCK    1443**DCL-ENT
M$MAKUSER    1474**DCL-ENT
M$MBS    1442**DCL-ENT
M$MDFFLD    1466**DCL-ENT
M$ME    7675**DCL
M$MERC    1491**DCL-ENT
M$MERCS    1492**DCL-ENT
M$MIRROR    1486**DCL-ENT
M$MONINFO    1503**DCL-ENT
M$MPL    1476**DCL-ENT
M$NODEINFO    1467**DCL-ENT
M$NXTUSR    1501**DCL-ENT
M$OCMSG    1499**DCL-ENT
M$OLAY    1447**DCL-ENT
M$PAS    1476**DCL-ENT
M$PATHCON    1499**DCL-ENT
M$PDS    1470**DCL-ENT
M$PFIL    1437**DCL-ENT
M$PLATEN    1461**DCL-ENT
M$PROCNAME    1452**DCL-ENT
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:524  
M$PROFILE    1463**DCL-ENT
M$PROMPT    1459**DCL-ENT
M$QUOTES   12662**DCL
M$QUOTES$   12669**DCL
M$RACST    1443**DCL-ENT
M$RDSYSLOG    1484**DCL-ENT
M$RELDCB    1441**DCL-ENT
M$RELSTARF    1444**DCL-ENT
M$REM    1444**DCL-ENT
M$RENV    1491**DCL-ENT
M$REQUIRE    1443**DCL-ENT
M$RETRY    1492**DCL-ENT
M$RETRYS    1492**DCL-ENT
M$REW    1438**DCL-ENT
M$RLSFLD    1466**DCL-ENT
M$RPRIV    1494**DCL-ENT
M$RSPP    1473**DCL-ENT
M$RSWITCH    1495**DCL-ENT
M$RUE    1501**DCL-ENT
M$SAD    1474**DCL-ENT
M$SAVE    1450**DCL-ENT
M$SCON    1451**DCL-ENT
M$SENV    1491**DCL-ENT
M$SETFMA    1435**DCL-ENT
M$SETFP    1464**DCL-ENT
M$SINPUT    1462**DCL-ENT
M$SLCFLD    1467**DCL-ENT
M$SMOUSE    1481**DCL-ENT
M$SMPRT    1473**DCL-ENT
M$SSC    1474**DCL-ENT
M$SSWITCH    1494**DCL-ENT
M$STATE    1503**DCL-ENT
M$STD    1475**DCL-ENT
M$STIMER    1489**DCL-ENT
M$STLPP    1472**DCL-ENT
M$STRAP    1489**DCL-ENT
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:525  
M$STRMATTR    1461**DCL-ENT
M$STRMCTL    1459**DCL-ENT
M$STRMTAB    1462**DCL-ENT
M$SYMBIO    1500**DCL-ENT
M$SYSCON    1486**DCL-ENT
M$SYSID    1504**DCL-ENT
M$TDCLOSE    1485**DCL-ENT
M$TDIO    1485**DCL-ENT
M$TDOPEN    1484**DCL-ENT
M$TDREQCPU    1485**DCL-ENT
M$TEMPWROC    1479**DCL-ENT
M$TRAP    1489**DCL-ENT
M$TRMISC    1464**DCL-ENT
M$TRMPRG    1460**DCL-ENT
M$TRTN    1493**DCL-ENT
M$TRUNC    1436**DCL-ENT
M$TTIMER    1489**DCL-ENT
M$UMPL    1476**DCL-ENT
M$UNFID    1498**DCL-ENT
M$UNLATCH    1455**DCL-ENT
M$UNSHARE    1452**DCL-ENT
M$USRFIELD    1495**DCL-ENT
M$VIRTUAL    1470**DCL-ENT
M$WEOF    1438**DCL-ENT
M$WRSYSLOG    1484**DCL-ENT
M$XCON    1490**DCL-ENT
M$XCONRTN    1451**DCL-ENT
M$XEQTIME    1503**DCL-ENT
M$XFLUSH    1444**DCL-ENT
M$XMOUSE    1481**DCL-ENT
M$XXX    1447**DCL-ENT
M$YC    1449**DCL-ENT
MSGBUF_   12819**DCL
RR IN PROCEDURE SEND_ONE_MAILGRAM  13903**DCL
SAVED_UNAME   12731**DCL
SCREECH4    9992**DCL
PL6.E3A0      #001=TCM$NETSEND File=TCM$SEND1.:TCA2TSI                           SUN 11/16/97 14:18 Page:526  
SITENAME   12724**DCL
SITE_INDEX IN PROCEDURE PARSE_MAIL_HEADER  14633**DCL
SITE_START IN PROCEDURE SELECT_DESTINATION_SITE  13781**DCL
TCM$NETSEND       8**PROC
TCM$READ_SMTP_NULLOK   12674**DCL-ENT
TEMP$ IN PROCEDURE PARSE_MAIL_HEADER  14635**DCL
TEXT_CHAR   12548**DCL
TRY_THIS_ONE IN PROCEDURE GET_MAIL_HEADER  13716**LABEL
VFC   12700**DCL
XUD$UTS_ADJ_25TH    7412**DCL-ENT
XUD$UTS_DIFF    7388**DCL-ENT
XUD$UTS_DIFF_25TH    7400**DCL-ENT
XUG$ALLMSG    7454**DCL-ENT
XUG$BLANK_PASSWORD    7457**DCL-ENT
XUG$BREAK    7447**DCL-ENT
XUG$CLRENABLE    7450**DCL-ENT
XUG$CORRES    7442**DCL-ENT
XUG$DISABLE    7448**DCL-ENT
XUG$ECHO    7440**DCL-ENT
XUG$ECHOLAST    7443**DCL-ENT
XUG$ENABLE    7449**DCL-ENT
XUG$ERRCNVRT    7459**DCL-ENT
XUG$ERRPTR    7438**DCL-ENT
XUG$ERRTOLCP6    7460**DCL-ENT
XUG$FINDDCB    7455**DCL-ENT
XUG$GETDCB    7456**DCL-ENT
XUG$HELP    7452**DCL-ENT
XUG$MOREMSG    7453**DCL-ENT
XUG$OPENOUT    7458**DCL-ENT
XUG$SETERRMSG    7445**DCL-ENT
XUG$SIMULATE_BREAK    7451**DCL-ENT
XUR$ERRMSG    7672**DCL-ENT

PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:527  
     2636        1        /*T***********************************************************/
     2637        2        /*T*                                                         */
     2638        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2639        4        /*T*                                                         */
     2640        5        /*T***********************************************************/
     2641        6        TCM$ABORT: PROC ASYNC;
     2642        7        %INCLUDE CP_6;
     2643       88            %B$TCB;
     2644       91            %FPT_ERRMSG( SOURCE=TRAP, BUF=BUF, STCLASS=CONSTANT);
     2645      118            %FPT_PRIV( FPTN=JIT_PRIV, STCLASS=SYMREF);
     2646      133            %FPT_SCREECH( FPTN=SCREECH4, STCLASS=SYMREF);
     2647      147        %INCLUDE B$JIT;
     2648      437        %INCLUDE CP_6_SUBS;
     2649      977
     2650      978    1       DCL TCM$WRITE_AUDIT_OFF ENTRY(2);
     2651      979
     2652      980    1       DCL B$TCB$ PTR SYMREF READONLY;
     2653      981    1       DCL B$JIT$ PTR SYMREF READONLY;
     2654      982
     2655      983    1       DCL IC CHAR(6) STATIC INIT( '000000');
     2656      984    1       DCL I SBIN;
     2657      985    1       DCL TEMP SBIN;
     2658      986    1       DCL TXT CHAR(120);
     2659      987    1       DCL BUF CHAR(120) STATIC;
     2660      988    1       DCL B$SBIN SBIN BASED;
     2661      989
     2662      990    1       TEMP = PINCRW( B$TCB$->B$TCB.STK$, 4)->B$SBIN;
     2663      991    1       TEMP = TEMP / 262144;
     2664      992    1       I = 5;
     2665      993    2       DO WHILE( TEMP > 0);
     2666      994    2           SUBSTR( IC, I, 1) = BINASC( ASCBIN( '0') + MOD( TEMP, 8));
     2667      995    2           TEMP = TEMP / 8;  I = I - 1;
     2668      996    2           END;
     2669      997    1       CALL M$ERRMSG( FPT_ERRMSG);
     2670      998    1       CALL CONCAT( TXT, '.', IC, ' ', SUBSTR( BUF, 1, 12));
     2671      999    1       CALL TCM$WRITE_AUDIT_OFF( 20, TXT);
     2672     1000    1       CALL M$SPRIV( JIT_PRIV);
PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:528  
     2673     1001    1       B$JIT.PRIV.ACTIVE.EXMM = %YES#;  /* so we can SNAP */
     2674     1002    1       CALL M$SCREECH( SCREECH4);  /* ..a SNAP, really */
     2675     1003    1       CALL M$EXIT;
     2676     1004
     2677     1005    1       END TCM$ABORT;

PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:529  
--  Include file information  --

   CP_6_SUBS.:LIBRARY  is referenced.
   B$JIT.:LIBRARY  cannot be made into a system file and is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure TCM$ABORT.

   Procedure TCM$ABORT requires 64 words for executable code.
   Procedure TCM$ABORT requires 38 words of local(AUTO) storage.

    No errors detected in file TCM$SEND1.:TCA2TSI    .

PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:530  

 Object Unit name= TCM$ABORT                                  File name= TCM$SEND1.:TCA2TOU
 UTS= NOV 16 '97 14:28:46.04 SUN                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS     26     32  TCM$ABORT
    2   Data  even  none    32     40  TCM$ABORT
    3   Proc  even  none    64    100  TCM$ABORT
    4  RoData even  none     3      3  TCM$ABORT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     3      0   yes            yes     Async       0  TCM$ABORT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       2 TCM$WRITE_AUDIT_OFF
                       nStd      0 X66_AAUTO
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AARET
PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:531  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  JIT_PRIV                              SCREECH4
r    B$TCB$                           r    B$JIT$                                B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:532  


     2636        1        /*T***********************************************************/
     2637        2        /*T*                                                         */
     2638        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2639        4        /*T*                                                         */
     2640        5        /*T***********************************************************/
     2641        6        TCM$ABORT: PROC ASYNC;

      6  3 000000   000000 700200 xent  TCM$ABORT    TSX0  ! X66_AAUTO
         3 000001   000046 000000                    ZERO    38,0

     2642        7        %INCLUDE CP_6;
     2643       88            %B$TCB;
     2644       91            %FPT_ERRMSG( SOURCE=TRAP, BUF=BUF, STCLASS=CONSTANT);
     2645      118            %FPT_PRIV( FPTN=JIT_PRIV, STCLASS=SYMREF);
     2646      133            %FPT_SCREECH( FPTN=SCREECH4, STCLASS=SYMREF);
     2647      147        %INCLUDE B$JIT;
     2648      437        %INCLUDE CP_6_SUBS;
     2649      977
     2650      978    1       DCL TCM$WRITE_AUDIT_OFF ENTRY(2);
     2651      979
     2652      980    1       DCL B$TCB$ PTR SYMREF READONLY;
     2653      981    1       DCL B$JIT$ PTR SYMREF READONLY;
     2654      982
     2655      983    1       DCL IC CHAR(6) STATIC INIT( '000000');
     2656      984    1       DCL I SBIN;
     2657      985    1       DCL TEMP SBIN;
     2658      986    1       DCL TXT CHAR(120);
     2659      987    1       DCL BUF CHAR(120) STATIC;
     2660      988    1       DCL B$SBIN SBIN BASED;
     2661      989
     2662      990    1       TEMP = PINCRW( B$TCB$->B$TCB.STK$, 4)->B$SBIN;

    990  3 000002   000000 470400 xsym               LDP0    B$TCB$
         3 000003   000001 471500                    LDP1    1,,PR0
         3 000004   100004 235100                    LDA     4,,PR1
         3 000005   200004 755100                    STA     TEMP,,AUTO
PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:533  

     2663      991    1       TEMP = TEMP / 262144;

    991  3 000006   200004 236100                    LDQ     TEMP,,AUTO
         3 000007   000001 506003                    DIV     1,DU
         3 000010   200004 756100                    STQ     TEMP,,AUTO

     2664      992    1       I = 5;

    992  3 000011   000005 235007                    LDA     5,DL
         3 000012   200003 755100                    STA     I,,AUTO

     2665      993    2       DO WHILE( TEMP > 0);

    993  3 000013   000000 116003                    CMPQ    0,DU
         3 000014   000037 604400 3                  TMOZ    s:997

     2666      994    2           SUBSTR( IC, I, 1) = BINASC( ASCBIN( '0') + MOD( TEMP, 8));

    994  3 000015   200004 236100                    LDQ     TEMP,,AUTO
         3 000016   000010 506007                    DIV     8,DL
         3 000017   000044 733000                    LRS     36
         3 000020   000060 036007                    ADLQ    48,DL
         3 000021   000033 736000                    QLS     27
         3 000022   000000 276000 4                  ORQ     0
         3 000023   200044 756100                    STQ     TXT+31,,AUTO
         3 000024   200003 235100                    LDA     I,,AUTO
         3 000025   040005 100500                    MLR     fill='040'O
         3 000026   200044 000004                    ADSC9   TXT+31,,AUTO             cn=0,n=4
         3 000027   000000 000001 2                  ADSC9   IC,A                     cn=0,n=1

     2667      995    2           TEMP = TEMP / 8;  I = I - 1;

    995  3 000030   200004 236100                    LDQ     TEMP,,AUTO
         3 000031   000010 506007                    DIV     8,DL
         3 000032   200004 756100                    STQ     TEMP,,AUTO

PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:534  
    995  3 000033   000001 336007                    LCQ     1,DL
         3 000034   200003 056100                    ASQ     I,,AUTO

     2668      996    2           END;

    996  3 000035   200004 235100                    LDA     TEMP,,AUTO
         3 000036   000015 605400 3                  TPNZ    s:994

     2669      997    1       CALL M$ERRMSG( FPT_ERRMSG);

    997  3 000037   000000 630400 1                  EPPR0   FPT_ERRMSG
         3 000040   020000 713400                    CLIMB   8192
         3 000041   405000 401760                    pmme    nvectors=11

     2670      998    1       CALL CONCAT( TXT, '.', IC, ' ', SUBSTR( BUF, 1, 12));

    998  3 000042   056000 236003                    LDQ     23552,DU
         3 000043   200005 756100                    STQ     TXT,,AUTO
         3 000044   040100 100400                    MLR     fill='040'O
         3 000045   000000 000006 2                  ADSC9   IC                       cn=0,n=6
         3 000046   200005 200006                    ADSC9   TXT,,AUTO                cn=1,n=6
         3 000047   000040 236007                    LDQ     32,DL
         3 000050   200006 552104                    STBQ    TXT+1,'04'O,AUTO
         3 000051   040100 100400                    MLR     fill='040'O
         3 000052   000002 200014 2                  ADSC9   BUF                      cn=1,n=12
         3 000053   200007 000160                    ADSC9   TXT+2,,AUTO              cn=0,n=112

     2671      999    1       CALL TCM$WRITE_AUDIT_OFF( 20, TXT);

    999  3 000054   200005 630500                    EPPR0   TXT,,AUTO
         3 000055   200045 450500                    STP0    TXT+32,,AUTO
         3 000056   000002 236000 4                  LDQ     2
         3 000057   200044 756100                    STQ     TXT+31,,AUTO
         3 000060   200044 630500                    EPPR0   TXT+31,,AUTO
         3 000061   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000062   000000 701000 xent               TSX1    TCM$WRITE_AUDIT_OFF
         3 000063   000000 011000                    NOP     0
PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:535  

     2672     1000    1       CALL M$SPRIV( JIT_PRIV);

   1000  3 000064   000000 630400 xsym               EPPR0   JIT_PRIV
         3 000065   020012 713400                    CLIMB   8202
         3 000066   400000 401760                    pmme    nvectors=1

     2673     1001    1       B$JIT.PRIV.ACTIVE.EXMM = %YES#;  /* so we can SNAP */

   1001  3 000067   000000 470400 xsym               LDP0    B$JIT$
         3 000070   000002 236007                    LDQ     2,DL
         3 000071   000013 256100                    ORSQ    11,,PR0

     2674     1002    1       CALL M$SCREECH( SCREECH4);  /* ..a SNAP, really */

   1002  3 000072   000000 630400 xsym               EPPR0   SCREECH4
         3 000073   000013 713400                    CLIMB   11
         3 000074   401000 401760                    pmme    nvectors=3

     2675     1003    1       CALL M$EXIT;

   1003  3 000075   000001 713400                    CLIMB   exit
         3 000076   000000 401760                    pmme    nvectors=0

     2676     1004
     2677     1005    1       END TCM$ABORT;

   1005  3 000077   000000 702200 xent               TSX2  ! X66_AARET

FPT_ERRMSG
 Sect OctLoc
   1     000   000003 777640   000026 006000   000000 177640   000000 006014    ................
   1     004   000035 777640   000002 006000   000000 177640   000000 006014    ................
   1     010   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     024*  000000 177640   000000 006014   000000 000000   000000 000000    ................
   1     030   375000 070001   040000 000000                                    ..8. ...

PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:536  
IC
 Sect OctLoc
   2     000   060060 060060   060060 ******                                    000000..

BUF
 Sect OctLoc
   2     002   ****** ******   ****** ******   ****** ******   ****** ******    ................

(unnamed)
 Sect OctLoc
   4     000   000040 040040   000000 000024   000001 006000                    .   ........

PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:537  
--  Include file information  --

   CP_6_SUBS.:LIBRARY  is referenced.
   B$JIT.:LIBRARY  cannot be made into a system file and is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure TCM$ABORT.
PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:538  

 **** Variables and constants ****

  ****  Section 001 RoData TCM$ABORT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(936)   r     1 FPT_ERRMSG

  ****  Section 002  Data  TCM$ABORT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     2-0-0/c CHAR(120)   r     1 BUF                        0-0-0/c CHAR(6)     r     1 IC

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w SBIN        r     1 I                          4-0-0/w SBIN        r     1 TEMP
     5-0-0/c CHAR(120)   r     1 TXT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$TCB$
     0-0-0/d STRC(144)   r     1 JIT_PRIV                   0-0-0/d STRC(216)   r     1 SCREECH4

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:539  
     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w SBIN        r     1 B$SBIN
     0-0-0/w STRC(144)   r     1 B$TCB


   Procedure TCM$ABORT requires 64 words for executable code.
   Procedure TCM$ABORT requires 38 words of local(AUTO) storage.

    No errors detected in file TCM$SEND1.:TCA2TSI    .
PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:540  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:541  
          MINI XREF LISTING

B$JIT.CPFLAGS1.SLEAZE
       255**DCL       255--REDEF
B$JIT.ERR.MID
       162**DCL       162--REDEF
B$JIT.JRESPEAK
       323**DCL       324--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
       432**DCL       432--REDEF     433--REDEF
B$JIT.PNR
       336**DCL       336--REDEF
B$JIT.PRIV.ACTIVE.EXMM
       166**DCL      1001<<ASSIGN
B$JIT.TSLINE
       430**DCL       431--REDEF
B$JIT$
       981**DCL       156--IMP-PTR  1001>>ASSIGN
B$SBIN
       988**DCL       990>>ASSIGN
B$TCB.STK$
        89**DCL       990>>ASSIGN
B$TCB$
       980**DCL       990>>ASSIGN
BUF
       987**DCL       103--DCLINIT   998>>CALLBLT
FPT_ERRMSG
       102**DCL       997<>CALL
FPT_ERRMSG.V
       106**DCL       102--DCLINIT
I
       984**DCL       992<<ASSIGN    994>>ASSIGN    995<<ASSIGN    995>>ASSIGN
IC
       983**DCL       994<<ASSIGN    998>>CALLBLT
PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:542  
JIT_PRIV
       129**DCL      1000<>CALL
M$ERRMSG
        79**DCL-ENT   997--CALL
M$EXIT
        28**DCL-ENT  1003--CALL
M$SCREECH
        30**DCL-ENT  1002--CALL
M$SPRIV
        75**DCL-ENT  1000--CALL
SCREECH4
       144**DCL      1002<>CALL
TCM$WRITE_AUDIT_OFF
       978**DCL-ENT   999--CALL
TEMP
       985**DCL       990<<ASSIGN    991<<ASSIGN    991>>ASSIGN    993>>DOWHILE   994>>ASSIGN    995<<ASSIGN
       995>>ASSIGN
TXT
       986**DCL       998<<CALLBLT   999<>CALL
PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:543  
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:544  
              MINI UREF LISTING

M$ACCT      33**DCL-ENT
M$ACTIVATE      36**DCL-ENT
M$ALIB      29**DCL-ENT
M$ASUSER      31**DCL-ENT
M$ATTACH      38**DCL-ENT
M$BADPP      56**DCL-ENT
M$CGCTL      37**DCL-ENT
M$CGINFO      37**DCL-ENT
M$CHECK      18**DCL-ENT
M$CHGUNIT      76**DCL-ENT
M$CLOSE      16**DCL-ENT
M$CLRSTK      74**DCL-ENT
M$CMDVAR      85**DCL-ENT
M$CONFIG      46**DCL-ENT
M$CORRES      21**DCL-ENT
M$CPEXIT      30**DCL-ENT
M$CVM      54**DCL-ENT
M$CVOL      19**DCL-ENT
M$DCLFLD      46**DCL-ENT
M$DEACTIVATE      36**DCL-ENT
M$DELREC      18**DCL-ENT
M$DEQ      83**DCL-ENT
M$DETACH      38**DCL-ENT
M$DEVICE      20**DCL-ENT
M$DISPLAY      83**DCL-ENT
M$DISPRES      23**DCL-ENT
M$DLIB      29**DCL-ENT
M$DRIBBLE      46**DCL-ENT
M$DRTN      74**DCL-ENT
M$DSUSER      31**DCL-ENT
M$ENQ      82**DCL-ENT
M$EOM      41**DCL-ENT
PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:545  
M$ERASE      47**DCL-ENT
M$ERR      28**DCL-ENT
M$EVENT      71**DCL-ENT
M$EXHUME      80**DCL-ENT
M$EXTEND      20**DCL-ENT
M$FDP      52**DCL-ENT
M$FDS      51**DCL-ENT
M$FEBOOT      44**DCL-ENT
M$FECTL      45**DCL-ENT
M$FEDUMP      44**DCL-ENT
M$FID      79**DCL-ENT
M$FINDPROC      33**DCL-ENT
M$FSUSER      31**DCL-ENT
M$FVP      53**DCL-ENT
M$FWCG      37**DCL-ENT
M$GBPL      57**DCL-ENT
M$GDDL      53**DCL-ENT
M$GDP      52**DCL-ENT
M$GDS      51**DCL-ENT
M$GETDCB      22**DCL-ENT
M$GETMOUSE      62**DCL-ENT
M$GETPM      63**DCL-ENT
M$GJOB      81**DCL-ENT
M$GLINEATTR      41**DCL-ENT
M$GOODPP      56**DCL-ENT
M$GPLATEN      49**DCL-ENT
M$GPROMPT      48**DCL-ENT
M$GTRMATTR      42**DCL-ENT
M$GTRMCTL      40**DCL-ENT
M$GTRMTAB      43**DCL-ENT
M$GVP      52**DCL-ENT
M$HELP      79**DCL-ENT
M$INT      71**DCL-ENT
M$INTRTN      32**DCL-ENT
M$IOQ      67**DCL-ENT
M$JOBSTATS      81**DCL-ENT
PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:546  
M$KEYIN      21**DCL-ENT
M$LDEV      16**DCL-ENT
M$LDTRC      29**DCL-ENT
M$LIMIT      22**DCL-ENT
M$LINES      21**DCL-ENT
M$LINK      28**DCL-ENT
M$MADMUCK      24**DCL-ENT
M$MAKUSER      55**DCL-ENT
M$MBS      23**DCL-ENT
M$MDFFLD      47**DCL-ENT
M$MERC      72**DCL-ENT
M$MERCS      73**DCL-ENT
M$MIRROR      67**DCL-ENT
M$MONINFO      84**DCL-ENT
M$MPL      57**DCL-ENT
M$NODEINFO      48**DCL-ENT
M$NXTUSR      82**DCL-ENT
M$OCMSG      80**DCL-ENT
M$OLAY      28**DCL-ENT
M$OPEN      16**DCL-ENT
M$PAS      57**DCL-ENT
M$PATHCON      80**DCL-ENT
M$PDS      51**DCL-ENT
M$PFIL      18**DCL-ENT
M$PLATEN      42**DCL-ENT
M$PRECORD      20**DCL-ENT
M$PROCNAME      33**DCL-ENT
M$PROFILE      44**DCL-ENT
M$PROMPT      40**DCL-ENT
M$RACST      24**DCL-ENT
M$RDSYSLOG      65**DCL-ENT
M$READ      17**DCL-ENT
M$RELDCB      22**DCL-ENT
M$RELRES      23**DCL-ENT
M$RELSTARF      25**DCL-ENT
M$REM      25**DCL-ENT
PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:547  
M$RENV      72**DCL-ENT
M$REQUIRE      24**DCL-ENT
M$RETRY      73**DCL-ENT
M$RETRYS      73**DCL-ENT
M$REW      19**DCL-ENT
M$RLSFLD      47**DCL-ENT
M$RPRIV      75**DCL-ENT
M$RSPP      54**DCL-ENT
M$RSWITCH      76**DCL-ENT
M$RUE      82**DCL-ENT
M$SAD      55**DCL-ENT
M$SAVE      31**DCL-ENT
M$SCON      32**DCL-ENT
M$SENV      72**DCL-ENT
M$SETFMA      16**DCL-ENT
M$SETFP      45**DCL-ENT
M$SINPUT      43**DCL-ENT
M$SLCFLD      48**DCL-ENT
M$SMOUSE      62**DCL-ENT
M$SMPRT      54**DCL-ENT
M$SSC      55**DCL-ENT
M$SSWITCH      75**DCL-ENT
M$STATE      84**DCL-ENT
M$STD      56**DCL-ENT
M$STIMER      70**DCL-ENT
M$STLPP      53**DCL-ENT
M$STRAP      70**DCL-ENT
M$STRMATTR      42**DCL-ENT
M$STRMCTL      40**DCL-ENT
M$STRMTAB      43**DCL-ENT
M$SYMBIO      81**DCL-ENT
M$SYSCON      67**DCL-ENT
M$SYSID      85**DCL-ENT
M$TDCLOSE      66**DCL-ENT
M$TDIO      66**DCL-ENT
M$TDOPEN      65**DCL-ENT
PL6.E3A0      #002=TCM$ABORT File=TCM$SEND1.:TCA2TSI                             SUN 11/16/97 14:28 Page:548  
M$TDREQCPU      66**DCL-ENT
M$TEMPWROC      60**DCL-ENT
M$TIME      83**DCL-ENT
M$TRAP      70**DCL-ENT
M$TRMISC      45**DCL-ENT
M$TRMPRG      41**DCL-ENT
M$TRTN      74**DCL-ENT
M$TRUNC      17**DCL-ENT
M$TTIMER      70**DCL-ENT
M$UC      40**DCL
M$UMPL      57**DCL-ENT
M$UNFID      79**DCL-ENT
M$UNLATCH      36**DCL-ENT
M$UNSHARE      33**DCL-ENT
M$USRFIELD      76**DCL-ENT
M$VIRTUAL      51**DCL-ENT
M$WAIT      74**DCL-ENT
M$WEOF      19**DCL-ENT
M$WRITE      17**DCL-ENT
M$WRSYSLOG      65**DCL-ENT
M$XCON      71**DCL-ENT
M$XCONRTN      32**DCL-ENT
M$XEQTIME      84**DCL-ENT
M$XFLUSH      25**DCL-ENT
M$XMOUSE      62**DCL-ENT
M$XXX      28**DCL-ENT
M$YC      30**DCL-ENT
TCM$ABORT       6**PROC
