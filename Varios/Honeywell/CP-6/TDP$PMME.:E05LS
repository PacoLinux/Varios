VERSION E05

PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:1    
        1        1        /*M* T & D PMME HANDLERS */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* */
        8        8        /*D*  NAME:   TDP$PMME
        9        9              CALL:   CALL TDP$PMME(CODE);
       10       10                          CODE is the PMME code.
       11       11              ENVIRONMENT:  Privleged master mode.
       12       12              DESCRIPTION:  A DO CASE statement selects which T & D
       13       13                            PMME is to be processed.
       14       14                                                                           */
       15       15        TDP$PMME: PROC(CODE);
       16       16        /**/
       17       17        /* PARAMETERS */
       18       18        /**/
       19       19    1   DCL CODE SBIN;
       20       20        /**/
       21       21        /* EXTERNAL PROCEDURES */
       22       22        /**/
       23       23    1   DCL TDM$MIRROR ENTRY ;
       24       24    1   DCL TDP$OPEN ENTRY;
       25       25    1   DCL TDP$CLOSE ENTRY;
       26       26    1   DCL TDP$TDIO ENTRY;
       27       27    1   DCL TDP$SYSCON ENTRY(3) ALTRET;
       28       28    1   DCL NIE$PMME ENTRY;
       29       29    1   DCL ELA$SYSLOG ENTRY(6) ALTRET;
       30       30    1   DCL MME$CVM ENTRY(4) ALTRET;
       31       31    1   DCL MMD$RSPP ENTRY(2) ALTRET;
       32       32    1   DCL UDB$PMMEXIT ENTRY(0);
       33       33    1   DCL HFF$DSIZ ENTRY(2);
       34       34    1   DCL SSS$CACHE ENTRY;
       35       35    1   DCL SSS$CACHEBP ENTRY;
       36       36        /**/
       37       37        /* MISCELLANEOUS DATA */
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:2    
       38       38        /**/
       39       39    1   DCL B$JIT$ PTR SYMREF;
       40       40        %INCLUDE B$JIT_C;
       41      354        %B$JIT0;
       42      443        %U$JIT1X;
       43      446        %M$JIT2X;
       44      449        %F$JIT3X;
       45      452        %S$JIT4;
       46      458        %J$JIT5X;
       47      461        %A$JIT6X;
       48      464    1   DCL B$PS0$ PTR SYMREF;
       49      465    1   DCL B$PS1$ PTR SYMREF;
       50      466        %INCLUDE B_ERRORS_C;
       51     1593    1   DCL DSIZ UBIN WORD;
       52     1594        /**/
       53     1595        /* M$RDSYSLOG DATA */
       54     1596        /**/
       55     1597        %INCLUDE EL_DATA_R;
       56     1606    1   DCL CVMPG UBIN(36);
       57     1607        %INCLUDE EL$TABLES;
       58     1930    1   DCL BUF$ PTR;
       59     1931        %EL$BUF(NAME=BUF,STCLASS="BASED(BUF$)");
       60     1934    1   DCL B$WINDOW$ PTR SYMREF;
       61     1935        %INCLUDE B_STRINGS_C;
       62     2064        %INCLUDE M_INFO_C;
       63     2204        %INCLUDE HF_LOCK_C;
       64     2218    1   DCL ERR UBIN(36);
       65     2219        /**/
       66     2220        /* M$WRSYSLOG DATA */
       67     2221        %INCLUDE EL_DATA_C;
       68     2233        %INCLUDE TD$CP6V_C;
       69     2269        %FPT$WRSYSLOG_V (FPTN=WRFPT);
       70     2272        /* M$TDREQCPU DATA */
       71     2273        %INCLUDE SS_SCHED_R;                    /* CPU REFERENCES                     */
       72     2316    1   DCL S_CUN UBIN SYMREF;
       73     2317        %INCLUDE B$USER;                        /* USER TABLES (B$U.CPU)              */
       74     2533        %B$USERREFS;
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:3    
       75     2537    1   DCL   CPU# SBIN;
       76     2538        %FPT$TDREQCPU_V;
       77     2542        /**/
       78     2543                   %FPT$SYSCON_V;
       79     2547    1   DCL SYSCON_RESULT BIT(72) ALIGNED;
       80     2548    1   DCL VLR_SYSCON BIT(72) ALIGNED BASED;
       81     2549    1   DCL 1 ERROR,
       82     2550    1         2 FCG BIT(18),
       83     2551    1         2 MON BIT(1),
       84     2552    1         2 CODE UBIN(14) UNAL,
       85     2553    1         2 SEV UBIN(3) UNAL;
       86     2554        %EJECT;
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:4    
       87     2555    2           DO CASE(CODE);
       88     2556    2            CASE(0);                       /* M$RDSYSLOG                         */
       89     2557        /*D*  NAME:   M$RDSYSLOG
       90     2558              CALL:   CALL TDP$PMME(0);
       91     2559              DESCRIPTION:    The first buffer in the error loggers buffer
       92     2560                              chain is moved to the buffer specified in the
       93     2561                              M$RDSYSLOG fpt. If the buffer moved is the
       94     2562                              second buffer in the page, the stolen page is
       95     2563                              returned to the system.
       96     2564                                                                           */
       97     2565    2              CALL SSS$CACHEBP;
       98     2566    3              IF EL_FIRSTBUF=0 THEN DO;
       99     2567    3                 EL_ERRCT=0;
      100     2568    3                 CALL SSS$CACHE;
      101     2569    3                 CALL BADRET(%E$NOBUFS,0);
      102     2570    3                 END;
      103     2571        /*E*  ERROR:  TDP-E$NOBUFS-0
      104     2572              DESCRIPTION:  There are no error log buffers to pass.
      105     2573              MESSAGE: NO ERROR LOG BUFFERS TO BE READ.
      106     2574                                                                           */
      107     2575                   %LOCK (G#=EL_BUSY);
      108     2578    2              CVMPG=EL_FIRSTBUF;
      109     2579    2              CALL SSS$CACHE;
      110     2580    2              CALL MME$CVM(%MONWSQ,%WINDOWHI,CVMPG,ERR) ALTRET(BADCVM);
      111     2581    2              BUF$=PINCRW(B$WINDOW$,(%WINDOWHI-%WINDOWLO)*1024);
      112     2582    2              CALL SSS$CACHEBP;
      113     2583    3              IF BUF.COUNT=0 & EL_FIRSTBUF=EL_CURBUF THEN DO;
      114     2584    3                 CALL SSS$CACHE;
      115     2585    3                 CALL MME$CVM(%MONWSQ,%WINDOWHI,-1,ERR) ALTRET(BADCVM);
      116     2586    3                 CALL SSS$CACHEBP;
      117     2587    3                 EL_ERRCT=0;
      118     2588    3                 CALL SSS$CACHE;
      119     2589                      %UNLOCK (G#=EL_BUSY);
      120     2592    3                 CALL BADRET(%E$NOBUFS,0);
      121     2593    3                 END;
      122     2594    2              CALL SSS$CACHE;
      123     2595    2              CALL HFF$DSIZ (0,DSIZ);
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:5    
      124     2596    3              IF DSIZ < 4096 THEN DO;
      125     2597                      %UNLOCK (G#=EL_BUSY);
      126     2600    3                 CALL BADRET (%E$BUF2SMALL,4);
      127     2601    3                 END;
      128     2602        /*E*  ERROR:  TDP-E$BUF2SMALL-0
      129     2603              DESCRIPTION:  The buffer specified in the M$RDSYSLOG fpt is
      130     2604                            smaller than 512 words.
      131     2605              MESSAGE: M$RDSYSLOG BUFFER LESS THAN 512 WORDS.
      132     2606                                                                           */
      133     2607    2              B$PS0$->BUF=BUF$->BUF;
      134     2608    2              CALL SSS$CACHEBP;
      135     2609    2              IF EL_FIRSTBUF=EL_CURBUF THEN
      136     2610    2                 EL_CURBUF=BUF.NXTBUF;
      137     2611    3              ELSE DO INHIBIT;
      138     2612    3                 EL_FULLBUFS=EL_FULLBUFS-1;
      139     2613    3                 END /* INHIBIT */;
      140     2614    2              EL_FIRSTBUF=BUF.NXTBUF;
      141     2615    2              CALL SSS$CACHE;
      142     2616    2              CALL MME$CVM(%MONWSQ,%WINDOWHI,-1,ERR) ALTRET(BADCVM);
      143     2617    2              CALL MMD$RSPP(CVMPG,%MONWSQ);
      144     2618    2              CALL SSS$CACHEBP;
      145     2619    3              DO INHIBIT;
      146     2620    3                 EL_NUMPGS=EL_NUMPGS-1;
      147     2621    3                 END;                      /* INHIBIT                            */
      148     2622    2              CALL SSS$CACHE;
      149     2623                   %UNLOCK (G#=EL_BUSY);
      150     2626    2              RETURN;
      151     2627    2   BADCVM:    ;
      152     2628                   %UNLOCK (G#=EL_BUSY);
      153     2631    2              CALL BADRET(ERR,4);
      154     2632        /**/
      155     2633        /* M$WRSYSLOG */
      156     2634        /**/
      157     2635    2            CASE(1);                       /* M$WRSYSLOG                         */
      158     2636        /*D*  NAME:   M$WRSYSLOG
      159     2637              CALL:   CALL TDP$PMME(1);
      160     2638              DESCRIPTION:    If the size of the entry to be made is not
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:6    
      161     2639                              greater than the maximum error log entry size
      162     2640                              a call is made to ELA$ERRLOG with the parameters
      163     2641                              specified in the fpt.
      164     2642                                                                           */
      165     2643    2              CALL HFF$DSIZ (1,DSIZ);
      166     2644    3              IF B$PS0$->WRFPT.SIZE*4 > DSIZ THEN DO;
      167     2645    3                 ERR=%E$INFO2SMALL;
      168     2646        /*E*    ERROR:      TDP-E$INFO2SMALL
      169     2647                MESSAGE: The buffer area passed is smaller than the size of the entry.
      170     2648                MESSAGE1: The area framed by the ENTRY vector of the M$WRSYSLOG
      171     2649                          fpt must be at least as big as the value specified
      172     2650                          for SIZE.
      173     2651        */
      174     2652    3                 GOTO WRALT;
      175     2653    3                 END;
      176     2654    2              CALL ELA$SYSLOG(B$PS0$->WRFPT.TYPE,B$PS1$->WRFPT,B$PS0$->WRFPT.SIZE,
      177     2655    2                B$PS0$->WRFPT.MMINHIB,B$PS0$->WRFPT.FILENUM,ERR) ALTRET(WRALT);
      178     2656    2              RETURN;
      179     2657
      180     2658    2   WRALT:     B$JIT.ERR='240420400004'O;
      181     2659    2              B$JIT.ERR.CODE=ERR;
      182     2660    2              RETURN;
      183     2661        /*E*    ERROR:      TDP-E$NTRY2BIG
      184     2662                MESSAGE: System log entries may not exceed 1000 words.
      185     2663        */
      186     2664        /*E*    ERROR:      TDP-E$SLBUSY
      187     2665                MESSAGE: System log is busy.  Try again later.
      188     2666        */
      189     2667        /*E*    ERROR:      TDP-E$NEEDPAGE
      190     2668                MESSAGE: System log needs a buffer page and can't get it
      191     2669                            right now.
      192     2670        */
      193     2671        /*E*    ERROR:      TDP-E$SLFILE
      194     2672                MESSAGE: System log file number may not exceed 99.
      195     2673        */
      196     2674    2            CASE(2);                       /* M$TDOPEN                           */
      197     2675    2              CALL TDP$OPEN;
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:7    
      198     2676    2            CASE(3);                       /* M$TDCLOSE                          */
      199     2677    2              CALL TDP$CLOSE;
      200     2678    2            CASE(4);                       /* M$TDIO                             */
      201     2679    2              CALL TDP$TDIO;
      202     2680    2            CASE(5);                       /* M$TDREQCPU                         */
      203     2681    3              DO CASE(B$PS0$->FPT$TDREQCPU_V.MODE);
      204     2682    3               CASE(2);                    /* MODE=NORMAL                        */
      205     2683    3                 IF S_TDCPUF ~= S_CUN
      206     2684    4                 THEN DO;
      207     2685    4                    S$CU$->B$U.CPU = 0;    /* FOR NONTDJASSIGN                   */
      208     2686    4                    RETURN;
      209     2687    4                    END;
      210     2688    3                 S_TDCPUF=0;
      211     2689    3                 S_TDCPU#=0;
      212     2690    3                 GOTO RESET;               /* RESET DIAG MODE USER               */
      213     2691    3               CASE(1);                    /* MODE=DIAG                          */
      214     2692    3                 IF B$PS0$->FPT$TDREQCPU_V.XEQ = 3
      215     2693    3                   AND B$PS0$->FPT$TDREQCPU_V.CPU = 511
      216     2694    4                 THEN DO;                  /* NONTDJASSIGN REQUEST FOR CPU TYPE  */
      217     2695    5                    DO CPU# = S_NSCPU DOWNTO 0;
      218     2696    5                       IF B$PS0$->FPT$TDREQCPU_V.TYPE = S_PTYPE(CPU#)
      219     2697    5                         AND S_MPSTATE(CPU#) = 2 AND S_STOP(CPU#) ~= 1
      220     2698    5                       THEN GOTO TDREQCPU_SET;
      221     2699    5                       END;
      222     2700    4                    CALL BADRET(%E$NOCPU,4);
      223     2701    4                    END;
      224     2702    3                 CALL PROC#;               /* GET CPU #                          */
      225     2703    3                 IF S_MPSTATE(CPU#) ~= 2 OR S_STOP(CPU#) = 1
      226     2704    3                 THEN CALL BADRET(%E$CPUSTOPPED,4);
      227     2705    3                 IF B$PS0$->FPT$TDREQCPU_V.XEQ = 3
      228     2706    3                 THEN GOTO TDREQCPU_SET;   /* NONTDJASSIGN REQUEST FOR CPU PORT  */
      229     2707    4                 ELSE DO;
      230     2708    4                    IF S_TDCPUF ~= 0
      231     2709    5                    THEN DO;
      232     2710    5                       IF S_TDCPUF ~= S_CUN OR S_TDCPU# ~= CPU#
      233     2711    5                       THEN CALL BADRET(%E$CPUDIAGERR,4);
      234     2712    5                       END;
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:8    
      235     2713    4                    S_TDCPUF = S_CUN;
      236     2714    4                    S_TDCPU# = CPU#;
      237     2715    4                    END;
      238     2716    3               END;                        /* END MODE CASES                     */
      239     2717        /*                                                                    */
      240     2718    2              IF B$PS0$->FPT$TDREQCPU_V.XEQ >= 1
      241     2719    3              THEN DO;
      242     2720    3                 IF S_TDCPUF ~= S_CUN
      243     2721    3                 THEN CALL BADRET(%E$CPUASSIGNERR,4);
      244     2722    3                 CALL PROC#;
      245     2723    3                 IF S_TDCPU# ~= CPU#
      246     2724    3                 THEN CALL BADRET(%E$CPUASSIGNERR,4);
      247     2725    3                 IF B$PS0$->FPT$TDREQCPU_V.XEQ = 2
      248     2726    3                 THEN S_TDCPUJ = S_CUN;    /* FOR REMAINDER OF JOB               */
      249     2727    3   TDREQCPU_SET:
      250     2728    3                 S$CU$->B$U.CPU = CPU#+1;
      251     2729    3                 B$JIT.IDELTAT = 0;        /* QUANTUM END USER TO GET ON CPU#    */
      252     2730    3                 RETURN;
      253     2731    3                 END;
      254     2732    3              ELSE DO;
      255     2733    3   RESET:        S$CU$->B$U.CPU=0;
      256     2734    3                 S_TDCPUJ=0;
      257     2735    3                 END;
      258     2736        /**/
      259     2737        /* M$IOQ */
      260     2738        /**/
      261     2739    2            CASE(6);
      262     2740    2              CALL NIE$PMME;
      263     2741    2            CASE(7);                       /* M$SYSCON                           */
      264     2742    2              CALL TDP$SYSCON(B$PS0$->FPT$SYSCON_V,SYSCON_RESULT,ERROR) ALTRET(
              2742                       SYSCON_ALT);
      265     2743    2              CALL HFF$DSIZ(1,ERR);
      266     2744    2              IF ERR>=8 THEN B$PS1$->VLR_SYSCON=SYSCON_RESULT;
      267     2745    2            CASE(8);
      268     2746    2              CALL TDM$MIRROR ;
      269     2747    2            END /* CASE CODE */;
      270     2748    1           RETURN;
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:9    
      271     2749    1   SYSCON_ALT: ;
      272     2750    1           IF ERROR.FCG='0'B THEN CALL BADRET(ERROR,4);
      273     2751    1           B$JIT.ERR=ERROR;
      274     2752    1           CALL UDB$PMMEXIT;
      275     2753        /*E*    ERROR:      TDP-E$PRTBSY
      276     2754                MESSAGE: Device in use.  Will be partitioned when released.
      277     2755        */
      278     2756        /*E*    ERROR:      TDP-E$UPNLDT
      279     2757                MESSAGE: Cannot return that device because there are no LDCTs available
      280     2758        */
      281     2759        /*                                                                   */
      282     2760    1   PROC#:  PROC;
      283     2761    3           DO CPU# = 0 TO S_NSCPU;         /*  SEARCH PORT # TABLE FOR PROC      */
      284     2762    3              IF B$PS0$->FPT$TDREQCPU_V.CPU = S_PORTNR(CPU#) THEN RETURN;
      285     2763    3              END;
      286     2764    2           CALL BADRET(%E$NOCPU,4);
      287     2765    2   END PROC#;
      288     2766        /*E*      ERROR: TDP-E$NOCPU-0
      289     2767                  MESSAGE: Designated CPU is unavailable
      290     2768                  DESCRIPTION: THE SPECIFIED CPU IS NOT CONFIGURED IN THE SYSTEM */
      291     2769        /*E*      ERROR: TDP-E$CPUSTOPPED-0
      292     2770                  MESSAGE: Designated CPU not running
      293     2771                  DESCRIPTION: THE SPECIFIED CPU IS PRESENT BUT IS NOT RUNNING. */
      294     2772        /*E*      ERROR: TDP-E$CPURUNNING-0
      295     2773                  MESSAGE: Designated CPU is running
      296     2774                  DESCRIPTION: THE SPECIFIED CPU IS PRESENT BUT IS RUNNING. */
      297     2775        /*E*      ERROR: TDP-E$CPUMASTER-0
      298     2776                  MESSAGE: Designated CPU is the MASTER
      299     2777                  DESCRIPTION: THE MASTER CPU MAY NOT BE  RELEASED. */
      300     2778        /*E*      ERROR: TDP-E$SCUNOTVALID-0
      301     2779                  MESSAGE: Designated SCU may not be released
      302     2780                  DESCRIPTION: LOW MEMORY MAY NOT BE  RELEASED. */
      303     2781        /*E*      ERROR: TDP-E$SCUPAGESINUSE-0
      304     2782                  MESSAGE: Pages in Designated SCU are in use; SCU not released
      305     2783                  DESCRIPTION: A DIE IS REQUIRE TO RELEASE SCU. */
      306     2784        /*E*      ERROR: TDP-E$SCUCMDNOTVALID-0
      307     2785                  MESSAGE: SCU option is only supported on the DPS 8000
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:10   
      308     2786                  DESCRIPTION: Use PART/RET PAGE to release or return memory */
      309     2787        /*E*      ERROR: TDP-E$SCUNOTRETURNED-0
      310     2788                  MESSAGE: Designated SCU was not returned
      311     2789                  DESCRIPTION: DPS8000 must be split, STATE SCU command failed*/
      312     2790        /*E*      ERROR: TDP-E$SCUNOTCONFIG-0
      313     2791                  MESSAGE: Designated SCU is not configured
      314     2792            DESCRIPTION: Operating system was not booted with half released configuration */
      315     2793        /*E*      ERROR: TDP-E$CPUNOTRETURNED-0
      316     2794                  MESSAGE: Designated CPU was not returned
      317     2795                  DESCRIPTION: DPS8000 must be split, STATE CPU command failed*/
      318     2796        /*E*      ERROR: TDP-E$IOMNOTRETURNED-0
      319     2797                  MESSAGE: Designated IOM was not returned
      320     2798                  DESCRIPTION: DPS8000 must be split, STATE command failed*/
      321     2799        /*E*      ERROR: TDP-E$IOMNOTRELEASED-0
      322     2800                  MESSAGE: Designated IOM was not released
      323     2801                  DESCRIPTION: DPS8000 must be split, STATE command failed*/
      324     2802        /*E*      ERROR: TDP-E$CPUNOTRELEASED-0
      325     2803                  MESSAGE: Designated CPU was not released
      326     2804                  DESCRIPTION: DPS8000 must be split, STATE CPU command failed*/
      327     2805        /*E*      ERROR: TDP-E$SCUNOTRELEASED-0
      328     2806                  MESSAGE: Designated SCU was not released
      329     2807                  DESCRIPTION: DPS8000 must be split, STATE SCU command failed*/
      330     2808        /*E*      ERROR: TDP-E$CPUDIAGERR-0
      331     2809                  MESSAGE: Another user or CPU is in diagnostic mode;                 */
      332     2810        /*E*      ERROR: TDP-E$CPUASSIGNERR-0
      333     2811                  MESSAGE: Requested CPU not in diagnostic mode               */
      334     2812    1   BADRET: PROC(ERRCODE,SEVERITY);
      335     2813    2   DCL ERRCODE UBIN(36);
      336     2814    2   DCL SEVERITY UBIN(36);
      337     2815    2           B$JIT$->B$JIT.ERR='240420000000'O;
      338     2816    2           B$JIT$->B$JIT.ERR.CODE=ERRCODE;
      339     2817    2           B$JIT$->B$JIT.ERR.SEV=SEVERITY;
      340     2818    2           CALL UDB$PMMEXIT;
      341     2819    2   END BADRET;
      342     2820    1   END TDP$PMME;
      343     2821        %EOD;

PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:11   
--  Include file information  --

   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   SS_CNTRLD_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_CNTRL_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_R.:E05TOU  cannot be made into a system file and is referenced.
   TD$CP6V_C.:E05TOU  is referenced.
   EL_DATA_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   M_INFO_C.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   EL$TABLES.:E05TOU  is referenced.
   EL_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure TDP$PMME.

   Procedure TDP$PMME requires 481 words for executable code.
   Procedure TDP$PMME requires 24 words of local(AUTO) storage.

PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:12   

 Object Unit name= TDP$PMME                                   File name= TDP$PMME.:E05TOU
 UTS= JUL 30 '97 06:03:20.72 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      2      2  TDP$PMME
    1   Proc  even  none   481    741  TDP$PMME
    2  RoData even  none    19     23  TDP$PMME

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  TDP$PMME
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:13   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 SSS$CACHEBP
         yes           Std       1 HFC$UNLOCK
         yes           Std       0 TDM$MIRROR
         yes           Std       0 SSS$CACHE
         yes           Std       1 HFC$LOCK
 yes     yes           Std       4 MME$CVM
         yes           Std       2 HFF$DSIZ
         yes           Std       0 NIE$PMME
 yes     yes           Std       2 MMD$RSPP
 yes     yes           Std       6 ELA$SYSLOG
         yes           Std       0 TDP$CLOSE
         yes           Std       0 TDP$OPEN
         yes           Std       0 TDP$TDIO
         yes           Std       0 UDB$PMMEXIT
 yes     yes           Std       3 TDP$SYSCON
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$JIT$                                B$PS0$                                B$PS1$
     EL_BUSY                               EL_NUMPGS                             EL_FULLBUFS
     EL_FIRSTBUF                           EL_CURBUF                             EL_ERRCT
     B$WINDOW$                             S_PORTNR                              S_MPSTATE
     S_STOP                                S_PTYPE                               S_NSCPU
     S_TDCPUF                              S_TDCPU#                              S_TDCPUJ
     S_CUN                                 S$CU$                                 B_VECTNIL
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:14   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:15   


        1        1        /*M* T & D PMME HANDLERS */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* */
        8        8        /*D*  NAME:   TDP$PMME
        9        9              CALL:   CALL TDP$PMME(CODE);
       10       10                          CODE is the PMME code.
       11       11              ENVIRONMENT:  Privleged master mode.
       12       12              DESCRIPTION:  A DO CASE statement selects which T & D
       13       13                            PMME is to be processed.
       14       14                                                                           */
       15       15        TDP$PMME: PROC(CODE);

     15  1 000000   000000 700200 xent  TDP$PMME     TSX0  ! X66_AUTO_1
         1 000001   000030 000001                    ZERO    24,1

       16       16        /**/
       17       17        /* PARAMETERS */
       18       18        /**/
       19       19    1   DCL CODE SBIN;
       20       20        /**/
       21       21        /* EXTERNAL PROCEDURES */
       22       22        /**/
       23       23    1   DCL TDM$MIRROR ENTRY ;
       24       24    1   DCL TDP$OPEN ENTRY;
       25       25    1   DCL TDP$CLOSE ENTRY;
       26       26    1   DCL TDP$TDIO ENTRY;
       27       27    1   DCL TDP$SYSCON ENTRY(3) ALTRET;
       28       28    1   DCL NIE$PMME ENTRY;
       29       29    1   DCL ELA$SYSLOG ENTRY(6) ALTRET;
       30       30    1   DCL MME$CVM ENTRY(4) ALTRET;
       31       31    1   DCL MMD$RSPP ENTRY(2) ALTRET;
       32       32    1   DCL UDB$PMMEXIT ENTRY(0);
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:16   
       33       33    1   DCL HFF$DSIZ ENTRY(2);
       34       34    1   DCL SSS$CACHE ENTRY;
       35       35    1   DCL SSS$CACHEBP ENTRY;
       36       36        /**/
       37       37        /* MISCELLANEOUS DATA */
       38       38        /**/
       39       39    1   DCL B$JIT$ PTR SYMREF;
       40       40        %INCLUDE B$JIT_C;
       41      354        %B$JIT0;
       42      443        %U$JIT1X;
       43      446        %M$JIT2X;
       44      449        %F$JIT3X;
       45      452        %S$JIT4;
       46      458        %J$JIT5X;
       47      461        %A$JIT6X;
       48      464    1   DCL B$PS0$ PTR SYMREF;
       49      465    1   DCL B$PS1$ PTR SYMREF;
       50      466        %INCLUDE B_ERRORS_C;
       51     1593    1   DCL DSIZ UBIN WORD;
       52     1594        /**/
       53     1595        /* M$RDSYSLOG DATA */
       54     1596        /**/
       55     1597        %INCLUDE EL_DATA_R;
       56     1606    1   DCL CVMPG UBIN(36);
       57     1607        %INCLUDE EL$TABLES;
       58     1930    1   DCL BUF$ PTR;
       59     1931        %EL$BUF(NAME=BUF,STCLASS="BASED(BUF$)");
       60     1934    1   DCL B$WINDOW$ PTR SYMREF;
       61     1935        %INCLUDE B_STRINGS_C;
       62     2064        %INCLUDE M_INFO_C;
       63     2204        %INCLUDE HF_LOCK_C;
       64     2218    1   DCL ERR UBIN(36);
       65     2219        /**/
       66     2220        /* M$WRSYSLOG DATA */
       67     2221        %INCLUDE EL_DATA_C;
       68     2233        %INCLUDE TD$CP6V_C;
       69     2269        %FPT$WRSYSLOG_V (FPTN=WRFPT);
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:17   
       70     2272        /* M$TDREQCPU DATA */
       71     2273        %INCLUDE SS_SCHED_R;                    /* CPU REFERENCES                     */
       72     2316    1   DCL S_CUN UBIN SYMREF;
       73     2317        %INCLUDE B$USER;                        /* USER TABLES (B$U.CPU)              */
       74     2533        %B$USERREFS;
       75     2537    1   DCL   CPU# SBIN;
       76     2538        %FPT$TDREQCPU_V;
       77     2542        /**/
       78     2543                   %FPT$SYSCON_V;
       79     2547    1   DCL SYSCON_RESULT BIT(72) ALIGNED;
       80     2548    1   DCL VLR_SYSCON BIT(72) ALIGNED BASED;
       81     2549    1   DCL 1 ERROR,
       82     2550    1         2 FCG BIT(18),
       83     2551    1         2 MON BIT(1),
       84     2552    1         2 CODE UBIN(14) UNAL,
       85     2553    1         2 SEV UBIN(3) UNAL;
       86     2554        %EJECT;
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:18   
       87     2555    2           DO CASE(CODE);

   2555  1 000002   200003 470500                    LDP0    @CODE,,AUTO
         1 000003   000000 235100                    LDA     0,,PR0
         1 000004   000011 115007                    CMPA    9,DL
         1 000005   000007 602005 1                  TNC     s:2555+5,AL
         1 000006   000644 710000 1                  TRA     s:2748
         1 000007   000020 710000 1                  TRA     s:2565
         1 000010   000300 710000 1                  TRA     s:2643
         1 000011   000355 710000 1                  TRA     s:2675
         1 000012   000361 710000 1                  TRA     s:2677
         1 000013   000365 710000 1                  TRA     s:2679
         1 000014   000371 710000 1                  TRA     s:2681
         1 000015   000603 710000 1                  TRA     s:2740
         1 000016   000607 710000 1                  TRA     s:2742
         1 000017   000641 710000 1                  TRA     s:2746

       88     2556    2            CASE(0);                       /* M$RDSYSLOG                         */

       89     2557        /*D*  NAME:   M$RDSYSLOG
       90     2558              CALL:   CALL TDP$PMME(0);
       91     2559              DESCRIPTION:    The first buffer in the error loggers buffer
       92     2560                              chain is moved to the buffer specified in the
       93     2561                              M$RDSYSLOG fpt. If the buffer moved is the
       94     2562                              second buffer in the page, the stolen page is
       95     2563                              returned to the system.
       96     2564                                                                           */
       97     2565    2              CALL SSS$CACHEBP;

   2565  1 000020   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000021   000000 701000 xent               TSX1    SSS$CACHEBP
         1 000022   000000 011000                    NOP     0

       98     2566    3              IF EL_FIRSTBUF=0 THEN DO;

   2566  1 000023   000000 235000 xsym               LDA     EL_FIRSTBUF
         1 000024   000037 601000 1                  TNZ     s:2576
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:19   

       99     2567    3                 EL_ERRCT=0;

   2567  1 000025   000000 450000 xsym               STZ     EL_ERRCT

      100     2568    3                 CALL SSS$CACHE;

   2568  1 000026   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000027   000000 701000 xent               TSX1    SSS$CACHE
         1 000030   000000 011000                    NOP     0

      101     2569    3                 CALL BADRET(%E$NOBUFS,0);

   2569  1 000031   000001 236000 2                  LDQ     1
         1 000032   200020 756100                    STQ     @ERRCODE+1,,AUTO
         1 000033   000002 236000 2                  LDQ     2
         1 000034   200017 756100                    STQ     ERROR+4,,AUTO
         1 000035   000714 701000 1                  TSX1    BADRET
         1 000036   000000 011000                    NOP     0

      102     2570    3                 END;

      103     2571        /*E*  ERROR:  TDP-E$NOBUFS-0
      104     2572              DESCRIPTION:  There are no error log buffers to pass.
      105     2573              MESSAGE: NO ERROR LOG BUFFERS TO BE READ.
      106     2574                                                                           */
      107     2575                   %LOCK (G#=EL_BUSY);

   2576  1 000037   000003 630400 2                  EPPR0   3
         1 000040   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000041   000000 701000 xent               TSX1    HFC$LOCK
         1 000042   000000 011000                    NOP     0

      108     2578    2              CVMPG=EL_FIRSTBUF;

   2578  1 000043   000000 235000 xsym               LDA     EL_FIRSTBUF
         1 000044   200005 755100                    STA     CVMPG,,AUTO
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:20   

      109     2579    2              CALL SSS$CACHE;

   2579  1 000045   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000046   000000 701000 xent               TSX1    SSS$CACHE
         1 000047   000000 011000                    NOP     0

      110     2580    2              CALL MME$CVM(%MONWSQ,%WINDOWHI,CVMPG,ERR) ALTRET(BADCVM);

   2580  1 000050   200007 630500                    EPPR0   ERR,,AUTO
         1 000051   200025 450500                    STP0    @SEVERITY+5,,AUTO
         1 000052   200005 631500                    EPPR1   CVMPG,,AUTO
         1 000053   200024 451500                    STP1    @SEVERITY+4,,AUTO
         1 000054   000006 237000 2                  LDAQ    6
         1 000055   200022 757100                    STAQ    @SEVERITY+2,,AUTO
         1 000056   200022 630500                    EPPR0   @SEVERITY+2,,AUTO
         1 000057   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000060   000000 701000 xent               TSX1    MME$CVM
         1 000061   000265 702000 1                  TSX2    BADCVM

      111     2581    2              BUF$=PINCRW(B$WINDOW$,(%WINDOWHI-%WINDOWLO)*1024);

   2581  1 000062   000000 236000 xsym               LDQ     B$WINDOW$
         1 000063   022000 036003                    ADLQ    9216,DU
         1 000064   200006 756100                    STQ     BUF$,,AUTO

      112     2582    2              CALL SSS$CACHEBP;

   2582  1 000065   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000066   000000 701000 xent               TSX1    SSS$CACHEBP
         1 000067   000000 011000                    NOP     0

      113     2583    3              IF BUF.COUNT=0 & EL_FIRSTBUF=EL_CURBUF THEN DO;

   2583  1 000070   400000 220003                    LDX0    -131072,DU
         1 000071   200006 470500                    LDP0    BUF$,,AUTO
         1 000072   000001 236100                    LDQ     1,,PR0
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:21   
         1 000073   777000 316003                    CANQ    -512,DU
         1 000074   000076 600000 1                  TZE     s:2583+6
         1 000075   000000 220003                    LDX0    0,DU
         1 000076   400000 221003                    LDX1    -131072,DU
         1 000077   000000 236000 xsym               LDQ     EL_FIRSTBUF
         1 000100   000000 116000 xsym               CMPQ    EL_CURBUF
         1 000101   000103 600000 1                  TZE     s:2583+11
         1 000102   000000 221003                    LDX1    0,DU
         1 000103   000000 636011                    EAQ     0,X1
         1 000104   200022 756100                    STQ     @SEVERITY+2,,AUTO
         1 000105   000000 636010                    EAQ     0,X0
         1 000106   200022 376100                    ANQ     @SEVERITY+2,,AUTO
         1 000107   000146 600000 1                  TZE     s:2594

      114     2584    3                 CALL SSS$CACHE;

   2584  1 000110   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000111   000000 701000 xent               TSX1    SSS$CACHE
         1 000112   000000 011000                    NOP     0

      115     2585    3                 CALL MME$CVM(%MONWSQ,%WINDOWHI,-1,ERR) ALTRET(BADCVM);

   2585  1 000113   200007 630500                    EPPR0   ERR,,AUTO
         1 000114   200025 450500                    STP0    @SEVERITY+5,,AUTO
         1 000115   000005 236000 2                  LDQ     5
         1 000116   200024 756100                    STQ     @SEVERITY+4,,AUTO
         1 000117   000006 237000 2                  LDAQ    6
         1 000120   200022 757100                    STAQ    @SEVERITY+2,,AUTO
         1 000121   200022 630500                    EPPR0   @SEVERITY+2,,AUTO
         1 000122   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000123   000000 701000 xent               TSX1    MME$CVM
         1 000124   000265 702000 1                  TSX2    BADCVM

      116     2586    3                 CALL SSS$CACHEBP;

   2586  1 000125   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000126   000000 701000 xent               TSX1    SSS$CACHEBP
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:22   
         1 000127   000000 011000                    NOP     0

      117     2587    3                 EL_ERRCT=0;

   2587  1 000130   000000 450000 xsym               STZ     EL_ERRCT

      118     2588    3                 CALL SSS$CACHE;

   2588  1 000131   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000132   000000 701000 xent               TSX1    SSS$CACHE
         1 000133   000000 011000                    NOP     0

      119     2589                      %UNLOCK (G#=EL_BUSY);

   2590  1 000134   000003 630400 2                  EPPR0   3
         1 000135   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000136   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000137   000000 011000                    NOP     0

      120     2592    3                 CALL BADRET(%E$NOBUFS,0);

   2592  1 000140   000001 236000 2                  LDQ     1
         1 000141   200020 756100                    STQ     @ERRCODE+1,,AUTO
         1 000142   000002 236000 2                  LDQ     2
         1 000143   200017 756100                    STQ     ERROR+4,,AUTO
         1 000144   000714 701000 1                  TSX1    BADRET
         1 000145   000000 011000                    NOP     0

      121     2593    3                 END;

      122     2594    2              CALL SSS$CACHE;

   2594  1 000146   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000147   000000 701000 xent               TSX1    SSS$CACHE
         1 000150   000000 011000                    NOP     0

      123     2595    2              CALL HFF$DSIZ (0,DSIZ);
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:23   

   2595  1 000151   200004 630500                    EPPR0   DSIZ,,AUTO
         1 000152   200023 450500                    STP0    @SEVERITY+3,,AUTO
         1 000153   000001 236000 2                  LDQ     1
         1 000154   200022 756100                    STQ     @SEVERITY+2,,AUTO
         1 000155   200022 630500                    EPPR0   @SEVERITY+2,,AUTO
         1 000156   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000157   000000 701000 xent               TSX1    HFF$DSIZ
         1 000160   000000 011000                    NOP     0

      124     2596    3              IF DSIZ < 4096 THEN DO;

   2596  1 000161   200004 235100                    LDA     DSIZ,,AUTO
         1 000162   010000 115007                    CMPA    4096,DL
         1 000163   000176 603000 1                  TRC     s:2607

      125     2597                      %UNLOCK (G#=EL_BUSY);

   2598  1 000164   000003 630400 2                  EPPR0   3
         1 000165   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000166   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000167   000000 011000                    NOP     0

      126     2600    3                 CALL BADRET (%E$BUF2SMALL,4);

   2600  1 000170   000011 236000 2                  LDQ     9
         1 000171   200020 756100                    STQ     @ERRCODE+1,,AUTO
         1 000172   000012 236000 2                  LDQ     10
         1 000173   200017 756100                    STQ     ERROR+4,,AUTO
         1 000174   000714 701000 1                  TSX1    BADRET
         1 000175   000000 011000                    NOP     0

      127     2601    3                 END;

      128     2602        /*E*  ERROR:  TDP-E$BUF2SMALL-0
      129     2603              DESCRIPTION:  The buffer specified in the M$RDSYSLOG fpt is
      130     2604                            smaller than 512 words.
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:24   
      131     2605              MESSAGE: M$RDSYSLOG BUFFER LESS THAN 512 WORDS.
      132     2606                                                                           */
      133     2607    2              B$PS0$->BUF=BUF$->BUF;

   2607  1 000176   200006 470500                    LDP0    BUF$,,AUTO
         1 000177   010000 220003                    LDX0    4096,DU
         1 000200   000000 471400 xsym               LDP1    B$PS0$
         1 000201   000140 100540                    MLR     fill='000'O
         1 000202   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         1 000203   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0

      134     2608    2              CALL SSS$CACHEBP;

   2608  1 000204   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000205   000000 701000 xent               TSX1    SSS$CACHEBP
         1 000206   000000 011000                    NOP     0

      135     2609    2              IF EL_FIRSTBUF=EL_CURBUF THEN

   2609  1 000207   000000 236000 xsym               LDQ     EL_FIRSTBUF
         1 000210   000000 116000 xsym               CMPQ    EL_CURBUF
         1 000211   000216 601000 1                  TNZ     s:2612

      136     2610    2                 EL_CURBUF=BUF.NXTBUF;

   2610  1 000212   200006 470500                    LDP0    BUF$,,AUTO
         1 000213   000000 235100                    LDA     0,,PR0
         1 000214   000000 755000 xsym               STA     EL_CURBUF
         1 000215   000220 710000 1                  TRA     s:2614

      137     2611    3              ELSE DO INHIBIT;

      138     2612    3                 EL_FULLBUFS=EL_FULLBUFS-1;

   2612  1 000216   000001 336207                    LCQ   ! 1,DL
         1 000217   000000 056200 xsym               ASQ   ! EL_FULLBUFS

PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:25   
      139     2613    3                 END /* INHIBIT */;

      140     2614    2              EL_FIRSTBUF=BUF.NXTBUF;

   2614  1 000220   200006 470500                    LDP0    BUF$,,AUTO
         1 000221   000000 235100                    LDA     0,,PR0
         1 000222   000000 755000 xsym               STA     EL_FIRSTBUF

      141     2615    2              CALL SSS$CACHE;

   2615  1 000223   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000224   000000 701000 xent               TSX1    SSS$CACHE
         1 000225   000000 011000                    NOP     0

      142     2616    2              CALL MME$CVM(%MONWSQ,%WINDOWHI,-1,ERR) ALTRET(BADCVM);

   2616  1 000226   200007 630500                    EPPR0   ERR,,AUTO
         1 000227   200025 450500                    STP0    @SEVERITY+5,,AUTO
         1 000230   000005 236000 2                  LDQ     5
         1 000231   200024 756100                    STQ     @SEVERITY+4,,AUTO
         1 000232   000006 237000 2                  LDAQ    6
         1 000233   200022 757100                    STAQ    @SEVERITY+2,,AUTO
         1 000234   200022 630500                    EPPR0   @SEVERITY+2,,AUTO
         1 000235   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000236   000000 701000 xent               TSX1    MME$CVM
         1 000237   000265 702000 1                  TSX2    BADCVM

      143     2617    2              CALL MMD$RSPP(CVMPG,%MONWSQ);

   2617  1 000240   000006 236000 2                  LDQ     6
         1 000241   200023 756100                    STQ     @SEVERITY+3,,AUTO
         1 000242   200005 630500                    EPPR0   CVMPG,,AUTO
         1 000243   200022 450500                    STP0    @SEVERITY+2,,AUTO
         1 000244   200022 630500                    EPPR0   @SEVERITY+2,,AUTO
         1 000245   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000246   000000 701000 xent               TSX1    MMD$RSPP
         1 000247   000000 011000                    NOP     0
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:26   

      144     2618    2              CALL SSS$CACHEBP;

   2618  1 000250   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000251   000000 701000 xent               TSX1    SSS$CACHEBP
         1 000252   000000 011000                    NOP     0

      145     2619    3              DO INHIBIT;

      146     2620    3                 EL_NUMPGS=EL_NUMPGS-1;

   2620  1 000253   000001 336207                    LCQ   ! 1,DL
         1 000254   000000 056200 xsym               ASQ   ! EL_NUMPGS

      147     2621    3                 END;                      /* INHIBIT                            */

      148     2622    2              CALL SSS$CACHE;

   2622  1 000255   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000256   000000 701000 xent               TSX1    SSS$CACHE
         1 000257   000000 011000                    NOP     0

      149     2623                   %UNLOCK (G#=EL_BUSY);

   2624  1 000260   000003 630400 2                  EPPR0   3
         1 000261   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000262   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000263   000000 011000                    NOP     0

      150     2626    2              RETURN;

   2626  1 000264   000000 702200 xent               TSX2  ! X66_ARET

   2620  1 000265                       BADCVM       null
      151     2627    2   BADCVM:    ;
      152     2628                   %UNLOCK (G#=EL_BUSY);

PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:27   
   2629  1 000265   000003 630400 2                  EPPR0   3
         1 000266   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000267   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000270   000000 011000                    NOP     0

      153     2631    2              CALL BADRET(ERR,4);

   2631  1 000271   000011 236000 2                  LDQ     9
         1 000272   200020 756100                    STQ     @ERRCODE+1,,AUTO
         1 000273   200007 630500                    EPPR0   ERR,,AUTO
         1 000274   200017 450500                    STP0    ERROR+4,,AUTO
         1 000275   000714 701000 1                  TSX1    BADRET
         1 000276   000000 011000                    NOP     0
         1 000277   000644 710000 1                  TRA     s:2748

      154     2632        /**/
      155     2633        /* M$WRSYSLOG */
      156     2634        /**/
      157     2635    2            CASE(1);                       /* M$WRSYSLOG                         */

      158     2636        /*D*  NAME:   M$WRSYSLOG
      159     2637              CALL:   CALL TDP$PMME(1);
      160     2638              DESCRIPTION:    If the size of the entry to be made is not
      161     2639                              greater than the maximum error log entry size
      162     2640                              a call is made to ELA$ERRLOG with the parameters
      163     2641                              specified in the fpt.
      164     2642                                                                           */
      165     2643    2              CALL HFF$DSIZ (1,DSIZ);

   2643  1 000300   200004 631500                    EPPR1   DSIZ,,AUTO
         1 000301   200023 451500                    STP1    @SEVERITY+3,,AUTO
         1 000302   000006 236000 2                  LDQ     6
         1 000303   200022 756100                    STQ     @SEVERITY+2,,AUTO
         1 000304   200022 630500                    EPPR0   @SEVERITY+2,,AUTO
         1 000305   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000306   000000 701000 xent               TSX1    HFF$DSIZ
         1 000307   000000 011000                    NOP     0
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:28   

      166     2644    3              IF B$PS0$->WRFPT.SIZE*4 > DSIZ THEN DO;

   2644  1 000310   000000 470400 xsym               LDP0    B$PS0$
         1 000311   000002 236100                    LDQ     2,,PR0
         1 000312   000002 736000                    QLS     2
         1 000313   200004 116100                    CMPQ    DSIZ,,AUTO
         1 000314   000321 602000 1                  TNC     s:2654
         1 000315   000321 600000 1                  TZE     s:2654

      167     2645    3                 ERR=%E$INFO2SMALL;

   2645  1 000316   001633 235007                    LDA     923,DL
         1 000317   200007 755100                    STA     ERR,,AUTO

      168     2646        /*E*    ERROR:      TDP-E$INFO2SMALL
      169     2647                MESSAGE: The buffer area passed is smaller than the size of the entry.
      170     2648                MESSAGE1: The area framed by the ENTRY vector of the M$WRSYSLOG
      171     2649                          fpt must be at least as big as the value specified
      172     2650                          for SIZE.
      173     2651        */
      174     2652    3                 GOTO WRALT;

   2652  1 000320   000344 710000 1                  TRA     WRALT

      175     2653    3                 END;
      176     2654    2              CALL ELA$SYSLOG(B$PS0$->WRFPT.TYPE,B$PS1$->WRFPT,B$PS0$->WRFPT.SIZE,

   2654  1 000321   200007 631500                    EPPR1   ERR,,AUTO
         1 000322   200027 451500                    STP1    @SEVERITY+7,,AUTO
         1 000323   000000 236000 xsym               LDQ     B$PS0$
         1 000324   000003 036003                    ADLQ    3,DU
         1 000325   200026 756100                    STQ     @SEVERITY+6,,AUTO
         1 000326   000000 236000 xsym               LDQ     B$PS0$
         1 000327   200025 756100                    STQ     @SEVERITY+5,,AUTO
         1 000330   000002 036003                    ADLQ    2,DU
         1 000331   200024 756100                    STQ     @SEVERITY+4,,AUTO
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:29   
         1 000332   000000 236000 xsym               LDQ     B$PS1$
         1 000333   200023 756100                    STQ     @SEVERITY+3,,AUTO
         1 000334   000000 236000 xsym               LDQ     B$PS0$
         1 000335   000001 036003                    ADLQ    1,DU
         1 000336   200022 756100                    STQ     @SEVERITY+2,,AUTO
         1 000337   200022 630500                    EPPR0   @SEVERITY+2,,AUTO
         1 000340   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 000341   000000 701000 xent               TSX1    ELA$SYSLOG
         1 000342   000344 702000 1                  TSX2    WRALT

      177     2655    2                B$PS0$->WRFPT.MMINHIB,B$PS0$->WRFPT.FILENUM,ERR) ALTRET(WRALT);
      178     2656    2              RETURN;

   2656  1 000343   000000 702200 xent               TSX2  ! X66_ARET

      179     2657
      180     2658    2   WRALT:     B$JIT.ERR='240420400004'O;

   2658  1 000344   000000 236000 0     WRALT        LDQ     0
         1 000345   000000 470400 xsym               LDP0    B$JIT$
         1 000346   000012 756100                    STQ     10,,PR0

      181     2659    2              B$JIT.ERR.CODE=ERR;

   2659  1 000347   200007 236100                    LDQ     ERR,,AUTO
         1 000350   000003 736000                    QLS     3
         1 000351   000012 676100                    ERQ     10,,PR0
         1 000352   377770 376007                    ANQ     131064,DL
         1 000353   000012 656100                    ERSQ    10,,PR0

      182     2660    2              RETURN;

   2660  1 000354   000000 702200 xent               TSX2  ! X66_ARET

      183     2661        /*E*    ERROR:      TDP-E$NTRY2BIG
      184     2662                MESSAGE: System log entries may not exceed 1000 words.
      185     2663        */
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:30   
      186     2664        /*E*    ERROR:      TDP-E$SLBUSY
      187     2665                MESSAGE: System log is busy.  Try again later.
      188     2666        */
      189     2667        /*E*    ERROR:      TDP-E$NEEDPAGE
      190     2668                MESSAGE: System log needs a buffer page and can't get it
      191     2669                            right now.
      192     2670        */
      193     2671        /*E*    ERROR:      TDP-E$SLFILE
      194     2672                MESSAGE: System log file number may not exceed 99.
      195     2673        */
      196     2674    2            CASE(2);                       /* M$TDOPEN                           */

      197     2675    2              CALL TDP$OPEN;

   2675  1 000355   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000356   000000 701000 xent               TSX1    TDP$OPEN
         1 000357   000000 011000                    NOP     0
         1 000360   000644 710000 1                  TRA     s:2748

      198     2676    2            CASE(3);                       /* M$TDCLOSE                          */

      199     2677    2              CALL TDP$CLOSE;

   2677  1 000361   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000362   000000 701000 xent               TSX1    TDP$CLOSE
         1 000363   000000 011000                    NOP     0
         1 000364   000644 710000 1                  TRA     s:2748

      200     2678    2            CASE(4);                       /* M$TDIO                             */

      201     2679    2              CALL TDP$TDIO;

   2679  1 000365   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000366   000000 701000 xent               TSX1    TDP$TDIO
         1 000367   000000 011000                    NOP     0
         1 000370   000644 710000 1                  TRA     s:2748

PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:31   
      202     2680    2            CASE(5);                       /* M$TDREQCPU                         */

      203     2681    3              DO CASE(B$PS0$->FPT$TDREQCPU_V.MODE);

   2681  1 000371   000000 471400 xsym               LDP1    B$PS0$
         1 000372   100000 236100                    LDQ     0,,PR1
         1 000373   000033 772000                    QRL     27
         1 000374   000003 116007                    CMPQ    3,DL
         1 000375   000377 602006 1                  TNC     s:2681+6,QL
         1 000376   000526 710000 1                  TRA     s:2718
         1 000377   000526 710000 1                  TRA     s:2718
         1 000400   000415 710000 1                  TRA     s:2692
         1 000401   000402 710000 1                  TRA     s:2683

      204     2682    3               CASE(2);                    /* MODE=NORMAL                        */

      205     2683    3                 IF S_TDCPUF ~= S_CUN

   2683  1 000402   000000 236000 xsym               LDQ     S_TDCPUF
         1 000403   000406 604000 1                  TMI     s:2685
         1 000404   000000 116000 xsym               CMPQ    S_CUN
         1 000405   000412 600000 1                  TZE     s:2688

      206     2684    4                 THEN DO;

      207     2685    4                    S$CU$->B$U.CPU = 0;    /* FOR NONTDJASSIGN                   */

   2685  1 000406   000000 473400 xsym               LDP3    S$CU$
         1 000407   000000 236003                    LDQ     0,DU
         1 000410   300010 552104                    STBQ    8,'04'O,PR3

      208     2686    4                    RETURN;

   2686  1 000411   000000 702200 xent               TSX2  ! X66_ARET

      209     2687    4                    END;
      210     2688    3                 S_TDCPUF=0;
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:32   

   2688  1 000412   000000 450000 xsym               STZ     S_TDCPUF

      211     2689    3                 S_TDCPU#=0;

   2689  1 000413   000000 450000 xsym               STZ     S_TDCPU#

      212     2690    3                 GOTO RESET;               /* RESET DIAG MODE USER               */

   2690  1 000414   000576 710000 1                  TRA     RESET

      213     2691    3               CASE(1);                    /* MODE=DIAG                          */

      214     2692    3                 IF B$PS0$->FPT$TDREQCPU_V.XEQ = 3

   2692  1 000415   100001 236100                    LDQ     1,,PR1
         1 000416   777000 376003                    ANQ     -512,DU
         1 000417   003000 116003                    CMPQ    1536,DU
         1 000420   000456 601000 1                  TNZ     s:2702
         1 000421   100003 236100                    LDQ     3,,PR1
         1 000422   777000 376003                    ANQ     -512,DU
         1 000423   777000 116003                    CMPQ    -512,DU
         1 000424   000456 601000 1                  TNZ     s:2702

      215     2693    3                   AND B$PS0$->FPT$TDREQCPU_V.CPU = 511
      216     2694    4                 THEN DO;                  /* NONTDJASSIGN REQUEST FOR CPU TYPE  */

      217     2695    5                    DO CPU# = S_NSCPU DOWNTO 0;

   2695  1 000425   000000 235000 xsym               LDA     S_NSCPU
         1 000426   200010 755100                    STA     CPU#,,AUTO
         1 000427   000446 710000 1                  TRA     s:2699+2

      218     2696    5                       IF B$PS0$->FPT$TDREQCPU_V.TYPE = S_PTYPE(CPU#)

   2696  1 000430   200010 720100                    LXL0    CPU#,,AUTO
         1 000431   000000 470400 xsym               LDP0    B$PS0$
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:33   
         1 000432   000002 236100                    LDQ     2,,PR0
         1 000433   000033 772000                    QRL     27
         1 000434   000000 116010 xsym               CMPQ    S_PTYPE,X0
         1 000435   000444 601000 1                  TNZ     s:2699
         1 000436   000000 235010 xsym               LDA     S_MPSTATE,X0
         1 000437   000002 115007                    CMPA    2,DL
         1 000440   000444 601000 1                  TNZ     s:2699
         1 000441   000000 235010 xsym               LDA     S_STOP,X0
         1 000442   000001 115007                    CMPA    1,DL
         1 000443   000567 601000 1                  TNZ     TDREQCPU_SET

      219     2697    5                         AND S_MPSTATE(CPU#) = 2 AND S_STOP(CPU#) ~= 1
      220     2698    5                       THEN GOTO TDREQCPU_SET;
      221     2699    5                       END;

   2699  1 000444   000001 336007                    LCQ     1,DL
         1 000445   200010 056100                    ASQ     CPU#,,AUTO
         1 000446   200010 235100                    LDA     CPU#,,AUTO
         1 000447   000430 605000 1                  TPL     s:2696

      222     2700    4                    CALL BADRET(%E$NOCPU,4);

   2700  1 000450   000011 236000 2                  LDQ     9
         1 000451   200020 756100                    STQ     @ERRCODE+1,,AUTO
         1 000452   000014 236000 2                  LDQ     12
         1 000453   200017 756100                    STQ     ERROR+4,,AUTO
         1 000454   000714 701000 1                  TSX1    BADRET
         1 000455   000000 011000                    NOP     0

      223     2701    4                    END;

      224     2702    3                 CALL PROC#;               /* GET CPU #                          */

   2702  1 000456   000664 701000 1                  TSX1    PROC#
         1 000457   000000 011000                    NOP     0

      225     2703    3                 IF S_MPSTATE(CPU#) ~= 2 OR S_STOP(CPU#) = 1
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:34   

   2703  1 000460   200010 720100                    LXL0    CPU#,,AUTO
         1 000461   000000 235010 xsym               LDA     S_MPSTATE,X0
         1 000462   000002 115007                    CMPA    2,DL
         1 000463   000467 601000 1                  TNZ     s:2704
         1 000464   000000 235010 xsym               LDA     S_STOP,X0
         1 000465   000001 115007                    CMPA    1,DL
         1 000466   000475 601000 1                  TNZ     s:2705

      226     2704    3                 THEN CALL BADRET(%E$CPUSTOPPED,4);

   2704  1 000467   000011 236000 2                  LDQ     9
         1 000470   200020 756100                    STQ     @ERRCODE+1,,AUTO
         1 000471   000016 236000 2                  LDQ     14
         1 000472   200017 756100                    STQ     ERROR+4,,AUTO
         1 000473   000714 701000 1                  TSX1    BADRET
         1 000474   000000 011000                    NOP     0

      227     2705    3                 IF B$PS0$->FPT$TDREQCPU_V.XEQ = 3

   2705  1 000475   000000 470400 xsym               LDP0    B$PS0$
         1 000476   000001 236100                    LDQ     1,,PR0
         1 000477   777000 376003                    ANQ     -512,DU
         1 000500   003000 116003                    CMPQ    1536,DU
         1 000501   000567 600000 1                  TZE     TDREQCPU_SET

      228     2706    3                 THEN GOTO TDREQCPU_SET;   /* NONTDJASSIGN REQUEST FOR CPU PORT  */
      229     2707    4                 ELSE DO;

      230     2708    4                    IF S_TDCPUF ~= 0

   2708  1 000502   000000 235000 xsym               LDA     S_TDCPUF
         1 000503   000522 600000 1                  TZE     s:2713

      231     2709    5                    THEN DO;

      232     2710    5                       IF S_TDCPUF ~= S_CUN OR S_TDCPU# ~= CPU#
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:35   

   2710  1 000504   000000 236000 xsym               LDQ     S_TDCPUF
         1 000505   000514 604000 1                  TMI     s:2711
         1 000506   000000 116000 xsym               CMPQ    S_CUN
         1 000507   000514 601000 1                  TNZ     s:2711
         1 000510   000000 236000 xsym               LDQ     S_TDCPU#
         1 000511   000514 604000 1                  TMI     s:2711
         1 000512   200010 116100                    CMPQ    CPU#,,AUTO
         1 000513   000522 600000 1                  TZE     s:2713

      233     2711    5                       THEN CALL BADRET(%E$CPUDIAGERR,4);

   2711  1 000514   000011 236000 2                  LDQ     9
         1 000515   200020 756100                    STQ     @ERRCODE+1,,AUTO
         1 000516   000020 236000 2                  LDQ     16
         1 000517   200017 756100                    STQ     ERROR+4,,AUTO
         1 000520   000714 701000 1                  TSX1    BADRET
         1 000521   000000 011000                    NOP     0

      234     2712    5                       END;

      235     2713    4                    S_TDCPUF = S_CUN;

   2713  1 000522   000000 235000 xsym               LDA     S_CUN
         1 000523   000000 755000 xsym               STA     S_TDCPUF

      236     2714    4                    S_TDCPU# = CPU#;

   2714  1 000524   200010 236100                    LDQ     CPU#,,AUTO
         1 000525   000000 756000 xsym               STQ     S_TDCPU#

      237     2715    4                    END;

      238     2716    3               END;                        /* END MODE CASES                     */

      239     2717        /*                                                                    */
      240     2718    2              IF B$PS0$->FPT$TDREQCPU_V.XEQ >= 1
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:36   

   2718  1 000526   000000 470400 xsym               LDP0    B$PS0$
         1 000527   000001 236100                    LDQ     1,,PR0
         1 000530   777000 316003                    CANQ    -512,DU
         1 000531   000576 600000 1                  TZE     RESET

      241     2719    3              THEN DO;

      242     2720    3                 IF S_TDCPUF ~= S_CUN

   2720  1 000532   000000 236000 xsym               LDQ     S_TDCPUF
         1 000533   000536 604000 1                  TMI     s:2721
         1 000534   000000 116000 xsym               CMPQ    S_CUN
         1 000535   000544 600000 1                  TZE     s:2722

      243     2721    3                 THEN CALL BADRET(%E$CPUASSIGNERR,4);

   2721  1 000536   000011 236000 2                  LDQ     9
         1 000537   200020 756100                    STQ     @ERRCODE+1,,AUTO
         1 000540   000022 236000 2                  LDQ     18
         1 000541   200017 756100                    STQ     ERROR+4,,AUTO
         1 000542   000714 701000 1                  TSX1    BADRET
         1 000543   000000 011000                    NOP     0

      244     2722    3                 CALL PROC#;

   2722  1 000544   000664 701000 1                  TSX1    PROC#
         1 000545   000000 011000                    NOP     0

      245     2723    3                 IF S_TDCPU# ~= CPU#

   2723  1 000546   000000 236000 xsym               LDQ     S_TDCPU#
         1 000547   000552 604000 1                  TMI     s:2724
         1 000550   200010 116100                    CMPQ    CPU#,,AUTO
         1 000551   000560 600000 1                  TZE     s:2725

      246     2724    3                 THEN CALL BADRET(%E$CPUASSIGNERR,4);
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:37   

   2724  1 000552   000011 236000 2                  LDQ     9
         1 000553   200020 756100                    STQ     @ERRCODE+1,,AUTO
         1 000554   000022 236000 2                  LDQ     18
         1 000555   200017 756100                    STQ     ERROR+4,,AUTO
         1 000556   000714 701000 1                  TSX1    BADRET
         1 000557   000000 011000                    NOP     0

      247     2725    3                 IF B$PS0$->FPT$TDREQCPU_V.XEQ = 2

   2725  1 000560   000000 470400 xsym               LDP0    B$PS0$
         1 000561   000001 236100                    LDQ     1,,PR0
         1 000562   777000 376003                    ANQ     -512,DU
         1 000563   002000 116003                    CMPQ    1024,DU
         1 000564   000567 601000 1                  TNZ     TDREQCPU_SET

      248     2726    3                 THEN S_TDCPUJ = S_CUN;    /* FOR REMAINDER OF JOB               */

   2726  1 000565   000000 235000 xsym               LDA     S_CUN
         1 000566   000000 755000 xsym               STA     S_TDCPUJ

      249     2727    3   TDREQCPU_SET:
      250     2728    3                 S$CU$->B$U.CPU = CPU#+1;

   2728  1 000567   000000 471400 xsym  TDREQCPU_SET LDP1    S$CU$
         1 000570   200010 236100                    LDQ     CPU#,,AUTO
         1 000571   000001 036007                    ADLQ    1,DL
         1 000572   100010 552104                    STBQ    8,'04'O,PR1

      251     2729    3                 B$JIT.IDELTAT = 0;        /* QUANTUM END USER TO GET ON CPU#    */

   2729  1 000573   000000 473400 xsym               LDP3    B$JIT$
         1 000574   300266 450100                    STZ     182,,PR3

      252     2730    3                 RETURN;

   2730  1 000575   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:38   

      253     2731    3                 END;
      254     2732    3              ELSE DO;

      255     2733    3   RESET:        S$CU$->B$U.CPU=0;

   2733  1 000576   000000 470400 xsym  RESET        LDP0    S$CU$
         1 000577   000000 236003                    LDQ     0,DU
         1 000600   000010 552104                    STBQ    8,'04'O,PR0

      256     2734    3                 S_TDCPUJ=0;

   2734  1 000601   000000 450000 xsym               STZ     S_TDCPUJ

      257     2735    3                 END;

   2735  1 000602   000644 710000 1                  TRA     s:2748

      258     2736        /**/
      259     2737        /* M$IOQ */
      260     2738        /**/
      261     2739    2            CASE(6);

      262     2740    2              CALL NIE$PMME;

   2740  1 000603   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000604   000000 701000 xent               TSX1    NIE$PMME
         1 000605   000000 011000                    NOP     0
         1 000606   000644 710000 1                  TRA     s:2748

      263     2741    2            CASE(7);                       /* M$SYSCON                           */

      264     2742    2              CALL TDP$SYSCON(B$PS0$->FPT$SYSCON_V,SYSCON_RESULT,ERROR) ALTRET(
              2742                       SYSCON_ALT);

   2742  1 000607   200013 631500                    EPPR1   ERROR,,AUTO
         1 000610   200024 451500                    STP1    @SEVERITY+4,,AUTO
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:39   
         1 000611   200011 633500                    EPPR3   SYSCON_RESULT,,AUTO
         1 000612   200023 453500                    STP3    @SEVERITY+3,,AUTO
         1 000613   000000 236000 xsym               LDQ     B$PS0$
         1 000614   200022 756100                    STQ     @SEVERITY+2,,AUTO
         1 000615   200022 630500                    EPPR0   @SEVERITY+2,,AUTO
         1 000616   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000617   000000 701000 xent               TSX1    TDP$SYSCON
         1 000620   000645 702000 1                  TSX2    SYSCON_ALT

      265     2743    2              CALL HFF$DSIZ(1,ERR);

   2743  1 000621   200007 630500                    EPPR0   ERR,,AUTO
         1 000622   200023 450500                    STP0    @SEVERITY+3,,AUTO
         1 000623   000006 236000 2                  LDQ     6
         1 000624   200022 756100                    STQ     @SEVERITY+2,,AUTO
         1 000625   200022 630500                    EPPR0   @SEVERITY+2,,AUTO
         1 000626   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000627   000000 701000 xent               TSX1    HFF$DSIZ
         1 000630   000000 011000                    NOP     0

      266     2744    2              IF ERR>=8 THEN B$PS1$->VLR_SYSCON=SYSCON_RESULT;

   2744  1 000631   200007 235100                    LDA     ERR,,AUTO
         1 000632   000010 115007                    CMPA    8,DL
         1 000633   000644 602000 1                  TNC     s:2748

   2744  1 000634   000000 470400 xsym               LDP0    B$PS1$
         1 000635   000100 100500                    MLR     fill='000'O
         1 000636   200011 000010                    ADSC9   SYSCON_RESULT,,AUTO      cn=0,n=8
         1 000637   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         1 000640   000644 710000 1                  TRA     s:2748

      267     2745    2            CASE(8);

      268     2746    2              CALL TDM$MIRROR ;

   2746  1 000641   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:40   
         1 000642   000000 701000 xent               TSX1    TDM$MIRROR
         1 000643   000000 011000                    NOP     0

      269     2747    2            END /* CASE CODE */;

      270     2748    1           RETURN;

   2748  1 000644   000000 702200 xent               TSX2  ! X66_ARET

   2742  1 000645                       SYSCON_ALT   null
      271     2749    1   SYSCON_ALT: ;
      272     2750    1           IF ERROR.FCG='0'B THEN CALL BADRET(ERROR,4);

   2750  1 000645   200013 220100                    LDX0    ERROR,,AUTO
         1 000646   000655 601000 1                  TNZ     s:2751

   2750  1 000647   000011 236000 2                  LDQ     9
         1 000650   200020 756100                    STQ     @ERRCODE+1,,AUTO
         1 000651   200013 630500                    EPPR0   ERROR,,AUTO
         1 000652   200017 450500                    STP0    ERROR+4,,AUTO
         1 000653   000714 701000 1                  TSX1    BADRET
         1 000654   000000 011000                    NOP     0

      273     2751    1           B$JIT.ERR=ERROR;

   2751  1 000655   200013 236100                    LDQ     ERROR,,AUTO
         1 000656   000000 470400 xsym               LDP0    B$JIT$
         1 000657   000012 756100                    STQ     10,,PR0

      274     2752    1           CALL UDB$PMMEXIT;

   2752  1 000660   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000661   000000 701000 xent               TSX1    UDB$PMMEXIT
         1 000662   000000 011000                    NOP     0
         1 000663   000740 710000 1                  TRA     s:2820

      275     2753        /*E*    ERROR:      TDP-E$PRTBSY
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:41   
      276     2754                MESSAGE: Device in use.  Will be partitioned when released.
      277     2755        */
      278     2756        /*E*    ERROR:      TDP-E$UPNLDT
      279     2757                MESSAGE: Cannot return that device because there are no LDCTs available
      280     2758        */
      281     2759        /*                                                                   */
      282     2760    1   PROC#:  PROC;

   2760  1 000664   200014 741300       PROC#        STX1  ! ERROR+1,,AUTO

      283     2761    3           DO CPU# = 0 TO S_NSCPU;         /*  SEARCH PORT # TABLE FOR PROC      */

   2761  1 000665   200010 450100                    STZ     CPU#,,AUTO
         1 000666   000700 710000 1                  TRA     s:2763+1

      284     2762    3              IF B$PS0$->FPT$TDREQCPU_V.CPU = S_PORTNR(CPU#) THEN RETURN;

   2762  1 000667   200010 720100                    LXL0    CPU#,,AUTO
         1 000670   000000 470400 xsym               LDP0    B$PS0$
         1 000671   000003 236100                    LDQ     3,,PR0
         1 000672   000033 772000                    QRL     27
         1 000673   000000 116010 xsym               CMPQ    S_PORTNR,X0
         1 000674   000677 601000 1                  TNZ     s:2763

   2762  1 000675   200014 221300                    LDX1  ! ERROR+1,,AUTO
         1 000676   000001 702211                    TSX2  ! 1,X1

      285     2763    3              END;

   2763  1 000677   200010 054100                    AOS     CPU#,,AUTO
         1 000700   000000 236000 xsym               LDQ     S_NSCPU
         1 000701   000667 604000 1                  TMI     s:2762
         1 000702   200010 116100                    CMPQ    CPU#,,AUTO
         1 000703   000667 605000 1                  TPL     s:2762

      286     2764    2           CALL BADRET(%E$NOCPU,4);

PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:42   
   2764  1 000704   000011 236000 2                  LDQ     9
         1 000705   200020 756100                    STQ     @ERRCODE+1,,AUTO
         1 000706   000014 236000 2                  LDQ     12
         1 000707   200017 756100                    STQ     ERROR+4,,AUTO
         1 000710   000714 701000 1                  TSX1    BADRET
         1 000711   000000 011000                    NOP     0

      287     2765    2   END PROC#;

   2765  1 000712   200014 221300                    LDX1  ! ERROR+1,,AUTO
         1 000713   000001 702211                    TSX2  ! 1,X1

      288     2766        /*E*      ERROR: TDP-E$NOCPU-0
      289     2767                  MESSAGE: Designated CPU is unavailable
      290     2768                  DESCRIPTION: THE SPECIFIED CPU IS NOT CONFIGURED IN THE SYSTEM */
      291     2769        /*E*      ERROR: TDP-E$CPUSTOPPED-0
      292     2770                  MESSAGE: Designated CPU not running
      293     2771                  DESCRIPTION: THE SPECIFIED CPU IS PRESENT BUT IS NOT RUNNING. */
      294     2772        /*E*      ERROR: TDP-E$CPURUNNING-0
      295     2773                  MESSAGE: Designated CPU is running
      296     2774                  DESCRIPTION: THE SPECIFIED CPU IS PRESENT BUT IS RUNNING. */
      297     2775        /*E*      ERROR: TDP-E$CPUMASTER-0
      298     2776                  MESSAGE: Designated CPU is the MASTER
      299     2777                  DESCRIPTION: THE MASTER CPU MAY NOT BE  RELEASED. */
      300     2778        /*E*      ERROR: TDP-E$SCUNOTVALID-0
      301     2779                  MESSAGE: Designated SCU may not be released
      302     2780                  DESCRIPTION: LOW MEMORY MAY NOT BE  RELEASED. */
      303     2781        /*E*      ERROR: TDP-E$SCUPAGESINUSE-0
      304     2782                  MESSAGE: Pages in Designated SCU are in use; SCU not released
      305     2783                  DESCRIPTION: A DIE IS REQUIRE TO RELEASE SCU. */
      306     2784        /*E*      ERROR: TDP-E$SCUCMDNOTVALID-0
      307     2785                  MESSAGE: SCU option is only supported on the DPS 8000
      308     2786                  DESCRIPTION: Use PART/RET PAGE to release or return memory */
      309     2787        /*E*      ERROR: TDP-E$SCUNOTRETURNED-0
      310     2788                  MESSAGE: Designated SCU was not returned
      311     2789                  DESCRIPTION: DPS8000 must be split, STATE SCU command failed*/
      312     2790        /*E*      ERROR: TDP-E$SCUNOTCONFIG-0
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:43   
      313     2791                  MESSAGE: Designated SCU is not configured
      314     2792           DESCRIPTION: Operating system was not booted with half released configuration */
      315     2793        /*E*      ERROR: TDP-E$CPUNOTRETURNED-0
      316     2794                  MESSAGE: Designated CPU was not returned
      317     2795                  DESCRIPTION: DPS8000 must be split, STATE CPU command failed*/
      318     2796        /*E*      ERROR: TDP-E$IOMNOTRETURNED-0
      319     2797                  MESSAGE: Designated IOM was not returned
      320     2798                  DESCRIPTION: DPS8000 must be split, STATE command failed*/
      321     2799        /*E*      ERROR: TDP-E$IOMNOTRELEASED-0
      322     2800                  MESSAGE: Designated IOM was not released
      323     2801                  DESCRIPTION: DPS8000 must be split, STATE command failed*/
      324     2802        /*E*      ERROR: TDP-E$CPUNOTRELEASED-0
      325     2803                  MESSAGE: Designated CPU was not released
      326     2804                  DESCRIPTION: DPS8000 must be split, STATE CPU command failed*/
      327     2805        /*E*      ERROR: TDP-E$SCUNOTRELEASED-0
      328     2806                  MESSAGE: Designated SCU was not released
      329     2807                  DESCRIPTION: DPS8000 must be split, STATE SCU command failed*/
      330     2808        /*E*      ERROR: TDP-E$CPUDIAGERR-0
      331     2809                  MESSAGE: Another user or CPU is in diagnostic mode;                 */
      332     2810        /*E*      ERROR: TDP-E$CPUASSIGNERR-0
      333     2811                  MESSAGE: Requested CPU not in diagnostic mode               */
      334     2812    1   BADRET: PROC(ERRCODE,SEVERITY);

   2812  1 000714   200016 741300       BADRET       STX1  ! ERROR+3,,AUTO

      335     2813    2   DCL ERRCODE UBIN(36);
      336     2814    2   DCL SEVERITY UBIN(36);
      337     2815    2           B$JIT$->B$JIT.ERR='240420000000'O;

   2815  1 000715   000001 236000 0                  LDQ     1
         1 000716   000000 470400 xsym               LDP0    B$JIT$
         1 000717   000012 756100                    STQ     10,,PR0

      338     2816    2           B$JIT$->B$JIT.ERR.CODE=ERRCODE;

   2816  1 000720   200017 471500                    LDP1    @ERRCODE,,AUTO
         1 000721   100000 236100                    LDQ     0,,PR1
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:44   
         1 000722   000003 736000                    QLS     3
         1 000723   000012 676100                    ERQ     10,,PR0
         1 000724   377770 376007                    ANQ     131064,DL
         1 000725   000012 656100                    ERSQ    10,,PR0

      339     2817    2           B$JIT$->B$JIT.ERR.SEV=SEVERITY;

   2817  1 000726   200020 473500                    LDP3    @SEVERITY,,AUTO
         1 000727   300000 236100                    LDQ     0,,PR3
         1 000730   000012 676100                    ERQ     10,,PR0
         1 000731   000007 376007                    ANQ     7,DL
         1 000732   000012 656100                    ERSQ    10,,PR0

      340     2818    2           CALL UDB$PMMEXIT;

   2818  1 000733   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000734   000000 701000 xent               TSX1    UDB$PMMEXIT
         1 000735   000000 011000                    NOP     0

      341     2819    2   END BADRET;

   2819  1 000736   200016 221300                    LDX1  ! ERROR+3,,AUTO
         1 000737   000001 702211                    TSX2  ! 1,X1

      342     2820    1   END TDP$PMME;

   2820  1 000740   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   0     000   240420 400004   240420 000000                                    ........

(unnamed)
 Sect OctLoc
   2     000   000000 001605   000002 006000   000000 006000   000000 006000    ................
   2     004   000000 000074   000027 006000   000003 006000   000004 006000    ...<............
   2     010   000000 001606   000006 006000   000010 006000   000000 001622    ................
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:45   
   2     014   000013 006000   000000 001623   000015 006000   000000 001624    ................
   2     020   000017 006000   000000 001625   000021 006000                    ............
      343     2821        %EOD;

PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:46   
--  Include file information  --

   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   SS_CNTRLD_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_CNTRL_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_R.:E05TOU  cannot be made into a system file and is referenced.
   TD$CP6V_C.:E05TOU  is referenced.
   EL_DATA_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   M_INFO_C.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   EL$TABLES.:E05TOU  is referenced.
   EL_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure TDP$PMME.
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:47   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @CODE                     17-0-0/w PTR         r     1 @ERRCODE
    20-0-0/w PTR         r     1 @SEVERITY                  6-0-0/w PTR         r     1 BUF$
    *0-0-0/w SBIN        r     1 CODE                      10-0-0/w SBIN        r     1 CPU#
     5-0-0/w UBIN        r     1 CVMPG                      4-0-0/w UBIN        r     1 DSIZ
     7-0-0/w UBIN        r     1 ERR                       *0-0-0/w UBIN        r     1 ERRCODE
    13-0-0/b STRC        r     1 ERROR                     *0-0-0/w UBIN        r     1 SEVERITY
    11-0-0/w BIT (72)    r     1 SYSCON_RESULT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$PS0$
     0-0-0/w PTR         r     1 B$PS1$                     0-0-0/w PTR         r     1 B$WINDOW$
     0-0-0/w SBIN        r     1 EL_BUSY                    0-0-0/w UBIN        r     1 EL_CURBUF
     0-0-0/w SBIN        r     1 EL_ERRCT                   0-0-0/w UBIN        r     1 EL_FIRSTBUF
     0-0-0/w SBIN        r     1 EL_FULLBUFS                0-0-0/w SBIN        r     1 EL_NUMPGS
     0-0-0/w PTR         r     1 S$CU$                      0-0-0/w UBIN        r     1 S_CUN
     0-0-0/w SBIN        r     1 S_MPSTATE(0:7)
     0-0-0/w UBIN        r     1 S_NSCPU
     0-0-0/w UBIN        r     1 S_PORTNR(0:7)
     0-0-0/w SBIN        r     1 S_PTYPE(0:7)
     0-0-0/w SBIN        r     1 S_STOP(0:7)                0-0-0/w UBIN        r     1 S_TDCPU#
     0-0-0/w SBIN        r     1 S_TDCPUF                   0-0-0/w UBIN        r     1 S_TDCPUJ

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:48   

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d STRC(576)   r     1 B$U
     0-0-0/w STRC(36864) r     1 BUF                        0-0-0/d STRC(118)   r     1 FPT$SYSCON_V
     0-0-0/d STRC(144)   r     1 FPT$TDREQCPU_V             0-0-0/w BIT (72)    r     1 VLR_SYSCON
     0-0-0/d STRC(144)   r     1 WRFPT


   Procedure TDP$PMME requires 481 words for executable code.
   Procedure TDP$PMME requires 24 words of local(AUTO) storage.
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:49   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:50   
          MINI XREF LISTING

B$DO.ECCINFO
      2468**DCL      2469--REDEF
B$JIT.ERR
       360**DCL      2658<<ASSIGN   2751<<ASSIGN   2815<<ASSIGN
B$JIT.ERR.CODE
       361**DCL      2659<<ASSIGN   2816<<ASSIGN
B$JIT.ERR.MID
       361**DCL       361--REDEF
B$JIT.ERR.SEV
       361**DCL      2817<<ASSIGN
B$JIT.IDELTAT
       454**DCL      2729<<ASSIGN
B$JIT.PNR
       455**DCL       455--REDEF
B$JIT$
        39**DCL       355--IMP-PTR  2658>>ASSIGN   2659>>ASSIGN   2729>>ASSIGN   2751>>ASSIGN   2815>>ASSIGN
      2816>>ASSIGN   2817>>ASSIGN
B$PS0$
       464**DCL      2607>>ASSIGN   2644>>IF       2654>>CALL     2654>>CALL     2654>>CALL     2654>>CALL
      2681>>DOCASE   2692>>IF       2692>>IF       2696>>IF       2705>>IF       2718>>IF       2725>>IF
      2742>>CALL     2762>>IF
B$PS1$
       465**DCL      2654>>CALL     2744>>ASSIGN
B$U.CPU
      2433**DCL      2685<<ASSIGN   2728<<ASSIGN   2733<<ASSIGN
B$U.MISC
      2447**DCL      2448--REDEF
B$USER.MISC
      2523**DCL      2524--REDEF
B$WINDOW$
      1934**DCL      2581>>ASSIGN
BADCVM
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:51   
      2620**LABEL    2580--CALLALT  2585--CALLALT  2616--CALLALT
BADRET
      2812**PROC     2569--CALL     2592--CALL     2600--CALL     2631--CALL     2700--CALL     2704--CALL
      2711--CALL     2721--CALL     2724--CALL     2750--CALL     2764--CALL
BUF
      1932**DCL      2607<<ASSIGN   2607>>ASSIGN
BUF.COUNT
      1932**DCL      2583>>IF
BUF.NXTBUF
      1932**DCL      2610>>ASSIGN   2614>>ASSIGN
BUF$
      1930**DCL      1932--IMP-PTR  2581<<ASSIGN   2583>>IF       2607>>ASSIGN   2610>>ASSIGN   2614>>ASSIGN
CODE
        19**DCL        15--PROC     2555>>DOCASE
CPU#
      2537**DCL      2695<<DOINDEX  2696>>IF       2696>>IF       2696>>IF       2703>>IF       2703>>IF
      2710>>IF       2714>>ASSIGN   2723>>IF       2728>>ASSIGN   2761<<DOINDEX  2762>>IF
CVMPG
      1606**DCL      2578<<ASSIGN   2580<>CALL     2617<>CALL
DSIZ
      1593**DCL      2595<>CALL     2596>>IF       2643<>CALL     2644>>IF
ELA$SYSLOG
        29**DCL-ENT  2654--CALL
EL_BUSY
      1604**DCL      2576<>CALL     2590<>CALL     2598<>CALL     2624<>CALL     2629<>CALL
EL_CURBUF
      1605**DCL      2583>>IF       2609>>IF       2610<<ASSIGN
EL_ERRCT
      1605**DCL      2567<<ASSIGN   2587<<ASSIGN
EL_FIRSTBUF
      1604**DCL      2566>>IF       2578>>ASSIGN   2583>>IF       2609>>IF       2614<<ASSIGN
EL_FULLBUFS
      1604**DCL      2612<<ASSIGN   2612>>ASSIGN
EL_NUMPGS
      1604**DCL      2620<<ASSIGN   2620>>ASSIGN
ERR
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:52   
      2218**DCL      2580<>CALL     2585<>CALL     2616<>CALL     2631<>CALL     2645<<ASSIGN   2654<>CALL
      2659>>ASSIGN   2743<>CALL     2744>>IF
ERRCODE IN PROCEDURE BADRET
      2813**DCL      2812--PROC     2816>>ASSIGN
ERROR
      2549**DCL      2742<>CALL     2750<>CALL     2751>>ASSIGN
ERROR.FCG
      2550**DCL      2750>>IF
FPT$SYSCON_V
      2544**DCL      2742<>CALL
FPT$SYSCON_V.IOM
      2544**DCL      2544--REDEF    2544--REDEF
FPT$TDREQCPU_V.CPU
      2539**DCL      2692>>IF       2762>>IF
FPT$TDREQCPU_V.MODE
      2539**DCL      2681>>DOCASE
FPT$TDREQCPU_V.TYPE
      2539**DCL      2696>>IF
FPT$TDREQCPU_V.XEQ
      2539**DCL      2692>>IF       2705>>IF       2718>>IF       2725>>IF
HFC$LOCK
      2217**DCL-ENT  2576--CALL
HFC$UNLOCK
      2217**DCL-ENT  2590--CALL     2598--CALL     2624--CALL     2629--CALL
HFF$DSIZ
        33**DCL-ENT  2595--CALL     2643--CALL     2743--CALL
MMD$RSPP
        31**DCL-ENT  2617--CALL
MME$CVM
        30**DCL-ENT  2580--CALL     2585--CALL     2616--CALL
NIE$PMME
        28**DCL-ENT  2740--CALL
PROC#
      2760**PROC     2702--CALL     2722--CALL
RESET
      2733**LABEL    2690--GOTO
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:53   
S$CU$
      2534**DCL      2685>>ASSIGN   2728>>ASSIGN   2733>>ASSIGN
SEVERITY IN PROCEDURE BADRET
      2814**DCL      2812--PROC     2817>>ASSIGN
SSS$CACHE
        34**DCL-ENT  2568--CALL     2579--CALL     2584--CALL     2588--CALL     2594--CALL     2615--CALL
      2622--CALL
SSS$CACHEBP
        35**DCL-ENT  2565--CALL     2582--CALL     2586--CALL     2608--CALL     2618--CALL
SYSCON_ALT
      2742**LABEL    2742--CALLALT
SYSCON_RESULT
      2547**DCL      2742<>CALL     2744>>ASSIGN
S_CUN
      2316**DCL      2683>>IF       2710>>IF       2713>>ASSIGN   2720>>IF       2726>>ASSIGN
S_MPSTATE
      2302**DCL      2696>>IF       2703>>IF
S_NSCPU
      2303**DCL      2695>>DOINDEX  2761>>DOINDEX
S_PORTNR
      2302**DCL      2762>>IF
S_PTYPE
      2303**DCL      2696>>IF
S_STOP
      2302**DCL      2696>>IF       2703>>IF
S_TDCPU#
      2304**DCL      2689<<ASSIGN   2710>>IF       2714<<ASSIGN   2723>>IF
S_TDCPUF
      2304**DCL      2683>>IF       2688<<ASSIGN   2708>>IF       2710>>IF       2713<<ASSIGN   2720>>IF
S_TDCPUJ
      2304**DCL      2726<<ASSIGN   2734<<ASSIGN
TDM$MIRROR
        23**DCL-ENT  2746--CALL
TDP$CLOSE
        25**DCL-ENT  2677--CALL
TDP$OPEN
PL6.E3A0      #001=TDP$PMME File=TDP$PMME.:E05TSI                                WED 07/30/97 06:03 Page:54   
        24**DCL-ENT  2675--CALL
TDP$SYSCON
        27**DCL-ENT  2742--CALL
TDP$TDIO
        26**DCL-ENT  2679--CALL
TDREQCPU_SET
      2728**LABEL    2698--GOTO     2706--GOTO
UDB$PMMEXIT
        32**DCL-ENT  2752--CALL     2818--CALL
VLR_SYSCON
      2548**DCL      2744<<ASSIGN
WRALT
      2658**LABEL    2652--GOTO     2654--CALLALT
WRFPT
      2270**DCL      2654<>CALL
WRFPT.FILENUM
      2270**DCL      2654<>CALL
WRFPT.MMINHIB
      2270**DCL      2654<>CALL
WRFPT.SIZE
      2270**DCL      2644>>IF       2654<>CALL
WRFPT.TYPE
      2270**DCL      2654<>CALL

PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:55   
      344        1        /*M* TDP$CLOSE - M$TDCLOSE PMME HANDLER */
      345        2        /*T***********************************************************/
      346        3        /*T*                                                         */
      347        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      348        5        /*T*                                                         */
      349        6        /*T***********************************************************/
      350        7        /**/
      351        8        TDP$CLOSE: PROC;
      352        9        /*
      353       10                Includes
      354       11        */
      355       12        %INCLUDE                        B$JIT ;
      356      615        %INCLUDE                        B$MAP ;
      357      714        %INCLUDE                        B$USER ;
      358      930        %INCLUDE                        B_STRINGS_C ;
      359     1059        %INCLUDE                        CP_6_SUBS ;
      360     1599        %INCLUDE                        F$DCBM ;
      361     1658        %INCLUDE                        HF_LOCK_C ;
      362     1672        %INCLUDE                        KI_DATA_R ;
      363     1698        %INCLUDE                        KI_MACROS_C ;
      364     2306        %INCLUDE                        M_INFO_C ;
      365     2446        %INCLUDE                        NI_DATA_C ;
      366     2559        %INCLUDE                        NI_DATA_R ;
      367     2996        %INCLUDE                        NI_MACROS_C ;
      368     3263        %INCLUDE                        N_FC_C ;
      369     3300        %INCLUDE                        SS_SCHED_C ;
      370     3533        %INCLUDE                        TD_ERRORS_C ;
      371     3616        /*
      372     3617                Entries
      373     3618        */
      374     3619    1   DCL 1 FMB$IOSPIN                ENTRY ;
      375     3620    1   DCL 1 FSA$FSP                   ENTRY(2) ALTRET ;
      376     3621    1   DCL 1 NIQ$GET                   ENTRY (1) ALTRET ;
      377     3622    1   DCL 1 NIO$QUE                   ENTRY (1) ALTRET ;
      378     3623    1   DCL 1 MMS$VREL                  ENTRY(2) ALTRET ;
      379     3624    1   DCL 1 NIW$LDFW                  ENTRY (2) ALTRET ;
      380     3625    1   DCL 1 NIW$MPCSTART              ENTRY(1) ;
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:56   
      381     3626    1   DCL 1 SSR$REG                   ENTRY(3) ALTRET ;
      382     3627    1   DCL 1 TDU$FINDPATH              ENTRY(6) ALTRET ;
      383     3628        /*
      384     3629                Symrefs
      385     3630        */
      386     3631    1   DCL 1 B$CPGT1$                  PTR SYMREF ;
      387     3632    1   DCL 1 B$JIT$                    PTR SYMREF ;
      388     3633    1   DCL 1 B$PS0$                    PTR SYMREF ;
      389     3634        %B$USERREFS ;
      390     3638    1   DCL 1 SL_MF(0:3)                SBIN SYMREF ;
      391     3639    1   DCL 1 TD_RELEASE_IDCW           BIT(36) SYMREF ;
      392     3640        /*
      393     3641                Auto
      394     3642        */
      395     3643    1   DCL 1 CPT$                      PTR ALIGNED ;
      396     3644    1   DCL 1 DCB$                      PTR ALIGNED ;
      397     3645    1   DCL 1 DCT$                      PTR ALIGNED ;
      398     3646    1   DCL 1 DQH$                      PTR ALIGNED ;
      399     3647    1   DCL 1 ERRCODE                   UBIN ALIGNED ;
      400     3648    1   DCL 1 FEI$                      PTR ALIGNED ;
      401     3649    1   DCL 1 I                         SBIN ALIGNED ;
      402     3650    1   DCL 1 IOS$                      PTR ALIGNED ;
      403     3651    1   DCL 1 MPC$                      PTR ALIGNED ;
      404     3652    1   DCL 1 SQH$                      PTR ALIGNED ;
      405     3653    1   DCL 1 REQ$                      PTR ALIGNED ;
      406     3654    1   DCL 1 X                         SBIN ALIGNED ;
      407     3655        /*
      408     3656                Based
      409     3657        */
      410     3658        %F$DCB                          ( DCBN=FDCB,     BASED="BASED(DCB$)"   ) ;
      411     3715        %NI$DCT                         ( NAME=DCT,      STCLASS=BASED         ) ;
      412     3763        %NI$DQH                         ( NAME=DQH,      STCLASS=BASED         ) ;
      413     3786        %KI$FEI                         (                STCLASS="BASED(FEI$)" ) ;
      414     3870        %NI$EXTST                       ( NAME=NI$EXTST, STCLASS=BASED         ) ;
      415     3904    1   DCL 1 PBASE$                    PTR BASED ;
      416     3905        %N$REQ                          ( NAME=REQ,      STCLASS="BASED(REQ$)" ) ;
      417     3963        %NI$SQH                         ( NAME=SQH,      STCLASS="BASED(SQH$)" ) ;
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:57   
      418     3976        /*
      419     3977                Constants
      420     3978        */
      421     3979        %EQU FPMC#=%BINBIT(FPMC,18) ;
      422     3980        %EJECT ;
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:58   
      423     3981    1           DCB$=B$JIT.DCB$;
      424     3982    2           IF FDCB.FUN# = %TD_TEST_MCA THEN DO;
      425     3983    2              CALL TDU$FINDPATH(FDCB.DEVADR,'0'B,DCT$,SQH$,DQH$,MPC$) ALTRET(TDNODEV);
      426     3984    3              IF DCT$->DCT.MCA.USER# ~= B$JIT.USER THEN DO;
      427     3985    3                 ERRCODE=%E$TDMCANOTUSER;
      428     3986    3                 GOTO BADRET;
      429     3987    3                 END;
      430     3988    2              DCT$->DCT.MCA.USER# = 0;
      431     3989                   %LOCK(G#=SQH.GATE);
      432     3992    3              IF NOT DCT$->DCT.MCA.RESERVED THEN DO;
      433     3993                      %UNLOCK(G#=SQH.GATE);
      434     3996    3                 ERRCODE=%E$TDMCANOTRESERVED;
      435     3997    3                 GOTO BADRET;
      436     3998    3                 END;
      437     3999    2              DCT$->DCT.MCA.RESERVED = '0'B;
      438     4000                   %UNLOCK(G#=SQH.GATE);
      439     4003    2              END;
      440     4004    2           IF FDCB.ASN#~=%T@D# THEN DO;
      441     4005    2              ERRCODE=%E$TDNOTDCB;
      442     4006    2   BADRET:
      443     4007    2              B$JIT.ERR='240420000000'O;
      444     4008    2              B$JIT.ERR.CODE=ERRCODE;
      445     4009    2              B$JIT.ERR.SEV=4;
      446     4010    2              RETURN;
      447     4011    2              END;
      448     4012    2           IF NOT FDCB.FCD# THEN DO;
      449     4013    2              ERRCODE=%E$TDNOTOPEN;
      450     4014    2              GOTO BADRET;
      451     4015    2              END;
      452     4016    2           IF FDCB.FCN.CNT(0)~=0 THEN DO;
      453     4017    2              FDCB.WAIT=0;
      454     4018    2              CALL FMB$IOSPIN;
      455     4019    2              END;
      456     4020    2           IF FDCB.FCN.CNT(1)~=0 THEN DO;
      457     4021    2              FDCB.WAIT=1;
      458     4022    2              CALL FMB$IOSPIN;
      459     4023    2              END;
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:59   
      460     4024    1           MPC$=FDCB.MPC$;
      461     4025    2           IF FDCB.FUN#=%TD_TEST_FEP THEN DO;
      462     4026    2              FEI$ = KI$FEI$(FDCB.DEVADR.DVN#);
      463     4027    2              CALL MMS$VREL(KI$FEI.FEWSQ ,KI$FEI.BD$ );
      464     4028    2              FDCB.DQH$->DQH.USER#=0;
      465     4029    2              END;
      466     4030    2           ELSE DO;
      467     4031    2              FDCB.DCT$->DCT.STATUS.TND=0;
      468     4032    2              FDCB.DCT$->DCT.SPEVENT=0;
      469     4033    2              END;
      470     4034    1           FDCB.DQH$->DQH.STATUS.TND=0;
      471     4035    2           DO CASE(FDCB.FUN#);
      472     4036    2            CASE(%TD_TEST_ITR);
      473     4037    2              MPC$->DCT.STATUS.TND=0;
      474     4038    2              MPC$->DCT.DFLG.MPCSUSPENDED='0'B;
      475     4039    2              CALL NIW$LDFW(MPC$->DCT,'0'B);
      476     4040    2            CASE(%TD_TEST_MDR);
      477     4041    2              MPC$->DCT.DFLG.MPCSTOP='1'B;
      478     4042    2              SQH$=MPC$->DCT.SQH$;
      479     4043    3              DO I=0 TO 1;
      480     4044    4                 IF SQH.MPC$(I)=MPC$ THEN DO;
      481     4045    4                    CALL NIW$MPCSTART(SQH.MPC$(I)->DCT);
      482     4046    5                    IF SQH.MPC$(I)->DCT.MPC.ALTMPCX~=0 THEN DO;
      483     4047    5                       CALL NIW$MPCSTART(N$DCT$(SQH.MPC$(I)->DCT.MPC.ALTMPCX)->DCT);
      484     4048    5                       END;
      485     4049    4                    END;
      486     4050    3                 END;
      487     4051    3              IF MPC$->DCT.MPC.TYPE=%DV_LP THEN DO;
      488     4052    3                 CALL NIQ$GET(REQ$);
      489     4053    3                 REQ.FC=%N_RESET;
      490     4054    3                 REQ.OPFLG=%(OP_USER|OP_WAIT);
      491     4055    3                 REQ.DCB$=DCB$;
      492     4056    3                 REQ.DLA.DCTX=MPC$->DCT.DCTX;
      493     4057    3                 CALL NIO$QUE(REQ);
      494     4058    3                 END;
      495     4059    2              MPC$->DCT.STATUS.TND=0;
      496     4060    3              IF MPC$->DCT.DFLG.MPCSUSPENDED THEN DO;
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:60   
      497     4061    3                 MPC$->DCT.DFLG.MPCSUSPENDED='0'B;
      498     4062    3                 CALL NIQ$GET(REQ$);
      499     4063    3                 REQ.DLA.DCTX=MPC$->DCT.DCTX;
      500     4064    3                 REQ.BUFSIZE=4;
      501     4065    3                 REQ.FC=%N_DCWLIST;
      502     4066    3                 REQ.OPFLG=OP_USER | OP_BPF | OP_WAIT;
      503     4067    3                 REQ.USER#=B$JIT.USER;
      504     4068    3                 REQ.DCB$=DCB$;
      505     4069    3                 REQ.BUF$=ADDR(TD_RELEASE_IDCW);
      506     4070    3                 CALL NIO$QUE(REQ);
      507     4071    3                 END/* IF SUSPENDED */;
      508     4072    2            END/* CASE TEST# */;
      509     4073    1           FDCB.DCT$=ADDR(NIL);
      510     4074    1           FDCB.DQH$=ADDR(NIL);
      511     4075    1           FDCB.MPC$=ADDR(NIL);
      512     4076    1           IF FDCB.TDEXTST$ ~= ADDR(NIL) THEN /* NOT SET UP FOR FEPS             */
      513     4077    1              CALL FSA$FSP(SIZEW(NI$EXTST),FDCB.TDEXTST$);
      514     4078    1           FDCB.TDEXTST$=ADDR(NIL);
      515     4079    1           FDCB.CFU$ = ADDR(NIL);
      516     4080    1           FDCB.FCI#=FDCB.FCD#;
      517     4081    1           FDCB.FCD#='0'B;
      518     4082    1           RETURN;
      519     4083    1   TDNODEV:
      520     4084    1           ERRCODE = %E$TDNODEV;
      521     4085    1           GOTO BADRET;
      522     4086    1   END TDP$CLOSE;
      523     4087        %EOD;

PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:61   
--  Include file information  --

   TD_ERRORS_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   F$DCBM.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure TDP$CLOSE.

   Procedure TDP$CLOSE requires 299 words for executable code.
   Procedure TDP$CLOSE requires 22 words of local(AUTO) storage.

PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:62   

 Object Unit name= TDP$CLOSE                                  File name= TDP$PMME.:E05TOU
 UTS= JUL 30 '97 06:03:59.24 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  TDP$CLOSE
    1   Proc  even  none   299    453  TDP$CLOSE
    2  RoData even  none    10     12  TDP$CLOSE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        0  TDP$CLOSE

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       6 TDU$FINDPATH
         yes           Std       1 HFC$UNLOCK
         yes           Std       0 FMB$IOSPIN
 yes     yes           Std       1 NIO$QUE
         yes           Std       1 HFC$LOCK
 yes     yes           Std       2 MMS$VREL
 yes     yes           Std       1 NIQ$GET
 yes     yes           Std       2 NIW$LDFW
 yes     yes           Std       2 FSA$FSP
         yes           Std       1 NIW$MPCSTART
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:63   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KI_FEI$$                              N$DCT$$                               N$FQ$
     NI$FQ$                                NI$IBUF$                              NI$RP$
     B$JIT$                                TD_RELEASE_IDCW                       B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:64   


      344        1        /*M* TDP$CLOSE - M$TDCLOSE PMME HANDLER */
      345        2        /*T***********************************************************/
      346        3        /*T*                                                         */
      347        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      348        5        /*T*                                                         */
      349        6        /*T***********************************************************/
      350        7        /**/
      351        8        TDP$CLOSE: PROC;

      8  1 000000   000000 700200 xent  TDP$CLOSE    TSX0  ! X66_AUTO_0
         1 000001   000026 000000                    ZERO    22,0

      352        9        /*
      353       10                Includes
      354       11        */
      355       12        %INCLUDE                        B$JIT ;
      356      615        %INCLUDE                        B$MAP ;
      357      714        %INCLUDE                        B$USER ;
      358      930        %INCLUDE                        B_STRINGS_C ;
      359     1059        %INCLUDE                        CP_6_SUBS ;
      360     1599        %INCLUDE                        F$DCBM ;
      361     1658        %INCLUDE                        HF_LOCK_C ;
      362     1672        %INCLUDE                        KI_DATA_R ;
      363     1698        %INCLUDE                        KI_MACROS_C ;
      364     2306        %INCLUDE                        M_INFO_C ;
      365     2446        %INCLUDE                        NI_DATA_C ;
      366     2559        %INCLUDE                        NI_DATA_R ;
      367     2996        %INCLUDE                        NI_MACROS_C ;
      368     3263        %INCLUDE                        N_FC_C ;
      369     3300        %INCLUDE                        SS_SCHED_C ;
      370     3533        %INCLUDE                        TD_ERRORS_C ;
      371     3616        /*
      372     3617                Entries
      373     3618        */
      374     3619    1   DCL 1 FMB$IOSPIN                ENTRY ;
      375     3620    1   DCL 1 FSA$FSP                   ENTRY(2) ALTRET ;
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:65   
      376     3621    1   DCL 1 NIQ$GET                   ENTRY (1) ALTRET ;
      377     3622    1   DCL 1 NIO$QUE                   ENTRY (1) ALTRET ;
      378     3623    1   DCL 1 MMS$VREL                  ENTRY(2) ALTRET ;
      379     3624    1   DCL 1 NIW$LDFW                  ENTRY (2) ALTRET ;
      380     3625    1   DCL 1 NIW$MPCSTART              ENTRY(1) ;
      381     3626    1   DCL 1 SSR$REG                   ENTRY(3) ALTRET ;
      382     3627    1   DCL 1 TDU$FINDPATH              ENTRY(6) ALTRET ;
      383     3628        /*
      384     3629                Symrefs
      385     3630        */
      386     3631    1   DCL 1 B$CPGT1$                  PTR SYMREF ;
      387     3632    1   DCL 1 B$JIT$                    PTR SYMREF ;
      388     3633    1   DCL 1 B$PS0$                    PTR SYMREF ;
      389     3634        %B$USERREFS ;
      390     3638    1   DCL 1 SL_MF(0:3)                SBIN SYMREF ;
      391     3639    1   DCL 1 TD_RELEASE_IDCW           BIT(36) SYMREF ;
      392     3640        /*
      393     3641                Auto
      394     3642        */
      395     3643    1   DCL 1 CPT$                      PTR ALIGNED ;
      396     3644    1   DCL 1 DCB$                      PTR ALIGNED ;
      397     3645    1   DCL 1 DCT$                      PTR ALIGNED ;
      398     3646    1   DCL 1 DQH$                      PTR ALIGNED ;
      399     3647    1   DCL 1 ERRCODE                   UBIN ALIGNED ;
      400     3648    1   DCL 1 FEI$                      PTR ALIGNED ;
      401     3649    1   DCL 1 I                         SBIN ALIGNED ;
      402     3650    1   DCL 1 IOS$                      PTR ALIGNED ;
      403     3651    1   DCL 1 MPC$                      PTR ALIGNED ;
      404     3652    1   DCL 1 SQH$                      PTR ALIGNED ;
      405     3653    1   DCL 1 REQ$                      PTR ALIGNED ;
      406     3654    1   DCL 1 X                         SBIN ALIGNED ;
      407     3655        /*
      408     3656                Based
      409     3657        */
      410     3658        %F$DCB                          ( DCBN=FDCB,     BASED="BASED(DCB$)"   ) ;
      411     3715        %NI$DCT                         ( NAME=DCT,      STCLASS=BASED         ) ;
      412     3763        %NI$DQH                         ( NAME=DQH,      STCLASS=BASED         ) ;
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:66   
      413     3786        %KI$FEI                         (                STCLASS="BASED(FEI$)" ) ;
      414     3870        %NI$EXTST                       ( NAME=NI$EXTST, STCLASS=BASED         ) ;
      415     3904    1   DCL 1 PBASE$                    PTR BASED ;
      416     3905        %N$REQ                          ( NAME=REQ,      STCLASS="BASED(REQ$)" ) ;
      417     3963        %NI$SQH                         ( NAME=SQH,      STCLASS="BASED(SQH$)" ) ;
      418     3976        /*
      419     3977                Constants
      420     3978        */
      421     3979        %EQU FPMC#=%BINBIT(FPMC,18) ;
      422     3980        %EJECT ;
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:67   
      423     3981    1           DCB$=B$JIT.DCB$;

   3981  1 000002   000000 470400 xsym               LDP0    B$JIT$
         1 000003   000232 236100                    LDQ     154,,PR0
         1 000004   200004 756100                    STQ     DCB$,,AUTO

      424     3982    2           IF FDCB.FUN# = %TD_TEST_MCA THEN DO;

   3982  1 000005   200004 471500                    LDP1    DCB$,,AUTO
         1 000006   100032 236100                    LDQ     26,,PR1
         1 000007   000777 376003                    ANQ     511,DU
         1 000010   000007 116003                    CMPQ    7,DU
         1 000011   000072 601000 1                  TNZ     s:4004

      425     3983    2              CALL TDU$FINDPATH(FDCB.DEVADR,'0'B,DCT$,SQH$,DQH$,MPC$) ALTRET(TDNODEV);

   3983  1 000012   200013 633500                    EPPR3   MPC$,,AUTO
         1 000013   200025 453500                    STP3    REQ$+8,,AUTO
         1 000014   200006 634500                    EPPR4   DQH$,,AUTO
         1 000015   200024 454500                    STP4    REQ$+7,,AUTO
         1 000016   200014 635500                    EPPR5   SQH$,,AUTO
         1 000017   200023 455500                    STP5    REQ$+6,,AUTO
         1 000020   200005 636500                    EPPR6   DCT$,,AUTO
         1 000021   200022 456500                    STP6    REQ$+5,,AUTO
         1 000022   000000 236000 2                  LDQ     0
         1 000023   200021 756100                    STQ     REQ$+4,,AUTO
         1 000024   200004 236100                    LDQ     DCB$,,AUTO
         1 000025   000001 036000 2                  ADLQ    1
         1 000026   200020 756100                    STQ     REQ$+3,,AUTO
         1 000027   200020 630500                    EPPR0   REQ$+3,,AUTO
         1 000030   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 000031   000000 701000 xent               TSX1    TDU$FINDPATH
         1 000032   000450 702000 1                  TSX2    TDNODEV

      426     3984    3              IF DCT$->DCT.MCA.USER# ~= B$JIT.USER THEN DO;

   3984  1 000033   200005 470500                    LDP0    DCT$,,AUTO
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:68   
         1 000034   000000 471400 xsym               LDP1    B$JIT$
         1 000035   100000 236100                    LDQ     0,,PR1
         1 000036   000022 772000                    QRL     18
         1 000037   000777 376007                    ANQ     511,DL
         1 000040   000031 116100                    CMPQ    25,,PR0
         1 000041   000045 600000 1                  TZE     s:3988

      427     3985    3                 ERRCODE=%E$TDMCANOTUSER;

   3985  1 000042   001664 235007                    LDA     948,DL
         1 000043   200007 755100                    STA     ERRCODE,,AUTO

      428     3986    3                 GOTO BADRET;

   3986  1 000044   000101 710000 1                  TRA     BADRET

      429     3987    3                 END;
      430     3988    2              DCT$->DCT.MCA.USER# = 0;

   3988  1 000045   000031 450100                    STZ     25,,PR0

      431     3989                   %LOCK(G#=SQH.GATE);

   3990  1 000046   200014 630500                    EPPR0   SQH$,,AUTO
         1 000047   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000050   000000 701000 xent               TSX1    HFC$LOCK
         1 000051   000000 011000                    NOP     0

      432     3992    3              IF NOT DCT$->DCT.MCA.RESERVED THEN DO;

   3992  1 000052   200005 470500                    LDP0    DCT$,,AUTO
         1 000053   000030 234100                    SZN     24,,PR0
         1 000054   000064 604000 1                  TMI     s:3999

      433     3993                      %UNLOCK(G#=SQH.GATE);

   3994  1 000055   200014 630500                    EPPR0   SQH$,,AUTO
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:69   
         1 000056   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000057   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000060   000000 011000                    NOP     0

      434     3996    3                 ERRCODE=%E$TDMCANOTRESERVED;

   3996  1 000061   001663 235007                    LDA     947,DL
         1 000062   200007 755100                    STA     ERRCODE,,AUTO

      435     3997    3                 GOTO BADRET;

   3997  1 000063   000101 710000 1                  TRA     BADRET

      436     3998    3                 END;
      437     3999    2              DCT$->DCT.MCA.RESERVED = '0'B;

   3999  1 000064   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 000065   000030 356100                    ANSQ    24,,PR0

      438     4000                   %UNLOCK(G#=SQH.GATE);

   4001  1 000066   200014 630500                    EPPR0   SQH$,,AUTO
         1 000067   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000070   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000071   000000 011000                    NOP     0

      439     4003    2              END;

      440     4004    2           IF FDCB.ASN#~=%T@D# THEN DO;

   4004  1 000072   200004 470500                    LDP0    DCB$,,AUTO
         1 000073   000032 236100                    LDQ     26,,PR0
         1 000074   777000 376007                    ANQ     -512,DL
         1 000075   006000 116007                    CMPQ    3072,DL
         1 000076   000116 600000 1                  TZE     s:4012

      441     4005    2              ERRCODE=%E$TDNOTDCB;
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:70   

   4005  1 000077   001616 235007                    LDA     910,DL
         1 000100   200007 755100                    STA     ERRCODE,,AUTO

      442     4006    2   BADRET:
      443     4007    2              B$JIT.ERR='240420000000'O;

   4007  1 000101   000000 236000 0     BADRET       LDQ     0
         1 000102   000000 470400 xsym               LDP0    B$JIT$
         1 000103   000012 756100                    STQ     10,,PR0

      444     4008    2              B$JIT.ERR.CODE=ERRCODE;

   4008  1 000104   200007 236100                    LDQ     ERRCODE,,AUTO
         1 000105   000003 736000                    QLS     3
         1 000106   000012 676100                    ERQ     10,,PR0
         1 000107   377770 376007                    ANQ     131064,DL
         1 000110   000012 656100                    ERSQ    10,,PR0

      445     4009    2              B$JIT.ERR.SEV=4;

   4009  1 000111   000012 236100                    LDQ     10,,PR0
         1 000112   000002 376000 2                  ANQ     2
         1 000113   000004 276007                    ORQ     4,DL
         1 000114   000012 756100                    STQ     10,,PR0

      446     4010    2              RETURN;

   4010  1 000115   000000 702200 xent               TSX2  ! X66_ARET

      447     4011    2              END;
      448     4012    2           IF NOT FDCB.FCD# THEN DO;

   4012  1 000116   000031 236100                    LDQ     25,,PR0
         1 000117   020000 316007                    CANQ    8192,DL
         1 000120   000124 601000 1                  TNZ     s:4016

PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:71   
      449     4013    2              ERRCODE=%E$TDNOTOPEN;

   4013  1 000121   001615 235007                    LDA     909,DL
         1 000122   200007 755100                    STA     ERRCODE,,AUTO

      450     4014    2              GOTO BADRET;

   4014  1 000123   000101 710000 1                  TRA     BADRET

      451     4015    2              END;
      452     4016    2           IF FDCB.FCN.CNT(0)~=0 THEN DO;

   4016  1 000124   000074 236100                    LDQ     60,,PR0
         1 000125   377000 316003                    CANQ    130560,DU
         1 000126   000134 600000 1                  TZE     s:4020

      453     4017    2              FDCB.WAIT=0;

   4017  1 000127   000003 236000 2                  LDQ     3
         1 000130   000064 356100                    ANSQ    52,,PR0

      454     4018    2              CALL FMB$IOSPIN;

   4018  1 000131   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000132   000000 701000 xent               TSX1    FMB$IOSPIN
         1 000133   000000 011000                    NOP     0

      455     4019    2              END;

      456     4020    2           IF FDCB.FCN.CNT(1)~=0 THEN DO;

   4020  1 000134   200004 470500                    LDP0    DCB$,,AUTO
         1 000135   000074 236100                    LDQ     60,,PR0
         1 000136   000377 316003                    CANQ    255,DU
         1 000137   000145 600000 1                  TZE     s:4024

      457     4021    2              FDCB.WAIT=1;
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:72   

   4021  1 000140   000020 236007                    LDQ     16,DL
         1 000141   000064 256100                    ORSQ    52,,PR0

      458     4022    2              CALL FMB$IOSPIN;

   4022  1 000142   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000143   000000 701000 xent               TSX1    FMB$IOSPIN
         1 000144   000000 011000                    NOP     0

      459     4023    2              END;

      460     4024    1           MPC$=FDCB.MPC$;

   4024  1 000145   200004 470500                    LDP0    DCB$,,AUTO
         1 000146   000050 236100                    LDQ     40,,PR0
         1 000147   200013 756100                    STQ     MPC$,,AUTO

      461     4025    2           IF FDCB.FUN#=%TD_TEST_FEP THEN DO;

   4025  1 000150   000032 236100                    LDQ     26,,PR0
         1 000151   000777 376003                    ANQ     511,DU
         1 000152   000005 116003                    CMPQ    5,DU
         1 000153   000200 601000 1                  TNZ     s:4031

      462     4026    2              FEI$ = KI$FEI$(FDCB.DEVADR.DVN#);

   4026  1 000154   000051 236100                    LDQ     41,,PR0
         1 000155   000014 772000                    QRL     12
         1 000156   000077 376007                    ANQ     63,DL
         1 000157   000000 471400 xsym               LDP1    KI_FEI$$
         1 000160   100000 236106                    LDQ     0,QL,PR1
         1 000161   200010 756100                    STQ     FEI$,,AUTO

      463     4027    2              CALL MMS$VREL(KI$FEI.FEWSQ ,KI$FEI.BD$ );

   4027  1 000162   000010 036003                    ADLQ    8,DU
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:73   
         1 000163   200021 756100                    STQ     REQ$+4,,AUTO
         1 000164   200010 236100                    LDQ     FEI$,,AUTO
         1 000165   000005 036003                    ADLQ    5,DU
         1 000166   200020 756100                    STQ     REQ$+3,,AUTO
         1 000167   200020 630500                    EPPR0   REQ$+3,,AUTO
         1 000170   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000171   000000 701000 xent               TSX1    MMS$VREL
         1 000172   000000 011000                    NOP     0

      464     4028    2              FDCB.DQH$->DQH.USER#=0;

   4028  1 000173   200004 470500                    LDP0    DCB$,,AUTO
         1 000174   000046 471500                    LDP1    38,,PR0
         1 000175   000000 236003                    LDQ     0,DU
         1 000176   100020 552120                    STBQ    16,'20'O,PR1

      465     4029    2              END;

   4029  1 000177   000205 710000 1                  TRA     s:4034

      466     4030    2           ELSE DO;

      467     4031    2              FDCB.DCT$->DCT.STATUS.TND=0;

   4031  1 000200   000047 471500                    LDP1    39,,PR0
         1 000201   000004 236000 2                  LDQ     4
         1 000202   100027 356100                    ANSQ    23,,PR1

      468     4032    2              FDCB.DCT$->DCT.SPEVENT=0;

   4032  1 000203   000047 471500                    LDP1    39,,PR0
         1 000204   100025 450100                    STZ     21,,PR1

      469     4033    2              END;

      470     4034    1           FDCB.DQH$->DQH.STATUS.TND=0;

PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:74   
   4034  1 000205   000046 471500                    LDP1    38,,PR0
         1 000206   000005 236000 2                  LDQ     5
         1 000207   100001 356100                    ANSQ    1,,PR1

      471     4035    2           DO CASE(FDCB.FUN#);

   4035  1 000210   000032 220100                    LDX0    26,,PR0
         1 000211   000777 360003                    ANX0    511,DU
         1 000212   000004 100003                    CMPX0   4,DU
         1 000213   000215 602010 1                  TNC     s:4035+5,X0
         1 000214   000414 710000 1                  TRA     s:4073
         1 000215   000414 710000 1                  TRA     s:4073
         1 000216   000414 710000 1                  TRA     s:4073
         1 000217   000221 710000 1                  TRA     s:4037
         1 000220   000236 710000 1                  TRA     s:4041

      472     4036    2            CASE(%TD_TEST_ITR);

      473     4037    2              MPC$->DCT.STATUS.TND=0;

   4037  1 000221   200013 471500                    LDP1    MPC$,,AUTO
         1 000222   000004 236000 2                  LDQ     4
         1 000223   100027 356100                    ANSQ    23,,PR1

      474     4038    2              MPC$->DCT.DFLG.MPCSUSPENDED='0'B;

   4038  1 000224   000006 236000 2                  LDQ     6
         1 000225   100006 356100                    ANSQ    6,,PR1

      475     4039    2              CALL NIW$LDFW(MPC$->DCT,'0'B);

   4039  1 000226   000000 236000 2                  LDQ     0
         1 000227   200013 235100                    LDA     MPC$,,AUTO
         1 000230   200020 757100                    STAQ    REQ$+3,,AUTO
         1 000231   200020 630500                    EPPR0   REQ$+3,,AUTO
         1 000232   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000233   000000 701000 xent               TSX1    NIW$LDFW
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:75   
         1 000234   000000 011000                    NOP     0
         1 000235   000414 710000 1                  TRA     s:4073

      476     4040    2            CASE(%TD_TEST_MDR);

      477     4041    2              MPC$->DCT.DFLG.MPCSTOP='1'B;

   4041  1 000236   200013 471500                    LDP1    MPC$,,AUTO
         1 000237   001000 236007                    LDQ     512,DL
         1 000240   100006 256100                    ORSQ    6,,PR1

      478     4042    2              SQH$=MPC$->DCT.SQH$;

   4042  1 000241   200013 471500                    LDP1    MPC$,,AUTO
         1 000242   100022 236100                    LDQ     18,,PR1
         1 000243   200014 756100                    STQ     SQH$,,AUTO

      479     4043    3              DO I=0 TO 1;

   4043  1 000244   200011 450100                    STZ     I,,AUTO

      480     4044    4                 IF SQH.MPC$(I)=MPC$ THEN DO;

   4044  1 000245   200014 470500                    LDP0    SQH$,,AUTO
         1 000246   200011 720100                    LXL0    I,,AUTO
         1 000247   000005 236110                    LDQ     5,X0,PR0
         1 000250   200013 116100                    CMPQ    MPC$,,AUTO
         1 000251   000277 601000 1                  TNZ     s:4050

      481     4045    4                    CALL NIW$MPCSTART(SQH.MPC$(I)->DCT);

   4045  1 000252   000005 471510                    LDP1    5,X0,PR0
         1 000253   200020 451500                    STP1    REQ$+3,,AUTO
         1 000254   200020 630500                    EPPR0   REQ$+3,,AUTO
         1 000255   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000256   000000 701000 xent               TSX1    NIW$MPCSTART
         1 000257   000000 011000                    NOP     0
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:76   

      482     4046    5                    IF SQH.MPC$(I)->DCT.MPC.ALTMPCX~=0 THEN DO;

   4046  1 000260   200014 470500                    LDP0    SQH$,,AUTO
         1 000261   200011 720100                    LXL0    I,,AUTO
         1 000262   000005 471510                    LDP1    5,X0,PR0
         1 000263   100035 236100                    LDQ     29,,PR1
         1 000264   000777 316007                    CANQ    511,DL
         1 000265   000277 600000 1                  TZE     s:4050

      483     4047    5                       CALL NIW$MPCSTART(N$DCT$(SQH.MPC$(I)->DCT.MPC.ALTMPCX)->DCT);

   4047  1 000266   100035 721100                    LXL1    29,,PR1
         1 000267   000777 361003                    ANX1    511,DU
         1 000270   000000 473400 xsym               LDP3    N$DCT$$
         1 000271   300000 474511                    LDP4    0,X1,PR3
         1 000272   200020 454500                    STP4    REQ$+3,,AUTO
         1 000273   200020 630500                    EPPR0   REQ$+3,,AUTO
         1 000274   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000275   000000 701000 xent               TSX1    NIW$MPCSTART
         1 000276   000000 011000                    NOP     0

      484     4048    5                       END;

      485     4049    4                    END;

      486     4050    3                 END;

   4050  1 000277   200011 054100                    AOS     I,,AUTO
         1 000300   200011 235100                    LDA     I,,AUTO
         1 000301   000001 115007                    CMPA    1,DL
         1 000302   000245 604400 1                  TMOZ    s:4044

      487     4051    3              IF MPC$->DCT.MPC.TYPE=%DV_LP THEN DO;

   4051  1 000303   200013 470500                    LDP0    MPC$,,AUTO
         1 000304   000035 236100                    LDQ     29,,PR0
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:77   
         1 000305   777000 376003                    ANQ     -512,DU
         1 000306   003000 116003                    CMPQ    1536,DU
         1 000307   000340 601000 1                  TNZ     s:4059

      488     4052    3                 CALL NIQ$GET(REQ$);

   4052  1 000310   200015 631500                    EPPR1   REQ$,,AUTO
         1 000311   200020 451500                    STP1    REQ$+3,,AUTO
         1 000312   200020 630500                    EPPR0   REQ$+3,,AUTO
         1 000313   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000314   000000 701000 xent               TSX1    NIQ$GET
         1 000315   000000 011000                    NOP     0

      489     4053    3                 REQ.FC=%N_RESET;

   4053  1 000316   200015 470500                    LDP0    REQ$,,AUTO
         1 000317   000022 236007                    LDQ     18,DL
         1 000320   000003 552104                    STBQ    3,'04'O,PR0

      490     4054    3                 REQ.OPFLG=%(OP_USER|OP_WAIT);

   4054  1 000321   200015 470500                    LDP0    REQ$,,AUTO
         1 000322   000420 236007                    LDQ     272,DL
         1 000323   000004 552104                    STBQ    4,'04'O,PR0

      491     4055    3                 REQ.DCB$=DCB$;

   4055  1 000324   200004 236100                    LDQ     DCB$,,AUTO
         1 000325   200015 470500                    LDP0    REQ$,,AUTO
         1 000326   000022 756100                    STQ     18,,PR0

      492     4056    3                 REQ.DLA.DCTX=MPC$->DCT.DCTX;

   4056  1 000327   200013 471500                    LDP1    MPC$,,AUTO
         1 000330   100006 236100                    LDQ     6,,PR1
         1 000331   000001 676100                    ERQ     1,,PR0
         1 000332   777770 376003                    ANQ     -8,DU
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:78   
         1 000333   000001 656100                    ERSQ    1,,PR0

      493     4057    3                 CALL NIO$QUE(REQ);

   4057  1 000334   200015 630500                    EPPR0   REQ$,,AUTO
         1 000335   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000336   000000 701000 xent               TSX1    NIO$QUE
         1 000337   000000 011000                    NOP     0

      494     4058    3                 END;

      495     4059    2              MPC$->DCT.STATUS.TND=0;

   4059  1 000340   200013 470500                    LDP0    MPC$,,AUTO
         1 000341   000004 236000 2                  LDQ     4
         1 000342   000027 356100                    ANSQ    23,,PR0

      496     4060    3              IF MPC$->DCT.DFLG.MPCSUSPENDED THEN DO;

   4060  1 000343   000006 236100                    LDQ     6,,PR0
         1 000344   002000 316007                    CANQ    1024,DL
         1 000345   000414 600000 1                  TZE     s:4073

      497     4061    3                 MPC$->DCT.DFLG.MPCSUSPENDED='0'B;

   4061  1 000346   000006 236000 2                  LDQ     6
         1 000347   000006 356100                    ANSQ    6,,PR0

      498     4062    3                 CALL NIQ$GET(REQ$);

   4062  1 000350   200015 630500                    EPPR0   REQ$,,AUTO
         1 000351   200020 450500                    STP0    REQ$+3,,AUTO
         1 000352   200020 630500                    EPPR0   REQ$+3,,AUTO
         1 000353   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000354   000000 701000 xent               TSX1    NIQ$GET
         1 000355   000000 011000                    NOP     0

PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:79   
      499     4063    3                 REQ.DLA.DCTX=MPC$->DCT.DCTX;

   4063  1 000356   200013 470500                    LDP0    MPC$,,AUTO
         1 000357   200015 471500                    LDP1    REQ$,,AUTO
         1 000360   000006 236100                    LDQ     6,,PR0
         1 000361   100001 676100                    ERQ     1,,PR1
         1 000362   777770 376003                    ANQ     -8,DU
         1 000363   100001 656100                    ERSQ    1,,PR1

      500     4064    3                 REQ.BUFSIZE=4;

   4064  1 000364   200015 470500                    LDP0    REQ$,,AUTO
         1 000365   000004 236100                    LDQ     4,,PR0
         1 000366   177777 376007                    ANQ     65535,DL
         1 000367   000001 276003                    ORQ     1,DU
         1 000370   000004 756100                    STQ     4,,PR0

      501     4065    3                 REQ.FC=%N_DCWLIST;

   4065  1 000371   200015 470500                    LDP0    REQ$,,AUTO
         1 000372   000000 236003                    LDQ     0,DU
         1 000373   000003 552104                    STBQ    3,'04'O,PR0

      502     4066    3                 REQ.OPFLG=OP_USER | OP_BPF | OP_WAIT;

   4066  1 000374   200015 470500                    LDP0    REQ$,,AUTO
         1 000375   000430 236007                    LDQ     280,DL
         1 000376   000004 552104                    STBQ    4,'04'O,PR0

      503     4067    3                 REQ.USER#=B$JIT.USER;

   4067  1 000377   000000 470400 xsym               LDP0    B$JIT$
         1 000400   200015 471500                    LDP1    REQ$,,AUTO
         1 000401   000000 236100                    LDQ     0,,PR0
         1 000402   000022 772000                    QRL     18
         1 000403   100027 552104                    STBQ    23,'04'O,PR1

PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:80   
      504     4068    3                 REQ.DCB$=DCB$;

   4068  1 000404   200004 236100                    LDQ     DCB$,,AUTO
         1 000405   100022 756100                    STQ     18,,PR1

      505     4069    3                 REQ.BUF$=ADDR(TD_RELEASE_IDCW);

   4069  1 000406   000007 236000 2                  LDQ     7
         1 000407   100005 756100                    STQ     5,,PR1

      506     4070    3                 CALL NIO$QUE(REQ);

   4070  1 000410   200015 630500                    EPPR0   REQ$,,AUTO
         1 000411   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000412   000000 701000 xent               TSX1    NIO$QUE
         1 000413   000000 011000                    NOP     0

      507     4071    3                 END/* IF SUSPENDED */;

      508     4072    2            END/* CASE TEST# */;

      509     4073    1           FDCB.DCT$=ADDR(NIL);

   4073  1 000414   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000415   200004 470500                    LDP0    DCB$,,AUTO
         1 000416   000047 756100                    STQ     39,,PR0

      510     4074    1           FDCB.DQH$=ADDR(NIL);

   4074  1 000417   000046 756100                    STQ     38,,PR0

      511     4075    1           FDCB.MPC$=ADDR(NIL);

   4075  1 000420   000050 756100                    STQ     40,,PR0

      512     4076    1           IF FDCB.TDEXTST$ ~= ADDR(NIL) THEN /* NOT SET UP FOR FEPS             */

PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:81   
   4076  1 000421   000007 236100                    LDQ     7,,PR0
         1 000422   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000423   000434 600000 1                  TZE     s:4078

      513     4077    1              CALL FSA$FSP(SIZEW(NI$EXTST),FDCB.TDEXTST$);

   4077  1 000424   200004 236100                    LDQ     DCB$,,AUTO
         1 000425   000007 036003                    ADLQ    7,DU
         1 000426   000010 235000 2                  LDA     8
         1 000427   200020 757100                    STAQ    REQ$+3,,AUTO
         1 000430   200020 630500                    EPPR0   REQ$+3,,AUTO
         1 000431   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000432   000000 701000 xent               TSX1    FSA$FSP
         1 000433   000000 011000                    NOP     0

      514     4078    1           FDCB.TDEXTST$=ADDR(NIL);

   4078  1 000434   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000435   200004 470500                    LDP0    DCB$,,AUTO
         1 000436   000007 756100                    STQ     7,,PR0

      515     4079    1           FDCB.CFU$ = ADDR(NIL);

   4079  1 000437   000066 756100                    STQ     54,,PR0

      516     4080    1           FDCB.FCI#=FDCB.FCD#;

   4080  1 000440   000031 236100                    LDQ     25,,PR0
         1 000441   000001 736000                    QLS     1
         1 000442   000031 676100                    ERQ     25,,PR0
         1 000443   040000 376007                    ANQ     16384,DL
         1 000444   000031 656100                    ERSQ    25,,PR0

      517     4081    1           FDCB.FCD#='0'B;

   4081  1 000445   000011 236000 2                  LDQ     9
         1 000446   000031 356100                    ANSQ    25,,PR0
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:82   

      518     4082    1           RETURN;

   4082  1 000447   000000 702200 xent               TSX2  ! X66_ARET

      519     4083    1   TDNODEV:
      520     4084    1           ERRCODE = %E$TDNODEV;

   4084  1 000450   001610 235007       TDNODEV      LDA     904,DL
         1 000451   200007 755100                    STA     ERRCODE,,AUTO

      521     4085    1           GOTO BADRET;

   4085  1 000452   000101 710000 1                  TRA     BADRET

(unnamed)
 Sect OctLoc
   0     000   240420 000000                                                    ....

(unnamed)
 Sect OctLoc
   2     000   000002 006000   000051 400000   777777 777770   777777 777757    .....)..........
   2     004   607777 777777   703777 777777   777777 775777   000000 006000    ................
   2     010   000012 006000   777777 757777                                    ........
      522     4086    1   END TDP$CLOSE;
      523     4087        %EOD;

PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:83   
--  Include file information  --

   TD_ERRORS_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   F$DCBM.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure TDP$CLOSE.
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:84   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 DCB$                       5-0-0/w PTR         r     1 DCT$
     6-0-0/w PTR         r     1 DQH$                       7-0-0/w UBIN        r     1 ERRCODE
    10-0-0/w PTR         r     1 FEI$                      11-0-0/w SBIN        r     1 I
    13-0-0/w PTR         r     1 MPC$                      15-0-0/w PTR         r     1 REQ$
    14-0-0/w PTR         r     1 SQH$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 KI_FEI$$
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 N$FQ$
     0-0-0/w PTR         r     1 NI$FQ$                     0-0-0/w PTR         r     1 NI$IBUF$
     0-0-0/w PTR         r     1 NI$RP$                     0-0-0/b BIT         r     1 TD_RELEASE_IDCW

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC(1332)  r     1 DCT
     0-0-0/w STRC(648)   r     1 DQH                        0-0-0/d ASTR(3528)  r     1 FDCB
     0-0-0/w STRC(612)   r     1 KI$FEI
     0-0-0/w PTR         r     1 KI$FEI$(0:0)
     0-0-0/w PTR         r     1 N$DCT$(0:0)                0-0-0/w STRC(288)   r     1 NI$EXTST
     0-0-0/d STRC(1080)  r     1 REQ                        0-0-0/w STRC(252)   r     1 SQH

PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:85   

   Procedure TDP$CLOSE requires 299 words for executable code.
   Procedure TDP$CLOSE requires 22 words of local(AUTO) storage.
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:86   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:87   
          MINI XREF LISTING

B$DO.ECCINFO
       865**DCL       866--REDEF
B$JIT.CPFLAGS1.SLEAZE
       433**DCL       433--REDEF
B$JIT.DCB$
       507**DCL      3981>>ASSIGN
B$JIT.ERR
       339**DCL      4007<<ASSIGN
B$JIT.ERR.CODE
       340**DCL      4008<<ASSIGN
B$JIT.ERR.MID
       340**DCL       340--REDEF
B$JIT.ERR.SEV
       340**DCL      4009<<ASSIGN
B$JIT.JRESPEAK
       501**DCL       502--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
       610**DCL       610--REDEF     611--REDEF
B$JIT.PNR
       514**DCL       514--REDEF
B$JIT.TSLINE
       608**DCL       609--REDEF
B$JIT.USER
       339**DCL      3984>>IF       4067>>ASSIGN
B$JIT$
      3632**DCL       334--IMP-PTR  3981>>ASSIGN   3984>>IF       4007>>ASSIGN   4008>>ASSIGN   4009>>ASSIGN
      4067>>ASSIGN
B$MAP.SCTRL
       658**DCL       659--REDEF
B$U.MISC
       844**DCL       845--REDEF
B$USER.MISC
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:88   
       920**DCL       921--REDEF
BADRET
      4007**LABEL    3986--GOTO     3997--GOTO     4014--GOTO     4085--GOTO
DCB$
      3644**DCL      3659--IMP-PTR  3981<<ASSIGN   3982>>IF       3983>>CALL     4004>>IF       4012>>IF
      4016>>IF       4017>>ASSIGN   4020>>IF       4021>>ASSIGN   4024>>ASSIGN   4025>>IF       4026>>ASSIGN
      4028>>ASSIGN   4031>>ASSIGN   4032>>ASSIGN   4034>>ASSIGN   4035>>DOCASE   4055>>ASSIGN   4068>>ASSIGN
      4073>>ASSIGN   4074>>ASSIGN   4075>>ASSIGN   4076>>IF       4077>>CALL     4078>>ASSIGN   4079>>ASSIGN
      4080>>ASSIGN   4080>>ASSIGN   4081>>ASSIGN
DCT
      3724**DCL      4039<>CALL     4045<>CALL     4047<>CALL
DCT.DCTX
      3725**DCL      4056>>ASSIGN   4063>>ASSIGN
DCT.DFLG.MPCSTOP
      3729**DCL      4041<<ASSIGN
DCT.DFLG.MPCSUSPENDED
      3729**DCL      4038<<ASSIGN   4060>>IF       4061<<ASSIGN
DCT.DP
      3744**DCL      3751--REDEF    3754--REDEF    3755--REDEF    3757--REDEF    3757--REDEF    3758--REDEF
      3759--REDEF    3759--REDEF
DCT.MCA.RESERVED
      3759**DCL      3992>>IF       3999<<ASSIGN
DCT.MCA.USER#
      3759**DCL      3984>>IF       3988<<ASSIGN
DCT.MPC.ALTMPCX
      3753**DCL      4046>>IF       4047>>CALL
DCT.MPC.IOCHANX
      3752**DCL      3752--REDEF
DCT.MPC.TYPE
      3752**DCL      4051>>IF
DCT.SPEVENT
      3740**DCL      4032<<ASSIGN
DCT.SQH$
      3739**DCL      4042>>ASSIGN
DCT.STATUS.TND
      3742**DCL      4031<<ASSIGN   4037<<ASSIGN   4059<<ASSIGN
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:89   
DCT$
      3645**DCL      3983<>CALL     3984>>IF       3988>>ASSIGN   3992>>IF       3999>>ASSIGN
DQH.IOCHANX
      3774**DCL      3775--REDEF
DQH.MBX$
      3783**DCL      3784--REDEF
DQH.STATUS.TND
      3773**DCL      4034<<ASSIGN
DQH.USER#
      3782**DCL      4028<<ASSIGN
DQH$
      3646**DCL      3983<>CALL
ERRCODE
      3647**DCL      3985<<ASSIGN   3996<<ASSIGN   4005<<ASSIGN   4008>>ASSIGN   4013<<ASSIGN   4084<<ASSIGN
FDCB.ACTPOS
      3691**DCL      3691--REDEF
FDCB.ARS#
      3665**DCL      3665--REDEF
FDCB.ASN#
      3680**DCL      4004>>IF
FDCB.ATTR
      3684**DCL      3685--REDEF
FDCB.BORROW
      3699**DCL      3699--REDEF    3699--REDEF    3699--REDEF
FDCB.CFU$
      3700**DCL      4079<<ASSIGN
FDCB.DCBNAME.L
      3713**DCL      3713--IMP-SIZ
FDCB.DCT$
      3688**DCL      4031>>ASSIGN   4032>>ASSIGN   4073<<ASSIGN
FDCB.DEVADR
      3688**DCL      3983<>CALL
FDCB.DEVADR.DVN#
      3689**DCL      4026>>ASSIGN
FDCB.DQH$
      3687**DCL      4028>>ASSIGN   4034>>ASSIGN   4074<<ASSIGN
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:90   
FDCB.EOMCHAR#
      3669**DCL      3669--REDEF
FDCB.FCD#
      3678**DCL      4012>>IF       4080>>ASSIGN   4081<<ASSIGN
FDCB.FCI#
      3678**DCL      4080<<ASSIGN
FDCB.FCN.CNT
      3704**DCL      4016>>IF       4020>>IF
FDCB.FLDID
      3694**DCL      3694--REDEF
FDCB.FORM$
      3688**DCL      3688--REDEF
FDCB.FSECT
      3704**DCL      3704--REDEF
FDCB.FSN#
      3681**DCL      3681--REDEF    3681--REDEF    3682--REDEF
FDCB.FUN#
      3680**DCL      3982>>IF       4025>>IF       4035>>DOCASE
FDCB.HEADER$
      3687**DCL      3687--REDEF
FDCB.IXTNSIZE#
      3685**DCL      3685--REDEF
FDCB.LASTSTA$
      3674**DCL      3674--REDEF
FDCB.LVL
      3700**DCL      3700--REDEF
FDCB.MPC$
      3688**DCL      4024>>ASSIGN   4075<<ASSIGN
FDCB.NAME#.C
      3675**DCL      3675--REDEF
FDCB.NOEOF
      3697**DCL      3697--REDEF
FDCB.NRECS#
      3686**DCL      3686--REDEF
FDCB.NRECX
      3705**DCL      3705--REDEF
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:91   
FDCB.OHDR
      3697**DCL      3697--REDEF
FDCB.ORG#
      3680**DCL      3680--REDEF
FDCB.PRECNO
      3703**DCL      3703--REDEF
FDCB.RCSZ
      3709**DCL      3709--REDEF
FDCB.RES#
      3676**DCL      3676--REDEF
FDCB.SETX
      3688**DCL      3688--REDEF
FDCB.TAB$
      3688**DCL      3688--REDEF
FDCB.TDA
      3702**DCL      3703--REDEF
FDCB.TDEXTST$
      3674**DCL      4076>>IF       4077<>CALL     4078<<ASSIGN
FDCB.WAIT
      3698**DCL      4017<<ASSIGN   4021<<ASSIGN
FDCB.WSN#
      3676**DCL      3676--REDEF
FEI$
      3648**DCL      3799--IMP-PTR  4026<<ASSIGN   4027>>CALL     4027>>CALL
FMB$IOSPIN
      3619**DCL-ENT  4018--CALL     4022--CALL
FSA$FSP
      3620**DCL-ENT  4077--CALL
HFC$LOCK
      1671**DCL-ENT  3990--CALL
HFC$UNLOCK
      1671**DCL-ENT  3994--CALL     4001--CALL
I
      3649**DCL      4043<<DOINDEX  4044>>IF       4045>>CALL     4046>>IF       4047>>CALL
KI$FEI.BD$
      3834**DCL      3835--REDEF    4027<>CALL
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:92   
KI$FEI.BDAD.WADDR
      3836**DCL      3837--REDEF
KI$FEI.FEWSQ
      3827**DCL      4027<>CALL
KI$FEI.RCVPB
      3850**DCL      3851--REDEF
KI$FEI$
      1684**DCL      4026>>ASSIGN
KI_FEI$$
      1683**DCL      1684--IMP-PTR  4026>>ASSIGN
MMS$VREL
      3623**DCL-ENT  4027--CALL
MPC$
      3651**DCL      3983<>CALL     4024<<ASSIGN   4037>>ASSIGN   4038>>ASSIGN   4039>>CALL     4041>>ASSIGN
      4042>>ASSIGN   4044>>IF       4051>>IF       4056>>ASSIGN   4059>>ASSIGN   4060>>IF       4061>>ASSIGN
      4063>>ASSIGN
N$DCT$
      2991**DCL      4047>>CALL
N$DCT$$
      2857**DCL      2991--IMP-PTR  4047>>CALL
N$FQ$
      2857**DCL      2992--IMP-PTR
N$REQ_INIT.BUFADDR
      2876**DCL      2877--REDEF    2877--REDEF
N$REQ_INIT.DLA.DRELADDR
      2868**DCL      2868--REDEF
N$REQ_INIT.DVE.EOMCHAR
      2905**DCL      2906--REDEF
N$REQ_INIT.EAINFO
      2899**DCL      2899--REDEF
N$REQ_INIT.EAINFOX
      2899**DCL      2900--REDEF
N$REQ_INIT.EVNTINFO
      2900**DCL      2900--REDEF
N$REQ_INIT.STATUS
      2881**DCL      2887--REDEF
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:93   
NI$EXTST
      3875**DCL      4077--CALL
NI$EXTST.EXTST
      3879**DCL      3881--REDEF    3883--REDEF
NI$FQ$
      2917**DCL      2993--IMP-PTR
NI$IBUF$
      2917**DCL      2993--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
      2927**DCL      2928--REDEF    2928--REDEF
NI$IMXMBX_INIT.SIZE
      2929**DCL      2929--REDEF
NI$REQ_INIT.DCW
      2951**DCL      2954--REDEF
NI$REQ_INIT.DCW.TALLY
      2952**DCL      2952--REDEF
NI$REQ_INIT.IDCW.EXTA
      2954**DCL      2954--REDEF
NI$REQ_INIT.PCW
      2956**DCL      2960--REDEF
NI$REQ_INIT.SEEK
      2961**DCL      2962--REDEF    2963--REDEF
NI$RP$
      2965**DCL      2995--IMP-PTR
NIO$QUE
      3622**DCL-ENT  4057--CALL     4070--CALL
NIQ$GET
      3621**DCL-ENT  4052--CALL     4062--CALL
NIW$LDFW
      3624**DCL-ENT  4039--CALL
NIW$MPCSTART
      3625**DCL-ENT  4045--CALL     4047--CALL
NI_MBX_INIT.DCW.CONTROL.AE
      2987**DCL      2987--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
      2983**DCL      2983--REDEF
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:94   
REQ
      3914**DCL      4057<>CALL     4070<>CALL
REQ.BUF$
      3923**DCL      4069<<ASSIGN
REQ.BUFADDR
      3923**DCL      3924--REDEF    3924--REDEF
REQ.BUFSIZE
      3917**DCL      4064<<ASSIGN
REQ.DCB$
      3945**DCL      4055<<ASSIGN   4068<<ASSIGN
REQ.DLA.DCTX
      3914**DCL      4056<<ASSIGN   4063<<ASSIGN
REQ.DLA.DRELADDR
      3915**DCL      3915--REDEF
REQ.DVE.EOMCHAR
      3952**DCL      3953--REDEF
REQ.EAINFO
      3946**DCL      3946--REDEF
REQ.EAINFOX
      3946**DCL      3947--REDEF
REQ.EVNTINFO
      3947**DCL      3947--REDEF
REQ.FC
      3917**DCL      4053<<ASSIGN   4065<<ASSIGN
REQ.OPFLG
      3920**DCL      4054<<ASSIGN   4066<<ASSIGN
REQ.STATUS
      3928**DCL      3934--REDEF
REQ.USER#
      3948**DCL      4067<<ASSIGN
REQ$
      3653**DCL      3914--IMP-PTR  4052<>CALL     4053>>ASSIGN   4054>>ASSIGN   4055>>ASSIGN   4056>>ASSIGN
      4057>>CALL     4062<>CALL     4063>>ASSIGN   4064>>ASSIGN   4065>>ASSIGN   4066>>ASSIGN   4067>>ASSIGN
      4068>>ASSIGN   4069>>ASSIGN   4070>>CALL
SQH.DOOR
      3972**DCL      3972--REDEF
PL6.E3A0      #002=TDP$CLOSE File=TDP$PMME.:E05TSI                               WED 07/30/97 06:03 Page:95   
SQH.GATE
      3972**DCL      3990<>CALL     3994<>CALL     4001<>CALL
SQH.MPC$
      3974**DCL      4044>>IF       4045>>CALL     4046>>IF       4047>>CALL
SQH$
      3652**DCL      3972--IMP-PTR  3983<>CALL     3990>>CALL     3994>>CALL     4001>>CALL     4042<<ASSIGN
      4044>>IF       4045>>CALL     4046>>IF       4047>>CALL
TDNODEV
      4084**LABEL    3983--CALLALT
TDU$FINDPATH
      3627**DCL-ENT  3983--CALL
TD_RELEASE_IDCW
      3639**DCL      4069--ASSIGN

PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:96   
      524        1        /*M* TDP$OPEN - M$TDOPEN PMME HANDLER */
      525        2        /*T***********************************************************/
      526        3        /*T*                                                         */
      527        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      528        5        /*T*                                                         */
      529        6        /*T***********************************************************/
      530        7        TDP$OPEN: PROC;
      531        8        /*
      532        9                Includes
      533       10        */
      534       11        %INCLUDE                        B$JIT ;
      535      614        %INCLUDE                        B$MAP ;
      536      713        %INCLUDE                        B$USER ;
      537      929        %INCLUDE                        B_STRINGS_C ;
      538     1058        %INCLUDE                        CP_6_SUBS ;
      539     1598        %INCLUDE                        EL$TABLES ;
      540     1921        %INCLUDE                        EL_SUBS_C ;
      541     2005        %INCLUDE                        F$DCB ;
      542     2054        %INCLUDE                        FM$GRAN ;
      543     2123        %INCLUDE                        FR$RAT ;
      544     2176        %INCLUDE                        F_ERRORS_C ;
      545     2416        %INCLUDE                        HF_LOCK_C ;
      546     2430        %INCLUDE                        JG_GHOSTS_C ;
      547     2520        %INCLUDE                        KI_DATA_R ;
      548     2546        %INCLUDE                        KI_MACROS_C ;
      549     3154        %INCLUDE                        KI_SUBS_C ;
      550     3290        %INCLUDE                        M_INFO_C ;
      551     3430        %INCLUDE                        NI_DATA_C ;
      552     3543        %INCLUDE                        NI_DATA_R ;
      553     3980        %INCLUDE                        NI_MACROS_C ;
      554     4247        %INCLUDE                        N_FC_C ;
      555     4284        %INCLUDE                        OC_SUBS_C ;
      556     5015        %INCLUDE                        SS_SCHED_C ;
      557     5248        %INCLUDE                        TD$CP6V_C ;
      558     5284        %INCLUDE                        TD_ERRORS_C ;
      559     5367        %INCLUDE                        UQ_ERRORS_C ;
      560     5389        /*
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:97   
      561     5390                Entries
      562     5391        */
      563     5392    1   DCL 1 ELA$SYSLOG                ENTRY(6) ALTRET ;
      564     5393    1   DCL 1 FMM$SCRUB                 ENTRY(1) ;
      565     5394    1   DCL 1 FSA$GSP                   ENTRY(2) ALTRET ;
      566     5395    1   DCL 1 HFF$DSIZ                  ENTRY(2) ;
      567     5396    1   DCL 1 HFF$NILERASE              ENTRY(1) ALTRET ;
      568     5397    1   DCL 1 NIQ$GET                   ENTRY(1) ALTRET ;
      569     5398    1   DCL 1 NIQ$REL                   ENTRY(1) ALTRET ;
      570     5399    1   DCL 1 NIO$QUE                   ENTRY(1) ALTRET ;
      571     5400    1   DCL 1 NIW$MPCSTOP               ENTRY(1) ;
      572     5401    1   DCL 1 MMS$VGET                  ENTRY(4) ALTRET ;
      573     5402    1   DCL 1 OCI$MK_WR                 ENTRY(7) ;
      574     5403    1   DCL 1 SSR$REG                   ENTRY(3) ALTRET ;
      575     5404    1   DCL 1 TDU$FINDPATH              ENTRY(6) ALTRET ;
      576     5405    1   DCL 1 UDB$PMMEXIT               ENTRY(0) ;
      577     5406        /*
      578     5407                Symrefs
      579     5408        */
      580     5409    1   DCL 1 B$CPGT1$                  PTR SYMREF ;
      581     5410    1   DCL 1 B$JIT$                    PTR SYMREF ;
      582     5411    1   DCL 1 B$PS0$                    PTR SYMREF ;
      583     5412    1   DCL 1 B$PS1$                    PTR SYMREF ;
      584     5413    1   DCL 1 B$PS2$                    PTR SYMREF ;
      585     5414    1   DCL 1 B$PS3$                    PTR SYMREF ;
      586     5415    1   DCL 1 B$UPT$                    PTR SYMREF ;
      587     5416        %B$USERREFS;
      588     5420    1   DCL 1 IT_SYSDISK                SBIN SYMREF ;
      589     5421    1   DCL 1 TD_OPENGATE               BIT(72) SYMREF ;
      590     5422        /*
      591     5423                Auto
      592     5424        */
      593     5425    1   DCL 1 CPT$                      PTR ALIGNED AUTO ;
      594     5426    1   DCL 1 DCB$                      PTR ALIGNED AUTO ;
      595     5427    1   DCL 1 DCT$                      PTR ALIGNED AUTO ;
      596     5428    1   DCL 1 DQH$                      PTR ALIGNED AUTO ;
      597     5429        %EL$DIAG                        ( NAME=EL$DIAG, STCLASS=AUTO );
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:98   
      598     5432    1   DCL 1 EXTST$                    PTR ALIGNED AUTO ;
      599     5433    1   DCL 1 FEI$                      PTR ALIGNED AUTO ;
      600     5434    1   DCL 1 FEI#                      UBIN ALIGNED AUTO ;
      601     5435    1   DCL 1 I                         SBIN ALIGNED AUTO ;
      602     5436    1   DCL 1 MPC$                      PTR ALIGNED AUTO ;
      603     5437    1   DCL 1 MPCFLG                    BIT(1) ALIGNED AUTO ;
      604     5438    1   DCL 1 MSG                       ALIGNED AUTO,
      605     5439    1         2 ACCT                    CHAR(8),
      606     5440    1         2 SYSID                   UBIN HALF UNAL,
      607     5441    1         2 NAME                    CHAR(12) UNAL,
      608     5442    1         2 DEVNM                   CHAR(4) UNAL,
      609     5443    1         2 FEPNO                   REDEF DEVNM UBIN UNAL,
      610     5444    1         2 TEST                    SBIN UNAL ;
      611     5445    1   DCL 1 P$                        PTR ALIGNED AUTO ;
      612     5446    1   DCL 1 PATH                      BIT(1) ALIGNED AUTO ;
      613     5447    1   DCL 1 Q$                        PTR ALIGNED AUTO ;
      614     5448    1   DCL 1 SQH$                      PTR ALIGNED AUTO ;
      615     5449    1   DCL 1 TEMP                      UBIN WORD ALIGNED AUTO ;
      616     5450    1   DCL 1 UPT$                      PTR ALIGNED AUTO ;
      617     5451    1   DCL 1 VID$                      PTR ALIGNED AUTO ;
      618     5452    1   DCL 1 VIDBUF1                   CHAR(%(64*4)) CALIGNED AUTO ;
      619     5453    1   DCL 1 VIDBUF2                   CHAR(%(64*4)) CALIGNED AUTO ;
      620     5454    1   DCL 1 WPTP                      SBIN ALIGNED AUTO ;
      621     5455    1   DCL 1 WSZ                       SBIN ALIGNED AUTO ;
      622     5456    1   DCL 1 WVA                       SBIN ALIGNED AUTO ;
      623     5457    1   DCL 1 X                         SBIN ALIGNED AUTO ;
      624     5458        /*
      625     5459                Based
      626     5460        */
      627     5461    1   DCL 1 CHAINIMG(0:59)            UBIN BASED ;
      628     5462        %NI$DCT                         ( NAME=DCT,           STCLASS="BASED(DCT$)" ) ;
      629     5510        %NI$DVT                         ( NAME=DVT,           STCLASS=BASED         ) ;
      630     5517        %FM$VID                         (                     BASED="BASED(VID$)" ) ;
      631     5523        %FPT$TDOPEN_V ;
      632     5527        %FR$RAT ;
      633     5567        %KI$FEI                         (                     STCLASS="BASED(FEI$)" ) ;
      634     5651        %N$REQ                          ( NAME=N$REQ,         STCLASS="BASED(Q$)" ) ;
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:99   
      635     5709        %NI$CHT                         ( NAME="NI$CHT(0:0)", STCLASS="BASED(NI$CHT$)" ) ;
      636     5712        %NI$DQH                         ( NAME=NI$DQH,        STCLASS="BASED(DQH$)" ) ;
      637     5735        %NI$EXTST                       ( NAME=NI$EXTST,      STCLASS=BASED ) ;
      638     5769        %NI$SQH                         ( NAME=NI$SQH,        STCLASS="BASED(SQH$)" ) ;
      639     5782    1   DCL 1 PBASE$                    PTR BASED ;
      640     5783    1   DCL 1 VFCIMG                    CHAR(TEMP) BASED ;
      641     5784        /*
      642     5785                Constants
      643     5786        */
      644     5787    1   DCL LEN(0:4) UBIN BYTE CONSTANT UNAL INIT(8,2,12,4,4);
      645     5788
      646     5789        %SUB TDOPNV=B$PS0$->FPT$TDOPEN_V;
      647     5790        %EQU FPMC#=%BINBIT(FPMC,18);
      648     5791        %EJECT;
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:100  
      649     5792        /* GET OPERATOR PERMISSION */
      650     5793    1           DCB$=B$JIT.DCB$;
      651     5794    1           IF DCB$->F$DCB.FCD THEN CALL BADRET(%E$DCBOPEN,4) ALTRET(XIT);
      652     5795        /*E*    ERROR:   TDP-E$DCBOPEN
      653     5796                MESSAGE: T & D DCB% %DC % is already open.
      654     5797                                                                           */
      655     5798    1           CALL FMM$SCRUB(DCB$);
      656     5799    1           DCB$->F$DCB.TDFLG.SDSK='0'B;
      657     5800    2           IF TDOPNV.TEST=%TD_TEST_FEP THEN DO;
      658     5801    2              DCT$=ADDR(NIL);
      659     5802    2              SQH$=ADDR(NIL);
      660     5803    2              MPC$=ADDR(NIL);
      661     5804    3              DO FEI# = 1 TO KI_MXFE;
      662     5805    3                 FEI$ = KI$FEI$(FEI#);
      663     5806    3                 IF KI$FEI.FEP# = TDOPNV.DEVICE.DVN
      664     5807    3                 THEN
      665     5808    3                    GOTO FOUND_FEP;
      666     5809    3                 END;
      667     5810    2              CALL BADRET (%E$TDNOTFEP,4) ALTRET(XIT);
      668     5811    2   FOUND_FEP: ;
      669     5812    2              DQH$=NI$CHT.DQH$(BITBIN(KI$FEI.FECH ));
      670     5813    2              IF DQH$=ADDR(NIL) OR TDOPNV.DEVICE.DVN>KI_NODES THEN
      671     5814    2                 CALL BADRET(%E$TDNODEV,4) ALTRET(XIT);
      672     5815    2   GOT_FEP:   MSG.FEPNO=KI$FEI.FEP#;
      673     5816    2              DCB$->F$DCB.NAME.C='FEP';
      674     5817    2              CALL BINCHAR(SUBSTR(DCB$->F$DCB.NAME.C,3,2),MSG.FEPNO);
      675     5818    2              DCB$->F$DCB.NAME.L=5;
      676     5819    2              S$CU$->B$U.FLG.TDOPPERM=NI$DQH.STATUS.TDOK;
      677     5820    2              IF  TDOPNV.TEST = %TD_TEST_MPC
      678     5821    2                OR TDOPNV.TEST = %TD_TEST_IPC
      679     5822    2              THEN                         /* Allow NDIC NFTS for DPS 8000       */
      680     5823    2                 RETURN ;
      681     5824    2              END;
      682     5825    2           ELSE DO;
      683     5826    2              IF  TDOPNV.TEST = %TD_TEST_ITR
      684     5827    2                OR TDOPNV.TEST = %TD_TEST_MPC
      685     5828    2                OR TDOPNV.TEST = %TD_TEST_IPC
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:101  
      686     5829    2              THEN
      687     5830    2                 MPCFLG = '1'B ;
      688     5831    2              ELSE
      689     5832    2                 MPCFLG = '0'B ;
      690     5833    2              CALL TDU$FINDPATH ( TDOPNV.DEVICE, MPCFLG, DCT$, SQH$, DQH$, MPC$ )
              5833                       ALTRET ( TDNODEV ) ;
      691     5834    3              IF DCT$=ADDR(NIL) THEN DO;   /* FEP                                */
      692     5835    3                 FEI$=KI$FEI$(NI$DQH.FEX);
      693     5836    3                 IF KI$FEI.FEST = KIST_MASKED OR
      694     5837    3                   (KI$FEI.FEST = KIST_DN AND KI$FEI.PBST.PROB = KIER_PART) THEN
      695     5838    3                    GOTO GOT_FEP;
      696     5839    3                 ELSE
      697     5840    3                    CALL BADRET(%E$TDDEVBSY,4) ALTRET(XIT);
      698     5841    3                 END;
      699     5842    2              MSG.DEVNM=DCT$->DCT.DEVNM;
      700     5843    2              DCB$->F$DCB.NAME.C=DCT$->DCT.DEVNM;
      701     5844    2              DCB$->F$DCB.NAME.L=8;
      702     5845    2              IF DCT$->DCT.TDUSER#=B$JIT.USER THEN
      703     5846    2                 S$CU$->B$U.FLG.TDOPPERM='1'B;
      704     5847    2              ELSE
      705     5848    2                 S$CU$->B$U.FLG.TDOPPERM=DCT$->DCT.STATUS.TDOK;
      706     5849    2              END;
      707     5850    1           IF TDOPNV.TEST=%TD_TEST_DEVICE OR TDOPNV.TEST=%TD_TEST_MPC THEN RETURN;
              5850                    /* preopen */
      708     5851    1           MSG.ACCT=B$JIT.ACCN;
      709     5852    1           MSG.SYSID=B$JIT.SYSID;
      710     5853    1           MSG.NAME=B$JIT.UNAME;
      711     5854    1           MSG.TEST=TDOPNV.TEST;
      712     5855    1           S$CU$->B$U.FLG.TDNOPERM = '0'B ;
      713     5856    1           IF  TDOPNV.TEST ~= %TD_TEST_MCA
      714     5857    1             AND TDOPNV.TEST ~= %TD_TEST_IPC
      715     5858    1           THEN
      716     5859    2           DO  WHILE  ( NOT S$CU$->B$U.FLG.TDOPPERM ) ;
      717     5860    2              IF  S$CU$->B$U.FLG.TDNOPERM
      718     5861    2              THEN
      719     5862    2                 CALL BADRET ( %E$TDNOPERM, 4 ) ALTRET ( XIT ) ;
      720     5863    2              CALL OCI$MK_WR ( M_SYS, DIAG_MSG#, 5, LEN, MSG ) ;
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:102  
      721     5864    2              CALL SSR$REG ( %SS_SL, , 20 ) ALTRET ( BRKYC ) ;
      722     5865    2              END ;
      723     5866        /* VERIFY THAT THE PATH TO THE DEVICE IS AVAILABLE */
      724     5867    2   PATH:   DO CASE(TDOPNV.TEST);
      725     5868    2            CASE(%TD_TEST_POLTS);
      726     5869    2              IF DCT$->DCT.TYPE=%DV_DP THEN CALL CHECK_SDSK;
      727     5870    2            CASE(%TD_TEST_ITR);
      728     5871    2              IF TDOPNV.DEVICE.DVN~=0 THEN CALL BADRET(%E$TDBADDVN,4) ALTRET(XIT);
      729     5872    2              IF MPC$->DCT.STATUS.TND~=0
      730     5873    2                OR MPC$->DCT.DFLG.MPCBUSY THEN CALL BADRET(%E$TDMPCBSY,4) ALTRET(XIT);
      731     5874    2              X=DCT$->DCT.DCTX;
      732     5875    2              IF  DCT$->DCT.MPC.TYPE=%DV_DP
      733     5876    3              THEN DO ;
      734     5877    3                 PATH = '0'B ;
      735     5878    3                 IF  DCT$->DCT.STATUS.DOWN
      736     5879    3                   OR DCT$->DCT.STATUS.SYSCON_PART
      737     5880    3                   OR DCT$->DCT.STATUS.MSOS_PART
      738     5881    3                   OR DCT$->DCT.DFLG.MPCSUSPENDED
      739     5882    3                   OR DCT$->DCT.DFLG.MPCSTOP
      740     5883    3                 THEN
      741     5884    3                    PATH = '1'B ;
      742     5885    4                 DO  I = 0 TO %N_MPCSPERSQHM1 ;
      743     5886    4                    IF  NI$SQH.MPC$(I) ~= DCT$
      744     5887    4                      AND NI$SQH.MPC$(I) ~= ADDR(NIL)
      745     5888    4                    THEN
      746     5889    4                       IF  NI$SQH.MPC$(I)->DCT.STATUS.DOWN
      747     5890    4                         OR  NI$SQH.MPC$(I)->DCT.STATUS.SYSCON_PART
      748     5891    4                         OR  NI$SQH.MPC$(I)->DCT.STATUS.MSOS_PART
      749     5892    4                         OR  NI$SQH.MPC$(I)->DCT.DFLG.MPCSUSPENDED
      750     5893    4                         OR  NI$SQH.MPC$(I)->DCT.DFLG.MPCSTOP
      751     5894    4                       THEN
      752     5895    4                          ;
      753     5896    4                       ELSE
      754     5897    4                          PATH = '1'B ;
      755     5898    4                    END ;
      756     5899    3                 IF  NOT PATH
      757     5900    3                 THEN
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:103  
      758     5901    3                    CALL BADRET ( %E$TDMPCBSY, 4 ) ALTRET ( XIT ) ;
      759     5902    3                 END ;
      760     5903    2            CASE(%TD_TEST_MDR);
      761     5904    2              IF MPC$->DCT.STATUS.TND~=0 THEN CALL BADRET(%E$TDMPCBSY,4) ALTRET(XIT);
      762     5905    2              IF MPC$->DCT.DFLG.MPCBUSY THEN CALL BADRET(%E$TDMPCBSY,4) ALTRET(XIT);
      763     5906    2              IF NI$DQH.STATUS.DOWN THEN CALL BADRET(%E$TDCHANDOWN,4) ALTRET(XIT);
      764     5907        /*E*    ERROR:  TDP-E$TDCHANDOWN
      765     5908                MESSAGE: Cannot run MDR through partitioned channel.
      766     5909                                                                           */
      767     5910    2              IF DCT$->DCT.TYPE=%DV_DP THEN CALL CHECK_SDSK;
      768     5911    2            CASE(%TD_TEST_MTAR);
      769     5912    2              IF DCT$->DCT.TYPE~=%DV_DP THEN CALL BADRET(%E$TDNODEV,4) ALTRET(XIT);
      770     5913    2              IF NOT DCT$->DCT.STATUS.DOWN THEN
      771     5914    2                 CALL BADRET(%E$TDDEVBSY,4) ALTRET(XIT);
      772     5915    2              CALL CHECK_SDSK ALTRET(TDNODEV);
      773     5916    2            CASE(%TD_TEST_FEP);
      774     5917    2              CALL OPEN_FEP;
      775     5918    2              RETURN;
      776     5919    2            CASE(%TD_TEST_MCA);
      777     5920    2              IF DCT$->DCT.TYPE ~= %DV_MCA THEN CALL BADRET(%E$TDNOTMCA,4) ALTRET(XIT);
      778     5921    2              IF NI$DQH.STATUS.DOWN THEN CALL BADRET(%E$TDCHANDOWN,4) ALTRET(XIT);
      779     5922                   %LOCK(G#=NI$SQH.GATE);
      780     5925    2              IF  DCT$->DCT.MCA.RESERVED
      781     5926    2              THEN
      782     5927    2                 CALL BADRET(%E$TDMCABUSY,4) ALTRET(MCA_UNLK);
      783     5928    2            CASE ( %TD_TEST_IPC ) ;
      784     5929    3              DO  I = 0 TO TDOPNV.NCHANS-1 ;
      785     5930    3                 P$ = NI$CHT.DQH$(NI$DQH.IOCHANX+I) ;
      786     5931    3                 IF  P$ ~= ADDR(NIL)
      787     5932    3                 THEN
      788     5933    3                    IF  NOT  P$->NI$DQH.STATUS.DOWN
      789     5934    3                    THEN
      790     5935    3                       CALL BADRET ( %E$TDDEVBSY, 4 ) ALTRET ( XIT ) ;
      791     5936    3                 END ;
      792     5937    2            CASE(ELSE);
      793     5938    2              CALL BADRET(%E$TDNOTEST,4) ALTRET(XIT);
      794     5939    2            END;                           /* CASE TDOPNV.TEST                   */
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:104  
      795     5940    2           DO CASE(DCT.TYPE);
      796     5941    2            CASE(%DV_CR,%DV_CP,%DV_LP,%DV_MT);
      797     5942    2              IF NOT DCT.STATUS.DOWN AND NOT DCT.STATUS.TDOK THEN
      798     5943    2                 CALL BADRET(%E$TDDEVBSY,4) ALTRET(XIT);
      799     5944    2            CASE(%DV_DP);
      800     5945    2              IF  TDOPNV.TEST ~= %TD_TEST_POLTS
      801     5946    2                AND TDOPNV.TEST ~= %TD_TEST_MDR
      802     5947    2                AND NOT DCT.STATUS.DOWN
      803     5948    2                AND (  DCT.RAT$->FR$RAT.RES.SISID = JG_SLUG#
      804     5949    2                OR  DCT.RAT$->FR$RAT.RES.SISID = JG_PIG#       )
      805     5950    2              THEN
      806     5951    2                 CALL BADRET ( %E$TDDEVBSY, 4 ) ALTRET ( XIT ) ;
      807     5952    2            END;                           /* CASE NI$DVT$(DCT.DVTX)->DVT.TYPE   */
      808     5953                %LOCK (G#=TD_OPENGATE);
      809     5956    1           IF DCT$->DCT.STATUS.TND=0 THEN DCT$->DCT.STATUS.TND=TDOPNV.TEST;
      810     5957    1           ELSE CALL BADRET(%E$TDDEVBSY,4) ALTRET(UNLOCK);
      811     5958                %UNLOCK (G#=TD_OPENGATE);
      812     5961        /**/
      813     5962        /* MODIFY I/O TABLES */
      814     5963        /**/
      815     5964    1           DCT.STATUS.TND=TDOPNV.TEST;
      816     5965    1           DCT.SPEVENT=TDOPNV.SPEVENT;
      817     5966    1           DCT.TDUSER#=B$JIT.USER;
      818     5967    2           DO CASE(TDOPNV.TEST);
      819     5968    2            CASE(%TD_TEST_MDR);
      820     5969    2              MPC$->DCT.STATUS.TND=%TD_TEST_MDR;
      821     5970                                     /* WHILE RUNNING THE MDR THROUGH THIS
      822     5971                                        MPC, MAKE IO THROUGH THE MPC BE
      823     5972                                        SINGLE STREAM ON THE CHANNEL THE
      824     5973                                        MDR IS USING                       */
      825     5974    3              DO I=0 TO 1;
      826     5975    4                 IF NI$SQH.MPC$(I)=MPC$ THEN DO;
      827     5976    4                    CALL NIW$MPCSTOP(NI$SQH.MPC$(I)->DCT);
      828     5977    5                    IF NI$SQH.MPC$(I)->DCT.MPC.ALTMPCX~=0 THEN DO;
      829     5978    5                       CALL NIW$MPCSTOP(N$DCT$(NI$SQH.MPC$(I)->DCT.MPC.ALTMPCX)->DCT);
      830     5979    5                       END;
      831     5980    4                    END;
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:105  
      832     5981    3                 END;
      833     5982    3              DO WHILE(NOT MPC$->DCT.DFLG.MPCSTOP);
      834     5983    3                 CALL SSR$REG(%SS_SL,,1);
      835     5984    3                 END;
      836     5985                   %LOCK (G#=NI$SQH.GATE);
      837     5988    2              MPC$->DCT.DFLG.MPCSTOP='0'B;
      838     5989    3              IF NOT NI$DQH.STATUS.DOWN THEN DO;
      839     5990    3                 NI$DQH.CHANSTATE.STOP='0'B;
      840     5991                      %ENQUEUE(P#=NI$DQH,Q#=NI$SQH.CQ$);
      841     5994    3                 END;
      842     5995                   %UNLOCK (G#=NI$SQH.GATE);
      843     5998    2            CASE(%TD_TEST_ITR);
      844     5999                                                /* STOP THE MPC WHILE RUNNING THE ITR */
      845     6000    2              CALL NIW$MPCSTOP(MPC$->DCT);
      846     6001    2              IF MPC$->DCT.MPC.ALTMPCX~=0 THEN
      847     6002    2                 CALL NIW$MPCSTOP(N$DCT$(MPC$->DCT.MPC.ALTMPCX)->DCT);
      848     6003    2            CASE(%TD_TEST_MCA);
      849     6004    2              DCT$->DCT.MCA.USER#=B$JIT.USER;
      850     6005    2              DCT$->DCT.MCA.RESERVED='1'B;
      851     6006                   %UNLOCK(G#=NI$SQH.GATE);
      852     6009    2            CASE ( %TD_TEST_IPC ) ;
      853     6010
      854     6011    2            END;
      855     6012    1           TEMP=DCT.DCTX;
      856     6013    1           CALL FSA$GSP(SIZEW(NI$EXTST),EXTST$) ALTRET(XIT);
      857     6014    1           CALL OCI$MK_WR(M_DEVC,TDOPN_MSG#,5,LEN,MSG,TEMP);
      858     6015        /**/
      859     6016        /* SET UP TD DCB */
      860     6017        /**/
      861     6018    1           DCB$->F$DCB.TYC='0'B;
      862     6019    1           DCB$->F$DCB.FUN=TDOPNV.TEST;
      863     6020    1           DCB$->F$DCB.DVTYPE=DCT.TYPE;
      864     6021    1           IF DCT.TYPE~=%DV_LP THEN DCB$->F$DCB.WIDTH=0;
      865     6022    2           ELSE DO;
      866     6023    2              DCB$->F$DCB.WIDTH=132;
      867     6024    2              CALL HFF$DSIZ(1,TEMP);
      868     6025    2              IF TEMP>=60*4 THEN B$PS1$->CHAINIMG=DCT.LP.CHAIN$->CHAINIMG;
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:106  
      869     6026    2              CALL HFF$DSIZ(2,TEMP);
      870     6027    3              IF TEMP>=DCT.LP.VFCL*4 THEN DO;
      871     6028    3                 TEMP=DCT.LP.VFCL*4;
      872     6029    3                 B$PS2$->VFCIMG=DCT.LP.VFC$->VFCIMG;
      873     6030    3                 END;
      874     6031    2              END;
      875     6032    1           DCB$->F$DCB.DQH$=DQH$;
      876     6033    1           DCB$->F$DCB.DCT$=DCT$;
      877     6034    1           DCB$->F$DCB.MPC$=MPC$;
      878     6035    1           DCB$->F$DCB.TDEXTST$=EXTST$;
      879     6036    1           DCB$->F$DCB.DEVADR=TDOPNV.DEVICE;
      880     6037    1           DCB$->F$DCB.CONNCT=0;
      881     6038    1           DCB$->F$DCB.CHANTIME=0;
      882     6039    1           DCB$->F$DCB.ASN=%T@D#;
      883     6040    1           DCB$->F$DCB.FCN='0'B;
      884     6041    1           DCB$->F$DCB.FCD='1'B;           /* MARK DCB OPEN                      */
      885     6042    1           EL$DIAG.ACCN=B$JIT.ACCN;
      886     6043    1           EL$DIAG.UNAME=B$JIT.UNAME;
      887     6044    1           EL$DIAG.SYSID=B$JIT.SYSID;
      888     6045    1           EL$DIAG.DEVNM=DCT$->DCT.DEVNM;
      889     6046    1           EL$DIAG.TEST=TDOPNV.TEST;
      890     6047    1           CALL ELA$SYSLOG(EL_DIAG,EL$DIAG,SIZEW(EL$DIAG),'0'B,1,TEMP);
      891     6048    1           RETURN;
      892     6049    1   BRKYC:
      893     6050    1           CALL BADRET(%E$BREAK,4) ALTRET(XIT);
      894     6051    1   TDNODEV:
      895     6052    1           CALL BADRET(%E$TDNODEV,4) ALTRET(XIT);
      896     6053        /*E*        ERROR: TDP-E$TDNODEV
      897     6054                  MESSAGE: Device requested by M$TDOPEN does not exist.
      898     6055        */
      899     6056    1   UNLOCK:
      900     6057                %UNLOCK(G#=TD_OPENGATE);
      901     6060    1   MCA_UNLK:
      902     6061    1           IF TDOPNV.TEST = %TD_TEST_MCA
      903     6062    2           THEN DO;
      904     6063                   %UNLOCK(G#=NI$SQH.GATE);
      905     6066    2              END;
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:107  
      906     6067    1   XIT:    RETURN;
      907     6068    1   BADRET: PROC(ERRCODE,SEV) ALTRET;
      908     6069    2   DCL ERRCODE UBIN WORD;
      909     6070    2   DCL SEV UBIN WORD;
      910     6071        /**/
      911     6072    2           B$JIT.ERR='240420000000'O;
      912     6073    2           B$JIT.ERR.CODE=ERRCODE;
      913     6074    2           B$JIT.ERR.SEV=SEV;
      914     6075    2           ALTRETURN;
      915     6076    2   END BADRET;
      916     6077        %EJECT;
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:108  
      917     6078    1   CHECK_SDSK: PROC ALTRET;
      918     6079    2   DCL I SBIN;
      919     6080        /**/
      920     6081    2           CALL NIQ$GET(Q$);
      921     6082    2           N$REQ.DLA.DCTX=DCT$->DCT.DCTX;
      922     6083    2           N$REQ.FC=%N_RQSTAT;
      923     6084    2           N$REQ.BPMIR = '1'B ;
      924     6085    2           N$REQ.DCB$=DCB$;
      925     6086    2           N$REQ.OPFLG=%(OP_USER|OP_WAIT|OP_HOLD|OP_CLR);
      926     6087    2           CALL NIO$QUE(Q$->N$REQ);
      927     6088    2           IF Q$->N$REQ.STATUS.MAJOR~=0 THEN GOTO SET_SDSK;
      928     6089    2           N$REQ.FC=%N_RDBIN;
      929     6090    2           N$REQ.OPFLG=%(OP_USER|OP_WAIT|OP_BPF|OP_HOLD|OP_CLR);
      930     6091    2           N$REQ.BUF$=ADDR(VIDBUF1);
      931     6092    2           N$REQ.BUFSIZE=SIZEC(VIDBUF1);
      932     6093    2           N$REQ.DLA.DRELADDR=0;
      933     6094    2           CALL NIO$QUE(Q$->N$REQ);
      934     6095    2           VID$=ADDR(VIDBUF1);
      935     6096    3           IF FM$VID.ID='CP6 ' THEN DO;
      936     6097    3              IF FM$VID.VOLCNT~=0 THEN GOTO SET_SDSK;
      937     6098    4              DO I=0 TO 25;
      938     6099    5                 IF FM$VID.SECTSTRT(I)~=0 AND FM$VID.SECTSTRT(I)<DCT$->DCT.DVT$->DVT.
              6099                          PACKSIZE THEN DO;
      939     6100    5                    N$REQ.BUF$=ADDR(VIDBUF2);
      940     6101    5                    N$REQ.BUFSIZE=SIZEC(VIDBUF2);
      941     6102    5                    N$REQ.OPFLG=%(OP_USER|OP_WAIT|OP_BPF|OP_HOLD|OP_CLR);
      942     6103    5                    N$REQ.DLA.DRELADDR=FM$VID.SECTSTRT(I);
      943     6104    5                    CALL NIO$QUE(N$REQ);
      944     6105    5                    IF ADDR(VIDBUF2)->FM$VID.VOLCNT~=0 THEN GOTO SET_SDSK;
      945     6106    5                    END;
      946     6107    4                 END;
      947     6108    3              END;
      948     6109    2           CALL NIQ$REL(Q$);
      949     6110    2           RETURN;
      950     6111    2   SET_SDSK:
      951     6112    2           CALL NIQ$REL(Q$);
      952     6113    2           DCB$->F$DCB.TDFLG.SDSK='1'B;
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:109  
      953     6114    2           ALTRETURN;
      954     6115    2   END CHECK_SDSK;
      955     6116        %EJECT;
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:110  
      956     6117    1   OPEN_FEP: PROC;
      957     6118    2           IF NI$DQH.FEX~=FEI# THEN CALL BADRET(%E$TDNOTFEP,4) ALTRET(XIT);
      958     6119        /*E*    ERROR:   TDP-E$TDNOTFEP
      959     6120                MESSAGE: FEP does not exist.
      960     6121        */
      961     6122    2           CALL HFF$NILERASE(B$PS3$) ALTRET(BADWINDOW);
      962     6123    2           CALL HFF$DSIZ(B$PS3$,WSZ);
      963     6124    3           IF MOD(WSZ,4096)~=0 THEN DO;
      964     6125    3   BADWINDOW: CALL BADRET(%E$TDBADWINDOW,4) ALTRET(XIT);
      965     6126        /*E*    ERROR:   TDP-E$TDBADWINDOW
      966     6127                MESSAGE: Window area must be present for T&D FEP open and must
      967     6128                         begin and end on a page boundary.
      968     6129        */
      969     6130    3              END;
      970     6131                %LOCK (G#=TD_OPENGATE);
      971     6134    2           IF NOT NI$DQH.STATUS.DOWN OR NI$DQH.STATUS.TND~=0 THEN
      972     6135    2              CALL BADRET(%E$TDFEPBSY,4) ALTRET(UNLOCK);
      973     6136    2           NI$DQH.STATUS.TND=TDOPNV.TEST;
      974     6137                %UNLOCK (G#=TD_OPENGATE);
      975     6140    2           FEI$ = KI$FEI$(NI$DQH.FEX);
      976     6141    2           CALL MMS$VGET(KI$FEI.FEWSQ ,B$PS3$,WSZ,KI$FEI.BD$ )
      977     6142    3           WHENALTRETURN DO;
      978     6143                   %LOCK (G=TD_OPENGATE);
      979     6146    3              NI$DQH.STATUS.TND = 0;
      980     6147                   %UNLOCK(G=TD_OPENGATE);
      981     6150    3              GOTO BADWINDOW;
      982     6151    3              END;
      983     6152    2           NI$DQH.USER#=B$JIT.USER;
      984     6153    2           NI$DQH.EVENTINFO = TDOPNV.SPEVENT;
      985     6154    2           DCB$->F$DCB.TYC='0'B;
      986     6155    2           DCB$->F$DCB.FUN=TDOPNV.TEST;
      987     6156    2           DCB$->F$DCB.XTNSIZE=WSZ/4096;
      988     6157    2           DCB$->F$DCB.IXTNSIZE=X;         /* NEED TO SAVE X FOR CLOSE           */
      989     6158    2           DCB$->F$DCB.DQH$=DQH$;
      990     6159    2           DCB$->F$DCB.DEVADR.DVN=FEI#;
      991     6160    2           DCB$->F$DCB.CONNCT=0;
      992     6161    2           DCB$->F$DCB.CHANTIME=0;
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:111  
      993     6162    2           DCB$->F$DCB.ASN=%T@D#;
      994     6163    2           DCB$->F$DCB.FCN='0'B;
      995     6164    2           DCB$->F$DCB.CFU$ = KI$FEI.BD$;
      996     6165    2           DCB$->F$DCB.FCD='1'B;
      997     6166    2           EL$DIAG.ACCN=B$JIT.ACCN;
      998     6167    2           EL$DIAG.UNAME=B$JIT.UNAME;
      999     6168    2           EL$DIAG.SYSID=B$JIT.SYSID;
     1000     6169    2           EL$DIAG.DEVNM='FEP NNN';
     1001     6170    2           CALL BINCHAR(SUBSTR(EL$DIAG.DEVNM,4,3),KI$FEI.FEP#);
     1002     6171    2           EL$DIAG.TEST=TDOPNV.TEST;
     1003     6172    2           DCB$->F$DCB.NAME.L=6;
     1004     6173    2           DCB$->F$DCB.NAME.C=EL$DIAG.DEVNM;
     1005     6174    2           CALL ELA$SYSLOG(EL_DIAG,EL$DIAG,SIZEW(EL$DIAG),'0'B,1,TEMP);
     1006     6175    2           RETURN;
     1007     6176    2   UNLOCK:
     1008     6177                %UNLOCK (G#=TD_OPENGATE);
     1009     6180    2   XIT:    RETURN;
     1010     6181    2   END OPEN_FEP;
     1011     6182    1   END TDP$OPEN;
     1012     6183        %EOD;

PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:112  
--  Include file information  --

   UQ_ERRORS_C.:E05TOU  is referenced.
   TD_ERRORS_C.:E05TOU  is referenced.
   TD$CP6V_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
   FM$GRAN.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   EL$TABLES.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure TDP$OPEN.

   Procedure TDP$OPEN requires 1178 words for executable code.
   Procedure TDP$OPEN requires 182 words of local(AUTO) storage.
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:113  

PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:114  

 Object Unit name= TDP$OPEN                                   File name= TDP$PMME.:E05TOU
 UTS= JUL 30 '97 06:04:48.12 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      7      7  TDP$OPEN
    1   Proc  even  none  1178   2232  TDP$OPEN
    2  RoData even  none    58     72  TDP$OPEN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        0  TDP$OPEN
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:115  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 FMM$SCRUB
 yes     yes           Std       6 TDU$FINDPATH
 yes     yes           Std       3 SSR$REG
         yes           Std       1 HFC$UNLOCK
         yes           Std       7 OCI$MK_WR
         yes           Std       1 NIW$MPCSTOP
         yes           Std       2 HFF$DSIZ
 yes     yes           Std       2 FSA$GSP
 yes     yes           Std       6 ELA$SYSLOG
         yes           Std       1 HFC$LOCK
         yes           Std       2 NIM$ENQUEUE
 yes     yes           Std       1 NIQ$GET
 yes     yes           Std       1 NIO$QUE
 yes     yes           Std       1 NIQ$REL
 yes     yes           Std       1 HFF$NILERASE
 yes     yes           Std       4 MMS$VGET
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KI_FEI$$                              KI_NODES                              KI_MXFE
     N$DCT$$                               N$FQ$                                 NI$CHT$
     NI$FQ$                                NI$IBUF$                              NI$RP$
     B$JIT$                                B$PS0$                                B$PS1$
     B$PS2$                                B$PS3$                                S$CU$
     TD_OPENGATE                           B_VECTNIL
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:116  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:117  


      524        1        /*M* TDP$OPEN - M$TDOPEN PMME HANDLER */
      525        2        /*T***********************************************************/
      526        3        /*T*                                                         */
      527        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      528        5        /*T*                                                         */
      529        6        /*T***********************************************************/
      530        7        TDP$OPEN: PROC;

      7  1 000000   000000 700200 xent  TDP$OPEN     TSX0  ! X66_AUTO_0
         1 000001   000266 000000                    ZERO    182,0

      531        8        /*
      532        9                Includes
      533       10        */
      534       11        %INCLUDE                        B$JIT ;
      535      614        %INCLUDE                        B$MAP ;
      536      713        %INCLUDE                        B$USER ;
      537      929        %INCLUDE                        B_STRINGS_C ;
      538     1058        %INCLUDE                        CP_6_SUBS ;
      539     1598        %INCLUDE                        EL$TABLES ;
      540     1921        %INCLUDE                        EL_SUBS_C ;
      541     2005        %INCLUDE                        F$DCB ;
      542     2054        %INCLUDE                        FM$GRAN ;
      543     2123        %INCLUDE                        FR$RAT ;
      544     2176        %INCLUDE                        F_ERRORS_C ;
      545     2416        %INCLUDE                        HF_LOCK_C ;
      546     2430        %INCLUDE                        JG_GHOSTS_C ;
      547     2520        %INCLUDE                        KI_DATA_R ;
      548     2546        %INCLUDE                        KI_MACROS_C ;
      549     3154        %INCLUDE                        KI_SUBS_C ;
      550     3290        %INCLUDE                        M_INFO_C ;
      551     3430        %INCLUDE                        NI_DATA_C ;
      552     3543        %INCLUDE                        NI_DATA_R ;
      553     3980        %INCLUDE                        NI_MACROS_C ;
      554     4247        %INCLUDE                        N_FC_C ;
      555     4284        %INCLUDE                        OC_SUBS_C ;
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:118  
      556     5015        %INCLUDE                        SS_SCHED_C ;
      557     5248        %INCLUDE                        TD$CP6V_C ;
      558     5284        %INCLUDE                        TD_ERRORS_C ;
      559     5367        %INCLUDE                        UQ_ERRORS_C ;
      560     5389        /*
      561     5390                Entries
      562     5391        */
      563     5392    1   DCL 1 ELA$SYSLOG                ENTRY(6) ALTRET ;
      564     5393    1   DCL 1 FMM$SCRUB                 ENTRY(1) ;
      565     5394    1   DCL 1 FSA$GSP                   ENTRY(2) ALTRET ;
      566     5395    1   DCL 1 HFF$DSIZ                  ENTRY(2) ;
      567     5396    1   DCL 1 HFF$NILERASE              ENTRY(1) ALTRET ;
      568     5397    1   DCL 1 NIQ$GET                   ENTRY(1) ALTRET ;
      569     5398    1   DCL 1 NIQ$REL                   ENTRY(1) ALTRET ;
      570     5399    1   DCL 1 NIO$QUE                   ENTRY(1) ALTRET ;
      571     5400    1   DCL 1 NIW$MPCSTOP               ENTRY(1) ;
      572     5401    1   DCL 1 MMS$VGET                  ENTRY(4) ALTRET ;
      573     5402    1   DCL 1 OCI$MK_WR                 ENTRY(7) ;
      574     5403    1   DCL 1 SSR$REG                   ENTRY(3) ALTRET ;
      575     5404    1   DCL 1 TDU$FINDPATH              ENTRY(6) ALTRET ;
      576     5405    1   DCL 1 UDB$PMMEXIT               ENTRY(0) ;
      577     5406        /*
      578     5407                Symrefs
      579     5408        */
      580     5409    1   DCL 1 B$CPGT1$                  PTR SYMREF ;
      581     5410    1   DCL 1 B$JIT$                    PTR SYMREF ;
      582     5411    1   DCL 1 B$PS0$                    PTR SYMREF ;
      583     5412    1   DCL 1 B$PS1$                    PTR SYMREF ;
      584     5413    1   DCL 1 B$PS2$                    PTR SYMREF ;
      585     5414    1   DCL 1 B$PS3$                    PTR SYMREF ;
      586     5415    1   DCL 1 B$UPT$                    PTR SYMREF ;
      587     5416        %B$USERREFS;
      588     5420    1   DCL 1 IT_SYSDISK                SBIN SYMREF ;
      589     5421    1   DCL 1 TD_OPENGATE               BIT(72) SYMREF ;
      590     5422        /*
      591     5423                Auto
      592     5424        */
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:119  
      593     5425    1   DCL 1 CPT$                      PTR ALIGNED AUTO ;
      594     5426    1   DCL 1 DCB$                      PTR ALIGNED AUTO ;
      595     5427    1   DCL 1 DCT$                      PTR ALIGNED AUTO ;
      596     5428    1   DCL 1 DQH$                      PTR ALIGNED AUTO ;
      597     5429        %EL$DIAG                        ( NAME=EL$DIAG, STCLASS=AUTO );
      598     5432    1   DCL 1 EXTST$                    PTR ALIGNED AUTO ;
      599     5433    1   DCL 1 FEI$                      PTR ALIGNED AUTO ;
      600     5434    1   DCL 1 FEI#                      UBIN ALIGNED AUTO ;
      601     5435    1   DCL 1 I                         SBIN ALIGNED AUTO ;
      602     5436    1   DCL 1 MPC$                      PTR ALIGNED AUTO ;
      603     5437    1   DCL 1 MPCFLG                    BIT(1) ALIGNED AUTO ;
      604     5438    1   DCL 1 MSG                       ALIGNED AUTO,
      605     5439    1         2 ACCT                    CHAR(8),
      606     5440    1         2 SYSID                   UBIN HALF UNAL,
      607     5441    1         2 NAME                    CHAR(12) UNAL,
      608     5442    1         2 DEVNM                   CHAR(4) UNAL,
      609     5443    1         2 FEPNO                   REDEF DEVNM UBIN UNAL,
      610     5444    1         2 TEST                    SBIN UNAL ;
      611     5445    1   DCL 1 P$                        PTR ALIGNED AUTO ;
      612     5446    1   DCL 1 PATH                      BIT(1) ALIGNED AUTO ;
      613     5447    1   DCL 1 Q$                        PTR ALIGNED AUTO ;
      614     5448    1   DCL 1 SQH$                      PTR ALIGNED AUTO ;
      615     5449    1   DCL 1 TEMP                      UBIN WORD ALIGNED AUTO ;
      616     5450    1   DCL 1 UPT$                      PTR ALIGNED AUTO ;
      617     5451    1   DCL 1 VID$                      PTR ALIGNED AUTO ;
      618     5452    1   DCL 1 VIDBUF1                   CHAR(%(64*4)) CALIGNED AUTO ;
      619     5453    1   DCL 1 VIDBUF2                   CHAR(%(64*4)) CALIGNED AUTO ;
      620     5454    1   DCL 1 WPTP                      SBIN ALIGNED AUTO ;
      621     5455    1   DCL 1 WSZ                       SBIN ALIGNED AUTO ;
      622     5456    1   DCL 1 WVA                       SBIN ALIGNED AUTO ;
      623     5457    1   DCL 1 X                         SBIN ALIGNED AUTO ;
      624     5458        /*
      625     5459                Based
      626     5460        */
      627     5461    1   DCL 1 CHAINIMG(0:59)            UBIN BASED ;
      628     5462        %NI$DCT                         ( NAME=DCT,           STCLASS="BASED(DCT$)" ) ;
      629     5510        %NI$DVT                         ( NAME=DVT,           STCLASS=BASED         ) ;
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:120  
      630     5517        %FM$VID                         (                     BASED="BASED(VID$)" ) ;
      631     5523        %FPT$TDOPEN_V ;
      632     5527        %FR$RAT ;
      633     5567        %KI$FEI                         (                     STCLASS="BASED(FEI$)" ) ;
      634     5651        %N$REQ                          ( NAME=N$REQ,         STCLASS="BASED(Q$)" ) ;
      635     5709        %NI$CHT                         ( NAME="NI$CHT(0:0)", STCLASS="BASED(NI$CHT$)" ) ;
      636     5712        %NI$DQH                         ( NAME=NI$DQH,        STCLASS="BASED(DQH$)" ) ;
      637     5735        %NI$EXTST                       ( NAME=NI$EXTST,      STCLASS=BASED ) ;
      638     5769        %NI$SQH                         ( NAME=NI$SQH,        STCLASS="BASED(SQH$)" ) ;
      639     5782    1   DCL 1 PBASE$                    PTR BASED ;
      640     5783    1   DCL 1 VFCIMG                    CHAR(TEMP) BASED ;
      641     5784        /*
      642     5785                Constants
      643     5786        */
      644     5787    1   DCL LEN(0:4) UBIN BYTE CONSTANT UNAL INIT(8,2,12,4,4);
      645     5788
      646     5789        %SUB TDOPNV=B$PS0$->FPT$TDOPEN_V;
      647     5790        %EQU FPMC#=%BINBIT(FPMC,18);
      648     5791        %EJECT;
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:121  
      649     5792        /* GET OPERATOR PERMISSION */
      650     5793    1           DCB$=B$JIT.DCB$;

   5793  1 000002   000000 470400 xsym               LDP0    B$JIT$
         1 000003   000232 236100                    LDQ     154,,PR0
         1 000004   200004 756100                    STQ     DCB$,,AUTO

      651     5794    1           IF DCB$->F$DCB.FCD THEN CALL BADRET(%E$DCBOPEN,4) ALTRET(XIT);

   5794  1 000005   200004 471500                    LDP1    DCB$,,AUTO
         1 000006   100031 236100                    LDQ     25,,PR1
         1 000007   020000 316007                    CANQ    8192,DL
         1 000010   000017 600000 1                  TZE     s:5798

   5794  1 000011   000001 236000 2                  LDQ     1
         1 000012   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 000013   000002 236000 2                  LDQ     2
         1 000014   200255 756100                    STQ     I+2,,AUTO
         1 000015   001540 701000 1                  TSX1    BADRET
         1 000016   001537 702000 1                  TSX2    XIT

      652     5795        /*E*    ERROR:   TDP-E$DCBOPEN
      653     5796                MESSAGE: T & D DCB% %DC % is already open.
      654     5797                                                                           */
      655     5798    1           CALL FMM$SCRUB(DCB$);

   5798  1 000017   200004 630500                    EPPR0   DCB$,,AUTO
         1 000020   200260 450500                    STP0    @SEV+2,,AUTO
         1 000021   200260 630500                    EPPR0   @SEV+2,,AUTO
         1 000022   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000023   000000 701000 xent               TSX1    FMM$SCRUB
         1 000024   000000 011000                    NOP     0

      656     5799    1           DCB$->F$DCB.TDFLG.SDSK='0'B;

   5799  1 000025   200004 470500                    LDP0    DCB$,,AUTO
         1 000026   000003 236000 2                  LDQ     3
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:122  
         1 000027   000040 356100                    ANSQ    32,,PR0

      657     5800    2           IF TDOPNV.TEST=%TD_TEST_FEP THEN DO;

   5800  1 000030   000000 471400 xsym               LDP1    B$PS0$
         1 000031   100002 236100                    LDQ     2,,PR1
         1 000032   770000 376003                    ANQ     -4096,DU
         1 000033   050000 116003                    CMPQ    20480,DU
         1 000034   000166 601000 1                  TNZ     s:5826

      658     5801    2              DCT$=ADDR(NIL);

   5801  1 000035   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000036   200005 756100                    STQ     DCT$,,AUTO

      659     5802    2              SQH$=ADDR(NIL);

   5802  1 000037   200041 756100                    STQ     SQH$,,AUTO

      660     5803    2              MPC$=ADDR(NIL);

   5803  1 000040   200024 756100                    STQ     MPC$,,AUTO

      661     5804    3              DO FEI# = 1 TO KI_MXFE;

   5804  1 000041   000001 235007                    LDA     1,DL
         1 000042   200022 755100                    STA     FEI#,,AUTO
         1 000043   000066 710000 1                  TRA     s:5809+3

      662     5805    3                 FEI$ = KI$FEI$(FEI#);

   5805  1 000044   000000 470400 xsym               LDP0    KI_FEI$$
         1 000045   200022 720100                    LXL0    FEI#,,AUTO
         1 000046   000000 236110                    LDQ     0,X0,PR0
         1 000047   200021 756100                    STQ     FEI$,,AUTO

      663     5806    3                 IF KI$FEI.FEP# = TDOPNV.DEVICE.DVN
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:123  

   5806  1 000050   000000 471400 xsym               LDP1    B$PS0$
         1 000051   100000 236100                    LDQ     0,,PR1
         1 000052   000014 772000                    QRL     12
         1 000053   000077 376007                    ANQ     63,DL
         1 000054   200260 756100                    STQ     @SEV+2,,AUTO
         1 000055   200021 473500                    LDP3    FEI$,,AUTO
         1 000056   300012 236100                    LDQ     10,,PR3
         1 000057   000011 772000                    QRL     9
         1 000060   000777 376007                    ANQ     511,DL
         1 000061   200260 116100                    CMPQ    @SEV+2,,AUTO
         1 000062   000077 600000 1                  TZE     FOUND_FEP

      664     5807    3                 THEN
      665     5808    3                    GOTO FOUND_FEP;
      666     5809    3                 END;

   5809  1 000063   200022 235100                    LDA     FEI#,,AUTO
         1 000064   000001 035007                    ADLA    1,DL
         1 000065   200022 755100                    STA     FEI#,,AUTO
         1 000066   000000 236000 xsym               LDQ     KI_MXFE
         1 000067   200022 116100                    CMPQ    FEI#,,AUTO
         1 000070   000044 603000 1                  TRC     s:5805

      667     5810    2              CALL BADRET (%E$TDNOTFEP,4) ALTRET(XIT);

   5810  1 000071   000001 236000 2                  LDQ     1
         1 000072   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 000073   000005 236000 2                  LDQ     5
         1 000074   200255 756100                    STQ     I+2,,AUTO
         1 000075   001540 701000 1                  TSX1    BADRET
         1 000076   001537 702000 1                  TSX2    XIT

   5805  1 000077                       FOUND_FEP    null
      668     5811    2   FOUND_FEP: ;
      669     5812    2              DQH$=NI$CHT.DQH$(BITBIN(KI$FEI.FECH ));

PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:124  
   5812  1 000077   200021 470500                    LDP0    FEI$,,AUTO
         1 000100   000002 236100                    LDQ     2,,PR0
         1 000101   000033 772000                    QRL     27
         1 000102   000001 736000                    QLS     1
         1 000103   000000 471400 xsym               LDP1    NI$CHT$
         1 000104   100000 236106                    LDQ     0,QL,PR1
         1 000105   200006 756100                    STQ     DQH$,,AUTO

      670     5813    2              IF DQH$=ADDR(NIL) OR TDOPNV.DEVICE.DVN>KI_NODES THEN

   5813  1 000106   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000107   000117 600000 1                  TZE     s:5814
         1 000110   000000 473400 xsym               LDP3    B$PS0$
         1 000111   300000 236100                    LDQ     0,,PR3
         1 000112   000014 772000                    QRL     12
         1 000113   000077 376007                    ANQ     63,DL
         1 000114   000000 116000 xsym               CMPQ    KI_NODES
         1 000115   000125 602000 1                  TNC     GOT_FEP
         1 000116   000125 600000 1                  TZE     GOT_FEP

      671     5814    2                 CALL BADRET(%E$TDNODEV,4) ALTRET(XIT);

   5814  1 000117   000001 236000 2                  LDQ     1
         1 000120   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 000121   000007 236000 2                  LDQ     7
         1 000122   200255 756100                    STQ     I+2,,AUTO
         1 000123   001540 701000 1                  TSX1    BADRET
         1 000124   001537 702000 1                  TSX2    XIT

      672     5815    2   GOT_FEP:   MSG.FEPNO=KI$FEI.FEP#;

   5815  1 000125   200021 470500       GOT_FEP      LDP0    FEI$,,AUTO
         1 000126   000100 101500                    MRL     fill='000'O
         1 000127   000012 400001                    ADSC9   10,,PR0                  cn=2,n=1
         1 000130   200033 400004                    ADSC9   MSG+5,,AUTO              cn=2,n=4

      673     5816    2              DCB$->F$DCB.NAME.C='FEP';
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:125  

   5816  1 000131   200004 471500                    LDP1    DCB$,,AUTO
         1 000132   040100 100400                    MLR     fill='040'O
         1 000133   000002 000003 0                  ADSC9   LEN+2                    cn=0,n=3
         1 000134   100010 200037                    ADSC9   8,,PR1                   cn=1,n=31

      674     5817    2              CALL BINCHAR(SUBSTR(DCB$->F$DCB.NAME.C,3,2),MSG.FEPNO);

   5817  1 000135   200033 235100                    LDA     MSG+5,,AUTO
         1 000136   200034 236100                    LDQ     MSG+6,,AUTO
         1 000137   000022 773000                    LRL     18
         1 000140   000000 235003                    LDA     0,DU
         1 000141   200260 757100                    STAQ    @SEV+2,,AUTO
         1 000142   000100 301500                    BTD
         1 000143   200260 000010                    NDSC9   @SEV+2,,AUTO             cn=0,s=lsgnf,sf=0,n=8
         1 000144   100011 030002                    NDSC9   9,,PR1                   cn=0,s=nosgn,sf=0,n=2

      675     5818    2              DCB$->F$DCB.NAME.L=5;

   5818  1 000145   005000 236003                    LDQ     2560,DU
         1 000146   100010 552140                    STBQ    8,'40'O,PR1

      676     5819    2              S$CU$->B$U.FLG.TDOPPERM=NI$DQH.STATUS.TDOK;

   5819  1 000147   000000 473400 xsym               LDP3    S$CU$
         1 000150   200006 474500                    LDP4    DQH$,,AUTO
         1 000151   400001 236100                    LDQ     1,,PR4
         1 000152   000006 772000                    QRL     6
         1 000153   300000 676100                    ERQ     0,,PR3
         1 000154   001000 376003                    ANQ     512,DU
         1 000155   300000 656100                    ERSQ    0,,PR3

      677     5820    2              IF  TDOPNV.TEST = %TD_TEST_MPC

   5820  1 000156   000000 471400 xsym               LDP1    B$PS0$
         1 000157   100002 236100                    LDQ     2,,PR1
         1 000160   770000 376003                    ANQ     -4096,DU
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:126  
         1 000161   060000 116003                    CMPQ    24576,DU
         1 000162   000165 600000 1                  TZE     s:5823
         1 000163   100000 116003                    CMPQ    32768,DU
         1 000164   000305 601000 1                  TNZ     s:5850

      678     5821    2                OR TDOPNV.TEST = %TD_TEST_IPC
      679     5822    2              THEN                         /* Allow NDIC NFTS for DPS 8000       */
      680     5823    2                 RETURN ;

   5823  1 000165   000000 702200 xent               TSX2  ! X66_ARET

      681     5824    2              END;
      682     5825    2           ELSE DO;

      683     5826    2              IF  TDOPNV.TEST = %TD_TEST_ITR

   5826  1 000166   020000 116003                    CMPQ    8192,DU
         1 000167   000174 600000 1                  TZE     s:5830
         1 000170   060000 116003                    CMPQ    24576,DU
         1 000171   000174 600000 1                  TZE     s:5830
         1 000172   100000 116003                    CMPQ    32768,DU
         1 000173   000177 601000 1                  TNZ     s:5832

      684     5827    2                OR TDOPNV.TEST = %TD_TEST_MPC
      685     5828    2                OR TDOPNV.TEST = %TD_TEST_IPC
      686     5829    2              THEN
      687     5830    2                 MPCFLG = '1'B ;

   5830  1 000174   400000 236003                    LDQ     -131072,DU
         1 000175   200025 756100                    STQ     MPCFLG,,AUTO
         1 000176   000200 710000 1                  TRA     s:5833

      688     5831    2              ELSE
      689     5832    2                 MPCFLG = '0'B ;

   5832  1 000177   200025 450100                    STZ     MPCFLG,,AUTO

PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:127  
      690     5833    2              CALL TDU$FINDPATH ( TDOPNV.DEVICE, MPCFLG, DCT$, SQH$, DQH$, MPC$ )
              5833                       ALTRET ( TDNODEV ) ;

   5833  1 000200   200024 633500                    EPPR3   MPC$,,AUTO
         1 000201   200265 453500                    STP3    @SEV+7,,AUTO
         1 000202   200006 634500                    EPPR4   DQH$,,AUTO
         1 000203   200264 454500                    STP4    @SEV+6,,AUTO
         1 000204   200041 635500                    EPPR5   SQH$,,AUTO
         1 000205   200263 455500                    STP5    @SEV+5,,AUTO
         1 000206   200005 636500                    EPPR6   DCT$,,AUTO
         1 000207   200262 456500                    STP6    @SEV+4,,AUTO
         1 000210   200025 637500                    EPPR7   MPCFLG,,AUTO
         1 000211   200261 457500                    STP7    @SEV+3,,AUTO
         1 000212   000000 236000 xsym               LDQ     B$PS0$
         1 000213   400000 036007                    ADLQ    -131072,DL
         1 000214   200260 756100                    STQ     @SEV+2,,AUTO
         1 000215   200260 630500                    EPPR0   @SEV+2,,AUTO
         1 000216   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 000217   000000 701000 xent               TSX1    TDU$FINDPATH
         1 000220   001514 702000 1                  TSX2    TDNODEV

      691     5834    3              IF DCT$=ADDR(NIL) THEN DO;   /* FEP                                */

   5834  1 000221   200005 236100                    LDQ     DCT$,,AUTO
         1 000222   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000223   000254 601000 1                  TNZ     s:5842

      692     5835    3                 FEI$=KI$FEI$(NI$DQH.FEX);

   5835  1 000224   200006 470500                    LDP0    DQH$,,AUTO
         1 000225   000001 236100                    LDQ     1,,PR0
         1 000226   000006 772000                    QRL     6
         1 000227   000077 376007                    ANQ     63,DL
         1 000230   000000 471400 xsym               LDP1    KI_FEI$$
         1 000231   100000 236106                    LDQ     0,QL,PR1
         1 000232   200021 756100                    STQ     FEI$,,AUTO

PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:128  
      693     5836    3                 IF KI$FEI.FEST = KIST_MASKED OR

   5836  1 000233   200021 473500                    LDP3    FEI$,,AUTO
         1 000234   300002 236100                    LDQ     2,,PR3
         1 000235   000777 376003                    ANQ     511,DU
         1 000236   000007 116003                    CMPQ    7,DU
         1 000237   000125 600000 1                  TZE     GOT_FEP
         1 000240   300002 236100                    LDQ     2,,PR3
         1 000241   000777 316003                    CANQ    511,DU
         1 000242   000246 601000 1                  TNZ     s:5840
         1 000243   300015 220100                    LDX0    13,,PR3
         1 000244   000016 100003                    CMPX0   14,DU
         1 000245   000125 600000 1                  TZE     GOT_FEP

      694     5837    3                   (KI$FEI.FEST = KIST_DN AND KI$FEI.PBST.PROB = KIER_PART) THEN
      695     5838    3                    GOTO GOT_FEP;
      696     5839    3                 ELSE
      697     5840    3                    CALL BADRET(%E$TDDEVBSY,4) ALTRET(XIT);

   5840  1 000246   000001 236000 2                  LDQ     1
         1 000247   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 000250   000011 236000 2                  LDQ     9
         1 000251   200255 756100                    STQ     I+2,,AUTO
         1 000252   001540 701000 1                  TSX1    BADRET
         1 000253   001537 702000 1                  TSX2    XIT

      698     5841    3                 END;

      699     5842    2              MSG.DEVNM=DCT$->DCT.DEVNM;

   5842  1 000254   200005 470500                    LDP0    DCT$,,AUTO
         1 000255   040100 100500                    MLR     fill='040'O
         1 000256   000002 000004                    ADSC9   2,,PR0                   cn=0,n=4
         1 000257   200033 400004                    ADSC9   MSG+5,,AUTO              cn=2,n=4

      700     5843    2              DCB$->F$DCB.NAME.C=DCT$->DCT.DEVNM;

PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:129  
   5843  1 000260   200004 471500                    LDP1    DCB$,,AUTO
         1 000261   040100 100500                    MLR     fill='040'O
         1 000262   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
         1 000263   100010 200037                    ADSC9   8,,PR1                   cn=1,n=31

      701     5844    2              DCB$->F$DCB.NAME.L=8;

   5844  1 000264   010000 236003                    LDQ     4096,DU
         1 000265   100010 552140                    STBQ    8,'40'O,PR1

      702     5845    2              IF DCT$->DCT.TDUSER#=B$JIT.USER THEN

   5845  1 000266   000000 473400 xsym               LDP3    B$JIT$
         1 000267   000027 236100                    LDQ     23,,PR0
         1 000270   300000 676100                    ERQ     0,,PR3
         1 000271   000777 376003                    ANQ     511,DU
         1 000272   000277 601000 1                  TNZ     s:5848

      703     5846    2                 S$CU$->B$U.FLG.TDOPPERM='1'B;

   5846  1 000273   000000 474400 xsym               LDP4    S$CU$
         1 000274   001000 236003                    LDQ     512,DU
         1 000275   400000 256100                    ORSQ    0,,PR4
         1 000276   000305 710000 1                  TRA     s:5850

      704     5847    2              ELSE
      705     5848    2                 S$CU$->B$U.FLG.TDOPPERM=DCT$->DCT.STATUS.TDOK;

   5848  1 000277   000000 474400 xsym               LDP4    S$CU$
         1 000300   000027 236100                    LDQ     23,,PR0
         1 000301   000007 772000                    QRL     7
         1 000302   400000 676100                    ERQ     0,,PR4
         1 000303   001000 376003                    ANQ     512,DU
         1 000304   400000 656100                    ERSQ    0,,PR4

      706     5849    2              END;

PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:130  
      707     5850    1           IF TDOPNV.TEST=%TD_TEST_DEVICE OR TDOPNV.TEST=%TD_TEST_MPC THEN RETURN;
              5850                    /* preopen */

   5850  1 000305   000000 470400 xsym               LDP0    B$PS0$
         1 000306   000002 236100                    LDQ     2,,PR0
         1 000307   770000 316003                    CANQ    -4096,DU
         1 000310   000315 600000 1                  TZE     s:5850+8
         1 000311   000002 236100                    LDQ     2,,PR0
         1 000312   770000 376003                    ANQ     -4096,DU
         1 000313   060000 116003                    CMPQ    24576,DU
         1 000314   000316 601000 1                  TNZ     s:5851

   5850  1 000315   000000 702200 xent               TSX2  ! X66_ARET

      708     5851    1           MSG.ACCT=B$JIT.ACCN;

   5851  1 000316   000000 471400 xsym               LDP1    B$JIT$
         1 000317   040100 100500                    MLR     fill='040'O
         1 000320   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
         1 000321   200026 000010                    ADSC9   MSG,,AUTO                cn=0,n=8

      709     5852    1           MSG.SYSID=B$JIT.SYSID;

   5852  1 000322   100000 720100                    LXL0    0,,PR1
         1 000323   200030 740100                    STX0    MSG+2,,AUTO

      710     5853    1           MSG.NAME=B$JIT.UNAME;

   5853  1 000324   040100 100500                    MLR     fill='040'O
         1 000325   100003 000014                    ADSC9   3,,PR1                   cn=0,n=12
         1 000326   200030 400014                    ADSC9   MSG+2,,AUTO              cn=2,n=12

      711     5854    1           MSG.TEST=TDOPNV.TEST;

   5854  1 000327   000100 101500                    MRL     fill='000'O
         1 000330   000002 020001                    ADSC6   2,,PR0                   cn=0,n=1
         1 000331   200034 320006                    ADSC6   MSG+6,,AUTO              cn=3,n=6
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:131  

      712     5855    1           S$CU$->B$U.FLG.TDNOPERM = '0'B ;

   5855  1 000332   000000 473400 xsym               LDP3    S$CU$
         1 000333   000012 236000 2                  LDQ     10
         1 000334   300000 356100                    ANSQ    0,,PR3

      713     5856    1           IF  TDOPNV.TEST ~= %TD_TEST_MCA

   5856  1 000335   000000 470400 xsym               LDP0    B$PS0$
         1 000336   000002 236100                    LDQ     2,,PR0
         1 000337   770000 376003                    ANQ     -4096,DU
         1 000340   070000 116003                    CMPQ    28672,DU
         1 000341   000405 600000 1                  TZE     PATH
         1 000342   100000 116003                    CMPQ    32768,DU
         1 000343   000405 600000 1                  TZE     PATH

      714     5857    1             AND TDOPNV.TEST ~= %TD_TEST_IPC
      715     5858    1           THEN
      716     5859    2           DO  WHILE  ( NOT S$CU$->B$U.FLG.TDOPPERM ) ;

   5859  1 000344   000402 710000 1                  TRA     s:5865

      717     5860    2              IF  S$CU$->B$U.FLG.TDNOPERM

   5860  1 000345   000000 470400 xsym               LDP0    S$CU$
         1 000346   000000 236100                    LDQ     0,,PR0
         1 000347   000400 316003                    CANQ    256,DU
         1 000350   000357 600000 1                  TZE     s:5863

      718     5861    2              THEN
      719     5862    2                 CALL BADRET ( %E$TDNOPERM, 4 ) ALTRET ( XIT ) ;

   5862  1 000351   000001 236000 2                  LDQ     1
         1 000352   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 000353   000014 236000 2                  LDQ     12
         1 000354   200255 756100                    STQ     I+2,,AUTO
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:132  
         1 000355   001540 701000 1                  TSX1    BADRET
         1 000356   001537 702000 1                  TSX2    XIT

      720     5863    2              CALL OCI$MK_WR ( M_SYS, DIAG_MSG#, 5, LEN, MSG ) ;

   5863  1 000357   200026 630500                    EPPR0   MSG,,AUTO
         1 000360   200264 450500                    STP0    @SEV+6,,AUTO
         1 000361   000020 237000 2                  LDAQ    16
         1 000362   200262 757100                    STAQ    @SEV+4,,AUTO
         1 000363   000022 237000 2                  LDAQ    18
         1 000364   200260 757100                    STAQ    @SEV+2,,AUTO
         1 000365   200260 630500                    EPPR0   @SEV+2,,AUTO
         1 000366   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000367   000000 701000 xent               TSX1    OCI$MK_WR
         1 000370   000000 011000                    NOP     0

      721     5864    2              CALL SSR$REG ( %SS_SL, , 20 ) ALTRET ( BRKYC ) ;

   5864  1 000371   000025 236000 2                  LDQ     21
         1 000372   200262 756100                    STQ     @SEV+4,,AUTO
         1 000373   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000374   000026 235000 2                  LDA     22
         1 000375   200260 757100                    STAQ    @SEV+2,,AUTO
         1 000376   200260 630500                    EPPR0   @SEV+2,,AUTO
         1 000377   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000400   000000 701000 xent               TSX1    SSR$REG
         1 000401   001506 702000 1                  TSX2    BRKYC

      722     5865    2              END ;

   5865  1 000402   000000 470400 xsym               LDP0    S$CU$
         1 000403   000000 430100                    FSZN    0,,PR0
         1 000404   000345 605000 1                  TPL     s:5860

      723     5866        /* VERIFY THAT THE PATH TO THE DEVICE IS AVAILABLE */
      724     5867    2   PATH:   DO CASE(TDOPNV.TEST);

PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:133  
   5867  1 000405   000000 470400 xsym  PATH         LDP0    B$PS0$
         1 000406   000002 236100                    LDQ     2,,PR0
         1 000407   000036 772000                    QRL     30
         1 000410   000011 116007                    CMPQ    9,DL
         1 000411   000413 602006 1                  TNC     PATH+6,QL
         1 000412   000757 710000 1                  TRA     s:5938
         1 000413   000757 710000 1                  TRA     s:5938
         1 000414   000424 710000 1                  TRA     s:5869
         1 000415   000434 710000 1                  TRA     s:5871
         1 000416   000555 710000 1                  TRA     s:5904
         1 000417   000623 710000 1                  TRA     s:5912
         1 000420   000652 710000 1                  TRA     s:5917
         1 000421   000757 710000 1                  TRA     s:5938
         1 000422   000655 710000 1                  TRA     s:5920
         1 000423   000720 710000 1                  TRA     s:5929

      725     5868    2            CASE(%TD_TEST_POLTS);

      726     5869    2              IF DCT$->DCT.TYPE=%DV_DP THEN CALL CHECK_SDSK;

   5869  1 000424   200005 471500                    LDP1    DCT$,,AUTO
         1 000425   100007 236100                    LDQ     7,,PR1
         1 000426   007700 376007                    ANQ     4032,DL
         1 000427   000600 116007                    CMPQ    384,DL
         1 000430   000765 601000 1                  TNZ     s:5940

   5869  1 000431   001561 701000 1                  TSX1    CHECK_SDSK
         1 000432   000000 011000                    NOP     0
         1 000433   000765 710000 1                  TRA     s:5940

      727     5870    2            CASE(%TD_TEST_ITR);

      728     5871    2              IF TDOPNV.DEVICE.DVN~=0 THEN CALL BADRET(%E$TDBADDVN,4) ALTRET(XIT);

   5871  1 000434   000000 236100                    LDQ     0,,PR0
         1 000435   770000 316007                    CANQ    -4096,DL
         1 000436   000445 600000 1                  TZE     s:5872
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:134  

   5871  1 000437   000001 236000 2                  LDQ     1
         1 000440   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 000441   000030 236000 2                  LDQ     24
         1 000442   200255 756100                    STQ     I+2,,AUTO
         1 000443   001540 701000 1                  TSX1    BADRET
         1 000444   001537 702000 1                  TSX2    XIT

      729     5872    2              IF MPC$->DCT.STATUS.TND~=0

   5872  1 000445   200024 470500                    LDP0    MPC$,,AUTO
         1 000446   000027 236100                    LDQ     23,,PR0
         1 000447   170000 316003                    CANQ    61440,DU
         1 000450   000454 601000 1                  TNZ     s:5873
         1 000451   000006 236100                    LDQ     6,,PR0
         1 000452   000400 316007                    CANQ    256,DL
         1 000453   000462 600000 1                  TZE     s:5874

      730     5873    2                OR MPC$->DCT.DFLG.MPCBUSY THEN CALL BADRET(%E$TDMPCBSY,4) ALTRET(XIT);

   5873  1 000454   000001 236000 2                  LDQ     1
         1 000455   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 000456   000032 236000 2                  LDQ     26
         1 000457   200255 756100                    STQ     I+2,,AUTO
         1 000460   001540 701000 1                  TSX1    BADRET
         1 000461   001537 702000 1                  TSX2    XIT

      731     5874    2              X=DCT$->DCT.DCTX;

   5874  1 000462   200005 470500                    LDP0    DCT$,,AUTO
         1 000463   000006 236100                    LDQ     6,,PR0
         1 000464   000025 772000                    QRL     21
         1 000465   200250 756100                    STQ     X,,AUTO

      732     5875    2              IF  DCT$->DCT.MPC.TYPE=%DV_DP

   5875  1 000466   000035 236100                    LDQ     29,,PR0
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:135  
         1 000467   777000 376003                    ANQ     -512,DU
         1 000470   006000 116003                    CMPQ    3072,DU
         1 000471   000765 601000 1                  TNZ     s:5940

      733     5876    3              THEN DO ;

      734     5877    3                 PATH = '0'B ;

   5877  1 000472   200037 450100                    STZ     PATH,,AUTO

      735     5878    3                 IF  DCT$->DCT.STATUS.DOWN

   5878  1 000473   000027 234100                    SZN     23,,PR0
         1 000474   000507 604000 1                  TMI     s:5884
         1 000475   000027 236100                    LDQ     23,,PR0
         1 000476   004000 316003                    CANQ    2048,DU
         1 000477   000507 601000 1                  TNZ     s:5884
         1 000500   002000 316003                    CANQ    1024,DU
         1 000501   000507 601000 1                  TNZ     s:5884
         1 000502   000006 236100                    LDQ     6,,PR0
         1 000503   002000 316007                    CANQ    1024,DL
         1 000504   000507 601000 1                  TNZ     s:5884
         1 000505   001000 316007                    CANQ    512,DL
         1 000506   000511 600000 1                  TZE     s:5885

      736     5879    3                   OR DCT$->DCT.STATUS.SYSCON_PART
      737     5880    3                   OR DCT$->DCT.STATUS.MSOS_PART
      738     5881    3                   OR DCT$->DCT.DFLG.MPCSUSPENDED
      739     5882    3                   OR DCT$->DCT.DFLG.MPCSTOP
      740     5883    3                 THEN
      741     5884    3                    PATH = '1'B ;

   5884  1 000507   400000 236003                    LDQ     -131072,DU
         1 000510   200037 756100                    STQ     PATH,,AUTO

      742     5885    4                 DO  I = 0 TO %N_MPCSPERSQHM1 ;

PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:136  
   5885  1 000511   200023 450100                    STZ     I,,AUTO

      743     5886    4                    IF  NI$SQH.MPC$(I) ~= DCT$

   5886  1 000512   200041 470500                    LDP0    SQH$,,AUTO
         1 000513   200023 720100                    LXL0    I,,AUTO
         1 000514   000005 236110                    LDQ     5,X0,PR0
         1 000515   200005 116100                    CMPQ    DCT$,,AUTO
         1 000516   000540 600000 1                  TZE     s:5898
         1 000517   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000520   000540 600000 1                  TZE     s:5898

      744     5887    4                      AND NI$SQH.MPC$(I) ~= ADDR(NIL)
      745     5888    4                    THEN
      746     5889    4                       IF  NI$SQH.MPC$(I)->DCT.STATUS.DOWN

   5889  1 000521   000005 471510                    LDP1    5,X0,PR0
         1 000522   100027 234100                    SZN     23,,PR1
         1 000523   000540 604000 1                  TMI     s:5898
         1 000524   100027 236100                    LDQ     23,,PR1
         1 000525   004000 316003                    CANQ    2048,DU
         1 000526   000540 601000 1                  TNZ     s:5898
         1 000527   002000 316003                    CANQ    1024,DU
         1 000530   000540 601000 1                  TNZ     s:5898
         1 000531   100006 236100                    LDQ     6,,PR1
         1 000532   002000 316007                    CANQ    1024,DL
         1 000533   000540 601000 1                  TNZ     s:5898
         1 000534   001000 316007                    CANQ    512,DL
         1 000535   000540 601000 1                  TNZ     s:5898

      747     5890    4                         OR  NI$SQH.MPC$(I)->DCT.STATUS.SYSCON_PART
      748     5891    4                         OR  NI$SQH.MPC$(I)->DCT.STATUS.MSOS_PART
      749     5892    4                         OR  NI$SQH.MPC$(I)->DCT.DFLG.MPCSUSPENDED
      750     5893    4                         OR  NI$SQH.MPC$(I)->DCT.DFLG.MPCSTOP
      751     5894    4                       THEN
      752     5895    4                          ;
      753     5896    4                       ELSE
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:137  
      754     5897    4                          PATH = '1'B ;

   5897  1 000536   400000 236003                    LDQ     -131072,DU
         1 000537   200037 756100                    STQ     PATH,,AUTO

      755     5898    4                    END ;

   5898  1 000540   200023 054100                    AOS     I,,AUTO
         1 000541   200023 235100                    LDA     I,,AUTO
         1 000542   000001 115007                    CMPA    1,DL
         1 000543   000512 604400 1                  TMOZ    s:5886

      756     5899    3                 IF  NOT PATH

   5899  1 000544   200037 234100                    SZN     PATH,,AUTO
         1 000545   000765 604000 1                  TMI     s:5940

      757     5900    3                 THEN
      758     5901    3                    CALL BADRET ( %E$TDMPCBSY, 4 ) ALTRET ( XIT ) ;

   5901  1 000546   000001 236000 2                  LDQ     1
         1 000547   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 000550   000032 236000 2                  LDQ     26
         1 000551   200255 756100                    STQ     I+2,,AUTO
         1 000552   001540 701000 1                  TSX1    BADRET
         1 000553   001537 702000 1                  TSX2    XIT

      759     5902    3                 END ;

   5902  1 000554   000765 710000 1                  TRA     s:5940

      760     5903    2            CASE(%TD_TEST_MDR);

      761     5904    2              IF MPC$->DCT.STATUS.TND~=0 THEN CALL BADRET(%E$TDMPCBSY,4) ALTRET(XIT);

   5904  1 000555   200024 471500                    LDP1    MPC$,,AUTO
         1 000556   100027 236100                    LDQ     23,,PR1
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:138  
         1 000557   170000 316003                    CANQ    61440,DU
         1 000560   000567 600000 1                  TZE     s:5905

   5904  1 000561   000001 236000 2                  LDQ     1
         1 000562   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 000563   000032 236000 2                  LDQ     26
         1 000564   200255 756100                    STQ     I+2,,AUTO
         1 000565   001540 701000 1                  TSX1    BADRET
         1 000566   001537 702000 1                  TSX2    XIT

      762     5905    2              IF MPC$->DCT.DFLG.MPCBUSY THEN CALL BADRET(%E$TDMPCBSY,4) ALTRET(XIT);

   5905  1 000567   200024 470500                    LDP0    MPC$,,AUTO
         1 000570   000006 236100                    LDQ     6,,PR0
         1 000571   000400 316007                    CANQ    256,DL
         1 000572   000601 600000 1                  TZE     s:5906

   5905  1 000573   000001 236000 2                  LDQ     1
         1 000574   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 000575   000032 236000 2                  LDQ     26
         1 000576   200255 756100                    STQ     I+2,,AUTO
         1 000577   001540 701000 1                  TSX1    BADRET
         1 000600   001537 702000 1                  TSX2    XIT

      763     5906    2              IF NI$DQH.STATUS.DOWN THEN CALL BADRET(%E$TDCHANDOWN,4) ALTRET(XIT);

   5906  1 000601   200006 470500                    LDP0    DQH$,,AUTO
         1 000602   000001 236100                    LDQ     1,,PR0
         1 000603   200000 316003                    CANQ    65536,DU
         1 000604   000613 600000 1                  TZE     s:5910

   5906  1 000605   000001 236000 2                  LDQ     1
         1 000606   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 000607   000034 236000 2                  LDQ     28
         1 000610   200255 756100                    STQ     I+2,,AUTO
         1 000611   001540 701000 1                  TSX1    BADRET
         1 000612   001537 702000 1                  TSX2    XIT
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:139  

      764     5907        /*E*    ERROR:  TDP-E$TDCHANDOWN
      765     5908                MESSAGE: Cannot run MDR through partitioned channel.
      766     5909                                                                           */
      767     5910    2              IF DCT$->DCT.TYPE=%DV_DP THEN CALL CHECK_SDSK;

   5910  1 000613   200005 470500                    LDP0    DCT$,,AUTO
         1 000614   000007 236100                    LDQ     7,,PR0
         1 000615   007700 376007                    ANQ     4032,DL
         1 000616   000600 116007                    CMPQ    384,DL
         1 000617   000765 601000 1                  TNZ     s:5940

   5910  1 000620   001561 701000 1                  TSX1    CHECK_SDSK
         1 000621   000000 011000                    NOP     0
         1 000622   000765 710000 1                  TRA     s:5940

      768     5911    2            CASE(%TD_TEST_MTAR);

      769     5912    2              IF DCT$->DCT.TYPE~=%DV_DP THEN CALL BADRET(%E$TDNODEV,4) ALTRET(XIT);

   5912  1 000623   200005 471500                    LDP1    DCT$,,AUTO
         1 000624   100007 236100                    LDQ     7,,PR1
         1 000625   007700 376007                    ANQ     4032,DL
         1 000626   000600 116007                    CMPQ    384,DL
         1 000627   000636 600000 1                  TZE     s:5913

   5912  1 000630   000001 236000 2                  LDQ     1
         1 000631   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 000632   000007 236000 2                  LDQ     7
         1 000633   200255 756100                    STQ     I+2,,AUTO
         1 000634   001540 701000 1                  TSX1    BADRET
         1 000635   001537 702000 1                  TSX2    XIT

      770     5913    2              IF NOT DCT$->DCT.STATUS.DOWN THEN

   5913  1 000636   200005 470500                    LDP0    DCT$,,AUTO
         1 000637   000027 234100                    SZN     23,,PR0
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:140  
         1 000640   000647 604000 1                  TMI     s:5915

      771     5914    2                 CALL BADRET(%E$TDDEVBSY,4) ALTRET(XIT);

   5914  1 000641   000001 236000 2                  LDQ     1
         1 000642   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 000643   000011 236000 2                  LDQ     9
         1 000644   200255 756100                    STQ     I+2,,AUTO
         1 000645   001540 701000 1                  TSX1    BADRET
         1 000646   001537 702000 1                  TSX2    XIT

      772     5915    2              CALL CHECK_SDSK ALTRET(TDNODEV);

   5915  1 000647   001561 701000 1                  TSX1    CHECK_SDSK
         1 000650   001514 702000 1                  TSX2    TDNODEV
         1 000651   000765 710000 1                  TRA     s:5940

      773     5916    2            CASE(%TD_TEST_FEP);

      774     5917    2              CALL OPEN_FEP;

   5917  1 000652   001744 701000 1                  TSX1    OPEN_FEP
         1 000653   000000 011000                    NOP     0

      775     5918    2              RETURN;

   5918  1 000654   000000 702200 xent               TSX2  ! X66_ARET

      776     5919    2            CASE(%TD_TEST_MCA);

      777     5920    2             IF DCT$->DCT.TYPE ~= %DV_MCA THEN CALL BADRET(%E$TDNOTMCA,4) ALTRET(XIT);

   5920  1 000655   200005 471500                    LDP1    DCT$,,AUTO
         1 000656   100007 236100                    LDQ     7,,PR1
         1 000657   007700 376007                    ANQ     4032,DL
         1 000660   001200 116007                    CMPQ    640,DL
         1 000661   000670 600000 1                  TZE     s:5921
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:141  

   5920  1 000662   000001 236000 2                  LDQ     1
         1 000663   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 000664   000036 236000 2                  LDQ     30
         1 000665   200255 756100                    STQ     I+2,,AUTO
         1 000666   001540 701000 1                  TSX1    BADRET
         1 000667   001537 702000 1                  TSX2    XIT

      778     5921    2              IF NI$DQH.STATUS.DOWN THEN CALL BADRET(%E$TDCHANDOWN,4) ALTRET(XIT);

   5921  1 000670   200006 470500                    LDP0    DQH$,,AUTO
         1 000671   000001 236100                    LDQ     1,,PR0
         1 000672   200000 316003                    CANQ    65536,DU
         1 000673   000702 600000 1                  TZE     s:5923

   5921  1 000674   000001 236000 2                  LDQ     1
         1 000675   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 000676   000034 236000 2                  LDQ     28
         1 000677   200255 756100                    STQ     I+2,,AUTO
         1 000700   001540 701000 1                  TSX1    BADRET
         1 000701   001537 702000 1                  TSX2    XIT

      779     5922                   %LOCK(G#=NI$SQH.GATE);

   5923  1 000702   200041 630500                    EPPR0   SQH$,,AUTO
         1 000703   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000704   000000 701000 xent               TSX1    HFC$LOCK
         1 000705   000000 011000                    NOP     0

      780     5925    2              IF  DCT$->DCT.MCA.RESERVED

   5925  1 000706   200005 470500                    LDP0    DCT$,,AUTO
         1 000707   000030 234100                    SZN     24,,PR0
         1 000710   000765 605000 1                  TPL     s:5940

      781     5926    2              THEN
      782     5927    2                 CALL BADRET(%E$TDMCABUSY,4) ALTRET(MCA_UNLK);
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:142  

   5927  1 000711   000001 236000 2                  LDQ     1
         1 000712   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 000713   000040 236000 2                  LDQ     32
         1 000714   200255 756100                    STQ     I+2,,AUTO
         1 000715   001540 701000 1                  TSX1    BADRET
         1 000716   001526 702000 1                  TSX2    MCA_UNLK
         1 000717   000765 710000 1                  TRA     s:5940

      783     5928    2            CASE ( %TD_TEST_IPC ) ;

      784     5929    3              DO  I = 0 TO TDOPNV.NCHANS-1 ;

   5929  1 000720   200023 450100                    STZ     I,,AUTO
         1 000721   000750 710000 1                  TRA     s:5936+1

      785     5930    3                 P$ = NI$CHT.DQH$(NI$DQH.IOCHANX+I) ;

   5930  1 000722   200006 470500                    LDP0    DQH$,,AUTO
         1 000723   000001 236100                    LDQ     1,,PR0
         1 000724   000022 772000                    QRL     18
         1 000725   000777 376007                    ANQ     511,DL
         1 000726   200023 036100                    ADLQ    I,,AUTO
         1 000727   000001 736000                    QLS     1
         1 000730   000000 471400 xsym               LDP1    NI$CHT$
         1 000731   100000 236106                    LDQ     0,QL,PR1
         1 000732   200036 756100                    STQ     P$,,AUTO

      786     5931    3                 IF  P$ ~= ADDR(NIL)

   5931  1 000733   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000734   000747 600000 1                  TZE     s:5936

      787     5932    3                 THEN
      788     5933    3                    IF  NOT  P$->NI$DQH.STATUS.DOWN

   5933  1 000735   200036 473500                    LDP3    P$,,AUTO
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:143  
         1 000736   300001 236100                    LDQ     1,,PR3
         1 000737   200000 316003                    CANQ    65536,DU
         1 000740   000747 601000 1                  TNZ     s:5936

      789     5934    3                    THEN
      790     5935    3                       CALL BADRET ( %E$TDDEVBSY, 4 ) ALTRET ( XIT ) ;

   5935  1 000741   000001 236000 2                  LDQ     1
         1 000742   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 000743   000011 236000 2                  LDQ     9
         1 000744   200255 756100                    STQ     I+2,,AUTO
         1 000745   001540 701000 1                  TSX1    BADRET
         1 000746   001537 702000 1                  TSX2    XIT

      791     5936    3                 END ;

   5936  1 000747   200023 054100                    AOS     I,,AUTO
         1 000750   000000 470400 xsym               LDP0    B$PS0$
         1 000751   000002 236100                    LDQ     2,,PR0
         1 000752   000030 772000                    QRL     24
         1 000753   000077 376007                    ANQ     63,DL
         1 000754   200023 116100                    CMPQ    I,,AUTO
         1 000755   000722 605400 1                  TPNZ    s:5930
         1 000756   000765 710000 1                  TRA     s:5940

      792     5937    2            CASE(ELSE);

      793     5938    2              CALL BADRET(%E$TDNOTEST,4) ALTRET(XIT);

   5938  1 000757   000001 236000 2                  LDQ     1
         1 000760   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 000761   000042 236000 2                  LDQ     34
         1 000762   200255 756100                    STQ     I+2,,AUTO
         1 000763   001540 701000 1                  TSX1    BADRET
         1 000764   001537 702000 1                  TSX2    XIT

      794     5939    2            END;                           /* CASE TDOPNV.TEST                   */
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:144  

      795     5940    2           DO CASE(DCT.TYPE);

   5940  1 000765   200005 470500                    LDP0    DCT$,,AUTO
         1 000766   000007 236100                    LDQ     7,,PR0
         1 000767   000006 772000                    QRL     6
         1 000770   000077 376007                    ANQ     63,DL
         1 000771   000007 116007                    CMPQ    7,DL
         1 000772   000774 602006 1                  TNC     s:5940+7,QL
         1 000773   001044 710000 1                  TRA     s:5954
         1 000774   001044 710000 1                  TRA     s:5954
         1 000775   001003 710000 1                  TRA     s:5942
         1 000776   001003 710000 1                  TRA     s:5942
         1 000777   001003 710000 1                  TRA     s:5942
         1 001000   001003 710000 1                  TRA     s:5942
         1 001001   001044 710000 1                  TRA     s:5954
         1 001002   001017 710000 1                  TRA     s:5945

      796     5941    2            CASE(%DV_CR,%DV_CP,%DV_LP,%DV_MT);

      797     5942    2              IF NOT DCT.STATUS.DOWN AND NOT DCT.STATUS.TDOK THEN

   5942  1 001003   000027 234100                    SZN     23,,PR0
         1 001004   001044 604000 1                  TMI     s:5954
         1 001005   000027 236100                    LDQ     23,,PR0
         1 001006   200000 316003                    CANQ    65536,DU
         1 001007   001044 601000 1                  TNZ     s:5954

      798     5943    2                 CALL BADRET(%E$TDDEVBSY,4) ALTRET(XIT);

   5943  1 001010   000001 236000 2                  LDQ     1
         1 001011   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 001012   000011 236000 2                  LDQ     9
         1 001013   200255 756100                    STQ     I+2,,AUTO
         1 001014   001540 701000 1                  TSX1    BADRET
         1 001015   001537 702000 1                  TSX2    XIT
         1 001016   001044 710000 1                  TRA     s:5954
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:145  

      799     5944    2            CASE(%DV_DP);

      800     5945    2              IF  TDOPNV.TEST ~= %TD_TEST_POLTS

   5945  1 001017   000000 471400 xsym               LDP1    B$PS0$
         1 001020   100002 236100                    LDQ     2,,PR1
         1 001021   770000 376003                    ANQ     -4096,DU
         1 001022   010000 116003                    CMPQ    4096,DU
         1 001023   001044 600000 1                  TZE     s:5954
         1 001024   030000 116003                    CMPQ    12288,DU
         1 001025   001044 600000 1                  TZE     s:5954
         1 001026   000027 234100                    SZN     23,,PR0
         1 001027   001044 604000 1                  TMI     s:5954
         1 001030   000005 473500                    LDP3    5,,PR0
         1 001031   300001 220100                    LDX0    1,,PR3
         1 001032   000001 100003                    CMPX0   1,DU
         1 001033   001036 600000 1                  TZE     s:5951
         1 001034   000007 100003                    CMPX0   7,DU
         1 001035   001044 601000 1                  TNZ     s:5954

      801     5946    2                AND TDOPNV.TEST ~= %TD_TEST_MDR
      802     5947    2                AND NOT DCT.STATUS.DOWN
      803     5948    2                AND (  DCT.RAT$->FR$RAT.RES.SISID = JG_SLUG#
      804     5949    2                OR  DCT.RAT$->FR$RAT.RES.SISID = JG_PIG#       )
      805     5950    2              THEN
      806     5951    2                 CALL BADRET ( %E$TDDEVBSY, 4 ) ALTRET ( XIT ) ;

   5951  1 001036   000001 236000 2                  LDQ     1
         1 001037   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 001040   000011 236000 2                  LDQ     9
         1 001041   200255 756100                    STQ     I+2,,AUTO
         1 001042   001540 701000 1                  TSX1    BADRET
         1 001043   001537 702000 1                  TSX2    XIT

      807     5952    2            END;                           /* CASE NI$DVT$(DCT.DVTX)->DVT.TYPE   */

PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:146  
      808     5953                %LOCK (G#=TD_OPENGATE);

   5954  1 001044   000043 630400 2                  EPPR0   35
         1 001045   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001046   000000 701000 xent               TSX1    HFC$LOCK
         1 001047   000000 011000                    NOP     0

      809     5956    1           IF DCT$->DCT.STATUS.TND=0 THEN DCT$->DCT.STATUS.TND=TDOPNV.TEST;

   5956  1 001050   200005 470500                    LDP0    DCT$,,AUTO
         1 001051   000027 236100                    LDQ     23,,PR0
         1 001052   170000 316003                    CANQ    61440,DU
         1 001053   001062 601000 1                  TNZ     s:5957

   5956  1 001054   000000 471400 xsym               LDP1    B$PS0$
         1 001055   100002 236100                    LDQ     2,,PR1
         1 001056   000027 676100                    ERQ     23,,PR0
         1 001057   170000 376003                    ANQ     61440,DU
         1 001060   000027 656100                    ERSQ    23,,PR0
         1 001061   001070 710000 1                  TRA     s:5959

      810     5957    1           ELSE CALL BADRET(%E$TDDEVBSY,4) ALTRET(UNLOCK);

   5957  1 001062   000001 236000 2                  LDQ     1
         1 001063   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 001064   000011 236000 2                  LDQ     9
         1 001065   200255 756100                    STQ     I+2,,AUTO
         1 001066   001540 701000 1                  TSX1    BADRET
         1 001067   001522 702000 1                  TSX2    UNLOCK

      811     5958                %UNLOCK (G#=TD_OPENGATE);

   5959  1 001070   000043 630400 2                  EPPR0   35
         1 001071   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001072   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001073   000000 011000                    NOP     0

PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:147  
      812     5961        /**/
      813     5962        /* MODIFY I/O TABLES */
      814     5963        /**/
      815     5964    1           DCT.STATUS.TND=TDOPNV.TEST;

   5964  1 001074   000000 470400 xsym               LDP0    B$PS0$
         1 001075   200005 471500                    LDP1    DCT$,,AUTO
         1 001076   000002 236100                    LDQ     2,,PR0
         1 001077   100027 676100                    ERQ     23,,PR1
         1 001100   170000 376003                    ANQ     61440,DU
         1 001101   100027 656100                    ERSQ    23,,PR1

      816     5965    1           DCT.SPEVENT=TDOPNV.SPEVENT;

   5965  1 001102   000001 235100                    LDA     1,,PR0
         1 001103   100025 755100                    STA     21,,PR1

      817     5966    1           DCT.TDUSER#=B$JIT.USER;

   5966  1 001104   000000 473400 xsym               LDP3    B$JIT$
         1 001105   300000 236100                    LDQ     0,,PR3
         1 001106   100027 552120                    STBQ    23,'20'O,PR1

      818     5967    2           DO CASE(TDOPNV.TEST);

   5967  1 001107   000002 236100                    LDQ     2,,PR0
         1 001110   000036 772000                    QRL     30
         1 001111   000010 116007                    CMPQ    8,DL
         1 001112   001114 602006 1                  TNC     s:5967+5,QL
         1 001113   001275 710000 1                  TRA     s:6012
         1 001114   001275 710000 1                  TRA     s:6012
         1 001115   001275 710000 1                  TRA     s:6012
         1 001116   001240 710000 1                  TRA     s:6000
         1 001117   001124 710000 1                  TRA     s:5969
         1 001120   001275 710000 1                  TRA     s:6012
         1 001121   001275 710000 1                  TRA     s:6012
         1 001122   001275 710000 1                  TRA     s:6012
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:148  
         1 001123   001262 710000 1                  TRA     s:6004

      819     5968    2            CASE(%TD_TEST_MDR);

      820     5969    2              MPC$->DCT.STATUS.TND=%TD_TEST_MDR;

   5969  1 001124   200024 474500                    LDP4    MPC$,,AUTO
         1 001125   400027 236100                    LDQ     23,,PR4
         1 001126   000044 376000 2                  ANQ     36
         1 001127   030000 276003                    ORQ     12288,DU
         1 001130   400027 756100                    STQ     23,,PR4

      821     5970                                     /* WHILE RUNNING THE MDR THROUGH THIS
      822     5971                                        MPC, MAKE IO THROUGH THE MPC BE
      823     5972                                        SINGLE STREAM ON THE CHANNEL THE
      824     5973                                        MDR IS USING                       */
      825     5974    3              DO I=0 TO 1;

   5974  1 001131   200023 450100                    STZ     I,,AUTO

      826     5975    4                 IF NI$SQH.MPC$(I)=MPC$ THEN DO;

   5975  1 001132   200041 470500                    LDP0    SQH$,,AUTO
         1 001133   200023 720100                    LXL0    I,,AUTO
         1 001134   000005 236110                    LDQ     5,X0,PR0
         1 001135   200024 116100                    CMPQ    MPC$,,AUTO
         1 001136   001164 601000 1                  TNZ     s:5981

      827     5976    4                    CALL NIW$MPCSTOP(NI$SQH.MPC$(I)->DCT);

   5976  1 001137   000005 471510                    LDP1    5,X0,PR0
         1 001140   200260 451500                    STP1    @SEV+2,,AUTO
         1 001141   200260 630500                    EPPR0   @SEV+2,,AUTO
         1 001142   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001143   000000 701000 xent               TSX1    NIW$MPCSTOP
         1 001144   000000 011000                    NOP     0

PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:149  
      828     5977    5                    IF NI$SQH.MPC$(I)->DCT.MPC.ALTMPCX~=0 THEN DO;

   5977  1 001145   200041 470500                    LDP0    SQH$,,AUTO
         1 001146   200023 720100                    LXL0    I,,AUTO
         1 001147   000005 471510                    LDP1    5,X0,PR0
         1 001150   100035 236100                    LDQ     29,,PR1
         1 001151   000777 316007                    CANQ    511,DL
         1 001152   001164 600000 1                  TZE     s:5981

      829     5978    5                       CALL NIW$MPCSTOP(N$DCT$(NI$SQH.MPC$(I)->DCT.MPC.ALTMPCX)->DCT);

   5978  1 001153   100035 721100                    LXL1    29,,PR1
         1 001154   000777 361003                    ANX1    511,DU
         1 001155   000000 473400 xsym               LDP3    N$DCT$$
         1 001156   300000 474511                    LDP4    0,X1,PR3
         1 001157   200260 454500                    STP4    @SEV+2,,AUTO
         1 001160   200260 630500                    EPPR0   @SEV+2,,AUTO
         1 001161   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001162   000000 701000 xent               TSX1    NIW$MPCSTOP
         1 001163   000000 011000                    NOP     0

      830     5979    5                       END;

      831     5980    4                    END;

      832     5981    3                 END;

   5981  1 001164   200023 054100                    AOS     I,,AUTO
         1 001165   200023 235100                    LDA     I,,AUTO
         1 001166   000001 115007                    CMPA    1,DL
         1 001167   001132 604400 1                  TMOZ    s:5975

      833     5982    3              DO WHILE(NOT MPC$->DCT.DFLG.MPCSTOP);

   5982  1 001170   001202 710000 1                  TRA     s:5984

      834     5983    3                 CALL SSR$REG(%SS_SL,,1);
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:150  

   5983  1 001171   000045 236000 2                  LDQ     37
         1 001172   200262 756100                    STQ     @SEV+4,,AUTO
         1 001173   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001174   000026 235000 2                  LDA     22
         1 001175   200260 757100                    STAQ    @SEV+2,,AUTO
         1 001176   200260 630500                    EPPR0   @SEV+2,,AUTO
         1 001177   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001200   000000 701000 xent               TSX1    SSR$REG
         1 001201   000000 011000                    NOP     0

      835     5984    3                 END;

   5984  1 001202   200024 470500                    LDP0    MPC$,,AUTO
         1 001203   000006 236100                    LDQ     6,,PR0
         1 001204   001000 316007                    CANQ    512,DL
         1 001205   001171 600000 1                  TZE     s:5983

      836     5985                   %LOCK (G#=NI$SQH.GATE);

   5986  1 001206   200041 630500                    EPPR0   SQH$,,AUTO
         1 001207   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001210   000000 701000 xent               TSX1    HFC$LOCK
         1 001211   000000 011000                    NOP     0

      837     5988    2              MPC$->DCT.DFLG.MPCSTOP='0'B;

   5988  1 001212   200024 470500                    LDP0    MPC$,,AUTO
         1 001213   000046 236000 2                  LDQ     38
         1 001214   000006 356100                    ANSQ    6,,PR0

      838     5989    3              IF NOT NI$DQH.STATUS.DOWN THEN DO;

   5989  1 001215   200006 470500                    LDP0    DQH$,,AUTO
         1 001216   000001 236100                    LDQ     1,,PR0
         1 001217   200000 316003                    CANQ    65536,DU
         1 001220   001233 601000 1                  TNZ     s:5996
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:151  

      839     5990    3                 NI$DQH.CHANSTATE.STOP='0'B;

   5990  1 001221   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 001222   000020 356100                    ANSQ    16,,PR0

      840     5991                      %ENQUEUE(P#=NI$DQH,Q#=NI$SQH.CQ$);

   5992  1 001223   200041 236100                    LDQ     SQH$,,AUTO
         1 001224   000004 036003                    ADLQ    4,DU
         1 001225   200006 235100                    LDA     DQH$,,AUTO
         1 001226   200260 757100                    STAQ    @SEV+2,,AUTO
         1 001227   200260 630500                    EPPR0   @SEV+2,,AUTO
         1 001230   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001231   000000 701000 xent               TSX1    NIM$ENQUEUE
         1 001232   000000 011000                    NOP     0

      841     5994    3                 END;

      842     5995                   %UNLOCK (G#=NI$SQH.GATE);

   5996  1 001233   200041 630500                    EPPR0   SQH$,,AUTO
         1 001234   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001235   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001236   000000 011000                    NOP     0
         1 001237   001275 710000 1                  TRA     s:6012

      843     5998    2            CASE(%TD_TEST_ITR);

      844     5999                                                /* STOP THE MPC WHILE RUNNING THE ITR */
      845     6000    2              CALL NIW$MPCSTOP(MPC$->DCT);

   6000  1 001240   200024 630500                    EPPR0   MPC$,,AUTO
         1 001241   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001242   000000 701000 xent               TSX1    NIW$MPCSTOP
         1 001243   000000 011000                    NOP     0

PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:152  
      846     6001    2              IF MPC$->DCT.MPC.ALTMPCX~=0 THEN

   6001  1 001244   200024 470500                    LDP0    MPC$,,AUTO
         1 001245   000035 236100                    LDQ     29,,PR0
         1 001246   000777 316007                    CANQ    511,DL
         1 001247   001275 600000 1                  TZE     s:6012

      847     6002    2                 CALL NIW$MPCSTOP(N$DCT$(MPC$->DCT.MPC.ALTMPCX)->DCT);

   6002  1 001250   000035 720100                    LXL0    29,,PR0
         1 001251   000777 360003                    ANX0    511,DU
         1 001252   000000 471400 xsym               LDP1    N$DCT$$
         1 001253   100000 473510                    LDP3    0,X0,PR1
         1 001254   200260 453500                    STP3    @SEV+2,,AUTO
         1 001255   200260 630500                    EPPR0   @SEV+2,,AUTO
         1 001256   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001257   000000 701000 xent               TSX1    NIW$MPCSTOP
         1 001260   000000 011000                    NOP     0
         1 001261   001275 710000 1                  TRA     s:6012

      848     6003    2            CASE(%TD_TEST_MCA);

      849     6004    2              DCT$->DCT.MCA.USER#=B$JIT.USER;

   6004  1 001262   300000 236100                    LDQ     0,,PR3
         1 001263   000022 772000                    QRL     18
         1 001264   000777 376007                    ANQ     511,DL
         1 001265   100031 756100                    STQ     25,,PR1

      850     6005    2              DCT$->DCT.MCA.RESERVED='1'B;

   6005  1 001266   400000 236003                    LDQ     -131072,DU
         1 001267   100030 256100                    ORSQ    24,,PR1

      851     6006                   %UNLOCK(G#=NI$SQH.GATE);

   6007  1 001270   200041 630500                    EPPR0   SQH$,,AUTO
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:153  
         1 001271   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001272   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001273   000000 011000                    NOP     0
         1 001274   001275 710000 1                  TRA     s:6012

      852     6009    2            CASE ( %TD_TEST_IPC ) ;

      853     6010
      854     6011    2            END;

      855     6012    1           TEMP=DCT.DCTX;

   6012  1 001275   200005 470500                    LDP0    DCT$,,AUTO
         1 001276   000006 236100                    LDQ     6,,PR0
         1 001277   000025 772000                    QRL     21
         1 001300   200042 756100                    STQ     TEMP,,AUTO

      856     6013    1           CALL FSA$GSP(SIZEW(NI$EXTST),EXTST$) ALTRET(XIT);

   6013  1 001301   200020 631500                    EPPR1   EXTST$,,AUTO
         1 001302   200261 451500                    STP1    @SEV+3,,AUTO
         1 001303   000047 236000 2                  LDQ     39
         1 001304   200260 756100                    STQ     @SEV+2,,AUTO
         1 001305   200260 630500                    EPPR0   @SEV+2,,AUTO
         1 001306   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001307   000000 701000 xent               TSX1    FSA$GSP
         1 001310   001537 702000 1                  TSX2    XIT

      857     6014    1           CALL OCI$MK_WR(M_DEVC,TDOPN_MSG#,5,LEN,MSG,TEMP);

   6014  1 001311   200042 630500                    EPPR0   TEMP,,AUTO
         1 001312   200265 450500                    STP0    @SEV+7,,AUTO
         1 001313   200026 631500                    EPPR1   MSG,,AUTO
         1 001314   200264 451500                    STP1    @SEV+6,,AUTO
         1 001315   000020 237000 2                  LDAQ    16
         1 001316   200262 757100                    STAQ    @SEV+4,,AUTO
         1 001317   000052 237000 2                  LDAQ    42
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:154  
         1 001320   200260 757100                    STAQ    @SEV+2,,AUTO
         1 001321   200260 630500                    EPPR0   @SEV+2,,AUTO
         1 001322   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 001323   000000 701000 xent               TSX1    OCI$MK_WR
         1 001324   000000 011000                    NOP     0

      858     6015        /**/
      859     6016        /* SET UP TD DCB */
      860     6017        /**/
      861     6018    1           DCB$->F$DCB.TYC='0'B;

   6018  1 001325   200004 470500                    LDP0    DCB$,,AUTO
         1 001326   000001 450100                    STZ     1,,PR0
         1 001327   000002 450100                    STZ     2,,PR0

      862     6019    1           DCB$->F$DCB.FUN=TDOPNV.TEST;

   6019  1 001330   000000 470400 xsym               LDP0    B$PS0$
         1 001331   200004 471500                    LDP1    DCB$,,AUTO
         1 001332   000002 236100                    LDQ     2,,PR0
         1 001333   770000 376003                    ANQ     -4096,DU
         1 001334   000014 772000                    QRL     12
         1 001335   100032 552120                    STBQ    26,'20'O,PR1

      863     6020    1           DCB$->F$DCB.DVTYPE=DCT.TYPE;

   6020  1 001336   200005 473500                    LDP3    DCT$,,AUTO
         1 001337   300007 236100                    LDQ     7,,PR3
         1 001340   007700 376007                    ANQ     4032,DL
         1 001341   000025 736000                    QLS     21
         1 001342   100032 552140                    STBQ    26,'40'O,PR1

      864     6021    1           IF DCT.TYPE~=%DV_LP THEN DCB$->F$DCB.WIDTH=0;

   6021  1 001343   300007 236100                    LDQ     7,,PR3
         1 001344   007700 376007                    ANQ     4032,DL
         1 001345   000300 116007                    CMPQ    192,DL
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:155  
         1 001346   001352 600000 1                  TZE     s:6023

   6021  1 001347   000000 236003                    LDQ     0,DU
         1 001350   100004 552104                    STBQ    4,'04'O,PR1
         1 001351   001423 710000 1                  TRA     s:6032

      865     6022    2           ELSE DO;

      866     6023    2              DCB$->F$DCB.WIDTH=132;

   6023  1 001352   000204 236007                    LDQ     132,DL
         1 001353   100004 552104                    STBQ    4,'04'O,PR1

      867     6024    2              CALL HFF$DSIZ(1,TEMP);

   6024  1 001354   200042 631500                    EPPR1   TEMP,,AUTO
         1 001355   200261 451500                    STP1    @SEV+3,,AUTO
         1 001356   000045 236000 2                  LDQ     37
         1 001357   200260 756100                    STQ     @SEV+2,,AUTO
         1 001360   200260 630500                    EPPR0   @SEV+2,,AUTO
         1 001361   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001362   000000 701000 xent               TSX1    HFF$DSIZ
         1 001363   000000 011000                    NOP     0

      868     6025    2              IF TEMP>=60*4 THEN B$PS1$->CHAINIMG=DCT.LP.CHAIN$->CHAINIMG;

   6025  1 001364   200042 235100                    LDA     TEMP,,AUTO
         1 001365   000360 115007                    CMPA    240,DL
         1 001366   001375 602000 1                  TNC     s:6026

   6025  1 001367   200005 470500                    LDP0    DCT$,,AUTO
         1 001370   000032 471500                    LDP1    26,,PR0
         1 001371   000000 473400 xsym               LDP3    B$PS1$
         1 001372   000100 100500                    MLR     fill='000'O
         1 001373   100000 000360                    ADSC9   0,,PR1                   cn=0,n=240
         1 001374   300000 000360                    ADSC9   0,,PR3                   cn=0,n=240

PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:156  
      869     6026    2              CALL HFF$DSIZ(2,TEMP);

   6026  1 001375   200042 630500                    EPPR0   TEMP,,AUTO
         1 001376   200261 450500                    STP0    @SEV+3,,AUTO
         1 001377   000054 236000 2                  LDQ     44
         1 001400   200260 756100                    STQ     @SEV+2,,AUTO
         1 001401   200260 630500                    EPPR0   @SEV+2,,AUTO
         1 001402   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001403   000000 701000 xent               TSX1    HFF$DSIZ
         1 001404   000000 011000                    NOP     0

      870     6027    3              IF TEMP>=DCT.LP.VFCL*4 THEN DO;

   6027  1 001405   200005 470500                    LDP0    DCT$,,AUTO
         1 001406   000031 236100                    LDQ     25,,PR0
         1 001407   000002 736000                    QLS     2
         1 001410   200042 116100                    CMPQ    TEMP,,AUTO
         1 001411   001413 600000 1                  TZE     s:6028
         1 001412   001423 603000 1                  TRC     s:6032

      871     6028    3                 TEMP=DCT.LP.VFCL*4;

   6028  1 001413   200042 756100                    STQ     TEMP,,AUTO

      872     6029    3                 B$PS2$->VFCIMG=DCT.LP.VFC$->VFCIMG;

   6029  1 001414   000030 471500                    LDP1    24,,PR0
         1 001415   000000 620006                    EAX0    0,QL
         1 001416   000000 473400 xsym               LDP3    B$PS2$
         1 001417   200042 721100                    LXL1    TEMP,,AUTO
         1 001420   040140 100540                    MLR     fill='040'O
         1 001421   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         1 001422   300000 000011                    ADSC9   0,,PR3                   cn=0,n=*X1

      873     6030    3                 END;

      874     6031    2              END;
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:157  

      875     6032    1           DCB$->F$DCB.DQH$=DQH$;

   6032  1 001423   200006 236100                    LDQ     DQH$,,AUTO
         1 001424   200004 470500                    LDP0    DCB$,,AUTO
         1 001425   000046 756100                    STQ     38,,PR0

      876     6033    1           DCB$->F$DCB.DCT$=DCT$;

   6033  1 001426   200005 236100                    LDQ     DCT$,,AUTO
         1 001427   000047 756100                    STQ     39,,PR0

      877     6034    1           DCB$->F$DCB.MPC$=MPC$;

   6034  1 001430   200024 236100                    LDQ     MPC$,,AUTO
         1 001431   000050 756100                    STQ     40,,PR0

      878     6035    1           DCB$->F$DCB.TDEXTST$=EXTST$;

   6035  1 001432   200020 236100                    LDQ     EXTST$,,AUTO
         1 001433   000007 756100                    STQ     7,,PR0

      879     6036    1           DCB$->F$DCB.DEVADR=TDOPNV.DEVICE;

   6036  1 001434   000000 471400 xsym               LDP1    B$PS0$
         1 001435   100000 720100                    LXL0    0,,PR1
         1 001436   000051 440100                    SXL0    41,,PR0

      880     6037    1           DCB$->F$DCB.CONNCT=0;

   6037  1 001437   000041 450100                    STZ     33,,PR0

      881     6038    1           DCB$->F$DCB.CHANTIME=0;

   6038  1 001440   000042 450100                    STZ     34,,PR0

      882     6039    1           DCB$->F$DCB.ASN=%T@D#;
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:158  

   6039  1 001441   006000 236007                    LDQ     3072,DL
         1 001442   000032 552110                    STBQ    26,'10'O,PR0

      883     6040    1           DCB$->F$DCB.FCN='0'B;

   6040  1 001443   000000 221003                    LDX1    0,DU
         1 001444   000074 741100                    STX1    60,,PR0

      884     6041    1           DCB$->F$DCB.FCD='1'B;           /* MARK DCB OPEN                      */

   6041  1 001445   020000 236007                    LDQ     8192,DL
         1 001446   000031 256100                    ORSQ    25,,PR0

      885     6042    1           EL$DIAG.ACCN=B$JIT.ACCN;

   6042  1 001447   000000 473400 xsym               LDP3    B$JIT$
         1 001450   040100 100500                    MLR     fill='040'O
         1 001451   300001 000010                    ADSC9   1,,PR3                   cn=0,n=8
         1 001452   200007 000010                    ADSC9   EL$DIAG,,AUTO            cn=0,n=8

      886     6043    1           EL$DIAG.UNAME=B$JIT.UNAME;

   6043  1 001453   040100 100500                    MLR     fill='040'O
         1 001454   300003 000014                    ADSC9   3,,PR3                   cn=0,n=12
         1 001455   200011 000014                    ADSC9   EL$DIAG+2,,AUTO          cn=0,n=12

      887     6044    1           EL$DIAG.SYSID=B$JIT.SYSID;

   6044  1 001456   300000 722100                    LXL2    0,,PR3
         1 001457   200014 742100                    STX2    EL$DIAG+5,,AUTO

      888     6045    1           EL$DIAG.DEVNM=DCT$->DCT.DEVNM;

   6045  1 001460   200005 474500                    LDP4    DCT$,,AUTO
         1 001461   040100 100500                    MLR     fill='040'O
         1 001462   400002 000010                    ADSC9   2,,PR4                   cn=0,n=8
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:159  
         1 001463   200015 000010                    ADSC9   EL$DIAG+6,,AUTO          cn=0,n=8

      889     6046    1           EL$DIAG.TEST=TDOPNV.TEST;

   6046  1 001464   100002 236100                    LDQ     2,,PR1
         1 001465   000036 772000                    QRL     30
         1 001466   200017 756100                    STQ     EL$DIAG+8,,AUTO

      890     6047    1           CALL ELA$SYSLOG(EL_DIAG,EL$DIAG,SIZEW(EL$DIAG),'0'B,1,TEMP);

   6047  1 001467   200042 635500                    EPPR5   TEMP,,AUTO
         1 001470   200265 455500                    STP5    @SEV+7,,AUTO
         1 001471   000045 236000 2                  LDQ     37
         1 001472   200264 756100                    STQ     @SEV+6,,AUTO
         1 001473   000056 237000 2                  LDAQ    46
         1 001474   200262 757100                    STAQ    @SEV+4,,AUTO
         1 001475   200007 636500                    EPPR6   EL$DIAG,,AUTO
         1 001476   200261 456500                    STP6    @SEV+3,,AUTO
         1 001477   000060 236000 2                  LDQ     48
         1 001500   200260 756100                    STQ     @SEV+2,,AUTO
         1 001501   200260 630500                    EPPR0   @SEV+2,,AUTO
         1 001502   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 001503   000000 701000 xent               TSX1    ELA$SYSLOG
         1 001504   000000 011000                    NOP     0

      891     6048    1           RETURN;

   6048  1 001505   000000 702200 xent               TSX2  ! X66_ARET

      892     6049    1   BRKYC:
      893     6050    1           CALL BADRET(%E$BREAK,4) ALTRET(XIT);

   6050  1 001506   000001 236000 2     BRKYC        LDQ     1
         1 001507   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 001510   000062 236000 2                  LDQ     50
         1 001511   200255 756100                    STQ     I+2,,AUTO
         1 001512   001540 701000 1                  TSX1    BADRET
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:160  
         1 001513   001537 702000 1                  TSX2    XIT

      894     6051    1   TDNODEV:
      895     6052    1           CALL BADRET(%E$TDNODEV,4) ALTRET(XIT);

   6052  1 001514   000001 236000 2     TDNODEV      LDQ     1
         1 001515   200256 756100                    STQ     @ERRCODE+1,,AUTO
         1 001516   000007 236000 2                  LDQ     7
         1 001517   200255 756100                    STQ     I+2,,AUTO
         1 001520   001540 701000 1                  TSX1    BADRET
         1 001521   001537 702000 1                  TSX2    XIT

      896     6053        /*E*        ERROR: TDP-E$TDNODEV
      897     6054                  MESSAGE: Device requested by M$TDOPEN does not exist.
      898     6055        */
      899     6056    1   UNLOCK:
      900     6057                %UNLOCK(G#=TD_OPENGATE);

   6058  1 001522   000043 630400 2     UNLOCK       EPPR0   35
         1 001523   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001524   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001525   000000 011000                    NOP     0

      901     6060    1   MCA_UNLK:
      902     6061    1           IF TDOPNV.TEST = %TD_TEST_MCA

   6061  1 001526   000000 470400 xsym  MCA_UNLK     LDP0    B$PS0$
         1 001527   000002 236100                    LDQ     2,,PR0
         1 001530   770000 376003                    ANQ     -4096,DU
         1 001531   070000 116003                    CMPQ    28672,DU
         1 001532   001537 601000 1                  TNZ     XIT

      903     6062    2           THEN DO;

      904     6063                   %UNLOCK(G#=NI$SQH.GATE);

   6064  1 001533   200041 630500                    EPPR0   SQH$,,AUTO
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:161  
         1 001534   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001535   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001536   000000 011000                    NOP     0

      905     6066    2              END;

      906     6067    1   XIT:    RETURN;

   6067  1 001537   000000 702200 xent  XIT          TSX2  ! X66_ARET

      907     6068    1   BADRET: PROC(ERRCODE,SEV) ALTRET;

   6068  1 001540   200254 741300       BADRET       STX1  ! I+1,,AUTO

      908     6069    2   DCL ERRCODE UBIN WORD;
      909     6070    2   DCL SEV UBIN WORD;
      910     6071        /**/
      911     6072    2           B$JIT.ERR='240420000000'O;

   6072  1 001541   000003 236000 0                  LDQ     LEN+3
         1 001542   000000 470400 xsym               LDP0    B$JIT$
         1 001543   000012 756100                    STQ     10,,PR0

      912     6073    2           B$JIT.ERR.CODE=ERRCODE;

   6073  1 001544   200255 471500                    LDP1    @ERRCODE,,AUTO
         1 001545   100000 236100                    LDQ     0,,PR1
         1 001546   000003 736000                    QLS     3
         1 001547   000012 676100                    ERQ     10,,PR0
         1 001550   377770 376007                    ANQ     131064,DL
         1 001551   000012 656100                    ERSQ    10,,PR0

      913     6074    2           B$JIT.ERR.SEV=SEV;

   6074  1 001552   200256 473500                    LDP3    @SEV,,AUTO
         1 001553   300000 236100                    LDQ     0,,PR3
         1 001554   000012 676100                    ERQ     10,,PR0
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:162  
         1 001555   000007 376007                    ANQ     7,DL
         1 001556   000012 656100                    ERSQ    10,,PR0

      914     6075    2           ALTRETURN;

   6075  1 001557   200254 221300                    LDX1  ! I+1,,AUTO
         1 001560   000000 702211                    TSX2  ! 0,X1

      915     6076    2   END BADRET;
      916     6077        %EJECT;
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:163  
      917     6078    1   CHECK_SDSK: PROC ALTRET;

   6078  1 001561   200252 741300       CHECK_SDSK   STX1  ! X+2,,AUTO

      918     6079    2   DCL I SBIN;
      919     6080        /**/
      920     6081    2           CALL NIQ$GET(Q$);

   6081  1 001562   200040 630500                    EPPR0   Q$,,AUTO
         1 001563   200260 450500                    STP0    @SEV+2,,AUTO
         1 001564   200260 630500                    EPPR0   @SEV+2,,AUTO
         1 001565   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001566   000000 701000 xent               TSX1    NIQ$GET
         1 001567   000000 011000                    NOP     0

      921     6082    2           N$REQ.DLA.DCTX=DCT$->DCT.DCTX;

   6082  1 001570   200005 470500                    LDP0    DCT$,,AUTO
         1 001571   200040 471500                    LDP1    Q$,,AUTO
         1 001572   000006 236100                    LDQ     6,,PR0
         1 001573   100001 676100                    ERQ     1,,PR1
         1 001574   777770 376003                    ANQ     -8,DU
         1 001575   100001 656100                    ERSQ    1,,PR1

      922     6083    2           N$REQ.FC=%N_RQSTAT;

   6083  1 001576   200040 470500                    LDP0    Q$,,AUTO
         1 001577   000001 236007                    LDQ     1,DL
         1 001600   000003 552104                    STBQ    3,'04'O,PR0

      923     6084    2           N$REQ.BPMIR = '1'B ;

   6084  1 001601   200040 470500                    LDP0    Q$,,AUTO
         1 001602   200000 236003                    LDQ     65536,DU
         1 001603   000034 256100                    ORSQ    28,,PR0

      924     6085    2           N$REQ.DCB$=DCB$;
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:164  

   6085  1 001604   200004 236100                    LDQ     DCB$,,AUTO
         1 001605   200040 470500                    LDP0    Q$,,AUTO
         1 001606   000022 756100                    STQ     18,,PR0

      925     6086    2           N$REQ.OPFLG=%(OP_USER|OP_WAIT|OP_HOLD|OP_CLR);

   6086  1 001607   200040 470500                    LDP0    Q$,,AUTO
         1 001610   000425 236007                    LDQ     277,DL
         1 001611   000004 552104                    STBQ    4,'04'O,PR0

      926     6087    2           CALL NIO$QUE(Q$->N$REQ);

   6087  1 001612   200040 630500                    EPPR0   Q$,,AUTO
         1 001613   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001614   000000 701000 xent               TSX1    NIO$QUE
         1 001615   000000 011000                    NOP     0

      927     6088    2           IF Q$->N$REQ.STATUS.MAJOR~=0 THEN GOTO SET_SDSK;

   6088  1 001616   200040 470500                    LDP0    Q$,,AUTO
         1 001617   000014 236100                    LDQ     12,,PR0
         1 001620   170000 316003                    CANQ    61440,DU
         1 001621   001731 601000 1                  TNZ     SET_SDSK

      928     6089    2           N$REQ.FC=%N_RDBIN;

   6089  1 001622   000002 236007                    LDQ     2,DL
         1 001623   000003 552104                    STBQ    3,'04'O,PR0

      929     6090    2           N$REQ.OPFLG=%(OP_USER|OP_WAIT|OP_BPF|OP_HOLD|OP_CLR);

   6090  1 001624   200040 470500                    LDP0    Q$,,AUTO
         1 001625   000435 236007                    LDQ     285,DL
         1 001626   000004 552104                    STBQ    4,'04'O,PR0

      930     6091    2           N$REQ.BUF$=ADDR(VIDBUF1);
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:165  

   6091  1 001627   200045 630500                    EPPR0   VIDBUF1,,AUTO
         1 001630   200040 471500                    LDP1    Q$,,AUTO
         1 001631   100005 450500                    STP0    5,,PR1

      931     6092    2           N$REQ.BUFSIZE=SIZEC(VIDBUF1);

   6092  1 001632   200040 470500                    LDP0    Q$,,AUTO
         1 001633   000004 236100                    LDQ     4,,PR0
         1 001634   177777 376007                    ANQ     65535,DL
         1 001635   000100 276003                    ORQ     64,DU
         1 001636   000004 756100                    STQ     4,,PR0

      932     6093    2           N$REQ.DLA.DRELADDR=0;

   6093  1 001637   200040 470500                    LDP0    Q$,,AUTO
         1 001640   777770 236003                    LDQ     -8,DU
         1 001641   000001 356100                    ANSQ    1,,PR0

      933     6094    2           CALL NIO$QUE(Q$->N$REQ);

   6094  1 001642   200040 630500                    EPPR0   Q$,,AUTO
         1 001643   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001644   000000 701000 xent               TSX1    NIO$QUE
         1 001645   000000 011000                    NOP     0

      934     6095    2           VID$=ADDR(VIDBUF1);

   6095  1 001646   200045 630500                    EPPR0   VIDBUF1,,AUTO
         1 001647   200044 450500                    STP0    VID$,,AUTO

      935     6096    3           IF FM$VID.ID='CP6 ' THEN DO;

   6096  1 001650   000000 236100                    LDQ     0,,PR0
         1 001651   000004 116000 0                  CMPQ    LEN+4
         1 001652   001721 601000 1                  TNZ     s:6109

PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:166  
      936     6097    3              IF FM$VID.VOLCNT~=0 THEN GOTO SET_SDSK;

   6097  1 001653   000004 720100                    LXL0    4,,PR0
         1 001654   001731 601000 1                  TNZ     SET_SDSK

      937     6098    4              DO I=0 TO 25;

   6098  1 001655   200253 450100                    STZ     I,,AUTO

      938     6099    5                 IF FM$VID.SECTSTRT(I)~=0 AND FM$VID.SECTSTRT(I)<DCT$->DCT.DVT$->DVT.
              6099                          PACKSIZE THEN DO;

   6099  1 001656   200044 470500                    LDP0    VID$,,AUTO
         1 001657   200253 720100                    LXL0    I,,AUTO
         1 001660   000010 235110                    LDA     8,X0,PR0
         1 001661   001715 600000 1                  TZE     s:6107
         1 001662   200005 471500                    LDP1    DCT$,,AUTO
         1 001663   100024 473500                    LDP3    20,,PR1
         1 001664   000010 236110                    LDQ     8,X0,PR0
         1 001665   300054 116100                    CMPQ    44,,PR3
         1 001666   001715 603000 1                  TRC     s:6107

      939     6100    5                    N$REQ.BUF$=ADDR(VIDBUF2);

   6100  1 001667   200145 634500                    EPPR4   VIDBUF2,,AUTO
         1 001670   200040 475500                    LDP5    Q$,,AUTO
         1 001671   500005 454500                    STP4    5,,PR5

      940     6101    5                    N$REQ.BUFSIZE=SIZEC(VIDBUF2);

   6101  1 001672   200040 471500                    LDP1    Q$,,AUTO
         1 001673   100004 236100                    LDQ     4,,PR1
         1 001674   177777 376007                    ANQ     65535,DL
         1 001675   000100 276003                    ORQ     64,DU
         1 001676   100004 756100                    STQ     4,,PR1

      941     6102    5                    N$REQ.OPFLG=%(OP_USER|OP_WAIT|OP_BPF|OP_HOLD|OP_CLR);
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:167  

   6102  1 001677   200040 471500                    LDP1    Q$,,AUTO
         1 001700   000435 236007                    LDQ     285,DL
         1 001701   100004 552104                    STBQ    4,'04'O,PR1

      942     6103    5                    N$REQ.DLA.DRELADDR=FM$VID.SECTSTRT(I);

   6103  1 001702   200040 471500                    LDP1    Q$,,AUTO
         1 001703   000010 236110                    LDQ     8,X0,PR0
         1 001704   100001 676100                    ERQ     1,,PR1
         1 001705   000063 376000 2                  ANQ     51
         1 001706   100001 656100                    ERSQ    1,,PR1

      943     6104    5                    CALL NIO$QUE(N$REQ);

   6104  1 001707   200040 630500                    EPPR0   Q$,,AUTO
         1 001710   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001711   000000 701000 xent               TSX1    NIO$QUE
         1 001712   000000 011000                    NOP     0

      944     6105    5                    IF ADDR(VIDBUF2)->FM$VID.VOLCNT~=0 THEN GOTO SET_SDSK;

   6105  1 001713   200151 720100                    LXL0    VIDBUF2+4,,AUTO
         1 001714   001731 601000 1                  TNZ     SET_SDSK

      945     6106    5                    END;

      946     6107    4                 END;

   6107  1 001715   200253 054100                    AOS     I,,AUTO
         1 001716   200253 235100                    LDA     I,,AUTO
         1 001717   000031 115007                    CMPA    25,DL
         1 001720   001656 604400 1                  TMOZ    s:6099

      947     6108    3              END;

      948     6109    2           CALL NIQ$REL(Q$);
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:168  

   6109  1 001721   200040 630500                    EPPR0   Q$,,AUTO
         1 001722   200260 450500                    STP0    @SEV+2,,AUTO
         1 001723   200260 630500                    EPPR0   @SEV+2,,AUTO
         1 001724   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001725   000000 701000 xent               TSX1    NIQ$REL
         1 001726   000000 011000                    NOP     0

      949     6110    2           RETURN;

   6110  1 001727   200252 221300                    LDX1  ! X+2,,AUTO
         1 001730   000001 702211                    TSX2  ! 1,X1

      950     6111    2   SET_SDSK:
      951     6112    2           CALL NIQ$REL(Q$);

   6112  1 001731   200040 630500       SET_SDSK     EPPR0   Q$,,AUTO
         1 001732   200260 450500                    STP0    @SEV+2,,AUTO
         1 001733   200260 630500                    EPPR0   @SEV+2,,AUTO
         1 001734   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001735   000000 701000 xent               TSX1    NIQ$REL
         1 001736   000000 011000                    NOP     0

      952     6113    2           DCB$->F$DCB.TDFLG.SDSK='1'B;

   6113  1 001737   200004 470500                    LDP0    DCB$,,AUTO
         1 001740   400000 236007                    LDQ     -131072,DL
         1 001741   000040 256100                    ORSQ    32,,PR0

      953     6114    2           ALTRETURN;

   6114  1 001742   200252 221300                    LDX1  ! X+2,,AUTO
         1 001743   000000 702211                    TSX2  ! 0,X1

      954     6115    2   END CHECK_SDSK;
      955     6116        %EJECT;
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:169  
      956     6117    1   OPEN_FEP: PROC;

   6117  1 001744   200252 741300       OPEN_FEP     STX1  ! X+2,,AUTO

      957     6118    2           IF NI$DQH.FEX~=FEI# THEN CALL BADRET(%E$TDNOTFEP,4) ALTRET(XIT);

   6118  1 001745   200006 470500                    LDP0    DQH$,,AUTO
         1 001746   000001 236100                    LDQ     1,,PR0
         1 001747   000006 772000                    QRL     6
         1 001750   000077 376007                    ANQ     63,DL
         1 001751   200022 116100                    CMPQ    FEI#,,AUTO
         1 001752   001761 600000 1                  TZE     s:6122

   6118  1 001753   000001 236000 2                  LDQ     1
         1 001754   200256 756100                    STQ     @SEV,,AUTO
         1 001755   000005 236000 2                  LDQ     5
         1 001756   200255 756100                    STQ     @ERRCODE,,AUTO
         1 001757   001540 701000 1                  TSX1    BADRET
         1 001760   002230 702000 1                  TSX2    XIT

      958     6119        /*E*    ERROR:   TDP-E$TDNOTFEP
      959     6120                MESSAGE: FEP does not exist.
      960     6121        */
      961     6122    2           CALL HFF$NILERASE(B$PS3$) ALTRET(BADWINDOW);

   6122  1 001761   000064 630400 2                  EPPR0   52
         1 001762   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001763   000000 701000 xent               TSX1    HFF$NILERASE
         1 001764   002002 702000 1                  TSX2    BADWINDOW

      962     6123    2           CALL HFF$DSIZ(B$PS3$,WSZ);

   6123  1 001765   200246 630500                    EPPR0   WSZ,,AUTO
         1 001766   200261 450500                    STP0    @SEV+3,,AUTO
         1 001767   000064 236000 2                  LDQ     52
         1 001770   200260 756100                    STQ     @SEV+2,,AUTO
         1 001771   200260 630500                    EPPR0   @SEV+2,,AUTO
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:170  
         1 001772   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001773   000000 701000 xent               TSX1    HFF$DSIZ
         1 001774   000000 011000                    NOP     0

      963     6124    3           IF MOD(WSZ,4096)~=0 THEN DO;

   6124  1 001775   200246 236100                    LDQ     WSZ,,AUTO
         1 001776   010000 506007                    DIV     4096,DL
         1 001777   000044 733000                    LRS     36
         1 002000   000000 116003                    CMPQ    0,DU
         1 002001   002010 600000 1                  TZE     s:6132

      964     6125    3   BADWINDOW: CALL BADRET(%E$TDBADWINDOW,4) ALTRET(XIT);

   6125  1 002002   000001 236000 2     BADWINDOW    LDQ     1
         1 002003   200256 756100                    STQ     @SEV,,AUTO
         1 002004   000066 236000 2                  LDQ     54
         1 002005   200255 756100                    STQ     @ERRCODE,,AUTO
         1 002006   001540 701000 1                  TSX1    BADRET
         1 002007   002230 702000 1                  TSX2    XIT

      965     6126        /*E*    ERROR:   TDP-E$TDBADWINDOW
      966     6127                MESSAGE: Window area must be present for T&D FEP open and must
      967     6128                         begin and end on a page boundary.
      968     6129        */
      969     6130    3              END;

      970     6131                %LOCK (G#=TD_OPENGATE);

   6132  1 002010   000043 630400 2                  EPPR0   35
         1 002011   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002012   000000 701000 xent               TSX1    HFC$LOCK
         1 002013   000000 011000                    NOP     0

      971     6134    2           IF NOT NI$DQH.STATUS.DOWN OR NI$DQH.STATUS.TND~=0 THEN

   6134  1 002014   200006 470500                    LDP0    DQH$,,AUTO
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:171  
         1 002015   000001 236100                    LDQ     1,,PR0
         1 002016   200000 316003                    CANQ    65536,DU
         1 002017   002022 600000 1                  TZE     s:6135
         1 002020   074000 316003                    CANQ    30720,DU
         1 002021   002030 600000 1                  TZE     s:6136

      972     6135    2              CALL BADRET(%E$TDFEPBSY,4) ALTRET(UNLOCK);

   6135  1 002022   000001 236000 2                  LDQ     1
         1 002023   200256 756100                    STQ     @SEV,,AUTO
         1 002024   000070 236000 2                  LDQ     56
         1 002025   200255 756100                    STQ     @ERRCODE,,AUTO
         1 002026   001540 701000 1                  TSX1    BADRET
         1 002027   002224 702000 1                  TSX2    UNLOCK

      973     6136    2           NI$DQH.STATUS.TND=TDOPNV.TEST;

   6136  1 002030   000000 470400 xsym               LDP0    B$PS0$
         1 002031   200006 471500                    LDP1    DQH$,,AUTO
         1 002032   000002 236100                    LDQ     2,,PR0
         1 002033   000001 772000                    QRL     1
         1 002034   100001 676100                    ERQ     1,,PR1
         1 002035   074000 376003                    ANQ     30720,DU
         1 002036   100001 656100                    ERSQ    1,,PR1

      974     6137                %UNLOCK (G#=TD_OPENGATE);

   6138  1 002037   000043 630400 2                  EPPR0   35
         1 002040   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002041   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002042   000000 011000                    NOP     0

      975     6140    2           FEI$ = KI$FEI$(NI$DQH.FEX);

   6140  1 002043   200006 470500                    LDP0    DQH$,,AUTO
         1 002044   000001 236100                    LDQ     1,,PR0
         1 002045   000006 772000                    QRL     6
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:172  
         1 002046   000077 376007                    ANQ     63,DL
         1 002047   000000 471400 xsym               LDP1    KI_FEI$$
         1 002050   100000 236106                    LDQ     0,QL,PR1
         1 002051   200021 756100                    STQ     FEI$,,AUTO

      976     6141    2           CALL MMS$VGET(KI$FEI.FEWSQ ,B$PS3$,WSZ,KI$FEI.BD$ )

   6141  1 002052   000010 036003                    ADLQ    8,DU
         1 002053   200263 756100                    STQ     @SEV+5,,AUTO
         1 002054   200246 633500                    EPPR3   WSZ,,AUTO
         1 002055   200262 453500                    STP3    @SEV+4,,AUTO
         1 002056   000064 236000 2                  LDQ     52
         1 002057   200261 756100                    STQ     @SEV+3,,AUTO
         1 002060   200021 236100                    LDQ     FEI$,,AUTO
         1 002061   000005 036003                    ADLQ    5,DU
         1 002062   200260 756100                    STQ     @SEV+2,,AUTO
         1 002063   200260 630500                    EPPR0   @SEV+2,,AUTO
         1 002064   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 002065   000000 701000 xent               TSX1    MMS$VGET
         1 002066   002070 702000 1                  TSX2    s:6144
         1 002067   002104 710000 1                  TRA     s:6152

      977     6142    3           WHENALTRETURN DO;

      978     6143                   %LOCK (G=TD_OPENGATE);

   6144  1 002070   000043 630400 2                  EPPR0   35
         1 002071   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002072   000000 701000 xent               TSX1    HFC$LOCK
         1 002073   000000 011000                    NOP     0

      979     6146    3              NI$DQH.STATUS.TND = 0;

   6146  1 002074   200006 470500                    LDP0    DQH$,,AUTO
         1 002075   000071 236000 2                  LDQ     57
         1 002076   000001 356100                    ANSQ    1,,PR0

PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:173  
      980     6147                   %UNLOCK(G=TD_OPENGATE);

   6148  1 002077   000043 630400 2                  EPPR0   35
         1 002100   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002101   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002102   000000 011000                    NOP     0

      981     6150    3              GOTO BADWINDOW;

   6150  1 002103   002002 710000 1                  TRA     BADWINDOW

      982     6151    3              END;
      983     6152    2           NI$DQH.USER#=B$JIT.USER;

   6152  1 002104   000000 470400 xsym               LDP0    B$JIT$
         1 002105   200006 471500                    LDP1    DQH$,,AUTO
         1 002106   000000 236100                    LDQ     0,,PR0
         1 002107   100020 552120                    STBQ    16,'20'O,PR1

      984     6153    2           NI$DQH.EVENTINFO = TDOPNV.SPEVENT;

   6153  1 002110   000000 473400 xsym               LDP3    B$PS0$
         1 002111   300001 235100                    LDA     1,,PR3
         1 002112   100017 755100                    STA     15,,PR1

      985     6154    2           DCB$->F$DCB.TYC='0'B;

   6154  1 002113   200004 474500                    LDP4    DCB$,,AUTO
         1 002114   400001 450100                    STZ     1,,PR4
         1 002115   400002 450100                    STZ     2,,PR4

      986     6155    2           DCB$->F$DCB.FUN=TDOPNV.TEST;

   6155  1 002116   200004 471500                    LDP1    DCB$,,AUTO
         1 002117   300002 236100                    LDQ     2,,PR3
         1 002120   770000 376003                    ANQ     -4096,DU
         1 002121   000014 772000                    QRL     12
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:174  
         1 002122   100032 552120                    STBQ    26,'20'O,PR1

      987     6156    2           DCB$->F$DCB.XTNSIZE=WSZ/4096;

   6156  1 002123   200246 236100                    LDQ     WSZ,,AUTO
         1 002124   010000 506007                    DIV     4096,DL
         1 002125   000000 620006                    EAX0    0,QL
         1 002126   100037 740100                    STX0    31,,PR1

      988     6157    2           DCB$->F$DCB.IXTNSIZE=X;         /* NEED TO SAVE X FOR CLOSE           */

   6157  1 002127   200250 235100                    LDA     X,,AUTO
         1 002130   100041 755100                    STA     33,,PR1

      989     6158    2           DCB$->F$DCB.DQH$=DQH$;

   6158  1 002131   200006 236100                    LDQ     DQH$,,AUTO
         1 002132   100046 756100                    STQ     38,,PR1

      990     6159    2           DCB$->F$DCB.DEVADR.DVN=FEI#;

   6159  1 002133   200022 236100                    LDQ     FEI#,,AUTO
         1 002134   000014 736000                    QLS     12
         1 002135   100051 752104                    STCQ    41,'04'O,PR1

      991     6160    2           DCB$->F$DCB.CONNCT=0;

   6160  1 002136   100041 450100                    STZ     33,,PR1

      992     6161    2           DCB$->F$DCB.CHANTIME=0;

   6161  1 002137   100042 450100                    STZ     34,,PR1

      993     6162    2           DCB$->F$DCB.ASN=%T@D#;

   6162  1 002140   006000 236007                    LDQ     3072,DL
         1 002141   100032 552110                    STBQ    26,'10'O,PR1
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:175  

      994     6163    2           DCB$->F$DCB.FCN='0'B;

   6163  1 002142   000000 221003                    LDX1    0,DU
         1 002143   100074 741100                    STX1    60,,PR1

      995     6164    2           DCB$->F$DCB.CFU$ = KI$FEI.BD$;

   6164  1 002144   200021 474500                    LDP4    FEI$,,AUTO
         1 002145   400010 236100                    LDQ     8,,PR4
         1 002146   100066 756100                    STQ     54,,PR1

      996     6165    2           DCB$->F$DCB.FCD='1'B;

   6165  1 002147   020000 236007                    LDQ     8192,DL
         1 002150   100031 256100                    ORSQ    25,,PR1

      997     6166    2           EL$DIAG.ACCN=B$JIT.ACCN;

   6166  1 002151   040100 100500                    MLR     fill='040'O
         1 002152   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         1 002153   200007 000010                    ADSC9   EL$DIAG,,AUTO            cn=0,n=8

      998     6167    2           EL$DIAG.UNAME=B$JIT.UNAME;

   6167  1 002154   040100 100500                    MLR     fill='040'O
         1 002155   000003 000014                    ADSC9   3,,PR0                   cn=0,n=12
         1 002156   200011 000014                    ADSC9   EL$DIAG+2,,AUTO          cn=0,n=12

      999     6168    2           EL$DIAG.SYSID=B$JIT.SYSID;

   6168  1 002157   000000 722100                    LXL2    0,,PR0
         1 002160   200014 742100                    STX2    EL$DIAG+5,,AUTO

     1000     6169    2           EL$DIAG.DEVNM='FEP NNN';

   6169  1 002161   040100 100400                    MLR     fill='040'O
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:176  
         1 002162   000005 000007 0                  ADSC9   LEN+5                    cn=0,n=7
         1 002163   200015 000010                    ADSC9   EL$DIAG+6,,AUTO          cn=0,n=8

     1001     6170    2           CALL BINCHAR(SUBSTR(EL$DIAG.DEVNM,4,3),KI$FEI.FEP#);

   6170  1 002164   400012 236100                    LDQ     10,,PR4
         1 002165   000011 772000                    QRL     9
         1 002166   000777 376007                    ANQ     511,DL
         1 002167   000000 235003                    LDA     0,DU
         1 002170   200260 757100                    STAQ    @SEV+2,,AUTO
         1 002171   000100 301500                    BTD
         1 002172   200260 000010                    NDSC9   @SEV+2,,AUTO             cn=0,s=lsgnf,sf=0,n=8
         1 002173   200016 030003                    NDSC9   EL$DIAG+7,,AUTO          cn=0,s=nosgn,sf=0,n=3

     1002     6171    2           EL$DIAG.TEST=TDOPNV.TEST;

   6171  1 002174   300002 236100                    LDQ     2,,PR3
         1 002175   000036 772000                    QRL     30
         1 002176   200017 756100                    STQ     EL$DIAG+8,,AUTO

     1003     6172    2           DCB$->F$DCB.NAME.L=6;

   6172  1 002177   006000 236003                    LDQ     3072,DU
         1 002200   100010 552140                    STBQ    8,'40'O,PR1

     1004     6173    2           DCB$->F$DCB.NAME.C=EL$DIAG.DEVNM;

   6173  1 002201   040100 100500                    MLR     fill='040'O
         1 002202   200015 000010                    ADSC9   EL$DIAG+6,,AUTO          cn=0,n=8
         1 002203   100010 200037                    ADSC9   8,,PR1                   cn=1,n=31

     1005     6174    2           CALL ELA$SYSLOG(EL_DIAG,EL$DIAG,SIZEW(EL$DIAG),'0'B,1,TEMP);

   6174  1 002204   200042 635500                    EPPR5   TEMP,,AUTO
         1 002205   200265 455500                    STP5    @SEV+7,,AUTO
         1 002206   000045 236000 2                  LDQ     37
         1 002207   200264 756100                    STQ     @SEV+6,,AUTO
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:177  
         1 002210   000056 237000 2                  LDAQ    46
         1 002211   200262 757100                    STAQ    @SEV+4,,AUTO
         1 002212   200007 636500                    EPPR6   EL$DIAG,,AUTO
         1 002213   200261 456500                    STP6    @SEV+3,,AUTO
         1 002214   000060 236000 2                  LDQ     48
         1 002215   200260 756100                    STQ     @SEV+2,,AUTO
         1 002216   200260 630500                    EPPR0   @SEV+2,,AUTO
         1 002217   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 002220   000000 701000 xent               TSX1    ELA$SYSLOG
         1 002221   000000 011000                    NOP     0

     1006     6175    2           RETURN;

   6175  1 002222   200252 221300                    LDX1  ! X+2,,AUTO
         1 002223   000001 702211                    TSX2  ! 1,X1

     1007     6176    2   UNLOCK:
     1008     6177                %UNLOCK (G#=TD_OPENGATE);

   6178  1 002224   000043 630400 2     UNLOCK       EPPR0   35
         1 002225   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002226   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002227   000000 011000                    NOP     0

     1009     6180    2   XIT:    RETURN;

   6180  1 002230   200252 221300       XIT          LDX1  ! X+2,,AUTO
         1 002231   000001 702211                    TSX2  ! 1,X1

LEN
 Sect OctLoc
   0     000   010002 014004   004*** ******                                    ........

(unnamed)
 Sect OctLoc
   0     002   106105 120040   240420 000000   103120 066040   106105 120040    FEP ....CP6 FEP
   0     006   116116 116040                                                    NNN
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:178  

(unnamed)
 Sect OctLoc
   2     000   000000 000144   000006 006000   000000 006000   777777 377777    ...d............
   2     004   000000 001644   000004 006000   000000 001610   000006 006000    ................
   2     010   000000 001617   000010 006000   777377 777777   000000 001607    ................
   2     014   000013 006000   200000 000000   000000 000036   000000 000031    ................
   2     020   000007 006000   000000 006000   000015 006000   000016 006000    ................
   2     024   000000 000024   000024 006000   000017 006000   000000 001612    ................
   2     030   000027 006000   000000 001613   000031 006000   000000 001650    ................
   2     034   000033 006000   000000 001662   000035 006000   000000 001661    ................
   2     040   000037 006000   000000 001611   000041 006000   000000 006000    .........!......
   2     044   607777 777777   000003 006000   777777 776777   000012 006000    ................
   2     050   100000 000000   000000 000231   000050 006000   000051 006000    @........(...)..
   2     054   000004 006000   000000 000156   000013 006000   000002 006000    .......n........
   2     060   000055 006000   000000 001451   000061 006000   000007 777777    .-.......1......
   2     064   000000 006000   000000 001645   000065 006000   000000 001646    .........5......
   2     070   000067 006000   703777 777777                                    .7......
     1010     6181    2   END OPEN_FEP;
     1011     6182    1   END TDP$OPEN;
     1012     6183        %EOD;

PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:179  
--  Include file information  --

   UQ_ERRORS_C.:E05TOU  is referenced.
   TD_ERRORS_C.:E05TOU  is referenced.
   TD$CP6V_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
   FM$GRAN.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   EL$TABLES.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure TDP$OPEN.
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:180  

 **** Variables and constants ****

  ****  Section 000 RoData TDP$OPEN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b UBIN(9)     r     1 LEN(0:4)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   255-0-0/w PTR         r     1 @ERRCODE                 256-0-0/w PTR         r     1 @SEV
     4-0-0/w PTR         r     1 DCB$                       5-0-0/w PTR         r     1 DCT$
     6-0-0/w PTR         r     1 DQH$                       7-0-0/w STRC(324)   r     1 EL$DIAG
    *0-0-0/w UBIN        r     1 ERRCODE                   20-0-0/w PTR         r     1 EXTST$
    22-0-0/w UBIN        r     1 FEI#                      21-0-0/w PTR         r     1 FEI$
    23-0-0/w SBIN        r     1 I                        253-0-0/w SBIN        r     1 I
    24-0-0/w PTR         r     1 MPC$                      25-0-0/w BIT         r     1 MPCFLG
    26-0-0/w STRC(270)   r     1 MSG                       36-0-0/w PTR         r     1 P$
    37-0-0/w BIT         r     1 PATH                      40-0-0/w PTR         r     1 Q$
    *0-0-0/w UBIN        r     1 SEV                       41-0-0/w PTR         r     1 SQH$
    42-0-0/w UBIN        r     1 TEMP                      44-0-0/w PTR         r     1 VID$
    45-0-0/c CHAR(256)   r     1 VIDBUF1                  145-0-0/c CHAR(256)   r     1 VIDBUF2
   246-0-0/w SBIN        r     1 WSZ                      250-0-0/w SBIN        r     1 X

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$PS0$
     0-0-0/w PTR         r     1 B$PS1$                     0-0-0/w PTR         r     1 B$PS2$
     0-0-0/w PTR         r     1 B$PS3$                     0-0-0/w PTR         r     1 KI_FEI$$
     0-0-0/w UBIN        r     1 KI_MXFE                    0-0-0/w UBIN        r     1 KI_NODES
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:181  
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 N$FQ$
     0-0-0/w PTR         r     1 NI$CHT$                    0-0-0/w PTR         r     1 NI$FQ$
     0-0-0/w PTR         r     1 NI$IBUF$                   0-0-0/w PTR         r     1 NI$RP$
     0-0-0/w PTR         r     1 S$CU$                      0-0-0/b BIT (72)    r     1 TD_OPENGATE

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d STRC(576)   r     1 B$U
     0-0-0/w UBIN        r     1 CHAINIMG(0:59)
     0-0-0/w STRC(1332)  r     1 DCT                        0-0-0/w STRC(2844)  r     1 DVT
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/w STRC(36864) r     1 FM$VID
     0-0-0/d STRC(144)   r     1 FPT$TDOPEN_V               0-0-0/w STRC(324)   r     1 FR$RAT
     0-0-0/w STRC(612)   r     1 KI$FEI
     0-0-0/w PTR         r     1 KI$FEI$(0:0)
     0-0-0/w PTR         r     1 N$DCT$(0:0)                0-0-0/d STRC(1080)  r     1 N$REQ
     0-0-0/w STRC(72)    r     1 NI$CHT(0:0)                0-0-0/w STRC(648)   r     1 NI$DQH
     0-0-0/w STRC(288)   r     1 NI$EXTST                   0-0-0/w STRC(252)   r     1 NI$SQH
     0-0-0/c ACHR        r     1 VFCIMG


   Procedure TDP$OPEN requires 1178 words for executable code.
   Procedure TDP$OPEN requires 182 words of local(AUTO) storage.
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:182  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:183  
          MINI XREF LISTING

B$DO.ECCINFO
       864**DCL       865--REDEF
B$JIT.ACCN
       338**DCL      5851>>ASSIGN   6042>>ASSIGN   6166>>ASSIGN
B$JIT.CPFLAGS1.SLEAZE
       432**DCL       432--REDEF
B$JIT.DCB$
       506**DCL      5793>>ASSIGN
B$JIT.ERR
       338**DCL      6072<<ASSIGN
B$JIT.ERR.CODE
       339**DCL      6073<<ASSIGN
B$JIT.ERR.MID
       339**DCL       339--REDEF
B$JIT.ERR.SEV
       339**DCL      6074<<ASSIGN
B$JIT.JRESPEAK
       500**DCL       501--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
       609**DCL       609--REDEF     610--REDEF
B$JIT.PNR
       513**DCL       513--REDEF
B$JIT.SYSID
       338**DCL      5852>>ASSIGN   6044>>ASSIGN   6168>>ASSIGN
B$JIT.TSLINE
       607**DCL       608--REDEF
B$JIT.UNAME
       338**DCL      5853>>ASSIGN   6043>>ASSIGN   6167>>ASSIGN
B$JIT.USER
       338**DCL      5845>>IF       5966>>ASSIGN   6004>>ASSIGN   6152>>ASSIGN
B$JIT$
      5410**DCL       333--IMP-PTR  5793>>ASSIGN   5845>>IF       5851>>ASSIGN   5852>>ASSIGN   5853>>ASSIGN
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:184  
      5966>>ASSIGN   6004>>ASSIGN   6042>>ASSIGN   6043>>ASSIGN   6044>>ASSIGN   6072>>ASSIGN   6073>>ASSIGN
      6074>>ASSIGN   6152>>ASSIGN   6166>>ASSIGN   6167>>ASSIGN   6168>>ASSIGN
B$MAP.SCTRL
       657**DCL       658--REDEF
B$PS0$
      5411**DCL      5800>>IF       5806>>IF       5813>>IF       5820>>IF       5820>>IF       5826>>IF
      5826>>IF       5826>>IF       5833>>CALL     5850>>IF       5850>>IF       5854>>ASSIGN   5856>>IF
      5856>>IF       5867>>DOCASE   5871>>IF       5929>>DOINDEX  5945>>IF       5945>>IF       5956>>ASSIGN
      5964>>ASSIGN   5965>>ASSIGN   5967>>DOCASE   6019>>ASSIGN   6036>>ASSIGN   6046>>ASSIGN   6061>>IF
      6136>>ASSIGN   6153>>ASSIGN   6155>>ASSIGN   6171>>ASSIGN
B$PS1$
      5412**DCL      6025>>ASSIGN
B$PS2$
      5413**DCL      6029>>ASSIGN
B$PS3$
      5414**DCL      6122<>CALL     6123<>CALL     6141<>CALL
B$U.FLG.TDNOPERM
       743**DCL      5855<<ASSIGN   5860>>IF
B$U.FLG.TDOPPERM
       741**DCL      5819<<ASSIGN   5846<<ASSIGN   5848<<ASSIGN   5859>>DOWHILE
B$U.MISC
       843**DCL       844--REDEF
B$USER.MISC
       919**DCL       920--REDEF
BADRET
      6068**PROC     5794--CALL     5810--CALL     5814--CALL     5840--CALL     5862--CALL     5871--CALL
      5873--CALL     5901--CALL     5904--CALL     5905--CALL     5906--CALL     5912--CALL     5914--CALL
      5920--CALL     5921--CALL     5927--CALL     5935--CALL     5938--CALL     5943--CALL     5951--CALL
      5957--CALL     6050--CALL     6052--CALL     6118--CALL     6125--CALL     6135--CALL
BADWINDOW IN PROCEDURE OPEN_FEP
      6125**LABEL    6122--CALLALT  6150--GOTO
BRKYC
      6050**LABEL    5864--CALLALT
CHAINIMG
      5461**DCL      6025<<ASSIGN   6025>>ASSIGN
CHECK_SDSK
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:185  
      6078**PROC     5869--CALL     5910--CALL     5915--CALL
DCB$
      5426**DCL      5793<<ASSIGN   5794>>IF       5798<>CALL     5799>>ASSIGN   5816>>ASSIGN   5817>>CALLBLT
      5818>>ASSIGN   5843>>ASSIGN   5844>>ASSIGN   6018>>ASSIGN   6019>>ASSIGN   6020>>ASSIGN   6021>>ASSIGN
      6023>>ASSIGN   6032>>ASSIGN   6033>>ASSIGN   6034>>ASSIGN   6035>>ASSIGN   6036>>ASSIGN   6037>>ASSIGN
      6038>>ASSIGN   6039>>ASSIGN   6040>>ASSIGN   6041>>ASSIGN   6085>>ASSIGN   6113>>ASSIGN   6154>>ASSIGN
      6155>>ASSIGN   6156>>ASSIGN   6157>>ASSIGN   6158>>ASSIGN   6159>>ASSIGN   6160>>ASSIGN   6161>>ASSIGN
      6162>>ASSIGN   6163>>ASSIGN   6164>>ASSIGN   6165>>ASSIGN   6172>>ASSIGN   6173>>ASSIGN
DCT
      5471**DCL      5976<>CALL     5978<>CALL     6000<>CALL     6002<>CALL
DCT.DCTX
      5472**DCL      5874>>ASSIGN   6012>>ASSIGN   6082>>ASSIGN
DCT.DEVNM
      5471**DCL      5842>>ASSIGN   5843>>ASSIGN   6045>>ASSIGN
DCT.DFLG.MPCBUSY
      5476**DCL      5872>>IF       5905>>IF
DCT.DFLG.MPCSTOP
      5476**DCL      5878>>IF       5889>>IF       5982>>DOWHILE  5988<<ASSIGN
DCT.DFLG.MPCSUSPENDED
      5476**DCL      5878>>IF       5889>>IF
DCT.DP
      5491**DCL      5498--REDEF    5501--REDEF    5502--REDEF    5504--REDEF    5504--REDEF    5505--REDEF
      5506--REDEF    5506--REDEF
DCT.DVT$
      5487**DCL      6099>>IF
DCT.LP.CHAIN$
      5501**DCL      6025>>ASSIGN
DCT.LP.VFC$
      5501**DCL      6029>>ASSIGN
DCT.LP.VFCL
      5501**DCL      6027>>IF       6028>>ASSIGN
DCT.MCA.RESERVED
      5506**DCL      5925>>IF       6005<<ASSIGN
DCT.MCA.USER#
      5506**DCL      6004<<ASSIGN
DCT.MPC.ALTMPCX
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:186  
      5500**DCL      5977>>IF       5978>>CALL     6001>>IF       6002>>CALL
DCT.MPC.IOCHANX
      5499**DCL      5499--REDEF
DCT.MPC.TYPE
      5499**DCL      5875>>IF
DCT.RAT$
      5472**DCL      5945>>IF       5945>>IF
DCT.SPEVENT
      5487**DCL      5965<<ASSIGN
DCT.STATUS.DOWN
      5488**DCL      5878>>IF       5889>>IF       5913>>IF       5942>>IF       5945>>IF
DCT.STATUS.MSOS_PART
      5490**DCL      5878>>IF       5889>>IF
DCT.STATUS.SYSCON_PART
      5489**DCL      5878>>IF       5889>>IF
DCT.STATUS.TDOK
      5489**DCL      5848>>ASSIGN   5942>>IF
DCT.STATUS.TND
      5489**DCL      5872>>IF       5904>>IF       5956>>IF       5956<<ASSIGN   5964<<ASSIGN   5969<<ASSIGN
DCT.TDUSER#
      5490**DCL      5845>>IF       5966<<ASSIGN
DCT.TYPE
      5481**DCL      5869>>IF       5910>>IF       5912>>IF       5920>>IF       5940>>DOCASE   6020>>ASSIGN
      6021>>IF
DCT$
      5427**DCL      5471--IMP-PTR  5801<<ASSIGN   5833<>CALL     5834>>IF       5842>>ASSIGN   5843>>ASSIGN
      5845>>IF       5848>>ASSIGN   5869>>IF       5874>>ASSIGN   5875>>IF       5878>>IF       5878>>IF
      5878>>IF       5878>>IF       5878>>IF       5886>>IF       5910>>IF       5912>>IF       5913>>IF
      5920>>IF       5925>>IF       5940>>DOCASE   5942>>IF       5942>>IF       5945>>IF       5945>>IF
      5945>>IF       5956>>IF       5956>>ASSIGN   5964>>ASSIGN   5965>>ASSIGN   5966>>ASSIGN   6004>>ASSIGN
      6005>>ASSIGN   6012>>ASSIGN   6020>>ASSIGN   6021>>IF       6025>>ASSIGN   6027>>IF       6028>>ASSIGN
      6029>>ASSIGN   6033>>ASSIGN   6045>>ASSIGN   6082>>ASSIGN   6099>>IF
DQH$
      5428**DCL      5721--IMP-PTR  5812<<ASSIGN   5813>>IF       5819>>ASSIGN   5833<>CALL     5835>>ASSIGN
      5906>>IF       5921>>IF       5930>>ASSIGN   5989>>IF       5990>>ASSIGN   5992>>CALL     6032>>ASSIGN
      6118>>IF       6134>>IF       6134>>IF       6136>>ASSIGN   6140>>ASSIGN   6146>>ASSIGN   6152>>ASSIGN
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:187  
      6153>>ASSIGN   6158>>ASSIGN
DVT.MPC
      5513**DCL      5514--REDEF
DVT.PACKSIZE
      5512**DCL      6099>>IF
EL$DIAG
      5430**DCL      6047<>CALL     6047--CALL     6174<>CALL     6174--CALL
EL$DIAG.ACCN
      5430**DCL      6042<<ASSIGN   6166<<ASSIGN
EL$DIAG.DEVNM
      5430**DCL      6045<<ASSIGN   6169<<ASSIGN   6170<<CALLBLT  6173>>ASSIGN
EL$DIAG.SYSID
      5430**DCL      6044<<ASSIGN   6168<<ASSIGN
EL$DIAG.TEST
      5430**DCL      6046<<ASSIGN   6171<<ASSIGN
EL$DIAG.UNAME
      5430**DCL      6043<<ASSIGN   6167<<ASSIGN
ELA$SYSLOG
      5392**DCL-ENT  6047--CALL     6174--CALL
ERRCODE IN PROCEDURE BADRET
      6069**DCL      6068--PROC     6073>>ASSIGN
EXTST$
      5432**DCL      6013<>CALL     6035>>ASSIGN
F$DCB.ACTPOS
      2031**DCL      2031--REDEF
F$DCB.ARS
      2006**DCL      2006--REDEF
F$DCB.ASN
      2021**DCL      6039<<ASSIGN   6162<<ASSIGN
F$DCB.ATTR
      2024**DCL      2025--REDEF
F$DCB.BORROW
      2039**DCL      2039--REDEF    2039--REDEF    2039--REDEF
F$DCB.CFU$
      2040**DCL      6164<<ASSIGN
F$DCB.CHANTIME
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:188  
      2026**DCL      6038<<ASSIGN   6161<<ASSIGN
F$DCB.CONNCT
      2025**DCL      6037<<ASSIGN   6160<<ASSIGN
F$DCB.DCBNAME.L
      2053**DCL      2053--IMP-SIZ
F$DCB.DCT$
      2028**DCL      6033<<ASSIGN
F$DCB.DEVADR
      2028**DCL      6036<<ASSIGN
F$DCB.DEVADR.DVN
      2028**DCL      6159<<ASSIGN
F$DCB.DQH$
      2027**DCL      6032<<ASSIGN   6158<<ASSIGN
F$DCB.DVTYPE
      2020**DCL      6020<<ASSIGN
F$DCB.EOMCHAR
      2010**DCL      2010--REDEF
F$DCB.FCD
      2019**DCL      5794>>IF       6041<<ASSIGN   6165<<ASSIGN
F$DCB.FCN
      2043**DCL      6040<<ASSIGN   6163<<ASSIGN
F$DCB.FLDID
      2034**DCL      2034--REDEF
F$DCB.FORM$
      2028**DCL      2028--REDEF
F$DCB.FSECT
      2044**DCL      2044--REDEF
F$DCB.FSN
      2021**DCL      2021--REDEF    2021--REDEF    2022--REDEF
F$DCB.FUN
      2020**DCL      6019<<ASSIGN   6155<<ASSIGN
F$DCB.HEADER$
      2027**DCL      2027--REDEF
F$DCB.IXTNSIZE
      2025**DCL      2025--REDEF    6157<<ASSIGN
F$DCB.LASTSTA$
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:189  
      2015**DCL      2015--REDEF
F$DCB.LVL
      2040**DCL      2040--REDEF
F$DCB.MPC$
      2028**DCL      6034<<ASSIGN
F$DCB.NAME.C
      2015**DCL      2015--REDEF    5816<<ASSIGN   5817<<CALLBLT  5843<<ASSIGN   6173<<ASSIGN
F$DCB.NAME.L
      2015**DCL      5818<<ASSIGN   5844<<ASSIGN   6172<<ASSIGN
F$DCB.NOEOF
      2036**DCL      2036--REDEF
F$DCB.NRECS
      2026**DCL      2026--REDEF
F$DCB.NRECX
      2045**DCL      2045--REDEF
F$DCB.OHDR
      2037**DCL      2037--REDEF
F$DCB.ORG
      2020**DCL      2020--REDEF
F$DCB.PRECNO
      2043**DCL      2043--REDEF
F$DCB.RCSZ
      2048**DCL      2048--REDEF
F$DCB.RES
      2016**DCL      2016--REDEF
F$DCB.SETX
      2028**DCL      2028--REDEF
F$DCB.TAB$
      2027**DCL      2028--REDEF
F$DCB.TDA
      2042**DCL      2042--REDEF
F$DCB.TDEXTST$
      2015**DCL      6035<<ASSIGN
F$DCB.TDFLG.SDSK
      2025**DCL      5799<<ASSIGN   6113<<ASSIGN
F$DCB.TYC
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:190  
      2006**DCL      6018<<ASSIGN   6154<<ASSIGN
F$DCB.WIDTH
      2013**DCL      6021<<ASSIGN   6023<<ASSIGN
F$DCB.WSN
      2017**DCL      2017--REDEF
F$DCB.XTNSIZE
      2023**DCL      6156<<ASSIGN
FEI#
      5434**DCL      5804<<DOINDEX  5805>>ASSIGN   6118>>IF       6159>>ASSIGN
FEI$
      5433**DCL      5580--IMP-PTR  5805<<ASSIGN   5806>>IF       5812>>ASSIGN   5815>>ASSIGN   5835<<ASSIGN
      5836>>IF       5836>>IF       5836>>IF       6140<<ASSIGN   6141>>CALL     6141>>CALL     6164>>ASSIGN
      6170>>CALLBLT
FM$VID.DTT
      5520**DCL      5520--REDEF
FM$VID.ID
      5518**DCL      6096>>IF
FM$VID.SECTSTRT
      5519**DCL      6099>>IF       6099>>IF       6103>>ASSIGN
FM$VID.VOLCNT
      5518**DCL      6097>>IF       6105>>IF
FMM$SCRUB
      5393**DCL-ENT  5798--CALL
FOUND_FEP
      5805**LABEL    5808--GOTO
FPT$TDOPEN_V.DEVICE
      5524**DCL      5833<>CALL     6036>>ASSIGN
FPT$TDOPEN_V.DEVICE.DVN
      5524**DCL      5806>>IF       5813>>IF       5871>>IF
FPT$TDOPEN_V.NCHANS
      5525**DCL      5929>>DOINDEX
FPT$TDOPEN_V.SPEVENT
      5524**DCL      5965>>ASSIGN   6153>>ASSIGN
FPT$TDOPEN_V.TEST
      5524**DCL      5800>>IF       5820>>IF       5820>>IF       5826>>IF       5826>>IF       5826>>IF
      5850>>IF       5850>>IF       5854>>ASSIGN   5856>>IF       5856>>IF       5867>>DOCASE   5945>>IF
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:191  
      5945>>IF       5956>>ASSIGN   5964>>ASSIGN   5967>>DOCASE   6019>>ASSIGN   6046>>ASSIGN   6061>>IF
      6136>>ASSIGN   6155>>ASSIGN   6171>>ASSIGN
FR$RAT.RES.SISID
      5532**DCL      5945>>IF       5945>>IF
FSA$GSP
      5394**DCL-ENT  6013--CALL
GOT_FEP
      5815**LABEL    5838--GOTO
HFC$LOCK
      2429**DCL-ENT  5923--CALL     5954--CALL     5986--CALL     6132--CALL     6144--CALL
HFC$UNLOCK
      2429**DCL-ENT  5959--CALL     5996--CALL     6007--CALL     6058--CALL     6064--CALL     6138--CALL
      6148--CALL     6178--CALL
HFF$DSIZ
      5395**DCL-ENT  6024--CALL     6026--CALL     6123--CALL
HFF$NILERASE
      5396**DCL-ENT  6122--CALL
I
      5435**DCL      5885<<DOINDEX  5886>>IF       5886>>IF       5889>>IF       5889>>IF       5889>>IF
      5889>>IF       5889>>IF       5929<<DOINDEX  5930>>ASSIGN   5974<<DOINDEX  5975>>IF       5976>>CALL
      5977>>IF       5978>>CALL
I IN PROCEDURE CHECK_SDSK
      6079**DCL      6098<<DOINDEX  6099>>IF       6099>>IF       6103>>ASSIGN
KI$FEI.BD$
      5615**DCL      5616--REDEF    6141<>CALL     6164>>ASSIGN
KI$FEI.BDAD.WADDR
      5617**DCL      5618--REDEF
KI$FEI.FECH
      5582**DCL      5812>>ASSIGN
KI$FEI.FEP#
      5625**DCL      5806>>IF       5815>>ASSIGN   6170>>CALLBLT
KI$FEI.FEST
      5585**DCL      5836>>IF       5836>>IF
KI$FEI.FEWSQ
      5608**DCL      6141<>CALL
KI$FEI.PBST.PROB
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:192  
      5633**DCL      5836>>IF
KI$FEI.RCVPB
      5631**DCL      5632--REDEF
KI$FEI$
      2532**DCL      5805>>ASSIGN   5835>>ASSIGN   6140>>ASSIGN
KI_FEI$$
      2531**DCL      2532--IMP-PTR  5805>>ASSIGN   5835>>ASSIGN   6140>>ASSIGN
KI_MXFE
      2540**DCL      5804>>DOINDEX
KI_NODES
      2539**DCL      5813>>IF
LEN
      5787**DCL      5863<>CALL     6014<>CALL
MCA_UNLK
      6061**LABEL    5927--CALLALT
MMS$VGET
      5401**DCL-ENT  6141--CALL
MPC$
      5436**DCL      5803<<ASSIGN   5833<>CALL     5872>>IF       5872>>IF       5904>>IF       5905>>IF
      5969>>ASSIGN   5975>>IF       5982>>DOWHILE  5988>>ASSIGN   6000>>CALL     6001>>IF       6002>>CALL
      6034>>ASSIGN
MPCFLG
      5437**DCL      5830<<ASSIGN   5832<<ASSIGN   5833<>CALL
MSG
      5438**DCL      5863<>CALL     6014<>CALL
MSG.ACCT
      5439**DCL      5851<<ASSIGN
MSG.DEVNM
      5442**DCL      5443--REDEF    5842<<ASSIGN
MSG.FEPNO
      5443**DCL      5815<<ASSIGN   5817>>CALLBLT
MSG.NAME
      5441**DCL      5853<<ASSIGN
MSG.SYSID
      5440**DCL      5852<<ASSIGN
MSG.TEST
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:193  
      5444**DCL      5854<<ASSIGN
N$DCT$
      3975**DCL      5978>>CALL     6002>>CALL
N$DCT$$
      3841**DCL      3975--IMP-PTR  5978>>CALL     6002>>CALL
N$FQ$
      3841**DCL      3976--IMP-PTR
N$REQ
      5660**DCL      6087<>CALL     6094<>CALL     6104<>CALL
N$REQ.BPMIR
      5705**DCL      6084<<ASSIGN
N$REQ.BUF$
      5669**DCL      6091<<ASSIGN   6100<<ASSIGN
N$REQ.BUFADDR
      5669**DCL      5670--REDEF    5670--REDEF
N$REQ.BUFSIZE
      5663**DCL      6092<<ASSIGN   6101<<ASSIGN
N$REQ.DCB$
      5691**DCL      6085<<ASSIGN
N$REQ.DLA.DCTX
      5660**DCL      6082<<ASSIGN
N$REQ.DLA.DRELADDR
      5661**DCL      5661--REDEF    6093<<ASSIGN   6103<<ASSIGN
N$REQ.DVE.EOMCHAR
      5698**DCL      5699--REDEF
N$REQ.EAINFO
      5692**DCL      5692--REDEF
N$REQ.EAINFOX
      5692**DCL      5693--REDEF
N$REQ.EVNTINFO
      5693**DCL      5693--REDEF
N$REQ.FC
      5663**DCL      6083<<ASSIGN   6089<<ASSIGN
N$REQ.OPFLG
      5666**DCL      6086<<ASSIGN   6090<<ASSIGN   6102<<ASSIGN
N$REQ.STATUS
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:194  
      5674**DCL      5680--REDEF
N$REQ.STATUS.MAJOR
      5674**DCL      6088>>IF
N$REQ_INIT.BUFADDR
      3860**DCL      3861--REDEF    3861--REDEF
N$REQ_INIT.DLA.DRELADDR
      3852**DCL      3852--REDEF
N$REQ_INIT.DVE.EOMCHAR
      3889**DCL      3890--REDEF
N$REQ_INIT.EAINFO
      3883**DCL      3883--REDEF
N$REQ_INIT.EAINFOX
      3883**DCL      3884--REDEF
N$REQ_INIT.EVNTINFO
      3884**DCL      3884--REDEF
N$REQ_INIT.STATUS
      3865**DCL      3871--REDEF
NI$CHT.DQH$
      5710**DCL      5812>>ASSIGN   5930>>ASSIGN
NI$CHT$
      3900**DCL      5710--IMP-PTR  5812>>ASSIGN   5930>>ASSIGN
NI$DQH
      5721**DCL      5992<>CALL
NI$DQH.CHANSTATE.STOP
      5729**DCL      5990<<ASSIGN
NI$DQH.EVENTINFO
      5729**DCL      6153<<ASSIGN
NI$DQH.FEX
      5724**DCL      5835>>ASSIGN   6118>>IF       6140>>ASSIGN
NI$DQH.IOCHANX
      5723**DCL      5724--REDEF    5930>>ASSIGN
NI$DQH.MBX$
      5732**DCL      5733--REDEF
NI$DQH.STATUS.DOWN
      5721**DCL      5906>>IF       5921>>IF       5933>>IF       5989>>IF       6134>>IF
NI$DQH.STATUS.TDOK
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:195  
      5722**DCL      5819>>ASSIGN
NI$DQH.STATUS.TND
      5722**DCL      6134>>IF       6136<<ASSIGN   6146<<ASSIGN
NI$DQH.USER#
      5731**DCL      6152<<ASSIGN
NI$EXTST
      5740**DCL      6013--CALL
NI$EXTST.EXTST
      5744**DCL      5746--REDEF    5748--REDEF
NI$FQ$
      3901**DCL      3977--IMP-PTR
NI$IBUF$
      3901**DCL      3977--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
      3911**DCL      3912--REDEF    3912--REDEF
NI$IMXMBX_INIT.SIZE
      3913**DCL      3913--REDEF
NI$REQ_INIT.DCW
      3935**DCL      3938--REDEF
NI$REQ_INIT.DCW.TALLY
      3936**DCL      3936--REDEF
NI$REQ_INIT.IDCW.EXTA
      3938**DCL      3938--REDEF
NI$REQ_INIT.PCW
      3940**DCL      3944--REDEF
NI$REQ_INIT.SEEK
      3945**DCL      3946--REDEF    3947--REDEF
NI$RP$
      3949**DCL      3979--IMP-PTR
NI$SQH.CQ$
      5779**DCL      5992<>CALL
NI$SQH.DOOR
      5778**DCL      5778--REDEF
NI$SQH.GATE
      5778**DCL      5923<>CALL     5986<>CALL     5996<>CALL     6007<>CALL     6064<>CALL
NI$SQH.MPC$
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:196  
      5780**DCL      5886>>IF       5886>>IF       5889>>IF       5889>>IF       5889>>IF       5889>>IF
      5889>>IF       5975>>IF       5976>>CALL     5977>>IF       5978>>CALL
NIM$ENQUEUE
      4005**DCL-ENT  5992--CALL
NIO$QUE
      5399**DCL-ENT  6087--CALL     6094--CALL     6104--CALL
NIQ$GET
      5397**DCL-ENT  6081--CALL
NIQ$REL
      5398**DCL-ENT  6109--CALL     6112--CALL
NIW$MPCSTOP
      5400**DCL-ENT  5976--CALL     5978--CALL     6000--CALL     6002--CALL
NI_MBX_INIT.DCW.CONTROL.AE
      3971**DCL      3971--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
      3967**DCL      3967--REDEF
OCI$MK_WR
      5402**DCL-ENT  5863--CALL     6014--CALL
OPEN_FEP
      6117**PROC     5917--CALL
P$
      5445**DCL      5930<<ASSIGN   5931>>IF       5933>>IF
PATH
      5867**LABEL    5877<<ASSIGN   5884<<ASSIGN   5897<<ASSIGN   5899>>IF
Q$
      5447**DCL      5660--IMP-PTR  6081<>CALL     6082>>ASSIGN   6083>>ASSIGN   6084>>ASSIGN   6085>>ASSIGN
      6086>>ASSIGN   6087>>CALL     6088>>IF       6089>>ASSIGN   6090>>ASSIGN   6091>>ASSIGN   6092>>ASSIGN
      6093>>ASSIGN   6094>>CALL     6100>>ASSIGN   6101>>ASSIGN   6102>>ASSIGN   6103>>ASSIGN   6104>>CALL
      6109<>CALL     6112<>CALL
S$CU$
      5417**DCL      5819>>ASSIGN   5846>>ASSIGN   5848>>ASSIGN   5855>>ASSIGN   5859>>DOWHILE  5860>>IF
SET_SDSK IN PROCEDURE CHECK_SDSK
      6112**LABEL    6088--GOTO     6097--GOTO     6105--GOTO
SEV IN PROCEDURE BADRET
      6070**DCL      6068--PROC     6074>>ASSIGN
SQH$
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:197  
      5448**DCL      5778--IMP-PTR  5802<<ASSIGN   5833<>CALL     5886>>IF       5886>>IF       5889>>IF
      5889>>IF       5889>>IF       5889>>IF       5889>>IF       5923>>CALL     5975>>IF       5976>>CALL
      5977>>IF       5978>>CALL     5986>>CALL     5992>>CALL     5996>>CALL     6007>>CALL     6064>>CALL
SSR$REG
      5403**DCL-ENT  5864--CALL     5983--CALL
TDNODEV
      6052**LABEL    5833--CALLALT  5915--CALLALT
TDU$FINDPATH
      5404**DCL-ENT  5833--CALL
TD_OPENGATE
      5421**DCL      5954<>CALL     5959<>CALL     6058<>CALL     6132<>CALL     6138<>CALL     6144<>CALL
      6148<>CALL     6178<>CALL
TEMP
      5449**DCL      5783--IMP-SIZ  6012<<ASSIGN   6014<>CALL     6024<>CALL     6025>>IF       6026<>CALL
      6027>>IF       6028<<ASSIGN   6029>>ASSIGN   6029>>ASSIGN   6047<>CALL     6174<>CALL
UNLOCK
      6058**LABEL    5957--CALLALT
UNLOCK IN PROCEDURE OPEN_FEP
      6178**LABEL    6135--CALLALT
VFCIMG
      5783**DCL      6029<<ASSIGN   6029>>ASSIGN
VID$
      5451**DCL      5518--IMP-PTR  6095<<ASSIGN   6096>>IF       6097>>IF       6099>>IF       6099>>IF
      6103>>ASSIGN
VIDBUF1
      5452**DCL      6091--ASSIGN   6092--ASSIGN   6095--ASSIGN
VIDBUF2
      5453**DCL      6100--ASSIGN   6101--ASSIGN   6105--IF
WSZ
      5455**DCL      6123<>CALL     6124>>IF       6141<>CALL     6156>>ASSIGN
X
      5457**DCL      5874<<ASSIGN   6157>>ASSIGN
XIT
      6067**LABEL    5794--CALLALT  5810--CALLALT  5814--CALLALT  5840--CALLALT  5862--CALLALT  5871--CALLALT
      5873--CALLALT  5901--CALLALT  5904--CALLALT  5905--CALLALT  5906--CALLALT  5912--CALLALT  5914--CALLALT
      5920--CALLALT  5921--CALLALT  5935--CALLALT  5938--CALLALT  5943--CALLALT  5951--CALLALT  6013--CALLALT
PL6.E3A0      #003=TDP$OPEN File=TDP$PMME.:E05TSI                                WED 07/30/97 06:04 Page:198  
      6050--CALLALT  6052--CALLALT
XIT IN PROCEDURE OPEN_FEP
      6180**LABEL    6118--CALLALT  6125--CALLALT

PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:199  
     1013        1        /*M* TDP$TDIO - M$TDIO PMME HANDLER */
     1014        2        /*T***********************************************************/
     1015        3        /*T*                                                         */
     1016        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1017        5        /*T*                                                         */
     1018        6        /*T***********************************************************/
     1019        7        TDP$TDIO: PROC;
     1020        8        /*
     1021        9                Includes
     1022       10        */
     1023       11        %INCLUDE                        B$JIT ;
     1024      614        %INCLUDE                        B$USER ;
     1025      830        %INCLUDE                        B_STRINGS_C ;
     1026      959        %INCLUDE                        CP_6_SUBS ;
     1027     1499        %INCLUDE                        F$DCB ;
     1028     1548        %INCLUDE                        HF_DATA_R ;
     1029     1591        %INCLUDE                        HF_LOCK_C ;
     1030     1605        %INCLUDE                        IT_SUBS_C ;
     1031     1872        %INCLUDE                        M_INFO_C ;
     1032     2012        %INCLUDE                        KI_DATA_R ;
     1033     2038        %INCLUDE                        KI_MACROS_C ;
     1034     2646        %INCLUDE                        NI_DATA_R ;
     1035     3083        %INCLUDE                        NI_DATA_C ;
     1036     3196        %INCLUDE                        NI_MACROS_C ;
     1037     3463        %INCLUDE                        SS_SCHED_C ;
     1038     3696        %INCLUDE                        S_WSPTD_R ;
     1039     3712        %INCLUDE                        TD$CP6V_C ;
     1040     3748        %INCLUDE                        TD_ERRORS_C ;
     1041     3831        /*
     1042     3832                Entries
     1043     3833        */
     1044     3834    1   DCL 1 FMB$IOSPIN                ENTRY ;
     1045     3835    1   DCL 1 HFF$DSIZ                  ENTRY(2) ;
     1046     3836    1   DCL 1 HFF$NILERASE              ENTRY(1) ALTRET ;
     1047     3837    1   DCL 1 NIM$CVTPTR                ENTRY(3) ;
     1048     3838    1   DCL 1 NIQ$GET                   ENTRY(1) ALTRET ;
     1049     3839    1   DCL 1 NIQ$GETS                  ENTRY(1) ALTRET ;
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:200  
     1050     3840    1   DCL 1 NIS$DCCON                 ENTRY(3) ;
     1051     3841    1   DCL 1 NIS$DRIVER                ENTRY(1) ;
     1052     3842    1   DCL 1 SSR$REG                   ENTRY(3) ALTRET ;
     1053     3843    1   DCL 1 TDU$FINDPATH              ENTRY(6) ALTRET ;
     1054     3844    1   DCL 1 UDB$PMMEXIT               ENTRY ;
     1055     3845        /*
     1056     3846                Symrefs
     1057     3847        */
     1058     3848    1   DCL 1 B$JIT$                    PTR SYMREF ;
     1059     3849    1   DCL 1 B$PS0$                    PTR SYMREF ;
     1060     3850    1   DCL 1 B$PS1$                    PTR SYMREF ;
     1061     3851    1   DCL 1 B$PS2$                    PTR SYMREF ;
     1062     3852        %B$USERREFS ;
     1063     3856    1   DCL 1 F_DCBLOCK                 BIT(72) SYMREF ALIGNED ;
     1064     3857    1   DCL 1 SL_MF(0:3)                SBIN SYMREF ;
     1065     3858        /*
     1066     3859                Auto
     1067     3860        */
     1068     3861    1   DCL 1 BUFADDR                   UBIN ALIGNED AUTO ;
     1069     3862    1   DCL 1 BUFVIRT                   REDEF BUFADDR,
     1070     3863    1         2 DA                      UBIN(33) UNAL,
     1071     3864    1         2 BYT                     UBIN(3) UNAL ;
     1072     3865    1   DCL 1 BUFPTP                    SBIN ALIGNED AUTO ;
     1073     3866    1   DCL 1 CONT_FLG                  BIT(1) ALIGNED AUTO ;
     1074     3867    1   DCL 1 DCB$                      PTR ALIGNED AUTO ;
     1075     3868    1   DCL 1 DCPCW                     ALIGNED AUTO,
     1076     3869    1         2 *                       BIT(18) UNAL,
     1077     3870    1         2 SVN                     BIT(3)  UNAL,
     1078     3871    1         2 MASK                    BIT(3)  UNAL,
     1079     3872    1         2 *                       BIT(12) UNAL ;
     1080     3873    1   DCL 1 DCT$                      PTR ALIGNED AUTO ;
     1081     3874    1   DCL 1 DCW$                      PTR ALIGNED AUTO ;
     1082     3875    1   DCL 1 DCWADDR                   UBIN ALIGNED AUTO ;
     1083     3876    1   DCL 1 DCWVIRT                   REDEF DCWADDR,
     1084     3877    1         2 DA                      UBIN(33) UNAL,
     1085     3878    1         2 BYT                     UBIN(3) UNAL;
     1086     3879    1   DCL 1 DCWPTP                    SBIN ALIGNED AUTO ;
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:201  
     1087     3880    1   DCL 1 DQH$                      PTR ALIGNED AUTO ;
     1088     3881    1   DCL 1 EXTRN                     EPTR ALIGNED AUTO ;
     1089     3882    1   DCL 1 I                         SBIN ALIGNED AUTO ;
     1090     3883    1   DCL 1 IOS$                      PTR ALIGNED AUTO ;
     1091     3884    1   DCL 1 FEI$                      PTR ALIGNED AUTO ;
     1092     3885    1   DCL 1 MBX$                      PTR ALIGNED AUTO ;
     1093     3886    1   DCL 1 MPC$                      PTR ALIGNED AUTO ;
     1094     3887    1   DCL 1 PATH                      ALIGNED AUTO,
     1095     3888    1         2 DVN                     UBIN(6) UNAL,
     1096     3889    1         2 IOM                     UBIN(3) UNAL,
     1097     3890    1         2 CHAN                    UBIN(9) UNAL ;
     1098     3891    1   DCL 1 PNTR$                     PTR ALIGNED AUTO ;
     1099     3892    1   DCL 1 PNTR                      REDEF PNTR$,
     1100     3893    1         2 WA                      UBIN(18) HALIGNED,
     1101     3894    1         2 *                       UBIN(18) HALIGNED ;
     1102     3895    1   DCL 1 RELEASE                   BIT(1) ALIGNED AUTO ;
     1103     3896    1   DCL 1 REQ$                      PTR ALIGNED AUTO ;
     1104     3897    1   DCL 1 SQH$                      PTR ALIGNED AUTO ;
     1105     3898    1   DCL 1 SUSPEND                   BIT(1) ALIGNED AUTO ;
     1106     3899    1   DCL 1 WRITE_FLG                 BIT(1) ALIGNED AUTO ;
     1107     3900
     1108     3901        /*
     1109     3902                Based
     1110     3903        */
     1111     3904        %DCW                            ( NAME=DCW,           STCLASS="BASED(DCW$)" ) ;
     1112     3934        %FPT$TDIO_V;
     1113     3938        %IDCW                           ( NAME=IDCW,          STCLASS="BASED(DCW$)" ) ;
     1114     3970        %KI$FEI                         (                     STCLASS="BASED(FEI$)" ) ;
     1115     4054        %N$REQ                          ( NAME=N$REQ,         STCLASS="BASED(REQ$)" ) ;
     1116     4112        %NI$CHT                         ( NAME="NI$CHT(0:0)", STCLASS="BASED(NI$CHT$)" ) ;
     1117     4115        %NI$DCT                         ( NAME=NI$DCT,        STCLASS=BASED         ) ;
     1118     4163        %NI$DQH                         ( NAME=NI$DQH,        STCLASS=BASED         ) ;
     1119     4186        %NI$DVT                         ( NAME=NI$DVT,        STCLASS=BASED         ) ;
     1120     4193        %NI$IMXMBX                      ( NAME=NI$IMXMBX,     STCLASS="BASED(MBX$)" ) ;
     1121     4214        %NI$REQ                         ( NAME=NI$REQ,        STCLASS="BASED(IOS$)" ) ;
     1122     4239        %NI$SQH                         ( NAME=NI$SQH,        STCLASS=BASED         ) ;
     1123     4252    1   DCL 1 PCW_B                     BASED,
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:202  
     1124     4253    1         2 *                       BIT(18) UNAL,
     1125     4254    1         2 SVN                     BIT(3) UNAL,
     1126     4255    1         2 MASK                    UBIN(3) UNAL,
     1127     4256    1         2 *                       BIT(12) UNAL ;
     1128     4257        /*
     1129     4258                Constants
     1130     4259        */
     1131     4260        %SUB DCB=DCB$->F$DCB;
     1132     4261        %SUB TDIOV=B$PS0$->FPT$TDIO_V;
     1133     4262
     1134     4263        %EJECT;
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:203  
     1135     4264    1           DCB$=B$JIT.DCB$;
     1136     4265    1           IF ~DCB$->F$DCB.FCD THEN CALL BADRET(%E$TDNOTOPEN,4);
     1137     4266    1           IF DCB$->F$DCB.ASN~=%T@D# THEN CALL BADRET(%E$TDNOTDCB,4);
     1138     4267    2           IF DCB$->F$DCB.FUN=%TD_TEST_FEP THEN DO;
     1139     4268    2              DCPCW=TDIOV.PCW;
     1140     4269    2              FEI$ = KI$FEI$(DCB$->F$DCB.DEVADR.DVN);
     1141     4270    2              CALL NIS$DCCON(DCB$->F$DCB.DQH$->NI$DQH.IOCHAN,DCPCW.MASK,KI$FEI.FEWSQ);
     1142     4271    2              DCB$->F$DCB.CONNCT=DCB$->F$DCB.CONNCT+1;
     1143     4272    2              RETURN;
     1144     4273    2              END;
     1145     4274    2           IF TDIOV.ALTPATH THEN DO;
     1146     4275    2              IF DCB$->F$DCB.FUN~=%TD_TEST_POLTS THEN
     1147     4276    2                 CALL BADRET(%E$TDALTBAD,4);
     1148     4277    2              PATH.IOM=TDIOV.ALTPATH.IOM;
     1149     4278    2              PATH.CHAN=TDIOV.ALTPATH.CHAN;
     1150     4279    2              PATH.DVN=DCB$->F$DCB.DEVADR.DVN;
     1151     4280    2              CALL TDU$FINDPATH(PATH,'0'B,DCT$,SQH$,DQH$,MPC$) ALTRET(ALTBAD);
     1152     4281    3              IF MPC$~=DCB$->F$DCB.MPC$ THEN DO;
     1153     4282    3   ALTBAD:       CALL BADRET(%E$TDALTBAD,4);
     1154     4283    3                 END;
     1155     4284    2              IF DCT$~=DCB$->F$DCB.DCT$ THEN CALL BADRET(%E$TDALTBAD,4);
     1156     4285    2              DCB$->F$DCB.PATH=TDIOV.ALTPATH;
     1157     4286    2              END;
     1158     4287    2           ELSE DO;
     1159     4288    2              DCB.PATH.IOM=DCB.DEVADR.IOM;
     1160     4289    2              DCB.PATH.CHAN=DCB.DEVADR.CHAN;
     1161     4290    2              END;
     1162     4291    1           DCB.DQH$=NI$CHT.DQH$(DCB.PATH.IOM*%N_MAXCHANS+DCB.PATH.CHAN);
     1163     4292    1           CONT_FLG='1'B;
     1164     4293    1           WRITE_FLG='0'B;
     1165     4294    1           SUSPEND='0'B;
     1166     4295    1           RELEASE='0'B;
     1167     4296    1           CALL HFF$NILERASE(B$PS1$) ALTRET(NO_DCW_LIST);
     1168     4297    1           DCW$=B$PS1$;
     1169     4298    2           DO WHILE (CONT_FLG);
     1170     4299    3              IF IDCW.SVN=7 THEN DO;       /* THIS MUST BE AN IDCW               */
     1171     4300    3                 IF IDCW.DVN~=0 THEN
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:204  
     1172     4301    3                    IDCW.DVN=DCB.DEVADR.DVN;
     1173     4302    3                 IF HW_IMX THEN
     1174     4303    3                    IDCW.DATA.BASE=%IMX_TDBUF_BASE;
     1175     4304    3                 CONT_FLG=IDCW.CONT;
     1176     4305    3                 IF DCB.TDFLG.SDSK THEN
     1177     4306    4                 DO CASE(IDCW.DC);
     1178     4307    4                  CASE(28,24);             /* SEEK                               */
     1179     4308    4                    WRITE_FLG='0'B;
     1180     4309    4                  CASE(30,29);             /* SPECIAL SEEK                       */
     1181     4310    4                    WRITE_FLG='1'B;
     1182     4311    4                  CASE(25,26,27/*WRITES*/);
     1183     4312    4                    IF ~WRITE_FLG THEN CALL BADRET(%E$TDBADIDCW,4);
     1184     4313    4                  END;                     /* CASE IDCW.DC                       */
     1185     4314    4                 IF IDCW.CCB & '40'O THEN DO;
     1186     4315    5                    IF IDCW.DC=0 THEN DO;
     1187     4316    5                       SUSPEND='1'B;
     1188     4317    5                       RELEASE='0'B;
     1189     4318    5                       END;
     1190     4319    5                    ELSE IF IDCW.DC=BITBIN('20'O) THEN DO;
     1191     4320    5                          RELEASE='1'B;
     1192     4321    5                          END;
     1193     4322    4                    END;
     1194     4323    3                 END;                      /* THIS MUST BE AN IDCW               */
     1195     4324    2              ELSE                         /* THIS MUST BE A DCW OF ANOTHER SORT */
     1196     4325    3              DO CASE(DCW.TYPE);
     1197     4326    3               CASE(%DCW_TDCW);
     1198     4327    3                 IF HW_IMX THEN
     1199     4328    3                    DCW.T.DCWLIST.BASE=%IMX_TDBUF_BASE;
     1200     4329    3                 DCW$=PINCRW(B$PS2$,DCW.FWA-1);
     1201     4330    3               CASE(ELSE);
     1202     4331    3               END;
     1203     4332    2              IF CONT_FLG THEN
     1204     4333    2                 DCW$=PINCRW(DCW$,1);
     1205     4334    2              END;                         /* DO WHILE CONT_FLG                  */
     1206     4335    1   NO_DCW_LIST: ;                     /* CONT_FLG WILL BE SET IF NO DCW LIST     */
     1207     4336        /* MAKE NECESSARY UPDATES TO DCB AND USER TABLE INFO */
     1208     4337    1           IF S$CU$->B$U.MF >= SL_MF(B$JIT.MODE)
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:205  
     1209     4338    1           THEN CALL SSR$REG(%SS_QMF);
     1210     4339                %LOCK (G#=NI_MFGATE);
     1211     4342    1           S$CU$->B$U.MF=S$CU$->B$U.MF+1;
     1212     4343                %UNLOCK (G#=NI_MFGATE);
     1213     4346    1           DCB$->F$DCB.WAIT=0;
     1214     4347                %LOCK (G#=F_DCBLOCK);
     1215     4350    1           DCB$->F$DCB.FCN.CNT(0)=DCB$->F$DCB.FCN.CNT(0)+1;
     1216     4351                %UNLOCK (G#=F_DCBLOCK);
     1217     4354        /*   All access checks have been passed, we now get an IOQ packet
     1218     4355             and set it up to do the I/O. */
     1219     4356    1           CALL NIQ$GET(REQ$);
     1220     4357    2           IF N$REQ.IOFLG.IOS THEN DO;
     1221     4358    2              IOS$=N$REQ.IOS$;
     1222     4359    2              NI$REQ=NI$REQ_INIT;
     1223     4360    3              IF HW_IMX THEN DO;
     1224     4361    3                 MBX$=PINCRW(IOS$,%IMX_MBX_OFFSET);
     1225     4362    3                 NI$IMXMBX=NI$IMXMBX_INIT;
     1226     4363    3                 END;
     1227     4364    2              END;
     1228     4365    2           ELSE DO;
     1229     4366    2              CALL NIQ$GETS(IOS$);
     1230     4367    2              IF HW_IMX THEN
     1231     4368    2                 MBX$=PINCRW(IOS$,%IMX_MBX_OFFSET);
     1232     4369    2              N$REQ.IOS$=IOS$;
     1233     4370    2              N$REQ.IOFLG.IOS='1'B;
     1234     4371    2              END;
     1235     4372    1           N$REQ.DCT$=DCB.DCT$;
     1236     4373    1           N$REQ.DLA.DCTX=DCB.DCT$->NI$DCT.DCTX;
     1237     4374    1           N$REQ.COMP=%COMP_TD;
     1238     4375    1           N$REQ.IOFLG.SUSP=SUSPEND;
     1239     4376    1           N$REQ.IOFLG.REL=RELEASE;
     1240     4377    1           N$REQ.BPMIR = '1'B ;
     1241     4378    1           CALL NIM$CVTPTR(B$PS2$,BUFADDR,BUFPTP);
     1242     4379    2           IF CONT_FLG THEN DO;            /* NO DCWLIST                         */
     1243     4380    2              NI$REQ.IDCW(0)='0000007'O;
     1244     4381    2              DCWPTP=BUFPTP;
     1245     4382    2              END;
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:206  
     1246     4383    2           ELSE DO;
     1247     4384    2              CALL NIM$CVTPTR(B$PS1$,DCWADDR,DCWPTP);
     1248     4385    3              IF HW_IMX THEN DO;
     1249     4386    3                 NI$REQ.DCW(0)=%TDCWM1;
     1250     4387    3                 NI$REQ.DCW.T.DCWLIST.BASE(0)=%IMX_TDDCW_BASE;
     1251     4388    3                 CALL HFF$DSIZ (B$PS1$,I);
     1252     4389    3                 NI$IMXMBX.PAGED_BASE.PTWADDR(%IMX_TDDCW_BASE)=DCWPTP;
     1253     4390    3                 NI$IMXMBX.PAGED_BASE.OFFSET(%IMX_TDDCW_BASE)=DCWADDR/4;
     1254     4391    3                 NI$IMXMBX.SIZE(%IMX_TDDCW_BASE)=(I+DCWVIRT.BYT+3)/4 - 1;
     1255     4392    3                 END;
     1256     4393    3              ELSE DO;
     1257     4394    4                 IF BUFPTP<DCWPTP THEN DO;
     1258     4395    4                    DCWADDR=DCWADDR+(4096*HW_IOPTP_UNITS*(DCWPTP-BUFPTP));
     1259     4396    4                    DCWPTP=BUFPTP;
     1260     4397    4                    END;
     1261     4398    4                 ELSE IF BUFPTP>DCWPTP THEN DO;
     1262     4399    4                       BUFADDR=BUFADDR+(4096*HW_IOPTP_UNITS*(BUFPTP-DCWPTP));
     1263     4400    4                       BUFPTP=DCWPTP;
     1264     4401    4                       END;
     1265     4402    3                 NI$REQ.DCW(0)=%TDCWM4;
     1266     4403    3                 NI$REQ.DCW.FWA(0)=DCWADDR/4;
     1267     4404    3                 END;
     1268     4405    2              END;
     1269     4406    1           N$REQ.LPWX.BASE=BUFADDR/8;
     1270     4407    1           CALL HFF$DSIZ(B$PS2$,I);
     1271     4408    1           N$REQ.LPWX.BOUND=(I+BUFVIRT.BYT)/4;
     1272     4409    1           N$REQ.PTP=BUFPTP;
     1273     4410    2           IF HW_IMX THEN DO;
     1274     4411    2              NI$IMXMBX.PAGED_BASE(%IMX_IOS_BASE)=BINBIT(NI_IMXLO_PBASE,36);
     1275     4412    2              NI$IMXMBX.SIZE(%IMX_IOS_BASE)=(%IMXHI-%IMXLO+1)*1024 - 1;
     1276     4413    2              NI$IMXMBX.PAGED_BASE.PTWADDR(%IMX_TDBUF_BASE)=BUFPTP;
     1277     4414    2              NI$IMXMBX.PAGED_BASE.OFFSET(%IMX_TDBUF_BASE)=N$REQ.LPWX.BASE*2;
     1278     4415    2              NI$IMXMBX.SIZE(%IMX_TDBUF_BASE)=N$REQ.LPWX.BOUND-1;
     1279     4416    2              PNTR$=ADDR(NI$REQ.DCW(0));
     1280     4417    2              NI$IMXMBX.LPW.DCW_ADDR=PNTR.WA;
     1281     4418    3              DO CASE (ADDR(TDIOV.PCW)->PCW_B.MASK);
     1282     4419    3               CASE(4);
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:207  
     1283     4420    3                 N$REQ.IMX_TDIO_MASK='1'B;
     1284     4421    3                 NI$IMXMBX.IOSTATUS(0)=%IMX_CCW_MASK_CHAN;
     1285     4422    3               CASE(7);
     1286     4423    3                 N$REQ.IMX_TDIO_MASK='1'B;
     1287     4424    3                 NI$IMXMBX.IOSTATUS(0)=%IMX_CCW_RSO;
     1288     4425    3               CASE(ELSE);
     1289     4426    3               END;
     1290     4427    2              END;
     1291     4428    2           ELSE DO;
     1292     4429    2              NI$REQ.PCW=TDIOV.PCW;
     1293     4430    2              NI$REQ.PCW.FLAGS='600'O;
     1294     4431    2              IF HW_IOP THEN
     1295     4432    2                 NI$REQ.IOP_PTAW=BINBIT(BUFPTP,27)|%IOP_PTA1_INIT; /* PHYSADDR   */
     1296     4433    2              ELSE
     1297     4434    2                 NI$REQ.PCW.PTP=BUFPTP;
     1298     4435    2              END;
     1299     4436    1           N$REQ.USER#=B$JIT.USER;
     1300     4437    1           N$REQ.OPFLG.WAIT=TDIOV.WAIT;
     1301     4438    1           N$REQ.NWIO=0;
     1302     4439    1           N$REQ.DCB$=DCB$;
     1303     4440    1           N$REQ.DQH$=DCB.DQH$;
     1304     4441    1           N$REQ.EVNTINFO=TDIOV.EVENT;
     1305     4442    1           N$REQ.TIMOUT=TDIOV.TIMEOUT;
     1306     4443    1           N$REQ.IOFLG.MREC='1'B;
     1307     4444    1           N$REQ.BUF$=B$PS2$;              /* FOR DEBUG PURPOSES ONLY            */
     1308     4445        /* CALL THE APPROPRIATE DEVICE SCHEDULER TO GET THE I/O STARTED */
     1309     4446    1           EXTRN=N$REQ.DCT$->NI$DCT.DVT$->NI$DVT.SCHED;
     1310     4447    1           N$REQ.IOQFLG.IOQUED = '1'B ;
     1311     4448    1           CALL EXTRN(N$REQ);
     1312     4449    1           IF TDIOV.WAIT THEN CALL FMB$IOSPIN;
     1313     4450    1           RETURN;
     1314     4451        /**/
     1315     4452    1   BADRET: PROC(ERROR,SEV);
     1316     4453    2   DCL ERROR UBIN WORD;
     1317     4454    2   DCL SEV UBIN WORD;
     1318     4455    2           B$JIT.ERR='240420000000'O;
     1319     4456    2           B$JIT.ERR.CODE=ERROR;
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:208  
     1320     4457    2           B$JIT.ERR.SEV=SEV;
     1321     4458    2           CALL UDB$PMMEXIT;
     1322     4459    2   END BADRET;
     1323     4460    1   END TDP$TDIO;
     1324     4461        %EOD;

PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:209  
--  Include file information  --

   TD_ERRORS_C.:E05TOU  is referenced.
   TD$CP6V_C.:E05TOU  is referenced.
   S_WSPTD_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   M_INFO_C.:E05TOU  is referenced.
   IT_SUBS_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure TDP$TDIO.

   Procedure TDP$TDIO requires 635 words for executable code.
   Procedure TDP$TDIO requires 36 words of local(AUTO) storage.

PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:210  

 Object Unit name= TDP$TDIO                                   File name= TDP$PMME.:E05TOU
 UTS= JUL 30 '97 06:06:08.56 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      7      7  TDP$TDIO
    1   Proc  even  none   635   1173  TDP$TDIO
    2  RoData even  none    24     30  TDP$TDIO

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        0  TDP$TDIO
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:211  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       3 NIS$DCCON
 yes     yes           Std       6 TDU$FINDPATH
 yes     yes           Std       3 SSR$REG
         yes           Std       1 HFC$UNLOCK
         yes           Std       0 FMB$IOSPIN
 yes     yes           Std       1 HFF$NILERASE
 yes     yes           Std       1 NIQ$GET
         yes           Std       2 HFF$DSIZ
         yes           Std       1 HFC$LOCK
         yes           Std       3 NIM$CVTPTR
 yes     yes           Std       1 NIQ$GETS
         yes           Std       0 UDB$PMMEXIT
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     HW_IOPTP_UNITS                        HW_IOP                                HW_IMX
     KI_FEI$$                              N$DCT$$                               N$FQ$
     NI$CHT$                               NI$FQ$                                NI$IBUF$
r    NI$IMXMBX_INIT                   r    NI$REQ_INIT                           NI$RP$
     NI_IMXLO_PBASE                        NI_MFGATE                             B$JIT$
     B$PS0$                                B$PS1$                                B$PS2$
     S$CU$                                 F_DCBLOCK                             SL_MF
     B_VECTNIL
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:212  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:213  


     1013        1        /*M* TDP$TDIO - M$TDIO PMME HANDLER */
     1014        2        /*T***********************************************************/
     1015        3        /*T*                                                         */
     1016        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1017        5        /*T*                                                         */
     1018        6        /*T***********************************************************/
     1019        7        TDP$TDIO: PROC;

      7  1 000000   000000 700200 xent  TDP$TDIO     TSX0  ! X66_AUTO_0
         1 000001   000044 000000                    ZERO    36,0

     1020        8        /*
     1021        9                Includes
     1022       10        */
     1023       11        %INCLUDE                        B$JIT ;
     1024      614        %INCLUDE                        B$USER ;
     1025      830        %INCLUDE                        B_STRINGS_C ;
     1026      959        %INCLUDE                        CP_6_SUBS ;
     1027     1499        %INCLUDE                        F$DCB ;
     1028     1548        %INCLUDE                        HF_DATA_R ;
     1029     1591        %INCLUDE                        HF_LOCK_C ;
     1030     1605        %INCLUDE                        IT_SUBS_C ;
     1031     1872        %INCLUDE                        M_INFO_C ;
     1032     2012        %INCLUDE                        KI_DATA_R ;
     1033     2038        %INCLUDE                        KI_MACROS_C ;
     1034     2646        %INCLUDE                        NI_DATA_R ;
     1035     3083        %INCLUDE                        NI_DATA_C ;
     1036     3196        %INCLUDE                        NI_MACROS_C ;
     1037     3463        %INCLUDE                        SS_SCHED_C ;
     1038     3696        %INCLUDE                        S_WSPTD_R ;
     1039     3712        %INCLUDE                        TD$CP6V_C ;
     1040     3748        %INCLUDE                        TD_ERRORS_C ;
     1041     3831        /*
     1042     3832                Entries
     1043     3833        */
     1044     3834    1   DCL 1 FMB$IOSPIN                ENTRY ;
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:214  
     1045     3835    1   DCL 1 HFF$DSIZ                  ENTRY(2) ;
     1046     3836    1   DCL 1 HFF$NILERASE              ENTRY(1) ALTRET ;
     1047     3837    1   DCL 1 NIM$CVTPTR                ENTRY(3) ;
     1048     3838    1   DCL 1 NIQ$GET                   ENTRY(1) ALTRET ;
     1049     3839    1   DCL 1 NIQ$GETS                  ENTRY(1) ALTRET ;
     1050     3840    1   DCL 1 NIS$DCCON                 ENTRY(3) ;
     1051     3841    1   DCL 1 NIS$DRIVER                ENTRY(1) ;
     1052     3842    1   DCL 1 SSR$REG                   ENTRY(3) ALTRET ;
     1053     3843    1   DCL 1 TDU$FINDPATH              ENTRY(6) ALTRET ;
     1054     3844    1   DCL 1 UDB$PMMEXIT               ENTRY ;
     1055     3845        /*
     1056     3846                Symrefs
     1057     3847        */
     1058     3848    1   DCL 1 B$JIT$                    PTR SYMREF ;
     1059     3849    1   DCL 1 B$PS0$                    PTR SYMREF ;
     1060     3850    1   DCL 1 B$PS1$                    PTR SYMREF ;
     1061     3851    1   DCL 1 B$PS2$                    PTR SYMREF ;
     1062     3852        %B$USERREFS ;
     1063     3856    1   DCL 1 F_DCBLOCK                 BIT(72) SYMREF ALIGNED ;
     1064     3857    1   DCL 1 SL_MF(0:3)                SBIN SYMREF ;
     1065     3858        /*
     1066     3859                Auto
     1067     3860        */
     1068     3861    1   DCL 1 BUFADDR                   UBIN ALIGNED AUTO ;
     1069     3862    1   DCL 1 BUFVIRT                   REDEF BUFADDR,
     1070     3863    1         2 DA                      UBIN(33) UNAL,
     1071     3864    1         2 BYT                     UBIN(3) UNAL ;
     1072     3865    1   DCL 1 BUFPTP                    SBIN ALIGNED AUTO ;
     1073     3866    1   DCL 1 CONT_FLG                  BIT(1) ALIGNED AUTO ;
     1074     3867    1   DCL 1 DCB$                      PTR ALIGNED AUTO ;
     1075     3868    1   DCL 1 DCPCW                     ALIGNED AUTO,
     1076     3869    1         2 *                       BIT(18) UNAL,
     1077     3870    1         2 SVN                     BIT(3)  UNAL,
     1078     3871    1         2 MASK                    BIT(3)  UNAL,
     1079     3872    1         2 *                       BIT(12) UNAL ;
     1080     3873    1   DCL 1 DCT$                      PTR ALIGNED AUTO ;
     1081     3874    1   DCL 1 DCW$                      PTR ALIGNED AUTO ;
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:215  
     1082     3875    1   DCL 1 DCWADDR                   UBIN ALIGNED AUTO ;
     1083     3876    1   DCL 1 DCWVIRT                   REDEF DCWADDR,
     1084     3877    1         2 DA                      UBIN(33) UNAL,
     1085     3878    1         2 BYT                     UBIN(3) UNAL;
     1086     3879    1   DCL 1 DCWPTP                    SBIN ALIGNED AUTO ;
     1087     3880    1   DCL 1 DQH$                      PTR ALIGNED AUTO ;
     1088     3881    1   DCL 1 EXTRN                     EPTR ALIGNED AUTO ;
     1089     3882    1   DCL 1 I                         SBIN ALIGNED AUTO ;
     1090     3883    1   DCL 1 IOS$                      PTR ALIGNED AUTO ;
     1091     3884    1   DCL 1 FEI$                      PTR ALIGNED AUTO ;
     1092     3885    1   DCL 1 MBX$                      PTR ALIGNED AUTO ;
     1093     3886    1   DCL 1 MPC$                      PTR ALIGNED AUTO ;
     1094     3887    1   DCL 1 PATH                      ALIGNED AUTO,
     1095     3888    1         2 DVN                     UBIN(6) UNAL,
     1096     3889    1         2 IOM                     UBIN(3) UNAL,
     1097     3890    1         2 CHAN                    UBIN(9) UNAL ;
     1098     3891    1   DCL 1 PNTR$                     PTR ALIGNED AUTO ;
     1099     3892    1   DCL 1 PNTR                      REDEF PNTR$,
     1100     3893    1         2 WA                      UBIN(18) HALIGNED,
     1101     3894    1         2 *                       UBIN(18) HALIGNED ;
     1102     3895    1   DCL 1 RELEASE                   BIT(1) ALIGNED AUTO ;
     1103     3896    1   DCL 1 REQ$                      PTR ALIGNED AUTO ;
     1104     3897    1   DCL 1 SQH$                      PTR ALIGNED AUTO ;
     1105     3898    1   DCL 1 SUSPEND                   BIT(1) ALIGNED AUTO ;
     1106     3899    1   DCL 1 WRITE_FLG                 BIT(1) ALIGNED AUTO ;
     1107     3900
     1108     3901        /*
     1109     3902                Based
     1110     3903        */
     1111     3904        %DCW                            ( NAME=DCW,           STCLASS="BASED(DCW$)" ) ;
     1112     3934        %FPT$TDIO_V;
     1113     3938        %IDCW                           ( NAME=IDCW,          STCLASS="BASED(DCW$)" ) ;
     1114     3970        %KI$FEI                         (                     STCLASS="BASED(FEI$)" ) ;
     1115     4054        %N$REQ                          ( NAME=N$REQ,         STCLASS="BASED(REQ$)" ) ;
     1116     4112        %NI$CHT                         ( NAME="NI$CHT(0:0)", STCLASS="BASED(NI$CHT$)" ) ;
     1117     4115        %NI$DCT                         ( NAME=NI$DCT,        STCLASS=BASED         ) ;
     1118     4163        %NI$DQH                         ( NAME=NI$DQH,        STCLASS=BASED         ) ;
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:216  
     1119     4186        %NI$DVT                         ( NAME=NI$DVT,        STCLASS=BASED         ) ;
     1120     4193        %NI$IMXMBX                      ( NAME=NI$IMXMBX,     STCLASS="BASED(MBX$)" ) ;
     1121     4214        %NI$REQ                         ( NAME=NI$REQ,        STCLASS="BASED(IOS$)" ) ;
     1122     4239        %NI$SQH                         ( NAME=NI$SQH,        STCLASS=BASED         ) ;
     1123     4252    1   DCL 1 PCW_B                     BASED,
     1124     4253    1         2 *                       BIT(18) UNAL,
     1125     4254    1         2 SVN                     BIT(3) UNAL,
     1126     4255    1         2 MASK                    UBIN(3) UNAL,
     1127     4256    1         2 *                       BIT(12) UNAL ;
     1128     4257        /*
     1129     4258                Constants
     1130     4259        */
     1131     4260        %SUB DCB=DCB$->F$DCB;
     1132     4261        %SUB TDIOV=B$PS0$->FPT$TDIO_V;
     1133     4262
     1134     4263        %EJECT;
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:217  
     1135     4264    1           DCB$=B$JIT.DCB$;

   4264  1 000002   000000 470400 xsym               LDP0    B$JIT$
         1 000003   000232 236100                    LDQ     154,,PR0
         1 000004   200006 756100                    STQ     DCB$,,AUTO

     1136     4265    1           IF ~DCB$->F$DCB.FCD THEN CALL BADRET(%E$TDNOTOPEN,4);

   4265  1 000005   200006 471500                    LDP1    DCB$,,AUTO
         1 000006   100031 236100                    LDQ     25,,PR1
         1 000007   000026 736000                    QLS     22
         1 000010   400000 376003                    ANQ     -131072,DU
         1 000011   400000 676003                    ERQ     -131072,DU
         1 000012   000021 600000 1                  TZE     s:4266

   4265  1 000013   000001 236000 2                  LDQ     1
         1 000014   200034 756100                    STQ     @ERROR+1,,AUTO
         1 000015   000002 236000 2                  LDQ     2
         1 000016   200033 756100                    STQ     WRITE_FLG+2,,AUTO
         1 000017   001147 701000 1                  TSX1    BADRET
         1 000020   000000 011000                    NOP     0

     1137     4266    1           IF DCB$->F$DCB.ASN~=%T@D# THEN CALL BADRET(%E$TDNOTDCB,4);

   4266  1 000021   200006 470500                    LDP0    DCB$,,AUTO
         1 000022   000032 236100                    LDQ     26,,PR0
         1 000023   777000 376007                    ANQ     -512,DL
         1 000024   006000 116007                    CMPQ    3072,DL
         1 000025   000034 600000 1                  TZE     s:4267

   4266  1 000026   000001 236000 2                  LDQ     1
         1 000027   200034 756100                    STQ     @ERROR+1,,AUTO
         1 000030   000004 236000 2                  LDQ     4
         1 000031   200033 756100                    STQ     WRITE_FLG+2,,AUTO
         1 000032   001147 701000 1                  TSX1    BADRET
         1 000033   000000 011000                    NOP     0

PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:218  
     1138     4267    2           IF DCB$->F$DCB.FUN=%TD_TEST_FEP THEN DO;

   4267  1 000034   200006 470500                    LDP0    DCB$,,AUTO
         1 000035   000032 236100                    LDQ     26,,PR0
         1 000036   000777 376003                    ANQ     511,DU
         1 000037   000005 116003                    CMPQ    5,DU
         1 000040   000074 601000 1                  TNZ     s:4274

     1139     4268    2              DCPCW=TDIOV.PCW;

   4268  1 000041   000000 471400 xsym               LDP1    B$PS0$
         1 000042   100001 236100                    LDQ     1,,PR1
         1 000043   200007 756100                    STQ     DCPCW,,AUTO

     1140     4269    2              FEI$ = KI$FEI$(DCB$->F$DCB.DEVADR.DVN);

   4269  1 000044   000051 236100                    LDQ     41,,PR0
         1 000045   000014 772000                    QRL     12
         1 000046   000077 376007                    ANQ     63,DL
         1 000047   000000 473400 xsym               LDP3    KI_FEI$$
         1 000050   300000 236106                    LDQ     0,QL,PR3
         1 000051   200020 756100                    STQ     FEI$,,AUTO

     1141     4270    2              CALL NIS$DCCON(DCB$->F$DCB.DQH$->NI$DQH.IOCHAN,DCPCW.MASK,KI$FEI.FEWSQ);

   4270  1 000052   000046 474500                    LDP4    38,,PR0
         1 000053   000005 036003                    ADLQ    5,DU
         1 000054   200040 756100                    STQ     @SEV+4,,AUTO
         1 000055   200041 452500                    STP2    @SEV+5,,AUTO
         1 000056   200041 236100                    LDQ     @SEV+5,,AUTO
         1 000057   000005 036000 2                  ADLQ    5
         1 000060   200037 756100                    STQ     @SEV+3,,AUTO
         1 000061   200042 454500                    STP4    @SEV+6,,AUTO
         1 000062   200042 236100                    LDQ     @SEV+6,,AUTO
         1 000063   000006 036000 2                  ADLQ    6
         1 000064   200036 756100                    STQ     @SEV+2,,AUTO
         1 000065   200036 630500                    EPPR0   @SEV+2,,AUTO
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:219  
         1 000066   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000067   000000 701000 xent               TSX1    NIS$DCCON
         1 000070   000000 011000                    NOP     0

     1142     4271    2              DCB$->F$DCB.CONNCT=DCB$->F$DCB.CONNCT+1;

   4271  1 000071   200006 470500                    LDP0    DCB$,,AUTO
         1 000072   000041 054100                    AOS     33,,PR0

     1143     4272    2              RETURN;

   4272  1 000073   000000 702200 xent               TSX2  ! X66_ARET

     1144     4273    2              END;
     1145     4274    2           IF TDIOV.ALTPATH THEN DO;

   4274  1 000074   000000 471400 xsym               LDP1    B$PS0$
         1 000075   100000 236100                    LDQ     0,,PR1
         1 000076   007777 316007                    CANQ    4095,DL
         1 000077   000200 600000 1                  TZE     s:4288

     1146     4275    2              IF DCB$->F$DCB.FUN~=%TD_TEST_POLTS THEN

   4275  1 000100   000032 236100                    LDQ     26,,PR0
         1 000101   000777 376003                    ANQ     511,DU
         1 000102   000001 116003                    CMPQ    1,DU
         1 000103   000112 600000 1                  TZE     s:4277

     1147     4276    2                 CALL BADRET(%E$TDALTBAD,4);

   4276  1 000104   000001 236000 2                  LDQ     1
         1 000105   200034 756100                    STQ     @ERROR+1,,AUTO
         1 000106   000010 236000 2                  LDQ     8
         1 000107   200033 756100                    STQ     WRITE_FLG+2,,AUTO
         1 000110   001147 701000 1                  TSX1    BADRET
         1 000111   000000 011000                    NOP     0

PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:220  
     1148     4277    2              PATH.IOM=TDIOV.ALTPATH.IOM;

   4277  1 000112   000000 470400 xsym               LDP0    B$PS0$
         1 000113   000000 236100                    LDQ     0,,PR0
         1 000114   000022 736000                    QLS     18
         1 000115   200023 676100                    ERQ     PATH,,AUTO
         1 000116   007000 376003                    ANQ     3584,DU
         1 000117   200023 656100                    ERSQ    PATH,,AUTO

     1149     4278    2              PATH.CHAN=TDIOV.ALTPATH.CHAN;

   4278  1 000120   000000 236100                    LDQ     0,,PR0
         1 000121   000022 736000                    QLS     18
         1 000122   200023 552120                    STBQ    PATH,'20'O,AUTO

     1150     4279    2              PATH.DVN=DCB$->F$DCB.DEVADR.DVN;

   4279  1 000123   200006 471500                    LDP1    DCB$,,AUTO
         1 000124   100051 236100                    LDQ     41,,PR1
         1 000125   000022 736000                    QLS     18
         1 000126   200023 752140                    STCQ    PATH,'40'O,AUTO

     1151     4280    2              CALL TDU$FINDPATH(PATH,'0'B,DCT$,SQH$,DQH$,MPC$) ALTRET(ALTBAD);

   4280  1 000127   200022 633500                    EPPR3   MPC$,,AUTO
         1 000130   200043 453500                    STP3    @SEV+7,,AUTO
         1 000131   200014 634500                    EPPR4   DQH$,,AUTO
         1 000132   200042 454500                    STP4    @SEV+6,,AUTO
         1 000133   200027 635500                    EPPR5   SQH$,,AUTO
         1 000134   200041 455500                    STP5    @SEV+5,,AUTO
         1 000135   200010 636500                    EPPR6   DCT$,,AUTO
         1 000136   200040 456500                    STP6    @SEV+4,,AUTO
         1 000137   000011 236000 2                  LDQ     9
         1 000140   200037 756100                    STQ     @SEV+3,,AUTO
         1 000141   200023 637500                    EPPR7   PATH,,AUTO
         1 000142   200036 457500                    STP7    @SEV+2,,AUTO
         1 000143   200036 630500                    EPPR0   @SEV+2,,AUTO
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:221  
         1 000144   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 000145   000000 701000 xent               TSX1    TDU$FINDPATH
         1 000146   000153 702000 1                  TSX2    ALTBAD

     1152     4281    3              IF MPC$~=DCB$->F$DCB.MPC$ THEN DO;

   4281  1 000147   200006 470500                    LDP0    DCB$,,AUTO
         1 000150   200022 236100                    LDQ     MPC$,,AUTO
         1 000151   000050 116100                    CMPQ    40,,PR0
         1 000152   000161 600000 1                  TZE     s:4284

     1153     4282    3   ALTBAD:       CALL BADRET(%E$TDALTBAD,4);

   4282  1 000153   000001 236000 2     ALTBAD       LDQ     1
         1 000154   200034 756100                    STQ     @ERROR+1,,AUTO
         1 000155   000010 236000 2                  LDQ     8
         1 000156   200033 756100                    STQ     WRITE_FLG+2,,AUTO
         1 000157   001147 701000 1                  TSX1    BADRET
         1 000160   000000 011000                    NOP     0

     1154     4283    3                 END;

     1155     4284    2              IF DCT$~=DCB$->F$DCB.DCT$ THEN CALL BADRET(%E$TDALTBAD,4);

   4284  1 000161   200006 470500                    LDP0    DCB$,,AUTO
         1 000162   200010 236100                    LDQ     DCT$,,AUTO
         1 000163   000047 116100                    CMPQ    39,,PR0
         1 000164   000173 600000 1                  TZE     s:4285

   4284  1 000165   000001 236000 2                  LDQ     1
         1 000166   200034 756100                    STQ     @ERROR+1,,AUTO
         1 000167   000010 236000 2                  LDQ     8
         1 000170   200033 756100                    STQ     WRITE_FLG+2,,AUTO
         1 000171   001147 701000 1                  TSX1    BADRET
         1 000172   000000 011000                    NOP     0

     1156     4285    2              DCB$->F$DCB.PATH=TDIOV.ALTPATH;
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:222  

   4285  1 000173   200006 470500                    LDP0    DCB$,,AUTO
         1 000174   000000 471400 xsym               LDP1    B$PS0$
         1 000175   100000 236100                    LDQ     0,,PR1
         1 000176   000060 752103                    STCQ    48,'03'O,PR0

     1157     4286    2              END;

   4286  1 000177   000206 710000 1                  TRA     s:4291

     1158     4287    2           ELSE DO;

     1159     4288    2              DCB.PATH.IOM=DCB.DEVADR.IOM;

   4288  1 000200   000051 236100                    LDQ     41,,PR0
         1 000201   000060 676100                    ERQ     48,,PR0
         1 000202   007000 376007                    ANQ     3584,DL
         1 000203   000060 656100                    ERSQ    48,,PR0

     1160     4289    2              DCB.PATH.CHAN=DCB.DEVADR.CHAN;

   4289  1 000204   000051 236100                    LDQ     41,,PR0
         1 000205   000060 552104                    STBQ    48,'04'O,PR0

     1161     4290    2              END;

     1162     4291    1           DCB.DQH$=NI$CHT.DQH$(DCB.PATH.IOM*%N_MAXCHANS+DCB.PATH.CHAN);

   4291  1 000206   000060 236100                    LDQ     48,,PR0
         1 000207   000777 376007                    ANQ     511,DL
         1 000210   200036 756100                    STQ     @SEV+2,,AUTO
         1 000211   000060 236100                    LDQ     48,,PR0
         1 000212   000002 772000                    QRL     2
         1 000213   001600 376007                    ANQ     896,DL
         1 000214   200036 036100                    ADLQ    @SEV+2,,AUTO
         1 000215   000001 736000                    QLS     1
         1 000216   000000 473400 xsym               LDP3    NI$CHT$
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:223  
         1 000217   300000 236106                    LDQ     0,QL,PR3
         1 000220   000046 756100                    STQ     38,,PR0

     1163     4292    1           CONT_FLG='1'B;

   4292  1 000221   400000 236003                    LDQ     -131072,DU
         1 000222   200005 756100                    STQ     CONT_FLG,,AUTO

     1164     4293    1           WRITE_FLG='0'B;

   4293  1 000223   200031 450100                    STZ     WRITE_FLG,,AUTO

     1165     4294    1           SUSPEND='0'B;

   4294  1 000224   200030 450100                    STZ     SUSPEND,,AUTO

     1166     4295    1           RELEASE='0'B;

   4295  1 000225   200025 450100                    STZ     RELEASE,,AUTO

     1167     4296    1           CALL HFF$NILERASE(B$PS1$) ALTRET(NO_DCW_LIST);

   4296  1 000226   000012 630400 2                  EPPR0   10
         1 000227   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000230   000000 701000 xent               TSX1    HFF$NILERASE
         1 000231   000377 702000 1                  TSX2    NO_DCW_LIST

     1168     4297    1           DCW$=B$PS1$;

   4297  1 000232   000000 236000 xsym               LDQ     B$PS1$
         1 000233   200011 756100                    STQ     DCW$,,AUTO

     1169     4298    2           DO WHILE (CONT_FLG);

   4298  1 000234   200005 234100                    SZN     CONT_FLG,,AUTO
         1 000235   000377 605000 1                  TPL     NO_DCW_LIST

PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:224  
     1170     4299    3              IF IDCW.SVN=7 THEN DO;       /* THIS MUST BE AN IDCW               */

   4299  1 000236   200011 470500                    LDP0    DCW$,,AUTO
         1 000237   000000 236100                    LDQ     0,,PR0
         1 000240   700000 376007                    ANQ     -32768,DL
         1 000241   700000 116007                    CMPQ    -32768,DL
         1 000242   000346 601000 1                  TNZ     s:4325

     1171     4300    3                 IF IDCW.DVN~=0 THEN

   4300  1 000243   000000 236100                    LDQ     0,,PR0
         1 000244   007700 316003                    CANQ    4032,DU
         1 000245   000252 600000 1                  TZE     s:4302

     1172     4301    3                    IDCW.DVN=DCB.DEVADR.DVN;

   4301  1 000246   200006 471500                    LDP1    DCB$,,AUTO
         1 000247   100051 236100                    LDQ     41,,PR1
         1 000250   000014 736000                    QLS     12
         1 000251   000000 752120                    STCQ    0,'20'O,PR0

     1173     4302    3                 IF HW_IMX THEN

   4302  1 000252   000000 234000 xsym               SZN     HW_IMX
         1 000253   000256 605000 1                  TPL     s:4304

     1174     4303    3                    IDCW.DATA.BASE=%IMX_TDBUF_BASE;

   4303  1 000254   000013 236000 2                  LDQ     11
         1 000255   000000 356100                    ANSQ    0,,PR0

     1175     4304    3                 CONT_FLG=IDCW.CONT;

   4304  1 000256   000000 236100                    LDQ     0,,PR0
         1 000257   000026 736000                    QLS     22
         1 000260   400000 376003                    ANQ     -131072,DU
         1 000261   200005 756100                    STQ     CONT_FLG,,AUTO
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:225  

     1176     4305    3                 IF DCB.TDFLG.SDSK THEN

   4305  1 000262   200006 471500                    LDP1    DCB$,,AUTO
         1 000263   100040 236100                    LDQ     32,,PR1
         1 000264   400000 316007                    CANQ    -131072,DL
         1 000265   000322 600000 1                  TZE     s:4314

     1177     4306    4                 DO CASE(IDCW.DC);

   4306  1 000266   000000 236100                    LDQ     0,,PR0
         1 000267   000036 772000                    QRL     30
         1 000270   000030 136007                    SBLQ    24,DL
         1 000271   000007 116007                    CMPQ    7,DL
         1 000272   000274 602006 1                  TNC     s:4306+6,QL
         1 000273   000322 710000 1                  TRA     s:4314
         1 000274   000303 710000 1                  TRA     s:4308
         1 000275   000310 710000 1                  TRA     s:4312
         1 000276   000310 710000 1                  TRA     s:4312
         1 000277   000310 710000 1                  TRA     s:4312
         1 000300   000303 710000 1                  TRA     s:4308
         1 000301   000305 710000 1                  TRA     s:4310
         1 000302   000305 710000 1                  TRA     s:4310

     1178     4307    4                  CASE(28,24);             /* SEEK                               */

     1179     4308    4                    WRITE_FLG='0'B;

   4308  1 000303   200031 450100                    STZ     WRITE_FLG,,AUTO
         1 000304   000322 710000 1                  TRA     s:4314

     1180     4309    4                  CASE(30,29);             /* SPECIAL SEEK                       */

     1181     4310    4                    WRITE_FLG='1'B;

   4310  1 000305   400000 236003                    LDQ     -131072,DU
         1 000306   200031 756100                    STQ     WRITE_FLG,,AUTO
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:226  
         1 000307   000322 710000 1                  TRA     s:4314

     1182     4311    4                  CASE(25,26,27/*WRITES*/);

     1183     4312    4                    IF ~WRITE_FLG THEN CALL BADRET(%E$TDBADIDCW,4);

   4312  1 000310   200031 236100                    LDQ     WRITE_FLG,,AUTO
         1 000311   400000 376003                    ANQ     -131072,DU
         1 000312   400000 676003                    ERQ     -131072,DU
         1 000313   000322 600000 1                  TZE     s:4314

   4312  1 000314   000001 236000 2                  LDQ     1
         1 000315   200034 756100                    STQ     @ERROR+1,,AUTO
         1 000316   000015 236000 2                  LDQ     13
         1 000317   200033 756100                    STQ     WRITE_FLG+2,,AUTO
         1 000320   001147 701000 1                  TSX1    BADRET
         1 000321   000000 011000                    NOP     0

     1184     4313    4                  END;                     /* CASE IDCW.DC                       */

     1185     4314    4                 IF IDCW.CCB & '40'O THEN DO;

   4314  1 000322   200011 470500                    LDP0    DCW$,,AUTO
         1 000323   000000 236100                    LDQ     0,,PR0
         1 000324   000030 736000                    QLS     24
         1 000325   770000 376003                    ANQ     -4096,DU
         1 000326   400000 376003                    ANQ     -131072,DU
         1 000327   000370 600000 1                  TZE     s:4332

     1186     4315    5                    IF IDCW.DC=0 THEN DO;

   4315  1 000330   000000 236100                    LDQ     0,,PR0
         1 000331   770000 316003                    CANQ    -4096,DU
         1 000332   000337 601000 1                  TNZ     s:4319

     1187     4316    5                       SUSPEND='1'B;

PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:227  
   4316  1 000333   400000 236003                    LDQ     -131072,DU
         1 000334   200030 756100                    STQ     SUSPEND,,AUTO

     1188     4317    5                       RELEASE='0'B;

   4317  1 000335   200025 450100                    STZ     RELEASE,,AUTO

     1189     4318    5                       END;

   4318  1 000336   000370 710000 1                  TRA     s:4332

     1190     4319    5                    ELSE IF IDCW.DC=BITBIN('20'O) THEN DO;

   4319  1 000337   000000 236100                    LDQ     0,,PR0
         1 000340   770000 376003                    ANQ     -4096,DU
         1 000341   200000 116003                    CMPQ    65536,DU
         1 000342   000370 601000 1                  TNZ     s:4332

     1191     4320    5                          RELEASE='1'B;

   4320  1 000343   400000 236003                    LDQ     -131072,DU
         1 000344   200025 756100                    STQ     RELEASE,,AUTO

     1192     4321    5                          END;

     1193     4322    4                    END;

     1194     4323    3                 END;                      /* THIS MUST BE AN IDCW               */

   4323  1 000345   000370 710000 1                  TRA     s:4332

     1195     4324    2              ELSE                         /* THIS MUST BE A DCW OF ANOTHER SORT */
     1196     4325    3              DO CASE(DCW.TYPE);

   4325  1 000346   000000 236100                    LDQ     0,,PR0
         1 000347   000014 772000                    QRL     12
         1 000350   000007 376007                    ANQ     7,DL
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:228  
         1 000351   000003 116007                    CMPQ    3,DL
         1 000352   000354 602006 1                  TNC     s:4325+6,QL
         1 000353   000370 710000 1                  TRA     s:4332
         1 000354   000370 710000 1                  TRA     s:4332
         1 000355   000370 710000 1                  TRA     s:4332
         1 000356   000357 710000 1                  TRA     s:4327

     1197     4326    3               CASE(%DCW_TDCW);

     1198     4327    3                 IF HW_IMX THEN

   4327  1 000357   000000 234000 xsym               SZN     HW_IMX
         1 000360   000363 605000 1                  TPL     s:4329

     1199     4328    3                    DCW.T.DCWLIST.BASE=%IMX_TDBUF_BASE;

   4328  1 000361   000016 236000 2                  LDQ     14
         1 000362   000000 356100                    ANSQ    0,,PR0

     1200     4329    3                 DCW$=PINCRW(B$PS2$,DCW.FWA-1);

   4329  1 000363   000000 220100                    LDX0    0,,PR0
         1 000364   777777 636010                    EAQ     -1,X0
         1 000365   000000 036000 xsym               ADLQ    B$PS2$
         1 000366   200011 756100                    STQ     DCW$,,AUTO
         1 000367   000370 710000 1                  TRA     s:4332

     1201     4330    3               CASE(ELSE);

     1202     4331    3               END;

     1203     4332    2              IF CONT_FLG THEN

   4332  1 000370   200005 234100                    SZN     CONT_FLG,,AUTO
         1 000371   000375 605000 1                  TPL     s:4334

     1204     4333    2                 DCW$=PINCRW(DCW$,1);
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:229  

   4333  1 000372   200011 236100                    LDQ     DCW$,,AUTO
         1 000373   000001 036003                    ADLQ    1,DU
         1 000374   200011 756100                    STQ     DCW$,,AUTO

     1205     4334    2              END;                         /* DO WHILE CONT_FLG                  */

   4334  1 000375   200005 234100                    SZN     CONT_FLG,,AUTO
         1 000376   000236 604000 1                  TMI     s:4299

   4330  1 000377                       NO_DCW_LIST  null
     1206     4335    1   NO_DCW_LIST: ;                     /* CONT_FLG WILL BE SET IF NO DCW LIST     */
     1207     4336        /* MAKE NECESSARY UPDATES TO DCB AND USER TABLE INFO */
     1208     4337    1           IF S$CU$->B$U.MF >= SL_MF(B$JIT.MODE)

   4337  1 000377   000000 470400 xsym               LDP0    B$JIT$
         1 000400   000000 236100                    LDQ     0,,PR0
         1 000401   000040 772000                    QRL     32
         1 000402   000000 620006                    EAX0    0,QL
         1 000403   000000 471400 xsym               LDP1    S$CU$
         1 000404   100006 236100                    LDQ     6,,PR1
         1 000405   000033 772000                    QRL     27
         1 000406   000000 116010 xsym               CMPQ    SL_MF,X0
         1 000407   000414 604000 1                  TMI     s:4340

     1209     4338    1           THEN CALL SSR$REG(%SS_QMF);

   4338  1 000410   000017 630400 2                  EPPR0   15
         1 000411   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000412   000000 701000 xent               TSX1    SSR$REG
         1 000413   000000 011000                    NOP     0

     1210     4339                %LOCK (G#=NI_MFGATE);

   4340  1 000414   000020 630400 2                  EPPR0   16
         1 000415   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000416   000000 701000 xent               TSX1    HFC$LOCK
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:230  
         1 000417   000000 011000                    NOP     0

     1211     4342    1           S$CU$->B$U.MF=S$CU$->B$U.MF+1;

   4342  1 000420   000000 470400 xsym               LDP0    S$CU$
         1 000421   000006 236100                    LDQ     6,,PR0
         1 000422   001000 036003                    ADLQ    512,DU
         1 000423   000006 552140                    STBQ    6,'40'O,PR0

     1212     4343                %UNLOCK (G#=NI_MFGATE);

   4344  1 000424   000020 630400 2                  EPPR0   16
         1 000425   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000426   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000427   000000 011000                    NOP     0

     1213     4346    1           DCB$->F$DCB.WAIT=0;

   4346  1 000430   200006 470500                    LDP0    DCB$,,AUTO
         1 000431   000021 236000 2                  LDQ     17
         1 000432   000064 356100                    ANSQ    52,,PR0

     1214     4347                %LOCK (G#=F_DCBLOCK);

   4348  1 000433   000022 630400 2                  EPPR0   18
         1 000434   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000435   000000 701000 xent               TSX1    HFC$LOCK
         1 000436   000000 011000                    NOP     0

     1215     4350    1           DCB$->F$DCB.FCN.CNT(0)=DCB$->F$DCB.FCN.CNT(0)+1;

   4350  1 000437   200006 470500                    LDP0    DCB$,,AUTO
         1 000440   000074 236100                    LDQ     60,,PR0
         1 000441   000033 772000                    QRL     27
         1 000442   000377 376007                    ANQ     255,DL
         1 000443   000001 036007                    ADLQ    1,DL
         1 000444   000033 736000                    QLS     27
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:231  
         1 000445   000074 676100                    ERQ     60,,PR0
         1 000446   377000 376003                    ANQ     130560,DU
         1 000447   000074 656100                    ERSQ    60,,PR0

     1216     4351                %UNLOCK (G#=F_DCBLOCK);

   4352  1 000450   000022 630400 2                  EPPR0   18
         1 000451   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000452   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000453   000000 011000                    NOP     0

     1217     4354        /*   All access checks have been passed, we now get an IOQ packet
     1218     4355             and set it up to do the I/O. */
     1219     4356    1           CALL NIQ$GET(REQ$);

   4356  1 000454   200026 630500                    EPPR0   REQ$,,AUTO
         1 000455   200036 450500                    STP0    @SEV+2,,AUTO
         1 000456   200036 630500                    EPPR0   @SEV+2,,AUTO
         1 000457   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000460   000000 701000 xent               TSX1    NIQ$GET
         1 000461   000000 011000                    NOP     0

     1220     4357    2           IF N$REQ.IOFLG.IOS THEN DO;

   4357  1 000462   200026 470500                    LDP0    REQ$,,AUTO
         1 000463   000004 236100                    LDQ     4,,PR0
         1 000464   040000 316007                    CANQ    16384,DL
         1 000465   000506 600000 1                  TZE     s:4366

     1221     4358    2              IOS$=N$REQ.IOS$;

   4358  1 000466   000012 236100                    LDQ     10,,PR0
         1 000467   200017 756100                    STQ     IOS$,,AUTO

     1222     4359    2              NI$REQ=NI$REQ_INIT;

   4359  1 000470   200017 471500                    LDP1    IOS$,,AUTO
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:232  
         1 000471   000100 100400                    MLR     fill='000'O
         1 000472   000000 000070 xsym               ADSC9   NI$REQ_INIT              cn=0,n=56
         1 000473   100000 000070                    ADSC9   0,,PR1                   cn=0,n=56

     1223     4360    3              IF HW_IMX THEN DO;

   4360  1 000474   000000 234000 xsym               SZN     HW_IMX
         1 000475   000527 605000 1                  TPL     s:4372

     1224     4361    3                 MBX$=PINCRW(IOS$,%IMX_MBX_OFFSET);

   4361  1 000476   200017 236100                    LDQ     IOS$,,AUTO
         1 000477   000010 036003                    ADLQ    8,DU
         1 000500   200021 756100                    STQ     MBX$,,AUTO

     1225     4362    3                 NI$IMXMBX=NI$IMXMBX_INIT;

   4362  1 000501   200021 470500                    LDP0    MBX$,,AUTO
         1 000502   000100 100400                    MLR     fill='000'O
         1 000503   000000 000140 xsym               ADSC9   NI$IMXMBX_INIT           cn=0,n=96
         1 000504   000000 000140                    ADSC9   0,,PR0                   cn=0,n=96

     1226     4363    3                 END;

     1227     4364    2              END;

   4364  1 000505   000527 710000 1                  TRA     s:4372

     1228     4365    2           ELSE DO;

     1229     4366    2              CALL NIQ$GETS(IOS$);

   4366  1 000506   200017 631500                    EPPR1   IOS$,,AUTO
         1 000507   200036 451500                    STP1    @SEV+2,,AUTO
         1 000510   200036 630500                    EPPR0   @SEV+2,,AUTO
         1 000511   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000512   000000 701000 xent               TSX1    NIQ$GETS
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:233  
         1 000513   000000 011000                    NOP     0

     1230     4367    2              IF HW_IMX THEN

   4367  1 000514   000000 234000 xsym               SZN     HW_IMX
         1 000515   000521 605000 1                  TPL     s:4369

     1231     4368    2                 MBX$=PINCRW(IOS$,%IMX_MBX_OFFSET);

   4368  1 000516   200017 236100                    LDQ     IOS$,,AUTO
         1 000517   000010 036003                    ADLQ    8,DU
         1 000520   200021 756100                    STQ     MBX$,,AUTO

     1232     4369    2              N$REQ.IOS$=IOS$;

   4369  1 000521   200017 236100                    LDQ     IOS$,,AUTO
         1 000522   200026 470500                    LDP0    REQ$,,AUTO
         1 000523   000012 756100                    STQ     10,,PR0

     1233     4370    2              N$REQ.IOFLG.IOS='1'B;

   4370  1 000524   200026 470500                    LDP0    REQ$,,AUTO
         1 000525   040000 236007                    LDQ     16384,DL
         1 000526   000004 256100                    ORSQ    4,,PR0

     1234     4371    2              END;

     1235     4372    1           N$REQ.DCT$=DCB.DCT$;

   4372  1 000527   200006 470500                    LDP0    DCB$,,AUTO
         1 000530   000047 236100                    LDQ     39,,PR0
         1 000531   200026 471500                    LDP1    REQ$,,AUTO
         1 000532   100002 756100                    STQ     2,,PR1

     1236     4373    1           N$REQ.DLA.DCTX=DCB.DCT$->NI$DCT.DCTX;

   4373  1 000533   000047 471500                    LDP1    39,,PR0
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:234  
         1 000534   200026 473500                    LDP3    REQ$,,AUTO
         1 000535   100006 236100                    LDQ     6,,PR1
         1 000536   300001 676100                    ERQ     1,,PR3
         1 000537   777770 376003                    ANQ     -8,DU
         1 000540   300001 656100                    ERSQ    1,,PR3

     1237     4374    1           N$REQ.COMP=%COMP_TD;

   4374  1 000541   200026 471500                    LDP1    REQ$,,AUTO
         1 000542   100027 236100                    LDQ     23,,PR1
         1 000543   000023 376000 2                  ANQ     19
         1 000544   004000 276007                    ORQ     2048,DL
         1 000545   100027 756100                    STQ     23,,PR1

     1238     4375    1           N$REQ.IOFLG.SUSP=SUSPEND;

   4375  1 000546   200030 236100                    LDQ     SUSPEND,,AUTO
         1 000547   000030 772000                    QRL     24
         1 000550   100004 676100                    ERQ     4,,PR1
         1 000551   004000 376007                    ANQ     2048,DL
         1 000552   100004 656100                    ERSQ    4,,PR1

     1239     4376    1           N$REQ.IOFLG.REL=RELEASE;

   4376  1 000553   200026 471500                    LDP1    REQ$,,AUTO
         1 000554   200025 236100                    LDQ     RELEASE,,AUTO
         1 000555   000031 772000                    QRL     25
         1 000556   100004 676100                    ERQ     4,,PR1
         1 000557   002000 376007                    ANQ     1024,DL
         1 000560   100004 656100                    ERSQ    4,,PR1

     1240     4377    1           N$REQ.BPMIR = '1'B ;

   4377  1 000561   200026 471500                    LDP1    REQ$,,AUTO
         1 000562   200000 236003                    LDQ     65536,DU
         1 000563   100034 256100                    ORSQ    28,,PR1

PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:235  
     1241     4378    1           CALL NIM$CVTPTR(B$PS2$,BUFADDR,BUFPTP);

   4378  1 000564   200004 633500                    EPPR3   BUFPTP,,AUTO
         1 000565   200040 453500                    STP3    @SEV+4,,AUTO
         1 000566   200003 634500                    EPPR4   BUFADDR,,AUTO
         1 000567   200037 454500                    STP4    @SEV+3,,AUTO
         1 000570   000024 236000 2                  LDQ     20
         1 000571   200036 756100                    STQ     @SEV+2,,AUTO
         1 000572   200036 630500                    EPPR0   @SEV+2,,AUTO
         1 000573   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000574   000000 701000 xent               TSX1    NIM$CVTPTR
         1 000575   000000 011000                    NOP     0

     1242     4379    2           IF CONT_FLG THEN DO;            /* NO DCWLIST                         */

   4379  1 000576   200005 234100                    SZN     CONT_FLG,,AUTO
         1 000577   000606 605000 1                  TPL     s:4384

     1243     4380    2              NI$REQ.IDCW(0)='0000007'O;

   4380  1 000600   000000 236000 0                  LDQ     0
         1 000601   200017 470500                    LDP0    IOS$,,AUTO
         1 000602   000002 756100                    STQ     2,,PR0

     1244     4381    2              DCWPTP=BUFPTP;

   4381  1 000603   200004 235100                    LDA     BUFPTP,,AUTO
         1 000604   200013 755100                    STA     DCWPTP,,AUTO

     1245     4382    2              END;

   4382  1 000605   000721 710000 1                  TRA     s:4406

     1246     4383    2           ELSE DO;

     1247     4384    2              CALL NIM$CVTPTR(B$PS1$,DCWADDR,DCWPTP);

PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:236  
   4384  1 000606   200013 630500                    EPPR0   DCWPTP,,AUTO
         1 000607   200040 450500                    STP0    @SEV+4,,AUTO
         1 000610   200012 631500                    EPPR1   DCWADDR,,AUTO
         1 000611   200037 451500                    STP1    @SEV+3,,AUTO
         1 000612   000012 236000 2                  LDQ     10
         1 000613   200036 756100                    STQ     @SEV+2,,AUTO
         1 000614   200036 630500                    EPPR0   @SEV+2,,AUTO
         1 000615   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000616   000000 701000 xent               TSX1    NIM$CVTPTR
         1 000617   000000 011000                    NOP     0

     1248     4385    3              IF HW_IMX THEN DO;

   4385  1 000620   000000 234000 xsym               SZN     HW_IMX
         1 000621   000665 605000 1                  TPL     s:4394

     1249     4386    3                 NI$REQ.DCW(0)=%TDCWM1;

   4386  1 000622   000001 236000 0                  LDQ     1
         1 000623   200017 470500                    LDP0    IOS$,,AUTO
         1 000624   000002 756100                    STQ     2,,PR0

     1250     4387    3                 NI$REQ.DCW.T.DCWLIST.BASE(0)=%IMX_TDDCW_BASE;

   4387  1 000625   200017 470500                    LDP0    IOS$,,AUTO
         1 000626   000002 236100                    LDQ     2,,PR0
         1 000627   000016 376000 2                  ANQ     14
         1 000630   000100 276007                    ORQ     64,DL
         1 000631   000002 756100                    STQ     2,,PR0

     1251     4388    3                 CALL HFF$DSIZ (B$PS1$,I);

   4388  1 000632   200016 630500                    EPPR0   I,,AUTO
         1 000633   200037 450500                    STP0    @SEV+3,,AUTO
         1 000634   000012 236000 2                  LDQ     10
         1 000635   200036 756100                    STQ     @SEV+2,,AUTO
         1 000636   200036 630500                    EPPR0   @SEV+2,,AUTO
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:237  
         1 000637   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000640   000000 701000 xent               TSX1    HFF$DSIZ
         1 000641   000000 011000                    NOP     0

     1252     4389    3                 NI$IMXMBX.PAGED_BASE.PTWADDR(%IMX_TDDCW_BASE)=DCWPTP;

   4389  1 000642   200021 470500                    LDP0    MBX$,,AUTO
         1 000643   200013 236100                    LDQ     DCWPTP,,AUTO
         1 000644   000012 736000                    QLS     10
         1 000645   000001 676100                    ERQ     1,,PR0
         1 000646   000025 376000 2                  ANQ     21
         1 000647   000001 656100                    ERSQ    1,,PR0

     1253     4390    3                 NI$IMXMBX.PAGED_BASE.OFFSET(%IMX_TDDCW_BASE)=DCWADDR/4;

   4390  1 000650   200012 236100                    LDQ     DCWADDR,,AUTO
         1 000651   000002 772000                    QRL     2
         1 000652   000001 676100                    ERQ     1,,PR0
         1 000653   001777 376007                    ANQ     1023,DL
         1 000654   000001 656100                    ERSQ    1,,PR0

     1254     4391    3                 NI$IMXMBX.SIZE(%IMX_TDDCW_BASE)=(I+DCWVIRT.BYT+3)/4 - 1;

   4391  1 000655   200012 236100                    LDQ     DCWADDR,,AUTO
         1 000656   000007 376007                    ANQ     7,DL
         1 000657   200016 036100                    ADLQ    I,,AUTO
         1 000660   000003 036007                    ADLQ    3,DL
         1 000661   000004 506007                    DIV     4,DL
         1 000662   777777 620006                    EAX0    -1,QL
         1 000663   000004 440100                    SXL0    4,,PR0

     1255     4392    3                 END;

   4392  1 000664   000721 710000 1                  TRA     s:4406

     1256     4393    3              ELSE DO;

PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:238  
     1257     4394    4                 IF BUFPTP<DCWPTP THEN DO;

   4394  1 000665   200004 236100                    LDQ     BUFPTP,,AUTO
         1 000666   200013 116100                    CMPQ    DCWPTP,,AUTO
         1 000667   000701 605000 1                  TPL     s:4398

     1258     4395    4                    DCWADDR=DCWADDR+(4096*HW_IOPTP_UNITS*(DCWPTP-BUFPTP));

   4395  1 000670   200013 236100                    LDQ     DCWPTP,,AUTO
         1 000671   200004 136100                    SBLQ    BUFPTP,,AUTO
         1 000672   000000 402000 xsym               MPY     HW_IOPTP_UNITS
         1 000673   000014 736000                    QLS     12
         1 000674   200012 036100                    ADLQ    DCWADDR,,AUTO
         1 000675   200012 756100                    STQ     DCWADDR,,AUTO

     1259     4396    4                    DCWPTP=BUFPTP;

   4396  1 000676   200004 235100                    LDA     BUFPTP,,AUTO
         1 000677   200013 755100                    STA     DCWPTP,,AUTO

     1260     4397    4                    END;

   4397  1 000700   000711 710000 1                  TRA     s:4402

     1261     4398    4                 ELSE IF BUFPTP>DCWPTP THEN DO;

   4398  1 000701   000711 604400 1                  TMOZ    s:4402

     1262     4399    4                       BUFADDR=BUFADDR+(4096*HW_IOPTP_UNITS*(BUFPTP-DCWPTP));

   4399  1 000702   200013 136100                    SBLQ    DCWPTP,,AUTO
         1 000703   000000 402000 xsym               MPY     HW_IOPTP_UNITS
         1 000704   000014 736000                    QLS     12
         1 000705   200003 036100                    ADLQ    BUFADDR,,AUTO
         1 000706   200003 756100                    STQ     BUFADDR,,AUTO

     1263     4400    4                       BUFPTP=DCWPTP;
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:239  

   4400  1 000707   200013 235100                    LDA     DCWPTP,,AUTO
         1 000710   200004 755100                    STA     BUFPTP,,AUTO

     1264     4401    4                       END;

     1265     4402    3                 NI$REQ.DCW(0)=%TDCWM4;

   4402  1 000711   000002 236000 0                  LDQ     2
         1 000712   200017 470500                    LDP0    IOS$,,AUTO
         1 000713   000002 756100                    STQ     2,,PR0

     1266     4403    3                 NI$REQ.DCW.FWA(0)=DCWADDR/4;

   4403  1 000714   200012 236100                    LDQ     DCWADDR,,AUTO
         1 000715   000002 772000                    QRL     2
         1 000716   000000 620006                    EAX0    0,QL
         1 000717   200017 470500                    LDP0    IOS$,,AUTO
         1 000720   000002 740100                    STX0    2,,PR0

     1267     4404    3                 END;

     1268     4405    2              END;

     1269     4406    1           N$REQ.LPWX.BASE=BUFADDR/8;

   4406  1 000721   200003 236100                    LDQ     BUFADDR,,AUTO
         1 000722   000003 772000                    QRL     3
         1 000723   000000 620006                    EAX0    0,QL
         1 000724   200026 470500                    LDP0    REQ$,,AUTO
         1 000725   000011 740100                    STX0    9,,PR0

     1270     4407    1           CALL HFF$DSIZ(B$PS2$,I);

   4407  1 000726   200016 630500                    EPPR0   I,,AUTO
         1 000727   200037 450500                    STP0    @SEV+3,,AUTO
         1 000730   000024 236000 2                  LDQ     20
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:240  
         1 000731   200036 756100                    STQ     @SEV+2,,AUTO
         1 000732   200036 630500                    EPPR0   @SEV+2,,AUTO
         1 000733   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000734   000000 701000 xent               TSX1    HFF$DSIZ
         1 000735   000000 011000                    NOP     0

     1271     4408    1           N$REQ.LPWX.BOUND=(I+BUFVIRT.BYT)/4;

   4408  1 000736   200003 236100                    LDQ     BUFADDR,,AUTO
         1 000737   000007 376007                    ANQ     7,DL
         1 000740   200016 036100                    ADLQ    I,,AUTO
         1 000741   000004 506007                    DIV     4,DL
         1 000742   000000 620006                    EAX0    0,QL
         1 000743   200026 470500                    LDP0    REQ$,,AUTO
         1 000744   000011 440100                    SXL0    9,,PR0

     1272     4409    1           N$REQ.PTP=BUFPTP;

   4409  1 000745   200026 470500                    LDP0    REQ$,,AUTO
         1 000746   200004 235100                    LDA     BUFPTP,,AUTO
         1 000747   000007 755100                    STA     7,,PR0

     1273     4410    2           IF HW_IMX THEN DO;

   4410  1 000750   000000 234000 xsym               SZN     HW_IMX
         1 000751   001035 605000 1                  TPL     s:4429

     1274     4411    2              NI$IMXMBX.PAGED_BASE(%IMX_IOS_BASE)=BINBIT(NI_IMXLO_PBASE,36);

   4411  1 000752   000000 236000 xsym               LDQ     NI_IMXLO_PBASE
         1 000753   200021 470500                    LDP0    MBX$,,AUTO
         1 000754   000002 756100                    STQ     2,,PR0

     1275     4412    2              NI$IMXMBX.SIZE(%IMX_IOS_BASE)=(%IMXHI-%IMXLO+1)*1024 - 1;

   4412  1 000755   037777 220003                    LDX0    16383,DU
         1 000756   000005 740100                    STX0    5,,PR0
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:241  

     1276     4413    2              NI$IMXMBX.PAGED_BASE.PTWADDR(%IMX_TDBUF_BASE)=BUFPTP;

   4413  1 000757   200004 236100                    LDQ     BUFPTP,,AUTO
         1 000760   000012 736000                    QLS     10
         1 000761   000000 676100                    ERQ     0,,PR0
         1 000762   000025 376000 2                  ANQ     21
         1 000763   000000 656100                    ERSQ    0,,PR0

     1277     4414    2              NI$IMXMBX.PAGED_BASE.OFFSET(%IMX_TDBUF_BASE)=N$REQ.LPWX.BASE*2;

   4414  1 000764   200026 471500                    LDP1    REQ$,,AUTO
         1 000765   100011 236100                    LDQ     9,,PR1
         1 000766   000021 772000                    QRL     17
         1 000767   000026 376000 2                  ANQ     22
         1 000770   000000 676100                    ERQ     0,,PR0
         1 000771   001777 376007                    ANQ     1023,DL
         1 000772   000000 656100                    ERSQ    0,,PR0

     1278     4415    2              NI$IMXMBX.SIZE(%IMX_TDBUF_BASE)=N$REQ.LPWX.BOUND-1;

   4415  1 000773   200026 471500                    LDP1    REQ$,,AUTO
         1 000774   100011 721100                    LXL1    9,,PR1
         1 000775   777777 622011                    EAX2    -1,X1
         1 000776   000004 742100                    STX2    4,,PR0

     1279     4416    2              PNTR$=ADDR(NI$REQ.DCW(0));

   4416  1 000777   200017 236100                    LDQ     IOS$,,AUTO
         1 001000   000002 036003                    ADLQ    2,DU
         1 001001   200024 756100                    STQ     PNTR$,,AUTO

     1280     4417    2              NI$IMXMBX.LPW.DCW_ADDR=PNTR.WA;

   4417  1 001002   200024 221100                    LDX1    PNTR$,,AUTO
         1 001003   000007 741100                    STX1    7,,PR0

PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:242  
     1281     4418    3              DO CASE (ADDR(TDIOV.PCW)->PCW_B.MASK);

   4418  1 001004   000000 471400 xsym               LDP1    B$PS0$
         1 001005   100001 236100                    LDQ     1,,PR1
         1 001006   000014 772000                    QRL     12
         1 001007   000007 376007                    ANQ     7,DL
         1 001010   000004 136007                    SBLQ    4,DL
         1 001011   000004 116007                    CMPQ    4,DL
         1 001012   001014 602006 1                  TNC     s:4418+8,QL
         1 001013   001061 710000 1                  TRA     s:4436
         1 001014   001020 710000 1                  TRA     s:4420
         1 001015   001034 710000 1                  TRA     s:4427
         1 001016   001034 710000 1                  TRA     s:4427
         1 001017   001026 710000 1                  TRA     s:4423

     1282     4419    3               CASE(4);

     1283     4420    3                 N$REQ.IMX_TDIO_MASK='1'B;

   4420  1 001020   200026 473500                    LDP3    REQ$,,AUTO
         1 001021   020000 236007                    LDQ     8192,DL
         1 001022   300031 256100                    ORSQ    25,,PR3

     1284     4421    3                 NI$IMXMBX.IOSTATUS(0)=%IMX_CCW_MASK_CHAN;

   4421  1 001023   000003 236000 0                  LDQ     3
         1 001024   000010 756100                    STQ     8,,PR0
         1 001025   001061 710000 1                  TRA     s:4436

     1285     4422    3               CASE(7);

     1286     4423    3                 N$REQ.IMX_TDIO_MASK='1'B;

   4423  1 001026   200026 473500                    LDP3    REQ$,,AUTO
         1 001027   020000 236007                    LDQ     8192,DL
         1 001030   300031 256100                    ORSQ    25,,PR3

PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:243  
     1287     4424    3                 NI$IMXMBX.IOSTATUS(0)=%IMX_CCW_RSO;

   4424  1 001031   000004 236000 0                  LDQ     4
         1 001032   000010 756100                    STQ     8,,PR0
         1 001033   001061 710000 1                  TRA     s:4436

     1288     4425    3               CASE(ELSE);

     1289     4426    3               END;

     1290     4427    2              END;

   4427  1 001034   001061 710000 1                  TRA     s:4436

     1291     4428    2           ELSE DO;

     1292     4429    2              NI$REQ.PCW=TDIOV.PCW;

   4429  1 001035   000000 470400 xsym               LDP0    B$PS0$
         1 001036   000001 235100                    LDA     1,,PR0
         1 001037   000000 236003                    LDQ     0,DU
         1 001040   200017 471500                    LDP1    IOS$,,AUTO
         1 001041   100012 757100                    STAQ    10,,PR1

     1293     4430    2              NI$REQ.PCW.FLAGS='600'O;

   4430  1 001042   200017 471500                    LDP1    IOS$,,AUTO
         1 001043   000600 236007                    LDQ     384,DL
         1 001044   100013 552104                    STBQ    11,'04'O,PR1

     1294     4431    2              IF HW_IOP THEN

   4431  1 001045   000000 234000 xsym               SZN     HW_IOP
         1 001046   001055 605000 1                  TPL     s:4434

     1295     4432    2                 NI$REQ.IOP_PTAW=BINBIT(BUFPTP,27)|%IOP_PTA1_INIT; /* PHYSADDR   */

PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:244  
   4432  1 001047   200004 236100                    LDQ     BUFPTP,,AUTO
         1 001050   000011 736000                    QLS     9
         1 001051   000005 276000 0                  ORQ     5
         1 001052   200017 471500                    LDP1    IOS$,,AUTO
         1 001053   100001 756100                    STQ     1,,PR1
         1 001054   001061 710000 1                  TRA     s:4436

     1296     4433    2              ELSE
     1297     4434    2                 NI$REQ.PCW.PTP=BUFPTP;

   4434  1 001055   200017 471500                    LDP1    IOS$,,AUTO
         1 001056   200004 236100                    LDQ     BUFPTP,,AUTO
         1 001057   000011 736000                    QLS     9
         1 001060   100013 552130                    STBQ    11,'30'O,PR1

     1298     4435    2              END;

     1299     4436    1           N$REQ.USER#=B$JIT.USER;

   4436  1 001061   000000 470400 xsym               LDP0    B$JIT$
         1 001062   200026 471500                    LDP1    REQ$,,AUTO
         1 001063   000000 236100                    LDQ     0,,PR0
         1 001064   000022 772000                    QRL     18
         1 001065   100027 552104                    STBQ    23,'04'O,PR1

     1300     4437    1           N$REQ.OPFLG.WAIT=TDIOV.WAIT;

   4437  1 001066   000000 473400 xsym               LDP3    B$PS0$
         1 001067   300000 236100                    LDQ     0,,PR3
         1 001070   000015 772000                    QRL     13
         1 001071   100004 676100                    ERQ     4,,PR1
         1 001072   000020 376007                    ANQ     16,DL
         1 001073   100004 656100                    ERSQ    4,,PR1

     1301     4438    1           N$REQ.NWIO=0;

   4438  1 001074   200026 471500                    LDP1    REQ$,,AUTO
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:245  
         1 001075   000027 236000 2                  LDQ     23
         1 001076   100031 356100                    ANSQ    25,,PR1

     1302     4439    1           N$REQ.DCB$=DCB$;

   4439  1 001077   200006 236100                    LDQ     DCB$,,AUTO
         1 001100   100022 756100                    STQ     18,,PR1

     1303     4440    1           N$REQ.DQH$=DCB.DQH$;

   4440  1 001101   200006 471500                    LDP1    DCB$,,AUTO
         1 001102   100046 236100                    LDQ     38,,PR1
         1 001103   200026 474500                    LDP4    REQ$,,AUTO
         1 001104   400020 756100                    STQ     16,,PR4

     1304     4441    1           N$REQ.EVNTINFO=TDIOV.EVENT;

   4441  1 001105   300002 235100                    LDA     2,,PR3
         1 001106   200026 474500                    LDP4    REQ$,,AUTO
         1 001107   400026 755100                    STA     22,,PR4

     1305     4442    1           N$REQ.TIMOUT=TDIOV.TIMEOUT;

   4442  1 001110   200026 474500                    LDP4    REQ$,,AUTO
         1 001111   300003 236100                    LDQ     3,,PR3
         1 001112   770000 376003                    ANQ     -4096,DU
         1 001113   000014 772000                    QRL     12
         1 001114   400003 552120                    STBQ    3,'20'O,PR4

     1306     4443    1           N$REQ.IOFLG.MREC='1'B;

   4443  1 001115   200026 474500                    LDP4    REQ$,,AUTO
         1 001116   010000 236007                    LDQ     4096,DL
         1 001117   400004 256100                    ORSQ    4,,PR4

     1307     4444    1           N$REQ.BUF$=B$PS2$;              /* FOR DEBUG PURPOSES ONLY            */

PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:246  
   4444  1 001120   000000 236000 xsym               LDQ     B$PS2$
         1 001121   200026 474500                    LDP4    REQ$,,AUTO
         1 001122   400005 756100                    STQ     5,,PR4

     1308     4445        /* CALL THE APPROPRIATE DEVICE SCHEDULER TO GET THE I/O STARTED */
     1309     4446    1           EXTRN=N$REQ.DCT$->NI$DCT.DVT$->NI$DVT.SCHED;

   4446  1 001123   200026 474500                    LDP4    REQ$,,AUTO
         1 001124   400002 475500                    LDP5    2,,PR4
         1 001125   500024 476500                    LDP6    20,,PR5
         1 001126   600000 236100                    LDQ     0,,PR6
         1 001127   200015 756100                    STQ     EXTRN,,AUTO

     1310     4447    1           N$REQ.IOQFLG.IOQUED = '1'B ;

   4447  1 001130   200000 236003                    LDQ     65536,DU
         1 001131   400033 256100                    ORSQ    27,,PR4

     1311     4448    1           CALL EXTRN(N$REQ);

   4448  1 001132   200026 630500                    EPPR0   REQ$,,AUTO
         1 001133   200015 220100                    LDX0    EXTRN,,AUTO
         1 001134   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001135   000000 701010                    TSX1    0,X0
         1 001136   000000 011000                    NOP     0

     1312     4449    1           IF TDIOV.WAIT THEN CALL FMB$IOSPIN;

   4449  1 001137   000000 470400 xsym               LDP0    B$PS0$
         1 001140   000000 236100                    LDQ     0,,PR0
         1 001141   400000 316007                    CANQ    -131072,DL
         1 001142   001146 600000 1                  TZE     s:4450

   4449  1 001143   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001144   000000 701000 xent               TSX1    FMB$IOSPIN
         1 001145   000000 011000                    NOP     0

PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:247  
     1313     4450    1           RETURN;

   4450  1 001146   000000 702200 xent               TSX2  ! X66_ARET

     1314     4451        /**/
     1315     4452    1   BADRET: PROC(ERROR,SEV);

   4452  1 001147   200032 741300       BADRET       STX1  ! WRITE_FLG+1,,AUTO

     1316     4453    2   DCL ERROR UBIN WORD;
     1317     4454    2   DCL SEV UBIN WORD;
     1318     4455    2           B$JIT.ERR='240420000000'O;

   4455  1 001150   000006 236000 0                  LDQ     6
         1 001151   000000 470400 xsym               LDP0    B$JIT$
         1 001152   000012 756100                    STQ     10,,PR0

     1319     4456    2           B$JIT.ERR.CODE=ERROR;

   4456  1 001153   200033 471500                    LDP1    @ERROR,,AUTO
         1 001154   100000 236100                    LDQ     0,,PR1
         1 001155   000003 736000                    QLS     3
         1 001156   000012 676100                    ERQ     10,,PR0
         1 001157   377770 376007                    ANQ     131064,DL
         1 001160   000012 656100                    ERSQ    10,,PR0

     1320     4457    2           B$JIT.ERR.SEV=SEV;

   4457  1 001161   200034 473500                    LDP3    @SEV,,AUTO
         1 001162   300000 236100                    LDQ     0,,PR3
         1 001163   000012 676100                    ERQ     10,,PR0
         1 001164   000007 376007                    ANQ     7,DL
         1 001165   000012 656100                    ERSQ    10,,PR0

     1321     4458    2           CALL UDB$PMMEXIT;

   4458  1 001166   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:248  
         1 001167   000000 701000 xent               TSX1    UDB$PMMEXIT
         1 001170   000000 011000                    NOP     0

     1322     4459    2   END BADRET;

   4459  1 001171   200032 221300                    LDX1  ! WRITE_FLG+1,,AUTO
         1 001172   000001 702211                    TSX2  ! 1,X1

(unnamed)
 Sect OctLoc
   0     000   000000 700000   000000 020000   000000 020005   604000 000000    ................
   0     004   630000 000000   000000 000100   240420 000000                    .......@....

(unnamed)
 Sect OctLoc
   2     000   000000 001615   000006 006000   000000 006000   000000 001616    ................
   2     004   000003 006000   000007 430000   000001 200000   000000 001632    ................
   2     010   000007 006000   000002 006000   000000 006000   777747 777777    ................
   2     014   000000 001621   000014 006000   777777 777477   000005 006000    ................
   2     020   000000 006000   777777 777757   000000 006000   777777 600777    ................
   2     024   000000 006000   777777 776000   000001 777776   777777 377777    ................
     1323     4460    1   END TDP$TDIO;
     1324     4461        %EOD;

PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:249  
--  Include file information  --

   TD_ERRORS_C.:E05TOU  is referenced.
   TD$CP6V_C.:E05TOU  is referenced.
   S_WSPTD_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   M_INFO_C.:E05TOU  is referenced.
   IT_SUBS_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure TDP$TDIO.
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:250  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    33-0-0/w PTR         r     1 @ERROR                    34-0-0/w PTR         r     1 @SEV
     3-0-0/w UBIN        r     1 BUFADDR                    4-0-0/w SBIN        r     1 BUFPTP
     3-0-0/w STRC        r     1 BUFVIRT                    5-0-0/w BIT         r     1 CONT_FLG
     6-0-0/w PTR         r     1 DCB$                       7-0-0/w STRC        r     1 DCPCW
    10-0-0/w PTR         r     1 DCT$                      11-0-0/w PTR         r     1 DCW$
    12-0-0/w UBIN        r     1 DCWADDR                   13-0-0/w SBIN        r     1 DCWPTP
    12-0-0/w STRC        r     1 DCWVIRT                   14-0-0/w PTR         r     1 DQH$
    *0-0-0/w UBIN        r     1 ERROR                     15-0-0/w EPTR        r     1 EXTRN
    20-0-0/w PTR         r     1 FEI$                      16-0-0/w SBIN        r     1 I
    17-0-0/w PTR         r     1 IOS$                      21-0-0/w PTR         r     1 MBX$
    22-0-0/w PTR         r     1 MPC$                      23-0-0/w STRC(18)    r     1 PATH
    24-0-0/w STRC        r     1 PNTR                      24-0-0/w PTR         r     1 PNTR$
    25-0-0/w BIT         r     1 RELEASE                   26-0-0/w PTR         r     1 REQ$
    *0-0-0/w UBIN        r     1 SEV                       27-0-0/w PTR         r     1 SQH$
    30-0-0/w BIT         r     1 SUSPEND                   31-0-0/w BIT         r     1 WRITE_FLG

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$PS0$
     0-0-0/w PTR         r     1 B$PS1$                     0-0-0/w PTR         r     1 B$PS2$
     0-0-0/w BIT (72)    r     1 F_DCBLOCK                  0-0-0/w BIT         r     1 HW_IMX
     0-0-0/w BIT         r     1 HW_IOP                     0-0-0/w SBIN        r     1 HW_IOPTP_UNITS
     0-0-0/w PTR         r     1 KI_FEI$$                   0-0-0/w PTR         r     1 N$DCT$$
     0-0-0/w PTR         r     1 N$FQ$                      0-0-0/w PTR         r     1 NI$CHT$
     0-0-0/w PTR         r     1 NI$FQ$                     0-0-0/w PTR         r     1 NI$IBUF$
     0-0-0/d STRC(864)   r     1 NI$IMXMBX_INIT             0-0-0/d STRC(504)   r     1 NI$REQ_INIT
     0-0-0/w PTR         r     1 NI$RP$                     0-0-0/w UBIN        r     1 NI_IMXLO_PBASE
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:251  
     0-0-0/w BIT (72)    r     1 NI_MFGATE                  0-0-0/w PTR         r     1 S$CU$
     0-0-0/w SBIN        r     1 SL_MF(0:3)

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d STRC(576)   r     1 B$U
     0-0-0/w STRC        r     1 DCW                        0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/d STRC(144)   r     1 FPT$TDIO_V                 0-0-0/w STRC        r     1 IDCW
     0-0-0/w STRC(612)   r     1 KI$FEI
     0-0-0/w PTR         r     1 KI$FEI$(0:0)
     0-0-0/d STRC(1080)  r     1 N$REQ                      0-0-0/w STRC(72)    r     1 NI$CHT(0:0)
     0-0-0/w STRC(1332)  r     1 NI$DCT                     0-0-0/w STRC(648)   r     1 NI$DQH
     0-0-0/w STRC(2844)  r     1 NI$DVT                     0-0-0/d STRC(864)   r     1 NI$IMXMBX
     0-0-0/d STRC(504)   r     1 NI$REQ                     0-0-0/b STRC        r     1 PCW_B


   Procedure TDP$TDIO requires 635 words for executable code.
   Procedure TDP$TDIO requires 36 words of local(AUTO) storage.
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:252  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:253  
          MINI XREF LISTING

ALTBAD
      4282**LABEL    4280--CALLALT
B$DO.ECCINFO
       765**DCL       766--REDEF
B$JIT.CPFLAGS1.SLEAZE
       432**DCL       432--REDEF
B$JIT.DCB$
       506**DCL      4264>>ASSIGN
B$JIT.ERR
       338**DCL      4455<<ASSIGN
B$JIT.ERR.CODE
       339**DCL      4456<<ASSIGN
B$JIT.ERR.MID
       339**DCL       339--REDEF
B$JIT.ERR.SEV
       339**DCL      4457<<ASSIGN
B$JIT.JRESPEAK
       500**DCL       501--REDEF
B$JIT.MODE
       333**DCL      4337>>IF
B$JIT.ORIGINATOR_PORT.FROM_CR
       609**DCL       609--REDEF     610--REDEF
B$JIT.PNR
       513**DCL       513--REDEF
B$JIT.TSLINE
       607**DCL       608--REDEF
B$JIT.USER
       338**DCL      4436>>ASSIGN
B$JIT$
      3848**DCL       333--IMP-PTR  4264>>ASSIGN   4337>>IF       4436>>ASSIGN   4455>>ASSIGN   4456>>ASSIGN
      4457>>ASSIGN
B$PS0$
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:254  
      3849**DCL      4268>>ASSIGN   4274>>IF       4277>>ASSIGN   4278>>ASSIGN   4285>>ASSIGN   4418>>DOCASE
      4429>>ASSIGN   4437>>ASSIGN   4441>>ASSIGN   4442>>ASSIGN   4449>>IF
B$PS1$
      3850**DCL      4296<>CALL     4297>>ASSIGN   4384<>CALL     4388<>CALL
B$PS2$
      3851**DCL      4329>>ASSIGN   4378<>CALL     4407<>CALL     4444>>ASSIGN
B$U.MF
       720**DCL      4337>>IF       4342<<ASSIGN   4342>>ASSIGN
B$U.MISC
       744**DCL       745--REDEF
B$USER.MISC
       820**DCL       821--REDEF
BADRET
      4452**PROC     4265--CALL     4266--CALL     4276--CALL     4282--CALL     4284--CALL     4312--CALL
BUFADDR
      3861**DCL      3862--REDEF    4378<>CALL     4399<<ASSIGN   4399>>ASSIGN   4406>>ASSIGN
BUFPTP
      3865**DCL      4378<>CALL     4381>>ASSIGN   4394>>IF       4395>>ASSIGN   4396>>ASSIGN   4398>>IF
      4399>>ASSIGN   4400<<ASSIGN   4409>>ASSIGN   4413>>ASSIGN   4432>>ASSIGN   4434>>ASSIGN
BUFVIRT.BYT
      3864**DCL      4408>>ASSIGN
CONT_FLG
      3866**DCL      4292<<ASSIGN   4298>>DOWHILE  4304<<ASSIGN   4332>>IF       4379>>IF
DCB$
      3867**DCL      4264<<ASSIGN   4265>>IF       4266>>IF       4267>>IF       4269>>ASSIGN   4270>>CALL
      4271>>ASSIGN   4271>>ASSIGN   4275>>IF       4279>>ASSIGN   4281>>IF       4284>>IF       4285>>ASSIGN
      4288>>ASSIGN   4288>>ASSIGN   4289>>ASSIGN   4289>>ASSIGN   4291>>ASSIGN   4291>>ASSIGN   4291>>ASSIGN
      4301>>ASSIGN   4305>>IF       4346>>ASSIGN   4350>>ASSIGN   4350>>ASSIGN   4372>>ASSIGN   4373>>ASSIGN
      4439>>ASSIGN   4440>>ASSIGN
DCPCW
      3868**DCL      4268<<ASSIGN
DCPCW.MASK
      3871**DCL      4270<>CALL
DCT$
      3873**DCL      4280<>CALL     4284>>IF
DCW.FWA
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:255  
      3913**DCL      4329>>ASSIGN
DCW.T.DCWLIST.BASE
      3921**DCL      4328<<ASSIGN
DCW.TALLY
      3916**DCL      3917--REDEF
DCW.TYPE
      3915**DCL      4325>>DOCASE
DCW$
      3874**DCL      3909--IMP-PTR  3943--IMP-PTR  4297<<ASSIGN   4299>>IF       4300>>IF       4301>>ASSIGN
      4303>>ASSIGN   4304>>ASSIGN   4306>>DOCASE   4314>>IF       4315>>IF       4319>>IF       4325>>DOCASE
      4328>>ASSIGN   4329<<ASSIGN   4329>>ASSIGN   4333<<ASSIGN   4333>>ASSIGN
DCWADDR
      3875**DCL      3876--REDEF    4384<>CALL     4390>>ASSIGN   4395<<ASSIGN   4395>>ASSIGN   4403>>ASSIGN
DCWPTP
      3879**DCL      4381<<ASSIGN   4384<>CALL     4389>>ASSIGN   4394>>IF       4395>>ASSIGN   4396<<ASSIGN
      4398>>IF       4399>>ASSIGN   4400>>ASSIGN
DCWVIRT.BYT
      3878**DCL      4391>>ASSIGN
DQH$
      3880**DCL      4280<>CALL
ERROR IN PROCEDURE BADRET
      4453**DCL      4452--PROC     4456>>ASSIGN
EXTRN
      3881**DCL      4446<<ASSIGN   4448>>CALL
F$DCB.ACTPOS
      1525**DCL      1525--REDEF
F$DCB.ARS
      1500**DCL      1500--REDEF
F$DCB.ASN
      1515**DCL      4266>>IF
F$DCB.ATTR
      1518**DCL      1519--REDEF
F$DCB.BORROW
      1533**DCL      1533--REDEF    1533--REDEF    1533--REDEF
F$DCB.CONNCT
      1519**DCL      4271<<ASSIGN   4271>>ASSIGN
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:256  
F$DCB.DCBNAME.L
      1547**DCL      1547--IMP-SIZ
F$DCB.DCT$
      1522**DCL      4284>>IF       4372>>ASSIGN   4373>>ASSIGN
F$DCB.DEVADR.CHAN
      1523**DCL      4289>>ASSIGN
F$DCB.DEVADR.DVN
      1522**DCL      4269>>ASSIGN   4279>>ASSIGN   4301>>ASSIGN
F$DCB.DEVADR.IOM
      1523**DCL      4288>>ASSIGN
F$DCB.DQH$
      1521**DCL      4270>>CALL     4291<<ASSIGN   4440>>ASSIGN
F$DCB.EOMCHAR
      1504**DCL      1504--REDEF
F$DCB.FCD
      1513**DCL      4265>>IF
F$DCB.FCN.CNT
      1537**DCL      4350<<ASSIGN   4350>>ASSIGN
F$DCB.FLDID
      1528**DCL      1528--REDEF
F$DCB.FORM$
      1522**DCL      1522--REDEF
F$DCB.FSECT
      1538**DCL      1538--REDEF
F$DCB.FSN
      1515**DCL      1515--REDEF    1515--REDEF    1516--REDEF
F$DCB.FUN
      1514**DCL      4267>>IF       4275>>IF
F$DCB.HEADER$
      1521**DCL      1521--REDEF
F$DCB.IXTNSIZE
      1519**DCL      1519--REDEF
F$DCB.LASTSTA$
      1509**DCL      1509--REDEF
F$DCB.LVL
      1534**DCL      1534--REDEF
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:257  
F$DCB.MPC$
      1522**DCL      4281>>IF
F$DCB.NAME.C
      1509**DCL      1509--REDEF
F$DCB.NOEOF
      1530**DCL      1530--REDEF
F$DCB.NRECS
      1520**DCL      1520--REDEF
F$DCB.NRECX
      1539**DCL      1539--REDEF
F$DCB.OHDR
      1531**DCL      1531--REDEF
F$DCB.ORG
      1514**DCL      1514--REDEF
F$DCB.PATH
      1527**DCL      4285<<ASSIGN
F$DCB.PATH.CHAN
      1527**DCL      4289<<ASSIGN   4291>>ASSIGN
F$DCB.PATH.IOM
      1527**DCL      4288<<ASSIGN   4291>>ASSIGN
F$DCB.PRECNO
      1537**DCL      1537--REDEF
F$DCB.RCSZ
      1542**DCL      1542--REDEF
F$DCB.RES
      1510**DCL      1510--REDEF
F$DCB.SETX
      1522**DCL      1522--REDEF
F$DCB.TAB$
      1521**DCL      1522--REDEF
F$DCB.TDA
      1536**DCL      1536--REDEF
F$DCB.TDFLG.SDSK
      1519**DCL      4305>>IF
F$DCB.WAIT
      1532**DCL      4346<<ASSIGN
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:258  
F$DCB.WSN
      1511**DCL      1511--REDEF
FEI$
      3884**DCL      3983--IMP-PTR  4269<<ASSIGN   4270>>CALL
FMB$IOSPIN
      3834**DCL-ENT  4449--CALL
FPT$TDIO_V.ALTPATH
      3935**DCL      4274>>IF       4285>>ASSIGN
FPT$TDIO_V.ALTPATH.CHAN
      3935**DCL      4278>>ASSIGN
FPT$TDIO_V.ALTPATH.IOM
      3935**DCL      4277>>ASSIGN
FPT$TDIO_V.EVENT
      3936**DCL      4441>>ASSIGN
FPT$TDIO_V.PCW
      3935**DCL      4268>>ASSIGN   4418--DOCASE   4429>>ASSIGN
FPT$TDIO_V.TIMEOUT
      3936**DCL      4442>>ASSIGN
FPT$TDIO_V.WAIT
      3935**DCL      4437>>ASSIGN   4449>>IF
F_DCBLOCK
      3856**DCL      4348<>CALL     4352<>CALL
HFC$LOCK
      1604**DCL-ENT  4340--CALL     4348--CALL
HFC$UNLOCK
      1604**DCL-ENT  4344--CALL     4352--CALL
HFF$DSIZ
      3835**DCL-ENT  4388--CALL     4407--CALL
HFF$NILERASE
      3836**DCL-ENT  4296--CALL
HW_IMX
      1590**DCL      4302>>IF       4327>>IF       4360>>IF       4367>>IF       4385>>IF       4410>>IF
HW_IOP
      1587**DCL      4431>>IF
HW_IOPTP_UNITS
      1585**DCL      4395>>ASSIGN   4399>>ASSIGN
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:259  
I
      3882**DCL      4388<>CALL     4391>>ASSIGN   4407<>CALL     4408>>ASSIGN
IDCW.CC
      3958**DCL      3959--REDEF
IDCW.CCB
      3959**DCL      4314>>IF
IDCW.CONT
      3956**DCL      4304>>ASSIGN
IDCW.DATA.BASE
      3952**DCL      4303<<ASSIGN
IDCW.DC
      3947**DCL      4306>>DOCASE   4315>>IF       4319>>IF
IDCW.DVN
      3948**DCL      4300>>IF       4301<<ASSIGN
IDCW.EXTA
      3949**DCL      3950--REDEF
IDCW.SVN
      3954**DCL      4299>>IF
IOS$
      3883**DCL      4223--IMP-PTR  4358<<ASSIGN   4359>>ASSIGN   4361>>ASSIGN   4366<>CALL     4368>>ASSIGN
      4369>>ASSIGN   4380>>ASSIGN   4386>>ASSIGN   4387>>ASSIGN   4402>>ASSIGN   4403>>ASSIGN   4416>>ASSIGN
      4429>>ASSIGN   4430>>ASSIGN   4432>>ASSIGN   4434>>ASSIGN
KI$FEI.BD$
      4018**DCL      4019--REDEF
KI$FEI.BDAD.WADDR
      4020**DCL      4021--REDEF
KI$FEI.FEWSQ
      4011**DCL      4270<>CALL
KI$FEI.RCVPB
      4034**DCL      4035--REDEF
KI$FEI$
      2024**DCL      4269>>ASSIGN
KI_FEI$$
      2023**DCL      2024--IMP-PTR  4269>>ASSIGN
MBX$
      3885**DCL      4202--IMP-PTR  4361<<ASSIGN   4362>>ASSIGN   4368<<ASSIGN   4389>>ASSIGN   4390>>ASSIGN
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:260  
      4391>>ASSIGN   4411>>ASSIGN   4412>>ASSIGN   4413>>ASSIGN   4414>>ASSIGN   4415>>ASSIGN   4417>>ASSIGN
      4421>>ASSIGN   4424>>ASSIGN
MPC$
      3886**DCL      4280<>CALL     4281>>IF
N$DCT$$
      2944**DCL      3078--IMP-PTR
N$FQ$
      2944**DCL      3079--IMP-PTR
N$REQ
      4063**DCL      4448<>CALL
N$REQ.BPMIR
      4108**DCL      4377<<ASSIGN
N$REQ.BUF$
      4072**DCL      4444<<ASSIGN
N$REQ.BUFADDR
      4072**DCL      4073--REDEF    4073--REDEF
N$REQ.COMP
      4097**DCL      4374<<ASSIGN
N$REQ.DCB$
      4094**DCL      4439<<ASSIGN
N$REQ.DCT$
      4064**DCL      4372<<ASSIGN   4446>>ASSIGN
N$REQ.DLA.DCTX
      4063**DCL      4373<<ASSIGN
N$REQ.DLA.DRELADDR
      4064**DCL      4064--REDEF
N$REQ.DQH$
      4085**DCL      4440<<ASSIGN
N$REQ.DVE.EOMCHAR
      4101**DCL      4102--REDEF
N$REQ.EAINFO
      4095**DCL      4095--REDEF
N$REQ.EAINFOX
      4095**DCL      4096--REDEF
N$REQ.EVNTINFO
      4096**DCL      4096--REDEF    4441<<ASSIGN
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:261  
N$REQ.IMX_TDIO_MASK
      4103**DCL      4420<<ASSIGN   4423<<ASSIGN
N$REQ.IOFLG.IOS
      4067**DCL      4357>>IF       4370<<ASSIGN
N$REQ.IOFLG.MREC
      4068**DCL      4443<<ASSIGN
N$REQ.IOFLG.REL
      4068**DCL      4376<<ASSIGN
N$REQ.IOFLG.SUSP
      4068**DCL      4375<<ASSIGN
N$REQ.IOQFLG.IOQUED
      4106**DCL      4447<<ASSIGN
N$REQ.IOS$
      4076**DCL      4358>>ASSIGN   4369<<ASSIGN
N$REQ.LPWX.BASE
      4075**DCL      4406<<ASSIGN   4414>>ASSIGN
N$REQ.LPWX.BOUND
      4075**DCL      4408<<ASSIGN   4415>>ASSIGN
N$REQ.NWIO
      4102**DCL      4438<<ASSIGN
N$REQ.OPFLG.WAIT
      4070**DCL      4437<<ASSIGN
N$REQ.PTP
      4074**DCL      4409<<ASSIGN
N$REQ.STATUS
      4077**DCL      4083--REDEF
N$REQ.TIMOUT
      4065**DCL      4442<<ASSIGN
N$REQ.USER#
      4097**DCL      4436<<ASSIGN
N$REQ_INIT.BUFADDR
      2963**DCL      2964--REDEF    2964--REDEF
N$REQ_INIT.DLA.DRELADDR
      2955**DCL      2955--REDEF
N$REQ_INIT.DVE.EOMCHAR
      2992**DCL      2993--REDEF
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:262  
N$REQ_INIT.EAINFO
      2986**DCL      2986--REDEF
N$REQ_INIT.EAINFOX
      2986**DCL      2987--REDEF
N$REQ_INIT.EVNTINFO
      2987**DCL      2987--REDEF
N$REQ_INIT.STATUS
      2968**DCL      2974--REDEF
NI$CHT.DQH$
      4113**DCL      4291>>ASSIGN
NI$CHT$
      3003**DCL      4113--IMP-PTR  4291>>ASSIGN
NI$DCT.DCTX
      4125**DCL      4373>>ASSIGN
NI$DCT.DP
      4144**DCL      4151--REDEF    4154--REDEF    4155--REDEF    4157--REDEF    4157--REDEF    4158--REDEF
      4159--REDEF    4159--REDEF
NI$DCT.DVT$
      4140**DCL      4446>>ASSIGN
NI$DCT.MPC.IOCHANX
      4152**DCL      4152--REDEF
NI$DQH.IOCHAN
      4175**DCL      4270<>CALL
NI$DQH.IOCHANX
      4174**DCL      4175--REDEF
NI$DQH.MBX$
      4183**DCL      4184--REDEF
NI$DVT.MPC
      4189**DCL      4190--REDEF
NI$DVT.SCHED
      4187**DCL      4446>>ASSIGN
NI$FQ$
      3004**DCL      3080--IMP-PTR
NI$IBUF$
      3004**DCL      3080--IMP-PTR
NI$IMXMBX
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:263  
      4202**DCL      4362<<ASSIGN
NI$IMXMBX.IOSTATUS
      4212**DCL      4421<<ASSIGN   4424<<ASSIGN
NI$IMXMBX.LPW.DCW_ADDR
      4208**DCL      4417<<ASSIGN
NI$IMXMBX.PAGED_BASE
      4202**DCL      4203--REDEF    4203--REDEF    4411<<ASSIGN
NI$IMXMBX.PAGED_BASE.OFFSET
      4202**DCL      4390<<ASSIGN   4414<<ASSIGN
NI$IMXMBX.PAGED_BASE.PTWADDR
      4202**DCL      4389<<ASSIGN   4413<<ASSIGN
NI$IMXMBX.SIZE
      4204**DCL      4204--REDEF    4391<<ASSIGN   4412<<ASSIGN   4415<<ASSIGN
NI$IMXMBX_INIT
      3014**DCL      4362>>ASSIGN
NI$IMXMBX_INIT.PAGED_BASE
      3014**DCL      3015--REDEF    3015--REDEF
NI$IMXMBX_INIT.SIZE
      3016**DCL      3016--REDEF
NI$REQ
      4223**DCL      4359<<ASSIGN
NI$REQ.DCW
      4225**DCL      4228--REDEF    4386<<ASSIGN   4402<<ASSIGN   4416--ASSIGN
NI$REQ.DCW.FWA
      4225**DCL      4403<<ASSIGN
NI$REQ.DCW.T.DCWLIST.BASE
      4227**DCL      4387<<ASSIGN
NI$REQ.DCW.TALLY
      4226**DCL      4226--REDEF
NI$REQ.IDCW
      4228**DCL      4380<<ASSIGN
NI$REQ.IDCW.EXTA
      4228**DCL      4228--REDEF
NI$REQ.IOP_PTAW
      4223**DCL      4432<<ASSIGN
NI$REQ.PCW
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:264  
      4230**DCL      4234--REDEF    4429<<ASSIGN
NI$REQ.PCW.FLAGS
      4234**DCL      4430<<ASSIGN
NI$REQ.PCW.PTP
      4234**DCL      4434<<ASSIGN
NI$REQ.SEEK
      4235**DCL      4236--REDEF    4237--REDEF
NI$REQ_INIT
      3036**DCL      4359>>ASSIGN
NI$REQ_INIT.DCW
      3038**DCL      3041--REDEF
NI$REQ_INIT.DCW.TALLY
      3039**DCL      3039--REDEF
NI$REQ_INIT.IDCW.EXTA
      3041**DCL      3041--REDEF
NI$REQ_INIT.PCW
      3043**DCL      3047--REDEF
NI$REQ_INIT.SEEK
      3048**DCL      3049--REDEF    3050--REDEF
NI$RP$
      3052**DCL      3082--IMP-PTR
NI$SQH.DOOR
      4248**DCL      4248--REDEF
NIM$CVTPTR
      3837**DCL-ENT  4378--CALL     4384--CALL
NIQ$GET
      3838**DCL-ENT  4356--CALL
NIQ$GETS
      3839**DCL-ENT  4366--CALL
NIS$DCCON
      3840**DCL-ENT  4270--CALL
NI_IMXLO_PBASE
      3054**DCL      4411>>ASSIGN
NI_MBX_INIT.DCW.CONTROL.AE
      3074**DCL      3074--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:265  
      3070**DCL      3070--REDEF
NI_MFGATE
      3077**DCL      4340<>CALL     4344<>CALL
NO_DCW_LIST
      4330**LABEL    4296--CALLALT
PATH
      3887**DCL      4280<>CALL
PATH.CHAN
      3890**DCL      4278<<ASSIGN
PATH.DVN
      3888**DCL      4279<<ASSIGN
PATH.IOM
      3889**DCL      4277<<ASSIGN
PCW_B.MASK
      4255**DCL      4418>>DOCASE
PNTR.WA
      3893**DCL      4417>>ASSIGN
PNTR$
      3891**DCL      3892--REDEF    4416<<ASSIGN
RELEASE
      3895**DCL      4295<<ASSIGN   4317<<ASSIGN   4320<<ASSIGN   4376>>ASSIGN
REQ$
      3896**DCL      4063--IMP-PTR  4356<>CALL     4357>>IF       4358>>ASSIGN   4369>>ASSIGN   4370>>ASSIGN
      4372>>ASSIGN   4373>>ASSIGN   4374>>ASSIGN   4375>>ASSIGN   4376>>ASSIGN   4377>>ASSIGN   4406>>ASSIGN
      4408>>ASSIGN   4409>>ASSIGN   4414>>ASSIGN   4415>>ASSIGN   4420>>ASSIGN   4423>>ASSIGN   4436>>ASSIGN
      4437>>ASSIGN   4438>>ASSIGN   4439>>ASSIGN   4440>>ASSIGN   4441>>ASSIGN   4442>>ASSIGN   4443>>ASSIGN
      4444>>ASSIGN   4446>>ASSIGN   4447>>ASSIGN   4448>>CALL
S$CU$
      3853**DCL      4337>>IF       4342>>ASSIGN   4342>>ASSIGN
SEV IN PROCEDURE BADRET
      4454**DCL      4452--PROC     4457>>ASSIGN
SL_MF
      3857**DCL      4337>>IF
SQH$
      3897**DCL      4280<>CALL
SSR$REG
PL6.E3A0      #004=TDP$TDIO File=TDP$PMME.:E05TSI                                WED 07/30/97 06:06 Page:266  
      3842**DCL-ENT  4338--CALL
SUSPEND
      3898**DCL      4294<<ASSIGN   4316<<ASSIGN   4375>>ASSIGN
TDU$FINDPATH
      3843**DCL-ENT  4280--CALL
UDB$PMMEXIT
      3844**DCL-ENT  4458--CALL
WRITE_FLG
      3899**DCL      4293<<ASSIGN   4308<<ASSIGN   4310<<ASSIGN   4312>>IF

PL6.E3A0      #005=TDP$ERRTEXT File=TDP$PMME.:E05TSI                             WED 07/30/97 06:07 Page:267  
     1325        1        /*T***********************************************************/
     1326        2        /*T*                                                         */
     1327        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1328        4        /*T*                                                         */
     1329        5        /*T***********************************************************/
     1330        6        TDP$ERRTEXT: PROC;
     1331        7        /*E*        ERROR:  TDP-E$ERRTOOBIG-0
     1332        8                  MESSAGE: Entry greater than maximum size of 1000 words.
     1333        9        */
     1334       10        /*E*        ERROR:  TDP-E$TDNOPERM-0
     1335       11                  MESSAGE: Operator refused permission to use T&D services.
     1336       12        */
     1337       13        /*E*        ERROR:  TDP-E$TDNOTEST-0
     1338       14                  MESSAGE: No test was specified in M$TDOPEN fpt
     1339       15        */
     1340       16        /*E*        ERROR:  TDP-E$TDBADDVN-0
     1341       17                  MESSAGE: Device number bad in M$TDOPEN fpt.
     1342       18        */
     1343       19        /*E*        ERROR:  TDP-E$TDMPCBSY-0
     1344       20                  MESSAGE: The requested MPC is not available for T & D.
     1345       21        */
     1346       22        /*E*        ERROR:  TDP-E$BREAK-0
     1347       23                  MESSAGE: Break or control Y received during M$TDOPEN.  Open not performed.
     1348       24        */
     1349       25        /*E*        ERROR:  TDP-E$TDNOTOPEN-0
     1350       26                  MESSAGE: DCB %DC is not open.
     1351       27        */
     1352       28        /*E*        ERROR:  TDP-E$TDNOTDCB-0
     1353       29                  MESSAGE: DCB %DC is not a T&D dcb.
     1354       30        */
     1355       31        /*E*        ERROR:  TDP-E$TDDEVBSY-0
     1356       32                  MESSAGE: The requested device is not available for T&D.
     1357       33        */
     1358       34        /*E*        ERROR:  TDP-E$TDMISC-0
     1359       35                  MESSAGE: T & D feature not yet implemented.
     1360       36        */
     1361       37        /*E*        ERROR:  TDP-E$TDBADIDCW-0
PL6.E3A0      #005=TDP$ERRTEXT File=TDP$PMME.:E05TSI                             WED 07/30/97 06:07 Page:268  
     1362       38                  MESSAGE: T & D DCW list contains an illegal IDCW.
     1363       39                 MESSAGE1: It is illegal to write on other than a diagnostic cylinder of
     1364       40                           a shared disk.
     1365       41        */
     1366       42        /*E*        ERROR:  TDP-E$BADDCB-0
     1367       43                  MESSAGE: M$IOQ DCB %DC open or assigned.
     1368       44        */
     1369       45        /*E*        ERROR:  TDP-E$BADDCWLIST-0
     1370       46                  MESSAGE: M$IOQ bad DCW list.
     1371       47        */
     1372       48        /*E*        ERROR:  TDP-E$BADDLA-0
     1373       49                  MESSAGE: M$IOQ bad Device Logical Address
     1374       50        */
     1375       51        /*E*        ERROR:  TDP-E$BADLFC-0
     1376       52                  MESSAGE: M$IOQ bad Logical Function Code.
     1377       53        */
     1378       54        /*E*        ERROR:  TDP-E$TDALTBAD-0
     1379       55                    MESSAGE: Bad altpath specified on M$TDIO.
     1380       56               MESSAGE1: The altpath specified does not exist or reaches a device other than
     1381       57                              the one the T & D DCB is opened to.
     1382       58        */
     1383       59        /*E*        ERROR:  TDP-E$SCNNOCOMP-0
     1384       60                  MESSAGE: The specified component does not exist.
     1385       61        */
     1386       62        /*E*        ERROR:  TDP-E$SCNNOTDEV-0
     1387       63                  MESSAGE: The specified component is not a device (It is probably an MPC)
     1388       64        */
     1389       65        /*E*        ERROR:  TDP-E$SCNNOTMPC-0
     1390       66                  MESSAGE: The specified component is not an MPC. (It is probably a device)
     1391       67        */
     1392       68        /*E*        ERROR:  TDP-E$SCNNOPATH-0
     1393       69                  MESSAGE: Can't return that device because all paths to it are partitioned.
     1394       70        */
     1395       71        /*E*        ERROR:  TDP-E$ONLYPATH-0
     1396       72                  MESSAGE: Can't partition that component because it is the only path
     1397       73                           to some device that has not been partitioned.
     1398       74        */
PL6.E3A0      #005=TDP$ERRTEXT File=TDP$PMME.:E05TSI                             WED 07/30/97 06:07 Page:269  
     1399       75        /*E*        ERROR:  TDP-E$ONLYSCONS-0
     1400       76                  MESSAGE: Can't partition that system console because it is the only
     1401       77                           console that has not been partitioned.
     1402       78        */
     1403       79        /*E*        ERROR:  TDP-E$IOMDOWN-0
     1404       80                  MESSAGE: Can't return that component because its IOM is partitioned.
     1405       81        */
     1406       82        /*E*        ERROR:  TDP-E$TDOKFORIOM-0
     1407       83                  MESSAGE: Can't specify TDOK for an IOM.
     1408       84        */
     1409       85        /*E*        ERROR:  TDP-E$CHANUP-0
     1410       86                  MESSAGE: Can't partition this IOM because at least one of its
     1411       87                           channels is not partitioned.
     1412       88        */
     1413       89        /*E*        ERROR:  TDP-E$MPCUP-0
     1414       90                  MESSAGE: Can't partition this IOM because it provides the only
     1415       91                           path to an MPC.
     1416       92        */
     1417       93        /*E*        ERROR:  TDP-E$NOPARTRETCHAN-0
     1418       94                  MESSAGE: Can't partition/return channel for FEP or system console;
     1419       95                           partition/return the device.
     1420       96        */
     1421       97        /*E*        ERROR:  TDP-E$SCNNOTFEP-0
     1422       98                  MESSAGE: The specified FEP does not exist
     1423       99        */
     1424      100        /*E*        ERROR:  TDP-E$SCNTDUSER-0
     1425      101                  MESSAGE: Cannot return that component because there is a T & D
     1426      102                           user using it.
     1427      103        */
     1428      104        /*E*       ERROR: TDP-E$CWFORNONDP-0
     1429      105                 MESSAGE: Cannot set CHECKWRITE% for device %U1.%
     1430      106                 MESSAGE1: CHECKWRITE is only legal for disk devices.
     1431      107        */
     1432      108        /*E*       ERROR: TDP-E$REMOTEFEP-0
     1433      109                   MESSAGE: Cannot perform operations on remote FEPs.
     1434      110                   MESSAGE1: Partition, return, or display of remote FEPs
     1435      111                             is not supported in SYSCON.
PL6.E3A0      #005=TDP$ERRTEXT File=TDP$PMME.:E05TSI                             WED 07/30/97 06:07 Page:270  
     1436      112        */
     1437      113        /*E*       ERROR: TDP-E$NOPARTRETFEP-0
     1438      114                   MESSAGE: Currently unable to partition/return that FEP.
     1439      115                   MESSAGE1: The FEP cannot be partitioned/returned because
     1440      116                             it is not in the proper state.
     1441      117        */
     1442      118        /*E*       ERROR: TDP-E$TDMCABUSY-0
     1443      119                   MESSAGE: The requested MCA is not available for T&D.
     1444      120        */
     1445      121        /*E*       ERROR: TDP-E$TDNOTMCA-0
     1446      122                   MESSAGE: The requested device is not an MCA.
     1447      123        */
     1448      124        /*E*       ERROR: TDP-E$TDMCANOTRESERVED-0
     1449      125                   MESSAGE: The requested device is not reserved for use by T&D
     1450      126        */
     1451      127        /*E*       ERROR: TDP-E$TDMCANOTUSER-0
     1452      128                  MESSAGE: The requested device is not reserved for user by T&D by this user
     1453      129        */
     1454      130        /*E*       ERROR: TDP-E$MCAINUSE-0
     1455      131                   MESSAGE: Can't partition or release IOM because MCA is in use
     1456      132        */
     1457      133        /*E*       ERROR: TDP-E$DEVNOTIDLE-0
     1458      134                   MESSAGE: Unable to partition that device - state is not idle
     1459      135                   MESSAGE1: This device cannot be partitioned because it is currently
     1460      136                             waiting for an operator keyin
     1461      137        */
     1462      138        /*E*       ERROR:TDP-E$IOMNOTENABLED-0
     1463      139                   MESSAGE: Can't partition IOM because its SCU port is not enabled
     1464      140        */
     1465      141    1   END TDP$ERRTEXT;

PL6.E3A0      #005=TDP$ERRTEXT File=TDP$PMME.:E05TSI                             WED 07/30/97 06:07 Page:271  
      No diagnostics issued in procedure TDP$ERRTEXT.

   No code generated for procedure TDP$ERRTEXT .
   Procedure TDP$ERRTEXT requires 4 words of local(AUTO) storage.

    No errors detected in file TDP$PMME.:E05TSI    .

PL6.E3A0      #005=TDP$ERRTEXT File=TDP$PMME.:E05TSI                             WED 07/30/97 06:07 Page:272  

 Object Unit name= TDP$ERRTEXT                                File name= TDP$PMME.:E05TOU
 UTS= JUL 30 '97 06:07:08.20 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none     0      0  TDP$ERRTEXT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes     ~proc       0  TDP$ERRTEXT
PL6.E3A0      #005=TDP$ERRTEXT File=TDP$PMME.:E05TSI                             WED 07/30/97 06:07 Page:273  

     1325        1        /*T***********************************************************/
     1326        2        /*T*                                                         */
     1327        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1328        4        /*T*                                                         */
     1329        5        /*T***********************************************************/
     1330        6        TDP$ERRTEXT: PROC;
     1331        7        /*E*        ERROR:  TDP-E$ERRTOOBIG-0
     1332        8                  MESSAGE: Entry greater than maximum size of 1000 words.
     1333        9        */
     1334       10        /*E*        ERROR:  TDP-E$TDNOPERM-0
     1335       11                  MESSAGE: Operator refused permission to use T&D services.
     1336       12        */
     1337       13        /*E*        ERROR:  TDP-E$TDNOTEST-0
     1338       14                  MESSAGE: No test was specified in M$TDOPEN fpt
     1339       15        */
     1340       16        /*E*        ERROR:  TDP-E$TDBADDVN-0
     1341       17                  MESSAGE: Device number bad in M$TDOPEN fpt.
     1342       18        */
     1343       19        /*E*        ERROR:  TDP-E$TDMPCBSY-0
     1344       20                  MESSAGE: The requested MPC is not available for T & D.
     1345       21        */
     1346       22        /*E*        ERROR:  TDP-E$BREAK-0
     1347       23                  MESSAGE: Break or control Y received during M$TDOPEN. Open not performed.
     1348       24        */
     1349       25        /*E*        ERROR:  TDP-E$TDNOTOPEN-0
     1350       26                  MESSAGE: DCB %DC is not open.
     1351       27        */
     1352       28        /*E*        ERROR:  TDP-E$TDNOTDCB-0
     1353       29                  MESSAGE: DCB %DC is not a T&D dcb.
     1354       30        */
     1355       31        /*E*        ERROR:  TDP-E$TDDEVBSY-0
     1356       32                  MESSAGE: The requested device is not available for T&D.
     1357       33        */
     1358       34        /*E*        ERROR:  TDP-E$TDMISC-0
     1359       35                  MESSAGE: T & D feature not yet implemented.
     1360       36        */
     1361       37        /*E*        ERROR:  TDP-E$TDBADIDCW-0
PL6.E3A0      #005=TDP$ERRTEXT File=TDP$PMME.:E05TSI                             WED 07/30/97 06:07 Page:274  
     1362       38                  MESSAGE: T & D DCW list contains an illegal IDCW.
     1363       39                 MESSAGE1: It is illegal to write on other than a diagnostic cylinder of
     1364       40                           a shared disk.
     1365       41        */
     1366       42        /*E*        ERROR:  TDP-E$BADDCB-0
     1367       43                  MESSAGE: M$IOQ DCB %DC open or assigned.
     1368       44        */
     1369       45        /*E*        ERROR:  TDP-E$BADDCWLIST-0
     1370       46                  MESSAGE: M$IOQ bad DCW list.
     1371       47        */
     1372       48        /*E*        ERROR:  TDP-E$BADDLA-0
     1373       49                  MESSAGE: M$IOQ bad Device Logical Address
     1374       50        */
     1375       51        /*E*        ERROR:  TDP-E$BADLFC-0
     1376       52                  MESSAGE: M$IOQ bad Logical Function Code.
     1377       53        */
     1378       54        /*E*        ERROR:  TDP-E$TDALTBAD-0
     1379       55                    MESSAGE: Bad altpath specified on M$TDIO.
     1380       56              MESSAGE1: The altpath specified does not exist or reaches a device other than
     1381       57                              the one the T & D DCB is opened to.
     1382       58        */
     1383       59        /*E*        ERROR:  TDP-E$SCNNOCOMP-0
     1384       60                  MESSAGE: The specified component does not exist.
     1385       61        */
     1386       62        /*E*        ERROR:  TDP-E$SCNNOTDEV-0
     1387       63                  MESSAGE: The specified component is not a device (It is probably an MPC)
     1388       64        */
     1389       65        /*E*        ERROR:  TDP-E$SCNNOTMPC-0
     1390       66                  MESSAGE: The specified component is not an MPC. (It is probably a device)
     1391       67        */
     1392       68        /*E*        ERROR:  TDP-E$SCNNOPATH-0
     1393       69                 MESSAGE: Can't return that device because all paths to it are partitioned.
     1394       70        */
     1395       71        /*E*        ERROR:  TDP-E$ONLYPATH-0
     1396       72                  MESSAGE: Can't partition that component because it is the only path
     1397       73                           to some device that has not been partitioned.
     1398       74        */
PL6.E3A0      #005=TDP$ERRTEXT File=TDP$PMME.:E05TSI                             WED 07/30/97 06:07 Page:275  
     1399       75        /*E*        ERROR:  TDP-E$ONLYSCONS-0
     1400       76                  MESSAGE: Can't partition that system console because it is the only
     1401       77                           console that has not been partitioned.
     1402       78        */
     1403       79        /*E*        ERROR:  TDP-E$IOMDOWN-0
     1404       80                  MESSAGE: Can't return that component because its IOM is partitioned.
     1405       81        */
     1406       82        /*E*        ERROR:  TDP-E$TDOKFORIOM-0
     1407       83                  MESSAGE: Can't specify TDOK for an IOM.
     1408       84        */
     1409       85        /*E*        ERROR:  TDP-E$CHANUP-0
     1410       86                  MESSAGE: Can't partition this IOM because at least one of its
     1411       87                           channels is not partitioned.
     1412       88        */
     1413       89        /*E*        ERROR:  TDP-E$MPCUP-0
     1414       90                  MESSAGE: Can't partition this IOM because it provides the only
     1415       91                           path to an MPC.
     1416       92        */
     1417       93        /*E*        ERROR:  TDP-E$NOPARTRETCHAN-0
     1418       94                  MESSAGE: Can't partition/return channel for FEP or system console;
     1419       95                           partition/return the device.
     1420       96        */
     1421       97        /*E*        ERROR:  TDP-E$SCNNOTFEP-0
     1422       98                  MESSAGE: The specified FEP does not exist
     1423       99        */
     1424      100        /*E*        ERROR:  TDP-E$SCNTDUSER-0
     1425      101                  MESSAGE: Cannot return that component because there is a T & D
     1426      102                           user using it.
     1427      103        */
     1428      104        /*E*       ERROR: TDP-E$CWFORNONDP-0
     1429      105                 MESSAGE: Cannot set CHECKWRITE% for device %U1.%
     1430      106                 MESSAGE1: CHECKWRITE is only legal for disk devices.
     1431      107        */
     1432      108        /*E*       ERROR: TDP-E$REMOTEFEP-0
     1433      109                   MESSAGE: Cannot perform operations on remote FEPs.
     1434      110                   MESSAGE1: Partition, return, or display of remote FEPs
     1435      111                             is not supported in SYSCON.
PL6.E3A0      #005=TDP$ERRTEXT File=TDP$PMME.:E05TSI                             WED 07/30/97 06:07 Page:276  
     1436      112        */
     1437      113        /*E*       ERROR: TDP-E$NOPARTRETFEP-0
     1438      114                   MESSAGE: Currently unable to partition/return that FEP.
     1439      115                   MESSAGE1: The FEP cannot be partitioned/returned because
     1440      116                             it is not in the proper state.
     1441      117        */
     1442      118        /*E*       ERROR: TDP-E$TDMCABUSY-0
     1443      119                   MESSAGE: The requested MCA is not available for T&D.
     1444      120        */
     1445      121        /*E*       ERROR: TDP-E$TDNOTMCA-0
     1446      122                   MESSAGE: The requested device is not an MCA.
     1447      123        */
     1448      124        /*E*       ERROR: TDP-E$TDMCANOTRESERVED-0
     1449      125                   MESSAGE: The requested device is not reserved for use by T&D
     1450      126        */
     1451      127        /*E*       ERROR: TDP-E$TDMCANOTUSER-0
     1452      128                 MESSAGE: The requested device is not reserved for user by T&D by this user
     1453      129        */
     1454      130        /*E*       ERROR: TDP-E$MCAINUSE-0
     1455      131                   MESSAGE: Can't partition or release IOM because MCA is in use
     1456      132        */
     1457      133        /*E*       ERROR: TDP-E$DEVNOTIDLE-0
     1458      134                   MESSAGE: Unable to partition that device - state is not idle
     1459      135                   MESSAGE1: This device cannot be partitioned because it is currently
     1460      136                             waiting for an operator keyin
     1461      137        */
     1462      138        /*E*       ERROR:TDP-E$IOMNOTENABLED-0
     1463      139                   MESSAGE: Can't partition IOM because its SCU port is not enabled
     1464      140        */
     1465      141    1   END TDP$ERRTEXT;

PL6.E3A0      #005=TDP$ERRTEXT File=TDP$PMME.:E05TSI                             WED 07/30/97 06:07 Page:277  
      No diagnostics issued in procedure TDP$ERRTEXT.
PL6.E3A0      #005=TDP$ERRTEXT File=TDP$PMME.:E05TSI                             WED 07/30/97 06:07 Page:278  

 **** Variables and constants ****


   No code generated for procedure TDP$ERRTEXT .
   Procedure TDP$ERRTEXT requires 4 words of local(AUTO) storage.

    No errors detected in file TDP$PMME.:E05TSI    .
PL6.E3A0      #005=TDP$ERRTEXT File=TDP$PMME.:E05TSI                             WED 07/30/97 06:07 Page:279  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=TDP$ERRTEXT File=TDP$PMME.:E05TSI                             WED 07/30/97 06:07 Page:280  
          MINI XREF LISTING

