VERSION E05

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:1    
        1        1        /*M* FSL$LDEV   Process the M$LDEV PMME.    */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR,PLM=5,IND=5,CTI=5,SDI=5,MCL=10,CSI=0,ECI=0 */
        8        8        /*P*    NAME: FSL$LDEV
        9        9                PURPOSE: Process the M$LDEV PMME.
       10       10         */
       11       11        /*F*    NAME: FSL$LDEV
       12       12                PURPOSE: Process  the M$LDEV PMME.
       13       13                   M$LDEV defines a logical device or changes some of
       14       14                   the parameters of a logical device definition or closes a
       15       15                   logical device for shipment or deletion.
       16       16                DESCRIPTION:  The basic operations performed by FSL$LDEV depend
       17       17                on whether the named logical device already exists, and on the
       18       18                values of the CONTINUE, SCRUB, REMOVE, and ERASE parameters
       19       19                of M$LDEV.
       20       20                   It is illegal to have SCRUB, REMOVE, or ERASE with
       21       21                CONTINUE.
       22       22                   CONTINUE -- If logical device does not exist or has no
       23       23                file, as if no CONTINUE specified.  Otherwise, update FIT
       24       24                of symbiont file with formatting parameters from M$LDEV.
       25       25                If file DCB is open, update the DCB too.  All done.
       26       26                   Not CONTINUE -- If logical device exists and its file is
       27       27                open, mark all user DCB's open to it closed.  If file not
       28       28                open, open it.  If not SCRUB or REMOVE, hang on to file's
       29       29                FIT.  If ERASE, close scratch; otherwise close save, do
       30       30                accounting and tell Outsym.
       31       31                If REMOVE, erase logical device name if not LP01, and we
       32       32                are done.
       33       33                   Get destination and formatting parameters from M$LDEV
       34       34                and add them to saved parameters if any.
       35       35                   Verify user access to workstation and workstation/device
       36       36                access to form.  Open new symbiont file.  Write banner if
       37       37                any into file.  Close file. All done.
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:2    
       38       38        */
       39       39        FSL$LDEV: PROC;
       40       40
       41       41        /*** ENTRY REFERENCES ***/
       42       42    1   DCL FMN$GETFIT ENTRY(2)ALTRET;          /* Read FIT of disk file.*/
       43       43    1   DCL FMO$LOCCODP ENTRY(2)ALTRET;         /* Find entry in FIT.*/
       44       44    1   DCL FMP$CLSF ENTRY(1);                  /* Close a disk file DCB*/
       45       45    1   DCL FSA$GSP ENTRY(2)ALTRET;             /* Get ROSEG space.*/
       46       46    1   DCL FSA$FSP ENTRY(2)ALTRET;             /* Free ROSEG space.*/
       47       47    1   DCL FSA$FDCB ENTRY(1);                  /* Free a DCB's ROSEG space */
       48       48    1   DCL FSB$STREAMCREATE ENTRY(1)ALTRET;    /* Make DCB for symfile create.*/
       49       49    1   DCL FSB$STREAMDCB ENTRY(1)ALTRET;       /* Open symb. file update.*/
       50       50    1   DCL FSL$ACCT ENTRY(3);                  /* Account for symbiont files.*/
       51       51    1   DCL FSL$UC ENTRY(1);
       52       52    1   DCL FSM$UCLDEV ENTRY;                   /* Do Tabs & Header for LDEV UC.*/
       53       53    1   DCL FSN$CONV_STR ENTRY(2) ALTRET;
       54       54    1   DCL FSX$TELLOUTSYM ENTRY(3);
       55       55    1   DCL HFF$NIL ENTRY(1)ALTRET;             /* Is vector NIL?*/
       56       56    1   DCL HFF$ERASE ENTRY(1)ALTRET;           /* Is vector ERASE?*/
       57       57    1   DCL HFF$NILERASE ENTRY(1)ALTRET;        /* Is vector NIL/ERASE?*/
       58       58    1   DCL HFF$DSIZ ENTRY(2);                  /* Find size of vector.*/
       59       59    1   DCL HFF$TRAPALT ENTRY ALTRET;           /* Get control of trap conditions */
       60       60    1   DCL FMD$GBUF ENTRY(1);                  /* Steal a File-Management buffer. */
       61       61    1   DCL FMD$RBUF ENTRY(1);                  /* Return a Stolen File Mgmt buffer. */
       62       62    1   DCL FMH$SYMB_FINISH ENTRY (3) ALTRET;
       63       63    1   DCL FSW$DESTFORM ENTRY(3)ALTRET;
       64       64    1   DCL FSW$FORM ENTRY(2)ALTRET;
       65       65    1   DCL FSW$UCFORM ENTRY(2)ALTRET;
       66       66    1   DCL FSF$SYMBFILE ENTRY(3)ALTRET;
       67       67    1   DCL SC_FSBADRO ENTRY CONV(2,0);
       68       68
       69       69        /*** DATA REFERENCES ***/
       70       70    1   DCL B$M$UC$ PTR SYMREF READONLY;
       71       71    1   DCL B$PS0$ PTR SYMREF;                  /*->V area of LDEV FPT*/
       72       72    1   DCL B$PS1$ PTR SYMREF;                  /*->TAB area of LDEV FPT*/
       73       73    1   DCL B$PS2$ PTR SYMREF;                  /*->HDR area of LDEV FPT*/
       74       74    1   DCL B$PS3$ PTR SYMREF;                  /*->WSN area of LDEV FPT*/
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:3    
       75       75    1   DCL B$PS4$ PTR SYMREF;                  /*->FORM area of LDEV FPT*/
       76       76    1   DCL B$PS5$ PTR SYMREF;                  /*->WINDOW area of LDEV FPT*/
       77       77    1   DCL B$PS6$ PTR SYMREF;                  /*->FPRG area of LDEV FPT*/
       78       78    1   DCL B$ROSEG$ PTR SYMREF;
       79       79    1   DCL B$JIT$ PTR SYMREF;                  /* Note that B$JIT is BASED(B$JIT$).  */
       80       80        %MACRO B$ROSEG(BASED=BASED);
       81       81        %INCLUDE B$ROSEG;
       82      144        %MEND;
       83      145        %B$ROSEG(BASED="BASED(B$ROSEG$)");
       84      205        %INCLUDE F$JIT_C;
       85      635        %MACRO F$DCBI(BASED=BASED);
       86      636        %INCLUDE F$DCB;
       87      685        %MEND;
       88      686        %F$DCBI(BASED="BASED(SDCB$)");
       89      736        %INCLUDE F$CP6V_C;
       90      962        %FPT$LDEV_V(BASED="BASED(B$PS0$)");
       91      968        %INCLUDE F_CP6;
       92     1993        %INCLUDE F$CP6P_C;
       93     2004        %INCLUDE FS_SUPER_C;
       94     2767        %FS$FORMREC;
       95     2838        %VLP_TAB(FPTN=VLP$TAB,STCLASS=BASED);
       96     2852        %VLP_HDR(FPTN=VLP$HDRF,STCLASS=BASED,LEN=160);
       97     2868        %VLP_WSN(FPTN=VLP$WSN,STCLASS="BASED(B$PS3$)");
       98     2881        %VLP_FORM(FPTN=VLP$FORM,STCLASS="BASED(B$PS4$)");
       99     2894        %INCLUDE KI_CP6;
      100     3990        %VLP_FPRG (FPTN=AUTOFPRG, LVL=1, STCLASS=);
      101     4011        %VLP_FPRG (FPTN=CODE17, LVL=1, STCLASS=BASED);
      102     4032        %INCLUDE F_ERRORS_C;
      103     4272        %INCLUDE FS$FIT;
      104     4315        %INCLUDE B$TABLES_C;
      105     4423        %B$XL_UPPER_UR;
      106     4427        %FS$DEST;
      107     4435        %FS$DEST(NAME=FS$DESTWITH,STCLASS="BASED(DEST$)",SIZ=FIT);
      108     4443        %FS_OSFN(FPTN=OSFN,STCLASS=BASED);
      109     4457    1   DCL CHARJ CHAR(J)BASED;                 /* Move chars, blank fill. */
      110     4458    1   DCL 1 BCHARJ BASED,2 * CHAR(J);         /* Move chars zero fill. */
      111     4459    1   DCL 1 BCHARTAB BASED, 2 * CHAR(PL6ISDUMB);
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:4    
      112     4460    1   DCL PL6ISDUMB UBIN CONSTANT INIT(SIZEC(VLP$TAB));
      113     4461        %FPT_OPEN(FPTN=CONSTOPN,STCLASS=CONSTANT,PFMT=PTR,VECTOR=ADDR);
      114     4570        %FPT_CLOSE(FPTN=CONSTCLS,STCLASS=CONSTANT,PFMT=PTR,VECTOR=ADDR,
      115     4571                CHGATT=YES);
      116     4613        %FPT_CLOSE(FPTN=CLOSE$STREAM$,PFMT=PTR,VECTOR=ADDR,STCLASS=CONSTANT);
      117     4655        %FPT_CLOSE(FPTN=CLOSESCRATCH$,PFMT=PTR,VECTOR=ADDR,STCLASS=CONSTANT,
      118     4656                DISP=SCRATCH);
      119     4698        %SUB FCG#="'0623'O";
      120     4699        %SUB MID#="'14'O";
      121     4700        %INCLUDE FM$MACROS;
      122     5075        %FM$GRAN;
      123     5079        %CODE16;
      124     5087        %ERRCODE (NAME=ERR$INCONSIS,COD#=%E$LDEVINCONS);
      125     5091        %ERRCODE (NAME=ERR$LDEVSNAME,COD#=%E$LDEVSNAME);
      126     5095        %ERRCODE (NAME=ERR$LDEVNOSTREAMS,COD#=%E$LDEVNOSTREAMS);
      127     5099        %ERRCODE (NAME=ERR$INVDEV,COD#=%E$INVDEV);
      128     5103        %ERRCODE (NAME=ERR$CANT_USE_TEMP_STREAM,COD#=%E$CANT_USE_TEMP_STREAM);
      129     5107        %ERRCODE (NAME=ERR$FPRG_ON_NON_GR,COD#=%E$FPRG_ON_NON_GR);
      130     5111        %INCLUDE CP_6_SUBS;
      131     5651    1   DCL I UBIN;                             /* Logical Device index (0 to 15) */
      132     5652    1   DCL J SBIN;                             /* Miscellaneous uses                 */
      133     5653    1   DCL TEMPSTR  UBIN BYTE;       /*  Temp for stream returned from FSN$CONV_STR  */
      134     5654    1   DCL SDCB$ PTR;                     /* Points to stream's DCB when necessary   */
      135     5655    1   DCL DEST$ PTR;                     /* Preserves destination across file close.*/
      136     5656    1   DCL FIT$ PTR;
      137     5657    1   DCL P$ PTR;
      138     5658    1   DCL CONTFLG BIT(1);
      139     5659    1   DCL SCRUBTO UBIN;
      140     5660    1   DCL SAVERR BIT(36);
      141     5661    1   DCL UC_STR BIT(1);
      142     5662        %FPT$OPEN_P(FPTN=AUTOFPT,STCLASS=,PFMT=PTR);
      143     5668        %FPT$CLOSE_P(FPTN=AUTOCLS,STCLASS=,PFMT=PTR);
      144     5672        %FS$LDEVDDF(NAME=FS$AUTODDF,STCLASS=);
      145     5676        %FS$LDEVDDF(NAME=FS$DDF,STCLASS=BASED);
      146     5680        %FS$LDEVDDF(NAME=FS$DDFSZ,STCLASS=BASED,SIZ=FIT);
      147     5684    1   DCL LNAME CHAR(4);                      /*Holds logical dev name during setup*/
      148     5685        /*      Logical Device names in the LDEV FPT may be --
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:5    
      149     5686                'ALL '
      150     5687                'Ln  ' or 'Pn  ', n a digit.
      151     5688                'ddnn', d alpanumeric and n a digit.
      152     5689                'UC  ' or 'M$UC'.
      153     5690                LNAMECHARS is alphanumeric characters.
      154     5691                LNAMEDD.CHR is digit characters.
      155     5692        */
      156     5693    1   DCL LNAMECHARS CHAR(36)CONSTANT INIT
      157     5694    1           ('0123456789LPCABDEFGHIJKMNOQRSTUVWXYZ');
      158     5695    1   DCL 1 LNAMEDD REDEF LNAMECHARS,
      159     5696    1            2 CHR CHAR(10), 2 LETTERS CHAR(26);
      160     5697        %EJECT;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:6    
      161     5698        /*
      162     5699                   First verify that parameters are consistent.  CONTINUE
      163     5700                is not allowed to change destination attributes.
      164     5701        */
      165     5702    1        UC_STR = '0'B;
      166     5703    2        IF FPT$LDEV_V.CONTINUE THEN DO;
      167     5704    2             IF NOT(FPT$LDEV_V.SCRUB OR FPT$LDEV_V.REMOVE OR
      168     5705    2                  FPT$LDEV_V.DELETE) THEN
      169     5706    2                  IF FPT$LDEV_V.DEV='  ' THEN
      170     5707    2                       CALL HFF$NIL(B$PS3$)
      171     5708    3                       WHENRETURN DO;
      172     5709    3                            B$JIT.ERR = ERR$INCONSIS;
      173     5710    3                            RETURN;
      174     5711    3                          END;
      175     5712    3                       WHENALTRETURN DO;
      176     5713    3                            CALL HFF$NIL(B$PS4$)
      177     5714    4                            WHENRETURN DO;
      178     5715    4                                 B$JIT.ERR=ERR$INCONSIS;
      179     5716    4                                 RETURN;
      180     5717    4                               END;
      181     5718    4                            WHENALTRETURN DO;
      182     5719    4                                 CALL HFF$NIL (B$PS6$)
      183     5720    5                                 WHENRETURN DO;
      184     5721    5                                      B$JIT.ERR = ERR$INCONSIS;
      185     5722        /*E*    ERROR: FSL-E$LDEVINCONS-2
      186     5723                MESSAGE: Inconsistent options for LDEV.
      187     5724                MESSAGE1: The LDEV option CONTINUE is inconsistent with the
      188     5725                      SCRUB, REMOVE, and ERASE options or with a change of
      189     5726                      destination, FPRG, or form name.
      190     5727        */
      191     5728    5                                      RETURN;
      192     5729    5                                    END;
      193     5730    5                                 WHENALTRETURN DO;
      194     5731    5                                    END;
      195     5732    4                               END;
      196     5733    3                          END;
      197     5734    2           END;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:7    
      198     5735        /* Check if from stream is legal */
      199     5736    1        IF FPT$LDEV_V.FRMSTRM ~= '  '
      200     5737    1        THEN
      201     5738    1             IF FPT$LDEV_V.DEV = 'UC'
      202     5739    2             THEN DO;
      203     5740    2                  CALL INDEX(I,SUBSTR(FPT$LDEV_V.FRMSTRM,0,1),'0123456789')
      204     5741    3                  WHENALTRETURN DO;
      205     5742    3   ILLGL_DEV:          ;
      206     5743    3                       B$JIT.ERR = ERR$INVDEV;
      207     5744                       /*E* ERROR: FSL-E$INVDEV-2
      208     5745                            MESSAGE: Illegal device name specified for from stream.
      209     5746         */
      210     5747    3                       RETURN;
      211     5748    3                     END;
      212     5749    2                  CALL INDEX(I,SUBSTR(FPT$LDEV_V.FRMSTRM,1,1),'0123456789') ALTRET(
              5749                           ILLGL_DEV);
      213     5750    2                  CALL CONCAT (LNAME,'UC',FPT$LDEV_V.FRMSTRM);
      214     5751    2                  CALL FSN$CONV_STR(LNAME,TEMPSTR)
      215     5752    3                  WHENRETURN DO;
      216     5753    4                       IF TEMPSTR > 20 THEN DO;
      217     5754    4                            B$JIT.ERR = ERR$CANT_USE_TEMP_STREAM;
      218     5755                       /*E* ERROR:  FSL-E$CANT_USE_TEMP_STREAM-2
      219     5756                            MESSAGE:  You cannot create this stream.
      220     5757                            MESSAGE1:  You cannot create a permanent LDEV
      221     5758                                       stream from a temporary stream.
      222     5759                       */
      223     5760    4                            RETURN;
      224     5761    4                          END;             /*  TEMPSTR > 20  */
      225     5762    3                     END;                  /*  WHENRETURN  */
      226     5763    3                  WHENALTRETURN DO;
      227     5764    3                       RETURN;
      228     5765    3                     END;
      229     5766    2                END;
      230     5767        /*
      231     5768                   Verify that Logical Device name is properly formed.
      232     5769                Acceptable names are --
      233     5770                'ddnn' with dd alphanumeric and nn digits.
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:8    
      234     5771                'LP  ', 'CP  ' or 'GR  ', abbrev for 'LP01', 'CP01' or 'GR01'.
      235     5772                'ALL ', means do all defined logical devices.
      236     5773                'UC  ', means operate on T/S terminal.
      237     5774        */
      238     5775    1        CALL XLATE ( LNAME, B$XL_UPPER_UR, FPT$LDEV_V.STREAMNAME );
      239     5776    1        CALL INDEX(I,' ',LNAME);
      240     5777    2        DO CASE(I);
      241     5778    2        CASE(3);
      242     5779    2           IF LNAME='ALL' THEN GOTO ALLLOGDEV;
      243     5780    2        CASE(2);
      244     5781    2           IF LNAME='UC' THEN GOTO MUCLOGDEV;
      245     5782    2           IF LNAME='LP' OR
      246     5783    2                LNAME='CP' OR
      247     5784    3                LNAME='GR' THEN DO;
      248     5785    3                CALL INSERT(LNAME,2,2,'01');
      249     5786    3                GOTO ONELOGDEV;
      250     5787    3              END;
      251     5788    2        CASE(4);
      252     5789    2           CALL INDEX(I,SUBSTR(LNAME,0,1),LNAMEDD.LETTERS)ALTRET(BADLNM);
      253     5790    2           CALL INDEX(I,SUBSTR(LNAME,1,1),LNAMEDD.LETTERS)ALTRET(BADLNM);
      254     5791    2           CALL INDEX(I,SUBSTR(LNAME,2,1),LNAMEDD.CHR)ALTRET(BADLNM);
      255     5792    2           CALL INDEX(I,SUBSTR(LNAME,3,1),LNAMEDD.CHR)ALTRET(BADLNM);
      256     5793    2           IF SUBSTR(LNAME,0,2) = 'UC'
      257     5794    2           THEN
      258     5795    2                UC_STR = '1'B;
      259     5796    2           GOTO ONELOGDEV;
      260     5797    2        END;
      261     5798    1   BADLNM: B$JIT.ERR=ERR$LDEVSNAME;
      262     5799        /*E*    ERROR:   FSL-E$LDEVSNAME-2
      263     5800                MESSAGE: Illegal Logical Device name on LDEV.
      264     5801                MESSAGE1:   Logical Device names must be four characters
      265     5802                      long:  two letters followed by two digits.  Acceptable
      266     5803                      abbreviations are 'LP' for 'LP01', 'CP' for 'CP01',
      267     5804                      and 'GR' for 'GR01' to reference individual devices,
      268     5805                      and 'ALL' to mean all defined logical devices.
      269     5806                      The name 'UC' refers to interactive user terminal.
      270     5807        */
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:9    
      271     5808    1        RETURN;
      272     5809    1   ALLLOGDEV:;
      273     5810    2        DO I=0 TO 15;
      274     5811    2             IF B$ROSEG.STREAMID.FLG(I)~=0 AND NOT B$ROSEG.STREAMID.UC_STR(I)
      275     5812    2             THEN
      276     5813    2                  CALL DOASTREAM;
      277     5814    2           END;
      278     5815    1        RETURN;
      279     5816    1   MUCLOGDEV:;
      280     5817    1        SDCB$=B$M$UC$;
      281     5818    1        IF NOT F$DCB.FCD OR F$DCB.ASN~=%DEVICE# OR
      282     5819    1             F$DCB.RES~='UC' OR NOT F$DCB.DDEV.IC THEN
      283     5820    1             GOTO BADLNM;
      284     5821    1        B$JIT.DCB$=SDCB$;
      285     5822    1        CALL HFF$NILERASE(B$PS4$)ALTRET(UCRET);
      286     5823    1        CALL HFF$DSIZ(B$PS4$,J);
      287     5824    1        F$DCB.PSN=B$PS4$->CHARJ;
      288     5825    1        CALL FMD$GBUF(FIT$);
      289     5826    1        CALL HFF$TRAPALT ALTRET(UCRBRET);
      290     5827    1        CALL FSW$UCFORM(,FIT$)ALTRET(UCRBRET);
      291     5828    1   UCRBRET: CALL FMD$RBUF(FIT$);
      292     5829    1   UCRET: CALL FSM$UCLDEV;
      293     5830    1        RETURN;
      294     5831        /*
      295     5832                We have a Logical Device name which is not 'ALL'.
      296     5833                See if it is defined; if so, perform the LDEV.
      297     5834         */
      298     5835    1   ONELOGDEV:;
      299     5836    2        DO I=0 TO 15;
      300     5837    3             IF B$ROSEG.LDEVNAME(I)=LNAME THEN DO;
      301     5838    3                  IF UC_STR
      302     5839    3                  THEN
      303     5840    3                       CALL FSL$UC(I);
      304     5841    3                  ELSE
      305     5842    3                       CALL DOASTREAM;
      306     5843    3                  RETURN;
      307     5844    3                END;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:10   
      308     5845    2           END;
      309     5846        /*
      310     5847                We have a Logical Device which is not defined.
      311     5848                If REMOVE, no-op.
      312     5849                If no unused Logical Device slots, error.
      313     5850                Else get a slot and use it.
      314     5851         */
      315     5852    1        IF FPT$LDEV_V.REMOVE THEN
      316     5853    1             RETURN;
      317     5854    2        DO I=0 TO 15;
      318     5855    3             IF B$ROSEG.LDEVNAME(I)='    ' THEN DO;
      319     5856    3                  B$ROSEG.LDEVNAME(I)=LNAME;
      320     5857    3                  IF UC_STR
      321     5858    3                  THEN
      322     5859    3                       CALL FSL$UC(I);
      323     5860    3                  ELSE
      324     5861    3                       CALL DOASTREAM;
      325     5862    4                  IF B$ROSEG.STREAMID.FLG(I)=0 THEN DO;
      326     5863    4                       B$ROSEG.LDEVNAME(I)=' ';
      327     5864    4                       B$ROSEG.STREAMID(I)='0'B;
      328     5865    4                     END;
      329     5866    3                  RETURN;
      330     5867    3                END;
      331     5868    2           END;
      332     5869    1        B$JIT.ERR=ERR$LDEVNOSTREAMS;
      333     5870        /*E*    ERROR: FSL-E$LDEVNOSTREAMS-2
      334     5871                MESSAGE: No more Logical Devices can be defined.
      335     5872                MESSAGE1: All sixteen Logical Device slots are defined.
      336     5873                          There are five slots reserved for system use,
      337     5874                          leaving eleven for user definition.
      338     5875                          You must un-define a Logical Device with LDEV
      339     5876                          (REMOVE) before you can define another one.
      340     5877        */
      341     5878    1        RETURN;
      342     5879        %EJECT;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:11   
      343     5880    1   DOASTREAM: PROC;
      344     5881    2   DCL NEWWSN CHAR(8);
      345     5882    2   DCL NEWRES CHAR(4);
      346     5883        /*
      347     5884                Perform the LDEV operation on a single Logical Device.
      348     5885                Logical Device slot number is in I.
      349     5886                First step:  If the Logical Device has a file associated,
      350     5887                   make sure that the file is open.  Mark all user DCB's
      351     5888                   open to the Logical Device closed, so that they will pick
      352     5889                   up new attributes.
      353     5890         */
      354     5891    2        SDCB$=ADDR(NIL);
      355     5892    2        DEST$=ADDR(NIL);
      356     5893    2        SCRUBTO=B$ROSEG.STREAMID.FLG(I);
      357     5894    2        FS$AUTODDF='0'B;
      358     5895    2        CALL HFF$TRAPALT ALTRET(SCRUBIT);
      359     5896    3        DO CASE(SCRUBTO);
      360     5897    3        CASE(2);
      361     5898    3           SDCB$=PINCRW(B$ROSEG$,B$ROSEG.STREAMID.IDENT(I));
      362     5899    3           B$JIT.DCB$=SDCB$;
      363     5900    3        CASE(1);
      364     5901    3           CALL FSB$STREAMDCB(I) ALTRET(RETN);
      365     5902    3           SDCB$=B$JIT.DCB$;
      366     5903    3        CASE(0);
      367     5904    3           B$ROSEG.STREAMID(I)='0'B;
      368     5905    3        CASE(ELSE);
      369     5906    3           CALL SC_FSBADRO;
      370     5907    3           B$ROSEG.STREAMID(I)='0'B;
      371     5908    3           SCRUBTO=0;
      372     5909    3        END;
      373     5910        /*
      374     5911                Second step:  (If the Logical Device has a file associated.)
      375     5912                   Collect attributes of the file that will be needed to
      376     5913                   create a new file.  Most are retained in the DCB, but
      377     5914                   destination info is needed for not-SCRUB/REMOVE when
      378     5915                   new destination is not specified.
      379     5916                   DEST$ is ADDR(NIL) or points to saved attributes.
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:12   
      380     5917                   With attributes collected, non-CONTINUE cases close the
      381     5918                   file, either SCRATCH or SAVE telling OUTSYM.
      382     5919                   If no file attributes at all are needed (SCRUB/REMOVE),
      383     5920                   the DCB is freed and "no file associated" is marked.
      384     5921                   If device or wsn is changing, default to SCRUB.
      385     5922         */
      386     5923    2        NEWWSN=B$JIT.WOO;
      387     5924    2        NEWRES=SUBSTR(LNAME,0,2);
      388     5925    3        IF SCRUBTO~= 0 THEN DO;
      389     5926    3             NEWRES=F$DCB.RES;
      390     5927    3             NEWWSN=F$DCB.WSN;
      391     5928    3             IF FPT$LDEV_V.CONTINUE AND NOT FPT$LDEV_V.SCRUB THEN
      392     5929    3                  GOTO SCRUBCODE;
      393     5930    3           END;
      394     5931    2        CALL HFF$NIL(B$PS3$)ALTRET(NOWSN);
      395     5932    2        NEWWSN=B$JIT.WOO;
      396     5933    2        CALL HFF$ERASE(B$PS3$)ALTRET(NOWSN);
      397     5934    2        CALL HFF$DSIZ(B$PS3$,J);
      398     5935    2        NEWWSN=B$PS3$->CHARJ;
      399     5936    2   NOWSN: ;
      400     5937    2        IF FPT$LDEV_V.DEV~=' ' THEN NEWRES=FPT$LDEV_V.DEV;
      401     5938    3   SCRUBCODE: DO;
      402     5939                                 /* This code is so wierd because SDCB$ might be nil */
      403     5940    4             DO;
      404     5941    4                  IF FPT$LDEV_V.REMOVE OR FPT$LDEV_V.SCRUB THEN EXIT;
      405     5942    4                  IF SDCB$~=ADDR(NIL) THEN
      406     5943    4                       IF F$DCB.RES~=NEWRES OR F$DCB.WSN~=NEWWSN THEN EXIT;
      407     5944    4                  EXIT SCRUBCODE;
      408     5945    4                END;
      409     5946    3             IF SCRUBTO=2 THEN CALL CLOSEM;
      410     5947    4             IF SCRUBTO~=0 THEN DO;
      411     5948    4                  CALL TRUNKET;
      412     5949    4                  CALL FSA$FDCB(SDCB$);
      413     5950    4                  B$ROSEG.STREAMID(I)='0'B;
      414     5951    4                END;
      415     5952                                           /* We can remove anything other than LP01. */
      416     5953    4             IF FPT$LDEV_V.REMOVE THEN DO;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:13   
      417     5954    4                  IF B$ROSEG.LDEVNAME(I)~='LP01' THEN
      418     5955    4                       B$ROSEG.LDEVNAME(I)='   ';
      419     5956    4                  RETURN;
      420     5957    4                END;
      421     5958    3           END;
      422     5959    2        CALL FSA$GSP(SIZEW(FS$DESTWITH),DEST$)ALTRET(SCRUBIT);
      423     5960    2        CALL HFF$TRAPALT ALTRET(SCRUBIT);
      424     5961    2        FS$DESTWITH='0'B;
      425     5962    2        FS$DESTWITH.SIZ=SIZEW(FS$DEST);
      426     5963    2        FS$DESTWITH.COPIES=1;
      427     5964    3        IF SCRUBTO~=0 THEN DO;
      428     5965    3             CONTFLG=FPT$LDEV_V.CONTINUE;
      429     5966    3             IF SCRUBTO=2 THEN CALL CLOSEM;
      430     5967    3             J=1;
      431     5968    3             CALL FMN$GETFIT(FIT$,J)ALTRET(SCRUBIT);
      432     5969    3             FIT$=PINCRW(FIT$,SIZEW(FM$GRAN));
      433     5970    3             P$=FIT$;
      434     5971    3             CALL FMO$LOCCODP(P$,13)ALTRET(SCRUBIT);
      435     5972    3             PINCRW(DEST$,1)->FS$DEST=P$->FS$DEST;
      436     5973                  /* This is to save the code17 block if it was already there
      437     5974                    because it isn't allowed to be changed.
      438     5975                  */
      439     5976    3             P$ = FIT$;
      440     5977    3             CALL FMO$LOCCODP (P$, 17)
      441     5978    4             WHENRETURN DO;
      442     5979    4                  AUTOFPRG = P$->CODE17;
      443     5980    4                END;
      444     5981    4             WHENALTRETURN DO;
      445     5982    4                END;
      446     5983    3             P$=FIT$;
      447     5984    3             CALL FMO$LOCCODP(P$,11)ALTRET(NOFILEDDF);
      448     5985    3             FS$AUTODDF=P$->FS$DDF;
      449     5986    3   NOFILEDDF: ;
      450     5987    4             IF NOT FPT$LDEV_V.CONTINUE THEN DO;
      451     5988    4                  CALL TRUNKET;
      452     5989    4                  F$DCB.FORM$->CODE16.STEPPAGENO=0;
      453     5990    4                  F$DCB.FORM$->CODE16.STEPRECNO=0;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:14   
      454     5991    4                END;
      455     5992    3           END;                       /* IF SCRUBTO ~= 0 (I.E. IT IS A FILE) */
      456     5993    3        ELSE DO;                           /* SCRUBTO = 0 (CREATE A STREAM) */
      457     5994    3             CONTFLG=%NO#;
      458     5995    3             CALL FSB$STREAMCREATE(I) ALTRET(SCRUBIT);
      459     5996    3             CALL HFF$TRAPALT ALTRET(SCRUBIT);
      460     5997    3             SDCB$=B$JIT.DCB$;
      461     5998    3             CALL HFF$NIL (B$PS6$)
      462     5999    4             WHENRETURN DO;
      463     6000                                                /* USE THE SPECIFIED FPRG */
      464     6001    4                  AUTOFPRG = B$PS6$ -> CODE17;
      465     6002    4                END;
      466     6003    4             WHENALTRETURN DO;
      467     6004                                           /* WE SET UP OUR OWN WITH LOADBYPRO SET */
      468     6005    4                  AUTOFPRG.LDBYPRO# = 1;
      469     6006    4                END;
      470     6007    3           END;
      471     6008        /*
      472     6009                Fourth step:  Logical Device now owns a DCB.  The DCB is
      473     6010                      closed unless CONTINUE.
      474     6011                      Either DEST$ has (saved) destination info, or DCB has
      475     6012                      defaults to be overridden by FPT.
      476     6013         */
      477     6014    3        IF FPT$LDEV_V.HOLD THEN DO;
      478     6015    3             DEST$->FS$DESTWITH.SAP=%YES#;
      479     6016    3             DEST$->FS$DESTWITH.SAPCOPIES=FPT$LDEV_V.HOLDCOPIES;
      480     6017    3           END;
      481     6018    2        IF FPT$LDEV_V.COPIES~=0 THEN
      482     6019    2             DEST$->FS$DESTWITH.COPIES=FPT$LDEV_V.COPIES;
      483     6020    2        IF FPT$LDEV_V.CONCURR THEN
      484     6021    2             DEST$->FS$DESTWITH.PRINT=%YES#;
      485     6022        /*
      486     6023                Fifth step:
      487     6024                Move DDF from FPT into Stream DCB.
      488     6025         */
      489     6026    2        CALL HFF$NIL(B$PS1$)ALTRET(NOTAB);
      490     6027    2        CALL HFF$ERASE(B$PS1$)ALTRET(TABZERO);
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:15   
      491     6028    2        IF F$DCB.TAB$=ADDR(NIL) THEN
      492     6029    2             CALL FSA$GSP(SIZEW(VLP$TAB),F$DCB.TAB$)ALTRET(TABNEW);
      493     6030    2        CALL HFF$DSIZ(B$PS1$,J);
      494     6031    2        F$DCB.TAB$->BCHARTAB=B$PS1$->BCHARJ;
      495     6032    2        GOTO TABNEW;
      496     6033    2   TABZERO:;
      497     6034    2        IF F$DCB.TAB$~=ADDR(NIL) THEN
      498     6035    2             CALL FSA$FSP(SIZEW(VLP$TAB),F$DCB.TAB$);
      499     6036    2   TABNEW: F$DCB.IWL.TABIWL='0'B;
      500     6037    2   NOTAB: ;
      501     6038    2        CALL HFF$NIL(B$PS2$)ALTRET(NOHDR);
      502     6039    2        CALL HFF$ERASE(B$PS2$)ALTRET(HDRZERO);
      503     6040    2        IF F$DCB.HEADER$=ADDR(NIL) THEN
      504     6041    2             CALL FSA$GSP(SIZEW(VLP$HDRF),F$DCB.HEADER$)ALTRET(HDRNEW);
      505     6042    2        J=LENGTHC(VLP$HDRF.CTL)+1;
      506     6043    2        F$DCB.HEADER$->CHARJ=B$PS2$->CHARJ;
      507     6044    2        CALL HFF$DSIZ(B$PS2$,J);
      508     6045    2        J=J-(LENGTHC(VLP$HDRF.CTL)+1);
      509     6046    2        IF J>F$DCB.HEADER$->VLP$HDRF.TITL.L# THEN
      510     6047    2             J=F$DCB.HEADER$->VLP$HDRF.TITL.L#;
      511     6048    2        F$DCB.HEADER$->VLP$HDRF.TITL.TITLE#=
      512     6049    2             ADDR(B$PS2$->VLP$HDRF.TITL.TITLE#)->CHARJ;
      513     6050    2        GOTO HDRNEW;
      514     6051    2   HDRZERO:;
      515     6052    2        IF F$DCB.HEADER$~=ADDR(NIL) THEN
      516     6053    2             CALL FSA$FSP(SIZEW(VLP$HDRF),F$DCB.HEADER$);
      517     6054    2   HDRNEW: F$DCB.IWL.HDRIWL='0'B;
      518     6055    2   NOHDR: ;
      519     6056    2        IF FPT$LDEV_V.SEQ&'01'B THEN GOTO NOSEQ;
      520     6057    2        F$DCB.SEQ=FPT$LDEV_V.SEQ;
      521     6058    2        F$DCB.SEQID=FPT$LDEV_V.SEQID;
      522     6059    2        F$DCB.SEQCOL=FPT$LDEV_V.SEQCOL;
      523     6060    2        F$DCB.IWL.SEQIWL='0'B;
      524     6061    2   NOSEQ: ;
      525     6062    2        IF FPT$LDEV_V.LINES~=0 THEN
      526     6063    2             FS$AUTODDF.LINES=FPT$LDEV_V.LINES;
      527     6064    2        IF FPT$LDEV_V.DVFC~=BINASC(0) THEN
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:16   
      528     6065    2             FS$AUTODDF.DVFC=FPT$LDEV_V.DVFC;
      529     6066    2        IF FPT$LDEV_V.WIDTH~=0 THEN
      530     6067    2             FS$AUTODDF.WIDTH=FPT$LDEV_V.WIDTH;
      531     6068    2        IF FPT$LDEV_V.ATTR THEN
      532     6069    2             FS$AUTODDF.ATTR=FPT$LDEV_V.ATTR;
      533     6070        /*
      534     6071                Now go create the new stream file.
      535     6072                (or update the CONTINUE file's FIT).
      536     6073         */
      537     6074    3        IF NOT CONTFLG THEN DO;
      538     6075    3             F$DCB.RES=NEWRES;
      539     6076    3             F$DCB.WSN=NEWWSN;
      540     6077    4             IF FS$AUTODDF.ATTR&~F$DCB.ATTR THEN DO;
      541     6078    4                  F$DCB.ATTR=FS$AUTODDF.ATTR;
      542     6079    4                  FS$DESTWITH.DT.WSN=BINASC(0);
      543     6080    4                END;
      544     6081    3             CALL HFF$NIL(4) ALTRET(NOFORM);
      545     6082    3             F$DCB.FORM$->CODE16='0'B;
      546     6083    3             CALL HFF$ERASE(B$PS4$)ALTRET(ERASEFORM);
      547     6084    3             CALL HFF$DSIZ(B$PS4$,J);
      548     6085    3             F$DCB.FORM$->CODE16.FORM=B$PS4$->CHARJ;
      549     6086    3             DEST$->FS$DESTWITH.FORM=F$DCB.FORM$->CODE16.FORM;
      550     6087    3   ERASEFORM: DEST$->FS$DESTWITH.DT.WSN=BINASC(0);
      551     6088                /* Must re-read WSN file to get default form name */
      552     6089    3   NOFORM:   ;
      553     6090    3             CALL FMD$GBUF(FIT$);
      554     6091    3             CALL HFF$TRAPALT ALTRET(RETNOO);
      555     6092    3             F$DCB.FUN=%CREATE#;
      556     6093    3             B$ROSEG.STREAMID.F01(I)=%NO#;
      557     6094    3             B$ROSEG.STREAMID.SUBNAME(I)=0;
      558     6095    3             F$DCB.WIDTH=FS$AUTODDF.WIDTH;
      559     6096    3             F$DCB.LINES=FS$AUTODDF.LINES;
      560     6097    3             F$DCB.DVFC=FS$AUTODDF.DVFC;
      561     6098    4             IF DEST$->FS$DESTWITH.DT.WSN<=BINASC(0) THEN DO;
      562     6099    4                  F$DCB.ATTR=FS$AUTODDF.ATTR;
      563     6100    4                  CALL FSW$DESTFORM(DEST$,FIT$,B$JIT$)ALTRET(RETNOO);
      564     6101    4                END;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:17   
      565     6102    3             ELSE
      566     6103    3                  CALL FSW$FORM(DEST$,FIT$)ALTRET(RETNOO);
      567     6104    3             F$DCB.ATTR = FIT$->FS$FORMREC.ATTR;
      568     6105    3             IF FIT$->FS$FORMREC.GRAPHIC
      569     6106    4             THEN DO;                      /* WE MUST PUT IN THE FPRG */
      570     6107    4                  CALL FSA$GSP (SIZEW (AUTOFPRG), P$);
      571     6108    4                  F$DCB.FPRGX = POFFW (P$, B$ROSEG$);
      572     6109    4                  P$ -> CODE17 = AUTOFPRG;
      573     6110                             /* Set the TAB, HDR, and SEQ IWL flags to avoid
      574     6111                                putting out these records unless demanded by
      575     6112                                the user.  Their existance might mess up some
      576     6113                                of the FPRGs.
      577     6114                             */
      578     6115    4                END;
      579     6116    4             ELSE DO;                      /* DO ERROR TEST */
      580     6117    4                  P$ = ADDR (NIL);
      581     6118    4                  CALL HFF$NIL (B$PS6$)
      582     6119    5                  WHENRETURN DO;
      583     6120        /*E*         ERROR: FSL-E$FPRG_ON_NON_GR-2
      584     6121                     MESSAGE: FPRG can't be specified with a non graphic form.
      585     6122                     MESSAGE1: The FPRG option can only be used with a graphic
      586     6123                              form specified in the LDEV.
      587     6124        */
      588     6125    5                       B$JIT.ERR = ERR$FPRG_ON_NON_GR;
      589     6126    5                       GOTO RETNOO;
      590     6127    5                     END;
      591     6128    5                  WHENALTRETURN DO;
      592     6129    5                     END;
      593     6130    4                END;
      594     6131    3             CALL SETDDF(PINCRW(FIT$,800));
      595     6132    3             AUTOFPT=CONSTOPN;
      596     6133    3             AUTOFPT.PROCATTR_=DEST$;
      597     6134    3             AUTOFPT.UATTR_=PINCRW(FIT$,800);
      598     6135    3             CALL FSF$SYMBFILE(FIT$,AUTOFPT,B$JIT$)ALTRET(RETNOO);
      599     6136    3             IF P$ ~= ADDR (NIL)
      600     6137    4             THEN DO;
      601     6138    4                  CALL FSA$FSP (SIZEW (AUTOFPRG), P$);
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:18   
      602     6139    4                END;
      603     6140    3           END;
      604     6141    3        ELSE DO;                           /* DO IF CONTFLG = '1'B */
      605     6142    3             IF FS$AUTODDF.LINES~=0 AND FS$AUTODDF.LINES<=
      606     6143    3                  FS$DESTWITH.FLINES THEN
      607     6144    3                  F$DCB.FORM$->CODE16.LINES=FS$AUTODDF.LINES;
      608     6145    3             IF FS$AUTODDF.WIDTH~=0 AND FS$AUTODDF.WIDTH<=
      609     6146    3                  FS$DESTWITH.FWIDTH THEN
      610     6147    3                  F$DCB.FORM$->CODE16.WIDTH=FS$AUTODDF.WIDTH;
      611     6148    3             IF FS$AUTODDF.DVFC~=BINASC(0) THEN
      612     6149    3                  F$DCB.FORM$->CODE16.DVFC=FS$AUTODDF.DVFC;
      613     6150    3             CALL FMD$GBUF(FIT$);
      614     6151    3             F$DCB.FUN=%UPDATE#;
      615     6152    3             CALL SETDDF(FIT$);
      616     6153    3             AUTOCLS=CONSTCLS;
      617     6154    3             AUTOCLS.PROCATTR_=DEST$;
      618     6155    3             AUTOCLS.UATTR_=FIT$;
      619     6156    3             CALL FMP$CLSF(AUTOCLS);
      620     6157    3           END;
      621     6158    2        CALL FMD$RBUF(FIT$);
      622     6159    2        SCRUBTO=1;
      623     6160    2        GOTO SCRUBIT;
      624     6161    2   RETNOO: CALL FMD$RBUF(FIT$);
      625     6162    2        SCRUBTO=0;
      626     6163    2   SCRUBIT:;
      627     6164    2        SAVERR=B$JIT.ERR;
      628     6165    2        CALL HFF$TRAPALT ALTRET(SAVERROR);
      629     6166    2        IF DEST$~=ADDR(NIL) THEN
      630     6167    2             CALL FSA$FSP(SIZEW(FS$DESTWITH),DEST$);
      631     6168    2        IF SCRUBTO=2 THEN
      632     6169    2             IF SDCB$=ADDR(NIL) THEN RETURN;
      633     6170    2             ELSE IF F$DCB.FCD THEN RETURN;
      634     6171    2                  ELSE CALL CLOSEM;
      635     6172    3        IF SCRUBTO=1 THEN DO;
      636     6173    4             IF SDCB$~=ADDR(NIL) THEN DO;
      637     6174    4                  IF F$DCB.FCD THEN
      638     6175    4                       CALL FMP$CLSF(CLOSE$STREAM$);
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:19   
      639     6176    5                  IF B$ROSEG.STREAMID.FLG(I)~=1 THEN DO;
      640     6177    5                       B$ROSEG.STREAMID.FLG(I)=1;
      641     6178    5                       CALL CHARBIN(J,ADDR(F$DCB.NAME)->OSFN.NUM);
      642     6179    5                       B$ROSEG.STREAMID.IDENT(I)=J;
      643     6180    5                       IF F$DCB.FORM$~=ADDR(NIL) THEN
      644     6181    5                            IF F$DCB.FORM$->CODE16.RECNO~=0 OR
      645     6182    5                                 F$DCB.FORM$->CODE16.PAGENO~=0 THEN
      646     6183    5                                 B$ROSEG.STREAMID.F01(I)='1'B;
      647     6184    5                     END;
      648     6185    4                  CALL FSA$FDCB(SDCB$);
      649     6186    4                  B$JIT.ERR=SAVERR;
      650     6187    4                  RETURN;
      651     6188    4                END;
      652     6189    3             ELSE IF B$ROSEG.STREAMID.FLG(I)=1 THEN RETURN;
      653     6190    3                  ELSE SCRUBTO=0;
      654     6191    3           END;
      655     6192    3        IF SCRUBTO=0 THEN DO;
      656     6193    4             IF SDCB$~=ADDR(NIL) THEN DO;
      657     6194    4                  IF F$DCB.FCD THEN
      658     6195    4                       CALL FMP$CLSF(CLOSESCRATCH$);
      659     6196    4                  CALL FSA$FDCB(SDCB$);
      660     6197    4                END;
      661     6198    3             B$ROSEG.STREAMID(I)='0'B;
      662     6199    3           END;
      663     6200    2   SAVERROR:
      664     6201    2        B$JIT.ERR=SAVERR;
      665     6202    2   RETN: RETURN;
      666     6203        /**/
      667     6204    2   CLOSEM: PROC;
      668     6205    3        J=B$ROSEG.NUMDCBS;
      669     6206    4        DO WHILE (J>=%M$MAXNEG#);
      670     6207    4             IF B$ROSEG.DCBPTR$->B$RODCB$(J)~=ADDR(NIL) THEN
      671     6208    4                  IF B$ROSEG.DCBPTR$->B$RODCB$(J)->F$DCB.CFU$=SDCB$ THEN
      672     6209    4                       IF B$ROSEG.DCBPTR$->B$RODCB$(J)->F$DCB.FCD THEN
      673     6210    4                            B$ROSEG.DCBPTR$->B$RODCB$(J)->F$DCB.FCD=%NO#;
      674     6211    4                       ELSE
      675     6212    4                            B$ROSEG.DCBPTR$->B$RODCB$(J)->F$DCB.CFU$=ADDR(NIL);
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:20   
      676     6213    4             J=J-1;
      677     6214    4           END;
      678     6215    3        SCRUBTO=1;
      679     6216    3        RETURN;
      680     6217    3   END CLOSEM;
      681     6218        /**/
      682     6219    2   TRUNKET: PROC;
      683     6220    4        IF FPT$LDEV_V.DELETE THEN DO;
      684     6221    4             CALL FSL$ACCT(SDCB$->F$DCB,'1'B);/*Acct Delete*/
      685     6222    4             IF ADDR(SDCB$->F$DCB.NAME)->OSFN.CNUM~='000' THEN
      686     6223    4                  CALL FSX$TELLOUTSYM(SDCB$->F$DCB,,1);
      687     6224    4             CALL FMP$CLSF(CLOSESCRATCH$);
      688     6225    4           END;
      689     6226    4        ELSE DO;
      690     6227    4             IF F$DCB.FORM$->CODE16.RECNO~=0 OR
      691     6228    5                  F$DCB.FORM$->CODE16.PAGENO~=0 THEN DO;
      692     6229    5                  CALL FSL$ACCT(SDCB$->F$DCB);
      693     6230    5                  CALL FMP$CLSF(CLOSE$STREAM$);
      694     6231    5                  CALL FSX$TELLOUTSYM(SDCB$->F$DCB);
      695     6232    5                END;
      696     6233    5             ELSE DO;
      697     6234    5                  CALL FMP$CLSF(CLOSESCRATCH$);
      698     6235    5                END;
      699     6236    4           END;
      700     6237    3        SCRUBTO=0;
      701     6238    3   END TRUNKET;
      702     6239        /**/
      703     6240    2   SETDDF: PROC(PTR$);
      704     6241    3   DCL PTR$ PTR;
      705     6242    3        PINCRW(PTR$,1)->FS$DDF=FS$AUTODDF;
      706     6243    3        PTR$->FS$DDFSZ.SEQ=F$DCB.SEQ;
      707     6244    3        PTR$->FS$DDFSZ.F.SEQ=F$DCB.SEQ;
      708     6245    4        IF PTR$->FS$DDFSZ.SEQ THEN DO;
      709     6246    4             PTR$->FS$DDFSZ.SEQID=F$DCB.SEQID;
      710     6247    4             PTR$->FS$DDFSZ.SEQCOL=F$DCB.SEQCOL;
      711     6248    4           END;
      712     6249    3        IF F$DCB.TAB$=ADDR(NIL) THEN
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:21   
      713     6250    3             PTR$->FS$DDFSZ.F.TAB='0'B;
      714     6251    4        ELSE DO;
      715     6252    4             PTR$->FS$DDFSZ.F.TAB='1'B;
      716     6253    4             PINCRW(PTR$,SIZEW(FS$DDFSZ))->VLP$TAB=F$DCB.TAB$->VLP$TAB;
      717     6254    4           END;
      718     6255    3        IF F$DCB.HEADER$=ADDR(NIL) THEN
      719     6256    3             PTR$->FS$DDFSZ.F.HDR='0'B;
      720     6257    4        ELSE DO;
      721     6258    4             PTR$->FS$DDFSZ.F.HDR='1'B;
      722     6259    5             IF F$DCB.HEADER$->VLP$HDRF.CTL.RESETPAGE# THEN DO;
      723     6260    5                  F$DCB.HEADER$->VLP$HDRF.CTL.RESETPAGE#='0'B;
      724     6261    5                  F$DCB.FORM$->CODE16.PAGEBASE=
      725     6262    5                       F$DCB.FORM$->CODE16.PAGENO;
      726     6263    5                END;
      727     6264    4             PINCRW(PTR$,SIZEW(FS$DDFSZ)+SIZEW(VLP$TAB))->VLP$HDRF=
      728     6265    4                  F$DCB.HEADER$->VLP$HDRF;
      729     6266    4           END;
      730     6267    3        PTR$->FS$DDFSZ.SIZ=SIZEW(FS$DDF)+SIZEW(VLP$TAB)+SIZEW(VLP$HDRF);
      731     6268    3        RETURN;
      732     6269    3   END SETDDF;
      733     6270    2   END DOASTREAM;
      734     6271    1   END FSL$LDEV;
      735     6272        %EOD;

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:22   
--  Include file information  --

   CP_6_SUBS.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B$TABLES_C.:E05TOU  cannot be made into a system file and is referenced.
   FS$FIT.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   FS_SUPER_C.:E05TOU  is referenced.
   F$CP6P_C.:E05TOU  is referenced.
   F_CP6.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  is referenced.
      No diagnostics issued in procedure FSL$LDEV.

   Procedure FSL$LDEV requires 1340 words for executable code.
   Procedure FSL$LDEV requires 82 words of local(AUTO) storage.

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:23   

 Object Unit name= FSL$LDEV                                   File name= FSL$LDEV.:E05TOU
 UTS= JUL 29 '97 17:34:07.08 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS    122    172  FSL$LDEV
    1   Proc  even  none  1340   2474  FSL$LDEV
    2  RoData even  none    35     43  FSL$LDEV

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        0  FSL$LDEV
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:24   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes          ~proc      0 B_POINTER
 yes     yes           Std       1 HFF$NIL
 yes     yes           Std       2 FSN$CONV_STR
         yes           Std       0 FSM$UCLDEV
 yes     yes           Std       1 HFF$NILERASE
         yes           Std       2 HFF$DSIZ
 yes     yes           Std       2 FSW$UCFORM
         yes           Std       1 FMD$GBUF
 yes     yes           Std       0 HFF$TRAPALT
         yes           Std       1 FMD$RBUF
         yes           Std       1 FSL$UC
 yes     yes           Std       1 FSB$STREAMDCB
 yes     yes           Std       2 FMO$LOCCODP
         yes           Std       1 FMP$CLSF
 yes     yes           Std       2 FSA$GSP
 yes     yes           Std       3 FSW$DESTFORM
 yes     yes           Std       1 HFF$ERASE
 yes     yes           Std       2 FSA$FSP
         yes           Std       1 FSA$FDCB
 yes     yes           Std       2 FMN$GETFIT
 yes     yes           Std       1 FSB$STREAMCREATE
 yes     yes           Std       3 FSF$SYMBFILE
 yes     yes           Std       2 FSW$FORM
         yes           Std       3 FSL$ACCT
         yes           Std       3 FSX$TELLOUTSYM
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:25   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_FSBADRO                       r    B$M$UC$                               B$PS0$
     B$PS1$                                B$PS2$                                B$PS3$
     B$PS4$                                B$PS6$                                B$ROSEG$
     B$JIT$                           r    B$XL_UPPER_UR$                        B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ASLENTSID
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:26   


        1        1        /*M* FSL$LDEV   Process the M$LDEV PMME.    */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR,PLM=5,IND=5,CTI=5,SDI=5,MCL=10,CSI=0,ECI=0 */
        8        8        /*P*    NAME: FSL$LDEV
        9        9                PURPOSE: Process the M$LDEV PMME.
       10       10         */
       11       11        /*F*    NAME: FSL$LDEV
       12       12                PURPOSE: Process  the M$LDEV PMME.
       13       13                   M$LDEV defines a logical device or changes some of
       14       14                   the parameters of a logical device definition or closes a
       15       15                   logical device for shipment or deletion.
       16       16                DESCRIPTION:  The basic operations performed by FSL$LDEV depend
       17       17                on whether the named logical device already exists, and on the
       18       18                values of the CONTINUE, SCRUB, REMOVE, and ERASE parameters
       19       19                of M$LDEV.
       20       20                   It is illegal to have SCRUB, REMOVE, or ERASE with
       21       21                CONTINUE.
       22       22                   CONTINUE -- If logical device does not exist or has no
       23       23                file, as if no CONTINUE specified.  Otherwise, update FIT
       24       24                of symbiont file with formatting parameters from M$LDEV.
       25       25                If file DCB is open, update the DCB too.  All done.
       26       26                   Not CONTINUE -- If logical device exists and its file is
       27       27                open, mark all user DCB's open to it closed.  If file not
       28       28                open, open it.  If not SCRUB or REMOVE, hang on to file's
       29       29                FIT.  If ERASE, close scratch; otherwise close save, do
       30       30                accounting and tell Outsym.
       31       31                If REMOVE, erase logical device name if not LP01, and we
       32       32                are done.
       33       33                   Get destination and formatting parameters from M$LDEV
       34       34                and add them to saved parameters if any.
       35       35                   Verify user access to workstation and workstation/device
       36       36                access to form.  Open new symbiont file.  Write banner if
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:27   
       37       37                any into file.  Close file. All done.
       38       38        */
       39       39        FSL$LDEV: PROC;

     39  1 000000   000000 700200 xent  FSL$LDEV     TSX0  ! X66_AUTO_0
         1 000001   000122 000000                    ZERO    82,0

       40       40
       41       41        /*** ENTRY REFERENCES ***/
       42       42    1   DCL FMN$GETFIT ENTRY(2)ALTRET;          /* Read FIT of disk file.*/
       43       43    1   DCL FMO$LOCCODP ENTRY(2)ALTRET;         /* Find entry in FIT.*/
       44       44    1   DCL FMP$CLSF ENTRY(1);                  /* Close a disk file DCB*/
       45       45    1   DCL FSA$GSP ENTRY(2)ALTRET;             /* Get ROSEG space.*/
       46       46    1   DCL FSA$FSP ENTRY(2)ALTRET;             /* Free ROSEG space.*/
       47       47    1   DCL FSA$FDCB ENTRY(1);                  /* Free a DCB's ROSEG space */
       48       48    1   DCL FSB$STREAMCREATE ENTRY(1)ALTRET;    /* Make DCB for symfile create.*/
       49       49    1   DCL FSB$STREAMDCB ENTRY(1)ALTRET;       /* Open symb. file update.*/
       50       50    1   DCL FSL$ACCT ENTRY(3);                  /* Account for symbiont files.*/
       51       51    1   DCL FSL$UC ENTRY(1);
       52       52    1   DCL FSM$UCLDEV ENTRY;                   /* Do Tabs & Header for LDEV UC.*/
       53       53    1   DCL FSN$CONV_STR ENTRY(2) ALTRET;
       54       54    1   DCL FSX$TELLOUTSYM ENTRY(3);
       55       55    1   DCL HFF$NIL ENTRY(1)ALTRET;             /* Is vector NIL?*/
       56       56    1   DCL HFF$ERASE ENTRY(1)ALTRET;           /* Is vector ERASE?*/
       57       57    1   DCL HFF$NILERASE ENTRY(1)ALTRET;        /* Is vector NIL/ERASE?*/
       58       58    1   DCL HFF$DSIZ ENTRY(2);                  /* Find size of vector.*/
       59       59    1   DCL HFF$TRAPALT ENTRY ALTRET;           /* Get control of trap conditions */
       60       60    1   DCL FMD$GBUF ENTRY(1);                  /* Steal a File-Management buffer. */
       61       61    1   DCL FMD$RBUF ENTRY(1);                  /* Return a Stolen File Mgmt buffer. */
       62       62    1   DCL FMH$SYMB_FINISH ENTRY (3) ALTRET;
       63       63    1   DCL FSW$DESTFORM ENTRY(3)ALTRET;
       64       64    1   DCL FSW$FORM ENTRY(2)ALTRET;
       65       65    1   DCL FSW$UCFORM ENTRY(2)ALTRET;
       66       66    1   DCL FSF$SYMBFILE ENTRY(3)ALTRET;
       67       67    1   DCL SC_FSBADRO ENTRY CONV(2,0);
       68       68
       69       69        /*** DATA REFERENCES ***/
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:28   
       70       70    1   DCL B$M$UC$ PTR SYMREF READONLY;
       71       71    1   DCL B$PS0$ PTR SYMREF;                  /*->V area of LDEV FPT*/
       72       72    1   DCL B$PS1$ PTR SYMREF;                  /*->TAB area of LDEV FPT*/
       73       73    1   DCL B$PS2$ PTR SYMREF;                  /*->HDR area of LDEV FPT*/
       74       74    1   DCL B$PS3$ PTR SYMREF;                  /*->WSN area of LDEV FPT*/
       75       75    1   DCL B$PS4$ PTR SYMREF;                  /*->FORM area of LDEV FPT*/
       76       76    1   DCL B$PS5$ PTR SYMREF;                  /*->WINDOW area of LDEV FPT*/
       77       77    1   DCL B$PS6$ PTR SYMREF;                  /*->FPRG area of LDEV FPT*/
       78       78    1   DCL B$ROSEG$ PTR SYMREF;
       79       79    1   DCL B$JIT$ PTR SYMREF;                  /* Note that B$JIT is BASED(B$JIT$).  */
       80       80        %MACRO B$ROSEG(BASED=BASED);
       81       81        %INCLUDE B$ROSEG;
       82      144        %MEND;
       83      145        %B$ROSEG(BASED="BASED(B$ROSEG$)");
       84      205        %INCLUDE F$JIT_C;
       85      635        %MACRO F$DCBI(BASED=BASED);
       86      636        %INCLUDE F$DCB;
       87      685        %MEND;
       88      686        %F$DCBI(BASED="BASED(SDCB$)");
       89      736        %INCLUDE F$CP6V_C;
       90      962        %FPT$LDEV_V(BASED="BASED(B$PS0$)");
       91      968        %INCLUDE F_CP6;
       92     1993        %INCLUDE F$CP6P_C;
       93     2004        %INCLUDE FS_SUPER_C;
       94     2767        %FS$FORMREC;
       95     2838        %VLP_TAB(FPTN=VLP$TAB,STCLASS=BASED);
       96     2852        %VLP_HDR(FPTN=VLP$HDRF,STCLASS=BASED,LEN=160);
       97     2868        %VLP_WSN(FPTN=VLP$WSN,STCLASS="BASED(B$PS3$)");
       98     2881        %VLP_FORM(FPTN=VLP$FORM,STCLASS="BASED(B$PS4$)");
       99     2894        %INCLUDE KI_CP6;
      100     3990        %VLP_FPRG (FPTN=AUTOFPRG, LVL=1, STCLASS=);
      101     4011        %VLP_FPRG (FPTN=CODE17, LVL=1, STCLASS=BASED);
      102     4032        %INCLUDE F_ERRORS_C;
      103     4272        %INCLUDE FS$FIT;
      104     4315        %INCLUDE B$TABLES_C;
      105     4423        %B$XL_UPPER_UR;
      106     4427        %FS$DEST;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:29   
      107     4435        %FS$DEST(NAME=FS$DESTWITH,STCLASS="BASED(DEST$)",SIZ=FIT);
      108     4443        %FS_OSFN(FPTN=OSFN,STCLASS=BASED);
      109     4457    1   DCL CHARJ CHAR(J)BASED;                 /* Move chars, blank fill. */
      110     4458    1   DCL 1 BCHARJ BASED,2 * CHAR(J);         /* Move chars zero fill. */
      111     4459    1   DCL 1 BCHARTAB BASED, 2 * CHAR(PL6ISDUMB);
      112     4460    1   DCL PL6ISDUMB UBIN CONSTANT INIT(SIZEC(VLP$TAB));
      113     4461        %FPT_OPEN(FPTN=CONSTOPN,STCLASS=CONSTANT,PFMT=PTR,VECTOR=ADDR);
      114     4570        %FPT_CLOSE(FPTN=CONSTCLS,STCLASS=CONSTANT,PFMT=PTR,VECTOR=ADDR,
      115     4571                CHGATT=YES);
      116     4613        %FPT_CLOSE(FPTN=CLOSE$STREAM$,PFMT=PTR,VECTOR=ADDR,STCLASS=CONSTANT);
      117     4655        %FPT_CLOSE(FPTN=CLOSESCRATCH$,PFMT=PTR,VECTOR=ADDR,STCLASS=CONSTANT,
      118     4656                DISP=SCRATCH);
      119     4698        %SUB FCG#="'0623'O";
      120     4699        %SUB MID#="'14'O";
      121     4700        %INCLUDE FM$MACROS;
      122     5075        %FM$GRAN;
      123     5079        %CODE16;
      124     5087        %ERRCODE (NAME=ERR$INCONSIS,COD#=%E$LDEVINCONS);
      125     5091        %ERRCODE (NAME=ERR$LDEVSNAME,COD#=%E$LDEVSNAME);
      126     5095        %ERRCODE (NAME=ERR$LDEVNOSTREAMS,COD#=%E$LDEVNOSTREAMS);
      127     5099        %ERRCODE (NAME=ERR$INVDEV,COD#=%E$INVDEV);
      128     5103        %ERRCODE (NAME=ERR$CANT_USE_TEMP_STREAM,COD#=%E$CANT_USE_TEMP_STREAM);
      129     5107        %ERRCODE (NAME=ERR$FPRG_ON_NON_GR,COD#=%E$FPRG_ON_NON_GR);
      130     5111        %INCLUDE CP_6_SUBS;
      131     5651    1   DCL I UBIN;                             /* Logical Device index (0 to 15) */
      132     5652    1   DCL J SBIN;                             /* Miscellaneous uses                 */
      133     5653    1   DCL TEMPSTR  UBIN BYTE;       /*  Temp for stream returned from FSN$CONV_STR  */
      134     5654    1   DCL SDCB$ PTR;                     /* Points to stream's DCB when necessary   */
      135     5655    1   DCL DEST$ PTR;                     /* Preserves destination across file close.*/
      136     5656    1   DCL FIT$ PTR;
      137     5657    1   DCL P$ PTR;
      138     5658    1   DCL CONTFLG BIT(1);
      139     5659    1   DCL SCRUBTO UBIN;
      140     5660    1   DCL SAVERR BIT(36);
      141     5661    1   DCL UC_STR BIT(1);
      142     5662        %FPT$OPEN_P(FPTN=AUTOFPT,STCLASS=,PFMT=PTR);
      143     5668        %FPT$CLOSE_P(FPTN=AUTOCLS,STCLASS=,PFMT=PTR);
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:30   
      144     5672        %FS$LDEVDDF(NAME=FS$AUTODDF,STCLASS=);
      145     5676        %FS$LDEVDDF(NAME=FS$DDF,STCLASS=BASED);
      146     5680        %FS$LDEVDDF(NAME=FS$DDFSZ,STCLASS=BASED,SIZ=FIT);
      147     5684    1   DCL LNAME CHAR(4);                      /*Holds logical dev name during setup*/
      148     5685        /*      Logical Device names in the LDEV FPT may be --
      149     5686                'ALL '
      150     5687                'Ln  ' or 'Pn  ', n a digit.
      151     5688                'ddnn', d alpanumeric and n a digit.
      152     5689                'UC  ' or 'M$UC'.
      153     5690                LNAMECHARS is alphanumeric characters.
      154     5691                LNAMEDD.CHR is digit characters.
      155     5692        */
      156     5693    1   DCL LNAMECHARS CHAR(36)CONSTANT INIT
      157     5694    1           ('0123456789LPCABDEFGHIJKMNOQRSTUVWXYZ');
      158     5695    1   DCL 1 LNAMEDD REDEF LNAMECHARS,
      159     5696    1            2 CHR CHAR(10), 2 LETTERS CHAR(26);
      160     5697        %EJECT;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:31   
      161     5698        /*
      162     5699                   First verify that parameters are consistent.  CONTINUE
      163     5700                is not allowed to change destination attributes.
      164     5701        */
      165     5702    1        UC_STR = '0'B;

   5702  1 000002   200040 450100                    STZ     UC_STR,,AUTO

      166     5703    2        IF FPT$LDEV_V.CONTINUE THEN DO;

   5703  1 000003   000000 470400 xsym               LDP0    B$PS0$
         1 000004   000001 234100                    SZN     1,,PR0
         1 000005   000050 605000 1                  TPL     s:5736

      167     5704    2             IF NOT(FPT$LDEV_V.SCRUB OR FPT$LDEV_V.REMOVE OR

   5704  1 000006   000001 236100                    LDQ     1,,PR0
         1 000007   200000 316003                    CANQ    65536,DU
         1 000010   000050 601000 1                  TNZ     s:5736
         1 000011   100000 316003                    CANQ    32768,DU
         1 000012   000050 601000 1                  TNZ     s:5736
         1 000013   040000 316003                    CANQ    16384,DU
         1 000014   000050 601000 1                  TNZ     s:5736

      168     5705    2                  FPT$LDEV_V.DELETE) THEN
      169     5706    2                  IF FPT$LDEV_V.DEV='  ' THEN

   5706  1 000015   000001 720100                    LXL0    1,,PR0
         1 000016   000157 100000 0                  CMPX0   LNAMECHARS+9
         1 000017   000050 601000 1                  TNZ     s:5736

      170     5707    2                       CALL HFF$NIL(B$PS3$)

   5707  1 000020   000000 630400 2                  EPPR0   0
         1 000021   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000022   000000 701000 xent               TSX1    HFF$NIL
         1 000023   000030 702000 1                  TSX2    s:5713
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:32   

      171     5708    3                       WHENRETURN DO;

      172     5709    3                            B$JIT.ERR = ERR$INCONSIS;

   5709  1 000024   000140 236000 0                  LDQ     ERR$INCONSIS
         1 000025   000000 470400 xsym               LDP0    B$JIT$
         1 000026   000012 756100                    STQ     10,,PR0

      173     5710    3                            RETURN;

   5710  1 000027   000000 702200 xent               TSX2  ! X66_ARET

      174     5711    3                          END;
      175     5712    3                       WHENALTRETURN DO;

      176     5713    3                            CALL HFF$NIL(B$PS4$)

   5713  1 000030   000001 630400 2                  EPPR0   1
         1 000031   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000032   000000 701000 xent               TSX1    HFF$NIL
         1 000033   000040 702000 1                  TSX2    s:5719

      177     5714    4                            WHENRETURN DO;

      178     5715    4                                 B$JIT.ERR=ERR$INCONSIS;

   5715  1 000034   000140 236000 0                  LDQ     ERR$INCONSIS
         1 000035   000000 470400 xsym               LDP0    B$JIT$
         1 000036   000012 756100                    STQ     10,,PR0

      179     5716    4                                 RETURN;

   5716  1 000037   000000 702200 xent               TSX2  ! X66_ARET

      180     5717    4                               END;
      181     5718    4                            WHENALTRETURN DO;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:33   

      182     5719    4                                 CALL HFF$NIL (B$PS6$)

   5719  1 000040   000002 630400 2                  EPPR0   2
         1 000041   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000042   000000 701000 xent               TSX1    HFF$NIL
         1 000043   000050 702000 1                  TSX2    s:5736

      183     5720    5                                 WHENRETURN DO;

      184     5721    5                                      B$JIT.ERR = ERR$INCONSIS;

   5721  1 000044   000140 236000 0                  LDQ     ERR$INCONSIS
         1 000045   000000 470400 xsym               LDP0    B$JIT$
         1 000046   000012 756100                    STQ     10,,PR0

      185     5722        /*E*    ERROR: FSL-E$LDEVINCONS-2
      186     5723                MESSAGE: Inconsistent options for LDEV.
      187     5724                MESSAGE1: The LDEV option CONTINUE is inconsistent with the
      188     5725                      SCRUB, REMOVE, and ERASE options or with a change of
      189     5726                      destination, FPRG, or form name.
      190     5727        */
      191     5728    5                                      RETURN;

   5728  1 000047   000000 702200 xent               TSX2  ! X66_ARET

      192     5729    5                                    END;
      193     5730    5                                 WHENALTRETURN DO;

      194     5731    5                                    END;

      195     5732    4                               END;

      196     5733    3                          END;

      197     5734    2           END;

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:34   
      198     5735        /* Check if from stream is legal */
      199     5736    1        IF FPT$LDEV_V.FRMSTRM ~= '  '

   5736  1 000050   000000 470400 xsym               LDP0    B$PS0$
         1 000051   040000 106500                    CMPC    fill='040'O
         1 000052   000005 200002                    ADSC9   5,,PR0                   cn=1,n=2
         1 000053   000157 000002 0                  ADSC9   LNAMECHARS+9             cn=0,n=2
         1 000054   000130 600000 1                  TZE     s:5775

      200     5737    1        THEN
      201     5738    1             IF FPT$LDEV_V.DEV = 'UC'

   5738  1 000055   000001 720100                    LXL0    1,,PR0
         1 000056   000160 100000 0                  CMPX0   LNAMECHARS+10
         1 000057   000130 601000 1                  TNZ     s:5775

      202     5739    2             THEN DO;

      203     5740    2                  CALL INDEX(I,SUBSTR(FPT$LDEV_V.FRMSTRM,0,1),'0123456789')

   5740  1 000060   000100 124400                    SCM     mask='000'O
         1 000061   000161 000012 0                  ADSC9   LNAMECHARS+11            cn=0,n=10
         1 000062   000005 200001                    ADSC9   5,,PR0                   cn=1,n=1
         1 000063   200026 000100                    ARG     I,,AUTO
         1 000064   000066 606400 1                  TTN     ILLGL_DEV
         1 000065   000072 710000 1                  TRA     s:5749

      204     5741    3                  WHENALTRETURN DO;

   5740  1 000066                       ILLGL_DEV    null
      205     5742    3   ILLGL_DEV:          ;
      206     5743    3                       B$JIT.ERR = ERR$INVDEV;

   5743  1 000066   000143 236000 0                  LDQ     ERR$INVDEV
         1 000067   000000 470400 xsym               LDP0    B$JIT$
         1 000070   000012 756100                    STQ     10,,PR0

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:35   
      207     5744                       /*E* ERROR: FSL-E$INVDEV-2
      208     5745                            MESSAGE: Illegal device name specified for from stream.
      209     5746         */
      210     5747    3                       RETURN;

   5747  1 000071   000000 702200 xent               TSX2  ! X66_ARET

      211     5748    3                     END;
      212     5749    2                  CALL INDEX(I,SUBSTR(FPT$LDEV_V.FRMSTRM,1,1),'0123456789') ALTRET(
              5749                           ILLGL_DEV);

   5749  1 000072   000100 124400                    SCM     mask='000'O
         1 000073   000161 000012 0                  ADSC9   LNAMECHARS+11            cn=0,n=10
         1 000074   000005 400001                    ADSC9   5,,PR0                   cn=2,n=1
         1 000075   200026 000100                    ARG     I,,AUTO
         1 000076   000066 606400 1                  TTN     ILLGL_DEV

      213     5750    2                  CALL CONCAT (LNAME,'UC',FPT$LDEV_V.FRMSTRM);

   5750  1 000077   000160 220000 0                  LDX0    LNAMECHARS+10
         1 000100   200106 740100                    STX0    LNAME,,AUTO
         1 000101   040100 100500                    MLR     fill='040'O
         1 000102   000005 200002                    ADSC9   5,,PR0                   cn=1,n=2
         1 000103   200116 000004                    ADSC9   @PTR$+1,,AUTO            cn=0,n=4
         1 000104   200116 221100                    LDX1    @PTR$+1,,AUTO
         1 000105   200106 441100                    SXL1    LNAME,,AUTO

      214     5751    2                  CALL FSN$CONV_STR(LNAME,TEMPSTR)

   5751  1 000106   200030 630500                    EPPR0   TEMPSTR,,AUTO
         1 000107   200117 450500                    STP0    @PTR$+2,,AUTO
         1 000110   200106 631500                    EPPR1   LNAME,,AUTO
         1 000111   200116 451500                    STP1    @PTR$+1,,AUTO
         1 000112   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 000113   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000114   000000 701000 xent               TSX1    FSN$CONV_STR
         1 000115   000127 702000 1                  TSX2    s:5764
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:36   

      215     5752    3                  WHENRETURN DO;

      216     5753    4                       IF TEMPSTR > 20 THEN DO;

   5753  1 000116   200030 236100                    LDQ     TEMPSTR,,AUTO
         1 000117   777000 376003                    ANQ     -512,DU
         1 000120   025000 116003                    CMPQ    10752,DU
         1 000121   000126 602000 1                  TNC     s:5760+1

      217     5754    4                            B$JIT.ERR = ERR$CANT_USE_TEMP_STREAM;

   5754  1 000122   000144 236000 0                  LDQ     ERR$CANT_USE_TEMP_STREAM
         1 000123   000000 470400 xsym               LDP0    B$JIT$
         1 000124   000012 756100                    STQ     10,,PR0

      218     5755                       /*E* ERROR:  FSL-E$CANT_USE_TEMP_STREAM-2
      219     5756                            MESSAGE:  You cannot create this stream.
      220     5757                            MESSAGE1:  You cannot create a permanent LDEV
      221     5758                                       stream from a temporary stream.
      222     5759                       */
      223     5760    4                            RETURN;

   5760  1 000125   000000 702200 xent               TSX2  ! X66_ARET
         1 000126   000130 710000 1                  TRA     s:5775

      224     5761    4                          END;             /*  TEMPSTR > 20  */
      225     5762    3                     END;                  /*  WHENRETURN  */
      226     5763    3                  WHENALTRETURN DO;

      227     5764    3                       RETURN;

   5764  1 000127   000000 702200 xent               TSX2  ! X66_ARET

      228     5765    3                     END;
      229     5766    2                END;

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:37   
      230     5767        /*
      231     5768                   Verify that Logical Device name is properly formed.
      232     5769                Acceptable names are --
      233     5770                'ddnn' with dd alphanumeric and nn digits.
      234     5771                'LP  ', 'CP  ' or 'GR  ', abbrev for 'LP01', 'CP01' or 'GR01'.
      235     5772                'ALL ', means do all defined logical devices.
      236     5773                'UC  ', means operate on T/S terminal.
      237     5774        */
      238     5775    1        CALL XLATE ( LNAME, B$XL_UPPER_UR, FPT$LDEV_V.STREAMNAME );

   5775  1 000130   000000 470400 xsym               LDP0    B$PS0$
         1 000131   000000 471400 xsym               LDP1    B$XL_UPPER_UR$
         1 000132   040100 160500                    MVT     fill='040'O
         1 000133   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 000134   200106 000004                    ADSC9   LNAME,,AUTO              cn=0,n=4
         1 000135   100000 000100                    ARG     0,,PR1

      239     5776    1        CALL INDEX(I,' ',LNAME);

   5776  1 000136   000000 124500                    SCM     mask='000'O
         1 000137   200106 000004                    ADSC9   LNAME,,AUTO              cn=0,n=4
         1 000140   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000141   200026 000100                    ARG     I,,AUTO

      240     5777    2        DO CASE(I);

   5777  1 000142   200026 235100                    LDA     I,,AUTO
         1 000143   000005 115007                    CMPA    5,DL
         1 000144   000146 602005 1                  TNC     s:5777+4,AL
         1 000145   000235 710000 1                  TRA     BADLNM
         1 000146   000235 710000 1                  TRA     BADLNM
         1 000147   000235 710000 1                  TRA     BADLNM
         1 000150   000160 710000 1                  TRA     s:5781
         1 000151   000153 710000 1                  TRA     s:5779
         1 000152   000203 710000 1                  TRA     s:5789

      241     5778    2        CASE(3);
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:38   

      242     5779    2           IF LNAME='ALL' THEN GOTO ALLLOGDEV;

   5779  1 000153   040000 106500                    CMPC    fill='040'O
         1 000154   200106 000004                    ADSC9   LNAME,,AUTO              cn=0,n=4
         1 000155   000164 000003 0                  ADSC9   LNAMECHARS+14            cn=0,n=3
         1 000156   000241 600000 1                  TZE     ALLLOGDEV
         1 000157   000235 710000 1                  TRA     BADLNM

      243     5780    2        CASE(2);

      244     5781    2           IF LNAME='UC' THEN GOTO MUCLOGDEV;

   5781  1 000160   040000 106500                    CMPC    fill='040'O
         1 000161   200106 000004                    ADSC9   LNAME,,AUTO              cn=0,n=4
         1 000162   000160 000002 0                  ADSC9   LNAMECHARS+10            cn=0,n=2
         1 000163   000261 600000 1                  TZE     MUCLOGDEV

      245     5782    2           IF LNAME='LP' OR

   5782  1 000164   040000 106500                    CMPC    fill='040'O
         1 000165   200106 000004                    ADSC9   LNAME,,AUTO              cn=0,n=4
         1 000166   000165 000002 0                  ADSC9   LNAMECHARS+15            cn=0,n=2
         1 000167   000200 600000 1                  TZE     s:5785
         1 000170   040000 106500                    CMPC    fill='040'O
         1 000171   200106 000004                    ADSC9   LNAME,,AUTO              cn=0,n=4
         1 000172   000166 000002 0                  ADSC9   LNAMECHARS+16            cn=0,n=2
         1 000173   000200 600000 1                  TZE     s:5785
         1 000174   040000 106500                    CMPC    fill='040'O
         1 000175   200106 000004                    ADSC9   LNAME,,AUTO              cn=0,n=4
         1 000176   000167 000002 0                  ADSC9   LNAMECHARS+17            cn=0,n=2
         1 000177   000235 601000 1                  TNZ     BADLNM

      246     5783    2                LNAME='CP' OR
      247     5784    3                LNAME='GR' THEN DO;

      248     5785    3                CALL INSERT(LNAME,2,2,'01');
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:39   

   5785  1 000200   000161 220000 0                  LDX0    LNAMECHARS+11
         1 000201   200106 440100                    SXL0    LNAME,,AUTO

      249     5786    3                GOTO ONELOGDEV;

   5786  1 000202   000362 710000 1                  TRA     ONELOGDEV

      250     5787    3              END;
      251     5788    2        CASE(4);

      252     5789    2           CALL INDEX(I,SUBSTR(LNAME,0,1),LNAMEDD.LETTERS)ALTRET(BADLNM);

   5789  1 000203   000100 124400                    SCM     mask='000'O
         1 000204   000150 400032 0                  ADSC9   LNAMECHARS+2             cn=2,n=26
         1 000205   200106 000001                    ADSC9   LNAME,,AUTO              cn=0,n=1
         1 000206   200026 000100                    ARG     I,,AUTO
         1 000207   000235 606400 1                  TTN     BADLNM

      253     5790    2           CALL INDEX(I,SUBSTR(LNAME,1,1),LNAMEDD.LETTERS)ALTRET(BADLNM);

   5790  1 000210   000100 124400                    SCM     mask='000'O
         1 000211   000150 400032 0                  ADSC9   LNAMECHARS+2             cn=2,n=26
         1 000212   200106 200001                    ADSC9   LNAME,,AUTO              cn=1,n=1
         1 000213   200026 000100                    ARG     I,,AUTO
         1 000214   000235 606400 1                  TTN     BADLNM

      254     5791    2           CALL INDEX(I,SUBSTR(LNAME,2,1),LNAMEDD.CHR)ALTRET(BADLNM);

   5791  1 000215   000100 124400                    SCM     mask='000'O
         1 000216   000146 000012 0                  ADSC9   LNAMECHARS               cn=0,n=10
         1 000217   200106 400001                    ADSC9   LNAME,,AUTO              cn=2,n=1
         1 000220   200026 000100                    ARG     I,,AUTO
         1 000221   000235 606400 1                  TTN     BADLNM

      255     5792    2           CALL INDEX(I,SUBSTR(LNAME,3,1),LNAMEDD.CHR)ALTRET(BADLNM);

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:40   
   5792  1 000222   000100 124400                    SCM     mask='000'O
         1 000223   000146 000012 0                  ADSC9   LNAMECHARS               cn=0,n=10
         1 000224   200106 600001                    ADSC9   LNAME,,AUTO              cn=3,n=1
         1 000225   200026 000100                    ARG     I,,AUTO
         1 000226   000235 606400 1                  TTN     BADLNM

      256     5793    2           IF SUBSTR(LNAME,0,2) = 'UC'

   5793  1 000227   200106 220100                    LDX0    LNAME,,AUTO
         1 000230   000160 100000 0                  CMPX0   LNAMECHARS+10
         1 000231   000234 601000 1                  TNZ     s:5796

      257     5794    2           THEN
      258     5795    2                UC_STR = '1'B;

   5795  1 000232   400000 236003                    LDQ     -131072,DU
         1 000233   200040 756100                    STQ     UC_STR,,AUTO

      259     5796    2           GOTO ONELOGDEV;

   5796  1 000234   000362 710000 1                  TRA     ONELOGDEV

      260     5797    2        END;

      261     5798    1   BADLNM: B$JIT.ERR=ERR$LDEVSNAME;

   5798  1 000235   000141 236000 0     BADLNM       LDQ     ERR$LDEVSNAME
         1 000236   000000 470400 xsym               LDP0    B$JIT$
         1 000237   000012 756100                    STQ     10,,PR0

      262     5799        /*E*    ERROR:   FSL-E$LDEVSNAME-2
      263     5800                MESSAGE: Illegal Logical Device name on LDEV.
      264     5801                MESSAGE1:   Logical Device names must be four characters
      265     5802                      long:  two letters followed by two digits.  Acceptable
      266     5803                      abbreviations are 'LP' for 'LP01', 'CP' for 'CP01',
      267     5804                      and 'GR' for 'GR01' to reference individual devices,
      268     5805                      and 'ALL' to mean all defined logical devices.
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:41   
      269     5806                      The name 'UC' refers to interactive user terminal.
      270     5807        */
      271     5808    1        RETURN;

   5808  1 000240   000000 702200 xent               TSX2  ! X66_ARET

   5792  1 000241                       ALLLOGDEV    null
      272     5809    1   ALLLOGDEV:;
      273     5810    2        DO I=0 TO 15;

   5810  1 000241   200026 450100                    STZ     I,,AUTO

      274     5811    2             IF B$ROSEG.STREAMID.FLG(I)~=0 AND NOT B$ROSEG.STREAMID.UC_STR(I)

   5811  1 000242   000000 470400 xsym               LDP0    B$ROSEG$
         1 000243   200026 720100                    LXL0    I,,AUTO
         1 000244   000074 236110                    LDQ     60,X0,PR0
         1 000245   600000 316003                    CANQ    -65536,DU
         1 000246   000253 600000 1                  TZE     s:5814
         1 000247   000001 316003                    CANQ    1,DU
         1 000250   000253 601000 1                  TNZ     s:5814

      275     5812    2             THEN
      276     5813    2                  CALL DOASTREAM;

   5813  1 000251   000465 701000 1                  TSX1    DOASTREAM
         1 000252   000000 011000                    NOP     0

      277     5814    2           END;

   5814  1 000253   200026 235100                    LDA     I,,AUTO
         1 000254   000001 035007                    ADLA    1,DL
         1 000255   200026 755100                    STA     I,,AUTO
         1 000256   000020 115007                    CMPA    16,DL
         1 000257   000242 602000 1                  TNC     s:5811

      278     5815    1        RETURN;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:42   

   5815  1 000260   000000 702200 xent               TSX2  ! X66_ARET

   5810  1 000261                       MUCLOGDEV    null
      279     5816    1   MUCLOGDEV:;
      280     5817    1        SDCB$=B$M$UC$;

   5817  1 000261   000000 236000 xsym               LDQ     B$M$UC$
         1 000262   200031 756100                    STQ     SDCB$,,AUTO

      281     5818    1        IF NOT F$DCB.FCD OR F$DCB.ASN~=%DEVICE# OR

   5818  1 000263   200031 473500                    LDP3    SDCB$,,AUTO
         1 000264   300031 236100                    LDQ     25,,PR3
         1 000265   020000 316007                    CANQ    8192,DL
         1 000266   000235 600000 1                  TZE     BADLNM
         1 000267   300032 236100                    LDQ     26,,PR3
         1 000270   777000 376007                    ANQ     -512,DL
         1 000271   003000 116007                    CMPQ    1536,DL
         1 000272   000235 601000 1                  TNZ     BADLNM
         1 000273   040000 106500                    CMPC    fill='040'O
         1 000274   300026 000004                    ADSC9   22,,PR3                  cn=0,n=4
         1 000275   000160 000002 0                  ADSC9   LNAMECHARS+10            cn=0,n=2
         1 000276   000235 601000 1                  TNZ     BADLNM
         1 000277   300004 236100                    LDQ     4,,PR3
         1 000300   100000 316007                    CANQ    32768,DL
         1 000301   000235 600000 1                  TZE     BADLNM

      282     5819    1             F$DCB.RES~='UC' OR NOT F$DCB.DDEV.IC THEN
      283     5820    1             GOTO BADLNM;
      284     5821    1        B$JIT.DCB$=SDCB$;

   5821  1 000302   200031 236100                    LDQ     SDCB$,,AUTO
         1 000303   000000 474400 xsym               LDP4    B$JIT$
         1 000304   400232 756100                    STQ     154,,PR4

      285     5822    1        CALL HFF$NILERASE(B$PS4$)ALTRET(UCRET);
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:43   

   5822  1 000305   000001 630400 2                  EPPR0   1
         1 000306   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000307   000000 701000 xent               TSX1    HFF$NILERASE
         1 000310   000356 702000 1                  TSX2    UCRET

      286     5823    1        CALL HFF$DSIZ(B$PS4$,J);

   5823  1 000311   200027 630500                    EPPR0   J,,AUTO
         1 000312   200117 450500                    STP0    @PTR$+2,,AUTO
         1 000313   000001 236000 2                  LDQ     1
         1 000314   200116 756100                    STQ     @PTR$+1,,AUTO
         1 000315   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 000316   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000317   000000 701000 xent               TSX1    HFF$DSIZ
         1 000320   000000 011000                    NOP     0

      287     5824    1        F$DCB.PSN=B$PS4$->CHARJ;

   5824  1 000321   000000 470400 xsym               LDP0    B$PS4$
         1 000322   200027 720100                    LXL0    J,,AUTO
         1 000323   200031 471500                    LDP1    SDCB$,,AUTO
         1 000324   040100 100540                    MLR     fill='040'O
         1 000325   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         1 000326   100024 000006                    ADSC9   20,,PR1                  cn=0,n=6

      288     5825    1        CALL FMD$GBUF(FIT$);

   5825  1 000327   200033 631500                    EPPR1   FIT$,,AUTO
         1 000330   200116 451500                    STP1    @PTR$+1,,AUTO
         1 000331   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 000332   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000333   000000 701000 xent               TSX1    FMD$GBUF
         1 000334   000000 011000                    NOP     0

      289     5826    1        CALL HFF$TRAPALT ALTRET(UCRBRET);

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:44   
   5826  1 000335   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000336   000000 701000 xent               TSX1    HFF$TRAPALT
         1 000337   000350 702000 1                  TSX2    UCRBRET

      290     5827    1        CALL FSW$UCFORM(,FIT$)ALTRET(UCRBRET);

   5827  1 000340   200033 630500                    EPPR0   FIT$,,AUTO
         1 000341   200117 450500                    STP0    @PTR$+2,,AUTO
         1 000342   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000343   200116 756100                    STQ     @PTR$+1,,AUTO
         1 000344   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 000345   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000346   000000 701000 xent               TSX1    FSW$UCFORM
         1 000347   000350 702000 1                  TSX2    UCRBRET

      291     5828    1   UCRBRET: CALL FMD$RBUF(FIT$);

   5828  1 000350   200033 630500       UCRBRET      EPPR0   FIT$,,AUTO
         1 000351   200116 450500                    STP0    @PTR$+1,,AUTO
         1 000352   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 000353   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000354   000000 701000 xent               TSX1    FMD$RBUF
         1 000355   000000 011000                    NOP     0

      292     5829    1   UCRET: CALL FSM$UCLDEV;

   5829  1 000356   000002 631400 xsym  UCRET        EPPR1   B_VECTNIL+2
         1 000357   000000 701000 xent               TSX1    FSM$UCLDEV
         1 000360   000000 011000                    NOP     0

      293     5830    1        RETURN;

   5830  1 000361   000000 702200 xent               TSX2  ! X66_ARET

   5824  1 000362                       ONELOGDEV    null
      294     5831        /*
      295     5832                We have a Logical Device name which is not 'ALL'.
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:45   
      296     5833                See if it is defined; if so, perform the LDEV.
      297     5834         */
      298     5835    1   ONELOGDEV:;
      299     5836    2        DO I=0 TO 15;

   5836  1 000362   200026 450100                    STZ     I,,AUTO

      300     5837    3             IF B$ROSEG.LDEVNAME(I)=LNAME THEN DO;

   5837  1 000363   000000 470400 xsym               LDP0    B$ROSEG$
         1 000364   200026 720100                    LXL0    I,,AUTO
         1 000365   000054 236110                    LDQ     44,X0,PR0
         1 000366   200106 116100                    CMPQ    LNAME,,AUTO
         1 000367   000404 601000 1                  TNZ     s:5845

      301     5838    3                  IF UC_STR

   5838  1 000370   200040 234100                    SZN     UC_STR,,AUTO
         1 000371   000401 605000 1                  TPL     s:5842

      302     5839    3                  THEN
      303     5840    3                       CALL FSL$UC(I);

   5840  1 000372   200026 631500                    EPPR1   I,,AUTO
         1 000373   200116 451500                    STP1    @PTR$+1,,AUTO
         1 000374   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 000375   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000376   000000 701000 xent               TSX1    FSL$UC
         1 000377   000000 011000                    NOP     0
         1 000400   000403 710000 1                  TRA     s:5843

      304     5841    3                  ELSE
      305     5842    3                       CALL DOASTREAM;

   5842  1 000401   000465 701000 1                  TSX1    DOASTREAM
         1 000402   000000 011000                    NOP     0

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:46   
      306     5843    3                  RETURN;

   5843  1 000403   000000 702200 xent               TSX2  ! X66_ARET

      307     5844    3                END;
      308     5845    2           END;

   5845  1 000404   200026 235100                    LDA     I,,AUTO
         1 000405   000001 035007                    ADLA    1,DL
         1 000406   200026 755100                    STA     I,,AUTO
         1 000407   000020 115007                    CMPA    16,DL
         1 000410   000363 602000 1                  TNC     s:5837

      309     5846        /*
      310     5847                We have a Logical Device which is not defined.
      311     5848                If REMOVE, no-op.
      312     5849                If no unused Logical Device slots, error.
      313     5850                Else get a slot and use it.
      314     5851         */
      315     5852    1        IF FPT$LDEV_V.REMOVE THEN

   5852  1 000411   000000 471400 xsym               LDP1    B$PS0$
         1 000412   100001 236100                    LDQ     1,,PR1
         1 000413   100000 316003                    CANQ    32768,DU
         1 000414   000416 600000 1                  TZE     s:5854

      316     5853    1             RETURN;

   5853  1 000415   000000 702200 xent               TSX2  ! X66_ARET

      317     5854    2        DO I=0 TO 15;

   5854  1 000416   200026 450100                    STZ     I,,AUTO

      318     5855    3             IF B$ROSEG.LDEVNAME(I)='    ' THEN DO;

   5855  1 000417   000000 470400 xsym               LDP0    B$ROSEG$
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:47   
         1 000420   200026 720100                    LXL0    I,,AUTO
         1 000421   000054 236110                    LDQ     44,X0,PR0
         1 000422   000157 116000 0                  CMPQ    LNAMECHARS+9
         1 000423   000454 601000 1                  TNZ     s:5868

      319     5856    3                  B$ROSEG.LDEVNAME(I)=LNAME;

   5856  1 000424   200106 236100                    LDQ     LNAME,,AUTO
         1 000425   000054 756110                    STQ     44,X0,PR0

      320     5857    3                  IF UC_STR

   5857  1 000426   200040 234100                    SZN     UC_STR,,AUTO
         1 000427   000437 605000 1                  TPL     s:5861

      321     5858    3                  THEN
      322     5859    3                       CALL FSL$UC(I);

   5859  1 000430   200026 630500                    EPPR0   I,,AUTO
         1 000431   200116 450500                    STP0    @PTR$+1,,AUTO
         1 000432   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 000433   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000434   000000 701000 xent               TSX1    FSL$UC
         1 000435   000000 011000                    NOP     0
         1 000436   000441 710000 1                  TRA     s:5862

      323     5860    3                  ELSE
      324     5861    3                       CALL DOASTREAM;

   5861  1 000437   000465 701000 1                  TSX1    DOASTREAM
         1 000440   000000 011000                    NOP     0

      325     5862    4                  IF B$ROSEG.STREAMID.FLG(I)=0 THEN DO;

   5862  1 000441   000000 470400 xsym               LDP0    B$ROSEG$
         1 000442   200026 720100                    LXL0    I,,AUTO
         1 000443   000074 236110                    LDQ     60,X0,PR0
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:48   
         1 000444   600000 316003                    CANQ    -65536,DU
         1 000445   000453 601000 1                  TNZ     s:5866

      326     5863    4                       B$ROSEG.LDEVNAME(I)=' ';

   5863  1 000446   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 000447   000054 756110                    STQ     44,X0,PR0

      327     5864    4                       B$ROSEG.STREAMID(I)='0'B;

   5864  1 000450   000000 470400 xsym               LDP0    B$ROSEG$
         1 000451   200026 720100                    LXL0    I,,AUTO
         1 000452   000074 450110                    STZ     60,X0,PR0

      328     5865    4                     END;

      329     5866    3                  RETURN;

   5866  1 000453   000000 702200 xent               TSX2  ! X66_ARET

      330     5867    3                END;
      331     5868    2           END;

   5868  1 000454   200026 235100                    LDA     I,,AUTO
         1 000455   000001 035007                    ADLA    1,DL
         1 000456   200026 755100                    STA     I,,AUTO
         1 000457   000020 115007                    CMPA    16,DL
         1 000460   000417 602000 1                  TNC     s:5855

      332     5869    1        B$JIT.ERR=ERR$LDEVNOSTREAMS;

   5869  1 000461   000142 236000 0                  LDQ     ERR$LDEVNOSTREAMS
         1 000462   000000 471400 xsym               LDP1    B$JIT$
         1 000463   100012 756100                    STQ     10,,PR1

      333     5870        /*E*    ERROR: FSL-E$LDEVNOSTREAMS-2
      334     5871                MESSAGE: No more Logical Devices can be defined.
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:49   
      335     5872                MESSAGE1: All sixteen Logical Device slots are defined.
      336     5873                          There are five slots reserved for system use,
      337     5874                          leaving eleven for user definition.
      338     5875                          You must un-define a Logical Device with LDEV
      339     5876                          (REMOVE) before you can define another one.
      340     5877        */
      341     5878    1        RETURN;

   5878  1 000464   000000 702200 xent               TSX2  ! X66_ARET

      342     5879        %EJECT;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:50   
      343     5880    1   DOASTREAM: PROC;

   5880  1 000465   200110 741300       DOASTREAM    STX1  ! LNAME+2,,AUTO

      344     5881    2   DCL NEWWSN CHAR(8);
      345     5882    2   DCL NEWRES CHAR(4);
      346     5883        /*
      347     5884                Perform the LDEV operation on a single Logical Device.
      348     5885                Logical Device slot number is in I.
      349     5886                First step:  If the Logical Device has a file associated,
      350     5887                   make sure that the file is open.  Mark all user DCB's
      351     5888                   open to the Logical Device closed, so that they will pick
      352     5889                   up new attributes.
      353     5890         */
      354     5891    2        SDCB$=ADDR(NIL);

   5891  1 000466   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000467   200031 756100                    STQ     SDCB$,,AUTO

      355     5892    2        DEST$=ADDR(NIL);

   5892  1 000470   200032 756100                    STQ     DEST$,,AUTO

      356     5893    2        SCRUBTO=B$ROSEG.STREAMID.FLG(I);

   5893  1 000471   000000 470400 xsym               LDP0    B$ROSEG$
         1 000472   200026 720100                    LXL0    I,,AUTO
         1 000473   000074 236110                    LDQ     60,X0,PR0
         1 000474   000042 772000                    QRL     34
         1 000475   200036 756100                    STQ     SCRUBTO,,AUTO

      357     5894    2        FS$AUTODDF='0'B;

   5894  1 000476   000100 100400                    MLR     fill='000'O
         1 000477   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000500   200102 000020                    ADSC9   FS$AUTODDF,,AUTO         cn=0,n=16

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:51   
      358     5895    2        CALL HFF$TRAPALT ALTRET(SCRUBIT);

   5895  1 000501   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000502   000000 701000 xent               TSX1    HFF$TRAPALT
         1 000503   002024 702000 1                  TSX2    SCRUBIT

      359     5896    3        DO CASE(SCRUBTO);

   5896  1 000504   200036 235100                    LDA     SCRUBTO,,AUTO
         1 000505   000003 115007                    CMPA    3,DL
         1 000506   000510 602005 1                  TNC     s:5896+4,AL
         1 000507   000542 710000 1                  TRA     s:5906
         1 000510   000536 710000 1                  TRA     s:5904
         1 000511   000524 710000 1                  TRA     s:5901
         1 000512   000513 710000 1                  TRA     s:5898

      360     5897    3        CASE(2);

      361     5898    3           SDCB$=PINCRW(B$ROSEG$,B$ROSEG.STREAMID.IDENT(I));

   5898  1 000513   000000 470400 xsym               LDP0    B$ROSEG$
         1 000514   200026 720100                    LXL0    I,,AUTO
         1 000515   000074 721110                    LXL1    60,X0,PR0
         1 000516   000000 636011                    EAQ     0,X1
         1 000517   000000 036000 xsym               ADLQ    B$ROSEG$
         1 000520   200031 756100                    STQ     SDCB$,,AUTO

      362     5899    3           B$JIT.DCB$=SDCB$;

   5899  1 000521   000000 471400 xsym               LDP1    B$JIT$
         1 000522   100232 756100                    STQ     154,,PR1
         1 000523   000550 710000 1                  TRA     s:5923

      363     5900    3        CASE(1);

      364     5901    3           CALL FSB$STREAMDCB(I) ALTRET(RETN);

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:52   
   5901  1 000524   200026 630500                    EPPR0   I,,AUTO
         1 000525   200116 450500                    STP0    @PTR$+1,,AUTO
         1 000526   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 000527   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000530   000000 701000 xent               TSX1    FSB$STREAMDCB
         1 000531   002217 702000 1                  TSX2    RETN

      365     5902    3           SDCB$=B$JIT.DCB$;

   5902  1 000532   000000 470400 xsym               LDP0    B$JIT$
         1 000533   000232 236100                    LDQ     154,,PR0
         1 000534   200031 756100                    STQ     SDCB$,,AUTO
         1 000535   000550 710000 1                  TRA     s:5923

      366     5903    3        CASE(0);

      367     5904    3           B$ROSEG.STREAMID(I)='0'B;

   5904  1 000536   000000 470400 xsym               LDP0    B$ROSEG$
         1 000537   200026 720100                    LXL0    I,,AUTO
         1 000540   000074 450110                    STZ     60,X0,PR0
         1 000541   000550 710000 1                  TRA     s:5923

      368     5905    3        CASE(ELSE);

      369     5906    3           CALL SC_FSBADRO;

   5906  1 000542   000000 713400 xsym               CLIMB   SC_FSBADRO
         1 000543   000000 600000 xsid               climb   nvectors=         0

      370     5907    3           B$ROSEG.STREAMID(I)='0'B;

   5907  1 000544   000000 470400 xsym               LDP0    B$ROSEG$
         1 000545   200026 720100                    LXL0    I,,AUTO
         1 000546   000074 450110                    STZ     60,X0,PR0

      371     5908    3           SCRUBTO=0;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:53   

   5908  1 000547   200036 450100                    STZ     SCRUBTO,,AUTO

      372     5909    3        END;

      373     5910        /*
      374     5911                Second step:  (If the Logical Device has a file associated.)
      375     5912                   Collect attributes of the file that will be needed to
      376     5913                   create a new file.  Most are retained in the DCB, but
      377     5914                   destination info is needed for not-SCRUB/REMOVE when
      378     5915                   new destination is not specified.
      379     5916                   DEST$ is ADDR(NIL) or points to saved attributes.
      380     5917                   With attributes collected, non-CONTINUE cases close the
      381     5918                   file, either SCRATCH or SAVE telling OUTSYM.
      382     5919                   If no file attributes at all are needed (SCRUB/REMOVE),
      383     5920                   the DCB is freed and "no file associated" is marked.
      384     5921                   If device or wsn is changing, default to SCRUB.
      385     5922         */
      386     5923    2        NEWWSN=B$JIT.WOO;

   5923  1 000550   000000 470400 xsym               LDP0    B$JIT$
         1 000551   000010 237100                    LDAQ    8,,PR0
         1 000552   200111 755100                    STA     NEWWSN,,AUTO
         1 000553   200112 756100                    STQ     NEWWSN+1,,AUTO

      387     5924    2        NEWRES=SUBSTR(LNAME,0,2);

   5924  1 000554   200106 236100                    LDQ     LNAME,,AUTO
         1 000555   777777 376003                    ANQ     -1,DU
         1 000556   040040 276007                    ORQ     16416,DL
         1 000557   200113 756100                    STQ     NEWRES,,AUTO

      388     5925    3        IF SCRUBTO~= 0 THEN DO;

   5925  1 000560   200036 235100                    LDA     SCRUBTO,,AUTO
         1 000561   000576 600000 1                  TZE     s:5931

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:54   
      389     5926    3             NEWRES=F$DCB.RES;

   5926  1 000562   200031 471500                    LDP1    SDCB$,,AUTO
         1 000563   100026 236100                    LDQ     22,,PR1
         1 000564   200113 756100                    STQ     NEWRES,,AUTO

      390     5927    3             NEWWSN=F$DCB.WSN;

   5927  1 000565   040100 100500                    MLR     fill='040'O
         1 000566   100027 000010                    ADSC9   23,,PR1                  cn=0,n=8
         1 000567   200111 000010                    ADSC9   NEWWSN,,AUTO             cn=0,n=8

      391     5928    3             IF FPT$LDEV_V.CONTINUE AND NOT FPT$LDEV_V.SCRUB THEN

   5928  1 000570   000000 473400 xsym               LDP3    B$PS0$
         1 000571   300001 234100                    SZN     1,,PR3
         1 000572   000576 605000 1                  TPL     s:5931
         1 000573   300001 236100                    LDQ     1,,PR3
         1 000574   200000 316003                    CANQ    65536,DU
         1 000575   000637 600000 1                  TZE     SCRUBCODE

      392     5929    3                  GOTO SCRUBCODE;
      393     5930    3           END;

      394     5931    2        CALL HFF$NIL(B$PS3$)ALTRET(NOWSN);

   5931  1 000576   000000 630400 2                  EPPR0   0
         1 000577   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000600   000000 701000 xent               TSX1    HFF$NIL
         1 000601   000627 702000 1                  TSX2    NOWSN

      395     5932    2        NEWWSN=B$JIT.WOO;

   5932  1 000602   000000 470400 xsym               LDP0    B$JIT$
         1 000603   000010 237100                    LDAQ    8,,PR0
         1 000604   200111 755100                    STA     NEWWSN,,AUTO
         1 000605   200112 756100                    STQ     NEWWSN+1,,AUTO
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:55   

      396     5933    2        CALL HFF$ERASE(B$PS3$)ALTRET(NOWSN);

   5933  1 000606   000000 630400 2                  EPPR0   0
         1 000607   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000610   000000 701000 xent               TSX1    HFF$ERASE
         1 000611   000627 702000 1                  TSX2    NOWSN

      397     5934    2        CALL HFF$DSIZ(B$PS3$,J);

   5934  1 000612   200027 630500                    EPPR0   J,,AUTO
         1 000613   200117 450500                    STP0    @PTR$+2,,AUTO
         1 000614   000000 236000 2                  LDQ     0
         1 000615   200116 756100                    STQ     @PTR$+1,,AUTO
         1 000616   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 000617   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000620   000000 701000 xent               TSX1    HFF$DSIZ
         1 000621   000000 011000                    NOP     0

      398     5935    2        NEWWSN=B$PS3$->CHARJ;

   5935  1 000622   000000 470400 xsym               LDP0    B$PS3$
         1 000623   200027 720100                    LXL0    J,,AUTO
         1 000624   040100 100540                    MLR     fill='040'O
         1 000625   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         1 000626   200111 000010                    ADSC9   NEWWSN,,AUTO             cn=0,n=8

   5935  1 000627                       NOWSN        null
      399     5936    2   NOWSN: ;
      400     5937    2        IF FPT$LDEV_V.DEV~=' ' THEN NEWRES=FPT$LDEV_V.DEV;

   5937  1 000627   000000 470400 xsym               LDP0    B$PS0$
         1 000630   000001 720100                    LXL0    1,,PR0
         1 000631   040040 100003                    CMPX0   16416,DU
         1 000632   000637 600000 1                  TZE     SCRUBCODE

   5937  1 000633   000001 236100                    LDQ     1,,PR0
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:56   
         1 000634   000022 736000                    QLS     18
         1 000635   040040 276007                    ORQ     16416,DL
         1 000636   200113 756100                    STQ     NEWRES,,AUTO

      401     5938    3   SCRUBCODE: DO;

   5938  1 000637                       SCRUBCODE    null
      402     5939                                 /* This code is so wierd because SDCB$ might be nil */
      403     5940    4             DO;

      404     5941    4                  IF FPT$LDEV_V.REMOVE OR FPT$LDEV_V.SCRUB THEN EXIT;

   5941  1 000637   000000 470400 xsym               LDP0    B$PS0$
         1 000640   000001 236100                    LDQ     1,,PR0
         1 000641   100000 316003                    CANQ    32768,DU
         1 000642   000661 601000 1                  TNZ     s:5946
         1 000643   200000 316003                    CANQ    65536,DU
         1 000644   000661 601000 1                  TNZ     s:5946

      405     5942    4                  IF SDCB$~=ADDR(NIL) THEN

   5942  1 000645   200031 236100                    LDQ     SDCB$,,AUTO
         1 000646   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000647   000660 600000 1                  TZE     s:5944

      406     5943    4                       IF F$DCB.RES~=NEWRES OR F$DCB.WSN~=NEWWSN THEN EXIT;

   5943  1 000650   200031 471500                    LDP1    SDCB$,,AUTO
         1 000651   100026 236100                    LDQ     22,,PR1
         1 000652   200113 116100                    CMPQ    NEWRES,,AUTO
         1 000653   000661 601000 1                  TNZ     s:5946
         1 000654   040100 106500                    CMPC    fill='040'O
         1 000655   100027 000010                    ADSC9   23,,PR1                  cn=0,n=8
         1 000656   200111 000010                    ADSC9   NEWWSN,,AUTO             cn=0,n=8
         1 000657   000661 601000 1                  TNZ     s:5946

      407     5944    4                  EXIT SCRUBCODE;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:57   

   5944  1 000660   000722 710000 1                  TRA     s:5959

      408     5945    4                END;
      409     5946    3             IF SCRUBTO=2 THEN CALL CLOSEM;

   5946  1 000661   200036 235100                    LDA     SCRUBTO,,AUTO
         1 000662   000002 115007                    CMPA    2,DL
         1 000663   000666 601000 1                  TNZ     s:5947

   5946  1 000664   002221 701000 1                  TSX1    CLOSEM
         1 000665   000000 011000                    NOP     0

      410     5947    4             IF SCRUBTO~=0 THEN DO;

   5947  1 000666   200036 235100                    LDA     SCRUBTO,,AUTO
         1 000667   000703 600000 1                  TZE     s:5953

      411     5948    4                  CALL TRUNKET;

   5948  1 000670   002262 701000 1                  TSX1    TRUNKET
         1 000671   000000 011000                    NOP     0

      412     5949    4                  CALL FSA$FDCB(SDCB$);

   5949  1 000672   200031 630500                    EPPR0   SDCB$,,AUTO
         1 000673   200116 450500                    STP0    @PTR$+1,,AUTO
         1 000674   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 000675   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000676   000000 701000 xent               TSX1    FSA$FDCB
         1 000677   000000 011000                    NOP     0

      413     5950    4                  B$ROSEG.STREAMID(I)='0'B;

   5950  1 000700   000000 470400 xsym               LDP0    B$ROSEG$
         1 000701   200026 720100                    LXL0    I,,AUTO
         1 000702   000074 450110                    STZ     60,X0,PR0
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:58   

      414     5951    4                END;

      415     5952                                           /* We can remove anything other than LP01. */
      416     5953    4             IF FPT$LDEV_V.REMOVE THEN DO;

   5953  1 000703   000000 470400 xsym               LDP0    B$PS0$
         1 000704   000001 236100                    LDQ     1,,PR0
         1 000705   100000 316003                    CANQ    32768,DU
         1 000706   000722 600000 1                  TZE     s:5959

      417     5954    4                  IF B$ROSEG.LDEVNAME(I)~='LP01' THEN

   5954  1 000707   000000 471400 xsym               LDP1    B$ROSEG$
         1 000710   200026 720100                    LXL0    I,,AUTO
         1 000711   100054 236110                    LDQ     44,X0,PR1
         1 000712   000170 116000 0                  CMPQ    LNAMECHARS+18
         1 000713   000720 600000 1                  TZE     s:5956

      418     5955    4                       B$ROSEG.LDEVNAME(I)='   ';

   5955  1 000714   000157 236000 0                  LDQ     LNAMECHARS+9
         1 000715   000003 376000 2                  ANQ     3
         1 000716   000040 276007                    ORQ     32,DL
         1 000717   100054 756110                    STQ     44,X0,PR1

      419     5956    4                  RETURN;

   5956  1 000720   200110 221300                    LDX1  ! LNAME+2,,AUTO
         1 000721   000001 702211                    TSX2  ! 1,X1

      420     5957    4                END;
      421     5958    3           END;
      422     5959    2        CALL FSA$GSP(SIZEW(FS$DESTWITH),DEST$)ALTRET(SCRUBIT);

   5959  1 000722   200032 631500                    EPPR1   DEST$,,AUTO
         1 000723   200117 451500                    STP1    @PTR$+2,,AUTO
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:59   
         1 000724   000005 236000 2                  LDQ     5
         1 000725   200116 756100                    STQ     @PTR$+1,,AUTO
         1 000726   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 000727   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000730   000000 701000 xent               TSX1    FSA$GSP
         1 000731   002024 702000 1                  TSX2    SCRUBIT

      423     5960    2        CALL HFF$TRAPALT ALTRET(SCRUBIT);

   5960  1 000732   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000733   000000 701000 xent               TSX1    HFF$TRAPALT
         1 000734   002024 702000 1                  TSX2    SCRUBIT

      424     5961    2        FS$DESTWITH='0'B;

   5961  1 000735   200032 470500                    LDP0    DEST$,,AUTO
         1 000736   000100 100400                    MLR     fill='000'O
         1 000737   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000740   000000 000154                    ADSC9   0,,PR0                   cn=0,n=108

      425     5962    2        FS$DESTWITH.SIZ=SIZEW(FS$DEST);

   5962  1 000741   000032 235007                    LDA     26,DL
         1 000742   200032 470500                    LDP0    DEST$,,AUTO
         1 000743   000000 755100                    STA     0,,PR0

      426     5963    2        FS$DESTWITH.COPIES=1;

   5963  1 000744   200032 470500                    LDP0    DEST$,,AUTO
         1 000745   000001 236003                    LDQ     1,DU
         1 000746   000006 552120                    STBQ    6,'20'O,PR0

      427     5964    3        IF SCRUBTO~=0 THEN DO;

   5964  1 000747   200036 235100                    LDA     SCRUBTO,,AUTO
         1 000750   001066 600000 1                  TZE     s:5994

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:60   
      428     5965    3             CONTFLG=FPT$LDEV_V.CONTINUE;

   5965  1 000751   000000 470400 xsym               LDP0    B$PS0$
         1 000752   000001 236100                    LDQ     1,,PR0
         1 000753   400000 376003                    ANQ     -131072,DU
         1 000754   200035 756100                    STQ     CONTFLG,,AUTO

      429     5966    3             IF SCRUBTO=2 THEN CALL CLOSEM;

   5966  1 000755   000002 115007                    CMPA    2,DL
         1 000756   000761 601000 1                  TNZ     s:5967

   5966  1 000757   002221 701000 1                  TSX1    CLOSEM
         1 000760   000000 011000                    NOP     0

      430     5967    3             J=1;

   5967  1 000761   000001 235007                    LDA     1,DL
         1 000762   200027 755100                    STA     J,,AUTO

      431     5968    3             CALL FMN$GETFIT(FIT$,J)ALTRET(SCRUBIT);

   5968  1 000763   200027 630500                    EPPR0   J,,AUTO
         1 000764   200117 450500                    STP0    @PTR$+2,,AUTO
         1 000765   200033 631500                    EPPR1   FIT$,,AUTO
         1 000766   200116 451500                    STP1    @PTR$+1,,AUTO
         1 000767   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 000770   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000771   000000 701000 xent               TSX1    FMN$GETFIT
         1 000772   002024 702000 1                  TSX2    SCRUBIT

      432     5969    3             FIT$=PINCRW(FIT$,SIZEW(FM$GRAN));

   5969  1 000773   200033 236100                    LDQ     FIT$,,AUTO
         1 000774   000005 036003                    ADLQ    5,DU
         1 000775   200033 756100                    STQ     FIT$,,AUTO

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:61   
      433     5970    3             P$=FIT$;

   5970  1 000776   200034 756100                    STQ     P$,,AUTO

      434     5971    3             CALL FMO$LOCCODP(P$,13)ALTRET(SCRUBIT);

   5971  1 000777   000007 236000 2                  LDQ     7
         1 001000   200117 756100                    STQ     @PTR$+2,,AUTO
         1 001001   200034 630500                    EPPR0   P$,,AUTO
         1 001002   200116 450500                    STP0    @PTR$+1,,AUTO
         1 001003   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 001004   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001005   000000 701000 xent               TSX1    FMO$LOCCODP
         1 001006   002024 702000 1                  TSX2    SCRUBIT

      435     5972    3             PINCRW(DEST$,1)->FS$DEST=P$->FS$DEST;

   5972  1 001007   200034 470500                    LDP0    P$,,AUTO
         1 001010   200032 471500                    LDP1    DEST$,,AUTO
         1 001011   000100 100500                    MLR     fill='000'O
         1 001012   000000 000150                    ADSC9   0,,PR0                   cn=0,n=104
         1 001013   100001 000150                    ADSC9   1,,PR1                   cn=0,n=104

      436     5973                  /* This is to save the code17 block if it was already there
      437     5974                    because it isn't allowed to be changed.
      438     5975                  */
      439     5976    3             P$ = FIT$;

   5976  1 001014   200033 236100                    LDQ     FIT$,,AUTO
         1 001015   200034 756100                    STQ     P$,,AUTO

      440     5977    3             CALL FMO$LOCCODP (P$, 17)

   5977  1 001016   000011 236000 2                  LDQ     9
         1 001017   200117 756100                    STQ     @PTR$+2,,AUTO
         1 001020   200034 630500                    EPPR0   P$,,AUTO
         1 001021   200116 450500                    STP0    @PTR$+1,,AUTO
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:62   
         1 001022   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 001023   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001024   000000 701000 xent               TSX1    FMO$LOCCODP
         1 001025   001033 702000 1                  TSX2    s:5983

      441     5978    4             WHENRETURN DO;

      442     5979    4                  AUTOFPRG = P$->CODE17;

   5979  1 001026   200034 470500                    LDP0    P$,,AUTO
         1 001027   000100 100500                    MLR     fill='000'O
         1 001030   000000 000104                    ADSC9   0,,PR0                   cn=0,n=68
         1 001031   200004 000104                    ADSC9   AUTOFPRG,,AUTO           cn=0,n=68

      443     5980    4                END;

   5980  1 001032   001033 710000 1                  TRA     s:5983

      444     5981    4             WHENALTRETURN DO;

      445     5982    4                END;

      446     5983    3             P$=FIT$;

   5983  1 001033   200033 236100                    LDQ     FIT$,,AUTO
         1 001034   200034 756100                    STQ     P$,,AUTO

      447     5984    3             CALL FMO$LOCCODP(P$,11)ALTRET(NOFILEDDF);

   5984  1 001035   000012 236000 2                  LDQ     10
         1 001036   200117 756100                    STQ     @PTR$+2,,AUTO
         1 001037   200034 630500                    EPPR0   P$,,AUTO
         1 001040   200116 450500                    STP0    @PTR$+1,,AUTO
         1 001041   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 001042   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001043   000000 701000 xent               TSX1    FMO$LOCCODP
         1 001044   001051 702000 1                  TSX2    NOFILEDDF
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:63   

      448     5985    3             FS$AUTODDF=P$->FS$DDF;

   5985  1 001045   200034 470500                    LDP0    P$,,AUTO
         1 001046   000100 100500                    MLR     fill='000'O
         1 001047   000000 000020                    ADSC9   0,,PR0                   cn=0,n=16
         1 001050   200102 000020                    ADSC9   FS$AUTODDF,,AUTO         cn=0,n=16

   5985  1 001051                       NOFILEDDF    null
      449     5986    3   NOFILEDDF: ;
      450     5987    4             IF NOT FPT$LDEV_V.CONTINUE THEN DO;

   5987  1 001051   000000 470400 xsym               LDP0    B$PS0$
         1 001052   000001 234100                    SZN     1,,PR0
         1 001053   001116 604000 1                  TMI     s:6014

      451     5988    4                  CALL TRUNKET;

   5988  1 001054   002262 701000 1                  TSX1    TRUNKET
         1 001055   000000 011000                    NOP     0

      452     5989    4                  F$DCB.FORM$->CODE16.STEPPAGENO=0;

   5989  1 001056   200031 470500                    LDP0    SDCB$,,AUTO
         1 001057   000050 471500                    LDP1    40,,PR0
         1 001060   000000 220003                    LDX0    0,DU
         1 001061   100024 740100                    STX0    20,,PR1

      453     5990    4                  F$DCB.FORM$->CODE16.STEPRECNO=0;

   5990  1 001062   200031 470500                    LDP0    SDCB$,,AUTO
         1 001063   000050 471500                    LDP1    40,,PR0
         1 001064   100025 450100                    STZ     21,,PR1

      454     5991    4                END;

      455     5992    3           END;                       /* IF SCRUBTO ~= 0 (I.E. IT IS A FILE) */
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:64   

   5992  1 001065   001116 710000 1                  TRA     s:6014

      456     5993    3        ELSE DO;                           /* SCRUBTO = 0 (CREATE A STREAM) */

      457     5994    3             CONTFLG=%NO#;

   5994  1 001066   200035 450100                    STZ     CONTFLG,,AUTO

      458     5995    3             CALL FSB$STREAMCREATE(I) ALTRET(SCRUBIT);

   5995  1 001067   200026 630500                    EPPR0   I,,AUTO
         1 001070   200116 450500                    STP0    @PTR$+1,,AUTO
         1 001071   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 001072   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001073   000000 701000 xent               TSX1    FSB$STREAMCREATE
         1 001074   002024 702000 1                  TSX2    SCRUBIT

      459     5996    3             CALL HFF$TRAPALT ALTRET(SCRUBIT);

   5996  1 001075   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001076   000000 701000 xent               TSX1    HFF$TRAPALT
         1 001077   002024 702000 1                  TSX2    SCRUBIT

      460     5997    3             SDCB$=B$JIT.DCB$;

   5997  1 001100   000000 470400 xsym               LDP0    B$JIT$
         1 001101   000232 236100                    LDQ     154,,PR0
         1 001102   200031 756100                    STQ     SDCB$,,AUTO

      461     5998    3             CALL HFF$NIL (B$PS6$)

   5998  1 001103   000002 630400 2                  EPPR0   2
         1 001104   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001105   000000 701000 xent               TSX1    HFF$NIL
         1 001106   001114 702000 1                  TSX2    s:6005

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:65   
      462     5999    4             WHENRETURN DO;

      463     6000                                                /* USE THE SPECIFIED FPRG */
      464     6001    4                  AUTOFPRG = B$PS6$ -> CODE17;

   6001  1 001107   000000 470400 xsym               LDP0    B$PS6$
         1 001110   000100 100500                    MLR     fill='000'O
         1 001111   000000 000104                    ADSC9   0,,PR0                   cn=0,n=68
         1 001112   200004 000104                    ADSC9   AUTOFPRG,,AUTO           cn=0,n=68

      465     6002    4                END;

   6002  1 001113   001116 710000 1                  TRA     s:6014

      466     6003    4             WHENALTRETURN DO;

      467     6004                                           /* WE SET UP OUR OWN WITH LOADBYPRO SET */
      468     6005    4                  AUTOFPRG.LDBYPRO# = 1;

   6005  1 001114   001000 236003                    LDQ     512,DU
         1 001115   200004 552140                    STBQ    AUTOFPRG,'40'O,AUTO

      469     6006    4                END;

      470     6007    3           END;

      471     6008        /*
      472     6009                Fourth step:  Logical Device now owns a DCB.  The DCB is
      473     6010                      closed unless CONTINUE.
      474     6011                      Either DEST$ has (saved) destination info, or DCB has
      475     6012                      defaults to be overridden by FPT.
      476     6013         */
      477     6014    3        IF FPT$LDEV_V.HOLD THEN DO;

   6014  1 001116   000000 470400 xsym               LDP0    B$PS0$
         1 001117   000001 430100                    FSZN    1,,PR0
         1 001120   001130 605000 1                  TPL     s:6018
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:66   

      478     6015    3             DEST$->FS$DESTWITH.SAP=%YES#;

   6015  1 001121   200032 471500                    LDP1    DEST$,,AUTO
         1 001122   100000 236003                    LDQ     32768,DU
         1 001123   100006 256100                    ORSQ    6,,PR1

      479     6016    3             DEST$->FS$DESTWITH.SAPCOPIES=FPT$LDEV_V.HOLDCOPIES;

   6016  1 001124   200032 471500                    LDP1    DEST$,,AUTO
         1 001125   000002 236100                    LDQ     2,,PR0
         1 001126   000011 772000                    QRL     9
         1 001127   100006 552110                    STBQ    6,'10'O,PR1

      480     6017    3           END;

      481     6018    2        IF FPT$LDEV_V.COPIES~=0 THEN

   6018  1 001130   000001 236100                    LDQ     1,,PR0
         1 001131   000777 316003                    CANQ    511,DU
         1 001132   001135 600000 1                  TZE     s:6020

      482     6019    2             DEST$->FS$DESTWITH.COPIES=FPT$LDEV_V.COPIES;

   6019  1 001133   200032 471500                    LDP1    DEST$,,AUTO
         1 001134   100006 552120                    STBQ    6,'20'O,PR1

      483     6020    2        IF FPT$LDEV_V.CONCURR THEN

   6020  1 001135   000001 236100                    LDQ     1,,PR0
         1 001136   002000 316003                    CANQ    1024,DU
         1 001137   001143 600000 1                  TZE     s:6026

      484     6021    2             DEST$->FS$DESTWITH.PRINT=%YES#;

   6021  1 001140   200032 471500                    LDP1    DEST$,,AUTO
         1 001141   200000 236003                    LDQ     65536,DU
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:67   
         1 001142   100006 256100                    ORSQ    6,,PR1

      485     6022        /*
      486     6023                Fifth step:
      487     6024                Move DDF from FPT into Stream DCB.
      488     6025         */
      489     6026    2        CALL HFF$NIL(B$PS1$)ALTRET(NOTAB);

   6026  1 001143   000013 630400 2                  EPPR0   11
         1 001144   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001145   000000 701000 xent               TSX1    HFF$NIL
         1 001146   001227 702000 1                  TSX2    NOTAB

      490     6027    2        CALL HFF$ERASE(B$PS1$)ALTRET(TABZERO);

   6027  1 001147   000013 630400 2                  EPPR0   11
         1 001150   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001151   000000 701000 xent               TSX1    HFF$ERASE
         1 001152   001210 702000 1                  TSX2    TABZERO

      491     6028    2        IF F$DCB.TAB$=ADDR(NIL) THEN

   6028  1 001153   200031 470500                    LDP0    SDCB$,,AUTO
         1 001154   000047 236100                    LDQ     39,,PR0
         1 001155   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001156   001167 601000 1                  TNZ     s:6030

      492     6029    2             CALL FSA$GSP(SIZEW(VLP$TAB),F$DCB.TAB$)ALTRET(TABNEW);

   6029  1 001157   200031 236100                    LDQ     SDCB$,,AUTO
         1 001160   000047 036003                    ADLQ    39,DU
         1 001161   000014 235000 2                  LDA     12
         1 001162   200116 757100                    STAQ    @PTR$+1,,AUTO
         1 001163   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 001164   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001165   000000 701000 xent               TSX1    FSA$GSP
         1 001166   001224 702000 1                  TSX2    TABNEW
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:68   

      493     6030    2        CALL HFF$DSIZ(B$PS1$,J);

   6030  1 001167   200027 630500                    EPPR0   J,,AUTO
         1 001170   200117 450500                    STP0    @PTR$+2,,AUTO
         1 001171   000013 236000 2                  LDQ     11
         1 001172   200116 756100                    STQ     @PTR$+1,,AUTO
         1 001173   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 001174   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001175   000000 701000 xent               TSX1    HFF$DSIZ
         1 001176   000000 011000                    NOP     0

      494     6031    2        F$DCB.TAB$->BCHARTAB=B$PS1$->BCHARJ;

   6031  1 001177   200031 470500                    LDP0    SDCB$,,AUTO
         1 001200   000047 471500                    LDP1    39,,PR0
         1 001201   000000 473400 xsym               LDP3    B$PS1$
         1 001202   200027 720100                    LXL0    J,,AUTO
         1 001203   000000 721000 0                  LXL1    PL6ISDUMB
         1 001204   000140 100540                    MLR     fill='000'O
         1 001205   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0
         1 001206   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1

      495     6032    2        GOTO TABNEW;

   6032  1 001207   001224 710000 1                  TRA     TABNEW

   6031  1 001210                       TABZERO      null
      496     6033    2   TABZERO:;
      497     6034    2        IF F$DCB.TAB$~=ADDR(NIL) THEN

   6034  1 001210   200031 470500                    LDP0    SDCB$,,AUTO
         1 001211   000047 236100                    LDQ     39,,PR0
         1 001212   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001213   001224 600000 1                  TZE     TABNEW

      498     6035    2             CALL FSA$FSP(SIZEW(VLP$TAB),F$DCB.TAB$);
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:69   

   6035  1 001214   200031 236100                    LDQ     SDCB$,,AUTO
         1 001215   000047 036003                    ADLQ    39,DU
         1 001216   000014 235000 2                  LDA     12
         1 001217   200116 757100                    STAQ    @PTR$+1,,AUTO
         1 001220   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 001221   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001222   000000 701000 xent               TSX1    FSA$FSP
         1 001223   000000 011000                    NOP     0

      499     6036    2   TABNEW: F$DCB.IWL.TABIWL='0'B;

   6036  1 001224   200031 470500       TABNEW       LDP0    SDCB$,,AUTO
         1 001225   000015 236000 2                  LDQ     13
         1 001226   000103 356100                    ANSQ    67,,PR0

   6034  1 001227                       NOTAB        null
      500     6037    2   NOTAB: ;
      501     6038    2        CALL HFF$NIL(B$PS2$)ALTRET(NOHDR);

   6038  1 001227   000016 630400 2                  EPPR0   14
         1 001230   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001231   000000 701000 xent               TSX1    HFF$NIL
         1 001232   001333 702000 1                  TSX2    NOHDR

      502     6039    2        CALL HFF$ERASE(B$PS2$)ALTRET(HDRZERO);

   6039  1 001233   000016 630400 2                  EPPR0   14
         1 001234   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001235   000000 701000 xent               TSX1    HFF$ERASE
         1 001236   001314 702000 1                  TSX2    HDRZERO

      503     6040    2        IF F$DCB.HEADER$=ADDR(NIL) THEN

   6040  1 001237   200031 470500                    LDP0    SDCB$,,AUTO
         1 001240   000046 236100                    LDQ     38,,PR0
         1 001241   000001 116000 xsym               CMPQ    B_VECTNIL+1
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:70   
         1 001242   001253 601000 1                  TNZ     s:6042

      504     6041    2             CALL FSA$GSP(SIZEW(VLP$HDRF),F$DCB.HEADER$)ALTRET(HDRNEW);

   6041  1 001243   200031 236100                    LDQ     SDCB$,,AUTO
         1 001244   000046 036003                    ADLQ    38,DU
         1 001245   000020 235000 2                  LDA     16
         1 001246   200116 757100                    STAQ    @PTR$+1,,AUTO
         1 001247   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 001250   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001251   000000 701000 xent               TSX1    FSA$GSP
         1 001252   001330 702000 1                  TSX2    HDRNEW

      505     6042    2        J=LENGTHC(VLP$HDRF.CTL)+1;

   6042  1 001253   000005 235007                    LDA     5,DL
         1 001254   200027 755100                    STA     J,,AUTO

      506     6043    2        F$DCB.HEADER$->CHARJ=B$PS2$->CHARJ;

   6043  1 001255   200031 470500                    LDP0    SDCB$,,AUTO
         1 001256   000046 471500                    LDP1    38,,PR0
         1 001257   000000 473400 xsym               LDP3    B$PS2$
         1 001260   000000 620005                    EAX0    0,AL
         1 001261   200027 721100                    LXL1    J,,AUTO
         1 001262   040140 100540                    MLR     fill='040'O
         1 001263   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0
         1 001264   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1

      507     6044    2        CALL HFF$DSIZ(B$PS2$,J);

   6044  1 001265   200027 630500                    EPPR0   J,,AUTO
         1 001266   200117 450500                    STP0    @PTR$+2,,AUTO
         1 001267   000016 236000 2                  LDQ     14
         1 001270   200116 756100                    STQ     @PTR$+1,,AUTO
         1 001271   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 001272   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:71   
         1 001273   000000 701000 xent               TSX1    HFF$DSIZ
         1 001274   000000 011000                    NOP     0

      508     6045    2        J=J-(LENGTHC(VLP$HDRF.CTL)+1);

   6045  1 001275   000005 336007                    LCQ     5,DL
         1 001276   200027 056100                    ASQ     J,,AUTO

      509     6046    2        IF J>F$DCB.HEADER$->VLP$HDRF.TITL.L# THEN

   6046  1 001277   200031 470500                    LDP0    SDCB$,,AUTO
         1 001300   000046 471500                    LDP1    38,,PR0
         1 001301   100001 236100                    LDQ     1,,PR1
         1 001302   000033 772000                    QRL     27
         1 001303   200027 116100                    CMPQ    J,,AUTO
         1 001304   001306 605000 1                  TPL     s:6048

      510     6047    2             J=F$DCB.HEADER$->VLP$HDRF.TITL.L#;

   6047  1 001305   200027 756100                    STQ     J,,AUTO

      511     6048    2        F$DCB.HEADER$->VLP$HDRF.TITL.TITLE#=

   6048  1 001306   000000 473400 xsym               LDP3    B$PS2$
         1 001307   200027 720100                    LXL0    J,,AUTO
         1 001310   040100 100540                    MLR     fill='040'O
         1 001311   300001 200010                    ADSC9   1,,PR3                   cn=1,n=*X0
         1 001312   100001 200240                    ADSC9   1,,PR1                   cn=1,n=160

      512     6049    2             ADDR(B$PS2$->VLP$HDRF.TITL.TITLE#)->CHARJ;
      513     6050    2        GOTO HDRNEW;

   6050  1 001313   001330 710000 1                  TRA     HDRNEW

   6049  1 001314                       HDRZERO      null
      514     6051    2   HDRZERO:;
      515     6052    2        IF F$DCB.HEADER$~=ADDR(NIL) THEN
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:72   

   6052  1 001314   200031 470500                    LDP0    SDCB$,,AUTO
         1 001315   000046 236100                    LDQ     38,,PR0
         1 001316   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001317   001330 600000 1                  TZE     HDRNEW

      516     6053    2             CALL FSA$FSP(SIZEW(VLP$HDRF),F$DCB.HEADER$);

   6053  1 001320   200031 236100                    LDQ     SDCB$,,AUTO
         1 001321   000046 036003                    ADLQ    38,DU
         1 001322   000020 235000 2                  LDA     16
         1 001323   200116 757100                    STAQ    @PTR$+1,,AUTO
         1 001324   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 001325   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001326   000000 701000 xent               TSX1    FSA$FSP
         1 001327   000000 011000                    NOP     0

      517     6054    2   HDRNEW: F$DCB.IWL.HDRIWL='0'B;

   6054  1 001330   200031 470500       HDRNEW       LDP0    SDCB$,,AUTO
         1 001331   000021 236000 2                  LDQ     17
         1 001332   000103 356100                    ANSQ    67,,PR0

   6052  1 001333                       NOHDR        null
      518     6055    2   NOHDR: ;
      519     6056    2        IF FPT$LDEV_V.SEQ&'01'B THEN GOTO NOSEQ;

   6056  1 001333   000000 470400 xsym               LDP0    B$PS0$
         1 001334   000003 236100                    LDQ     3,,PR0
         1 001335   000022 736000                    QLS     18
         1 001336   600000 376003                    ANQ     -65536,DU
         1 001337   200000 376003                    ANQ     65536,DU
         1 001340   001357 601000 1                  TNZ     NOSEQ

      520     6057    2        F$DCB.SEQ=FPT$LDEV_V.SEQ;

   6057  1 001341   200031 471500                    LDP1    SDCB$,,AUTO
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:73   
         1 001342   000003 236100                    LDQ     3,,PR0
         1 001343   000011 772000                    QRL     9
         1 001344   100044 676100                    ERQ     36,,PR1
         1 001345   000400 376007                    ANQ     256,DL
         1 001346   100044 656100                    ERSQ    36,,PR1

      521     6058    2        F$DCB.SEQID=FPT$LDEV_V.SEQID;

   6058  1 001347   000004 236100                    LDQ     4,,PR0
         1 001350   100045 756100                    STQ     37,,PR1

      522     6059    2        F$DCB.SEQCOL=FPT$LDEV_V.SEQCOL;

   6059  1 001351   000003 236100                    LDQ     3,,PR0
         1 001352   100044 676100                    ERQ     36,,PR1
         1 001353   000377 376007                    ANQ     255,DL
         1 001354   100044 656100                    ERSQ    36,,PR1

      523     6060    2        F$DCB.IWL.SEQIWL='0'B;

   6060  1 001355   000022 236000 2                  LDQ     18
         1 001356   100103 356100                    ANSQ    67,,PR1

   6060  1 001357                       NOSEQ        null
      524     6061    2   NOSEQ: ;
      525     6062    2        IF FPT$LDEV_V.LINES~=0 THEN

   6062  1 001357   000002 720100                    LXL0    2,,PR0
         1 001360   001362 600000 1                  TZE     s:6064

      526     6063    2             FS$AUTODDF.LINES=FPT$LDEV_V.LINES;

   6063  1 001361   200103 740100                    STX0    FS$AUTODDF+1,,AUTO

      527     6064    2        IF FPT$LDEV_V.DVFC~=BINASC(0) THEN

   6064  1 001362   000002 236100                    LDQ     2,,PR0
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:74   
         1 001363   777000 376003                    ANQ     -512,DU
         1 001364   000000 116003                    CMPQ    0,DU
         1 001365   001371 600000 1                  TZE     s:6066

      528     6065    2             FS$AUTODDF.DVFC=FPT$LDEV_V.DVFC;

   6065  1 001366   000002 236100                    LDQ     2,,PR0
         1 001367   000022 772000                    QRL     18
         1 001370   200103 552110                    STBQ    FS$AUTODDF+1,'10'O,AUTO

      529     6066    2        IF FPT$LDEV_V.WIDTH~=0 THEN

   6066  1 001371   000005 236100                    LDQ     5,,PR0
         1 001372   777000 316003                    CANQ    -512,DU
         1 001373   001376 600000 1                  TZE     s:6068

      530     6067    2             FS$AUTODDF.WIDTH=FPT$LDEV_V.WIDTH;

   6067  1 001374   000011 772000                    QRL     9
         1 001375   200102 552120                    STBQ    FS$AUTODDF,'20'O,AUTO

      531     6068    2        IF FPT$LDEV_V.ATTR THEN

   6068  1 001376   000003 221100                    LDX1    3,,PR0
         1 001377   001401 600000 1                  TZE     s:6074

      532     6069    2             FS$AUTODDF.ATTR=FPT$LDEV_V.ATTR;

   6069  1 001400   200102 441100                    SXL1    FS$AUTODDF,,AUTO

      533     6070        /*
      534     6071                Now go create the new stream file.
      535     6072                (or update the CONTINUE file's FIT).
      536     6073         */
      537     6074    3        IF NOT CONTFLG THEN DO;

   6074  1 001401   200035 234100                    SZN     CONTFLG,,AUTO
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:75   
         1 001402   001703 604000 1                  TMI     s:6142

      538     6075    3             F$DCB.RES=NEWRES;

   6075  1 001403   200113 236100                    LDQ     NEWRES,,AUTO
         1 001404   200031 471500                    LDP1    SDCB$,,AUTO
         1 001405   100026 756100                    STQ     22,,PR1

      539     6076    3             F$DCB.WSN=NEWWSN;

   6076  1 001406   200031 471500                    LDP1    SDCB$,,AUTO
         1 001407   040100 100500                    MLR     fill='040'O
         1 001410   200111 000010                    ADSC9   NEWWSN,,AUTO             cn=0,n=8
         1 001411   100027 000010                    ADSC9   23,,PR1                  cn=0,n=8

      540     6077    4             IF FS$AUTODDF.ATTR&~F$DCB.ATTR THEN DO;

   6077  1 001412   200031 471500                    LDP1    SDCB$,,AUTO
         1 001413   100040 236100                    LDQ     32,,PR1
         1 001414   000022 736000                    QLS     18
         1 001415   777777 676003                    ERQ     -1,DU
         1 001416   200116 756100                    STQ     @PTR$+1,,AUTO
         1 001417   200102 236100                    LDQ     FS$AUTODDF,,AUTO
         1 001420   000022 736000                    QLS     18
         1 001421   200116 376100                    ANQ     @PTR$+1,,AUTO
         1 001422   001432 600000 1                  TZE     s:6081

      541     6078    4                  F$DCB.ATTR=FS$AUTODDF.ATTR;

   6078  1 001423   200102 720100                    LXL0    FS$AUTODDF,,AUTO
         1 001424   100040 440100                    SXL0    32,,PR1

      542     6079    4                  FS$DESTWITH.DT.WSN=BINASC(0);

   6079  1 001425   200032 473500                    LDP3    DEST$,,AUTO
         1 001426   000023 235000 2                  LDA     19
         1 001427   000035 236000 xsym               LDQ     B_VECTNIL+29
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:76   
         1 001430   300020 755100                    STA     16,,PR3
         1 001431   300021 756100                    STQ     17,,PR3

      543     6080    4                END;

      544     6081    3             CALL HFF$NIL(4) ALTRET(NOFORM);

   6081  1 001432   000024 630400 2                  EPPR0   20
         1 001433   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001434   000000 701000 xent               TSX1    HFF$NIL
         1 001435   001501 702000 1                  TSX2    NOFORM

      545     6082    3             F$DCB.FORM$->CODE16='0'B;

   6082  1 001436   200031 470500                    LDP0    SDCB$,,AUTO
         1 001437   000050 471500                    LDP1    40,,PR0
         1 001440   000100 100400                    MLR     fill='000'O
         1 001441   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 001442   100000 000234                    ADSC9   0,,PR1                   cn=0,n=156

      546     6083    3             CALL HFF$ERASE(B$PS4$)ALTRET(ERASEFORM);

   6083  1 001443   000001 630400 2                  EPPR0   1
         1 001444   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001445   000000 701000 xent               TSX1    HFF$ERASE
         1 001446   001474 702000 1                  TSX2    ERASEFORM

      547     6084    3             CALL HFF$DSIZ(B$PS4$,J);

   6084  1 001447   200027 630500                    EPPR0   J,,AUTO
         1 001450   200117 450500                    STP0    @PTR$+2,,AUTO
         1 001451   000001 236000 2                  LDQ     1
         1 001452   200116 756100                    STQ     @PTR$+1,,AUTO
         1 001453   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 001454   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001455   000000 701000 xent               TSX1    HFF$DSIZ
         1 001456   000000 011000                    NOP     0
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:77   

      548     6085    3             F$DCB.FORM$->CODE16.FORM=B$PS4$->CHARJ;

   6085  1 001457   200031 470500                    LDP0    SDCB$,,AUTO
         1 001460   000050 471500                    LDP1    40,,PR0
         1 001461   000000 473400 xsym               LDP3    B$PS4$
         1 001462   200027 720100                    LXL0    J,,AUTO
         1 001463   040100 100540                    MLR     fill='040'O
         1 001464   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0
         1 001465   100000 000006                    ADSC9   0,,PR1                   cn=0,n=6

      549     6086    3             DEST$->FS$DESTWITH.FORM=F$DCB.FORM$->CODE16.FORM;

   6086  1 001466   200031 470500                    LDP0    SDCB$,,AUTO
         1 001467   000050 471500                    LDP1    40,,PR0
         1 001470   200032 473500                    LDP3    DEST$,,AUTO
         1 001471   040100 100500                    MLR     fill='040'O
         1 001472   100000 000006                    ADSC9   0,,PR1                   cn=0,n=6
         1 001473   300001 000006                    ADSC9   1,,PR3                   cn=0,n=6

      550     6087    3   ERASEFORM: DEST$->FS$DESTWITH.DT.WSN=BINASC(0);

   6087  1 001474   200032 470500       ERASEFORM    LDP0    DEST$,,AUTO
         1 001475   000023 235000 2                  LDA     19
         1 001476   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 001477   000020 755100                    STA     16,,PR0
         1 001500   000021 756100                    STQ     17,,PR0

   6086  1 001501                       NOFORM       null
      551     6088                /* Must re-read WSN file to get default form name */
      552     6089    3   NOFORM:   ;
      553     6090    3             CALL FMD$GBUF(FIT$);

   6090  1 001501   200033 630500                    EPPR0   FIT$,,AUTO
         1 001502   200116 450500                    STP0    @PTR$+1,,AUTO
         1 001503   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 001504   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:78   
         1 001505   000000 701000 xent               TSX1    FMD$GBUF
         1 001506   000000 011000                    NOP     0

      554     6091    3             CALL HFF$TRAPALT ALTRET(RETNOO);

   6091  1 001507   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001510   000000 701000 xent               TSX1    HFF$TRAPALT
         1 001511   002015 702000 1                  TSX2    RETNOO

      555     6092    3             F$DCB.FUN=%CREATE#;

   6092  1 001512   200031 470500                    LDP0    SDCB$,,AUTO
         1 001513   000003 236003                    LDQ     3,DU
         1 001514   000032 552120                    STBQ    26,'20'O,PR0

      556     6093    3             B$ROSEG.STREAMID.F01(I)=%NO#;

   6093  1 001515   000000 471400 xsym               LDP1    B$ROSEG$
         1 001516   200026 720100                    LXL0    I,,AUTO
         1 001517   000025 236000 2                  LDQ     21
         1 001520   100074 356110                    ANSQ    60,X0,PR1

      557     6094    3             B$ROSEG.STREAMID.SUBNAME(I)=0;

   6094  1 001521   000000 470400 xsym               LDP0    B$ROSEG$
         1 001522   200026 720100                    LXL0    I,,AUTO
         1 001523   000026 236000 2                  LDQ     22
         1 001524   000074 356110                    ANSQ    60,X0,PR0

      558     6095    3             F$DCB.WIDTH=FS$AUTODDF.WIDTH;

   6095  1 001525   200031 470500                    LDP0    SDCB$,,AUTO
         1 001526   200102 236100                    LDQ     FS$AUTODDF,,AUTO
         1 001527   000022 772000                    QRL     18
         1 001530   000004 552104                    STBQ    4,'04'O,PR0

      559     6096    3             F$DCB.LINES=FS$AUTODDF.LINES;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:79   

   6096  1 001531   200103 220100                    LDX0    FS$AUTODDF+1,,AUTO
         1 001532   200031 470500                    LDP0    SDCB$,,AUTO
         1 001533   000044 740100                    STX0    36,,PR0

      560     6097    3             F$DCB.DVFC=FS$AUTODDF.DVFC;

   6097  1 001534   200103 236100                    LDQ     FS$AUTODDF+1,,AUTO
         1 001535   000044 552110                    STBQ    36,'10'O,PR0

      561     6098    4             IF DEST$->FS$DESTWITH.DT.WSN<=BINASC(0) THEN DO;

   6098  1 001536   200032 471500                    LDP1    DEST$,,AUTO
         1 001537   040100 106400                    CMPC    fill='040'O
         1 001540   000023 000001 2                  ADSC9   19                       cn=0,n=1
         1 001541   100020 000010                    ADSC9   16,,PR1                  cn=0,n=8
         1 001542   001560 602000 1                  TNC     s:6103

      562     6099    4                  F$DCB.ATTR=FS$AUTODDF.ATTR;

   6099  1 001543   200102 721100                    LXL1    FS$AUTODDF,,AUTO
         1 001544   000040 441100                    SXL1    32,,PR0

      563     6100    4                  CALL FSW$DESTFORM(DEST$,FIT$,B$JIT$)ALTRET(RETNOO);

   6100  1 001545   000027 236000 2                  LDQ     23
         1 001546   200120 756100                    STQ     @PTR$+3,,AUTO
         1 001547   200033 633500                    EPPR3   FIT$,,AUTO
         1 001550   200117 453500                    STP3    @PTR$+2,,AUTO
         1 001551   200032 634500                    EPPR4   DEST$,,AUTO
         1 001552   200116 454500                    STP4    @PTR$+1,,AUTO
         1 001553   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 001554   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001555   000000 701000 xent               TSX1    FSW$DESTFORM
         1 001556   002015 702000 1                  TSX2    RETNOO

      564     6101    4                END;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:80   

   6101  1 001557   001570 710000 1                  TRA     s:6104

      565     6102    3             ELSE
      566     6103    3                  CALL FSW$FORM(DEST$,FIT$)ALTRET(RETNOO);

   6103  1 001560   200033 633500                    EPPR3   FIT$,,AUTO
         1 001561   200117 453500                    STP3    @PTR$+2,,AUTO
         1 001562   200032 634500                    EPPR4   DEST$,,AUTO
         1 001563   200116 454500                    STP4    @PTR$+1,,AUTO
         1 001564   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 001565   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001566   000000 701000 xent               TSX1    FSW$FORM
         1 001567   002015 702000 1                  TSX2    RETNOO

      567     6104    3             F$DCB.ATTR = FIT$->FS$FORMREC.ATTR;

   6104  1 001570   200033 470500                    LDP0    FIT$,,AUTO
         1 001571   000005 220100                    LDX0    5,,PR0
         1 001572   200031 471500                    LDP1    SDCB$,,AUTO
         1 001573   100040 440100                    SXL0    32,,PR1

      568     6105    3             IF FIT$->FS$FORMREC.GRAPHIC

   6105  1 001574   000004 430100                    FSZN    4,,PR0
         1 001575   001624 605000 1                  TPL     s:6117

      569     6106    4             THEN DO;                      /* WE MUST PUT IN THE FPRG */

      570     6107    4                  CALL FSA$GSP (SIZEW (AUTOFPRG), P$);

   6107  1 001576   200034 633500                    EPPR3   P$,,AUTO
         1 001577   200117 453500                    STP3    @PTR$+2,,AUTO
         1 001600   000031 236000 2                  LDQ     25
         1 001601   200116 756100                    STQ     @PTR$+1,,AUTO
         1 001602   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 001603   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:81   
         1 001604   000000 701000 xent               TSX1    FSA$GSP
         1 001605   000000 011000                    NOP     0

      571     6108    4                  F$DCB.FPRGX = POFFW (P$, B$ROSEG$);

   6108  1 001606   000000 235000 xsym               LDA     B$ROSEG$
         1 001607   000022 771000                    ARL     18
         1 001610   200116 755100                    STA     @PTR$+1,,AUTO
         1 001611   200034 236100                    LDQ     P$,,AUTO
         1 001612   000022 772000                    QRL     18
         1 001613   200116 136100                    SBLQ    @PTR$+1,,AUTO
         1 001614   000000 620006                    EAX0    0,QL
         1 001615   200031 470500                    LDP0    SDCB$,,AUTO
         1 001616   000054 740100                    STX0    44,,PR0

      572     6109    4                  P$ -> CODE17 = AUTOFPRG;

   6109  1 001617   200034 471500                    LDP1    P$,,AUTO
         1 001620   000100 100500                    MLR     fill='000'O
         1 001621   200004 000104                    ADSC9   AUTOFPRG,,AUTO           cn=0,n=68
         1 001622   100000 000104                    ADSC9   0,,PR1                   cn=0,n=68

      573     6110                             /* Set the TAB, HDR, and SEQ IWL flags to avoid
      574     6111                                putting out these records unless demanded by
      575     6112                                the user.  Their existance might mess up some
      576     6113                                of the FPRGs.
      577     6114                             */
      578     6115    4                END;

   6115  1 001623   001636 710000 1                  TRA     s:6131

      579     6116    4             ELSE DO;                      /* DO ERROR TEST */

      580     6117    4                  P$ = ADDR (NIL);

   6117  1 001624   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001625   200034 756100                    STQ     P$,,AUTO
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:82   

      581     6118    4                  CALL HFF$NIL (B$PS6$)

   6118  1 001626   000002 630400 2                  EPPR0   2
         1 001627   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001630   000000 701000 xent               TSX1    HFF$NIL
         1 001631   001636 702000 1                  TSX2    s:6131

      582     6119    5                  WHENRETURN DO;

      583     6120        /*E*         ERROR: FSL-E$FPRG_ON_NON_GR-2
      584     6121                     MESSAGE: FPRG can't be specified with a non graphic form.
      585     6122                     MESSAGE1: The FPRG option can only be used with a graphic
      586     6123                              form specified in the LDEV.
      587     6124        */
      588     6125    5                       B$JIT.ERR = ERR$FPRG_ON_NON_GR;

   6125  1 001632   000145 236000 0                  LDQ     ERR$FPRG_ON_NON_GR
         1 001633   000000 470400 xsym               LDP0    B$JIT$
         1 001634   000012 756100                    STQ     10,,PR0

      589     6126    5                       GOTO RETNOO;

   6126  1 001635   002015 710000 1                  TRA     RETNOO

      590     6127    5                     END;
      591     6128    5                  WHENALTRETURN DO;

      592     6129    5                     END;

      593     6130    4                END;

      594     6131    3             CALL SETDDF(PINCRW(FIT$,800));

   6131  1 001636   200033 236100                    LDQ     FIT$,,AUTO
         1 001637   001440 036003                    ADLQ    800,DU
         1 001640   200121 756100                    STQ     @PTR$+4,,AUTO
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:83   
         1 001641   200121 630500                    EPPR0   @PTR$+4,,AUTO
         1 001642   200115 450500                    STP0    NEWRES+2,,AUTO
         1 001643   002353 701000 1                  TSX1    SETDDF
         1 001644   000000 011000                    NOP     0

      595     6132    3             AUTOFPT=CONSTOPN;

   6132  1 001645   000100 100400                    MLR     fill='000'O
         1 001646   000002 000114 0                  ADSC9   CONSTOPN                 cn=0,n=76
         1 001647   200041 000114                    ADSC9   AUTOFPT,,AUTO            cn=0,n=76

      596     6133    3             AUTOFPT.PROCATTR_=DEST$;

   6133  1 001650   200032 236100                    LDQ     DEST$,,AUTO
         1 001651   200052 756100                    STQ     AUTOFPT+9,,AUTO

      597     6134    3             AUTOFPT.UATTR_=PINCRW(FIT$,800);

   6134  1 001652   200033 236100                    LDQ     FIT$,,AUTO
         1 001653   001440 036003                    ADLQ    800,DU
         1 001654   200050 756100                    STQ     AUTOFPT+7,,AUTO

      598     6135    3             CALL FSF$SYMBFILE(FIT$,AUTOFPT,B$JIT$)ALTRET(RETNOO);

   6135  1 001655   000027 236000 2                  LDQ     23
         1 001656   200120 756100                    STQ     @PTR$+3,,AUTO
         1 001657   200041 630500                    EPPR0   AUTOFPT,,AUTO
         1 001660   200117 450500                    STP0    @PTR$+2,,AUTO
         1 001661   200033 631500                    EPPR1   FIT$,,AUTO
         1 001662   200116 451500                    STP1    @PTR$+1,,AUTO
         1 001663   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 001664   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001665   000000 701000 xent               TSX1    FSF$SYMBFILE
         1 001666   002015 702000 1                  TSX2    RETNOO

      599     6136    3             IF P$ ~= ADDR (NIL)

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:84   
   6136  1 001667   200034 236100                    LDQ     P$,,AUTO
         1 001670   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001671   002004 600000 1                  TZE     s:6158

      600     6137    4             THEN DO;

      601     6138    4                  CALL FSA$FSP (SIZEW (AUTOFPRG), P$);

   6138  1 001672   200034 630500                    EPPR0   P$,,AUTO
         1 001673   200117 450500                    STP0    @PTR$+2,,AUTO
         1 001674   000031 236000 2                  LDQ     25
         1 001675   200116 756100                    STQ     @PTR$+1,,AUTO
         1 001676   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 001677   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001700   000000 701000 xent               TSX1    FSA$FSP
         1 001701   000000 011000                    NOP     0

      602     6139    4                END;

      603     6140    3           END;

   6140  1 001702   002004 710000 1                  TRA     s:6158

      604     6141    3        ELSE DO;                           /* DO IF CONTFLG = '1'B */

      605     6142    3             IF FS$AUTODDF.LINES~=0 AND FS$AUTODDF.LINES<=

   6142  1 001703   200103 222100                    LDX2    FS$AUTODDF+1,,AUTO
         1 001704   001720 600000 1                  TZE     s:6145
         1 001705   200103 235100                    LDA     FS$AUTODDF+1,,AUTO
         1 001706   000022 771000                    ARL     18
         1 001707   200116 755100                    STA     @PTR$+1,,AUTO
         1 001710   200032 471500                    LDP1    DEST$,,AUTO
         1 001711   100003 236100                    LDQ     3,,PR1
         1 001712   000777 376007                    ANQ     511,DL
         1 001713   200116 116100                    CMPQ    @PTR$+1,,AUTO
         1 001714   001720 604000 1                  TMI     s:6145
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:85   

      606     6143    3                  FS$DESTWITH.FLINES THEN
      607     6144    3                  F$DCB.FORM$->CODE16.LINES=FS$AUTODDF.LINES;

   6144  1 001715   200031 473500                    LDP3    SDCB$,,AUTO
         1 001716   300050 474500                    LDP4    40,,PR3
         1 001717   400006 442100                    SXL2    6,,PR4

      608     6145    3             IF FS$AUTODDF.WIDTH~=0 AND FS$AUTODDF.WIDTH<=

   6145  1 001720   200102 236100                    LDQ     FS$AUTODDF,,AUTO
         1 001721   000777 316003                    CANQ    511,DU
         1 001722   001741 600000 1                  TZE     s:6148
         1 001723   200102 236100                    LDQ     FS$AUTODDF,,AUTO
         1 001724   000022 772000                    QRL     18
         1 001725   000777 376007                    ANQ     511,DL
         1 001726   200116 756100                    STQ     @PTR$+1,,AUTO
         1 001727   200032 471500                    LDP1    DEST$,,AUTO
         1 001730   100003 236100                    LDQ     3,,PR1
         1 001731   000011 772000                    QRL     9
         1 001732   000777 376007                    ANQ     511,DL
         1 001733   200116 116100                    CMPQ    @PTR$+1,,AUTO
         1 001734   001741 604000 1                  TMI     s:6148

      609     6146    3                  FS$DESTWITH.FWIDTH THEN
      610     6147    3                  F$DCB.FORM$->CODE16.WIDTH=FS$AUTODDF.WIDTH;

   6147  1 001735   200031 473500                    LDP3    SDCB$,,AUTO
         1 001736   300050 474500                    LDP4    40,,PR3
         1 001737   200102 236100                    LDQ     FS$AUTODDF,,AUTO
         1 001740   400026 552120                    STBQ    22,'20'O,PR4

      611     6148    3             IF FS$AUTODDF.DVFC~=BINASC(0) THEN

   6148  1 001741   200103 236100                    LDQ     FS$AUTODDF+1,,AUTO
         1 001742   777000 376007                    ANQ     -512,DL
         1 001743   000000 116003                    CMPQ    0,DU
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:86   
         1 001744   001752 600000 1                  TZE     s:6150

      612     6149    3                  F$DCB.FORM$->CODE16.DVFC=FS$AUTODDF.DVFC;

   6149  1 001745   200031 471500                    LDP1    SDCB$,,AUTO
         1 001746   100050 473500                    LDP3    40,,PR1
         1 001747   200103 236100                    LDQ     FS$AUTODDF+1,,AUTO
         1 001750   000022 736000                    QLS     18
         1 001751   300026 552140                    STBQ    22,'40'O,PR3

      613     6150    3             CALL FMD$GBUF(FIT$);

   6150  1 001752   200033 631500                    EPPR1   FIT$,,AUTO
         1 001753   200116 451500                    STP1    @PTR$+1,,AUTO
         1 001754   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 001755   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001756   000000 701000 xent               TSX1    FMD$GBUF
         1 001757   000000 011000                    NOP     0

      614     6151    3             F$DCB.FUN=%UPDATE#;

   6151  1 001760   200031 470500                    LDP0    SDCB$,,AUTO
         1 001761   000001 236003                    LDQ     1,DU
         1 001762   000032 552120                    STBQ    26,'20'O,PR0

      615     6152    3             CALL SETDDF(FIT$);

   6152  1 001763   200033 631500                    EPPR1   FIT$,,AUTO
         1 001764   200115 451500                    STP1    NEWRES+2,,AUTO
         1 001765   002353 701000 1                  TSX1    SETDDF
         1 001766   000000 011000                    NOP     0

      616     6153    3             AUTOCLS=CONSTCLS;

   6153  1 001767   000100 100400                    MLR     fill='000'O
         1 001770   000052 000070 0                  ADSC9   CONSTCLS                 cn=0,n=56
         1 001771   200064 000070                    ADSC9   AUTOCLS,,AUTO            cn=0,n=56
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:87   

      617     6154    3             AUTOCLS.PROCATTR_=DEST$;

   6154  1 001772   200032 236100                    LDQ     DEST$,,AUTO
         1 001773   200075 756100                    STQ     AUTOCLS+9,,AUTO

      618     6155    3             AUTOCLS.UATTR_=FIT$;

   6155  1 001774   200033 236100                    LDQ     FIT$,,AUTO
         1 001775   200073 756100                    STQ     AUTOCLS+7,,AUTO

      619     6156    3             CALL FMP$CLSF(AUTOCLS);

   6156  1 001776   200064 630500                    EPPR0   AUTOCLS,,AUTO
         1 001777   200116 450500                    STP0    @PTR$+1,,AUTO
         1 002000   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 002001   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002002   000000 701000 xent               TSX1    FMP$CLSF
         1 002003   000000 011000                    NOP     0

      620     6157    3           END;

      621     6158    2        CALL FMD$RBUF(FIT$);

   6158  1 002004   200033 630500                    EPPR0   FIT$,,AUTO
         1 002005   200116 450500                    STP0    @PTR$+1,,AUTO
         1 002006   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 002007   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002010   000000 701000 xent               TSX1    FMD$RBUF
         1 002011   000000 011000                    NOP     0

      622     6159    2        SCRUBTO=1;

   6159  1 002012   000001 235007                    LDA     1,DL
         1 002013   200036 755100                    STA     SCRUBTO,,AUTO

      623     6160    2        GOTO SCRUBIT;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:88   

   6160  1 002014   002024 710000 1                  TRA     SCRUBIT

      624     6161    2   RETNOO: CALL FMD$RBUF(FIT$);

   6161  1 002015   200033 630500       RETNOO       EPPR0   FIT$,,AUTO
         1 002016   200116 450500                    STP0    @PTR$+1,,AUTO
         1 002017   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 002020   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002021   000000 701000 xent               TSX1    FMD$RBUF
         1 002022   000000 011000                    NOP     0

      625     6162    2        SCRUBTO=0;

   6162  1 002023   200036 450100                    STZ     SCRUBTO,,AUTO

   6162  1 002024                       SCRUBIT      null
      626     6163    2   SCRUBIT:;
      627     6164    2        SAVERR=B$JIT.ERR;

   6164  1 002024   000000 470400 xsym               LDP0    B$JIT$
         1 002025   000012 236100                    LDQ     10,,PR0
         1 002026   200037 756100                    STQ     SAVERR,,AUTO

      628     6165    2        CALL HFF$TRAPALT ALTRET(SAVERROR);

   6165  1 002027   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002030   000000 701000 xent               TSX1    HFF$TRAPALT
         1 002031   002214 702000 1                  TSX2    SAVERROR

      629     6166    2        IF DEST$~=ADDR(NIL) THEN

   6166  1 002032   200032 236100                    LDQ     DEST$,,AUTO
         1 002033   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002034   002045 600000 1                  TZE     s:6168

      630     6167    2             CALL FSA$FSP(SIZEW(FS$DESTWITH),DEST$);
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:89   

   6167  1 002035   200032 630500                    EPPR0   DEST$,,AUTO
         1 002036   200117 450500                    STP0    @PTR$+2,,AUTO
         1 002037   000005 236000 2                  LDQ     5
         1 002040   200116 756100                    STQ     @PTR$+1,,AUTO
         1 002041   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 002042   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002043   000000 701000 xent               TSX1    FSA$FSP
         1 002044   000000 011000                    NOP     0

      631     6168    2        IF SCRUBTO=2 THEN

   6168  1 002045   200036 235100                    LDA     SCRUBTO,,AUTO
         1 002046   000002 115007                    CMPA    2,DL
         1 002047   002065 601000 1                  TNZ     s:6172

      632     6169    2             IF SDCB$=ADDR(NIL) THEN RETURN;

   6169  1 002050   200031 236100                    LDQ     SDCB$,,AUTO
         1 002051   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002052   002055 601000 1                  TNZ     s:6170

   6169  1 002053   200110 221300                    LDX1  ! LNAME+2,,AUTO
         1 002054   000001 702211                    TSX2  ! 1,X1

      633     6170    2             ELSE IF F$DCB.FCD THEN RETURN;

   6170  1 002055   200031 470500                    LDP0    SDCB$,,AUTO
         1 002056   000031 236100                    LDQ     25,,PR0
         1 002057   020000 316007                    CANQ    8192,DL
         1 002060   002063 600000 1                  TZE     s:6171

   6170  1 002061   200110 221300                    LDX1  ! LNAME+2,,AUTO
         1 002062   000001 702211                    TSX2  ! 1,X1

      634     6171    2                  ELSE CALL CLOSEM;

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:90   
   6171  1 002063   002221 701000 1                  TSX1    CLOSEM
         1 002064   000000 011000                    NOP     0

      635     6172    3        IF SCRUBTO=1 THEN DO;

   6172  1 002065   200036 235100                    LDA     SCRUBTO,,AUTO
         1 002066   000001 115007                    CMPA    1,DL
         1 002067   002166 601000 1                  TNZ     s:6192

      636     6173    4             IF SDCB$~=ADDR(NIL) THEN DO;

   6173  1 002070   200031 236100                    LDQ     SDCB$,,AUTO
         1 002071   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002072   002155 600000 1                  TZE     s:6189

      637     6174    4                  IF F$DCB.FCD THEN

   6174  1 002073   200031 470500                    LDP0    SDCB$,,AUTO
         1 002074   000031 236100                    LDQ     25,,PR0
         1 002075   020000 316007                    CANQ    8192,DL
         1 002076   002103 600000 1                  TZE     s:6176

      638     6175    4                       CALL FMP$CLSF(CLOSE$STREAM$);

   6175  1 002077   000032 630400 2                  EPPR0   26
         1 002100   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002101   000000 701000 xent               TSX1    FMP$CLSF
         1 002102   000000 011000                    NOP     0

      639     6176    5                  IF B$ROSEG.STREAMID.FLG(I)~=1 THEN DO;

   6176  1 002103   000000 470400 xsym               LDP0    B$ROSEG$
         1 002104   200026 720100                    LXL0    I,,AUTO
         1 002105   000074 236110                    LDQ     60,X0,PR0
         1 002106   600000 376003                    ANQ     -65536,DU
         1 002107   200000 116003                    CMPQ    65536,DU
         1 002110   002142 600000 1                  TZE     s:6185
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:91   

      640     6177    5                       B$ROSEG.STREAMID.FLG(I)=1;

   6177  1 002111   000074 236110                    LDQ     60,X0,PR0
         1 002112   000033 376000 2                  ANQ     27
         1 002113   200000 276003                    ORQ     65536,DU
         1 002114   000074 756110                    STQ     60,X0,PR0

      641     6178    5                       CALL CHARBIN(J,ADDR(F$DCB.NAME)->OSFN.NUM);

   6178  1 002115   200031 470500                    LDP0    SDCB$,,AUTO
         1 002116   000100 305500                    DTB
         1 002117   000012 430006                    NDSC9   10,,PR0                  cn=2,s=nosgn,sf=0,n=6
         1 002120   200027 000004                    NDSC9   J,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

      642     6179    5                       B$ROSEG.STREAMID.IDENT(I)=J;

   6179  1 002121   200027 720100                    LXL0    J,,AUTO
         1 002122   000000 471400 xsym               LDP1    B$ROSEG$
         1 002123   200026 721100                    LXL1    I,,AUTO
         1 002124   100074 440111                    SXL0    60,X1,PR1

      643     6180    5                       IF F$DCB.FORM$~=ADDR(NIL) THEN

   6180  1 002125   200031 470500                    LDP0    SDCB$,,AUTO
         1 002126   000050 236100                    LDQ     40,,PR0
         1 002127   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002130   002142 600000 1                  TZE     s:6185

      644     6181    5                            IF F$DCB.FORM$->CODE16.RECNO~=0 OR

   6181  1 002131   000050 471500                    LDP1    40,,PR0
         1 002132   100004 235100                    LDA     4,,PR1
         1 002133   002136 601000 1                  TNZ     s:6183
         1 002134   100005 220100                    LDX0    5,,PR1
         1 002135   002142 600000 1                  TZE     s:6185

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:92   
      645     6182    5                                 F$DCB.FORM$->CODE16.PAGENO~=0 THEN
      646     6183    5                                 B$ROSEG.STREAMID.F01(I)='1'B;

   6183  1 002136   000000 473400 xsym               LDP3    B$ROSEG$
         1 002137   200026 720100                    LXL0    I,,AUTO
         1 002140   100000 236003                    LDQ     32768,DU
         1 002141   300074 256110                    ORSQ    60,X0,PR3

      647     6184    5                     END;

      648     6185    4                  CALL FSA$FDCB(SDCB$);

   6185  1 002142   200031 630500                    EPPR0   SDCB$,,AUTO
         1 002143   200116 450500                    STP0    @PTR$+1,,AUTO
         1 002144   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 002145   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002146   000000 701000 xent               TSX1    FSA$FDCB
         1 002147   000000 011000                    NOP     0

      649     6186    4                  B$JIT.ERR=SAVERR;

   6186  1 002150   200037 236100                    LDQ     SAVERR,,AUTO
         1 002151   000000 470400 xsym               LDP0    B$JIT$
         1 002152   000012 756100                    STQ     10,,PR0

      650     6187    4                  RETURN;

   6187  1 002153   200110 221300                    LDX1  ! LNAME+2,,AUTO
         1 002154   000001 702211                    TSX2  ! 1,X1

      651     6188    4                END;
      652     6189    3             ELSE IF B$ROSEG.STREAMID.FLG(I)=1 THEN RETURN;

   6189  1 002155   000000 470400 xsym               LDP0    B$ROSEG$
         1 002156   200026 720100                    LXL0    I,,AUTO
         1 002157   000074 236110                    LDQ     60,X0,PR0
         1 002160   600000 376003                    ANQ     -65536,DU
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:93   
         1 002161   200000 116003                    CMPQ    65536,DU
         1 002162   002165 601000 1                  TNZ     s:6190

   6189  1 002163   200110 221300                    LDX1  ! LNAME+2,,AUTO
         1 002164   000001 702211                    TSX2  ! 1,X1

      653     6190    3                  ELSE SCRUBTO=0;

   6190  1 002165   200036 450100                    STZ     SCRUBTO,,AUTO

      654     6191    3           END;

      655     6192    3        IF SCRUBTO=0 THEN DO;

   6192  1 002166   200036 235100                    LDA     SCRUBTO,,AUTO
         1 002167   002214 601000 1                  TNZ     SAVERROR

      656     6193    4             IF SDCB$~=ADDR(NIL) THEN DO;

   6193  1 002170   200031 236100                    LDQ     SDCB$,,AUTO
         1 002171   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002172   002211 600000 1                  TZE     s:6198

      657     6194    4                  IF F$DCB.FCD THEN

   6194  1 002173   200031 470500                    LDP0    SDCB$,,AUTO
         1 002174   000031 236100                    LDQ     25,,PR0
         1 002175   020000 316007                    CANQ    8192,DL
         1 002176   002203 600000 1                  TZE     s:6196

      658     6195    4                       CALL FMP$CLSF(CLOSESCRATCH$);

   6195  1 002177   000034 630400 2                  EPPR0   28
         1 002200   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002201   000000 701000 xent               TSX1    FMP$CLSF
         1 002202   000000 011000                    NOP     0

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:94   
      659     6196    4                  CALL FSA$FDCB(SDCB$);

   6196  1 002203   200031 630500                    EPPR0   SDCB$,,AUTO
         1 002204   200116 450500                    STP0    @PTR$+1,,AUTO
         1 002205   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 002206   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002207   000000 701000 xent               TSX1    FSA$FDCB
         1 002210   000000 011000                    NOP     0

      660     6197    4                END;

      661     6198    3             B$ROSEG.STREAMID(I)='0'B;

   6198  1 002211   000000 470400 xsym               LDP0    B$ROSEG$
         1 002212   200026 720100                    LXL0    I,,AUTO
         1 002213   000074 450110                    STZ     60,X0,PR0

      662     6199    3           END;

      663     6200    2   SAVERROR:
      664     6201    2        B$JIT.ERR=SAVERR;

   6201  1 002214   200037 236100       SAVERROR     LDQ     SAVERR,,AUTO
         1 002215   000000 470400 xsym               LDP0    B$JIT$
         1 002216   000012 756100                    STQ     10,,PR0

      665     6202    2   RETN: RETURN;

   6202  1 002217   200110 221300       RETN         LDX1  ! LNAME+2,,AUTO
         1 002220   000001 702211                    TSX2  ! 1,X1

      666     6203        /**/
      667     6204    2   CLOSEM: PROC;

   6204  1 002221   200114 741300       CLOSEM       STX1  ! NEWRES+1,,AUTO

      668     6205    3        J=B$ROSEG.NUMDCBS;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:95   

   6205  1 002222   000000 470400 xsym               LDP0    B$ROSEG$
         1 002223   000002 236100                    LDQ     2,,PR0
         1 002224   000022 772000                    QRL     18
         1 002225   200027 756100                    STQ     J,,AUTO

      669     6206    4        DO WHILE (J>=%M$MAXNEG#);

   6206  1 002226   002253 710000 1                  TRA     s:6214

      670     6207    4             IF B$ROSEG.DCBPTR$->B$RODCB$(J)~=ADDR(NIL) THEN

   6207  1 002227   000000 470400 xsym               LDP0    B$ROSEG$
         1 002230   000000 471500                    LDP1    0,,PR0
         1 002231   200027 720100                    LXL0    J,,AUTO
         1 002232   100000 236110                    LDQ     0,X0,PR1
         1 002233   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002234   002251 600000 1                  TZE     s:6213

      671     6208    4                  IF B$ROSEG.DCBPTR$->B$RODCB$(J)->F$DCB.CFU$=SDCB$ THEN

   6208  1 002235   100000 473510                    LDP3    0,X0,PR1
         1 002236   300066 236100                    LDQ     54,,PR3
         1 002237   200031 116100                    CMPQ    SDCB$,,AUTO
         1 002240   002251 601000 1                  TNZ     s:6213

      672     6209    4                       IF B$ROSEG.DCBPTR$->B$RODCB$(J)->F$DCB.FCD THEN

   6209  1 002241   300031 236100                    LDQ     25,,PR3
         1 002242   020000 316007                    CANQ    8192,DL
         1 002243   002247 600000 1                  TZE     s:6212

      673     6210    4                            B$ROSEG.DCBPTR$->B$RODCB$(J)->F$DCB.FCD=%NO#;

   6210  1 002244   000035 236000 2                  LDQ     29
         1 002245   300031 356100                    ANSQ    25,,PR3
         1 002246   002251 710000 1                  TRA     s:6213
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:96   

      674     6211    4                       ELSE
      675     6212    4                            B$ROSEG.DCBPTR$->B$RODCB$(J)->F$DCB.CFU$=ADDR(NIL);

   6212  1 002247   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 002250   300066 756100                    STQ     54,,PR3

      676     6213    4             J=J-1;

   6213  1 002251   000001 336007                    LCQ     1,DL
         1 002252   200027 056100                    ASQ     J,,AUTO

      677     6214    4           END;

   6214  1 002253   200027 235100                    LDA     J,,AUTO
         1 002254   000036 115000 2                  CMPA    30
         1 002255   002227 605000 1                  TPL     s:6207

      678     6215    3        SCRUBTO=1;

   6215  1 002256   000001 236007                    LDQ     1,DL
         1 002257   200036 756100                    STQ     SCRUBTO,,AUTO

      679     6216    3        RETURN;

   6216  1 002260   200114 221300                    LDX1  ! NEWRES+1,,AUTO
         1 002261   000001 702211                    TSX2  ! 1,X1

      680     6217    3   END CLOSEM;
      681     6218        /**/
      682     6219    2   TRUNKET: PROC;

   6219  1 002262   200114 741300       TRUNKET      STX1  ! NEWRES+1,,AUTO

      683     6220    4        IF FPT$LDEV_V.DELETE THEN DO;

   6220  1 002263   000000 470400 xsym               LDP0    B$PS0$
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:97   
         1 002264   000001 236100                    LDQ     1,,PR0
         1 002265   040000 316003                    CANQ    16384,DU
         1 002266   002321 600000 1                  TZE     s:6227

      684     6221    4             CALL FSL$ACCT(SDCB$->F$DCB,'1'B);/*Acct Delete*/

   6221  1 002267   000037 236000 2                  LDQ     31
         1 002270   200031 235100                    LDA     SDCB$,,AUTO
         1 002271   200116 757100                    STAQ    @PTR$+1,,AUTO
         1 002272   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 002273   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002274   000000 701000 xent               TSX1    FSL$ACCT
         1 002275   000000 011000                    NOP     0

      685     6222    4             IF ADDR(SDCB$->F$DCB.NAME)->OSFN.CNUM~='000' THEN

   6222  1 002276   200031 470500                    LDP0    SDCB$,,AUTO
         1 002277   000014 236100                    LDQ     12,,PR0
         1 002300   000171 676000 0                  ERQ     LNAMECHARS+19
         1 002301   000003 376000 2                  ANQ     3
         1 002302   002314 600000 1                  TZE     s:6224

      686     6223    4                  CALL FSX$TELLOUTSYM(SDCB$->F$DCB,,1);

   6223  1 002303   000040 236000 2                  LDQ     32
         1 002304   200120 756100                    STQ     @PTR$+3,,AUTO
         1 002305   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 002306   200031 235100                    LDA     SDCB$,,AUTO
         1 002307   200116 757100                    STAQ    @PTR$+1,,AUTO
         1 002310   200116 630500                    EPPR0   @PTR$+1,,AUTO
         1 002311   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002312   000000 701000 xent               TSX1    FSX$TELLOUTSYM
         1 002313   000000 011000                    NOP     0

      687     6224    4             CALL FMP$CLSF(CLOSESCRATCH$);

   6224  1 002314   000034 630400 2                  EPPR0   28
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:98   
         1 002315   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002316   000000 701000 xent               TSX1    FMP$CLSF
         1 002317   000000 011000                    NOP     0

      688     6225    4           END;

   6225  1 002320   002350 710000 1                  TRA     s:6237

      689     6226    4        ELSE DO;

      690     6227    4             IF F$DCB.FORM$->CODE16.RECNO~=0 OR

   6227  1 002321   200031 471500                    LDP1    SDCB$,,AUTO
         1 002322   100050 473500                    LDP3    40,,PR1
         1 002323   300004 235100                    LDA     4,,PR3
         1 002324   002327 601000 1                  TNZ     s:6229
         1 002325   300005 220100                    LDX0    5,,PR3
         1 002326   002344 600000 1                  TZE     s:6234

      691     6228    5                  F$DCB.FORM$->CODE16.PAGENO~=0 THEN DO;

      692     6229    5                  CALL FSL$ACCT(SDCB$->F$DCB);

   6229  1 002327   200031 630500                    EPPR0   SDCB$,,AUTO
         1 002330   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002331   000000 701000 xent               TSX1    FSL$ACCT
         1 002332   000000 011000                    NOP     0

      693     6230    5                  CALL FMP$CLSF(CLOSE$STREAM$);

   6230  1 002333   000032 630400 2                  EPPR0   26
         1 002334   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002335   000000 701000 xent               TSX1    FMP$CLSF
         1 002336   000000 011000                    NOP     0

      694     6231    5                  CALL FSX$TELLOUTSYM(SDCB$->F$DCB);

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:99   
   6231  1 002337   200031 630500                    EPPR0   SDCB$,,AUTO
         1 002340   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002341   000000 701000 xent               TSX1    FSX$TELLOUTSYM
         1 002342   000000 011000                    NOP     0

      695     6232    5                END;

   6232  1 002343   002350 710000 1                  TRA     s:6237

      696     6233    5             ELSE DO;

      697     6234    5                  CALL FMP$CLSF(CLOSESCRATCH$);

   6234  1 002344   000034 630400 2                  EPPR0   28
         1 002345   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002346   000000 701000 xent               TSX1    FMP$CLSF
         1 002347   000000 011000                    NOP     0

      698     6235    5                END;

      699     6236    4           END;

      700     6237    3        SCRUBTO=0;

   6237  1 002350   200036 450100                    STZ     SCRUBTO,,AUTO

      701     6238    3   END TRUNKET;

   6238  1 002351   200114 221300                    LDX1  ! NEWRES+1,,AUTO
         1 002352   000001 702211                    TSX2  ! 1,X1

      702     6239        /**/
      703     6240    2   SETDDF: PROC(PTR$);

   6240  1 002353   200114 741300       SETDDF       STX1  ! NEWRES+1,,AUTO

      704     6241    3   DCL PTR$ PTR;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:100  
      705     6242    3        PINCRW(PTR$,1)->FS$DDF=FS$AUTODDF;

   6242  1 002354   200115 470500                    LDP0    @PTR$,,AUTO
         1 002355   000000 471500                    LDP1    0,,PR0
         1 002356   000100 100500                    MLR     fill='000'O
         1 002357   200102 000020                    ADSC9   FS$AUTODDF,,AUTO         cn=0,n=16
         1 002360   100001 000020                    ADSC9   1,,PR1                   cn=0,n=16

      706     6243    3        PTR$->FS$DDFSZ.SEQ=F$DCB.SEQ;

   6243  1 002361   000000 471500                    LDP1    0,,PR0
         1 002362   200031 473500                    LDP3    SDCB$,,AUTO
         1 002363   300044 236100                    LDQ     36,,PR3
         1 002364   100002 676100                    ERQ     2,,PR1
         1 002365   000400 376007                    ANQ     256,DL
         1 002366   100002 656100                    ERSQ    2,,PR1

      707     6244    3        PTR$->FS$DDFSZ.F.SEQ=F$DCB.SEQ;

   6244  1 002367   000000 471500                    LDP1    0,,PR0
         1 002370   200031 473500                    LDP3    SDCB$,,AUTO
         1 002371   300044 236100                    LDQ     36,,PR3
         1 002372   000031 736000                    QLS     25
         1 002373   100001 676100                    ERQ     1,,PR1
         1 002374   100000 376003                    ANQ     32768,DU
         1 002375   100001 656100                    ERSQ    1,,PR1

      708     6245    4        IF PTR$->FS$DDFSZ.SEQ THEN DO;

   6245  1 002376   000000 471500                    LDP1    0,,PR0
         1 002377   100002 236100                    LDQ     2,,PR1
         1 002400   000400 316007                    CANQ    256,DL
         1 002401   002413 600000 1                  TZE     s:6249

      709     6246    4             PTR$->FS$DDFSZ.SEQID=F$DCB.SEQID;

   6246  1 002402   200031 473500                    LDP3    SDCB$,,AUTO
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:101  
         1 002403   300045 236100                    LDQ     37,,PR3
         1 002404   100003 756100                    STQ     3,,PR1

      710     6247    4             PTR$->FS$DDFSZ.SEQCOL=F$DCB.SEQCOL;

   6247  1 002405   000000 471500                    LDP1    0,,PR0
         1 002406   200031 473500                    LDP3    SDCB$,,AUTO
         1 002407   300044 236100                    LDQ     36,,PR3
         1 002410   100002 676100                    ERQ     2,,PR1
         1 002411   000377 376007                    ANQ     255,DL
         1 002412   100002 656100                    ERSQ    2,,PR1

      711     6248    4           END;

      712     6249    3        IF F$DCB.TAB$=ADDR(NIL) THEN

   6249  1 002413   200031 471500                    LDP1    SDCB$,,AUTO
         1 002414   100047 236100                    LDQ     39,,PR1
         1 002415   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002416   002423 601000 1                  TNZ     s:6252

      713     6250    3             PTR$->FS$DDFSZ.F.TAB='0'B;

   6250  1 002417   000000 473500                    LDP3    0,,PR0
         1 002420   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 002421   300001 356100                    ANSQ    1,,PR3
         1 002422   002434 710000 1                  TRA     s:6255

      714     6251    4        ELSE DO;

      715     6252    4             PTR$->FS$DDFSZ.F.TAB='1'B;

   6252  1 002423   000000 473500                    LDP3    0,,PR0
         1 002424   400000 236003                    LDQ     -131072,DU
         1 002425   300001 256100                    ORSQ    1,,PR3

      716     6253    4             PINCRW(PTR$,SIZEW(FS$DDFSZ))->VLP$TAB=F$DCB.TAB$->VLP$TAB;
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:102  

   6253  1 002426   000000 471500                    LDP1    0,,PR0
         1 002427   200031 473500                    LDP3    SDCB$,,AUTO
         1 002430   300047 474500                    LDP4    39,,PR3
         1 002431   000100 100500                    MLR     fill='000'O
         1 002432   400000 000040                    ADSC9   0,,PR4                   cn=0,n=32
         1 002433   100005 000040                    ADSC9   5,,PR1                   cn=0,n=32

      717     6254    4           END;

      718     6255    3        IF F$DCB.HEADER$=ADDR(NIL) THEN

   6255  1 002434   200031 471500                    LDP1    SDCB$,,AUTO
         1 002435   100046 236100                    LDQ     38,,PR1
         1 002436   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002437   002444 601000 1                  TNZ     s:6258

      719     6256    3             PTR$->FS$DDFSZ.F.HDR='0'B;

   6256  1 002440   000000 473500                    LDP3    0,,PR0
         1 002441   000041 236000 2                  LDQ     33
         1 002442   300001 356100                    ANSQ    1,,PR3
         1 002443   002467 710000 1                  TRA     s:6267

      720     6257    4        ELSE DO;

      721     6258    4             PTR$->FS$DDFSZ.F.HDR='1'B;

   6258  1 002444   000000 473500                    LDP3    0,,PR0
         1 002445   200000 236003                    LDQ     65536,DU
         1 002446   300001 256100                    ORSQ    1,,PR3

      722     6259    5             IF F$DCB.HEADER$->VLP$HDRF.CTL.RESETPAGE# THEN DO;

   6259  1 002447   200031 471500                    LDP1    SDCB$,,AUTO
         1 002450   100046 473500                    LDP3    38,,PR1
         1 002451   300000 430100                    FSZN    0,,PR3
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:103  
         1 002452   002461 605000 1                  TPL     s:6264

      723     6260    5                  F$DCB.HEADER$->VLP$HDRF.CTL.RESETPAGE#='0'B;

   6260  1 002453   000042 236000 2                  LDQ     34
         1 002454   300000 356100                    ANSQ    0,,PR3

      724     6261    5                  F$DCB.FORM$->CODE16.PAGEBASE=

   6261  1 002455   200031 471500                    LDP1    SDCB$,,AUTO
         1 002456   100050 473500                    LDP3    40,,PR1
         1 002457   300005 220100                    LDX0    5,,PR3
         1 002460   300006 740100                    STX0    6,,PR3

      725     6262    5                       F$DCB.FORM$->CODE16.PAGENO;
      726     6263    5                END;

      727     6264    4             PINCRW(PTR$,SIZEW(FS$DDFSZ)+SIZEW(VLP$TAB))->VLP$HDRF=

   6264  1 002461   000000 471500                    LDP1    0,,PR0
         1 002462   200031 473500                    LDP3    SDCB$,,AUTO
         1 002463   300046 474500                    LDP4    38,,PR3
         1 002464   000100 100500                    MLR     fill='000'O
         1 002465   400000 000245                    ADSC9   0,,PR4                   cn=0,n=165
         1 002466   100015 000245                    ADSC9   13,,PR1                  cn=0,n=165

      728     6265    4                  F$DCB.HEADER$->VLP$HDRF;
      729     6266    4           END;

      730     6267    3        PTR$->FS$DDFSZ.SIZ=SIZEW(FS$DDF)+SIZEW(VLP$TAB)+SIZEW(VLP$HDRF);

   6267  1 002467   000000 471500                    LDP1    0,,PR0
         1 002470   000066 235007                    LDA     54,DL
         1 002471   100000 755100                    STA     0,,PR1

      731     6268    3        RETURN;

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:104  
   6268  1 002472   200114 221300                    LDX1  ! NEWRES+1,,AUTO
         1 002473   000001 702211                    TSX2  ! 1,X1

PL6ISDUMB
 Sect OctLoc
   0     000   000000 000040                                                    ...

CONSTOPN
 Sect OctLoc
   0     002   000024 006000   000000 006014   000000 006014   000000 006014    ................
   0     006   000000 006014   000000 006014   000000 006014   000000 006014    ................
   0     022*  000000 006014   000000 006014   000000 000042   000000 000000    ..........."....
   0     026   252525 000000   000040 252520   000040 040040   000000 000000    ..... ...   ....
   0     032   000000 777777   000000 000000   000000 000000   000000 000000    ................
   0     036   000000 000000   000000 000000   251000 622000   000000 000000    ................
   0     042   000000 000000   111250 000000   040040 040040   000000 000000    ....I...    ....
   0     046   000000 000000   000000 000000   000000 000000   ****** ******    ................

CONSTCLS
 Sect OctLoc
   0     052   000070 006000   000000 006014   000000 006014   000000 006014    .8..............
   0     056   000000 006014   000000 006014   000000 006014   000000 006014    ................
   0     066*  000000 006014   ****** ******   000000 400000   000000 000040    ...............
   0     072   000220 000000   000000 000000                                    ........

CLOSE$STREAM$
 Sect OctLoc
   0     074   000112 006000   000000 006014   000000 006014   000000 006014    .J..............
   0     100   000000 006014   000000 006014   000000 006014   000000 006014    ................
   0     110*  000000 006014   ****** ******   000000 000000   000000 000040    ...............
   0     114   000220 000000   000000 000000                                    ........

CLOSESCRATCH$
 Sect OctLoc
   0     116   000134 006000   000000 006014   000000 006014   000000 006014    .\..............
   0     122   000000 006014   000000 006014   000000 006014   000000 006014    ................
   0     132*  000000 006014   ****** ******   000000 000001   000000 000040    ...............
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:105  
   0     136   000220 000000   000000 000000                                    ........

ERR$INCONSIS
 Sect OctLoc
   0     140   062314 013702                                                    2...

ERR$LDEVSNAME
 Sect OctLoc
   0     141   062314 013712                                                    2...

ERR$LDEVNOSTREAMS
 Sect OctLoc
   0     142   062314 013722                                                    2...

ERR$INVDEV
 Sect OctLoc
   0     143   062314 013732                                                    2...

ERR$CANT_USE_TEMP_STREAM
 Sect OctLoc
   0     144   062314 014222                                                    2...

ERR$FPRG_ON_NON_GR
 Sect OctLoc
   0     145   062314 014202                                                    2...

LNAMECHARS
 Sect OctLoc
   0     146   060061 062063   064065 066067   070071 114120   103101 102104    0123456789LPCABD
   0     152   105106 107110   111112 113115   116117 121122   123124 125126    EFGHIJKMNOQRSTUV
   0     156   127130 131132                                                    WXYZ

(unnamed)
 Sect OctLoc
   0     157   040040 040040   125103 040040   060061 062063   064065 066067        UC  01234567
   0     163   070071 040040   101114 114040   114120 040040   103120 040040    89  ALL LP  CP
   0     167   107122 040040   114120 060061   060060 060040                    GR  LP01000
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:106  

(unnamed)
 Sect OctLoc
   2     000   000000 006000   000000 006000   000000 006000   777777 777000    ................
   2     004   000000 000033   000004 006000   000000 000015   000006 006000    ................
   2     010   000000 000021   000010 006000   000015 006000   000000 006000    ................
   2     014   000012 006000   777777 377777   000000 006000   000000 000052    ...............*
   2     020   000017 006000   777777 677777   777777 577777   000040 040040    .............
   2     024   000006 006000   677777 777777   700077 777777   000000 006000    .........?......
   2     030   000000 000022   000030 006000   000074 006000   177777 777777    .........<......
   2     034   000116 006000   777777 757777   777777 777740   000030 006000    .N..............
   2     040   000003 006000   577777 777777   776777 777777                    ............
      732     6269    3   END SETDDF;
      733     6270    2   END DOASTREAM;
      734     6271    1   END FSL$LDEV;
      735     6272        %EOD;

PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:107  
--  Include file information  --

   CP_6_SUBS.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B$TABLES_C.:E05TOU  cannot be made into a system file and is referenced.
   FS$FIT.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   FS_SUPER_C.:E05TOU  is referenced.
   F$CP6P_C.:E05TOU  is referenced.
   F_CP6.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  is referenced.
      No diagnostics issued in procedure FSL$LDEV.
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:108  

 **** Variables and constants ****

  ****  Section 000 RoData FSL$LDEV

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    74-0-0/d STRC(648)   r     1 CLOSE$STREAM$            116-0-0/d STRC(648)   r     1 CLOSESCRATCH$
    52-0-0/d STRC(648)   r     1 CONSTCLS                   2-0-0/d STRC(1440)  r     1 CONSTOPN
   144-0-0/b STRC        r     1 ERR$CANT_USE_TEMP_STREAM
   145-0-0/b STRC        r     1 ERR$FPRG_ON_NON_GR       140-0-0/b STRC        r     1 ERR$INCONSIS
   143-0-0/b STRC        r     1 ERR$INVDEV               142-0-0/b STRC        r     1 ERR$LDEVNOSTREAMS
   141-0-0/b STRC        r     1 ERR$LDEVSNAME            146-0-0/c CHAR        r     1 LNAMECHARS
   146-0-0/c STRC(324)   r     1 LNAMEDD                    0-0-0/w UBIN        r     1 PL6ISDUMB

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   115-0-0/w PTR         r     1 @PTR$                     64-0-0/w STRC(504)   r     1 AUTOCLS
     4-0-0/d STRC(612)   r     1 AUTOFPRG                  41-0-0/w STRC(684)   r     1 AUTOFPT
    35-0-0/b BIT         r     1 CONTFLG                   32-0-0/w PTR         r     1 DEST$
    33-0-0/w PTR         r     1 FIT$                     102-0-0/w STRC(144)   r     1 FS$AUTODDF
    26-0-0/w UBIN        r     1 I                         27-0-0/w SBIN        r     1 J
   106-0-0/c CHAR(4)     r     1 LNAME                    113-0-0/c CHAR(4)     r     1 NEWRES
   111-0-0/c CHAR(8)     r     1 NEWWSN                    34-0-0/w PTR         r     1 P$
    *0-0-0/w PTR         r     1 PTR$                      37-0-0/b BIT         r     1 SAVERR
    36-0-0/w UBIN        r     1 SCRUBTO                   31-0-0/w PTR         r     1 SDCB$
    30-0-0/w UBIN(9)     r     1 TEMPSTR                   40-0-0/b BIT         r     1 UC_STR

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$M$UC$
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:109  
     0-0-0/w PTR         r     1 B$PS0$                     0-0-0/w PTR         r     1 B$PS1$
     0-0-0/w PTR         r     1 B$PS2$                     0-0-0/w PTR         r     1 B$PS3$
     0-0-0/w PTR         r     1 B$PS4$                     0-0-0/w PTR         r     1 B$PS6$
     0-0-0/w PTR         r     1 B$ROSEG$                   0-0-0/w PTR         r     1 B$XL_UPPER_UR$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w PTR         r     1 B$RODCB$(0:0)
     0-0-0/d STRC(3024)  r     1 B$ROSEG                    0-0-0/d STRC(4608)  r     1 B$XL_UPPER_UR
     0-0-0/c ASTR(0)     r     1 BCHARJ                     0-0-0/c ASTR(0)     r     1 BCHARTAB
     0-0-0/c ACHR        r     1 CHARJ                      0-0-0/w STRC(1404)  r     1 CODE16
     0-0-0/d STRC(612)   r     1 CODE17                     0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(180)   r     1 FM$GRAN                    0-0-0/d STRC(216)   r     1 FPT$LDEV_V
     0-0-0/w STRC(144)   r     1 FS$DDF                     0-0-0/w STRC(180)   r     1 FS$DDFSZ
     0-0-0/w STRC(936)   r     1 FS$DEST                    0-0-0/w STRC(972)   r     1 FS$DESTWITH
     0-0-0/w STRC(3186)  r     1 FS$FORMREC                 0-0-0/w STRC(171)   r     1 OSFN
     0-0-0/w STRC(1485)  r     1 VLP$HDRF                   0-0-0/w STRC(288)   r     1 VLP$TAB


   Procedure FSL$LDEV requires 1340 words for executable code.
   Procedure FSL$LDEV requires 82 words of local(AUTO) storage.
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:110  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:111  
          MINI XREF LISTING

ALLLOGDEV
      5792**LABEL    5779--GOTO
AUTOCLS
      5669**DCL      6153<<ASSIGN   6156<>CALL
AUTOCLS.PROCATTR_
      5670**DCL      6154<<ASSIGN
AUTOCLS.SN_
      5669**DCL      5669--REDEF
AUTOCLS.UATTR_
      5670**DCL      6155<<ASSIGN
AUTOCLS.UTL_
      5669**DCL      5669--REDEF
AUTOFPRG
      4001**DCL      5979<<ASSIGN   6001<<ASSIGN   6107--CALL     6109>>ASSIGN   6138--CALL
AUTOFPRG.LDBYPRO#
      4005**DCL      6005<<ASSIGN
AUTOFPT
      5663**DCL      6132<<ASSIGN   6135<>CALL
AUTOFPT.ACSVEH_
      5664**DCL      5664--REDEF
AUTOFPT.ALTKEYS_
      5666**DCL      5666--REDEF    5666--REDEF
AUTOFPT.HDR_
      5665**DCL      5665--REDEF
AUTOFPT.PROCATTR_
      5664**DCL      6133<<ASSIGN
AUTOFPT.TAB_
      5665**DCL      5665--REDEF
AUTOFPT.UATTR_
      5664**DCL      6134<<ASSIGN
AUTOFPT.UHL_
      5663**DCL      5663--REDEF    5663--REDEF
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:112  
AUTOFPT.WSN_
      5665**DCL      5665--REDEF
B$JIT.DCB$
       622**DCL      5821<<ASSIGN   5899<<ASSIGN   5902>>ASSIGN   5997>>ASSIGN
B$JIT.ERR
       532**DCL      5709<<ASSIGN   5715<<ASSIGN   5721<<ASSIGN   5743<<ASSIGN   5754<<ASSIGN   5798<<ASSIGN
      5869<<ASSIGN   6125<<ASSIGN   6164>>ASSIGN   6186<<ASSIGN   6201<<ASSIGN
B$JIT.ERR.MID
       533**DCL       533--REDEF
B$JIT.WOO
       532**DCL      5923>>ASSIGN   5932>>ASSIGN
B$JIT$
        79**DCL       527--IMP-PTR  5709>>ASSIGN   5715>>ASSIGN   5721>>ASSIGN   5743>>ASSIGN   5754>>ASSIGN
      5798>>ASSIGN   5821>>ASSIGN   5869>>ASSIGN   5899>>ASSIGN   5902>>ASSIGN   5923>>ASSIGN   5932>>ASSIGN
      5997>>ASSIGN   6100<>CALL     6125>>ASSIGN   6135<>CALL     6164>>ASSIGN   6186>>ASSIGN   6201>>ASSIGN
B$M$UC$
        70**DCL      5817>>ASSIGN
B$PS0$
        71**DCL       963--IMP-PTR  5703>>IF       5704>>IF       5704>>IF       5704>>IF       5706>>IF
      5736>>IF       5738>>IF       5740>>CALLBLT  5749>>CALLBLT  5750>>CALLBLT  5775>>CALLBLT  5852>>IF
      5928>>IF       5928>>IF       5937>>IF       5937>>ASSIGN   5941>>IF       5941>>IF       5953>>IF
      5965>>ASSIGN   5987>>IF       6014>>IF       6016>>ASSIGN   6018>>IF       6019>>ASSIGN   6020>>IF
      6056>>IF       6057>>ASSIGN   6058>>ASSIGN   6059>>ASSIGN   6062>>IF       6063>>ASSIGN   6064>>IF
      6065>>ASSIGN   6066>>IF       6067>>ASSIGN   6068>>IF       6069>>ASSIGN   6220>>IF
B$PS1$
        72**DCL      6026<>CALL     6027<>CALL     6030<>CALL     6031>>ASSIGN
B$PS2$
        73**DCL      6038<>CALL     6039<>CALL     6043>>ASSIGN   6044<>CALL     6048>>ASSIGN
B$PS3$
        74**DCL      2879--IMP-PTR  5707<>CALL     5931<>CALL     5933<>CALL     5934<>CALL     5935>>ASSIGN
B$PS4$
        75**DCL      2892--IMP-PTR  5713<>CALL     5822<>CALL     5823<>CALL     5824>>ASSIGN   6083<>CALL
      6084<>CALL     6085>>ASSIGN
B$PS6$
        77**DCL      5719<>CALL     5998<>CALL     6001>>ASSIGN   6118<>CALL
B$RODCB$
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:113  
       190**DCL      6207>>IF       6208>>IF       6209>>IF       6210>>ASSIGN   6212>>ASSIGN
B$ROSEG.DCBPTR$
       155**DCL      6207>>IF       6208>>IF       6209>>IF       6210>>ASSIGN   6212>>ASSIGN
B$ROSEG.LDEVNAME
       165**DCL      5837>>IF       5855>>IF       5856<<ASSIGN   5863<<ASSIGN   5954>>IF       5955<<ASSIGN
B$ROSEG.NUMDCBS
       157**DCL      6205>>ASSIGN
B$ROSEG.STREAMID
       166**DCL      5864<<ASSIGN   5904<<ASSIGN   5907<<ASSIGN   5950<<ASSIGN   6198<<ASSIGN
B$ROSEG.STREAMID.F01
       169**DCL      6093<<ASSIGN   6183<<ASSIGN
B$ROSEG.STREAMID.FLG
       167**DCL      5811>>IF       5862>>IF       5893>>ASSIGN   6176>>IF       6177<<ASSIGN   6189>>IF
B$ROSEG.STREAMID.IDENT
       174**DCL      5898>>ASSIGN   6179<<ASSIGN
B$ROSEG.STREAMID.SUBNAME
       170**DCL      6094<<ASSIGN
B$ROSEG.STREAMID.UC_STR
       173**DCL      5811>>IF
B$ROSEG$
        78**DCL       154--IMP-PTR   190--IMP-PTR   192--IMP-PTR  5811>>IF       5811>>IF       5837>>IF
      5855>>IF       5856>>ASSIGN   5862>>IF       5863>>ASSIGN   5864>>ASSIGN   5893>>ASSIGN   5898>>ASSIGN
      5898>>ASSIGN   5904>>ASSIGN   5907>>ASSIGN   5950>>ASSIGN   5954>>IF       5955>>ASSIGN   6093>>ASSIGN
      6094>>ASSIGN   6108>>ASSIGN   6176>>IF       6177>>ASSIGN   6179>>ASSIGN   6183>>ASSIGN   6189>>IF
      6198>>ASSIGN   6205>>ASSIGN   6207>>IF       6208>>IF       6209>>IF       6210>>ASSIGN   6212>>ASSIGN
B$XL_UPPER_UR
      4425**DCL      5775>>CALLBLT
B$XL_UPPER_UR$
      4424**DCL      4425--IMP-PTR  5775>>CALLBLT
BADLNM
      5798**LABEL    5789--CALLALT  5790--CALLALT  5791--CALLALT  5792--CALLALT  5820--GOTO
BCHARJ
      4458**DCL      6031>>ASSIGN
BCHARTAB
      4459**DCL      6031<<ASSIGN
CHARJ
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:114  
      4457**DCL      5824>>ASSIGN   5935>>ASSIGN   6043<<ASSIGN   6043>>ASSIGN   6048>>ASSIGN   6085>>ASSIGN
CLOSE$STREAM$
      4636**DCL      6175<>CALL     6230<>CALL
CLOSE$STREAM$.SN_
      4636**DCL      4636--REDEF
CLOSE$STREAM$.UTL_
      4637**DCL      4637--REDEF
CLOSE$STREAM$.V
      4641**DCL      4636--DCLINIT
CLOSE$STREAM$.V.EXPIRE#
      4651**DCL      4651--REDEF
CLOSE$STREAM$.V.TYPE#
      4649**DCL      4649--REDEF
CLOSE$STREAM$.V.XTNSIZE#
      4646**DCL      4646--REDEF    4648--REDEF
CLOSEM IN PROCEDURE DOASTREAM
      6204**PROC     5946--CALL     5966--CALL     6171--CALL
CLOSESCRATCH$
      4679**DCL      6195<>CALL     6224<>CALL     6234<>CALL
CLOSESCRATCH$.SN_
      4679**DCL      4679--REDEF
CLOSESCRATCH$.UTL_
      4680**DCL      4680--REDEF
CLOSESCRATCH$.V
      4684**DCL      4679--DCLINIT
CLOSESCRATCH$.V.EXPIRE#
      4694**DCL      4694--REDEF
CLOSESCRATCH$.V.TYPE#
      4692**DCL      4692--REDEF
CLOSESCRATCH$.V.XTNSIZE#
      4689**DCL      4689--REDEF    4691--REDEF
CODE16
      5080**DCL      6082<<ASSIGN
CODE16.DVFC
      5084**DCL      6149<<ASSIGN
CODE16.FORM
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:115  
      5080**DCL      6085<<ASSIGN   6086>>ASSIGN
CODE16.LINES
      5081**DCL      6144<<ASSIGN
CODE16.PAGEBASE
      5081**DCL      6261<<ASSIGN
CODE16.PAGENO
      5080**DCL      6181>>IF       6227>>IF       6261>>ASSIGN
CODE16.RECNO
      5080**DCL      6181>>IF       6227>>IF
CODE16.STEPPAGENO
      5084**DCL      5989<<ASSIGN
CODE16.STEPRECNO
      5084**DCL      5990<<ASSIGN
CODE16.WIDTH
      5084**DCL      6147<<ASSIGN
CODE17
      4022**DCL      5979>>ASSIGN   6001>>ASSIGN   6109<<ASSIGN
CONSTCLS
      4594**DCL      6153>>ASSIGN
CONSTCLS.SN_
      4594**DCL      4594--REDEF
CONSTCLS.UTL_
      4595**DCL      4595--REDEF
CONSTCLS.V
      4599**DCL      4594--DCLINIT
CONSTCLS.V.EXPIRE#
      4609**DCL      4609--REDEF
CONSTCLS.V.TYPE#
      4607**DCL      4607--REDEF
CONSTCLS.V.XTNSIZE#
      4604**DCL      4604--REDEF    4606--REDEF
CONSTOPN
      4526**DCL      6132>>ASSIGN
CONSTOPN.ACSVEH_
      4528**DCL      4529--REDEF
CONSTOPN.ALTKEYS_
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:116  
      4534**DCL      4535--REDEF    4535--REDEF
CONSTOPN.HDR_
      4533**DCL      4534--REDEF
CONSTOPN.TAB_
      4532**DCL      4533--REDEF
CONSTOPN.UHL_
      4526**DCL      4527--REDEF    4527--REDEF
CONSTOPN.V
      4535**DCL      4526--DCLINIT
CONSTOPN.V.FSN#
      4566**DCL      4566--REDEF    4566--REDEF
CONSTOPN.WSN_
      4532**DCL      4532--REDEF
CONTFLG
      5658**DCL      5965<<ASSIGN   5994<<ASSIGN   6074>>IF
DEST$
      5655**DCL      4436--IMP-PTR  5892<<ASSIGN   5959<>CALL     5961>>ASSIGN   5962>>ASSIGN   5963>>ASSIGN
      5972>>ASSIGN   6015>>ASSIGN   6016>>ASSIGN   6019>>ASSIGN   6021>>ASSIGN   6079>>ASSIGN   6086>>ASSIGN
      6087>>ASSIGN   6098>>IF       6100<>CALL     6103<>CALL     6133>>ASSIGN   6142>>IF       6145>>IF
      6154>>ASSIGN   6166>>IF       6167<>CALL
DOASTREAM
      5880**PROC     5813--CALL     5842--CALL     5861--CALL
ERASEFORM IN PROCEDURE DOASTREAM
      6087**LABEL    6083--CALLALT
ERR$CANT_USE_TEMP_STREAM
      5104**DCL      5754>>ASSIGN
ERR$FPRG_ON_NON_GR
      5108**DCL      6125>>ASSIGN
ERR$INCONSIS
      5088**DCL      5709>>ASSIGN   5715>>ASSIGN   5721>>ASSIGN
ERR$INVDEV
      5100**DCL      5743>>ASSIGN
ERR$LDEVNOSTREAMS
      5096**DCL      5869>>ASSIGN
ERR$LDEVSNAME
      5092**DCL      5798>>ASSIGN
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:117  
F$DCB
       687**DCL      6221<>CALL     6223<>CALL     6229<>CALL     6231<>CALL
F$DCB.ACTPOS
       712**DCL       712--REDEF
F$DCB.ARS
       687**DCL       687--REDEF
F$DCB.ASN
       702**DCL      5818>>IF
F$DCB.ATTR
       705**DCL       706--REDEF    6077>>IF       6078<<ASSIGN   6099<<ASSIGN   6104<<ASSIGN
F$DCB.BORROW
       720**DCL       720--REDEF     720--REDEF     720--REDEF
F$DCB.CFU$
       721**DCL      6208>>IF       6212<<ASSIGN
F$DCB.DCBNAME.L
       734**DCL       734--IMP-SIZ  6221>>CALL     6223>>CALL     6229>>CALL     6231>>CALL
F$DCB.DDEV.IC
       693**DCL      5818>>IF
F$DCB.DVFC
       708**DCL      6097<<ASSIGN
F$DCB.EOMCHAR
       691**DCL       691--REDEF
F$DCB.FCD
       700**DCL      5818>>IF       6170>>IF       6174>>IF       6194>>IF       6209>>IF       6210<<ASSIGN
F$DCB.FLDID
       715**DCL       715--REDEF
F$DCB.FORM$
       709**DCL       709--REDEF    5989>>ASSIGN   5990>>ASSIGN   6082>>ASSIGN   6085>>ASSIGN   6086>>ASSIGN
      6144>>ASSIGN   6147>>ASSIGN   6149>>ASSIGN   6180>>IF       6181>>IF       6181>>IF       6227>>IF
      6227>>IF       6261>>ASSIGN   6261>>ASSIGN
F$DCB.FPRGX
       711**DCL      6108<<ASSIGN
F$DCB.FSECT
       725**DCL       725--REDEF
F$DCB.FSN
       702**DCL       702--REDEF     702--REDEF     703--REDEF
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:118  
F$DCB.FUN
       701**DCL      6092<<ASSIGN   6151<<ASSIGN
F$DCB.HEADER$
       708**DCL       708--REDEF    6040>>IF       6041<>CALL     6043>>ASSIGN   6046>>IF       6047>>ASSIGN
      6048>>ASSIGN   6052>>IF       6053<>CALL     6255>>IF       6259>>IF       6260>>ASSIGN   6264>>ASSIGN
F$DCB.IWL.HDRIWL
       728**DCL      6054<<ASSIGN
F$DCB.IWL.SEQIWL
       728**DCL      6060<<ASSIGN
F$DCB.IWL.TABIWL
       728**DCL      6036<<ASSIGN
F$DCB.IXTNSIZE
       706**DCL       706--REDEF
F$DCB.LASTSTA$
       696**DCL       696--REDEF
F$DCB.LINES
       708**DCL      6096<<ASSIGN
F$DCB.LVL
       721**DCL       721--REDEF
F$DCB.NAME
       696**DCL      6178--CALLBLT  6222--IF
F$DCB.NAME.C
       696**DCL       696--REDEF
F$DCB.NOEOF
       717**DCL       717--REDEF
F$DCB.NRECS
       707**DCL       707--REDEF
F$DCB.NRECX
       726**DCL       726--REDEF
F$DCB.OHDR
       718**DCL       718--REDEF
F$DCB.ORG
       701**DCL       701--REDEF
F$DCB.PRECNO
       724**DCL       724--REDEF
F$DCB.PSN
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:119  
       697**DCL      5824<<ASSIGN
F$DCB.RCSZ
       729**DCL       729--REDEF
F$DCB.RES
       697**DCL       697--REDEF    5818>>IF       5926>>ASSIGN   5943>>IF       6075<<ASSIGN
F$DCB.SEQ
       708**DCL      6057<<ASSIGN   6243>>ASSIGN   6244>>ASSIGN
F$DCB.SEQCOL
       708**DCL      6059<<ASSIGN   6247>>ASSIGN
F$DCB.SEQID
       708**DCL      6058<<ASSIGN   6246>>ASSIGN
F$DCB.SETX
       709**DCL       709--REDEF
F$DCB.TAB$
       708**DCL       709--REDEF    6028>>IF       6029<>CALL     6031>>ASSIGN   6034>>IF       6035<>CALL
      6249>>IF       6253>>ASSIGN
F$DCB.TDA
       723**DCL       723--REDEF
F$DCB.WIDTH
       694**DCL      6095<<ASSIGN
F$DCB.WSN
       698**DCL       698--REDEF    5927>>ASSIGN   5943>>IF       6076<<ASSIGN
FIT$
      5656**DCL      5825<>CALL     5827<>CALL     5828<>CALL     5968<>CALL     5969<<ASSIGN   5969>>ASSIGN
      5970>>ASSIGN   5976>>ASSIGN   5983>>ASSIGN   6090<>CALL     6100<>CALL     6103<>CALL     6104>>ASSIGN
      6105>>IF       6131>>CALL     6134>>ASSIGN   6135<>CALL     6150<>CALL     6152<>CALL     6155>>ASSIGN
      6158<>CALL     6161<>CALL
FM$GRAN
      5076**DCL      5969--ASSIGN
FMD$GBUF
        60**DCL-ENT  5825--CALL     6090--CALL     6150--CALL
FMD$RBUF
        61**DCL-ENT  5828--CALL     6158--CALL     6161--CALL
FMN$GETFIT
        42**DCL-ENT  5968--CALL
FMO$LOCCODP
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:120  
        43**DCL-ENT  5971--CALL     5977--CALL     5984--CALL
FMP$CLSF
        44**DCL-ENT  6156--CALL     6175--CALL     6195--CALL     6224--CALL     6230--CALL     6234--CALL
FPT$LDEV_V.ATTR
       965**DCL      6068>>IF       6069>>ASSIGN
FPT$LDEV_V.CONCURR
       964**DCL      6020>>IF
FPT$LDEV_V.CONTINUE
       963**DCL      5703>>IF       5928>>IF       5965>>ASSIGN   5987>>IF
FPT$LDEV_V.COPIES
       964**DCL      6018>>IF       6019>>ASSIGN
FPT$LDEV_V.DELETE
       963**DCL      5704>>IF       6220>>IF
FPT$LDEV_V.DEV
       964**DCL      5706>>IF       5738>>IF       5937>>IF       5937>>ASSIGN
FPT$LDEV_V.DVFC
       964**DCL      6064>>IF       6065>>ASSIGN
FPT$LDEV_V.FRMSTRM
       965**DCL      5736>>IF       5740>>CALLBLT  5749>>CALLBLT  5750>>CALLBLT
FPT$LDEV_V.HOLD
       964**DCL      6014>>IF
FPT$LDEV_V.HOLDCOPIES
       964**DCL      6016>>ASSIGN
FPT$LDEV_V.LINES
       964**DCL      6062>>IF       6063>>ASSIGN
FPT$LDEV_V.REMOVE
       963**DCL      5704>>IF       5852>>IF       5941>>IF       5953>>IF
FPT$LDEV_V.SCRUB
       963**DCL      5704>>IF       5928>>IF       5941>>IF
FPT$LDEV_V.SEQ
       965**DCL      6056>>IF       6057>>ASSIGN
FPT$LDEV_V.SEQCOL
       965**DCL      6059>>ASSIGN
FPT$LDEV_V.SEQID
       965**DCL      6058>>ASSIGN
FPT$LDEV_V.STREAMNAME
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:121  
       963**DCL      5775>>CALLBLT
FPT$LDEV_V.WIDTH
       965**DCL      6066>>IF       6067>>ASSIGN
FS$AUTODDF
      5673**DCL      5894<<ASSIGN   5985<<ASSIGN   6242>>ASSIGN
FS$AUTODDF.ATTR
      5674**DCL      6069<<ASSIGN   6077>>IF       6078>>ASSIGN   6099>>ASSIGN
FS$AUTODDF.DVFC
      5674**DCL      6065<<ASSIGN   6097>>ASSIGN   6148>>IF       6149>>ASSIGN
FS$AUTODDF.LINES
      5674**DCL      6063<<ASSIGN   6096>>ASSIGN   6142>>IF       6142>>IF       6144>>ASSIGN
FS$AUTODDF.WIDTH
      5673**DCL      6067<<ASSIGN   6095>>ASSIGN   6145>>IF       6145>>IF       6147>>ASSIGN
FS$DDF
      5677**DCL      5985>>ASSIGN   6242<<ASSIGN   6267--ASSIGN
FS$DDFSZ
      5681**DCL      6253--ASSIGN   6264--ASSIGN
FS$DDFSZ.F.HDR
      5681**DCL      6256<<ASSIGN   6258<<ASSIGN
FS$DDFSZ.F.SEQ
      5681**DCL      6244<<ASSIGN
FS$DDFSZ.F.TAB
      5681**DCL      6250<<ASSIGN   6252<<ASSIGN
FS$DDFSZ.SEQ
      5682**DCL      6243<<ASSIGN   6245>>IF
FS$DDFSZ.SEQCOL
      5682**DCL      6247<<ASSIGN
FS$DDFSZ.SEQID
      5682**DCL      6246<<ASSIGN
FS$DDFSZ.SIZ
      5681**DCL      6267<<ASSIGN
FS$DEST
      4428**DCL      5962--ASSIGN   5972<<ASSIGN   5972>>ASSIGN
FS$DESTWITH
      4436**DCL      5959--CALL     5961<<ASSIGN   6167--CALL
FS$DESTWITH.COPIES
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:122  
      4437**DCL      5963<<ASSIGN   6019<<ASSIGN
FS$DESTWITH.DT.WSN
      4441**DCL      6079<<ASSIGN   6087<<ASSIGN   6098>>IF
FS$DESTWITH.FLINES
      4436**DCL      6142>>IF
FS$DESTWITH.FORM
      4436**DCL      6086<<ASSIGN
FS$DESTWITH.FWIDTH
      4436**DCL      6145>>IF
FS$DESTWITH.PRINT
      4437**DCL      6021<<ASSIGN
FS$DESTWITH.SAP
      4437**DCL      6015<<ASSIGN
FS$DESTWITH.SAPCOPIES
      4437**DCL      6016<<ASSIGN
FS$DESTWITH.SIZ
      4436**DCL      5962<<ASSIGN
FS$FORMREC.ATTR
      2801**DCL      6104>>ASSIGN
FS$FORMREC.CHAINS
      2826**DCL      2836--REDEF
FS$FORMREC.GRAPHIC
      2787**DCL      6105>>IF
FSA$FDCB
        47**DCL-ENT  5949--CALL     6185--CALL     6196--CALL
FSA$FSP
        46**DCL-ENT  6035--CALL     6053--CALL     6138--CALL     6167--CALL
FSA$GSP
        45**DCL-ENT  5959--CALL     6029--CALL     6041--CALL     6107--CALL
FSB$STREAMCREATE
        48**DCL-ENT  5995--CALL
FSB$STREAMDCB
        49**DCL-ENT  5901--CALL
FSF$SYMBFILE
        66**DCL-ENT  6135--CALL
FSL$ACCT
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:123  
        50**DCL-ENT  6221--CALL     6229--CALL
FSL$UC
        51**DCL-ENT  5840--CALL     5859--CALL
FSM$UCLDEV
        52**DCL-ENT  5829--CALL
FSN$CONV_STR
        53**DCL-ENT  5751--CALL
FSW$DESTFORM
        63**DCL-ENT  6100--CALL
FSW$FORM
        64**DCL-ENT  6103--CALL
FSW$UCFORM
        65**DCL-ENT  5827--CALL
FSX$TELLOUTSYM
        54**DCL-ENT  6223--CALL     6231--CALL
HDRNEW IN PROCEDURE DOASTREAM
      6054**LABEL    6041--CALLALT  6050--GOTO
HDRZERO IN PROCEDURE DOASTREAM
      6049**LABEL    6039--CALLALT
HFF$DSIZ
        58**DCL-ENT  5823--CALL     5934--CALL     6030--CALL     6044--CALL     6084--CALL
HFF$ERASE
        56**DCL-ENT  5933--CALL     6027--CALL     6039--CALL     6083--CALL
HFF$NIL
        55**DCL-ENT  5707--CALL     5713--CALL     5719--CALL     5931--CALL     5998--CALL     6026--CALL
      6038--CALL     6081--CALL     6118--CALL
HFF$NILERASE
        57**DCL-ENT  5822--CALL
HFF$TRAPALT
        59**DCL-ENT  5826--CALL     5895--CALL     5960--CALL     5996--CALL     6091--CALL     6165--CALL
I
      5651**DCL      5740<<CALLBLT  5749<<CALLBLT  5776<<CALLBLT  5777>>DOCASE   5789<<CALLBLT  5790<<CALLBLT
      5791<<CALLBLT  5792<<CALLBLT  5810<<DOINDEX  5811>>IF       5811>>IF       5836<<DOINDEX  5837>>IF
      5840<>CALL     5854<<DOINDEX  5855>>IF       5856>>ASSIGN   5859<>CALL     5862>>IF       5863>>ASSIGN
      5864>>ASSIGN   5893>>ASSIGN   5898>>ASSIGN   5901<>CALL     5904>>ASSIGN   5907>>ASSIGN   5950>>ASSIGN
      5954>>IF       5955>>ASSIGN   5995<>CALL     6093>>ASSIGN   6094>>ASSIGN   6176>>IF       6177>>ASSIGN
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:124  
      6179>>ASSIGN   6183>>ASSIGN   6189>>IF       6198>>ASSIGN
ILLGL_DEV
      5740**LABEL    5749--CALLALT
J
      5652**DCL      4457--IMP-SIZ  4458--IMP-SIZ  5823<>CALL     5824>>ASSIGN   5934<>CALL     5935>>ASSIGN
      5967<<ASSIGN   5968<>CALL     6030<>CALL     6031>>ASSIGN   6042<<ASSIGN   6043>>ASSIGN   6043>>ASSIGN
      6044<>CALL     6045<<ASSIGN   6045>>ASSIGN   6046>>IF       6047<<ASSIGN   6048>>ASSIGN   6084<>CALL
      6085>>ASSIGN   6178<<CALLBLT  6179>>ASSIGN   6205<<ASSIGN   6206>>DOWHILE  6207>>IF       6208>>IF
      6209>>IF       6210>>ASSIGN   6212>>ASSIGN   6213<<ASSIGN   6213>>ASSIGN
LNAME
      5684**DCL      5750<<CALLBLT  5751<>CALL     5775<<CALLBLT  5776>>CALLBLT  5779>>IF       5781>>IF
      5782>>IF       5782>>IF       5782>>IF       5785<<CALLBLT  5789>>CALLBLT  5790>>CALLBLT  5791>>CALLBLT
      5792>>CALLBLT  5793>>IF       5837>>IF       5856>>ASSIGN   5924>>ASSIGN
LNAMECHARS
      5693**DCL      5695--REDEF
LNAMEDD.CHR
      5696**DCL      5791>>CALLBLT  5792>>CALLBLT
LNAMEDD.LETTERS
      5696**DCL      5789>>CALLBLT  5790>>CALLBLT
MUCLOGDEV
      5810**LABEL    5781--GOTO
NEWRES IN PROCEDURE DOASTREAM
      5882**DCL      5924<<ASSIGN   5926<<ASSIGN   5937<<ASSIGN   5943>>IF       6075>>ASSIGN
NEWWSN IN PROCEDURE DOASTREAM
      5881**DCL      5923<<ASSIGN   5927<<ASSIGN   5932<<ASSIGN   5935<<ASSIGN   5943>>IF       6076>>ASSIGN
NOFILEDDF IN PROCEDURE DOASTREAM
      5985**LABEL    5984--CALLALT
NOFORM IN PROCEDURE DOASTREAM
      6086**LABEL    6081--CALLALT
NOHDR IN PROCEDURE DOASTREAM
      6052**LABEL    6038--CALLALT
NOSEQ IN PROCEDURE DOASTREAM
      6060**LABEL    6056--GOTO
NOTAB IN PROCEDURE DOASTREAM
      6034**LABEL    6026--CALLALT
NOWSN IN PROCEDURE DOASTREAM
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:125  
      5935**LABEL    5931--CALLALT  5933--CALLALT
ONELOGDEV
      5824**LABEL    5786--GOTO     5796--GOTO
OSFN.CNUM
      4455**DCL      6222>>IF
OSFN.NUM
      4455**DCL      6178>>CALLBLT
P$
      5657**DCL      5970<<ASSIGN   5971<>CALL     5972>>ASSIGN   5976<<ASSIGN   5977<>CALL     5979>>ASSIGN
      5983<<ASSIGN   5984<>CALL     5985>>ASSIGN   6107<>CALL     6108>>ASSIGN   6109>>ASSIGN   6117<<ASSIGN
      6136>>IF       6138<>CALL
PL6ISDUMB
      4460**DCL      4459--IMP-SIZ  6031>>ASSIGN
PTR$ IN PROCEDURE SETDDF
      6241**DCL      6240--PROC     6242>>ASSIGN   6243>>ASSIGN   6244>>ASSIGN   6245>>IF       6246>>ASSIGN
      6247>>ASSIGN   6250>>ASSIGN   6252>>ASSIGN   6253>>ASSIGN   6256>>ASSIGN   6258>>ASSIGN   6264>>ASSIGN
      6267>>ASSIGN
RETN IN PROCEDURE DOASTREAM
      6202**LABEL    5901--CALLALT
RETNOO IN PROCEDURE DOASTREAM
      6161**LABEL    6091--CALLALT  6100--CALLALT  6103--CALLALT  6126--GOTO     6135--CALLALT
SAVERR
      5660**DCL      6164<<ASSIGN   6186>>ASSIGN   6201>>ASSIGN
SAVERROR IN PROCEDURE DOASTREAM
      6201**LABEL    6165--CALLALT
SCRUBCODE IN PROCEDURE DOASTREAM
      5938**LABEL    5929--GOTO     5944--EXIT
SCRUBIT IN PROCEDURE DOASTREAM
      6162**LABEL    5895--CALLALT  5959--CALLALT  5960--CALLALT  5968--CALLALT  5971--CALLALT  5995--CALLALT
      5996--CALLALT  6160--GOTO
SCRUBTO
      5659**DCL      5893<<ASSIGN   5896>>DOCASE   5908<<ASSIGN   5925>>IF       5946>>IF       5947>>IF
      5964>>IF       5966>>IF       6159<<ASSIGN   6162<<ASSIGN   6168>>IF       6172>>IF       6190<<ASSIGN
      6192>>IF       6215<<ASSIGN   6237<<ASSIGN
SC_FSBADRO
        67**DCL-ENT  5906--CALL
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:126  
SDCB$
      5654**DCL       687--IMP-PTR  5817<<ASSIGN   5818>>IF       5818>>IF       5818>>IF       5818>>IF
      5821>>ASSIGN   5824>>ASSIGN   5891<<ASSIGN   5898<<ASSIGN   5899>>ASSIGN   5902<<ASSIGN   5926>>ASSIGN
      5927>>ASSIGN   5942>>IF       5943>>IF       5943>>IF       5949<>CALL     5989>>ASSIGN   5990>>ASSIGN
      5997<<ASSIGN   6028>>IF       6029>>CALL     6031>>ASSIGN   6034>>IF       6035>>CALL     6036>>ASSIGN
      6040>>IF       6041>>CALL     6043>>ASSIGN   6046>>IF       6047>>ASSIGN   6048>>ASSIGN   6052>>IF
      6053>>CALL     6054>>ASSIGN   6057>>ASSIGN   6058>>ASSIGN   6059>>ASSIGN   6060>>ASSIGN   6075>>ASSIGN
      6076>>ASSIGN   6077>>IF       6078>>ASSIGN   6082>>ASSIGN   6085>>ASSIGN   6086>>ASSIGN   6092>>ASSIGN
      6095>>ASSIGN   6096>>ASSIGN   6097>>ASSIGN   6099>>ASSIGN   6104>>ASSIGN   6108>>ASSIGN   6144>>ASSIGN
      6147>>ASSIGN   6149>>ASSIGN   6151>>ASSIGN   6169>>IF       6170>>IF       6173>>IF       6174>>IF
      6178>>CALLBLT  6180>>IF       6181>>IF       6181>>IF       6185<>CALL     6193>>IF       6194>>IF
      6196<>CALL     6208>>IF       6221>>CALL     6221>>CALL     6222>>IF       6223>>CALL     6223>>CALL
      6227>>IF       6227>>IF       6229>>CALL     6229>>CALL     6231>>CALL     6231>>CALL     6243>>ASSIGN
      6244>>ASSIGN   6246>>ASSIGN   6247>>ASSIGN   6249>>IF       6253>>ASSIGN   6255>>IF       6259>>IF
      6260>>ASSIGN   6261>>ASSIGN   6261>>ASSIGN   6264>>ASSIGN
SETDDF IN PROCEDURE DOASTREAM
      6240**PROC     6131--CALL     6152--CALL
TABNEW IN PROCEDURE DOASTREAM
      6036**LABEL    6029--CALLALT  6032--GOTO
TABZERO IN PROCEDURE DOASTREAM
      6031**LABEL    6027--CALLALT
TEMPSTR
      5653**DCL      5751<>CALL     5753>>IF
TRUNKET IN PROCEDURE DOASTREAM
      6219**PROC     5948--CALL     5988--CALL
UCRBRET
      5828**LABEL    5826--CALLALT  5827--CALLALT
UCRET
      5829**LABEL    5822--CALLALT
UC_STR
      5661**DCL      5702<<ASSIGN   5795<<ASSIGN   5838>>IF       5857>>IF
VLP$HDRF
      2863**DCL      6041--CALL     6053--CALL     6264<<ASSIGN   6264>>ASSIGN   6267--ASSIGN
VLP$HDRF.CTL
      2863**DCL      6042--ASSIGN   6045--ASSIGN
VLP$HDRF.CTL.RESETPAGE#
PL6.E3A0      #001=FSL$LDEV File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:127  
      2863**DCL      6259>>IF       6260<<ASSIGN
VLP$HDRF.TITL.L#
      2865**DCL      6046>>IF       6047>>ASSIGN
VLP$HDRF.TITL.TITLE#
      2866**DCL      6048<<ASSIGN   6048--ASSIGN
VLP$TAB
      2849**DCL      4460--DCLINIT  6029--CALL     6035--CALL     6253<<ASSIGN   6253>>ASSIGN   6264--ASSIGN
      6267--ASSIGN

PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:128  
      736        1        /*T***********************************************************/
      737        2        /*T*                                                         */
      738        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      739        4        /*T*                                                         */
      740        5        /*T***********************************************************/
      741        6        /*F*    NAME: FSL$ACCT
      742        7                PURPOSE: FSL$ACCT writes accounting records to *S for
      743        8                   symbiont files when they are closed.
      744        9                DESCRIPTION: If the symbiont file is destined for LP
      745       10                   at user's wsn-of-origin with standard forms, pages
      746       11                   are charged into B$JIT.STDLOPGS.  If not, a record
      747       12                   is written into *S with information about number of
      748       13                   pages, records, and copies and the dev/wsn/forms.
      749       14         */
      750       15        /*D*    NAME: FSL$ACCT
      751       16                CALL: CALL FSL$ACCT(DCB, [DELETE], [COPIES]);
      752       17                DESCRIPTION:
      753       18         */
      754       19        FSL$ACCT: PROC(F$DCB,DELBIT,COPIES);
      755       20        %MACRO F$DCBI(BASED=BASED);
      756       21        %INCLUDE F$DCB;
      757       70        %MEND;
      758       71        %F$DCBI(BASED=);
      759      121    1   DCL DELBIT BIT(1)UNAL;
      760      122    1   DCL COPIES UBIN(9)UNAL;
      761      123        /***   ENTRY REFERENCES   ***/
      762      124    1   DCL FMM$DFLOPNP ENTRY;
      763      125    1   DCL FMM$SCRUB ENTRY(1);
      764      126    1   DCL FMP$CLSJ ENTRY;
      765      127    1   DCL M$MWRITE ENTRY(1)ALTRET;
      766      128        %INCLUDE F_CP6;
      767     1153        %INCLUDE CP_6_SUBS;
      768     1693        %FPT_WRITE(FPTN=CONSTWRITE,STCLASS=CONSTANT);
      769     1724        %FPT_WRITE(FPTN=AUTOWRITE,STCLASS=);
      770     1755    1   DCL B$M$STAR$ PTR SYMREF READONLY;
      771     1756        %INCLUDE FM$FIT;
      772     1977        %CODE16(BASED="BASED(F$DCB.FORM$)");
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:129  
      773     1985    1   DCL B$JIT$ PTR SYMREF;
      774     1986        %INCLUDE B$JIT;
      775     2589        %INCLUDE AZ_MACRO_C;
      776     5176        %FORM$REC(STCLASS=);
      777     5230        %FORM_KEY(STCLASS=CONSTANT);
      778     5265        %FORM$KEY(STCLASS=);
      779     5300        %EJECT;
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:130  
      780     5301    1        FORM$REC='0'B;
      781     5302    1        IF ADDR(DELBIT)~=ADDR(NIL) THEN
      782     5303    2             IF DELBIT THEN DO;
      783     5304    2                  CALL BACKOUT;
      784     5305    2                  GOTO RET;
      785     5306    2                END;
      786     5307    1        IF ADDR(COPIES)~=ADDR(NIL) THEN
      787     5308    2             IF COPIES~=CODE16.COPIES THEN DO;
      788     5309    2                  CALL BACKOUT;
      789     5310    2                  CODE16.COPIES=COPIES;
      790     5311    2                  FORM$REC.MOUNTS=0;
      791     5312    2                END;
      792     5313    1        IF CODE16.PAGENO=0 AND CODE16.RECNO=0 THEN
      793     5314    1             GOTO RET;
      794     5315    1        IF CODE16.STEPPAGENO=0 AND CODE16.STEPRECNO=0
      795     5316    2        THEN DO;
      796     5317    2             IF CODE16.NSFORM
      797     5318    3             THEN DO;
      798     5319    3                  FORM$REC.MOUNTS=1;
      799     5320    3                END;
      800     5321    2             IF CODE16.BANNER_CHARGES
      801     5322    3             THEN DO;
      802     5323    3                  FORM$REC.PAGES = CODE16.PAGENO + CODE16.BANNER_REPEATS;
      803     5324    3                END;
      804     5325    3             ELSE DO;
      805     5326    3                  FORM$REC.PAGES = CODE16.PAGENO;
      806     5327    3                END;
      807     5328    2             FORM$REC.COPIES = CODE16.COPIES;
      808     5329    2             FORM$REC.RECS = CODE16.RECNO;
      809     5330    2           END;
      810     5331    2        ELSE DO;
      811     5332    2             FORM$REC.COPIES = CODE16.COPIES;
      812     5333    2             FORM$REC.PAGES = CODE16.PAGENO - CODE16.STEPPAGENO;
      813     5334    2             FORM$REC.RECS = CODE16.RECNO - CODE16.STEPRECNO;
      814     5335    2           END;
      815     5336    1        CALL WRITEIT;
      816     5337    1   RET: B$JIT.DCB$=ADDR(F$DCB);
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:131  
      817     5338    1        CODE16.STEPRECNO=CODE16.RECNO;
      818     5339    1        CODE16.STEPPAGENO=CODE16.PAGENO;
      819     5340    1        RETURN;
      820     5341        %EJECT;
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:132  
      821     5342    1   BACKOUT:PROC;
      822     5343    2        IF CODE16.STEPPAGENO=0 AND CODE16.STEPRECNO=0 THEN RETURN;
      823     5344    2        IF CODE16.BANNER_CHARGES
      824     5345    3        THEN DO;
      825     5346    3             FORM$REC.PAGES = - CODE16.STEPPAGENO - CODE16.BANNER_REPEATS;
      826     5347    3           END;
      827     5348    3        ELSE DO;
      828     5349    3             FORM$REC.PAGES = - CODE16.STEPPAGENO;
      829     5350    3           END;
      830     5351    2        FORM$REC.RECS=-CODE16.STEPRECNO;
      831     5352    2        FORM$REC.COPIES=CODE16.COPIES;
      832     5353    2        IF CODE16.NSFORM THEN
      833     5354    2             FORM$REC.MOUNTS=-1;
      834     5355    2        CODE16.STEPPAGENO=0;
      835     5356    2        CODE16.STEPRECNO=0;
      836     5357        /**/
      837     5358    2   WRITEIT: ENTRY;
      838     5359    2        IF FORM$REC.PAGES=0 AND FORM$REC.RECS=0 THEN RETURN;
      839     5360    2        IF F$DCB.WSN~=B$JIT.WOO OR SUBSTR(F$DCB.RES,0,2)~='LP' OR
      840     5361    3             CODE16.FORM~='STDLP' THEN DO;
      841     5362    3             CALL OPENSTAR ALTRET(RETN);
      842     5363    3             FORM$KEY=FORM_KEY;
      843     5364    3             FORM$KEY.STEP=B$JIT.STEPS;
      844     5365    3             FORM$KEY.UNIQUE=B$JIT.ARECX;
      845     5366    3             B$JIT.ARECX=B$JIT.ARECX+1;
      846     5367    3             FORM$REC.DDEV=CODE16.DDEV;
      847     5368    3             FORM$REC.S1.FORMNAME=CODE16.FORM;
      848     5369    3             FORM$REC.S1.DD=F$DCB.RES;
      849     5370    3             FORM$REC.S1.WSN=F$DCB.WSN;
      850     5371    3             AUTOWRITE=CONSTWRITE;
      851     5372    3             AUTOWRITE.BUF_=VECTOR(FORM$REC);
      852     5373    3             AUTOWRITE.KEY_=VECTOR(FORM$KEY);
      853     5374    3             AUTOWRITE.V_=VECTOR(AUTOWRITE.V);
      854     5375    3             AUTOWRITE.V.DCB#=%M$STAR#;
      855     5376    3             CALL M$MWRITE(AUTOWRITE)ALTRET(ALTR);
      856     5377    3   ALTR:     CALL FMP$CLSJ;
      857     5378    3   RETN:     ;
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:133  
      858     5379    3             RETURN;
      859     5380    3           END;
      860     5381    2        B$JIT.STDLOPGS=B$JIT.STDLOPGS
      861     5382    2             +FORM$REC.PAGES*FORM$REC.COPIES;
      862     5383    2        RETURN;
      863     5384    2   OPENSTAR: PROC ALTRET;
      864     5385        %F$DCBI(BASED="BASED(B$M$STAR$)");
      865     5435    3        B$JIT.DCB$=B$M$STAR$;
      866     5436    3        IF F$DCB.FCD THEN
      867     5437    3             CALL FMP$CLSJ;
      868     5438    3        CALL FMM$SCRUB(B$M$STAR$);
      869     5439    3        F$DCB.ASN=%FILE#;
      870     5440    3        F$DCB.ORG=%KEYED#;
      871     5441    3        F$DCB.FUN=%CREATE#;
      872     5442    3        F$DCB.EXIST=%OLDFILE#;
      873     5443    3        F$DCB.SHARE=%ALL#;
      874     5444    3        F$DCB.ACS=%DIRECT#;
      875     5445    3        F$DCB.NAME.L=2;
      876     5446    3        F$DCB.NAME.C='*S';
      877     5447    3        B$JIT.ERR='0'B;
      878     5448    3        CALL FMM$DFLOPNP;
      879     5449    3        IF B$JIT.ERR.CODE=0 THEN RETURN;
      880     5450    3        ALTRETURN;
      881     5451    3   END OPENSTAR;
      882     5452    2   END BACKOUT;
      883     5453        /**/
      884     5454    1   END FSL$ACCT;
      885     5455        %EOD;

PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:134  
--  Include file information  --

   G_JIT_M.:E05TOU  is referenced.
   AZ_MACRO_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   FM$FIT.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   F_CP6.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
      No diagnostics issued in procedure FSL$ACCT.

   Procedure FSL$ACCT requires 290 words for executable code.
   Procedure FSL$ACCT requires 36 words of local(AUTO) storage.

PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:135  

 Object Unit name= FSL$ACCT                                   File name= FSL$LDEV.:E05TOU
 UTS= JUL 29 '97 17:34:41.72 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     18     22  FSL$ACCT
    1   Proc  even  none   290    442  FSL$ACCT
    2  RoData even  none     6      6  FSL$ACCT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        3  FSL$ACCT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 M$MWRITE
         yes           Std       0 FMP$CLSJ
         yes           Std       1 FMM$SCRUB
         yes           Std       0 FMM$DFLOPNP
                       nStd      0 X66_AUTO_3
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:136  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    B$M$STAR$                             B$JIT$                                B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:137  


      736        1        /*T***********************************************************/
      737        2        /*T*                                                         */
      738        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      739        4        /*T*                                                         */
      740        5        /*T***********************************************************/
      741        6        /*F*    NAME: FSL$ACCT
      742        7                PURPOSE: FSL$ACCT writes accounting records to *S for
      743        8                   symbiont files when they are closed.
      744        9                DESCRIPTION: If the symbiont file is destined for LP
      745       10                   at user's wsn-of-origin with standard forms, pages
      746       11                   are charged into B$JIT.STDLOPGS.  If not, a record
      747       12                   is written into *S with information about number of
      748       13                   pages, records, and copies and the dev/wsn/forms.
      749       14         */
      750       15        /*D*    NAME: FSL$ACCT
      751       16                CALL: CALL FSL$ACCT(DCB, [DELETE], [COPIES]);
      752       17                DESCRIPTION:
      753       18         */
      754       19        FSL$ACCT: PROC(F$DCB,DELBIT,COPIES);

     19  1 000000   000000 700200 xent  FSL$ACCT     TSX0  ! X66_AUTO_3
         1 000001   000044 000003                    ZERO    36,3

      755       20        %MACRO F$DCBI(BASED=BASED);
      756       21        %INCLUDE F$DCB;
      757       70        %MEND;
      758       71        %F$DCBI(BASED=);
      759      121    1   DCL DELBIT BIT(1)UNAL;
      760      122    1   DCL COPIES UBIN(9)UNAL;
      761      123        /***   ENTRY REFERENCES   ***/
      762      124    1   DCL FMM$DFLOPNP ENTRY;
      763      125    1   DCL FMM$SCRUB ENTRY(1);
      764      126    1   DCL FMP$CLSJ ENTRY;
      765      127    1   DCL M$MWRITE ENTRY(1)ALTRET;
      766      128        %INCLUDE F_CP6;
      767     1153        %INCLUDE CP_6_SUBS;
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:138  
      768     1693        %FPT_WRITE(FPTN=CONSTWRITE,STCLASS=CONSTANT);
      769     1724        %FPT_WRITE(FPTN=AUTOWRITE,STCLASS=);
      770     1755    1   DCL B$M$STAR$ PTR SYMREF READONLY;
      771     1756        %INCLUDE FM$FIT;
      772     1977        %CODE16(BASED="BASED(F$DCB.FORM$)");
      773     1985    1   DCL B$JIT$ PTR SYMREF;
      774     1986        %INCLUDE B$JIT;
      775     2589        %INCLUDE AZ_MACRO_C;
      776     5176        %FORM$REC(STCLASS=);
      777     5230        %FORM_KEY(STCLASS=CONSTANT);
      778     5265        %FORM$KEY(STCLASS=);
      779     5300        %EJECT;
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:139  
      780     5301    1        FORM$REC='0'B;

   5301  1 000002   000100 100400                    MLR     fill='000'O
         1 000003   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000004   200022 000044                    ADSC9   FORM$REC,,AUTO           cn=0,n=36

      781     5302    1        IF ADDR(DELBIT)~=ADDR(NIL) THEN

   5302  1 000005   200004 236100                    LDQ     @DELBIT,,AUTO
         1 000006   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000007   000020 600000 1                  TZE     s:5307

      782     5303    2             IF DELBIT THEN DO;

   5303  1 000010   200004 470500                    LDP0    @DELBIT,,AUTO
         1 000011   000000 066500                    CMPB    filb='0'B
         1 000012   000000 000001                    BDSC    0,,PR0                   by=0,bit=0,n=1
         1 000013   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         1 000014   000020 600000 1                  TZE     s:5307

      783     5304    2                  CALL BACKOUT;

   5304  1 000015   000150 701000 1                  TSX1    BACKOUT
         1 000016   000000 011000                    NOP     0

      784     5305    2                  GOTO RET;

   5305  1 000017   000135 710000 1                  TRA     RET

      785     5306    2                END;
      786     5307    1        IF ADDR(COPIES)~=ADDR(NIL) THEN

   5307  1 000020   200005 236100                    LDQ     @COPIES,,AUTO
         1 000021   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000022   000051 600000 1                  TZE     s:5313

      787     5308    2             IF COPIES~=CODE16.COPIES THEN DO;
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:140  

   5308  1 000023   200003 470500                    LDP0    @F$DCB,,AUTO
         1 000024   000050 471500                    LDP1    40,,PR0
         1 000025   100007 236100                    LDQ     7,,PR1
         1 000026   000022 772000                    QRL     18
         1 000027   000777 376007                    ANQ     511,DL
         1 000030   200042 756100                    STQ     FORM$KEY+7,,AUTO
         1 000031   200005 473500                    LDP3    @COPIES,,AUTO
         1 000032   003100 061500                    CSR     bolr='003'O
         1 000033   300000 000011                    BDSC    0,,PR3                   by=0,bit=0,n=9
         1 000034   200043 000044                    BDSC    FORM$KEY+8,,AUTO         by=0,bit=0,n=36
         1 000035   200043 236100                    LDQ     FORM$KEY+8,,AUTO
         1 000036   200042 116100                    CMPQ    FORM$KEY+7,,AUTO
         1 000037   000051 600000 1                  TZE     s:5313

      788     5309    2                  CALL BACKOUT;

   5309  1 000040   000150 701000 1                  TSX1    BACKOUT
         1 000041   000000 011000                    NOP     0

      789     5310    2                  CODE16.COPIES=COPIES;

   5310  1 000042   200003 470500                    LDP0    @F$DCB,,AUTO
         1 000043   000050 471500                    LDP1    40,,PR0
         1 000044   200005 473500                    LDP3    @COPIES,,AUTO
         1 000045   003100 060500                    CSL     bolr='003'O
         1 000046   300000 000011                    BDSC    0,,PR3                   by=0,bit=0,n=9
         1 000047   100007 200011                    BDSC    7,,PR1                   by=1,bit=0,n=9

      790     5311    2                  FORM$REC.MOUNTS=0;

   5311  1 000050   200022 450100                    STZ     FORM$REC,,AUTO

      791     5312    2                END;

      792     5313    1        IF CODE16.PAGENO=0 AND CODE16.RECNO=0 THEN

PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:141  
   5313  1 000051   200003 470500                    LDP0    @F$DCB,,AUTO
         1 000052   000050 471500                    LDP1    40,,PR0
         1 000053   100005 220100                    LDX0    5,,PR1
         1 000054   000057 601000 1                  TNZ     s:5315
         1 000055   100004 235100                    LDA     4,,PR1
         1 000056   000135 600000 1                  TZE     RET

      793     5314    1             GOTO RET;
      794     5315    1        IF CODE16.STEPPAGENO=0 AND CODE16.STEPRECNO=0

   5315  1 000057   100024 221100                    LDX1    20,,PR1
         1 000060   000115 601000 1                  TNZ     s:5332
         1 000061   100025 235100                    LDA     21,,PR1
         1 000062   000115 601000 1                  TNZ     s:5332

      795     5316    2        THEN DO;

      796     5317    2             IF CODE16.NSFORM

   5317  1 000063   100007 236100                    LDQ     7,,PR1
         1 000064   040000 316003                    CANQ    16384,DU
         1 000065   000070 600000 1                  TZE     s:5321

      797     5318    3             THEN DO;

      798     5319    3                  FORM$REC.MOUNTS=1;

   5319  1 000066   000001 235007                    LDA     1,DL
         1 000067   200022 755100                    STA     FORM$REC,,AUTO

      799     5320    3                END;

      800     5321    2             IF CODE16.BANNER_CHARGES

   5321  1 000070   100007 236100                    LDQ     7,,PR1
         1 000071   002000 316003                    CANQ    1024,DU
         1 000072   000105 600000 1                  TZE     s:5326
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:142  

      801     5322    3             THEN DO;

      802     5323    3                  FORM$REC.PAGES = CODE16.PAGENO + CODE16.BANNER_REPEATS;

   5323  1 000073   100007 236100                    LDQ     7,,PR1
         1 000074   000011 772000                    QRL     9
         1 000075   000777 376007                    ANQ     511,DL
         1 000076   200042 756100                    STQ     FORM$KEY+7,,AUTO
         1 000077   100005 236100                    LDQ     5,,PR1
         1 000100   000022 772000                    QRL     18
         1 000101   200042 036100                    ADLQ    FORM$KEY+7,,AUTO
         1 000102   000000 620006                    EAX0    0,QL
         1 000103   200024 740100                    STX0    FORM$REC+2,,AUTO

      803     5324    3                END;

   5324  1 000104   000107 710000 1                  TRA     s:5328

      804     5325    3             ELSE DO;

      805     5326    3                  FORM$REC.PAGES = CODE16.PAGENO;

   5326  1 000105   100005 220100                    LDX0    5,,PR1
         1 000106   200024 740100                    STX0    FORM$REC+2,,AUTO

      806     5327    3                END;

      807     5328    2             FORM$REC.COPIES = CODE16.COPIES;

   5328  1 000107   100007 221100                    LDX1    7,,PR1
         1 000110   000777 361003                    ANX1    511,DU
         1 000111   200024 441100                    SXL1    FORM$REC+2,,AUTO

      808     5329    2             FORM$REC.RECS = CODE16.RECNO;

   5329  1 000112   100004 235100                    LDA     4,,PR1
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:143  
         1 000113   200023 755100                    STA     FORM$REC+1,,AUTO

      809     5330    2           END;

   5330  1 000114   000133 710000 1                  TRA     s:5336

      810     5331    2        ELSE DO;

      811     5332    2             FORM$REC.COPIES = CODE16.COPIES;

   5332  1 000115   100007 222100                    LDX2    7,,PR1
         1 000116   000777 362003                    ANX2    511,DU
         1 000117   200024 442100                    SXL2    FORM$REC+2,,AUTO

      812     5333    2             FORM$REC.PAGES = CODE16.PAGENO - CODE16.STEPPAGENO;

   5333  1 000120   100024 236100                    LDQ     20,,PR1
         1 000121   000022 772000                    QRL     18
         1 000122   200042 756100                    STQ     FORM$KEY+7,,AUTO
         1 000123   100005 236100                    LDQ     5,,PR1
         1 000124   000022 772000                    QRL     18
         1 000125   200042 136100                    SBLQ    FORM$KEY+7,,AUTO
         1 000126   000000 620006                    EAX0    0,QL
         1 000127   200024 740100                    STX0    FORM$REC+2,,AUTO

      813     5334    2             FORM$REC.RECS = CODE16.RECNO - CODE16.STEPRECNO;

   5334  1 000130   100004 236100                    LDQ     4,,PR1
         1 000131   100025 136100                    SBLQ    21,,PR1
         1 000132   200023 756100                    STQ     FORM$REC+1,,AUTO

      814     5335    2           END;

      815     5336    1        CALL WRITEIT;

   5336  1 000133   000222 701000 1                  TSX1    WRITEIT
         1 000134   000000 011000                    NOP     0
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:144  

      816     5337    1   RET: B$JIT.DCB$=ADDR(F$DCB);

   5337  1 000135   200003 236100       RET          LDQ     @F$DCB,,AUTO
         1 000136   000000 470400 xsym               LDP0    B$JIT$
         1 000137   000232 756100                    STQ     154,,PR0

      817     5338    1        CODE16.STEPRECNO=CODE16.RECNO;

   5338  1 000140   200003 471500                    LDP1    @F$DCB,,AUTO
         1 000141   100050 473500                    LDP3    40,,PR1
         1 000142   300004 235100                    LDA     4,,PR3
         1 000143   300025 755100                    STA     21,,PR3

      818     5339    1        CODE16.STEPPAGENO=CODE16.PAGENO;

   5339  1 000144   100050 473500                    LDP3    40,,PR1
         1 000145   300005 220100                    LDX0    5,,PR3
         1 000146   300024 740100                    STX0    20,,PR3

      819     5340    1        RETURN;

   5340  1 000147   000000 702200 xent               TSX2  ! X66_ARET

      820     5341        %EJECT;
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:145  
      821     5342    1   BACKOUT:PROC;

   5342  1 000150   200036 741300       BACKOUT      STX1  ! FORM$KEY+3,,AUTO

      822     5343    2        IF CODE16.STEPPAGENO=0 AND CODE16.STEPRECNO=0 THEN RETURN;

   5343  1 000151   200003 470500                    LDP0    @F$DCB,,AUTO
         1 000152   000050 471500                    LDP1    40,,PR0
         1 000153   100024 220100                    LDX0    20,,PR1
         1 000154   000160 601000 1                  TNZ     s:5344
         1 000155   100025 235100                    LDA     21,,PR1
         1 000156   000160 601000 1                  TNZ     s:5344

   5343  1 000157   000001 702211                    TSX2  ! 1,X1

      823     5344    2        IF CODE16.BANNER_CHARGES

   5344  1 000160   100007 236100                    LDQ     7,,PR1
         1 000161   002000 316003                    CANQ    1024,DU
         1 000162   000176 600000 1                  TZE     s:5349

      824     5345    3        THEN DO;

      825     5346    3             FORM$REC.PAGES = - CODE16.STEPPAGENO - CODE16.BANNER_REPEATS;

   5346  1 000163   100007 236100                    LDQ     7,,PR1
         1 000164   000011 772000                    QRL     9
         1 000165   000777 376007                    ANQ     511,DL
         1 000166   200042 756100                    STQ     FORM$KEY+7,,AUTO
         1 000167   100024 236100                    LDQ     20,,PR1
         1 000170   000022 772000                    QRL     18
         1 000171   200042 036100                    ADLQ    FORM$KEY+7,,AUTO
         1 000172   777777 620006                    EAX0    -1,QL
         1 000173   777777 660003                    ERX0    -1,DU
         1 000174   200024 740100                    STX0    FORM$REC+2,,AUTO

      826     5347    3           END;
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:146  

   5347  1 000175   000201 710000 1                  TRA     s:5351

      827     5348    3        ELSE DO;

      828     5349    3             FORM$REC.PAGES = - CODE16.STEPPAGENO;

   5349  1 000176   777777 620010                    EAX0    -1,X0
         1 000177   777777 660003                    ERX0    -1,DU
         1 000200   200024 740100                    STX0    FORM$REC+2,,AUTO

      829     5350    3           END;

      830     5351    2        FORM$REC.RECS=-CODE16.STEPRECNO;

   5351  1 000201   100025 235100                    LDA     21,,PR1
         1 000202   000027 675000 xsym               ERA     B_VECTNIL+23
         1 000203   000001 035007                    ADLA    1,DL
         1 000204   200023 755100                    STA     FORM$REC+1,,AUTO

      831     5352    2        FORM$REC.COPIES=CODE16.COPIES;

   5352  1 000205   100007 222100                    LDX2    7,,PR1
         1 000206   000777 362003                    ANX2    511,DU
         1 000207   200024 442100                    SXL2    FORM$REC+2,,AUTO

      832     5353    2        IF CODE16.NSFORM THEN

   5353  1 000210   100007 236100                    LDQ     7,,PR1
         1 000211   040000 316003                    CANQ    16384,DU
         1 000212   000215 600000 1                  TZE     s:5355

      833     5354    2             FORM$REC.MOUNTS=-1;

   5354  1 000213   000001 335007                    LCA     1,DL
         1 000214   200022 755100                    STA     FORM$REC,,AUTO

PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:147  
      834     5355    2        CODE16.STEPPAGENO=0;

   5355  1 000215   000000 223003                    LDX3    0,DU
         1 000216   100024 743100                    STX3    20,,PR1

      835     5356    2        CODE16.STEPRECNO=0;

   5356  1 000217   000050 471500                    LDP1    40,,PR0
         1 000220   100025 450100                    STZ     21,,PR1
         1 000221   000223 710000 1                  TRA     s:5359

      836     5357        /**/
      837     5358    2   WRITEIT: ENTRY;

   5358  1 000222   200036 741300       WRITEIT      STX1  ! FORM$KEY+3,,AUTO

      838     5359    2        IF FORM$REC.PAGES=0 AND FORM$REC.RECS=0 THEN RETURN;

   5359  1 000223   200024 220100                    LDX0    FORM$REC+2,,AUTO
         1 000224   000231 601000 1                  TNZ     s:5360
         1 000225   200023 235100                    LDA     FORM$REC+1,,AUTO
         1 000226   000231 601000 1                  TNZ     s:5360

   5359  1 000227   200036 221300                    LDX1  ! FORM$KEY+3,,AUTO
         1 000230   000001 702211                    TSX2  ! 1,X1

      839     5360    2        IF F$DCB.WSN~=B$JIT.WOO OR SUBSTR(F$DCB.RES,0,2)~='LP' OR

   5360  1 000231   200003 470500                    LDP0    @F$DCB,,AUTO
         1 000232   000000 471400 xsym               LDP1    B$JIT$
         1 000233   040100 106500                    CMPC    fill='040'O
         1 000234   000027 000010                    ADSC9   23,,PR0                  cn=0,n=8
         1 000235   100010 000010                    ADSC9   8,,PR1                   cn=0,n=8
         1 000236   000247 601000 1                  TNZ     s:5362
         1 000237   000026 221100                    LDX1    22,,PR0
         1 000240   000016 101000 0                  CMPX1   FORM_KEY+2
         1 000241   000247 601000 1                  TNZ     s:5362
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:148  
         1 000242   000050 473500                    LDP3    40,,PR0
         1 000243   040000 106500                    CMPC    fill='040'O
         1 000244   300000 000006                    ADSC9   0,,PR3                   cn=0,n=6
         1 000245   000017 000005 0                  ADSC9   FORM_KEY+3               cn=0,n=5
         1 000246   000346 600000 1                  TZE     s:5381

      840     5361    3             CODE16.FORM~='STDLP' THEN DO;

      841     5362    3             CALL OPENSTAR ALTRET(RETN);

   5362  1 000247   000360 701000 1                  TSX1    OPENSTAR
         1 000250   000344 702000 1                  TSX2    RETN

      842     5363    3             FORM$KEY=FORM_KEY;

   5363  1 000251   000100 100400                    MLR     fill='000'O
         1 000252   000014 000006 0                  ADSC9   FORM_KEY                 cn=0,n=6
         1 000253   200033 000006                    ADSC9   FORM$KEY,,AUTO           cn=0,n=6

      843     5364    3             FORM$KEY.STEP=B$JIT.STEPS;

   5364  1 000254   000000 470400 xsym               LDP0    B$JIT$
         1 000255   000315 720100                    LXL0    205,,PR0
         1 000256   200033 440100                    SXL0    FORM$KEY,,AUTO

      844     5365    3             FORM$KEY.UNIQUE=B$JIT.ARECX;

   5365  1 000257   000333 721100                    LXL1    219,,PR0
         1 000260   177777 361003                    ANX1    65535,DU
         1 000261   200034 741100                    STX1    FORM$KEY+1,,AUTO

      845     5366    3             B$JIT.ARECX=B$JIT.ARECX+1;

   5366  1 000262   000333 236100                    LDQ     219,,PR0
         1 000263   177777 376007                    ANQ     65535,DL
         1 000264   000001 036007                    ADLQ    1,DL
         1 000265   000333 676100                    ERQ     219,,PR0
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:149  
         1 000266   177777 376007                    ANQ     65535,DL
         1 000267   000333 656100                    ERSQ    219,,PR0

      846     5367    3             FORM$REC.DDEV=CODE16.DDEV;

   5367  1 000270   200003 471500                    LDP1    @F$DCB,,AUTO
         1 000271   100050 473500                    LDP3    40,,PR1
         1 000272   000100 100500                    MLR     fill='000'O
         1 000273   300003 000001                    ADSC9   3,,PR3                   cn=0,n=1
         1 000274   200042 000004                    ADSC9   FORM$KEY+7,,AUTO         cn=0,n=4
         1 000275   200042 222100                    LDX2    FORM$KEY+7,,AUTO
         1 000276   200025 742100                    STX2    FORM$REC+3,,AUTO

      847     5368    3             FORM$REC.S1.FORMNAME=CODE16.FORM;

   5368  1 000277   040100 100500                    MLR     fill='040'O
         1 000300   300000 000006                    ADSC9   0,,PR3                   cn=0,n=6
         1 000301   200025 400014                    ADSC9   FORM$REC+3,,AUTO         cn=2,n=12

      848     5369    3             FORM$REC.S1.DD=F$DCB.RES;

   5369  1 000302   100026 223100                    LDX3    22,,PR1
         1 000303   200030 443100                    SXL3    FORM$REC+6,,AUTO

      849     5370    3             FORM$REC.S1.WSN=F$DCB.WSN;

   5370  1 000304   040100 100500                    MLR     fill='040'O
         1 000305   100027 000010                    ADSC9   23,,PR1                  cn=0,n=8
         1 000306   200031 000010                    ADSC9   FORM$REC+7,,AUTO         cn=0,n=8

      850     5371    3             AUTOWRITE=CONSTWRITE;

   5371  1 000307   000100 100400                    MLR     fill='000'O
         1 000310   000000 000060 0                  ADSC9   CONSTWRITE               cn=0,n=48
         1 000311   200006 000060                    ADSC9   AUTOWRITE,,AUTO          cn=0,n=48

      851     5372    3             AUTOWRITE.BUF_=VECTOR(FORM$REC);
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:150  

   5372  1 000312   000000 235000 2                  LDA     0
         1 000313   200042 452500                    STP2    FORM$KEY+7,,AUTO
         1 000314   200042 236100                    LDQ     FORM$KEY+7,,AUTO
         1 000315   000022 036003                    ADLQ    18,DU
         1 000316   200012 757100                    STAQ    AUTOWRITE+4,,AUTO

      852     5373    3             AUTOWRITE.KEY_=VECTOR(FORM$KEY);

   5373  1 000317   000001 235000 2                  LDA     1
         1 000320   200042 452500                    STP2    FORM$KEY+7,,AUTO
         1 000321   200042 236100                    LDQ     FORM$KEY+7,,AUTO
         1 000322   000033 036003                    ADLQ    27,DU
         1 000323   200010 757100                    STAQ    AUTOWRITE+2,,AUTO

      853     5374    3             AUTOWRITE.V_=VECTOR(AUTOWRITE.V);

   5374  1 000324   000002 235000 2                  LDA     2
         1 000325   200042 452500                    STP2    FORM$KEY+7,,AUTO
         1 000326   200042 236100                    LDQ     FORM$KEY+7,,AUTO
         1 000327   000016 036003                    ADLQ    14,DU
         1 000330   200006 757100                    STAQ    AUTOWRITE,,AUTO

      854     5375    3             AUTOWRITE.V.DCB#=%M$STAR#;

   5375  1 000331   000001 224003                    LDX4    1,DU
         1 000332   200016 744100                    STX4    AUTOWRITE+8,,AUTO

      855     5376    3             CALL M$MWRITE(AUTOWRITE)ALTRET(ALTR);

   5376  1 000333   200006 634500                    EPPR4   AUTOWRITE,,AUTO
         1 000334   200042 454500                    STP4    FORM$KEY+7,,AUTO
         1 000335   200042 630500                    EPPR0   FORM$KEY+7,,AUTO
         1 000336   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000337   000000 701000 xent               TSX1    M$MWRITE
         1 000340   000341 702000 1                  TSX2    ALTR

PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:151  
      856     5377    3   ALTR:     CALL FMP$CLSJ;

   5377  1 000341   000002 631400 xsym  ALTR         EPPR1   B_VECTNIL+2
         1 000342   000000 701000 xent               TSX1    FMP$CLSJ
         1 000343   000000 011000                    NOP     0

   5375  1 000344                       RETN         null
      857     5378    3   RETN:     ;
      858     5379    3             RETURN;

   5379  1 000344   200036 221300                    LDX1  ! FORM$KEY+3,,AUTO
         1 000345   000001 702211                    TSX2  ! 1,X1

      859     5380    3           END;
      860     5381    2        B$JIT.STDLOPGS=B$JIT.STDLOPGS

   5381  1 000346   200024 236100                    LDQ     FORM$REC+2,,AUTO
         1 000347   777777 376007                    ANQ     -1,DL
         1 000350   200042 756100                    STQ     FORM$KEY+7,,AUTO
         1 000351   200024 236100                    LDQ     FORM$REC+2,,AUTO
         1 000352   000022 732000                    QRS     18
         1 000353   200042 402100                    MPY     FORM$KEY+7,,AUTO
         1 000354   100326 036100                    ADLQ    214,,PR1
         1 000355   100326 756100                    STQ     214,,PR1

      861     5382    2             +FORM$REC.PAGES*FORM$REC.COPIES;
      862     5383    2        RETURN;

   5383  1 000356   200036 221300                    LDX1  ! FORM$KEY+3,,AUTO
         1 000357   000001 702211                    TSX2  ! 1,X1

      863     5384    2   OPENSTAR: PROC ALTRET;

   5384  1 000360   200040 741300       OPENSTAR     STX1  ! FORM$KEY+5,,AUTO

      864     5385        %F$DCBI(BASED="BASED(B$M$STAR$)");
      865     5435    3        B$JIT.DCB$=B$M$STAR$;
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:152  

   5435  1 000361   000000 236000 xsym               LDQ     B$M$STAR$
         1 000362   000000 470400 xsym               LDP0    B$JIT$
         1 000363   000232 756100                    STQ     154,,PR0

      866     5436    3        IF F$DCB.FCD THEN

   5436  1 000364   000000 471400 xsym               LDP1    B$M$STAR$
         1 000365   100031 236100                    LDQ     25,,PR1
         1 000366   020000 316007                    CANQ    8192,DL
         1 000367   000373 600000 1                  TZE     s:5438

      867     5437    3             CALL FMP$CLSJ;

   5437  1 000370   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000371   000000 701000 xent               TSX1    FMP$CLSJ
         1 000372   000000 011000                    NOP     0

      868     5438    3        CALL FMM$SCRUB(B$M$STAR$);

   5438  1 000373   000003 630400 2                  EPPR0   3
         1 000374   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000375   000000 701000 xent               TSX1    FMM$SCRUB
         1 000376   000000 011000                    NOP     0

      869     5439    3        F$DCB.ASN=%FILE#;

   5439  1 000377   000000 470400 xsym               LDP0    B$M$STAR$
         1 000400   001000 236007                    LDQ     512,DL
         1 000401   000032 552110                    STBQ    26,'10'O,PR0

      870     5440    3        F$DCB.ORG=%KEYED#;

   5440  1 000402   002000 236003                    LDQ     1024,DU
         1 000403   000032 552140                    STBQ    26,'40'O,PR0

      871     5441    3        F$DCB.FUN=%CREATE#;
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:153  

   5441  1 000404   000003 236003                    LDQ     3,DU
         1 000405   000032 552120                    STBQ    26,'20'O,PR0

      872     5442    3        F$DCB.EXIST=%OLDFILE#;

   5442  1 000406   000031 236100                    LDQ     25,,PR0
         1 000407   000004 376000 2                  ANQ     4
         1 000410   002000 276007                    ORQ     1024,DL
         1 000411   000031 756100                    STQ     25,,PR0

      873     5443    3        F$DCB.SHARE=%ALL#;

   5443  1 000412   000031 236100                    LDQ     25,,PR0
         1 000413   000005 376000 2                  ANQ     5
         1 000414   000200 276007                    ORQ     128,DL
         1 000415   000031 756100                    STQ     25,,PR0

      874     5444    3        F$DCB.ACS=%DIRECT#;

   5444  1 000416   000002 236007                    LDQ     2,DL
         1 000417   000036 552104                    STBQ    30,'04'O,PR0

      875     5445    3        F$DCB.NAME.L=2;

   5445  1 000420   002000 236003                    LDQ     1024,DU
         1 000421   000010 552140                    STBQ    8,'40'O,PR0

      876     5446    3        F$DCB.NAME.C='*S';

   5446  1 000422   040100 100400                    MLR     fill='040'O
         1 000423   000021 000002 0                  ADSC9   FORM_KEY+5               cn=0,n=2
         1 000424   000010 200037                    ADSC9   8,,PR0                   cn=1,n=31

      877     5447    3        B$JIT.ERR='0'B;

   5447  1 000425   000000 471400 xsym               LDP1    B$JIT$
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:154  
         1 000426   100012 450100                    STZ     10,,PR1

      878     5448    3        CALL FMM$DFLOPNP;

   5448  1 000427   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000430   000000 701000 xent               TSX1    FMM$DFLOPNP
         1 000431   000000 011000                    NOP     0

      879     5449    3        IF B$JIT.ERR.CODE=0 THEN RETURN;

   5449  1 000432   000000 470400 xsym               LDP0    B$JIT$
         1 000433   000012 236100                    LDQ     10,,PR0
         1 000434   377770 316007                    CANQ    131064,DL
         1 000435   000440 601000 1                  TNZ     s:5450

   5449  1 000436   200040 221300                    LDX1  ! FORM$KEY+5,,AUTO
         1 000437   000001 702211                    TSX2  ! 1,X1

      880     5450    3        ALTRETURN;

   5450  1 000440   200040 221300                    LDX1  ! FORM$KEY+5,,AUTO
         1 000441   000000 702211                    TSX2  ! 0,X1

CONSTWRITE
 Sect OctLoc
   0     000   000003 777640   000010 006000   000000 177640   000000 006014    ................
   0     004   000000 177640   000000 006014   000000 177640   000000 006014    ................
   0     010   000000 400400   000000 000000   000000 000000   000000 000000    ................

FORM_KEY
 Sect OctLoc
   0     014   005146 000000   000000 ******                                    .f......

(unnamed)
 Sect OctLoc
   0     016   114120 040040   123124 104114   120040 040040   052123 040040    LP  STDLP   *S

PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:155  
(unnamed)
 Sect OctLoc
   2     000   000010 777640   000001 377640   000003 777640   000000 006000    ................
   2     004   777777 774777   777777 777177                                    ........
      881     5451    3   END OPENSTAR;
      882     5452    2   END BACKOUT;
      883     5453        /**/
      884     5454    1   END FSL$ACCT;
      885     5455        %EOD;

PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:156  
--  Include file information  --

   G_JIT_M.:E05TOU  is referenced.
   AZ_MACRO_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   FM$FIT.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   F_CP6.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
      No diagnostics issued in procedure FSL$ACCT.
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:157  

 **** Variables and constants ****

  ****  Section 000 RoData FSL$ACCT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(432)   r     1 CONSTWRITE                14-0-0/c STRC(54)    r     1 FORM_KEY

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     5-0-0/w PTR         r     1 @COPIES                    4-0-0/w PTR         r     1 @DELBIT
     3-0-0/w PTR         r     1 @F$DCB                     6-0-0/d STRC(432)   r     1 AUTOWRITE
    *0-0-0/b UBIN(9)     r     1 COPIES                    *0-0-0/b BIT         r     1 DELBIT
    *0-0-0/d ASTR(3528)  r     1 F$DCB                     33-0-0/c STRC(54)    r     1 FORM$KEY
    22-0-0/w STRC(324)   r     1 FORM$REC

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$M$STAR$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC(1404)  r     1 CODE16
     0-0-0/d ASTR(3528)  r     1 F$DCB

PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:158  

   Procedure FSL$ACCT requires 290 words for executable code.
   Procedure FSL$ACCT requires 36 words of local(AUTO) storage.
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:159  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:160  
          MINI XREF LISTING

ALTR IN PROCEDURE BACKOUT
      5377**LABEL    5376--CALLALT
AUTOWRITE
      1741**DCL      5371<<ASSIGN   5376<>CALL
AUTOWRITE.BUF_
      1741**DCL      5372<<ASSIGN
AUTOWRITE.KEY_
      1741**DCL      5373<<ASSIGN
AUTOWRITE.STATION_
      1743**DCL      1743--REDEF
AUTOWRITE.V
      1744**DCL      5374--ASSIGN
AUTOWRITE.V.DCB#
      1744**DCL      5375<<ASSIGN
AUTOWRITE.V.DVBYTE.VFC#
      1750**DCL      1750--REDEF
AUTOWRITE.V_
      1741**DCL      5374<<ASSIGN
B$JIT.ARECX
      2581**DCL      5365>>ASSIGN   5366<<ASSIGN   5366>>ASSIGN
B$JIT.CPFLAGS1.SLEAZE
      2407**DCL      2407--REDEF
B$JIT.DCB$
      2481**DCL      5337<<ASSIGN   5435<<ASSIGN
B$JIT.ERR
      2313**DCL      5447<<ASSIGN
B$JIT.ERR.CODE
      2314**DCL      5449>>IF
B$JIT.ERR.MID
      2314**DCL      2314--REDEF
B$JIT.JRESPEAK
      2475**DCL      2476--REDEF
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:161  
B$JIT.ORIGINATOR_PORT.FROM_CR
      2584**DCL      2584--REDEF    2585--REDEF
B$JIT.PNR
      2488**DCL      2488--REDEF
B$JIT.STDLOPGS
      2581**DCL      5381<<ASSIGN   5381>>ASSIGN
B$JIT.STEPS
      2534**DCL      5364>>ASSIGN
B$JIT.TSLINE
      2582**DCL      2583--REDEF
B$JIT.WOO
      2313**DCL      5360>>IF
B$JIT$
      1985**DCL      2308--IMP-PTR  5337>>ASSIGN   5360>>IF       5364>>ASSIGN   5365>>ASSIGN   5366>>ASSIGN
      5366>>ASSIGN   5381>>ASSIGN   5381>>ASSIGN   5435>>ASSIGN   5447>>ASSIGN   5449>>IF
B$M$STAR$
      1755**DCL      5386--IMP-PTR  5435>>ASSIGN   5436>>IF       5438<>CALL     5439>>ASSIGN   5440>>ASSIGN
      5441>>ASSIGN   5442>>ASSIGN   5443>>ASSIGN   5444>>ASSIGN   5445>>ASSIGN   5446>>ASSIGN
BACKOUT
      5342**PROC     5304--CALL     5309--CALL
CODE16.BANNER_CHARGES
      1980**DCL      5321>>IF       5344>>IF
CODE16.BANNER_REPEATS
      1980**DCL      5323>>ASSIGN   5346>>ASSIGN
CODE16.COPIES
      1980**DCL      5308>>IF       5310<<ASSIGN   5328>>ASSIGN   5332>>ASSIGN   5352>>ASSIGN
CODE16.DDEV
      1978**DCL      5367>>ASSIGN
CODE16.FORM
      1978**DCL      5360>>IF       5368>>ASSIGN
CODE16.NSFORM
      1979**DCL      5317>>IF       5353>>IF
CODE16.PAGENO
      1978**DCL      5313>>IF       5323>>ASSIGN   5326>>ASSIGN   5333>>ASSIGN   5339>>ASSIGN
CODE16.RECNO
      1978**DCL      5313>>IF       5329>>ASSIGN   5334>>ASSIGN   5338>>ASSIGN
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:162  
CODE16.STEPPAGENO
      1982**DCL      5315>>IF       5333>>ASSIGN   5339<<ASSIGN   5343>>IF       5346>>ASSIGN   5349>>ASSIGN
      5355<<ASSIGN
CODE16.STEPRECNO
      1982**DCL      5315>>IF       5334>>ASSIGN   5338<<ASSIGN   5343>>IF       5351>>ASSIGN   5356<<ASSIGN
CONSTWRITE
      1710**DCL      5371>>ASSIGN
CONSTWRITE.STATION_
      1712**DCL      1712--REDEF
CONSTWRITE.V
      1713**DCL      1710--DCLINIT
CONSTWRITE.V.DVBYTE.VFC#
      1719**DCL      1719--REDEF
COPIES
       122**DCL        19--PROC     5307--IF       5308>>IF       5310>>ASSIGN
DELBIT
       121**DCL        19--PROC     5302--IF       5303>>IF
F$DCB
        72**DCL        19--PROC     5337--ASSIGN
F$DCB.ACTPOS
        97**DCL        97--REDEF
F$DCB.ARS
        72**DCL        72--REDEF
F$DCB.ATTR
        90**DCL        91--REDEF
F$DCB.BORROW
       105**DCL       105--REDEF     105--REDEF     105--REDEF
F$DCB.DCBNAME.L
       119**DCL       119--IMP-SIZ
F$DCB.EOMCHAR
        76**DCL        76--REDEF
F$DCB.FLDID
       100**DCL       100--REDEF
F$DCB.FORM$
        94**DCL        94--REDEF    1978--IMP-PTR  5308>>IF       5310>>ASSIGN   5313>>IF       5313>>IF
      5315>>IF       5315>>IF       5317>>IF       5321>>IF       5323>>ASSIGN   5323>>ASSIGN   5326>>ASSIGN
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:163  
      5328>>ASSIGN   5329>>ASSIGN   5332>>ASSIGN   5333>>ASSIGN   5333>>ASSIGN   5334>>ASSIGN   5334>>ASSIGN
      5338>>ASSIGN   5338>>ASSIGN   5339>>ASSIGN   5339>>ASSIGN   5343>>IF       5343>>IF       5344>>IF
      5346>>ASSIGN   5346>>ASSIGN   5349>>ASSIGN   5351>>ASSIGN   5352>>ASSIGN   5353>>IF       5355>>ASSIGN
      5356>>ASSIGN   5360>>IF       5367>>ASSIGN   5368>>ASSIGN
F$DCB.FSECT
       110**DCL       110--REDEF
F$DCB.FSN
        87**DCL        87--REDEF      87--REDEF      88--REDEF
F$DCB.HEADER$
        93**DCL        93--REDEF
F$DCB.IXTNSIZE
        91**DCL        91--REDEF
F$DCB.LASTSTA$
        81**DCL        81--REDEF
F$DCB.LVL
       106**DCL       106--REDEF
F$DCB.NAME.C
        81**DCL        81--REDEF
F$DCB.NOEOF
       102**DCL       102--REDEF
F$DCB.NRECS
        92**DCL        92--REDEF
F$DCB.NRECX
       111**DCL       111--REDEF
F$DCB.OHDR
       103**DCL       103--REDEF
F$DCB.ORG
        86**DCL        86--REDEF
F$DCB.PRECNO
       109**DCL       109--REDEF
F$DCB.RCSZ
       114**DCL       114--REDEF
F$DCB.RES
        82**DCL        82--REDEF    5360>>IF       5369>>ASSIGN
F$DCB.SETX
        94**DCL        94--REDEF
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:164  
F$DCB.TAB$
        93**DCL        94--REDEF
F$DCB.TDA
       108**DCL       108--REDEF
F$DCB.WSN
        83**DCL        83--REDEF    5360>>IF       5370>>ASSIGN
F$DCB.ACS IN PROCEDURE OPENSTAR
      5403**DCL      5444<<ASSIGN
F$DCB.ACTPOS IN PROCEDURE OPENSTAR
      5411**DCL      5411--REDEF
F$DCB.ARS IN PROCEDURE OPENSTAR
      5386**DCL      5386--REDEF
F$DCB.ASN IN PROCEDURE OPENSTAR
      5401**DCL      5439<<ASSIGN
F$DCB.ATTR IN PROCEDURE OPENSTAR
      5404**DCL      5405--REDEF
F$DCB.BORROW IN PROCEDURE OPENSTAR
      5419**DCL      5419--REDEF    5419--REDEF    5419--REDEF
F$DCB.DCBNAME.L IN PROCEDURE OPENSTAR
      5433**DCL      5433--IMP-SIZ
F$DCB.EOMCHAR IN PROCEDURE OPENSTAR
      5390**DCL      5390--REDEF
F$DCB.EXIST IN PROCEDURE OPENSTAR
      5399**DCL      5442<<ASSIGN
F$DCB.FCD IN PROCEDURE OPENSTAR
      5399**DCL      5436>>IF
F$DCB.FLDID IN PROCEDURE OPENSTAR
      5414**DCL      5414--REDEF
F$DCB.FORM$ IN PROCEDURE OPENSTAR
      5408**DCL      5408--REDEF
F$DCB.FSECT IN PROCEDURE OPENSTAR
      5424**DCL      5424--REDEF
F$DCB.FSN IN PROCEDURE OPENSTAR
      5401**DCL      5401--REDEF    5401--REDEF    5402--REDEF
F$DCB.FUN IN PROCEDURE OPENSTAR
      5400**DCL      5441<<ASSIGN
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:165  
F$DCB.HEADER$ IN PROCEDURE OPENSTAR
      5407**DCL      5407--REDEF
F$DCB.IXTNSIZE IN PROCEDURE OPENSTAR
      5405**DCL      5405--REDEF
F$DCB.LASTSTA$ IN PROCEDURE OPENSTAR
      5395**DCL      5395--REDEF
F$DCB.LVL IN PROCEDURE OPENSTAR
      5420**DCL      5420--REDEF
F$DCB.NAME.C IN PROCEDURE OPENSTAR
      5395**DCL      5395--REDEF    5446<<ASSIGN
F$DCB.NAME.L IN PROCEDURE OPENSTAR
      5395**DCL      5445<<ASSIGN
F$DCB.NOEOF IN PROCEDURE OPENSTAR
      5416**DCL      5416--REDEF
F$DCB.NRECS IN PROCEDURE OPENSTAR
      5406**DCL      5406--REDEF
F$DCB.NRECX IN PROCEDURE OPENSTAR
      5425**DCL      5425--REDEF
F$DCB.OHDR IN PROCEDURE OPENSTAR
      5417**DCL      5417--REDEF
F$DCB.ORG IN PROCEDURE OPENSTAR
      5400**DCL      5400--REDEF    5440<<ASSIGN
F$DCB.PRECNO IN PROCEDURE OPENSTAR
      5423**DCL      5423--REDEF
F$DCB.RCSZ IN PROCEDURE OPENSTAR
      5428**DCL      5428--REDEF
F$DCB.RES IN PROCEDURE OPENSTAR
      5396**DCL      5396--REDEF
F$DCB.SETX IN PROCEDURE OPENSTAR
      5408**DCL      5408--REDEF
F$DCB.SHARE IN PROCEDURE OPENSTAR
      5399**DCL      5443<<ASSIGN
F$DCB.TAB$ IN PROCEDURE OPENSTAR
      5407**DCL      5408--REDEF
F$DCB.TDA IN PROCEDURE OPENSTAR
      5422**DCL      5422--REDEF
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:166  
F$DCB.WSN IN PROCEDURE OPENSTAR
      5397**DCL      5397--REDEF
FMM$DFLOPNP
       124**DCL-ENT  5448--CALL
FMM$SCRUB
       125**DCL-ENT  5438--CALL
FMP$CLSJ
       126**DCL-ENT  5377--CALL     5437--CALL
FORM$KEY
      5279**DCL      5363<<ASSIGN   5373--ASSIGN
FORM$KEY.AREC_TYPE
      5281**DCL      5282--REDEF
FORM$KEY.STEP
      5287**DCL      5364<<ASSIGN
FORM$KEY.UNIQUE
      5292**DCL      5365<<ASSIGN
FORM$REC
      5182**DCL      5301<<ASSIGN   5372--ASSIGN
FORM$REC.COPIES
      5197**DCL      5328<<ASSIGN   5332<<ASSIGN   5352<<ASSIGN   5381>>ASSIGN
FORM$REC.DDEV
      5202**DCL      5367<<ASSIGN
FORM$REC.MOUNTS
      5183**DCL      5311<<ASSIGN   5319<<ASSIGN   5354<<ASSIGN
FORM$REC.PAGES
      5193**DCL      5323<<ASSIGN   5326<<ASSIGN   5333<<ASSIGN   5346<<ASSIGN   5349<<ASSIGN   5359>>IF
      5381>>ASSIGN
FORM$REC.RECS
      5189**DCL      5329<<ASSIGN   5334<<ASSIGN   5351<<ASSIGN   5359>>IF
FORM$REC.S1.DD
      5220**DCL      5369<<ASSIGN
FORM$REC.S1.FORMNAME
      5214**DCL      5368<<ASSIGN
FORM$REC.S1.WSN
      5224**DCL      5370<<ASSIGN
FORM_KEY
PL6.E3A0      #002=FSL$ACCT File=FSL$LDEV.:E05TSI                                TUE 07/29/97 17:34 Page:167  
      5244**DCL      5363>>ASSIGN
FORM_KEY.AREC_TYPE
      5246**DCL      5247--REDEF
M$MWRITE
       127**DCL-ENT  5376--CALL
OPENSTAR IN PROCEDURE BACKOUT
      5384**PROC     5362--CALL
RET
      5337**LABEL    5305--GOTO     5314--GOTO
RETN IN PROCEDURE BACKOUT
      5375**LABEL    5362--CALLALT
WRITEIT IN PROCEDURE BACKOUT
      5358**ENTRY    5336--CALL

PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:168  
      886        1        /*T***********************************************************/
      887        2        /*T*                                                         */
      888        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      889        4        /*T*                                                         */
      890        5        /*T***********************************************************/
      891        6        /*F*      NAME: FSL$UC
      892        7                  PURPOSE: FSL$UC creates a new LDEV stream for a UC
      893        8                            stream.
      894        9                  DESCRIPTION:  When a stream begins with 'UC' it is a
      895       10                                Logical Commiuication devices.  Instead of
      896       11                                the description being in the FIT of the file
      897       12                                it will exists as records in the *A file.
      898       13                   */
      899       14
      900       15        FSL$UC: PROC (INDX);
      901       16
      902       17        /* Include files */
      903       18        %INCLUDE FS$FIT;
      904       61        %INCLUDE CP_6;
      905     5620        %INCLUDE F$JIT_C;
      906     6050        %MACRO B$ROSEG(BASED=BASED);
      907     6051        %INCLUDE B$ROSEG;
      908     6114        %MEND;
      909     6115        %B$ROSEG(BASED="BASED(B$ROSEG$)");
      910     6175        %INCLUDE F$DCB;
      911     6224        %INCLUDE F$CP6V_C;
      912     6450        %INCLUDE CP_6_SUBS;
      913     6990        %INCLUDE F_FMTCODE_C;
      914     7024        %INCLUDE KI_SUBS_C;
      915     7160    1   DCL KIA$DCLSTR ENTRY(2) ALTRET;
      916     7161    1   DCL FSN$CONV_STR ENTRY(2) ALTRET;
      917     7162    1   DCL KIA$REDSTR ENTRY(2) ALTRET;
      918     7163    1   DCL KIA$CLSSTR ENTRY(3) ALTRET;
      919     7164    1   DCL KIA$WINDOW ENTRY(2) ALTRET;
      920     7165
      921     7166        /* Parameters */
      922     7167    1   DCL INDX UBIN;                          /* Index of stream in roseg */
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:169  
      923     7168
      924     7169        /* Structures */
      925     7170        %VLP_TAB (FPTN=VLP$TAB,STCLASS=BASED);
      926     7184        %VLP_HDR (FPTN=VLP$HDRF,STCLASS=BASED,LEN=160);
      927     7200    1   DCL 1 VLP$HDRU BASED CALIGNED, 2 * CHAR(J);
      928     7201        %FS$LDEVDDF (NAME=FS$DDF,STCLASS=BASED);
      929     7205        %FS$LDEVDDF (NAME=FS$DDFSZ,STCLASS=BASED,SIZ=FIT);
      930     7209        %FPT$LDEV_V (BASED="BASED(B$PS0$)");
      931     7215        /* Default window for FS */
      932     7216        %VLP_WINDOW (FPTN=FS_WINDOW,FWINDOW='UC01',STCLASS="CONSTANT SYMDEF");
      933     7260        %VLP_WINDOW(FPTN=VLP$WINDOW,STCLASS="BASED(B$PS5$)");
      934     7304        %VLP_WINDOW (FPTN=WINDOW,STCLASS=AUTO);
      935     7348
      936     7349        /* Auto */
      937     7350    1   DCL BUFFER CHAR(4096) BASED(BUF$);
      938     7351    1   DCL BUF$ PTR;
      939     7352    1   DCL 1 LDEV_KEY,
      940     7353    1            2 SZ UBIN BYTE UNAL,
      941     7354    1            2 BLK CHAR(1) UNAL,
      942     7355    1            2 NAME CHAR(4) UNAL;
      943     7356    1   DCL J SBIN;
      944     7357    1   DCL DCB$ PTR;
      945     7358    1   DCL ONLINE BIT(1);
      946     7359    1   DCL FRMSTRM UBIN;
      947     7360    1   DCL 1 FRMSTRM_BYTE REDEF FRMSTRM,
      948     7361    1            2 * BIT(27),
      949     7362    1            2 STR UBIN BYTE UNAL;
      950     7363    1   DCL FRMSTRM_TEXT CHAR(4);
      951     7364
      952     7365        /* References */
      953     7366    1   DCL B$JIT$ PTR SYMREF;
      954     7367    1   DCL B$M$STAR$ PTR SYMREF READONLY;
      955     7368    1   DCL B$M$UC$ PTR SYMREF READONLY;
      956     7369    1   DCL B$PS0$ PTR SYMREF;                  /* V area of FPT_LDEV */
      957     7370    1   DCL B$PS1$ PTR SYMREF;                  /* TAB area of FPT_LDEV */
      958     7371    1   DCL B$PS2$ PTR SYMREF;                  /* HDR area of FPT_LDEV */
      959     7372    1   DCL B$PS5$ PTR SYMREF;                  /*->WINDOW area of LDEV FPT*/
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:170  
      960     7373    1   DCL B$ROSEG$ PTR SYMREF;
      961     7374
      962     7375        /* Entry references */
      963     7376    1   DCL FSB$GETDDF ENTRY(1) ALTRET;
      964     7377    1   DCL FMD$GBUF ENTRY (1);
      965     7378    1   DCL FMD$RBUF ENTRY (1);
      966     7379    1   DCL HFF$NIL ENTRY(1) ALTRET;
      967     7380    1   DCL HFF$ERASE ENTRY(1) ALTRET;
      968     7381    1   DCL HFF$DSIZ ENTRY(2);
      969     7382    1   DCL HFF$TRAPALT ENTRY ALTRET;
      970     7383    1   DCL HFF$NILERASE ENTRY(1) ALTRET;
      971     7384    1   DCL FMM$DFLOPNP ENTRY;
      972     7385    1   DCL FMP$CLSJ ENTRY;
      973     7386    1   DCL M$MREAD ENTRY(1) ALTRET;
      974     7387    1   DCL M$MWRITE ENTRY(1) ALTRET;
      975     7388    1   DCL FSA$FDCB ENTRY(1);
      976     7389
      977     7390        /* FPT's */
      978     7391        %FPT_READ (FPTN=FPT_READ_CONS,STCLASS=CONSTANT,KEYS=YES);
      979     7430        %FPT_READ (STCLASS=AUTO);
      980     7469        %FPT_WRITE (FPTN=FPT_WRITE_CONS,STCLASS=CONSTANT);
      981     7500        %FPT_WRITE (STCLASS=AUTO);
      982     7531
      983     7532        %EJECT;
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:171  
      984     7533
      985     7534    1        CALL FMD$GBUF (BUF$);
      986     7535    1        BUF$->FS$DDFSZ = '0'B;
      987     7536    1        IF B$M$UC$->F$DCB.MEDIA = FMTUC#
      988     7537    1        THEN
      989     7538    1             ONLINE = '1'B;
      990     7539    1        ELSE
      991     7540    1             ONLINE = '0'B;
      992     7541
      993     7542    1        IF B$ROSEG$->B$ROSEG.STREAMID.FLG(INDX) = 2 /* Stream open */
      994     7543    2        THEN DO;
      995     7544    2             J = B$ROSEG$->B$ROSEG.NUMDCBS;
      996     7545    3             DO WHILE (J>=%M$MAXNEG#);
      997     7546    3                  IF B$ROSEG.DCBPTR$->B$RODCB$(J)~=ADDR(NIL)
      998     7547    3                       AND B$ROSEG.DCBPTR$->B$RODCB$(J)~=B$M$UC$ THEN
      999     7548    3                       IF B$ROSEG.DCBPTR$->B$RODCB$(J)->F$DCB.IASN=%STREAM#
     1000     7549    3                            AND B$ROSEG.DCBPTR$->B$RODCB$(J)->F$DCB.CFU$=B$M$UC$
     1001     7550    3                            AND B$ROSEG.DCBPTR$->B$RODCB$(J)->F$DCB.STR=INDX THEN
     1002     7551    3                            B$ROSEG.DCBPTR$->B$RODCB$(J)->F$DCB.FCD=%NO#;
     1003     7552    3                  J=J-1;
     1004     7553    3                END;
     1005     7554
     1006     7555    2             IF ONLINE
     1007     7556    2             THEN
     1008     7557    2                  CALL KIA$CLSSTR (INDX,'0'B,'0'B);
     1009     7558    2             B$ROSEG$->B$ROSEG.STREAMID.FLG(INDX) = 1;
     1010     7559    2           END;
     1011     7560
     1012     7561    1        CALL OPEN_STAR ALTRET(CLEAN_UP);
     1013     7562    1        CALL HFF$TRAPALT ALTRET(TRAPALT);
     1014     7563
     1015     7564    1        IF B$ROSEG$->B$ROSEG.STREAMID.FLG(INDX) ~= 0
     1016     7565    1        THEN
     1017     7566    1             CALL READ_CLDEV(BUF$)
     1018     7567    2             WHENALTRETURN DO;
     1019     7568    2                  B$JIT.ERR = '0'B;
     1020     7569    2                END;
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:172  
     1021     7570
     1022     7571    1        IF (FPT$LDEV_V.REMOVE OR FPT$LDEV_V.LOGON) AND
     1023     7572    1             INDX > KIDM_DB
     1024     7573    2        THEN DO;
     1025     7574    2             IF ONLINE AND B$ROSEG$->B$ROSEG.STREAMID.FLG(INDX) ~= 0
     1026     7575    2             THEN
     1027     7576    2                  CALL KIA$CLSSTR(INDX,FPT$LDEV_V.REMOVE,FPT$LDEV_V.LOGON);
     1028     7577    2             B$ROSEG$->B$ROSEG.STREAMID(INDX) = '0'B;
     1029     7578    2             B$ROSEG$->B$ROSEG.LDEVNAME(INDX) = '    ';
     1030     7579    2   TRAPALT:  ;
     1031     7580    2             B$JIT.DCB$ = B$M$STAR$;
     1032     7581    2             CALL FMP$CLSJ;
     1033     7582    2             GOTO CLEAN_UP;
     1034     7583    2           END;
     1035     7584
     1036     7585    1        FRMSTRM = 0;
     1037     7586    1        IF FPT$LDEV_V.FRMSTRM ~= ' '
     1038     7587    2        THEN DO;
     1039     7588    2             CALL CONCAT (FRMSTRM_TEXT,'UC',FPT$LDEV_V.FRMSTRM);
     1040     7589    2             CALL FSN$CONV_STR(FRMSTRM_TEXT,FRMSTRM_BYTE.STR);
     1041     7590    2           END;
     1042     7591    1        IF FPT$LDEV_V.LINES~=0 THEN
     1043     7592    1             BUF$->FS$DDFSZ.LINES=FPT$LDEV_V.LINES;
     1044     7593    1        IF FPT$LDEV_V.DVFC~=BINASC(0) THEN
     1045     7594    1             BUF$->FS$DDFSZ.DVFC=FPT$LDEV_V.DVFC;
     1046     7595    1        IF FPT$LDEV_V.WIDTH~=0 THEN
     1047     7596    1             BUF$->FS$DDFSZ.WIDTH=FPT$LDEV_V.WIDTH;
     1048     7597    1        IF FPT$LDEV_V.ATTR THEN
     1049     7598    1             BUF$->FS$DDFSZ.ATTR=FPT$LDEV_V.ATTR;
     1050     7599    1        CALL HFF$NIL(B$PS1$)
     1051     7600    2        WHENRETURN DO;
     1052     7601    2             CALL HFF$ERASE(B$PS1$)
     1053     7602    3             WHENRETURN DO;
     1054     7603    3                  BUF$->FS$DDFSZ.F.TAB = '1'B;
     1055     7604    3                  PINCRW(BUF$,SIZEW(FS$DDFSZ))->VLP$TAB = B$PS1$->VLP$TAB;
     1056     7605    3                END;
     1057     7606    3             WHENALTRETURN DO;
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:173  
     1058     7607    3                  BUF$->FS$DDFSZ.F.TAB = '0'B;
     1059     7608    3                END;
     1060     7609    2           END;
     1061     7610    1        CALL HFF$NIL(B$PS2$)
     1062     7611    2        WHENRETURN DO;
     1063     7612    2             CALL HFF$ERASE(B$PS2$)
     1064     7613    3             WHENRETURN DO;
     1065     7614    3                  BUF$->FS$DDFSZ.F.HDR = '1'B;
     1066     7615    3                  CALL HFF$DSIZ(B$PS2$,J);
     1067     7616    3                  PINCRW(BUF$,SIZEW(FS$DDFSZ)+SIZEW(VLP$TAB))->VLP$HDRF
     1068     7617    3                       = B$PS2$->VLP$HDRU;
     1069     7618    3                END;
     1070     7619    3             WHENALTRETURN DO;
     1071     7620    3                  BUF$->FS$DDFSZ.F.HDR = '0'B;
     1072     7621    3                END;
     1073     7622    2           END;
     1074     7623    1        BUF$->FS$DDFSZ.SIZ = SIZEW(FS$DDF)+SIZEW(VLP$TAB)+SIZEW(VLP$HDRF);
     1075     7624
     1076     7625    1        FPT_WRITE = FPT_WRITE_CONS;
     1077     7626    1        FPT_WRITE.V_ = VECTOR(FPT_WRITE.V);
     1078     7627    1        FPT_WRITE.KEY_ = VECTOR(LDEV_KEY);
     1079     7628    1        FPT_WRITE.V.DCB# = %M$STAR#;
     1080     7629    1        FPT_WRITE.BUF_ = VECTOR(BUFFER);
     1081     7630    1        FPT_WRITE.BUF_.BOUND = BUF$->FS$DDFSZ.SIZ * 4 + 3;
     1082     7631    1        CALL M$MWRITE (FPT_WRITE)
     1083     7632    2        WHENALTRETURN DO;
     1084     7633    2           END;
     1085     7634    1        B$JIT.DCB$ = B$M$STAR$;
     1086     7635    1        CALL FMP$CLSJ;
     1087     7636
     1088     7637        /* Finish setting up ROSEG */
     1089     7638    1        B$ROSEG$->B$ROSEG.STREAMID.UC_STR(INDX) = '1'B;
     1090     7639    1        IF ONLINE
     1091     7640    2        THEN DO;
     1092     7641    2             IF B$ROSEG$->B$ROSEG.STREAMID.FLG(INDX) = 0
     1093     7642    3             THEN DO;
     1094     7643    3                  IF FRMSTRM = 0
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:174  
     1095     7644    3                  THEN
     1096     7645    3                       FRMSTRM = KIDM_USER;
     1097     7646    3                  CALL KIA$DCLSTR (FRMSTRM, INDX) ALTRET (CLEAN_UP);
     1098     7647    3                END;
     1099     7648    2             ELSE
     1100     7649    2                  IF FRMSTRM ~= 0
     1101     7650    2                  THEN
     1102     7651    2                       CALL KIA$REDSTR(INDX,FRMSTRM) ALTRET (CLEAN_UP);
     1103     7652    2             CALL HFF$NILERASE(5)
     1104     7653    3             WHENRETURN DO;
     1105     7654    3                  WINDOW = VLP$WINDOW;
     1106     7655    3                  CALL KIA$WINDOW(INDX,WINDOW) ALTRET (CLEAN_UP);
     1107     7656    3                  B$ROSEG$->B$ROSEG.STREAMID.WINDOW(INDX) = '1'B;
     1108     7657    3                END;
     1109     7658    2           END;
     1110     7659
     1111     7660    1        B$ROSEG$->B$ROSEG.STREAMID.FLG(INDX) = 1;
     1112     7661
     1113     7662    1   CLEAN_UP:
     1114     7663    1        CALL FMD$RBUF(BUF$);
     1115     7664
     1116     7665    1        RETURN;
     1117     7666        %EJECT;
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:175  
     1118     7667    1   FSL$GET_CLDEV: ENTRY (INDX);
     1119     7668
     1120     7669
     1121     7670    1        DCB$ = B$JIT.DCB$;
     1122     7671    1        CALL OPEN_STAR
     1123     7672    2        WHENALTRETURN DO;
     1124     7673    2             B$JIT.DCB$ = DCB$;
     1125     7674    2             RETURN;
     1126     7675    2           END;
     1127     7676    1        CALL FMD$GBUF(BUF$);
     1128     7677    1        BUF$->FS$DDFSZ = '0'B;
     1129     7678    1        CALL READ_CLDEV;
     1130     7679    1        IF DCB$~=B$M$UC$
     1131     7680    2        THEN DO;
     1132     7681                  /*N* SET UP REST OF THE STREAM DCB ATTRIBUTES */
     1133     7682    2             B$JIT.DCB$ = DCB$;
     1134     7683    2             B$JIT.DCB$->F$DCB.MEDIA = FMTUC#;
     1135     7684    2             CALL FSB$GETDDF(PINCRW(BUF$,1));
     1136     7685    2           END;
     1137     7686    1        B$JIT.DCB$ = B$M$STAR$;
     1138     7687    1        CALL FMP$CLSJ;
     1139     7688    1        B$JIT.DCB$ = DCB$;
     1140     7689    1        GOTO CLEAN_UP;
     1141     7690
     1142     7691        %EJECT;
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:176  
     1143     7692    1   OPEN_STAR: PROC ALTRET;
     1144     7693
     1145     7694    2        B$JIT.DCB$ = B$M$STAR$;
     1146     7695    2        B$M$STAR$->F$DCB.NAME.L = 2;
     1147     7696    2        B$M$STAR$->F$DCB.NAME.C = '*A';
     1148     7697    2        B$M$STAR$->F$DCB.ASN = %FILE#;
     1149     7698    2        B$M$STAR$->F$DCB.FUN = %UPDATE#;
     1150     7699    2        CALL FMM$DFLOPNP;
     1151     7700    2        IF B$JIT.ERR ~= '0'B               /* Cant open *A */
     1152     7701    3        THEN DO;
     1153     7702    3             ALTRETURN;
     1154     7703    3           END;
     1155     7704    2        LDEV_KEY.SZ = 5;
     1156     7705    2        LDEV_KEY.BLK = ' ';
     1157     7706    2        LDEV_KEY.NAME = B$ROSEG$->B$ROSEG.LDEVNAME(INDX);
     1158     7707
     1159     7708    2        RETURN;
     1160     7709
     1161     7710    2   END OPEN_STAR;
     1162     7711
     1163     7712        %EJECT;
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:177  
     1164     7713    1   READ_CLDEV: PROC (BUF$) ALTRET;
     1165     7714
     1166     7715    2   DCL BUF$ PTR;
     1167     7716
     1168     7717    2        FPT_READ = FPT_READ_CONS;
     1169     7718    2        FPT_READ.V.DCB# = %M$STAR#;
     1170     7719    2        FPT_READ.V_ = VECTOR (FPT_READ.V);
     1171     7720    2        FPT_READ.KEY_ = VECTOR (LDEV_KEY);
     1172     7721    2        FPT_READ.BUF_ = VECTOR(BUFFER);
     1173     7722    2        CALL M$MREAD (FPT_READ)
     1174     7723    3        WHENALTRETURN DO;
     1175     7724    3             ALTRETURN;
     1176     7725    3           END;
     1177     7726
     1178     7727    2        RETURN;
     1179     7728
     1180     7729    2   END READ_CLDEV;
     1181     7730
     1182     7731    1   END FSL$UC;
     1183     7732        /*      ME  is the all-purpose most reasonable place for input and
     1184     7733                   output.  Its name is intended to be derived from the
     1185     7734                   word "me"; i.e., the place that "I" am.
     1186     7735                   When you are a timesharing user, ME input comes from your
     1187     7736                   terminal unless you are XEQ'ing, in which case it comes
     1188     7737                   from the XEQ.  Timesharing user ME output is written to
     1189     7738                   your terminal.
     1190     7739                   Batch ME input comes from the command file that was
     1191     7740                   BATCHed to create the batch job, unless the job is doing
     1192     7741                   an XEQ, in which case it comes from the XEQ.  Batch ME
     1193     7742                   output is written to the line printer LP.
     1194     7743
     1195     7744                CR  is the input side of ME.  The name CR stands for
     1196     7745                   "Command Read".  It is just like ME, except you can't
     1197     7746                   output to it.
     1198     7747
     1199     7748                LO  is the output side of ME.  The name LO stands for
     1200     7749                   "Listing Output".  It is just like ME, except you
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:178  
     1201     7750                   can't read from it.
     1202     7751
     1203     7752                UC  is the interactive place.  The name UC stands for
     1204     7753                   "User Console".  When you are a timesharing user, UC
     1205     7754                   input always comes from your terminal and UC output
     1206     7755                   always is written to your terminal.  In batch there is
     1207     7756                   no place to interact, so UC input is an end-of-file and
     1208     7757                   UC output is thrown away.
     1209     7758
     1210     7759                LP  is the line printer.  The name LP stands for "Line
     1211     7760                   Printer".  Output to LP goes to the line printer; you
     1212     7761                   can't read from LP.
     1213     7762
     1214     7763                NO  is no place at all.  The name NO means the word "no".
     1215     7764                   NO input is an end-of-file; NO output is thrown away.
     1216     7765
     1217     7766                CP  is the card punch.  The name CP stands for "Card Punch".
     1218     7767                   Output to CP goes to the card punch; you can't read from
     1219     7768                   CP.
     1220     7769
     1221     7770                GR  is the graphics place.  The name GR stands for "GRaphics".
     1222     7771                   Output to GR goes to the graphics device; you can't read
     1223     7772                   from GR.
     1224     7773        */

PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:179  
--  Include file information  --

   KI_SUBS_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   FS$FIT.:E05TOU  is referenced.
      No diagnostics issued in procedure FSL$UC.

   Procedure FSL$UC requires 463 words for executable code.
   Procedure FSL$UC requires 52 words of local(AUTO) storage.

    No errors detected in file FSL$LDEV.:E05TSI    .

PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:180  

 Object Unit name= FSL$UC                                     File name= FSL$LDEV.:E05TOU
 UTS= JUL 29 '97 17:34:56.56 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS     37     45  FSL$UC
    2   Proc  even  none   463    717  FSL$UC
    3  RoData even  none    17     21  FSL$UC

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes            yes      Std        1  FSL$UC
     2    530                  yes      Std        1  FSL$GET_CLDEV

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    1      0  FS_WINDOW
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:181  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 FMD$GBUF
 yes     yes           Std       3 KIA$CLSSTR
 yes     yes           Std       0 HFF$TRAPALT
 yes     yes           Std       2 FSN$CONV_STR
 yes     yes           Std       1 M$MWRITE
 yes     yes           Std       1 HFF$NIL
         yes           Std       2 HFF$DSIZ
 yes     yes           Std       1 HFF$NILERASE
 yes     yes           Std       1 FSB$GETDDF
         yes           Std       0 FMP$CLSJ
 yes     yes           Std       1 HFF$ERASE
 yes     yes           Std       2 KIA$REDSTR
         yes           Std       1 FMD$RBUF
 yes     yes           Std       2 KIA$DCLSTR
 yes     yes           Std       2 KIA$WINDOW
         yes           Std       0 FMM$DFLOPNP
 yes     yes           Std       1 M$MREAD
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  B$JIT$                           r    B$M$STAR$
r    B$M$UC$                               B$PS0$                                B$PS1$
     B$PS2$                                B$PS5$                                B$ROSEG$
     B_VECTNIL
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:182  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:183  


      886        1        /*T***********************************************************/
      887        2        /*T*                                                         */
      888        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      889        4        /*T*                                                         */
      890        5        /*T***********************************************************/
      891        6        /*F*      NAME: FSL$UC
      892        7                  PURPOSE: FSL$UC creates a new LDEV stream for a UC
      893        8                            stream.
      894        9                  DESCRIPTION:  When a stream begins with 'UC' it is a
      895       10                                Logical Commiuication devices.  Instead of
      896       11                                the description being in the FIT of the file
      897       12                                it will exists as records in the *A file.
      898       13                   */
      899       14
      900       15        FSL$UC: PROC (INDX);

     15  2 000000   000000 700200 xent  FSL$UC       TSX0  ! X66_AUTO_1
         2 000001   000064 000001                    ZERO    52,1

      901       16
      902       17        /* Include files */
      903       18        %INCLUDE FS$FIT;
      904       61        %INCLUDE CP_6;
      905     5620        %INCLUDE F$JIT_C;
      906     6050        %MACRO B$ROSEG(BASED=BASED);
      907     6051        %INCLUDE B$ROSEG;
      908     6114        %MEND;
      909     6115        %B$ROSEG(BASED="BASED(B$ROSEG$)");
      910     6175        %INCLUDE F$DCB;
      911     6224        %INCLUDE F$CP6V_C;
      912     6450        %INCLUDE CP_6_SUBS;
      913     6990        %INCLUDE F_FMTCODE_C;
      914     7024        %INCLUDE KI_SUBS_C;
      915     7160    1   DCL KIA$DCLSTR ENTRY(2) ALTRET;
      916     7161    1   DCL FSN$CONV_STR ENTRY(2) ALTRET;
      917     7162    1   DCL KIA$REDSTR ENTRY(2) ALTRET;
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:184  
      918     7163    1   DCL KIA$CLSSTR ENTRY(3) ALTRET;
      919     7164    1   DCL KIA$WINDOW ENTRY(2) ALTRET;
      920     7165
      921     7166        /* Parameters */
      922     7167    1   DCL INDX UBIN;                          /* Index of stream in roseg */
      923     7168
      924     7169        /* Structures */
      925     7170        %VLP_TAB (FPTN=VLP$TAB,STCLASS=BASED);
      926     7184        %VLP_HDR (FPTN=VLP$HDRF,STCLASS=BASED,LEN=160);
      927     7200    1   DCL 1 VLP$HDRU BASED CALIGNED, 2 * CHAR(J);
      928     7201        %FS$LDEVDDF (NAME=FS$DDF,STCLASS=BASED);
      929     7205        %FS$LDEVDDF (NAME=FS$DDFSZ,STCLASS=BASED,SIZ=FIT);
      930     7209        %FPT$LDEV_V (BASED="BASED(B$PS0$)");
      931     7215        /* Default window for FS */
      932     7216        %VLP_WINDOW (FPTN=FS_WINDOW,FWINDOW='UC01',STCLASS="CONSTANT SYMDEF");
      933     7260        %VLP_WINDOW(FPTN=VLP$WINDOW,STCLASS="BASED(B$PS5$)");
      934     7304        %VLP_WINDOW (FPTN=WINDOW,STCLASS=AUTO);
      935     7348
      936     7349        /* Auto */
      937     7350    1   DCL BUFFER CHAR(4096) BASED(BUF$);
      938     7351    1   DCL BUF$ PTR;
      939     7352    1   DCL 1 LDEV_KEY,
      940     7353    1            2 SZ UBIN BYTE UNAL,
      941     7354    1            2 BLK CHAR(1) UNAL,
      942     7355    1            2 NAME CHAR(4) UNAL;
      943     7356    1   DCL J SBIN;
      944     7357    1   DCL DCB$ PTR;
      945     7358    1   DCL ONLINE BIT(1);
      946     7359    1   DCL FRMSTRM UBIN;
      947     7360    1   DCL 1 FRMSTRM_BYTE REDEF FRMSTRM,
      948     7361    1            2 * BIT(27),
      949     7362    1            2 STR UBIN BYTE UNAL;
      950     7363    1   DCL FRMSTRM_TEXT CHAR(4);
      951     7364
      952     7365        /* References */
      953     7366    1   DCL B$JIT$ PTR SYMREF;
      954     7367    1   DCL B$M$STAR$ PTR SYMREF READONLY;
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:185  
      955     7368    1   DCL B$M$UC$ PTR SYMREF READONLY;
      956     7369    1   DCL B$PS0$ PTR SYMREF;                  /* V area of FPT_LDEV */
      957     7370    1   DCL B$PS1$ PTR SYMREF;                  /* TAB area of FPT_LDEV */
      958     7371    1   DCL B$PS2$ PTR SYMREF;                  /* HDR area of FPT_LDEV */
      959     7372    1   DCL B$PS5$ PTR SYMREF;                  /*->WINDOW area of LDEV FPT*/
      960     7373    1   DCL B$ROSEG$ PTR SYMREF;
      961     7374
      962     7375        /* Entry references */
      963     7376    1   DCL FSB$GETDDF ENTRY(1) ALTRET;
      964     7377    1   DCL FMD$GBUF ENTRY (1);
      965     7378    1   DCL FMD$RBUF ENTRY (1);
      966     7379    1   DCL HFF$NIL ENTRY(1) ALTRET;
      967     7380    1   DCL HFF$ERASE ENTRY(1) ALTRET;
      968     7381    1   DCL HFF$DSIZ ENTRY(2);
      969     7382    1   DCL HFF$TRAPALT ENTRY ALTRET;
      970     7383    1   DCL HFF$NILERASE ENTRY(1) ALTRET;
      971     7384    1   DCL FMM$DFLOPNP ENTRY;
      972     7385    1   DCL FMP$CLSJ ENTRY;
      973     7386    1   DCL M$MREAD ENTRY(1) ALTRET;
      974     7387    1   DCL M$MWRITE ENTRY(1) ALTRET;
      975     7388    1   DCL FSA$FDCB ENTRY(1);
      976     7389
      977     7390        /* FPT's */
      978     7391        %FPT_READ (FPTN=FPT_READ_CONS,STCLASS=CONSTANT,KEYS=YES);
      979     7430        %FPT_READ (STCLASS=AUTO);
      980     7469        %FPT_WRITE (FPTN=FPT_WRITE_CONS,STCLASS=CONSTANT);
      981     7500        %FPT_WRITE (STCLASS=AUTO);
      982     7531
      983     7532        %EJECT;
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:186  
      984     7533
      985     7534    1        CALL FMD$GBUF (BUF$);

   7534  2 000002   200014 630500                    EPPR0   BUF$,,AUTO
         2 000003   200060 450500                    STP0    @BUF$+1,,AUTO
         2 000004   200060 630500                    EPPR0   @BUF$+1,,AUTO
         2 000005   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000006   000000 701000 xent               TSX1    FMD$GBUF
         2 000007   000000 011000                    NOP     0

      986     7535    1        BUF$->FS$DDFSZ = '0'B;

   7535  2 000010   200014 470500                    LDP0    BUF$,,AUTO
         2 000011   000100 100400                    MLR     fill='000'O
         2 000012   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000013   000000 000024                    ADSC9   0,,PR0                   cn=0,n=20

      987     7536    1        IF B$M$UC$->F$DCB.MEDIA = FMTUC#

   7536  2 000014   000000 470400 xsym               LDP0    B$M$UC$
         2 000015   000103 236100                    LDQ     67,,PR0
         2 000016   000777 376003                    ANQ     511,DU
         2 000017   000014 116003                    CMPQ    12,DU
         2 000020   000024 601000 2                  TNZ     s:7540

      988     7537    1        THEN
      989     7538    1             ONLINE = '1'B;

   7538  2 000021   400000 236003                    LDQ     -131072,DU
         2 000022   200021 756100                    STQ     ONLINE,,AUTO
         2 000023   000025 710000 2                  TRA     s:7542

      990     7539    1        ELSE
      991     7540    1             ONLINE = '0'B;

   7540  2 000024   200021 450100                    STZ     ONLINE,,AUTO

PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:187  
      992     7541
      993     7542    1        IF B$ROSEG$->B$ROSEG.STREAMID.FLG(INDX) = 2 /* Stream open */

   7542  2 000025   200003 471500                    LDP1    @INDX,,AUTO
         2 000026   100000 720100                    LXL0    0,,PR1
         2 000027   000000 473400 xsym               LDP3    B$ROSEG$
         2 000030   300074 236110                    LDQ     60,X0,PR3
         2 000031   600000 376003                    ANQ     -65536,DU
         2 000032   400000 116003                    CMPQ    -131072,DU
         2 000033   000115 601000 2                  TNZ     s:7561

      994     7543    2        THEN DO;

      995     7544    2             J = B$ROSEG$->B$ROSEG.NUMDCBS;

   7544  2 000034   300002 236100                    LDQ     2,,PR3
         2 000035   000022 772000                    QRL     18
         2 000036   200017 756100                    STQ     J,,AUTO

      996     7545    3             DO WHILE (J>=%M$MAXNEG#);

   7545  2 000037   000071 710000 2                  TRA     s:7553

      997     7546    3                  IF B$ROSEG.DCBPTR$->B$RODCB$(J)~=ADDR(NIL)

   7546  2 000040   000000 470400 xsym               LDP0    B$ROSEG$
         2 000041   000000 471500                    LDP1    0,,PR0
         2 000042   200017 720100                    LXL0    J,,AUTO
         2 000043   100000 236110                    LDQ     0,X0,PR1
         2 000044   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000045   000067 600000 2                  TZE     s:7552
         2 000046   000000 116000 xsym               CMPQ    B$M$UC$
         2 000047   000067 600000 2                  TZE     s:7552

      998     7547    3                       AND B$ROSEG.DCBPTR$->B$RODCB$(J)~=B$M$UC$ THEN
      999     7548    3                       IF B$ROSEG.DCBPTR$->B$RODCB$(J)->F$DCB.IASN=%STREAM#

PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:188  
   7548  2 000050   100000 473510                    LDP3    0,X0,PR1
         2 000051   300103 236100                    LDQ     67,,PR3
         2 000052   000777 376007                    ANQ     511,DL
         2 000053   000005 116007                    CMPQ    5,DL
         2 000054   000067 601000 2                  TNZ     s:7552
         2 000055   300066 236100                    LDQ     54,,PR3
         2 000056   000000 116000 xsym               CMPQ    B$M$UC$
         2 000057   000067 601000 2                  TNZ     s:7552
         2 000060   200003 474500                    LDP4    @INDX,,AUTO
         2 000061   300077 236100                    LDQ     63,,PR3
         2 000062   000777 376007                    ANQ     511,DL
         2 000063   400000 116100                    CMPQ    0,,PR4
         2 000064   000067 601000 2                  TNZ     s:7552

     1000     7549    3                            AND B$ROSEG.DCBPTR$->B$RODCB$(J)->F$DCB.CFU$=B$M$UC$
     1001     7550    3                            AND B$ROSEG.DCBPTR$->B$RODCB$(J)->F$DCB.STR=INDX THEN
     1002     7551    3                            B$ROSEG.DCBPTR$->B$RODCB$(J)->F$DCB.FCD=%NO#;

   7551  2 000065   000000 236000 3                  LDQ     0
         2 000066   300031 356100                    ANSQ    25,,PR3

     1003     7552    3                  J=J-1;

   7552  2 000067   000001 336007                    LCQ     1,DL
         2 000070   200017 056100                    ASQ     J,,AUTO

     1004     7553    3                END;

   7553  2 000071   200017 235100                    LDA     J,,AUTO
         2 000072   000001 115000 3                  CMPA    1
         2 000073   000040 605000 2                  TPL     s:7546

     1005     7554
     1006     7555    2             IF ONLINE

   7555  2 000074   200021 234100                    SZN     ONLINE,,AUTO
         2 000075   000106 605000 2                  TPL     s:7558
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:189  

     1007     7556    2             THEN
     1008     7557    2                  CALL KIA$CLSSTR (INDX,'0'B,'0'B);

   7557  2 000076   000002 236000 3                  LDQ     2
         2 000077   200062 756100                    STQ     @BUF$+3,,AUTO
         2 000100   200003 235100                    LDA     @INDX,,AUTO
         2 000101   200060 757100                    STAQ    @BUF$+1,,AUTO
         2 000102   200060 630500                    EPPR0   @BUF$+1,,AUTO
         2 000103   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000104   000000 701000 xent               TSX1    KIA$CLSSTR
         2 000105   000000 011000                    NOP     0

     1009     7558    2             B$ROSEG$->B$ROSEG.STREAMID.FLG(INDX) = 1;

   7558  2 000106   200003 470500                    LDP0    @INDX,,AUTO
         2 000107   000000 720100                    LXL0    0,,PR0
         2 000110   000000 471400 xsym               LDP1    B$ROSEG$
         2 000111   100074 236110                    LDQ     60,X0,PR1
         2 000112   000003 376000 3                  ANQ     3
         2 000113   200000 276003                    ORQ     65536,DU
         2 000114   100074 756110                    STQ     60,X0,PR1

     1010     7559    2           END;

     1011     7560
     1012     7561    1        CALL OPEN_STAR ALTRET(CLEAN_UP);

   7561  2 000115   000615 701000 2                  TSX1    OPEN_STAR
         2 000116   000521 702000 2                  TSX2    CLEAN_UP

     1013     7562    1        CALL HFF$TRAPALT ALTRET(TRAPALT);

   7562  2 000117   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000120   000000 701000 xent               TSX1    HFF$TRAPALT
         2 000121   000203 702000 2                  TSX2    TRAPALT

PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:190  
     1014     7563
     1015     7564    1        IF B$ROSEG$->B$ROSEG.STREAMID.FLG(INDX) ~= 0

   7564  2 000122   200003 470500                    LDP0    @INDX,,AUTO
         2 000123   000000 720100                    LXL0    0,,PR0
         2 000124   000000 471400 xsym               LDP1    B$ROSEG$
         2 000125   100074 236110                    LDQ     60,X0,PR1
         2 000126   600000 316003                    CANQ    -65536,DU
         2 000127   000137 600000 2                  TZE     s:7571

     1016     7565    1        THEN
     1017     7566    1             CALL READ_CLDEV(BUF$)

   7566  2 000130   200014 633500                    EPPR3   BUF$,,AUTO
         2 000131   200057 453500                    STP3    FPT_WRITE+13,,AUTO
         2 000132   000661 701000 2                  TSX1    READ_CLDEV
         2 000133   000135 702000 2                  TSX2    s:7568
         2 000134   000137 710000 2                  TRA     s:7571

     1018     7567    2             WHENALTRETURN DO;

     1019     7568    2                  B$JIT.ERR = '0'B;

   7568  2 000135   000000 470400 xsym               LDP0    B$JIT$
         2 000136   000012 450100                    STZ     10,,PR0

     1020     7569    2                END;

     1021     7570
     1022     7571    1        IF (FPT$LDEV_V.REMOVE OR FPT$LDEV_V.LOGON) AND

   7571  2 000137   000000 470400 xsym               LDP0    B$PS0$
         2 000140   000001 236100                    LDQ     1,,PR0
         2 000141   100000 316003                    CANQ    32768,DU
         2 000142   000145 601000 2                  TNZ     s:7571+6
         2 000143   020000 316003                    CANQ    8192,DU
         2 000144   000212 600000 2                  TZE     s:7585
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:191  
         2 000145   200003 471500                    LDP1    @INDX,,AUTO
         2 000146   100000 235100                    LDA     0,,PR1
         2 000147   000004 115007                    CMPA    4,DL
         2 000150   000212 602000 2                  TNC     s:7585

     1023     7572    1             INDX > KIDM_DB
     1024     7573    2        THEN DO;

     1025     7574    2             IF ONLINE AND B$ROSEG$->B$ROSEG.STREAMID.FLG(INDX) ~= 0

   7574  2 000151   200021 234100                    SZN     ONLINE,,AUTO
         2 000152   000173 605000 2                  TPL     s:7577
         2 000153   100000 720100                    LXL0    0,,PR1
         2 000154   000000 473400 xsym               LDP3    B$ROSEG$
         2 000155   300074 236110                    LDQ     60,X0,PR3
         2 000156   600000 316003                    CANQ    -65536,DU
         2 000157   000173 600000 2                  TZE     s:7577

     1026     7575    2             THEN
     1027     7576    2                  CALL KIA$CLSSTR(INDX,FPT$LDEV_V.REMOVE,FPT$LDEV_V.LOGON);

   7576  2 000160   000000 236000 xsym               LDQ     B$PS0$
         2 000161   000004 036000 3                  ADLQ    4
         2 000162   200062 756100                    STQ     @BUF$+3,,AUTO
         2 000163   000000 236000 xsym               LDQ     B$PS0$
         2 000164   000005 036000 3                  ADLQ    5
         2 000165   200003 235100                    LDA     @INDX,,AUTO
         2 000166   200060 757100                    STAQ    @BUF$+1,,AUTO
         2 000167   200060 630500                    EPPR0   @BUF$+1,,AUTO
         2 000170   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000171   000000 701000 xent               TSX1    KIA$CLSSTR
         2 000172   000000 011000                    NOP     0

     1028     7577    2             B$ROSEG$->B$ROSEG.STREAMID(INDX) = '0'B;

   7577  2 000173   200003 470500                    LDP0    @INDX,,AUTO
         2 000174   000000 720100                    LXL0    0,,PR0
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:192  
         2 000175   000000 471400 xsym               LDP1    B$ROSEG$
         2 000176   100074 450110                    STZ     60,X0,PR1

     1029     7578    2             B$ROSEG$->B$ROSEG.LDEVNAME(INDX) = '    ';

   7578  2 000177   000000 720100                    LXL0    0,,PR0
         2 000200   000042 236000 1                  LDQ     FPT_WRITE_CONS+12
         2 000201   000000 471400 xsym               LDP1    B$ROSEG$
         2 000202   100054 756110                    STQ     44,X0,PR1

   7578  2 000203                       TRAPALT      null
     1030     7579    2   TRAPALT:  ;
     1031     7580    2             B$JIT.DCB$ = B$M$STAR$;

   7580  2 000203   000000 236000 xsym               LDQ     B$M$STAR$
         2 000204   000000 470400 xsym               LDP0    B$JIT$
         2 000205   000232 756100                    STQ     154,,PR0

     1032     7581    2             CALL FMP$CLSJ;

   7581  2 000206   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000207   000000 701000 xent               TSX1    FMP$CLSJ
         2 000210   000000 011000                    NOP     0

     1033     7582    2             GOTO CLEAN_UP;

   7582  2 000211   000521 710000 2                  TRA     CLEAN_UP

     1034     7583    2           END;
     1035     7584
     1036     7585    1        FRMSTRM = 0;

   7585  2 000212   200022 450100                    STZ     FRMSTRM,,AUTO

     1037     7586    1        IF FPT$LDEV_V.FRMSTRM ~= ' '

   7586  2 000213   000005 236100                    LDQ     5,,PR0
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:193  
         2 000214   000006 376000 3                  ANQ     6
         2 000215   000007 116000 3                  CMPQ    7
         2 000216   000240 600000 2                  TZE     s:7591

     1038     7587    2        THEN DO;

     1039     7588    2             CALL CONCAT (FRMSTRM_TEXT,'UC',FPT$LDEV_V.FRMSTRM);

   7588  2 000217   000043 220000 1                  LDX0    FPT_WRITE_CONS+13
         2 000220   200023 740100                    STX0    FRMSTRM_TEXT,,AUTO
         2 000221   040100 100500                    MLR     fill='040'O
         2 000222   000005 200002                    ADSC9   5,,PR0                   cn=1,n=2
         2 000223   200060 000004                    ADSC9   @BUF$+1,,AUTO            cn=0,n=4
         2 000224   200060 221100                    LDX1    @BUF$+1,,AUTO
         2 000225   200023 441100                    SXL1    FRMSTRM_TEXT,,AUTO

     1040     7589    2             CALL FSN$CONV_STR(FRMSTRM_TEXT,FRMSTRM_BYTE.STR);

   7589  2 000226   200062 452500                    STP2    @BUF$+3,,AUTO
         2 000227   200062 236100                    LDQ     @BUF$+3,,AUTO
         2 000230   000010 036000 3                  ADLQ    8
         2 000231   200061 756100                    STQ     @BUF$+2,,AUTO
         2 000232   200023 630500                    EPPR0   FRMSTRM_TEXT,,AUTO
         2 000233   200060 450500                    STP0    @BUF$+1,,AUTO
         2 000234   200060 630500                    EPPR0   @BUF$+1,,AUTO
         2 000235   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000236   000000 701000 xent               TSX1    FSN$CONV_STR
         2 000237   000000 011000                    NOP     0

     1041     7590    2           END;

     1042     7591    1        IF FPT$LDEV_V.LINES~=0 THEN

   7591  2 000240   000000 470400 xsym               LDP0    B$PS0$
         2 000241   000002 720100                    LXL0    2,,PR0
         2 000242   000245 600000 2                  TZE     s:7593

PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:194  
     1043     7592    1             BUF$->FS$DDFSZ.LINES=FPT$LDEV_V.LINES;

   7592  2 000243   200014 471500                    LDP1    BUF$,,AUTO
         2 000244   100002 740100                    STX0    2,,PR1

     1044     7593    1        IF FPT$LDEV_V.DVFC~=BINASC(0) THEN

   7593  2 000245   000002 236100                    LDQ     2,,PR0
         2 000246   777000 376003                    ANQ     -512,DU
         2 000247   000000 116003                    CMPQ    0,DU
         2 000250   000255 600000 2                  TZE     s:7595

     1045     7594    1             BUF$->FS$DDFSZ.DVFC=FPT$LDEV_V.DVFC;

   7594  2 000251   200014 471500                    LDP1    BUF$,,AUTO
         2 000252   000002 236100                    LDQ     2,,PR0
         2 000253   000022 772000                    QRL     18
         2 000254   100002 552110                    STBQ    2,'10'O,PR1

     1046     7595    1        IF FPT$LDEV_V.WIDTH~=0 THEN

   7595  2 000255   000005 236100                    LDQ     5,,PR0
         2 000256   777000 316003                    CANQ    -512,DU
         2 000257   000263 600000 2                  TZE     s:7597

     1047     7596    1             BUF$->FS$DDFSZ.WIDTH=FPT$LDEV_V.WIDTH;

   7596  2 000260   200014 471500                    LDP1    BUF$,,AUTO
         2 000261   000011 772000                    QRL     9
         2 000262   100001 552120                    STBQ    1,'20'O,PR1

     1048     7597    1        IF FPT$LDEV_V.ATTR THEN

   7597  2 000263   000003 220100                    LDX0    3,,PR0
         2 000264   000267 600000 2                  TZE     s:7599

     1049     7598    1             BUF$->FS$DDFSZ.ATTR=FPT$LDEV_V.ATTR;
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:195  

   7598  2 000265   200014 471500                    LDP1    BUF$,,AUTO
         2 000266   100001 440100                    SXL0    1,,PR1

     1050     7599    1        CALL HFF$NIL(B$PS1$)

   7599  2 000267   000011 630400 3                  EPPR0   9
         2 000270   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000271   000000 701000 xent               TSX1    HFF$NIL
         2 000272   000313 702000 2                  TSX2    s:7610

     1051     7600    2        WHENRETURN DO;

     1052     7601    2             CALL HFF$ERASE(B$PS1$)

   7601  2 000273   000011 630400 3                  EPPR0   9
         2 000274   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000275   000000 701000 xent               TSX1    HFF$ERASE
         2 000276   000310 702000 2                  TSX2    s:7607

     1053     7602    3             WHENRETURN DO;

     1054     7603    3                  BUF$->FS$DDFSZ.F.TAB = '1'B;

   7603  2 000277   200014 470500                    LDP0    BUF$,,AUTO
         2 000300   400000 236003                    LDQ     -131072,DU
         2 000301   000001 256100                    ORSQ    1,,PR0

     1055     7604    3                  PINCRW(BUF$,SIZEW(FS$DDFSZ))->VLP$TAB = B$PS1$->VLP$TAB;

   7604  2 000302   000000 470400 xsym               LDP0    B$PS1$
         2 000303   200014 471500                    LDP1    BUF$,,AUTO
         2 000304   000100 100500                    MLR     fill='000'O
         2 000305   000000 000040                    ADSC9   0,,PR0                   cn=0,n=32
         2 000306   100005 000040                    ADSC9   5,,PR1                   cn=0,n=32

     1056     7605    3                END;
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:196  

   7605  2 000307   000313 710000 2                  TRA     s:7610

     1057     7606    3             WHENALTRETURN DO;

     1058     7607    3                  BUF$->FS$DDFSZ.F.TAB = '0'B;

   7607  2 000310   200014 470500                    LDP0    BUF$,,AUTO
         2 000311   000031 236000 xsym               LDQ     B_VECTNIL+25
         2 000312   000001 356100                    ANSQ    1,,PR0

     1059     7608    3                END;

     1060     7609    2           END;

     1061     7610    1        CALL HFF$NIL(B$PS2$)

   7610  2 000313   000012 630400 3                  EPPR0   10
         2 000314   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000315   000000 701000 xent               TSX1    HFF$NIL
         2 000316   000350 702000 2                  TSX2    s:7623

     1062     7611    2        WHENRETURN DO;

     1063     7612    2             CALL HFF$ERASE(B$PS2$)

   7612  2 000317   000012 630400 3                  EPPR0   10
         2 000320   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000321   000000 701000 xent               TSX1    HFF$ERASE
         2 000322   000345 702000 2                  TSX2    s:7620

     1064     7613    3             WHENRETURN DO;

     1065     7614    3                  BUF$->FS$DDFSZ.F.HDR = '1'B;

   7614  2 000323   200014 470500                    LDP0    BUF$,,AUTO
         2 000324   200000 236003                    LDQ     65536,DU
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:197  
         2 000325   000001 256100                    ORSQ    1,,PR0

     1066     7615    3                  CALL HFF$DSIZ(B$PS2$,J);

   7615  2 000326   200017 630500                    EPPR0   J,,AUTO
         2 000327   200061 450500                    STP0    @BUF$+2,,AUTO
         2 000330   000012 236000 3                  LDQ     10
         2 000331   200060 756100                    STQ     @BUF$+1,,AUTO
         2 000332   200060 630500                    EPPR0   @BUF$+1,,AUTO
         2 000333   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000334   000000 701000 xent               TSX1    HFF$DSIZ
         2 000335   000000 011000                    NOP     0

     1067     7616    3                  PINCRW(BUF$,SIZEW(FS$DDFSZ)+SIZEW(VLP$TAB))->VLP$HDRF

   7616  2 000336   000000 470400 xsym               LDP0    B$PS2$
         2 000337   200017 720100                    LXL0    J,,AUTO
         2 000340   200014 471500                    LDP1    BUF$,,AUTO
         2 000341   000100 100540                    MLR     fill='000'O
         2 000342   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         2 000343   100015 000245                    ADSC9   13,,PR1                  cn=0,n=165

     1068     7617    3                       = B$PS2$->VLP$HDRU;
     1069     7618    3                END;

   7618  2 000344   000350 710000 2                  TRA     s:7623

     1070     7619    3             WHENALTRETURN DO;

     1071     7620    3                  BUF$->FS$DDFSZ.F.HDR = '0'B;

   7620  2 000345   200014 470500                    LDP0    BUF$,,AUTO
         2 000346   000013 236000 3                  LDQ     11
         2 000347   000001 356100                    ANSQ    1,,PR0

     1072     7621    3                END;

PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:198  
     1073     7622    2           END;

     1074     7623    1        BUF$->FS$DDFSZ.SIZ = SIZEW(FS$DDF)+SIZEW(VLP$TAB)+SIZEW(VLP$HDRF);

   7623  2 000350   000066 235007                    LDA     54,DL
         2 000351   200014 470500                    LDP0    BUF$,,AUTO
         2 000352   000000 755100                    STA     0,,PR0

     1075     7624
     1076     7625    1        FPT_WRITE = FPT_WRITE_CONS;

   7625  2 000353   000100 100400                    MLR     fill='000'O
         2 000354   000026 000060 1                  ADSC9   FPT_WRITE_CONS           cn=0,n=48
         2 000355   200042 000060                    ADSC9   FPT_WRITE,,AUTO          cn=0,n=48

     1077     7626    1        FPT_WRITE.V_ = VECTOR(FPT_WRITE.V);

   7626  2 000356   000014 235000 3                  LDA     12
         2 000357   200060 452500                    STP2    @BUF$+1,,AUTO
         2 000360   200060 236100                    LDQ     @BUF$+1,,AUTO
         2 000361   000052 036003                    ADLQ    42,DU
         2 000362   200042 757100                    STAQ    FPT_WRITE,,AUTO

     1078     7627    1        FPT_WRITE.KEY_ = VECTOR(LDEV_KEY);

   7627  2 000363   000015 235000 3                  LDA     13
         2 000364   200060 452500                    STP2    @BUF$+1,,AUTO
         2 000365   200060 236100                    LDQ     @BUF$+1,,AUTO
         2 000366   000015 036003                    ADLQ    13,DU
         2 000367   200044 757100                    STAQ    FPT_WRITE+2,,AUTO

     1079     7628    1        FPT_WRITE.V.DCB# = %M$STAR#;

   7628  2 000370   000001 220003                    LDX0    1,DU
         2 000371   200052 740100                    STX0    FPT_WRITE+8,,AUTO

     1080     7629    1        FPT_WRITE.BUF_ = VECTOR(BUFFER);
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:199  

   7629  2 000372   000016 235000 3                  LDA     14
         2 000373   200014 236100                    LDQ     BUF$,,AUTO
         2 000374   200046 757100                    STAQ    FPT_WRITE+4,,AUTO

     1081     7630    1        FPT_WRITE.BUF_.BOUND = BUF$->FS$DDFSZ.SIZ * 4 + 3;

   7630  2 000375   200014 470500                    LDP0    BUF$,,AUTO
         2 000376   000000 236100                    LDQ     0,,PR0
         2 000377   000002 736000                    QLS     2
         2 000400   000003 036007                    ADLQ    3,DL
         2 000401   000020 736000                    QLS     16
         2 000402   200046 676100                    ERQ     FPT_WRITE+4,,AUTO
         2 000403   000034 376000 xsym               ANQ     B_VECTNIL+28
         2 000404   200046 656100                    ERSQ    FPT_WRITE+4,,AUTO

     1082     7631    1        CALL M$MWRITE (FPT_WRITE)

   7631  2 000405   200042 631500                    EPPR1   FPT_WRITE,,AUTO
         2 000406   200060 451500                    STP1    @BUF$+1,,AUTO
         2 000407   200060 630500                    EPPR0   @BUF$+1,,AUTO
         2 000410   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000411   000000 701000 xent               TSX1    M$MWRITE
         2 000412   000414 702000 2                  TSX2    s:7634
         2 000413   000414 710000 2                  TRA     s:7634

     1083     7632    2        WHENALTRETURN DO;

     1084     7633    2           END;

     1085     7634    1        B$JIT.DCB$ = B$M$STAR$;

   7634  2 000414   000000 236000 xsym               LDQ     B$M$STAR$
         2 000415   000000 470400 xsym               LDP0    B$JIT$
         2 000416   000232 756100                    STQ     154,,PR0

     1086     7635    1        CALL FMP$CLSJ;
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:200  

   7635  2 000417   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000420   000000 701000 xent               TSX1    FMP$CLSJ
         2 000421   000000 011000                    NOP     0

     1087     7636
     1088     7637        /* Finish setting up ROSEG */
     1089     7638    1        B$ROSEG$->B$ROSEG.STREAMID.UC_STR(INDX) = '1'B;

   7638  2 000422   200003 470500                    LDP0    @INDX,,AUTO
         2 000423   000000 720100                    LXL0    0,,PR0
         2 000424   000000 471400 xsym               LDP1    B$ROSEG$
         2 000425   000001 236003                    LDQ     1,DU
         2 000426   100074 256110                    ORSQ    60,X0,PR1

     1090     7639    1        IF ONLINE

   7639  2 000427   200021 234100                    SZN     ONLINE,,AUTO
         2 000430   000512 605000 2                  TPL     s:7660

     1091     7640    2        THEN DO;

     1092     7641    2             IF B$ROSEG$->B$ROSEG.STREAMID.FLG(INDX) = 0

   7641  2 000431   000000 720100                    LXL0    0,,PR0
         2 000432   000000 471400 xsym               LDP1    B$ROSEG$
         2 000433   100074 236110                    LDQ     60,X0,PR1
         2 000434   600000 316003                    CANQ    -65536,DU
         2 000435   000453 601000 2                  TNZ     s:7649

     1093     7642    3             THEN DO;

     1094     7643    3                  IF FRMSTRM = 0

   7643  2 000436   200022 235100                    LDA     FRMSTRM,,AUTO
         2 000437   000442 601000 2                  TNZ     s:7646

PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:201  
     1095     7644    3                  THEN
     1096     7645    3                       FRMSTRM = KIDM_USER;

   7645  2 000440   000002 235007                    LDA     2,DL
         2 000441   200022 755100                    STA     FRMSTRM,,AUTO

     1097     7646    3                  CALL KIA$DCLSTR (FRMSTRM, INDX) ALTRET (CLEAN_UP);

   7646  2 000442   200003 236100                    LDQ     @INDX,,AUTO
         2 000443   200061 756100                    STQ     @BUF$+2,,AUTO
         2 000444   200022 633500                    EPPR3   FRMSTRM,,AUTO
         2 000445   200060 453500                    STP3    @BUF$+1,,AUTO
         2 000446   200060 630500                    EPPR0   @BUF$+1,,AUTO
         2 000447   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000450   000000 701000 xent               TSX1    KIA$DCLSTR
         2 000451   000521 702000 2                  TSX2    CLEAN_UP

     1098     7647    3                END;

   7647  2 000452   000465 710000 2                  TRA     s:7652

     1099     7648    2             ELSE
     1100     7649    2                  IF FRMSTRM ~= 0

   7649  2 000453   200022 235100                    LDA     FRMSTRM,,AUTO
         2 000454   000465 600000 2                  TZE     s:7652

     1101     7650    2                  THEN
     1102     7651    2                       CALL KIA$REDSTR(INDX,FRMSTRM) ALTRET (CLEAN_UP);

   7651  2 000455   200022 633500                    EPPR3   FRMSTRM,,AUTO
         2 000456   200061 453500                    STP3    @BUF$+2,,AUTO
         2 000457   200003 236100                    LDQ     @INDX,,AUTO
         2 000460   200060 756100                    STQ     @BUF$+1,,AUTO
         2 000461   200060 630500                    EPPR0   @BUF$+1,,AUTO
         2 000462   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000463   000000 701000 xent               TSX1    KIA$REDSTR
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:202  
         2 000464   000521 702000 2                  TSX2    CLEAN_UP

     1103     7652    2             CALL HFF$NILERASE(5)

   7652  2 000465   000017 630400 3                  EPPR0   15
         2 000466   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000467   000000 701000 xent               TSX1    HFF$NILERASE
         2 000470   000512 702000 2                  TSX2    s:7660

     1104     7653    3             WHENRETURN DO;

     1105     7654    3                  WINDOW = VLP$WINDOW;

   7654  2 000471   000000 470400 xsym               LDP0    B$PS5$
         2 000472   000100 100500                    MLR     fill='000'O
         2 000473   000000 000040                    ADSC9   0,,PR0                   cn=0,n=32
         2 000474   200004 000040                    ADSC9   WINDOW,,AUTO             cn=0,n=32

     1106     7655    3                  CALL KIA$WINDOW(INDX,WINDOW) ALTRET (CLEAN_UP);

   7655  2 000475   200004 631500                    EPPR1   WINDOW,,AUTO
         2 000476   200061 451500                    STP1    @BUF$+2,,AUTO
         2 000477   200003 236100                    LDQ     @INDX,,AUTO
         2 000500   200060 756100                    STQ     @BUF$+1,,AUTO
         2 000501   200060 630500                    EPPR0   @BUF$+1,,AUTO
         2 000502   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000503   000000 701000 xent               TSX1    KIA$WINDOW
         2 000504   000521 702000 2                  TSX2    CLEAN_UP

     1107     7656    3                  B$ROSEG$->B$ROSEG.STREAMID.WINDOW(INDX) = '1'B;

   7656  2 000505   200003 470500                    LDP0    @INDX,,AUTO
         2 000506   000000 720100                    LXL0    0,,PR0
         2 000507   000000 471400 xsym               LDP1    B$ROSEG$
         2 000510   000002 236003                    LDQ     2,DU
         2 000511   100074 256110                    ORSQ    60,X0,PR1

PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:203  
     1108     7657    3                END;

     1109     7658    2           END;

     1110     7659
     1111     7660    1        B$ROSEG$->B$ROSEG.STREAMID.FLG(INDX) = 1;

   7660  2 000512   200003 470500                    LDP0    @INDX,,AUTO
         2 000513   000000 720100                    LXL0    0,,PR0
         2 000514   000000 471400 xsym               LDP1    B$ROSEG$
         2 000515   100074 236110                    LDQ     60,X0,PR1
         2 000516   000003 376000 3                  ANQ     3
         2 000517   200000 276003                    ORQ     65536,DU
         2 000520   100074 756110                    STQ     60,X0,PR1

     1112     7661
     1113     7662    1   CLEAN_UP:
     1114     7663    1        CALL FMD$RBUF(BUF$);

   7663  2 000521   200014 630500       CLEAN_UP     EPPR0   BUF$,,AUTO
         2 000522   200060 450500                    STP0    @BUF$+1,,AUTO
         2 000523   200060 630500                    EPPR0   @BUF$+1,,AUTO
         2 000524   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000525   000000 701000 xent               TSX1    FMD$RBUF
         2 000526   000000 011000                    NOP     0

     1115     7664
     1116     7665    1        RETURN;

   7665  2 000527   000000 702200 xent               TSX2  ! X66_ARET

     1117     7666        %EJECT;
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:204  
     1118     7667    1   FSL$GET_CLDEV: ENTRY (INDX);

   7667  2 000530   000000 700200 xent  FSL$GET_CLD* TSX0  ! X66_AUTO_1
         2 000531   000064 000001                    ZERO    52,1

     1119     7668
     1120     7669
     1121     7670    1        DCB$ = B$JIT.DCB$;

   7670  2 000532   000000 470400 xsym               LDP0    B$JIT$
         2 000533   000232 236100                    LDQ     154,,PR0
         2 000534   200020 756100                    STQ     DCB$,,AUTO

     1122     7671    1        CALL OPEN_STAR

   7671  2 000535   000615 701000 2                  TSX1    OPEN_STAR
         2 000536   000540 702000 2                  TSX2    s:7673
         2 000537   000544 710000 2                  TRA     s:7676

     1123     7672    2        WHENALTRETURN DO;

     1124     7673    2             B$JIT.DCB$ = DCB$;

   7673  2 000540   200020 236100                    LDQ     DCB$,,AUTO
         2 000541   000000 470400 xsym               LDP0    B$JIT$
         2 000542   000232 756100                    STQ     154,,PR0

     1125     7674    2             RETURN;

   7674  2 000543   000000 702200 xent               TSX2  ! X66_ARET

     1126     7675    2           END;
     1127     7676    1        CALL FMD$GBUF(BUF$);

   7676  2 000544   200014 630500                    EPPR0   BUF$,,AUTO
         2 000545   200060 450500                    STP0    @BUF$+1,,AUTO
         2 000546   200060 630500                    EPPR0   @BUF$+1,,AUTO
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:205  
         2 000547   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000550   000000 701000 xent               TSX1    FMD$GBUF
         2 000551   000000 011000                    NOP     0

     1128     7677    1        BUF$->FS$DDFSZ = '0'B;

   7677  2 000552   200014 470500                    LDP0    BUF$,,AUTO
         2 000553   000100 100400                    MLR     fill='000'O
         2 000554   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000555   000000 000024                    ADSC9   0,,PR0                   cn=0,n=20

     1129     7678    1        CALL READ_CLDEV;

   7678  2 000556   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000557   200057 756100                    STQ     FPT_WRITE+13,,AUTO
         2 000560   000661 701000 2                  TSX1    READ_CLDEV
         2 000561   000000 011000                    NOP     0

     1130     7679    1        IF DCB$~=B$M$UC$

   7679  2 000562   200020 236100                    LDQ     DCB$,,AUTO
         2 000563   000000 116000 xsym               CMPQ    B$M$UC$
         2 000564   000603 600000 2                  TZE     s:7686

     1131     7680    2        THEN DO;

     1132     7681                  /*N* SET UP REST OF THE STREAM DCB ATTRIBUTES */
     1133     7682    2             B$JIT.DCB$ = DCB$;

   7682  2 000565   000000 470400 xsym               LDP0    B$JIT$
         2 000566   000232 756100                    STQ     154,,PR0

     1134     7683    2             B$JIT.DCB$->F$DCB.MEDIA = FMTUC#;

   7683  2 000567   000232 471500                    LDP1    154,,PR0
         2 000570   000014 236003                    LDQ     12,DU
         2 000571   100103 552120                    STBQ    67,'20'O,PR1
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:206  

     1135     7684    2             CALL FSB$GETDDF(PINCRW(BUF$,1));

   7684  2 000572   200014 236100                    LDQ     BUF$,,AUTO
         2 000573   000001 036003                    ADLQ    1,DU
         2 000574   200060 756100                    STQ     @BUF$+1,,AUTO
         2 000575   200060 631500                    EPPR1   @BUF$+1,,AUTO
         2 000576   200061 451500                    STP1    @BUF$+2,,AUTO
         2 000577   200061 630500                    EPPR0   @BUF$+2,,AUTO
         2 000600   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000601   000000 701000 xent               TSX1    FSB$GETDDF
         2 000602   000000 011000                    NOP     0

     1136     7685    2           END;

     1137     7686    1        B$JIT.DCB$ = B$M$STAR$;

   7686  2 000603   000000 236000 xsym               LDQ     B$M$STAR$
         2 000604   000000 470400 xsym               LDP0    B$JIT$
         2 000605   000232 756100                    STQ     154,,PR0

     1138     7687    1        CALL FMP$CLSJ;

   7687  2 000606   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000607   000000 701000 xent               TSX1    FMP$CLSJ
         2 000610   000000 011000                    NOP     0

     1139     7688    1        B$JIT.DCB$ = DCB$;

   7688  2 000611   200020 236100                    LDQ     DCB$,,AUTO
         2 000612   000000 470400 xsym               LDP0    B$JIT$
         2 000613   000232 756100                    STQ     154,,PR0

     1140     7689    1        GOTO CLEAN_UP;

   7689  2 000614   000521 710000 2                  TRA     CLEAN_UP

PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:207  
     1141     7690
     1142     7691        %EJECT;
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:208  
     1143     7692    1   OPEN_STAR: PROC ALTRET;

   7692  2 000615   200056 741300       OPEN_STAR    STX1  ! FPT_WRITE+12,,AUTO

     1144     7693
     1145     7694    2        B$JIT.DCB$ = B$M$STAR$;

   7694  2 000616   000000 236000 xsym               LDQ     B$M$STAR$
         2 000617   000000 470400 xsym               LDP0    B$JIT$
         2 000620   000232 756100                    STQ     154,,PR0

     1146     7695    2        B$M$STAR$->F$DCB.NAME.L = 2;

   7695  2 000621   000000 471400 xsym               LDP1    B$M$STAR$
         2 000622   002000 236003                    LDQ     1024,DU
         2 000623   100010 552140                    STBQ    8,'40'O,PR1

     1147     7696    2        B$M$STAR$->F$DCB.NAME.C = '*A';

   7696  2 000624   040100 100400                    MLR     fill='040'O
         2 000625   000044 000002 1                  ADSC9   FPT_WRITE_CONS+14        cn=0,n=2
         2 000626   100010 200037                    ADSC9   8,,PR1                   cn=1,n=31

     1148     7697    2        B$M$STAR$->F$DCB.ASN = %FILE#;

   7697  2 000627   001000 236007                    LDQ     512,DL
         2 000630   100032 552110                    STBQ    26,'10'O,PR1

     1149     7698    2        B$M$STAR$->F$DCB.FUN = %UPDATE#;

   7698  2 000631   000001 236003                    LDQ     1,DU
         2 000632   100032 552120                    STBQ    26,'20'O,PR1

     1150     7699    2        CALL FMM$DFLOPNP;

   7699  2 000633   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000634   000000 701000 xent               TSX1    FMM$DFLOPNP
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:209  
         2 000635   000000 011000                    NOP     0

     1151     7700    2        IF B$JIT.ERR ~= '0'B               /* Cant open *A */

   7700  2 000636   000000 470400 xsym               LDP0    B$JIT$
         2 000637   000012 235100                    LDA     10,,PR0
         2 000640   000643 600000 2                  TZE     s:7704

     1152     7701    3        THEN DO;

     1153     7702    3             ALTRETURN;

   7702  2 000641   200056 221300                    LDX1  ! FPT_WRITE+12,,AUTO
         2 000642   000000 702211                    TSX2  ! 0,X1

     1154     7703    3           END;
     1155     7704    2        LDEV_KEY.SZ = 5;

   7704  2 000643   005000 236003                    LDQ     2560,DU
         2 000644   200015 552140                    STBQ    LDEV_KEY,'40'O,AUTO

     1156     7705    2        LDEV_KEY.BLK = ' ';

   7705  2 000645   000040 236003                    LDQ     32,DU
         2 000646   200015 552120                    STBQ    LDEV_KEY,'20'O,AUTO

     1157     7706    2        LDEV_KEY.NAME = B$ROSEG$->B$ROSEG.LDEVNAME(INDX);

   7706  2 000647   200003 471500                    LDP1    @INDX,,AUTO
         2 000650   100000 720100                    LXL0    0,,PR1
         2 000651   000000 635010                    EAA     0,X0
         2 000652   000020 771000                    ARL     16
         2 000653   000000 473400 xsym               LDP3    B$ROSEG$
         2 000654   040100 100505                    MLR     fill='040'O
         2 000655   300054 000004                    ADSC9   44,A,PR3                 cn=0,n=4
         2 000656   200015 400004                    ADSC9   LDEV_KEY,,AUTO           cn=2,n=4

PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:210  
     1158     7707
     1159     7708    2        RETURN;

   7708  2 000657   200056 221300                    LDX1  ! FPT_WRITE+12,,AUTO
         2 000660   000001 702211                    TSX2  ! 1,X1

     1160     7709
     1161     7710    2   END OPEN_STAR;
     1162     7711
     1163     7712        %EJECT;
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:211  
     1164     7713    1   READ_CLDEV: PROC (BUF$) ALTRET;

   7713  2 000661   200056 741300       READ_CLDEV   STX1  ! FPT_WRITE+12,,AUTO

     1165     7714
     1166     7715    2   DCL BUF$ PTR;
     1167     7716
     1168     7717    2        FPT_READ = FPT_READ_CONS;

   7717  2 000662   000100 100400                    MLR     fill='000'O
         2 000663   000010 000070 1                  ADSC9   FPT_READ_CONS            cn=0,n=56
         2 000664   200024 000070                    ADSC9   FPT_READ,,AUTO           cn=0,n=56

     1169     7718    2        FPT_READ.V.DCB# = %M$STAR#;

   7718  2 000665   000001 220003                    LDX0    1,DU
         2 000666   200034 740100                    STX0    FPT_READ+8,,AUTO

     1170     7719    2        FPT_READ.V_ = VECTOR (FPT_READ.V);

   7719  2 000667   000020 235000 3                  LDA     16
         2 000670   200060 452500                    STP2    @BUF$+1,,AUTO
         2 000671   200060 236100                    LDQ     @BUF$+1,,AUTO
         2 000672   000034 036003                    ADLQ    28,DU
         2 000673   200024 757100                    STAQ    FPT_READ,,AUTO

     1171     7720    2        FPT_READ.KEY_ = VECTOR (LDEV_KEY);

   7720  2 000674   000015 235000 3                  LDA     13
         2 000675   200060 452500                    STP2    @BUF$+1,,AUTO
         2 000676   200060 236100                    LDQ     @BUF$+1,,AUTO
         2 000677   000015 036003                    ADLQ    13,DU
         2 000700   200026 757100                    STAQ    FPT_READ+2,,AUTO

     1172     7721    2        FPT_READ.BUF_ = VECTOR(BUFFER);

   7721  2 000701   000016 235000 3                  LDA     14
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:212  
         2 000702   200014 236100                    LDQ     BUF$,,AUTO
         2 000703   200030 757100                    STAQ    FPT_READ+4,,AUTO

     1173     7722    2        CALL M$MREAD (FPT_READ)

   7722  2 000704   200024 630500                    EPPR0   FPT_READ,,AUTO
         2 000705   200060 450500                    STP0    @BUF$+1,,AUTO
         2 000706   200060 630500                    EPPR0   @BUF$+1,,AUTO
         2 000707   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000710   000000 701000 xent               TSX1    M$MREAD
         2 000711   000713 702000 2                  TSX2    s:7724
         2 000712   000715 710000 2                  TRA     s:7727

     1174     7723    3        WHENALTRETURN DO;

     1175     7724    3             ALTRETURN;

   7724  2 000713   200056 221300                    LDX1  ! FPT_WRITE+12,,AUTO
         2 000714   000000 702211                    TSX2  ! 0,X1

     1176     7725    3           END;
     1177     7726
     1178     7727    2        RETURN;

   7727  2 000715   200056 221300                    LDX1  ! FPT_WRITE+12,,AUTO
         2 000716   000001 702211                    TSX2  ! 1,X1

(unnamed)
 Sect OctLoc
   1     000   125103 060061   000000 000000   001000 000000   120000 120000    UC01........P.P.
   1     004   377377 125377   377377 377377   377377 377377   377377 377377    ..U.............

FPT_READ_CONS
 Sect OctLoc
   1     010   000005 777640   000020 006000   000000 177640   000000 006014    ................
   1     014   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     020   000000 600000   000000 000000   000000 000000   000000 000000    ................
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:213  
   1     024   000000 000000   000000 000000                                    ........

FPT_WRITE_CONS
 Sect OctLoc
   1     026   000003 777640   000036 006000   000000 177640   000000 006014    ................
   1     032   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     036   000000 400400   000000 000000   000000 000000   000000 000000    ................

(unnamed)
 Sect OctLoc
   1     042   040040 040040   125103 040040   052101 040040                        UC  *A

(unnamed)
 Sect OctLoc
   3     000   777777 757777   777777 777740   000002 006000   177777 777777    ................
   3     004   000001 040000   000001 020000   000777 777000   000040 040000    .. ..........  .
   3     010   000022 600000   000000 006000   000000 006000   577777 777777    ................
   3     014   000003 777640   000001 377640   001777 777640   000007 006000    ................
   3     020   000005 777640                                                    ....
     1179     7728
     1180     7729    2   END READ_CLDEV;
     1181     7730
     1182     7731    1   END FSL$UC;
     1183     7732        /*      ME  is the all-purpose most reasonable place for input and
     1184     7733                   output.  Its name is intended to be derived from the
     1185     7734                   word "me"; i.e., the place that "I" am.
     1186     7735                   When you are a timesharing user, ME input comes from your
     1187     7736                   terminal unless you are XEQ'ing, in which case it comes
     1188     7737                   from the XEQ.  Timesharing user ME output is written to
     1189     7738                   your terminal.
     1190     7739                   Batch ME input comes from the command file that was
     1191     7740                   BATCHed to create the batch job, unless the job is doing
     1192     7741                   an XEQ, in which case it comes from the XEQ.  Batch ME
     1193     7742                   output is written to the line printer LP.
     1194     7743
     1195     7744                CR  is the input side of ME.  The name CR stands for
     1196     7745                   "Command Read".  It is just like ME, except you can't
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:214  
     1197     7746                   output to it.
     1198     7747
     1199     7748                LO  is the output side of ME.  The name LO stands for
     1200     7749                   "Listing Output".  It is just like ME, except you
     1201     7750                   can't read from it.
     1202     7751
     1203     7752                UC  is the interactive place.  The name UC stands for
     1204     7753                   "User Console".  When you are a timesharing user, UC
     1205     7754                   input always comes from your terminal and UC output
     1206     7755                   always is written to your terminal.  In batch there is
     1207     7756                   no place to interact, so UC input is an end-of-file and
     1208     7757                   UC output is thrown away.
     1209     7758
     1210     7759                LP  is the line printer.  The name LP stands for "Line
     1211     7760                   Printer".  Output to LP goes to the line printer; you
     1212     7761                   can't read from LP.
     1213     7762
     1214     7763                NO  is no place at all.  The name NO means the word "no".
     1215     7764                   NO input is an end-of-file; NO output is thrown away.
     1216     7765
     1217     7766                CP  is the card punch.  The name CP stands for "Card Punch".
     1218     7767                   Output to CP goes to the card punch; you can't read from
     1219     7768                   CP.
     1220     7769
     1221     7770                GR  is the graphics place.  The name GR stands for "GRaphics".
     1222     7771                   Output to GR goes to the graphics device; you can't read
     1223     7772                   from GR.
     1224     7773        */

PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:215  
--  Include file information  --

   KI_SUBS_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   FS$FIT.:E05TOU  is referenced.
      No diagnostics issued in procedure FSL$UC.
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:216  

 **** Variables and constants ****

  ****  Section 001 RoData FSL$UC

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    10-0-0/d STRC(504)   r     1 FPT_READ_CONS             26-0-0/d STRC(432)   r     1 FPT_WRITE_CONS

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    57-0-0/w PTR         r     1 @BUF$                      3-0-0/w PTR         r     1 @INDX
    14-0-0/w PTR         r     1 BUF$                      *0-0-0/w PTR         r     1 BUF$
    20-0-0/w PTR         r     1 DCB$                      24-0-0/d STRC(504)   r     1 FPT_READ
    42-0-0/d STRC(432)   r     1 FPT_WRITE                 22-0-0/w UBIN        r     1 FRMSTRM
    22-0-0/w STRC        r     1 FRMSTRM_BYTE              23-0-0/c CHAR(4)     r     1 FRMSTRM_TEXT
    *0-0-0/w UBIN        r     1 INDX                      17-0-0/w SBIN        r     1 J
    15-0-0/c STRC(54)    r     1 LDEV_KEY                  21-0-0/b BIT         r     1 ONLINE
     4-0-0/d STRC(288)   r     1 WINDOW

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$M$STAR$
     0-0-0/w PTR         r     1 B$M$UC$                    0-0-0/w PTR         r     1 B$PS0$
     0-0-0/w PTR         r     1 B$PS1$                     0-0-0/w PTR         r     1 B$PS2$
     0-0-0/w PTR         r     1 B$PS5$                     0-0-0/w PTR         r     1 B$ROSEG$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:217  

     0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w PTR         r     1 B$RODCB$(0:0)
     0-0-0/d STRC(3024)  r     1 B$ROSEG                    0-0-0/c CHAR(4096)  r     1 BUFFER
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/d STRC(216)   r     1 FPT$LDEV_V
     0-0-0/w STRC(144)   r     1 FS$DDF                     0-0-0/w STRC(180)   r     1 FS$DDFSZ
     0-0-0/w STRC(1485)  r     1 VLP$HDRF                   0-0-0/c ASTR(0)     r     1 VLP$HDRU
     0-0-0/w STRC(288)   r     1 VLP$TAB                    0-0-0/d STRC(288)   r     1 VLP$WINDOW


   Procedure FSL$UC requires 463 words for executable code.
   Procedure FSL$UC requires 52 words of local(AUTO) storage.

    No errors detected in file FSL$LDEV.:E05TSI    .
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:218  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:219  
          MINI XREF LISTING

B$JIT.DCB$
      6037**DCL      7580<<ASSIGN   7634<<ASSIGN   7670>>ASSIGN   7673<<ASSIGN   7682<<ASSIGN   7683>>ASSIGN
      7686<<ASSIGN   7688<<ASSIGN   7694<<ASSIGN
B$JIT.ERR
      5947**DCL      7568<<ASSIGN   7700>>IF
B$JIT.ERR.MID
      5948**DCL      5948--REDEF
B$JIT$
      7366**DCL      5942--IMP-PTR  7568>>ASSIGN   7580>>ASSIGN   7634>>ASSIGN   7670>>ASSIGN   7673>>ASSIGN
      7682>>ASSIGN   7683>>ASSIGN   7686>>ASSIGN   7688>>ASSIGN   7694>>ASSIGN   7700>>IF
B$M$STAR$
      7367**DCL      7580>>ASSIGN   7634>>ASSIGN   7686>>ASSIGN   7694>>ASSIGN   7695>>ASSIGN   7696>>ASSIGN
      7697>>ASSIGN   7698>>ASSIGN
B$M$UC$
      7368**DCL      7536>>IF       7546>>IF       7548>>IF       7679>>IF
B$PS0$
      7369**DCL      7210--IMP-PTR  7571>>IF       7571>>IF       7576>>CALL     7576>>CALL     7586>>IF
      7588>>CALLBLT  7591>>IF       7592>>ASSIGN   7593>>IF       7594>>ASSIGN   7595>>IF       7596>>ASSIGN
      7597>>IF       7598>>ASSIGN
B$PS1$
      7370**DCL      7599<>CALL     7601<>CALL     7604>>ASSIGN
B$PS2$
      7371**DCL      7610<>CALL     7612<>CALL     7615<>CALL     7616>>ASSIGN
B$PS5$
      7372**DCL      7278--IMP-PTR  7654>>ASSIGN
B$RODCB$
      6160**DCL      7546>>IF       7546>>IF       7548>>IF       7548>>IF       7548>>IF       7551>>ASSIGN
B$ROSEG.DCBPTR$
      6125**DCL      7546>>IF       7546>>IF       7548>>IF       7548>>IF       7548>>IF       7551>>ASSIGN
B$ROSEG.LDEVNAME
      6135**DCL      7578<<ASSIGN   7706>>ASSIGN
B$ROSEG.NUMDCBS
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:220  
      6127**DCL      7544>>ASSIGN
B$ROSEG.STREAMID
      6136**DCL      7577<<ASSIGN
B$ROSEG.STREAMID.FLG
      6137**DCL      7542>>IF       7558<<ASSIGN   7564>>IF       7574>>IF       7641>>IF       7660<<ASSIGN
B$ROSEG.STREAMID.UC_STR
      6143**DCL      7638<<ASSIGN
B$ROSEG.STREAMID.WINDOW
      6142**DCL      7656<<ASSIGN
B$ROSEG$
      7373**DCL      6124--IMP-PTR  6160--IMP-PTR  6162--IMP-PTR  7542>>IF       7544>>ASSIGN   7546>>IF
      7546>>IF       7548>>IF       7548>>IF       7548>>IF       7551>>ASSIGN   7558>>ASSIGN   7564>>IF
      7574>>IF       7577>>ASSIGN   7578>>ASSIGN   7638>>ASSIGN   7641>>IF       7656>>ASSIGN   7660>>ASSIGN
      7706>>ASSIGN
BUF$
      7351**DCL      7350--IMP-PTR  7534<>CALL     7535>>ASSIGN   7566<>CALL     7592>>ASSIGN   7594>>ASSIGN
      7596>>ASSIGN   7598>>ASSIGN   7603>>ASSIGN   7604>>ASSIGN   7607>>ASSIGN   7614>>ASSIGN   7616>>ASSIGN
      7620>>ASSIGN   7623>>ASSIGN   7629>>ASSIGN   7630>>ASSIGN   7663<>CALL     7676<>CALL     7677>>ASSIGN
      7684>>CALL     7721>>ASSIGN
BUF$ IN PROCEDURE READ_CLDEV
      7715**DCL      7713--PROC
BUFFER
      7350**DCL      7629--ASSIGN   7721--ASSIGN
CLEAN_UP
      7663**LABEL    7561--CALLALT  7582--GOTO     7646--CALLALT  7651--CALLALT  7655--CALLALT  7689--GOTO
DCB$
      7357**DCL      7670<<ASSIGN   7673>>ASSIGN   7679>>IF       7682>>ASSIGN   7688>>ASSIGN
F$DCB.ACTPOS
      6201**DCL      6201--REDEF
F$DCB.ARS
      6176**DCL      6176--REDEF
F$DCB.ASN
      6191**DCL      7697<<ASSIGN
F$DCB.ATTR
      6194**DCL      6195--REDEF
F$DCB.BORROW
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:221  
      6209**DCL      6209--REDEF    6209--REDEF    6209--REDEF
F$DCB.CFU$
      6210**DCL      7548>>IF
F$DCB.DCBNAME.L
      6223**DCL      6223--IMP-SIZ
F$DCB.EOMCHAR
      6180**DCL      6180--REDEF
F$DCB.FCD
      6189**DCL      7551<<ASSIGN
F$DCB.FLDID
      6204**DCL      6204--REDEF
F$DCB.FORM$
      6198**DCL      6198--REDEF
F$DCB.FSECT
      6214**DCL      6214--REDEF
F$DCB.FSN
      6191**DCL      6191--REDEF    6191--REDEF    6192--REDEF
F$DCB.FUN
      6190**DCL      7698<<ASSIGN
F$DCB.HEADER$
      6197**DCL      6197--REDEF
F$DCB.IASN
      6217**DCL      7548>>IF
F$DCB.IXTNSIZE
      6195**DCL      6195--REDEF
F$DCB.LASTSTA$
      6185**DCL      6185--REDEF
F$DCB.LVL
      6210**DCL      6210--REDEF
F$DCB.MEDIA
      6216**DCL      7536>>IF       7683<<ASSIGN
F$DCB.NAME.C
      6185**DCL      6185--REDEF    7696<<ASSIGN
F$DCB.NAME.L
      6185**DCL      7695<<ASSIGN
F$DCB.NOEOF
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:222  
      6206**DCL      6206--REDEF
F$DCB.NRECS
      6196**DCL      6196--REDEF
F$DCB.NRECX
      6215**DCL      6215--REDEF
F$DCB.OHDR
      6207**DCL      6207--REDEF
F$DCB.ORG
      6190**DCL      6190--REDEF
F$DCB.PRECNO
      6213**DCL      6213--REDEF
F$DCB.RCSZ
      6218**DCL      6218--REDEF
F$DCB.RES
      6186**DCL      6186--REDEF
F$DCB.SETX
      6198**DCL      6198--REDEF
F$DCB.STR
      6214**DCL      7548>>IF
F$DCB.TAB$
      6197**DCL      6198--REDEF
F$DCB.TDA
      6212**DCL      6212--REDEF
F$DCB.WSN
      6187**DCL      6187--REDEF
FMD$GBUF
      7377**DCL-ENT  7534--CALL     7676--CALL
FMD$RBUF
      7378**DCL-ENT  7663--CALL
FMM$DFLOPNP
      7384**DCL-ENT  7699--CALL
FMP$CLSJ
      7385**DCL-ENT  7581--CALL     7635--CALL     7687--CALL
FPT$LDEV_V.ATTR
      7212**DCL      7597>>IF       7598>>ASSIGN
FPT$LDEV_V.DVFC
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:223  
      7211**DCL      7593>>IF       7594>>ASSIGN
FPT$LDEV_V.FRMSTRM
      7212**DCL      7586>>IF       7588>>CALLBLT
FPT$LDEV_V.LINES
      7211**DCL      7591>>IF       7592>>ASSIGN
FPT$LDEV_V.LOGON
      7210**DCL      7571>>IF       7576<>CALL
FPT$LDEV_V.REMOVE
      7210**DCL      7571>>IF       7576<>CALL
FPT$LDEV_V.WIDTH
      7212**DCL      7595>>IF       7596>>ASSIGN
FPT_READ
      7447**DCL      7717<<ASSIGN   7722<>CALL
FPT_READ.BUF_
      7449**DCL      7721<<ASSIGN
FPT_READ.KEY_
      7447**DCL      7720<<ASSIGN
FPT_READ.STATION_
      7450**DCL      7451--REDEF
FPT_READ.V
      7451**DCL      7719--ASSIGN
FPT_READ.V.DCB#
      7451**DCL      7718<<ASSIGN
FPT_READ.V.DVBYTE.REREAD#
      7462**DCL      7462--REDEF
FPT_READ.V.INDX#
      7460**DCL      7460--REDEF
FPT_READ.V_
      7447**DCL      7719<<ASSIGN
FPT_READ_CONS
      7408**DCL      7717>>ASSIGN
FPT_READ_CONS.STATION_
      7411**DCL      7412--REDEF
FPT_READ_CONS.V
      7412**DCL      7408--DCLINIT
FPT_READ_CONS.V.DVBYTE.REREAD#
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:224  
      7423**DCL      7423--REDEF
FPT_READ_CONS.V.INDX#
      7421**DCL      7421--REDEF
FPT_WRITE
      7517**DCL      7625<<ASSIGN   7631<>CALL
FPT_WRITE.BUF_
      7517**DCL      7629<<ASSIGN
FPT_WRITE.BUF_.BOUND
      7517**DCL      7630<<ASSIGN
FPT_WRITE.KEY_
      7517**DCL      7627<<ASSIGN
FPT_WRITE.STATION_
      7519**DCL      7519--REDEF
FPT_WRITE.V
      7520**DCL      7626--ASSIGN
FPT_WRITE.V.DCB#
      7520**DCL      7628<<ASSIGN
FPT_WRITE.V.DVBYTE.VFC#
      7526**DCL      7526--REDEF
FPT_WRITE.V_
      7517**DCL      7626<<ASSIGN
FPT_WRITE_CONS
      7486**DCL      7625>>ASSIGN
FPT_WRITE_CONS.STATION_
      7488**DCL      7488--REDEF
FPT_WRITE_CONS.V
      7489**DCL      7486--DCLINIT
FPT_WRITE_CONS.V.DVBYTE.VFC#
      7495**DCL      7495--REDEF
FRMSTRM
      7359**DCL      7360--REDEF    7585<<ASSIGN   7643>>IF       7645<<ASSIGN   7646<>CALL     7649>>IF
      7651<>CALL
FRMSTRM_BYTE.STR
      7362**DCL      7589<>CALL
FRMSTRM_TEXT
      7363**DCL      7588<<CALLBLT  7589<>CALL
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:225  
FS$DDF
      7202**DCL      7623--ASSIGN
FS$DDFSZ
      7206**DCL      7535<<ASSIGN   7604--ASSIGN   7616--ASSIGN   7677<<ASSIGN
FS$DDFSZ.ATTR
      7207**DCL      7598<<ASSIGN
FS$DDFSZ.DVFC
      7207**DCL      7594<<ASSIGN
FS$DDFSZ.F.HDR
      7206**DCL      7614<<ASSIGN   7620<<ASSIGN
FS$DDFSZ.F.TAB
      7206**DCL      7603<<ASSIGN   7607<<ASSIGN
FS$DDFSZ.LINES
      7207**DCL      7592<<ASSIGN
FS$DDFSZ.SIZ
      7206**DCL      7623<<ASSIGN   7630>>ASSIGN
FS$DDFSZ.WIDTH
      7206**DCL      7596<<ASSIGN
FSB$GETDDF
      7376**DCL-ENT  7684--CALL
FSN$CONV_STR
      7161**DCL-ENT  7589--CALL
FS_WINDOW.FWINDOW#
      7234**DCL      7234--REDEF    7235--REDEF
HFF$DSIZ
      7381**DCL-ENT  7615--CALL
HFF$ERASE
      7380**DCL-ENT  7601--CALL     7612--CALL
HFF$NIL
      7379**DCL-ENT  7599--CALL     7610--CALL
HFF$NILERASE
      7383**DCL-ENT  7652--CALL
HFF$TRAPALT
      7382**DCL-ENT  7562--CALL
INDX
      7167**DCL        15--PROC     7542>>IF       7548>>IF       7557<>CALL     7558>>ASSIGN   7564>>IF
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:226  
      7571>>IF       7574>>IF       7576<>CALL     7577>>ASSIGN   7578>>ASSIGN   7638>>ASSIGN   7641>>IF
      7646<>CALL     7651<>CALL     7655<>CALL     7656>>ASSIGN   7660>>ASSIGN   7667--ENTRY    7706>>ASSIGN
J
      7356**DCL      7200--IMP-SIZ  7544<<ASSIGN   7545>>DOWHILE  7546>>IF       7546>>IF       7548>>IF
      7548>>IF       7548>>IF       7551>>ASSIGN   7552<<ASSIGN   7552>>ASSIGN   7615<>CALL     7616>>ASSIGN
KIA$CLSSTR
      7163**DCL-ENT  7557--CALL     7576--CALL
KIA$DCLSTR
      7160**DCL-ENT  7646--CALL
KIA$REDSTR
      7162**DCL-ENT  7651--CALL
KIA$WINDOW
      7164**DCL-ENT  7655--CALL
LDEV_KEY
      7352**DCL      7627--ASSIGN   7720--ASSIGN
LDEV_KEY.BLK
      7354**DCL      7705<<ASSIGN
LDEV_KEY.NAME
      7355**DCL      7706<<ASSIGN
LDEV_KEY.SZ
      7353**DCL      7704<<ASSIGN
M$MREAD
      7386**DCL-ENT  7722--CALL
M$MWRITE
      7387**DCL-ENT  7631--CALL
ONLINE
      7358**DCL      7538<<ASSIGN   7540<<ASSIGN   7555>>IF       7574>>IF       7639>>IF
OPEN_STAR
      7692**PROC     7561--CALL     7671--CALL
READ_CLDEV
      7713**PROC     7566--CALL     7678--CALL
TRAPALT
      7578**LABEL    7562--CALLALT
VLP$HDRF
      7195**DCL      7616<<ASSIGN   7623--ASSIGN
VLP$HDRU
PL6.E3A0      #003=FSL$UC File=FSL$LDEV.:E05TSI                                  TUE 07/29/97 17:34 Page:227  
      7200**DCL      7616>>ASSIGN
VLP$TAB
      7181**DCL      7604<<ASSIGN   7604>>ASSIGN   7616--ASSIGN   7623--ASSIGN
VLP$WINDOW
      7278**DCL      7654>>ASSIGN
VLP$WINDOW.FWINDOW#
      7278**DCL      7278--REDEF    7279--REDEF
WINDOW
      7322**DCL      7654<<ASSIGN   7655<>CALL
WINDOW.FWINDOW#
      7322**DCL      7322--REDEF    7323--REDEF
