VERSION A02

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:1    
        1        1        /*M* FTP Server command module */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* NTB, MCR=NO, PLM=3, CTI=6, IND=4, MCI=YES, SDI=6, DCI=4, ENU=0, ECU=0 , CCC */
        8        8        FTPCMD: PROC ALTRET;
        9        9        %INCLUDE CP_6;
       10       90        %INCLUDE CP_6_SUBS;
       11      630        %INCLUDE B$JIT;
       12      920    1   DCL B$JIT$ PTR SYMREF READONLY;
       13      921        %INCLUDE XU_MACRO_C;
       14     4027        %INCLUDE XUG_ENTRY;
       15     4058        %INCLUDE TCF_FTP_E;
       16     4113        %INCLUDE TCP_HEP_M;
       17     4168        %B$TCB (STCLASS="BASED(B$TCB$)");
       18     4171        %B$ALT;
       19     4179        %INCLUDE B_ERRORS_C;
       20     5306        %EQU TIMEOUT = 60;
       21     5307
       22     5308    1   DCL GET_COMMAND ENTRY(3) ALTRET;
       23     5309    1   DCL SET_USER_ID ENTRY(2) ALTRET;
       24     5310    1   DCL REPORT_TIME ENTRY(2);
       25     5311    1   DCL SEND_MSG ENTRY(2) ALTRET;
       26     5312    1   DCL NET$ADDR2IP ENTRY(2);
       27     5313    1   DCL NET$ADDR2NAME ENTRY(2) ALTRET;
       28     5314    1   DCL TCP$RELEASE ENTRY(1) ALTRET;
       29     5315
       30     5316        %XUG_GETCMD (NODES=FTP_NODES,
       31     5317                TREAD=NO,
       32     5318                READR=GET_COMMAND);
       33     5656
       34     5657        %XUG_INIT (COMMANDS=NO,
       35     5658                ECHO=ALWAYS_ECHO,
       36     5659                GOODCMD=NO);
       37     6072
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:2    
       38     6073        %PARSE$OUT (STCLASS="BASED(PARSE$)");
       39     6118        %PARSE$SYM (STCLASS=BASED);
       40     6156        %F$DCB;
       41     6213    1   DCL B$TCB$ PTR SYMREF;
       42     6214    1   DCL PARSE$ PTR;
       43     6215
       44     6216    1   DCL CODE UBIN(36);
       45     6217    1   DCL LOGGED_IN BIT(1) STATIC INIT('0'B);
       46     6218    1   DCL CMD_LCN SBIN(36) SYMREF;
       47     6219    1   DCL DATA_LCN SBIN(36) SYMREF;
       48     6220    1   DCL RUNNING BIT(1) SYMREF;
       49     6221    1   DCL FTP_NODES UBIN(36) SYMREF;
       50     6222        %TCP$SOCKET (NAME=CMD_FS, STCLASS="SYMREF");
       51     6230    1   DCL CMD_BUFFER CHAR(4096) SYMREF;
       52     6231    1   DCL LINE_BUF REDEF CMD_BUFFER CHAR(4096);
       53     6232    1   DCL DATA_BUFFER REDEF CMD_BUFFER CHAR(4096);
       54     6233        %TCP$SOCKET (NAME=CMD_LS, STCLASS="SYMREF");
       55     6241        %TCP$CB (NAME=CB, STCLASS=STATIC);
       56     6244        %TCP$ADMIN (STCLASS=BASED);
       57     6265    1   DCL M$LO DCB;
       58     6266    1   DCL GLOBAL_ERR UBIN(36) STATIC SYMDEF;
       59     6267    1   DCL 1 TFID ,
       60     6268    1             2 COUNT UBIN(9) CALIGNED,
       61     6269    1             2 TEXT CHAR(79);
       62     6270
       63     6271    1   DCL 1 TEXTC BASED,
       64     6272    1             2 COUNT UBIN(9) CALIGNED,
       65     6273    1             2 TEXT CHAR(TEXTC.COUNT);
       66     6274
       67     6275    1   DCL CHARN CHAR(CHARNLEN) BASED;
       68     6276    1   DCL CHARNLEN UBIN(36) STATIC;
       69     6277    1   DCL START_TIME UBIN(36) STATIC;
       70     6278    1   DCL BYTES UBIN(36) STATIC;
       71     6279    1   DCL TSTAMP UBIN(36) STATIC;
       72     6280        %FPT_TIME (SOURCE=CLOCK, TSTAMP=TSTAMP, DEST=TUN);
       73     6299        %FPT_WRITE (FPTN=WRITE_LO,
       74     6300                STCLASS=SYMREF);
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:3    
       75     6331        %FPT_YC (NOERR=YES);
       76     6348        %FPT_LDEV (STCLASS=CONSTANT, STREAMNAME='LP01', DELETE=YES);
       77     6373    1   DCL 1 SALUTATION SYMREF,
       78     6374    1             2 L UBIN BYTE CALIGNED,
       79     6375    1             2 T CHAR(SALUTATION.L);
       80     6376
       81     6377    1   DCL F$FILE DCB;
       82     6378    1   DCL F$FILE$ PTR STATIC;
       83     6379        /* Open items */
       84     6380        %FPT_OPEN (
       85     6381                ACS=SEQUEN,
       86     6382                ACCT=VLP_ACCT,
       87     6383                DCB=F$FILE,
       88     6384                DISP=NAMED,
       89     6385                SCRUB=YES,
       90     6386                RES='JF',
       91     6387                FUN=CREATE,
       92     6388                NAME=VLP_NAME,
       93     6389                PASS=VLP_PASS,
       94     6390                SN=VLP_SN,
       95     6391                WSN=VLP_WSN);
       96     6500        %VLP_ACCT;
       97     6513        %VLP_NAME;
       98     6540        %VLP_PASS;
       99     6553        %VLP_SN;
      100     6566        %VLP_WSN;
      101     6579
      102     6580        %FPT_FID (ACCT=VLP_ACCT,
      103     6581                ASN=FPT_OPEN.V.ASN#,
      104     6582                NAME=VLP_NAME,
      105     6583                PASS=VLP_PASS,
      106     6584                RES=FPT_OPEN.V.RES#,
      107     6585                SN=VLP_SN,
      108     6586                WSN=VLP_WSN);
      109     6609
      110     6610        %FPT_READ (DCB=F$FILE, BUF=DATA_BUFFER, FULL=YES);
      111     6649        %FPT_WRITE (DCB=F$FILE, BUF=PMD_CMD);
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:4    
      112     6680    1   DCL PMD_CMD CONSTANT CHAR(0)
      113     6681    1      INIT('!PMD DA,DC,DS,JI,TC;D XSL_ERRNO\J;D 0\REGS;PL;Q');
      114     6682        %FPT_CLOSE (DCB=F$FILE, DISP=SAVE, STCLASS=CONSTANT);
      115     6724        %FPT_CLOSE (DCB=F$FILE, FPTN=FPT_NSAVE, STCLASS=CONSTANT);
      116     6766
      117     6767    1   DCL FILE_TYPE UBIN(36) STATIC INIT(%FTP_OPT_ASCII);
      118     6768    1   DCL TYPE_NAME(0:2) CONSTANT CHAR(5) ALIGNED INIT('Ascii', 'Image', 'CP-6');
      119     6769
      120     6770    1   DCL PASV SBIN STATIC INIT(0);
      121     6771    1   DCL RNFR_PENDING BIT(36) STATIC INIT('0'B);
      122     6772        %TCP$SOCKET (NAME=DATA_FS, STCLASS=STATIC);
      123     6780        %TCP$SOCKET (NAME=DATA_LS, STCLASS=STATIC);
      124     6788
      125     6789        %MACRO MSG(NAME=0, TEXT=' ');
      126     6790        DCL 1 MSG_%CHARTEXT(TEXTCHAR(NAME)) CONSTANT,
      127     6791                  2 * UBIN BYTE UNAL INIT(LENGTHC(TEXT)),
      128     6792                  2 * CHAR(0) INIT(TEXT);
      129     6793        %MEND;
      130     6794
      131     6795
      132     6796        %MSG (NAME=150, TEXT='150 Opening data connection for ');
      133     6801        %MSG (NAME=200TYPE, TEXT='200 Type changed to ');
      134     6806        %MSG (NAME=200PORT, TEXT='200 PORT command accepted.');
      135     6811        %MSG (NAME=200SET, TEXT='200 Set command accepted.');
      136     6816        %MSG (NAME=230USER, TEXT='230 User login successful.');
      137     6821        %MSG (NAME=202, TEXT='202 No-op completed.');
      138     6826        %MSG (NAME=214,
      139     6827        TEXT="'214- CP-6 FTP recognizes these commands: (* = unimplemented).'");
      140     6832        %MSG (NAME=214_1,
      141     6833        TEXT='   ABOR*  ACCT*  ALLO   APPE   CDUP   CWD    DELE   HELP   LIST');
      142     6838        %MSG (NAME=214_2,
      143     6839        TEXT='   MODE*  MKD*   NLST   NOOP   PASS   PASV   PORT   PWD    QUIT');
      144     6844        %MSG (NAME=214_3,
      145     6845        TEXT='   REIN*  REST*  RETR   RMD*   RNFR   RNTO   SITE*  SMNT*  STAT*');
      146     6850        %MSG (NAME=214_4,
      147     6851        TEXT='   STOR   STOU*  STRU*  SYST*  TYPE   USER   !SET');
      148     6856        %MSG (NAME=214_E, TEXT="'214 Use RHELP (IBEX) for info about help.'");
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:5    
      149     6861        %MSG (NAME=221, TEXT='221 CP-6 FTP server disconnecting.');
      150     6866        %MSG (NAME=226, TEXT='226 Data Transfer completed.');
      151     6871        %MSG (NAME=227, TEXT='227 Entering Passive mode ');
      152     6876        %MSG (NAME=230, TEXT="'230 Guest userid accepted; access restrictions apply.'");
      153     6881        %MSG (NAME=250DEL, TEXT='250 Deleted file ');
      154     6886        %MSG (NAME=250RNTO, TEXT='250 Renamed to ');
      155     6891        %MSG (NAME=257, TEXT='257 Current directory is ');
      156     6896        %MSG (NAME=331, TEXT='331 Password required.');
      157     6901        %MSG (NAME=331GUEST, TEXT="'331 Guest login ok; send userid as password.'");
      158     6906        %MSG (NAME=350RNFR, TEXT='350 File ok - awaiting RNTO.');
      159     6911        %MSG (NAME=425, TEXT='425 Can''t open Data connection.');
      160     6916        %MSG (NAME=425E, TEXT='425 Can''t open Data connection: ');
      161     6921        %MSG (NAME=426, TEXT="'426 Connection closed; transfer aborted. '");
      162     6926        %MSG (NAME=500, TEXT='500 Syntax error - unrecognized command.');
      163     6931        %MSG (NAME=501, TEXT='501 Syntax error in parameters.');
      164     6936        %MSG (NAME=502, TEXT='502 Unimplemented command.');
      165     6941        %MSG (NAME=503, TEXT='503 Bad command sequence.');
      166     6946        %MSG (NAME=504, TEXT='504 Parameter not implememted.');
      167     6951        %MSG (NAME=530, TEXT='530 User not logged in.');
      168     6956        %MSG (NAME=530USER, TEXT='530 Access denied.');
      169     6961        %MSG (NAME=530LOGOUT,
      170     6962        TEXT="'530 User command not allowed; please close first.'");
      171     6967        %MSG (NAME=550, TEXT='550 Request rejected: ');
      172     6972        %MSG (NAME=550H, TEXT='550 Help message too big.');
      173     6977
      174     6978    1   DCL MSG_500$(0:4) PTR CONSTANT INIT( ADDR(MSG_500), ADDR(MSG_501),
      175     6979    1     ADDR(MSG_502), ADDR(MSG_503), ADDR(MSG_504));
      176     6980
      177     6981    1      GLOBAL_ERR = 0;
      178     6982    1      TCP_MON_ERR = '0'B;
      179     6983    2      CALL XUG$GETCMD (XUG_GETCMD) WHENALTRETURN DO;
      180     6984    2          IF TCP_MON_ERR THEN CALL REPORT_LIB;
      181     6985    2          RUNNING = '0'B;
      182     6986    2          RETURN;
      183     6987    2          END;
      184     6988
      185     6989    2      IF XUG_GETCMD.OUT$ = ADDR(NIL) THEN DO;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:6    
      186     6990    2          RUNNING = '0'B;
      187     6991    2          RETURN;
      188     6992    2          END;
      189     6993
      190     6994    1      PARSE$ = XUG_GETCMD.OUT$->OUT$BLK.SUBLK$(0);
      191     6995    1      CODE =  OUT$BLK.CODE;
      192     6996
      193     6997    2      IF OUT$BLK.NSUBLKS=1 AND OUT$BLK.SUBLK$(0) -> OUT$BLK.CODE > 499 THEN DO;
      194     6998    2          CALL SEND_MSG (MSG_500$(OUT$BLK.SUBLK$(0) -> OUT$BLK.CODE-500)->CHARN);
      195     6999    2          RETURN;
      196     7000    2          END;
      197     7001
      198     7002    1      IF NOT LOGGED_IN AND CODE~=%FTP_CMD_USER AND CODE~=%FTP_CMD_RHELP
      199     7003    2            AND CODE~=%FTP_CMD_CLOSE THEN DO;
      200     7004    2          CALL SEND_MSG (MSG_530);
      201     7005    2          RETURN;
      202     7006    2          END;
      203     7007
      204     7008    2      IF RNFR_PENDING THEN DO;
      205     7009    2          IF CODE=%FTP_CMD_RENAME THEN IF OUT$BLK.SUBLK$(0)->OUT$BLK.CODE>0
      206     7010    2              THEN EXIT;
      207     7011    2          CALL M$CLOSE (FPT_CLOSE);
      208     7012    2          CALL SEND_MSG (MSG_503);
      209     7013    2          END;
      210     7014
      211     7015    2      DO CASE (CODE);
      212     7016    2       CASE (%FTP_CMD_LIST);               /* List */
      213     7017    2          CALL LIST_CMD('L(A)  ');
      214     7018
      215     7019    2       CASE (%FTP_CMD_LS);                 /* Nlst */
      216     7020    2          CALL LIST_CMD('L(C=0)');
      217     7021
      218     7022    2       CASE (%FTP_CMD_RHELP);              /* Help */
      219     7023    2          IF NOT LOGGED_IN THEN B$JIT.PRIV.ACTIVE = %PR_JIT#;
      220     7024    2          CALL HELP_CMD;
      221     7025
      222     7026    2       CASE (%FTP_CMD_CONNECT);            /* Noop allo */
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:7    
      223     7027    2          CALL SEND_MSG (MSG_202);
      224     7028
      225     7029    2       CASE (%FTP_CMD_USER);               /* User */
      226     7030    3          CALL USER_CMD WHENRETURN DO;
      227     7031    4              CALL M$LDEV (FPT_LDEV) WHENALTRETURN DO; END;
      228     7032    3              WRITE_LO.BUF_ = VECTOR (SALUTATION.T);
      229     7033    3              CALL M$WRITE (WRITE_LO);
      230     7034    3              LOGGED_IN = '1'B;
      231     7035    3              CALL SEND_MSG (MSG_230USER);
      232     7036    3              END;
      233     7037
      234     7038    2       CASE (%FTP_CMD_CLOSE);              /* Quit */
      235     7039    2          IF NOT LOGGED_IN THEN CALL USER_CMD; /* log bad password if req'd */
      236     7040    2          CALL SEND_MSG (MSG_221);
      237     7041    2          CALL GET_CLOSE(CMD_LCN);
      238     7042    2          RUNNING = '0'B;
      239     7043    2          RETURN;
      240     7044
      241     7045    2       CASE (%FTP_CMD_RDIR);               /* Cwd cdup */
      242     7046    3          CALL DIR_CMD WHENRETURN DO;
      243     7047    3              GOTO PWD_CMD;
      244     7048    3              END;
      245     7049
      246     7050    2       CASE (%FTP_CMD_PWD);                /* Pwd */
      247     7051    2   PWD_CMD:;
      248     7052    2          IF B$JIT.FPSN = ' ' THEN CHARNLEN = 0;
      249     7053    3          ELSE DO;
      250     7054    3              SUBSTR( DATA_BUFFER, 0, 3) = 'DP#';
      251     7055    3              SUBSTR( DATA_BUFFER, 3, 6) = B$JIT.FPSN;
      252     7056    3              CALL INDEX( CHARNLEN, ' ', DATA_BUFFER);
      253     7057    3              END;
      254     7058    2          SUBSTR( DATA_BUFFER, CHARNLEN, 1) = '.';
      255     7059    2          SUBSTR( DATA_BUFFER, CHARNLEN+1, 9) = B$JIT.FACCN;
      256     7060    2          CALL INDEX (CHARNLEN, ' ', DATA_BUFFER);
      257     7061    2          CALL SEND_MSG(MSG_257, VECTOR(ADDR(DATA_BUFFER)->CHARN));
      258     7062
      259     7063    2       CASE (%FTP_CMD_DELETE);             /* Dele */
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:8    
      260     7064    2          CALL DELETE_CMD;
      261     7065
      262     7066    2       CASE (%FTP_CMD_RENAME);             /* Rnfr, rnto */
      263     7067    2          CALL RENAME_CMD;
      264     7068
      265     7069    2       CASE (%FTP_CMD_GET);                /* Stor, appe */
      266     7070    2          CALL GET_CMD(OUT$BLK.SUBLK$(0)->OUT$BLK.CODE,
      267     7071    2                OUT$BLK.SUBLK$(1)->OUT$SYM.TEXTC$);
      268     7072
      269     7073    2       CASE (%FTP_CMD_PUT);                /* Retr */
      270     7074    2          CALL PUT_CMD(OUT$BLK.SUBLK$(0)->OUT$SYM.TEXTC$);
      271     7075
      272     7076    2       CASE (%FTP_CMD_TYPE);               /* Type */
      273     7077    2          FILE_TYPE = OUT$BLK.SUBLK$(0)->OUT$SYM.CODE;
      274     7078    2          CALL SEND_MSG (MSG_200TYPE,
      275     7079    2                VECTOR(TYPE_NAME(FILE_TYPE-%FTP_OPT_ASCII)));
      276     7080
      277     7081    2       CASE (%FTP_SRVCMD_PORT);            /* Port */
      278     7082    2          IF PASV > 0 THEN CALL TCP$RELEASE (DATA_LCN);
      279     7083    2          CALL PARSE_PORT (DATA_FS, OUT$BLK.SUBLK$(0) -> OUT$SYM.TEXT);
      280     7084    2          PASV = -1;
      281     7085    2          CALL SEND_MSG (MSG_200PORT);
      282     7086
      283     7087    2       CASE (%FTP_SRVCMD_PASV);            /* Pasv */
      284     7088    2          IF PASV > 0 THEN CALL TCP$RELEASE (DATA_LCN);
      285     7089    2          PASV = 0;
      286     7090    2          CALL OPEN_PASV_PORT;
      287     7091
      288     7092    2       CASE (%FTP_SRVCMD_SET);
      289     7093    2          FPT_YC.CMD_ = VECTOR (OUT$BLK.SUBLK$(0) -> OUT$SYM.TEXT);
      290     7094    3          CALL M$YC (FPT_YC) WHENRETURN DO;
      291     7095    3              CALL SEND_MSG (MSG_200SET);
      292     7096    3              END; WHENALTRETURN DO;
      293     7097    3              IF B$TCB.ALT$->B$ALT.ERR.FCG~='3025'O THEN CALL REPORT_ALT;
      294     7098    3              ELSE CALL SEND_MSG (MSG_501);
      295     7099    3              END;
      296     7100
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:9    
      297     7101    2       CASE(ELSE);
      298     7102    2          CALL SEND_MSG (MSG_502);
      299     7103    2          END;                             /* Do case */
      300     7104
      301     7105        /*N* IF BATCH AND GLOBAL_ERR ~= 0 THEN ABORT */
      302     7106
      303     7107
      304     7108    1      RETURN;
      305     7109    1   FTPCMD_INIT: ENTRY ALTRET;
      306     7110    1      F$FILE$ = DCBADDR(DCBNUM(F$FILE));
      307     7111    2      CALL XUG$INIT (XUG_GETCMD, XUG_INIT) WHENALTRETURN DO;
      308     7112    2          CALL M$XXX;
      309     7113    2          END;
      310     7114    1      CALL M$OPEN (FPT_OPEN);    /* Write a pmd to jf to get a dump if we abort */
      311     7115    1      FPT_OPEN.V.INITZ.REASSIGN# = '1'B;
      312     7116    1      CALL M$WRITE (FPT_WRITE);
      313     7117    1      CALL M$CLOSE (FPT_CLOSE);
      314     7118    1      B$JIT.JUNK = B$JIT.JUNK & ~%JJ_EXONLY#; /* Make it possible, too. */
      315     7119    1      B$JIT.PRIV.ACTIVE.FMSEC = '1'B;
      316     7120    1      B$JIT.CLRES(2) = '1'B;
      317     7121        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:10   
      318     7122    1   USER_CMD: PROC ALTRET;
      319     7123        %INCLUDE XSL_CHAM_M;
      320     7148        %XSL_CHAM (NAME=AUTH);
      321     7164    2   DCL F$ANON DCB;
      322     7165        %M$DCB (DCBN=F$FTPUSERS, ASN=FILE, NAME='etc:ftpusers', ACCT=':SYS');
      323     7239           %FPT_READ
      324     7240                 (FPTN=READ_FTPUSERS, STCLASS=CONSTANT, DCB=F$FTPUSERS, BUF=CMD_BUFFER);
      325     7279        %FPT_CLOSE (FPTN=CLOSE_FTPUSERS, STCLASS=CONSTANT, DCB=F$FTPUSERS);
      326     7321
      327     7322    2   DCL I SBIN;
      328     7323
      329     7324    3      IF LOGGED_IN THEN DO;      /* Temp code until XSL$CHAM can do accounting */
      330     7325    3          CALL SEND_MSG (MSG_530LOGOUT);
      331     7326    3          ALTRETURN;
      332     7327    3          END;
      333     7328    2      IF LOGGED_IN THEN AUTH.FLAGS.DO_ACCOUNTING = '1'B;
      334     7329    2      LOGGED_IN = '0'B;
      335     7330
      336     7331    3      IF OUT$BLK.NSUBLKS = 0 OR OUT$BLK.SUBLK$(0) -> OUT$SYM.CODE = 0 THEN DO;
      337     7332    4          IF AUTH.RESPONSE = 1 THEN DO;
      338     7333    4              AUTH.FLAGS.BADPW = '1'B;
      339     7334    4              AUTH.FLAGS.CHECKPW = '1'B;
      340     7335    4              CALL SET_USER_ID (AUTH, CMD_BUFFER);
      341     7336    4              AUTH.FLAGS.BADPW = '0'B;
      342     7337    4              END;
      343     7338    3          IF CODE = %FTP_CMD_CLOSE THEN RETURN;
      344     7339    4          IF OUT$BLK.NSUBLKS = 0 THEN DO;  /* anonymous login */
      345     7340    4              AUTH.L = DCBADDR(DCBNUM(F$ANON))->F$DCB.NAME#.L+8;
      346     7341    4              AUTH.ACCN = DCBADDR(DCBNUM(F$ANON))->F$DCB.ACCT#;
      347     7342    4              AUTH.USER = DCBADDR(DCBNUM(F$ANON))->F$DCB.NAME#.C;
      348     7343    4              AUTH.FLAGS.CHECKPW = '0'B;
      349     7344    4              AUTH.FLAGS.STUFF_JIT = '0'B;
      350     7345    4              CALL SET_USER_ID (AUTH, CMD_BUFFER);
      351     7346    4              IF AUTH.RESPONSE > 0 THEN CALL SEND_MSG (MSG_530USER);
      352     7347    4              ELSE CALL SEND_MSG (MSG_331GUEST);
      353     7348    4              AUTH.FLAGS.STUFF_JIT = '1'B;
      354     7349    4              AUTH.RESPONSE = 1;      /* Make it look like a password is needed */
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:11   
      355     7350    4              ALTRETURN;
      356     7351    4              END;
      357     7352    3          AUTH.L = 9;
      358     7353    3          AUTH.USER = '*';
      359     7354    3          AUTH.FLAGS.SCRAMBLED = '0'B;
      360     7355    3          AUTH.ACCN = OUT$BLK.SUBLK$(0) -> OUT$SYM.TEXT;
      361     7356    4          IF OUT$BLK.NSUBLKS > 1 THEN DO;
      362     7357    4              AUTH.USER = OUT$BLK.SUBLK$(1) -> OUT$SYM.TEXT;
      363     7358    4              AUTH.L = OUT$BLK.SUBLK$(1) -> OUT$SYM.COUNT + 8;
      364     7359    4              END;
      365     7360    3          AUTH.PSWB = '0'B;
      366     7361    3          END;
      367     7362    3      ELSE DO;
      368     7363    4          IF AUTH.RESPONSE ~= 1 THEN DO;
      369     7364                                                /* Pass can't be first. */
      370     7365    4              CALL SEND_MSG (MSG_503);
      371     7366    4              ALTRETURN;
      372     7367    4              END;
      373     7368    4          IF NOT AUTH.FLAGS.CHECKPW THEN DO;
      374     7369        /* Got ident for anonymous login - login for real and echo the command */
      375     7370        /* unless nothing was supplied for a password */
      376     7371    4              IF OUT$BLK.SUBLK$(0) ->OUT$SYM.COUNT < 6 THEN AUTH.L = 1;
      377     7372    4              CALL SET_USER_ID (AUTH, CMD_BUFFER);
      378     7373    4              AUTH.FLAGS.CHECKPW = '1'B;
      379     7374    4              IF AUTH.RESPONSE > 0 THEN EXIT; /* do it again and report 530 */
      380     7375    5              CALL M$LDEV (FPT_LDEV) WHENALTRETURN DO; END;
      381     7376    4              WRITE_LO.BUF_ = VECTOR (SALUTATION.T);
      382     7377    4              CALL M$WRITE (WRITE_LO);
      383     7378    4              SUBSTR(CMD_BUFFER,0,17) = 'Guest login from ';
      384     7379    4              CALL NET$ADDR2IP (TFID, CMD_FS);
      385     7380    4              SUBSTR (CMD_BUFFER,17,15) = ADDR (TFID)-> TEXTC.TEXT;
      386     7381    4              WRITE_LO.BUF_ = VECTOR (SUBSTR (CMD_BUFFER,0,32));
      387     7382    5              CALL NET$ADDR2NAME (TFID, CMD_FS) WHENRETURN DO;
      388     7383    5                  CALL INSERT (CMD_BUFFER,32,,' (',ADDR (TFID)-> TEXTC.TEXT,')');
      389     7384    5                  WRITE_LO.BUF_.BOUND = 34+TFID.COUNT;
      390     7385    5                  END;
      391     7386    4              CALL M$WRITE (WRITE_LO);
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:12   
      392     7387    4              CALL XUG$ECHO (XUG_GETCMD);
      393     7388    4              LOGGED_IN = '1'B;
      394     7389    4              CALL SEND_MSG (MSG_230);
      395     7390    4              ALTRETURN;
      396     7391    4              END;
      397     7392    3          ELSE IF OUT$BLK.SUBLK$(0) -> OUT$SYM.CODE = 1
      398     7393    3                    AND OUT$BLK.SUBLK$(0) -> OUT$SYM.COUNT > 0 THEN
      399     7394    3                  AUTH.PASS = OUT$BLK.SUBLK$(0) -> OUT$SYM.TEXT;
      400     7395    4              ELSE IF OUT$BLK.SUBLK$(0) -> OUT$SYM.COUNT ~= 9 THEN DO;
      401     7396    4                      CALL SEND_MSG (MSG_501);
      402     7397    4                      ALTRETURN;
      403     7398    4                      END;
      404     7399    4                  ELSE DO I=0 TO 8;
      405     7400    4                      AUTH.PSWB(I) = ASCBIT( SUBSTR (OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT,I,
              7400                               1));
      406     7401    4                      AUTH.FLAGS.SCRAMBLED = '1'B;
      407     7402    4                      END;
      408     7403    3          END;
      409     7404
      410     7405    2      AUTH.RESPONSE = 0;
      411     7406    2      CALL SET_USER_ID (AUTH, CMD_BUFFER);
      412     7407    3      IF AUTH.RESPONSE < 1 THEN DO WHILE '1'B;
      413     7408    3          SUBSTR(CMD_BUFFER,0,8) = ' ';
      414     7409    3          CALL M$READ (READ_FTPUSERS) ALTRET (FTPUSERS_OK);
      415     7410    4          IF SUBSTR(CMD_BUFFER,0,8) = AUTH.ACCN THEN DO;
      416     7411    4              AUTH.RESPONSE = 2;
      417     7412    4              GOTO FTPUSERS_OK;            /* A misnomer in this case */
      418     7413    4              END;
      419     7414    3          END;
      420     7415    2   FTPUSERS_OK: CALL M$CLOSE (CLOSE_FTPUSERS);
      421     7416
      422     7417    2      IF AUTH.RESPONSE < 1 THEN RETURN;
      423     7418    2      IF AUTH.RESPONSE = 1 THEN CALL SEND_MSG (MSG_331);
      424     7419    2      ELSE CALL SEND_MSG (MSG_530USER);
      425     7420    2      ALTRETURN;
      426     7421
      427     7422    2   END USER_CMD;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:13   
      428     7423        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:14   
      429     7424    1   DIR_CMD: PROC ALTRET;
      430     7425
      431     7426        %FPT_SETFMA (STCLASS=CONSTANT, ACCT=VLP_ACCT, PSN=VLP_SN.SN#);
      432     7439
      433     7440    3      IF OUT$BLK.NSUBLKS>0 THEN DO;
      434     7441    3          FPT_FID.TEXTFID_ = VECTOR (OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT);
      435     7442    4          CALL M$FID (FPT_FID) WHENALTRETURN DO;
      436     7443    4              CALL REPORT_ALT;
      437     7444    4              ALTRETURN;
      438     7445    4              END;
      439     7446    3          END;
      440     7447    3      ELSE DO;
      441     7448    3          VLP_ACCT.ACCT# = B$JIT.ACCN;
      442     7449    3          VLP_SN.SN#(0) = ' ';
      443     7450    3          END;
      444     7451
      445     7452    3      CALL M$SETFMA (FPT_SETFMA) WHENALTRETURN DO;
      446     7453    3          CALL REPORT_ALT;
      447     7454    3          ALTRETURN;
      448     7455    3          END;
      449     7456    2      RETURN;
      450     7457    2   END DIR_CMD;
      451     7458        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:15   
      452     7459    1   LIST_CMD: PROC (CMDT) ALTRET;
      453     7460    2   DCL CMDT CHAR(6);
      454     7461        %FPT_LINK (STCLASS=CONSTANT, NAME=VLP_PCL, ACCT=VLP_SYS, CMD=CMD);
      455     7479    2   DCL 1 CMD STATIC, 2 L UBIN BYTE UNAL INIT(255), 2 BUF CHAR(255);
      456     7480        %VLP_NAME (FPTN=VLP_PCL, STCLASS=CONSTANT, NAME='PCL');
      457     7507        %VLP_ACCT (FPTN=VLP_SYS, STCLASS=CONSTANT, ACCT=':SYS');
      458     7520        %VLP_NAME (FPTN=VLP_STARL, STCLASS=CONSTANT, NAME='*L');
      459     7547    2   DCL M$DO DCB;
      460     7548        %FPT_YC (FPTN=SETDO, STCLASS=CONSTANT, CMD=SETDOCMD);
      461     7565    2   DCL SETDOCMD CONSTANT CHAR(0) INIT('SET M$DO *DO,EXI=O');
      462     7566        %FPT_OPEN (FPTN=DELDO, STCLASS=CONSTANT, DCB=M$DO, SCRUB=YES, REASSIGN=YES,
      463     7567                   FUN=UPDATE, DELETE=YES);
      464     7676        %FPT_CLOSE (FPTN=CLSDO, STCLASS=CONSTANT, DCB=M$DO, DISP=SAVE);
      465     7718        %FPT_READ (FPTN=READDO, STCLASS=CONSTANT, DCB=M$DO, BUF=LINE_BUF);
      466     7757
      467     7758    2      CMD.BUF = CMDT;
      468     7759    2      FPT_FID.TEXTFID_ = VECTOR (B$JIT.FACCN);
      469     7760    3      IF OUT$BLK.NSUBLKS>0 THEN DO;
      470     7761    3          SUBSTR( CMD.BUF, 7) = OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT;
      471     7762    3          FPT_FID.TEXTFID_ = VECTOR (OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT);
      472     7763    3          END;
      473     7764    2      SUBSTR( CMD.BUF, 240) = 'OVER *L';
      474     7765    2      IF SUBSTR( CMD.BUF, 3, 1) = '=' THEN SUBSTR( CMD.BUF, 247) = '(NSUM)';
      475     7766
      476     7767    2      IF NOT DCBADDR (DCBNUM (M$DO)) -> F$DCB.AMR#
      477     7768    3      THEN CALL M$YC (SETDO) WHENALTRETURN DO; END;
      478     7769    2      CALL M$CLOSE (CLSDO);
      479     7770    3      CALL M$OPEN (DELDO) WHENALTRETURN DO; END;
      480     7771
      481     7772    3      CALL M$LINK (FPT_LINK) WHENALTRETURN DO;
      482     7773    3          CALL M$REW (READDO);
      483     7774    4          CALL M$READ (READDO) WHENRETURN DO;
      484     7775    4              CHARNLEN = DCBADDR(DCBNUM(M$DO)) -> F$DCB.ARS#;
      485     7776    4              CALL SEND_MSG (MSG_550, VECTOR(ADDR(LINE_BUF)->CHARN));
      486     7777    4              END;
      487     7778    4          WHENALTRETURN DO;
      488     7779    4              CALL SEND_MSG (MSG_501);
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:16   
      489     7780    4              END;
      490     7781    3   RETALT: ALTRETURN;
      491     7782    3          END;
      492     7783
      493     7784    2      VLP_NAME = VLP_STARL;
      494     7785    2      FPT_OPEN.V.ASN# = %FILE#;
      495     7786    2      CALL PUT_STARL ALTRET (RETALT);
      496     7787
      497     7788    2      RETURN;
      498     7789    2   END LIST_CMD;
      499     7790        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:17   
      500     7791    1   RENAME_CMD: PROC;
      501     7792
      502     7793        %FPT_CLOSE (FPTN=RENAME, STCLASS=CONSTANT, DCB=F$FILE, CHGATT=YES,
      503     7794                    NAME=VLP_NAME, PASS=VLP_PASS);
      504     7836
      505     7837    2      FPT_FID.TEXTFID_ = VECTOR( OUT$BLK.SUBLK$(0) -> OUT$SYM.TEXT);
      506     7838    3      CALL M$FID (FPT_FID) WHENALTRETURN DO;
      507     7839    3   BADFID: ;
      508     7840    3          CALL SEND_MSG(MSG_501);
      509     7841    3          GOTO NORNFR_PENDING;
      510     7842    3          END;
      511     7843
      512     7844    2      IF FPT_OPEN.V.ASN# ~= %FILE# THEN GOTO BADFID;
      513     7845    2      FPT_OPEN.V.FUN# = %UPDATE#;
      514     7846    3      IF OUT$BLK.SUBLK$(0) -> OUT$SYM.CODE = 0 THEN DO;
      515     7847    4          CALL M$OPEN (FPT_OPEN) WHENALTRETURN DO;
      516     7848    4   REPALT:    CALL REPORT_ALT;
      517     7849    4              GOTO NORNFR_PENDING;
      518     7850    4              END;
      519     7851    3          CALL SEND_MSG (MSG_350RNFR);
      520     7852    3          RNFR_PENDING = '1'B;
      521     7853    3          RETURN;
      522     7854    3          END;
      523     7855    2      ELSE IF NOT RNFR_PENDING THEN CALL SEND_MSG (MSG_503);
      524     7856    3          ELSE DO;
      525     7857    3              IF VLP_ACCT.ACCT# ~= ' ' OR VLP_SN.SN#(0) ~= ' ' OR VLP_WSN.WSN# ~= ' '
      526     7858    3              THEN GOTO BADFID;
      527     7859
      528     7860    3              CALL M$CLOSE (RENAME) ALTRET (REPALT);
      529     7861    3              CALL SEND_MSG (MSG_250RNTO, FPT_FID.TEXTFID_);
      530     7862    3              END;
      531     7863
      532     7864    2   NORNFR_PENDING:;
      533     7865    2      CALL M$CLOSE (FPT_CLOSE);
      534     7866    2      RNFR_PENDING = '0'B;
      535     7867    2      RETURN;
      536     7868
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:18   
      537     7869    2   END RENAME_CMD;
      538     7870        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:19   
      539     7871    1   DELETE_CMD: PROC ALTRET;
      540     7872
      541     7873    2      FPT_FID.TEXTFID_ = VECTOR (OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT);
      542     7874    3      CALL M$FID (FPT_FID) WHENALTRETURN DO;
      543     7875    3   REPALT:;
      544     7876    3          FPT_OPEN.V.DELETE# = '0'B;
      545     7877    3          CALL REPORT_ALT;
      546     7878    3          ALTRETURN;
      547     7879    3          END;
      548     7880    2      FPT_OPEN.V.DELETE# = '1'B;
      549     7881    2      FPT_OPEN.V.FUN# = %UPDATE#;
      550     7882    2      CALL M$OPEN (FPT_OPEN) ALTRET (REPALT);
      551     7883    2      FPT_OPEN.V.DELETE# = '0'B;
      552     7884    2      CALL SEND_MSG (MSG_250DEL, FPT_FID.TEXTFID_);
      553     7885
      554     7886    2      RETURN;
      555     7887    2   END DELETE_CMD;
      556     7888        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:20   
      557     7889    1   HELP_CMD: PROC;
      558     7890        %FPT_HELP (BUF=LINE_BUF, KEY1=KEY1, KEY2=KEY2, RESULTS=VLR_HELP,
      559     7891                   PROCPSN=P.PSN, PROCNAME=P.NAME, PROCACCT=P.ACCT, PROCPASS=P.PASS);
      560     7912    2   DCL KEY1(0:35) UBIN BYTE UNAL STATIC INIT(0);
      561     7913    2   DCL KEY2(0:35) UBIN BYTE UNAL STATIC INIT(0);
      562     7914        %VLR_HELP;
      563     7943    2   DCL MSG0 CONSTANT CHAR(8) INIT(%CONCAT(BINASC(3),'214'));
      564     7944    2   DCL DASH CONSTANT CHAR(1) INIT('-');
      565     7945    2   DCL MSGI CONSTANT CHAR(8) INIT(BINASC(1));
      566     7946        %EQU BACK4=CONCAT(BINASC(8),BINASC(8),BINASC(8),BINASC(8));
      567     7947    2   DCL MSGN CONSTANT CHAR(12) INIT(%CONCAT(BINASC(9),'214 ',BACK4,' '));
      568     7948    2   DCL 1 P STATIC, 2 NAME(0:31) CHAR(1) INIT(BINASC(4),'F','T','P','D',' '*0),
      569     7949    2             2 PSN CHAR(6) INIT(' '),
      570     7950    2             2 ACCT CHAR(8) INIT(' '),
      571     7951    2             2 PASS CHAR(8) INIT(' ');
      572     7952    2   DCL PCH REDEF P CHAR(54);
      573     7953    2   DCL SUBLK$ PTR;
      574     7954        %PARSE$OUT (NAME=SUB$BLK, STCLASS="BASED(SUBLK$)");
      575     7999    2   DCL 1 TEXTC BASED ALIGNED,2 L UBIN BYTE UNAL,2 T CHAR(TEXTC.L);
      576     8000    2   DCL I SBIN;
      577     8001
      578     8002    3      IF OUT$BLK.NSUBLKS=0 THEN DO;
      579     8003    3          CALL SEND_MSG (MSG_214);
      580     8004    3          RETURN;
      581     8005    3          END;
      582     8006
      583     8007    2      FPT_HELP.V.ALL# = '0'B;
      584     8008    2      FPT_HELP.V.LIST# = '0'B;
      585     8009    2      FPT_HELP.V.MORE# = '0'B;
      586     8010    2      FPT_HELP.V.RANGE# = '0'B;
      587     8011    2      IF OUT$BLK.NSUBLKS=1 AND OUT$BLK.SUBLK$(0) -> OUT$SYM.CODE = 1
      588     8012    2            AND (OUT$BLK.SUBLK$(0) -> OUT$SYM.TEXT = '?'
      589     8013    3            OR OUT$BLK.SUBLK$(0) -> OUT$SYM.TEXT = '??') THEN DO;
      590     8014    3          IF OUT$BLK.SUBLK$(0) -> OUT$SYM.COUNT = 2 THEN FPT_HELP.V.ALL# = '1'B;
      591     8015    3          ELSE IF VLR_HELP.NOMSG THEN FPT_HELP.V.LIST# = '1'B;
      592     8016    3              ELSE FPT_HELP.V.MORE# = '1'B;
      593     8017    3          GOTO DO_M$HELP;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:21   
      594     8018    3          END;
      595     8019    2      KEY1(0) = 0;
      596     8020    2      KEY2(0) = 0;
      597     8021    3      DO I=0 TO OUT$BLK.NSUBLKS-1;
      598     8022    3          SUBLK$ = OUT$BLK.SUBLK$(I);
      599     8023    4          IF SUB$BLK.CODE < 1 THEN DO;
      600     8024    4              IF SUB$BLK.NSUBLKS = 0
      601     8025    4              THEN FPT_HELP.V.LIST# = '1'B; /* No subblocks is topcs */
      602     8026    5              ELSE DO;
      603     8027    5                  PCH = BINASC(1);
      604     8028    6                  IF SUB$BLK.SUBLK$(0) -> OUT$SYM.CODE > 0 THEN DO;
      605     8029    6                      P.PSN = SUB$BLK.SUBLK$(0) -> OUT$SYM.TEXT;
      606     8030    6                      SUBLK$ = SUB$BLK.SUBLK$(1);
      607     8031    6                      END;
      608     8032    5                  IF SUB$BLK.SUBLK$(0) -> OUT$SYM.TEXT = '?'
      609     8033    5                  THEN FPT_HELP.V.LIST# = '1'B;
      610     8034    5                  ELSE P.NAME = ADDR(SUB$BLK.SUBLK$(0) -> OUT$SYM.COUNT) -> TEXTC;
      611     8035    5                  IF SUB$BLK.NSUBLKS = 1 THEN EXIT;
      612     8036    5                  P.ACCT = SUB$BLK.SUBLK$(1) -> OUT$SYM.TEXT;
      613     8037    5                  IF SUB$BLK.NSUBLKS = 2 THEN EXIT;
      614     8038    5                  P.PASS = SUB$BLK.SUBLK$(2) -> OUT$SYM.TEXT;
      615     8039    5                  END;
      616     8040    4              END;
      617     8041    3          ELSE IF SUB$BLK.CODE = 1         /* KEY1 */
      618     8042    3              THEN KEY1 = ADDR(SUBLK$ -> OUT$SYM.COUNT) -> TEXTC;
      619     8043    3              ELSE KEY2 = ADDR(SUBLK$ -> OUT$SYM.COUNT) -> TEXTC;
      620     8044    3          END;
      621     8045
      622     8046    2   DO_M$HELP: ;
      623     8047    3      CALL M$HELP (FPT_HELP) WHENALTRETURN DO;
      624     8048    3          CALL REPORT_ALT;
      625     8049    3          RETURN;
      626     8050    3          END;
      627     8051    3      IF NOT VLR_HELP.MSGCOMP THEN DO;
      628     8052    3          CALL SEND_MSG (MSG_550H);
      629     8053    3          RETURN;
      630     8054    3          END;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:22   
      631     8055
      632     8056    3      IF VLR_HELP.RECCNT = 0 THEN DO;
      633     8057    3          SUBSTR(LINE_BUF,0,80) = ' No message available.';
      634     8058    3          VLR_HELP.RECCNT = 1;
      635     8059    3          END;
      636     8060
      637     8061    2      IF VLR_HELP.RECCNT > 1 THEN CALL SEND_MSG (MSG0, VECTOR(DASH));
      638     8062    2      SUBLK$ = ADDR(LINE_BUF);
      639     8063    3      DO WHILE '1'B;
      640     8064    3          CHARNLEN = 80;
      641     8065    4          DO UNTIL CHARNLEN = 1;
      642     8066    4              CHARNLEN = CHARNLEN-1;
      643     8067    4              IF SUBSTR (SUBLK$ -> CHARN, CHARNLEN-1, 1) ~= ' ' THEN EXIT;
      644     8068    4              END;
      645     8069    3          VLR_HELP.RECCNT = VLR_HELP.RECCNT - 1;
      646     8070    3          IF VLR_HELP.RECCNT = 0 THEN EXIT;
      647     8071    3          CALL SEND_MSG (MSGI, VECTOR (SUBLK$ -> CHARN));
      648     8072    3          SUBLK$ = PINCRC (SUBLK$, 79);
      649     8073    3          END;
      650     8074    2      CALL SEND_MSG (MSGN, VECTOR (SUBLK$ -> CHARN));
      651     8075    2      RETURN;
      652     8076
      653     8077    2   END HELP_CMD;
      654     8078        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:23   
      655     8079    1   GET_CMD: PROC (ONOVER,LFID$) ALTRET;
      656     8080    2   DCL ONOVER UBIN HALF HALIGNED;
      657     8081    2   DCL LFID$ PTR;
      658     8082    2   DCL TCP$READ ENTRY(3) ALTRET;
      659     8083    2   DCL GET_LINE ENTRY(4) ALTRET;
      660     8084    2   DCL OK BIT(1) STATIC;
      661     8085    2   DCL ARS UBIN(36) STATIC;
      662     8086    2   DCL CURSIZ SBIN;
      663     8087
      664     8088        /* First, validate local fid */
      665     8089
      666     8090    2      FPT_FID.TEXTFID_ = VECTOR(LFID$->TEXTC.TEXT);
      667     8091    3      CALL M$FID(FPT_FID) WHENALTRETURN DO;
      668     8092    3   RETALT: CALL REPORT_ALT;
      669     8093    3          GLOBAL_ERR = %FTP_COMMAND_ERR;
      670     8094    3          IF PASV>0 THEN CALL TCP$RELEASE (DATA_LCN);
      671     8095    3          PASV = 0;
      672     8096    3          ALTRETURN;
      673     8097    3          END;
      674     8098
      675     8099    2      IF ONOVER = %FTP_OPT_ON
      676     8100    3      THEN DO;
      677     8101    3          FPT_OPEN.V.FUN# = %CREATE#;
      678     8102    3          FPT_OPEN.V.EXIST# = %ERROR#;
      679     8103    3          END;
      680     8104    2      ELSE IF ONOVER = %FTP_OPT_OVER
      681     8105    3          THEN DO;
      682     8106    3              FPT_OPEN.V.FUN# = %CREATE#;
      683     8107    3              FPT_OPEN.V.EXIST# = %NEWFILE#;
      684     8108    3              END;
      685     8109    2          ELSE IF ONOVER = %FTP_OPT_INTO
      686     8110    3              THEN DO;
      687     8111    3                  FPT_OPEN.V.FUN# = %CREATE#;
      688     8112    3                  FPT_OPEN.V.EXIST# = %OLDFILE#;
      689     8113    3                  END;
      690     8114    2              ELSE CALL M$XXX;             /* Internal error */
      691     8115
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:24   
      692     8116    2      CALL M$OPEN (FPT_OPEN) ALTRET (RETALT);
      693     8117
      694     8118    2      CALL SEND_MSG (MSG_150, FPT_FID.TEXTFID_);
      695     8119
      696     8120    2      ARS = F$FILE$->F$DCB.RECL#;
      697     8121    2      CHARNLEN = 0;
      698     8122    2      CURSIZ = 0;
      699     8123
      700     8124    3      CALL OPEN_DATA_PORT WHENALTRETURN DO;
      701     8125    3   PROCERR: ;
      702     8126    3          GLOBAL_ERR = %FTP_PROCEDURE_ERR;          /*N* REPORT ERROR */
      703     8127    3          CALL M$CLOSE (FPT_NSAVE);
      704     8128    3          ALTRETURN;
      705     8129    3          END;
      706     8130                                                /* Read file until it closes */
      707     8131    2      BYTES=0;
      708     8132                                                /* First, get open */
      709     8133    2      CALL GET_OPEN(DATA_LCN,%TIMEOUT) ALTRET (PROCERR);
      710     8134
      711     8135    2      CALL M$TIME (FPT_TIME);
      712     8136    2      START_TIME=TSTAMP;
      713     8137    2      OK='1'B;
      714     8138    3      DO WHILE OK;
      715     8139    3          IF FILE_TYPE = %FTP_OPT_ASCII
      716     8140    4          THEN DO;
      717     8141    4              FPT_WRITE.BUF_.BUF$ = ADDR(LINE_BUF);
      718     8142    4              CALL GET_LINE(DATA_LCN, VECTOR(LINE_BUF), ARS)
      719     8143    5              WHENRETURN DO;
      720     8144    5                  BYTES = BYTES + ARS-1;
      721     8145                                                /* write it */
      722     8146    5                  CHARNLEN=ARS-2;          /* Don't include crlf*/
      723     8147    5                  FPT_WRITE.V.DVBYTE.CONT# = '0'B;
      724     8148    5                  IF CHARNLEN>=SIZEV(LINE_BUF)
      725     8149    6                  THEN DO;
      726     8150    6                      BYTES = BYTES-1;
      727     8151    6                      FPT_WRITE.V.DVBYTE.CONT# = '1'B;
      728     8152    6                      END;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:25   
      729     8153    5                  ELSE IF CHARNLEN<=0
      730     8154    6                      THEN DO;
      731     8155    6                          CHARNLEN=1;
      732     8156    6                          FPT_WRITE.BUF_.BUF$ = ADDR(NIL);
      733     8157    6                          END;
      734     8158    5                  END;
      735     8159    5              WHENALTRETURN DO;
      736     8160    5                  OK='0'B;
      737     8161    5                  END;
      738     8162    4              END;
      739     8163    4          ELSE DO;                         /* Mode is image */
      740     8164    5              IF CHARNLEN=0 OR CHARNLEN=CB.ARS THEN DO;
      741     8165    5                  FPT_WRITE.BUF_.BUF$ = ADDR(LINE_BUF);
      742     8166    6                  CALL TCP$READ (DATA_LCN,VECTOR(LINE_BUF),CB) WHENALTRETURN DO;
      743     8167    6                      CALL TCP$RELEASE (DATA_LCN);
      744     8168    6                      CALL SEND_MSG (MSG_426);
      745     8169    6                      GOTO PROCERR;
      746     8170    6                      END;
      747     8171    5                  IF CB.ADMIN
      748     8172    6                  THEN DO;
      749     8173    6                      OK = '0'B;
      750     8174    6                      END;
      751     8175    6                  ELSE DO;
      752     8176    6                      BYTES = BYTES+CB.ARS;
      753     8177    6                      CHARNLEN=CB.ARS;
      754     8178    6                      END;
      755     8179    5                  END; ELSE DO;
      756     8180    5                  CB.ARS = CB.ARS-CHARNLEN;
      757     8181    5                  FPT_WRITE.BUF_.BUF$ = PINCRC(FPT_WRITE.BUF_.BUF$,CHARNLEN);
      758     8182    5                  CHARNLEN = CB.ARS;
      759     8183    5                  END;
      760     8184    5              IF ARS>0 THEN DO;  /* Recl was specified, make'em all the same */
      761     8185    5                  FPT_WRITE.V.DVBYTE.CONT# = '1'B;
      762     8186    6                  IF CHARNLEN>=ARS-CURSIZ THEN DO;
      763     8187    6                      CHARNLEN = ARS-CURSIZ;
      764     8188    6                      CURSIZ = -CHARNLEN;
      765     8189    6                      FPT_WRITE.V.DVBYTE.CONT# = '0'B;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:26   
      766     8190    6                      END;
      767     8191    5                  CURSIZ = CURSIZ+CHARNLEN;
      768     8192    5                  END;
      769     8193
      770     8194    4              END;
      771     8195
      772     8196    3          IF (OK)
      773     8197    4          THEN DO;
      774     8198    4              FPT_WRITE.BUF_.BOUND = CHARNLEN-1;
      775     8199    5              CALL M$WRITE (FPT_WRITE) WHENALTRETURN DO;
      776     8200    5                  CALL REPORT_ALT;
      777     8201    5                  CALL TCP$RELEASE(DATA_LCN);
      778     8202    5                  GOTO PROCERR;
      779     8203    5                  END;
      780     8204    4              END;
      781     8205    3          END;
      782     8206    2      CALL M$TIME (FPT_TIME);
      783     8207    2      START_TIME = TSTAMP-START_TIME;
      784     8208    2      CALL GET_CLOSE(DATA_LCN,%TIMEOUT);
      785     8209    2      CALL SEND_MSG (MSG_226);
      786     8210    2      CALL REPORT_TIME(BYTES, START_TIME);
      787     8211    2      CALL M$CLOSE (FPT_CLOSE);
      788     8212
      789     8213    2      RETURN;
      790     8214    2   END GET_CMD;
      791     8215        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:27   
      792     8216    1   PUT_CMD: PROC (LFID$) ALTRET;
      793     8217    2   DCL LFID$ PTR;
      794     8218    2   DCL CRLF CHAR(2) SYMREF;
      795     8219    2   DCL TCP$WRITE ENTRY(4) ALTRET;
      796     8220    2   DCL OK BIT(1) STATIC;
      797     8221
      798     8222        /* First, validate local fid */
      799     8223
      800     8224    2      FPT_FID.TEXTFID_ = VECTOR(LFID$->TEXTC.TEXT);
      801     8225    3      CALL M$FID(FPT_FID) WHENALTRETURN DO;
      802     8226    3   REPALT: ;
      803     8227    3          CALL REPORT_ALT;
      804     8228    3          GLOBAL_ERR = %FTP_COMMAND_ERR;
      805     8229    3          IF PASV > 0 THEN CALL TCP$RELEASE (DATA_LCN);
      806     8230    3          PASV = 0;
      807     8231    3          ALTRETURN;
      808     8232    3          END;
      809     8233
      810     8234    2   PUT_STARL: ENTRY ALTRET;
      811     8235    2      FPT_OPEN.V.FUN# = %IN#;
      812     8236    2      CALL M$OPEN (FPT_OPEN) ALTRET (REPALT);
      813     8237
      814     8238    2      CALL SEND_MSG (MSG_150, FPT_FID.TEXTFID_);
      815     8239    3      CALL OPEN_DATA_PORT WHENALTRETURN DO;
      816     8240    3   PORTALT: ;
      817     8241    3          GLOBAL_ERR = %FTP_PROCEDURE_ERR;          /*N* REPORT ERROR */
      818     8242    3          CALL M$CLOSE (FPT_CLOSE);
      819     8243    3          ALTRETURN;
      820     8244    3          END;
      821     8245
      822     8246                                                /* Write file until it closes */
      823     8247    2      BYTES=0;
      824     8248                                                /* First, get open */
      825     8249    2      CALL GET_OPEN(DATA_LCN,%TIMEOUT) ALTRET (PORTALT);
      826     8250    2      CALL M$TIME (FPT_TIME);
      827     8251    2      START_TIME=TSTAMP;
      828     8252    2      OK='1'B;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:28   
      829     8253    3      DO WHILE OK;
      830     8254    3          CALL M$READ (FPT_READ)
      831     8255    4          WHENRETURN DO;
      832     8256    4              OK='1'B;
      833     8257    4              FPT_READ.V.DVBYTE.CONT#='0'B;
      834     8258    4              END;
      835     8259    4          WHENALTRETURN DO;
      836     8260    4              IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.ERR# = %E$LD
      837     8261    5              THEN DO;
      838     8262    5                  FPT_READ.V.DVBYTE.CONT#='1'B;
      839     8263    5                  END;
      840     8264    4              ELSE OK='0'B;
      841     8265    4              END;
      842     8266    3          IF OK
      843     8267    4          THEN DO;
      844     8268
      845     8269    4              CHARNLEN=F$FILE$->F$DCB.ARS#;
      846     8270    4              IF FILE_TYPE = %FTP_OPT_ASCII AND NOT FPT_READ.V.DVBYTE.CONT#
      847     8271    5              THEN DO;
      848     8272    5                  BYTES = BYTES - 1;
      849     8273    5                  SUBSTR (DATA_BUFFER, CHARNLEN, 2) = CRLF;
      850     8274    5                  CHARNLEN = CHARNLEN + 2;
      851     8275    5                  END;
      852     8276    4              IF (CHARNLEN>0)
      853     8277    4              THEN CALL TCP$WRITE(DATA_LCN,VECTOR(ADDR(DATA_BUFFER)->CHARN))
      854     8278    5                  WHENALTRETURN DO;
      855     8279    5                      CALL TCP$RELEASE(DATA_LCN);
      856     8280    5                      CALL SEND_MSG (MSG_426);
      857     8281    5                      GOTO PORTALT;
      858     8282    5                      END;
      859     8283    4              BYTES = BYTES + CHARNLEN;
      860     8284    4              END;
      861     8285    3          END;
      862     8286    2      CALL GET_CLOSE(DATA_LCN,%TIMEOUT);
      863     8287    2      CALL M$TIME (FPT_TIME);
      864     8288    2      START_TIME = TSTAMP-START_TIME;
      865     8289    2      CALL SEND_MSG (MSG_226);
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:29   
      866     8290
      867     8291    2      CALL REPORT_TIME(BYTES,START_TIME);
      868     8292    2      CALL M$CLOSE (FPT_CLOSE);
      869     8293
      870     8294    2      RETURN;
      871     8295    2   END PUT_CMD;
      872     8296
      873     8297        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:30   
      874     8298    1   GET_OPEN: PROC(LCN,TIMEOUT) ALTRET;
      875     8299    2   DCL LCN UBIN(36);
      876     8300    2   DCL TIMEOUT UBIN(36);
      877     8301
      878     8302        %TCP$CB (NAME=CB);
      879     8305        %TCP$ADMIN (STCLASS=BASED);
      880     8326    2   DCL TCP$READ ENTRY(3) ALTRET;
      881     8327    2   DCL REMOTE_ADMIN ENTRY(1);
      882     8328
      883     8329    2      PASV = 0;             /* If we get this far, use the default next time */
      884     8330
      885     8331                  /* Do a read, it must be a ADMINMSG_ESTABLISHED, otherwise altret */
      886     8332
      887     8333    2      CALL TCP$READ (LCN, VECTOR(CMD_BUFFER), CB) ALTRET (RETALT);
      888     8334
      889     8335    3      IF CB.ADMIN THEN DO;
      890     8336    3          IF ADDR(CMD_BUFFER)->TCP$ADMIN.CMD ~= %TCP_ADMINMSG_ESTABLISHED
      891     8337    4          THEN DO;
      892     8338    4              CALL REMOTE_ADMIN(ADDR(CMD_BUFFER));
      893     8339    4   RETALT:    CALL REPORT_LIB;             /* Send a 425 error */
      894     8340    4              CALL TCP$RELEASE(LCN);
      895     8341    4              ALTRETURN;
      896     8342    4              END;
      897     8343    3          END;
      898     8344    2      RETURN;
      899     8345    2   END GET_OPEN;
      900     8346
      901     8347        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:31   
      902     8348        /* Close lcn, wait for close ack, release it */
      903     8349    1   GET_CLOSE: PROC(LCN, TIMEOUT) ALTRET;
      904     8350    2   DCL LCN UBIN(36);
      905     8351    2   DCL TIMEOUT UBIN(36);
      906     8352        %TCP$CB (NAME=CB, STCLASS=STATIC);
      907     8355        %TCP$ADMIN (STCLASS=BASED);
      908     8376    2   DCL TCP$CLOSE ENTRY(1) ALTRET;
      909     8377    2   DCL TCP$READ ENTRY(3) ALTRET;
      910     8378    2   DCL REMOTE_ADMIN ENTRY(1);
      911     8379
      912     8380    2      CALL TCP$CLOSE (LCN)
      913     8381    3      WHENALTRETURN DO;
      914     8382    3          CALL TCP$RELEASE(LCN);
      915     8383    3          ALTRETURN;
      916     8384    3          END;
      917     8385
      918     8386    3      DO WHILE('1'B);
      919     8387    4          CALL TCP$READ (LCN, VECTOR(CMD_BUFFER), CB) WHENALTRETURN DO;
      920     8388    4              CALL M$XXX;
      921     8389    4              END;
      922     8390
      923     8391    4          IF CB.ADMIN THEN DO;
      924     8392    4              IF (ADDR(CMD_BUFFER)->TCP$ADMIN.CMD ~= %TCP_ADMINMSG_CLOSED) AND
      925     8393    4                    (ADDR(CMD_BUFFER)->TCP$ADMIN.CMD ~= %TCP_ADMINMSG_CLOSING) THEN
      926     8394    4                  CALL REMOTE_ADMIN(ADDR(CMD_BUFFER));
      927     8395
      928     8396    4              CALL TCP$RELEASE(LCN);
      929     8397    4              RETURN;
      930     8398    4              END;
      931     8399
      932     8400    3          END;
      933     8401    2   END GET_CLOSE;
      934     8402
      935     8403        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:32   
      936     8404    1   OPEN_DATA_PORT: PROC ALTRET;
      937     8405        /*
      938     8406           If we're in passive mode, the data port is already open.
      939     8407           otherwise ...
      940     8408           Open to the socket from any port command, or to the default.
      941     8409           Altret if it doesn't work. */
      942     8410
      943     8411    2   DCL FMT_OUT CHAR(64);
      944     8412    2   DCL FMT_OUTL SBIN(36);
      945     8413    2   DCL FMT_OUTB CHAR(FMT_OUTL) BASED;
      946     8414    2   DCL TCP$OPEN ENTRY(6) ALTRET;
      947     8415
      948     8416    2      IF PASV > 0 THEN RETURN;
      949     8417
      950     8418        /*n* handle optional output to file */  /* What does this mean, harold? */
      951     8419
      952     8420    2      DATA_LS = CMD_LS;
      953     8421    2      DATA_LS.PORT = DATA_LS.PORT-1;
      954     8422    3      IF PASV = 0 THEN DO;
      955     8423    3          DATA_FS = CMD_FS;
      956     8424    3          END;
      957     8425    2      ELSE IF DATA_FS.ADDRESS/%BITBIN('01000000'X) = 127 THEN
      958     8426    2              DATA_FS.ADDRESS = CMD_FS.ADDRESS;
      959     8427
      960     8428                                                /* Open a socket to other end */
      961     8429
      962     8430    2      B$JIT.PRIV.ACTIVE.MSYS = '1'B; /* Get privileged so we can use low port#'s */
      963     8431    2      DATA_LCN = -1;
      964     8432    2      CALL TCP$OPEN (DATA_LCN, DATA_LS, DATA_FS, %TCP_ACTIVE,,DATA_LS)
      965     8433    3      WHENALTRETURN DO;
      966     8434    3          B$JIT.PRIV.ACTIVE.MSYS = B$JIT.PRIV.JOB.MSYS;
      967     8435    3   RETALT: ;
      968     8436    3          GLOBAL_ERR = %FTP_PROCEDURE_ERR;              /*N* REPORT ERROR */
      969     8437    3          CALL REPORT_LIB;                 /* Send informational 425 response */
      970     8438    3          IF DATA_LCN >= 0 THEN CALL TCP$RELEASE(DATA_LCN);
      971     8439    3          ALTRETURN;
      972     8440    3          END;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:33   
      973     8441    2      B$JIT.PRIV.ACTIVE.MSYS = B$JIT.PRIV.JOB.MSYS;
      974     8442    2      RETURN;
      975     8443
      976     8444
      977     8445    2   OPEN_PASV_PORT: ENTRY ALTRET;
      978     8446
      979     8447                            /* Open a listen socket and send its address to other end */
      980     8448    2      DATA_LS.PORT = 0;
      981     8449    2      DATA_LS.ADDRESS = CMD_LS.ADDRESS;
      982     8450    2      IF DATA_LS.ADDRESS/%BITBIN('01000000'X) = 127 THEN
      983     8451    2          DATA_LS.ADDRESS = CMD_FS.ADDRESS;
      984     8452    2      DATA_LCN = -1;
      985     8453    2      DATA_FS = '0'B;
      986     8454    2      CALL TCP$OPEN (DATA_LCN, DATA_LS, DATA_FS, %TCP_PASSIVE,,DATA_LS)
      987     8455    2            ALTRET (RETALT);
      988     8456                                                /* Build pasv response */
      989     8457    2      CALL PORT(DATA_LS.ADDRESS, DATA_LS.PORT);
      990     8458    2      FMT_OUTL = FMT_OUTL-1;
      991     8459    2      CALL SEND_MSG (MSG_227, VECTOR(PINCRC(ADDR(FMT_OUT),1)->FMT_OUTB));
      992     8460    2      PASV = 1;
      993     8461    2      RETURN;
      994     8462
      995     8463        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:34   
      996     8464    2   PORT: PROC(ADDRESS,PORT);
      997     8465
      998     8466    3   DCL 1 ADDRESS UBIN(32) ALIGNED;
      999     8467
     1000     8468    3   DCL 1 PORT UBIN(16) ALIGNED;
     1001     8469
     1002     8470    3   DCL X$WRITE ENTRY(22);
     1003     8471        %INCLUDE XU_FORMAT_C;
     1004     8633        %F_FDS (NAME=FDS);
     1005     8746
     1006     8747    3   DCL IPFMT CONSTANT CHAR(0) INIT(' (%.8D,%.8D,%.8D,%.8D,%S%.8D,%.8D)%1Q');
     1007     8748
     1008     8749    3      FDS.BUF_ = VECTOR(FMT_OUT);
     1009     8750    3      CALL X$WRITE (FDS, VECTOR(IPFMT), VECTOR(ADDRESS),
     1010     8751    3            VECTOR(PORT));
     1011     8752    3      FMT_OUTL = FDS.BUFX;
     1012     8753
     1013     8754    3   END PORT;
     1014     8755    2   END OPEN_DATA_PORT;
     1015     8756        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:35   
     1016     8757    1   PARSE_PORT: PROC(SOCKET,TEXT);
     1017     8758        %TCP$SOCKET (NAME=SOCKET, STCLASS=PARAM);
     1018     8766    2   DCL TEXT(0:0) CHAR(1);
     1019     8767    2   DCL I SBIN;
     1020     8768    2   DCL J SBIN;
     1021     8769    2   DCL K SBIN;
     1022     8770
     1023     8771    2      J = -1;
     1024     8772    2      I=0;
     1025     8773    2      K=0;
     1026     8774    3      DO WHILE '1'B;
     1027     8775    3          J = J + 1;
     1028     8776    4          IF TEXT(J) < '0' OR TEXT(J) > '9' THEN DO;
     1029     8777    4              I = I + 1;
     1030     8778    4              SOCKET.PORT = SOCKET.PORT*256 + K;
     1031     8779    4              IF I = 6 THEN RETURN;
     1032     8780    5              IF MOD(I,2) = 0 THEN DO;
     1033     8781    5                  SOCKET.ADDRESS = SOCKET.ADDRESS*65536 + SOCKET.PORT;
     1034     8782    5                  END;
     1035     8783    4              K = 0;
     1036     8784    4              END;
     1037     8785    3          ELSE K = K*10 + ASCBIN(TEXT(J)) - 48;
     1038     8786    3          END;
     1039     8787    2   END PARSE_PORT;
     1040     8788
     1041     8789        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:36   
     1042     8790    1   REPORT_LIB: PROC;
     1043     8791        %FPT_ERRMSG (BUF=LINE_BUF,              /* errmsg */
     1044     8792               INCLCODE=NO,
     1045     8793               SUBMESS=YES,
     1046     8794                CODE=TCP_MON_ERR,
     1047     8795               SOURCE=ALTRET);
     1048     8822    2      FPT_ERRMSG.V.SOURCE# = 0;
     1049     8823    2   REPORT_ALT: ENTRY;
     1050     8824    2      CALL M$ERRMSG (FPT_ERRMSG);
     1051     8825    2      CHARNLEN = 120;
     1052     8826    3      DO WHILE SUBSTR(LINE_BUF,0,1) = ' ';
     1053     8827    3          SUBSTR(LINE_BUF,0,120) = SUBSTR(LINE_BUF,1,119);
     1054     8828    3          CHARNLEN = CHARNLEN - 1;
     1055     8829    3          IF CHARNLEN < 100 THEN EXIT;
     1056     8830    3          END;
     1057     8831    3      DO UNTIL CHARNLEN = 1;
     1058     8832    3          IF SUBSTR (LINE_BUF, CHARNLEN-1, 1) ~= ' ' THEN EXIT;
     1059     8833    3          CHARNLEN = CHARNLEN-1;
     1060     8834    3          END;
     1061     8835    2      IF FPT_ERRMSG.V.SOURCE#~=0
     1062     8836    2      THEN CALL SEND_MSG (MSG_550, VECTOR(ADDR(LINE_BUF)->CHARN));
     1063     8837    2      ELSE CALL SEND_MSG (MSG_425E, VECTOR(ADDR(LINE_BUF)->CHARN));
     1064     8838    2      FPT_ERRMSG.V.SOURCE# = 2;
     1065     8839    2      RETURN;
     1066     8840    2   END REPORT_LIB;
     1067     8841
     1068     8842
     1069     8843    1   END FTPCMD;
     1070     8844        %EOD;

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:37   
--  Include file information  --

   XU_FORMAT_C.:LIBRARY  is referenced.
   XSL_CHAM_M.:TCA2TOU  is referenced.
   B_ERRORS_C.:LIBRARY  is referenced.
   TCP_HEP_M.:TCA2TOU  cannot be made into a system file and is referenced.
   TCF_FTP_E.:TCA2TOU  is referenced.
   XUG_ENTRY.:LIBRARY  cannot be made into a system file and is referenced.
   XU_MACRO_C.:LIBRARY  is referenced.
   B$JIT.:LIBRARY  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIBRARY  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FTPCMD.

   Procedure FTPCMD requires 1909 words for executable code.
   Procedure FTPCMD requires 64 words of local(AUTO) storage.

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:38   

 Object Unit name= FTPCMD                                     File name= TCF$FTPDCMD.:TCA2TOU
 UTS= NOV 16 '97 14:11:40.60 SUN                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none   456    710  FTPCMD
    2   DCB   even  none     0      0  M$LO
    3  RoData even  UTS    675   1243  FTPCMD
    4   DCB   even  none     0      0  F$FILE
    5   DCB   even  none     0      0  F$ANON
    6   DCB   even  none    98    142  F$FTPUSERS
    7   DCB   even  none     0      0  M$DO
    8   Proc  even  none  1909   3565  FTPCMD
    9  RoData even  none   109    155  FTPCMD

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     8      0   yes    yes     yes      Std        0  FTPCMD
     8    475          yes     yes      Std        0  FTPCMD_INIT

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    1    124  GLOBAL_ERR
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:39   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 GET_COMMAND
 yes     yes           Std       2 XTX$ADAPT
 yes     yes           Std       1 XUG$GETCMD
 yes     yes           Std       2 SEND_MSG
 yes     yes           Std       1 TCP$RELEASE
 yes     yes           Std       2 XUG$INIT
 yes     yes           Std       2 SET_USER_ID
         yes           Std       2 NET$ADDR2IP
 yes     yes           Std       2 NET$ADDR2NAME
 yes     yes           Std       1 XUG$ECHO
 yes     yes           Std       3 TCP$READ
 yes     yes           Std       4 GET_LINE
         yes           Std       2 REPORT_TIME
 yes     yes           Std       4 TCP$WRITE
 yes     yes           Std       3 TCP$READ
         yes           Std       1 REMOTE_ADMIN
 yes     yes           Std       1 TCP$CLOSE
 yes     yes           Std       3 TCP$READ
         yes           Std       1 REMOTE_ADMIN
 yes     yes           Std       6 TCP$OPEN
         yes           Std      22 X$WRITE
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:40   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                             r    B$JIT$                                TCP_MON_ERR
     B$TCB$                                CMD_LCN                               DATA_LCN
     RUNNING                               FTP_NODES                             CMD_FS
     CMD_BUFFER                            CMD_LS                                M$LO
     WRITE_LO                              SALUTATION                            F$FILE
     F$ANON                                F$FTPUSERS                            M$DO
     CRLF                                  B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:41   


        1        1        /*M* FTP Server command module */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* NTB, MCR=NO, PLM=3, CTI=6, IND=4, MCI=YES, SDI=6, DCI=4, ENU=0, ECU=0 , CCC */
        8        8        FTPCMD: PROC ALTRET;

      8  8 000000   000000 700200 xent  FTPCMD       TSX0  ! X66_AUTO_0
         8 000001   000100 000000                    ZERO    64,0

        9        9        %INCLUDE CP_6;
       10       90        %INCLUDE CP_6_SUBS;
       11      630        %INCLUDE B$JIT;
       12      920    1   DCL B$JIT$ PTR SYMREF READONLY;
       13      921        %INCLUDE XU_MACRO_C;
       14     4027        %INCLUDE XUG_ENTRY;
       15     4058        %INCLUDE TCF_FTP_E;
       16     4113        %INCLUDE TCP_HEP_M;
       17     4168        %B$TCB (STCLASS="BASED(B$TCB$)");
       18     4171        %B$ALT;
       19     4179        %INCLUDE B_ERRORS_C;
       20     5306        %EQU TIMEOUT = 60;
       21     5307
       22     5308    1   DCL GET_COMMAND ENTRY(3) ALTRET;
       23     5309    1   DCL SET_USER_ID ENTRY(2) ALTRET;
       24     5310    1   DCL REPORT_TIME ENTRY(2);
       25     5311    1   DCL SEND_MSG ENTRY(2) ALTRET;
       26     5312    1   DCL NET$ADDR2IP ENTRY(2);
       27     5313    1   DCL NET$ADDR2NAME ENTRY(2) ALTRET;
       28     5314    1   DCL TCP$RELEASE ENTRY(1) ALTRET;
       29     5315
       30     5316        %XUG_GETCMD (NODES=FTP_NODES,
       31     5317                TREAD=NO,
       32     5318                READR=GET_COMMAND);
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:42   
       33     5656
       34     5657        %XUG_INIT (COMMANDS=NO,
       35     5658                ECHO=ALWAYS_ECHO,
       36     5659                GOODCMD=NO);
       37     6072
       38     6073        %PARSE$OUT (STCLASS="BASED(PARSE$)");
       39     6118        %PARSE$SYM (STCLASS=BASED);
       40     6156        %F$DCB;
       41     6213    1   DCL B$TCB$ PTR SYMREF;
       42     6214    1   DCL PARSE$ PTR;
       43     6215
       44     6216    1   DCL CODE UBIN(36);
       45     6217    1   DCL LOGGED_IN BIT(1) STATIC INIT('0'B);
       46     6218    1   DCL CMD_LCN SBIN(36) SYMREF;
       47     6219    1   DCL DATA_LCN SBIN(36) SYMREF;
       48     6220    1   DCL RUNNING BIT(1) SYMREF;
       49     6221    1   DCL FTP_NODES UBIN(36) SYMREF;
       50     6222        %TCP$SOCKET (NAME=CMD_FS, STCLASS="SYMREF");
       51     6230    1   DCL CMD_BUFFER CHAR(4096) SYMREF;
       52     6231    1   DCL LINE_BUF REDEF CMD_BUFFER CHAR(4096);
       53     6232    1   DCL DATA_BUFFER REDEF CMD_BUFFER CHAR(4096);
       54     6233        %TCP$SOCKET (NAME=CMD_LS, STCLASS="SYMREF");
       55     6241        %TCP$CB (NAME=CB, STCLASS=STATIC);
       56     6244        %TCP$ADMIN (STCLASS=BASED);
       57     6265    1   DCL M$LO DCB;
       58     6266    1   DCL GLOBAL_ERR UBIN(36) STATIC SYMDEF;
       59     6267    1   DCL 1 TFID ,
       60     6268    1             2 COUNT UBIN(9) CALIGNED,
       61     6269    1             2 TEXT CHAR(79);
       62     6270
       63     6271    1   DCL 1 TEXTC BASED,
       64     6272    1             2 COUNT UBIN(9) CALIGNED,
       65     6273    1             2 TEXT CHAR(TEXTC.COUNT);
       66     6274
       67     6275    1   DCL CHARN CHAR(CHARNLEN) BASED;
       68     6276    1   DCL CHARNLEN UBIN(36) STATIC;
       69     6277    1   DCL START_TIME UBIN(36) STATIC;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:43   
       70     6278    1   DCL BYTES UBIN(36) STATIC;
       71     6279    1   DCL TSTAMP UBIN(36) STATIC;
       72     6280        %FPT_TIME (SOURCE=CLOCK, TSTAMP=TSTAMP, DEST=TUN);
       73     6299        %FPT_WRITE (FPTN=WRITE_LO,
       74     6300                STCLASS=SYMREF);
       75     6331        %FPT_YC (NOERR=YES);
       76     6348        %FPT_LDEV (STCLASS=CONSTANT, STREAMNAME='LP01', DELETE=YES);
       77     6373    1   DCL 1 SALUTATION SYMREF,
       78     6374    1             2 L UBIN BYTE CALIGNED,
       79     6375    1             2 T CHAR(SALUTATION.L);
       80     6376
       81     6377    1   DCL F$FILE DCB;
       82     6378    1   DCL F$FILE$ PTR STATIC;
       83     6379        /* Open items */
       84     6380        %FPT_OPEN (
       85     6381                ACS=SEQUEN,
       86     6382                ACCT=VLP_ACCT,
       87     6383                DCB=F$FILE,
       88     6384                DISP=NAMED,
       89     6385                SCRUB=YES,
       90     6386                RES='JF',
       91     6387                FUN=CREATE,
       92     6388                NAME=VLP_NAME,
       93     6389                PASS=VLP_PASS,
       94     6390                SN=VLP_SN,
       95     6391                WSN=VLP_WSN);
       96     6500        %VLP_ACCT;
       97     6513        %VLP_NAME;
       98     6540        %VLP_PASS;
       99     6553        %VLP_SN;
      100     6566        %VLP_WSN;
      101     6579
      102     6580        %FPT_FID (ACCT=VLP_ACCT,
      103     6581                ASN=FPT_OPEN.V.ASN#,
      104     6582                NAME=VLP_NAME,
      105     6583                PASS=VLP_PASS,
      106     6584                RES=FPT_OPEN.V.RES#,
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:44   
      107     6585                SN=VLP_SN,
      108     6586                WSN=VLP_WSN);
      109     6609
      110     6610        %FPT_READ (DCB=F$FILE, BUF=DATA_BUFFER, FULL=YES);
      111     6649        %FPT_WRITE (DCB=F$FILE, BUF=PMD_CMD);
      112     6680    1   DCL PMD_CMD CONSTANT CHAR(0)
      113     6681    1      INIT('!PMD DA,DC,DS,JI,TC;D XSL_ERRNO\J;D 0\REGS;PL;Q');
      114     6682        %FPT_CLOSE (DCB=F$FILE, DISP=SAVE, STCLASS=CONSTANT);
      115     6724        %FPT_CLOSE (DCB=F$FILE, FPTN=FPT_NSAVE, STCLASS=CONSTANT);
      116     6766
      117     6767    1   DCL FILE_TYPE UBIN(36) STATIC INIT(%FTP_OPT_ASCII);
      118     6768    1   DCL TYPE_NAME(0:2) CONSTANT CHAR(5) ALIGNED INIT('Ascii', 'Image', 'CP-6');
      119     6769
      120     6770    1   DCL PASV SBIN STATIC INIT(0);
      121     6771    1   DCL RNFR_PENDING BIT(36) STATIC INIT('0'B);
      122     6772        %TCP$SOCKET (NAME=DATA_FS, STCLASS=STATIC);
      123     6780        %TCP$SOCKET (NAME=DATA_LS, STCLASS=STATIC);
      124     6788
      125     6789        %MACRO MSG(NAME=0, TEXT=' ');
      126     6790        DCL 1 MSG_%CHARTEXT(TEXTCHAR(NAME)) CONSTANT,
      127     6791                  2 * UBIN BYTE UNAL INIT(LENGTHC(TEXT)),
      128     6792                  2 * CHAR(0) INIT(TEXT);
      129     6793        %MEND;
      130     6794
      131     6795
      132     6796        %MSG (NAME=150, TEXT='150 Opening data connection for ');
      133     6801        %MSG (NAME=200TYPE, TEXT='200 Type changed to ');
      134     6806        %MSG (NAME=200PORT, TEXT='200 PORT command accepted.');
      135     6811        %MSG (NAME=200SET, TEXT='200 Set command accepted.');
      136     6816        %MSG (NAME=230USER, TEXT='230 User login successful.');
      137     6821        %MSG (NAME=202, TEXT='202 No-op completed.');
      138     6826        %MSG (NAME=214,
      139     6827        TEXT="'214- CP-6 FTP recognizes these commands: (* = unimplemented).'");
      140     6832        %MSG (NAME=214_1,
      141     6833        TEXT='   ABOR*  ACCT*  ALLO   APPE   CDUP   CWD    DELE   HELP   LIST');
      142     6838        %MSG (NAME=214_2,
      143     6839        TEXT='   MODE*  MKD*   NLST   NOOP   PASS   PASV   PORT   PWD    QUIT');
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:45   
      144     6844        %MSG (NAME=214_3,
      145     6845        TEXT='   REIN*  REST*  RETR   RMD*   RNFR   RNTO   SITE*  SMNT*  STAT*');
      146     6850        %MSG (NAME=214_4,
      147     6851        TEXT='   STOR   STOU*  STRU*  SYST*  TYPE   USER   !SET');
      148     6856        %MSG (NAME=214_E, TEXT="'214 Use RHELP (IBEX) for info about help.'");
      149     6861        %MSG (NAME=221, TEXT='221 CP-6 FTP server disconnecting.');
      150     6866        %MSG (NAME=226, TEXT='226 Data Transfer completed.');
      151     6871        %MSG (NAME=227, TEXT='227 Entering Passive mode ');
      152     6876        %MSG (NAME=230, TEXT="'230 Guest userid accepted; access restrictions apply.'");
      153     6881        %MSG (NAME=250DEL, TEXT='250 Deleted file ');
      154     6886        %MSG (NAME=250RNTO, TEXT='250 Renamed to ');
      155     6891        %MSG (NAME=257, TEXT='257 Current directory is ');
      156     6896        %MSG (NAME=331, TEXT='331 Password required.');
      157     6901        %MSG (NAME=331GUEST, TEXT="'331 Guest login ok; send userid as password.'");
      158     6906        %MSG (NAME=350RNFR, TEXT='350 File ok - awaiting RNTO.');
      159     6911        %MSG (NAME=425, TEXT='425 Can''t open Data connection.');
      160     6916        %MSG (NAME=425E, TEXT='425 Can''t open Data connection: ');
      161     6921        %MSG (NAME=426, TEXT="'426 Connection closed; transfer aborted. '");
      162     6926        %MSG (NAME=500, TEXT='500 Syntax error - unrecognized command.');
      163     6931        %MSG (NAME=501, TEXT='501 Syntax error in parameters.');
      164     6936        %MSG (NAME=502, TEXT='502 Unimplemented command.');
      165     6941        %MSG (NAME=503, TEXT='503 Bad command sequence.');
      166     6946        %MSG (NAME=504, TEXT='504 Parameter not implememted.');
      167     6951        %MSG (NAME=530, TEXT='530 User not logged in.');
      168     6956        %MSG (NAME=530USER, TEXT='530 Access denied.');
      169     6961        %MSG (NAME=530LOGOUT,
      170     6962        TEXT="'530 User command not allowed; please close first.'");
      171     6967        %MSG (NAME=550, TEXT='550 Request rejected: ');
      172     6972        %MSG (NAME=550H, TEXT='550 Help message too big.');
      173     6977
      174     6978    1   DCL MSG_500$(0:4) PTR CONSTANT INIT( ADDR(MSG_500), ADDR(MSG_501),
      175     6979    1     ADDR(MSG_502), ADDR(MSG_503), ADDR(MSG_504));
      176     6980
      177     6981    1      GLOBAL_ERR = 0;

   6981  8 000002   000124 450000 1                  STZ     GLOBAL_ERR

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:46   
      178     6982    1      TCP_MON_ERR = '0'B;

   6982  8 000003   000000 450000 xsym               STZ     TCP_MON_ERR

      179     6983    2      CALL XUG$GETCMD (XUG_GETCMD) WHENALTRETURN DO;

   6983  8 000004   000000 630400 9                  EPPR0   0
         8 000005   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000006   000000 701000 xent               TSX1    XUG$GETCMD
         8 000007   000011 702000 8                  TSX2    s:6984
         8 000010   000017 710000 8                  TRA     s:6989

      180     6984    2          IF TCP_MON_ERR THEN CALL REPORT_LIB;

   6984  8 000011   000000 235000 xsym               LDA     TCP_MON_ERR
         8 000012   000015 600000 8                  TZE     s:6985

   6984  8 000013   003462 701000 8                  TSX1    REPORT_LIB
         8 000014   000000 011000                    NOP     0

      181     6985    2          RUNNING = '0'B;

   6985  8 000015   000000 450000 xsym               STZ     RUNNING

      182     6986    2          RETURN;

   6986  8 000016   000000 702200 xent               TSX2  ! X66_ARET

      183     6987    2          END;
      184     6988
      185     6989    2      IF XUG_GETCMD.OUT$ = ADDR(NIL) THEN DO;

   6989  8 000017   000001 236000 1                  LDQ     XUG_GETCMD+1
         8 000020   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 000021   000024 601000 8                  TNZ     s:6994

      186     6990    2          RUNNING = '0'B;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:47   

   6990  8 000022   000000 450000 xsym               STZ     RUNNING

      187     6991    2          RETURN;

   6991  8 000023   000000 702200 xent               TSX2  ! X66_ARET

      188     6992    2          END;
      189     6993
      190     6994    1      PARSE$ = XUG_GETCMD.OUT$->OUT$BLK.SUBLK$(0);

   6994  8 000024   000001 470400 1                  LDP0    XUG_GETCMD+1
         8 000025   000003 236100                    LDQ     3,,PR0
         8 000026   200003 756100                    STQ     PARSE$,,AUTO

      191     6995    1      CODE =  OUT$BLK.CODE;

   6995  8 000027   200003 471500                    LDP1    PARSE$,,AUTO
         8 000030   100000 236100                    LDQ     0,,PR1
         8 000031   777777 376007                    ANQ     -1,DL
         8 000032   200004 756100                    STQ     CODE,,AUTO

      192     6996
      193     6997    2      IF OUT$BLK.NSUBLKS=1 AND OUT$BLK.SUBLK$(0) -> OUT$BLK.CODE > 499 THEN DO;

   6997  8 000033   100001 220100                    LDX0    1,,PR1
         8 000034   000001 100003                    CMPX0   1,DU
         8 000035   000051 601000 8                  TNZ     s:7002
         8 000036   100003 473500                    LDP3    3,,PR1
         8 000037   300000 721100                    LXL1    0,,PR3
         8 000040   000764 101003                    CMPX1   500,DU
         8 000041   000051 602000 8                  TNC     s:7002

      194     6998    2          CALL SEND_MSG (MSG_500$(OUT$BLK.SUBLK$(0) -> OUT$BLK.CODE-500)->CHARN);

   6998  8 000042   777653 474411 3                  LDP4    IPFMT-727,X1
         8 000043   200064 454500                    STP4    @PORT+2,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:48   
         8 000044   200064 630500                    EPPR0   @PORT+2,,AUTO
         8 000045   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000046   000000 701000 xent               TSX1    SEND_MSG
         8 000047   000000 011000                    NOP     0

      195     6999    2          RETURN;

   6999  8 000050   000000 702200 xent               TSX2  ! X66_ARET

      196     7000    2          END;
      197     7001
      198     7002    1      IF NOT LOGGED_IN AND CODE~=%FTP_CMD_USER AND CODE~=%FTP_CMD_RHELP

   7002  8 000051   000116 234000 1                  SZN     LOGGED_IN
         8 000052   000066 604000 8                  TMI     s:7008
         8 000053   000017 116007                    CMPQ    15,DL
         8 000054   000066 600000 8                  TZE     s:7008
         8 000055   000013 116007                    CMPQ    11,DL
         8 000056   000066 600000 8                  TZE     s:7008
         8 000057   000014 116007                    CMPQ    12,DL
         8 000060   000066 600000 8                  TZE     s:7008

      199     7003    2            AND CODE~=%FTP_CMD_CLOSE THEN DO;

      200     7004    2          CALL SEND_MSG (MSG_530);

   7004  8 000061   000001 630400 9                  EPPR0   1
         8 000062   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000063   000000 701000 xent               TSX1    SEND_MSG
         8 000064   000000 011000                    NOP     0

      201     7005    2          RETURN;

   7005  8 000065   000000 702200 xent               TSX2  ! X66_ARET

      202     7006    2          END;
      203     7007
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:49   
      204     7008    2      IF RNFR_PENDING THEN DO;

   7008  8 000066   000360 235000 1                  LDA     RNFR_PENDING
         8 000067   000104 600000 8                  TZE     s:7015

      205     7009    2          IF CODE=%FTP_CMD_RENAME THEN IF OUT$BLK.SUBLK$(0)->OUT$BLK.CODE>0

   7009  8 000070   000015 116007                    CMPQ    13,DL
         8 000071   000075 601000 8                  TNZ     s:7011

   7009  8 000072   100003 473500                    LDP3    3,,PR1
         8 000073   300000 721100                    LXL1    0,,PR3
         8 000074   000104 601000 8                  TNZ     s:7015

      206     7010    2              THEN EXIT;
      207     7011    2          CALL M$CLOSE (FPT_CLOSE);

   7011  8 000075   000040 630400 3                  EPPR0   FPT_CLOSE
         8 000076   050001 713400                    CLIMB   close
         8 000077   406000 401760                    pmme    nvectors=13

      208     7012    2          CALL SEND_MSG (MSG_503);

   7012  8 000100   000002 630400 9                  EPPR0   2
         8 000101   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000102   000000 701000 xent               TSX1    SEND_MSG
         8 000103   000000 011000                    NOP     0

      209     7013    2          END;

      210     7014
      211     7015    2      DO CASE (CODE);

   7015  8 000104   200004 235100                    LDA     CODE,,AUTO
         8 000105   000026 115007                    CMPA    22,DL
         8 000106   000110 602005 8                  TNC     s:7015+4,AL
         8 000107   000470 710000 8                  TRA     s:7102
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:50   
         8 000110   000470 710000 8                  TRA     s:7102
         8 000111   000313 710000 8                  TRA     s:7064
         8 000112   000234 710000 8                  TRA     s:7046
         8 000113   000344 710000 8                  TRA     s:7077
         8 000114   000321 710000 8                  TRA     s:7070
         8 000115   000470 710000 8                  TRA     s:7102
         8 000116   000143 710000 8                  TRA     s:7020
         8 000117   000136 710000 8                  TRA     s:7017
         8 000120   000470 710000 8                  TRA     s:7102
         8 000121   000335 710000 8                  TRA     s:7074
         8 000122   000470 710000 8                  TRA     s:7102
         8 000123   000150 710000 8                  TRA     s:7023
         8 000124   000214 710000 8                  TRA     s:7039
         8 000125   000316 710000 8                  TRA     s:7067
         8 000126   000470 710000 8                  TRA     s:7102
         8 000127   000165 710000 8                  TRA     s:7030
         8 000130   000160 710000 8                  TRA     s:7027
         8 000131   000470 710000 8                  TRA     s:7102
         8 000132   000240 710000 8                  TRA     PWD_CMD
         8 000133   000415 710000 8                  TRA     s:7088
         8 000134   000366 710000 8                  TRA     s:7082
         8 000135   000427 710000 8                  TRA     s:7093

      212     7016    2       CASE (%FTP_CMD_LIST);               /* List */

      213     7017    2          CALL LIST_CMD('L(A)  ');

   7017  8 000136   000003 236000 9                  LDQ     3
         8 000137   200033 756100                    STQ     TFID+22,,AUTO
         8 000140   001273 701000 8                  TSX1    LIST_CMD
         8 000141   000000 011000                    NOP     0
         8 000142   000474 710000 8                  TRA     s:7108

      214     7018
      215     7019    2       CASE (%FTP_CMD_LS);                 /* Nlst */

      216     7020    2          CALL LIST_CMD('L(C=0)');
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:51   

   7020  8 000143   000004 236000 9                  LDQ     4
         8 000144   200033 756100                    STQ     TFID+22,,AUTO
         8 000145   001273 701000 8                  TSX1    LIST_CMD
         8 000146   000000 011000                    NOP     0
         8 000147   000474 710000 8                  TRA     s:7108

      217     7021
      218     7022    2       CASE (%FTP_CMD_RHELP);              /* Help */

      219     7023    2          IF NOT LOGGED_IN THEN B$JIT.PRIV.ACTIVE = %PR_JIT#;

   7023  8 000150   000116 234000 1                  SZN     LOGGED_IN
         8 000151   000155 604000 8                  TMI     s:7024

   7023  8 000152   001220 236000 3                  LDQ     IPFMT+14
         8 000153   000000 470400 xsym               LDP0    B$JIT$
         8 000154   000013 756100                    STQ     11,,PR0

      220     7024    2          CALL HELP_CMD;

   7024  8 000155   001627 701000 8                  TSX1    HELP_CMD
         8 000156   000000 011000                    NOP     0
         8 000157   000474 710000 8                  TRA     s:7108

      221     7025
      222     7026    2       CASE (%FTP_CMD_CONNECT);            /* Noop allo */

      223     7027    2          CALL SEND_MSG (MSG_202);

   7027  8 000160   000005 630400 9                  EPPR0   5
         8 000161   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000162   000000 701000 xent               TSX1    SEND_MSG
         8 000163   000000 011000                    NOP     0
         8 000164   000474 710000 8                  TRA     s:7108

      224     7028
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:52   
      225     7029    2       CASE (%FTP_CMD_USER);               /* User */

      226     7030    3          CALL USER_CMD WHENRETURN DO;

   7030  8 000165   000536 701000 8                  TSX1    USER_CMD
         8 000166   000213 702000 8                  TSX2    s:7036

      227     7031    4              CALL M$LDEV (FPT_LDEV) WHENALTRETURN DO; END;

   7031  8 000167   000000 630400 3                  EPPR0   FPT_LDEV
         8 000170   460004 713400                    CLIMB   alt,+24580
         8 000171   403000 401760                    pmme    nvectors=7
         8 000172   000174 702000 8                  TSX2    s:7032
         8 000173   000174 710000 8                  TRA     s:7032

      228     7032    3              WRITE_LO.BUF_ = VECTOR (SALUTATION.T);

   7032  8 000174   000000 236000 xsym               LDQ     SALUTATION
         8 000175   000033 772000                    QRL     27
         8 000176   000064 737000                    LLS     52
         8 000177   000140 135007                    SBLA    96,DL
         8 000200   000006 236000 9                  LDQ     6
         8 000201   000004 757000 xsym               STAQ    WRITE_LO+4

      229     7033    3              CALL M$WRITE (WRITE_LO);

   7033  8 000202   000000 630400 xsym               EPPR0   WRITE_LO
         8 000203   040001 713400                    CLIMB   write
         8 000204   401400 401760                    pmme    nvectors=4

      230     7034    3              LOGGED_IN = '1'B;

   7034  8 000205   400000 236003                    LDQ     -131072,DU
         8 000206   000116 756000 1                  STQ     LOGGED_IN

      231     7035    3              CALL SEND_MSG (MSG_230USER);

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:53   
   7035  8 000207   000007 630400 9                  EPPR0   7
         8 000210   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000211   000000 701000 xent               TSX1    SEND_MSG
         8 000212   000000 011000                    NOP     0

      232     7036    3              END;

   7036  8 000213   000474 710000 8                  TRA     s:7108

      233     7037
      234     7038    2       CASE (%FTP_CMD_CLOSE);              /* Quit */

      235     7039    2          IF NOT LOGGED_IN THEN CALL USER_CMD; /* log bad password if req'd */

   7039  8 000214   000116 234000 1                  SZN     LOGGED_IN
         8 000215   000220 604000 8                  TMI     s:7040

   7039  8 000216   000536 701000 8                  TSX1    USER_CMD
         8 000217   000000 011000                    NOP     0

      236     7040    2          CALL SEND_MSG (MSG_221);

   7040  8 000220   000010 630400 9                  EPPR0   8
         8 000221   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000222   000000 701000 xent               TSX1    SEND_MSG
         8 000223   000000 011000                    NOP     0

      237     7041    2          CALL GET_CLOSE(CMD_LCN);

   7041  8 000224   000001 236000 xsym               LDQ     B_VECTNIL+1
         8 000225   200040 756100                    STQ     K+1,,AUTO
         8 000226   000011 236000 9                  LDQ     9
         8 000227   200037 756100                    STQ     J+1,,AUTO
         8 000230   003062 701000 8                  TSX1    GET_CLOSE
         8 000231   000000 011000                    NOP     0

      238     7042    2          RUNNING = '0'B;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:54   

   7042  8 000232   000000 450000 xsym               STZ     RUNNING

      239     7043    2          RETURN;

   7043  8 000233   000000 702200 xent               TSX2  ! X66_ARET

      240     7044
      241     7045    2       CASE (%FTP_CMD_RDIR);               /* Cwd cdup */

      242     7046    3          CALL DIR_CMD WHENRETURN DO;

   7046  8 000234   001222 701000 8                  TSX1    DIR_CMD
         8 000235   000237 702000 8                  TSX2    s:7047+1

      243     7047    3              GOTO PWD_CMD;

   7047  8 000236   000240 710000 8                  TRA     PWD_CMD
         8 000237   000474 710000 8                  TRA     s:7108

      244     7048    3              END;
      245     7049
      246     7050    2       CASE (%FTP_CMD_PWD);                /* Pwd */

   7043  8 000240                       PWD_CMD      null
      247     7051    2   PWD_CMD:;
      248     7052    2          IF B$JIT.FPSN = ' ' THEN CHARNLEN = 0;

   7052  8 000240   000000 470400 xsym               LDP0    B$JIT$
         8 000241   040000 106500                    CMPC    fill='040'O
         8 000242   000021 000006                    ADSC9   17,,PR0                  cn=0,n=6
         8 000243   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         8 000244   000247 601000 8                  TNZ     s:7054

   7052  8 000245   000125 450000 1                  STZ     CHARNLEN
         8 000246   000261 710000 8                  TRA     s:7058

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:55   
      249     7053    3          ELSE DO;

      250     7054    3              SUBSTR( DATA_BUFFER, 0, 3) = 'DP#';

   7054  8 000247   001221 236000 3                  LDQ     IPFMT+15
         8 000250   000000 552070 xsym               STBQ    CMD_BUFFER,'70'O

      251     7055    3              SUBSTR( DATA_BUFFER, 3, 6) = B$JIT.FPSN;

   7055  8 000251   040000 100500                    MLR     fill='040'O
         8 000252   000021 000006                    ADSC9   17,,PR0                  cn=0,n=6
         8 000253   000000 600006 xsym               ADSC9   CMD_BUFFER               cn=3,n=6

      252     7056    3              CALL INDEX( CHARNLEN, ' ', DATA_BUFFER);

   7056  8 000254   010000 220003                    LDX0    4096,DU
         8 000255   000000 124440                    SCM     mask='000'O
         8 000256   000000 000010 xsym               ADSC9   CMD_BUFFER               cn=0,n=*X0
         8 000257   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         8 000260   000125 000000 1                  ARG     CHARNLEN

      253     7057    3              END;

      254     7058    2          SUBSTR( DATA_BUFFER, CHARNLEN, 1) = '.';

   7058  8 000261   000125 235000 1                  LDA     CHARNLEN
         8 000262   040005 100400                    MLR     fill='040'O
         8 000263   000012 000001 9                  ADSC9   10                       cn=0,n=1
         8 000264   000000 000001 xsym               ADSC9   CMD_BUFFER,A             cn=0,n=1

      255     7059    2          SUBSTR( DATA_BUFFER, CHARNLEN+1, 9) = B$JIT.FACCN;

   7059  8 000265   040005 100500                    MLR     fill='040'O
         8 000266   000006 000010                    ADSC9   6,,PR0                   cn=0,n=8
         8 000267   000000 200011 xsym               ADSC9   CMD_BUFFER,A             cn=1,n=9

      256     7060    2          CALL INDEX (CHARNLEN, ' ', DATA_BUFFER);
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:56   

   7060  8 000270   010000 220003                    LDX0    4096,DU
         8 000271   000000 124440                    SCM     mask='000'O
         8 000272   000000 000010 xsym               ADSC9   CMD_BUFFER               cn=0,n=*X0
         8 000273   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         8 000274   000125 000000 1                  ARG     CHARNLEN

      257     7061    2          CALL SEND_MSG(MSG_257, VECTOR(ADDR(DATA_BUFFER)->CHARN));

   7061  8 000275   000125 235000 1                  LDA     CHARNLEN
         8 000276   000020 735000                    ALS     16
         8 000277   000140 135007                    SBLA    96,DL
         8 000300   000013 236000 9                  LDQ     11
         8 000301   200064 757100                    STAQ    @PORT+2,,AUTO
         8 000302   200064 631500                    EPPR1   @PORT+2,,AUTO
         8 000303   200067 451500                    STP1    @PORT+5,,AUTO
         8 000304   000014 236000 9                  LDQ     12
         8 000305   200066 756100                    STQ     @PORT+4,,AUTO
         8 000306   200066 630500                    EPPR0   @PORT+4,,AUTO
         8 000307   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 000310   000000 701000 xent               TSX1    SEND_MSG
         8 000311   000000 011000                    NOP     0
         8 000312   000474 710000 8                  TRA     s:7108

      258     7062
      259     7063    2       CASE (%FTP_CMD_DELETE);             /* Dele */

      260     7064    2          CALL DELETE_CMD;

   7064  8 000313   001561 701000 8                  TSX1    DELETE_CMD
         8 000314   000000 011000                    NOP     0
         8 000315   000474 710000 8                  TRA     s:7108

      261     7065
      262     7066    2       CASE (%FTP_CMD_RENAME);             /* Rnfr, rnto */

      263     7067    2          CALL RENAME_CMD;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:57   

   7067  8 000316   001443 701000 8                  TSX1    RENAME_CMD
         8 000317   000000 011000                    NOP     0
         8 000320   000474 710000 8                  TRA     s:7108

      264     7068
      265     7069    2       CASE (%FTP_CMD_GET);                /* Stor, appe */

      266     7070    2          CALL GET_CMD(OUT$BLK.SUBLK$(0)->OUT$BLK.CODE,

   7070  8 000321   200003 470500                    LDP0    PARSE$,,AUTO
         8 000322   000003 471500                    LDP1    3,,PR0
         8 000323   000004 473500                    LDP3    4,,PR0
         8 000324   300003 634500                    EPPR4   3,,PR3
         8 000325   200034 454500                    STP4    @SOCKET+1,,AUTO
         8 000326   200064 451500                    STP1    @PORT+2,,AUTO
         8 000327   200064 236100                    LDQ     @PORT+2,,AUTO
         8 000330   400000 036007                    ADLQ    -131072,DL
         8 000331   200033 756100                    STQ     TFID+22,,AUTO
         8 000332   002162 701000 8                  TSX1    GET_CMD
         8 000333   000000 011000                    NOP     0
         8 000334   000474 710000 8                  TRA     s:7108

      267     7071    2                OUT$BLK.SUBLK$(1)->OUT$SYM.TEXTC$);
      268     7072
      269     7073    2       CASE (%FTP_CMD_PUT);                /* Retr */

      270     7074    2          CALL PUT_CMD(OUT$BLK.SUBLK$(0)->OUT$SYM.TEXTC$);

   7074  8 000335   200003 470500                    LDP0    PARSE$,,AUTO
         8 000336   000003 471500                    LDP1    3,,PR0
         8 000337   100003 633500                    EPPR3   3,,PR1
         8 000340   200035 453500                    STP3    @TEXT+1,,AUTO
         8 000341   002557 701000 8                  TSX1    PUT_CMD
         8 000342   000000 011000                    NOP     0
         8 000343   000474 710000 8                  TRA     s:7108

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:58   
      271     7075
      272     7076    2       CASE (%FTP_CMD_TYPE);               /* Type */

      273     7077    2          FILE_TYPE = OUT$BLK.SUBLK$(0)->OUT$SYM.CODE;

   7077  8 000344   200003 470500                    LDP0    PARSE$,,AUTO
         8 000345   000003 471500                    LDP1    3,,PR0
         8 000346   100000 236100                    LDQ     0,,PR1
         8 000347   777777 376007                    ANQ     -1,DL
         8 000350   000356 756000 1                  STQ     FILE_TYPE

      274     7078    2          CALL SEND_MSG (MSG_200TYPE,

   7078  8 000351   000015 235000 9                  LDA     13
         8 000352   000023 736000                    QLS     19
         8 000353   000016 036000 9                  ADLQ    14
         8 000354   200064 757100                    STAQ    @PORT+2,,AUTO
         8 000355   200064 631500                    EPPR1   @PORT+2,,AUTO
         8 000356   200067 451500                    STP1    @PORT+5,,AUTO
         8 000357   000017 236000 9                  LDQ     15
         8 000360   200066 756100                    STQ     @PORT+4,,AUTO
         8 000361   200066 630500                    EPPR0   @PORT+4,,AUTO
         8 000362   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 000363   000000 701000 xent               TSX1    SEND_MSG
         8 000364   000000 011000                    NOP     0
         8 000365   000474 710000 8                  TRA     s:7108

      275     7079    2                VECTOR(TYPE_NAME(FILE_TYPE-%FTP_OPT_ASCII)));
      276     7080
      277     7081    2       CASE (%FTP_SRVCMD_PORT);            /* Port */

      278     7082    2          IF PASV > 0 THEN CALL TCP$RELEASE (DATA_LCN);

   7082  8 000366   000357 236000 1                  LDQ     PASV
         8 000367   000374 604400 8                  TMOZ    s:7083

   7082  8 000370   000020 630400 9                  EPPR0   16
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:59   
         8 000371   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000372   000000 701000 xent               TSX1    TCP$RELEASE
         8 000373   000000 011000                    NOP     0

      279     7083    2          CALL PARSE_PORT (DATA_FS, OUT$BLK.SUBLK$(0) -> OUT$SYM.TEXT);

   7083  8 000374   200003 470500                    LDP0    PARSE$,,AUTO
         8 000375   000003 471500                    LDP1    3,,PR0
         8 000376   200064 451500                    STP1    @PORT+2,,AUTO
         8 000377   200064 236100                    LDQ     @PORT+2,,AUTO
         8 000400   000021 036000 9                  ADLQ    17
         8 000401   200034 756100                    STQ     @SOCKET+1,,AUTO
         8 000402   000022 236000 9                  LDQ     18
         8 000403   200033 756100                    STQ     TFID+22,,AUTO
         8 000404   003372 701000 8                  TSX1    PARSE_PORT
         8 000405   000000 011000                    NOP     0

      280     7084    2          PASV = -1;

   7084  8 000406   000001 335007                    LCA     1,DL
         8 000407   000357 755000 1                  STA     PASV

      281     7085    2          CALL SEND_MSG (MSG_200PORT);

   7085  8 000410   000023 630400 9                  EPPR0   19
         8 000411   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000412   000000 701000 xent               TSX1    SEND_MSG
         8 000413   000000 011000                    NOP     0
         8 000414   000474 710000 8                  TRA     s:7108

      282     7086
      283     7087    2       CASE (%FTP_SRVCMD_PASV);            /* Pasv */

      284     7088    2          IF PASV > 0 THEN CALL TCP$RELEASE (DATA_LCN);

   7088  8 000415   000357 236000 1                  LDQ     PASV
         8 000416   000423 604400 8                  TMOZ    s:7089
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:60   

   7088  8 000417   000020 630400 9                  EPPR0   16
         8 000420   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000421   000000 701000 xent               TSX1    TCP$RELEASE
         8 000422   000000 011000                    NOP     0

      285     7089    2          PASV = 0;

   7089  8 000423   000357 450000 1                  STZ     PASV

      286     7090    2          CALL OPEN_PASV_PORT;

   7090  8 000424   003243 701000 8                  TSX1    OPEN_PASV_PORT
         8 000425   000000 011000                    NOP     0
         8 000426   000474 710000 8                  TRA     s:7108

      287     7091
      288     7092    2       CASE (%FTP_SRVCMD_SET);

      289     7093    2          FPT_YC.CMD_ = VECTOR (OUT$BLK.SUBLK$(0) -> OUT$SYM.TEXT);

   7093  8 000427   200003 470500                    LDP0    PARSE$,,AUTO
         8 000430   000003 471500                    LDP1    3,,PR0
         8 000431   100004 236100                    LDQ     4,,PR1
         8 000432   000033 772000                    QRL     27
         8 000433   000064 737000                    LLS     52
         8 000434   000140 135007                    SBLA    96,DL
         8 000435   200064 451500                    STP1    @PORT+2,,AUTO
         8 000436   200064 236100                    LDQ     @PORT+2,,AUTO
         8 000437   000021 036000 9                  ADLQ    17
         8 000440   000146 757000 1                  STAQ    FPT_YC

      290     7094    3          CALL M$YC (FPT_YC) WHENRETURN DO;

   7094  8 000441   000146 630400 1                  EPPR0   FPT_YC
         8 000442   400011 713400                    CLIMB   alt,+9
         8 000443   401000 401760                    pmme    nvectors=3
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:61   
         8 000444   000452 702000 8                  TSX2    s:7097

      291     7095    3              CALL SEND_MSG (MSG_200SET);

   7095  8 000445   000024 630400 9                  EPPR0   20
         8 000446   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000447   000000 701000 xent               TSX1    SEND_MSG
         8 000450   000000 011000                    NOP     0

      292     7096    3              END; WHENALTRETURN DO;

   7096  8 000451   000467 710000 8                  TRA     s:7099

      293     7097    3              IF B$TCB.ALT$->B$ALT.ERR.FCG~='3025'O THEN CALL REPORT_ALT;

   7097  8 000452   000000 470400 xsym               LDP0    B$TCB$
         8 000453   000000 471500                    LDP1    0,,PR0
         8 000454   100102 236100                    LDQ     66,,PR1
         8 000455   777700 376003                    ANQ     -64,DU
         8 000456   302500 116003                    CMPQ    99648,DU
         8 000457   000463 600000 8                  TZE     s:7098

   7097  8 000460   003466 701000 8                  TSX1    REPORT_ALT
         8 000461   000000 011000                    NOP     0
         8 000462   000467 710000 8                  TRA     s:7099

      294     7098    3              ELSE CALL SEND_MSG (MSG_501);

   7098  8 000463   000025 630400 9                  EPPR0   21
         8 000464   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000465   000000 701000 xent               TSX1    SEND_MSG
         8 000466   000000 011000                    NOP     0

      295     7099    3              END;

   7099  8 000467   000474 710000 8                  TRA     s:7108

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:62   
      296     7100
      297     7101    2       CASE(ELSE);

      298     7102    2          CALL SEND_MSG (MSG_502);

   7102  8 000470   000026 630400 9                  EPPR0   22
         8 000471   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000472   000000 701000 xent               TSX1    SEND_MSG
         8 000473   000000 011000                    NOP     0

      299     7103    2          END;                             /* Do case */

      300     7104
      301     7105        /*N* IF BATCH AND GLOBAL_ERR ~= 0 THEN ABORT */
      302     7106
      303     7107
      304     7108    1      RETURN;

   7108  8 000474   000000 702200 xent               TSX2  ! X66_ARET

      305     7109    1   FTPCMD_INIT: ENTRY ALTRET;

   7109  8 000475   000000 700200 xent  FTPCMD_INIT  TSX0  ! X66_AUTO_0
         8 000476   000100 000000                    ZERO    64,0

      306     7110    1      F$FILE$ = DCBADDR(DCBNUM(F$FILE));

   7110  8 000477   000000 236007 xsym               LDQ     F$FILE,DL
         8 000500   000027 470400 9                  LDP0    23
         8 000501   000000 471500                    LDP1    0,,PR0
         8 000502   100000 236106                    LDQ     0,QL,PR1
         8 000503   000156 756000 1                  STQ     F$FILE$

      307     7111    2      CALL XUG$INIT (XUG_GETCMD, XUG_INIT) WHENALTRETURN DO;

   7111  8 000504   000030 630400 9                  EPPR0   24
         8 000505   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:63   
         8 000506   000000 701000 xent               TSX1    XUG$INIT
         8 000507   000511 702000 8                  TSX2    s:7112
         8 000510   000513 710000 8                  TRA     s:7114

      308     7112    2          CALL M$XXX;

   7112  8 000511   000003 713400                    CLIMB   3
         8 000512   000000 401760                    pmme    nvectors=0

      309     7113    2          END;

      310     7114    1      CALL M$OPEN (FPT_OPEN);    /* Write a pmd to jf to get a dump if we abort */

   7114  8 000513   000160 630400 1                  EPPR0   FPT_OPEN
         8 000514   050000 713400                    CLIMB   open
         8 000515   410400 401760                    pmme    nvectors=18

      311     7115    1      FPT_OPEN.V.INITZ.REASSIGN# = '1'B;

   7115  8 000516   200000 236007                    LDQ     65536,DL
         8 000517   000224 256000 1                  ORSQ    FPT_OPEN+36

      312     7116    1      CALL M$WRITE (FPT_WRITE);

   7116  8 000520   000342 630400 1                  EPPR0   FPT_WRITE
         8 000521   040001 713400                    CLIMB   write
         8 000522   401400 401760                    pmme    nvectors=4

      313     7117    1      CALL M$CLOSE (FPT_CLOSE);

   7117  8 000523   000040 630400 3                  EPPR0   FPT_CLOSE
         8 000524   050001 713400                    CLIMB   close
         8 000525   406000 401760                    pmme    nvectors=13

      314     7118    1      B$JIT.JUNK = B$JIT.JUNK & ~%JJ_EXONLY#; /* Make it possible, too. */

   7118  8 000526   000000 470400 xsym               LDP0    B$JIT$
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:64   
         8 000527   000315 220100                    LDX0    205,,PR0
         8 000530   777767 360003                    ANX0    -9,DU
         8 000531   000315 740100                    STX0    205,,PR0

      315     7119    1      B$JIT.PRIV.ACTIVE.FMSEC = '1'B;

   7119  8 000532   100000 236003                    LDQ     32768,DU
         8 000533   000013 256100                    ORSQ    11,,PR0

      316     7120    1      B$JIT.CLRES(2) = '1'B;

   7120  8 000534   000325 256100                    ORSQ    213,,PR0
         8 000535   003564 710000 8                  TRA     s:8843

      317     7121        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:65   
      318     7122    1   USER_CMD: PROC ALTRET;

   7122  8 000536   200032 741300       USER_CMD     STX1  ! TFID+21,,AUTO

      319     7123        %INCLUDE XSL_CHAM_M;
      320     7148        %XSL_CHAM (NAME=AUTH);
      321     7164    2   DCL F$ANON DCB;
      322     7165        %M$DCB (DCBN=F$FTPUSERS, ASN=FILE, NAME='etc:ftpusers', ACCT=':SYS');
      323     7239           %FPT_READ
      324     7240                 (FPTN=READ_FTPUSERS, STCLASS=CONSTANT, DCB=F$FTPUSERS, BUF=CMD_BUFFER);
      325     7279        %FPT_CLOSE (FPTN=CLOSE_FTPUSERS, STCLASS=CONSTANT, DCB=F$FTPUSERS);
      326     7321
      327     7322    2   DCL I SBIN;
      328     7323
      329     7324    3      IF LOGGED_IN THEN DO;      /* Temp code until XSL$CHAM can do accounting */

   7324  8 000537   000116 234000 1                  SZN     LOGGED_IN
         8 000540   000547 605000 8                  TPL     s:7328

      330     7325    3          CALL SEND_MSG (MSG_530LOGOUT);

   7325  8 000541   000032 630400 9                  EPPR0   26
         8 000542   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000543   000000 701000 xent               TSX1    SEND_MSG
         8 000544   000000 011000                    NOP     0

      331     7326    3          ALTRETURN;

   7326  8 000545   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 000546   000000 702211                    TSX2  ! 0,X1

      332     7327    3          END;
      333     7328    2      IF LOGGED_IN THEN AUTH.FLAGS.DO_ACCOUNTING = '1'B;

   7328  8 000547   000552 605000 8                  TPL     s:7329

   7328  8 000550   000400 236003                    LDQ     256,DU
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:66   
         8 000551   000372 256000 1                  ORSQ    AUTH+5

      334     7329    2      LOGGED_IN = '0'B;

   7329  8 000552   000116 450000 1                  STZ     LOGGED_IN

      335     7330
      336     7331    3      IF OUT$BLK.NSUBLKS = 0 OR OUT$BLK.SUBLK$(0) -> OUT$SYM.CODE = 0 THEN DO;

   7331  8 000553   200003 470500                    LDP0    PARSE$,,AUTO
         8 000554   000001 220100                    LDX0    1,,PR0
         8 000555   000561 600000 8                  TZE     s:7332
         8 000556   000003 471500                    LDP1    3,,PR0
         8 000557   100000 722100                    LXL2    0,,PR1
         8 000560   000723 601000 8                  TNZ     s:7363

      337     7332    4          IF AUTH.RESPONSE = 1 THEN DO;

   7332  8 000561   000372 722000 1                  LXL2    AUTH+5
         8 000562   000001 102003                    CMPX2   1,DU
         8 000563   000576 601000 8                  TNZ     s:7338

      338     7333    4              AUTH.FLAGS.BADPW = '1'B;

   7333  8 000564   000020 236003                    LDQ     16,DU
         8 000565   000372 256000 1                  ORSQ    AUTH+5

      339     7334    4              AUTH.FLAGS.CHECKPW = '1'B;

   7334  8 000566   000010 236003                    LDQ     8,DU
         8 000567   000372 256000 1                  ORSQ    AUTH+5

      340     7335    4              CALL SET_USER_ID (AUTH, CMD_BUFFER);

   7335  8 000570   000033 630400 9                  EPPR0   27
         8 000571   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 000572   000000 701000 xent               TSX1    SET_USER_ID
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:67   
         8 000573   000000 011000                    NOP     0

      341     7336    4              AUTH.FLAGS.BADPW = '0'B;

   7336  8 000574   000035 236000 9                  LDQ     29
         8 000575   000372 356000 1                  ANSQ    AUTH+5

      342     7337    4              END;

      343     7338    3          IF CODE = %FTP_CMD_CLOSE THEN RETURN;

   7338  8 000576   200004 235100                    LDA     CODE,,AUTO
         8 000577   000014 115007                    CMPA    12,DL
         8 000600   000603 601000 8                  TNZ     s:7339

   7338  8 000601   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 000602   000001 702211                    TSX2  ! 1,X1

      344     7339    4          IF OUT$BLK.NSUBLKS = 0 THEN DO;  /* anonymous login */

   7339  8 000603   200003 470500                    LDP0    PARSE$,,AUTO
         8 000604   000001 220100                    LDX0    1,,PR0
         8 000605   000662 601000 8                  TNZ     s:7352

      345     7340    4              AUTH.L = DCBADDR(DCBNUM(F$ANON))->F$DCB.NAME#.L+8;

   7340  8 000606   000000 236007 xsym               LDQ     F$ANON,DL
         8 000607   000027 471400 9                  LDP1    23
         8 000610   100000 473500                    LDP3    0,,PR1
         8 000611   300000 474506                    LDP4    0,QL,PR3
         8 000612   400010 236100                    LDQ     8,,PR4
         8 000613   000033 772000                    QRL     27
         8 000614   000010 036007                    ADLQ    8,DL
         8 000615   000033 736000                    QLS     27
         8 000616   000365 552040 1                  STBQ    AUTH,'40'O

      346     7341    4              AUTH.ACCN = DCBADDR(DCBNUM(F$ANON))->F$DCB.ACCT#;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:68   

   7341  8 000617   000000 236007 xsym               LDQ     F$ANON,DL
         8 000620   300000 474506                    LDP4    0,QL,PR3
         8 000621   040000 100500                    MLR     fill='040'O
         8 000622   400020 000010                    ADSC9   16,,PR4                  cn=0,n=8
         8 000623   000365 200010 1                  ADSC9   AUTH                     cn=1,n=8

      347     7342    4              AUTH.USER = DCBADDR(DCBNUM(F$ANON))->F$DCB.NAME#.C;

   7342  8 000624   000000 236007 xsym               LDQ     F$ANON,DL
         8 000625   300000 474506                    LDP4    0,QL,PR3
         8 000626   040000 100500                    MLR     fill='040'O
         8 000627   400010 200014                    ADSC9   8,,PR4                   cn=1,n=12
         8 000630   000367 200014 1                  ADSC9   AUTH+2                   cn=1,n=12

      348     7343    4              AUTH.FLAGS.CHECKPW = '0'B;

   7343  8 000631   000036 236000 9                  LDQ     30
         8 000632   000372 356000 1                  ANSQ    AUTH+5

      349     7344    4              AUTH.FLAGS.STUFF_JIT = '0'B;

   7344  8 000633   000037 236000 9                  LDQ     31
         8 000634   000372 356000 1                  ANSQ    AUTH+5

      350     7345    4              CALL SET_USER_ID (AUTH, CMD_BUFFER);

   7345  8 000635   000033 630400 9                  EPPR0   27
         8 000636   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 000637   000000 701000 xent               TSX1    SET_USER_ID
         8 000640   000000 011000                    NOP     0

      351     7346    4              IF AUTH.RESPONSE > 0 THEN CALL SEND_MSG (MSG_530USER);

   7346  8 000641   000372 720000 1                  LXL0    AUTH+5
         8 000642   000650 600000 8                  TZE     s:7347

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:69   
   7346  8 000643   000040 630400 9                  EPPR0   32
         8 000644   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000645   000000 701000 xent               TSX1    SEND_MSG
         8 000646   000000 011000                    NOP     0
         8 000647   000654 710000 8                  TRA     s:7348

      352     7347    4              ELSE CALL SEND_MSG (MSG_331GUEST);

   7347  8 000650   000041 630400 9                  EPPR0   33
         8 000651   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000652   000000 701000 xent               TSX1    SEND_MSG
         8 000653   000000 011000                    NOP     0

      353     7348    4              AUTH.FLAGS.STUFF_JIT = '1'B;

   7348  8 000654   000200 236003                    LDQ     128,DU
         8 000655   000372 256000 1                  ORSQ    AUTH+5

      354     7349    4              AUTH.RESPONSE = 1;      /* Make it look like a password is needed */

   7349  8 000656   000001 220003                    LDX0    1,DU
         8 000657   000372 440000 1                  SXL0    AUTH+5

      355     7350    4              ALTRETURN;

   7350  8 000660   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 000661   000000 702211                    TSX2  ! 0,X1

      356     7351    4              END;
      357     7352    3          AUTH.L = 9;

   7352  8 000662   011000 236003                    LDQ     4608,DU
         8 000663   000365 552040 1                  STBQ    AUTH,'40'O

      358     7353    3          AUTH.USER = '*';

   7353  8 000664   040000 100400                    MLR     fill='040'O
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:70   
         8 000665   000042 000001 9                  ADSC9   34                       cn=0,n=1
         8 000666   000367 200014 1                  ADSC9   AUTH+2                   cn=1,n=12

      359     7354    3          AUTH.FLAGS.SCRAMBLED = '0'B;

   7354  8 000667   000043 236000 9                  LDQ     35
         8 000670   000372 356000 1                  ANSQ    AUTH+5

      360     7355    3          AUTH.ACCN = OUT$BLK.SUBLK$(0) -> OUT$SYM.TEXT;

   7355  8 000671   000003 471500                    LDP1    3,,PR0
         8 000672   100004 236100                    LDQ     4,,PR1
         8 000673   000033 772000                    QRL     27
         8 000674   000000 620006                    EAX0    0,QL
         8 000675   040000 100540                    MLR     fill='040'O
         8 000676   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
         8 000677   000365 200010 1                  ADSC9   AUTH                     cn=1,n=8

      361     7356    4          IF OUT$BLK.NSUBLKS > 1 THEN DO;

   7356  8 000700   000001 220100                    LDX0    1,,PR0
         8 000701   000002 100003                    CMPX0   2,DU
         8 000702   000720 602000 8                  TNC     s:7360

      362     7357    4              AUTH.USER = OUT$BLK.SUBLK$(1) -> OUT$SYM.TEXT;

   7357  8 000703   000004 471500                    LDP1    4,,PR0
         8 000704   100004 236100                    LDQ     4,,PR1
         8 000705   000033 772000                    QRL     27
         8 000706   000000 621006                    EAX1    0,QL
         8 000707   040000 100540                    MLR     fill='040'O
         8 000710   100004 200011                    ADSC9   4,,PR1                   cn=1,n=*X1
         8 000711   000367 200014 1                  ADSC9   AUTH+2                   cn=1,n=12

      363     7358    4              AUTH.L = OUT$BLK.SUBLK$(1) -> OUT$SYM.COUNT + 8;

   7358  8 000712   000004 471500                    LDP1    4,,PR0
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:71   
         8 000713   100004 236100                    LDQ     4,,PR1
         8 000714   000033 772000                    QRL     27
         8 000715   000010 036007                    ADLQ    8,DL
         8 000716   000033 736000                    QLS     27
         8 000717   000365 552040 1                  STBQ    AUTH,'40'O

      364     7359    4              END;

      365     7360    3          AUTH.PSWB = '0'B;

   7360  8 000720   000373 450000 1                  STZ     AUTH+6
         8 000721   000374 450000 1                  STZ     AUTH+7

      366     7361    3          END;

   7361  8 000722   001147 710000 8                  TRA     s:7405

      367     7362    3      ELSE DO;

      368     7363    4          IF AUTH.RESPONSE ~= 1 THEN DO;

   7363  8 000723   000372 723000 1                  LXL3    AUTH+5
         8 000724   000001 103003                    CMPX3   1,DU
         8 000725   000734 600000 8                  TZE     s:7368

      369     7364                                                /* Pass can't be first. */
      370     7365    4              CALL SEND_MSG (MSG_503);

   7365  8 000726   000002 630400 9                  EPPR0   2
         8 000727   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000730   000000 701000 xent               TSX1    SEND_MSG
         8 000731   000000 011000                    NOP     0

      371     7366    4              ALTRETURN;

   7366  8 000732   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 000733   000000 702211                    TSX2  ! 0,X1
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:72   

      372     7367    4              END;
      373     7368    4          IF NOT AUTH.FLAGS.CHECKPW THEN DO;

   7368  8 000734   000372 236000 1                  LDQ     AUTH+5
         8 000735   000010 316003                    CANQ    8,DU
         8 000736   001072 601000 8                  TNZ     s:7392

      374     7369        /* Got ident for anonymous login - login for real and echo the command */
      375     7370        /* unless nothing was supplied for a password */
      376     7371    4              IF OUT$BLK.SUBLK$(0) ->OUT$SYM.COUNT < 6 THEN AUTH.L = 1;

   7371  8 000737   100004 236100                    LDQ     4,,PR1
         8 000740   777000 376003                    ANQ     -512,DU
         8 000741   006000 116003                    CMPQ    3072,DU
         8 000742   000745 603000 8                  TRC     s:7372

   7371  8 000743   001000 236003                    LDQ     512,DU
         8 000744   000365 552040 1                  STBQ    AUTH,'40'O

      377     7372    4              CALL SET_USER_ID (AUTH, CMD_BUFFER);

   7372  8 000745   000033 630400 9                  EPPR0   27
         8 000746   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 000747   000000 701000 xent               TSX1    SET_USER_ID
         8 000750   000000 011000                    NOP     0

      378     7373    4              AUTH.FLAGS.CHECKPW = '1'B;

   7373  8 000751   000010 236003                    LDQ     8,DU
         8 000752   000372 256000 1                  ORSQ    AUTH+5

      379     7374    4              IF AUTH.RESPONSE > 0 THEN EXIT; /* do it again and report 530 */

   7374  8 000753   000372 720000 1                  LXL0    AUTH+5
         8 000754   001071 601000 8                  TNZ     s:7390+2

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:73   
      380     7375    5              CALL M$LDEV (FPT_LDEV) WHENALTRETURN DO; END;

   7375  8 000755   000000 630400 3                  EPPR0   FPT_LDEV
         8 000756   460004 713400                    CLIMB   alt,+24580
         8 000757   403000 401760                    pmme    nvectors=7
         8 000760   000762 702000 8                  TSX2    s:7376
         8 000761   000762 710000 8                  TRA     s:7376

      381     7376    4              WRITE_LO.BUF_ = VECTOR (SALUTATION.T);

   7376  8 000762   000000 236000 xsym               LDQ     SALUTATION
         8 000763   000033 772000                    QRL     27
         8 000764   000064 737000                    LLS     52
         8 000765   000140 135007                    SBLA    96,DL
         8 000766   000006 236000 9                  LDQ     6
         8 000767   000004 757000 xsym               STAQ    WRITE_LO+4

      382     7377    4              CALL M$WRITE (WRITE_LO);

   7377  8 000770   000000 630400 xsym               EPPR0   WRITE_LO
         8 000771   040001 713400                    CLIMB   write
         8 000772   401400 401760                    pmme    nvectors=4

      383     7378    4              SUBSTR(CMD_BUFFER,0,17) = 'Guest login from ';

   7378  8 000773   040000 100400                    MLR     fill='040'O
         8 000774   001222 000021 3                  ADSC9   IPFMT+16                 cn=0,n=17
         8 000775   000000 000021 xsym               ADSC9   CMD_BUFFER               cn=0,n=17

      384     7379    4              CALL NET$ADDR2IP (TFID, CMD_FS);

   7379  8 000776   000044 236000 9                  LDQ     36
         8 000777   200065 756100                    STQ     @PORT+3,,AUTO
         8 001000   200005 630500                    EPPR0   TFID,,AUTO
         8 001001   200064 450500                    STP0    @PORT+2,,AUTO
         8 001002   200064 630500                    EPPR0   @PORT+2,,AUTO
         8 001003   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:74   
         8 001004   000000 701000 xent               TSX1    NET$ADDR2IP
         8 001005   000000 011000                    NOP     0

      385     7380    4              SUBSTR (CMD_BUFFER,17,15) = ADDR (TFID)-> TEXTC.TEXT;

   7380  8 001006   200005 236100                    LDQ     TFID,,AUTO
         8 001007   000033 772000                    QRL     27
         8 001010   000000 620006                    EAX0    0,QL
         8 001011   040000 100540                    MLR     fill='040'O
         8 001012   200005 200010                    ADSC9   TFID,,AUTO               cn=1,n=*X0
         8 001013   000004 200017 xsym               ADSC9   CMD_BUFFER+4             cn=1,n=15

      386     7381    4              WRITE_LO.BUF_ = VECTOR (SUBSTR (CMD_BUFFER,0,32));

   7381  8 001014   000046 237000 9                  LDAQ    38
         8 001015   000004 757000 xsym               STAQ    WRITE_LO+4

      387     7382    5              CALL NET$ADDR2NAME (TFID, CMD_FS) WHENRETURN DO;

   7382  8 001016   000044 236000 9                  LDQ     36
         8 001017   200065 756100                    STQ     @PORT+3,,AUTO
         8 001020   200005 630500                    EPPR0   TFID,,AUTO
         8 001021   200064 450500                    STP0    @PORT+2,,AUTO
         8 001022   200064 630500                    EPPR0   @PORT+2,,AUTO
         8 001023   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 001024   000000 701000 xent               TSX1    NET$ADDR2NAME
         8 001025   001052 702000 8                  TSX2    s:7386

      388     7383    5                  CALL INSERT (CMD_BUFFER,32,,' (',ADDR (TFID)-> TEXTC.TEXT,')');

   7383  8 001026   200005 236100                    LDQ     TFID,,AUTO
         8 001027   000033 772000                    QRL     27
         8 001030   001227 220000 3                  LDX0    IPFMT+21
         8 001031   000010 740000 xsym               STX0    CMD_BUFFER+8
         8 001032   000000 621006                    EAX1    0,QL
         8 001033   040000 100540                    MLR     fill='040'O
         8 001034   200005 200011                    ADSC9   TFID,,AUTO               cn=1,n=*X1
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:75   
         8 001035   000010 407736 xsym               ADSC9   CMD_BUFFER+8             cn=2,n=4062
         8 001036   007736 116007                    CMPQ    4062,DL
         8 001037   001045 603000 8                  TRC     s:7384
         8 001040   770041 622006                    EAX2    -4063,QL
         8 001041   777777 662003                    ERX2    -1,DU
         8 001042   040046 100400                    MLR     fill='040'O
         8 001043   000050 000001 9                  ADSC9   40                       cn=0,n=1
         8 001044   000010 400012 xsym               ADSC9   CMD_BUFFER+8,Q           cn=2,n=*X2

      389     7384    5                  WRITE_LO.BUF_.BOUND = 34+TFID.COUNT;

   7384  8 001045   000042 036007                    ADLQ    34,DL
         8 001046   000020 736000                    QLS     16
         8 001047   000004 676000 xsym               ERQ     WRITE_LO+4
         8 001050   000034 376000 xsym               ANQ     B_VECTNIL+28
         8 001051   000004 656000 xsym               ERSQ    WRITE_LO+4

      390     7385    5                  END;

      391     7386    4              CALL M$WRITE (WRITE_LO);

   7386  8 001052   000000 630400 xsym               EPPR0   WRITE_LO
         8 001053   040001 713400                    CLIMB   write
         8 001054   401400 401760                    pmme    nvectors=4

      392     7387    4              CALL XUG$ECHO (XUG_GETCMD);

   7387  8 001055   000000 630400 9                  EPPR0   0
         8 001056   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 001057   000000 701000 xent               TSX1    XUG$ECHO
         8 001060   000000 011000                    NOP     0

      393     7388    4              LOGGED_IN = '1'B;

   7388  8 001061   400000 236003                    LDQ     -131072,DU
         8 001062   000116 756000 1                  STQ     LOGGED_IN

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:76   
      394     7389    4              CALL SEND_MSG (MSG_230);

   7389  8 001063   000051 630400 9                  EPPR0   41
         8 001064   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 001065   000000 701000 xent               TSX1    SEND_MSG
         8 001066   000000 011000                    NOP     0

      395     7390    4              ALTRETURN;

   7390  8 001067   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 001070   000000 702211                    TSX2  ! 0,X1
         8 001071   001147 710000 8                  TRA     s:7405

      396     7391    4              END;
      397     7392    3          ELSE IF OUT$BLK.SUBLK$(0) -> OUT$SYM.CODE = 1

   7392  8 001072   000001 102003                    CMPX2   1,DU
         8 001073   001106 601000 8                  TNZ     s:7395
         8 001074   100004 236100                    LDQ     4,,PR1
         8 001075   777000 316003                    CANQ    -512,DU
         8 001076   001106 600000 8                  TZE     s:7395

      398     7393    3                    AND OUT$BLK.SUBLK$(0) -> OUT$SYM.COUNT > 0 THEN
      399     7394    3                  AUTH.PASS = OUT$BLK.SUBLK$(0) -> OUT$SYM.TEXT;

   7394  8 001077   100004 236100                    LDQ     4,,PR1
         8 001100   000033 772000                    QRL     27
         8 001101   000000 624006                    EAX4    0,QL
         8 001102   040000 100540                    MLR     fill='040'O
         8 001103   100004 200014                    ADSC9   4,,PR1                   cn=1,n=*X4
         8 001104   000373 000010 1                  ADSC9   AUTH+6                   cn=0,n=8
         8 001105   001147 710000 8                  TRA     s:7405

      400     7395    4              ELSE IF OUT$BLK.SUBLK$(0) -> OUT$SYM.COUNT ~= 9 THEN DO;

   7395  8 001106   100004 236100                    LDQ     4,,PR1
         8 001107   777000 376003                    ANQ     -512,DU
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:77   
         8 001110   011000 116003                    CMPQ    4608,DU
         8 001111   001120 600000 8                  TZE     s:7399

      401     7396    4                      CALL SEND_MSG (MSG_501);

   7396  8 001112   000025 630400 9                  EPPR0   21
         8 001113   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 001114   000000 701000 xent               TSX1    SEND_MSG
         8 001115   000000 011000                    NOP     0

      402     7397    4                      ALTRETURN;

   7397  8 001116   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 001117   000000 702211                    TSX2  ! 0,X1

      403     7398    4                      END;
      404     7399    4                  ELSE DO I=0 TO 8;

   7399  8 001120   200033 450100                    STZ     I,,AUTO

      405     7400    4                     AUTH.PSWB(I) = ASCBIT( SUBSTR (OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT,I,
              7400                               1));

   7400  8 001121   200003 470500                    LDP0    PARSE$,,AUTO
         8 001122   000003 471500                    LDP1    3,,PR0
         8 001123   100004 236100                    LDQ     4,,PR1
         8 001124   000033 772000                    QRL     27
         8 001125   200033 235100                    LDA     I,,AUTO
         8 001126   000100 100505                    MLR     fill='000'O
         8 001127   100004 200001                    ADSC9   4,A,PR1                  cn=1,n=1
         8 001130   200064 000004                    ADSC9   @PORT+2,,AUTO            cn=0,n=4
         8 001131   200064 236100                    LDQ     @PORT+2,,AUTO
         8 001132   200065 756100                    STQ     @PORT+3,,AUTO
         8 001133   000003 735000                    ALS     3
         8 001134   001136 605000 8                  TPL     s:7400+13
         8 001135   000044 035003                    ADLA    36,DU
         8 001136   003005 060500                    CSL     bolr='003'O
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:78   
         8 001137   200065 000044                    BDSC    @PORT+3,,AUTO            by=0,bit=0,n=36
         8 001140   000373 000010 1                  BDSC    AUTH+6,A                 by=0,bit=0,n=8

      406     7401    4                      AUTH.FLAGS.SCRAMBLED = '1'B;

   7401  8 001141   000100 236003                    LDQ     64,DU
         8 001142   000372 256000 1                  ORSQ    AUTH+5

      407     7402    4                      END;

   7402  8 001143   200033 054100                    AOS     I,,AUTO
         8 001144   200033 235100                    LDA     I,,AUTO
         8 001145   000010 115007                    CMPA    8,DL
         8 001146   001121 604400 8                  TMOZ    s:7400

      408     7403    3          END;

      409     7404
      410     7405    2      AUTH.RESPONSE = 0;

   7405  8 001147   000000 220003                    LDX0    0,DU
         8 001150   000372 440000 1                  SXL0    AUTH+5

      411     7406    2      CALL SET_USER_ID (AUTH, CMD_BUFFER);

   7406  8 001151   000033 630400 9                  EPPR0   27
         8 001152   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 001153   000000 701000 xent               TSX1    SET_USER_ID
         8 001154   000000 011000                    NOP     0

      412     7407    3      IF AUTH.RESPONSE < 1 THEN DO WHILE '1'B;

   7407  8 001155   000372 720000 1                  LXL0    AUTH+5
         8 001156   001176 601000 8                  TNZ     FTPUSERS_OK

      413     7408    3          SUBSTR(CMD_BUFFER,0,8) = ' ';

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:79   
   7408  8 001157   000035 235000 xsym               LDA     B_VECTNIL+29
         8 001160   000035 236000 xsym               LDQ     B_VECTNIL+29
         8 001161   000000 755000 xsym               STA     CMD_BUFFER
         8 001162   000001 756000 xsym               STQ     CMD_BUFFER+1

      414     7409    3          CALL M$READ (READ_FTPUSERS) ALTRET (FTPUSERS_OK);

   7409  8 001163   000644 630400 3                  EPPR0   READ_FTPUSERS
         8 001164   440000 713400                    CLIMB   alt,read
         8 001165   401400 401760                    pmme    nvectors=4
         8 001166   001176 702000 8                  TSX2    FTPUSERS_OK

      415     7410    4          IF SUBSTR(CMD_BUFFER,0,8) = AUTH.ACCN THEN DO;

   7410  8 001167   040000 106400                    CMPC    fill='040'O
         8 001170   000000 000010 xsym               ADSC9   CMD_BUFFER               cn=0,n=8
         8 001171   000365 200010 1                  ADSC9   AUTH                     cn=1,n=8
         8 001172   001157 601000 8                  TNZ     s:7408

      416     7411    4              AUTH.RESPONSE = 2;

   7411  8 001173   000002 220003                    LDX0    2,DU
         8 001174   000372 440000 1                  SXL0    AUTH+5

      417     7412    4              GOTO FTPUSERS_OK;            /* A misnomer in this case */

   7412  8 001175   001176 710000 8                  TRA     FTPUSERS_OK

      418     7413    4              END;
      419     7414    3          END;

      420     7415    2   FTPUSERS_OK: CALL M$CLOSE (CLOSE_FTPUSERS);

   7415  8 001176   000662 630400 3     FTPUSERS_OK  EPPR0   CLOSE_FTPUSERS
         8 001177   050001 713400                    CLIMB   close
         8 001200   406000 401760                    pmme    nvectors=13

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:80   
      421     7416
      422     7417    2      IF AUTH.RESPONSE < 1 THEN RETURN;

   7417  8 001201   000372 720000 1                  LXL0    AUTH+5
         8 001202   001205 601000 8                  TNZ     s:7418

   7417  8 001203   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 001204   000001 702211                    TSX2  ! 1,X1

      423     7418    2      IF AUTH.RESPONSE = 1 THEN CALL SEND_MSG (MSG_331);

   7418  8 001205   000001 100003                    CMPX0   1,DU
         8 001206   001214 601000 8                  TNZ     s:7419

   7418  8 001207   000052 630400 9                  EPPR0   42
         8 001210   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 001211   000000 701000 xent               TSX1    SEND_MSG
         8 001212   000000 011000                    NOP     0
         8 001213   001220 710000 8                  TRA     s:7420

      424     7419    2      ELSE CALL SEND_MSG (MSG_530USER);

   7419  8 001214   000040 630400 9                  EPPR0   32
         8 001215   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 001216   000000 701000 xent               TSX1    SEND_MSG
         8 001217   000000 011000                    NOP     0

      425     7420    2      ALTRETURN;

   7420  8 001220   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 001221   000000 702211                    TSX2  ! 0,X1

      426     7421
      427     7422    2   END USER_CMD;
      428     7423        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:81   
      429     7424    1   DIR_CMD: PROC ALTRET;

   7424  8 001222   200032 741300       DIR_CMD      STX1  ! TFID+21,,AUTO

      430     7425
      431     7426        %FPT_SETFMA (STCLASS=CONSTANT, ACCT=VLP_ACCT, PSN=VLP_SN.SN#);
      432     7439
      433     7440    3      IF OUT$BLK.NSUBLKS>0 THEN DO;

   7440  8 001223   200003 470500                    LDP0    PARSE$,,AUTO
         8 001224   000001 220100                    LDX0    1,,PR0
         8 001225   001251 600000 8                  TZE     s:7448

      434     7441    3          FPT_FID.TEXTFID_ = VECTOR (OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT);

   7441  8 001226   000003 471500                    LDP1    3,,PR0
         8 001227   100004 236100                    LDQ     4,,PR1
         8 001230   000033 772000                    QRL     27
         8 001231   000064 737000                    LLS     52
         8 001232   000140 135007                    SBLA    96,DL
         8 001233   200064 451500                    STP1    @PORT+2,,AUTO
         8 001234   200064 236100                    LDQ     @PORT+2,,AUTO
         8 001235   000021 036000 9                  ADLQ    17
         8 001236   000276 757000 1                  STAQ    FPT_FID+2

      435     7442    4          CALL M$FID (FPT_FID) WHENALTRETURN DO;

   7442  8 001237   000274 630400 1                  EPPR0   FPT_FID
         8 001240   420001 713400                    CLIMB   alt,+8193
         8 001241   404400 401760                    pmme    nvectors=10
         8 001242   001244 702000 8                  TSX2    s:7443
         8 001243   001250 710000 8                  TRA     s:7446

      436     7443    4              CALL REPORT_ALT;

   7443  8 001244   003466 701000 8                  TSX1    REPORT_ALT
         8 001245   000000 011000                    NOP     0
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:82   

      437     7444    4              ALTRETURN;

   7444  8 001246   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 001247   000000 702211                    TSX2  ! 0,X1

      438     7445    4              END;
      439     7446    3          END;

   7446  8 001250   001260 710000 8                  TRA     s:7452

      440     7447    3      ELSE DO;

      441     7448    3          VLP_ACCT.ACCT# = B$JIT.ACCN;

   7448  8 001251   000000 471400 xsym               LDP1    B$JIT$
         8 001252   040000 100500                    MLR     fill='040'O
         8 001253   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
         8 001254   000252 000010 1                  ADSC9   VLP_ACCT                 cn=0,n=8

      442     7449    3          VLP_SN.SN#(0) = ' ';

   7449  8 001255   040000 100400                    MLR     fill='040'O
         8 001256   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         8 001257   000267 000006 1                  ADSC9   VLP_SN+1                 cn=0,n=6

      443     7450    3          END;

      444     7451
      445     7452    3      CALL M$SETFMA (FPT_SETFMA) WHENALTRETURN DO;

   7452  8 001260   000720 630400 3                  EPPR0   FPT_SETFMA
         8 001261   460001 713400                    CLIMB   alt,+24577
         8 001262   400400 401760                    pmme    nvectors=2
         8 001263   001265 702000 8                  TSX2    s:7453
         8 001264   001271 710000 8                  TRA     s:7456

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:83   
      446     7453    3          CALL REPORT_ALT;

   7453  8 001265   003466 701000 8                  TSX1    REPORT_ALT
         8 001266   000000 011000                    NOP     0

      447     7454    3          ALTRETURN;

   7454  8 001267   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 001270   000000 702211                    TSX2  ! 0,X1

      448     7455    3          END;
      449     7456    2      RETURN;

   7456  8 001271   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 001272   000001 702211                    TSX2  ! 1,X1

      450     7457    2   END DIR_CMD;
      451     7458        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:84   
      452     7459    1   LIST_CMD: PROC (CMDT) ALTRET;

   7459  8 001273   200032 741300       LIST_CMD     STX1  ! TFID+21,,AUTO

      453     7460    2   DCL CMDT CHAR(6);
      454     7461        %FPT_LINK (STCLASS=CONSTANT, NAME=VLP_PCL, ACCT=VLP_SYS, CMD=CMD);
      455     7479    2   DCL 1 CMD STATIC, 2 L UBIN BYTE UNAL INIT(255), 2 BUF CHAR(255);
      456     7480        %VLP_NAME (FPTN=VLP_PCL, STCLASS=CONSTANT, NAME='PCL');
      457     7507        %VLP_ACCT (FPTN=VLP_SYS, STCLASS=CONSTANT, ACCT=':SYS');
      458     7520        %VLP_NAME (FPTN=VLP_STARL, STCLASS=CONSTANT, NAME='*L');
      459     7547    2   DCL M$DO DCB;
      460     7548        %FPT_YC (FPTN=SETDO, STCLASS=CONSTANT, CMD=SETDOCMD);
      461     7565    2   DCL SETDOCMD CONSTANT CHAR(0) INIT('SET M$DO *DO,EXI=O');
      462     7566        %FPT_OPEN (FPTN=DELDO, STCLASS=CONSTANT, DCB=M$DO, SCRUB=YES, REASSIGN=YES,
      463     7567                   FUN=UPDATE, DELETE=YES);
      464     7676        %FPT_CLOSE (FPTN=CLSDO, STCLASS=CONSTANT, DCB=M$DO, DISP=SAVE);
      465     7718        %FPT_READ (FPTN=READDO, STCLASS=CONSTANT, DCB=M$DO, BUF=LINE_BUF);
      466     7757
      467     7758    2      CMD.BUF = CMDT;

   7758  8 001274   200033 470500                    LDP0    @CMDT,,AUTO
         8 001275   040000 100500                    MLR     fill='040'O
         8 001276   000000 000006                    ADSC9   0,,PR0                   cn=0,n=6
         8 001277   000375 200377 1                  ADSC9   CMD                      cn=1,n=255

      468     7759    2      FPT_FID.TEXTFID_ = VECTOR (B$JIT.FACCN);

   7759  8 001300   000015 235000 9                  LDA     13
         8 001301   000000 236000 xsym               LDQ     B$JIT$
         8 001302   000006 036003                    ADLQ    6,DU
         8 001303   000276 757000 1                  STAQ    FPT_FID+2

      469     7760    3      IF OUT$BLK.NSUBLKS>0 THEN DO;

   7760  8 001304   200003 471500                    LDP1    PARSE$,,AUTO
         8 001305   100001 220100                    LDX0    1,,PR1
         8 001306   001327 600000 8                  TZE     s:7764
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:85   

      470     7761    3          SUBSTR( CMD.BUF, 7) = OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT;

   7761  8 001307   100003 473500                    LDP3    3,,PR1
         8 001310   300004 236100                    LDQ     4,,PR3
         8 001311   000033 772000                    QRL     27
         8 001312   000000 622006                    EAX2    0,QL
         8 001313   040000 100540                    MLR     fill='040'O
         8 001314   300004 200012                    ADSC9   4,,PR3                   cn=1,n=*X2
         8 001315   000377 000370 1                  ADSC9   CMD+2                    cn=0,n=248

      471     7762    3          FPT_FID.TEXTFID_ = VECTOR (OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT);

   7762  8 001316   100003 473500                    LDP3    3,,PR1
         8 001317   300004 236100                    LDQ     4,,PR3
         8 001320   000033 772000                    QRL     27
         8 001321   000064 737000                    LLS     52
         8 001322   000140 135007                    SBLA    96,DL
         8 001323   200064 453500                    STP3    @PORT+2,,AUTO
         8 001324   200064 236100                    LDQ     @PORT+2,,AUTO
         8 001325   000021 036000 9                  ADLQ    17
         8 001326   000276 757000 1                  STAQ    FPT_FID+2

      472     7763    3          END;

      473     7764    2      SUBSTR( CMD.BUF, 240) = 'OVER *L';

   7764  8 001327   040000 100400                    MLR     fill='040'O
         8 001330   001230 000007 3                  ADSC9   IPFMT+22                 cn=0,n=7
         8 001331   000471 200017 1                  ADSC9   CMD+60                   cn=1,n=15

      474     7765    2      IF SUBSTR( CMD.BUF, 3, 1) = '=' THEN SUBSTR( CMD.BUF, 247) = '(NSUM)';

   7765  8 001332   000376 236000 1                  LDQ     CMD+1
         8 001333   777000 376003                    ANQ     -512,DU
         8 001334   075000 116003                    CMPQ    31232,DU
         8 001335   001341 601000 8                  TNZ     s:7767
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:86   

   7765  8 001336   040000 100400                    MLR     fill='040'O
         8 001337   001232 000006 3                  ADSC9   IPFMT+24                 cn=0,n=6
         8 001340   000473 000010 1                  ADSC9   CMD+62                   cn=0,n=8

      475     7766
      476     7767    2      IF NOT DCBADDR (DCBNUM (M$DO)) -> F$DCB.AMR#

   7767  8 001341   000000 236007 xsym               LDQ     M$DO,DL
         8 001342   000027 473400 9                  LDP3    23
         8 001343   300000 474500                    LDP4    0,,PR3
         8 001344   400000 475506                    LDP5    0,QL,PR4
         8 001345   500031 236100                    LDQ     25,,PR5
         8 001346   010000 316007                    CANQ    4096,DL
         8 001347   001355 601000 8                  TNZ     s:7769

      477     7768    3      THEN CALL M$YC (SETDO) WHENALTRETURN DO; END;

   7768  8 001350   000750 630400 3                  EPPR0   SETDO
         8 001351   400011 713400                    CLIMB   alt,+9
         8 001352   401000 401760                    pmme    nvectors=3
         8 001353   001355 702000 8                  TSX2    s:7769
         8 001354   001355 710000 8                  TRA     s:7769

      478     7769    2      CALL M$CLOSE (CLSDO);

   7769  8 001355   001060 630400 3                  EPPR0   CLSDO
         8 001356   050001 713400                    CLIMB   close
         8 001357   406000 401760                    pmme    nvectors=13

      479     7770    3      CALL M$OPEN (DELDO) WHENALTRETURN DO; END;

   7770  8 001360   000766 630400 3                  EPPR0   DELDO
         8 001361   450000 713400                    CLIMB   alt,open
         8 001362   410400 401760                    pmme    nvectors=18
         8 001363   001365 702000 8                  TSX2    s:7772
         8 001364   001365 710000 8                  TRA     s:7772
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:87   

      480     7771
      481     7772    3      CALL M$LINK (FPT_LINK) WHENALTRETURN DO;

   7772  8 001365   000724 630400 3                  EPPR0   FPT_LINK
         8 001366   400005 713400                    CLIMB   alt,+5
         8 001367   403000 401760                    pmme    nvectors=7
         8 001370   001372 702000 8                  TSX2    s:7773
         8 001371   001432 710000 8                  TRA     s:7784

      482     7773    3          CALL M$REW (READDO);

   7773  8 001372   001116 630400 3                  EPPR0   READDO
         8 001373   040006 713400                    CLIMB   16390
         8 001374   400000 401760                    pmme    nvectors=1

      483     7774    4          CALL M$READ (READDO) WHENRETURN DO;

   7774  8 001375   001116 630400 3                  EPPR0   READDO
         8 001376   440000 713400                    CLIMB   alt,read
         8 001377   401400 401760                    pmme    nvectors=4
         8 001400   001424 702000 8                  TSX2    s:7779

      484     7775    4              CHARNLEN = DCBADDR(DCBNUM(M$DO)) -> F$DCB.ARS#;

   7775  8 001401   000000 236007 xsym               LDQ     M$DO,DL
         8 001402   000027 470400 9                  LDP0    23
         8 001403   000000 471500                    LDP1    0,,PR0
         8 001404   100000 473506                    LDP3    0,QL,PR1
         8 001405   300000 235100                    LDA     0,,PR3
         8 001406   000125 755000 1                  STA     CHARNLEN

      485     7776    4              CALL SEND_MSG (MSG_550, VECTOR(ADDR(LINE_BUF)->CHARN));

   7776  8 001407   000020 735000                    ALS     16
         8 001410   000140 135007                    SBLA    96,DL
         8 001411   000013 236000 9                  LDQ     11
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:88   
         8 001412   200064 757100                    STAQ    @PORT+2,,AUTO
         8 001413   200064 633500                    EPPR3   @PORT+2,,AUTO
         8 001414   200067 453500                    STP3    @PORT+5,,AUTO
         8 001415   000053 236000 9                  LDQ     43
         8 001416   200066 756100                    STQ     @PORT+4,,AUTO
         8 001417   200066 630500                    EPPR0   @PORT+4,,AUTO
         8 001420   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 001421   000000 701000 xent               TSX1    SEND_MSG
         8 001422   000000 011000                    NOP     0

      486     7777    4              END;

   7777  8 001423   001430 710000 8                  TRA     RETALT

      487     7778    4          WHENALTRETURN DO;

      488     7779    4              CALL SEND_MSG (MSG_501);

   7779  8 001424   000025 630400 9                  EPPR0   21
         8 001425   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 001426   000000 701000 xent               TSX1    SEND_MSG
         8 001427   000000 011000                    NOP     0

      489     7780    4              END;

      490     7781    3   RETALT: ALTRETURN;

   7781  8 001430   200032 221300       RETALT       LDX1  ! TFID+21,,AUTO
         8 001431   000000 702211                    TSX2  ! 0,X1

      491     7782    3          END;
      492     7783
      493     7784    2      VLP_NAME = VLP_STARL;

   7784  8 001432   000000 100400                    MLR     fill='000'O
         8 001433   000747 000003 3                  ADSC9   VLP_STARL                cn=0,n=3
         8 001434   000254 000040 1                  ADSC9   VLP_NAME                 cn=0,n=32
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:89   

      494     7785    2      FPT_OPEN.V.ASN# = %FILE#;

   7785  8 001435   000001 236007                    LDQ     1,DL
         8 001436   000225 552004 1                  STBQ    FPT_OPEN+37,'04'O

      495     7786    2      CALL PUT_STARL ALTRET (RETALT);

   7786  8 001437   002620 701000 8                  TSX1    PUT_STARL
         8 001440   001430 702000 8                  TSX2    RETALT

      496     7787
      497     7788    2      RETURN;

   7788  8 001441   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 001442   000001 702211                    TSX2  ! 1,X1

      498     7789    2   END LIST_CMD;
      499     7790        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:90   
      500     7791    1   RENAME_CMD: PROC;

   7791  8 001443   200032 741300       RENAME_CMD   STX1  ! TFID+21,,AUTO

      501     7792
      502     7793        %FPT_CLOSE (FPTN=RENAME, STCLASS=CONSTANT, DCB=F$FILE, CHGATT=YES,
      503     7794                    NAME=VLP_NAME, PASS=VLP_PASS);
      504     7836
      505     7837    2      FPT_FID.TEXTFID_ = VECTOR( OUT$BLK.SUBLK$(0) -> OUT$SYM.TEXT);

   7837  8 001444   200003 470500                    LDP0    PARSE$,,AUTO
         8 001445   000003 471500                    LDP1    3,,PR0
         8 001446   100004 236100                    LDQ     4,,PR1
         8 001447   000033 772000                    QRL     27
         8 001450   000064 737000                    LLS     52
         8 001451   000140 135007                    SBLA    96,DL
         8 001452   200064 451500                    STP1    @PORT+2,,AUTO
         8 001453   200064 236100                    LDQ     @PORT+2,,AUTO
         8 001454   000021 036000 9                  ADLQ    17
         8 001455   000276 757000 1                  STAQ    FPT_FID+2

      506     7838    3      CALL M$FID (FPT_FID) WHENALTRETURN DO;

   7838  8 001456   000274 630400 1                  EPPR0   FPT_FID
         8 001457   420001 713400                    CLIMB   alt,+8193
         8 001460   404400 401760                    pmme    nvectors=10
         8 001461   001463 702000 8                  TSX2    BADFID
         8 001462   001470 710000 8                  TRA     s:7844

   7834  8 001463                       BADFID       null
      507     7839    3   BADFID: ;
      508     7840    3          CALL SEND_MSG(MSG_501);

   7840  8 001463   000025 630400 9                  EPPR0   21
         8 001464   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 001465   000000 701000 xent               TSX1    SEND_MSG
         8 001466   000000 011000                    NOP     0
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:91   

      509     7841    3          GOTO NORNFR_PENDING;

   7841  8 001467   001553 710000 8                  TRA     NORNFR_PENDING

      510     7842    3          END;
      511     7843
      512     7844    2      IF FPT_OPEN.V.ASN# ~= %FILE# THEN GOTO BADFID;

   7844  8 001470   000225 236000 1                  LDQ     FPT_OPEN+37
         8 001471   000777 376007                    ANQ     511,DL
         8 001472   000001 116007                    CMPQ    1,DL
         8 001473   001463 601000 8                  TNZ     BADFID

      513     7845    2      FPT_OPEN.V.FUN# = %UPDATE#;

   7845  8 001474   001000 236007                    LDQ     512,DL
         8 001475   000225 552010 1                  STBQ    FPT_OPEN+37,'10'O

      514     7846    3      IF OUT$BLK.SUBLK$(0) -> OUT$SYM.CODE = 0 THEN DO;

   7846  8 001476   200003 470500                    LDP0    PARSE$,,AUTO
         8 001477   000003 471500                    LDP1    3,,PR0
         8 001500   100000 720100                    LXL0    0,,PR1
         8 001501   001522 601000 8                  TNZ     s:7855

      515     7847    4          CALL M$OPEN (FPT_OPEN) WHENALTRETURN DO;

   7847  8 001502   000160 630400 1                  EPPR0   FPT_OPEN
         8 001503   450000 713400                    CLIMB   alt,open
         8 001504   410400 401760                    pmme    nvectors=18
         8 001505   001507 702000 8                  TSX2    REPALT
         8 001506   001512 710000 8                  TRA     s:7851

      516     7848    4   REPALT:    CALL REPORT_ALT;

   7848  8 001507   003466 701000 8     REPALT       TSX1    REPORT_ALT
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:92   
         8 001510   000000 011000                    NOP     0

      517     7849    4              GOTO NORNFR_PENDING;

   7849  8 001511   001553 710000 8                  TRA     NORNFR_PENDING

      518     7850    4              END;
      519     7851    3          CALL SEND_MSG (MSG_350RNFR);

   7851  8 001512   000054 630400 9                  EPPR0   44
         8 001513   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 001514   000000 701000 xent               TSX1    SEND_MSG
         8 001515   000000 011000                    NOP     0

      520     7852    3          RNFR_PENDING = '1'B;

   7852  8 001516   400000 236003                    LDQ     -131072,DU
         8 001517   000360 756000 1                  STQ     RNFR_PENDING

      521     7853    3          RETURN;

   7853  8 001520   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 001521   000001 702211                    TSX2  ! 1,X1

      522     7854    3          END;
      523     7855    2      ELSE IF NOT RNFR_PENDING THEN CALL SEND_MSG (MSG_503);

   7855  8 001522   000360 235000 1                  LDA     RNFR_PENDING
         8 001523   001531 601000 8                  TNZ     s:7857

   7855  8 001524   000002 630400 9                  EPPR0   2
         8 001525   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 001526   000000 701000 xent               TSX1    SEND_MSG
         8 001527   000000 011000                    NOP     0
         8 001530   001553 710000 8                  TRA     NORNFR_PENDING

      524     7856    3          ELSE DO;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:93   

      525     7857    3              IF VLP_ACCT.ACCT# ~= ' ' OR VLP_SN.SN#(0) ~= ' ' OR VLP_WSN.WSN# ~= ' '

   7857  8 001531   000252 237000 1                  LDAQ    VLP_ACCT
         8 001532   000056 117000 9                  CMPAQ   46
         8 001533   001463 601000 8                  TNZ     BADFID
         8 001534   040000 106400                    CMPC    fill='040'O
         8 001535   000267 000006 1                  ADSC9   VLP_SN+1                 cn=0,n=6
         8 001536   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         8 001537   001463 601000 8                  TNZ     BADFID
         8 001540   000272 237000 1                  LDAQ    VLP_WSN
         8 001541   000056 117000 9                  CMPAQ   46
         8 001542   001463 601000 8                  TNZ     BADFID

      526     7858    3              THEN GOTO BADFID;
      527     7859
      528     7860    3              CALL M$CLOSE (RENAME) ALTRET (REPALT);

   7860  8 001543   001134 630400 3                  EPPR0   RENAME
         8 001544   450001 713400                    CLIMB   alt,close
         8 001545   406000 401760                    pmme    nvectors=13
         8 001546   001507 702000 8                  TSX2    REPALT

      529     7861    3              CALL SEND_MSG (MSG_250RNTO, FPT_FID.TEXTFID_);

   7861  8 001547   000060 630400 9                  EPPR0   48
         8 001550   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 001551   000000 701000 xent               TSX1    SEND_MSG
         8 001552   000000 011000                    NOP     0

      530     7862    3              END;

   7861  8 001553                       NORNFR_PEND* null
      531     7863
      532     7864    2   NORNFR_PENDING:;
      533     7865    2      CALL M$CLOSE (FPT_CLOSE);

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:94   
   7865  8 001553   000040 630400 3                  EPPR0   FPT_CLOSE
         8 001554   050001 713400                    CLIMB   close
         8 001555   406000 401760                    pmme    nvectors=13

      534     7866    2      RNFR_PENDING = '0'B;

   7866  8 001556   000360 450000 1                  STZ     RNFR_PENDING

      535     7867    2      RETURN;

   7867  8 001557   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 001560   000001 702211                    TSX2  ! 1,X1

      536     7868
      537     7869    2   END RENAME_CMD;
      538     7870        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:95   
      539     7871    1   DELETE_CMD: PROC ALTRET;

   7871  8 001561   200032 741300       DELETE_CMD   STX1  ! TFID+21,,AUTO

      540     7872
      541     7873    2      FPT_FID.TEXTFID_ = VECTOR (OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT);

   7873  8 001562   200003 470500                    LDP0    PARSE$,,AUTO
         8 001563   000003 471500                    LDP1    3,,PR0
         8 001564   100004 236100                    LDQ     4,,PR1
         8 001565   000033 772000                    QRL     27
         8 001566   000064 737000                    LLS     52
         8 001567   000140 135007                    SBLA    96,DL
         8 001570   200064 451500                    STP1    @PORT+2,,AUTO
         8 001571   200064 236100                    LDQ     @PORT+2,,AUTO
         8 001572   000021 036000 9                  ADLQ    17
         8 001573   000276 757000 1                  STAQ    FPT_FID+2

      542     7874    3      CALL M$FID (FPT_FID) WHENALTRETURN DO;

   7874  8 001574   000274 630400 1                  EPPR0   FPT_FID
         8 001575   420001 713400                    CLIMB   alt,+8193
         8 001576   404400 401760                    pmme    nvectors=10
         8 001577   001601 702000 8                  TSX2    REPALT
         8 001600   001607 710000 8                  TRA     s:7880

   7874  8 001601                       REPALT       null
      543     7875    3   REPALT:;
      544     7876    3          FPT_OPEN.V.DELETE# = '0'B;

   7876  8 001601   000062 236000 9                  LDQ     50
         8 001602   000224 356000 1                  ANSQ    FPT_OPEN+36

      545     7877    3          CALL REPORT_ALT;

   7877  8 001603   003466 701000 8                  TSX1    REPORT_ALT
         8 001604   000000 011000                    NOP     0
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:96   

      546     7878    3          ALTRETURN;

   7878  8 001605   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 001606   000000 702211                    TSX2  ! 0,X1

      547     7879    3          END;
      548     7880    2      FPT_OPEN.V.DELETE# = '1'B;

   7880  8 001607   040000 236007                    LDQ     16384,DL
         8 001610   000224 256000 1                  ORSQ    FPT_OPEN+36

      549     7881    2      FPT_OPEN.V.FUN# = %UPDATE#;

   7881  8 001611   001000 236007                    LDQ     512,DL
         8 001612   000225 552010 1                  STBQ    FPT_OPEN+37,'10'O

      550     7882    2      CALL M$OPEN (FPT_OPEN) ALTRET (REPALT);

   7882  8 001613   000160 630400 1                  EPPR0   FPT_OPEN
         8 001614   450000 713400                    CLIMB   alt,open
         8 001615   410400 401760                    pmme    nvectors=18
         8 001616   001601 702000 8                  TSX2    REPALT

      551     7883    2      FPT_OPEN.V.DELETE# = '0'B;

   7883  8 001617   000062 236000 9                  LDQ     50
         8 001620   000224 356000 1                  ANSQ    FPT_OPEN+36

      552     7884    2      CALL SEND_MSG (MSG_250DEL, FPT_FID.TEXTFID_);

   7884  8 001621   000063 630400 9                  EPPR0   51
         8 001622   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 001623   000000 701000 xent               TSX1    SEND_MSG
         8 001624   000000 011000                    NOP     0

      553     7885
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:97   
      554     7886    2      RETURN;

   7886  8 001625   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 001626   000001 702211                    TSX2  ! 1,X1

      555     7887    2   END DELETE_CMD;
      556     7888        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:98   
      557     7889    1   HELP_CMD: PROC;

   7889  8 001627   200032 741300       HELP_CMD     STX1  ! TFID+21,,AUTO

      558     7890        %FPT_HELP (BUF=LINE_BUF, KEY1=KEY1, KEY2=KEY2, RESULTS=VLR_HELP,
      559     7891                   PROCPSN=P.PSN, PROCNAME=P.NAME, PROCACCT=P.ACCT, PROCPASS=P.PASS);
      560     7912    2   DCL KEY1(0:35) UBIN BYTE UNAL STATIC INIT(0);
      561     7913    2   DCL KEY2(0:35) UBIN BYTE UNAL STATIC INIT(0);
      562     7914        %VLR_HELP;
      563     7943    2   DCL MSG0 CONSTANT CHAR(8) INIT(%CONCAT(BINASC(3),'214'));
      564     7944    2   DCL DASH CONSTANT CHAR(1) INIT('-');
      565     7945    2   DCL MSGI CONSTANT CHAR(8) INIT(BINASC(1));
      566     7946        %EQU BACK4=CONCAT(BINASC(8),BINASC(8),BINASC(8),BINASC(8));
      567     7947    2   DCL MSGN CONSTANT CHAR(12) INIT(%CONCAT(BINASC(9),'214 ',BACK4,' '));
      568     7948    2   DCL 1 P STATIC, 2 NAME(0:31) CHAR(1) INIT(BINASC(4),'F','T','P','D',' '*0),
      569     7949    2             2 PSN CHAR(6) INIT(' '),
      570     7950    2             2 ACCT CHAR(8) INIT(' '),
      571     7951    2             2 PASS CHAR(8) INIT(' ');
      572     7952    2   DCL PCH REDEF P CHAR(54);
      573     7953    2   DCL SUBLK$ PTR;
      574     7954        %PARSE$OUT (NAME=SUB$BLK, STCLASS="BASED(SUBLK$)");
      575     7999    2   DCL 1 TEXTC BASED ALIGNED,2 L UBIN BYTE UNAL,2 T CHAR(TEXTC.L);
      576     8000    2   DCL I SBIN;
      577     8001
      578     8002    3      IF OUT$BLK.NSUBLKS=0 THEN DO;

   8002  8 001630   200003 470500                    LDP0    PARSE$,,AUTO
         8 001631   000001 220100                    LDX0    1,,PR0
         8 001632   001641 601000 8                  TNZ     s:8007

      579     8003    3          CALL SEND_MSG (MSG_214);

   8003  8 001633   000065 630400 9                  EPPR0   53
         8 001634   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 001635   000000 701000 xent               TSX1    SEND_MSG
         8 001636   000000 011000                    NOP     0

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:99   
      580     8004    3          RETURN;

   8004  8 001637   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 001640   000001 702211                    TSX2  ! 1,X1

      581     8005    3          END;
      582     8006
      583     8007    2      FPT_HELP.V.ALL# = '0'B;

   8007  8 001641   000066 236000 9                  LDQ     54
         8 001642   000521 356000 1                  ANSQ    FPT_HELP+19

      584     8008    2      FPT_HELP.V.LIST# = '0'B;

   8008  8 001643   000067 236000 9                  LDQ     55
         8 001644   000521 356000 1                  ANSQ    FPT_HELP+19

      585     8009    2      FPT_HELP.V.MORE# = '0'B;

   8009  8 001645   000070 236000 9                  LDQ     56
         8 001646   000521 356000 1                  ANSQ    FPT_HELP+19

      586     8010    2      FPT_HELP.V.RANGE# = '0'B;

   8010  8 001647   000071 236000 9                  LDQ     57
         8 001650   000521 356000 1                  ANSQ    FPT_HELP+19

      587     8011    2      IF OUT$BLK.NSUBLKS=1 AND OUT$BLK.SUBLK$(0) -> OUT$SYM.CODE = 1

   8011  8 001651   000001 220100                    LDX0    1,,PR0
         8 001652   000001 100003                    CMPX0   1,DU
         8 001653   001712 601000 8                  TNZ     s:8019
         8 001654   000003 471500                    LDP1    3,,PR0
         8 001655   100000 722100                    LXL2    0,,PR1
         8 001656   000001 102003                    CMPX2   1,DU
         8 001657   001712 601000 8                  TNZ     s:8019
         8 001660   100004 236100                    LDQ     4,,PR1
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:100  
         8 001661   000033 772000                    QRL     27
         8 001662   000000 623006                    EAX3    0,QL
         8 001663   040000 106540                    CMPC    fill='040'O
         8 001664   100004 200013                    ADSC9   4,,PR1                   cn=1,n=*X3
         8 001665   000072 000001 9                  ADSC9   58                       cn=0,n=1
         8 001666   001673 600000 8                  TZE     s:8014
         8 001667   040000 106540                    CMPC    fill='040'O
         8 001670   100004 200013                    ADSC9   4,,PR1                   cn=1,n=*X3
         8 001671   001234 000002 3                  ADSC9   IPFMT+26                 cn=0,n=2
         8 001672   001712 601000 8                  TNZ     s:8019

      588     8012    2            AND (OUT$BLK.SUBLK$(0) -> OUT$SYM.TEXT = '?'
      589     8013    3            OR OUT$BLK.SUBLK$(0) -> OUT$SYM.TEXT = '??') THEN DO;

      590     8014    3          IF OUT$BLK.SUBLK$(0) -> OUT$SYM.COUNT = 2 THEN FPT_HELP.V.ALL# = '1'B;

   8014  8 001673   000033 736000                    QLS     27
         8 001674   002000 116003                    CMPQ    1024,DU
         8 001675   001701 601000 8                  TNZ     s:8015

   8014  8 001676   000004 236007                    LDQ     4,DL
         8 001677   000521 256000 1                  ORSQ    FPT_HELP+19
         8 001700   001711 710000 8                  TRA     s:8017

      591     8015    3          ELSE IF VLR_HELP.NOMSG THEN FPT_HELP.V.LIST# = '1'B;

   8015  8 001701   000546 236000 1                  LDQ     VLR_HELP
         8 001702   100000 316003                    CANQ    32768,DU
         8 001703   001707 600000 8                  TZE     s:8016

   8015  8 001704   000010 236007                    LDQ     8,DL
         8 001705   000521 256000 1                  ORSQ    FPT_HELP+19
         8 001706   001711 710000 8                  TRA     s:8017

      592     8016    3              ELSE FPT_HELP.V.MORE# = '1'B;

   8016  8 001707   000002 236007                    LDQ     2,DL
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:101  
         8 001710   000521 256000 1                  ORSQ    FPT_HELP+19

      593     8017    3          GOTO DO_M$HELP;

   8017  8 001711   002042 710000 8                  TRA     DO_M$HELP

      594     8018    3          END;
      595     8019    2      KEY1(0) = 0;

   8019  8 001712   000000 236003                    LDQ     0,DU
         8 001713   000524 552040 1                  STBQ    KEY1,'40'O

      596     8020    2      KEY2(0) = 0;

   8020  8 001714   000535 552040 1                  STBQ    KEY2,'40'O

      597     8021    3      DO I=0 TO OUT$BLK.NSUBLKS-1;

   8021  8 001715   200034 450100                    STZ     I,,AUTO
         8 001716   002036 710000 8                  TRA     s:8044+1

      598     8022    3          SUBLK$ = OUT$BLK.SUBLK$(I);

   8022  8 001717   200003 470500                    LDP0    PARSE$,,AUTO
         8 001720   200034 720100                    LXL0    I,,AUTO
         8 001721   000003 236110                    LDQ     3,X0,PR0
         8 001722   200033 756100                    STQ     SUBLK$,,AUTO

      599     8023    4          IF SUB$BLK.CODE < 1 THEN DO;

   8023  8 001723   200033 471500                    LDP1    SUBLK$,,AUTO
         8 001724   100000 721100                    LXL1    0,,PR1
         8 001725   002016 601000 8                  TNZ     s:8041

      600     8024    4              IF SUB$BLK.NSUBLKS = 0

   8024  8 001726   100001 222100                    LDX2    1,,PR1
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:102  
         8 001727   001733 601000 8                  TNZ     s:8027

      601     8025    4              THEN FPT_HELP.V.LIST# = '1'B; /* No subblocks is topcs */

   8025  8 001730   000010 236007                    LDQ     8,DL
         8 001731   000521 256000 1                  ORSQ    FPT_HELP+19
         8 001732   002035 710000 8                  TRA     s:8044

      602     8026    5              ELSE DO;

      603     8027    5                  PCH = BINASC(1);

   8027  8 001733   040000 100400                    MLR     fill='040'O
         8 001734   000073 000001 9                  ADSC9   59                       cn=0,n=1
         8 001735   000564 000066 1                  ADSC9   P                        cn=0,n=54

      604     8028    6                  IF SUB$BLK.SUBLK$(0) -> OUT$SYM.CODE > 0 THEN DO;

   8028  8 001736   100003 473500                    LDP3    3,,PR1
         8 001737   300000 721100                    LXL1    0,,PR3
         8 001740   001751 600000 8                  TZE     s:8032

      605     8029    6                      P.PSN = SUB$BLK.SUBLK$(0) -> OUT$SYM.TEXT;

   8029  8 001741   300004 236100                    LDQ     4,,PR3
         8 001742   000033 772000                    QRL     27
         8 001743   000000 622006                    EAX2    0,QL
         8 001744   040000 100540                    MLR     fill='040'O
         8 001745   300004 200012                    ADSC9   4,,PR3                   cn=1,n=*X2
         8 001746   000574 000006 1                  ADSC9   P+8                      cn=0,n=6

      606     8030    6                      SUBLK$ = SUB$BLK.SUBLK$(1);

   8030  8 001747   100004 236100                    LDQ     4,,PR1
         8 001750   200033 756100                    STQ     SUBLK$,,AUTO

      607     8031    6                      END;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:103  

      608     8032    5                  IF SUB$BLK.SUBLK$(0) -> OUT$SYM.TEXT = '?'

   8032  8 001751   200033 471500                    LDP1    SUBLK$,,AUTO
         8 001752   100003 473500                    LDP3    3,,PR1
         8 001753   300004 236100                    LDQ     4,,PR3
         8 001754   000033 772000                    QRL     27
         8 001755   000000 621006                    EAX1    0,QL
         8 001756   040000 106540                    CMPC    fill='040'O
         8 001757   300004 200011                    ADSC9   4,,PR3                   cn=1,n=*X1
         8 001760   000072 000001 9                  ADSC9   58                       cn=0,n=1
         8 001761   001765 601000 8                  TNZ     s:8034

      609     8033    5                  THEN FPT_HELP.V.LIST# = '1'B;

   8033  8 001762   000010 236007                    LDQ     8,DL
         8 001763   000521 256000 1                  ORSQ    FPT_HELP+19
         8 001764   001771 710000 8                  TRA     s:8035

      610     8034    5                  ELSE P.NAME = ADDR(SUB$BLK.SUBLK$(0) -> OUT$SYM.COUNT) -> TEXTC;

   8034  8 001765   000001 622011                    EAX2    1,X1
         8 001766   000000 100540                    MLR     fill='000'O
         8 001767   300004 000012                    ADSC9   4,,PR3                   cn=0,n=*X2
         8 001770   000564 000040 1                  ADSC9   P                        cn=0,n=32

      611     8035    5                  IF SUB$BLK.NSUBLKS = 1 THEN EXIT;

   8035  8 001771   100001 221100                    LDX1    1,,PR1
         8 001772   000001 101003                    CMPX1   1,DU
         8 001773   002015 600000 8                  TZE     s:8040

      612     8036    5                  P.ACCT = SUB$BLK.SUBLK$(1) -> OUT$SYM.TEXT;

   8036  8 001774   100004 473500                    LDP3    4,,PR1
         8 001775   300004 236100                    LDQ     4,,PR3
         8 001776   000033 772000                    QRL     27
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:104  
         8 001777   000000 622006                    EAX2    0,QL
         8 002000   040000 100540                    MLR     fill='040'O
         8 002001   300004 200012                    ADSC9   4,,PR3                   cn=1,n=*X2
         8 002002   000575 400010 1                  ADSC9   P+9                      cn=2,n=8

      613     8037    5                  IF SUB$BLK.NSUBLKS = 2 THEN EXIT;

   8037  8 002003   100001 221100                    LDX1    1,,PR1
         8 002004   000002 101003                    CMPX1   2,DU
         8 002005   002015 600000 8                  TZE     s:8040

      614     8038    5                  P.PASS = SUB$BLK.SUBLK$(2) -> OUT$SYM.TEXT;

   8038  8 002006   100005 473500                    LDP3    5,,PR1
         8 002007   300004 236100                    LDQ     4,,PR3
         8 002010   000033 772000                    QRL     27
         8 002011   000000 622006                    EAX2    0,QL
         8 002012   040000 100540                    MLR     fill='040'O
         8 002013   300004 200012                    ADSC9   4,,PR3                   cn=1,n=*X2
         8 002014   000577 400010 1                  ADSC9   P+11                     cn=2,n=8

      615     8039    5                  END;

      616     8040    4              END;

   8040  8 002015   002035 710000 8                  TRA     s:8044

      617     8041    3          ELSE IF SUB$BLK.CODE = 1         /* KEY1 */

   8041  8 002016   000001 101003                    CMPX1   1,DU
         8 002017   002027 601000 8                  TNZ     s:8043

      618     8042    3              THEN KEY1 = ADDR(SUBLK$ -> OUT$SYM.COUNT) -> TEXTC;

   8042  8 002020   100004 236100                    LDQ     4,,PR1
         8 002021   000033 772000                    QRL     27
         8 002022   000001 622006                    EAX2    1,QL
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:105  
         8 002023   000000 100540                    MLR     fill='000'O
         8 002024   100004 000012                    ADSC9   4,,PR1                   cn=0,n=*X2
         8 002025   000524 000044 1                  ADSC9   KEY1                     cn=0,n=36
         8 002026   002035 710000 8                  TRA     s:8044

      619     8043    3              ELSE KEY2 = ADDR(SUBLK$ -> OUT$SYM.COUNT) -> TEXTC;

   8043  8 002027   100004 236100                    LDQ     4,,PR1
         8 002030   000033 772000                    QRL     27
         8 002031   000001 622006                    EAX2    1,QL
         8 002032   000000 100540                    MLR     fill='000'O
         8 002033   100004 000012                    ADSC9   4,,PR1                   cn=0,n=*X2
         8 002034   000535 000044 1                  ADSC9   KEY2                     cn=0,n=36

      620     8044    3          END;

   8044  8 002035   200034 054100                    AOS     I,,AUTO
         8 002036   000001 236100                    LDQ     1,,PR0
         8 002037   000022 772000                    QRL     18
         8 002040   200034 116100                    CMPQ    I,,AUTO
         8 002041   001717 605400 8                  TPNZ    s:8022

   8043  8 002042                       DO_M$HELP    null
      621     8045
      622     8046    2   DO_M$HELP: ;
      623     8047    3      CALL M$HELP (FPT_HELP) WHENALTRETURN DO;

   8047  8 002042   000476 630400 1                  EPPR0   FPT_HELP
         8 002043   420024 713400                    CLIMB   alt,+8212
         8 002044   404000 401760                    pmme    nvectors=9
         8 002045   002047 702000 8                  TSX2    s:8048
         8 002046   002053 710000 8                  TRA     s:8051

      624     8048    3          CALL REPORT_ALT;

   8048  8 002047   003466 701000 8                  TSX1    REPORT_ALT
         8 002050   000000 011000                    NOP     0
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:106  

      625     8049    3          RETURN;

   8049  8 002051   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 002052   000001 702211                    TSX2  ! 1,X1

      626     8050    3          END;
      627     8051    3      IF NOT VLR_HELP.MSGCOMP THEN DO;

   8051  8 002053   000546 236000 1                  LDQ     VLR_HELP
         8 002054   020000 316003                    CANQ    8192,DU
         8 002055   002064 601000 8                  TNZ     s:8056

      628     8052    3          CALL SEND_MSG (MSG_550H);

   8052  8 002056   000074 630400 9                  EPPR0   60
         8 002057   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 002060   000000 701000 xent               TSX1    SEND_MSG
         8 002061   000000 011000                    NOP     0

      629     8053    3          RETURN;

   8053  8 002062   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 002063   000001 702211                    TSX2  ! 1,X1

      630     8054    3          END;
      631     8055
      632     8056    3      IF VLR_HELP.RECCNT = 0 THEN DO;

   8056  8 002064   000547 720000 1                  LXL0    VLR_HELP+1
         8 002065   002073 601000 8                  TNZ     s:8061

      633     8057    3          SUBSTR(LINE_BUF,0,80) = ' No message available.';

   8057  8 002066   040000 100400                    MLR     fill='040'O
         8 002067   001235 000026 3                  ADSC9   IPFMT+27                 cn=0,n=22
         8 002070   000000 000120 xsym               ADSC9   CMD_BUFFER               cn=0,n=80
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:107  

      634     8058    3          VLR_HELP.RECCNT = 1;

   8058  8 002071   000001 221003                    LDX1    1,DU
         8 002072   000547 441000 1                  SXL1    VLR_HELP+1

      635     8059    3          END;

      636     8060
      637     8061    2      IF VLR_HELP.RECCNT > 1 THEN CALL SEND_MSG (MSG0, VECTOR(DASH));

   8061  8 002073   000547 720000 1                  LXL0    VLR_HELP+1
         8 002074   000002 100003                    CMPX0   2,DU
         8 002075   002102 602000 8                  TNC     s:8062

   8061  8 002076   000100 630400 9                  EPPR0   64
         8 002077   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 002100   000000 701000 xent               TSX1    SEND_MSG
         8 002101   000000 011000                    NOP     0

      638     8062    2      SUBLK$ = ADDR(LINE_BUF);

   8062  8 002102   000013 236000 9                  LDQ     11
         8 002103   200033 756100                    STQ     SUBLK$,,AUTO

      639     8063    3      DO WHILE '1'B;

      640     8064    3          CHARNLEN = 80;

   8064  8 002104   000120 235007                    LDA     80,DL
         8 002105   000125 755000 1                  STA     CHARNLEN

      641     8065    4          DO UNTIL CHARNLEN = 1;

      642     8066    4              CHARNLEN = CHARNLEN-1;

   8066  8 002106   000125 235000 1                  LDA     CHARNLEN
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:108  
         8 002107   000001 135007                    SBLA    1,DL
         8 002110   000125 755000 1                  STA     CHARNLEN

      643     8067    4              IF SUBSTR (SUBLK$ -> CHARN, CHARNLEN-1, 1) ~= ' ' THEN EXIT;

   8067  8 002111   200033 470500                    LDP0    SUBLK$,,AUTO
         8 002112   040000 106505                    CMPC    fill='040'O
         8 002113   077777 600001                    ADSC9   -1,A,PR0                 cn=3,n=1
         8 002114   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         8 002115   002120 601000 8                  TNZ     s:8069

      644     8068    4              END;

   8068  8 002116   000001 115007                    CMPA    1,DL
         8 002117   002106 601000 8                  TNZ     s:8066

      645     8069    3          VLR_HELP.RECCNT = VLR_HELP.RECCNT - 1;

   8069  8 002120   000547 720000 1                  LXL0    VLR_HELP+1
         8 002121   777777 621010                    EAX1    -1,X0
         8 002122   000547 441000 1                  SXL1    VLR_HELP+1

      646     8070    3          IF VLR_HELP.RECCNT = 0 THEN EXIT;

   8070  8 002123   002144 600000 8                  TZE     s:8074

      647     8071    3          CALL SEND_MSG (MSGI, VECTOR (SUBLK$ -> CHARN));

   8071  8 002124   000020 735000                    ALS     16
         8 002125   000140 135007                    SBLA    96,DL
         8 002126   200033 236100                    LDQ     SUBLK$,,AUTO
         8 002127   200064 757100                    STAQ    @PORT+2,,AUTO
         8 002130   200064 631500                    EPPR1   @PORT+2,,AUTO
         8 002131   200067 451500                    STP1    @PORT+5,,AUTO
         8 002132   000102 236000 9                  LDQ     66
         8 002133   200066 756100                    STQ     @PORT+4,,AUTO
         8 002134   200066 630500                    EPPR0   @PORT+4,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:109  
         8 002135   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 002136   000000 701000 xent               TSX1    SEND_MSG
         8 002137   000000 011000                    NOP     0

      648     8072    3          SUBLK$ = PINCRC (SUBLK$, 79);

   8072  8 002140   200033 236100                    LDQ     SUBLK$,,AUTO
         8 002141   000103 036000 9                  ADLQ    67
         8 002142   200033 756100                    STQ     SUBLK$,,AUTO

      649     8073    3          END;

   8073  8 002143   002104 710000 8                  TRA     s:8064

      650     8074    2      CALL SEND_MSG (MSGN, VECTOR (SUBLK$ -> CHARN));

   8074  8 002144   000020 735000                    ALS     16
         8 002145   000140 135007                    SBLA    96,DL
         8 002146   200033 236100                    LDQ     SUBLK$,,AUTO
         8 002147   200064 757100                    STAQ    @PORT+2,,AUTO
         8 002150   200064 631500                    EPPR1   @PORT+2,,AUTO
         8 002151   200067 451500                    STP1    @PORT+5,,AUTO
         8 002152   000104 236000 9                  LDQ     68
         8 002153   200066 756100                    STQ     @PORT+4,,AUTO
         8 002154   200066 630500                    EPPR0   @PORT+4,,AUTO
         8 002155   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 002156   000000 701000 xent               TSX1    SEND_MSG
         8 002157   000000 011000                    NOP     0

      651     8075    2      RETURN;

   8075  8 002160   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 002161   000001 702211                    TSX2  ! 1,X1

      652     8076
      653     8077    2   END HELP_CMD;
      654     8078        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:110  
      655     8079    1   GET_CMD: PROC (ONOVER,LFID$) ALTRET;

   8079  8 002162   200032 741300       GET_CMD      STX1  ! TFID+21,,AUTO

      656     8080    2   DCL ONOVER UBIN HALF HALIGNED;
      657     8081    2   DCL LFID$ PTR;
      658     8082    2   DCL TCP$READ ENTRY(3) ALTRET;
      659     8083    2   DCL GET_LINE ENTRY(4) ALTRET;
      660     8084    2   DCL OK BIT(1) STATIC;
      661     8085    2   DCL ARS UBIN(36) STATIC;
      662     8086    2   DCL CURSIZ SBIN;
      663     8087
      664     8088        /* First, validate local fid */
      665     8089
      666     8090    2      FPT_FID.TEXTFID_ = VECTOR(LFID$->TEXTC.TEXT);

   8090  8 002163   200034 470500                    LDP0    @LFID$,,AUTO
         8 002164   000000 471500                    LDP1    0,,PR0
         8 002165   000100 101500                    MRL     fill='000'O
         8 002166   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         8 002167   200064 000002                    ADSC9   @PORT+2,,AUTO            cn=0,n=2
         8 002170   200064 220100                    LDX0    @PORT+2,,AUTO
         8 002171   000000 635010                    EAA     0,X0
         8 002172   000002 771000                    ARL     2
         8 002173   000140 135007                    SBLA    96,DL
         8 002174   200065 451500                    STP1    @PORT+3,,AUTO
         8 002175   200065 236100                    LDQ     @PORT+3,,AUTO
         8 002176   200000 036007                    ADLQ    65536,DL
         8 002177   000276 757000 1                  STAQ    FPT_FID+2

      667     8091    3      CALL M$FID(FPT_FID) WHENALTRETURN DO;

   8091  8 002200   000274 630400 1                  EPPR0   FPT_FID
         8 002201   420001 713400                    CLIMB   alt,+8193
         8 002202   404400 401760                    pmme    nvectors=10
         8 002203   002205 702000 8                  TSX2    RETALT
         8 002204   002222 710000 8                  TRA     s:8099
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:111  

      668     8092    3   RETALT: CALL REPORT_ALT;

   8092  8 002205   003466 701000 8     RETALT       TSX1    REPORT_ALT
         8 002206   000000 011000                    NOP     0

      669     8093    3          GLOBAL_ERR = %FTP_COMMAND_ERR;

   8093  8 002207   000001 235007                    LDA     1,DL
         8 002210   000124 755000 1                  STA     GLOBAL_ERR

      670     8094    3          IF PASV>0 THEN CALL TCP$RELEASE (DATA_LCN);

   8094  8 002211   000357 236000 1                  LDQ     PASV
         8 002212   002217 604400 8                  TMOZ    s:8095

   8094  8 002213   000020 630400 9                  EPPR0   16
         8 002214   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 002215   000000 701000 xent               TSX1    TCP$RELEASE
         8 002216   000000 011000                    NOP     0

      671     8095    3          PASV = 0;

   8095  8 002217   000357 450000 1                  STZ     PASV

      672     8096    3          ALTRETURN;

   8096  8 002220   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 002221   000000 702211                    TSX2  ! 0,X1

      673     8097    3          END;
      674     8098
      675     8099    2      IF ONOVER = %FTP_OPT_ON

   8099  8 002222   200033 470500                    LDP0    @ONOVER,,AUTO
         8 002223   000100 101500                    MRL     fill='000'O
         8 002224   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:112  
         8 002225   200064 000004                    ADSC9   @PORT+2,,AUTO            cn=0,n=4
         8 002226   200064 236100                    LDQ     @PORT+2,,AUTO
         8 002227   000001 116007                    CMPQ    1,DL
         8 002230   002240 601000 8                  TNZ     s:8104

      676     8100    3      THEN DO;

      677     8101    3          FPT_OPEN.V.FUN# = %CREATE#;

   8101  8 002231   003000 236007                    LDQ     1536,DL
         8 002232   000225 552010 1                  STBQ    FPT_OPEN+37,'10'O

      678     8102    3          FPT_OPEN.V.EXIST# = %ERROR#;

   8102  8 002233   000224 236000 1                  LDQ     FPT_OPEN+36
         8 002234   000105 376000 9                  ANQ     69
         8 002235   000200 276007                    ORQ     128,DL
         8 002236   000224 756000 1                  STQ     FPT_OPEN+36

      679     8103    3          END;

   8103  8 002237   002272 710000 8                  TRA     s:8116

      680     8104    2      ELSE IF ONOVER = %FTP_OPT_OVER

   8104  8 002240   000100 101500                    MRL     fill='000'O
         8 002241   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         8 002242   200064 000004                    ADSC9   @PORT+2,,AUTO            cn=0,n=4
         8 002243   200064 236100                    LDQ     @PORT+2,,AUTO
         8 002244   000000 116003                    CMPQ    0,DU
         8 002245   002253 601000 8                  TNZ     s:8109

      681     8105    3          THEN DO;

      682     8106    3              FPT_OPEN.V.FUN# = %CREATE#;

   8106  8 002246   003000 236007                    LDQ     1536,DL
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:113  
         8 002247   000225 552010 1                  STBQ    FPT_OPEN+37,'10'O

      683     8107    3              FPT_OPEN.V.EXIST# = %NEWFILE#;

   8107  8 002250   000600 236007                    LDQ     384,DL
         8 002251   000224 256000 1                  ORSQ    FPT_OPEN+36

      684     8108    3              END;

   8108  8 002252   002272 710000 8                  TRA     s:8116

      685     8109    2          ELSE IF ONOVER = %FTP_OPT_INTO

   8109  8 002253   000100 101500                    MRL     fill='000'O
         8 002254   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         8 002255   200064 000004                    ADSC9   @PORT+2,,AUTO            cn=0,n=4
         8 002256   200064 236100                    LDQ     @PORT+2,,AUTO
         8 002257   000002 116007                    CMPQ    2,DL
         8 002260   002270 601000 8                  TNZ     s:8114

      686     8110    3              THEN DO;

      687     8111    3                  FPT_OPEN.V.FUN# = %CREATE#;

   8111  8 002261   003000 236007                    LDQ     1536,DL
         8 002262   000225 552010 1                  STBQ    FPT_OPEN+37,'10'O

      688     8112    3                  FPT_OPEN.V.EXIST# = %OLDFILE#;

   8112  8 002263   000224 236000 1                  LDQ     FPT_OPEN+36
         8 002264   000105 376000 9                  ANQ     69
         8 002265   000400 276007                    ORQ     256,DL
         8 002266   000224 756000 1                  STQ     FPT_OPEN+36

      689     8113    3                  END;

   8113  8 002267   002272 710000 8                  TRA     s:8116
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:114  

      690     8114    2              ELSE CALL M$XXX;             /* Internal error */

   8114  8 002270   000003 713400                    CLIMB   3
         8 002271   000000 401760                    pmme    nvectors=0

      691     8115
      692     8116    2      CALL M$OPEN (FPT_OPEN) ALTRET (RETALT);

   8116  8 002272   000160 630400 1                  EPPR0   FPT_OPEN
         8 002273   450000 713400                    CLIMB   alt,open
         8 002274   410400 401760                    pmme    nvectors=18
         8 002275   002205 702000 8                  TSX2    RETALT

      693     8117
      694     8118    2      CALL SEND_MSG (MSG_150, FPT_FID.TEXTFID_);

   8118  8 002276   000106 630400 9                  EPPR0   70
         8 002277   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 002300   000000 701000 xent               TSX1    SEND_MSG
         8 002301   000000 011000                    NOP     0

      695     8119
      696     8120    2      ARS = F$FILE$->F$DCB.RECL#;

   8120  8 002302   000156 470400 1                  LDP0    F$FILE$
         8 002303   000033 236100                    LDQ     27,,PR0
         8 002304   777777 376007                    ANQ     -1,DL
         8 002305   000603 756000 1                  STQ     ARS

      697     8121    2      CHARNLEN = 0;

   8121  8 002306   000125 450000 1                  STZ     CHARNLEN

      698     8122    2      CURSIZ = 0;

   8122  8 002307   200035 450100                    STZ     CURSIZ,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:115  

      699     8123
      700     8124    3      CALL OPEN_DATA_PORT WHENALTRETURN DO;

   8124  8 002310   003137 701000 8                  TSX1    OPEN_DATA_PORT
         8 002311   002313 702000 8                  TSX2    PROCERR
         8 002312   002322 710000 8                  TRA     s:8131

   8116  8 002313                       PROCERR      null
      701     8125    3   PROCERR: ;
      702     8126    3          GLOBAL_ERR = %FTP_PROCEDURE_ERR;          /*N* REPORT ERROR */

   8126  8 002313   000002 235007                    LDA     2,DL
         8 002314   000124 755000 1                  STA     GLOBAL_ERR

      703     8127    3          CALL M$CLOSE (FPT_NSAVE);

   8127  8 002315   000076 630400 3                  EPPR0   FPT_NSAVE
         8 002316   050001 713400                    CLIMB   close
         8 002317   406000 401760                    pmme    nvectors=13

      704     8128    3          ALTRETURN;

   8128  8 002320   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 002321   000000 702211                    TSX2  ! 0,X1

      705     8129    3          END;
      706     8130                                                /* Read file until it closes */
      707     8131    2      BYTES=0;

   8131  8 002322   000127 450000 1                  STZ     BYTES

      708     8132                                                /* First, get open */
      709     8133    2      CALL GET_OPEN(DATA_LCN,%TIMEOUT) ALTRET (PROCERR);

   8133  8 002323   000111 236000 9                  LDQ     73
         8 002324   200040 756100                    STQ     K+1,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:116  
         8 002325   000020 236000 9                  LDQ     16
         8 002326   200037 756100                    STQ     J+1,,AUTO
         8 002327   003020 701000 8                  TSX1    GET_OPEN
         8 002330   002313 702000 8                  TSX2    PROCERR

      710     8134
      711     8135    2      CALL M$TIME (FPT_TIME);

   8135  8 002331   000132 630400 1                  EPPR0   FPT_TIME
         8 002332   020004 713400                    CLIMB   8196
         8 002333   402000 401760                    pmme    nvectors=5

      712     8136    2      START_TIME=TSTAMP;

   8136  8 002334   000130 235000 1                  LDA     TSTAMP
         8 002335   000126 755000 1                  STA     START_TIME

      713     8137    2      OK='1'B;

   8137  8 002336   400000 236003                    LDQ     -131072,DU
         8 002337   000602 756000 1                  STQ     OK

      714     8138    3      DO WHILE OK;

   8138  8 002340   000602 234000 1                  SZN     OK
         8 002341   002526 605000 8                  TPL     s:8206

      715     8139    3          IF FILE_TYPE = %FTP_OPT_ASCII

   8139  8 002342   000356 235000 1                  LDA     FILE_TYPE
         8 002343   002404 601000 8                  TNZ     s:8164

      716     8140    4          THEN DO;

      717     8141    4              FPT_WRITE.BUF_.BUF$ = ADDR(LINE_BUF);

   8141  8 002344   000013 236000 9                  LDQ     11
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:117  
         8 002345   000347 756000 1                  STQ     FPT_WRITE+5

      718     8142    4              CALL GET_LINE(DATA_LCN, VECTOR(LINE_BUF), ARS)

   8142  8 002346   000114 630400 9                  EPPR0   76
         8 002347   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 002350   000000 701000 xent               TSX1    GET_LINE
         8 002351   002402 702000 8                  TSX2    s:8160

      719     8143    5              WHENRETURN DO;

      720     8144    5                  BYTES = BYTES + ARS-1;

   8144  8 002352   000127 236000 1                  LDQ     BYTES
         8 002353   000603 036000 1                  ADLQ    ARS
         8 002354   000001 136007                    SBLQ    1,DL
         8 002355   000127 756000 1                  STQ     BYTES

      721     8145                                                /* write it */
      722     8146    5                  CHARNLEN=ARS-2;          /* Don't include crlf*/

   8146  8 002356   000603 235000 1                  LDA     ARS
         8 002357   000002 135007                    SBLA    2,DL
         8 002360   000125 755000 1                  STA     CHARNLEN

      723     8147    5                  FPT_WRITE.V.DVBYTE.CONT# = '0'B;

   8147  8 002361   000117 236000 9                  LDQ     79
         8 002362   000355 356000 1                  ANSQ    FPT_WRITE+11

      724     8148    5                  IF CHARNLEN>=SIZEV(LINE_BUF)

   8148  8 002363   007777 115007                    CMPA    4095,DL
         8 002364   002373 602000 8                  TNC     s:8153

      725     8149    6                  THEN DO;

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:118  
      726     8150    6                      BYTES = BYTES-1;

   8150  8 002365   000127 235000 1                  LDA     BYTES
         8 002366   000001 135007                    SBLA    1,DL
         8 002367   000127 755000 1                  STA     BYTES

      727     8151    6                      FPT_WRITE.V.DVBYTE.CONT# = '1'B;

   8151  8 002370   001000 236003                    LDQ     512,DU
         8 002371   000355 256000 1                  ORSQ    FPT_WRITE+11

      728     8152    6                      END;

   8152  8 002372   002401 710000 8                  TRA     s:8158

      729     8153    5                  ELSE IF CHARNLEN<=0

   8153  8 002373   000000 115003                    CMPA    0,DU
         8 002374   002401 601000 8                  TNZ     s:8158

      730     8154    6                      THEN DO;

      731     8155    6                          CHARNLEN=1;

   8155  8 002375   000001 235007                    LDA     1,DL
         8 002376   000125 755000 1                  STA     CHARNLEN

      732     8156    6                          FPT_WRITE.BUF_.BUF$ = ADDR(NIL);

   8156  8 002377   000001 236000 xsym               LDQ     B_VECTNIL+1
         8 002400   000347 756000 1                  STQ     FPT_WRITE+5

      733     8157    6                          END;

      734     8158    5                  END;

   8158  8 002401   002403 710000 8                  TRA     s:8162
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:119  

      735     8159    5              WHENALTRETURN DO;

      736     8160    5                  OK='0'B;

   8160  8 002402   000602 450000 1                  STZ     OK

      737     8161    5                  END;

      738     8162    4              END;

   8162  8 002403   002500 710000 8                  TRA     s:8196

      739     8163    4          ELSE DO;                         /* Mode is image */

      740     8164    5              IF CHARNLEN=0 OR CHARNLEN=CB.ARS THEN DO;

   8164  8 002404   000125 236000 1                  LDQ     CHARNLEN
         8 002405   002410 600000 8                  TZE     s:8165
         8 002406   000120 116000 1                  CMPQ    CB+1
         8 002407   002442 601000 8                  TNZ     s:8180

      741     8165    5                  FPT_WRITE.BUF_.BUF$ = ADDR(LINE_BUF);

   8165  8 002410   000013 236000 9                  LDQ     11
         8 002411   000347 756000 1                  STQ     FPT_WRITE+5

      742     8166    6                  CALL TCP$READ (DATA_LCN,VECTOR(LINE_BUF),CB) WHENALTRETURN DO;

   8166  8 002412   000120 630400 9                  EPPR0   80
         8 002413   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 002414   000000 701000 xent               TSX1    TCP$READ
         8 002415   002417 702000 8                  TSX2    s:8167
         8 002416   002430 710000 8                  TRA     s:8171

      743     8167    6                      CALL TCP$RELEASE (DATA_LCN);

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:120  
   8167  8 002417   000020 630400 9                  EPPR0   16
         8 002420   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 002421   000000 701000 xent               TSX1    TCP$RELEASE
         8 002422   000000 011000                    NOP     0

      744     8168    6                      CALL SEND_MSG (MSG_426);

   8168  8 002423   000123 630400 9                  EPPR0   83
         8 002424   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 002425   000000 701000 xent               TSX1    SEND_MSG
         8 002426   000000 011000                    NOP     0

      745     8169    6                      GOTO PROCERR;

   8169  8 002427   002313 710000 8                  TRA     PROCERR

      746     8170    6                      END;
      747     8171    5                  IF CB.ADMIN

   8171  8 002430   000117 234000 1                  SZN     CB
         8 002431   002434 605000 8                  TPL     s:8176

      748     8172    6                  THEN DO;

      749     8173    6                      OK = '0'B;

   8173  8 002432   000602 450000 1                  STZ     OK

      750     8174    6                      END;

   8174  8 002433   002453 710000 8                  TRA     s:8184

      751     8175    6                  ELSE DO;

      752     8176    6                      BYTES = BYTES+CB.ARS;

   8176  8 002434   000127 236000 1                  LDQ     BYTES
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:121  
         8 002435   000120 036000 1                  ADLQ    CB+1
         8 002436   000127 756000 1                  STQ     BYTES

      753     8177    6                      CHARNLEN=CB.ARS;

   8177  8 002437   000120 235000 1                  LDA     CB+1
         8 002440   000125 755000 1                  STA     CHARNLEN

      754     8178    6                      END;

      755     8179    5                  END; ELSE DO;

   8179  8 002441   002453 710000 8                  TRA     s:8184

      756     8180    5                  CB.ARS = CB.ARS-CHARNLEN;

   8180  8 002442   000120 236000 1                  LDQ     CB+1
         8 002443   000125 136000 1                  SBLQ    CHARNLEN
         8 002444   000120 756000 1                  STQ     CB+1

      757     8181    5                  FPT_WRITE.BUF_.BUF$ = PINCRC(FPT_WRITE.BUF_.BUF$,CHARNLEN);

   8181  8 002445   000125 236000 1                  LDQ     CHARNLEN
         8 002446   000020 736000                    QLS     16
         8 002447   000347 036000 1                  ADLQ    FPT_WRITE+5
         8 002450   000347 756000 1                  STQ     FPT_WRITE+5

      758     8182    5                  CHARNLEN = CB.ARS;

   8182  8 002451   000120 235000 1                  LDA     CB+1
         8 002452   000125 755000 1                  STA     CHARNLEN

      759     8183    5                  END;

      760     8184    5              IF ARS>0 THEN DO;  /* Recl was specified, make'em all the same */

   8184  8 002453   000603 235000 1                  LDA     ARS
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:122  
         8 002454   002500 600000 8                  TZE     s:8196

      761     8185    5                  FPT_WRITE.V.DVBYTE.CONT# = '1'B;

   8185  8 002455   001000 236003                    LDQ     512,DU
         8 002456   000355 256000 1                  ORSQ    FPT_WRITE+11

      762     8186    6                  IF CHARNLEN>=ARS-CURSIZ THEN DO;

   8186  8 002457   000603 236000 1                  LDQ     ARS
         8 002460   200035 136100                    SBLQ    CURSIZ,,AUTO
         8 002461   002465 604000 8                  TMI     s:8187
         8 002462   000125 116000 1                  CMPQ    CHARNLEN
         8 002463   002465 600000 8                  TZE     s:8187
         8 002464   002475 603000 8                  TRC     s:8191

      763     8187    6                      CHARNLEN = ARS-CURSIZ;

   8187  8 002465   000603 236000 1                  LDQ     ARS
         8 002466   200035 136100                    SBLQ    CURSIZ,,AUTO
         8 002467   000125 756000 1                  STQ     CHARNLEN

      764     8188    6                      CURSIZ = -CHARNLEN;

   8188  8 002470   000000 235003                    LDA     0,DU
         8 002471   000125 135000 1                  SBLA    CHARNLEN
         8 002472   200035 755100                    STA     CURSIZ,,AUTO

      765     8189    6                      FPT_WRITE.V.DVBYTE.CONT# = '0'B;

   8189  8 002473   000117 236000 9                  LDQ     79
         8 002474   000355 356000 1                  ANSQ    FPT_WRITE+11

      766     8190    6                      END;

      767     8191    5                  CURSIZ = CURSIZ+CHARNLEN;

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:123  
   8191  8 002475   200035 236100                    LDQ     CURSIZ,,AUTO
         8 002476   000125 036000 1                  ADLQ    CHARNLEN
         8 002477   200035 756100                    STQ     CURSIZ,,AUTO

      768     8192    5                  END;

      769     8193
      770     8194    4              END;

      771     8195
      772     8196    3          IF (OK)

   8196  8 002500   000602 234000 1                  SZN     OK
         8 002501   002524 605000 8                  TPL     s:8205

      773     8197    4          THEN DO;

      774     8198    4              FPT_WRITE.BUF_.BOUND = CHARNLEN-1;

   8198  8 002502   000125 236000 1                  LDQ     CHARNLEN
         8 002503   000001 136007                    SBLQ    1,DL
         8 002504   000020 736000                    QLS     16
         8 002505   000346 676000 1                  ERQ     FPT_WRITE+4
         8 002506   000034 376000 xsym               ANQ     B_VECTNIL+28
         8 002507   000346 656000 1                  ERSQ    FPT_WRITE+4

      775     8199    5              CALL M$WRITE (FPT_WRITE) WHENALTRETURN DO;

   8199  8 002510   000342 630400 1                  EPPR0   FPT_WRITE
         8 002511   440001 713400                    CLIMB   alt,write
         8 002512   401400 401760                    pmme    nvectors=4
         8 002513   002515 702000 8                  TSX2    s:8200
         8 002514   002524 710000 8                  TRA     s:8205

      776     8200    5                  CALL REPORT_ALT;

   8200  8 002515   003466 701000 8                  TSX1    REPORT_ALT
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:124  
         8 002516   000000 011000                    NOP     0

      777     8201    5                  CALL TCP$RELEASE(DATA_LCN);

   8201  8 002517   000020 630400 9                  EPPR0   16
         8 002520   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 002521   000000 701000 xent               TSX1    TCP$RELEASE
         8 002522   000000 011000                    NOP     0

      778     8202    5                  GOTO PROCERR;

   8202  8 002523   002313 710000 8                  TRA     PROCERR

      779     8203    5                  END;
      780     8204    4              END;

      781     8205    3          END;

   8205  8 002524   000602 234000 1                  SZN     OK
         8 002525   002342 604000 8                  TMI     s:8139

      782     8206    2      CALL M$TIME (FPT_TIME);

   8206  8 002526   000132 630400 1                  EPPR0   FPT_TIME
         8 002527   020004 713400                    CLIMB   8196
         8 002530   402000 401760                    pmme    nvectors=5

      783     8207    2      START_TIME = TSTAMP-START_TIME;

   8207  8 002531   000130 236000 1                  LDQ     TSTAMP
         8 002532   000126 136000 1                  SBLQ    START_TIME
         8 002533   000126 756000 1                  STQ     START_TIME

      784     8208    2      CALL GET_CLOSE(DATA_LCN,%TIMEOUT);

   8208  8 002534   000111 236000 9                  LDQ     73
         8 002535   200040 756100                    STQ     K+1,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:125  
         8 002536   000020 236000 9                  LDQ     16
         8 002537   200037 756100                    STQ     J+1,,AUTO
         8 002540   003062 701000 8                  TSX1    GET_CLOSE
         8 002541   000000 011000                    NOP     0

      785     8209    2      CALL SEND_MSG (MSG_226);

   8209  8 002542   000124 630400 9                  EPPR0   84
         8 002543   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 002544   000000 701000 xent               TSX1    SEND_MSG
         8 002545   000000 011000                    NOP     0

      786     8210    2      CALL REPORT_TIME(BYTES, START_TIME);

   8210  8 002546   000125 630400 9                  EPPR0   85
         8 002547   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 002550   000000 701000 xent               TSX1    REPORT_TIME
         8 002551   000000 011000                    NOP     0

      787     8211    2      CALL M$CLOSE (FPT_CLOSE);

   8211  8 002552   000040 630400 3                  EPPR0   FPT_CLOSE
         8 002553   050001 713400                    CLIMB   close
         8 002554   406000 401760                    pmme    nvectors=13

      788     8212
      789     8213    2      RETURN;

   8213  8 002555   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 002556   000001 702211                    TSX2  ! 1,X1

      790     8214    2   END GET_CMD;
      791     8215        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:126  
      792     8216    1   PUT_CMD: PROC (LFID$) ALTRET;

   8216  8 002557   200034 741300       PUT_CMD      STX1  ! @LFID$,,AUTO

      793     8217    2   DCL LFID$ PTR;
      794     8218    2   DCL CRLF CHAR(2) SYMREF;
      795     8219    2   DCL TCP$WRITE ENTRY(4) ALTRET;
      796     8220    2   DCL OK BIT(1) STATIC;
      797     8221
      798     8222        /* First, validate local fid */
      799     8223
      800     8224    2      FPT_FID.TEXTFID_ = VECTOR(LFID$->TEXTC.TEXT);

   8224  8 002560   200035 470500                    LDP0    @LFID$,,AUTO
         8 002561   000000 471500                    LDP1    0,,PR0
         8 002562   000100 101500                    MRL     fill='000'O
         8 002563   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         8 002564   200064 000002                    ADSC9   @PORT+2,,AUTO            cn=0,n=2
         8 002565   200064 220100                    LDX0    @PORT+2,,AUTO
         8 002566   000000 635010                    EAA     0,X0
         8 002567   000002 771000                    ARL     2
         8 002570   000140 135007                    SBLA    96,DL
         8 002571   200065 451500                    STP1    @PORT+3,,AUTO
         8 002572   200065 236100                    LDQ     @PORT+3,,AUTO
         8 002573   200000 036007                    ADLQ    65536,DL
         8 002574   000276 757000 1                  STAQ    FPT_FID+2

      801     8225    3      CALL M$FID(FPT_FID) WHENALTRETURN DO;

   8225  8 002575   000274 630400 1                  EPPR0   FPT_FID
         8 002576   420001 713400                    CLIMB   alt,+8193
         8 002577   404400 401760                    pmme    nvectors=10
         8 002600   002602 702000 8                  TSX2    REPALT
         8 002601   002617 710000 8                  TRA     s:8231+2

   8219  8 002602                       REPALT       null
      802     8226    3   REPALT: ;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:127  
      803     8227    3          CALL REPORT_ALT;

   8227  8 002602   003466 701000 8                  TSX1    REPORT_ALT
         8 002603   000000 011000                    NOP     0

      804     8228    3          GLOBAL_ERR = %FTP_COMMAND_ERR;

   8228  8 002604   000001 235007                    LDA     1,DL
         8 002605   000124 755000 1                  STA     GLOBAL_ERR

      805     8229    3          IF PASV > 0 THEN CALL TCP$RELEASE (DATA_LCN);

   8229  8 002606   000357 236000 1                  LDQ     PASV
         8 002607   002614 604400 8                  TMOZ    s:8230

   8229  8 002610   000020 630400 9                  EPPR0   16
         8 002611   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 002612   000000 701000 xent               TSX1    TCP$RELEASE
         8 002613   000000 011000                    NOP     0

      806     8230    3          PASV = 0;

   8230  8 002614   000357 450000 1                  STZ     PASV

      807     8231    3          ALTRETURN;

   8231  8 002615   200034 221300                    LDX1  ! @LFID$,,AUTO
         8 002616   000000 702211                    TSX2  ! 0,X1
         8 002617   002621 710000 8                  TRA     s:8235

      808     8232    3          END;
      809     8233
      810     8234    2   PUT_STARL: ENTRY ALTRET;

   8234  8 002620   200034 741300       PUT_STARL    STX1  ! @LFID$,,AUTO

      811     8235    2      FPT_OPEN.V.FUN# = %IN#;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:128  

   8235  8 002621   002000 236007                    LDQ     1024,DL
         8 002622   000225 552010 1                  STBQ    FPT_OPEN+37,'10'O

      812     8236    2      CALL M$OPEN (FPT_OPEN) ALTRET (REPALT);

   8236  8 002623   000160 630400 1                  EPPR0   FPT_OPEN
         8 002624   450000 713400                    CLIMB   alt,open
         8 002625   410400 401760                    pmme    nvectors=18
         8 002626   002602 702000 8                  TSX2    REPALT

      813     8237
      814     8238    2      CALL SEND_MSG (MSG_150, FPT_FID.TEXTFID_);

   8238  8 002627   000106 630400 9                  EPPR0   70
         8 002630   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 002631   000000 701000 xent               TSX1    SEND_MSG
         8 002632   000000 011000                    NOP     0

      815     8239    3      CALL OPEN_DATA_PORT WHENALTRETURN DO;

   8239  8 002633   003137 701000 8                  TSX1    OPEN_DATA_PORT
         8 002634   002636 702000 8                  TSX2    PORTALT
         8 002635   002645 710000 8                  TRA     s:8247

   8231  8 002636                       PORTALT      null
      816     8240    3   PORTALT: ;
      817     8241    3          GLOBAL_ERR = %FTP_PROCEDURE_ERR;          /*N* REPORT ERROR */

   8241  8 002636   000002 235007                    LDA     2,DL
         8 002637   000124 755000 1                  STA     GLOBAL_ERR

      818     8242    3          CALL M$CLOSE (FPT_CLOSE);

   8242  8 002640   000040 630400 3                  EPPR0   FPT_CLOSE
         8 002641   050001 713400                    CLIMB   close
         8 002642   406000 401760                    pmme    nvectors=13
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:129  

      819     8243    3          ALTRETURN;

   8243  8 002643   200034 221300                    LDX1  ! @LFID$,,AUTO
         8 002644   000000 702211                    TSX2  ! 0,X1

      820     8244    3          END;
      821     8245
      822     8246                                                /* Write file until it closes */
      823     8247    2      BYTES=0;

   8247  8 002645   000127 450000 1                  STZ     BYTES

      824     8248                                                /* First, get open */
      825     8249    2      CALL GET_OPEN(DATA_LCN,%TIMEOUT) ALTRET (PORTALT);

   8249  8 002646   000111 236000 9                  LDQ     73
         8 002647   200040 756100                    STQ     K+1,,AUTO
         8 002650   000020 236000 9                  LDQ     16
         8 002651   200037 756100                    STQ     J+1,,AUTO
         8 002652   003020 701000 8                  TSX1    GET_OPEN
         8 002653   002636 702000 8                  TSX2    PORTALT

      826     8250    2      CALL M$TIME (FPT_TIME);

   8250  8 002654   000132 630400 1                  EPPR0   FPT_TIME
         8 002655   020004 713400                    CLIMB   8196
         8 002656   402000 401760                    pmme    nvectors=5

      827     8251    2      START_TIME=TSTAMP;

   8251  8 002657   000130 235000 1                  LDA     TSTAMP
         8 002660   000126 755000 1                  STA     START_TIME

      828     8252    2      OK='1'B;

   8252  8 002661   400000 236003                    LDQ     -131072,DU
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:130  
         8 002662   000604 756000 1                  STQ     OK

      829     8253    3      DO WHILE OK;

   8253  8 002663   000604 234000 1                  SZN     OK
         8 002664   002767 605000 8                  TPL     s:8286

      830     8254    3          CALL M$READ (FPT_READ)

   8254  8 002665   000324 630400 1                  EPPR0   FPT_READ
         8 002666   440000 713400                    CLIMB   alt,read
         8 002667   401400 401760                    pmme    nvectors=4
         8 002670   002676 702000 8                  TSX2    s:8260

      831     8255    4          WHENRETURN DO;

      832     8256    4              OK='1'B;

   8256  8 002671   400000 236003                    LDQ     -131072,DU
         8 002672   000604 756000 1                  STQ     OK

      833     8257    4              FPT_READ.V.DVBYTE.CONT#='0'B;

   8257  8 002673   000117 236000 9                  LDQ     79
         8 002674   000337 356000 1                  ANSQ    FPT_READ+11

      834     8258    4              END;

   8258  8 002675   002710 710000 8                  TRA     s:8266

      835     8259    4          WHENALTRETURN DO;

      836     8260    4              IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.ERR# = %E$LD

   8260  8 002676   000000 470400 xsym               LDP0    B$TCB$
         8 002677   000000 471500                    LDP1    0,,PR0
         8 002700   100102 236100                    LDQ     66,,PR1
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:131  
         8 002701   377770 376007                    ANQ     131064,DL
         8 002702   000070 116007                    CMPQ    56,DL
         8 002703   002707 601000 8                  TNZ     s:8264

      837     8261    5              THEN DO;

      838     8262    5                  FPT_READ.V.DVBYTE.CONT#='1'B;

   8262  8 002704   001000 236003                    LDQ     512,DU
         8 002705   000337 256000 1                  ORSQ    FPT_READ+11

      839     8263    5                  END;

   8263  8 002706   002710 710000 8                  TRA     s:8266

      840     8264    4              ELSE OK='0'B;

   8264  8 002707   000604 450000 1                  STZ     OK

      841     8265    4              END;

      842     8266    3          IF OK

   8266  8 002710   000604 234000 1                  SZN     OK
         8 002711   002765 605000 8                  TPL     s:8285

      843     8267    4          THEN DO;

      844     8268
      845     8269    4              CHARNLEN=F$FILE$->F$DCB.ARS#;

   8269  8 002712   000156 470400 1                  LDP0    F$FILE$
         8 002713   000000 235100                    LDA     0,,PR0
         8 002714   000125 755000 1                  STA     CHARNLEN

      846     8270    4              IF FILE_TYPE = %FTP_OPT_ASCII AND NOT FPT_READ.V.DVBYTE.CONT#

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:132  
   8270  8 002715   000356 236000 1                  LDQ     FILE_TYPE
         8 002716   002732 601000 8                  TNZ     s:8276
         8 002717   000337 430000 1                  FSZN    FPT_READ+11
         8 002720   002732 604000 8                  TMI     s:8276

      847     8271    5              THEN DO;

      848     8272    5                  BYTES = BYTES - 1;

   8272  8 002721   000127 235000 1                  LDA     BYTES
         8 002722   000001 135007                    SBLA    1,DL
         8 002723   000127 755000 1                  STA     BYTES

      849     8273    5                  SUBSTR (DATA_BUFFER, CHARNLEN, 2) = CRLF;

   8273  8 002724   000125 235000 1                  LDA     CHARNLEN
         8 002725   040005 100400                    MLR     fill='040'O
         8 002726   000000 000002 xsym               ADSC9   CRLF                     cn=0,n=2
         8 002727   000000 000002 xsym               ADSC9   CMD_BUFFER,A             cn=0,n=2

      850     8274    5                  CHARNLEN = CHARNLEN + 2;

   8274  8 002730   000002 035007                    ADLA    2,DL
         8 002731   000125 755000 1                  STA     CHARNLEN

      851     8275    5                  END;

      852     8276    4              IF (CHARNLEN>0)

   8276  8 002732   000000 115003                    CMPA    0,DU
         8 002733   002762 600000 8                  TZE     s:8283

      853     8277    4              THEN CALL TCP$WRITE(DATA_LCN,VECTOR(ADDR(DATA_BUFFER)->CHARN))

   8277  8 002734   000020 735000                    ALS     16
         8 002735   000140 135007                    SBLA    96,DL
         8 002736   000013 236000 9                  LDQ     11
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:133  
         8 002737   200064 757100                    STAQ    @PORT+2,,AUTO
         8 002740   200064 631500                    EPPR1   @PORT+2,,AUTO
         8 002741   200067 451500                    STP1    @PORT+5,,AUTO
         8 002742   000020 236000 9                  LDQ     16
         8 002743   200066 756100                    STQ     @PORT+4,,AUTO
         8 002744   200066 630500                    EPPR0   @PORT+4,,AUTO
         8 002745   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 002746   000000 701000 xent               TSX1    TCP$WRITE
         8 002747   002751 702000 8                  TSX2    s:8279
         8 002750   002762 710000 8                  TRA     s:8283

      854     8278    5                  WHENALTRETURN DO;

      855     8279    5                      CALL TCP$RELEASE(DATA_LCN);

   8279  8 002751   000020 630400 9                  EPPR0   16
         8 002752   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 002753   000000 701000 xent               TSX1    TCP$RELEASE
         8 002754   000000 011000                    NOP     0

      856     8280    5                      CALL SEND_MSG (MSG_426);

   8280  8 002755   000123 630400 9                  EPPR0   83
         8 002756   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 002757   000000 701000 xent               TSX1    SEND_MSG
         8 002760   000000 011000                    NOP     0

      857     8281    5                      GOTO PORTALT;

   8281  8 002761   002636 710000 8                  TRA     PORTALT

      858     8282    5                      END;
      859     8283    4              BYTES = BYTES + CHARNLEN;

   8283  8 002762   000127 236000 1                  LDQ     BYTES
         8 002763   000125 036000 1                  ADLQ    CHARNLEN
         8 002764   000127 756000 1                  STQ     BYTES
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:134  

      860     8284    4              END;

      861     8285    3          END;

   8285  8 002765   000604 234000 1                  SZN     OK
         8 002766   002665 604000 8                  TMI     s:8254

      862     8286    2      CALL GET_CLOSE(DATA_LCN,%TIMEOUT);

   8286  8 002767   000111 236000 9                  LDQ     73
         8 002770   200040 756100                    STQ     K+1,,AUTO
         8 002771   000020 236000 9                  LDQ     16
         8 002772   200037 756100                    STQ     J+1,,AUTO
         8 002773   003062 701000 8                  TSX1    GET_CLOSE
         8 002774   000000 011000                    NOP     0

      863     8287    2      CALL M$TIME (FPT_TIME);

   8287  8 002775   000132 630400 1                  EPPR0   FPT_TIME
         8 002776   020004 713400                    CLIMB   8196
         8 002777   402000 401760                    pmme    nvectors=5

      864     8288    2      START_TIME = TSTAMP-START_TIME;

   8288  8 003000   000130 236000 1                  LDQ     TSTAMP
         8 003001   000126 136000 1                  SBLQ    START_TIME
         8 003002   000126 756000 1                  STQ     START_TIME

      865     8289    2      CALL SEND_MSG (MSG_226);

   8289  8 003003   000124 630400 9                  EPPR0   84
         8 003004   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 003005   000000 701000 xent               TSX1    SEND_MSG
         8 003006   000000 011000                    NOP     0

      866     8290
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:135  
      867     8291    2      CALL REPORT_TIME(BYTES,START_TIME);

   8291  8 003007   000125 630400 9                  EPPR0   85
         8 003010   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 003011   000000 701000 xent               TSX1    REPORT_TIME
         8 003012   000000 011000                    NOP     0

      868     8292    2      CALL M$CLOSE (FPT_CLOSE);

   8292  8 003013   000040 630400 3                  EPPR0   FPT_CLOSE
         8 003014   050001 713400                    CLIMB   close
         8 003015   406000 401760                    pmme    nvectors=13

      869     8293
      870     8294    2      RETURN;

   8294  8 003016   200034 221300                    LDX1  ! @LFID$,,AUTO
         8 003017   000001 702211                    TSX2  ! 1,X1

      871     8295    2   END PUT_CMD;
      872     8296
      873     8297        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:136  
      874     8298    1   GET_OPEN: PROC(LCN,TIMEOUT) ALTRET;

   8298  8 003020   200036 741300       GET_OPEN     STX1  ! I+1,,AUTO

      875     8299    2   DCL LCN UBIN(36);
      876     8300    2   DCL TIMEOUT UBIN(36);
      877     8301
      878     8302        %TCP$CB (NAME=CB);
      879     8305        %TCP$ADMIN (STCLASS=BASED);
      880     8326    2   DCL TCP$READ ENTRY(3) ALTRET;
      881     8327    2   DCL REMOTE_ADMIN ENTRY(1);
      882     8328
      883     8329    2      PASV = 0;             /* If we get this far, use the default next time */

   8329  8 003021   000357 450000 1                  STZ     PASV

      884     8330
      885     8331                  /* Do a read, it must be a ADMINMSG_ESTABLISHED, otherwise altret */
      886     8332
      887     8333    2      CALL TCP$READ (LCN, VECTOR(CMD_BUFFER), CB) ALTRET (RETALT);

   8333  8 003022   000127 236000 9                  LDQ     87
         8 003023   200066 756100                    STQ     @PORT+4,,AUTO
         8 003024   000115 236000 9                  LDQ     77
         8 003025   200037 235100                    LDA     @LCN,,AUTO
         8 003026   200064 757100                    STAQ    @PORT+2,,AUTO
         8 003027   200064 630500                    EPPR0   @PORT+2,,AUTO
         8 003030   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 003031   000000 701000 xent               TSX1    TCP$READ
         8 003032   003050 702000 8                  TSX2    RETALT

      888     8334
      889     8335    3      IF CB.ADMIN THEN DO;

   8335  8 003033   000605 234000 1                  SZN     CB
         8 003034   003060 605000 8                  TPL     s:8344

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:137  
      890     8336    3          IF ADDR(CMD_BUFFER)->TCP$ADMIN.CMD ~= %TCP_ADMINMSG_ESTABLISHED

   8336  8 003035   000000 235000 xsym               LDA     CMD_BUFFER
         8 003036   000003 115007                    CMPA    3,DL
         8 003037   003060 600000 8                  TZE     s:8344

      891     8337    4          THEN DO;

      892     8338    4              CALL REMOTE_ADMIN(ADDR(CMD_BUFFER));

   8338  8 003040   000013 236000 9                  LDQ     11
         8 003041   200064 756100                    STQ     @PORT+2,,AUTO
         8 003042   200064 630500                    EPPR0   @PORT+2,,AUTO
         8 003043   200065 450500                    STP0    @PORT+3,,AUTO
         8 003044   200065 630500                    EPPR0   @PORT+3,,AUTO
         8 003045   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 003046   000000 701000 xent               TSX1    REMOTE_ADMIN
         8 003047   000000 011000                    NOP     0

      893     8339    4   RETALT:    CALL REPORT_LIB;             /* Send a 425 error */

   8339  8 003050   003462 701000 8     RETALT       TSX1    REPORT_LIB
         8 003051   000000 011000                    NOP     0

      894     8340    4              CALL TCP$RELEASE(LCN);

   8340  8 003052   200037 630500                    EPPR0   @LCN,,AUTO
         8 003053   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 003054   000000 701000 xent               TSX1    TCP$RELEASE
         8 003055   000000 011000                    NOP     0

      895     8341    4              ALTRETURN;

   8341  8 003056   200036 221300                    LDX1  ! I+1,,AUTO
         8 003057   000000 702211                    TSX2  ! 0,X1

      896     8342    4              END;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:138  
      897     8343    3          END;
      898     8344    2      RETURN;

   8344  8 003060   200036 221300                    LDX1  ! I+1,,AUTO
         8 003061   000001 702211                    TSX2  ! 1,X1

      899     8345    2   END GET_OPEN;
      900     8346
      901     8347        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:139  
      902     8348        /* Close lcn, wait for close ack, release it */
      903     8349    1   GET_CLOSE: PROC(LCN, TIMEOUT) ALTRET;

   8349  8 003062   200036 741300       GET_CLOSE    STX1  ! I+1,,AUTO

      904     8350    2   DCL LCN UBIN(36);
      905     8351    2   DCL TIMEOUT UBIN(36);
      906     8352        %TCP$CB (NAME=CB, STCLASS=STATIC);
      907     8355        %TCP$ADMIN (STCLASS=BASED);
      908     8376    2   DCL TCP$CLOSE ENTRY(1) ALTRET;
      909     8377    2   DCL TCP$READ ENTRY(3) ALTRET;
      910     8378    2   DCL REMOTE_ADMIN ENTRY(1);
      911     8379
      912     8380    2      CALL TCP$CLOSE (LCN)

   8380  8 003063   200037 630500                    EPPR0   @LCN,,AUTO
         8 003064   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 003065   000000 701000 xent               TSX1    TCP$CLOSE
         8 003066   003070 702000 8                  TSX2    s:8382
         8 003067   003076 710000 8                  TRA     s:8387

      913     8381    3      WHENALTRETURN DO;

      914     8382    3          CALL TCP$RELEASE(LCN);

   8382  8 003070   200037 630500                    EPPR0   @LCN,,AUTO
         8 003071   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 003072   000000 701000 xent               TSX1    TCP$RELEASE
         8 003073   000000 011000                    NOP     0

      915     8383    3          ALTRETURN;

   8383  8 003074   200036 221300                    LDX1  ! I+1,,AUTO
         8 003075   000000 702211                    TSX2  ! 0,X1

      916     8384    3          END;
      917     8385
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:140  
      918     8386    3      DO WHILE('1'B);

      919     8387    4          CALL TCP$READ (LCN, VECTOR(CMD_BUFFER), CB) WHENALTRETURN DO;

   8387  8 003076   000130 236000 9                  LDQ     88
         8 003077   200066 756100                    STQ     @PORT+4,,AUTO
         8 003100   000115 236000 9                  LDQ     77
         8 003101   200037 235100                    LDA     @LCN,,AUTO
         8 003102   200064 757100                    STAQ    @PORT+2,,AUTO
         8 003103   200064 630500                    EPPR0   @PORT+2,,AUTO
         8 003104   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 003105   000000 701000 xent               TSX1    TCP$READ
         8 003106   003110 702000 8                  TSX2    s:8388
         8 003107   003112 710000 8                  TRA     s:8391

      920     8388    4              CALL M$XXX;

   8388  8 003110   000003 713400                    CLIMB   3
         8 003111   000000 401760                    pmme    nvectors=0

      921     8389    4              END;

      922     8390
      923     8391    4          IF CB.ADMIN THEN DO;

   8391  8 003112   000612 234000 1                  SZN     CB
         8 003113   003076 605000 8                  TPL     s:8387

      924     8392    4              IF (ADDR(CMD_BUFFER)->TCP$ADMIN.CMD ~= %TCP_ADMINMSG_CLOSED) AND

   8392  8 003114   000000 235000 xsym               LDA     CMD_BUFFER
         8 003115   000007 115007                    CMPA    7,DL
         8 003116   003131 600000 8                  TZE     s:8396
         8 003117   000005 115007                    CMPA    5,DL
         8 003120   003131 600000 8                  TZE     s:8396

      925     8393    4                    (ADDR(CMD_BUFFER)->TCP$ADMIN.CMD ~= %TCP_ADMINMSG_CLOSING) THEN
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:141  
      926     8394    4                  CALL REMOTE_ADMIN(ADDR(CMD_BUFFER));

   8394  8 003121   000013 236000 9                  LDQ     11
         8 003122   200064 756100                    STQ     @PORT+2,,AUTO
         8 003123   200064 630500                    EPPR0   @PORT+2,,AUTO
         8 003124   200065 450500                    STP0    @PORT+3,,AUTO
         8 003125   200065 630500                    EPPR0   @PORT+3,,AUTO
         8 003126   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 003127   000000 701000 xent               TSX1    REMOTE_ADMIN
         8 003130   000000 011000                    NOP     0

      927     8395
      928     8396    4              CALL TCP$RELEASE(LCN);

   8396  8 003131   200037 630500                    EPPR0   @LCN,,AUTO
         8 003132   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 003133   000000 701000 xent               TSX1    TCP$RELEASE
         8 003134   000000 011000                    NOP     0

      929     8397    4              RETURN;

   8397  8 003135   200036 221300                    LDX1  ! I+1,,AUTO
         8 003136   000001 702211                    TSX2  ! 1,X1

      930     8398    4              END;
      931     8399
      932     8400    3          END;

      933     8401    2   END GET_CLOSE;
      934     8402
      935     8403        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:142  
      936     8404    1   OPEN_DATA_PORT: PROC ALTRET;

   8404  8 003137   200036 741300       OPEN_DATA_P* STX1  ! I+1,,AUTO

      937     8405        /*
      938     8406           If we're in passive mode, the data port is already open.
      939     8407           otherwise ...
      940     8408           Open to the socket from any port command, or to the default.
      941     8409           Altret if it doesn't work. */
      942     8410
      943     8411    2   DCL FMT_OUT CHAR(64);
      944     8412    2   DCL FMT_OUTL SBIN(36);
      945     8413    2   DCL FMT_OUTB CHAR(FMT_OUTL) BASED;
      946     8414    2   DCL TCP$OPEN ENTRY(6) ALTRET;
      947     8415
      948     8416    2      IF PASV > 0 THEN RETURN;

   8416  8 003140   000357 235000 1                  LDA     PASV
         8 003141   003143 604400 8                  TMOZ    s:8420

   8416  8 003142   000001 702211                    TSX2  ! 1,X1

      949     8417
      950     8418        /*n* handle optional output to file */  /* What does this mean, harold? */
      951     8419
      952     8420    2      DATA_LS = CMD_LS;

   8420  8 003143   000000 100400                    MLR     fill='000'O
         8 003144   000000 000010 xsym               ADSC9   CMD_LS                   cn=0,n=8
         8 003145   000363 000010 1                  ADSC9   DATA_LS                  cn=0,n=8

      953     8421    2      DATA_LS.PORT = DATA_LS.PORT-1;

   8421  8 003146   000364 236000 1                  LDQ     DATA_LS+1
         8 003147   000024 772000                    QRL     20
         8 003150   000001 136007                    SBLQ    1,DL
         8 003151   000024 736000                    QLS     20
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:143  
         8 003152   000364 756000 1                  STQ     DATA_LS+1

      954     8422    3      IF PASV = 0 THEN DO;

   8422  8 003153   000000 115003                    CMPA    0,DU
         8 003154   003161 601000 8                  TNZ     s:8425

      955     8423    3          DATA_FS = CMD_FS;

   8423  8 003155   000000 100400                    MLR     fill='000'O
         8 003156   000000 000010 xsym               ADSC9   CMD_FS                   cn=0,n=8
         8 003157   000361 000010 1                  ADSC9   DATA_FS                  cn=0,n=8

      956     8424    3          END;

   8424  8 003160   003172 710000 8                  TRA     s:8430

      957     8425    2      ELSE IF DATA_FS.ADDRESS/%BITBIN('01000000'X) = 127 THEN

   8425  8 003161   000361 236000 1                  LDQ     DATA_FS
         8 003162   000004 772000                    QRL     4
         8 003163   000030 772000                    QRL     24
         8 003164   000177 116007                    CMPQ    127,DL
         8 003165   003172 601000 8                  TNZ     s:8430

      958     8426    2              DATA_FS.ADDRESS = CMD_FS.ADDRESS;

   8426  8 003166   000000 236000 xsym               LDQ     CMD_FS
         8 003167   000004 772000                    QRL     4
         8 003170   000004 736000                    QLS     4
         8 003171   000361 756000 1                  STQ     DATA_FS

      959     8427
      960     8428                                                /* Open a socket to other end */
      961     8429
      962     8430    2      B$JIT.PRIV.ACTIVE.MSYS = '1'B; /* Get privileged so we can use low port#'s */

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:144  
   8430  8 003172   000000 470400 xsym               LDP0    B$JIT$
         8 003173   000010 236007                    LDQ     8,DL
         8 003174   000013 256100                    ORSQ    11,,PR0

      963     8431    2      DATA_LCN = -1;

   8431  8 003175   000001 335007                    LCA     1,DL
         8 003176   000000 755000 xsym               STA     DATA_LCN

      964     8432    2      CALL TCP$OPEN (DATA_LCN, DATA_LS, DATA_FS, %TCP_ACTIVE,,DATA_LS)

   8432  8 003177   000131 236000 9                  LDQ     89
         8 003200   000001 235000 xsym               LDA     B_VECTNIL+1
         8 003201   200070 757100                    STAQ    @PORT+6,,AUTO
         8 003202   000132 237000 9                  LDAQ    90
         8 003203   200066 757100                    STAQ    @PORT+4,,AUTO
         8 003204   000134 237000 9                  LDAQ    92
         8 003205   200064 757100                    STAQ    @PORT+2,,AUTO
         8 003206   200064 630500                    EPPR0   @PORT+2,,AUTO
         8 003207   000024 631400 xsym               EPPR1   B_VECTNIL+20
         8 003210   000000 701000 xent               TSX1    TCP$OPEN
         8 003211   003213 702000 8                  TSX2    s:8434
         8 003212   003234 710000 8                  TRA     s:8441

      965     8433    3      WHENALTRETURN DO;

      966     8434    3          B$JIT.PRIV.ACTIVE.MSYS = B$JIT.PRIV.JOB.MSYS;

   8434  8 003213   000000 470400 xsym               LDP0    B$JIT$
         8 003214   000015 236100                    LDQ     13,,PR0
         8 003215   000013 676100                    ERQ     11,,PR0
         8 003216   000010 376007                    ANQ     8,DL
         8 003217   000013 656100                    ERSQ    11,,PR0

   8434  8 003220                       RETALT       null
      967     8435    3   RETALT: ;
      968     8436    3          GLOBAL_ERR = %FTP_PROCEDURE_ERR;              /*N* REPORT ERROR */
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:145  

   8436  8 003220   000002 235007                    LDA     2,DL
         8 003221   000124 755000 1                  STA     GLOBAL_ERR

      969     8437    3          CALL REPORT_LIB;                 /* Send informational 425 response */

   8437  8 003222   003462 701000 8                  TSX1    REPORT_LIB
         8 003223   000000 011000                    NOP     0

      970     8438    3          IF DATA_LCN >= 0 THEN CALL TCP$RELEASE(DATA_LCN);

   8438  8 003224   000000 235000 xsym               LDA     DATA_LCN
         8 003225   003232 604000 8                  TMI     s:8439

   8438  8 003226   000020 630400 9                  EPPR0   16
         8 003227   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 003230   000000 701000 xent               TSX1    TCP$RELEASE
         8 003231   000000 011000                    NOP     0

      971     8439    3          ALTRETURN;

   8439  8 003232   200036 221300                    LDX1  ! I+1,,AUTO
         8 003233   000000 702211                    TSX2  ! 0,X1

      972     8440    3          END;
      973     8441    2      B$JIT.PRIV.ACTIVE.MSYS = B$JIT.PRIV.JOB.MSYS;

   8441  8 003234   000000 470400 xsym               LDP0    B$JIT$
         8 003235   000015 236100                    LDQ     13,,PR0
         8 003236   000013 676100                    ERQ     11,,PR0
         8 003237   000010 376007                    ANQ     8,DL
         8 003240   000013 656100                    ERSQ    11,,PR0

      974     8442    2      RETURN;

   8442  8 003241   200036 221300                    LDX1  ! I+1,,AUTO
         8 003242   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:146  

      975     8443
      976     8444
      977     8445    2   OPEN_PASV_PORT: ENTRY ALTRET;

   8445  8 003243   200036 741300       OPEN_PASV_P* STX1  ! I+1,,AUTO

      978     8446
      979     8447                            /* Open a listen socket and send its address to other end */
      980     8448    2      DATA_LS.PORT = 0;

   8448  8 003244   000364 450000 1                  STZ     DATA_LS+1

      981     8449    2      DATA_LS.ADDRESS = CMD_LS.ADDRESS;

   8449  8 003245   000000 236000 xsym               LDQ     CMD_LS
         8 003246   000004 772000                    QRL     4
         8 003247   000004 736000                    QLS     4
         8 003250   000363 756000 1                  STQ     DATA_LS

      982     8450    2      IF DATA_LS.ADDRESS/%BITBIN('01000000'X) = 127 THEN

   8450  8 003251   000363 236000 1                  LDQ     DATA_LS
         8 003252   000004 772000                    QRL     4
         8 003253   000030 772000                    QRL     24
         8 003254   000177 116007                    CMPQ    127,DL
         8 003255   003262 601000 8                  TNZ     s:8452

      983     8451    2          DATA_LS.ADDRESS = CMD_FS.ADDRESS;

   8451  8 003256   000000 236000 xsym               LDQ     CMD_FS
         8 003257   000004 772000                    QRL     4
         8 003260   000004 736000                    QLS     4
         8 003261   000363 756000 1                  STQ     DATA_LS

      984     8452    2      DATA_LCN = -1;

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:147  
   8452  8 003262   000001 335007                    LCA     1,DL
         8 003263   000000 755000 xsym               STA     DATA_LCN

      985     8453    2      DATA_FS = '0'B;

   8453  8 003264   000361 450000 1                  STZ     DATA_FS
         8 003265   000362 450000 1                  STZ     DATA_FS+1

      986     8454    2      CALL TCP$OPEN (DATA_LCN, DATA_LS, DATA_FS, %TCP_PASSIVE,,DATA_LS)

   8454  8 003266   000131 236000 9                  LDQ     89
         8 003267   000001 235000 xsym               LDA     B_VECTNIL+1
         8 003270   200070 757100                    STAQ    @PORT+6,,AUTO
         8 003271   000136 237000 9                  LDAQ    94
         8 003272   200066 757100                    STAQ    @PORT+4,,AUTO
         8 003273   000134 237000 9                  LDAQ    92
         8 003274   200064 757100                    STAQ    @PORT+2,,AUTO
         8 003275   200064 630500                    EPPR0   @PORT+2,,AUTO
         8 003276   000024 631400 xsym               EPPR1   B_VECTNIL+20
         8 003277   000000 701000 xent               TSX1    TCP$OPEN
         8 003300   003220 702000 8                  TSX2    RETALT

      987     8455    2            ALTRET (RETALT);
      988     8456                                                /* Build pasv response */
      989     8457    2      CALL PORT(DATA_LS.ADDRESS, DATA_LS.PORT);

   8457  8 003301   000140 236000 9                  LDQ     96
         8 003302   200062 756100                    STQ     @ADDRESS+1,,AUTO
         8 003303   000131 236000 9                  LDQ     89
         8 003304   200061 756100                    STQ     FMT_OUTL+2,,AUTO
         8 003305   003334 701000 8                  TSX1    PORT
         8 003306   000000 011000                    NOP     0

      990     8458    2      FMT_OUTL = FMT_OUTL-1;

   8458  8 003307   000001 336007                    LCQ     1,DL
         8 003310   200057 056100                    ASQ     FMT_OUTL,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:148  

      991     8459    2      CALL SEND_MSG (MSG_227, VECTOR(PINCRC(ADDR(FMT_OUT),1)->FMT_OUTB));

   8459  8 003311   200057 235100                    LDA     FMT_OUTL,,AUTO
         8 003312   000020 735000                    ALS     16
         8 003313   000140 135007                    SBLA    96,DL
         8 003314   200064 452500                    STP2    @PORT+2,,AUTO
         8 003315   200064 236100                    LDQ     @PORT+2,,AUTO
         8 003316   000141 036000 9                  ADLQ    97
         8 003317   200066 757100                    STAQ    @PORT+4,,AUTO
         8 003320   200066 630500                    EPPR0   @PORT+4,,AUTO
         8 003321   200071 450500                    STP0    @PORT+7,,AUTO
         8 003322   000142 236000 9                  LDQ     98
         8 003323   200070 756100                    STQ     @PORT+6,,AUTO
         8 003324   200070 630500                    EPPR0   @PORT+6,,AUTO
         8 003325   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 003326   000000 701000 xent               TSX1    SEND_MSG
         8 003327   000000 011000                    NOP     0

      992     8460    2      PASV = 1;

   8460  8 003330   000001 235007                    LDA     1,DL
         8 003331   000357 755000 1                  STA     PASV

      993     8461    2      RETURN;

   8461  8 003332   200036 221300                    LDX1  ! I+1,,AUTO
         8 003333   000001 702211                    TSX2  ! 1,X1

      994     8462
      995     8463        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:149  
      996     8464    2   PORT: PROC(ADDRESS,PORT);

   8464  8 003334   200060 741300       PORT         STX1  ! FMT_OUTL+1,,AUTO

      997     8465
      998     8466    3   DCL 1 ADDRESS UBIN(32) ALIGNED;
      999     8467
     1000     8468    3   DCL 1 PORT UBIN(16) ALIGNED;
     1001     8469
     1002     8470    3   DCL X$WRITE ENTRY(22);
     1003     8471        %INCLUDE XU_FORMAT_C;
     1004     8633        %F_FDS (NAME=FDS);
     1005     8746
     1006     8747    3   DCL IPFMT CONSTANT CHAR(0) INIT(' (%.8D,%.8D,%.8D,%.8D,%S%.8D,%.8D)%1Q');
     1007     8748
     1008     8749    3      FDS.BUF_ = VECTOR(FMT_OUT);

   8749  8 003335   000143 235000 9                  LDA     99
         8 003336   200064 452500                    STP2    @PORT+2,,AUTO
         8 003337   200064 236100                    LDQ     @PORT+2,,AUTO
         8 003340   000037 036003                    ADLQ    31,DU
         8 003341   000624 757000 1                  STAQ    FDS+5

     1009     8750    3      CALL X$WRITE (FDS, VECTOR(IPFMT), VECTOR(ADDRESS),

   8750  8 003342   777640 235007                    LDA     -96,DL
         8 003343   200061 236100                    LDQ     @ADDRESS,,AUTO
         8 003344   200064 757100                    STAQ    @PORT+2,,AUTO
         8 003345   777640 235007                    LDA     -96,DL
         8 003346   200062 236100                    LDQ     @PORT,,AUTO
         8 003347   200070 757100                    STAQ    @PORT+6,,AUTO
         8 003350   200064 237100                    LDAQ    @PORT+2,,AUTO
         8 003351   200066 757100                    STAQ    @PORT+4,,AUTO
         8 003352   200070 237100                    LDAQ    @PORT+6,,AUTO
         8 003353   200072 757100                    STAQ    @PORT+8,,AUTO
         8 003354   200072 630500                    EPPR0   @PORT+8,,AUTO
         8 003355   200077 450500                    STP0    @PORT+13,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:150  
         8 003356   200066 631500                    EPPR1   @PORT+4,,AUTO
         8 003357   200076 451500                    STP1    @PORT+12,,AUTO
         8 003360   000146 237000 9                  LDAQ    102
         8 003361   200074 757100                    STAQ    @PORT+10,,AUTO
         8 003362   200074 630500                    EPPR0   @PORT+10,,AUTO
         8 003363   000022 631400 xsym               EPPR1   B_VECTNIL+18
         8 003364   000000 701000 xent               TSX1    X$WRITE
         8 003365   000000 011000                    NOP     0

     1010     8751    3            VECTOR(PORT));
     1011     8752    3      FMT_OUTL = FDS.BUFX;

   8752  8 003366   000626 235000 1                  LDA     FDS+7
         8 003367   200057 755100                    STA     FMT_OUTL,,AUTO

     1012     8753
     1013     8754    3   END PORT;

   8754  8 003370   200060 221300                    LDX1  ! FMT_OUTL+1,,AUTO
         8 003371   000001 702211                    TSX2  ! 1,X1

     1014     8755    2   END OPEN_DATA_PORT;
     1015     8756        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:151  
     1016     8757    1   PARSE_PORT: PROC(SOCKET,TEXT);

   8757  8 003372   200032 741300       PARSE_PORT   STX1  ! TFID+21,,AUTO

     1017     8758        %TCP$SOCKET (NAME=SOCKET, STCLASS=PARAM);
     1018     8766    2   DCL TEXT(0:0) CHAR(1);
     1019     8767    2   DCL I SBIN;
     1020     8768    2   DCL J SBIN;
     1021     8769    2   DCL K SBIN;
     1022     8770
     1023     8771    2      J = -1;

   8771  8 003373   000001 335007                    LCA     1,DL
         8 003374   200036 755100                    STA     J,,AUTO

     1024     8772    2      I=0;

   8772  8 003375   200035 450100                    STZ     I,,AUTO

     1025     8773    2      K=0;

   8773  8 003376   200037 450100                    STZ     K,,AUTO

     1026     8774    3      DO WHILE '1'B;

     1027     8775    3          J = J + 1;

   8775  8 003377   200036 054100                    AOS     J,,AUTO

     1028     8776    4          IF TEXT(J) < '0' OR TEXT(J) > '9' THEN DO;

   8776  8 003400   200034 470500                    LDP0    @TEXT,,AUTO
         8 003401   200036 235100                    LDA     J,,AUTO
         8 003402   040000 106505                    CMPC    fill='040'O
         8 003403   000000 000001                    ADSC9   0,A,PR0                  cn=0,n=1
         8 003404   000150 000001 9                  ADSC9   104                      cn=0,n=1
         8 003405   003412 602000 8                  TNC     s:8777
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:152  
         8 003406   040105 106400                    CMPC    fill='040'O
         8 003407   000151 000001 9                  ADSC9   105                      cn=0,n=1
         8 003410   000000 000001                    ADSC9   0,A,PR0                  cn=0,n=1
         8 003411   003447 603000 8                  TRC     s:8785

     1029     8777    4              I = I + 1;

   8777  8 003412   200035 054100                    AOS     I,,AUTO

     1030     8778    4              SOCKET.PORT = SOCKET.PORT*256 + K;

   8778  8 003413   200033 471500                    LDP1    @SOCKET,,AUTO
         8 003414   100001 236100                    LDQ     1,,PR1
         8 003415   000014 772000                    QRL     12
         8 003416   000152 376000 9                  ANQ     106
         8 003417   200037 036100                    ADLQ    K,,AUTO
         8 003420   000024 736000                    QLS     20
         8 003421   100001 756100                    STQ     1,,PR1

     1031     8779    4              IF I = 6 THEN RETURN;

   8779  8 003422   200035 235100                    LDA     I,,AUTO
         8 003423   000006 115007                    CMPA    6,DL
         8 003424   003427 601000 8                  TNZ     s:8780

   8779  8 003425   200032 221300                    LDX1  ! TFID+21,,AUTO
         8 003426   000001 702211                    TSX2  ! 1,X1

     1032     8780    5              IF MOD(I,2) = 0 THEN DO;

   8780  8 003427   200035 236100                    LDQ     I,,AUTO
         8 003430   000002 506007                    DIV     2,DL
         8 003431   000044 733000                    LRS     36
         8 003432   000000 116003                    CMPQ    0,DU
         8 003433   003445 601000 8                  TNZ     s:8783

     1033     8781    5                  SOCKET.ADDRESS = SOCKET.ADDRESS*65536 + SOCKET.PORT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:153  

   8781  8 003434   100001 236100                    LDQ     1,,PR1
         8 003435   000024 772000                    QRL     20
         8 003436   200064 756100                    STQ     @PORT+2,,AUTO
         8 003437   100000 236100                    LDQ     0,,PR1
         8 003440   000014 736000                    QLS     12
         8 003441   000034 376000 xsym               ANQ     B_VECTNIL+28
         8 003442   200064 036100                    ADLQ    @PORT+2,,AUTO
         8 003443   000004 736000                    QLS     4
         8 003444   100000 756100                    STQ     0,,PR1

     1034     8782    5                  END;

     1035     8783    4              K = 0;

   8783  8 003445   200037 450100                    STZ     K,,AUTO

     1036     8784    4              END;

   8784  8 003446   003377 710000 8                  TRA     s:8775

     1037     8785    3          ELSE K = K*10 + ASCBIN(TEXT(J)) - 48;

   8785  8 003447   000100 101505                    MRL     fill='000'O
         8 003450   000000 000001                    ADSC9   0,A,PR0                  cn=0,n=1
         8 003451   200064 000004                    ADSC9   @PORT+2,,AUTO            cn=0,n=4
         8 003452   200064 236100                    LDQ     @PORT+2,,AUTO
         8 003453   200065 756100                    STQ     @PORT+3,,AUTO
         8 003454   200037 236100                    LDQ     K,,AUTO
         8 003455   000012 402007                    MPY     10,DL
         8 003456   200065 036100                    ADLQ    @PORT+3,,AUTO
         8 003457   000060 136007                    SBLQ    48,DL
         8 003460   200037 756100                    STQ     K,,AUTO

     1038     8786    3          END;

   8786  8 003461   003377 710000 8                  TRA     s:8775
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:154  

     1039     8787    2   END PARSE_PORT;
     1040     8788
     1041     8789        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:155  
     1042     8790    1   REPORT_LIB: PROC;

   8790  8 003462   200060 741300       REPORT_LIB   STX1  ! FMT_OUTL+1,,AUTO

     1043     8791        %FPT_ERRMSG (BUF=LINE_BUF,              /* errmsg */
     1044     8792               INCLCODE=NO,
     1045     8793               SUBMESS=YES,
     1046     8794                CODE=TCP_MON_ERR,
     1047     8795               SOURCE=ALTRET);
     1048     8822    2      FPT_ERRMSG.V.SOURCE# = 0;

   8822  8 003463   000153 236000 9                  LDQ     107
         8 003464   000706 356000 1                  ANSQ    FPT_ERRMSG+24
         8 003465   003467 710000 8                  TRA     s:8824

     1049     8823    2   REPORT_ALT: ENTRY;

   8823  8 003466   200060 741300       REPORT_ALT   STX1  ! FMT_OUTL+1,,AUTO

     1050     8824    2      CALL M$ERRMSG (FPT_ERRMSG);

   8824  8 003467   000656 630400 1                  EPPR0   FPT_ERRMSG
         8 003470   020000 713400                    CLIMB   8192
         8 003471   405000 401760                    pmme    nvectors=11

     1051     8825    2      CHARNLEN = 120;

   8825  8 003472   000170 235007                    LDA     120,DL
         8 003473   000125 755000 1                  STA     CHARNLEN

     1052     8826    3      DO WHILE SUBSTR(LINE_BUF,0,1) = ' ';

   8826  8 003474   003505 710000 8                  TRA     s:8830

     1053     8827    3          SUBSTR(LINE_BUF,0,120) = SUBSTR(LINE_BUF,1,119);

   8827  8 003475   040000 100400                    MLR     fill='040'O
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:156  
         8 003476   000000 200167 xsym               ADSC9   CMD_BUFFER               cn=1,n=119
         8 003477   000000 000170 xsym               ADSC9   CMD_BUFFER               cn=0,n=120

     1054     8828    3          CHARNLEN = CHARNLEN - 1;

   8828  8 003500   000125 235000 1                  LDA     CHARNLEN
         8 003501   000001 135007                    SBLA    1,DL
         8 003502   000125 755000 1                  STA     CHARNLEN

     1055     8829    3          IF CHARNLEN < 100 THEN EXIT;

   8829  8 003503   000144 115007                    CMPA    100,DL
         8 003504   003511 602000 8                  TNC     s:8832

     1056     8830    3          END;

   8830  8 003505   000000 236000 xsym               LDQ     CMD_BUFFER
         8 003506   777000 376003                    ANQ     -512,DU
         8 003507   040000 116003                    CMPQ    16384,DU
         8 003510   003475 600000 8                  TZE     s:8827

     1057     8831    3      DO UNTIL CHARNLEN = 1;

     1058     8832    3          IF SUBSTR (LINE_BUF, CHARNLEN-1, 1) ~= ' ' THEN EXIT;

   8832  8 003511   000125 235000 1                  LDA     CHARNLEN
         8 003512   040000 106405                    CMPC    fill='040'O
         8 003513   777777 600001 xsym               ADSC9   CMD_BUFFER-1,A           cn=3,n=1
         8 003514   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         8 003515   003522 601000 8                  TNZ     s:8835

     1059     8833    3          CHARNLEN = CHARNLEN-1;

   8833  8 003516   000001 135007                    SBLA    1,DL
         8 003517   000125 755000 1                  STA     CHARNLEN

     1060     8834    3          END;
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:157  

   8834  8 003520   000001 115007                    CMPA    1,DL
         8 003521   003511 601000 8                  TNZ     s:8832

     1061     8835    2      IF FPT_ERRMSG.V.SOURCE#~=0

   8835  8 003522   000706 236000 1                  LDQ     FPT_ERRMSG+24
         8 003523   340000 316007                    CANQ    114688,DL
         8 003524   003542 600000 8                  TZE     s:8837

     1062     8836    2      THEN CALL SEND_MSG (MSG_550, VECTOR(ADDR(LINE_BUF)->CHARN));

   8836  8 003525   000020 735000                    ALS     16
         8 003526   000140 135007                    SBLA    96,DL
         8 003527   000013 236000 9                  LDQ     11
         8 003530   200064 757100                    STAQ    @PORT+2,,AUTO
         8 003531   200064 630500                    EPPR0   @PORT+2,,AUTO
         8 003532   200067 450500                    STP0    @PORT+5,,AUTO
         8 003533   000053 236000 9                  LDQ     43
         8 003534   200066 756100                    STQ     @PORT+4,,AUTO
         8 003535   200066 630500                    EPPR0   @PORT+4,,AUTO
         8 003536   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 003537   000000 701000 xent               TSX1    SEND_MSG
         8 003540   000000 011000                    NOP     0
         8 003541   003556 710000 8                  TRA     s:8838

     1063     8837    2      ELSE CALL SEND_MSG (MSG_425E, VECTOR(ADDR(LINE_BUF)->CHARN));

   8837  8 003542   000020 735000                    ALS     16
         8 003543   000140 135007                    SBLA    96,DL
         8 003544   000013 236000 9                  LDQ     11
         8 003545   200064 757100                    STAQ    @PORT+2,,AUTO
         8 003546   200064 630500                    EPPR0   @PORT+2,,AUTO
         8 003547   200067 450500                    STP0    @PORT+5,,AUTO
         8 003550   000154 236000 9                  LDQ     108
         8 003551   200066 756100                    STQ     @PORT+4,,AUTO
         8 003552   200066 630500                    EPPR0   @PORT+4,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:158  
         8 003553   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 003554   000000 701000 xent               TSX1    SEND_MSG
         8 003555   000000 011000                    NOP     0

     1064     8838    2      FPT_ERRMSG.V.SOURCE# = 2;

   8838  8 003556   000706 236000 1                  LDQ     FPT_ERRMSG+24
         8 003557   000153 376000 9                  ANQ     107
         8 003560   100000 276007                    ORQ     32768,DL
         8 003561   000706 756000 1                  STQ     FPT_ERRMSG+24

     1065     8839    2      RETURN;

   8839  8 003562   200060 221300                    LDX1  ! FMT_OUTL+1,,AUTO
         8 003563   000001 702211                    TSX2  ! 1,X1

     1066     8840    2   END REPORT_LIB;
     1067     8841
     1068     8842
     1069     8843    1   END FTPCMD;

   8843  8 003564   000000 702200 xent               TSX2  ! X66_ARET

XUG_GETCMD
 Sect OctLoc
   1     000   000000 006000   000000 006014   000000 006014   000000 006014    ................
   1     004   000000 006014   000000 006014   040000 000000   04000* ***000    ........ ... ...
   1     010   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     014   000000 000000   000000 000000   000000 000000   000000 177640    ................
   1     020   000000 006014   000000 177640   000000 006014   000000 177640    ................
   1     030*  000000 006014   000000 000000   000000 000000   000000 000000    ................
   1     034   000000 177640   000000 006014   000000 006014   000000 000000    ................
   1     040   000000 006014   000000 006014   000000 006014   000000 006014    ................
   1     044   000000 006014   000000 006014   000000 000000   000000 000000    ................
   1     050   000000 000000   000000 000000                                    ........

XUG_INIT
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:159  
 Sect OctLoc
   1     052   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     062*  000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     066   000000 006014   000000 177640   000000 006014   000000 006014    ................
   1     072   000000 006014   000000 177640   000000 006014   000000 000454    ................
   1     076   000144 000144   001000 000000   050000 000000   000000 000000    .d.d....(.......
   1     102   000000 000000   000000 000000   000000 000000   000000 006014    ................
   1     106   000000 006014   000000 006014   000000 006014   000000 006014    ................
   1     112   00000* ******   000000 000000   000000 000000   000000 000000    ................

LOGGED_IN
 Sect OctLoc
   1     116   0***** ******                                                    ....

CB
 Sect OctLoc
   1     117   ****** ******   ****** ******   ****** ******   ****** ******    ................

FPT_TIME
 Sect OctLoc
   1     132   000001 777640   000144 006000   000000 177640   000000 006014    .....d..........
   1     136   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     142   000000 777640   000130 006000   000005 000000   ****** ******    .....X..........

FPT_YC
 Sect OctLoc
   1     146   000000 177640   000000 006014   000001 777640   000154 006000    .............l..
   1     152   000000 177640   000000 006014   200000 000000   0***** ******    ................

FPT_OPEN
 Sect OctLoc
   1     160   000025 777640   000224 006000   000003 777640   000266 006000    ................
   1     164   000000 177640   000000 006014   000007 777640   000254 006000    ................
   1     170   000001 777640   000264 006000   000000 177640   000000 006014    ................
   1     174   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     204*  000001 777640   000252 006000   000000 177640   000000 006014    ................
   1     210   000000 177640   000000 006014   000001 777640   000272 006000    ................
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:160  
   1     214   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     224*  000000 400042   000000 003000   252525 000001   000040 252520    ..."......... ..
   1     230   112106 040040   000000 000002   000000 777777   000000 000000    JF  ............
   1     234   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     240   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1     244   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1     250   000000 000000   ****** ******                                    ........

VLP_ACCT
 Sect OctLoc
   1     252   040040 040040   040040 040040

VLP_NAME
 Sect OctLoc
   1     254   037040 040040   040040 040040   040040 040040   040040 040040    .
   1     260   040040 040040   040040 040040   040040 040040   040040 040040

VLP_PASS
 Sect OctLoc
   1     264   040040 040040   040040 040040

VLP_SN
 Sect OctLoc
   1     266   000000 000001   040040 040040   040040 ******                    ....      ..

VLP_WSN
 Sect OctLoc
   1     272   040040 040040   040040 040040

FPT_FID
 Sect OctLoc
   1     274   000003 777640   000320 006000   000000 177640   000000 006014    ................
   1     300   000007 777640   000254 006000   000001 777640   000252 006000    ................
   1     304   000001 777640   000264 006000   000003 777640   000266 006000    ................
   1     310   000001 777640   000272 006000   000000 177640   000225 606000    ................
   1     314   000000 777640   000230 006000   000000 177640   000000 006014    ................
   1     320   777000 000000   000000 000000   000000 000000   ****** ******    ................
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:161  

FPT_READ
 Sect OctLoc
   1     324   000005 777640   000334 006000   000000 177640   000000 006014    ................
   1     330   001777 777640   000000 006000   000000 177640   000000 006014    ................
   1     334   000000 410000   000000 000000   000000 000000   000000 000000    ................
   1     340   000000 000000   000000 000000                                    ........

FPT_WRITE
 Sect OctLoc
   1     342   000003 777640   000352 006000   000000 177640   000000 006014    ................
   1     346   000013 577640   000024 006000   000000 177640   000000 006014    ................
   1     352   000000 400400   000000 000000   000000 000000   000000 000000    ................

FILE_TYPE
 Sect OctLoc
   1     356   000000 000000                                                    ....

PASV
 Sect OctLoc
   1     357   000000 000000                                                    ....

RNFR_PENDING
 Sect OctLoc
   1     360   000000 000000                                                    ....

AUTH
 Sect OctLoc
   1     365   000040 040040   040040 040040   040040 040040   040040 040040    .
   1     371   040040 040040   040210 000000   040040 040040   040040 040040         ...

CMD
 Sect OctLoc
   1     375   377*** ******   ****** ******   ****** ******   ****** ******    ................
   1     471*  ****** ******   ****** ******   ****** ******   ****** ******    ................

FPT_HELP
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:162  
 Sect OctLoc
   1     476   000003 777640   000520 006000   000010 777640   000524 006000    ................
   1     502   000010 777640   000535 006000   001777 777640   000000 006000    ................
   1     506   000007 777640   000564 006000   000001 777640   000575 406000    ................
   1     512   000001 777640   000577 406000   000015 777640   000546 006000    ................
   1     516   000001 377640   000574 006000   000000 000000   040000 000040    ............ ..
   1     522   400000 000000   000000 000000                                    ........

KEY1
 Sect OctLoc
   1     524   000*** ******   ****** ******   ****** ******   ****** ******    ................
   1     534*  ****** ******                                                    ....

KEY2
 Sect OctLoc
   1     535   000*** ******   ****** ******   ****** ******   ****** ******    ................
   1     545*  ****** ******                                                    ....

VLR_HELP
 Sect OctLoc
   1     546   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     552   000040 040040   040040 040040   040040 040040   040040 040040    .
   1     556   040040 040040   040040 040040   040040 040040   040040 040040
   1     562   040040 040000   000000 000000                                       .....

P
 Sect OctLoc
   1     564   004106 124120   104040 040040   040040 040040   040040 040040    .FTPD
   1     570   040040 040040   040040 040040   040040 040040   040040 040040
   1     600*  040040 040040   040040 ******                                          ..

CB
 Sect OctLoc
   1     605   ****** ******   ****** ******   ****** ******   ****** ******    ................

CB
 Sect OctLoc
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:163  
   1     612   ****** ******   ****** ******   ****** ******   ****** ******    ................

FDS
 Sect OctLoc
   1     617   000000 177640   000000 006014   000000 000000   000000 000000    ................
   1     623   000000 000000   000000 177640   000000 006014   000000 000001    ................
   1     627   000000 000000   000000 000000   000000 006014   000000 101500    ..............A.
   1     633   000000 000000   000000 000000   000000 000001   000000 000012    ................
   1     637   000000 000000   ****** ******   ****** ******   000000 000000    ................
   1     643   000000 000000   000000 000000   000000 000000   000000 006014    ................
   1     647   000000 006014   000000 006014   000000 006014   000000 000000    ................
   1     653   000000 000000   000000 000000                                    ........

FPT_ERRMSG
 Sect OctLoc
   1     656   000003 777640   000704 006000   000000 777640   000000 006000    ................
   1     662   001777 777640   000000 006000   000000 177640   000000 006014    ................
   1     666   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     702*  000000 177640   000000 006014   000000 000000   000000 000000    ................
   1     706   371000 130001   040000 000000                                    ..X. ...

FPT_LDEV
 Sect OctLoc
   3     000   000005 777640   000016 006000   000000 177640   000000 006014    ................
   3     004   000000 177640   000000 006014   000000 177640   000000 006014    ................
   3     014*  000000 177640   000000 006014   114120 060061   040000 040040    ........LP01 .
   3     020   000000 000000   000000 200111   040040 040040   000040 040000    .......I    .  .

PMD_CMD
 Sect OctLoc
   3     024   041120 115104   040104 101054   104103 054104   123054 112111    !PMD DA,DC,DS,JI
   3     030   054124 103073   104040 130123   114137 105122   122116 117134    ,TC;D XSL_ERRNO\
   3     034   112073 104040   060134 122105   107123 073120   114073 121***    J;D 0\REGS;PL;Q.

FPT_CLOSE
 Sect OctLoc
   3     040   000003 777640   000072 006000   000000 177640   000000 006014    .....:..........
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:164  
   3     044   000000 177640   000000 006014   000000 177640   000000 006014    ................
   3     070*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   3     074   000220 000000   000000 000000                                    ........

FPT_NSAVE
 Sect OctLoc
   3     076   000003 777640   000130 006000   000000 177640   000000 006014    .....X..........
   3     102   000000 177640   000000 006014   000000 177640   000000 006014    ................
   3     126*  000000 177640   000000 006014   000000 000000   000000 000040    ...............
   3     132   000220 000000   000000 000000                                    ........

TYPE_NAME
 Sect OctLoc
   3     134   101163 143151   151040 040040   111155 141147   145040 040040    Ascii   Image
   3     140   103120 055066   040040 040040                                    CP-6

MSG_150
 Sect OctLoc
   3     142   040061 065060   040117 160145   156151 156147   040144 141164     150 Opening dat
   3     146   141040 143157   156156 145143   164151 157156   040146 157162    a connection for
   3     152   040*** ******                                                     ...

MSG_200TYPE
 Sect OctLoc
   3     153   024062 060060   040124 171160   145040 143150   141156 147145    .200 Type change
   3     157   144040 164157   040*** ******                                    d to ...

MSG_200PORT
 Sect OctLoc
   3     161   032062 060060   040120 117122   124040 143157   155155 141156    .200 PORT comman
   3     165   144040 141143   143145 160164   145144 056***                    d accepted..

MSG_200SET
 Sect OctLoc
   3     170   031062 060060   040123 145164   040143 157155   155141 156144    .200 Set command
   3     174   040141 143143   145160 164145   144056 ******                     accepted...

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:165  
MSG_230USER
 Sect OctLoc
   3     177   032062 063060   040125 163145   162040 154157   147151 156040    .230 User login
   3     203   163165 143143   145163 163146   165154 056***                    successful..

MSG_202
 Sect OctLoc
   3     206   024062 060062   040116 157055   157160 040143   157155 160154    .202 No-op compl
   3     212   145164 145144   056*** ******                                    eted....

MSG_214
 Sect OctLoc
   3     214   075062 061064   055040 103120   055066 040106   124120 040162    =214- CP-6 FTP r
   3     220   145143 157147   156151 172145   163040 164150   145163 145040    ecognizes these
   3     224   143157 155155   141156 144163   072040 050052   040075 040165    commands: (* = u
   3     230   156151 155160   154145 155145   156164 145144   051056 ******    nimplemented)...

(unnamed)
 Sect OctLoc
   3     234   077040 040040   101102 117122   052040 040101   103103 124052    ?   ABOR*  ACCT*
   3     240   040040 101114   114117 040040   040101 120120   105040 040040      ALLO   APPE
   3     244   103104 125120   040040 040103   127104 040040   040040 104105    CDUP   CWD    DE
   3     250   114105 040040   040110 105114   120040 040040   114111 123124    LE   HELP   LIST
   3     254   077040 040040   115117 104105   052040 040115   113104 052040    ?   MODE*  MKD*
   3     260   040040 116114   123124 040040   040116 117117   120040 040040      NLST   NOOP
   3     264   120101 123123   040040 040120   101123 126040   040040 120117    PASS   PASV   PO
   3     270   122124 040040   040120 127104   040040 040040   121125 111124    RT   PWD    QUIT
   3     274   100040 040040   122105 111116   052040 040122   105123 124052    @   REIN*  REST*
   3     300   040040 122105   124122 040040   040122 115104   052040 040040      RETR   RMD*
   3     304   122116 106122   040040 040122   116124 117040   040040 123111    RNFR   RNTO   SI
   3     310   124105 052040   040123 115116   124052 040040   123124 101124    TE*  SMNT*  STAT
   3     314   052*** ******   061040 040040   123124 117122   040040 040123    *...1   STOR   S
   3     320   124117 125052   040040 123124   122125 052040   040123 131123    TOU*  STRU*  SYS
   3     324   124052 040040   124131 120105   040040 040125   123105 122040    T*  TYPE   USER
   3     330   040040 041123   105124 ******   051062 061064   040125 163145      !SET..)214 Use
   3     334   040122 110105   114120 040050   111102 105130   051040 146157     RHELP (IBEX) fo
   3     340   162040 151156   146157 040141   142157 165164   040150 145154    r info about hel
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:166  
   3     344   160056 ******                                                    p...

MSG_221
 Sect OctLoc
   3     345   042062 062061   040103 120055   066040 106124   120040 163145    "221 CP-6 FTP se
   3     351   162166 145162   040144 151163   143157 156156   145143 164151    rver disconnecti
   3     355   156147 056***                                                    ng..

MSG_226
 Sect OctLoc
   3     356   034062 062066   040104 141164   141040 124162   141156 163146    .226 Data Transf
   3     362   145162 040143   157155 160154   145164 145144   056*** ******    er completed....

MSG_227
 Sect OctLoc
   3     366   032062 062067   040105 156164   145162 151156   147040 120141    .227 Entering Pa
   3     372   163163 151166   145040 155157   144145 040***                    ssive mode .

MSG_230
 Sect OctLoc
   3     375   065062 063060   040107 165145   163164 040165   163145 162151    5230 Guest useri
   3     401   144040 141143   143145 160164   145144 073040   141143 143145    d accepted; acce
   3     405   163163 040162   145163 164162   151143 164151   157156 163040    ss restrictions
   3     411   141160 160154   171056 ******                                    apply...

MSG_250DEL
 Sect OctLoc
   3     413   021062 065060   040104 145154   145164 145144   040146 151154    .250 Deleted fil
   3     417   145040 ******                                                    e ..

MSG_250RNTO
 Sect OctLoc
   3     420   017062 065060   040122 145156   141155 145144   040164 157040    .250 Renamed to

MSG_257
 Sect OctLoc
   3     424   031062 065067   040103 165162   162145 156164   040144 151162    .257 Current dir
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:167  
   3     430   145143 164157   162171 040151   163040 ******                    ectory is ..

MSG_331
 Sect OctLoc
   3     433   026063 063061   040120 141163   163167 157162   144040 162145    .331 Password re
   3     437   161165 151162   145144 056***                                    quired..

MSG_331GUEST
 Sect OctLoc
   3     441   054063 063061   040107 165145   163164 040154   157147 151156    ,331 Guest login
   3     445   040157 153073   040163 145156   144040 165163   145162 151144     ok; send userid
   3     451   040141 163040   160141 163163   167157 162144   056*** ******     as password....

MSG_350RNFR
 Sect OctLoc
   3     455   034063 065060   040106 151154   145040 157153   040055 040141    .350 File ok - a
   3     461   167141 151164   151156 147040   122116 124117   056*** ******    waiting RNTO....

(unnamed)
 Sect OctLoc
   3     465   037064 062065   040103 141156   047164 040157   160145 156040    .425 Can't open
   3     471   104141 164141   040143 157156   156145 143164   151157 156056    Data connection.

MSG_425E
 Sect OctLoc
   3     475   040064 062065   040103 141156   047164 040157   160145 156040     425 Can't open
   3     501   104141 164141   040143 157156   156145 143164   151157 156072    Data connection:
   3     505   040*** ******                                                     ...

MSG_426
 Sect OctLoc
   3     506   051064 062066   040103 157156   156145 143164   151157 156040    )426 Connection
   3     512   143154 157163   145144 073040   164162 141156   163146 145162    closed; transfer
   3     516   040141 142157   162164 145144   056004 ******                     aborted....

MSG_500
 Sect OctLoc
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:168  
   3     521   050065 060060   040123 171156   164141 170040   145162 162157    (500 Syntax erro
   3     525   162040 055040   165156 162145   143157 147156   151172 145144    r - unrecognized
   3     531   040143 157155   155141 156144   056*** ******                     command....

MSG_501
 Sect OctLoc
   3     534   037065 060061   040123 171156   164141 170040   145162 162157    .501 Syntax erro
   3     540   162040 151156   040160 141162   141155 145164   145162 163056    r in parameters.

MSG_502
 Sect OctLoc
   3     544   032065 060062   040125 156151   155160 154145   155145 156164    .502 Unimplement
   3     550   145144 040143   157155 155141   156144 056***                    ed command..

MSG_503
 Sect OctLoc
   3     553   031065 060063   040102 141144   040143 157155   155141 156144    .503 Bad command
   3     557   040163 145161   165145 156143   145056 ******                     sequence...

MSG_504
 Sect OctLoc
   3     562   036065 060064   040120 141162   141155 145164   145162 040156    .504 Parameter n
   3     566   157164 040151   155160 154145   155145 155164   145144 056***    ot implememted..

MSG_530
 Sect OctLoc
   3     572   027065 063060   040125 163145   162040 156157   164040 154157    .530 User not lo
   3     576   147147 145144   040151 156056                                    gged in.

MSG_530USER
 Sect OctLoc
   3     600   022065 063060   040101 143143   145163 163040   144145 156151    .530 Access deni
   3     604   145144 056***                                                    ed..

MSG_530LOGOUT
 Sect OctLoc
   3     605   061065 063060   040125 163145   162040 143157   155155 141156    1530 User comman
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:169  
   3     611   144040 156157   164040 141154   154157 167145   144073 040160    d not allowed; p
   3     615   154145 141163   145040 143154   157163 145040   146151 162163    lease close firs
   3     621   164056 ******                                                    t...

MSG_550
 Sect OctLoc
   3     622   026065 065060   040122 145161   165145 163164   040162 145152    .550 Request rej
   3     626   145143 164145   144072 040***                                    ected: .

MSG_550H
 Sect OctLoc
   3     630   031065 065060   040110 145154   160040 155145   163163 141147    .550 Help messag
   3     634   145040 164157   157040 142151   147056 ******                    e too big...

MSG_500$
 Sect OctLoc
   3     637   000521 006000   000534 006000   000544 006000   000553 006000    ................
   3     643   000562 006000                                                    ....

READ_FTPUSERS
 Sect OctLoc
   3     644   000005 777640   000654 006000   000000 177640   000000 006014    ................
   3     650   001777 777640   000000 006000   000000 177640   000000 006014    ................
   3     654   000000 400000   000000 000000   000000 000000   000000 000000    ................
   3     660   000000 000000   000000 000000                                    ........

CLOSE_FTPUSERS
 Sect OctLoc
   3     662   000003 777640   000714 006000   000000 177640   000000 006014    ................
   3     666   000000 177640   000000 006014   000000 177640   000000 006014    ................
   3     712*  000000 177640   000000 006014   000000 000000   000000 000040    ...............
   3     716   000220 000000   000000 000000                                    ........

FPT_SETFMA
 Sect OctLoc
   3     720   000001 777640   000252 006000   000001 377640   000267 006000    ................

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:170  
FPT_LINK
 Sect OctLoc
   3     724   000000 777640   000744 006000   000001 777640   000745 006000    ................
   3     730   000000 177640   000000 006014   000000 177640   000000 006014    ................
   3     734   000077 777640   000375 006000   000000 177640   000000 006014    .?..............
   3     740   000001 777640   000742 006000   600000 000000   000000 000000    ................

VLP_PCL
 Sect OctLoc
   3     744   003120 103114                                                    .PCL

VLP_SYS
 Sect OctLoc
   3     745   072123 131123   040040 040040                                    :SYS

VLP_STARL
 Sect OctLoc
   3     747   002052 114***                                                    .*L.

SETDO
 Sect OctLoc
   3     750   000004 377640   000760 006000   000001 777640   000756 006000    ................
   3     754   000000 177640   000000 006014   000000 000000   0***** ******    ................

SETDOCMD
 Sect OctLoc
   3     760   123105 124040   115044 104117   040052 104117   054105 130111    SET M$DO *DO,EXI
   3     764   075117 ******                                                    =O..

DELDO
 Sect OctLoc
   3     766   000025 777640   001032 006000   000000 177640   000000 006014    ................
   3     772   000000 177640   000000 006014   000000 177640   000000 006014    ................
   3    1032*  000000 640042   000000 001000   252525 000000   000040 252520    ..."......... ..
   3    1036   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   3    1042   000000 000000   000000 000000   000000 000000   000000 000000    ................
   3    1046   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:171  
   3    1052   040040 040040   000000 000000   000000 000000   000000 000000        ............
   3    1056   000000 000000   ****** ******                                    ........

CLSDO
 Sect OctLoc
   3    1060   000003 777640   001112 006000   000000 177640   000000 006014    .....J..........
   3    1064   000000 177640   000000 006014   000000 177640   000000 006014    ................
   3    1110*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   3    1114   000220 000000   000000 000000                                    ........

READDO
 Sect OctLoc
   3    1116   000005 777640   001126 006000   000000 177640   000000 006014    .....V..........
   3    1122   001777 777640   000000 006000   000000 177640   000000 006014    ................
   3    1126   000000 400000   000000 000000   000000 000000   000000 000000    ................
   3    1132   000000 000000   000000 000000                                    ........

RENAME
 Sect OctLoc
   3    1134   000003 777640   001166 006000   000000 177640   000000 006014    .....v..........
   3    1140   000000 177640   000000 006014   000007 777640   000254 006000    ................
   3    1144   000001 777640   000264 006000   000000 177640   000000 006014    ................
   3    1150   000000 177640   000000 006014   000000 177640   000000 006014    ................
   3    1164*  000000 177640   000000 006014   000000 400000   000000 000040    ...............
   3    1170   000220 000000   000000 000000                                    ........

MSG0
 Sect OctLoc
   3    1172   003062 061064   040040 040040                                    .214

DASH
 Sect OctLoc
   3    1174   055*** ******                                                    -...

MSGI
 Sect OctLoc
   3    1175   001040 040040   040040 040040                                    .
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:172  

MSGN
 Sect OctLoc
   3    1177   011062 061064   040010 010010   010040 040040                    .214 ....

IPFMT
 Sect OctLoc
   3    1202   040050 045056   070104 054045   056070 104054   045056 070104     (%.8D,%.8D,%.8D
   3    1206   054045 056070   104054 045123   045056 070104   054045 056070    ,%.8D,%S%.8D,%.8
   3    1212   104051 045061   121*** ******                                    D)%1Q...

(unnamed)
 Sect OctLoc
   3    1214   114050 101051   040040 040040   114050 103075   060051 040040    L(A)    L(C=0)
   3    1220   000000 000040   104120 043040   107165 145163   164040 154157    ... DP# Guest lo
   3    1224   147151 156040   146162 157155   040040 040040   040050 040040    gin from     (
   3    1230   117126 105122   040052 114040   050116 123125   115051 040040    OVER *L (NSUM)
   3    1234   077077 040040   040116 157040   155145 163163   141147 145040    ??   No message
   3    1240   141166 141151   154141 142154   145056 040040                    available.

(unnamed)
 Sect OctLoc
   6     000   000000 000000   000000 000000   000000 000000   000000 000501    ................
   6     004   000000 000000   000000 000000   000000 006014   000000 006014    ................
   6     010   014145 164143   072146 164160   165163 145162   163040 040040    .etc:ftpusers
   6     014   040040 040040   040040 040040   040040 040040   040040 040040
   6     020   072123 131123   040040 040040   040040 040040   040040 040040    :SYS
   6     024   040040 040040   040040 040040   115105 040040   040040 040040            ME
   6     030   040040 040040   000000 203015   000000 001000   000000 000000        ............
   6     034   000000 000000   000000 000000   000000 000000   000002 776003    ................
   6     040   001000 000000   000000 000002   000000 000000   000000 000000    ................
   6     044   000000 000111   040040 040040   000000 006014   000000 006014    ...I    ........
   6     050   000000 006014   000000 000000   000000 000000   000000 006014    ................
   6     054   000000 000000   000000 000000   000000 000000   000000 000000    ................
   6     060   000000 010000   000000 000000   000000 000000   000000 000000    ................
   6     064   000000 000020   000000 000000   000000 006014   000000 000000    ................
   6     070   000000 000000   000000 000000   000000 000000   000000 000000    ................
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:173  
   6     074   000000 000000   000000 006014   000000 000000   000000 000000    ................
   6     100   000000 000000   000000 000000   000000 000000   000000 000000    ................
   6     104   ****** ******   ****** ******   000000 000000   ****** ******    ................
   6     110   000000 000000   000000 000000   000000 000000   000000 000000    ................
   6     124*  000000 000000   000000 000000   000000 000000   ****** ******    ................
   6     134*  ****** ******   ****** ******   ****** ******   000000 070707    ..............8.
   6     140   ****** ******   ****** ******                                    ........

(unnamed)
 Sect OctLoc
   9     000   000000 006000   000572 006000   000553 006000   001214 006000    ................
   9     004   001216 006000   000206 006000   000000 206000   000177 006000    ................
   9     010   000345 006000   000000 006000   056040 040040   000000 006000    .........   ....
   9     014   000424 006000   000001 777640   000134 006000   000153 006000    .........\...k..
   9     020   000000 006000   000004 200000   000361 006000   000161 006000    .............q..
   9     024   000170 006000   000534 006000   000544 006000   000000 006003    .x..............
   9     030   000000 006000   000052 006000   000605 006000   000365 006000    .....*..........
   9     034   000000 006000   777757 777777   777767 777777   777577 777777    ................
   9     040   000600 006000   000441 006000   052040 040040   777677 777777    ........*   ....
   9     044   000000 006000   000000 000000   000007 777640   000000 006000    ................
   9     050   051040 040040   000375 006000   000433 006000   000622 006000    )   ............
   9     054   000455 006000   000000 000000   040040 040040   040040 040040    ........
   9     060   000420 006000   000276 006000   777777 737777   000413 006000    ................
   9     064   000276 006000   000214 006000   777777 777773   777777 777767    ................
   9     070   777777 777775   777777 777776   077040 040040   001040 040040    ........?   .
   9     074   000630 006000   000000 000000   000000 177640   001174 006000    .............|..
   9     100   001172 006000   000076 006000   001175 006000   000023 600000    .z...>...}......
   9     104   001177 006000   777777 777177   000142 006000   000276 006000    .........b......
   9     110   000000 000074   000110 006000   001777 777640   000000 006000    ...<.H..........
   9     114   000000 006000   000112 006000   000603 006000   776777 777777    .....J..........
   9     120   000000 006000   000112 006000   000117 006000   000506 006000    .....J...O......
   9     124   000356 006000   000127 006000   000126 006000   000605 006000    .....W...V......
   9     130   000612 006000   000363 006000   000361 006000   000003 006000    ................
   9     134   000000 006000   000363 006000   000361 006000   000004 006000    ................
   9     140   000364 006000   000037 200000   000366 006000   000017 777640    ................
   9     144   000011 177640   001202 006000   000617 006000   000144 006000    .............d..
   9     150   060040 040040   071040 040040   000077 777400   777777 437777    0   9   .?......
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:174  
   9     154   000475 006000                                                    ....
     1070     8844        %EOD;

PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:175  
--  Include file information  --

   XU_FORMAT_C.:LIBRARY  is referenced.
   XSL_CHAM_M.:TCA2TOU  is referenced.
   B_ERRORS_C.:LIBRARY  is referenced.
   TCP_HEP_M.:TCA2TOU  cannot be made into a system file and is referenced.
   TCF_FTP_E.:TCA2TOU  is referenced.
   XUG_ENTRY.:LIBRARY  cannot be made into a system file and is referenced.
   XU_MACRO_C.:LIBRARY  is referenced.
   B$JIT.:LIBRARY  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIBRARY  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FTPCMD.
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:176  

 **** Variables and constants ****

  ****  Section 001  Data  FTPCMD

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   603-0-0/w UBIN        r     1 ARS                      365-0-0/w STRC(288)   r     1 AUTH
   127-0-0/w UBIN        r     1 BYTES                    117-0-0/w STRC(180)   r     1 CB
   605-0-0/w STRC(180)   r     1 CB                       612-0-0/w STRC(180)   r     1 CB
   125-0-0/w UBIN        r     1 CHARNLEN                 375-0-0/c STRC(2304)  r     1 CMD
   361-0-0/w STRC(72)    r     1 DATA_FS                  363-0-0/w STRC(72)    r     1 DATA_LS
   156-0-0/w PTR         r     1 F$FILE$                  617-0-0/w STRC(1080)  r     1 FDS
   356-0-0/w UBIN        r     1 FILE_TYPE                656-0-0/d STRC(936)   r     1 FPT_ERRMSG
   274-0-0/d STRC(864)   r     1 FPT_FID                  476-0-0/d STRC(792)   r     1 FPT_HELP
   160-0-0/d STRC(2088)  r     1 FPT_OPEN                 324-0-0/d STRC(504)   r     1 FPT_READ
   132-0-0/d STRC(432)   r     1 FPT_TIME                 342-0-0/d STRC(432)   r     1 FPT_WRITE
   146-0-0/d STRC(288)   r     1 FPT_YC                   124-0-0/w UBIN        r     1 GLOBAL_ERR
   524-0-0/b UBIN(9)     r     1 KEY1(0:35)               535-0-0/b UBIN(9)     r     1 KEY2(0:35)
   116-0-0/b BIT         r     1 LOGGED_IN                602-0-0/b BIT         r     1 OK
   604-0-0/b BIT         r     1 OK                       564-0-0/c STRC(486)   r     1 P
   357-0-0/w SBIN        r     1 PASV                     564-0-0/c CHAR(54)    r     1 PCH
   360-0-0/b BIT         r     1 RNFR_PENDING             126-0-0/w UBIN        r     1 START_TIME
   130-0-0/w UBIN        r     1 TSTAMP                   252-0-0/c STRC(72)    r     1 VLP_ACCT
   254-0-0/c STRC(288)   r     1 VLP_NAME                 264-0-0/c STRC(72)    r     1 VLP_PASS
   266-0-0/d STRC(90)    r     1 VLP_SN                   272-0-0/c STRC(72)    r     1 VLP_WSN
   546-0-0/d STRC(504)   r     1 VLR_HELP                   0-0-0/d STRC(1512)  r     1 XUG_GETCMD
    52-0-0/d STRC(1296)  r     1 XUG_INIT

  ****  Section 003 RoData FTPCMD

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   662-0-0/d STRC(1080)  r     1 CLOSE_FTPUSERS          1060-0-0/d STRC(1080)  r     1 CLSDO
  1174-0-0/c CHAR        r     1 DASH                     766-0-0/d STRC(2088)  r     1 DELDO
    40-0-0/d STRC(1080)  r     1 FPT_CLOSE                  0-0-0/d STRC(720)   r     1 FPT_LDEV
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:177  
   724-0-0/d STRC(576)   r     1 FPT_LINK                  76-0-0/d STRC(1080)  r     1 FPT_NSAVE
   720-0-0/d STRC(144)   r     1 FPT_SETFMA              1202-0-0/c CHAR(37)    r     1 IPFMT
  1172-0-0/c CHAR(8)     r     1 MSG0                    1175-0-0/c CHAR(8)     r     1 MSGI
  1177-0-0/c CHAR(12)    r     1 MSGN                     142-0-0/c STRC(297)   r     1 MSG_150
   161-0-0/c STRC(243)   r     1 MSG_200PORT              170-0-0/c STRC(234)   r     1 MSG_200SET
   153-0-0/c STRC(189)   r     1 MSG_200TYPE              206-0-0/c STRC(189)   r     1 MSG_202
   214-0-0/c STRC(558)   r     1 MSG_214                  345-0-0/c STRC(315)   r     1 MSG_221
   356-0-0/c STRC(261)   r     1 MSG_226                  366-0-0/c STRC(243)   r     1 MSG_227
   375-0-0/c STRC(486)   r     1 MSG_230                  177-0-0/c STRC(243)   r     1 MSG_230USER
   413-0-0/c STRC(162)   r     1 MSG_250DEL               420-0-0/c STRC(144)   r     1 MSG_250RNTO
   424-0-0/c STRC(234)   r     1 MSG_257                  433-0-0/c STRC(207)   r     1 MSG_331
   441-0-0/c STRC(405)   r     1 MSG_331GUEST             455-0-0/c STRC(261)   r     1 MSG_350RNFR
   475-0-0/c STRC(297)   r     1 MSG_425E                 506-0-0/c STRC(378)   r     1 MSG_426
   521-0-0/c STRC(369)   r     1 MSG_500
   637-0-0/w PTR         r     1 MSG_500$(0:4)
   534-0-0/c STRC(288)   r     1 MSG_501                  544-0-0/c STRC(243)   r     1 MSG_502
   553-0-0/c STRC(234)   r     1 MSG_503                  562-0-0/c STRC(279)   r     1 MSG_504
   572-0-0/c STRC(216)   r     1 MSG_530                  605-0-0/c STRC(450)   r     1 MSG_530LOGOUT
   600-0-0/c STRC(171)   r     1 MSG_530USER              622-0-0/c STRC(207)   r     1 MSG_550
   630-0-0/c STRC(234)   r     1 MSG_550H                  24-0-0/c CHAR(47)    r     1 PMD_CMD
  1116-0-0/d STRC(504)   r     1 READDO                   644-0-0/d STRC(504)   r     1 READ_FTPUSERS
  1134-0-0/d STRC(1080)  r     1 RENAME                   750-0-0/d STRC(288)   r     1 SETDO
   760-0-0/c CHAR(18)    r     1 SETDOCMD
   134-0-0/w CHAR(5)     r     1 TYPE_NAME(0:2)
   744-0-0/c STRC        r     1 VLP_PCL                  747-0-0/c STRC(27)    r     1 VLP_STARL
   745-0-0/c STRC(72)    r     1 VLP_SYS

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    61-0-0/w PTR         r     1 @ADDRESS                  33-0-0/w PTR         r     1 @CMDT
    37-0-0/w PTR         r     1 @LCN                      37-0-0/w PTR         r     1 @LCN
    34-0-0/w PTR         r     1 @LFID$                    35-0-0/w PTR         r     1 @LFID$
    33-0-0/w PTR         r     1 @ONOVER                   62-0-0/w PTR         r     1 @PORT
    33-0-0/w PTR         r     1 @SOCKET                   34-0-0/w PTR         r     1 @TEXT
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:178  
    40-0-0/w PTR         r     1 @TIMEOUT                  40-0-0/w PTR         r     1 @TIMEOUT
    *0-0-0/w UBIN(32)    r     1 ADDRESS                   *0-0-0/c CHAR(6)     r     1 CMDT
     4-0-0/w UBIN        r     1 CODE                      35-0-0/w SBIN        r     1 CURSIZ
    37-0-0/c CHAR(64)    r     1 FMT_OUT                   57-0-0/w SBIN        r     1 FMT_OUTL
    33-0-0/w SBIN        r     1 I                         34-0-0/w SBIN        r     1 I
    35-0-0/w SBIN        r     1 I                         36-0-0/w SBIN        r     1 J
    37-0-0/w SBIN        r     1 K                         *0-0-0/w UBIN        r     1 LCN
    *0-0-0/w UBIN        r     1 LCN                       *0-0-0/w PTR         r     1 LFID$
    *0-0-0/w PTR         r     1 LFID$                     *0-0-0/h UBIN(18)    r     1 ONOVER
     3-0-0/w PTR         r     1 PARSE$                    *0-0-0/w UBIN(16)    r     1 PORT
    *0-0-0/w STRC(72)    r     1 SOCKET                    33-0-0/w PTR         r     1 SUBLK$
    *0-0-0/c CHAR        r     1 TEXT(0:0)                  5-0-0/c STRC(720)   r     1 TFID
    *0-0-0/w UBIN        r     1 TIMEOUT                   *0-0-0/w UBIN        r     1 TIMEOUT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$TCB$
     0-0-0/c CHAR(4096)  r     1 CMD_BUFFER                 0-0-0/w STRC(72)    r     1 CMD_FS
     0-0-0/w SBIN        r     1 CMD_LCN                    0-0-0/w STRC(72)    r     1 CMD_LS
     0-0-0/c CHAR(2)     r     1 CRLF                       0-0-0/c CHAR(4096)  r     1 DATA_BUFFER
     0-0-0/w SBIN        r     1 DATA_LCN                   0-0-0/w UBIN        r     1 FTP_NODES
     0-0-0/c CHAR(4096)  r     1 LINE_BUF                   0-0-0/b BIT         r     1 RUNNING
     0-0-0/c ASTR(9)     r     1 SALUTATION                 0-0-0/b STRC        r     1 TCP_MON_ERR
     0-0-0/d STRC(432)   r     1 WRITE_LO

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w STRC(144)   r     1 B$TCB                      0-0-0/c ACHR        r     1 CHARN
     0-0-0N  NULL        r     1 F$ANON                     0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0N  NULL        r     1 F$FILE                     0-0-0/d ASTR(3528)  r     1 F$FTPUSERS
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:179  
     0-0-0/c ACHR        r     1 FMT_OUTB                   0-0-0N  NULL        r     1 M$DO
     0-0-0/w STRC(144)   r     1 OUT$BLK                    0-0-0/w ASTR(153)   r     1 OUT$SYM
     0-0-0/w STRC(144)   r     1 SUB$BLK                    0-0-0/w STRC(432)   r     1 TCP$ADMIN
     0-0-0/w STRC(432)   r     1 TCP$ADMIN                  0-0-0/c ASTR(9)     r     1 TEXTC
     0-0-0/w ASTR(9)     r     1 TEXTC


   Procedure FTPCMD requires 1909 words for executable code.
   Procedure FTPCMD requires 64 words of local(AUTO) storage.
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:180  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:181  
          MINI XREF LISTING

ADDRESS IN PROCEDURE PORT
      8466**DCL      8464--PROC     8750--CALL
ARS IN PROCEDURE GET_CMD
      8085**DCL      8120<<ASSIGN   8142<>CALL     8144>>ASSIGN   8146>>ASSIGN   8184>>IF       8186>>IF
      8187>>ASSIGN
AUTH IN PROCEDURE USER_CMD
      7157**DCL      7335<>CALL     7345<>CALL     7372<>CALL     7406<>CALL
AUTH.ACCN IN PROCEDURE USER_CMD
      7157**DCL      7341<<ASSIGN   7355<<ASSIGN   7410>>IF
AUTH.FLAGS.BADPW IN PROCEDURE USER_CMD
      7160**DCL      7333<<ASSIGN   7336<<ASSIGN
AUTH.FLAGS.CHECKPW IN PROCEDURE USER_CMD
      7160**DCL      7334<<ASSIGN   7343<<ASSIGN   7368>>IF       7373<<ASSIGN
AUTH.FLAGS.DO_ACCOUNTING IN PROCEDURE USER_CMD
      7158**DCL      7328<<ASSIGN
AUTH.FLAGS.SCRAMBLED IN PROCEDURE USER_CMD
      7159**DCL      7354<<ASSIGN   7401<<ASSIGN
AUTH.FLAGS.STUFF_JIT IN PROCEDURE USER_CMD
      7158**DCL      7344<<ASSIGN   7348<<ASSIGN
AUTH.L IN PROCEDURE USER_CMD
      7157**DCL      7340<<ASSIGN   7352<<ASSIGN   7358<<ASSIGN   7371<<ASSIGN
AUTH.PASS IN PROCEDURE USER_CMD
      7161**DCL      7161--REDEF    7394<<ASSIGN
AUTH.PSWB IN PROCEDURE USER_CMD
      7161**DCL      7360<<ASSIGN   7400<<ASSIGN
AUTH.RESPONSE IN PROCEDURE USER_CMD
      7161**DCL      7332>>IF       7346>>IF       7349<<ASSIGN   7363>>IF       7374>>IF       7405<<ASSIGN
      7407>>IF       7411<<ASSIGN   7417>>IF       7418>>IF
AUTH.USER IN PROCEDURE USER_CMD
      7158**DCL      7342<<ASSIGN   7353<<ASSIGN   7357<<ASSIGN
B$ALT.CODE
      4173**DCL      4173--REDEF    4174--REDEF    4174--REDEF
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:182  
B$ALT.ERR.ERR#
      4175**DCL      4175--REDEF    8260>>IF
B$ALT.ERR.FCG
      4175**DCL      7097>>IF
B$ALT.EVID
      4174**DCL      4174--REDEF    4174--REDEF
B$JIT.ACCN
       644**DCL      7448>>ASSIGN
B$JIT.CLRES
       911**DCL      7120<<ASSIGN
B$JIT.CPFLAGS1.SLEAZE
       738**DCL       738--REDEF
B$JIT.ERR.MID
       645**DCL       645--REDEF
B$JIT.FACCN
       644**DCL      7059>>ASSIGN   7759--ASSIGN
B$JIT.FPSN
       725**DCL      7052>>IF       7055>>ASSIGN
B$JIT.JRESPEAK
       806**DCL       807--REDEF
B$JIT.JUNK
       844**DCL      7118<<ASSIGN   7118>>ASSIGN
B$JIT.ORIGINATOR_PORT.FROM_CR
       915**DCL       915--REDEF     916--REDEF
B$JIT.PNR
       819**DCL       819--REDEF
B$JIT.PRIV.ACTIVE
       645**DCL      7023<<ASSIGN
B$JIT.PRIV.ACTIVE.FMSEC
       646**DCL      7119<<ASSIGN
B$JIT.PRIV.ACTIVE.MSYS
       649**DCL      8430<<ASSIGN   8434<<ASSIGN   8441<<ASSIGN
B$JIT.PRIV.JOB.MSYS
       692**DCL      8434>>ASSIGN   8441>>ASSIGN
B$JIT.TSLINE
       913**DCL       914--REDEF
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:183  
B$JIT$
       920**DCL       639--IMP-PTR  7023>>ASSIGN   7052>>IF       7055>>ASSIGN   7059>>ASSIGN   7118>>ASSIGN
      7118>>ASSIGN   7119>>ASSIGN   7120>>ASSIGN   7448>>ASSIGN   7759>>ASSIGN   8430>>ASSIGN   8434>>ASSIGN
      8434>>ASSIGN   8441>>ASSIGN   8441>>ASSIGN
B$TCB.ALT$
      4169**DCL      7097>>IF       8260>>IF
B$TCB$
      6213**DCL      4169--IMP-PTR  7097>>IF       8260>>IF
BADFID IN PROCEDURE RENAME_CMD
      7834**LABEL    7844--GOTO     7858--GOTO
BYTES
      6278**DCL      8131<<ASSIGN   8144<<ASSIGN   8144>>ASSIGN   8150<<ASSIGN   8150>>ASSIGN   8176<<ASSIGN
      8176>>ASSIGN   8210<>CALL     8247<<ASSIGN   8272<<ASSIGN   8272>>ASSIGN   8283<<ASSIGN   8283>>ASSIGN
      8291<>CALL
CB
      6242**DCL      8166<>CALL
CB.ADMIN
      6242**DCL      8171>>IF
CB.ARS
      6242**DCL      8164>>IF       8176>>ASSIGN   8177>>ASSIGN   8180<<ASSIGN   8180>>ASSIGN   8182>>ASSIGN
CB IN PROCEDURE GET_CLOSE
      8353**DCL      8387<>CALL
CB.ADMIN IN PROCEDURE GET_CLOSE
      8353**DCL      8391>>IF
CB IN PROCEDURE GET_OPEN
      8303**DCL      8333<>CALL
CB.ADMIN IN PROCEDURE GET_OPEN
      8303**DCL      8335>>IF
CHARN
      6275**DCL      6998<>CALL     7061--CALL     7776--CALL     8067>>IF       8071--CALL     8074--CALL
      8277--CALL     8836--CALL     8837--CALL
CHARNLEN
      6276**DCL      6275--IMP-SIZ  6998>>CALL     7052<<ASSIGN   7056<<CALLBLT  7058>>ASSIGN   7059>>ASSIGN
      7060<<CALLBLT  7061>>CALL     7775<<ASSIGN   7776>>CALL     8064<<ASSIGN   8065>>DOUNTIL  8066<<ASSIGN
      8066>>ASSIGN   8067>>IF       8067>>IF       8071>>CALL     8074>>CALL     8121<<ASSIGN   8146<<ASSIGN
      8148>>IF       8153>>IF       8155<<ASSIGN   8164>>IF       8164>>IF       8177<<ASSIGN   8180>>ASSIGN
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:184  
      8181>>ASSIGN   8182<<ASSIGN   8186>>IF       8187<<ASSIGN   8188>>ASSIGN   8191>>ASSIGN   8198>>ASSIGN
      8269<<ASSIGN   8273>>ASSIGN   8274<<ASSIGN   8274>>ASSIGN   8276>>IF       8277>>CALL     8283>>ASSIGN
      8825<<ASSIGN   8828<<ASSIGN   8828>>ASSIGN   8829>>IF       8831>>DOUNTIL  8832>>IF       8833<<ASSIGN
      8833>>ASSIGN   8836>>CALL     8837>>CALL
CLOSE_FTPUSERS IN PROCEDURE USER_CMD
      7302**DCL      7415<>CALL
CLOSE_FTPUSERS.SN_ IN PROCEDURE USER_CMD
      7302**DCL      7302--REDEF
CLOSE_FTPUSERS.UTL_ IN PROCEDURE USER_CMD
      7303**DCL      7303--REDEF
CLOSE_FTPUSERS.V IN PROCEDURE USER_CMD
      7307**DCL      7302--DCLINIT
CLOSE_FTPUSERS.V.EXPIRE# IN PROCEDURE USER_CMD
      7317**DCL      7317--REDEF
CLOSE_FTPUSERS.V.TYPE# IN PROCEDURE USER_CMD
      7315**DCL      7315--REDEF
CLOSE_FTPUSERS.V.XTNSIZE# IN PROCEDURE USER_CMD
      7312**DCL      7312--REDEF    7314--REDEF
CLSDO IN PROCEDURE LIST_CMD
      7699**DCL      7769<>CALL
CLSDO.SN_ IN PROCEDURE LIST_CMD
      7699**DCL      7699--REDEF
CLSDO.UTL_ IN PROCEDURE LIST_CMD
      7700**DCL      7700--REDEF
CLSDO.V IN PROCEDURE LIST_CMD
      7704**DCL      7699--DCLINIT
CLSDO.V.EXPIRE# IN PROCEDURE LIST_CMD
      7714**DCL      7714--REDEF
CLSDO.V.TYPE# IN PROCEDURE LIST_CMD
      7712**DCL      7712--REDEF
CLSDO.V.XTNSIZE# IN PROCEDURE LIST_CMD
      7709**DCL      7709--REDEF    7711--REDEF
CMD IN PROCEDURE LIST_CMD
      7479**DCL      7475--DCLINIT
CMD.BUF IN PROCEDURE LIST_CMD
      7479**DCL      7758<<ASSIGN   7761<<ASSIGN   7764<<ASSIGN   7765>>IF       7765<<ASSIGN
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:185  
CMDT IN PROCEDURE LIST_CMD
      7460**DCL      7459--PROC     7758>>ASSIGN
CMD_BUFFER
      6230**DCL      6231--REDEF    6232--REDEF    7259--DCLINIT  7260--DCLINIT  7335<>CALL     7345<>CALL
      7372<>CALL     7378<<ASSIGN   7380<<ASSIGN   7381--ASSIGN   7383<<CALLBLT  7406<>CALL     7408<<ASSIGN
      7410>>IF       8333--CALL     8336--IF       8338--CALL     8387--CALL     8392--IF       8392--IF
      8394--CALL
CMD_FS
      6224**DCL      7379<>CALL     7382<>CALL     8423>>ASSIGN
CMD_FS.ADDRESS
      6228**DCL      8426>>ASSIGN   8451>>ASSIGN
CMD_LCN
      6218**DCL      7041<>CALL
CMD_LS
      6235**DCL      8420>>ASSIGN
CMD_LS.ADDRESS
      6239**DCL      8449>>ASSIGN
CODE
      6216**DCL      6995<<ASSIGN   7002>>IF       7002>>IF       7002>>IF       7009>>IF       7015>>DOCASE
      7338>>IF
CRLF IN PROCEDURE PUT_CMD
      8218**DCL      8273>>ASSIGN
CURSIZ IN PROCEDURE GET_CMD
      8086**DCL      8122<<ASSIGN   8186>>IF       8187>>ASSIGN   8188<<ASSIGN   8191<<ASSIGN   8191>>ASSIGN
DASH IN PROCEDURE HELP_CMD
      7944**DCL      8061--CALL
DATA_BUFFER
      6232**DCL      6629--DCLINIT  6630--DCLINIT  7054<<ASSIGN   7055<<ASSIGN   7056>>CALLBLT  7058<<ASSIGN
      7059<<ASSIGN   7060>>CALLBLT  7061--CALL     8273<<ASSIGN   8277--CALL
DATA_FS
      6774**DCL      7083<>CALL     8423<<ASSIGN   8432<>CALL     8453<<ASSIGN   8454<>CALL
DATA_FS.ADDRESS
      6778**DCL      8425>>IF       8426<<ASSIGN
DATA_LCN
      6219**DCL      7082<>CALL     7088<>CALL     8094<>CALL     8133<>CALL     8142<>CALL     8166<>CALL
      8167<>CALL     8201<>CALL     8208<>CALL     8229<>CALL     8249<>CALL     8277<>CALL     8279<>CALL
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:186  
      8286<>CALL     8431<<ASSIGN   8432<>CALL     8438>>IF       8438<>CALL     8452<<ASSIGN   8454<>CALL
DATA_LS
      6782**DCL      8420<<ASSIGN   8432<>CALL     8432<>CALL     8454<>CALL     8454<>CALL
DATA_LS.ADDRESS
      6786**DCL      8449<<ASSIGN   8450>>IF       8451<<ASSIGN   8457<>CALL
DATA_LS.PORT
      6786**DCL      8421<<ASSIGN   8421>>ASSIGN   8448<<ASSIGN   8457<>CALL
DELDO IN PROCEDURE LIST_CMD
      7632**DCL      7770<>CALL
DELDO.ACSVEH_ IN PROCEDURE LIST_CMD
      7634**DCL      7635--REDEF
DELDO.ALTKEYS_ IN PROCEDURE LIST_CMD
      7640**DCL      7641--REDEF    7641--REDEF
DELDO.HDR_ IN PROCEDURE LIST_CMD
      7639**DCL      7640--REDEF
DELDO.TAB_ IN PROCEDURE LIST_CMD
      7638**DCL      7639--REDEF
DELDO.UHL_ IN PROCEDURE LIST_CMD
      7632**DCL      7633--REDEF    7633--REDEF
DELDO.V IN PROCEDURE LIST_CMD
      7641**DCL      7632--DCLINIT
DELDO.V.FSN# IN PROCEDURE LIST_CMD
      7672**DCL      7672--REDEF    7672--REDEF
DELDO.WSN_ IN PROCEDURE LIST_CMD
      7638**DCL      7638--REDEF
DELETE_CMD
      7871**PROC     7064--CALL
DIR_CMD
      7424**PROC     7046--CALL
DO_M$HELP IN PROCEDURE HELP_CMD
      8043**LABEL    8017--GOTO
F$ANON IN PROCEDURE USER_CMD
      7164**DCL      7340--ASSIGN   7341--ASSIGN   7342--ASSIGN
F$DCB.ACCT#
      6173**DCL      7341>>ASSIGN
F$DCB.ACTPOS
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:187  
      6189**DCL      6189--REDEF
F$DCB.AMR#
      6176**DCL      7767>>IF
F$DCB.ARS#
      6163**DCL      6163--REDEF    7775>>ASSIGN   8269>>ASSIGN
F$DCB.ATTR
      6182**DCL      6183--REDEF
F$DCB.BORROW
      6197**DCL      6197--REDEF    6197--REDEF    6197--REDEF
F$DCB.DCBNAME.L
      6211**DCL      6211--IMP-SIZ
F$DCB.EOMCHAR#
      6167**DCL      6167--REDEF
F$DCB.FLDID
      6192**DCL      6192--REDEF
F$DCB.FORM$
      6186**DCL      6186--REDEF
F$DCB.FSECT
      6202**DCL      6202--REDEF
F$DCB.FSN#
      6179**DCL      6179--REDEF    6179--REDEF    6180--REDEF
F$DCB.HEADER$
      6185**DCL      6185--REDEF
F$DCB.IXTNSIZE#
      6183**DCL      6183--REDEF
F$DCB.LASTSTA$
      6172**DCL      6172--REDEF
F$DCB.LVL
      6198**DCL      6198--REDEF
F$DCB.NAME#.C
      6173**DCL      6173--REDEF    7342>>ASSIGN
F$DCB.NAME#.L
      6173**DCL      7340>>ASSIGN
F$DCB.NOEOF
      6195**DCL      6195--REDEF
F$DCB.NRECS#
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:188  
      6184**DCL      6184--REDEF
F$DCB.NRECX
      6203**DCL      6203--REDEF
F$DCB.OHDR
      6195**DCL      6195--REDEF
F$DCB.ORG#
      6178**DCL      6178--REDEF
F$DCB.PRECNO
      6201**DCL      6201--REDEF
F$DCB.RCSZ
      6207**DCL      6207--REDEF
F$DCB.RECL#
      6179**DCL      8120>>ASSIGN
F$DCB.RES#
      6174**DCL      6174--REDEF
F$DCB.SETX
      6186**DCL      6186--REDEF
F$DCB.TAB$
      6186**DCL      6186--REDEF
F$DCB.TDA
      6200**DCL      6201--REDEF
F$DCB.WSN#
      6174**DCL      6174--REDEF
F$FILE
      6377**DCL      7110--ASSIGN
F$FILE$
      6378**DCL      7110<<ASSIGN   8120>>ASSIGN   8269>>ASSIGN
F$FTPUSERS.ACTPOS IN PROCEDURE USER_CMD
      7207**DCL      7207--REDEF
F$FTPUSERS.ARS# IN PROCEDURE USER_CMD
      7166**DCL      7166--REDEF
F$FTPUSERS.ATTR# IN PROCEDURE USER_CMD
      7196**DCL      7196--REDEF    7198--REDEF
F$FTPUSERS.BORROW IN PROCEDURE USER_CMD
      7218**DCL      7218--REDEF    7218--REDEF    7218--REDEF
F$FTPUSERS.DCBNAME.L IN PROCEDURE USER_CMD
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:189  
      7237**DCL      7237--IMP-SIZ
F$FTPUSERS.EOMCHAR# IN PROCEDURE USER_CMD
      7173**DCL      7174--REDEF
F$FTPUSERS.FLDID IN PROCEDURE USER_CMD
      7210**DCL      7211--REDEF
F$FTPUSERS.FORM$ IN PROCEDURE USER_CMD
      7202**DCL      7202--REDEF
F$FTPUSERS.FSECT IN PROCEDURE USER_CMD
      7225**DCL      7225--REDEF
F$FTPUSERS.FSN# IN PROCEDURE USER_CMD
      7192**DCL      7192--REDEF    7192--REDEF    7193--REDEF
F$FTPUSERS.HEADER$ IN PROCEDURE USER_CMD
      7201**DCL      7202--REDEF
F$FTPUSERS.IXTNSIZE# IN PROCEDURE USER_CMD
      7198**DCL      7199--REDEF
F$FTPUSERS.LASTSTA$ IN PROCEDURE USER_CMD
      7182**DCL      7182--REDEF
F$FTPUSERS.LVL IN PROCEDURE USER_CMD
      7219**DCL      7219--REDEF
F$FTPUSERS.NAME#.C IN PROCEDURE USER_CMD
      7182**DCL      7183--REDEF
F$FTPUSERS.NOEOF IN PROCEDURE USER_CMD
      7214**DCL      7214--REDEF
F$FTPUSERS.NRECS# IN PROCEDURE USER_CMD
      7199**DCL      7199--REDEF
F$FTPUSERS.NRECX IN PROCEDURE USER_CMD
      7226**DCL      7226--REDEF
F$FTPUSERS.OHDR IN PROCEDURE USER_CMD
      7215**DCL      7215--REDEF
F$FTPUSERS.ORG# IN PROCEDURE USER_CMD
      7190**DCL      7191--REDEF
F$FTPUSERS.PRECNO IN PROCEDURE USER_CMD
      7223**DCL      7223--REDEF
F$FTPUSERS.RCSZ IN PROCEDURE USER_CMD
      7231**DCL      7231--REDEF
F$FTPUSERS.RES# IN PROCEDURE USER_CMD
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:190  
      7184**DCL      7184--REDEF
F$FTPUSERS.SETX IN PROCEDURE USER_CMD
      7203**DCL      7203--REDEF
F$FTPUSERS.TAB$ IN PROCEDURE USER_CMD
      7202**DCL      7202--REDEF
F$FTPUSERS.TDA IN PROCEDURE USER_CMD
      7222**DCL      7223--REDEF
F$FTPUSERS.WSN# IN PROCEDURE USER_CMD
      7184**DCL      7185--REDEF
FDS IN PROCEDURE PORT
      8647**DCL      8750<>CALL
FDS.BUFX IN PROCEDURE PORT
      8671**DCL      8752>>ASSIGN
FDS.BUF_ IN PROCEDURE PORT
      8664**DCL      8749<<ASSIGN
FILE_TYPE
      6767**DCL      7077<<ASSIGN   7078>>CALL     8139>>IF       8270>>IF
FMT_OUT IN PROCEDURE OPEN_DATA_PORT
      8411**DCL      8459--CALL     8749--ASSIGN
FMT_OUTB IN PROCEDURE OPEN_DATA_PORT
      8413**DCL      8459--CALL
FMT_OUTL IN PROCEDURE OPEN_DATA_PORT
      8412**DCL      8413--IMP-SIZ  8458<<ASSIGN   8458>>ASSIGN   8459>>CALL     8752<<ASSIGN
FPT_CLOSE
      6705**DCL      7011<>CALL     7117<>CALL     7865<>CALL     8211<>CALL     8242<>CALL     8292<>CALL
FPT_CLOSE.SN_
      6705**DCL      6705--REDEF
FPT_CLOSE.UTL_
      6706**DCL      6706--REDEF
FPT_CLOSE.V
      6710**DCL      6705--DCLINIT
FPT_CLOSE.V.EXPIRE#
      6720**DCL      6720--REDEF
FPT_CLOSE.V.TYPE#
      6718**DCL      6718--REDEF
FPT_CLOSE.V.XTNSIZE#
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:191  
      6715**DCL      6715--REDEF    6717--REDEF
FPT_ERRMSG IN PROCEDURE REPORT_LIB
      8806**DCL      8824<>CALL
FPT_ERRMSG.V IN PROCEDURE REPORT_LIB
      8810**DCL      8806--DCLINIT
FPT_ERRMSG.V.SOURCE# IN PROCEDURE REPORT_LIB
      8817**DCL      8822<<ASSIGN   8835>>IF       8838<<ASSIGN
FPT_FID
      6597**DCL      7442<>CALL     7838<>CALL     7874<>CALL     8091<>CALL     8225<>CALL
FPT_FID.TEXTFID_
      6597**DCL      7441<<ASSIGN   7759<<ASSIGN   7762<<ASSIGN   7837<<ASSIGN   7861<>CALL     7873<<ASSIGN
      7884<>CALL     8090<<ASSIGN   8118<>CALL     8224<<ASSIGN   8238<>CALL
FPT_FID.V
      6601**DCL      6597--DCLINIT
FPT_HELP IN PROCEDURE HELP_CMD
      7902**DCL      8047<>CALL
FPT_HELP.V IN PROCEDURE HELP_CMD
      7906**DCL      7902--DCLINIT
FPT_HELP.V.ALL# IN PROCEDURE HELP_CMD
      7908**DCL      8007<<ASSIGN   8014<<ASSIGN
FPT_HELP.V.LIST# IN PROCEDURE HELP_CMD
      7908**DCL      8008<<ASSIGN   8015<<ASSIGN   8025<<ASSIGN   8033<<ASSIGN
FPT_HELP.V.MORE# IN PROCEDURE HELP_CMD
      7909**DCL      8009<<ASSIGN   8016<<ASSIGN
FPT_HELP.V.RANGE# IN PROCEDURE HELP_CMD
      7909**DCL      8010<<ASSIGN
FPT_LDEV
      6360**DCL      7031<>CALL     7375<>CALL
FPT_LDEV.V
      6362**DCL      6360--DCLINIT
FPT_LINK IN PROCEDURE LIST_CMD
      7474**DCL      7772<>CALL
FPT_LINK.V IN PROCEDURE LIST_CMD
      7476**DCL      7476--DCLINIT
FPT_NSAVE
      6747**DCL      8127<>CALL
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:192  
FPT_NSAVE.SN_
      6747**DCL      6747--REDEF
FPT_NSAVE.UTL_
      6748**DCL      6748--REDEF
FPT_NSAVE.V
      6752**DCL      6747--DCLINIT
FPT_NSAVE.V.EXPIRE#
      6762**DCL      6762--REDEF
FPT_NSAVE.V.TYPE#
      6760**DCL      6760--REDEF
FPT_NSAVE.V.XTNSIZE#
      6757**DCL      6757--REDEF    6759--REDEF
FPT_OPEN
      6456**DCL      7114<>CALL     7847<>CALL     7882<>CALL     8116<>CALL     8236<>CALL
FPT_OPEN.ACSVEH_
      6458**DCL      6459--REDEF
FPT_OPEN.ALTKEYS_
      6464**DCL      6465--REDEF    6465--REDEF
FPT_OPEN.HDR_
      6463**DCL      6464--REDEF
FPT_OPEN.TAB_
      6462**DCL      6463--REDEF
FPT_OPEN.UHL_
      6456**DCL      6457--REDEF    6457--REDEF
FPT_OPEN.V
      6465**DCL      6456--DCLINIT
FPT_OPEN.V.ASN#
      6475**DCL      6600--DCLINIT  7785<<ASSIGN   7844>>IF
FPT_OPEN.V.DELETE#
      6467**DCL      7876<<ASSIGN   7880<<ASSIGN   7883<<ASSIGN
FPT_OPEN.V.EXIST#
      6469**DCL      8102<<ASSIGN   8107<<ASSIGN   8112<<ASSIGN
FPT_OPEN.V.FSN#
      6496**DCL      6496--REDEF    6496--REDEF
FPT_OPEN.V.FUN#
      6475**DCL      7845<<ASSIGN   7881<<ASSIGN   8101<<ASSIGN   8106<<ASSIGN   8111<<ASSIGN   8235<<ASSIGN
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:193  
FPT_OPEN.V.INITZ.REASSIGN#
      6466**DCL      7115<<ASSIGN
FPT_OPEN.V.RES#
      6480**DCL      6600--DCLINIT
FPT_OPEN.WSN_
      6462**DCL      6462--REDEF
FPT_READ
      6627**DCL      8254<>CALL
FPT_READ.STATION_
      6630**DCL      6631--REDEF
FPT_READ.V
      6631**DCL      6627--DCLINIT
FPT_READ.V.DVBYTE.CONT#
      6644**DCL      8257<<ASSIGN   8262<<ASSIGN   8270>>IF
FPT_READ.V.DVBYTE.REREAD#
      6642**DCL      6642--REDEF
FPT_READ.V.INDX#
      6640**DCL      6640--REDEF
FPT_SETFMA IN PROCEDURE DIR_CMD
      7437**DCL      7452<>CALL
FPT_TIME
      6291**DCL      8135<>CALL     8206<>CALL     8250<>CALL     8287<>CALL
FPT_TIME.V
      6295**DCL      6291--DCLINIT
FPT_WRITE
      6666**DCL      7116<>CALL     8199<>CALL
FPT_WRITE.BUF_.BOUND
      6666**DCL      8198<<ASSIGN
FPT_WRITE.BUF_.BUF$
      6668**DCL      8141<<ASSIGN   8156<<ASSIGN   8165<<ASSIGN   8181<<ASSIGN   8181>>ASSIGN
FPT_WRITE.STATION_
      6668**DCL      6668--REDEF
FPT_WRITE.V
      6669**DCL      6666--DCLINIT
FPT_WRITE.V.DVBYTE.CONT#
      6677**DCL      8147<<ASSIGN   8151<<ASSIGN   8185<<ASSIGN   8189<<ASSIGN
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:194  
FPT_WRITE.V.DVBYTE.VFC#
      6675**DCL      6675--REDEF
FPT_YC
      6344**DCL      7094<>CALL
FPT_YC.CMD_
      6344**DCL      7093<<ASSIGN
FPT_YC.V
      6345**DCL      6344--DCLINIT
FTPUSERS_OK IN PROCEDURE USER_CMD
      7415**LABEL    7409--CALLALT  7412--GOTO
FTP_NODES
      6221**DCL      5332--DCLINIT
GET_CLOSE
      8349**PROC     7041--CALL     8208--CALL     8286--CALL
GET_CMD
      8079**PROC     7070--CALL
GET_COMMAND
      5308**DCL-ENT  5554--DCLINIT
GET_LINE IN PROCEDURE GET_CMD
      8083**DCL-ENT  8142--CALL
GET_OPEN
      8298**PROC     8133--CALL     8249--CALL
GLOBAL_ERR
      6266**DCL      6981<<ASSIGN   8093<<ASSIGN   8126<<ASSIGN   8228<<ASSIGN   8241<<ASSIGN   8436<<ASSIGN
HELP_CMD
      7889**PROC     7024--CALL
I IN PROCEDURE HELP_CMD
      8000**DCL      8021<<DOINDEX  8022>>ASSIGN
I IN PROCEDURE PARSE_PORT
      8767**DCL      8772<<ASSIGN   8777<<ASSIGN   8777>>ASSIGN   8779>>IF       8780>>IF
I IN PROCEDURE USER_CMD
      7322**DCL      7399<<DOINDEX  7400>>ASSIGN   7400>>ASSIGN
IPFMT IN PROCEDURE PORT
      8747**DCL      8750--CALL
J IN PROCEDURE PARSE_PORT
      8768**DCL      8771<<ASSIGN   8775<<ASSIGN   8775>>ASSIGN   8776>>IF       8776>>IF       8785>>ASSIGN
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:195  
K IN PROCEDURE PARSE_PORT
      8769**DCL      8773<<ASSIGN   8778>>ASSIGN   8783<<ASSIGN   8785<<ASSIGN   8785>>ASSIGN
KEY1 IN PROCEDURE HELP_CMD
      7912**DCL      7902--DCLINIT  8019<<ASSIGN   8042<<ASSIGN
KEY2 IN PROCEDURE HELP_CMD
      7913**DCL      7903--DCLINIT  8020<<ASSIGN   8043<<ASSIGN
LCN IN PROCEDURE GET_CLOSE
      8350**DCL      8349--PROC     8380<>CALL     8382<>CALL     8387<>CALL     8396<>CALL
LCN IN PROCEDURE GET_OPEN
      8299**DCL      8298--PROC     8333<>CALL     8340<>CALL
LFID$ IN PROCEDURE GET_CMD
      8081**DCL      8079--PROC     8090>>ASSIGN   8090>>ASSIGN
LFID$ IN PROCEDURE PUT_CMD
      8217**DCL      8216--PROC     8224>>ASSIGN   8224>>ASSIGN
LINE_BUF
      6231**DCL      7737--DCLINIT  7738--DCLINIT  7776--CALL     7903--DCLINIT  8057<<ASSIGN   8062--ASSIGN
      8141--ASSIGN   8142--CALL     8148--IF       8165--ASSIGN   8166--CALL     8807--DCLINIT  8826>>DOWHILE
      8827<<ASSIGN   8827>>ASSIGN   8832>>IF       8836--CALL     8837--CALL
LIST_CMD
      7459**PROC     7017--CALL     7020--CALL
LOGGED_IN
      6217**DCL      7002>>IF       7023>>IF       7034<<ASSIGN   7039>>IF       7324>>IF       7328>>IF
      7329<<ASSIGN   7388<<ASSIGN
M$CLOSE
        18**DCL-ENT  7011--CALL     7117--CALL     7415--CALL     7769--CALL     7860--CALL     7865--CALL
      8127--CALL     8211--CALL     8242--CALL     8292--CALL
M$DO IN PROCEDURE LIST_CMD
      7547**DCL      7767--IF       7775--ASSIGN
M$ERRMSG
        81**DCL-ENT  8824--CALL
M$FID
        81**DCL-ENT  7442--CALL     7838--CALL     7874--CALL     8091--CALL     8225--CALL
M$HELP
        81**DCL-ENT  8047--CALL
M$LDEV
        18**DCL-ENT  7031--CALL     7375--CALL
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:196  
M$LINK
        30**DCL-ENT  7772--CALL
M$OPEN
        18**DCL-ENT  7114--CALL     7770--CALL     7847--CALL     7882--CALL     8116--CALL     8236--CALL
M$READ
        19**DCL-ENT  7409--CALL     7774--CALL     8254--CALL
M$REW
        21**DCL-ENT  7773--CALL
M$SETFMA
        18**DCL-ENT  7452--CALL
M$TIME
        85**DCL-ENT  8135--CALL     8206--CALL     8250--CALL     8287--CALL
M$WRITE
        19**DCL-ENT  7033--CALL     7116--CALL     7377--CALL     7386--CALL     8199--CALL
M$XXX
        30**DCL-ENT  7112--CALL     8114--CALL     8388--CALL
M$YC
        32**DCL-ENT  7094--CALL     7768--CALL
MSG0 IN PROCEDURE HELP_CMD
      7943**DCL      8061<>CALL
MSGI IN PROCEDURE HELP_CMD
      7945**DCL      8071<>CALL
MSGN IN PROCEDURE HELP_CMD
      7947**DCL      8074<>CALL
MSG_150
      6797**DCL      8118<>CALL     8238<>CALL
MSG_200PORT
      6807**DCL      7085<>CALL
MSG_200SET
      6812**DCL      7095<>CALL
MSG_200TYPE
      6802**DCL      7078<>CALL
MSG_202
      6822**DCL      7027<>CALL
MSG_214
      6828**DCL      8003<>CALL
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:197  
MSG_221
      6862**DCL      7040<>CALL
MSG_226
      6867**DCL      8209<>CALL     8289<>CALL
MSG_227
      6872**DCL      8459<>CALL
MSG_230
      6877**DCL      7389<>CALL
MSG_230USER
      6817**DCL      7035<>CALL
MSG_250DEL
      6882**DCL      7884<>CALL
MSG_250RNTO
      6887**DCL      7861<>CALL
MSG_257
      6892**DCL      7061<>CALL
MSG_331
      6897**DCL      7418<>CALL
MSG_331GUEST
      6902**DCL      7347<>CALL
MSG_350RNFR
      6907**DCL      7851<>CALL
MSG_425E
      6917**DCL      8837<>CALL
MSG_426
      6922**DCL      8168<>CALL     8280<>CALL
MSG_500
      6927**DCL      6978--DCLINIT
MSG_500$
      6978**DCL      6998>>CALL
MSG_501
      6932**DCL      6978--DCLINIT  7098<>CALL     7396<>CALL     7779<>CALL     7840<>CALL
MSG_502
      6937**DCL      6979--DCLINIT  7102<>CALL
MSG_503
      6942**DCL      6979--DCLINIT  7012<>CALL     7365<>CALL     7855<>CALL
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:198  
MSG_504
      6947**DCL      6979--DCLINIT
MSG_530
      6952**DCL      7004<>CALL
MSG_530LOGOUT
      6963**DCL      7325<>CALL
MSG_530USER
      6957**DCL      7346<>CALL     7419<>CALL
MSG_550
      6968**DCL      7776<>CALL     8836<>CALL
MSG_550H
      6973**DCL      8052<>CALL
NET$ADDR2IP
      5312**DCL-ENT  7379--CALL
NET$ADDR2NAME
      5313**DCL-ENT  7382--CALL
NORNFR_PENDING IN PROCEDURE RENAME_CMD
      7861**LABEL    7841--GOTO     7849--GOTO
OK IN PROCEDURE GET_CMD
      8084**DCL      8137<<ASSIGN   8138>>DOWHILE  8160<<ASSIGN   8173<<ASSIGN   8196>>IF
OK IN PROCEDURE PUT_CMD
      8220**DCL      8252<<ASSIGN   8253>>DOWHILE  8256<<ASSIGN   8264<<ASSIGN   8266>>IF
ONOVER IN PROCEDURE GET_CMD
      8080**DCL      8079--PROC     8099>>IF       8104>>IF       8109>>IF
OPEN_DATA_PORT
      8404**PROC     8124--CALL     8239--CALL
OPEN_PASV_PORT IN PROCEDURE OPEN_DATA_PORT
      8445**ENTRY    7090--CALL
OUT$BLK.CODE
      6087**DCL      6995>>ASSIGN   6997>>IF       6998>>CALL     7009>>IF       7070<>CALL
OUT$BLK.NSUBLKS
      6091**DCL      6997>>IF       7331>>IF       7339>>IF       7356>>IF       7440>>IF       7760>>IF
      8002>>IF       8011>>IF       8021>>DOINDEX
OUT$BLK.SUBLK$
      6112**DCL      6994>>ASSIGN   6997>>IF       6998>>CALL     7009>>IF       7070>>CALL     7070>>CALL
      7074>>CALL     7077>>ASSIGN   7083>>CALL     7083>>CALL     7093>>ASSIGN   7093>>ASSIGN   7331>>IF
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:199  
      7355>>ASSIGN   7355>>ASSIGN   7357>>ASSIGN   7357>>ASSIGN   7358>>ASSIGN   7371>>IF       7392>>IF
      7392>>IF       7394>>ASSIGN   7394>>ASSIGN   7395>>IF       7400>>ASSIGN   7400>>ASSIGN   7441>>ASSIGN
      7441>>ASSIGN   7761>>ASSIGN   7761>>ASSIGN   7762>>ASSIGN   7762>>ASSIGN   7837>>ASSIGN   7837>>ASSIGN
      7846>>IF       7873>>ASSIGN   7873>>ASSIGN   8011>>IF       8011>>IF       8011>>IF       8011>>IF
      8011>>IF       8014>>IF       8022>>ASSIGN
OUT$SYM.CODE
      6131**DCL      7077>>ASSIGN   7331>>IF       7392>>IF       7846>>IF       8011>>IF       8028>>IF
OUT$SYM.COUNT
      6148**DCL      6151--IMP-SIZ  7083>>CALL     7093>>ASSIGN   7355>>ASSIGN   7357>>ASSIGN   7358>>ASSIGN
      7371>>IF       7392>>IF       7394>>ASSIGN   7395>>IF       7400>>ASSIGN   7441>>ASSIGN   7761>>ASSIGN
      7762>>ASSIGN   7837>>ASSIGN   7873>>ASSIGN   8011>>IF       8011>>IF       8014>>IF       8029>>ASSIGN
      8032>>IF       8034--ASSIGN   8034--ASSIGN   8036>>ASSIGN   8038>>ASSIGN   8042--ASSIGN   8042--ASSIGN
      8043--ASSIGN   8043--ASSIGN
OUT$SYM.TEXT
      6151**DCL      7083<>CALL     7093--ASSIGN   7355>>ASSIGN   7357>>ASSIGN   7394>>ASSIGN   7400>>ASSIGN
      7441--ASSIGN   7761>>ASSIGN   7762--ASSIGN   7837--ASSIGN   7873--ASSIGN   8011>>IF       8011>>IF
      8029>>ASSIGN   8032>>IF       8036>>ASSIGN   8038>>ASSIGN
OUT$SYM.TEXTC$
      6143**DCL      7070<>CALL     7074<>CALL
P IN PROCEDURE HELP_CMD
      7948**DCL      7952--REDEF
P.ACCT IN PROCEDURE HELP_CMD
      7950**DCL      7904--DCLINIT  8036<<ASSIGN
P.NAME IN PROCEDURE HELP_CMD
      7948**DCL      7903--DCLINIT  8034<<ASSIGN
P.PASS IN PROCEDURE HELP_CMD
      7951**DCL      7904--DCLINIT  8038<<ASSIGN
P.PSN IN PROCEDURE HELP_CMD
      7949**DCL      7905--DCLINIT  8029<<ASSIGN
PARSE$
      6214**DCL      6079--IMP-PTR  6994<<ASSIGN   6995>>ASSIGN   6997>>IF       6997>>IF       6998>>CALL
      7009>>IF       7070>>CALL     7070>>CALL     7074>>CALL     7077>>ASSIGN   7083>>CALL     7083>>CALL
      7093>>ASSIGN   7093>>ASSIGN   7331>>IF       7331>>IF       7339>>IF       7355>>ASSIGN   7355>>ASSIGN
      7356>>IF       7357>>ASSIGN   7357>>ASSIGN   7358>>ASSIGN   7371>>IF       7392>>IF       7392>>IF
      7394>>ASSIGN   7394>>ASSIGN   7395>>IF       7400>>ASSIGN   7400>>ASSIGN   7440>>IF       7441>>ASSIGN
      7441>>ASSIGN   7760>>IF       7761>>ASSIGN   7761>>ASSIGN   7762>>ASSIGN   7762>>ASSIGN   7837>>ASSIGN
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:200  
      7837>>ASSIGN   7846>>IF       7873>>ASSIGN   7873>>ASSIGN   8002>>IF       8011>>IF       8011>>IF
      8011>>IF       8011>>IF       8011>>IF       8011>>IF       8014>>IF       8021>>DOINDEX  8022>>ASSIGN
PARSE_PORT
      8757**PROC     7083--CALL
PASV
      6770**DCL      7082>>IF       7084<<ASSIGN   7088>>IF       7089<<ASSIGN   8094>>IF       8095<<ASSIGN
      8229>>IF       8230<<ASSIGN   8329<<ASSIGN   8416>>IF       8422>>IF       8460<<ASSIGN
PCH IN PROCEDURE HELP_CMD
      7952**DCL      8027<<ASSIGN
PMD_CMD
      6680**DCL      6667--DCLINIT  6668--DCLINIT
PORT IN PROCEDURE OPEN_DATA_PORT
      8464**PROC     8457--CALL
PORT IN PROCEDURE PORT
      8468**DCL      8464--PROC     8750--CALL
PORTALT IN PROCEDURE PUT_CMD
      8231**LABEL    8249--CALLALT  8281--GOTO
PROCERR IN PROCEDURE GET_CMD
      8116**LABEL    8133--CALLALT  8169--GOTO     8202--GOTO
PUT_CMD
      8216**PROC     7074--CALL
PUT_STARL IN PROCEDURE PUT_CMD
      8234**ENTRY    7786--CALL
PWD_CMD
      7043**LABEL    7047--GOTO
READDO IN PROCEDURE LIST_CMD
      7735**DCL      7773<>CALL     7774<>CALL
READDO.STATION_ IN PROCEDURE LIST_CMD
      7738**DCL      7739--REDEF
READDO.V IN PROCEDURE LIST_CMD
      7739**DCL      7735--DCLINIT
READDO.V.DVBYTE.REREAD# IN PROCEDURE LIST_CMD
      7750**DCL      7750--REDEF
READDO.V.INDX# IN PROCEDURE LIST_CMD
      7748**DCL      7748--REDEF
READ_FTPUSERS IN PROCEDURE USER_CMD
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:201  
      7257**DCL      7409<>CALL
READ_FTPUSERS.STATION_ IN PROCEDURE USER_CMD
      7260**DCL      7261--REDEF
READ_FTPUSERS.V IN PROCEDURE USER_CMD
      7261**DCL      7257--DCLINIT
READ_FTPUSERS.V.DVBYTE.REREAD# IN PROCEDURE USER_CMD
      7272**DCL      7272--REDEF
READ_FTPUSERS.V.INDX# IN PROCEDURE USER_CMD
      7270**DCL      7270--REDEF
REMOTE_ADMIN IN PROCEDURE GET_CLOSE
      8378**DCL-ENT  8394--CALL
REMOTE_ADMIN IN PROCEDURE GET_OPEN
      8327**DCL-ENT  8338--CALL
RENAME IN PROCEDURE RENAME_CMD
      7817**DCL      7860<>CALL
RENAME.SN_ IN PROCEDURE RENAME_CMD
      7817**DCL      7817--REDEF
RENAME.UTL_ IN PROCEDURE RENAME_CMD
      7818**DCL      7818--REDEF
RENAME.V IN PROCEDURE RENAME_CMD
      7822**DCL      7817--DCLINIT
RENAME.V.EXPIRE# IN PROCEDURE RENAME_CMD
      7832**DCL      7832--REDEF
RENAME.V.TYPE# IN PROCEDURE RENAME_CMD
      7830**DCL      7830--REDEF
RENAME.V.XTNSIZE# IN PROCEDURE RENAME_CMD
      7827**DCL      7827--REDEF    7829--REDEF
RENAME_CMD
      7791**PROC     7067--CALL
REPALT IN PROCEDURE DELETE_CMD
      7874**LABEL    7882--CALLALT
REPALT IN PROCEDURE PUT_CMD
      8219**LABEL    8236--CALLALT
REPALT IN PROCEDURE RENAME_CMD
      7848**LABEL    7860--CALLALT
REPORT_ALT IN PROCEDURE REPORT_LIB
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:202  
      8823**ENTRY    7097--CALL     7443--CALL     7453--CALL     7848--CALL     7877--CALL     8048--CALL
      8092--CALL     8200--CALL     8227--CALL
REPORT_LIB
      8790**PROC     6984--CALL     8339--CALL     8437--CALL
REPORT_TIME
      5310**DCL-ENT  8210--CALL     8291--CALL
RETALT IN PROCEDURE GET_CMD
      8092**LABEL    8116--CALLALT
RETALT IN PROCEDURE GET_OPEN
      8339**LABEL    8333--CALLALT
RETALT IN PROCEDURE LIST_CMD
      7781**LABEL    7786--CALLALT
RETALT IN PROCEDURE OPEN_DATA_PORT
      8434**LABEL    8454--CALLALT
RNFR_PENDING
      6771**DCL      7008>>IF       7852<<ASSIGN   7855>>IF       7866<<ASSIGN
RUNNING
      6220**DCL      6985<<ASSIGN   6990<<ASSIGN   7042<<ASSIGN
SALUTATION.L
      6374**DCL      6375--IMP-SIZ  7032>>ASSIGN   7376>>ASSIGN
SALUTATION.T
      6375**DCL      7032--ASSIGN   7376--ASSIGN
SEND_MSG
      5311**DCL-ENT  6998--CALL     7004--CALL     7012--CALL     7027--CALL     7035--CALL     7040--CALL
      7061--CALL     7078--CALL     7085--CALL     7095--CALL     7098--CALL     7102--CALL     7325--CALL
      7346--CALL     7347--CALL     7365--CALL     7389--CALL     7396--CALL     7418--CALL     7419--CALL
      7776--CALL     7779--CALL     7840--CALL     7851--CALL     7855--CALL     7861--CALL     7884--CALL
      8003--CALL     8052--CALL     8061--CALL     8071--CALL     8074--CALL     8118--CALL     8168--CALL
      8209--CALL     8238--CALL     8280--CALL     8289--CALL     8459--CALL     8836--CALL     8837--CALL
SETDO IN PROCEDURE LIST_CMD
      7561**DCL      7768<>CALL
SETDO.V IN PROCEDURE LIST_CMD
      7562**DCL      7561--DCLINIT
SETDOCMD IN PROCEDURE LIST_CMD
      7565**DCL      7561--DCLINIT
SET_USER_ID
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:203  
      5309**DCL-ENT  7335--CALL     7345--CALL     7372--CALL     7406--CALL
SOCKET IN PROCEDURE PARSE_PORT
      8760**DCL      8757--PROC
SOCKET.ADDRESS IN PROCEDURE PARSE_PORT
      8764**DCL      8781<<ASSIGN   8781>>ASSIGN
SOCKET.PORT IN PROCEDURE PARSE_PORT
      8764**DCL      8778<<ASSIGN   8778>>ASSIGN   8781>>ASSIGN
START_TIME
      6277**DCL      8136<<ASSIGN   8207<<ASSIGN   8207>>ASSIGN   8210<>CALL     8251<<ASSIGN   8288<<ASSIGN
      8288>>ASSIGN   8291<>CALL
SUB$BLK.CODE IN PROCEDURE HELP_CMD
      7968**DCL      8023>>IF       8041>>IF
SUB$BLK.NSUBLKS IN PROCEDURE HELP_CMD
      7972**DCL      8024>>IF       8035>>IF       8037>>IF
SUB$BLK.SUBLK$ IN PROCEDURE HELP_CMD
      7993**DCL      8028>>IF       8029>>ASSIGN   8029>>ASSIGN   8030>>ASSIGN   8032>>IF       8032>>IF
      8034>>ASSIGN   8034>>ASSIGN   8036>>ASSIGN   8036>>ASSIGN   8038>>ASSIGN   8038>>ASSIGN
SUBLK$ IN PROCEDURE HELP_CMD
      7953**DCL      7960--IMP-PTR  8022<<ASSIGN   8023>>IF       8024>>IF       8028>>IF       8029>>ASSIGN
      8029>>ASSIGN   8030<<ASSIGN   8030>>ASSIGN   8032>>IF       8032>>IF       8034>>ASSIGN   8034>>ASSIGN
      8035>>IF       8036>>ASSIGN   8036>>ASSIGN   8037>>IF       8038>>ASSIGN   8038>>ASSIGN   8041>>IF
      8042>>ASSIGN   8042>>ASSIGN   8043>>ASSIGN   8043>>ASSIGN   8062<<ASSIGN   8067>>IF       8071>>CALL
      8072<<ASSIGN   8072>>ASSIGN   8074>>CALL
TCP$ADMIN.GHST_LCN
      6246**DCL      6246--REDEF
TCP$ADMIN.USER_LCN
      6245**DCL      6246--REDEF
TCP$ADMIN.CMD IN PROCEDURE GET_CLOSE
      8356**DCL      8392>>IF       8392>>IF
TCP$ADMIN.GHST_LCN IN PROCEDURE GET_CLOSE
      8357**DCL      8357--REDEF
TCP$ADMIN.USER_LCN IN PROCEDURE GET_CLOSE
      8356**DCL      8357--REDEF
TCP$ADMIN.CMD IN PROCEDURE GET_OPEN
      8306**DCL      8336>>IF
TCP$ADMIN.GHST_LCN IN PROCEDURE GET_OPEN
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:204  
      8307**DCL      8307--REDEF
TCP$ADMIN.USER_LCN IN PROCEDURE GET_OPEN
      8306**DCL      8307--REDEF
TCP$CLOSE IN PROCEDURE GET_CLOSE
      8376**DCL-ENT  8380--CALL
TCP$OPEN IN PROCEDURE OPEN_DATA_PORT
      8414**DCL-ENT  8432--CALL     8454--CALL
TCP$READ IN PROCEDURE GET_CLOSE
      8377**DCL-ENT  8387--CALL
TCP$READ IN PROCEDURE GET_CMD
      8082**DCL-ENT  8166--CALL
TCP$READ IN PROCEDURE GET_OPEN
      8326**DCL-ENT  8333--CALL
TCP$RELEASE
      5314**DCL-ENT  7082--CALL     7088--CALL     8094--CALL     8167--CALL     8201--CALL     8229--CALL
      8279--CALL     8340--CALL     8382--CALL     8396--CALL     8438--CALL
TCP$WRITE IN PROCEDURE PUT_CMD
      8219**DCL-ENT  8277--CALL
TCP_MON_ERR
      4149**DCL      6982<<ASSIGN   6984>>IF       8806--DCLINIT
TEXT IN PROCEDURE PARSE_PORT
      8766**DCL      8757--PROC     8776>>IF       8776>>IF       8785>>ASSIGN
TEXTC.COUNT
      6272**DCL      6273--IMP-SIZ  7380>>ASSIGN   7383>>CALLBLT  8090>>ASSIGN   8224>>ASSIGN
TEXTC.TEXT
      6273**DCL      7380>>ASSIGN   7383>>CALLBLT  8090--ASSIGN   8224--ASSIGN
TEXTC IN PROCEDURE HELP_CMD
      7999**DCL      8034>>ASSIGN   8042>>ASSIGN   8043>>ASSIGN
TEXTC.L IN PROCEDURE HELP_CMD
      7999**DCL      7999--IMP-SIZ  8034>>ASSIGN   8042>>ASSIGN   8043>>ASSIGN
TFID
      6267**DCL      7379<>CALL     7380--ASSIGN   7380--ASSIGN   7382<>CALL     7383--CALLBLT  7383--CALLBLT
TFID.COUNT
      6268**DCL      7384>>ASSIGN
TIMEOUT IN PROCEDURE GET_CLOSE
      8351**DCL      8349--PROC
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:205  
TIMEOUT IN PROCEDURE GET_OPEN
      8300**DCL      8298--PROC
TSTAMP
      6279**DCL      6295--DCLINIT  8136>>ASSIGN   8207>>ASSIGN   8251>>ASSIGN   8288>>ASSIGN
TYPE_NAME
      6768**DCL      7078--CALL
USER_CMD
      7122**PROC     7030--CALL     7039--CALL
VLP_ACCT
      6511**DCL      6461--DCLINIT  6598--DCLINIT  7437--DCLINIT
VLP_ACCT.ACCT#
      6511**DCL      7448<<ASSIGN   7857>>IF
VLP_NAME
      6538**DCL      6457--DCLINIT  6598--DCLINIT  7784<<ASSIGN   7819--DCLINIT
VLP_PASS
      6551**DCL      6458--DCLINIT  6599--DCLINIT  7819--DCLINIT
VLP_PCL IN PROCEDURE LIST_CMD
      7505**DCL      7474--DCLINIT
VLP_SN
      6564**DCL      6456--DCLINIT  6599--DCLINIT
VLP_SN.SN#
      6564**DCL      7437--DCLINIT  7449<<ASSIGN   7857>>IF
VLP_STARL IN PROCEDURE LIST_CMD
      7545**DCL      7784>>ASSIGN
VLP_SYS IN PROCEDURE LIST_CMD
      7518**DCL      7474--DCLINIT
VLP_WSN
      6577**DCL      6462--DCLINIT  6599--DCLINIT
VLP_WSN.WSN#
      6577**DCL      7857>>IF
VLR_HELP IN PROCEDURE HELP_CMD
      7926**DCL      7905--DCLINIT
VLR_HELP.MSGCOMP IN PROCEDURE HELP_CMD
      7931**DCL      8051>>IF
VLR_HELP.NOMSG IN PROCEDURE HELP_CMD
      7930**DCL      8015>>IF
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:206  
VLR_HELP.RECCNT IN PROCEDURE HELP_CMD
      7934**DCL      8056>>IF       8058<<ASSIGN   8061>>IF       8069<<ASSIGN   8069>>ASSIGN   8070>>IF
WRITE_LO
      6317**DCL      7033<>CALL     7377<>CALL     7386<>CALL
WRITE_LO.BUF_
      6317**DCL      7032<<ASSIGN   7376<<ASSIGN   7381<<ASSIGN
WRITE_LO.BUF_.BOUND
      6317**DCL      7384<<ASSIGN
WRITE_LO.STATION_
      6319**DCL      6319--REDEF
WRITE_LO.V.DVBYTE.VFC#
      6326**DCL      6326--REDEF
X$WRITE IN PROCEDURE PORT
      8470**DCL-ENT  8750--CALL
XTX$ADAPT
      5676**DCL-ENT  5992--DCLINIT
XUG$ECHO
      4037**DCL-ENT  7387--CALL
XUG$GETCMD
      4034**DCL-ENT  6983--CALL
XUG$INIT
      4038**DCL-ENT  7111--CALL
XUG_GETCMD
      5331**DCL      6983<>CALL     7111<>CALL     7387<>CALL
XUG_GETCMD.OUT$
      5336**DCL      5342--REDEF    6989>>IF       6994>>ASSIGN
XUG_INIT
      5681**DCL      7111<>CALL
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:207  
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:208  
              MINI UREF LISTING

FTPCMD       8**PROC
FTPCMD_INIT    7109**ENTRY
M$ACCT      35**DCL-ENT
M$ACTIVATE      38**DCL-ENT
M$ALIB      31**DCL-ENT
M$ASUSER      33**DCL-ENT
M$ATTACH      40**DCL-ENT
M$BADPP      58**DCL-ENT
M$CGCTL      39**DCL-ENT
M$CGINFO      39**DCL-ENT
M$CHECK      20**DCL-ENT
M$CHGUNIT      78**DCL-ENT
M$CLRSTK      76**DCL-ENT
M$CMDVAR      87**DCL-ENT
M$CONFIG      48**DCL-ENT
M$CORRES      23**DCL-ENT
M$CPEXIT      32**DCL-ENT
M$CVM      56**DCL-ENT
M$CVOL      21**DCL-ENT
M$DCLFLD      48**DCL-ENT
M$DEACTIVATE      38**DCL-ENT
M$DELREC      20**DCL-ENT
M$DEQ      85**DCL-ENT
M$DETACH      40**DCL-ENT
M$DEVICE      22**DCL-ENT
M$DISPLAY      85**DCL-ENT
M$DISPRES      25**DCL-ENT
M$DLIB      31**DCL-ENT
M$DRIBBLE      48**DCL-ENT
M$DRTN      76**DCL-ENT
M$DSUSER      33**DCL-ENT
M$ENQ      84**DCL-ENT
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:209  
M$EOM      43**DCL-ENT
M$ERASE      49**DCL-ENT
M$ERR      30**DCL-ENT
M$EVENT      73**DCL-ENT
M$EXHUME      82**DCL-ENT
M$EXIT      30**DCL-ENT
M$EXTEND      22**DCL-ENT
M$FDP      54**DCL-ENT
M$FDS      53**DCL-ENT
M$FEBOOT      46**DCL-ENT
M$FECTL      47**DCL-ENT
M$FEDUMP      46**DCL-ENT
M$FINDPROC      35**DCL-ENT
M$FSUSER      33**DCL-ENT
M$FVP      55**DCL-ENT
M$FWCG      39**DCL-ENT
M$GBPL      59**DCL-ENT
M$GDDL      55**DCL-ENT
M$GDP      54**DCL-ENT
M$GDS      53**DCL-ENT
M$GETDCB      24**DCL-ENT
M$GETMOUSE      64**DCL-ENT
M$GETPM      65**DCL-ENT
M$GJOB      83**DCL-ENT
M$GLINEATTR      43**DCL-ENT
M$GOODPP      58**DCL-ENT
M$GPLATEN      51**DCL-ENT
M$GPROMPT      50**DCL-ENT
M$GTRMATTR      44**DCL-ENT
M$GTRMCTL      42**DCL-ENT
M$GTRMTAB      45**DCL-ENT
M$GVP      54**DCL-ENT
M$INT      73**DCL-ENT
M$INTRTN      34**DCL-ENT
M$IOQ      69**DCL-ENT
M$JOBSTATS      83**DCL-ENT
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:210  
M$KEYIN      23**DCL-ENT
M$LDTRC      31**DCL-ENT
M$LIMIT      24**DCL-ENT
M$LINES      23**DCL-ENT
M$LO    6265**DCL
M$MADMUCK      26**DCL-ENT
M$MAKUSER      57**DCL-ENT
M$MBS      25**DCL-ENT
M$MDFFLD      49**DCL-ENT
M$MERC      74**DCL-ENT
M$MERCS      75**DCL-ENT
M$MIRROR      69**DCL-ENT
M$MONINFO      86**DCL-ENT
M$MPL      59**DCL-ENT
M$NODEINFO      50**DCL-ENT
M$NXTUSR      84**DCL-ENT
M$OCMSG      82**DCL-ENT
M$OLAY      30**DCL-ENT
M$PAS      59**DCL-ENT
M$PATHCON      82**DCL-ENT
M$PDS      53**DCL-ENT
M$PFIL      20**DCL-ENT
M$PLATEN      44**DCL-ENT
M$PRECORD      22**DCL-ENT
M$PROCNAME      35**DCL-ENT
M$PROFILE      46**DCL-ENT
M$PROMPT      42**DCL-ENT
M$RACST      26**DCL-ENT
M$RDSYSLOG      67**DCL-ENT
M$RELDCB      24**DCL-ENT
M$RELRES      25**DCL-ENT
M$RELSTARF      27**DCL-ENT
M$REM      27**DCL-ENT
M$RENV      74**DCL-ENT
M$REQUIRE      26**DCL-ENT
M$RETRY      75**DCL-ENT
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:211  
M$RETRYS      75**DCL-ENT
M$RLSFLD      49**DCL-ENT
M$RPRIV      77**DCL-ENT
M$RSPP      56**DCL-ENT
M$RSWITCH      78**DCL-ENT
M$RUE      84**DCL-ENT
M$SAD      57**DCL-ENT
M$SAVE      33**DCL-ENT
M$SCON      34**DCL-ENT
M$SCREECH      32**DCL-ENT
M$SENV      74**DCL-ENT
M$SETFP      47**DCL-ENT
M$SINPUT      45**DCL-ENT
M$SLCFLD      50**DCL-ENT
M$SMOUSE      64**DCL-ENT
M$SMPRT      56**DCL-ENT
M$SPRIV      77**DCL-ENT
M$SSC      57**DCL-ENT
M$SSWITCH      77**DCL-ENT
M$STATE      86**DCL-ENT
M$STD      58**DCL-ENT
M$STIMER      72**DCL-ENT
M$STLPP      55**DCL-ENT
M$STRAP      72**DCL-ENT
M$STRMATTR      44**DCL-ENT
M$STRMCTL      42**DCL-ENT
M$STRMTAB      45**DCL-ENT
M$SYMBIO      83**DCL-ENT
M$SYSCON      69**DCL-ENT
M$SYSID      87**DCL-ENT
M$TDCLOSE      68**DCL-ENT
M$TDIO      68**DCL-ENT
M$TDOPEN      67**DCL-ENT
M$TDREQCPU      68**DCL-ENT
M$TEMPWROC      62**DCL-ENT
M$TRAP      72**DCL-ENT
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:212  
M$TRMISC      47**DCL-ENT
M$TRMPRG      43**DCL-ENT
M$TRTN      76**DCL-ENT
M$TRUNC      19**DCL-ENT
M$TTIMER      72**DCL-ENT
M$UC      42**DCL
M$UMPL      59**DCL-ENT
M$UNFID      81**DCL-ENT
M$UNLATCH      38**DCL-ENT
M$UNSHARE      35**DCL-ENT
M$USRFIELD      78**DCL-ENT
M$VIRTUAL      53**DCL-ENT
M$WAIT      76**DCL-ENT
M$WEOF      21**DCL-ENT
M$WRSYSLOG      67**DCL-ENT
M$XCON      73**DCL-ENT
M$XCONRTN      34**DCL-ENT
M$XEQTIME      86**DCL-ENT
M$XFLUSH      27**DCL-ENT
M$XMOUSE      64**DCL-ENT
MSG_214_1    6834**DCL
MSG_214_2    6840**DCL
MSG_214_3    6846**DCL
MSG_214_4    6852**DCL
MSG_214_E    6857**DCL
MSG_425    6912**DCL
TCP_ERR_CODE    4149**DCL
XUG$ALLMSG    4051**DCL-ENT
XUG$BLANK_PASSWORD    4054**DCL-ENT
XUG$BREAK    4044**DCL-ENT
XUG$CLOSE_DCBS    4043**DCL-ENT
XUG$CLRENABLE    4047**DCL-ENT
XUG$CORRES    4039**DCL-ENT
XUG$DISABLE    4045**DCL-ENT
XUG$ECHOIF    4036**DCL-ENT
XUG$ECHOLAST    4040**DCL-ENT
PL6.E3A0      #001=FTPCMD File=TCF$FTPDCMD.:TCA2TSI                              SUN 11/16/97 14:11 Page:213  
XUG$ENABLE    4046**DCL-ENT
XUG$ERRCNVRT    4056**DCL-ENT
XUG$ERRMSG    4041**DCL-ENT
XUG$ERRPTR    4035**DCL-ENT
XUG$ERRTOLCP6    4057**DCL-ENT
XUG$FINDDCB    4052**DCL-ENT
XUG$GETDCB    4053**DCL-ENT
XUG$HELP    4049**DCL-ENT
XUG$MOREMSG    4050**DCL-ENT
XUG$OPENOUT    4055**DCL-ENT
XUG$SETERRMSG    4042**DCL-ENT
XUG$SIMULATE_BREAK    4048**DCL-ENT

PL6.E3A0      #002=REPORT_TIME File=TCF$FTPDCMD.:TCA2TSI                         SUN 11/16/97 14:17 Page:214  
     1071        1        /*T***********************************************************/
     1072        2        /*T*                                                         */
     1073        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1074        4        /*T*                                                         */
     1075        5        /*T***********************************************************/
     1076        6        REPORT_TIME: PROC(BYTES,TIME);
     1077        7    1   DCL BYTES SBIN(36);
     1078        8    1   DCL TIME SBIN(36);
     1079        9    1   DCL X$WRITE ENTRY(22);                  /* X$ fmt */
     1080       10        %INCLUDE XU_FORMAT_C;
     1081      172        %F_FDS (NAME=FDS, DCB=M$LO,BUF=FDSBUF);
     1082      285    1   DCL FDSBUF CHAR(240) STATIC;
     1083      286    1   DCL FMT CHAR(0) CONSTANT
     1084      287    1    INIT('%D bytes transferred in %N=%.#:10/KD.%1.#KD seconds
     1085      288    1     (%N=%.#:10/KD%#:200/[.%1.#KD%] Kbytes/s)');
     1086      289    1   DCL M$LO DCB;
     1087      290    1   DCL 1 DAT,
     1088      291    1             2 BYTES SBIN,
     1089      292    1             2 SECS SBIN,
     1090      293    1             2 BPS SBIN;
     1091      294
     1092      295    1      DAT.SECS=TIME;
     1093      296    1      IF DAT.SECS<0 THEN DAT.SECS=DAT.SECS+86400000; /* add a day for wrap */
     1094      297    1      DAT.SECS=(DAT.SECS+50)/100;          /* time in tenths */
     1095      298    1      IF DAT.SECS=0 THEN DAT.SECS=DAT.SECS+1;
     1096      299    1      DAT.BYTES=BYTES;
     1097      300    1      DAT.BPS=(DAT.BYTES+9)/10/DAT.SECS;
     1098      301    1      CALL X$WRITE (FDS, VECTOR(FMT), VECTOR(DAT));
     1099      302
     1100      303    1      RETURN;
     1101      304    1   END REPORT_TIME;

PL6.E3A0      #002=REPORT_TIME File=TCF$FTPDCMD.:TCA2TSI                         SUN 11/16/97 14:17 Page:215  
--  Include file information  --

   XU_FORMAT_C.:LIBRARY  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure REPORT_TIME.

   Procedure REPORT_TIME requires 37 words for executable code.
   Procedure REPORT_TIME requires 16 words of local(AUTO) storage.

    No errors detected in file TCF$FTPDCMD.:TCA2TSI    .

PL6.E3A0      #002=REPORT_TIME File=TCF$FTPDCMD.:TCA2TSI                         SUN 11/16/97 14:17 Page:216  

 Object Unit name= REPORT_TIME                                File name= TCF$FTPDCMD.:TCA2TOU
 UTS= NOV 16 '97 14:17:12.08 SUN                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none    90    132  REPORT_TIME
    1  RoData even  UTS     23     27  REPORT_TIME
    2   DCB   even  none     0      0  M$LO
    3   Proc  even  none    37     45  REPORT_TIME
    4  RoData even  none     6      6  REPORT_TIME

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     3      0   yes            yes      Std        2  REPORT_TIME

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std      22 X$WRITE
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$LO                                  B_VECTNIL
PL6.E3A0      #002=REPORT_TIME File=TCF$FTPDCMD.:TCA2TSI                         SUN 11/16/97 14:17 Page:217  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID
PL6.E3A0      #002=REPORT_TIME File=TCF$FTPDCMD.:TCA2TSI                         SUN 11/16/97 14:17 Page:218  


     1071        1        /*T***********************************************************/
     1072        2        /*T*                                                         */
     1073        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1074        4        /*T*                                                         */
     1075        5        /*T***********************************************************/
     1076        6        REPORT_TIME: PROC(BYTES,TIME);

      6  3 000000   000000 700200 xent  REPORT_TIME  TSX0  ! X66_AUTO_2
         3 000001   000020 000002                    ZERO    16,2

     1077        7    1   DCL BYTES SBIN(36);
     1078        8    1   DCL TIME SBIN(36);
     1079        9    1   DCL X$WRITE ENTRY(22);                  /* X$ fmt */
     1080       10        %INCLUDE XU_FORMAT_C;
     1081      172        %F_FDS (NAME=FDS, DCB=M$LO,BUF=FDSBUF);
     1082      285    1   DCL FDSBUF CHAR(240) STATIC;
     1083      286    1   DCL FMT CHAR(0) CONSTANT
     1084      287    1    INIT('%D bytes transferred in %N=%.#:10/KD.%1.#KD seconds
     1085      288    1     (%N=%.#:10/KD%#:200/[.%1.#KD%] Kbytes/s)');
     1086      289    1   DCL M$LO DCB;
     1087      290    1   DCL 1 DAT,
     1088      291    1             2 BYTES SBIN,
     1089      292    1             2 SECS SBIN,
     1090      293    1             2 BPS SBIN;
     1091      294
     1092      295    1      DAT.SECS=TIME;

    295  3 000002   200004 470500                    LDP0    @TIME,,AUTO
         3 000003   000000 235100                    LDA     0,,PR0
         3 000004   200006 755100                    STA     DAT+1,,AUTO

     1093      296    1      IF DAT.SECS<0 THEN DAT.SECS=DAT.SECS+86400000; /* add a day for wrap */

    296  3 000005   000010 605000 3                  TPL     s:297

    296  3 000006   000000 236000 4                  LDQ     0
PL6.E3A0      #002=REPORT_TIME File=TCF$FTPDCMD.:TCA2TSI                         SUN 11/16/97 14:17 Page:219  
         3 000007   200006 056100                    ASQ     DAT+1,,AUTO

     1094      297    1      DAT.SECS=(DAT.SECS+50)/100;          /* time in tenths */

    297  3 000010   200006 236100                    LDQ     DAT+1,,AUTO
         3 000011   000062 036007                    ADLQ    50,DL
         3 000012   000144 506007                    DIV     100,DL
         3 000013   200006 756100                    STQ     DAT+1,,AUTO

     1095      298    1      IF DAT.SECS=0 THEN DAT.SECS=DAT.SECS+1;

    298  3 000014   000000 116003                    CMPQ    0,DU
         3 000015   000017 601000 3                  TNZ     s:299

    298  3 000016   200006 054100                    AOS     DAT+1,,AUTO

     1096      299    1      DAT.BYTES=BYTES;

    299  3 000017   200003 471500                    LDP1    @BYTES,,AUTO
         3 000020   100000 235100                    LDA     0,,PR1
         3 000021   200005 755100                    STA     DAT,,AUTO

     1097      300    1      DAT.BPS=(DAT.BYTES+9)/10/DAT.SECS;

    300  3 000022   200005 236100                    LDQ     DAT,,AUTO
         3 000023   000011 036007                    ADLQ    9,DL
         3 000024   000012 506007                    DIV     10,DL
         3 000025   200006 506100                    DIV     DAT+1,,AUTO
         3 000026   200007 756100                    STQ     DAT+2,,AUTO

     1098      301    1      CALL X$WRITE (FDS, VECTOR(FMT), VECTOR(DAT));

    301  3 000027   000001 235000 4                  LDA     1
         3 000030   200010 452500                    STP2    DAT+3,,AUTO
         3 000031   200010 236100                    LDQ     DAT+3,,AUTO
         3 000032   000005 036003                    ADLQ    5,DU
         3 000033   200012 757100                    STAQ    DAT+5,,AUTO
PL6.E3A0      #002=REPORT_TIME File=TCF$FTPDCMD.:TCA2TSI                         SUN 11/16/97 14:17 Page:220  
         3 000034   200012 633500                    EPPR3   DAT+5,,AUTO
         3 000035   200016 453500                    STP3    DAT+9,,AUTO
         3 000036   000004 237000 4                  LDAQ    4
         3 000037   200014 757100                    STAQ    DAT+7,,AUTO
         3 000040   200014 630500                    EPPR0   DAT+7,,AUTO
         3 000041   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000042   000000 701000 xent               TSX1    X$WRITE
         3 000043   000000 011000                    NOP     0

     1099      302
     1100      303    1      RETURN;

    303  3 000044   000000 702200 xent               TSX2  ! X66_ARET

FDS
 Sect OctLoc
   0     000   000000 177640   000000 006014   000000 000000   000000 000000    ................
   0     004   000000 000000   000073 777640   000036 006000   000000 000001    .....;..........
   0     010   000000 000000   000000 000000   000000 006014   000000 101500    ..............A.
   0     014   000000 000000   000000 000000   000000 000001   000000 000012    ................
   0     020   000000 000000   ****** ******   ****** ******   000000 000000    ................
   0     024   000000 000000   000000 000000   000000 000000   000000 006014    ................
   0     030   000000 006014   000000 006014   000000 006014   000000 000000    ................
   0     034   000000 000000   000000 000000                                    ........

FDSBUF
 Sect OctLoc
   0     036   ****** ******   ****** ******   ****** ******   ****** ******    ................

FMT
 Sect OctLoc
   1     000   045104 040142   171164 145163   040164 162141   156163 146145    %D bytes transfe
   1     004   162162 145144   040151 156040   045116 075045   056043 072061    rred in %N=%.#:1
   1     010   060057 113104   056045 061056   043113 104040   163145 143157    0/KD.%1.#KD seco
   1     014   156144 163040   050045 116075   045056 043072   061060 057113    nds (%N=%.#:10/K
   1     020   104045 043072   062060 060057   133056 045061   056043 113104    D%#:200/[.%1.#KD
   1     024   045135 040113   142171 164145   163057 163051                    %] Kbytes/s)
PL6.E3A0      #002=REPORT_TIME File=TCF$FTPDCMD.:TCA2TSI                         SUN 11/16/97 14:17 Page:221  

(unnamed)
 Sect OctLoc
   4     000   000511 456000   000002 777640   000026 777640   000000 006000    ................
   4     004   000000 006000   000002 006000                                    ........
     1101      304    1   END REPORT_TIME;

PL6.E3A0      #002=REPORT_TIME File=TCF$FTPDCMD.:TCA2TSI                         SUN 11/16/97 14:17 Page:222  
--  Include file information  --

   XU_FORMAT_C.:LIBRARY  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure REPORT_TIME.
PL6.E3A0      #002=REPORT_TIME File=TCF$FTPDCMD.:TCA2TSI                         SUN 11/16/97 14:17 Page:223  

 **** Variables and constants ****

  ****  Section 000  Data  REPORT_TIME

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(1080)  r     1 FDS                       36-0-0/c CHAR(240)   r     1 FDSBUF

  ****  Section 001 RoData REPORT_TIME

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(92)    r     1 FMT

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @BYTES                     4-0-0/w PTR         r     1 @TIME
    *0-0-0/w SBIN        r     1 BYTES                      5-0-0/w STRC(108)   r     1 DAT
    *0-0-0/w SBIN        r     1 TIME

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0N  NULL        r     1 M$LO


   Procedure REPORT_TIME requires 37 words for executable code.
   Procedure REPORT_TIME requires 16 words of local(AUTO) storage.
PL6.E3A0      #002=REPORT_TIME File=TCF$FTPDCMD.:TCA2TSI                         SUN 11/16/97 14:17 Page:224  

    No errors detected in file TCF$FTPDCMD.:TCA2TSI    .
PL6.E3A0      #002=REPORT_TIME File=TCF$FTPDCMD.:TCA2TSI                         SUN 11/16/97 14:17 Page:225  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=REPORT_TIME File=TCF$FTPDCMD.:TCA2TSI                         SUN 11/16/97 14:17 Page:226  
          MINI XREF LISTING

BYTES
         7**DCL         6--PROC      299>>ASSIGN
DAT
       290**DCL       301--CALL
DAT.BPS
       293**DCL       300<<ASSIGN
DAT.BYTES
       291**DCL       299<<ASSIGN    300>>ASSIGN
DAT.SECS
       292**DCL       295<<ASSIGN    296>>IF        296<<ASSIGN    296>>ASSIGN    297<<ASSIGN    297>>ASSIGN
       298>>IF        298<<ASSIGN    298>>ASSIGN    300>>ASSIGN
FDS
       186**DCL       301<>CALL
FDSBUF
       285**DCL       204--DCLINIT   206--DCLINIT
FMT
       286**DCL       301--CALL
TIME
         8**DCL         6--PROC      295>>ASSIGN
X$WRITE
         9**DCL-ENT   301--CALL
PL6.E3A0      #002=REPORT_TIME File=TCF$FTPDCMD.:TCA2TSI                         SUN 11/16/97 14:17 Page:227  
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #002=REPORT_TIME File=TCF$FTPDCMD.:TCA2TSI                         SUN 11/16/97 14:17 Page:228  
              MINI UREF LISTING

M$LO     289**DCL
REPORT_TIME       6**PROC
