VERSION B06

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:1    
        1        1        /*M* VWB$BEAM - Transmit a file from here to somewhere. */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC, PLM=3, CTI=2, CSI=2, ECI=2, MCI=YES, SDI=6, THI=2 */
        8        8        /*F**
        9        9        *
       10       10        *   NAME:  VWB$BEAM
       11       11        *
       12       12        *   PURPOSE:
       13       13        *       To package files for shipment to another system.
       14       14        *
       15       15        *   DESCRIPTION:
       16       16        *       The BEAM subroutine examines the information passed to it in the
       17       17        *       options block, then opens and reads the file(s) specified,
       18       18        *       packaging them for shipment in 80-column printable (ASC95)
       19       19        *       records.
       20       20        *
       21       21        *   REFERENCE:
       22       22        *       For a description of the transmission packet formats, see the
       23       23        *       appropriate Architecture File document pertaining to MOVE.
       24       24        *
       25       25        ****/
       26       26
       27       27        /*D**
       28       28        *
       29       29        *   NAME:  VWB$BEAM
       30       30        *
       31       31        *   CALL:
       32       32        *       From MOVE and SCOTTY:  CALL VWB$BEAM ALTRET...
       33       33        *       From MAILMAN:          CALL VWB$BEAM(CHECKCG) ALTRET...
       34       34        *
       35       35        *   PARAMETERS:
       36       36        *       MOVE and SCOTTY call VWB$BEAM without parameters.  MAILMAN passes an
       37       37        *       entry (EPTR) address; the existence of the parameter causes VWB$BEAM
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:2    
       38       38        *       to call the external routine periodically to check for comgroup reads.
       39       39        *
       40       40        *   INTERFACE:
       41       41        *       The presence of the CHECKCG parameter causes VWB$BEAM to CALL the
       42       42        *       routine.  The routines VWX$MAIL, VWR$BREAK, VWH$HEADER, VWF$FOOTER,
       43       43        *       VWO$TRANSO, and X$WILDFMT are called.
       44       44        *
       45       45        *   ENVIRONMENT:
       46       46        *       The VW_OPTIONS# block must be filled in by the caller.  At least the
       47       47        *       BEAM and SUCK sections must contain valid data.  SCOTTY must have
       48       48        *       assumed the user's identity (see VWS$SCOTTY).
       49       49        *
       50       50        *   INPUT:
       51       51        *       CHECKCG, as explained above.  VW_OPTIONS# is passed as a global
       52       52        *       symbol.
       53       53        *
       54       54        *   OUTPUT:
       55       55        *       VW_INPCNT#, VW_OUTCNT#, and VW_TOTBYTES# may be modified by this
       56       56        *       routine.  VW_SCRAMBLE# is copied from the VW_OPTIONS# block.
       57       57        *
       58       58        *   SCRATCH:
       59       59        *       VW_BREAK# may be set/reset if the user hits the BREAK key.
       60       60        *
       61       61        *   DESCRIPTION:
       62       62        *       The BEAM subroutine packages a file for transmission across the
       63       63        *       HASP link.  It expects to find the VW_OPTIONS# block filled in by
       64       64        *       the calling program.  Communication back to the "sender" is
       65       65        *       accomplished via the MAIL subprogram, which is different for
       66       66        *       the MOVE program and the SCOTTY ghost.  The BREAK routine is
       67       67        *       used for user break control, but only in MOVE.  ALTRET is taken
       68       68        *       if the beaming process aborts.
       69       69        *
       70       70        ****/
       71       71
       72       72        VWB$BEAM: PROC(CHECKCG) ALTRET;
       73       73
       74       74        /****
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:3    
       75       75        *
       76       76        *   %INCLUDEs
       77       77        *
       78       78        ****/
       79       79
       80       80        %INCLUDE CP_6;
       81     5639        %INCLUDE CP_6_SUBS;
       82     6179        %INCLUDE B$JIT;
       83     6782        %INCLUDE FM$FIT;
       84     7003        %INCLUDE B_ERRORS_C;
       85     8130        %INCLUDE XUW_MACRO_C;
       86     8265        %INCLUDE XU_PERR_C;
       87     8456        %INCLUDE VW_MOVE_E;
       88     8534        %INCLUDE VWM_ERRS_E;
       89     8908        %INCLUDE VW_OPTS_M;
       90     9592        %MOVE_OPTIONS;
       91    10095        %INCLUDE VW_NODEATER_E;
       92    10151        %INCLUDE VW_FPTS_M;
       93    10572
       94    10573        /****
       95    10574        *
       96    10575        *   FPTs
       97    10576        *
       98    10577        ****/
       99    10578
      100    10579        %FM$FIT;
      101    10582
      102    10583        %CODE03;
      103    10590
      104    10591        %CODE04;
      105    10599
      106    10600
      107    10601             %FPT_OPEN(FPTN=OPEN_INP,
      108    10602             DCB=M$INP,
      109    10603             NAME=NAME_INP,
      110    10604             ACCT=ACCT_INP,
      111    10605             PASS=PASS_INP,
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:4    
      112    10606             SN=SN_INP,
      113    10607             FUN=IN,
      114    10608             SCRUB=YES,
      115    10609             SHARE=NONE);
      116    10718
      117    10719        %VLP_NAME(FPTN=NAME_INP,
      118    10720                  LEN=31,
      119    10721                  NAME=' ');
      120    10748
      121    10749        %VLP_ACCT(FPTN=ACCT_INP,
      122    10750                  ACCT='        ');
      123    10763
      124    10764        %VLP_PASS(FPTN=PASS_INP,
      125    10765                  PASS='        ');
      126    10778
      127    10779        %VLP_SN(FPTN=SN_INP,
      128    10780                N=6);
      129    10793
      130    10794        %FPT_FID(FPTN=FID_INP,
      131    10795                 NAME=NAME_INP,
      132    10796                 ACCT=ACCT_INP,
      133    10797                 PASS=PASS_INP,
      134    10798                 SN=SN_INP,
      135    10799                 ASN=OPEN_INP.V.ASN#,
      136    10800                 RES=OPEN_INP.V.RES#,
      137    10801                 RESULTS=VLR_INP);
      138    10824
      139    10825        %VLR_FID(FPTN=VLR_INP);
      140    10844
      141    10845        %FPT_UNFID(FPTN=UNFID_INP,
      142    10846                   DCB=M$INP);
      143    10864
      144    10865        %FPT_OPEN(FPTN=OPEN_OUT,
      145    10866                  NAME=NAME_OUT,
      146    10867                  ACCT=ACCT_OUT,
      147    10868                  PASS=PASS_OUT,
      148    10869                  SN=SN_OUT,
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:5    
      149    10870                  FUN=IN,
      150    10871                  SCRUB=YES,
      151    10872                  SHARE=NONE);
      152    10981
      153    10982        %VLP_NAME(FPTN=NAME_OUT,
      154    10983                  LEN=31,
      155    10984                  NAME=' ');
      156    11011
      157    11012        %VLP_ACCT(FPTN=ACCT_OUT,
      158    11013                  ACCT='        ');
      159    11026
      160    11027        %VLP_PASS(FPTN=PASS_OUT,
      161    11028                  PASS='        ');
      162    11041
      163    11042        %VLP_SN(FPTN=SN_OUT,
      164    11043                N=6);
      165    11056
      166    11057        %FPT_FID(FPTN=FID_OUT,
      167    11058                 NAME=NAME_OUT,
      168    11059                 ACCT=ACCT_OUT,
      169    11060                 PASS=PASS_OUT,
      170    11061                 SN=SN_OUT,
      171    11062                 ASN=OPEN_OUT.V.ASN#,
      172    11063                 RES=OPEN_OUT.V.RES#,
      173    11064                 RESULTS=VLR_OUT);
      174    11087
      175    11088        %VLR_FID(FPTN=VLR_OUT);
      176    11107
      177    11108        %FPT_UNFID(FPTN=UNFID_OUT,
      178    11109                   ACCT=ACCT_OUT,
      179    11110                   ASN=OPEN_OUT.V.ASN#,
      180    11111                   NAME=NAME_OUT,
      181    11112                   PASS=PASS_OUT,
      182    11113                   RES=OPEN_OUT.V.RES#,
      183    11114                   SN=SN_OUT);
      184    11132
      185    11133        %FPT_UNFID(FPTN=UNFID_MSG,
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:6    
      186    11134                   ACCT=ACCT_OUT,
      187    11135                   ASN=OPEN_OUT.V.ASN#,
      188    11136                   NAME=NAME_OUT,
      189    11137                   RES=OPEN_OUT.V.RES#,
      190    11138                   SN=SN_OUT);
      191    11156
      192    11157        %FPT_READ(FPTN=READ_INP,
      193    11158                  DCB=M$INP,
      194    11159                  BUF=INPBUF);
      195    11198
      196    11199        %FPT_PRECORD(FPTN=PRECORD_INP,
      197    11200                     DCB=M$INP,
      198    11201                     N=-1);
      199    11222
      200    11223        %FPT_CLOSE(FPTN=CLOSE_INP,
      201    11224                   DCB=M$INP,
      202    11225                   DISP=SAVE);
      203    11267
      204    11268        %FPT_OPEN(FPTN=OPEN_JE,
      205    11269                  DCB=M$JE,
      206    11270                  ASN=DEVICE,
      207    11271                  RES='JE  ',
      208    11272                  FUN=CREATE,
      209    11273                  EXIST=ERROR,
      210    11274                  SCRUB=YES,
      211    11275                  WSN=WSN_JE);
      212    11384
      213    11385        %FPT_OPEN(FPTN=OPEN_JE_INTRASHIP,
      214    11386                  DCB=M$JE,
      215    11387                  ASN=FILE,
      216    11388                  FUN=CREATE,
      217    11389                  EXIST=ERROR,
      218    11390                  SCRUB=YES,
      219    11391                  ORG=CONSEC,
      220    11392                  NAME=INTRASHIP_NAME,
      221    11393                  ACCT=ACCT_MOVE,
      222    11394                  PASS=INTRASHIP_PASS);
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:7    
      223    11503
      224    11504        %VLP_NAME(FPTN=INTRASHIP_NAME,
      225    11505                  LEN=31);
      226    11532
      227    11533        %VLP_ACCT(FPTN=ACCT_MOVE,
      228    11534                  STCLASS=SYMREF);
      229    11547
      230    11548        %VLP_PASS(FPTN=INTRASHIP_PASS,
      231    11549                  STCLASS=CONSTANT,
      232    11550                  PASS='Montgmry');
      233    11563
      234    11564        %VLP_WSN(FPTN=WSN_JE,
      235    11565                 WSN='        ');
      236    11578
      237    11579        %FPT_WRITE(FPTN=WRITE_JE,
      238    11580                   DCB=M$JE);
      239    11611
      240    11612        %FPT_CLOSE(FPTN=CLOSE_JE,
      241    11613                   DCB=M$JE,
      242    11614                   DISP=SAVE);
      243    11656
      244    11657        %FPT_JOBSTATS(ORDER=CHECKF,
      245    11658                      CRITERIA=VLP_CRITERIA,
      246    11659                      RESULTS=VLR_JOBSTATS_CHECK);
      247    11679
      248    11680        %VLP_CRITERIA;
      249    11708
      250    11709             %VLR_JOBSTATS_CHECK;
      251    11728
      252    11729        %FPT_TIME(FPTN=CLOCK_TO_TODAY,
      253    11730                  SOURCE=CLOCK,
      254    11731                  DEST=ANS,
      255    11732                  DATE=YYMMDD);
      256    11751
      257    11752        %FPT_TIME(FPTN=TODAY_TO_UTS,
      258    11753                  SOURCE=ANS,
      259    11754                  DEST=UTS,
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:8    
      260    11755                  DATE=YYMMDD,
      261    11756                  TSTAMP=TODAY);
      262    11775
      263    11776        %FPT_TIME(FPTN=CLOCK_TO_UTS,
      264    11777                  STCLASS=CONSTANT,
      265    11778                  SOURCE=CLOCK,
      266    11779                  DEST=UTS,
      267    11780                  TSTAMP=TODAY);
      268    11799
      269    11800        %FPT_PRIV(FPTN=FMSEC,
      270    11801                  STCLASS=CONSTANT,
      271    11802                  PRIV=%PR_FMSEC#);
      272    11817
      273    11818        %FPT_WAIT(UNITS=1);
      274    11832
      275    11833        %VLP_NAME(FPTN=NAME_WILD);
      276    11860
      277    11861        %VLP_NAME(FPTN=NAME_DEST);
      278    11888
      279    11889        %XUW_WILDCARD;
      280    11985
      281    11986        %B$TCB;
      282    11989
      283    11990        %B$ALT;
      284    11998
      285    11999        %F$DCB(DCBN=DUMMY);
      286    12056
      287    12057        %EQU ADAY=%(24*60*60*100);             /* A day in 100ths of seconds */
      288    12058
      289    12059        /****
      290    12060        *
      291    12061        *   Local variables
      292    12062        *
      293    12063        ****/
      294    12064
      295    12065    1   DCL CHECKCG                        EPTR;
      296    12066
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:9    
      297    12067    1   DCL M$INP                          DCB;
      298    12068    1   DCL M$JE                           DCB;
      299    12069    1   DCL M$NODE                         DCB;
      300    12070
      301    12071    1   DCL ASZ$SCRAMBLE ENTRY (1);
      302    12072    1   DCL VWX$MAIL                       ENTRY(5);
      303    12073    1   DCL VWR$BREAK                      ENTRY ALTRET;
      304    12074    1   DCL VWH$HEADER                     ENTRY(3) ALTRET;
      305    12075    1   DCL VWF$FOOTER                     ENTRY(3) ALTRET;
      306    12076    1   DCL X$WILDFMT                      ENTRY(1) ALTRET;
      307    12077    1   DCL VWO$TRANSO                     ENTRY(1);
      308    12078
      309    12079    1   DCL I                              SBIN;
      310    12080    1   DCL J                              SBIN;
      311    12081    1   DCL K                              SBIN;
      312    12082    1   DCL W                              SBIN;
      313    12083    1   DCL N                              SBIN;
      314    12084    1   DCL O                              SBIN;
      315    12085    1   DCL D                              SBIN;
      316    12086    1   DCL OPTX                           SBIN;
      317    12087    1   DCL RECX                           SBIN;
      318    12088    1   DCL FILECOUNT                      SBIN;
      319    12089    1   DCL RECSCOUNT                      SBIN;
      320    12090    1   DCL VW_INPCNT# SYMREF              SBIN;
      321    12091    1   DCL VW_OUTCNT# SYMREF              SBIN;
      322    12092    1   DCL VW_TOTBYTES# SYMREF            SBIN;
      323    12093    1   DCL VW_BROKEN# SYMREF              SBIN;
      324    12094    1   DCL FILEORG                        SBIN;
      325    12095    1   DCL JEIDX                          SBIN;
      326    12096    1   DCL INPLIM                         SBIN;
      327    12097    1   DCL ARS                            SBIN;
      328    12098    1   DCL ERRDCB                         SBIN;
      329    12099
      330    12100    1   DCL INF_CON CONSTANT               SBIN INIT(-1);
      331    12101    1   DCL INFINITY REDEF INF_CON         UBIN;
      332    12102
      333    12103    1   DCL TODAY STATIC                   UBIN;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:10   
      334    12104    1   DCL DATE_LO                        UBIN;
      335    12105    1   DCL DATE_HI                        UBIN;
      336    12106
      337    12107    1   DCL 1 RECS(0:9),
      338    12108    1             2 LO                         UBIN,
      339    12109    1             2 HI                         UBIN;
      340    12110
      341    12111    1   DCL ERRCODE                        SBIN;
      342    12112    1   DCL 1 ERRBITS REDEF ERRCODE,
      343    12113    1             2 FCG                        UNAL BIT(18),
      344    12114    1             2 M                          UNAL BIT(1),
      345    12115    1             2 CODE                       UNAL UBIN(14),
      346    12116    1             2 SEV                        UNAL UBIN(3);
      347    12117
      348    12118    1   DCL B$JIT$ SYMREF                  PTR;
      349    12119    1   DCL B$TCB$ SYMREF                  PTR;
      350    12120    1   DCL INPPTR                         PTR;
      351    12121    1   DCL JEPTR                          PTR;
      352    12122    1   DCL OPT$                           PTR;
      353    12123
      354    12124    1   DCL 1 INPBUF STATIC,
      355    12125    1             2 C                          CHAR(8192),
      356    12126    1             2 *                          CHAR(8192),
      357    12127    1             2 *                          CHAR(8192),
      358    12128    1             2 *                          CHAR(8192);
      359    12129
      360    12130    1   DCL 1 KEYBUF,
      361    12131    1             2 L UNAL                     UBIN BYTE,
      362    12132    1             2 C UNAL                     CHAR(255);
      363    12133
      364    12134    1   DCL 1 EXTERNAL,
      365    12135    1             2 SITENAME               CHAR(8),
      366    12136    1             2 ACCT                   CHAR(8);
      367    12137
      368    12138    1   DCL FITBUF (0:1023) AUTO           UBIN WORD;
      369    12139    1   DCL JEBUF                          CHAR(80);
      370    12140    1   DCL TWORK                          CHAR(12);
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:11   
      371    12141    1   DCL DWORK                          CHAR(8);
      372    12142    1   DCL YYMMDD STATIC                  CHAR(6);
      373    12143    1   DCL VW_IAM# SYMREF                 CHAR(8);
      374    12144    1   DCL RANREL                         CHAR(4);
      375    12145    1   DCL BAD_FILE_NAME                   CHAR (31);
      376    12146
      377    12147    1   DCL 1 BADCHARS CONSTANT ALIGNED,
      378    12148    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      379    12149    1             2 *(0:31) BIT(9) UNAL INIT('000'O*32),
      380    12150    1             2 *(0:31) BIT(9) UNAL INIT('000'O*32),
      381    12151    1             2 *(0:31) BIT(9) UNAL INIT('000'O*31,'111'O),
      382    12152    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      383    12153    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      384    12154    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      385    12155    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      386    12156    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      387    12157    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      388    12158    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      389    12159    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      390    12160    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      391    12161    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      392    12162    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      393    12163    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32);
      394    12164
      395    12165    1   DCL 1 U1,
      396    12166    1             2 L UNAL                     UBIN BYTE,
      397    12167    1             2 C UNAL                     CHAR(79);
      398    12168    1   DCL 1 U2,
      399    12169    1             2 L UNAL                     UBIN BYTE,
      400    12170    1             2 C UNAL                     CHAR(79);
      401    12171    1   DCL 1 U3,
      402    12172    1             2 L UNAL                     UBIN BYTE,
      403    12173    1             2 C UNAL                     CHAR(79);
      404    12174    1   DCL 1 U4,
      405    12175    1             2 L UNAL                     UBIN BYTE,
      406    12176    1             2 C UNAL                     CHAR(79);
      407    12177    1   DCL 1 U5,
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:12   
      408    12178    1             2 L UNAL                     UBIN BYTE,
      409    12179    1             2 C UNAL                     CHAR(79);
      410    12180    1   DCL 1 U6,
      411    12181    1             2 L UNAL                     UBIN BYTE,
      412    12182    1             2 C UNAL                     CHAR(79);
      413    12183
      414    12184    1   DCL NLN                            BIT(1);
      415    12185    1   DCL NFA                            BIT(1);
      416    12186    1   DCL NSC                            BIT(1);
      417    12187    1   DCL ITSBIN                         BIT(1);
      418    12188    1   DCL MULTIPLE                       BIT(1);
      419    12189    1   DCL VW_SCRAMBLE# SYMREF            BIT(1);
      420    12190    1   DCL SOMETHING                      BIT(1);
      421    12191    1   DCL DATE_SELECT                    BIT(1);
      422    12192    1   DCL DATE_SELECT_WHICH              BIT(1);
      423    12193    1   DCL DATE_REL                       BIT(1);
      424    12194    1   DCL INTERNET                       BIT(1);
      425    12195    1   DCL INTRASHIP                      BIT(1);
      426    12196    1   DCL VO_INTERSYS_ACCT CONSTANT      CHAR(8) INIT (':MAIL');
      427    12197    1   DCL VO_INTERSYS_NAME CONSTANT      CHAR(12) INIT ('500ATOB');
      428    12198    1   DCL VO_INTERSYS_PASSWORD CONSTANT  CHAR(8) INIT ('MAILPASS');
      429    12199
      430    12200        %EJECT;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:13   
      431    12201        /****
      432    12202        *
      433    12203        *   Initialize the FPTs and local variables to defaults.
      434    12204        *
      435    12205        ****/
      436    12206
      437    12207    1      INPPTR=DCBADDR(DCBNUM(M$INP));
      438    12208    1      JEPTR=DCBADDR(DCBNUM(M$JE));
      439    12209    1      OPEN_INP.FPARAM_=VECTOR(FITBUF);
      440    12210    1      WRITE_JE.BUF_.BUF$=ADDR(JEBUF);
      441    12211    1      WRITE_JE.BUF_.BOUND=79;
      442    12212    1      UNFID_OUT.TEXTFID_=VECTOR(OPTS.OUT.FID);
      443    12213    1      UNFID_OUT.LEN_=VECTOR(I);
      444    12214    1      UNFID_INP.TEXTFID_=VECTOR(U1.C);
      445    12215    1      UNFID_INP.LEN_=VECTOR(I);
      446    12216    1      UNFID_MSG.TEXTFID_=VECTOR(U2.C);
      447    12217    1      UNFID_MSG.LEN_=VECTOR(I);
      448    12218    1      NODEKEY.L=8;
      449    12219    1      MULTIPLE='0'B;
      450    12220    1      FILECOUNT=0;
      451    12221    1      DATE_SELECT='0'B;
      452    12222    1      CALL M$TIME(CLOCK_TO_TODAY);
      453    12223    1      CALL M$TIME(TODAY_TO_UTS);
      454    12224    1      RECX=0;
      455    12225    1      RECS='0'B;
      456    12226
      457    12227        /****
      458    12228        *
      459    12229        *   Decode the output file name into the M$OPEN FPTs, unless the name
      460    12230        *   is "foreign" (enclosed in single quotes).
      461    12231        *
      462    12232        ****/
      463    12233
      464    12234    2      IF SUBSTR(OPTS.OUT.FID,0,1)~='''' THEN DO;
      465    12235    2         I=OPTS.OUT.L-ASCBIN('/');
      466    12236    2         IF I<1 OR I>79 THEN
      467    12237    2            GOTO BEAM_BAD_OTL;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:14   
      468    12238    2         FID_OUT.TEXTFID_=VECTOR(SUBSTR(OPTS.OUT.FID,0,I));
      469    12239    2         CALL M$FID(FID_OUT) ALTRET(BEAM_BAD_OUT);
      470    12240    2         END;
      471    12241
      472    12242        /****
      473    12243        *
      474    12244        *   Decode the input file name into the M$OPEN FPTs.  This name cannot
      475    12245        *   be "foreign".
      476    12246        *
      477    12247        ****/
      478    12248
      479    12249    1      I=OPTS.INP.L-ASCBIN('/');
      480    12250    1      IF I<1 OR I>79 THEN
      481    12251    1         GOTO BEAM_BAD_ITL;
      482    12252    1      FID_INP.TEXTFID_=VECTOR(SUBSTR(OPTS.INP.FID,0,I));
      483    12253    1      CALL M$FID(FID_INP) ALTRET(BEAM_BAD_INP);
      484    12254
      485    12255        /****
      486    12256        *
      487    12257        *   Determine if there are options present.
      488    12258        *
      489    12259        ****/
      490    12260
      491    12261    1      OPTX=0;
      492    12262    2      DO WHILE(OPTX<LENGTHC(OPTS.OPTSRECS)/80 AND SUBSTR(OPTS.OPTSRECS(OPTX),
      493    12263    2        0,4)='OPTS');
      494    12264    2         OPT$=ADDR(OPTS.OPTSRECS(OPTX));
      495    12265    3         DO SELECT(SUBSTR(OPTS.OPTSRECS(OPTX),4,4));
      496    12266
      497    12267        /****
      498    12268        *
      499    12269        *   DATE option.  Decode which date (modify or create), the relation, and
      500    12270        *   the date the relation is to be applied to (today, yesterday, etc.).
      501    12271        *
      502    12272        ****/
      503    12273
      504    12274    3            SELECT('DATE');
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:15   
      505    12275    3            IF OPT$->OPTSDATE.WHICH='C' THEN
      506    12276    3               DATE_SELECT_WHICH='0'B;
      507    12277    3              ELSE
      508    12278    3               DATE_SELECT_WHICH='1'B;
      509    12279
      510    12280    3            IF OPT$->OPTSDATE.UTS='TODAY' THEN
      511    12281    3               ;
      512    12282    3              ELSE IF OPT$->OPTSDATE.UTS='YESTERDAY' THEN
      513    12283    3                  TODAY=TODAY-%ADAY;
      514    12284    4                 ELSE IF SUBSTR(OPT$->OPTSDATE.UTS,0,1)='-' THEN DO;
      515    12285    4                     CALL INDEX(I,' ',OPT$->OPTSDATE.UTS);
      516    12286    4                     CALL CHARBIN(J,SUBSTR(OPT$->OPTSDATE.UTS,1,I-1));
      517    12287    4                     TODAY=TODAY-J*%ADAY;
      518    12288    4                     END;
      519    12289    4                    ELSE DO;
      520    12290    4                     YYMMDD=SUBSTR(OPT$->OPTSDATE.UTS,0,6);
      521    12291    4                     CALL M$TIME(TODAY_TO_UTS);
      522    12292    4                     END;
      523    12293
      524    12294    3            DATE_REL='0'B;
      525    12295    4            DO SELECT(OPT$->OPTSDATE.REL);
      526    12296    4               SELECT('GT');
      527    12297    4               DATE_LO=TODAY+%ADAY;
      528    12298    4               DATE_HI=INFINITY;
      529    12299    4               SELECT('EQ');
      530    12300    4               DATE_LO=TODAY;
      531    12301    4               DATE_HI=TODAY+%ADAY;
      532    12302    4               SELECT('GE');
      533    12303    4               DATE_LO=TODAY;
      534    12304    4               DATE_HI=INFINITY;
      535    12305    4               SELECT('LT');
      536    12306    4               DATE_LO=0;
      537    12307    4               DATE_HI=TODAY;
      538    12308    4               SELECT('LE');
      539    12309    4               DATE_LO=0;
      540    12310    4               DATE_HI=TODAY+%ADAY;
      541    12311    4               SELECT('NE');
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:16   
      542    12312    4               DATE_LO=TODAY;
      543    12313    4               DATE_HI=TODAY+%ADAY;
      544    12314    4               DATE_REL='1'B;
      545    12315    4               END;
      546    12316    3            DATE_SELECT='1'B;
      547    12317
      548    12318        /****
      549    12319        *
      550    12320        *   RECS (record selection) option.  Fetch the first and last record
      551    12321        *   numbers.
      552    12322        *
      553    12323        ****/
      554    12324
      555    12325    3            SELECT('RECS');
      556    12326    4            IF RECX<10 THEN DO;
      557    12327    4               CALL CHARBIN(RECS.LO(RECX),OPT$->OPTSRECS.FRST);
      558    12328    4               CALL CHARBIN(RECS.HI(RECX),OPT$->OPTSRECS.LAST);
      559    12329    4               RECX=RECX+1;
      560    12330    4               END;
      561    12331
      562    12332    3            END /* DO select */;
      563    12333    2         OPTX=OPTX+1;
      564    12334    2         END;
      565    12335
      566    12336        /****
      567    12337        *
      568    12338        *   Discover if this is a wildcarded MOVE by looking for ? in the FID.
      569    12339        *   You cannot wildcard-move to a foreign system.
      570    12340        *
      571    12341        ****/
      572    12342
      573    12343    1      CALL INDEX1(J,'?',SUBSTR(NAME_INP.NAME#,0,NAME_INP.L#),0)
      574    12344    1        ALTRET(BEAM_JUST_ONCE);
      575    12345    1      IF SUBSTR(OPTS.OUT.FID,0,1)='''' THEN
      576    12346    1         GOTO BEAM_BAD_WLD;
      577    12347
      578    12348        /****
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:17   
      579    12349        *
      580    12350        *   Set up for multiple inputs (wildcarded).
      581    12351        *
      582    12352        ****/
      583    12353
      584    12354    1      NAME_DEST=NAME_OUT;
      585    12355    1      NAME_WILD=NAME_INP;
      586    12356    1      XUW_WILDCARD.TEMPLATE_=VECTOR(SUBSTR(NAME_DEST.NAME#,0,NAME_DEST.L#));
      587    12357    1      XUW_WILDCARD.PATTERN_=VECTOR(SUBSTR(NAME_WILD.NAME#,0,NAME_WILD.L#));
      588    12358    1      OPEN_INP.V.OPER.THISF#='1'B;
      589    12359    1      CALL INDEX1(I,'?',NAME_INP.NAME#,0);
      590    12360    1      NAME_INP.L#=I;
      591    12361    1      MULTIPLE='1'B;
      592    12362    1      BAD_FILE_NAME = ' ';
      593    12363
      594    12364        /****
      595    12365        *
      596    12366        *   Open the next file in test mode to see if it's one we want.
      597    12367        *
      598    12368        ****/
      599    12369
      600    12370    1   BEAM_NEXT_FILE:
      601    12371    1      OPEN_INP.V.OPER.NXTF#='1'B;
      602    12372    1      OPEN_INP.V.OPER.TEST#='1'B;
      603    12373    1      CALL M$OPEN(OPEN_INP)
      604    12374    2        WHENALTRETURN DO;
      605    12375    2         IF B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR.ERR# = %E$FDEOF  /* end of dir. */
      606    12376    2           OR B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR.ERR# = %E$EOSET /* end of tapeset */
      607    12377    2           OR INPPTR->DUMMY.NAME#.C = BAD_FILE_NAME            /* stuck */
      608    12378    2           THEN
      609    12379    2            GOTO BEAM_WILD_DONE;
      610    12380    2         BAD_FILE_NAME = INPPTR->DUMMY.NAME#.C;
      611    12381    2         NAME_INP = INPPTR->DUMMY.NAME#;
      612    12382    2         GOTO BEAM_NEXT_FILE;
      613    12383    2         END;
      614    12384    1      NAME_INP=INPPTR->DUMMY.NAME#;
      615    12385    1      OPEN_INP.V.OPER='0'B;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:18   
      616    12386    1      NAME_OUT.L#=31;
      617    12387    1      XUW_WILDCARD.INPUT_=VECTOR(SUBSTR(NAME_INP.NAME#,0,NAME_INP.L#));
      618    12388    1      XUW_WILDCARD.OUTPUT_=VECTOR(SUBSTR(NAME_OUT.NAME#,0,NAME_OUT.L#));
      619    12389    1      CALL X$WILDFMT(XUW_WILDCARD) ALTRET(BEAM_WILD_ERROR);
      620    12390    1      NAME_OUT.L#=XUW_WILDCARD.OUTPUT_LEN;
      621    12391    1      IF NAME_OUT.L#>0 THEN
      622    12392    1         GOTO BEAM_MULT_FILE;
      623    12393
      624    12394        /****
      625    12395        *
      626    12396        *   The wildcarder returned an error.  If this is just "no match",
      627    12397        *   move on to the next file, if appropriate.
      628    12398        *
      629    12399        ****/
      630    12400
      631    12401    1   BEAM_WILD_ERROR:
      632    12402    2      IF XUW_WILDCARD.ERROR.ERR#=%E$XUW#NOMATCH THEN DO;
      633    12403    2         CALL INDEX1(I,'?',SUBSTR(NAME_WILD.NAME#,0,NAME_WILD.L#),0);
      634    12404    2         IF I=0 THEN
      635    12405    2            GOTO BEAM_NEXT_FILE;
      636    12406    2         IF SUBSTR(NAME_INP.NAME#,0,I)~=SUBSTR(NAME_WILD.NAME#,0,I) THEN
      637    12407    2            GOTO BEAM_WILD_DONE;
      638    12408    2         GOTO BEAM_NEXT_FILE;
      639    12409    2         END;
      640    12410    1        ELSE
      641    12411    1         GOTO BEAM_BAD_WLD;
      642    12412
      643    12413        /****
      644    12414        *
      645    12415        *   We found a file we want to BEAM.  Put the name back into the
      646    12416        *   buffer and fall into the open logic.
      647    12417        *
      648    12418        ****/
      649    12419
      650    12420    1   BEAM_MULT_FILE:
      651    12421    1      CALL M$UNFID(UNFID_OUT);
      652    12422    1      OPTS.OUT.L=I+ASCBIN('/');
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:19   
      653    12423    1      IF B$JIT.PRIV.ACTIVE&%PR_JIT#~='0'B THEN
      654    12424    1         B$JIT.REMCPO=131071;
      655    12425
      656    12426        /****
      657    12427        *
      658    12428        *   Now open the file for real.
      659    12429        *
      660    12430        ****/
      661    12431
      662    12432    1   BEAM_JUST_ONCE:
      663    12433    1      OPEN_INP.V.OPER.TEST#='0'B;
      664    12434    1      OPEN_INP.V.OPER.NXTF#='0'B;
      665    12435    1      CALL M$OPEN(OPEN_INP) ALTRET(BEAM_BAD_FMF);
      666    12436
      667    12437        /****
      668    12438        *
      669    12439        *   See if this file is eligible for by date moves.
      670    12440        *
      671    12441        ****/
      672    12442
      673    12443    2      IF DATE_SELECT THEN DO;
      674    12444    2         J=ADDR(FITBUF)->FM$FIT.CODES.CODE(0);
      675    12445    3         DO I=1 TO J;
      676    12446    4            IF ADDR(FITBUF)->FM$FIT.CODES.CODE(I)=4 THEN DO;
      677    12447    4               K=ADDR(FITBUF)->FM$FIT.CODES.ITEMX(I);
      678    12448    4               IF DATE_SELECT_WHICH THEN
      679    12449    4                  TODAY=PINCRW(ADDR(FITBUF),K)->CODE04.MODIFY.TIME;
      680    12450    4                 ELSE
      681    12451    4                  TODAY=PINCRW(ADDR(FITBUF),K)->CODE04.CREATION.TIME;
      682    12452    4               IF (DATE_REL AND TODAY>=DATE_LO AND TODAY<DATE_HI) OR
      683    12453    5                 (NOT DATE_REL AND (TODAY<DATE_LO OR TODAY>=DATE_HI)) THEN DO;
      684    12454    5                  CALL M$CLOSE(CLOSE_INP);
      685    12455    5                  IF MULTIPLE THEN
      686    12456    5                     GOTO BEAM_NEXT_FILE;
      687    12457    5                    ELSE
      688    12458    5                     RETURN;
      689    12459    5                  END;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:20   
      690    12460    4               END;
      691    12461    3            END;
      692    12462    2         END;
      693    12463
      694    12464        /****
      695    12465        *
      696    12466        *   Open the output DCB to the appropriate destination.  For normal beaming,
      697    12467        *   open to JE@wsn.  For beaming to an "external" node, open to JE@dirwsn
      698    12468        *   (if the directory lies on another system) or to a uniquely-named
      699    12469        *   file in .moveacct (if the directory lies on this system).
      700    12470        *
      701    12471        ****/
      702    12472
      703    12473    1      IF OPTS.OUT.NODE = VW_IAM#
      704    12474    1        THEN
      705    12475    1         GOTO INTRASHIP_BEAMING;
      706    12476    1      NODEKEY.C=OPTS.OUT.NODE;
      707    12477    1      CALL M$READ(READ_NODE) ALTRET(BEAM_BAD_DST);
      708    12478    2      IF DCBADDR(DCBNUM(M$NODE))->DUMMY.ARS#=8 THEN DO;
      709    12479    2         IF NODEOVR.PATH_NAME = VW_IAM#
      710    12480    2           THEN
      711    12481    2            GOTO INTRASHIP_BEAMING;
      712    12482    2         NODEKEY.C=NODEOVR.PATH_NAME;
      713    12483    2         CALL M$READ(READ_NODE) ALTRET(BEAM_BAD_DST);
      714    12484    2         END;
      715    12485    1      IF NODEOVR.TYPE_DEST = %N_EXTERNAL#
      716    12486    2        THEN DO;
      717    12487    2         INTERNET = %YES#;
      718    12488    2         EXTERNAL.SITENAME = NODEOVR.NODE_NAME;
      719    12489    2         EXTERNAL.ACCT = NODEOVR.ACCT;
      720    12490    2         IF EXTERNAL.SITENAME = VW_IAM#
      721    12491    3           THEN DO;
      722    12492    3   INTRASHIP_BEAMING:
      723    12493    3            INTRASHIP = %YES#;
      724    12494    3            CALL M$TIME (CLOCK_TO_UTS);
      725    12495    3            CALL CONCAT (INTRASHIP_NAME.NAME#, 'MOVExxxxxxxx', VW_IAM#);
      726    12496    3            CALL BINCHAR (SUBSTR(INTRASHIP_NAME.NAME#, 4, 8), TODAY);
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:21   
      727    12497    3            CALL INDEX (I, ' ', INTRASHIP_NAME.NAME#);
      728    12498    3            INTRASHIP_NAME.L# = I;
      729    12499    3            CALL M$OPEN (OPEN_JE_INTRASHIP)
      730    12500    4              WHENALTRETURN DO;
      731    12501    4               IF B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR.ERR# ~= %E$NEWFILE
      732    12502    4                 OR B$JIT.PRIV.ACTIVE.FMSEC
      733    12503    4                 THEN
      734    12504    4                  GOTO BEAM_BAD_NODE;
      735    12505    4               CALL M$SENV;
      736    12506    4               CALL M$SPRIV (FMSEC) ALTRET (NOGOOD);
      737    12507    4               CALL M$OPEN (OPEN_JE_INTRASHIP)
      738    12508    5                 WHENALTRETURN DO;
      739    12509    6   NOGOOD:        CALL M$RPRIV (FMSEC) WHENALTRETURN DO; END;
      740    12510    5                  CALL M$RENV;
      741    12511    5                  GOTO BEAM_BAD_NODE;
      742    12512    5                  END;
      743    12513    5               CALL M$RPRIV (FMSEC) WHENALTRETURN DO; END;
      744    12514    4               CALL M$RENV;
      745    12515    4               END;
      746    12516    3            END;
      747    12517    3           ELSE DO;
      748    12518    3            INTRASHIP = %NO#;
      749    12519    3            NODEKEY.C = EXTERNAL.SITENAME;
      750    12520    3            CALL M$READ (READ_NODE) ALTRET (BEAM_BAD_DST);
      751    12521    3            WSN_JE.WSN# = NODEOVR.PATH_NAME;
      752    12522    3            CALL M$OPEN (OPEN_JE) ALTRET (BEAM_BAD_NODE);
      753    12523    3            END;
      754    12524    2         END;
      755    12525    2        ELSE DO;
      756    12526    2         INTERNET = %NO#;
      757    12527    2         INTRASHIP = %NO#;
      758    12528    2         WSN_JE.WSN# = NODEOVR.PATH_NAME;
      759    12529    2         CALL M$OPEN (OPEN_JE) ALTRET (BEAM_BAD_NODE);
      760    12530    2         END;
      761    12531
      762    12532        /****
      763    12533        *
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:22   
      764    12534        *   Tell the user he's MOVing.
      765    12535        *
      766    12536        ****/
      767    12537
      768    12538    1      CALL M$UNFID(UNFID_INP);
      769    12539    1      U1.L=I;
      770    12540    2      IF SUBSTR(OPTS.OUT.FID,0,1)='''' THEN DO;
      771    12541    2         U2.C=OPTS.OUT.FID;
      772    12542    2         I=OPTS.OUT.L-ASCBIN('/');
      773    12543    2         END;
      774    12544    1        ELSE
      775    12545    1         CALL M$UNFID(UNFID_MSG);
      776    12546    1      U2.L=I;
      777    12547    1      U3.C=OPTS.OUT.NODE;
      778    12548    1      CALL INDEX(I,' ',OPTS.OUT.NODE);
      779    12549    1      U3.L=I;
      780    12550    1      CALL VWX$MAIL(%E$VWM_SEN,VECTOR(U1),VECTOR(U2),VECTOR(U3));
      781    12551
      782    12552        /****
      783    12553        *
      784    12554        *   Pick the options out of the OPTS block.
      785    12555        *
      786    12556        ****/
      787    12557
      788    12558    1      NLN=OPTS.INP.MISC.NLN;
      789    12559    1      NSC=OPTS.INP.MISC.NSC;
      790    12560    1      NFA=OPTS.INP.MISC.NFA;
      791    12561    1      VW_SCRAMBLE#=OPTS.INP.MISC.TRAN;
      792    12562
      793    12563        /****
      794    12564        *
      795    12565        *   Reset a whole bunch of stuff, then find the file's size.
      796    12566        *
      797    12567        ****/
      798    12568
      799    12569    1      JEBUF=' ';
      800    12570    1      VW_INPCNT#=0;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:23   
      801    12571    1      JEIDX=0;
      802    12572    1      VW_BROKEN#=0;
      803    12573    1      SOMETHING='0'B;
      804    12574    1      RECSCOUNT=0;
      805    12575    1      FILEORG=INPPTR->DUMMY.ORG#;
      806    12576    1      J=ADDR(FITBUF)->FM$FIT.CODES.CODE(0);
      807    12577    2      DO I=1 TO J;
      808    12578    3         IF ADDR(FITBUF)->FM$FIT.CODES.CODE(I)=3 THEN DO;
      809    12579    3            K=ADDR(FITBUF)->FM$FIT.CODES.ITEMX(I);
      810    12580    3            VW_TOTBYTES#=PINCRW(ADDR(FITBUF),K)->CODE03.UGRANS*4096;
      811    12581    3            IF VW_TOTBYTES#<=0
      812    12582    3              OR PINCRW(ADDR(FITBUF),K)->CODE03.COMP
      813    12583    3              THEN
      814    12584    3               VW_TOTBYTES#=0;
      815    12585    3            END;
      816    12586    2         END;
      817    12587
      818    12588        /****
      819    12589        *
      820    12590        *   Process the NLN and NFA options
      821    12591        *
      822    12592        ****/
      823    12593
      824    12594    2      IF NLN THEN DO;
      825    12595    2         FILEORG=%CONSEC#;
      826    12596    2         J=ADDR(FITBUF)->FM$FIT.CODES.CODE(0);
      827    12597    3         DO I=1 TO J;
      828    12598    4            IF ADDR(FITBUF)->FM$FIT.CODES.CODE(I)=3 THEN DO;
      829    12599    4               K=ADDR(FITBUF)->FM$FIT.CODES.ITEMX(I);
      830    12600    4               PINCRW(ADDR(FITBUF),K)->CODE03.ORG=%CONSEC#;
      831    12601    4               END;
      832    12602    3            IF ADDR(FITBUF)->FM$FIT.CODES.CODE(I)=8 THEN
      833    12603    3               ADDR(FITBUF)->FM$FIT.CODES.CODE(I)=0;
      834    12604    3            IF ADDR(FITBUF)->FM$FIT.CODES.CODE(I)>18  AND
      835    12605    3              ADDR(FITBUF)->FM$FIT.CODES.CODE(I)<21 THEN
      836    12606    3               ADDR(FITBUF)->FM$FIT.CODES.CODE(I)=0;
      837    12607    3            END;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:24   
      838    12608    2         END;
      839    12609    2      IF NFA THEN DO;
      840    12610    2         J=ADDR(FITBUF)->FM$FIT.CODES.CODE(0);
      841    12611    3         DO I=1 TO J;
      842    12612    4            IF ADDR(FITBUF)->FM$FIT.CODES.CODE(I)=3 THEN DO;
      843    12613    4               K=ADDR(FITBUF)->FM$FIT.CODES.ITEMX(I);
      844    12614    4               PINCRW(ADDR(FITBUF),K)->CODE03.EXPIRE=0;
      845    12615    4               END;
      846    12616    3            IF ADDR(FITBUF)->FM$FIT.CODES.CODE(I)>8 AND
      847    12617    3              ADDR(FITBUF)->FM$FIT.CODES.CODE(I)<11 THEN
      848    12618    3               ADDR(FITBUF)->FM$FIT.CODES.NDW(I)=0;
      849    12619    3            END;
      850    12620    2         END;
      851    12621
      852    12622        /****
      853    12623        *
      854    12624        *   If we're involved in an internet (external-node) transfer, then
      855    12625        *   go off and play footsie with the FIT information and the output
      856    12626        *   options.
      857    12627        *
      858    12628        ****/
      859    12629
      860    12630    1      IF INTERNET
      861    12631    1        THEN
      862    12632    1         CALL FIDDLE_FIT ALTRET (BEAM_USRERR);
      863    12633
      864    12634        /****
      865    12635        *
      866    12636        *   Generate an appropriate header.
      867    12637        *
      868    12638        ****/
      869    12639
      870    12640    1      IF NOT INTRASHIP
      871    12641    2        THEN DO;
      872    12642    2         I=NODEOVR.TYPE_PATH;
      873    12643    2         CALL VWH$HEADER(DCBNUM(M$JE),JEBUF,I) ALTRET(BEAM_BAD_WRJ);
      874    12644    2         END;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:25   
      875    12645
      876    12646        /****
      877    12647        *
      878    12648        *   Write out the header blocks.
      879    12649        *
      880    12650        ****/
      881    12651
      882    12652    1      JEBUF=CARD(2);
      883    12653    1      IF VW_SCRAMBLE# THEN
      884    12654    1         CALL VWO$TRANSO(JEBUF);
      885    12655    1      CALL M$WRITE(WRITE_JE) ALTRET(BEAM_BAD_WRJ);
      886    12656    1      JEBUF=CARD(3);
      887    12657    1      IF VW_SCRAMBLE# THEN
      888    12658    1         CALL VWO$TRANSO(JEBUF);
      889    12659    1      CALL M$WRITE(WRITE_JE) ALTRET(BEAM_BAD_WRJ);
      890    12660    1      VW_OUTCNT#=3;
      891    12661
      892    12662        /****
      893    12663        *
      894    12664        *   Send the MAIL records only if mail was requested.
      895    12665        *
      896    12666        ****/
      897    12667
      898    12668    2      IF OPTS.MAILRCVR.WHO~=' ' THEN DO;
      899    12669    2         JEBUF=CARD(6);
      900    12670    2         IF VW_SCRAMBLE# THEN
      901    12671    2            CALL VWO$TRANSO(JEBUF);
      902    12672    2         CALL M$WRITE(WRITE_JE) ALTRET(BEAM_BAD_WRJ);
      903    12673    2         JEBUF=CARD(7);
      904    12674    2         IF VW_SCRAMBLE# THEN
      905    12675    2            CALL VWO$TRANSO(JEBUF);
      906    12676    2         CALL M$WRITE(WRITE_JE) ALTRET(BEAM_BAD_WRJ);
      907    12677    2         VW_OUTCNT#=VW_OUTCNT#+2;
      908    12678    2         END;
      909    12679
      910    12680    2      IF OPTS.MAILINIT.WHO~=' ' THEN DO;
      911    12681    2         JEBUF=CARD(8);
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:26   
      912    12682    2         IF VW_SCRAMBLE# THEN
      913    12683    2            CALL VWO$TRANSO(JEBUF);
      914    12684    2         CALL M$WRITE(WRITE_JE) ALTRET(BEAM_BAD_WRJ);
      915    12685    2         JEBUF=CARD(9);
      916    12686    2         IF VW_SCRAMBLE# THEN
      917    12687    2            CALL VWO$TRANSO(JEBUF);
      918    12688    2         CALL M$WRITE(WRITE_JE) ALTRET(BEAM_BAD_WRJ);
      919    12689    2         VW_OUTCNT#=VW_OUTCNT#+2;
      920    12690    2         END;
      921    12691
      922    12692        /****
      923    12693        *
      924    12694        *   Send the character-transparency test pattern.
      925    12695        *
      926    12696        ****/
      927    12697
      928    12698    1      JEBUF = ' ';
      929    12699    1      ADDR(JEBUF) -> OPTSCHAR.CMD = 'OPTS';
      930    12700    1      ADDR(JEBUF) -> OPTSCHAR.SUB = 'CHAR';
      931    12701    1      ADDR(JEBUF) -> OPTSCHAR.PATTERN = %VW_PATTERN#;
      932    12702    1      IF VW_SCRAMBLE# THEN
      933    12703    1         CALL VWO$TRANSO (JEBUF);
      934    12704    1      CALL M$WRITE (WRITE_JE) ALTRET (BEAM_BAD_WRJ);
      935    12705    1      VW_OUTCNT# = VW_OUTCNT# + 1;
      936    12706
      937    12707        /****
      938    12708        *
      939    12709        *   Send the file's FIT.
      940    12710        *
      941    12711        ****/
      942    12712
      943    12713    1      INPLIM=4*ADDR(FITBUF)->FM$FIT.CODES.NDW(0);
      944    12714    1      CALL FORMAT(FITBUF,INPLIM,INPLIM,'0'B,'1'B) ALTRET(BEAM_BAD_WRJ);
      945    12715
      946    12716        /****
      947    12717        *
      948    12718        *   Set up the switches according to file type and check that the
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:27   
      949    12719        *   file being transported is legal to go to this node.
      950    12720        *
      951    12721        ****/
      952    12722
      953    12723    2      DO CASE(FILEORG);
      954    12724
      955    12725        /****
      956    12726        *
      957    12727        *   Consecutive (and perversions thereof):  No keys, up to 1MB records,
      958    12728        *   no TSTAMP.
      959    12729        *
      960    12730        ****/
      961    12731
      962    12732    2        CASE(%CONSEC#,%UR#,%INDEXED#,%TERMINAL#,%IREL#);
      963    12733    2         READ_INP.V.KEYR#='0'B;
      964    12734    2         READ_INP.BUF_.BOUND=32767;
      965    12735    2         READ_INP.V.FULL#='0'B;
      966    12736
      967    12737        /****
      968    12738        *
      969    12739        *   Keyed files:  Keys, up to 1MB records, no TSTAMP.
      970    12740        *
      971    12741        ****/
      972    12742
      973    12743    2        CASE(%KEYED#);
      974    12744    2         READ_INP.V.KEYR#='1'B;
      975    12745    2         READ_INP.KEY_=VECTOR(KEYBUF);
      976    12746    2         READ_INP.BUF_.BOUND=32767;
      977    12747    2         READ_INP.V.FULL#='0'B;
      978    12748
      979    12749        /****
      980    12750        *
      981    12751        *   Random:  (sort of) keys, 4092-byte records, no TSTAMP.
      982    12752        *
      983    12753        ****/
      984    12754
      985    12755    2        CASE(%RANDOM#);
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:28   
      986    12756    2         READ_INP.V.KEYR#='1'B;
      987    12757    2         READ_INP.KEY_=VECTOR(RANREL);
      988    12758    2         READ_INP.BUF_.BOUND=4091;
      989    12759    2         READ_INP.V.FULL#='0'B;
      990    12760
      991    12761        /****
      992    12762        *
      993    12763        *   Relative:  (sort of) keys, up to 1MB records, no TSTAMP.
      994    12764        *
      995    12765        ****/
      996    12766
      997    12767    2        CASE(%RELATIVE#);
      998    12768    2         READ_INP.V.KEYR#='1'B;
      999    12769    2         READ_INP.KEY_=VECTOR(RANREL);
     1000    12770    2         READ_INP.BUF_.BOUND=INPPTR->DUMMY.RECL#-1;
     1001    12771    2         IF READ_INP.BUF_.BOUND>32767 THEN
     1002    12772    2            READ_INP.BUF_.BOUND=32767;
     1003    12773    2         READ_INP.V.FULL#='0'B;
     1004    12774
     1005    12775        /****
     1006    12776        *
     1007    12777        *   IDS:  (sort of) keys, 4096-byte records, TSTAMP.
     1008    12778        *
     1009    12779        ****/
     1010    12780
     1011    12781    2        CASE(%IDS#);
     1012    12782    2         READ_INP.V.KEYR#='1'B;
     1013    12783    2         READ_INP.KEY_=VECTOR(RANREL);
     1014    12784    2         READ_INP.BUF_.BOUND=4095;
     1015    12785    2         READ_INP.V.FULL#='1'B;
     1016    12786
     1017    12787        /****
     1018    12788        *
     1019    12789        *   All the weird tape file orgs aren't valid.
     1020    12790        *
     1021    12791        ****/
     1022    12792
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:29   
     1023    12793    2        CASE(ELSE);
     1024    12794    2         GOTO BEAM_BAD_ORG;
     1025    12795
     1026    12796    2        END;
     1027    12797
     1028    12798        /****
     1029    12799        *
     1030    12800        *   Read and write until EOF.
     1031    12801        *
     1032    12802        ****/
     1033    12803
     1034    12804    1   BEAM_IGNORE:
     1035    12805    2      DO WHILE('1'B);
     1036    12806    2         READ_INP.V.DVBYTE.CONT#='0'B;
     1037    12807    2         INPLIM=0;
     1038    12808    2         ITSBIN='0'B;
     1039    12809    3         CALL M$READ(READ_INP) WHENALTRETURN DO;
     1040    12810
     1041    12811        /****
     1042    12812        *
     1043    12813        *   Oops, something bad happened.  This may be EOF or LD.
     1044    12814        *
     1045    12815        ****/
     1046    12816
     1047    12817    3   BEAM_BAD_FM1:
     1048    12818    3            IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE=%E$EOT OR
     1049    12819    3              B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE=%E$EOF OR
     1050    12820    3              B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE=%E$EOD THEN
     1051    12821    3               GOTO BEAM_INP_EOF;
     1052    12822    3            IF (FILEORG=%IDS# OR FILEORG=%RANDOM#) AND
     1053    12823    4              B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE=%E$DI THEN DO;
     1054    12824    4               RECSCOUNT=RECSCOUNT+1;
     1055    12825    4               GOTO BEAM_IGNORE;
     1056    12826    4               END;
     1057    12827    3            IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE~=%E$LD THEN
     1058    12828    3               GOTO BEAM_BAD_INE;
     1059    12829    3            ARS=INPPTR->DUMMY.ARS#;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:30   
     1060    12830    3            INPLIM=INPLIM+ARS;
     1061    12831    3            CALL SEARCH(I,J,BADCHARS,SUBSTR(INPBUF.C,0,ARS));
     1062    12832    3            IF J>0 THEN
     1063    12833    3               ITSBIN='1'B;
     1064    12834    3            READ_INP.V.DVBYTE.CONT#='1'B;
     1065    12835    3            CALL M$READ(READ_INP) ALTRET(BEAM_BAD_FM1);
     1066    12836    3            END;
     1067    12837    2         RECSCOUNT=RECSCOUNT+1;
     1068    12838
     1069    12839        /****
     1070    12840        *
     1071    12841        *   Process the NSC option by ignoring schema records.
     1072    12842        *
     1073    12843        ****/
     1074    12844
     1075    12845    2         IF NSC AND FILEORG=%KEYED# AND KEYBUF.L>=7 AND ASCBIT(SUBSTR
     1076    12846    2           (KEYBUF.C,0,1))='777'O AND ASCBIN(SUBSTR(KEYBUF.C,5,1))>=11
     1077    12847    2           AND ASCBIN(SUBSTR(KEYBUF.C,5,1))<=15 THEN
     1078    12848    2            GOTO BEAM_SKIP;
     1079    12849
     1080    12850        /****
     1081    12851        *
     1082    12852        *   Process the record selections.  Note that we don't send the
     1083    12853        *   records in the order the user specified.
     1084    12854        *
     1085    12855        ****/
     1086    12856
     1087    12857    3         IF RECX>0 THEN DO;
     1088    12858    3            I=0;
     1089    12859    4            DO WHILE(I<RECX);
     1090    12860    4               IF RECSCOUNT>=RECS.LO(I) AND RECSCOUNT<=RECS.HI(I) THEN
     1091    12861    4                  I=RECX;
     1092    12862    4               I=I+1;
     1093    12863    4               END;
     1094    12864    3            IF I=RECX THEN
     1095    12865    3               GOTO BEAM_SKIP;
     1096    12866    3            END;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:31   
     1097    12867
     1098    12868        /****
     1099    12869        *
     1100    12870        *   Process keys for keyed files (or perversions thereof).
     1101    12871        *
     1102    12872        ****/
     1103    12873
     1104    12874    3         IF FILEORG=%KEYED# THEN DO;
     1105    12875    3            K=KEYBUF.L;
     1106    12876    3            VW_INPCNT#=VW_INPCNT#+K+4;
     1107    12877    3            CALL SEARCH(I,J,BADCHARS,SUBSTR(KEYBUF.C,0,K));
     1108    12878    3            IF J>0 THEN
     1109    12879    3               CALL FORMAT(KEYBUF.C,K,K,'0'B,'1'B) ALTRET(BEAM_BAD_WRJ);
     1110    12880    3              ELSE
     1111    12881    3               CALL FORMAT(KEYBUF.C,K,K,'0'B,'0'B) ALTRET(BEAM_BAD_WRJ);
     1112    12882    3            END;
     1113    12883    2           ELSE IF FILEORG=%RANDOM# OR FILEORG=%RELATIVE# OR FILEORG=%IDS# THEN
     1114    12884    2               CALL FORMAT(RANREL,4,4,'0'B,'1'B) ALTRET(BEAM_BAD_WRJ);
     1115    12885    2         JEIDX=JEIDX+1;
     1116    12886    2         IF JEIDX>79 THEN
     1117    12887    2            CALL STUFF ALTRET(BEAM_BAD_WRJ);
     1118    12888
     1119    12889        /****
     1120    12890        *
     1121    12891        *   Process DVBYTE.
     1122    12892        *
     1123    12893        ****/
     1124    12894
     1125    12895    2         CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+BITBIN('00111000'B&
     1126    12896    2           INPPTR->DUMMY.DVBYTE)));
     1127    12897
     1128    12898        /****
     1129    12899        *
     1130    12900        *   Now process record contents.
     1131    12901        *
     1132    12902        ****/
     1133    12903
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:32   
     1134    12904    2         SOMETHING='1'B;
     1135    12905    2         ARS=INPPTR->DUMMY.ARS#;
     1136    12906    2         INPLIM=INPLIM+ARS;
     1137    12907    2         CALL SEARCH(I,J,BADCHARS,SUBSTR(INPBUF.C,0,ARS));
     1138    12908    2         IF J>0 THEN
     1139    12909    2            ITSBIN='1'B;
     1140    12910
     1141    12911        /****
     1142    12912        *
     1143    12913        *   If the record was too big to fit in the buffer, we have to back
     1144    12914        *   up and reread it a chunk at a time.  Note that this doesn't work
     1145    12915        *   for compressed files.
     1146    12916        *
     1147    12917        ****/
     1148    12918
     1149    12919    3         IF ARS<INPLIM THEN DO;
     1150    12920    3            CALL M$PRECORD(PRECORD_INP);
     1151    12921    3            READ_INP.V.DVBYTE.CONT#='0'B;
     1152    12922    4            CALL M$READ(READ_INP) WHENALTRETURN DO;
     1153    12923
     1154    12924        /****
     1155    12925        *
     1156    12926        *   Something bad happened.  It might be EOF or LD, though.
     1157    12927        *
     1158    12928        ****/
     1159    12929
     1160    12930    4   BEAM_BAD_FM2:
     1161    12931    4               IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE~=%E$LD THEN
     1162    12932    4                  GOTO BEAM_BAD_INE;
     1163    12933    4               ARS=INPPTR->DUMMY.ARS#;
     1164    12934    4               CALL FORMAT(INPBUF,ARS,INPLIM,READ_INP.V.DVBYTE.CONT#,ITSBIN)
     1165    12935    4                 ALTRET(BEAM_BAD_WRJ);
     1166    12936    4               READ_INP.V.DVBYTE.CONT#='1'B;
     1167    12937    4               CALL M$READ(READ_INP) ALTRET(BEAM_BAD_FM2);
     1168    12938    4               END;
     1169    12939    3            END;
     1170    12940    2         ARS=INPPTR->DUMMY.ARS#;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:33   
     1171    12941    2         CALL FORMAT(INPBUF,ARS,INPLIM,READ_INP.V.DVBYTE.CONT#,ITSBIN)
     1172    12942    2           ALTRET(BEAM_BAD_WRJ);
     1173    12943
     1174    12944        /****
     1175    12945        *
     1176    12946        *   Tally bytes sent, check to see if BREAK was hit, check CG read.
     1177    12947        *
     1178    12948        ****/
     1179    12949
     1180    12950    2   BEAM_SKIP:
     1181    12951    2         VW_INPCNT#=VW_INPCNT#+INPLIM+4;
     1182    12952    2         IF VW_BROKEN#>0 THEN
     1183    12953    2            CALL VWR$BREAK ALTRET(BEAM_ABORT);
     1184    12954
     1185    12955        /****
     1186    12956        *
     1187    12957        *   This module is part of MAIL, too.  If it is, check periodically to
     1188    12958        *   see if we need to read the comgroup.
     1189    12959        *
     1190    12960        ****/
     1191    12961
     1192    12962    2         IF ADDR(CHECKCG)~=ADDR(NIL) AND MOD(VW_INPCNT#,256)=0 THEN
     1193    12963    2            CALL CHECKCG;
     1194    12964
     1195    12965    2         END /* of read/write loop */;
     1196    12966
     1197    12967        /****
     1198    12968        *
     1199    12969        *   We made it to EOF, so close up and go home.
     1200    12970        *
     1201    12971        ****/
     1202    12972
     1203    12973    1   BEAM_INP_EOF:
     1204    12974
     1205    12975        /****
     1206    12976        *
     1207    12977        *   Finish out the last partial record, if necessary.
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:34   
     1208    12978        *
     1209    12979        ****/
     1210    12980
     1211    12981    1      JEIDX=JEIDX+1;
     1212    12982    1      CALL STUFF ALTRET(BEAM_BAD_WRJ);
     1213    12983    1      CALL M$CLOSE(CLOSE_INP);
     1214    12984
     1215    12985        /****
     1216    12986        *
     1217    12987        *   Supply appropriate footer information.
     1218    12988        *
     1219    12989        ****/
     1220    12990
     1221    12991    1      I=NODEOVR.TYPE_PATH;
     1222    12992    1      CALL VWF$FOOTER(DCBNUM(M$JE),JEBUF,I) ALTRET(BEAM_BAD_WRJ);
     1223    12993    1      CLOSE_JE.V.DISP#=%SAVE#;
     1224    12994    1      CALL M$CLOSE(CLOSE_JE) ALTRET(BEAM_BAD_INE);
     1225    12995
     1226    12996        /****
     1227    12997        *
     1228    12998        *   For intrasystem beaming, simply tell the user that the file has
     1229    12999        *   been transferred;  there's no transmission time involved.
     1230    13000        *
     1231    13001        ****/
     1232    13002
     1233    13003    1      IF INTRASHIP
     1234    13004    2        THEN DO;
     1235    13005    2         CALL VWX$MAIL (%E$VWM_INTRABEAM);
     1236    13006    2         GOTO REPORT_SENT;
     1237    13007    2         END;
     1238    13008
     1239    13009        /****
     1240    13010        *
     1241    13011        *   Determine the status of the packet and tell the user.
     1242    13012        *
     1243    13013        ****/
     1244    13014
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:35   
     1245    13015    2      IF ADDR(CHECKCG)=ADDR(NIL) THEN DO;
     1246    13016    2         TWORK=SUBSTR(JEPTR->DUMMY.NAME#.C,3,12);
     1247    13017    2         I=0;
     1248    13018    3         DO WHILE(SUBSTR(TWORK,I,1)='0');
     1249    13019    3            I=I+1;
     1250    13020    3            END;
     1251    13021    2         J=6;
     1252    13022    3         DO WHILE(SUBSTR(TWORK,J,1)='0' AND J<11);
     1253    13023    3            J=J+1;
     1254    13024    3            END;
     1255    13025    2         CALL CONCAT(U4.C,SUBSTR(TWORK,I,6-I),'-',SUBSTR(TWORK,J,12-J));
     1256    13026    2         U4.L=19-I-J;
     1257    13027
     1258    13028        /****
     1259    13029        *
     1260    13030        *   We must wait for a second to allow PRESCAN to get its act together.
     1261    13031        *
     1262    13032        ****/
     1263    13033
     1264    13034    2         CALL CHARBIN(I,SUBSTR(JEPTR->DUMMY.NAME#.C,3,6));
     1265    13035    2         FPT_JOBSTATS.V.SYSID#=I;
     1266    13036    2         CALL CHARBIN(I,SUBSTR(JEPTR->DUMMY.NAME#.C,9,6));
     1267    13037    2         FPT_JOBSTATS.V.NUM#=I;
     1268    13038    2         CALL M$WAIT(FPT_WAIT);
     1269    13039    2         VLP_CRITERIA.WSN#=OPTS.OUT.NODE;
     1270    13040    2         CALL M$JOBSTATS(FPT_JOBSTATS);
     1271    13041
     1272    13042        /****
     1273    13043        *
     1274    13044        *   Compute the approximate time of transmission.  This is a real fudge.
     1275    13045        *
     1276    13046        ****/
     1277    13047
     1278    13048    2         I=(VW_OUTCNT#*84*NODEOVR.TIME+4096)/4096;
     1279    13049    3         IF I>=60000 THEN DO;
     1280    13050    3            TWORK=' hours.';
     1281    13051    3            I=I/3600;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:36   
     1282    13052    3            END;
     1283    13053    3           ELSE IF I>=1000 THEN DO;
     1284    13054    3               TWORK=' minutes.';
     1285    13055    3               I=I/60;
     1286    13056    3               END;
     1287    13057    2              ELSE
     1288    13058    2               TWORK=' seconds.';
     1289    13059    2         CALL BINCHAR(DWORK,I);
     1290    13060    2         I=0;
     1291    13061    3         DO WHILE(I<6 AND SUBSTR(DWORK,I,1)='0');
     1292    13062    3            I=I+1;
     1293    13063    3            END;
     1294    13064    2         CALL CONCAT(U6.C,SUBSTR(DWORK,I,7-I),'.',SUBSTR(DWORK,7,1),TWORK);
     1295    13065    2         U6.L=24-I;
     1296    13066
     1297    13067        /****
     1298    13068        *
     1299    13069        *   Determine the status of the packet.  If it was real small and the
     1300    13070        *   system is running pretty quick, it may be lost by JOBSTATS.
     1301    13071        *
     1302    13072        ****/
     1303    13073
     1304    13074    3         IF VLR_JOBSTATS_CHECK.FCODE=%FS_PWAIT# THEN DO;
     1305    13075    3            CALL BINCHAR(DWORK,VLR_JOBSTATS_CHECK.AHEAD);
     1306    13076    3            K=0;
     1307    13077    4            DO WHILE(K<7 AND SUBSTR(DWORK,K,1)='0');
     1308    13078    4               K=K+1;
     1309    13079    4               END;
     1310    13080    3            U5.C=SUBSTR(DWORK,K,8-K);
     1311    13081    3            U5.L=8-K;
     1312    13082    3            CALL VWX$MAIL(%E$VWM_XWT,VECTOR(U4),VECTOR(U5),VECTOR(U6));
     1313    13083    3            END;
     1314    13084    3           ELSE IF VLR_JOBSTATS_CHECK.FCODE=%FS_PRT# THEN DO;
     1315    13085    3               U5.C=VLR_JOBSTATS_CHECK.DEVNAME;
     1316    13086    3               U5.L=4;
     1317    13087    3               CALL VWX$MAIL(%E$VWM_XMT,VECTOR(U4),VECTOR(U5),VECTOR(U6));
     1318    13088    3               END;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:37   
     1319    13089    3              ELSE DO;
     1320    13090    3               CALL VWX$MAIL(%E$VWM_XBB,VECTOR(U4),VECTOR(U6));
     1321    13091    3               END;
     1322    13092    2         END;
     1323    13093
     1324    13094        /****
     1325    13095        *
     1326    13096        *   If we're SCOTTY, tell that we've sent the file.
     1327    13097        *
     1328    13098        ****/
     1329    13099
     1330    13100    1   REPORT_SENT:
     1331    13101    1      IF B$JIT.MODE=%M_GHOST# THEN
     1332    13102    1         CALL VWX$MAIL(%E$VWM_SNT,VECTOR(U1),VECTOR(U2),VECTOR(U3));
     1333    13103
     1334    13104        /****
     1335    13105        *
     1336    13106        *   Count the file, then do another if wildcarded.
     1337    13107        *
     1338    13108        ****/
     1339    13109
     1340    13110    1      FILECOUNT=FILECOUNT+1;
     1341    13111    1      IF MULTIPLE THEN
     1342    13112    1         GOTO BEAM_NEXT_FILE;
     1343    13113    1      RETURN;
     1344    13114
     1345    13115        /****
     1346    13116        *
     1347    13117        *   The input file name was too long.
     1348    13118        *
     1349    13119        ****/
     1350    13120
     1351    13121    1   BEAM_BAD_ITL:
     1352    13122    1      ERRCODE=%E$VWM_ITL;
     1353    13123    1      GOTO BEAM_USRERR;
     1354    13124
     1355    13125        /****
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:38   
     1356    13126        *
     1357    13127        *   The input file name was invalid.
     1358    13128        *
     1359    13129        ****/
     1360    13130
     1361    13131    1   BEAM_BAD_INP:
     1362    13132    1      ERRCODE=%E$VWM_INP;
     1363    13133    1      GOTO BEAM_USRERR;
     1364    13134
     1365    13135        /****
     1366    13136        *
     1367    13137        *   The output file name was too long.
     1368    13138        *
     1369    13139        ****/
     1370    13140
     1371    13141    1   BEAM_BAD_OTL:
     1372    13142    1      ERRCODE=%E$VWM_OTL;
     1373    13143    1      GOTO BEAM_USRERR;
     1374    13144
     1375    13145        /****
     1376    13146        *
     1377    13147        *   The output file name was invalid.
     1378    13148        *
     1379    13149        ****/
     1380    13150
     1381    13151    1   BEAM_BAD_OUT:
     1382    13152    1      ERRCODE=%E$VWM_OUT;
     1383    13153    1      GOTO BEAM_USRERR;
     1384    13154
     1385    13155        /****
     1386    13156        *
     1387    13157        *   Sorry, can't MOVE this file type.
     1388    13158        *
     1389    13159        ****/
     1390    13160
     1391    13161    1   BEAM_BAD_ORG:
     1392    13162    1      ERRCODE=%E$VWM_ORG;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:39   
     1393    13163    1      GOTO BEAM_USRERR;
     1394    13164
     1395    13165        /****
     1396    13166        *
     1397    13167        *   Destination node is undefined.
     1398    13168        *
     1399    13169        ****/
     1400    13170
     1401    13171    1   BEAM_BAD_DST:
     1402    13172    1      ERRCODE=%E$VWM_DND;
     1403    13173    1      GOTO BEAM_USRERR;
     1404    13174
     1405    13175        /****
     1406    13176        *
     1407    13177        *   Wildcarding error.
     1408    13178        *
     1409    13179        ****/
     1410    13180
     1411    13181    1   BEAM_BAD_WLD:
     1412    13182    1      ERRCODE=%E$VWM_WLD;
     1413    13183    1      GOTO BEAM_USRERR;
     1414    13184
     1415    13185        /****
     1416    13186        *
     1417    13187        *   Monitor error opening/reading :NODES.
     1418    13188        *
     1419    13189        ****/
     1420    13190
     1421    13191    1   BEAM_BAD_NODE:
     1422    13192    1      ERRDCB=DCBNUM(M$JE);
     1423    13193    1      GOTO BEAM_SYSERR;
     1424    13194
     1425    13195        /****
     1426    13196        *
     1427    13197        *   Input file read error (except LD or EOF).
     1428    13198        *
     1429    13199        ****/
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:40   
     1430    13200
     1431    13201    1   BEAM_BAD_INE:
     1432    13202    1      ERRDCB=DCBNUM(M$INP);
     1433    13203    1      GOTO BEAM_SYSERR;
     1434    13204
     1435    13205        /****
     1436    13206        *
     1437    13207        *   Error writing JE file.
     1438    13208        *
     1439    13209        ****/
     1440    13210
     1441    13211    1   BEAM_BAD_WRJ:
     1442    13212    1      ERRDCB=DCBNUM(M$JE);
     1443    13213    1      GOTO BEAM_SYSERR;
     1444    13214
     1445    13215        /****
     1446    13216        *
     1447    13217        *   Error opening input file.  Check for file busy.
     1448    13218        *
     1449    13219        ****/
     1450    13220
     1451    13221    1   BEAM_BAD_FMF:
     1452    13222    1      ERRDCB=DCBNUM(M$INP);
     1453    13223    1      ERRBITS=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
     1454    13224    1      ERRBITS.SEV=0;
     1455    13225    1      IF ERRBITS.CODE~=%E$FILEBUSY AND ERRBITS.CODE~=%E$NONEWU AND
     1456    13226    1        ERRBITS.CODE~=%E$SETDOWN AND ERRBITS.CODE~=%E$XCLSET THEN
     1457    13227    1         GOTO BEAM_SYSERR;
     1458    13228    1      CALL VWX$MAIL(%E$VWM_BSY);
     1459    13229    1      OPTS.MAILINIT.CMD='BUSY';
     1460    13230    1      GOTO BEAM_ABORT;
     1461    13231
     1462    13232        /****
     1463    13233        *
     1464    13234        *   A user-land error has occurred.
     1465    13235        *
     1466    13236        ****/
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:41   
     1467    13237
     1468    13238    1   BEAM_USRERR:
     1469    13239    1      CALL VWX$MAIL(ERRCODE);
     1470    13240    1      GOTO BEAM_ABORT;
     1471    13241
     1472    13242        /****
     1473    13243        *
     1474    13244        *   A monitor error has occurred.
     1475    13245        *
     1476    13246        ****/
     1477    13247
     1478    13248    1   BEAM_SYSERR:
     1479    13249    1      ERRBITS=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
     1480    13250    1      ERRBITS.SEV=0;
     1481    13251    1      CALL VWX$MAIL(ERRCODE,,,,ERRDCB);
     1482    13252    1      GOTO BEAM_ABORT;
     1483    13253
     1484    13254        /****
     1485    13255        *
     1486    13256        *   Disaster!  Close the input file; if the output file is still
     1487    13257        *   open, close and release it.
     1488    13258        *
     1489    13259        ****/
     1490    13260
     1491    13261    1   BEAM_ABORT:
     1492    13262    1      IF INPPTR->DUMMY.FCD# THEN
     1493    13263    1         CALL M$CLOSE(CLOSE_INP);
     1494    13264    1      CLOSE_JE.V.DISP#=%RELEASE#;
     1495    13265    1      IF JEPTR->DUMMY.FCD# THEN
     1496    13266    1         CALL M$CLOSE(CLOSE_JE);
     1497    13267    1      IF MULTIPLE THEN
     1498    13268    1         GOTO BEAM_NEXT_FILE;
     1499    13269    1      ALTRETURN;
     1500    13270
     1501    13271        /****
     1502    13272        *
     1503    13273        *   Supply appropriate text for wildcarded MOVEs.
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:42   
     1504    13274        *
     1505    13275        ****/
     1506    13276
     1507    13277    1   BEAM_WILD_DONE:
     1508    13278    2      DO CASE(FILECOUNT);
     1509    13279    2        CASE(0);
     1510    13280    2         CALL VWX$MAIL(%E$VWM_NTT);
     1511    13281    2        CASE(1);
     1512    13282    2         ;
     1513    13283    2        CASE(ELSE);
     1514    13284    2         CALL BINCHAR(DWORK,FILECOUNT);
     1515    13285    2         I=0;
     1516    13286    3         DO WHILE(SUBSTR(DWORK,I,1)='0');
     1517    13287    3            I=I+1;
     1518    13288    3            END;
     1519    13289    2         U1.C=SUBSTR(DWORK,I,8-I);
     1520    13290    2         U1.L=8-I;
     1521    13291    2         CALL VWX$MAIL(%E$VWM_NFT,VECTOR(U1));
     1522    13292    2        END;
     1523    13293    1      RETURN;
     1524    13294
     1525    13295        %EJECT;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:43   
     1526    13296    1   FIDDLE_FIT: PROC ALTRET;
     1527    13297        /*I*  NAME: FIDDLE_FIT
     1528    13298              CALL: CALL FIDDLE_FIT ALTRET (trouble);
     1529    13299              INPUT: OPTS contains the options for the move;  FITBUF contains the
     1530    13300                    input file's FIT.
     1531    13301              OUTPUT: On a successful return, all significant information in OPTS will
     1532    13302                    have been transferred into the "processor attributes" data area
     1533    13303                    in the FITBUF;  the OPTS.OUT will have been modified so that
     1534    13304                    SCOTTY on the receiving system will materialize a randomly-named
     1535    13305                    file in the appropriate external-transport directory.
     1536    13306              DESCRIPTION: This procedure is called when a file is being MOVEd to
     1537    13307                    an external node via a CP-6 disk directory.  It records all of
     1538    13308                    the significant information & options from the MOVE in such a way
     1539    13309                    that the installation's custom file-exporting package can access
     1540    13310                    it, and directs SCOTTY to materialize the file in a randomly-named
     1541    13311                    location in the directory account.
     1542    13312        */
     1543    13313    2   DCL FITCARD                                                (0:24) CHAR (80);
     1544    13314    2   DCL FITWORD (0:499) REDEF FITCARD UBIN WORD;
     1545    13315    2   DCL SIZE_NEEDED UBIN;
     1546    13316    2   DCL CODES SBIN;
     1547    13317    2   DCL CODE SBIN;
     1548    13318    2   DCL LOW SBIN;
     1549    13319    2   DCL HIGH SBIN;
     1550    13320    2   DCL FREE SBIN;
     1551    13321    2   DCL I SBIN;
     1552    13322    2   DCL OFFSET SBIN;
     1553    13323    2   DCL EPASS CHAR(12) STATIC;
     1554    13324    2   DCL BIT9(0:11) REDEF EPASS UBIN BYTE UNAL;
     1555    13325    2   DCL PASSWORD CHAR(8) STATIC;
     1556    13326    2   DCL BIT6(0:11) REDEF PASSWORD UBIN(6) UNAL;
     1557    13327
     1558    13328    2      SIZE_NEEDED = 0;
     1559    13329
     1560    13330    3      DO I = 1 TO LENGTHC(CARD)/LENGTHC(CARD(0)) - 1;
     1561    13331    3         IF SUBSTR (CARD(I), 0, 4) ~= ' '
     1562    13332    4           THEN DO;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:44   
     1563    13333    4            FITCARD(SIZE_NEEDED) = CARD(I);
     1564    13334    4            SIZE_NEEDED = SIZE_NEEDED + 1;
     1565    13335    4            END;
     1566    13336
     1567    13337    3         END;
     1568    13338
     1569    13339    2      SIZE_NEEDED = SIZE_NEEDED * SIZEW(FITCARD(0));
     1570    13340
     1571    13341    2      CODES = ADDR(FITBUF) -> FM$FIT.CODES.CODE(0);   /* # of sections */
     1572    13342    2      LOW = ADDR(FITBUF) -> FM$FIT.CODES.NDW(0);      /* total size of FPARAM */
     1573    13343    2      FREE = -1;
     1574    13344
     1575    13345    3      DO CODE = 1 TO CODES;
     1576    13346
     1577    13347    3         LOW = MINIMUM (ADDR(FITBUF) -> FM$FIT.CODES.ITEMX(CODE), LOW);
     1578    13348
     1579    13349    4         DO CASE (ADDR(FITBUF) -> FM$FIT.CODES.CODE(CODE));
     1580    13350
     1581    13351    4           CASE (0, 5, 6, 13);
     1582    13352
     1583    13353    4            ADDR(FITBUF) -> FM$FIT.CODES.CODE(CODE) = 0;
     1584    13354
     1585    13355    4            IF FREE < 0 OR ADDR(FITBUF) -> FM$FIT.CODES.NAW(CODE) >
     1586    13356    4              ADDR(FITBUF) -> FM$FIT.CODES.NAW(FREE)
     1587    13357    4              THEN
     1588    13358    4               FREE = CODE;
     1589    13359
     1590    13360    4           CASE (ELSE);
     1591    13361    4           END;
     1592    13362
     1593    13363    3         END;
     1594    13364
     1595    13365    2      IF FREE < 0
     1596    13366    3        THEN DO;
     1597    13367        /*
     1598    13368              Well, we found no free FPARAM entry at all; we'll have to add one.
     1599    13369        */
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:45   
     1600    13370    3         IF LOW <= CODES
     1601    13371    4           THEN DO;
     1602    13372        /*
     1603    13373              Uggh!  The data starts right immediately after the end of the FM$FIT
     1604    13374              area;  we'll have to push the data up one word and increment all the
     1605    13375              ITEMX values in the FM$FIT.
     1606    13376        */
     1607    13377    5            DO I = ADDR(FITBUF) -> FM$FIT.CODES.NDW(0) - 1 DOWNTO LOW BY -1;
     1608    13378    5               FITBUF(I+1) = FITBUF(I);
     1609    13379    5               END;
     1610    13380    5            DO I = 1 TO CODES;
     1611    13381    5               ADDR(FITBUF) -> FM$FIT.CODES.ITEMX(I) =
     1612    13382    5                 ADDR(FITBUF) -> FM$FIT.CODES.ITEMX(I) + 1;
     1613    13383    5               END;
     1614    13384    4            ADDR(FITBUF) -> FM$FIT.CODES.NDW(0) = ADDR(FITBUF) ->
     1615    13385    4              FM$FIT.CODES.NDW(0) + 1;
     1616    13386    4            LOW = LOW + 1;
     1617    13387
     1618    13388    4            END;
     1619    13389        /*
     1620    13390           Record the creation of a new FM$FIT.CODE
     1621    13391        */
     1622    13392    3         CODES = CODES + 1;
     1623    13393    3         FREE = CODES;
     1624    13394    3         ADDR(FITBUF) -> FM$FIT.CODES.CODE(0) = CODES;
     1625    13395    3         ADDR(FITBUF) -> FM$FIT.CODES.NAW(FREE) = 0;
     1626    13396
     1627    13397    3         END;
     1628    13398
     1629    13399        /*
     1630    13400           Check to see whether the largest free entry has enough space to hold
     1631    13401           the FITCARD stuff.
     1632    13402        */
     1633    13403
     1634    13404    2      IF ADDR(FITBUF) -> FM$FIT.CODES.NAW(FREE) < SIZE_NEEDED
     1635    13405    3        THEN DO;
     1636    13406
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:46   
     1637    13407        /*
     1638    13408              Nope; have to allocate a new block at the end of the existing FITBUF.
     1639    13409              Make sure that there's enough space left at the end to hold all of
     1640    13410              the option cards.
     1641    13411        */
     1642    13412    3         IF ADDR(FITBUF) -> FM$FIT.CODES.NDW(0) + SIZE_NEEDED >= SIZEW(FITBUF)
     1643    13413    4           THEN DO;
     1644    13414    4            ERRCODE = %E$VWM_FITFULL;
     1645    13415    4            ALTRETURN;
     1646    13416    4            END;
     1647    13417        /*
     1648    13418              Point the FIT entry to the new space, and reserve it.
     1649    13419        */
     1650    13420    3         ADDR(FITBUF) -> FM$FIT.CODES.NAW(FREE) = SIZE_NEEDED;
     1651    13421    3         ADDR(FITBUF) -> FM$FIT.CODES.ITEMX(FREE) =
     1652    13422    3           ADDR(FITBUF) -> FM$FIT.CODES.NDW(0);
     1653    13423    3         ADDR(FITBUF) -> FM$FIT.CODES.NDW(0) =
     1654    13424    3           ADDR(FITBUF) -> FM$FIT.CODES.NDW(0) + SIZE_NEEDED;
     1655    13425    3         END;
     1656    13426        /*
     1657    13427           Update the code and words-in-use fields.
     1658    13428        */
     1659    13429    2      ADDR(FITBUF) -> FM$FIT.CODES.CODE(FREE) = 13; /* processor attr. */
     1660    13430    2      ADDR(FITBUF) -> FM$FIT.CODES.NDW(FREE) = SIZE_NEEDED;
     1661    13431        /*
     1662    13432              Move the option cards into the FITBUF.
     1663    13433        */
     1664    13434    2      OFFSET = ADDR(FITBUF) -> FM$FIT.CODES.ITEMX(FREE);
     1665    13435    3      DO I = 0 TO SIZE_NEEDED - 1;
     1666    13436    3         FITBUF(OFFSET+I) = FITWORD(I);
     1667    13437    3         END;
     1668    13438        /*
     1669    13439              Tweak the information in the outgoing header packets.  Redirect the
     1670    13440              file to a randomly-named fid in the appropriate directory, and use
     1671    13441              the standard MAIL authorization to materialize it there.
     1672    13442        */
     1673    13443    2      OPTS.OUT.ACCT = VO_INTERSYS_ACCT;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:47   
     1674    13444    2      OPTS.OUT.NAME = VO_INTERSYS_NAME;
     1675    13445    2      PASSWORD = VO_INTERSYS_PASSWORD;
     1676    13446    2      CALL ASZ$SCRAMBLE (PASSWORD);
     1677    13447    3      DO I = 0 TO 11;
     1678    13448    3         BIT9(I) = BIT6(I) + ASCBIN(' ');
     1679    13449    3         END;
     1680    13450    2      OPTS.OUT.EPASS = EPASS;
     1681    13451    2      OPTS.OUT.NODE = EXTERNAL.SITENAME;
     1682    13452    2      OPTS.MAILSNDR.WHO = ' ';
     1683    13453    2      OPTS.MAILRCVR.WHO = ' ';
     1684    13454    2      OPTS.MAILINIT.WHO = ' ';
     1685    13455    2      CALL M$TIME (CLOCK_TO_UTS);
     1686    13456    2      CALL CONCAT (OPTS.OUT.FID, 'MOVExxxxxxxx', VW_IAM#);
     1687    13457    2      CALL BINCHAR (SUBSTR(OPTS.OUT.FID, 4, 8), TODAY);
     1688    13458    2      CALL INDEX (I, ' ', OPTS.OUT.FID);
     1689    13459    2      CALL INSERT (OPTS.OUT.FID, I, , '.', EXTERNAL.ACCT);
     1690    13460    2      CALL INDEX (I, ' ', OPTS.OUT.FID);
     1691    13461    2      OPTS.OUT.L = I + ASCBIN('/');
     1692    13462
     1693    13463    2      RETURN;
     1694    13464
     1695    13465    2   END FIDDLE_FIT;
     1696    13466        %EJECT;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:48   
     1697    13467        /*I**
     1698    13468        *
     1699    13469        *   NAME:  FORMAT
     1700    13470        *
     1701    13471        *   PURPOSE:
     1702    13472        *       To format a buffer into JEBUF and write it when JEBUF is full.
     1703    13473        *
     1704    13474        *   CALL:
     1705    13475        *       CALL FORMAT(bfr,siz,mxs,cont,binm) ALTRET...
     1706    13476        *
     1707    13477        *   PARAMETERS:
     1708    13478        *       bfr - is the input buffer to be reformatted.  siz - is the size of
     1709    13479        *       bfr.  mxs - is the maximum size of the record, which may exceed siz
     1710    13480        *       and is used only when records are larger than 32K bytes.  cont - is
     1711    13481        *       a bit variable; if FALSE, length bytes are written, otherwise not.
     1712    13482        *       binm - is a bit variable; if TRUE, data are written in 3-for-2 or
     1713    13483        *       "encoded" format.
     1714    13484        *
     1715    13485        *   DATA:
     1716    13486        *       FORMAT uses the global variable JEIDX which points to the last-used
     1717    13487        *       byte in JEBUF.
     1718    13488        *
     1719    13489        *   DESCRIPTION:
     1720    13490        *       FORMAT reformats BFR of length SIZ into JEBUF; maximum record
     1721    13491        *       size is MXS (which may exceed SIZ).  If CONT is false, write
     1722    13492        *       the length control byte(s) and DVBYTE; otherwise, just write
     1723    13493        *       data.  If BINM is true, write the data in 3-for-2 format; else
     1724    13494        *       write it "clear".  ALTRET if an I/O error occurs in STUFF.
     1725    13495        *
     1726    13496        ****/
     1727    13497
     1728    13498    1   FORMAT: PROC(BFR,SIZ,MXS,CONT,BINM) ALTRET;
     1729    13499
     1730    13500    2   DCL BFR                            UNAL CHAR(SIZ);
     1731    13501    2   DCL SIZ                            ALIGNED SBIN;
     1732    13502    2   DCL MXS                            ALIGNED SBIN;
     1733    13503    2   DCL CONT                           UNAL BIT(1);
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:49   
     1734    13504    2   DCL BINM                           UNAL BIT(1);
     1735    13505
     1736    13506    2   DCL EBIT                           SBIN;
     1737    13507    2   DCL I                              SBIN;
     1738    13508    2   DCL J                              SBIN;
     1739    13509
     1740    13510        /****
     1741    13511        *
     1742    13512        *   If not continuing a record, supply the record header.  Note that
     1743    13513        *   this routine does keys as well as data.
     1744    13514        *
     1745    13515        ****/
     1746    13516
     1747    13517    3      IF NOT CONT THEN DO;
     1748    13518    3         IF BINM THEN
     1749    13519    3            EBIT=32;
     1750    13520    3           ELSE
     1751    13521    3            EBIT=0;
     1752    13522
     1753    13523        /****
     1754    13524        *
     1755    13525        *   If the records are bigger than 16384 bytes, we need 4 length bytes.
     1756    13526        *
     1757    13527        ****/
     1758    13528
     1759    13529    4         IF MXS>16384 THEN DO;
     1760    13530    4            JEIDX=JEIDX+1;
     1761    13531    4            IF JEIDX>79 THEN
     1762    13532    4               CALL STUFF ALTRET(FORMAT_ABORT);
     1763    13533    4            CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+28+EBIT+
     1764    13534    4              (MXS-1)/262144));
     1765    13535    4            JEIDX=JEIDX+1;
     1766    13536    4            IF JEIDX>79 THEN
     1767    13537    4               CALL STUFF ALTRET(FORMAT_ABORT);
     1768    13538    4            CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+MOD((MXS-1)/4096,
     1769    13539    4              64)));
     1770    13540    4            JEIDX=JEIDX+1;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:50   
     1771    13541    4            IF JEIDX>79 THEN
     1772    13542    4               CALL STUFF ALTRET(FORMAT_ABORT);
     1773    13543    4            CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+MOD((MXS-1)/64,
     1774    13544    4              64)));
     1775    13545    4            JEIDX=JEIDX+1;
     1776    13546    4            IF JEIDX>79 THEN
     1777    13547    4               CALL STUFF ALTRET(FORMAT_ABORT);
     1778    13548    4            CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+MOD(MXS-1,64)));
     1779    13549    4            END;
     1780    13550
     1781    13551        /****
     1782    13552        *
     1783    13553        *   If the records are 513-16384 bytes, we need three length bytes.
     1784    13554        *
     1785    13555        ****/
     1786    13556
     1787    13557    4           ELSE IF MXS>512 THEN DO;
     1788    13558    4               JEIDX=JEIDX+1;
     1789    13559    4               IF JEIDX>79 THEN
     1790    13560    4                  CALL STUFF ALTRET(FORMAT_ABORT);
     1791    13561    4               CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+24+EBIT+
     1792    13562    4                 (MXS-1)/4096));
     1793    13563    4               JEIDX=JEIDX+1;
     1794    13564    4               IF JEIDX>79 THEN
     1795    13565    4                  CALL STUFF ALTRET(FORMAT_ABORT);
     1796    13566    4               CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+MOD((MXS-1)/64,
     1797    13567    4                 64)));
     1798    13568    4               JEIDX=JEIDX+1;
     1799    13569    4               IF JEIDX>79 THEN
     1800    13570    4                  CALL STUFF ALTRET(FORMAT_ABORT);
     1801    13571    4               CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+MOD(MXS-1,64)));
     1802    13572    4               END;
     1803    13573
     1804    13574        /****
     1805    13575        *
     1806    13576        *   If the records are 17-512 bytes, we need two length bytes.
     1807    13577        *
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:51   
     1808    13578        ****/
     1809    13579
     1810    13580    4              ELSE IF MXS>16 THEN DO;
     1811    13581    4                  JEIDX=JEIDX+1;
     1812    13582    4                  IF JEIDX>79 THEN
     1813    13583    4                     CALL STUFF ALTRET(FORMAT_ABORT);
     1814    13584    4                  CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+16+EBIT+
     1815    13585    4                    (MXS-1)/64));
     1816    13586    4                  JEIDX=JEIDX+1;
     1817    13587    4                  IF JEIDX>79 THEN
     1818    13588    4                     CALL STUFF ALTRET(FORMAT_ABORT);
     1819    13589    4                  CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+MOD(MXS-1,64)));
     1820    13590    4                  END;
     1821    13591
     1822    13592        /****
     1823    13593        *
     1824    13594        *   If the records are 1-16 bytes, we need one length byte.
     1825    13595        *
     1826    13596        ****/
     1827    13597
     1828    13598    4                 ELSE IF MXS>0 THEN DO;
     1829    13599    4                     JEIDX=JEIDX+1;
     1830    13600    4                     IF JEIDX>79 THEN
     1831    13601    4                        CALL STUFF ALTRET(FORMAT_ABORT);
     1832    13602    4                     CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+EBIT+MXS-1));
     1833    13603    4                     END;
     1834    13604
     1835    13605        /****
     1836    13606        *
     1837    13607        *   Special case for 0-length records.
     1838    13608        *
     1839    13609        ****/
     1840    13610
     1841    13611    4                    ELSE DO;
     1842    13612    4                     JEIDX=JEIDX+1;
     1843    13613    4                     IF JEIDX>79 THEN
     1844    13614    4                        CALL STUFF ALTRET(FORMAT_ABORT);
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:52   
     1845    13615    4                     CALL INSERT(JEBUF,JEIDX,1,'`');
     1846    13616    4                     END;
     1847    13617    3         END;
     1848    13618
     1849    13619        /****
     1850    13620        *
     1851    13621        *   If the data are in binary (i.e., not in ASC95), convert the entire
     1852    13622        *   record (segment) to 3-for-2 format.
     1853    13623        *
     1854    13624        ****/
     1855    13625
     1856    13626    3      IF BINM THEN DO;
     1857    13627    4         DO I=0 TO SIZ-2 BY 2;
     1858    13628    4            JEIDX=JEIDX+1;
     1859    13629    4            IF JEIDX>79 THEN
     1860    13630    4               CALL STUFF ALTRET(FORMAT_ABORT);
     1861    13631    4            CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+ASCBIN(SUBSTR
     1862    13632    4              (BFR,I,1))/8));
     1863    13633    4            JEIDX=JEIDX+1;
     1864    13634    4            IF JEIDX>79 THEN
     1865    13635    4               CALL STUFF ALTRET(FORMAT_ABORT);
     1866    13636    4            CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+8*BITBIN
     1867    13637    4              (ASCBIT(SUBSTR(BFR,I,1))&'007'O)+ASCBIN(SUBSTR(BFR,
     1868    13638    4              I+1,1))/64));
     1869    13639    4            JEIDX=JEIDX+1;
     1870    13640    4            IF JEIDX>79 THEN
     1871    13641    4               CALL STUFF ALTRET(FORMAT_ABORT);
     1872    13642    4            CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+BITBIN(ASCBIT
     1873    13643    4              (SUBSTR(BFR,I+1,1))&'077'O)));
     1874    13644    4            END;
     1875    13645
     1876    13646        /****
     1877    13647        *
     1878    13648        *   We must send an extra 0-byte if there are an odd number of binary
     1879    13649        *   digits.  The length, however, reflects the true record length.
     1880    13650        *
     1881    13651        ****/
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:53   
     1882    13652
     1883    13653    4         IF MOD(SIZ,2)=1 THEN DO;
     1884    13654    4            JEIDX=JEIDX+1;
     1885    13655    4            IF JEIDX>79 THEN
     1886    13656    4               CALL STUFF ALTRET(FORMAT_ABORT);
     1887    13657    4            CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+ASCBIN(SUBSTR
     1888    13658    4              (BFR,SIZ-1,1))/8));
     1889    13659    4            JEIDX=JEIDX+1;
     1890    13660    4            IF JEIDX>79 THEN
     1891    13661    4               CALL STUFF ALTRET(FORMAT_ABORT);
     1892    13662    4            CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+8*BITBIN
     1893    13663    4              (ASCBIT(SUBSTR(BFR,SIZ-1,1))&'007'O)));
     1894    13664    4            JEIDX=JEIDX+1;
     1895    13665    4            IF JEIDX>79 THEN
     1896    13666    4               CALL STUFF ALTRET(FORMAT_ABORT);
     1897    13667    4            CALL INSERT(JEBUF,JEIDX,1,' ');
     1898    13668    4            END;
     1899    13669    3         END;
     1900    13670
     1901    13671        /****
     1902    13672        *
     1903    13673        *   Send data "in the clear" by copying it in segments to the output
     1904    13674        *   buffer and writing it.
     1905    13675        *
     1906    13676        ****/
     1907    13677
     1908    13678    3        ELSE DO;
     1909    13679    3         I=0;
     1910    13680    4         DO WHILE(I<SIZ);
     1911    13681    4            JEIDX=JEIDX+1;
     1912    13682    4            IF JEIDX>79 THEN
     1913    13683    4               CALL STUFF ALTRET(FORMAT_ABORT);
     1914    13684    4            J=80-JEIDX;
     1915    13685    4            IF J>SIZ-I THEN
     1916    13686    4               J=SIZ-I;
     1917    13687    4            CALL INSERT(JEBUF,JEIDX,J,SUBSTR(BFR,I,J));
     1918    13688    4            I=I+J;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:54   
     1919    13689    4            JEIDX=JEIDX+J-1;
     1920    13690    4            END;
     1921    13691    3         END;
     1922    13692
     1923    13693    2      RETURN;
     1924    13694
     1925    13695        /****
     1926    13696        *
     1927    13697        *   Somebody ALTRETed on us.  Do the same.
     1928    13698        *
     1929    13699        ****/
     1930    13700
     1931    13701    2   FORMAT_ABORT:
     1932    13702    2      ALTRETURN;
     1933    13703
     1934    13704    2   END;
     1935    13705
     1936    13706        %EJECT;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:55   
     1937    13707        /*I**
     1938    13708        *
     1939    13709        *   NAME:  STUFF
     1940    13710        *
     1941    13711        *   PURPOSE:
     1942    13712        *       STUFF computes the length byte and writes JEBUF to JE.
     1943    13713        *
     1944    13714        *   CALL:
     1945    13715        *       CALL STUFF ALTRET...
     1946    13716        *
     1947    13717        *   PARAMETERS:
     1948    13718        *       None.
     1949    13719        *
     1950    13720        *   DATA:
     1951    13721        *       STUFF computes the length byte based on the global cell JEIDX and
     1952    13722        *       places it in the first byte of JEBUF.  JEIDX is reset to 1 and
     1953    13723        *       JEBUF is blanked.
     1954    13724        *
     1955    13725        *   DESCRIPTION:
     1956    13726        *       Write JEBUF after computing the length byte and placing it in
     1957    13727        *       column 1.  If length>0, add 1 to VW_OUTCNT#.  ALTRET if an I/O
     1958    13728        *       error occurs; otherwise, clear JEBUF and reset JEIDX to 1.
     1959    13729        *
     1960    13730        ****/
     1961    13731
     1962    13732    1   STUFF: PROC ALTRET;
     1963    13733
     1964    13734        /****
     1965    13735        *
     1966    13736        *   Compute the length byte, which is '/' plus the number of
     1967    13737        *   bytes in the record (1-79).  This keeps it out of the range of
     1968    13738        *   most system's command character (!, $, /, etc.).  Note that
     1969    13739        *   JEIDX is one more than it should be.
     1970    13740        *
     1971    13741        ****/
     1972    13742
     1973    13743    2      CALL INSERT(JEBUF,0,1,BINASC(ASCBIN('.')+JEIDX));
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:56   
     1974    13744
     1975    13745        /****
     1976    13746        *
     1977    13747        *   Scramble the record (if required) and write it, but only if
     1978    13748        *   there's data in the record.
     1979    13749        *
     1980    13750        ****/
     1981    13751
     1982    13752    3      IF JEIDX>1 THEN DO;
     1983    13753    3         IF VW_SCRAMBLE# THEN
     1984    13754    3            CALL VWO$TRANSO(JEBUF);
     1985    13755    3         CALL M$WRITE(WRITE_JE) ALTRET(STUFF_BAD_WRJ);
     1986    13756    3         VW_OUTCNT#=VW_OUTCNT#+1;
     1987    13757    3         END;
     1988    13758
     1989    13759        /****
     1990    13760        *
     1991    13761        *   Reset the buffer and the pointer for the caller.
     1992    13762        *
     1993    13763        ****/
     1994    13764
     1995    13765    2      JEIDX=1;
     1996    13766    2      JEBUF=' ';
     1997    13767
     1998    13768    2      RETURN;
     1999    13769
     2000    13770        /****
     2001    13771        *
     2002    13772        *   Hmmm, must've gotten an error on the write.
     2003    13773        *
     2004    13774        ****/
     2005    13775
     2006    13776    2   STUFF_BAD_WRJ:
     2007    13777    2      ALTRETURN;
     2008    13778
     2009    13779    2   END;
     2010    13780
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:57   
     2011    13781    1   END;

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:58   
--  Include file information  --

   VW_FPTS_M.:VMB6TOU  cannot be made into a system file and is referenced.
   VW_NODEATER_E.:VMB6TOU  is referenced.
   VW_OPTS_M.:VMB6TOU  is referenced.
   VWM_ERRS_E.:VMB6TOU  is referenced.
   VW_MOVE_E.:VMB6TOU  is referenced.
   XU_PERR_C.:LIB_E05  is referenced.
   XUW_MACRO_C.:LIB_E05  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   FM$FIT.:LIB_E05  is referenced.
   B$JIT_C.:LIB_E05  is referenced.
   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VWB$BEAM.

   Procedure VWB$BEAM requires 2571 words for executable code.
   Procedure VWB$BEAM requires 1836 words of local(AUTO) storage.

    No errors detected in file VWB$BEAM.:VMB6TSI    .

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:59   

 Object Unit name= VWB$BEAM                                   File name= VWB$BEAM.:VMB6TOU
 UTS= AUG 20 '97 15:37:21.88 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none  8956  21374  VWB$BEAM
    2  RtLbCm even  none     2      2  ACCT_NODE
    3  RoData even  UTS    224    340  VWB$BEAM
    4   DCB   even  none     0      0  M$INP
    5   DCB   even  none     0      0  M$JE
    6   DCB   even  none     0      0  M$NODE
    7   Proc  even  none  2571   5013  VWB$BEAM
    8  RoData even  none    91    133  VWB$BEAM

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     7      0   yes    yes     yes      Std        1  VWB$BEAM
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:60   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 VWH$HEADER
         yes           Std       5 VWX$MAIL
         yes           Std       1 VWO$TRANSO
 yes     yes           Std       0 VWR$BREAK
 yes     yes           Std       1 X$WILDFMT
 yes     yes           Std       3 VWF$FOOTER
         yes           Std       1 ASZ$SCRAMBLE
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  VW_OPTIONS#                           ACCT_MOVE
     M$INP                                 M$JE                                  M$NODE
     VW_INPCNT#                            VW_OUTCNT#                            VW_TOTBYTES#
     VW_BROKEN#                            B$JIT$                                B$TCB$
     VW_IAM#                               VW_SCRAMBLE#

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:61   


        1        1        /*M* VWB$BEAM - Transmit a file from here to somewhere. */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC, PLM=3, CTI=2, CSI=2, ECI=2, MCI=YES, SDI=6, THI=2 */
        8        8        /*F**
        9        9        *
       10       10        *   NAME:  VWB$BEAM
       11       11        *
       12       12        *   PURPOSE:
       13       13        *       To package files for shipment to another system.
       14       14        *
       15       15        *   DESCRIPTION:
       16       16        *       The BEAM subroutine examines the information passed to it in the
       17       17        *       options block, then opens and reads the file(s) specified,
       18       18        *       packaging them for shipment in 80-column printable (ASC95)
       19       19        *       records.
       20       20        *
       21       21        *   REFERENCE:
       22       22        *       For a description of the transmission packet formats, see the
       23       23        *       appropriate Architecture File document pertaining to MOVE.
       24       24        *
       25       25        ****/
       26       26
       27       27        /*D**
       28       28        *
       29       29        *   NAME:  VWB$BEAM
       30       30        *
       31       31        *   CALL:
       32       32        *       From MOVE and SCOTTY:  CALL VWB$BEAM ALTRET...
       33       33        *       From MAILMAN:          CALL VWB$BEAM(CHECKCG) ALTRET...
       34       34        *
       35       35        *   PARAMETERS:
       36       36        *       MOVE and SCOTTY call VWB$BEAM without parameters.  MAILMAN passes an
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:62   
       37       37        *       entry (EPTR) address; the existence of the parameter causes VWB$BEAM
       38       38        *       to call the external routine periodically to check for comgroup reads.
       39       39        *
       40       40        *   INTERFACE:
       41       41        *       The presence of the CHECKCG parameter causes VWB$BEAM to CALL the
       42       42        *       routine.  The routines VWX$MAIL, VWR$BREAK, VWH$HEADER, VWF$FOOTER,
       43       43        *       VWO$TRANSO, and X$WILDFMT are called.
       44       44        *
       45       45        *   ENVIRONMENT:
       46       46        *       The VW_OPTIONS# block must be filled in by the caller.  At least the
       47       47        *       BEAM and SUCK sections must contain valid data.  SCOTTY must have
       48       48        *       assumed the user's identity (see VWS$SCOTTY).
       49       49        *
       50       50        *   INPUT:
       51       51        *       CHECKCG, as explained above.  VW_OPTIONS# is passed as a global
       52       52        *       symbol.
       53       53        *
       54       54        *   OUTPUT:
       55       55        *       VW_INPCNT#, VW_OUTCNT#, and VW_TOTBYTES# may be modified by this
       56       56        *       routine.  VW_SCRAMBLE# is copied from the VW_OPTIONS# block.
       57       57        *
       58       58        *   SCRATCH:
       59       59        *       VW_BREAK# may be set/reset if the user hits the BREAK key.
       60       60        *
       61       61        *   DESCRIPTION:
       62       62        *       The BEAM subroutine packages a file for transmission across the
       63       63        *       HASP link.  It expects to find the VW_OPTIONS# block filled in by
       64       64        *       the calling program.  Communication back to the "sender" is
       65       65        *       accomplished via the MAIL subprogram, which is different for
       66       66        *       the MOVE program and the SCOTTY ghost.  The BREAK routine is
       67       67        *       used for user break control, but only in MOVE.  ALTRET is taken
       68       68        *       if the beaming process aborts.
       69       69        *
       70       70        ****/
       71       71
       72       72        VWB$BEAM: PROC(CHECKCG) ALTRET;

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:63   
     72  7 000000   000000 700200 xent  VWB$BEAM     TSX0  ! X66_AUTO_1
         7 000001   003454 000001                    ZERO    1836,1

       73       73
       74       74        /****
       75       75        *
       76       76        *   %INCLUDEs
       77       77        *
       78       78        ****/
       79       79
       80       80        %INCLUDE CP_6;
       81     5639        %INCLUDE CP_6_SUBS;
       82     6179        %INCLUDE B$JIT;
       83     6782        %INCLUDE FM$FIT;
       84     7003        %INCLUDE B_ERRORS_C;
       85     8130        %INCLUDE XUW_MACRO_C;
       86     8265        %INCLUDE XU_PERR_C;
       87     8456        %INCLUDE VW_MOVE_E;
       88     8534        %INCLUDE VWM_ERRS_E;
       89     8908        %INCLUDE VW_OPTS_M;
       90     9592        %MOVE_OPTIONS;
       91    10095        %INCLUDE VW_NODEATER_E;
       92    10151        %INCLUDE VW_FPTS_M;
       93    10572
       94    10573        /****
       95    10574        *
       96    10575        *   FPTs
       97    10576        *
       98    10577        ****/
       99    10578
      100    10579        %FM$FIT;
      101    10582
      102    10583        %CODE03;
      103    10590
      104    10591        %CODE04;
      105    10599
      106    10600
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:64   
      107    10601             %FPT_OPEN(FPTN=OPEN_INP,
      108    10602             DCB=M$INP,
      109    10603             NAME=NAME_INP,
      110    10604             ACCT=ACCT_INP,
      111    10605             PASS=PASS_INP,
      112    10606             SN=SN_INP,
      113    10607             FUN=IN,
      114    10608             SCRUB=YES,
      115    10609             SHARE=NONE);
      116    10718
      117    10719        %VLP_NAME(FPTN=NAME_INP,
      118    10720                  LEN=31,
      119    10721                  NAME=' ');
      120    10748
      121    10749        %VLP_ACCT(FPTN=ACCT_INP,
      122    10750                  ACCT='        ');
      123    10763
      124    10764        %VLP_PASS(FPTN=PASS_INP,
      125    10765                  PASS='        ');
      126    10778
      127    10779        %VLP_SN(FPTN=SN_INP,
      128    10780                N=6);
      129    10793
      130    10794        %FPT_FID(FPTN=FID_INP,
      131    10795                 NAME=NAME_INP,
      132    10796                 ACCT=ACCT_INP,
      133    10797                 PASS=PASS_INP,
      134    10798                 SN=SN_INP,
      135    10799                 ASN=OPEN_INP.V.ASN#,
      136    10800                 RES=OPEN_INP.V.RES#,
      137    10801                 RESULTS=VLR_INP);
      138    10824
      139    10825        %VLR_FID(FPTN=VLR_INP);
      140    10844
      141    10845        %FPT_UNFID(FPTN=UNFID_INP,
      142    10846                   DCB=M$INP);
      143    10864
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:65   
      144    10865        %FPT_OPEN(FPTN=OPEN_OUT,
      145    10866                  NAME=NAME_OUT,
      146    10867                  ACCT=ACCT_OUT,
      147    10868                  PASS=PASS_OUT,
      148    10869                  SN=SN_OUT,
      149    10870                  FUN=IN,
      150    10871                  SCRUB=YES,
      151    10872                  SHARE=NONE);
      152    10981
      153    10982        %VLP_NAME(FPTN=NAME_OUT,
      154    10983                  LEN=31,
      155    10984                  NAME=' ');
      156    11011
      157    11012        %VLP_ACCT(FPTN=ACCT_OUT,
      158    11013                  ACCT='        ');
      159    11026
      160    11027        %VLP_PASS(FPTN=PASS_OUT,
      161    11028                  PASS='        ');
      162    11041
      163    11042        %VLP_SN(FPTN=SN_OUT,
      164    11043                N=6);
      165    11056
      166    11057        %FPT_FID(FPTN=FID_OUT,
      167    11058                 NAME=NAME_OUT,
      168    11059                 ACCT=ACCT_OUT,
      169    11060                 PASS=PASS_OUT,
      170    11061                 SN=SN_OUT,
      171    11062                 ASN=OPEN_OUT.V.ASN#,
      172    11063                 RES=OPEN_OUT.V.RES#,
      173    11064                 RESULTS=VLR_OUT);
      174    11087
      175    11088        %VLR_FID(FPTN=VLR_OUT);
      176    11107
      177    11108        %FPT_UNFID(FPTN=UNFID_OUT,
      178    11109                   ACCT=ACCT_OUT,
      179    11110                   ASN=OPEN_OUT.V.ASN#,
      180    11111                   NAME=NAME_OUT,
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:66   
      181    11112                   PASS=PASS_OUT,
      182    11113                   RES=OPEN_OUT.V.RES#,
      183    11114                   SN=SN_OUT);
      184    11132
      185    11133        %FPT_UNFID(FPTN=UNFID_MSG,
      186    11134                   ACCT=ACCT_OUT,
      187    11135                   ASN=OPEN_OUT.V.ASN#,
      188    11136                   NAME=NAME_OUT,
      189    11137                   RES=OPEN_OUT.V.RES#,
      190    11138                   SN=SN_OUT);
      191    11156
      192    11157        %FPT_READ(FPTN=READ_INP,
      193    11158                  DCB=M$INP,
      194    11159                  BUF=INPBUF);
      195    11198
      196    11199        %FPT_PRECORD(FPTN=PRECORD_INP,
      197    11200                     DCB=M$INP,
      198    11201                     N=-1);
      199    11222
      200    11223        %FPT_CLOSE(FPTN=CLOSE_INP,
      201    11224                   DCB=M$INP,
      202    11225                   DISP=SAVE);
      203    11267
      204    11268        %FPT_OPEN(FPTN=OPEN_JE,
      205    11269                  DCB=M$JE,
      206    11270                  ASN=DEVICE,
      207    11271                  RES='JE  ',
      208    11272                  FUN=CREATE,
      209    11273                  EXIST=ERROR,
      210    11274                  SCRUB=YES,
      211    11275                  WSN=WSN_JE);
      212    11384
      213    11385        %FPT_OPEN(FPTN=OPEN_JE_INTRASHIP,
      214    11386                  DCB=M$JE,
      215    11387                  ASN=FILE,
      216    11388                  FUN=CREATE,
      217    11389                  EXIST=ERROR,
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:67   
      218    11390                  SCRUB=YES,
      219    11391                  ORG=CONSEC,
      220    11392                  NAME=INTRASHIP_NAME,
      221    11393                  ACCT=ACCT_MOVE,
      222    11394                  PASS=INTRASHIP_PASS);
      223    11503
      224    11504        %VLP_NAME(FPTN=INTRASHIP_NAME,
      225    11505                  LEN=31);
      226    11532
      227    11533        %VLP_ACCT(FPTN=ACCT_MOVE,
      228    11534                  STCLASS=SYMREF);
      229    11547
      230    11548        %VLP_PASS(FPTN=INTRASHIP_PASS,
      231    11549                  STCLASS=CONSTANT,
      232    11550                  PASS='Montgmry');
      233    11563
      234    11564        %VLP_WSN(FPTN=WSN_JE,
      235    11565                 WSN='        ');
      236    11578
      237    11579        %FPT_WRITE(FPTN=WRITE_JE,
      238    11580                   DCB=M$JE);
      239    11611
      240    11612        %FPT_CLOSE(FPTN=CLOSE_JE,
      241    11613                   DCB=M$JE,
      242    11614                   DISP=SAVE);
      243    11656
      244    11657        %FPT_JOBSTATS(ORDER=CHECKF,
      245    11658                      CRITERIA=VLP_CRITERIA,
      246    11659                      RESULTS=VLR_JOBSTATS_CHECK);
      247    11679
      248    11680        %VLP_CRITERIA;
      249    11708
      250    11709             %VLR_JOBSTATS_CHECK;
      251    11728
      252    11729        %FPT_TIME(FPTN=CLOCK_TO_TODAY,
      253    11730                  SOURCE=CLOCK,
      254    11731                  DEST=ANS,
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:68   
      255    11732                  DATE=YYMMDD);
      256    11751
      257    11752        %FPT_TIME(FPTN=TODAY_TO_UTS,
      258    11753                  SOURCE=ANS,
      259    11754                  DEST=UTS,
      260    11755                  DATE=YYMMDD,
      261    11756                  TSTAMP=TODAY);
      262    11775
      263    11776        %FPT_TIME(FPTN=CLOCK_TO_UTS,
      264    11777                  STCLASS=CONSTANT,
      265    11778                  SOURCE=CLOCK,
      266    11779                  DEST=UTS,
      267    11780                  TSTAMP=TODAY);
      268    11799
      269    11800        %FPT_PRIV(FPTN=FMSEC,
      270    11801                  STCLASS=CONSTANT,
      271    11802                  PRIV=%PR_FMSEC#);
      272    11817
      273    11818        %FPT_WAIT(UNITS=1);
      274    11832
      275    11833        %VLP_NAME(FPTN=NAME_WILD);
      276    11860
      277    11861        %VLP_NAME(FPTN=NAME_DEST);
      278    11888
      279    11889        %XUW_WILDCARD;
      280    11985
      281    11986        %B$TCB;
      282    11989
      283    11990        %B$ALT;
      284    11998
      285    11999        %F$DCB(DCBN=DUMMY);
      286    12056
      287    12057        %EQU ADAY=%(24*60*60*100);             /* A day in 100ths of seconds */
      288    12058
      289    12059        /****
      290    12060        *
      291    12061        *   Local variables
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:69   
      292    12062        *
      293    12063        ****/
      294    12064
      295    12065    1   DCL CHECKCG                        EPTR;
      296    12066
      297    12067    1   DCL M$INP                          DCB;
      298    12068    1   DCL M$JE                           DCB;
      299    12069    1   DCL M$NODE                         DCB;
      300    12070
      301    12071    1   DCL ASZ$SCRAMBLE ENTRY (1);
      302    12072    1   DCL VWX$MAIL                       ENTRY(5);
      303    12073    1   DCL VWR$BREAK                      ENTRY ALTRET;
      304    12074    1   DCL VWH$HEADER                     ENTRY(3) ALTRET;
      305    12075    1   DCL VWF$FOOTER                     ENTRY(3) ALTRET;
      306    12076    1   DCL X$WILDFMT                      ENTRY(1) ALTRET;
      307    12077    1   DCL VWO$TRANSO                     ENTRY(1);
      308    12078
      309    12079    1   DCL I                              SBIN;
      310    12080    1   DCL J                              SBIN;
      311    12081    1   DCL K                              SBIN;
      312    12082    1   DCL W                              SBIN;
      313    12083    1   DCL N                              SBIN;
      314    12084    1   DCL O                              SBIN;
      315    12085    1   DCL D                              SBIN;
      316    12086    1   DCL OPTX                           SBIN;
      317    12087    1   DCL RECX                           SBIN;
      318    12088    1   DCL FILECOUNT                      SBIN;
      319    12089    1   DCL RECSCOUNT                      SBIN;
      320    12090    1   DCL VW_INPCNT# SYMREF              SBIN;
      321    12091    1   DCL VW_OUTCNT# SYMREF              SBIN;
      322    12092    1   DCL VW_TOTBYTES# SYMREF            SBIN;
      323    12093    1   DCL VW_BROKEN# SYMREF              SBIN;
      324    12094    1   DCL FILEORG                        SBIN;
      325    12095    1   DCL JEIDX                          SBIN;
      326    12096    1   DCL INPLIM                         SBIN;
      327    12097    1   DCL ARS                            SBIN;
      328    12098    1   DCL ERRDCB                         SBIN;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:70   
      329    12099
      330    12100    1   DCL INF_CON CONSTANT               SBIN INIT(-1);
      331    12101    1   DCL INFINITY REDEF INF_CON         UBIN;
      332    12102
      333    12103    1   DCL TODAY STATIC                   UBIN;
      334    12104    1   DCL DATE_LO                        UBIN;
      335    12105    1   DCL DATE_HI                        UBIN;
      336    12106
      337    12107    1   DCL 1 RECS(0:9),
      338    12108    1             2 LO                         UBIN,
      339    12109    1             2 HI                         UBIN;
      340    12110
      341    12111    1   DCL ERRCODE                        SBIN;
      342    12112    1   DCL 1 ERRBITS REDEF ERRCODE,
      343    12113    1             2 FCG                        UNAL BIT(18),
      344    12114    1             2 M                          UNAL BIT(1),
      345    12115    1             2 CODE                       UNAL UBIN(14),
      346    12116    1             2 SEV                        UNAL UBIN(3);
      347    12117
      348    12118    1   DCL B$JIT$ SYMREF                  PTR;
      349    12119    1   DCL B$TCB$ SYMREF                  PTR;
      350    12120    1   DCL INPPTR                         PTR;
      351    12121    1   DCL JEPTR                          PTR;
      352    12122    1   DCL OPT$                           PTR;
      353    12123
      354    12124    1   DCL 1 INPBUF STATIC,
      355    12125    1             2 C                          CHAR(8192),
      356    12126    1             2 *                          CHAR(8192),
      357    12127    1             2 *                          CHAR(8192),
      358    12128    1             2 *                          CHAR(8192);
      359    12129
      360    12130    1   DCL 1 KEYBUF,
      361    12131    1             2 L UNAL                     UBIN BYTE,
      362    12132    1             2 C UNAL                     CHAR(255);
      363    12133
      364    12134    1   DCL 1 EXTERNAL,
      365    12135    1             2 SITENAME               CHAR(8),
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:71   
      366    12136    1             2 ACCT                   CHAR(8);
      367    12137
      368    12138    1   DCL FITBUF (0:1023) AUTO           UBIN WORD;
      369    12139    1   DCL JEBUF                          CHAR(80);
      370    12140    1   DCL TWORK                          CHAR(12);
      371    12141    1   DCL DWORK                          CHAR(8);
      372    12142    1   DCL YYMMDD STATIC                  CHAR(6);
      373    12143    1   DCL VW_IAM# SYMREF                 CHAR(8);
      374    12144    1   DCL RANREL                         CHAR(4);
      375    12145    1   DCL BAD_FILE_NAME                   CHAR (31);
      376    12146
      377    12147    1   DCL 1 BADCHARS CONSTANT ALIGNED,
      378    12148    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      379    12149    1             2 *(0:31) BIT(9) UNAL INIT('000'O*32),
      380    12150    1             2 *(0:31) BIT(9) UNAL INIT('000'O*32),
      381    12151    1             2 *(0:31) BIT(9) UNAL INIT('000'O*31,'111'O),
      382    12152    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      383    12153    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      384    12154    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      385    12155    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      386    12156    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      387    12157    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      388    12158    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      389    12159    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      390    12160    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      391    12161    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      392    12162    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32),
      393    12163    1             2 *(0:31) BIT(9) UNAL INIT('111'O*32);
      394    12164
      395    12165    1   DCL 1 U1,
      396    12166    1             2 L UNAL                     UBIN BYTE,
      397    12167    1             2 C UNAL                     CHAR(79);
      398    12168    1   DCL 1 U2,
      399    12169    1             2 L UNAL                     UBIN BYTE,
      400    12170    1             2 C UNAL                     CHAR(79);
      401    12171    1   DCL 1 U3,
      402    12172    1             2 L UNAL                     UBIN BYTE,
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:72   
      403    12173    1             2 C UNAL                     CHAR(79);
      404    12174    1   DCL 1 U4,
      405    12175    1             2 L UNAL                     UBIN BYTE,
      406    12176    1             2 C UNAL                     CHAR(79);
      407    12177    1   DCL 1 U5,
      408    12178    1             2 L UNAL                     UBIN BYTE,
      409    12179    1             2 C UNAL                     CHAR(79);
      410    12180    1   DCL 1 U6,
      411    12181    1             2 L UNAL                     UBIN BYTE,
      412    12182    1             2 C UNAL                     CHAR(79);
      413    12183
      414    12184    1   DCL NLN                            BIT(1);
      415    12185    1   DCL NFA                            BIT(1);
      416    12186    1   DCL NSC                            BIT(1);
      417    12187    1   DCL ITSBIN                         BIT(1);
      418    12188    1   DCL MULTIPLE                       BIT(1);
      419    12189    1   DCL VW_SCRAMBLE# SYMREF            BIT(1);
      420    12190    1   DCL SOMETHING                      BIT(1);
      421    12191    1   DCL DATE_SELECT                    BIT(1);
      422    12192    1   DCL DATE_SELECT_WHICH              BIT(1);
      423    12193    1   DCL DATE_REL                       BIT(1);
      424    12194    1   DCL INTERNET                       BIT(1);
      425    12195    1   DCL INTRASHIP                      BIT(1);
      426    12196    1   DCL VO_INTERSYS_ACCT CONSTANT      CHAR(8) INIT (':MAIL');
      427    12197    1   DCL VO_INTERSYS_NAME CONSTANT      CHAR(12) INIT ('500ATOB');
      428    12198    1   DCL VO_INTERSYS_PASSWORD CONSTANT  CHAR(8) INIT ('MAILPASS');
      429    12199
      430    12200        %EJECT;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:73   
      431    12201        /****
      432    12202        *
      433    12203        *   Initialize the FPTs and local variables to defaults.
      434    12204        *
      435    12205        ****/
      436    12206
      437    12207    1      INPPTR=DCBADDR(DCBNUM(M$INP));

  12207  7 000002   000000 236007 xsym               LDQ     M$INP,DL
         7 000003   000000 470400 8                  LDP0    0
         7 000004   000000 471500                    LDP1    0,,PR0
         7 000005   100000 236106                    LDQ     0,QL,PR1
         7 000006   200053 756100                    STQ     INPPTR,,AUTO

      438    12208    1      JEPTR=DCBADDR(DCBNUM(M$JE));

  12208  7 000007   000000 236007 xsym               LDQ     M$JE,DL
         7 000010   100000 236106                    LDQ     0,QL,PR1
         7 000011   200054 756100                    STQ     JEPTR,,AUTO

      439    12209    1      OPEN_INP.FPARAM_=VECTOR(FITBUF);

  12209  7 000012   000001 235000 8                  LDA     1
         7 000013   203426 452500                    STP2    OFFSET+2,,AUTO
         7 000014   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 000015   000162 036003                    ADLQ    114,DU
         7 000016   000212 757000 1                  STAQ    OPEN_INP+24

      440    12210    1      WRITE_JE.BUF_.BUF$=ADDR(JEBUF);

  12210  7 000017   202162 633500                    EPPR3   JEBUF,,AUTO
         7 000020   001121 453400 1                  STP3    WRITE_JE+5

      441    12211    1      WRITE_JE.BUF_.BOUND=79;

  12211  7 000021   001120 236000 1                  LDQ     WRITE_JE+4
         7 000022   177777 376007                    ANQ     65535,DL
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:74   
         7 000023   000002 276000 8                  ORQ     2
         7 000024   001120 756000 1                  STQ     WRITE_JE+4

      442    12212    1      UNFID_OUT.TEXTFID_=VECTOR(OPTS.OUT.FID);

  12212  7 000025   000004 237000 8                  LDAQ    4
         7 000026   000556 757000 1                  STAQ    UNFID_OUT+2

      443    12213    1      UNFID_OUT.LEN_=VECTOR(I);

  12213  7 000027   777640 235007                    LDA     -96,DL
         7 000030   203426 452500                    STP2    OFFSET+2,,AUTO
         7 000031   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 000032   000004 036003                    ADLQ    4,DU
         7 000033   000576 757000 1                  STAQ    UNFID_OUT+18

      444    12214    1      UNFID_INP.TEXTFID_=VECTOR(U1.C);

  12214  7 000034   000004 235000 8                  LDA     4
         7 000035   203426 452500                    STP2    OFFSET+2,,AUTO
         7 000036   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 000037   000003 036000 8                  ADLQ    3
         7 000040   000346 757000 1                  STAQ    UNFID_INP+2

      445    12215    1      UNFID_INP.LEN_=VECTOR(I);

  12215  7 000041   777640 235007                    LDA     -96,DL
         7 000042   203426 452500                    STP2    OFFSET+2,,AUTO
         7 000043   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 000044   000004 036003                    ADLQ    4,DU
         7 000045   000366 757000 1                  STAQ    UNFID_INP+18

      446    12216    1      UNFID_MSG.TEXTFID_=VECTOR(U2.C);

  12216  7 000046   000004 235000 8                  LDA     4
         7 000047   203426 452500                    STP2    OFFSET+2,,AUTO
         7 000050   203426 236100                    LDQ     OFFSET+2,,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:75   
         7 000051   000006 036000 8                  ADLQ    6
         7 000052   000604 757000 1                  STAQ    UNFID_MSG+2

      447    12217    1      UNFID_MSG.LEN_=VECTOR(I);

  12217  7 000053   777640 235007                    LDA     -96,DL
         7 000054   203426 452500                    STP2    OFFSET+2,,AUTO
         7 000055   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 000056   000004 036003                    ADLQ    4,DU
         7 000057   000624 757000 1                  STAQ    UNFID_MSG+18

      448    12218    1      NODEKEY.L=8;

  12218  7 000060   010000 236003                    LDQ     4096,DU
         7 000061   000150 552040 1                  STBQ    NODEKEY,'40'O

      449    12219    1      MULTIPLE='0'B;

  12219  7 000062   202420 450100                    STZ     MULTIPLE,,AUTO

      450    12220    1      FILECOUNT=0;

  12220  7 000063   200015 450100                    STZ     FILECOUNT,,AUTO

      451    12221    1      DATE_SELECT='0'B;

  12221  7 000064   202422 450100                    STZ     DATE_SELECT,,AUTO

      452    12222    1      CALL M$TIME(CLOCK_TO_TODAY);

  12222  7 000065   001272 630400 1                  EPPR0   CLOCK_TO_TODAY
         7 000066   020004 713400                    CLIMB   8196
         7 000067   402000 401760                    pmme    nvectors=5

      453    12223    1      CALL M$TIME(TODAY_TO_UTS);

  12223  7 000070   001306 630400 1                  EPPR0   TODAY_TO_UTS
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:76   
         7 000071   020004 713400                    CLIMB   8196
         7 000072   402000 401760                    pmme    nvectors=5

      454    12224    1      RECX=0;

  12224  7 000073   200014 450100                    STZ     RECX,,AUTO

      455    12225    1      RECS='0'B;

  12225  7 000074   000100 100400                    MLR     fill='000'O
         7 000075   000007 000001 8                  ADSC9   7                        cn=0,n=1
         7 000076   200026 000120                    ADSC9   RECS,,AUTO               cn=0,n=80

      456    12226
      457    12227        /****
      458    12228        *
      459    12229        *   Decode the output file name into the M$OPEN FPTs, unless the name
      460    12230        *   is "foreign" (enclosed in single quotes).
      461    12231        *
      462    12232        ****/
      463    12233
      464    12234    2      IF SUBSTR(OPTS.OUT.FID,0,1)~='''' THEN DO;

  12234  7 000077   000074 236000 xsym               LDQ     VW_OPTIONS#+60
         7 000100   000777 376003                    ANQ     511,DU
         7 000101   000047 116003                    CMPQ    39,DU
         7 000102   000123 600000 7                  TZE     s:12249

      465    12235    2         I=OPTS.OUT.L-ASCBIN('/');

  12235  7 000103   000074 236000 xsym               LDQ     VW_OPTIONS#+60
         7 000104   000033 772000                    QRL     27
         7 000105   000057 136007                    SBLQ    47,DL
         7 000106   200004 756100                    STQ     I,,AUTO

      466    12236    2         IF I<1 OR I>79 THEN

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:77   
  12236  7 000107   003214 604400 7                  TMOZ    BEAM_BAD_OTL
         7 000110   000117 116007                    CMPQ    79,DL
         7 000111   003214 605400 7                  TPNZ    BEAM_BAD_OTL

      467    12237    2            GOTO BEAM_BAD_OTL;
      468    12238    2         FID_OUT.TEXTFID_=VECTOR(SUBSTR(OPTS.OUT.FID,0,I));

  12238  7 000112   200004 235100                    LDA     I,,AUTO
         7 000113   000020 735000                    ALS     16
         7 000114   000140 135007                    SBLA    96,DL
         7 000115   000005 236000 8                  LDQ     5
         7 000116   000514 757000 1                  STAQ    FID_OUT+2

      469    12239    2         CALL M$FID(FID_OUT) ALTRET(BEAM_BAD_OUT);

  12239  7 000117   000512 630400 1                  EPPR0   FID_OUT
         7 000120   420001 713400                    CLIMB   alt,+8193
         7 000121   404400 401760                    pmme    nvectors=10
         7 000122   003217 702000 7                  TSX2    BEAM_BAD_OUT

      470    12240    2         END;

      471    12241
      472    12242        /****
      473    12243        *
      474    12244        *   Decode the input file name into the M$OPEN FPTs.  This name cannot
      475    12245        *   be "foreign".
      476    12246        *
      477    12247        ****/
      478    12248
      479    12249    1      I=OPTS.INP.L-ASCBIN('/');

  12249  7 000123   000024 236000 xsym               LDQ     VW_OPTIONS#+20
         7 000124   000033 772000                    QRL     27
         7 000125   000057 136007                    SBLQ    47,DL
         7 000126   200004 756100                    STQ     I,,AUTO

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:78   
      480    12250    1      IF I<1 OR I>79 THEN

  12250  7 000127   003206 604400 7                  TMOZ    BEAM_BAD_ITL
         7 000130   000117 116007                    CMPQ    79,DL
         7 000131   003206 605400 7                  TPNZ    BEAM_BAD_ITL

      481    12251    1         GOTO BEAM_BAD_ITL;
      482    12252    1      FID_INP.TEXTFID_=VECTOR(SUBSTR(OPTS.INP.FID,0,I));

  12252  7 000132   200004 235100                    LDA     I,,AUTO
         7 000133   000020 735000                    ALS     16
         7 000134   000140 135007                    SBLA    96,DL
         7 000135   000010 236000 8                  LDQ     8
         7 000136   000304 757000 1                  STAQ    FID_INP+2

      483    12253    1      CALL M$FID(FID_INP) ALTRET(BEAM_BAD_INP);

  12253  7 000137   000302 630400 1                  EPPR0   FID_INP
         7 000140   420001 713400                    CLIMB   alt,+8193
         7 000141   404400 401760                    pmme    nvectors=10
         7 000142   003211 702000 7                  TSX2    BEAM_BAD_INP

      484    12254
      485    12255        /****
      486    12256        *
      487    12257        *   Determine if there are options present.
      488    12258        *
      489    12259        ****/
      490    12260
      491    12261    1      OPTX=0;

  12261  7 000143   200013 450100                    STZ     OPTX,,AUTO

      492    12262    2      DO WHILE(OPTX<LENGTHC(OPTS.OPTSRECS)/80 AND SUBSTR(OPTS.OPTSRECS(OPTX),

  12262  7 000144   000372 710000 7                  TRA     s:12334

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:79   
      493    12263    2        0,4)='OPTS');
      494    12264    2         OPT$=ADDR(OPTS.OPTSRECS(OPTX));

  12264  7 000145   200013 236100                    LDQ     OPTX,,AUTO
         7 000146   000024 402003                    MPY     20,DU
         7 000147   000011 036000 8                  ADLQ    9
         7 000150   200055 756100                    STQ     OPT$,,AUTO

      495    12265    3         DO SELECT(SUBSTR(OPTS.OPTSRECS(OPTX),4,4));

  12265  7 000151   200013 236100                    LDQ     OPTX,,AUTO
         7 000152   000024 402007                    MPY     20,DL
         7 000153   000311 236006 xsym               LDQ     VW_OPTIONS#+201,QL
         7 000154   000274 116000 3                  CMPQ    VO_INTERSYS_PASSWORD+2
         7 000155   000371 602000 7                  TNC     s:12333
         7 000156   200013 236100                    LDQ     OPTX,,AUTO
         7 000157   000024 402007                    MPY     20,DL
         7 000160   000311 236006 xsym               LDQ     VW_OPTIONS#+201,QL
         7 000161   000274 116000 3                  CMPQ    VO_INTERSYS_PASSWORD+2
         7 000162   000171 600000 7                  TZE     s:12275
         7 000163   200013 236100                    LDQ     OPTX,,AUTO
         7 000164   000024 402007                    MPY     20,DL
         7 000165   000311 236006 xsym               LDQ     VW_OPTIONS#+201,QL
         7 000166   000275 116000 3                  CMPQ    VO_INTERSYS_PASSWORD+3
         7 000167   000371 601000 7                  TNZ     s:12333
         7 000170   000351 710000 7                  TRA     s:12326

      496    12266
      497    12267        /****
      498    12268        *
      499    12269        *   DATE option.  Decode which date (modify or create), the relation, and
      500    12270        *   the date the relation is to be applied to (today, yesterday, etc.).
      501    12271        *
      502    12272        ****/
      503    12273
      504    12274    3            SELECT('DATE');

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:80   
      505    12275    3            IF OPT$->OPTSDATE.WHICH='C' THEN

  12275  7 000171   200055 470500                    LDP0    OPT$,,AUTO
         7 000172   040000 106500                    CMPC    fill='040'O
         7 000173   000002 000001                    ADSC9   2,,PR0                   cn=0,n=1
         7 000174   000012 000001 8                  ADSC9   10                       cn=0,n=1
         7 000175   000200 601000 7                  TNZ     s:12278

      506    12276    3               DATE_SELECT_WHICH='0'B;

  12276  7 000176   202423 450100                    STZ     DATE_SELECT_WHICH,,AUTO
         7 000177   000202 710000 7                  TRA     s:12280

      507    12277    3              ELSE
      508    12278    3               DATE_SELECT_WHICH='1'B;

  12278  7 000200   400000 236003                    LDQ     -131072,DU
         7 000201   202423 756100                    STQ     DATE_SELECT_WHICH,,AUTO

      509    12279
      510    12280    3            IF OPT$->OPTSDATE.UTS='TODAY' THEN

  12280  7 000202   040000 106500                    CMPC    fill='040'O
         7 000203   000002 600013                    ADSC9   2,,PR0                   cn=3,n=11
         7 000204   000276 000005 3                  ADSC9   VO_INTERSYS_PASSWORD+4   cn=0,n=5
         7 000205   000247 600000 7                  TZE     s:12294

      511    12281    3               ;
      512    12282    3              ELSE IF OPT$->OPTSDATE.UTS='YESTERDAY' THEN

  12282  7 000206   040000 106500                    CMPC    fill='040'O
         7 000207   000002 600013                    ADSC9   2,,PR0                   cn=3,n=11
         7 000210   000300 000011 3                  ADSC9   VO_INTERSYS_PASSWORD+6   cn=0,n=9
         7 000211   000216 601000 7                  TNZ     s:12284

      513    12283    3                  TODAY=TODAY-%ADAY;

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:81   
  12283  7 000212   001364 235000 1                  LDA     TODAY
         7 000213   000013 135000 8                  SBLA    11
         7 000214   001364 755000 1                  STA     TODAY
         7 000215   000247 710000 7                  TRA     s:12294

      514    12284    4                 ELSE IF SUBSTR(OPT$->OPTSDATE.UTS,0,1)='-' THEN DO;

  12284  7 000216   040000 106500                    CMPC    fill='040'O
         7 000217   000002 600001                    ADSC9   2,,PR0                   cn=3,n=1
         7 000220   000014 000001 8                  ADSC9   12                       cn=0,n=1
         7 000221   000241 601000 7                  TNZ     s:12290

      515    12285    4                     CALL INDEX(I,' ',OPT$->OPTSDATE.UTS);

  12285  7 000222   000000 124500                    SCM     mask='000'O
         7 000223   000002 600013                    ADSC9   2,,PR0                   cn=3,n=11
         7 000224   000015 000001 8                  ADSC9   13                       cn=0,n=1
         7 000225   200004 000100                    ARG     I,,AUTO

      516    12286    4                     CALL CHARBIN(J,SUBSTR(OPT$->OPTSDATE.UTS,1,I-1));

  12286  7 000226   200004 720100                    LXL0    I,,AUTO
         7 000227   777777 621010                    EAX1    -1,X0
         7 000230   000100 305540                    DTB
         7 000231   000003 030011                    NDSC9   3,,PR0                   cn=0,s=nosgn,sf=0,n=*X1
         7 000232   200005 000004                    NDSC9   J,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

      517    12287    4                     TODAY=TODAY-J*%ADAY;

  12287  7 000233   000000 236003                    LDQ     0,DU
         7 000234   200005 136100                    SBLQ    J,,AUTO
         7 000235   000013 402000 8                  MPY     11
         7 000236   001364 036000 1                  ADLQ    TODAY
         7 000237   001364 756000 1                  STQ     TODAY

      518    12288    4                     END;

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:82   
  12288  7 000240   000247 710000 7                  TRA     s:12294

      519    12289    4                    ELSE DO;

      520    12290    4                     YYMMDD=SUBSTR(OPT$->OPTSDATE.UTS,0,6);

  12290  7 000241   040000 100500                    MLR     fill='040'O
         7 000242   000002 600006                    ADSC9   2,,PR0                   cn=3,n=6
         7 000243   021365 000006 1                  ADSC9   YYMMDD                   cn=0,n=6

      521    12291    4                     CALL M$TIME(TODAY_TO_UTS);

  12291  7 000244   001306 630400 1                  EPPR0   TODAY_TO_UTS
         7 000245   020004 713400                    CLIMB   8196
         7 000246   402000 401760                    pmme    nvectors=5

      522    12292    4                     END;

      523    12293
      524    12294    3            DATE_REL='0'B;

  12294  7 000247   202424 450100                    STZ     DATE_REL,,AUTO

      525    12295    4            DO SELECT(OPT$->OPTSDATE.REL);

  12295  7 000250   200055 470500                    LDP0    OPT$,,AUTO
         7 000251   040000 106500                    CMPC    fill='040'O
         7 000252   000002 200002                    ADSC9   2,,PR0                   cn=1,n=2
         7 000253   000303 000002 3                  ADSC9   VO_INTERSYS_PASSWORD+9   cn=0,n=2
         7 000254   000270 602000 7                  TNC     s:12295+16
         7 000255   000333 600000 7                  TZE     s:12309
         7 000256   040000 106500                    CMPC    fill='040'O
         7 000257   000002 200002                    ADSC9   2,,PR0                   cn=1,n=2
         7 000260   000304 000002 3                  ADSC9   VO_INTERSYS_PASSWORD+10  cn=0,n=2
         7 000261   000346 602000 7                  TNC     s:12316
         7 000262   000327 600000 7                  TZE     s:12306
         7 000263   040000 106500                    CMPC    fill='040'O
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:83   
         7 000264   000002 200002                    ADSC9   2,,PR0                   cn=1,n=2
         7 000265   000305 000002 3                  ADSC9   VO_INTERSYS_PASSWORD+11  cn=0,n=2
         7 000266   000346 601000 7                  TNZ     s:12316
         7 000267   000340 710000 7                  TRA     s:12312
         7 000270   040000 106500                    CMPC    fill='040'O
         7 000271   000002 200002                    ADSC9   2,,PR0                   cn=1,n=2
         7 000272   000306 000002 3                  ADSC9   VO_INTERSYS_PASSWORD+12  cn=0,n=2
         7 000273   000302 602000 7                  TNC     s:12295+26
         7 000274   000322 600000 7                  TZE     s:12303
         7 000275   040000 106500                    CMPC    fill='040'O
         7 000276   000002 200002                    ADSC9   2,,PR0                   cn=1,n=2
         7 000277   000307 000002 3                  ADSC9   VO_INTERSYS_PASSWORD+13  cn=0,n=2
         7 000300   000346 601000 7                  TNZ     s:12316
         7 000301   000307 710000 7                  TRA     s:12297
         7 000302   040000 106500                    CMPC    fill='040'O
         7 000303   000002 200002                    ADSC9   2,,PR0                   cn=1,n=2
         7 000304   000310 000002 3                  ADSC9   VO_INTERSYS_PASSWORD+14  cn=0,n=2
         7 000305   000346 601000 7                  TNZ     s:12316
         7 000306   000315 710000 7                  TRA     s:12300

      526    12296    4               SELECT('GT');

      527    12297    4               DATE_LO=TODAY+%ADAY;

  12297  7 000307   001364 235000 1                  LDA     TODAY
         7 000310   000013 035000 8                  ADLA    11
         7 000311   200024 755100                    STA     DATE_LO,,AUTO

      528    12298    4               DATE_HI=INFINITY;

  12298  7 000312   000064 236000 3                  LDQ     INF_CON
         7 000313   200025 756100                    STQ     DATE_HI,,AUTO
         7 000314   000346 710000 7                  TRA     s:12316

      529    12299    4               SELECT('EQ');

      530    12300    4               DATE_LO=TODAY;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:84   

  12300  7 000315   001364 235000 1                  LDA     TODAY
         7 000316   200024 755100                    STA     DATE_LO,,AUTO

      531    12301    4               DATE_HI=TODAY+%ADAY;

  12301  7 000317   000013 035000 8                  ADLA    11
         7 000320   200025 755100                    STA     DATE_HI,,AUTO
         7 000321   000346 710000 7                  TRA     s:12316

      532    12302    4               SELECT('GE');

      533    12303    4               DATE_LO=TODAY;

  12303  7 000322   001364 235000 1                  LDA     TODAY
         7 000323   200024 755100                    STA     DATE_LO,,AUTO

      534    12304    4               DATE_HI=INFINITY;

  12304  7 000324   000064 236000 3                  LDQ     INF_CON
         7 000325   200025 756100                    STQ     DATE_HI,,AUTO
         7 000326   000346 710000 7                  TRA     s:12316

      535    12305    4               SELECT('LT');

      536    12306    4               DATE_LO=0;

  12306  7 000327   200024 450100                    STZ     DATE_LO,,AUTO

      537    12307    4               DATE_HI=TODAY;

  12307  7 000330   001364 235000 1                  LDA     TODAY
         7 000331   200025 755100                    STA     DATE_HI,,AUTO
         7 000332   000346 710000 7                  TRA     s:12316

      538    12308    4               SELECT('LE');

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:85   
      539    12309    4               DATE_LO=0;

  12309  7 000333   200024 450100                    STZ     DATE_LO,,AUTO

      540    12310    4               DATE_HI=TODAY+%ADAY;

  12310  7 000334   001364 235000 1                  LDA     TODAY
         7 000335   000013 035000 8                  ADLA    11
         7 000336   200025 755100                    STA     DATE_HI,,AUTO
         7 000337   000346 710000 7                  TRA     s:12316

      541    12311    4               SELECT('NE');

      542    12312    4               DATE_LO=TODAY;

  12312  7 000340   001364 235000 1                  LDA     TODAY
         7 000341   200024 755100                    STA     DATE_LO,,AUTO

      543    12313    4               DATE_HI=TODAY+%ADAY;

  12313  7 000342   000013 035000 8                  ADLA    11
         7 000343   200025 755100                    STA     DATE_HI,,AUTO

      544    12314    4               DATE_REL='1'B;

  12314  7 000344   400000 236003                    LDQ     -131072,DU
         7 000345   202424 756100                    STQ     DATE_REL,,AUTO

      545    12315    4               END;

      546    12316    3            DATE_SELECT='1'B;

  12316  7 000346   400000 236003                    LDQ     -131072,DU
         7 000347   202422 756100                    STQ     DATE_SELECT,,AUTO
         7 000350   000371 710000 7                  TRA     s:12333

      547    12317
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:86   
      548    12318        /****
      549    12319        *
      550    12320        *   RECS (record selection) option.  Fetch the first and last record
      551    12321        *   numbers.
      552    12322        *
      553    12323        ****/
      554    12324
      555    12325    3            SELECT('RECS');

      556    12326    4            IF RECX<10 THEN DO;

  12326  7 000351   200014 235100                    LDA     RECX,,AUTO
         7 000352   000012 115007                    CMPA    10,DL
         7 000353   000371 605000 7                  TPL     s:12333

      557    12327    4               CALL CHARBIN(RECS.LO(RECX),OPT$->OPTSRECS.FRST);

  12327  7 000354   200055 470500                    LDP0    OPT$,,AUTO
         7 000355   000100 305500                    DTB
         7 000356   000002 030012                    NDSC9   2,,PR0                   cn=0,s=nosgn,sf=0,n=10
         7 000357   203426 000010                    NDSC9   OFFSET+2,,AUTO           cn=0,s=lsgnf,sf=0,n=8
         7 000360   000001 735000                    ALS     1
         7 000361   203427 236100                    LDQ     OFFSET+3,,AUTO
         7 000362   200026 756105                    STQ     RECS,AL,AUTO

      558    12328    4               CALL CHARBIN(RECS.HI(RECX),OPT$->OPTSRECS.LAST);

  12328  7 000363   000100 305500                    DTB
         7 000364   000004 430012                    NDSC9   4,,PR0                   cn=2,s=nosgn,sf=0,n=10
         7 000365   203426 000010                    NDSC9   OFFSET+2,,AUTO           cn=0,s=lsgnf,sf=0,n=8
         7 000366   203427 236100                    LDQ     OFFSET+3,,AUTO
         7 000367   200027 756105                    STQ     RECS+1,AL,AUTO

      559    12329    4               RECX=RECX+1;

  12329  7 000370   200014 054100                    AOS     RECX,,AUTO

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:87   
      560    12330    4               END;

      561    12331
      562    12332    3            END /* DO select */;

      563    12333    2         OPTX=OPTX+1;

  12333  7 000371   200013 054100                    AOS     OPTX,,AUTO

      564    12334    2         END;

  12334  7 000372   200013 235100                    LDA     OPTX,,AUTO
         7 000373   000017 115007                    CMPA    15,DL
         7 000374   000402 605000 7                  TPL     s:12343
         7 000375   200013 236100                    LDQ     OPTX,,AUTO
         7 000376   000024 402007                    MPY     20,DL
         7 000377   000310 236006 xsym               LDQ     VW_OPTIONS#+200,QL
         7 000400   000311 116000 3                  CMPQ    VO_INTERSYS_PASSWORD+15
         7 000401   000145 600000 7                  TZE     s:12264

      565    12335
      566    12336        /****
      567    12337        *
      568    12338        *   Discover if this is a wildcarded MOVE by looking for ? in the FID.
      569    12339        *   You cannot wildcard-move to a foreign system.
      570    12340        *
      571    12341        ****/
      572    12342
      573    12343    1      CALL INDEX1(J,'?',SUBSTR(NAME_INP.NAME#,0,NAME_INP.L#),0)

  12343  7 000402   000254 236000 1                  LDQ     NAME_INP
         7 000403   000033 772000                    QRL     27
         7 000404   000000 620006                    EAX0    0,QL
         7 000405   000000 124440                    SCM     mask='000'O
         7 000406   000254 200010 1                  ADSC9   NAME_INP                 cn=1,n=*X0
         7 000407   000016 000001 8                  ADSC9   14                       cn=0,n=1
         7 000410   200005 000100                    ARG     J,,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:88   
         7 000411   000616 606400 7                  TTN     BEAM_JUST_ONCE

      574    12344    1        ALTRET(BEAM_JUST_ONCE);
      575    12345    1      IF SUBSTR(OPTS.OUT.FID,0,1)='''' THEN

  12345  7 000412   000074 236000 xsym               LDQ     VW_OPTIONS#+60
         7 000413   000777 376003                    ANQ     511,DU
         7 000414   000047 116003                    CMPQ    39,DU
         7 000415   003230 600000 7                  TZE     BEAM_BAD_WLD

      576    12346    1         GOTO BEAM_BAD_WLD;
      577    12347
      578    12348        /****
      579    12349        *
      580    12350        *   Set up for multiple inputs (wildcarded).
      581    12351        *
      582    12352        ****/
      583    12353
      584    12354    1      NAME_DEST=NAME_OUT;

  12354  7 000416   000000 100400                    MLR     fill='000'O
         7 000417   000464 000040 1                  ADSC9   NAME_OUT                 cn=0,n=32
         7 000420   001340 000040 1                  ADSC9   NAME_DEST                cn=0,n=32

      585    12355    1      NAME_WILD=NAME_INP;

  12355  7 000421   000000 100400                    MLR     fill='000'O
         7 000422   000254 000040 1                  ADSC9   NAME_INP                 cn=0,n=32
         7 000423   001330 000040 1                  ADSC9   NAME_WILD                cn=0,n=32

      586    12356    1      XUW_WILDCARD.TEMPLATE_=VECTOR(SUBSTR(NAME_DEST.NAME#,0,NAME_DEST.L#));

  12356  7 000424   001340 236000 1                  LDQ     NAME_DEST
         7 000425   000033 772000                    QRL     27
         7 000426   000064 737000                    LLS     52
         7 000427   000140 135007                    SBLA    96,DL
         7 000430   000017 236000 8                  LDQ     15
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:89   
         7 000431   001354 757000 1                  STAQ    XUW_WILDCARD+4

      587    12357    1      XUW_WILDCARD.PATTERN_=VECTOR(SUBSTR(NAME_WILD.NAME#,0,NAME_WILD.L#));

  12357  7 000432   001330 236000 1                  LDQ     NAME_WILD
         7 000433   000033 772000                    QRL     27
         7 000434   000064 737000                    LLS     52
         7 000435   000140 135007                    SBLA    96,DL
         7 000436   000020 236000 8                  LDQ     16
         7 000437   001350 757000 1                  STAQ    XUW_WILDCARD

      588    12358    1      OPEN_INP.V.OPER.THISF#='1'B;

  12358  7 000440   002000 236007                    LDQ     1024,DL
         7 000441   000226 256000 1                  ORSQ    OPEN_INP+36

      589    12359    1      CALL INDEX1(I,'?',NAME_INP.NAME#,0);

  12359  7 000442   000000 124400                    SCM     mask='000'O
         7 000443   000254 200037 1                  ADSC9   NAME_INP                 cn=1,n=31
         7 000444   000016 000001 8                  ADSC9   14                       cn=0,n=1
         7 000445   200004 000100                    ARG     I,,AUTO

      590    12360    1      NAME_INP.L#=I;

  12360  7 000446   200004 236100                    LDQ     I,,AUTO
         7 000447   000033 736000                    QLS     27
         7 000450   000254 552040 1                  STBQ    NAME_INP,'40'O

      591    12361    1      MULTIPLE='1'B;

  12361  7 000451   400000 236003                    LDQ     -131072,DU
         7 000452   202420 756100                    STQ     MULTIPLE,,AUTO

      592    12362    1      BAD_FILE_NAME = ' ';

  12362  7 000453   040100 100400                    MLR     fill='040'O
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:90   
         7 000454   000015 000001 8                  ADSC9   13                       cn=0,n=1
         7 000455   202214 000037                    ADSC9   BAD_FILE_NAME,,AUTO      cn=0,n=31

      593    12363
      594    12364        /****
      595    12365        *
      596    12366        *   Open the next file in test mode to see if it's one we want.
      597    12367        *
      598    12368        ****/
      599    12369
      600    12370    1   BEAM_NEXT_FILE:
      601    12371    1      OPEN_INP.V.OPER.NXTF#='1'B;

  12371  7 000456   004000 236007       BEAM_NEXT_F* LDQ     2048,DL
         7 000457   000226 256000 1                  ORSQ    OPEN_INP+36

      602    12372    1      OPEN_INP.V.OPER.TEST#='1'B;

  12372  7 000460   020000 236007                    LDQ     8192,DL
         7 000461   000226 256000 1                  ORSQ    OPEN_INP+36

      603    12373    1      CALL M$OPEN(OPEN_INP)

  12373  7 000462   000162 630400 1                  EPPR0   OPEN_INP
         7 000463   450000 713400                    CLIMB   alt,open
         7 000464   410400 401760                    pmme    nvectors=18
         7 000465   000467 702000 7                  TSX2    s:12375
         7 000466   000513 710000 7                  TRA     s:12384

      604    12374    2        WHENALTRETURN DO;

      605    12375    2         IF B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR.ERR# = %E$FDEOF  /* end of dir. */

  12375  7 000467   000000 470400 xsym               LDP0    B$TCB$
         7 000470   000000 471500                    LDP1    0,,PR0
         7 000471   100102 236100                    LDQ     66,,PR1
         7 000472   377770 376007                    ANQ     131064,DL
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:91   
         7 000473   001540 116007                    CMPQ    864,DL
         7 000474   003353 600000 7                  TZE     BEAM_WILD_DONE
         7 000475   013140 116007                    CMPQ    5728,DL
         7 000476   003353 600000 7                  TZE     BEAM_WILD_DONE
         7 000477   200053 473500                    LDP3    INPPTR,,AUTO
         7 000500   040100 106500                    CMPC    fill='040'O
         7 000501   300010 200037                    ADSC9   8,,PR3                   cn=1,n=31
         7 000502   202214 000037                    ADSC9   BAD_FILE_NAME,,AUTO      cn=0,n=31
         7 000503   003353 600000 7                  TZE     BEAM_WILD_DONE

      606    12376    2           OR B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR.ERR# = %E$EOSET /* end of tapeset */
      607    12377    2           OR INPPTR->DUMMY.NAME#.C = BAD_FILE_NAME            /* stuck */
      608    12378    2           THEN
      609    12379    2            GOTO BEAM_WILD_DONE;
      610    12380    2         BAD_FILE_NAME = INPPTR->DUMMY.NAME#.C;

  12380  7 000504   040100 100500                    MLR     fill='040'O
         7 000505   300010 200037                    ADSC9   8,,PR3                   cn=1,n=31
         7 000506   202214 000037                    ADSC9   BAD_FILE_NAME,,AUTO      cn=0,n=31

      611    12381    2         NAME_INP = INPPTR->DUMMY.NAME#;

  12381  7 000507   000000 100500                    MLR     fill='000'O
         7 000510   300010 000040                    ADSC9   8,,PR3                   cn=0,n=32
         7 000511   000254 000040 1                  ADSC9   NAME_INP                 cn=0,n=32

      612    12382    2         GOTO BEAM_NEXT_FILE;

  12382  7 000512   000456 710000 7                  TRA     BEAM_NEXT_FILE

      613    12383    2         END;
      614    12384    1      NAME_INP=INPPTR->DUMMY.NAME#;

  12384  7 000513   200053 470500                    LDP0    INPPTR,,AUTO
         7 000514   000000 100500                    MLR     fill='000'O
         7 000515   000010 000040                    ADSC9   8,,PR0                   cn=0,n=32
         7 000516   000254 000040 1                  ADSC9   NAME_INP                 cn=0,n=32
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:92   

      615    12385    1      OPEN_INP.V.OPER='0'B;

  12385  7 000517   000021 236000 8                  LDQ     17
         7 000520   000226 356000 1                  ANSQ    OPEN_INP+36

      616    12386    1      NAME_OUT.L#=31;

  12386  7 000521   037000 236003                    LDQ     15872,DU
         7 000522   000464 552040 1                  STBQ    NAME_OUT,'40'O

      617    12387    1      XUW_WILDCARD.INPUT_=VECTOR(SUBSTR(NAME_INP.NAME#,0,NAME_INP.L#));

  12387  7 000523   000254 236000 1                  LDQ     NAME_INP
         7 000524   000033 772000                    QRL     27
         7 000525   000064 737000                    LLS     52
         7 000526   000140 135007                    SBLA    96,DL
         7 000527   000022 236000 8                  LDQ     18
         7 000530   001352 757000 1                  STAQ    XUW_WILDCARD+2

      618    12388    1      XUW_WILDCARD.OUTPUT_=VECTOR(SUBSTR(NAME_OUT.NAME#,0,NAME_OUT.L#));

  12388  7 000531   000464 236000 1                  LDQ     NAME_OUT
         7 000532   000033 772000                    QRL     27
         7 000533   000064 737000                    LLS     52
         7 000534   000140 135007                    SBLA    96,DL
         7 000535   000023 236000 8                  LDQ     19
         7 000536   001356 757000 1                  STAQ    XUW_WILDCARD+6

      619    12389    1      CALL X$WILDFMT(XUW_WILDCARD) ALTRET(BEAM_WILD_ERROR);

  12389  7 000537   000025 630400 8                  EPPR0   21
         7 000540   000024 631400 8                  EPPR1   20
         7 000541   000000 701000 xent               TSX1    X$WILDFMT
         7 000542   000551 702000 7                  TSX2    BEAM_WILD_ERROR

      620    12390    1      NAME_OUT.L#=XUW_WILDCARD.OUTPUT_LEN;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:93   

  12390  7 000543   001362 236000 1                  LDQ     XUW_WILDCARD+10
         7 000544   000033 736000                    QLS     27
         7 000545   000464 552040 1                  STBQ    NAME_OUT,'40'O

      621    12391    1      IF NAME_OUT.L#>0 THEN

  12391  7 000546   000464 236000 1                  LDQ     NAME_OUT
         7 000547   777000 316003                    CANQ    -512,DU
         7 000550   000575 601000 7                  TNZ     BEAM_MULT_FILE

      622    12392    1         GOTO BEAM_MULT_FILE;
      623    12393
      624    12394        /****
      625    12395        *
      626    12396        *   The wildcarder returned an error.  If this is just "no match",
      627    12397        *   move on to the next file, if appropriate.
      628    12398        *
      629    12399        ****/
      630    12400
      631    12401    1   BEAM_WILD_ERROR:
      632    12402    2      IF XUW_WILDCARD.ERROR.ERR#=%E$XUW#NOMATCH THEN DO;

  12402  7 000551   001360 236000 1     BEAM_WILD_E* LDQ     XUW_WILDCARD+8
         7 000552   377770 376007                    ANQ     131064,DL
         7 000553   004000 116007                    CMPQ    2048,DL
         7 000554   003230 601000 7                  TNZ     BEAM_BAD_WLD

      633    12403    2         CALL INDEX1(I,'?',SUBSTR(NAME_WILD.NAME#,0,NAME_WILD.L#),0);

  12403  7 000555   001330 236000 1                  LDQ     NAME_WILD
         7 000556   000033 772000                    QRL     27
         7 000557   000000 620006                    EAX0    0,QL
         7 000560   000000 124440                    SCM     mask='000'O
         7 000561   001330 200010 1                  ADSC9   NAME_WILD                cn=1,n=*X0
         7 000562   000016 000001 8                  ADSC9   14                       cn=0,n=1
         7 000563   200004 000100                    ARG     I,,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:94   

      634    12404    2         IF I=0 THEN

  12404  7 000564   200004 235100                    LDA     I,,AUTO
         7 000565   000456 600000 7                  TZE     BEAM_NEXT_FILE

      635    12405    2            GOTO BEAM_NEXT_FILE;
      636    12406    2         IF SUBSTR(NAME_INP.NAME#,0,I)~=SUBSTR(NAME_WILD.NAME#,0,I) THEN

  12406  7 000566   000000 620005                    EAX0    0,AL
         7 000567   200004 721100                    LXL1    I,,AUTO
         7 000570   040040 106440                    CMPC    fill='040'O
         7 000571   000254 200010 1                  ADSC9   NAME_INP                 cn=1,n=*X0
         7 000572   001330 200011 1                  ADSC9   NAME_WILD                cn=1,n=*X1
         7 000573   003353 601000 7                  TNZ     BEAM_WILD_DONE

      637    12407    2            GOTO BEAM_WILD_DONE;
      638    12408    2         GOTO BEAM_NEXT_FILE;

  12408  7 000574   000456 710000 7                  TRA     BEAM_NEXT_FILE

      639    12409    2         END;
      640    12410    1        ELSE
      641    12411    1         GOTO BEAM_BAD_WLD;
      642    12412
      643    12413        /****
      644    12414        *
      645    12415        *   We found a file we want to BEAM.  Put the name back into the
      646    12416        *   buffer and fall into the open logic.
      647    12417        *
      648    12418        ****/
      649    12419
      650    12420    1   BEAM_MULT_FILE:
      651    12421    1      CALL M$UNFID(UNFID_OUT);

  12421  7 000575   000554 630400 1     BEAM_MULT_F* EPPR0   UNFID_OUT
         7 000576   020021 713400                    CLIMB   8209
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:95   
         7 000577   404400 401760                    pmme    nvectors=10

      652    12422    1      OPTS.OUT.L=I+ASCBIN('/');

  12422  7 000600   200004 236100                    LDQ     I,,AUTO
         7 000601   000057 036007                    ADLQ    47,DL
         7 000602   000033 736000                    QLS     27
         7 000603   000074 552040 xsym               STBQ    VW_OPTIONS#+60,'40'O

      653    12423    1      IF B$JIT.PRIV.ACTIVE&%PR_JIT#~='0'B THEN

  12423  7 000604   400000 220003                    LDX0    -131072,DU
         7 000605   000312 235000 3                  LDA     VO_INTERSYS_PASSWORD+16
         7 000606   000610 601000 7                  TNZ     s:12423+4
         7 000607   000000 220003                    LDX0    0,DU
         7 000610   000000 470400 xsym               LDP0    B$JIT$
         7 000611   000000 636010                    EAQ     0,X0
         7 000612   000013 376100                    ANQ     11,,PR0
         7 000613   000616 600000 7                  TZE     BEAM_JUST_ONCE

      654    12424    1         B$JIT.REMCPO=131071;

  12424  7 000614   377777 236007                    LDQ     131071,DL
         7 000615   000360 756100                    STQ     240,,PR0

      655    12425
      656    12426        /****
      657    12427        *
      658    12428        *   Now open the file for real.
      659    12429        *
      660    12430        ****/
      661    12431
      662    12432    1   BEAM_JUST_ONCE:
      663    12433    1      OPEN_INP.V.OPER.TEST#='0'B;

  12433  7 000616   000026 236000 8     BEAM_JUST_O* LDQ     22
         7 000617   000226 356000 1                  ANSQ    OPEN_INP+36
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:96   

      664    12434    1      OPEN_INP.V.OPER.NXTF#='0'B;

  12434  7 000620   000027 236000 8                  LDQ     23
         7 000621   000226 356000 1                  ANSQ    OPEN_INP+36

      665    12435    1      CALL M$OPEN(OPEN_INP) ALTRET(BEAM_BAD_FMF);

  12435  7 000622   000162 630400 1                  EPPR0   OPEN_INP
         7 000623   450000 713400                    CLIMB   alt,open
         7 000624   410400 401760                    pmme    nvectors=18
         7 000625   003244 702000 7                  TSX2    BEAM_BAD_FMF

      666    12436
      667    12437        /****
      668    12438        *
      669    12439        *   See if this file is eligible for by date moves.
      670    12440        *
      671    12441        ****/
      672    12442
      673    12443    2      IF DATE_SELECT THEN DO;

  12443  7 000626   202422 234100                    SZN     DATE_SELECT,,AUTO
         7 000627   000705 605000 7                  TPL     s:12473

      674    12444    2         J=ADDR(FITBUF)->FM$FIT.CODES.CODE(0);

  12444  7 000630   200162 236100                    LDQ     FITBUF,,AUTO
         7 000631   000037 772000                    QRL     31
         7 000632   200005 756100                    STQ     J,,AUTO

      675    12445    3         DO I=1 TO J;

  12445  7 000633   000001 235007                    LDA     1,DL
         7 000634   200004 755100                    STA     I,,AUTO
         7 000635   000702 710000 7                  TRA     s:12461+1

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:97   
      676    12446    4            IF ADDR(FITBUF)->FM$FIT.CODES.CODE(I)=4 THEN DO;

  12446  7 000636   200004 720100                    LXL0    I,,AUTO
         7 000637   200162 236110                    LDQ     FITBUF,X0,AUTO
         7 000640   760000 376003                    ANQ     -8192,DU
         7 000641   100000 116003                    CMPQ    32768,DU
         7 000642   000701 601000 7                  TNZ     s:12461

      677    12447    4               K=ADDR(FITBUF)->FM$FIT.CODES.ITEMX(I);

  12447  7 000643   200162 236110                    LDQ     FITBUF,X0,AUTO
         7 000644   001777 376007                    ANQ     1023,DL
         7 000645   200006 756100                    STQ     K,,AUTO

      678    12448    4               IF DATE_SELECT_WHICH THEN

  12448  7 000646   202423 234100                    SZN     DATE_SELECT_WHICH,,AUTO
         7 000647   000653 605000 7                  TPL     s:12451

      679    12449    4                  TODAY=PINCRW(ADDR(FITBUF),K)->CODE04.MODIFY.TIME;

  12449  7 000650   200163 235106                    LDA     FITBUF+1,QL,AUTO
         7 000651   001364 755000 1                  STA     TODAY
         7 000652   000655 710000 7                  TRA     s:12452

      680    12450    4                 ELSE
      681    12451    4                  TODAY=PINCRW(ADDR(FITBUF),K)->CODE04.CREATION.TIME;

  12451  7 000653   200164 235106                    LDA     FITBUF+2,QL,AUTO
         7 000654   001364 755000 1                  STA     TODAY

      682    12452    4               IF (DATE_REL AND TODAY>=DATE_LO AND TODAY<DATE_HI) OR

  12452  7 000655   202424 234100                    SZN     DATE_REL,,AUTO
         7 000656   000664 605000 7                  TPL     s:12452+7
         7 000657   001364 236000 1                  LDQ     TODAY
         7 000660   200024 116100                    CMPQ    DATE_LO,,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:98   
         7 000661   000664 602000 7                  TNC     s:12452+7
         7 000662   200025 116100                    CMPQ    DATE_HI,,AUTO
         7 000663   000673 602000 7                  TNC     s:12454
         7 000664   202424 234100                    SZN     DATE_REL,,AUTO
         7 000665   000701 604000 7                  TMI     s:12461
         7 000666   001364 236000 1                  LDQ     TODAY
         7 000667   200024 116100                    CMPQ    DATE_LO,,AUTO
         7 000670   000673 602000 7                  TNC     s:12454
         7 000671   200025 116100                    CMPQ    DATE_HI,,AUTO
         7 000672   000701 602000 7                  TNC     s:12461

      683    12453    5                 (NOT DATE_REL AND (TODAY<DATE_LO OR TODAY>=DATE_HI)) THEN DO;

      684    12454    5                  CALL M$CLOSE(CLOSE_INP);

  12454  7 000673   000660 630400 1                  EPPR0   CLOSE_INP
         7 000674   050001 713400                    CLIMB   close
         7 000675   406000 401760                    pmme    nvectors=13

      685    12455    5                  IF MULTIPLE THEN

  12455  7 000676   202420 234100                    SZN     MULTIPLE,,AUTO
         7 000677   000456 604000 7                  TMI     BEAM_NEXT_FILE

      686    12456    5                     GOTO BEAM_NEXT_FILE;
      687    12457    5                    ELSE
      688    12458    5                     RETURN;

  12458  7 000700   000000 702200 xent               TSX2  ! X66_ARET

      689    12459    5                  END;
      690    12460    4               END;
      691    12461    3            END;

  12461  7 000701   200004 054100                    AOS     I,,AUTO
         7 000702   200004 236100                    LDQ     I,,AUTO
         7 000703   200005 116100                    CMPQ    J,,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:99   
         7 000704   000636 604400 7                  TMOZ    s:12446

      692    12462    2         END;

      693    12463
      694    12464        /****
      695    12465        *
      696    12466        *   Open the output DCB to the appropriate destination.  For normal beaming,
      697    12467        *   open to JE@wsn.  For beaming to an "external" node, open to JE@dirwsn
      698    12468        *   (if the directory lies on another system) or to a uniquely-named
      699    12469        *   file in .moveacct (if the directory lies on this system).
      700    12470        *
      701    12471        ****/
      702    12472
      703    12473    1      IF OPTS.OUT.NODE = VW_IAM#

  12473  7 000705   040000 106400                    CMPC    fill='040'O
         7 000706   000072 000010 xsym               ADSC9   VW_OPTIONS#+58           cn=0,n=8
         7 000707   000000 000010 xsym               ADSC9   VW_IAM#                  cn=0,n=8
         7 000710   000762 600000 7                  TZE     INTRASHIP_BEAMING

      704    12474    1        THEN
      705    12475    1         GOTO INTRASHIP_BEAMING;
      706    12476    1      NODEKEY.C=OPTS.OUT.NODE;

  12476  7 000711   040000 100400                    MLR     fill='040'O
         7 000712   000072 000010 xsym               ADSC9   VW_OPTIONS#+58           cn=0,n=8
         7 000713   000150 200010 1                  ADSC9   NODEKEY                  cn=1,n=8

      707    12477    1      CALL M$READ(READ_NODE) ALTRET(BEAM_BAD_DST);

  12477  7 000714   000074 630400 1                  EPPR0   READ_NODE
         7 000715   440000 713400                    CLIMB   alt,read
         7 000716   401400 401760                    pmme    nvectors=4
         7 000717   003225 702000 7                  TSX2    BEAM_BAD_DST

      708    12478    2      IF DCBADDR(DCBNUM(M$NODE))->DUMMY.ARS#=8 THEN DO;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:100  

  12478  7 000720   000000 236007 xsym               LDQ     M$NODE,DL
         7 000721   000000 470400 8                  LDP0    0
         7 000722   000000 471500                    LDP1    0,,PR0
         7 000723   100000 473506                    LDP3    0,QL,PR1
         7 000724   300000 235100                    LDA     0,,PR3
         7 000725   000010 115007                    CMPA    8,DL
         7 000726   000742 601000 7                  TNZ     s:12485

      709    12479    2         IF NODEOVR.PATH_NAME = VW_IAM#

  12479  7 000727   040000 106400                    CMPC    fill='040'O
         7 000730   000153 000010 1                  ADSC9   NODEOVR                  cn=0,n=8
         7 000731   000000 000010 xsym               ADSC9   VW_IAM#                  cn=0,n=8
         7 000732   000762 600000 7                  TZE     INTRASHIP_BEAMING

      710    12480    2           THEN
      711    12481    2            GOTO INTRASHIP_BEAMING;
      712    12482    2         NODEKEY.C=NODEOVR.PATH_NAME;

  12482  7 000733   040000 100400                    MLR     fill='040'O
         7 000734   000153 000010 1                  ADSC9   NODEOVR                  cn=0,n=8
         7 000735   000150 200010 1                  ADSC9   NODEKEY                  cn=1,n=8

      713    12483    2         CALL M$READ(READ_NODE) ALTRET(BEAM_BAD_DST);

  12483  7 000736   000074 630400 1                  EPPR0   READ_NODE
         7 000737   440000 713400                    CLIMB   alt,read
         7 000740   401400 401760                    pmme    nvectors=4
         7 000741   003225 702000 7                  TSX2    BEAM_BAD_DST

      714    12484    2         END;

      715    12485    1      IF NODEOVR.TYPE_DEST = %N_EXTERNAL#

  12485  7 000742   000157 236000 1                  LDQ     NODEOVR+4
         7 000743   777000 376003                    ANQ     -512,DU
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:101  
         7 000744   157000 116003                    CMPQ    56832,DU
         7 000745   001104 601000 7                  TNZ     s:12526

      716    12486    2        THEN DO;

      717    12487    2         INTERNET = %YES#;

  12487  7 000746   400000 236003                    LDQ     -131072,DU
         7 000747   202425 756100                    STQ     INTERNET,,AUTO

      718    12488    2         EXTERNAL.SITENAME = NODEOVR.NODE_NAME;

  12488  7 000750   040100 100400                    MLR     fill='040'O
         7 000751   000155 000010 1                  ADSC9   NODEOVR+2                cn=0,n=8
         7 000752   200156 000010                    ADSC9   EXTERNAL,,AUTO           cn=0,n=8

      719    12489    2         EXTERNAL.ACCT = NODEOVR.ACCT;

  12489  7 000753   040100 100400                    MLR     fill='040'O
         7 000754   000153 000010 1                  ADSC9   NODEOVR                  cn=0,n=8
         7 000755   200160 000010                    ADSC9   EXTERNAL+2,,AUTO         cn=0,n=8

      720    12490    2         IF EXTERNAL.SITENAME = VW_IAM#

  12490  7 000756   040000 106500                    CMPC    fill='040'O
         7 000757   200156 000010                    ADSC9   EXTERNAL,,AUTO           cn=0,n=8
         7 000760   000000 000010 xsym               ADSC9   VW_IAM#                  cn=0,n=8
         7 000761   001064 601000 7                  TNZ     s:12518

      721    12491    3           THEN DO;

      722    12492    3   INTRASHIP_BEAMING:
      723    12493    3            INTRASHIP = %YES#;

  12493  7 000762   400000 236003       INTRASHIP_B* LDQ     -131072,DU
         7 000763   202426 756100                    STQ     INTRASHIP,,AUTO

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:102  
      724    12494    3            CALL M$TIME (CLOCK_TO_UTS);

  12494  7 000764   000044 630400 3                  EPPR0   CLOCK_TO_UTS
         7 000765   020004 713400                    CLIMB   8196
         7 000766   402000 401760                    pmme    nvectors=5

      725    12495    3            CALL CONCAT (INTRASHIP_NAME.NAME#, 'MOVExxxxxxxx', VW_IAM#);

  12495  7 000767   040000 100400                    MLR     fill='040'O
         7 000770   000313 000014 3                  ADSC9   VO_INTERSYS_PASSWORD+17  cn=0,n=12
         7 000771   001102 200014 1                  ADSC9   INTRASHIP_NAME           cn=1,n=12
         7 000772   040000 100400                    MLR     fill='040'O
         7 000773   000000 000010 xsym               ADSC9   VW_IAM#                  cn=0,n=8
         7 000774   001105 200023 1                  ADSC9   INTRASHIP_NAME+3         cn=1,n=19

      726    12496    3            CALL BINCHAR (SUBSTR(INTRASHIP_NAME.NAME#, 4, 8), TODAY);

  12496  7 000775   001364 235000 1                  LDA     TODAY
         7 000776   000044 773000                    LRL     36
         7 000777   203426 757100                    STAQ    OFFSET+2,,AUTO
         7 001000   000000 301500                    BTD
         7 001001   203426 000010                    NDSC9   OFFSET+2,,AUTO           cn=0,s=lsgnf,sf=0,n=8
         7 001002   001103 230010 1                  NDSC9   INTRASHIP_NAME+1         cn=1,s=nosgn,sf=0,n=8

      727    12497    3            CALL INDEX (I, ' ', INTRASHIP_NAME.NAME#);

  12497  7 001003   000000 124400                    SCM     mask='000'O
         7 001004   001102 200037 1                  ADSC9   INTRASHIP_NAME           cn=1,n=31
         7 001005   000015 000001 8                  ADSC9   13                       cn=0,n=1
         7 001006   200004 000100                    ARG     I,,AUTO

      728    12498    3            INTRASHIP_NAME.L# = I;

  12498  7 001007   200004 236100                    LDQ     I,,AUTO
         7 001010   000033 736000                    QLS     27
         7 001011   001102 552040 1                  STBQ    INTRASHIP_NAME,'40'O

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:103  
      729    12499    3            CALL M$OPEN (OPEN_JE_INTRASHIP)

  12499  7 001012   001010 630400 1                  EPPR0   OPEN_JE_INTRASHIP
         7 001013   450000 713400                    CLIMB   alt,open
         7 001014   410400 401760                    pmme    nvectors=18
         7 001015   001017 702000 7                  TSX2    s:12501
         7 001016   001063 710000 7                  TRA     s:12516

      730    12500    4              WHENALTRETURN DO;

      731    12501    4               IF B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR.ERR# ~= %E$NEWFILE

  12501  7 001017   000000 470400 xsym               LDP0    B$TCB$
         7 001020   000000 471500                    LDP1    0,,PR0
         7 001021   100102 236100                    LDQ     66,,PR1
         7 001022   377770 376007                    ANQ     131064,DL
         7 001023   001730 116007                    CMPQ    984,DL
         7 001024   003233 601000 7                  TNZ     BEAM_BAD_NODE
         7 001025   000000 473400 xsym               LDP3    B$JIT$
         7 001026   300013 236100                    LDQ     11,,PR3
         7 001027   100000 316003                    CANQ    32768,DU
         7 001030   003233 601000 7                  TNZ     BEAM_BAD_NODE

      732    12502    4                 OR B$JIT.PRIV.ACTIVE.FMSEC
      733    12503    4                 THEN
      734    12504    4                  GOTO BEAM_BAD_NODE;
      735    12505    4               CALL M$SENV;

  12505  7 001031   010011 713400                    CLIMB   4105
         7 001032   000000 401760                    pmme    nvectors=0

      736    12506    4               CALL M$SPRIV (FMSEC) ALTRET (NOGOOD);

  12506  7 001033   000060 630400 3                  EPPR0   FMSEC
         7 001034   420012 713400                    CLIMB   alt,+8202
         7 001035   400000 401760                    pmme    nvectors=1
         7 001036   001044 702000 7                  TSX2    NOGOOD
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:104  

      737    12507    4               CALL M$OPEN (OPEN_JE_INTRASHIP)

  12507  7 001037   001010 630400 1                  EPPR0   OPEN_JE_INTRASHIP
         7 001040   450000 713400                    CLIMB   alt,open
         7 001041   410400 401760                    pmme    nvectors=18
         7 001042   001044 702000 7                  TSX2    NOGOOD
         7 001043   001054 710000 7                  TRA     s:12513

      738    12508    5                 WHENALTRETURN DO;

      739    12509    6   NOGOOD:        CALL M$RPRIV (FMSEC) WHENALTRETURN DO; END;

  12509  7 001044   000060 630400 3     NOGOOD       EPPR0   FMSEC
         7 001045   420013 713400                    CLIMB   alt,+8203
         7 001046   400000 401760                    pmme    nvectors=1
         7 001047   001051 702000 7                  TSX2    s:12510
         7 001050   001051 710000 7                  TRA     s:12510

      740    12510    5                  CALL M$RENV;

  12510  7 001051   010016 713400                    CLIMB   4110
         7 001052   000000 401760                    pmme    nvectors=0

      741    12511    5                  GOTO BEAM_BAD_NODE;

  12511  7 001053   003233 710000 7                  TRA     BEAM_BAD_NODE

      742    12512    5                  END;
      743    12513    5               CALL M$RPRIV (FMSEC) WHENALTRETURN DO; END;

  12513  7 001054   000060 630400 3                  EPPR0   FMSEC
         7 001055   420013 713400                    CLIMB   alt,+8203
         7 001056   400000 401760                    pmme    nvectors=1
         7 001057   001061 702000 7                  TSX2    s:12514
         7 001060   001061 710000 7                  TRA     s:12514

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:105  
      744    12514    4               CALL M$RENV;

  12514  7 001061   010016 713400                    CLIMB   4110
         7 001062   000000 401760                    pmme    nvectors=0

      745    12515    4               END;

      746    12516    3            END;

  12516  7 001063   001115 710000 7                  TRA     s:12538

      747    12517    3           ELSE DO;

      748    12518    3            INTRASHIP = %NO#;

  12518  7 001064   202426 450100                    STZ     INTRASHIP,,AUTO

      749    12519    3            NODEKEY.C = EXTERNAL.SITENAME;

  12519  7 001065   040000 100500                    MLR     fill='040'O
         7 001066   200156 000010                    ADSC9   EXTERNAL,,AUTO           cn=0,n=8
         7 001067   000150 200010 1                  ADSC9   NODEKEY                  cn=1,n=8

      750    12520    3            CALL M$READ (READ_NODE) ALTRET (BEAM_BAD_DST);

  12520  7 001070   000074 630400 1                  EPPR0   READ_NODE
         7 001071   440000 713400                    CLIMB   alt,read
         7 001072   401400 401760                    pmme    nvectors=4
         7 001073   003225 702000 7                  TSX2    BEAM_BAD_DST

      751    12521    3            WSN_JE.WSN# = NODEOVR.PATH_NAME;

  12521  7 001074   040000 100400                    MLR     fill='040'O
         7 001075   000153 000010 1                  ADSC9   NODEOVR                  cn=0,n=8
         7 001076   001112 000010 1                  ADSC9   WSN_JE                   cn=0,n=8

      752    12522    3            CALL M$OPEN (OPEN_JE) ALTRET (BEAM_BAD_NODE);
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:106  

  12522  7 001077   000716 630400 1                  EPPR0   OPEN_JE
         7 001100   450000 713400                    CLIMB   alt,open
         7 001101   410400 401760                    pmme    nvectors=18
         7 001102   003233 702000 7                  TSX2    BEAM_BAD_NODE

      753    12523    3            END;

      754    12524    2         END;

  12524  7 001103   001115 710000 7                  TRA     s:12538

      755    12525    2        ELSE DO;

      756    12526    2         INTERNET = %NO#;

  12526  7 001104   202425 450100                    STZ     INTERNET,,AUTO

      757    12527    2         INTRASHIP = %NO#;

  12527  7 001105   202426 450100                    STZ     INTRASHIP,,AUTO

      758    12528    2         WSN_JE.WSN# = NODEOVR.PATH_NAME;

  12528  7 001106   040000 100400                    MLR     fill='040'O
         7 001107   000153 000010 1                  ADSC9   NODEOVR                  cn=0,n=8
         7 001110   001112 000010 1                  ADSC9   WSN_JE                   cn=0,n=8

      759    12529    2         CALL M$OPEN (OPEN_JE) ALTRET (BEAM_BAD_NODE);

  12529  7 001111   000716 630400 1                  EPPR0   OPEN_JE
         7 001112   450000 713400                    CLIMB   alt,open
         7 001113   410400 401760                    pmme    nvectors=18
         7 001114   003233 702000 7                  TSX2    BEAM_BAD_NODE

      760    12530    2         END;

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:107  
      761    12531
      762    12532        /****
      763    12533        *
      764    12534        *   Tell the user he's MOVing.
      765    12535        *
      766    12536        ****/
      767    12537
      768    12538    1      CALL M$UNFID(UNFID_INP);

  12538  7 001115   000344 630400 1                  EPPR0   UNFID_INP
         7 001116   020021 713400                    CLIMB   8209
         7 001117   404400 401760                    pmme    nvectors=10

      769    12539    1      U1.L=I;

  12539  7 001120   200004 236100                    LDQ     I,,AUTO
         7 001121   000033 736000                    QLS     27
         7 001122   202224 552140                    STBQ    U1,'40'O,AUTO

      770    12540    2      IF SUBSTR(OPTS.OUT.FID,0,1)='''' THEN DO;

  12540  7 001123   000074 236000 xsym               LDQ     VW_OPTIONS#+60
         7 001124   000777 376003                    ANQ     511,DU
         7 001125   000047 116003                    CMPQ    39,DU
         7 001126   001137 601000 7                  TNZ     s:12545

      771    12541    2         U2.C=OPTS.OUT.FID;

  12541  7 001127   040100 100400                    MLR     fill='040'O
         7 001130   000074 200117 xsym               ADSC9   VW_OPTIONS#+60           cn=1,n=79
         7 001131   202250 200117                    ADSC9   U2,,AUTO                 cn=1,n=79

      772    12542    2         I=OPTS.OUT.L-ASCBIN('/');

  12542  7 001132   000074 236000 xsym               LDQ     VW_OPTIONS#+60
         7 001133   000033 772000                    QRL     27
         7 001134   000057 136007                    SBLQ    47,DL
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:108  
         7 001135   200004 756100                    STQ     I,,AUTO

      773    12543    2         END;

  12543  7 001136   001142 710000 7                  TRA     s:12546

      774    12544    1        ELSE
      775    12545    1         CALL M$UNFID(UNFID_MSG);

  12545  7 001137   000602 630400 1                  EPPR0   UNFID_MSG
         7 001140   020021 713400                    CLIMB   8209
         7 001141   404400 401760                    pmme    nvectors=10

      776    12546    1      U2.L=I;

  12546  7 001142   200004 236100                    LDQ     I,,AUTO
         7 001143   000033 736000                    QLS     27
         7 001144   202250 552140                    STBQ    U2,'40'O,AUTO

      777    12547    1      U3.C=OPTS.OUT.NODE;

  12547  7 001145   040100 100400                    MLR     fill='040'O
         7 001146   000072 000010 xsym               ADSC9   VW_OPTIONS#+58           cn=0,n=8
         7 001147   202274 200117                    ADSC9   U3,,AUTO                 cn=1,n=79

      778    12548    1      CALL INDEX(I,' ',OPTS.OUT.NODE);

  12548  7 001150   000000 124400                    SCM     mask='000'O
         7 001151   000072 000010 xsym               ADSC9   VW_OPTIONS#+58           cn=0,n=8
         7 001152   000015 000001 8                  ADSC9   13                       cn=0,n=1
         7 001153   200004 000100                    ARG     I,,AUTO

      779    12549    1      U3.L=I;

  12549  7 001154   200004 236100                    LDQ     I,,AUTO
         7 001155   000033 736000                    QLS     27
         7 001156   202274 552140                    STBQ    U3,'40'O,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:109  

      780    12550    1      CALL VWX$MAIL(%E$VWM_SEN,VECTOR(U1),VECTOR(U2),VECTOR(U3));

  12550  7 001157   000030 235000 8                  LDA     24
         7 001160   203426 452500                    STP2    OFFSET+2,,AUTO
         7 001161   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 001162   002224 036003                    ADLQ    1172,DU
         7 001163   203430 757100                    STAQ    OFFSET+4,,AUTO
         7 001164   000030 235000 8                  LDA     24
         7 001165   203432 452500                    STP2    OFFSET+6,,AUTO
         7 001166   203432 236100                    LDQ     OFFSET+6,,AUTO
         7 001167   002250 036003                    ADLQ    1192,DU
         7 001170   203434 757100                    STAQ    OFFSET+8,,AUTO
         7 001171   000030 235000 8                  LDA     24
         7 001172   203436 452500                    STP2    OFFSET+10,,AUTO
         7 001173   203436 236100                    LDQ     OFFSET+10,,AUTO
         7 001174   002274 036003                    ADLQ    1212,DU
         7 001175   203442 757100                    STAQ    OFFSET+14,,AUTO
         7 001176   203430 237100                    LDAQ    OFFSET+4,,AUTO
         7 001177   203440 757100                    STAQ    OFFSET+12,,AUTO
         7 001200   203434 237100                    LDAQ    OFFSET+8,,AUTO
         7 001201   203444 757100                    STAQ    OFFSET+16,,AUTO
         7 001202   203442 237100                    LDAQ    OFFSET+14,,AUTO
         7 001203   203446 757100                    STAQ    OFFSET+18,,AUTO
         7 001204   203446 630500                    EPPR0   OFFSET+18,,AUTO
         7 001205   203453 450500                    STP0    OFFSET+23,,AUTO
         7 001206   203444 631500                    EPPR1   OFFSET+16,,AUTO
         7 001207   203452 451500                    STP1    OFFSET+22,,AUTO
         7 001210   203440 633500                    EPPR3   OFFSET+12,,AUTO
         7 001211   203451 453500                    STP3    OFFSET+21,,AUTO
         7 001212   000033 236000 8                  LDQ     27
         7 001213   203450 756100                    STQ     OFFSET+20,,AUTO
         7 001214   203450 630500                    EPPR0   OFFSET+20,,AUTO
         7 001215   000031 631400 8                  EPPR1   25
         7 001216   000000 701000 xent               TSX1    VWX$MAIL
         7 001217   000000 011000                    NOP     0

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:110  
      781    12551
      782    12552        /****
      783    12553        *
      784    12554        *   Pick the options out of the OPTS block.
      785    12555        *
      786    12556        ****/
      787    12557
      788    12558    1      NLN=OPTS.INP.MISC.NLN;

  12558  7 001220   000021 236000 xsym               LDQ     VW_OPTIONS#+17
         7 001221   000043 736000                    QLS     35
         7 001222   202414 756100                    STQ     NLN,,AUTO

      789    12559    1      NSC=OPTS.INP.MISC.NSC;

  12559  7 001223   000021 236000 xsym               LDQ     VW_OPTIONS#+17
         7 001224   000041 736000                    QLS     33
         7 001225   400000 376003                    ANQ     -131072,DU
         7 001226   202416 756100                    STQ     NSC,,AUTO

      790    12560    1      NFA=OPTS.INP.MISC.NFA;

  12560  7 001227   000021 236000 xsym               LDQ     VW_OPTIONS#+17
         7 001230   000042 736000                    QLS     34
         7 001231   400000 376003                    ANQ     -131072,DU
         7 001232   202415 756100                    STQ     NFA,,AUTO

      791    12561    1      VW_SCRAMBLE#=OPTS.INP.MISC.TRAN;

  12561  7 001233   000021 236000 xsym               LDQ     VW_OPTIONS#+17
         7 001234   000040 736000                    QLS     32
         7 001235   400000 376003                    ANQ     -131072,DU
         7 001236   000000 756000 xsym               STQ     VW_SCRAMBLE#

      792    12562
      793    12563        /****
      794    12564        *
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:111  
      795    12565        *   Reset a whole bunch of stuff, then find the file's size.
      796    12566        *
      797    12567        ****/
      798    12568
      799    12569    1      JEBUF=' ';

  12569  7 001237   040100 100400                    MLR     fill='040'O
         7 001240   000015 000001 8                  ADSC9   13                       cn=0,n=1
         7 001241   202162 000120                    ADSC9   JEBUF,,AUTO              cn=0,n=80

      800    12570    1      VW_INPCNT#=0;

  12570  7 001242   000000 450000 xsym               STZ     VW_INPCNT#

      801    12571    1      JEIDX=0;

  12571  7 001243   200020 450100                    STZ     JEIDX,,AUTO

      802    12572    1      VW_BROKEN#=0;

  12572  7 001244   000000 450000 xsym               STZ     VW_BROKEN#

      803    12573    1      SOMETHING='0'B;

  12573  7 001245   202421 450100                    STZ     SOMETHING,,AUTO

      804    12574    1      RECSCOUNT=0;

  12574  7 001246   200016 450100                    STZ     RECSCOUNT,,AUTO

      805    12575    1      FILEORG=INPPTR->DUMMY.ORG#;

  12575  7 001247   200053 470500                    LDP0    INPPTR,,AUTO
         7 001250   000032 236100                    LDQ     26,,PR0
         7 001251   000033 772000                    QRL     27
         7 001252   200017 756100                    STQ     FILEORG,,AUTO

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:112  
      806    12576    1      J=ADDR(FITBUF)->FM$FIT.CODES.CODE(0);

  12576  7 001253   200162 236100                    LDQ     FITBUF,,AUTO
         7 001254   000037 772000                    QRL     31
         7 001255   200005 756100                    STQ     J,,AUTO

      807    12577    2      DO I=1 TO J;

  12577  7 001256   000001 235007                    LDA     1,DL
         7 001257   200004 755100                    STA     I,,AUTO
         7 001260   001302 710000 7                  TRA     s:12586+1

      808    12578    3         IF ADDR(FITBUF)->FM$FIT.CODES.CODE(I)=3 THEN DO;

  12578  7 001261   200004 720100                    LXL0    I,,AUTO
         7 001262   200162 236110                    LDQ     FITBUF,X0,AUTO
         7 001263   760000 376003                    ANQ     -8192,DU
         7 001264   060000 116003                    CMPQ    24576,DU
         7 001265   001301 601000 7                  TNZ     s:12586

      809    12579    3            K=ADDR(FITBUF)->FM$FIT.CODES.ITEMX(I);

  12579  7 001266   200162 236110                    LDQ     FITBUF,X0,AUTO
         7 001267   001777 376007                    ANQ     1023,DL
         7 001270   200006 756100                    STQ     K,,AUTO

      810    12580    3            VW_TOTBYTES#=PINCRW(ADDR(FITBUF),K)->CODE03.UGRANS*4096;

  12580  7 001271   200162 236106                    LDQ     FITBUF,QL,AUTO
         7 001272   000014 736000                    QLS     12
         7 001273   000000 756000 xsym               STQ     VW_TOTBYTES#

      811    12581    3            IF VW_TOTBYTES#<=0

  12581  7 001274   001300 604400 7                  TMOZ    s:12584
         7 001275   200006 721100                    LXL1    K,,AUTO
         7 001276   200166 234111                    SZN     FITBUF+4,X1,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:113  
         7 001277   001301 605000 7                  TPL     s:12586

      812    12582    3              OR PINCRW(ADDR(FITBUF),K)->CODE03.COMP
      813    12583    3              THEN
      814    12584    3               VW_TOTBYTES#=0;

  12584  7 001300   000000 450000 xsym               STZ     VW_TOTBYTES#

      815    12585    3            END;

      816    12586    2         END;

  12586  7 001301   200004 054100                    AOS     I,,AUTO
         7 001302   200004 236100                    LDQ     I,,AUTO
         7 001303   200005 116100                    CMPQ    J,,AUTO
         7 001304   001261 604400 7                  TMOZ    s:12578

      817    12587
      818    12588        /****
      819    12589        *
      820    12590        *   Process the NLN and NFA options
      821    12591        *
      822    12592        ****/
      823    12593
      824    12594    2      IF NLN THEN DO;

  12594  7 001305   202414 234100                    SZN     NLN,,AUTO
         7 001306   001357 605000 7                  TPL     s:12609

      825    12595    2         FILEORG=%CONSEC#;

  12595  7 001307   000001 235007                    LDA     1,DL
         7 001310   200017 755100                    STA     FILEORG,,AUTO

      826    12596    2         J=ADDR(FITBUF)->FM$FIT.CODES.CODE(0);

  12596  7 001311   200162 236100                    LDQ     FITBUF,,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:114  
         7 001312   000037 772000                    QRL     31
         7 001313   200005 756100                    STQ     J,,AUTO

      827    12597    3         DO I=1 TO J;

  12597  7 001314   200004 755100                    STA     I,,AUTO
         7 001315   001354 710000 7                  TRA     s:12607+1

      828    12598    4            IF ADDR(FITBUF)->FM$FIT.CODES.CODE(I)=3 THEN DO;

  12598  7 001316   200004 720100                    LXL0    I,,AUTO
         7 001317   200162 236110                    LDQ     FITBUF,X0,AUTO
         7 001320   760000 376003                    ANQ     -8192,DU
         7 001321   060000 116003                    CMPQ    24576,DU
         7 001322   001333 601000 7                  TNZ     s:12602

      829    12599    4               K=ADDR(FITBUF)->FM$FIT.CODES.ITEMX(I);

  12599  7 001323   200162 236110                    LDQ     FITBUF,X0,AUTO
         7 001324   001777 376007                    ANQ     1023,DL
         7 001325   200006 756100                    STQ     K,,AUTO

      830    12600    4               PINCRW(ADDR(FITBUF),K)->CODE03.ORG=%CONSEC#;

  12600  7 001326   000000 621006                    EAX1    0,QL
         7 001327   200162 236106                    LDQ     FITBUF,QL,AUTO
         7 001330   000034 376000 8                  ANQ     28
         7 001331   001000 276003                    ORQ     512,DU
         7 001332   200162 756111                    STQ     FITBUF,X1,AUTO

      831    12601    4               END;

      832    12602    3            IF ADDR(FITBUF)->FM$FIT.CODES.CODE(I)=8 THEN

  12602  7 001333   200004 720100                    LXL0    I,,AUTO
         7 001334   200162 236110                    LDQ     FITBUF,X0,AUTO
         7 001335   760000 376003                    ANQ     -8192,DU
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:115  
         7 001336   200000 116003                    CMPQ    65536,DU
         7 001337   001342 601000 7                  TNZ     s:12604

      833    12603    3               ADDR(FITBUF)->FM$FIT.CODES.CODE(I)=0;

  12603  7 001340   000035 236000 8                  LDQ     29
         7 001341   200162 356110                    ANSQ    FITBUF,X0,AUTO

      834    12604    3            IF ADDR(FITBUF)->FM$FIT.CODES.CODE(I)>18  AND

  12604  7 001342   200004 720100                    LXL0    I,,AUTO
         7 001343   200162 236110                    LDQ     FITBUF,X0,AUTO
         7 001344   760000 376003                    ANQ     -8192,DU
         7 001345   460000 116003                    CMPQ    -106496,DU
         7 001346   001353 602000 7                  TNC     s:12607
         7 001347   520000 116003                    CMPQ    -90112,DU
         7 001350   001353 603000 7                  TRC     s:12607

      835    12605    3              ADDR(FITBUF)->FM$FIT.CODES.CODE(I)<21 THEN
      836    12606    3               ADDR(FITBUF)->FM$FIT.CODES.CODE(I)=0;

  12606  7 001351   000035 236000 8                  LDQ     29
         7 001352   200162 356110                    ANSQ    FITBUF,X0,AUTO

      837    12607    3            END;

  12607  7 001353   200004 054100                    AOS     I,,AUTO
         7 001354   200004 236100                    LDQ     I,,AUTO
         7 001355   200005 116100                    CMPQ    J,,AUTO
         7 001356   001316 604400 7                  TMOZ    s:12598

      838    12608    2         END;

      839    12609    2      IF NFA THEN DO;

  12609  7 001357   202415 234100                    SZN     NFA,,AUTO
         7 001360   001416 605000 7                  TPL     s:12630
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:116  

      840    12610    2         J=ADDR(FITBUF)->FM$FIT.CODES.CODE(0);

  12610  7 001361   200162 236100                    LDQ     FITBUF,,AUTO
         7 001362   000037 772000                    QRL     31
         7 001363   200005 756100                    STQ     J,,AUTO

      841    12611    3         DO I=1 TO J;

  12611  7 001364   000001 235007                    LDA     1,DL
         7 001365   200004 755100                    STA     I,,AUTO
         7 001366   001413 710000 7                  TRA     s:12619+1

      842    12612    4            IF ADDR(FITBUF)->FM$FIT.CODES.CODE(I)=3 THEN DO;

  12612  7 001367   200004 720100                    LXL0    I,,AUTO
         7 001370   200162 236110                    LDQ     FITBUF,X0,AUTO
         7 001371   760000 376003                    ANQ     -8192,DU
         7 001372   060000 116003                    CMPQ    24576,DU
         7 001373   001401 601000 7                  TNZ     s:12616

      843    12613    4               K=ADDR(FITBUF)->FM$FIT.CODES.ITEMX(I);

  12613  7 001374   200162 236110                    LDQ     FITBUF,X0,AUTO
         7 001375   001777 376007                    ANQ     1023,DL
         7 001376   200006 756100                    STQ     K,,AUTO

      844    12614    4               PINCRW(ADDR(FITBUF),K)->CODE03.EXPIRE=0;

  12614  7 001377   000000 221003                    LDX1    0,DU
         7 001400   200171 741106                    STX1    FITBUF+7,QL,AUTO

      845    12615    4               END;

      846    12616    3            IF ADDR(FITBUF)->FM$FIT.CODES.CODE(I)>8 AND

  12616  7 001401   200004 720100                    LXL0    I,,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:117  
         7 001402   200162 236110                    LDQ     FITBUF,X0,AUTO
         7 001403   760000 376003                    ANQ     -8192,DU
         7 001404   220000 116003                    CMPQ    73728,DU
         7 001405   001412 602000 7                  TNC     s:12619
         7 001406   260000 116003                    CMPQ    90112,DU
         7 001407   001412 603000 7                  TRC     s:12619

      847    12617    3              ADDR(FITBUF)->FM$FIT.CODES.CODE(I)<11 THEN
      848    12618    3               ADDR(FITBUF)->FM$FIT.CODES.NDW(I)=0;

  12618  7 001410   000036 236000 8                  LDQ     30
         7 001411   200162 356110                    ANSQ    FITBUF,X0,AUTO

      849    12619    3            END;

  12619  7 001412   200004 054100                    AOS     I,,AUTO
         7 001413   200004 236100                    LDQ     I,,AUTO
         7 001414   200005 116100                    CMPQ    J,,AUTO
         7 001415   001367 604400 7                  TMOZ    s:12612

      850    12620    2         END;

      851    12621
      852    12622        /****
      853    12623        *
      854    12624        *   If we're involved in an internet (external-node) transfer, then
      855    12625        *   go off and play footsie with the FIT information and the output
      856    12626        *   options.
      857    12627        *
      858    12628        ****/
      859    12629
      860    12630    1      IF INTERNET

  12630  7 001416   202425 234100                    SZN     INTERNET,,AUTO
         7 001417   001422 605000 7                  TPL     s:12640

      861    12631    1        THEN
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:118  
      862    12632    1         CALL FIDDLE_FIT ALTRET (BEAM_USRERR);

  12632  7 001420   003430 701000 7                  TSX1    FIDDLE_FIT
         7 001421   003275 702000 7                  TSX2    BEAM_USRERR

      863    12633
      864    12634        /****
      865    12635        *
      866    12636        *   Generate an appropriate header.
      867    12637        *
      868    12638        ****/
      869    12639
      870    12640    1      IF NOT INTRASHIP

  12640  7 001422   202426 234100                    SZN     INTRASHIP,,AUTO
         7 001423   001444 604000 7                  TMI     s:12652

      871    12641    2        THEN DO;

      872    12642    2         I=NODEOVR.TYPE_PATH;

  12642  7 001424   000157 236000 1                  LDQ     NODEOVR+4
         7 001425   000011 772000                    QRL     9
         7 001426   000777 376007                    ANQ     511,DL
         7 001427   200004 756100                    STQ     I,,AUTO

      873    12643    2         CALL VWH$HEADER(DCBNUM(M$JE),JEBUF,I) ALTRET(BEAM_BAD_WRJ);

  12643  7 001430   000000 236007 xsym               LDQ     M$JE,DL
         7 001431   203426 756100                    STQ     OFFSET+2,,AUTO
         7 001432   200004 630500                    EPPR0   I,,AUTO
         7 001433   203431 450500                    STP0    OFFSET+5,,AUTO
         7 001434   202162 631500                    EPPR1   JEBUF,,AUTO
         7 001435   203430 451500                    STP1    OFFSET+4,,AUTO
         7 001436   203426 633500                    EPPR3   OFFSET+2,,AUTO
         7 001437   203427 453500                    STP3    OFFSET+3,,AUTO
         7 001440   203427 630500                    EPPR0   OFFSET+3,,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:119  
         7 001441   000037 631400 8                  EPPR1   31
         7 001442   000000 701000 xent               TSX1    VWH$HEADER
         7 001443   003241 702000 7                  TSX2    BEAM_BAD_WRJ

      874    12644    2         END;

      875    12645
      876    12646        /****
      877    12647        *
      878    12648        *   Write out the header blocks.
      879    12649        *
      880    12650        ****/
      881    12651
      882    12652    1      JEBUF=CARD(2);

  12652  7 001444   040100 100400                    MLR     fill='040'O
         7 001445   000050 000120 xsym               ADSC9   VW_OPTIONS#+40           cn=0,n=80
         7 001446   202162 000120                    ADSC9   JEBUF,,AUTO              cn=0,n=80

      883    12653    1      IF VW_SCRAMBLE# THEN

  12653  7 001447   000000 234000 xsym               SZN     VW_SCRAMBLE#
         7 001450   001457 605000 7                  TPL     s:12655

      884    12654    1         CALL VWO$TRANSO(JEBUF);

  12654  7 001451   202162 630500                    EPPR0   JEBUF,,AUTO
         7 001452   203426 450500                    STP0    OFFSET+2,,AUTO
         7 001453   203426 630500                    EPPR0   OFFSET+2,,AUTO
         7 001454   000024 631400 8                  EPPR1   20
         7 001455   000000 701000 xent               TSX1    VWO$TRANSO
         7 001456   000000 011000                    NOP     0

      885    12655    1      CALL M$WRITE(WRITE_JE) ALTRET(BEAM_BAD_WRJ);

  12655  7 001457   001114 630400 1                  EPPR0   WRITE_JE
         7 001460   440001 713400                    CLIMB   alt,write
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:120  
         7 001461   401400 401760                    pmme    nvectors=4
         7 001462   003241 702000 7                  TSX2    BEAM_BAD_WRJ

      886    12656    1      JEBUF=CARD(3);

  12656  7 001463   040100 100400                    MLR     fill='040'O
         7 001464   000074 000120 xsym               ADSC9   VW_OPTIONS#+60           cn=0,n=80
         7 001465   202162 000120                    ADSC9   JEBUF,,AUTO              cn=0,n=80

      887    12657    1      IF VW_SCRAMBLE# THEN

  12657  7 001466   000000 234000 xsym               SZN     VW_SCRAMBLE#
         7 001467   001476 605000 7                  TPL     s:12659

      888    12658    1         CALL VWO$TRANSO(JEBUF);

  12658  7 001470   202162 630500                    EPPR0   JEBUF,,AUTO
         7 001471   203426 450500                    STP0    OFFSET+2,,AUTO
         7 001472   203426 630500                    EPPR0   OFFSET+2,,AUTO
         7 001473   000024 631400 8                  EPPR1   20
         7 001474   000000 701000 xent               TSX1    VWO$TRANSO
         7 001475   000000 011000                    NOP     0

      889    12659    1      CALL M$WRITE(WRITE_JE) ALTRET(BEAM_BAD_WRJ);

  12659  7 001476   001114 630400 1                  EPPR0   WRITE_JE
         7 001477   440001 713400                    CLIMB   alt,write
         7 001500   401400 401760                    pmme    nvectors=4
         7 001501   003241 702000 7                  TSX2    BEAM_BAD_WRJ

      890    12660    1      VW_OUTCNT#=3;

  12660  7 001502   000003 235007                    LDA     3,DL
         7 001503   000000 755000 xsym               STA     VW_OUTCNT#

      891    12661
      892    12662        /****
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:121  
      893    12663        *
      894    12664        *   Send the MAIL records only if mail was requested.
      895    12665        *
      896    12666        ****/
      897    12667
      898    12668    2      IF OPTS.MAILRCVR.WHO~=' ' THEN DO;

  12668  7 001504   000171 236000 xsym               LDQ     VW_OPTIONS#+121
         7 001505   777000 376003                    ANQ     -512,DU
         7 001506   040000 116003                    CMPQ    16384,DU
         7 001507   001550 600000 7                  TZE     s:12680

      899    12669    2         JEBUF=CARD(6);

  12669  7 001510   040100 100400                    MLR     fill='040'O
         7 001511   000170 000120 xsym               ADSC9   VW_OPTIONS#+120          cn=0,n=80
         7 001512   202162 000120                    ADSC9   JEBUF,,AUTO              cn=0,n=80

      900    12670    2         IF VW_SCRAMBLE# THEN

  12670  7 001513   000000 234000 xsym               SZN     VW_SCRAMBLE#
         7 001514   001523 605000 7                  TPL     s:12672

      901    12671    2            CALL VWO$TRANSO(JEBUF);

  12671  7 001515   202162 630500                    EPPR0   JEBUF,,AUTO
         7 001516   203426 450500                    STP0    OFFSET+2,,AUTO
         7 001517   203426 630500                    EPPR0   OFFSET+2,,AUTO
         7 001520   000024 631400 8                  EPPR1   20
         7 001521   000000 701000 xent               TSX1    VWO$TRANSO
         7 001522   000000 011000                    NOP     0

      902    12672    2         CALL M$WRITE(WRITE_JE) ALTRET(BEAM_BAD_WRJ);

  12672  7 001523   001114 630400 1                  EPPR0   WRITE_JE
         7 001524   440001 713400                    CLIMB   alt,write
         7 001525   401400 401760                    pmme    nvectors=4
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:122  
         7 001526   003241 702000 7                  TSX2    BEAM_BAD_WRJ

      903    12673    2         JEBUF=CARD(7);

  12673  7 001527   040100 100400                    MLR     fill='040'O
         7 001530   000214 000120 xsym               ADSC9   VW_OPTIONS#+140          cn=0,n=80
         7 001531   202162 000120                    ADSC9   JEBUF,,AUTO              cn=0,n=80

      904    12674    2         IF VW_SCRAMBLE# THEN

  12674  7 001532   000000 234000 xsym               SZN     VW_SCRAMBLE#
         7 001533   001542 605000 7                  TPL     s:12676

      905    12675    2            CALL VWO$TRANSO(JEBUF);

  12675  7 001534   202162 630500                    EPPR0   JEBUF,,AUTO
         7 001535   203426 450500                    STP0    OFFSET+2,,AUTO
         7 001536   203426 630500                    EPPR0   OFFSET+2,,AUTO
         7 001537   000024 631400 8                  EPPR1   20
         7 001540   000000 701000 xent               TSX1    VWO$TRANSO
         7 001541   000000 011000                    NOP     0

      906    12676    2         CALL M$WRITE(WRITE_JE) ALTRET(BEAM_BAD_WRJ);

  12676  7 001542   001114 630400 1                  EPPR0   WRITE_JE
         7 001543   440001 713400                    CLIMB   alt,write
         7 001544   401400 401760                    pmme    nvectors=4
         7 001545   003241 702000 7                  TSX2    BEAM_BAD_WRJ

      907    12677    2         VW_OUTCNT#=VW_OUTCNT#+2;

  12677  7 001546   000002 236007                    LDQ     2,DL
         7 001547   000000 056000 xsym               ASQ     VW_OUTCNT#

      908    12678    2         END;

      909    12679
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:123  
      910    12680    2      IF OPTS.MAILINIT.WHO~=' ' THEN DO;

  12680  7 001550   000241 236000 xsym               LDQ     VW_OPTIONS#+161
         7 001551   777000 376003                    ANQ     -512,DU
         7 001552   040000 116003                    CMPQ    16384,DU
         7 001553   001614 600000 7                  TZE     s:12698

      911    12681    2         JEBUF=CARD(8);

  12681  7 001554   040100 100400                    MLR     fill='040'O
         7 001555   000240 000120 xsym               ADSC9   VW_OPTIONS#+160          cn=0,n=80
         7 001556   202162 000120                    ADSC9   JEBUF,,AUTO              cn=0,n=80

      912    12682    2         IF VW_SCRAMBLE# THEN

  12682  7 001557   000000 234000 xsym               SZN     VW_SCRAMBLE#
         7 001560   001567 605000 7                  TPL     s:12684

      913    12683    2            CALL VWO$TRANSO(JEBUF);

  12683  7 001561   202162 630500                    EPPR0   JEBUF,,AUTO
         7 001562   203426 450500                    STP0    OFFSET+2,,AUTO
         7 001563   203426 630500                    EPPR0   OFFSET+2,,AUTO
         7 001564   000024 631400 8                  EPPR1   20
         7 001565   000000 701000 xent               TSX1    VWO$TRANSO
         7 001566   000000 011000                    NOP     0

      914    12684    2         CALL M$WRITE(WRITE_JE) ALTRET(BEAM_BAD_WRJ);

  12684  7 001567   001114 630400 1                  EPPR0   WRITE_JE
         7 001570   440001 713400                    CLIMB   alt,write
         7 001571   401400 401760                    pmme    nvectors=4
         7 001572   003241 702000 7                  TSX2    BEAM_BAD_WRJ

      915    12685    2         JEBUF=CARD(9);

  12685  7 001573   040100 100400                    MLR     fill='040'O
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:124  
         7 001574   000264 000120 xsym               ADSC9   VW_OPTIONS#+180          cn=0,n=80
         7 001575   202162 000120                    ADSC9   JEBUF,,AUTO              cn=0,n=80

      916    12686    2         IF VW_SCRAMBLE# THEN

  12686  7 001576   000000 234000 xsym               SZN     VW_SCRAMBLE#
         7 001577   001606 605000 7                  TPL     s:12688

      917    12687    2            CALL VWO$TRANSO(JEBUF);

  12687  7 001600   202162 630500                    EPPR0   JEBUF,,AUTO
         7 001601   203426 450500                    STP0    OFFSET+2,,AUTO
         7 001602   203426 630500                    EPPR0   OFFSET+2,,AUTO
         7 001603   000024 631400 8                  EPPR1   20
         7 001604   000000 701000 xent               TSX1    VWO$TRANSO
         7 001605   000000 011000                    NOP     0

      918    12688    2         CALL M$WRITE(WRITE_JE) ALTRET(BEAM_BAD_WRJ);

  12688  7 001606   001114 630400 1                  EPPR0   WRITE_JE
         7 001607   440001 713400                    CLIMB   alt,write
         7 001610   401400 401760                    pmme    nvectors=4
         7 001611   003241 702000 7                  TSX2    BEAM_BAD_WRJ

      919    12689    2         VW_OUTCNT#=VW_OUTCNT#+2;

  12689  7 001612   000002 236007                    LDQ     2,DL
         7 001613   000000 056000 xsym               ASQ     VW_OUTCNT#

      920    12690    2         END;

      921    12691
      922    12692        /****
      923    12693        *
      924    12694        *   Send the character-transparency test pattern.
      925    12695        *
      926    12696        ****/
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:125  
      927    12697
      928    12698    1      JEBUF = ' ';

  12698  7 001614   040100 100400                    MLR     fill='040'O
         7 001615   000015 000001 8                  ADSC9   13                       cn=0,n=1
         7 001616   202162 000120                    ADSC9   JEBUF,,AUTO              cn=0,n=80

      929    12699    1      ADDR(JEBUF) -> OPTSCHAR.CMD = 'OPTS';

  12699  7 001617   000311 236000 3                  LDQ     VO_INTERSYS_PASSWORD+15
         7 001620   202162 756100                    STQ     JEBUF,,AUTO

      930    12700    1      ADDR(JEBUF) -> OPTSCHAR.SUB = 'CHAR';

  12700  7 001621   000316 236000 3                  LDQ     VO_INTERSYS_PASSWORD+20
         7 001622   202163 756100                    STQ     JEBUF+1,,AUTO

      931    12701    1      ADDR(JEBUF) -> OPTSCHAR.PATTERN = %VW_PATTERN#;

  12701  7 001623   040100 100400                    MLR     fill='040'O
         7 001624   000317 000037 3                  ADSC9   VO_INTERSYS_PASSWORD+21  cn=0,n=31
         7 001625   202164 000037                    ADSC9   JEBUF+2,,AUTO            cn=0,n=31

      932    12702    1      IF VW_SCRAMBLE# THEN

  12702  7 001626   000000 234000 xsym               SZN     VW_SCRAMBLE#
         7 001627   001636 605000 7                  TPL     s:12704

      933    12703    1         CALL VWO$TRANSO (JEBUF);

  12703  7 001630   202162 630500                    EPPR0   JEBUF,,AUTO
         7 001631   203426 450500                    STP0    OFFSET+2,,AUTO
         7 001632   203426 630500                    EPPR0   OFFSET+2,,AUTO
         7 001633   000024 631400 8                  EPPR1   20
         7 001634   000000 701000 xent               TSX1    VWO$TRANSO
         7 001635   000000 011000                    NOP     0

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:126  
      934    12704    1      CALL M$WRITE (WRITE_JE) ALTRET (BEAM_BAD_WRJ);

  12704  7 001636   001114 630400 1                  EPPR0   WRITE_JE
         7 001637   440001 713400                    CLIMB   alt,write
         7 001640   401400 401760                    pmme    nvectors=4
         7 001641   003241 702000 7                  TSX2    BEAM_BAD_WRJ

      935    12705    1      VW_OUTCNT# = VW_OUTCNT# + 1;

  12705  7 001642   000000 054000 xsym               AOS     VW_OUTCNT#

      936    12706
      937    12707        /****
      938    12708        *
      939    12709        *   Send the file's FIT.
      940    12710        *
      941    12711        ****/
      942    12712
      943    12713    1      INPLIM=4*ADDR(FITBUF)->FM$FIT.CODES.NDW(0);

  12713  7 001643   200162 236100                    LDQ     FITBUF,,AUTO
         7 001644   000010 772000                    QRL     8
         7 001645   007774 376007                    ANQ     4092,DL
         7 001646   200021 756100                    STQ     INPLIM,,AUTO

      944    12714    1      CALL FORMAT(FITBUF,INPLIM,INPLIM,'0'B,'1'B) ALTRET(BEAM_BAD_WRJ);

  12714  7 001647   000042 237000 8                  LDAQ    34
         7 001650   202434 757100                    STAQ    @MXS+1,,AUTO
         7 001651   200021 630500                    EPPR0   INPLIM,,AUTO
         7 001652   202433 450500                    STP0    @SIZ+1,,AUTO
         7 001653   200021 631500                    EPPR1   INPLIM,,AUTO
         7 001654   202432 451500                    STP1    @BFR+1,,AUTO
         7 001655   200162 633500                    EPPR3   FITBUF,,AUTO
         7 001656   202431 453500                    STP3    INTRASHIP+3,,AUTO
         7 001657   004062 701000 7                  TSX1    FORMAT
         7 001660   003241 702000 7                  TSX2    BEAM_BAD_WRJ
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:127  

      945    12715
      946    12716        /****
      947    12717        *
      948    12718        *   Set up the switches according to file type and check that the
      949    12719        *   file being transported is legal to go to this node.
      950    12720        *
      951    12721        ****/
      952    12722
      953    12723    2      DO CASE(FILEORG);

  12723  7 001661   200017 235100                    LDA     FILEORG,,AUTO
         7 001662   000016 115007                    CMPA    14,DL
         7 001663   001665 602005 7                  TNC     s:12723+4,AL
         7 001664   002020 710000 7                  TRA     s:12794
         7 001665   002020 710000 7                  TRA     s:12794
         7 001666   001703 710000 7                  TRA     s:12733
         7 001667   001714 710000 7                  TRA     s:12744
         7 001670   001732 710000 7                  TRA     s:12756
         7 001671   001703 710000 7                  TRA     s:12733
         7 001672   001750 710000 7                  TRA     s:12768
         7 001673   001703 710000 7                  TRA     s:12733
         7 001674   002002 710000 7                  TRA     s:12782
         7 001675   001703 710000 7                  TRA     s:12733
         7 001676   002020 710000 7                  TRA     s:12794
         7 001677   002020 710000 7                  TRA     s:12794
         7 001700   002020 710000 7                  TRA     s:12794
         7 001701   002020 710000 7                  TRA     s:12794
         7 001702   001703 710000 7                  TRA     s:12733

      954    12724
      955    12725        /****
      956    12726        *
      957    12727        *   Consecutive (and perversions thereof):  No keys, up to 1MB records,
      958    12728        *   no TSTAMP.
      959    12729        *
      960    12730        ****/
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:128  
      961    12731
      962    12732    2        CASE(%CONSEC#,%UR#,%INDEXED#,%TERMINAL#,%IREL#);

      963    12733    2         READ_INP.V.KEYR#='0'B;

  12733  7 001703   000041 236000 8                  LDQ     33
         7 001704   000640 356000 1                  ANSQ    READ_INP+8

      964    12734    2         READ_INP.BUF_.BOUND=32767;

  12734  7 001705   000634 236000 1                  LDQ     READ_INP+4
         7 001706   177777 376007                    ANQ     65535,DL
         7 001707   000044 276000 8                  ORQ     36
         7 001710   000634 756000 1                  STQ     READ_INP+4

      965    12735    2         READ_INP.V.FULL#='0'B;

  12735  7 001711   000045 236000 8                  LDQ     37
         7 001712   000640 356000 1                  ANSQ    READ_INP+8
         7 001713   002021 710000 7                  TRA     BEAM_IGNORE

      966    12736
      967    12737        /****
      968    12738        *
      969    12739        *   Keyed files:  Keys, up to 1MB records, no TSTAMP.
      970    12740        *
      971    12741        ****/
      972    12742
      973    12743    2        CASE(%KEYED#);

      974    12744    2         READ_INP.V.KEYR#='1'B;

  12744  7 001714   100000 236007                    LDQ     32768,DL
         7 001715   000640 256000 1                  ORSQ    READ_INP+8

      975    12745    2         READ_INP.KEY_=VECTOR(KEYBUF);

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:129  
  12745  7 001716   000046 235000 8                  LDA     38
         7 001717   203426 452500                    STP2    OFFSET+2,,AUTO
         7 001720   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 001721   000056 036003                    ADLQ    46,DU
         7 001722   000632 757000 1                  STAQ    READ_INP+2

      976    12746    2         READ_INP.BUF_.BOUND=32767;

  12746  7 001723   000634 236000 1                  LDQ     READ_INP+4
         7 001724   177777 376007                    ANQ     65535,DL
         7 001725   000044 276000 8                  ORQ     36
         7 001726   000634 756000 1                  STQ     READ_INP+4

      977    12747    2         READ_INP.V.FULL#='0'B;

  12747  7 001727   000045 236000 8                  LDQ     37
         7 001730   000640 356000 1                  ANSQ    READ_INP+8
         7 001731   002021 710000 7                  TRA     BEAM_IGNORE

      978    12748
      979    12749        /****
      980    12750        *
      981    12751        *   Random:  (sort of) keys, 4092-byte records, no TSTAMP.
      982    12752        *
      983    12753        ****/
      984    12754
      985    12755    2        CASE(%RANDOM#);

      986    12756    2         READ_INP.V.KEYR#='1'B;

  12756  7 001732   100000 236007                    LDQ     32768,DL
         7 001733   000640 256000 1                  ORSQ    READ_INP+8

      987    12757    2         READ_INP.KEY_=VECTOR(RANREL);

  12757  7 001734   777640 235007                    LDA     -96,DL
         7 001735   203426 452500                    STP2    OFFSET+2,,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:130  
         7 001736   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 001737   002213 036003                    ADLQ    1163,DU
         7 001740   000632 757000 1                  STAQ    READ_INP+2

      988    12758    2         READ_INP.BUF_.BOUND=4091;

  12758  7 001741   000634 236000 1                  LDQ     READ_INP+4
         7 001742   177777 376007                    ANQ     65535,DL
         7 001743   000047 276000 8                  ORQ     39
         7 001744   000634 756000 1                  STQ     READ_INP+4

      989    12759    2         READ_INP.V.FULL#='0'B;

  12759  7 001745   000045 236000 8                  LDQ     37
         7 001746   000640 356000 1                  ANSQ    READ_INP+8
         7 001747   002021 710000 7                  TRA     BEAM_IGNORE

      990    12760
      991    12761        /****
      992    12762        *
      993    12763        *   Relative:  (sort of) keys, up to 1MB records, no TSTAMP.
      994    12764        *
      995    12765        ****/
      996    12766
      997    12767    2        CASE(%RELATIVE#);

      998    12768    2         READ_INP.V.KEYR#='1'B;

  12768  7 001750   100000 236007                    LDQ     32768,DL
         7 001751   000640 256000 1                  ORSQ    READ_INP+8

      999    12769    2         READ_INP.KEY_=VECTOR(RANREL);

  12769  7 001752   777640 235007                    LDA     -96,DL
         7 001753   203426 452500                    STP2    OFFSET+2,,AUTO
         7 001754   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 001755   002213 036003                    ADLQ    1163,DU
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:131  
         7 001756   000632 757000 1                  STAQ    READ_INP+2

     1000    12770    2         READ_INP.BUF_.BOUND=INPPTR->DUMMY.RECL#-1;

  12770  7 001757   200053 470500                    LDP0    INPPTR,,AUTO
         7 001760   000033 236100                    LDQ     27,,PR0
         7 001761   777777 376007                    ANQ     -1,DL
         7 001762   000001 136007                    SBLQ    1,DL
         7 001763   000020 736000                    QLS     16
         7 001764   000634 676000 1                  ERQ     READ_INP+4
         7 001765   000050 376000 8                  ANQ     40
         7 001766   000634 656000 1                  ERSQ    READ_INP+4

     1001    12771    2         IF READ_INP.BUF_.BOUND>32767 THEN

  12771  7 001767   000634 236000 1                  LDQ     READ_INP+4
         7 001770   000050 376000 8                  ANQ     40
         7 001771   020000 116003                    CMPQ    8192,DU
         7 001772   001777 602000 7                  TNC     s:12773

     1002    12772    2            READ_INP.BUF_.BOUND=32767;

  12772  7 001773   000634 236000 1                  LDQ     READ_INP+4
         7 001774   177777 376007                    ANQ     65535,DL
         7 001775   000044 276000 8                  ORQ     36
         7 001776   000634 756000 1                  STQ     READ_INP+4

     1003    12773    2         READ_INP.V.FULL#='0'B;

  12773  7 001777   000045 236000 8                  LDQ     37
         7 002000   000640 356000 1                  ANSQ    READ_INP+8
         7 002001   002021 710000 7                  TRA     BEAM_IGNORE

     1004    12774
     1005    12775        /****
     1006    12776        *
     1007    12777        *   IDS:  (sort of) keys, 4096-byte records, TSTAMP.
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:132  
     1008    12778        *
     1009    12779        ****/
     1010    12780
     1011    12781    2        CASE(%IDS#);

     1012    12782    2         READ_INP.V.KEYR#='1'B;

  12782  7 002002   100000 236007                    LDQ     32768,DL
         7 002003   000640 256000 1                  ORSQ    READ_INP+8

     1013    12783    2         READ_INP.KEY_=VECTOR(RANREL);

  12783  7 002004   777640 235007                    LDA     -96,DL
         7 002005   203426 452500                    STP2    OFFSET+2,,AUTO
         7 002006   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 002007   002213 036003                    ADLQ    1163,DU
         7 002010   000632 757000 1                  STAQ    READ_INP+2

     1014    12784    2         READ_INP.BUF_.BOUND=4095;

  12784  7 002011   000634 236000 1                  LDQ     READ_INP+4
         7 002012   177777 376007                    ANQ     65535,DL
         7 002013   000051 276000 8                  ORQ     41
         7 002014   000634 756000 1                  STQ     READ_INP+4

     1015    12785    2         READ_INP.V.FULL#='1'B;

  12785  7 002015   010000 236007                    LDQ     4096,DL
         7 002016   000640 256000 1                  ORSQ    READ_INP+8
         7 002017   002021 710000 7                  TRA     BEAM_IGNORE

     1016    12786
     1017    12787        /****
     1018    12788        *
     1019    12789        *   All the weird tape file orgs aren't valid.
     1020    12790        *
     1021    12791        ****/
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:133  
     1022    12792
     1023    12793    2        CASE(ELSE);

     1024    12794    2         GOTO BEAM_BAD_ORG;

  12794  7 002020   003222 710000 7                  TRA     BEAM_BAD_ORG

     1025    12795
     1026    12796    2        END;

     1027    12797
     1028    12798        /****
     1029    12799        *
     1030    12800        *   Read and write until EOF.
     1031    12801        *
     1032    12802        ****/
     1033    12803
     1034    12804    1   BEAM_IGNORE:
     1035    12805    2      DO WHILE('1'B);

  12805  7 002021                       BEAM_IGNORE  null
     1036    12806    2         READ_INP.V.DVBYTE.CONT#='0'B;

  12806  7 002021   000052 236000 8                  LDQ     42
         7 002022   000643 356000 1                  ANSQ    READ_INP+11

     1037    12807    2         INPLIM=0;

  12807  7 002023   200021 450100                    STZ     INPLIM,,AUTO

     1038    12808    2         ITSBIN='0'B;

  12808  7 002024   202417 450100                    STZ     ITSBIN,,AUTO

     1039    12809    3         CALL M$READ(READ_INP) WHENALTRETURN DO;

  12809  7 002025   000630 630400 1                  EPPR0   READ_INP
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:134  
         7 002026   440000 713400                    CLIMB   alt,read
         7 002027   401400 401760                    pmme    nvectors=4
         7 002030   002032 702000 7                  TSX2    BEAM_BAD_FM1
         7 002031   002107 710000 7                  TRA     s:12837

     1040    12810
     1041    12811        /****
     1042    12812        *
     1043    12813        *   Oops, something bad happened.  This may be EOF or LD.
     1044    12814        *
     1045    12815        ****/
     1046    12816
     1047    12817    3   BEAM_BAD_FM1:
     1048    12818    3            IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE=%E$EOT OR

  12818  7 002032   000000 470400 xsym  BEAM_BAD_FM1 LDP0    B$TCB$
         7 002033   000000 471500                    LDP1    0,,PR0
         7 002034   100102 236100                    LDQ     66,,PR1
         7 002035   377770 376007                    ANQ     131064,DL
         7 002036   000020 116007                    CMPQ    16,DL
         7 002037   002444 600000 7                  TZE     BEAM_INP_EOF
         7 002040   000060 116007                    CMPQ    48,DL
         7 002041   002444 600000 7                  TZE     BEAM_INP_EOF
         7 002042   000120 116007                    CMPQ    80,DL
         7 002043   002444 600000 7                  TZE     BEAM_INP_EOF

     1049    12819    3              B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE=%E$EOF OR
     1050    12820    3              B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE=%E$EOD THEN
     1051    12821    3               GOTO BEAM_INP_EOF;
     1052    12822    3            IF (FILEORG=%IDS# OR FILEORG=%RANDOM#) AND

  12822  7 002044   200017 235100                    LDA     FILEORG,,AUTO
         7 002045   000007 115007                    CMPA    7,DL
         7 002046   002051 600000 7                  TZE     s:12822+5
         7 002047   000003 115007                    CMPA    3,DL
         7 002050   002055 601000 7                  TNZ     s:12827
         7 002051   000110 116007                    CMPQ    72,DL
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:135  
         7 002052   002055 601000 7                  TNZ     s:12827

     1053    12823    4              B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE=%E$DI THEN DO;

     1054    12824    4               RECSCOUNT=RECSCOUNT+1;

  12824  7 002053   200016 054100                    AOS     RECSCOUNT,,AUTO

     1055    12825    4               GOTO BEAM_IGNORE;

  12825  7 002054   002021 710000 7                  TRA     BEAM_IGNORE

     1056    12826    4               END;
     1057    12827    3            IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE~=%E$LD THEN

  12827  7 002055   000070 116007                    CMPQ    56,DL
         7 002056   003236 601000 7                  TNZ     BEAM_BAD_INE

     1058    12828    3               GOTO BEAM_BAD_INE;
     1059    12829    3            ARS=INPPTR->DUMMY.ARS#;

  12829  7 002057   200053 473500                    LDP3    INPPTR,,AUTO
         7 002060   300000 235100                    LDA     0,,PR3
         7 002061   200022 755100                    STA     ARS,,AUTO

     1060    12830    3            INPLIM=INPLIM+ARS;

  12830  7 002062   200021 236100                    LDQ     INPLIM,,AUTO
         7 002063   200022 036100                    ADLQ    ARS,,AUTO
         7 002064   200021 756100                    STQ     INPLIM,,AUTO

     1061    12831    3            CALL SEARCH(I,J,BADCHARS,SUBSTR(INPBUF.C,0,ARS));

  12831  7 002065   000000 620005                    EAX0    0,AL
         7 002066   000000 164440                    TCT
         7 002067   001365 000010 1                  ADSC9   INPBUF                   cn=0,n=*X0
         7 002070   000065 000000 3                  ARG     BADCHARS
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:136  
         7 002071   200004 000100                    ARG     I,,AUTO
         7 002072   200004 235100                    LDA     I,,AUTO
         7 002073   000033 771000                    ARL     27
         7 002074   200005 755100                    STA     J,,AUTO
         7 002075   200004 551140                    STBA    I,'40'O,AUTO

     1062    12832    3            IF J>0 THEN

  12832  7 002076   002101 604400 7                  TMOZ    s:12834

     1063    12833    3               ITSBIN='1'B;

  12833  7 002077   400000 236003                    LDQ     -131072,DU
         7 002100   202417 756100                    STQ     ITSBIN,,AUTO

     1064    12834    3            READ_INP.V.DVBYTE.CONT#='1'B;

  12834  7 002101   001000 236003                    LDQ     512,DU
         7 002102   000643 256000 1                  ORSQ    READ_INP+11

     1065    12835    3            CALL M$READ(READ_INP) ALTRET(BEAM_BAD_FM1);

  12835  7 002103   000630 630400 1                  EPPR0   READ_INP
         7 002104   440000 713400                    CLIMB   alt,read
         7 002105   401400 401760                    pmme    nvectors=4
         7 002106   002032 702000 7                  TSX2    BEAM_BAD_FM1

     1066    12836    3            END;

     1067    12837    2         RECSCOUNT=RECSCOUNT+1;

  12837  7 002107   200016 054100                    AOS     RECSCOUNT,,AUTO

     1068    12838
     1069    12839        /****
     1070    12840        *
     1071    12841        *   Process the NSC option by ignoring schema records.
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:137  
     1072    12842        *
     1073    12843        ****/
     1074    12844
     1075    12845    2         IF NSC AND FILEORG=%KEYED# AND KEYBUF.L>=7 AND ASCBIT(SUBSTR

  12845  7 002110   202416 234100                    SZN     NSC,,AUTO
         7 002111   002135 605000 7                  TPL     s:12857
         7 002112   200017 235100                    LDA     FILEORG,,AUTO
         7 002113   000002 115007                    CMPA    2,DL
         7 002114   002135 601000 7                  TNZ     s:12857
         7 002115   200056 236100                    LDQ     KEYBUF,,AUTO
         7 002116   777000 376003                    ANQ     -512,DU
         7 002117   007000 116003                    CMPQ    3584,DU
         7 002120   002135 602000 7                  TNC     s:12857
         7 002121   200056 236100                    LDQ     KEYBUF,,AUTO
         7 002122   000011 736000                    QLS     9
         7 002123   777000 376003                    ANQ     -512,DU
         7 002124   777000 116003                    CMPQ    -512,DU
         7 002125   002135 601000 7                  TNZ     s:12857
         7 002126   200057 236100                    LDQ     KEYBUF+1,,AUTO
         7 002127   000011 772000                    QRL     9
         7 002130   000777 376007                    ANQ     511,DL
         7 002131   000013 116007                    CMPQ    11,DL
         7 002132   002135 602000 7                  TNC     s:12857
         7 002133   000020 116007                    CMPQ    16,DL
         7 002134   002415 602000 7                  TNC     BEAM_SKIP

     1076    12846    2           (KEYBUF.C,0,1))='777'O AND ASCBIN(SUBSTR(KEYBUF.C,5,1))>=11
     1077    12847    2           AND ASCBIN(SUBSTR(KEYBUF.C,5,1))<=15 THEN
     1078    12848    2            GOTO BEAM_SKIP;
     1079    12849
     1080    12850        /****
     1081    12851        *
     1082    12852        *   Process the record selections.  Note that we don't send the
     1083    12853        *   records in the order the user specified.
     1084    12854        *
     1085    12855        ****/
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:138  
     1086    12856
     1087    12857    3         IF RECX>0 THEN DO;

  12857  7 002135   200014 235100                    LDA     RECX,,AUTO
         7 002136   002165 604400 7                  TMOZ    s:12874

     1088    12858    3            I=0;

  12858  7 002137   200004 450100                    STZ     I,,AUTO

     1089    12859    4            DO WHILE(I<RECX);

  12859  7 002140   200004 236100                    LDQ     I,,AUTO
         7 002141   200014 116100                    CMPQ    RECX,,AUTO
         7 002142   002164 605000 7                  TPL     s:12864

     1090    12860    4               IF RECSCOUNT>=RECS.LO(I) AND RECSCOUNT<=RECS.HI(I) THEN

  12860  7 002143   200004 235100                    LDA     I,,AUTO
         7 002144   000001 735000                    ALS     1
         7 002145   200016 236100                    LDQ     RECSCOUNT,,AUTO
         7 002146   002160 604000 7                  TMI     s:12862
         7 002147   200026 116105                    CMPQ    RECS,AL,AUTO
         7 002150   002160 602000 7                  TNC     s:12862
         7 002151   000000 116003                    CMPQ    0,DU
         7 002152   002156 604000 7                  TMI     s:12861
         7 002153   200027 116105                    CMPQ    RECS+1,AL,AUTO
         7 002154   002156 600000 7                  TZE     s:12861
         7 002155   002160 603000 7                  TRC     s:12862

     1091    12861    4                  I=RECX;

  12861  7 002156   200014 235100                    LDA     RECX,,AUTO
         7 002157   200004 755100                    STA     I,,AUTO

     1092    12862    4               I=I+1;

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:139  
  12862  7 002160   200004 054100                    AOS     I,,AUTO

     1093    12863    4               END;

  12863  7 002161   200004 236100                    LDQ     I,,AUTO
         7 002162   200014 116100                    CMPQ    RECX,,AUTO
         7 002163   002143 604000 7                  TMI     s:12860

     1094    12864    3            IF I=RECX THEN

  12864  7 002164   002415 600000 7                  TZE     BEAM_SKIP

     1095    12865    3               GOTO BEAM_SKIP;
     1096    12866    3            END;

     1097    12867
     1098    12868        /****
     1099    12869        *
     1100    12870        *   Process keys for keyed files (or perversions thereof).
     1101    12871        *
     1102    12872        ****/
     1103    12873
     1104    12874    3         IF FILEORG=%KEYED# THEN DO;

  12874  7 002165   200017 235100                    LDA     FILEORG,,AUTO
         7 002166   000002 115007                    CMPA    2,DL
         7 002167   002242 601000 7                  TNZ     s:12883

     1105    12875    3            K=KEYBUF.L;

  12875  7 002170   200056 236100                    LDQ     KEYBUF,,AUTO
         7 002171   000033 772000                    QRL     27
         7 002172   200006 756100                    STQ     K,,AUTO

     1106    12876    3            VW_INPCNT#=VW_INPCNT#+K+4;

  12876  7 002173   000000 036000 xsym               ADLQ    VW_INPCNT#
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:140  
         7 002174   000004 036007                    ADLQ    4,DL
         7 002175   000000 756000 xsym               STQ     VW_INPCNT#

     1107    12877    3            CALL SEARCH(I,J,BADCHARS,SUBSTR(KEYBUF.C,0,K));

  12877  7 002176   200006 720100                    LXL0    K,,AUTO
         7 002177   000000 164540                    TCT
         7 002200   200056 200010                    ADSC9   KEYBUF,,AUTO             cn=1,n=*X0
         7 002201   000065 000000 3                  ARG     BADCHARS
         7 002202   200004 000100                    ARG     I,,AUTO
         7 002203   200004 235100                    LDA     I,,AUTO
         7 002204   000033 771000                    ARL     27
         7 002205   200005 755100                    STA     J,,AUTO
         7 002206   200004 551140                    STBA    I,'40'O,AUTO

     1108    12878    3            IF J>0 THEN

  12878  7 002207   002225 604400 7                  TMOZ    s:12881

     1109    12879    3               CALL FORMAT(KEYBUF.C,K,K,'0'B,'1'B) ALTRET(BEAM_BAD_WRJ);

  12879  7 002210   000042 237000 8                  LDAQ    34
         7 002211   202434 757100                    STAQ    @MXS+1,,AUTO
         7 002212   200006 630500                    EPPR0   K,,AUTO
         7 002213   202433 450500                    STP0    @SIZ+1,,AUTO
         7 002214   200006 631500                    EPPR1   K,,AUTO
         7 002215   202432 451500                    STP1    @BFR+1,,AUTO
         7 002216   203426 452500                    STP2    OFFSET+2,,AUTO
         7 002217   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 002220   000053 036000 8                  ADLQ    43
         7 002221   202431 756100                    STQ     INTRASHIP+3,,AUTO
         7 002222   004062 701000 7                  TSX1    FORMAT
         7 002223   003241 702000 7                  TSX2    BEAM_BAD_WRJ
         7 002224   002260 710000 7                  TRA     s:12885

     1110    12880    3              ELSE
     1111    12881    3               CALL FORMAT(KEYBUF.C,K,K,'0'B,'0'B) ALTRET(BEAM_BAD_WRJ);
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:141  

  12881  7 002225   000054 237000 8                  LDAQ    44
         7 002226   202434 757100                    STAQ    @MXS+1,,AUTO
         7 002227   200006 630500                    EPPR0   K,,AUTO
         7 002230   202433 450500                    STP0    @SIZ+1,,AUTO
         7 002231   200006 631500                    EPPR1   K,,AUTO
         7 002232   202432 451500                    STP1    @BFR+1,,AUTO
         7 002233   203426 452500                    STP2    OFFSET+2,,AUTO
         7 002234   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 002235   000053 036000 8                  ADLQ    43
         7 002236   202431 756100                    STQ     INTRASHIP+3,,AUTO
         7 002237   004062 701000 7                  TSX1    FORMAT
         7 002240   003241 702000 7                  TSX2    BEAM_BAD_WRJ

     1112    12882    3            END;

  12882  7 002241   002260 710000 7                  TRA     s:12885

     1113    12883    2           ELSE IF FILEORG=%RANDOM# OR FILEORG=%RELATIVE# OR FILEORG=%IDS# THEN

  12883  7 002242   000003 115007                    CMPA    3,DL
         7 002243   002250 600000 7                  TZE     s:12884
         7 002244   000005 115007                    CMPA    5,DL
         7 002245   002250 600000 7                  TZE     s:12884
         7 002246   000007 115007                    CMPA    7,DL
         7 002247   002260 601000 7                  TNZ     s:12885

     1114    12884    2               CALL FORMAT(RANREL,4,4,'0'B,'1'B) ALTRET(BEAM_BAD_WRJ);

  12884  7 002250   000042 237000 8                  LDAQ    34
         7 002251   202434 757100                    STAQ    @MXS+1,,AUTO
         7 002252   000060 237000 8                  LDAQ    48
         7 002253   202432 757100                    STAQ    @BFR+1,,AUTO
         7 002254   202213 630500                    EPPR0   RANREL,,AUTO
         7 002255   202431 450500                    STP0    INTRASHIP+3,,AUTO
         7 002256   004062 701000 7                  TSX1    FORMAT
         7 002257   003241 702000 7                  TSX2    BEAM_BAD_WRJ
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:142  

     1115    12885    2         JEIDX=JEIDX+1;

  12885  7 002260   200020 054100                    AOS     JEIDX,,AUTO

     1116    12886    2         IF JEIDX>79 THEN

  12886  7 002261   200020 235100                    LDA     JEIDX,,AUTO
         7 002262   000117 115007                    CMPA    79,DL
         7 002263   002266 604400 7                  TMOZ    s:12895

     1117    12887    2            CALL STUFF ALTRET(BEAM_BAD_WRJ);

  12887  7 002264   004754 701000 7                  TSX1    STUFF
         7 002265   003241 702000 7                  TSX2    BEAM_BAD_WRJ

     1118    12888
     1119    12889        /****
     1120    12890        *
     1121    12891        *   Process DVBYTE.
     1122    12892        *
     1123    12893        ****/
     1124    12894
     1125    12895    2         CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+BITBIN('00111000'B&

  12895  7 002266   200053 470500                    LDP0    INPPTR,,AUTO
         7 002267   000003 236100                    LDQ     3,,PR0
         7 002270   776000 376003                    ANQ     -1024,DU
         7 002271   160000 376003                    ANQ     57344,DU
         7 002272   000034 772000                    QRL     28
         7 002273   000040 036007                    ADLQ    32,DL
         7 002274   000033 736000                    QLS     27
         7 002275   000057 276000 8                  ORQ     47
         7 002276   203426 756100                    STQ     OFFSET+2,,AUTO
         7 002277   200020 235100                    LDA     JEIDX,,AUTO
         7 002300   040105 100500                    MLR     fill='040'O
         7 002301   203426 000004                    ADSC9   OFFSET+2,,AUTO           cn=0,n=4
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:143  
         7 002302   202162 000001                    ADSC9   JEBUF,A,AUTO             cn=0,n=1

     1126    12896    2           INPPTR->DUMMY.DVBYTE)));
     1127    12897
     1128    12898        /****
     1129    12899        *
     1130    12900        *   Now process record contents.
     1131    12901        *
     1132    12902        ****/
     1133    12903
     1134    12904    2         SOMETHING='1'B;

  12904  7 002303   400000 236003                    LDQ     -131072,DU
         7 002304   202421 756100                    STQ     SOMETHING,,AUTO

     1135    12905    2         ARS=INPPTR->DUMMY.ARS#;

  12905  7 002305   000000 235100                    LDA     0,,PR0
         7 002306   200022 755100                    STA     ARS,,AUTO

     1136    12906    2         INPLIM=INPLIM+ARS;

  12906  7 002307   200021 236100                    LDQ     INPLIM,,AUTO
         7 002310   200022 036100                    ADLQ    ARS,,AUTO
         7 002311   200021 756100                    STQ     INPLIM,,AUTO

     1137    12907    2         CALL SEARCH(I,J,BADCHARS,SUBSTR(INPBUF.C,0,ARS));

  12907  7 002312   000000 620005                    EAX0    0,AL
         7 002313   000000 164440                    TCT
         7 002314   001365 000010 1                  ADSC9   INPBUF                   cn=0,n=*X0
         7 002315   000065 000000 3                  ARG     BADCHARS
         7 002316   200004 000100                    ARG     I,,AUTO
         7 002317   200004 235100                    LDA     I,,AUTO
         7 002320   000033 771000                    ARL     27
         7 002321   200005 755100                    STA     J,,AUTO
         7 002322   200004 551140                    STBA    I,'40'O,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:144  

     1138    12908    2         IF J>0 THEN

  12908  7 002323   002326 604400 7                  TMOZ    s:12919

     1139    12909    2            ITSBIN='1'B;

  12909  7 002324   400000 236003                    LDQ     -131072,DU
         7 002325   202417 756100                    STQ     ITSBIN,,AUTO

     1140    12910
     1141    12911        /****
     1142    12912        *
     1143    12913        *   If the record was too big to fit in the buffer, we have to back
     1144    12914        *   up and reread it a chunk at a time.  Note that this doesn't work
     1145    12915        *   for compressed files.
     1146    12916        *
     1147    12917        ****/
     1148    12918
     1149    12919    3         IF ARS<INPLIM THEN DO;

  12919  7 002326   200022 236100                    LDQ     ARS,,AUTO
         7 002327   200021 116100                    CMPQ    INPLIM,,AUTO
         7 002330   002376 605000 7                  TPL     s:12940

     1150    12920    3            CALL M$PRECORD(PRECORD_INP);

  12920  7 002331   000646 630400 1                  EPPR0   PRECORD_INP
         7 002332   040003 713400                    CLIMB   16387
         7 002333   401000 401760                    pmme    nvectors=3

     1151    12921    3            READ_INP.V.DVBYTE.CONT#='0'B;

  12921  7 002334   000052 236000 8                  LDQ     42
         7 002335   000643 356000 1                  ANSQ    READ_INP+11

     1152    12922    4            CALL M$READ(READ_INP) WHENALTRETURN DO;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:145  

  12922  7 002336   000630 630400 1                  EPPR0   READ_INP
         7 002337   440000 713400                    CLIMB   alt,read
         7 002340   401400 401760                    pmme    nvectors=4
         7 002341   002343 702000 7                  TSX2    BEAM_BAD_FM2
         7 002342   002376 710000 7                  TRA     s:12940

     1153    12923
     1154    12924        /****
     1155    12925        *
     1156    12926        *   Something bad happened.  It might be EOF or LD, though.
     1157    12927        *
     1158    12928        ****/
     1159    12929
     1160    12930    4   BEAM_BAD_FM2:
     1161    12931    4               IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE~=%E$LD THEN

  12931  7 002343   000000 470400 xsym  BEAM_BAD_FM2 LDP0    B$TCB$
         7 002344   000000 471500                    LDP1    0,,PR0
         7 002345   100102 236100                    LDQ     66,,PR1
         7 002346   377770 376007                    ANQ     131064,DL
         7 002347   000070 116007                    CMPQ    56,DL
         7 002350   003236 601000 7                  TNZ     BEAM_BAD_INE

     1162    12932    4                  GOTO BEAM_BAD_INE;
     1163    12933    4               ARS=INPPTR->DUMMY.ARS#;

  12933  7 002351   200053 473500                    LDP3    INPPTR,,AUTO
         7 002352   300000 235100                    LDA     0,,PR3
         7 002353   200022 755100                    STA     ARS,,AUTO

     1164    12934    4               CALL FORMAT(INPBUF,ARS,INPLIM,READ_INP.V.DVBYTE.CONT#,ITSBIN)

  12934  7 002354   202417 631500                    EPPR1   ITSBIN,,AUTO
         7 002355   202435 451500                    STP1    @CONT+1,,AUTO
         7 002356   000062 236000 8                  LDQ     50
         7 002357   202434 756100                    STQ     @MXS+1,,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:146  
         7 002360   200021 634500                    EPPR4   INPLIM,,AUTO
         7 002361   202433 454500                    STP4    @SIZ+1,,AUTO
         7 002362   200022 635500                    EPPR5   ARS,,AUTO
         7 002363   202432 455500                    STP5    @BFR+1,,AUTO
         7 002364   000063 236000 8                  LDQ     51
         7 002365   202431 756100                    STQ     INTRASHIP+3,,AUTO
         7 002366   004062 701000 7                  TSX1    FORMAT
         7 002367   003241 702000 7                  TSX2    BEAM_BAD_WRJ

     1165    12935    4                 ALTRET(BEAM_BAD_WRJ);
     1166    12936    4               READ_INP.V.DVBYTE.CONT#='1'B;

  12936  7 002370   001000 236003                    LDQ     512,DU
         7 002371   000643 256000 1                  ORSQ    READ_INP+11

     1167    12937    4               CALL M$READ(READ_INP) ALTRET(BEAM_BAD_FM2);

  12937  7 002372   000630 630400 1                  EPPR0   READ_INP
         7 002373   440000 713400                    CLIMB   alt,read
         7 002374   401400 401760                    pmme    nvectors=4
         7 002375   002343 702000 7                  TSX2    BEAM_BAD_FM2

     1168    12938    4               END;

     1169    12939    3            END;

     1170    12940    2         ARS=INPPTR->DUMMY.ARS#;

  12940  7 002376   200053 470500                    LDP0    INPPTR,,AUTO
         7 002377   000000 235100                    LDA     0,,PR0
         7 002400   200022 755100                    STA     ARS,,AUTO

     1171    12941    2         CALL FORMAT(INPBUF,ARS,INPLIM,READ_INP.V.DVBYTE.CONT#,ITSBIN)

  12941  7 002401   202417 631500                    EPPR1   ITSBIN,,AUTO
         7 002402   202435 451500                    STP1    @CONT+1,,AUTO
         7 002403   000062 236000 8                  LDQ     50
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:147  
         7 002404   202434 756100                    STQ     @MXS+1,,AUTO
         7 002405   200021 633500                    EPPR3   INPLIM,,AUTO
         7 002406   202433 453500                    STP3    @SIZ+1,,AUTO
         7 002407   200022 634500                    EPPR4   ARS,,AUTO
         7 002410   202432 454500                    STP4    @BFR+1,,AUTO
         7 002411   000063 236000 8                  LDQ     51
         7 002412   202431 756100                    STQ     INTRASHIP+3,,AUTO
         7 002413   004062 701000 7                  TSX1    FORMAT
         7 002414   003241 702000 7                  TSX2    BEAM_BAD_WRJ

     1172    12942    2           ALTRET(BEAM_BAD_WRJ);
     1173    12943
     1174    12944        /****
     1175    12945        *
     1176    12946        *   Tally bytes sent, check to see if BREAK was hit, check CG read.
     1177    12947        *
     1178    12948        ****/
     1179    12949
     1180    12950    2   BEAM_SKIP:
     1181    12951    2         VW_INPCNT#=VW_INPCNT#+INPLIM+4;

  12951  7 002415   000000 236000 xsym  BEAM_SKIP    LDQ     VW_INPCNT#
         7 002416   200021 036100                    ADLQ    INPLIM,,AUTO
         7 002417   000004 036007                    ADLQ    4,DL
         7 002420   000000 756000 xsym               STQ     VW_INPCNT#

     1182    12952    2         IF VW_BROKEN#>0 THEN

  12952  7 002421   000000 235000 xsym               LDA     VW_BROKEN#
         7 002422   002426 604400 7                  TMOZ    s:12962

     1183    12953    2            CALL VWR$BREAK ALTRET(BEAM_ABORT);

  12953  7 002423   000007 631400 8                  EPPR1   7
         7 002424   000000 701000 xent               TSX1    VWR$BREAK
         7 002425   003330 702000 7                  TSX2    BEAM_ABORT

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:148  
     1184    12954
     1185    12955        /****
     1186    12956        *
     1187    12957        *   This module is part of MAIL, too.  If it is, check periodically to
     1188    12958        *   see if we need to read the comgroup.
     1189    12959        *
     1190    12960        ****/
     1191    12961
     1192    12962    2         IF ADDR(CHECKCG)~=ADDR(NIL) AND MOD(VW_INPCNT#,256)=0 THEN

  12962  7 002426   200003 236100                    LDQ     @CHECKCG,,AUTO
         7 002427   000064 116000 8                  CMPQ    52
         7 002430   002021 600000 7                  TZE     BEAM_IGNORE
         7 002431   000000 236000 xsym               LDQ     VW_INPCNT#
         7 002432   000400 506007                    DIV     256,DL
         7 002433   000044 733000                    LRS     36
         7 002434   000000 116003                    CMPQ    0,DU
         7 002435   002021 601000 7                  TNZ     BEAM_IGNORE

     1193    12963    2            CALL CHECKCG;

  12963  7 002436   200003 470500                    LDP0    @CHECKCG,,AUTO
         7 002437   000000 220100                    LDX0    0,,PR0
         7 002440   000007 631400 8                  EPPR1   7
         7 002441   000000 701010                    TSX1    0,X0
         7 002442   000000 011000                    NOP     0

     1194    12964
     1195    12965    2         END /* of read/write loop */;

  12965  7 002443   002021 710000 7                  TRA     BEAM_IGNORE

     1196    12966
     1197    12967        /****
     1198    12968        *
     1199    12969        *   We made it to EOF, so close up and go home.
     1200    12970        *
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:149  
     1201    12971        ****/
     1202    12972
     1203    12973    1   BEAM_INP_EOF:
     1204    12974
     1205    12975        /****
     1206    12976        *
     1207    12977        *   Finish out the last partial record, if necessary.
     1208    12978        *
     1209    12979        ****/
     1210    12980
     1211    12981    1      JEIDX=JEIDX+1;

  12981  7 002444   200020 054100       BEAM_INP_EOF AOS     JEIDX,,AUTO

     1212    12982    1      CALL STUFF ALTRET(BEAM_BAD_WRJ);

  12982  7 002445   004754 701000 7                  TSX1    STUFF
         7 002446   003241 702000 7                  TSX2    BEAM_BAD_WRJ

     1213    12983    1      CALL M$CLOSE(CLOSE_INP);

  12983  7 002447   000660 630400 1                  EPPR0   CLOSE_INP
         7 002450   050001 713400                    CLIMB   close
         7 002451   406000 401760                    pmme    nvectors=13

     1214    12984
     1215    12985        /****
     1216    12986        *
     1217    12987        *   Supply appropriate footer information.
     1218    12988        *
     1219    12989        ****/
     1220    12990
     1221    12991    1      I=NODEOVR.TYPE_PATH;

  12991  7 002452   000157 236000 1                  LDQ     NODEOVR+4
         7 002453   000011 772000                    QRL     9
         7 002454   000777 376007                    ANQ     511,DL
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:150  
         7 002455   200004 756100                    STQ     I,,AUTO

     1222    12992    1      CALL VWF$FOOTER(DCBNUM(M$JE),JEBUF,I) ALTRET(BEAM_BAD_WRJ);

  12992  7 002456   000000 236007 xsym               LDQ     M$JE,DL
         7 002457   203426 756100                    STQ     OFFSET+2,,AUTO
         7 002460   200004 630500                    EPPR0   I,,AUTO
         7 002461   203431 450500                    STP0    OFFSET+5,,AUTO
         7 002462   202162 631500                    EPPR1   JEBUF,,AUTO
         7 002463   203430 451500                    STP1    OFFSET+4,,AUTO
         7 002464   203426 633500                    EPPR3   OFFSET+2,,AUTO
         7 002465   203427 453500                    STP3    OFFSET+3,,AUTO
         7 002466   203427 630500                    EPPR0   OFFSET+3,,AUTO
         7 002467   000037 631400 8                  EPPR1   31
         7 002470   000000 701000 xent               TSX1    VWF$FOOTER
         7 002471   003241 702000 7                  TSX2    BEAM_BAD_WRJ

     1223    12993    1      CLOSE_JE.V.DISP#=%SAVE#;

  12993  7 002472   000002 236007                    LDQ     2,DL
         7 002473   001162 552004 1                  STBQ    CLOSE_JE+26,'04'O

     1224    12994    1      CALL M$CLOSE(CLOSE_JE) ALTRET(BEAM_BAD_INE);

  12994  7 002474   001130 630400 1                  EPPR0   CLOSE_JE
         7 002475   450001 713400                    CLIMB   alt,close
         7 002476   406000 401760                    pmme    nvectors=13
         7 002477   003236 702000 7                  TSX2    BEAM_BAD_INE

     1225    12995
     1226    12996        /****
     1227    12997        *
     1228    12998        *   For intrasystem beaming, simply tell the user that the file has
     1229    12999        *   been transferred;  there's no transmission time involved.
     1230    13000        *
     1231    13001        ****/
     1232    13002
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:151  
     1233    13003    1      IF INTRASHIP

  13003  7 002500   202426 234100                    SZN     INTRASHIP,,AUTO
         7 002501   002507 605000 7                  TPL     s:13015

     1234    13004    2        THEN DO;

     1235    13005    2         CALL VWX$MAIL (%E$VWM_INTRABEAM);

  13005  7 002502   000066 630400 8                  EPPR0   54
         7 002503   000024 631400 8                  EPPR1   20
         7 002504   000000 701000 xent               TSX1    VWX$MAIL
         7 002505   000000 011000                    NOP     0

     1236    13006    2         GOTO REPORT_SENT;

  13006  7 002506   003134 710000 7                  TRA     REPORT_SENT

     1237    13007    2         END;
     1238    13008
     1239    13009        /****
     1240    13010        *
     1241    13011        *   Determine the status of the packet and tell the user.
     1242    13012        *
     1243    13013        ****/
     1244    13014
     1245    13015    2      IF ADDR(CHECKCG)=ADDR(NIL) THEN DO;

  13015  7 002507   200003 236100                    LDQ     @CHECKCG,,AUTO
         7 002510   000064 116000 8                  CMPQ    52
         7 002511   003134 601000 7                  TNZ     REPORT_SENT

     1246    13016    2         TWORK=SUBSTR(JEPTR->DUMMY.NAME#.C,3,12);

  13016  7 002512   200054 470500                    LDP0    JEPTR,,AUTO
         7 002513   040100 100500                    MLR     fill='040'O
         7 002514   000011 000014                    ADSC9   9,,PR0                   cn=0,n=12
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:152  
         7 002515   202206 000014                    ADSC9   TWORK,,AUTO              cn=0,n=12

     1247    13017    2         I=0;

  13017  7 002516   200004 450100                    STZ     I,,AUTO

     1248    13018    3         DO WHILE(SUBSTR(TWORK,I,1)='0');

  13018  7 002517   002521 710000 7                  TRA     s:13020

     1249    13019    3            I=I+1;

  13019  7 002520   200004 054100                    AOS     I,,AUTO

     1250    13020    3            END;

  13020  7 002521   200004 235100                    LDA     I,,AUTO
         7 002522   040000 106505                    CMPC    fill='040'O
         7 002523   202206 000001                    ADSC9   TWORK,A,AUTO             cn=0,n=1
         7 002524   000067 000001 8                  ADSC9   55                       cn=0,n=1
         7 002525   002520 600000 7                  TZE     s:13019

     1251    13021    2         J=6;

  13021  7 002526   000006 236007                    LDQ     6,DL
         7 002527   200005 756100                    STQ     J,,AUTO

     1252    13022    3         DO WHILE(SUBSTR(TWORK,J,1)='0' AND J<11);

  13022  7 002530   002532 710000 7                  TRA     s:13024

     1253    13023    3            J=J+1;

  13023  7 002531   200005 054100                    AOS     J,,AUTO

     1254    13024    3            END;

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:153  
  13024  7 002532   200005 235100                    LDA     J,,AUTO
         7 002533   040000 106505                    CMPC    fill='040'O
         7 002534   202206 000001                    ADSC9   TWORK,A,AUTO             cn=0,n=1
         7 002535   000067 000001 8                  ADSC9   55                       cn=0,n=1
         7 002536   002541 601000 7                  TNZ     s:13025
         7 002537   000013 115007                    CMPA    11,DL
         7 002540   002531 604000 7                  TMI     s:13023

     1255    13025    2         CALL CONCAT(U4.C,SUBSTR(TWORK,I,6-I),'-',SUBSTR(TWORK,J,12-J));

  13025  7 002541   200004 720100                    LXL0    I,,AUTO
         7 002542   777771 620010                    EAX0    -7,X0
         7 002543   777777 660003                    ERX0    -1,DU
         7 002544   200004 236100                    LDQ     I,,AUTO
         7 002545   040100 100546                    MLR     fill='040'O
         7 002546   202206 000010                    ADSC9   TWORK,Q,AUTO             cn=0,n=*X0
         7 002547   202320 200117                    ADSC9   U4,,AUTO                 cn=1,n=79
         7 002550   000070 116000 8                  CMPQ    56
         7 002551   002573 604400 7                  TMOZ    s:13026
         7 002552   000111 621006                    EAX1    73,QL
         7 002553   200004 335100                    LCA     I,,AUTO
         7 002554   040145 100400                    MLR     fill='040'O
         7 002555   000014 000001 8                  ADSC9   12                       cn=0,n=1
         7 002556   202321 600011                    ADSC9   U4+1,A,AUTO              cn=3,n=*X1
         7 002557   200004 236100                    LDQ     I,,AUTO
         7 002560   000071 116000 8                  CMPQ    57
         7 002561   002573 604400 7                  TMOZ    s:13026
         7 002562   200005 720100                    LXL0    J,,AUTO
         7 002563   777763 620010                    EAX0    -13,X0
         7 002564   777777 660003                    ERX0    -1,DU
         7 002565   000110 621006                    EAX1    72,QL
         7 002566   200004 335100                    LCA     I,,AUTO
         7 002567   200005 236100                    LDQ     J,,AUTO
         7 002570   040145 100546                    MLR     fill='040'O
         7 002571   202206 000010                    ADSC9   TWORK,Q,AUTO             cn=0,n=*X0
         7 002572   202322 000011                    ADSC9   U4+2,A,AUTO              cn=0,n=*X1

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:154  
     1256    13026    2         U4.L=19-I-J;

  13026  7 002573   200004 236100                    LDQ     I,,AUTO
         7 002574   200005 036100                    ADLQ    J,,AUTO
         7 002575   000072 676000 8                  ERQ     58
         7 002576   000024 036007                    ADLQ    20,DL
         7 002577   000033 736000                    QLS     27
         7 002600   202320 552140                    STBQ    U4,'40'O,AUTO

     1257    13027
     1258    13028        /****
     1259    13029        *
     1260    13030        *   We must wait for a second to allow PRESCAN to get its act together.
     1261    13031        *
     1262    13032        ****/
     1263    13033
     1264    13034    2         CALL CHARBIN(I,SUBSTR(JEPTR->DUMMY.NAME#.C,3,6));

  13034  7 002601   200054 470500                    LDP0    JEPTR,,AUTO
         7 002602   000100 305500                    DTB
         7 002603   000011 030006                    NDSC9   9,,PR0                   cn=0,s=nosgn,sf=0,n=6
         7 002604   200004 000004                    NDSC9   I,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

     1265    13035    2         FPT_JOBSTATS.V.SYSID#=I;

  13035  7 002605   200004 235100                    LDA     I,,AUTO
         7 002606   001217 755000 1                  STA     FPT_JOBSTATS+25

     1266    13036    2         CALL CHARBIN(I,SUBSTR(JEPTR->DUMMY.NAME#.C,9,6));

  13036  7 002607   000100 305500                    DTB
         7 002610   000012 430006                    NDSC9   10,,PR0                  cn=2,s=nosgn,sf=0,n=6
         7 002611   200004 000004                    NDSC9   I,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

     1267    13037    2         FPT_JOBSTATS.V.NUM#=I;

  13037  7 002612   200004 720100                    LXL0    I,,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:155  
         7 002613   001222 740000 1                  STX0    FPT_JOBSTATS+28

     1268    13038    2         CALL M$WAIT(FPT_WAIT);

  13038  7 002614   001322 630400 1                  EPPR0   FPT_WAIT
         7 002615   020006 713400                    CLIMB   8198
         7 002616   400400 401760                    pmme    nvectors=2

     1269    13039    2         VLP_CRITERIA.WSN#=OPTS.OUT.NODE;

  13039  7 002617   040000 100400                    MLR     fill='040'O
         7 002620   000072 000010 xsym               ADSC9   VW_OPTIONS#+58           cn=0,n=8
         7 002621   001234 000010 1                  ADSC9   VLP_CRITERIA+2           cn=0,n=8

     1270    13040    2         CALL M$JOBSTATS(FPT_JOBSTATS);

  13040  7 002622   001166 630400 1                  EPPR0   FPT_JOBSTATS
         7 002623   170001 713400                    CLIMB   61441
         7 002624   405400 401760                    pmme    nvectors=12

     1271    13041
     1272    13042        /****
     1273    13043        *
     1274    13044        *   Compute the approximate time of transmission.  This is a real fudge.
     1275    13045        *
     1276    13046        ****/
     1277    13047
     1278    13048    2         I=(VW_OUTCNT#*84*NODEOVR.TIME+4096)/4096;

  13048  7 002625   000160 236000 1                  LDQ     NODEOVR+5
         7 002626   000022 772000                    QRL     18
         7 002627   000000 402000 xsym               MPY     VW_OUTCNT#
         7 002630   000124 402007                    MPY     84,DL
         7 002631   010000 036007                    ADLQ    4096,DL
         7 002632   010000 506007                    DIV     4096,DL
         7 002633   200004 756100                    STQ     I,,AUTO

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:156  
     1279    13049    3         IF I>=60000 THEN DO;

  13049  7 002634   165140 116007                    CMPQ    60000,DL
         7 002635   002644 604000 7                  TMI     s:13053

     1280    13050    3            TWORK=' hours.';

  13050  7 002636   040100 100400                    MLR     fill='040'O
         7 002637   000327 000007 3                  ADSC9   VO_INTERSYS_PASSWORD+29  cn=0,n=7
         7 002640   202206 000014                    ADSC9   TWORK,,AUTO              cn=0,n=12

     1281    13051    3            I=I/3600;

  13051  7 002641   007020 506007                    DIV     3600,DL
         7 002642   200004 756100                    STQ     I,,AUTO

     1282    13052    3            END;

  13052  7 002643   002657 710000 7                  TRA     s:13059

     1283    13053    3           ELSE IF I>=1000 THEN DO;

  13053  7 002644   001750 116007                    CMPQ    1000,DL
         7 002645   002654 604000 7                  TMI     s:13058

     1284    13054    3               TWORK=' minutes.';

  13054  7 002646   040100 100400                    MLR     fill='040'O
         7 002647   000331 000011 3                  ADSC9   VO_INTERSYS_PASSWORD+31  cn=0,n=9
         7 002650   202206 000014                    ADSC9   TWORK,,AUTO              cn=0,n=12

     1285    13055    3               I=I/60;

  13055  7 002651   000074 506007                    DIV     60,DL
         7 002652   200004 756100                    STQ     I,,AUTO

     1286    13056    3               END;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:157  

  13056  7 002653   002657 710000 7                  TRA     s:13059

     1287    13057    2              ELSE
     1288    13058    2               TWORK=' seconds.';

  13058  7 002654   040100 100400                    MLR     fill='040'O
         7 002655   000334 000011 3                  ADSC9   VO_INTERSYS_PASSWORD+34  cn=0,n=9
         7 002656   202206 000014                    ADSC9   TWORK,,AUTO              cn=0,n=12

     1289    13059    2         CALL BINCHAR(DWORK,I);

  13059  7 002657   000100 301500                    BTD
         7 002660   200004 000004                    NDSC9   I,,AUTO                  cn=0,s=lsgnf,sf=0,n=4
         7 002661   202211 030010                    NDSC9   DWORK,,AUTO              cn=0,s=nosgn,sf=0,n=8

     1290    13060    2         I=0;

  13060  7 002662   200004 450100                    STZ     I,,AUTO

     1291    13061    3         DO WHILE(I<6 AND SUBSTR(DWORK,I,1)='0');

  13061  7 002663   002665 710000 7                  TRA     s:13063

     1292    13062    3            I=I+1;

  13062  7 002664   200004 054100                    AOS     I,,AUTO

     1293    13063    3            END;

  13063  7 002665   200004 235100                    LDA     I,,AUTO
         7 002666   000006 115007                    CMPA    6,DL
         7 002667   002674 605000 7                  TPL     s:13064
         7 002670   040000 106505                    CMPC    fill='040'O
         7 002671   202211 000001                    ADSC9   DWORK,A,AUTO             cn=0,n=1
         7 002672   000067 000001 8                  ADSC9   55                       cn=0,n=1
         7 002673   002664 600000 7                  TZE     s:13062
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:158  

     1294    13064    2         CALL CONCAT(U6.C,SUBSTR(DWORK,I,7-I),'.',SUBSTR(DWORK,7,1),TWORK);

  13064  7 002674   777770 620005                    EAX0    -8,AL
         7 002675   777777 660003                    ERX0    -1,DU
         7 002676   040100 100545                    MLR     fill='040'O
         7 002677   202211 000010                    ADSC9   DWORK,A,AUTO             cn=0,n=*X0
         7 002700   202370 200117                    ADSC9   U6,,AUTO                 cn=1,n=79
         7 002701   200004 236100                    LDQ     I,,AUTO
         7 002702   000071 116000 8                  CMPQ    57
         7 002703   002731 604400 7                  TMOZ    s:13065
         7 002704   000110 621006                    EAX1    72,QL
         7 002705   000000 531000                    NEG     0
         7 002706   040145 100400                    MLR     fill='040'O
         7 002707   000073 000001 8                  ADSC9   59                       cn=0,n=1
         7 002710   202372 000011                    ADSC9   U6+2,A,AUTO              cn=0,n=*X1
         7 002711   200004 236100                    LDQ     I,,AUTO
         7 002712   000074 116000 8                  CMPQ    60
         7 002713   002731 604400 7                  TMOZ    s:13065
         7 002714   000107 620006                    EAX0    71,QL
         7 002715   200004 335100                    LCA     I,,AUTO
         7 002716   040145 100500                    MLR     fill='040'O
         7 002717   202212 600001                    ADSC9   DWORK+1,,AUTO            cn=3,n=1
         7 002720   202372 200010                    ADSC9   U6+2,A,AUTO              cn=1,n=*X0
         7 002721   200004 236100                    LDQ     I,,AUTO
         7 002722   000075 116000 8                  CMPQ    61
         7 002723   002731 604400 7                  TMOZ    s:13065
         7 002724   000106 620006                    EAX0    70,QL
         7 002725   200004 335100                    LCA     I,,AUTO
         7 002726   040145 100500                    MLR     fill='040'O
         7 002727   202206 000014                    ADSC9   TWORK,,AUTO              cn=0,n=12
         7 002730   202372 400010                    ADSC9   U6+2,A,AUTO              cn=2,n=*X0

     1295    13065    2         U6.L=24-I;

  13065  7 002731   000030 236007                    LDQ     24,DL
         7 002732   200004 136100                    SBLQ    I,,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:159  
         7 002733   000033 736000                    QLS     27
         7 002734   202370 552140                    STBQ    U6,'40'O,AUTO

     1296    13066
     1297    13067        /****
     1298    13068        *
     1299    13069        *   Determine the status of the packet.  If it was real small and the
     1300    13070        *   system is running pretty quick, it may be lost by JOBSTATS.
     1301    13071        *
     1302    13072        ****/
     1303    13073
     1304    13074    3         IF VLR_JOBSTATS_CHECK.FCODE=%FS_PWAIT# THEN DO;

  13074  7 002735   001262 220000 1                  LDX0    VLR_JOBSTATS_CHECK+4
         7 002736   000002 100003                    CMPX0   2,DU
         7 002737   003033 601000 7                  TNZ     s:13084

     1305    13075    3            CALL BINCHAR(DWORK,VLR_JOBSTATS_CHECK.AHEAD);

  13075  7 002740   001260 235000 1                  LDA     VLR_JOBSTATS_CHECK+2
         7 002741   000044 773000                    LRL     36
         7 002742   203426 757100                    STAQ    OFFSET+2,,AUTO
         7 002743   000100 301500                    BTD
         7 002744   203426 000010                    NDSC9   OFFSET+2,,AUTO           cn=0,s=lsgnf,sf=0,n=8
         7 002745   202211 030010                    NDSC9   DWORK,,AUTO              cn=0,s=nosgn,sf=0,n=8

     1306    13076    3            K=0;

  13076  7 002746   200006 450100                    STZ     K,,AUTO

     1307    13077    4            DO WHILE(K<7 AND SUBSTR(DWORK,K,1)='0');

  13077  7 002747   002751 710000 7                  TRA     s:13079

     1308    13078    4               K=K+1;

  13078  7 002750   200006 054100                    AOS     K,,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:160  

     1309    13079    4               END;

  13079  7 002751   200006 235100                    LDA     K,,AUTO
         7 002752   000007 115007                    CMPA    7,DL
         7 002753   002760 605000 7                  TPL     s:13080
         7 002754   040000 106505                    CMPC    fill='040'O
         7 002755   202211 000001                    ADSC9   DWORK,A,AUTO             cn=0,n=1
         7 002756   000067 000001 8                  ADSC9   55                       cn=0,n=1
         7 002757   002750 600000 7                  TZE     s:13078

     1310    13080    3            U5.C=SUBSTR(DWORK,K,8-K);

  13080  7 002760   777767 620005                    EAX0    -9,AL
         7 002761   777777 660003                    ERX0    -1,DU
         7 002762   040100 100545                    MLR     fill='040'O
         7 002763   202211 000010                    ADSC9   DWORK,A,AUTO             cn=0,n=*X0
         7 002764   202344 200117                    ADSC9   U5,,AUTO                 cn=1,n=79

     1311    13081    3            U5.L=8-K;

  13081  7 002765   000010 236007                    LDQ     8,DL
         7 002766   200006 136100                    SBLQ    K,,AUTO
         7 002767   000033 736000                    QLS     27
         7 002770   202344 552140                    STBQ    U5,'40'O,AUTO

     1312    13082    3            CALL VWX$MAIL(%E$VWM_XWT,VECTOR(U4),VECTOR(U5),VECTOR(U6));

  13082  7 002771   000030 235000 8                  LDA     24
         7 002772   203426 452500                    STP2    OFFSET+2,,AUTO
         7 002773   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 002774   002320 036003                    ADLQ    1232,DU
         7 002775   203430 757100                    STAQ    OFFSET+4,,AUTO
         7 002776   000030 235000 8                  LDA     24
         7 002777   203432 452500                    STP2    OFFSET+6,,AUTO
         7 003000   203432 236100                    LDQ     OFFSET+6,,AUTO
         7 003001   002344 036003                    ADLQ    1252,DU
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:161  
         7 003002   203434 757100                    STAQ    OFFSET+8,,AUTO
         7 003003   000030 235000 8                  LDA     24
         7 003004   203436 452500                    STP2    OFFSET+10,,AUTO
         7 003005   203436 236100                    LDQ     OFFSET+10,,AUTO
         7 003006   002370 036003                    ADLQ    1272,DU
         7 003007   203442 757100                    STAQ    OFFSET+14,,AUTO
         7 003010   203430 237100                    LDAQ    OFFSET+4,,AUTO
         7 003011   203440 757100                    STAQ    OFFSET+12,,AUTO
         7 003012   203434 237100                    LDAQ    OFFSET+8,,AUTO
         7 003013   203444 757100                    STAQ    OFFSET+16,,AUTO
         7 003014   203442 237100                    LDAQ    OFFSET+14,,AUTO
         7 003015   203446 757100                    STAQ    OFFSET+18,,AUTO
         7 003016   203446 630500                    EPPR0   OFFSET+18,,AUTO
         7 003017   203453 450500                    STP0    OFFSET+23,,AUTO
         7 003020   203444 631500                    EPPR1   OFFSET+16,,AUTO
         7 003021   203452 451500                    STP1    OFFSET+22,,AUTO
         7 003022   203440 633500                    EPPR3   OFFSET+12,,AUTO
         7 003023   203451 453500                    STP3    OFFSET+21,,AUTO
         7 003024   000077 236000 8                  LDQ     63
         7 003025   203450 756100                    STQ     OFFSET+20,,AUTO
         7 003026   203450 630500                    EPPR0   OFFSET+20,,AUTO
         7 003027   000031 631400 8                  EPPR1   25
         7 003030   000000 701000 xent               TSX1    VWX$MAIL
         7 003031   000000 011000                    NOP     0

     1313    13083    3            END;

  13083  7 003032   003134 710000 7                  TRA     REPORT_SENT

     1314    13084    3           ELSE IF VLR_JOBSTATS_CHECK.FCODE=%FS_PRT# THEN DO;

  13084  7 003033   000003 100003                    CMPX0   3,DU
         7 003034   003104 601000 7                  TNZ     s:13090

     1315    13085    3               U5.C=VLR_JOBSTATS_CHECK.DEVNAME;

  13085  7 003035   040100 100400                    MLR     fill='040'O
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:162  
         7 003036   001265 000004 1                  ADSC9   VLR_JOBSTATS_CHECK+7     cn=0,n=4
         7 003037   202344 200117                    ADSC9   U5,,AUTO                 cn=1,n=79

     1316    13086    3               U5.L=4;

  13086  7 003040   004000 236003                    LDQ     2048,DU
         7 003041   202344 552140                    STBQ    U5,'40'O,AUTO

     1317    13087    3               CALL VWX$MAIL(%E$VWM_XMT,VECTOR(U4),VECTOR(U5),VECTOR(U6));

  13087  7 003042   000030 235000 8                  LDA     24
         7 003043   203426 452500                    STP2    OFFSET+2,,AUTO
         7 003044   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 003045   002320 036003                    ADLQ    1232,DU
         7 003046   203430 757100                    STAQ    OFFSET+4,,AUTO
         7 003047   000030 235000 8                  LDA     24
         7 003050   203432 452500                    STP2    OFFSET+6,,AUTO
         7 003051   203432 236100                    LDQ     OFFSET+6,,AUTO
         7 003052   002344 036003                    ADLQ    1252,DU
         7 003053   203434 757100                    STAQ    OFFSET+8,,AUTO
         7 003054   000030 235000 8                  LDA     24
         7 003055   203436 452500                    STP2    OFFSET+10,,AUTO
         7 003056   203436 236100                    LDQ     OFFSET+10,,AUTO
         7 003057   002370 036003                    ADLQ    1272,DU
         7 003060   203442 757100                    STAQ    OFFSET+14,,AUTO
         7 003061   203430 237100                    LDAQ    OFFSET+4,,AUTO
         7 003062   203440 757100                    STAQ    OFFSET+12,,AUTO
         7 003063   203434 237100                    LDAQ    OFFSET+8,,AUTO
         7 003064   203444 757100                    STAQ    OFFSET+16,,AUTO
         7 003065   203442 237100                    LDAQ    OFFSET+14,,AUTO
         7 003066   203446 757100                    STAQ    OFFSET+18,,AUTO
         7 003067   203446 630500                    EPPR0   OFFSET+18,,AUTO
         7 003070   203453 450500                    STP0    OFFSET+23,,AUTO
         7 003071   203444 631500                    EPPR1   OFFSET+16,,AUTO
         7 003072   203452 451500                    STP1    OFFSET+22,,AUTO
         7 003073   203440 633500                    EPPR3   OFFSET+12,,AUTO
         7 003074   203451 453500                    STP3    OFFSET+21,,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:163  
         7 003075   000101 236000 8                  LDQ     65
         7 003076   203450 756100                    STQ     OFFSET+20,,AUTO
         7 003077   203450 630500                    EPPR0   OFFSET+20,,AUTO
         7 003100   000031 631400 8                  EPPR1   25
         7 003101   000000 701000 xent               TSX1    VWX$MAIL
         7 003102   000000 011000                    NOP     0

     1318    13088    3               END;

  13088  7 003103   003134 710000 7                  TRA     REPORT_SENT

     1319    13089    3              ELSE DO;

     1320    13090    3               CALL VWX$MAIL(%E$VWM_XBB,VECTOR(U4),VECTOR(U6));

  13090  7 003104   000030 235000 8                  LDA     24
         7 003105   203426 452500                    STP2    OFFSET+2,,AUTO
         7 003106   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 003107   002320 036003                    ADLQ    1232,DU
         7 003110   203430 757100                    STAQ    OFFSET+4,,AUTO
         7 003111   000030 235000 8                  LDA     24
         7 003112   203432 452500                    STP2    OFFSET+6,,AUTO
         7 003113   203432 236100                    LDQ     OFFSET+6,,AUTO
         7 003114   002370 036003                    ADLQ    1272,DU
         7 003115   203436 757100                    STAQ    OFFSET+10,,AUTO
         7 003116   203430 237100                    LDAQ    OFFSET+4,,AUTO
         7 003117   203434 757100                    STAQ    OFFSET+8,,AUTO
         7 003120   203436 237100                    LDAQ    OFFSET+10,,AUTO
         7 003121   203440 757100                    STAQ    OFFSET+12,,AUTO
         7 003122   203440 630500                    EPPR0   OFFSET+12,,AUTO
         7 003123   203444 450500                    STP0    OFFSET+16,,AUTO
         7 003124   203434 631500                    EPPR1   OFFSET+8,,AUTO
         7 003125   203443 451500                    STP1    OFFSET+15,,AUTO
         7 003126   000103 236000 8                  LDQ     67
         7 003127   203442 756100                    STQ     OFFSET+14,,AUTO
         7 003130   203442 630500                    EPPR0   OFFSET+14,,AUTO
         7 003131   000037 631400 8                  EPPR1   31
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:164  
         7 003132   000000 701000 xent               TSX1    VWX$MAIL
         7 003133   000000 011000                    NOP     0

     1321    13091    3               END;

     1322    13092    2         END;

     1323    13093
     1324    13094        /****
     1325    13095        *
     1326    13096        *   If we're SCOTTY, tell that we've sent the file.
     1327    13097        *
     1328    13098        ****/
     1329    13099
     1330    13100    1   REPORT_SENT:
     1331    13101    1      IF B$JIT.MODE=%M_GHOST# THEN

  13101  7 003134   000000 470400 xsym  REPORT_SENT  LDP0    B$JIT$
         7 003135   000000 236100                    LDQ     0,,PR0
         7 003136   740000 376003                    ANQ     -16384,DU
         7 003137   100000 116003                    CMPQ    32768,DU
         7 003140   003202 601000 7                  TNZ     s:13110

     1332    13102    1         CALL VWX$MAIL(%E$VWM_SNT,VECTOR(U1),VECTOR(U2),VECTOR(U3));

  13102  7 003141   000030 235000 8                  LDA     24
         7 003142   203426 452500                    STP2    OFFSET+2,,AUTO
         7 003143   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 003144   002224 036003                    ADLQ    1172,DU
         7 003145   203430 757100                    STAQ    OFFSET+4,,AUTO
         7 003146   000030 235000 8                  LDA     24
         7 003147   203432 452500                    STP2    OFFSET+6,,AUTO
         7 003150   203432 236100                    LDQ     OFFSET+6,,AUTO
         7 003151   002250 036003                    ADLQ    1192,DU
         7 003152   203434 757100                    STAQ    OFFSET+8,,AUTO
         7 003153   000030 235000 8                  LDA     24
         7 003154   203436 452500                    STP2    OFFSET+10,,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:165  
         7 003155   203436 236100                    LDQ     OFFSET+10,,AUTO
         7 003156   002274 036003                    ADLQ    1212,DU
         7 003157   203442 757100                    STAQ    OFFSET+14,,AUTO
         7 003160   203430 237100                    LDAQ    OFFSET+4,,AUTO
         7 003161   203440 757100                    STAQ    OFFSET+12,,AUTO
         7 003162   203434 237100                    LDAQ    OFFSET+8,,AUTO
         7 003163   203444 757100                    STAQ    OFFSET+16,,AUTO
         7 003164   203442 237100                    LDAQ    OFFSET+14,,AUTO
         7 003165   203446 757100                    STAQ    OFFSET+18,,AUTO
         7 003166   203446 631500                    EPPR1   OFFSET+18,,AUTO
         7 003167   203453 451500                    STP1    OFFSET+23,,AUTO
         7 003170   203444 633500                    EPPR3   OFFSET+16,,AUTO
         7 003171   203452 453500                    STP3    OFFSET+22,,AUTO
         7 003172   203440 634500                    EPPR4   OFFSET+12,,AUTO
         7 003173   203451 454500                    STP4    OFFSET+21,,AUTO
         7 003174   000105 236000 8                  LDQ     69
         7 003175   203450 756100                    STQ     OFFSET+20,,AUTO
         7 003176   203450 630500                    EPPR0   OFFSET+20,,AUTO
         7 003177   000031 631400 8                  EPPR1   25
         7 003200   000000 701000 xent               TSX1    VWX$MAIL
         7 003201   000000 011000                    NOP     0

     1333    13103
     1334    13104        /****
     1335    13105        *
     1336    13106        *   Count the file, then do another if wildcarded.
     1337    13107        *
     1338    13108        ****/
     1339    13109
     1340    13110    1      FILECOUNT=FILECOUNT+1;

  13110  7 003202   200015 054100                    AOS     FILECOUNT,,AUTO

     1341    13111    1      IF MULTIPLE THEN

  13111  7 003203   202420 234100                    SZN     MULTIPLE,,AUTO
         7 003204   000456 604000 7                  TMI     BEAM_NEXT_FILE
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:166  

     1342    13112    1         GOTO BEAM_NEXT_FILE;
     1343    13113    1      RETURN;

  13113  7 003205   000000 702200 xent               TSX2  ! X66_ARET

     1344    13114
     1345    13115        /****
     1346    13116        *
     1347    13117        *   The input file name was too long.
     1348    13118        *
     1349    13119        ****/
     1350    13120
     1351    13121    1   BEAM_BAD_ITL:
     1352    13122    1      ERRCODE=%E$VWM_ITL;

  13122  7 003206   000106 235000 8     BEAM_BAD_ITL LDA     70
         7 003207   200052 755100                    STA     ERRCODE,,AUTO

     1353    13123    1      GOTO BEAM_USRERR;

  13123  7 003210   003275 710000 7                  TRA     BEAM_USRERR

     1354    13124
     1355    13125        /****
     1356    13126        *
     1357    13127        *   The input file name was invalid.
     1358    13128        *
     1359    13129        ****/
     1360    13130
     1361    13131    1   BEAM_BAD_INP:
     1362    13132    1      ERRCODE=%E$VWM_INP;

  13132  7 003211   000107 235000 8     BEAM_BAD_INP LDA     71
         7 003212   200052 755100                    STA     ERRCODE,,AUTO

     1363    13133    1      GOTO BEAM_USRERR;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:167  

  13133  7 003213   003275 710000 7                  TRA     BEAM_USRERR

     1364    13134
     1365    13135        /****
     1366    13136        *
     1367    13137        *   The output file name was too long.
     1368    13138        *
     1369    13139        ****/
     1370    13140
     1371    13141    1   BEAM_BAD_OTL:
     1372    13142    1      ERRCODE=%E$VWM_OTL;

  13142  7 003214   000110 235000 8     BEAM_BAD_OTL LDA     72
         7 003215   200052 755100                    STA     ERRCODE,,AUTO

     1373    13143    1      GOTO BEAM_USRERR;

  13143  7 003216   003275 710000 7                  TRA     BEAM_USRERR

     1374    13144
     1375    13145        /****
     1376    13146        *
     1377    13147        *   The output file name was invalid.
     1378    13148        *
     1379    13149        ****/
     1380    13150
     1381    13151    1   BEAM_BAD_OUT:
     1382    13152    1      ERRCODE=%E$VWM_OUT;

  13152  7 003217   000111 235000 8     BEAM_BAD_OUT LDA     73
         7 003220   200052 755100                    STA     ERRCODE,,AUTO

     1383    13153    1      GOTO BEAM_USRERR;

  13153  7 003221   003275 710000 7                  TRA     BEAM_USRERR

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:168  
     1384    13154
     1385    13155        /****
     1386    13156        *
     1387    13157        *   Sorry, can't MOVE this file type.
     1388    13158        *
     1389    13159        ****/
     1390    13160
     1391    13161    1   BEAM_BAD_ORG:
     1392    13162    1      ERRCODE=%E$VWM_ORG;

  13162  7 003222   000112 236000 8     BEAM_BAD_ORG LDQ     74
         7 003223   200052 756100                    STQ     ERRCODE,,AUTO

     1393    13163    1      GOTO BEAM_USRERR;

  13163  7 003224   003275 710000 7                  TRA     BEAM_USRERR

     1394    13164
     1395    13165        /****
     1396    13166        *
     1397    13167        *   Destination node is undefined.
     1398    13168        *
     1399    13169        ****/
     1400    13170
     1401    13171    1   BEAM_BAD_DST:
     1402    13172    1      ERRCODE=%E$VWM_DND;

  13172  7 003225   000113 235000 8     BEAM_BAD_DST LDA     75
         7 003226   200052 755100                    STA     ERRCODE,,AUTO

     1403    13173    1      GOTO BEAM_USRERR;

  13173  7 003227   003275 710000 7                  TRA     BEAM_USRERR

     1404    13174
     1405    13175        /****
     1406    13176        *
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:169  
     1407    13177        *   Wildcarding error.
     1408    13178        *
     1409    13179        ****/
     1410    13180
     1411    13181    1   BEAM_BAD_WLD:
     1412    13182    1      ERRCODE=%E$VWM_WLD;

  13182  7 003230   000114 235000 8     BEAM_BAD_WLD LDA     76
         7 003231   200052 755100                    STA     ERRCODE,,AUTO

     1413    13183    1      GOTO BEAM_USRERR;

  13183  7 003232   003275 710000 7                  TRA     BEAM_USRERR

     1414    13184
     1415    13185        /****
     1416    13186        *
     1417    13187        *   Monitor error opening/reading :NODES.
     1418    13188        *
     1419    13189        ****/
     1420    13190
     1421    13191    1   BEAM_BAD_NODE:
     1422    13192    1      ERRDCB=DCBNUM(M$JE);

  13192  7 003233   000000 236007 xsym  BEAM_BAD_NO* LDQ     M$JE,DL
         7 003234   200023 756100                    STQ     ERRDCB,,AUTO

     1423    13193    1      GOTO BEAM_SYSERR;

  13193  7 003235   003304 710000 7                  TRA     BEAM_SYSERR

     1424    13194
     1425    13195        /****
     1426    13196        *
     1427    13197        *   Input file read error (except LD or EOF).
     1428    13198        *
     1429    13199        ****/
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:170  
     1430    13200
     1431    13201    1   BEAM_BAD_INE:
     1432    13202    1      ERRDCB=DCBNUM(M$INP);

  13202  7 003236   000000 236007 xsym  BEAM_BAD_INE LDQ     M$INP,DL
         7 003237   200023 756100                    STQ     ERRDCB,,AUTO

     1433    13203    1      GOTO BEAM_SYSERR;

  13203  7 003240   003304 710000 7                  TRA     BEAM_SYSERR

     1434    13204
     1435    13205        /****
     1436    13206        *
     1437    13207        *   Error writing JE file.
     1438    13208        *
     1439    13209        ****/
     1440    13210
     1441    13211    1   BEAM_BAD_WRJ:
     1442    13212    1      ERRDCB=DCBNUM(M$JE);

  13212  7 003241   000000 236007 xsym  BEAM_BAD_WRJ LDQ     M$JE,DL
         7 003242   200023 756100                    STQ     ERRDCB,,AUTO

     1443    13213    1      GOTO BEAM_SYSERR;

  13213  7 003243   003304 710000 7                  TRA     BEAM_SYSERR

     1444    13214
     1445    13215        /****
     1446    13216        *
     1447    13217        *   Error opening input file.  Check for file busy.
     1448    13218        *
     1449    13219        ****/
     1450    13220
     1451    13221    1   BEAM_BAD_FMF:
     1452    13222    1      ERRDCB=DCBNUM(M$INP);
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:171  

  13222  7 003244   000000 236007 xsym  BEAM_BAD_FMF LDQ     M$INP,DL
         7 003245   200023 756100                    STQ     ERRDCB,,AUTO

     1453    13223    1      ERRBITS=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

  13223  7 003246   000000 470400 xsym               LDP0    B$TCB$
         7 003247   000000 471500                    LDP1    0,,PR0
         7 003250   100102 236100                    LDQ     66,,PR1
         7 003251   200052 756100                    STQ     ERRCODE,,AUTO

     1454    13224    1      ERRBITS.SEV=0;

  13224  7 003252   000115 236000 8                  LDQ     77
         7 003253   200052 356100                    ANSQ    ERRCODE,,AUTO

     1455    13225    1      IF ERRBITS.CODE~=%E$FILEBUSY AND ERRBITS.CODE~=%E$NONEWU AND

  13225  7 003254   200052 236100                    LDQ     ERRCODE,,AUTO
         7 003255   377770 376007                    ANQ     131064,DL
         7 003256   001550 116007                    CMPQ    872,DL
         7 003257   003266 600000 7                  TZE     s:13228
         7 003260   001520 116007                    CMPQ    848,DL
         7 003261   003266 600000 7                  TZE     s:13228
         7 003262   002200 116007                    CMPQ    1152,DL
         7 003263   003266 600000 7                  TZE     s:13228
         7 003264   002170 116007                    CMPQ    1144,DL
         7 003265   003304 601000 7                  TNZ     BEAM_SYSERR

     1456    13226    1        ERRBITS.CODE~=%E$SETDOWN AND ERRBITS.CODE~=%E$XCLSET THEN
     1457    13227    1         GOTO BEAM_SYSERR;
     1458    13228    1      CALL VWX$MAIL(%E$VWM_BSY);

  13228  7 003266   000117 630400 8                  EPPR0   79
         7 003267   000024 631400 8                  EPPR1   20
         7 003270   000000 701000 xent               TSX1    VWX$MAIL
         7 003271   000000 011000                    NOP     0
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:172  

     1459    13229    1      OPTS.MAILINIT.CMD='BUSY';

  13229  7 003272   000337 236000 3                  LDQ     VO_INTERSYS_PASSWORD+37
         7 003273   000240 756000 xsym               STQ     VW_OPTIONS#+160

     1460    13230    1      GOTO BEAM_ABORT;

  13230  7 003274   003330 710000 7                  TRA     BEAM_ABORT

     1461    13231
     1462    13232        /****
     1463    13233        *
     1464    13234        *   A user-land error has occurred.
     1465    13235        *
     1466    13236        ****/
     1467    13237
     1468    13238    1   BEAM_USRERR:
     1469    13239    1      CALL VWX$MAIL(ERRCODE);

  13239  7 003275   200052 630500       BEAM_USRERR  EPPR0   ERRCODE,,AUTO
         7 003276   203426 450500                    STP0    OFFSET+2,,AUTO
         7 003277   203426 630500                    EPPR0   OFFSET+2,,AUTO
         7 003300   000024 631400 8                  EPPR1   20
         7 003301   000000 701000 xent               TSX1    VWX$MAIL
         7 003302   000000 011000                    NOP     0

     1470    13240    1      GOTO BEAM_ABORT;

  13240  7 003303   003330 710000 7                  TRA     BEAM_ABORT

     1471    13241
     1472    13242        /****
     1473    13243        *
     1474    13244        *   A monitor error has occurred.
     1475    13245        *
     1476    13246        ****/
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:173  
     1477    13247
     1478    13248    1   BEAM_SYSERR:
     1479    13249    1      ERRBITS=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

  13249  7 003304   000000 470400 xsym  BEAM_SYSERR  LDP0    B$TCB$
         7 003305   000000 471500                    LDP1    0,,PR0
         7 003306   100102 236100                    LDQ     66,,PR1
         7 003307   200052 756100                    STQ     ERRCODE,,AUTO

     1480    13250    1      ERRBITS.SEV=0;

  13250  7 003310   000115 236000 8                  LDQ     77
         7 003311   200052 356100                    ANSQ    ERRCODE,,AUTO

     1481    13251    1      CALL VWX$MAIL(ERRCODE,,,,ERRDCB);

  13251  7 003312   200023 631500                    EPPR1   ERRDCB,,AUTO
         7 003313   203432 451500                    STP1    OFFSET+6,,AUTO
         7 003314   000064 236000 8                  LDQ     52
         7 003315   000064 235000 8                  LDA     52
         7 003316   203430 757100                    STAQ    OFFSET+4,,AUTO
         7 003317   000064 236000 8                  LDQ     52
         7 003320   203427 756100                    STQ     OFFSET+3,,AUTO
         7 003321   200052 633500                    EPPR3   ERRCODE,,AUTO
         7 003322   203426 453500                    STP3    OFFSET+2,,AUTO
         7 003323   203426 630500                    EPPR0   OFFSET+2,,AUTO
         7 003324   000120 631400 8                  EPPR1   80
         7 003325   000000 701000 xent               TSX1    VWX$MAIL
         7 003326   000000 011000                    NOP     0

     1482    13252    1      GOTO BEAM_ABORT;

  13252  7 003327   003330 710000 7                  TRA     BEAM_ABORT

     1483    13253
     1484    13254        /****
     1485    13255        *
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:174  
     1486    13256        *   Disaster!  Close the input file; if the output file is still
     1487    13257        *   open, close and release it.
     1488    13258        *
     1489    13259        ****/
     1490    13260
     1491    13261    1   BEAM_ABORT:
     1492    13262    1      IF INPPTR->DUMMY.FCD# THEN

  13262  7 003330   200053 470500       BEAM_ABORT   LDP0    INPPTR,,AUTO
         7 003331   000031 236100                    LDQ     25,,PR0
         7 003332   020000 316007                    CANQ    8192,DL
         7 003333   003337 600000 7                  TZE     s:13264

     1493    13263    1         CALL M$CLOSE(CLOSE_INP);

  13263  7 003334   000660 630400 1                  EPPR0   CLOSE_INP
         7 003335   050001 713400                    CLIMB   close
         7 003336   406000 401760                    pmme    nvectors=13

     1494    13264    1      CLOSE_JE.V.DISP#=%RELEASE#;

  13264  7 003337   000001 236007                    LDQ     1,DL
         7 003340   001162 552004 1                  STBQ    CLOSE_JE+26,'04'O

     1495    13265    1      IF JEPTR->DUMMY.FCD# THEN

  13265  7 003341   200054 470500                    LDP0    JEPTR,,AUTO
         7 003342   000031 236100                    LDQ     25,,PR0
         7 003343   020000 316007                    CANQ    8192,DL
         7 003344   003350 600000 7                  TZE     s:13267

     1496    13266    1         CALL M$CLOSE(CLOSE_JE);

  13266  7 003345   001130 630400 1                  EPPR0   CLOSE_JE
         7 003346   050001 713400                    CLIMB   close
         7 003347   406000 401760                    pmme    nvectors=13

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:175  
     1497    13267    1      IF MULTIPLE THEN

  13267  7 003350   202420 234100                    SZN     MULTIPLE,,AUTO
         7 003351   000456 604000 7                  TMI     BEAM_NEXT_FILE

     1498    13268    1         GOTO BEAM_NEXT_FILE;
     1499    13269    1      ALTRETURN;

  13269  7 003352   000000 702200 xent               TSX2  ! X66_AALT

     1500    13270
     1501    13271        /****
     1502    13272        *
     1503    13273        *   Supply appropriate text for wildcarded MOVEs.
     1504    13274        *
     1505    13275        ****/
     1506    13276
     1507    13277    1   BEAM_WILD_DONE:
     1508    13278    2      DO CASE(FILECOUNT);

  13278  7 003353   200015 235100       BEAM_WILD_D* LDA     FILECOUNT,,AUTO
         7 003354   000002 115007                    CMPA    2,DL
         7 003355   003357 602005 7                  TNC     BEAM_WILD_DONE+4,AL
         7 003356   003366 710000 7                  TRA     s:13284
         7 003357   003361 710000 7                  TRA     s:13280
         7 003360   003427 710000 7                  TRA     s:13293

     1509    13279    2        CASE(0);

     1510    13280    2         CALL VWX$MAIL(%E$VWM_NTT);

  13280  7 003361   000122 630400 8                  EPPR0   82
         7 003362   000024 631400 8                  EPPR1   20
         7 003363   000000 701000 xent               TSX1    VWX$MAIL
         7 003364   000000 011000                    NOP     0
         7 003365   003427 710000 7                  TRA     s:13293

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:176  
     1511    13281    2        CASE(1);

     1512    13282    2         ;
     1513    13283    2        CASE(ELSE);

     1514    13284    2         CALL BINCHAR(DWORK,FILECOUNT);

  13284  7 003366   000100 301500                    BTD
         7 003367   200015 000004                    NDSC9   FILECOUNT,,AUTO          cn=0,s=lsgnf,sf=0,n=4
         7 003370   202211 030010                    NDSC9   DWORK,,AUTO              cn=0,s=nosgn,sf=0,n=8

     1515    13285    2         I=0;

  13285  7 003371   200004 450100                    STZ     I,,AUTO

     1516    13286    3         DO WHILE(SUBSTR(DWORK,I,1)='0');

  13286  7 003372   003374 710000 7                  TRA     s:13288

     1517    13287    3            I=I+1;

  13287  7 003373   200004 054100                    AOS     I,,AUTO

     1518    13288    3            END;

  13288  7 003374   200004 235100                    LDA     I,,AUTO
         7 003375   040000 106505                    CMPC    fill='040'O
         7 003376   202211 000001                    ADSC9   DWORK,A,AUTO             cn=0,n=1
         7 003377   000067 000001 8                  ADSC9   55                       cn=0,n=1
         7 003400   003373 600000 7                  TZE     s:13287

     1519    13289    2         U1.C=SUBSTR(DWORK,I,8-I);

  13289  7 003401   777767 620005                    EAX0    -9,AL
         7 003402   777777 660003                    ERX0    -1,DU
         7 003403   040100 100545                    MLR     fill='040'O
         7 003404   202211 000010                    ADSC9   DWORK,A,AUTO             cn=0,n=*X0
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:177  
         7 003405   202224 200117                    ADSC9   U1,,AUTO                 cn=1,n=79

     1520    13290    2         U1.L=8-I;

  13290  7 003406   000010 236007                    LDQ     8,DL
         7 003407   200004 136100                    SBLQ    I,,AUTO
         7 003410   000033 736000                    QLS     27
         7 003411   202224 552140                    STBQ    U1,'40'O,AUTO

     1521    13291    2         CALL VWX$MAIL(%E$VWM_NFT,VECTOR(U1));

  13291  7 003412   000030 235000 8                  LDA     24
         7 003413   203426 452500                    STP2    OFFSET+2,,AUTO
         7 003414   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 003415   002224 036003                    ADLQ    1172,DU
         7 003416   203430 757100                    STAQ    OFFSET+4,,AUTO
         7 003417   203430 630500                    EPPR0   OFFSET+4,,AUTO
         7 003420   203433 450500                    STP0    OFFSET+7,,AUTO
         7 003421   000125 236000 8                  LDQ     85
         7 003422   203432 756100                    STQ     OFFSET+6,,AUTO
         7 003423   203432 630500                    EPPR0   OFFSET+6,,AUTO
         7 003424   000123 631400 8                  EPPR1   83
         7 003425   000000 701000 xent               TSX1    VWX$MAIL
         7 003426   000000 011000                    NOP     0

     1522    13292    2        END;

     1523    13293    1      RETURN;

  13293  7 003427   000000 702200 xent               TSX2  ! X66_ARET

     1524    13294
     1525    13295        %EJECT;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:178  
     1526    13296    1   FIDDLE_FIT: PROC ALTRET;

  13296  7 003430   202430 741300       FIDDLE_FIT   STX1  ! INTRASHIP+2,,AUTO

     1527    13297        /*I*  NAME: FIDDLE_FIT
     1528    13298              CALL: CALL FIDDLE_FIT ALTRET (trouble);
     1529    13299              INPUT: OPTS contains the options for the move;  FITBUF contains the
     1530    13300                    input file's FIT.
     1531    13301              OUTPUT: On a successful return, all significant information in OPTS will
     1532    13302                    have been transferred into the "processor attributes" data area
     1533    13303                    in the FITBUF;  the OPTS.OUT will have been modified so that
     1534    13304                    SCOTTY on the receiving system will materialize a randomly-named
     1535    13305                    file in the appropriate external-transport directory.
     1536    13306              DESCRIPTION: This procedure is called when a file is being MOVEd to
     1537    13307                    an external node via a CP-6 disk directory.  It records all of
     1538    13308                    the significant information & options from the MOVE in such a way
     1539    13309                    that the installation's custom file-exporting package can access
     1540    13310                    it, and directs SCOTTY to materialize the file in a randomly-named
     1541    13311                    location in the directory account.
     1542    13312        */
     1543    13313    2   DCL FITCARD                                                (0:24) CHAR (80);
     1544    13314    2   DCL FITWORD (0:499) REDEF FITCARD UBIN WORD;
     1545    13315    2   DCL SIZE_NEEDED UBIN;
     1546    13316    2   DCL CODES SBIN;
     1547    13317    2   DCL CODE SBIN;
     1548    13318    2   DCL LOW SBIN;
     1549    13319    2   DCL HIGH SBIN;
     1550    13320    2   DCL FREE SBIN;
     1551    13321    2   DCL I SBIN;
     1552    13322    2   DCL OFFSET SBIN;
     1553    13323    2   DCL EPASS CHAR(12) STATIC;
     1554    13324    2   DCL BIT9(0:11) REDEF EPASS UBIN BYTE UNAL;
     1555    13325    2   DCL PASSWORD CHAR(8) STATIC;
     1556    13326    2   DCL BIT6(0:11) REDEF PASSWORD UBIN(6) UNAL;
     1557    13327
     1558    13328    2      SIZE_NEEDED = 0;

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:179  
  13328  7 003431   203415 450100                    STZ     SIZE_NEEDED,,AUTO

     1559    13329
     1560    13330    3      DO I = 1 TO LENGTHC(CARD)/LENGTHC(CARD(0)) - 1;

  13330  7 003432   000001 235007                    LDA     1,DL
         7 003433   203423 755100                    STA     I,,AUTO
         7 003434   003457 710000 7                  TRA     s:13337+1

     1561    13331    3         IF SUBSTR (CARD(I), 0, 4) ~= ' '

  13331  7 003435   203423 236100                    LDQ     I,,AUTO
         7 003436   000024 402007                    MPY     20,DL
         7 003437   000000 236006 xsym               LDQ     VW_OPTIONS#,QL
         7 003440   000015 116000 8                  CMPQ    13
         7 003441   003456 600000 7                  TZE     s:13337

     1562    13332    4           THEN DO;

     1563    13333    4            FITCARD(SIZE_NEEDED) = CARD(I);

  13333  7 003442   203423 236100                    LDQ     I,,AUTO
         7 003443   000120 402007                    MPY     80,DL
         7 003444   203426 756100                    STQ     OFFSET+2,,AUTO
         7 003445   203415 236100                    LDQ     SIZE_NEEDED,,AUTO
         7 003446   000120 402007                    MPY     80,DL
         7 003447   203426 235100                    LDA     OFFSET+2,,AUTO
         7 003450   040106 100405                    MLR     fill='040'O
         7 003451   000000 000120 xsym               ADSC9   VW_OPTIONS#,A            cn=0,n=80
         7 003452   202431 000120                    ADSC9   FITCARD,Q,AUTO           cn=0,n=80

     1564    13334    4            SIZE_NEEDED = SIZE_NEEDED + 1;

  13334  7 003453   203415 235100                    LDA     SIZE_NEEDED,,AUTO
         7 003454   000001 035007                    ADLA    1,DL
         7 003455   203415 755100                    STA     SIZE_NEEDED,,AUTO

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:180  
     1565    13335    4            END;

     1566    13336
     1567    13337    3         END;

  13337  7 003456   203423 054100                    AOS     I,,AUTO
         7 003457   203423 235100                    LDA     I,,AUTO
         7 003460   000030 115007                    CMPA    24,DL
         7 003461   003435 604400 7                  TMOZ    s:13331

     1568    13338
     1569    13339    2      SIZE_NEEDED = SIZE_NEEDED * SIZEW(FITCARD(0));

  13339  7 003462   203415 236100                    LDQ     SIZE_NEEDED,,AUTO
         7 003463   000024 402007                    MPY     20,DL
         7 003464   203415 756100                    STQ     SIZE_NEEDED,,AUTO

     1570    13340
     1571    13341    2      CODES = ADDR(FITBUF) -> FM$FIT.CODES.CODE(0);   /* # of sections */

  13341  7 003465   200162 236100                    LDQ     FITBUF,,AUTO
         7 003466   000037 772000                    QRL     31
         7 003467   203416 756100                    STQ     CODES,,AUTO

     1572    13342    2      LOW = ADDR(FITBUF) -> FM$FIT.CODES.NDW(0);      /* total size of FPARAM */

  13342  7 003470   200162 236100                    LDQ     FITBUF,,AUTO
         7 003471   000012 772000                    QRL     10
         7 003472   001777 376007                    ANQ     1023,DL
         7 003473   203420 756100                    STQ     LOW,,AUTO

     1573    13343    2      FREE = -1;

  13343  7 003474   000001 335007                    LCA     1,DL
         7 003475   203422 755100                    STA     FREE,,AUTO

     1574    13344
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:181  
     1575    13345    3      DO CODE = 1 TO CODES;

  13345  7 003476   000001 235007                    LDA     1,DL
         7 003477   203417 755100                    STA     CODE,,AUTO
         7 003500   003555 710000 7                  TRA     s:13363+1

     1576    13346
     1577    13347    3         LOW = MINIMUM (ADDR(FITBUF) -> FM$FIT.CODES.ITEMX(CODE), LOW);

  13347  7 003501   203417 720100                    LXL0    CODE,,AUTO
         7 003502   200162 236110                    LDQ     FITBUF,X0,AUTO
         7 003503   001777 376007                    ANQ     1023,DL
         7 003504   003507 604000 7                  TMI     s:13347+6
         7 003505   203420 116100                    CMPQ    LOW,,AUTO
         7 003506   003510 604400 7                  TMOZ    s:13347+7
         7 003507   203420 236100                    LDQ     LOW,,AUTO
         7 003510   203420 756100                    STQ     LOW,,AUTO

     1578    13348
     1579    13349    4         DO CASE (ADDR(FITBUF) -> FM$FIT.CODES.CODE(CODE));

  13349  7 003511   200162 236110                    LDQ     FITBUF,X0,AUTO
         7 003512   000037 772000                    QRL     31
         7 003513   000016 116007                    CMPQ    14,DL
         7 003514   003516 602006 7                  TNC     s:13349+5,QL
         7 003515   003554 710000 7                  TRA     s:13363
         7 003516   003534 710000 7                  TRA     s:13353
         7 003517   003554 710000 7                  TRA     s:13363
         7 003520   003554 710000 7                  TRA     s:13363
         7 003521   003554 710000 7                  TRA     s:13363
         7 003522   003554 710000 7                  TRA     s:13363
         7 003523   003534 710000 7                  TRA     s:13353
         7 003524   003534 710000 7                  TRA     s:13353
         7 003525   003554 710000 7                  TRA     s:13363
         7 003526   003554 710000 7                  TRA     s:13363
         7 003527   003554 710000 7                  TRA     s:13363
         7 003530   003554 710000 7                  TRA     s:13363
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:182  
         7 003531   003554 710000 7                  TRA     s:13363
         7 003532   003554 710000 7                  TRA     s:13363
         7 003533   003534 710000 7                  TRA     s:13353

     1580    13350
     1581    13351    4           CASE (0, 5, 6, 13);

     1582    13352
     1583    13353    4            ADDR(FITBUF) -> FM$FIT.CODES.CODE(CODE) = 0;

  13353  7 003534   000035 236000 8                  LDQ     29
         7 003535   200162 356110                    ANSQ    FITBUF,X0,AUTO

     1584    13354
     1585    13355    4            IF FREE < 0 OR ADDR(FITBUF) -> FM$FIT.CODES.NAW(CODE) >

  13355  7 003536   203422 235100                    LDA     FREE,,AUTO
         7 003537   003551 604000 7                  TMI     s:13358
         7 003540   200162 236110                    LDQ     FITBUF,X0,AUTO
         7 003541   000024 772000                    QRL     20
         7 003542   001777 376007                    ANQ     1023,DL
         7 003543   203426 756100                    STQ     OFFSET+2,,AUTO
         7 003544   200162 236105                    LDQ     FITBUF,AL,AUTO
         7 003545   000024 772000                    QRL     20
         7 003546   001777 376007                    ANQ     1023,DL
         7 003547   203426 116100                    CMPQ    OFFSET+2,,AUTO
         7 003550   003554 605000 7                  TPL     s:13363

     1586    13356    4              ADDR(FITBUF) -> FM$FIT.CODES.NAW(FREE)
     1587    13357    4              THEN
     1588    13358    4               FREE = CODE;

  13358  7 003551   203417 235100                    LDA     CODE,,AUTO
         7 003552   203422 755100                    STA     FREE,,AUTO
         7 003553   003554 710000 7                  TRA     s:13363

     1589    13359
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:183  
     1590    13360    4           CASE (ELSE);

     1591    13361    4           END;

     1592    13362
     1593    13363    3         END;

  13363  7 003554   203417 054100                    AOS     CODE,,AUTO
         7 003555   203417 236100                    LDQ     CODE,,AUTO
         7 003556   203416 116100                    CMPQ    CODES,,AUTO
         7 003557   003501 604400 7                  TMOZ    s:13347

     1594    13364
     1595    13365    2      IF FREE < 0

  13365  7 003560   203422 235100                    LDA     FREE,,AUTO
         7 003561   003644 605000 7                  TPL     s:13404

     1596    13366    3        THEN DO;

     1597    13367        /*
     1598    13368              Well, we found no free FPARAM entry at all; we'll have to add one.
     1599    13369        */
     1600    13370    3         IF LOW <= CODES

  13370  7 003562   203420 236100                    LDQ     LOW,,AUTO
         7 003563   203416 116100                    CMPQ    CODES,,AUTO
         7 003564   003632 605400 7                  TPNZ    s:13392

     1601    13371    4           THEN DO;

     1602    13372        /*
     1603    13373              Uggh!  The data starts right immediately after the end of the FM$FIT
     1604    13374              area;  we'll have to push the data up one word and increment all the
     1605    13375              ITEMX values in the FM$FIT.
     1606    13376        */
     1607    13377    5            DO I = ADDR(FITBUF) -> FM$FIT.CODES.NDW(0) - 1 DOWNTO LOW BY -1;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:184  

  13377  7 003565   200162 236100                    LDQ     FITBUF,,AUTO
         7 003566   000012 772000                    QRL     10
         7 003567   001777 376007                    ANQ     1023,DL
         7 003570   000001 136007                    SBLQ    1,DL
         7 003571   203423 756100                    STQ     I,,AUTO
         7 003572   003600 710000 7                  TRA     s:13379+2

     1608    13378    5               FITBUF(I+1) = FITBUF(I);

  13378  7 003573   203423 720100                    LXL0    I,,AUTO
         7 003574   200162 235110                    LDA     FITBUF,X0,AUTO
         7 003575   200163 755110                    STA     FITBUF+1,X0,AUTO

     1609    13379    5               END;

  13379  7 003576   000001 336007                    LCQ     1,DL
         7 003577   203423 056100                    ASQ     I,,AUTO
         7 003600   203423 236100                    LDQ     I,,AUTO
         7 003601   203420 116100                    CMPQ    LOW,,AUTO
         7 003602   003573 605000 7                  TPL     s:13378

     1610    13380    5            DO I = 1 TO CODES;

  13380  7 003603   000001 235007                    LDA     1,DL
         7 003604   203423 755100                    STA     I,,AUTO
         7 003605   003616 710000 7                  TRA     s:13383+1

     1611    13381    5               ADDR(FITBUF) -> FM$FIT.CODES.ITEMX(I) =

  13381  7 003606   203423 720100                    LXL0    I,,AUTO
         7 003607   200162 236110                    LDQ     FITBUF,X0,AUTO
         7 003610   001777 376007                    ANQ     1023,DL
         7 003611   000001 036007                    ADLQ    1,DL
         7 003612   200162 676110                    ERQ     FITBUF,X0,AUTO
         7 003613   001777 376007                    ANQ     1023,DL
         7 003614   200162 656110                    ERSQ    FITBUF,X0,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:185  

     1612    13382    5                 ADDR(FITBUF) -> FM$FIT.CODES.ITEMX(I) + 1;
     1613    13383    5               END;

  13383  7 003615   203423 054100                    AOS     I,,AUTO
         7 003616   203423 236100                    LDQ     I,,AUTO
         7 003617   203416 116100                    CMPQ    CODES,,AUTO
         7 003620   003606 604400 7                  TMOZ    s:13381

     1614    13384    4            ADDR(FITBUF) -> FM$FIT.CODES.NDW(0) = ADDR(FITBUF) ->

  13384  7 003621   200162 236100                    LDQ     FITBUF,,AUTO
         7 003622   000012 772000                    QRL     10
         7 003623   001777 376007                    ANQ     1023,DL
         7 003624   000001 036007                    ADLQ    1,DL
         7 003625   000012 736000                    QLS     10
         7 003626   200162 676100                    ERQ     FITBUF,,AUTO
         7 003627   000126 376000 8                  ANQ     86
         7 003630   200162 656100                    ERSQ    FITBUF,,AUTO

     1615    13385    4              FM$FIT.CODES.NDW(0) + 1;
     1616    13386    4            LOW = LOW + 1;

  13386  7 003631   203420 054100                    AOS     LOW,,AUTO

     1617    13387
     1618    13388    4            END;

     1619    13389        /*
     1620    13390           Record the creation of a new FM$FIT.CODE
     1621    13391        */
     1622    13392    3         CODES = CODES + 1;

  13392  7 003632   203416 054100                    AOS     CODES,,AUTO

     1623    13393    3         FREE = CODES;

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:186  
  13393  7 003633   203416 235100                    LDA     CODES,,AUTO
         7 003634   203422 755100                    STA     FREE,,AUTO

     1624    13394    3         ADDR(FITBUF) -> FM$FIT.CODES.CODE(0) = CODES;

  13394  7 003635   203416 236100                    LDQ     CODES,,AUTO
         7 003636   000037 736000                    QLS     31
         7 003637   200162 676100                    ERQ     FITBUF,,AUTO
         7 003640   760000 376003                    ANQ     -8192,DU
         7 003641   200162 656100                    ERSQ    FITBUF,,AUTO

     1625    13395    3         ADDR(FITBUF) -> FM$FIT.CODES.NAW(FREE) = 0;

  13395  7 003642   000127 236000 8                  LDQ     87
         7 003643   200162 356105                    ANSQ    FITBUF,AL,AUTO

     1626    13396
     1627    13397    3         END;

     1628    13398
     1629    13399        /*
     1630    13400           Check to see whether the largest free entry has enough space to hold
     1631    13401           the FITCARD stuff.
     1632    13402        */
     1633    13403
     1634    13404    2      IF ADDR(FITBUF) -> FM$FIT.CODES.NAW(FREE) < SIZE_NEEDED

  13404  7 003644   203422 720100                    LXL0    FREE,,AUTO
         7 003645   200162 236110                    LDQ     FITBUF,X0,AUTO
         7 003646   000024 772000                    QRL     20
         7 003647   001777 376007                    ANQ     1023,DL
         7 003650   203415 116100                    CMPQ    SIZE_NEEDED,,AUTO
         7 003651   003706 603000 7                  TRC     s:13429

     1635    13405    3        THEN DO;

     1636    13406
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:187  
     1637    13407        /*
     1638    13408              Nope; have to allocate a new block at the end of the existing FITBUF.
     1639    13409              Make sure that there's enough space left at the end to hold all of
     1640    13410              the option cards.
     1641    13411        */
     1642    13412    3         IF ADDR(FITBUF) -> FM$FIT.CODES.NDW(0) + SIZE_NEEDED >= SIZEW(FITBUF)

  13412  7 003652   200162 236100                    LDQ     FITBUF,,AUTO
         7 003653   000012 772000                    QRL     10
         7 003654   001777 376007                    ANQ     1023,DL
         7 003655   203415 036100                    ADLQ    SIZE_NEEDED,,AUTO
         7 003656   002000 116007                    CMPQ    1024,DL
         7 003657   003664 602000 7                  TNC     s:13420

     1643    13413    4           THEN DO;

     1644    13414    4            ERRCODE = %E$VWM_FITFULL;

  13414  7 003660   000130 235000 8                  LDA     88
         7 003661   200052 755100                    STA     ERRCODE,,AUTO

     1645    13415    4            ALTRETURN;

  13415  7 003662   202430 221300                    LDX1  ! INTRASHIP+2,,AUTO
         7 003663   000000 702211                    TSX2  ! 0,X1

     1646    13416    4            END;
     1647    13417        /*
     1648    13418              Point the FIT entry to the new space, and reserve it.
     1649    13419        */
     1650    13420    3         ADDR(FITBUF) -> FM$FIT.CODES.NAW(FREE) = SIZE_NEEDED;

  13420  7 003664   203415 236100                    LDQ     SIZE_NEEDED,,AUTO
         7 003665   000024 736000                    QLS     20
         7 003666   200162 676110                    ERQ     FITBUF,X0,AUTO
         7 003667   007774 376003                    ANQ     4092,DU
         7 003670   200162 656110                    ERSQ    FITBUF,X0,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:188  

     1651    13421    3         ADDR(FITBUF) -> FM$FIT.CODES.ITEMX(FREE) =

  13421  7 003671   200162 236100                    LDQ     FITBUF,,AUTO
         7 003672   000012 772000                    QRL     10
         7 003673   200162 676110                    ERQ     FITBUF,X0,AUTO
         7 003674   001777 376007                    ANQ     1023,DL
         7 003675   200162 656110                    ERSQ    FITBUF,X0,AUTO

     1652    13422    3           ADDR(FITBUF) -> FM$FIT.CODES.NDW(0);
     1653    13423    3         ADDR(FITBUF) -> FM$FIT.CODES.NDW(0) =

  13423  7 003676   200162 236100                    LDQ     FITBUF,,AUTO
         7 003677   000012 772000                    QRL     10
         7 003700   001777 376007                    ANQ     1023,DL
         7 003701   203415 036100                    ADLQ    SIZE_NEEDED,,AUTO
         7 003702   000012 736000                    QLS     10
         7 003703   200162 676100                    ERQ     FITBUF,,AUTO
         7 003704   000126 376000 8                  ANQ     86
         7 003705   200162 656100                    ERSQ    FITBUF,,AUTO

     1654    13424    3           ADDR(FITBUF) -> FM$FIT.CODES.NDW(0) + SIZE_NEEDED;
     1655    13425    3         END;

     1656    13426        /*
     1657    13427           Update the code and words-in-use fields.
     1658    13428        */
     1659    13429    2      ADDR(FITBUF) -> FM$FIT.CODES.CODE(FREE) = 13; /* processor attr. */

  13429  7 003706   200162 236110                    LDQ     FITBUF,X0,AUTO
         7 003707   000035 376000 8                  ANQ     29
         7 003710   320000 276003                    ORQ     106496,DU
         7 003711   200162 756110                    STQ     FITBUF,X0,AUTO

     1660    13430    2      ADDR(FITBUF) -> FM$FIT.CODES.NDW(FREE) = SIZE_NEEDED;

  13430  7 003712   203415 236100                    LDQ     SIZE_NEEDED,,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:189  
         7 003713   000012 736000                    QLS     10
         7 003714   200162 676110                    ERQ     FITBUF,X0,AUTO
         7 003715   000126 376000 8                  ANQ     86
         7 003716   200162 656110                    ERSQ    FITBUF,X0,AUTO

     1661    13431        /*
     1662    13432              Move the option cards into the FITBUF.
     1663    13433        */
     1664    13434    2      OFFSET = ADDR(FITBUF) -> FM$FIT.CODES.ITEMX(FREE);

  13434  7 003717   200162 236110                    LDQ     FITBUF,X0,AUTO
         7 003720   001777 376007                    ANQ     1023,DL
         7 003721   203424 756100                    STQ     OFFSET,,AUTO

     1665    13435    3      DO I = 0 TO SIZE_NEEDED - 1;

  13435  7 003722   203423 450100                    STZ     I,,AUTO
         7 003723   003732 710000 7                  TRA     s:13437+1

     1666    13436    3         FITBUF(OFFSET+I) = FITWORD(I);

  13436  7 003724   203424 236100                    LDQ     OFFSET,,AUTO
         7 003725   203423 036100                    ADLQ    I,,AUTO
         7 003726   203423 720100                    LXL0    I,,AUTO
         7 003727   202431 235110                    LDA     FITCARD,X0,AUTO
         7 003730   200162 755106                    STA     FITBUF,QL,AUTO

     1667    13437    3         END;

  13437  7 003731   203423 054100                    AOS     I,,AUTO
         7 003732   203423 236100                    LDQ     I,,AUTO
         7 003733   003724 604000 7                  TMI     s:13436
         7 003734   203415 116100                    CMPQ    SIZE_NEEDED,,AUTO
         7 003735   003724 602000 7                  TNC     s:13436

     1668    13438        /*
     1669    13439              Tweak the information in the outgoing header packets.  Redirect the
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:190  
     1670    13440              file to a randomly-named fid in the appropriate directory, and use
     1671    13441              the standard MAIL authorization to materialize it there.
     1672    13442        */
     1673    13443    2      OPTS.OUT.ACCT = VO_INTERSYS_ACCT;

  13443  7 003736   040000 100400                    MLR     fill='040'O
         7 003737   000265 000010 3                  ADSC9   VO_INTERSYS_ACCT         cn=0,n=8
         7 003740   000051 000010 xsym               ADSC9   VW_OPTIONS#+41           cn=0,n=8

     1674    13444    2      OPTS.OUT.NAME = VO_INTERSYS_NAME;

  13444  7 003741   040000 100400                    MLR     fill='040'O
         7 003742   000267 000014 3                  ADSC9   VO_INTERSYS_NAME         cn=0,n=12
         7 003743   000053 000014 xsym               ADSC9   VW_OPTIONS#+43           cn=0,n=12

     1675    13445    2      PASSWORD = VO_INTERSYS_PASSWORD;

  13445  7 003744   000272 237000 3                  LDAQ    VO_INTERSYS_PASSWORD
         7 003745   021372 757000 1                  STAQ    PASSWORD

     1676    13446    2      CALL ASZ$SCRAMBLE (PASSWORD);

  13446  7 003746   000131 630400 8                  EPPR0   89
         7 003747   000024 631400 8                  EPPR1   20
         7 003750   000000 701000 xent               TSX1    ASZ$SCRAMBLE
         7 003751   000000 011000                    NOP     0

     1677    13447    3      DO I = 0 TO 11;

  13447  7 003752   203423 450100                    STZ     I,,AUTO

     1678    13448    3         BIT9(I) = BIT6(I) + ASCBIN(' ');

  13448  7 003753   203423 235100                    LDA     I,,AUTO
         7 003754   003756 605000 7                  TPL     s:13448+3
         7 003755   000006 035003                    ADLA    6,DU
         7 003756   000100 101405                    MRL     fill='000'O
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:191  
         7 003757   021372 020001 1                  ADSC6   PASSWORD,A               cn=0,n=1
         7 003760   203427 020006                    ADSC6   OFFSET+3,,AUTO           cn=0,n=6
         7 003761   203427 236100                    LDQ     OFFSET+3,,AUTO
         7 003762   000040 036007                    ADLQ    32,DL
         7 003763   203426 756100                    STQ     OFFSET+2,,AUTO
         7 003764   203423 235100                    LDA     I,,AUTO
         7 003765   000005 101500                    MRL     fill='000'O
         7 003766   203426 000004                    ADSC9   OFFSET+2,,AUTO           cn=0,n=4
         7 003767   021367 000001 1                  ADSC9   EPASS,A                  cn=0,n=1

     1679    13449    3         END;

  13449  7 003770   203423 054100                    AOS     I,,AUTO
         7 003771   203423 235100                    LDA     I,,AUTO
         7 003772   000013 115007                    CMPA    11,DL
         7 003773   003753 604400 7                  TMOZ    s:13448

     1680    13450    2      OPTS.OUT.EPASS = EPASS;

  13450  7 003774   040000 100400                    MLR     fill='040'O
         7 003775   021367 000014 1                  ADSC9   EPASS                    cn=0,n=12
         7 003776   000056 000014 xsym               ADSC9   VW_OPTIONS#+46           cn=0,n=12

     1681    13451    2      OPTS.OUT.NODE = EXTERNAL.SITENAME;

  13451  7 003777   200156 237100                    LDAQ    EXTERNAL,,AUTO
         7 004000   000072 755000 xsym               STA     VW_OPTIONS#+58
         7 004001   000073 756000 xsym               STQ     VW_OPTIONS#+59

     1682    13452    2      OPTS.MAILSNDR.WHO = ' ';

  13452  7 004002   040000 236003                    LDQ     16384,DU
         7 004003   000121 552040 xsym               STBQ    VW_OPTIONS#+81,'40'O

     1683    13453    2      OPTS.MAILRCVR.WHO = ' ';

  13453  7 004004   000171 552040 xsym               STBQ    VW_OPTIONS#+121,'40'O
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:192  

     1684    13454    2      OPTS.MAILINIT.WHO = ' ';

  13454  7 004005   000241 552040 xsym               STBQ    VW_OPTIONS#+161,'40'O

     1685    13455    2      CALL M$TIME (CLOCK_TO_UTS);

  13455  7 004006   000044 630400 3                  EPPR0   CLOCK_TO_UTS
         7 004007   020004 713400                    CLIMB   8196
         7 004010   402000 401760                    pmme    nvectors=5

     1686    13456    2      CALL CONCAT (OPTS.OUT.FID, 'MOVExxxxxxxx', VW_IAM#);

  13456  7 004011   040000 100400                    MLR     fill='040'O
         7 004012   000313 000014 3                  ADSC9   VO_INTERSYS_PASSWORD+17  cn=0,n=12
         7 004013   000074 200014 xsym               ADSC9   VW_OPTIONS#+60           cn=1,n=12
         7 004014   040000 100400                    MLR     fill='040'O
         7 004015   000000 000010 xsym               ADSC9   VW_IAM#                  cn=0,n=8
         7 004016   000077 200103 xsym               ADSC9   VW_OPTIONS#+63           cn=1,n=67

     1687    13457    2      CALL BINCHAR (SUBSTR(OPTS.OUT.FID, 4, 8), TODAY);

  13457  7 004017   001364 235000 1                  LDA     TODAY
         7 004020   000044 773000                    LRL     36
         7 004021   203426 757100                    STAQ    OFFSET+2,,AUTO
         7 004022   000000 301500                    BTD
         7 004023   203426 000010                    NDSC9   OFFSET+2,,AUTO           cn=0,s=lsgnf,sf=0,n=8
         7 004024   000075 230010 xsym               NDSC9   VW_OPTIONS#+61           cn=1,s=nosgn,sf=0,n=8

     1688    13458    2      CALL INDEX (I, ' ', OPTS.OUT.FID);

  13458  7 004025   000000 124400                    SCM     mask='000'O
         7 004026   000074 200117 xsym               ADSC9   VW_OPTIONS#+60           cn=1,n=79
         7 004027   000015 000001 8                  ADSC9   13                       cn=0,n=1
         7 004030   203423 000100                    ARG     I,,AUTO

     1689    13459    2      CALL INSERT (OPTS.OUT.FID, I, , '.', EXTERNAL.ACCT);
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:193  

  13459  7 004031   203423 720100                    LXL0    I,,AUTO
         7 004032   777660 620010                    EAX0    -80,X0
         7 004033   777777 660003                    ERX0    -1,DU
         7 004034   203423 235100                    LDA     I,,AUTO
         7 004035   040045 100400                    MLR     fill='040'O
         7 004036   000073 000001 8                  ADSC9   59                       cn=0,n=1
         7 004037   000074 200010 xsym               ADSC9   VW_OPTIONS#+60,A         cn=1,n=*X0
         7 004040   203423 236100                    LDQ     I,,AUTO
         7 004041   000116 116007                    CMPQ    78,DL
         7 004042   004050 605000 7                  TPL     s:13460
         7 004043   777661 621006                    EAX1    -79,QL
         7 004044   777777 661003                    ERX1    -1,DU
         7 004045   040046 100500                    MLR     fill='040'O
         7 004046   200160 000010                    ADSC9   EXTERNAL+2,,AUTO         cn=0,n=8
         7 004047   000074 400011 xsym               ADSC9   VW_OPTIONS#+60,Q         cn=2,n=*X1

     1690    13460    2      CALL INDEX (I, ' ', OPTS.OUT.FID);

  13460  7 004050   000000 124400                    SCM     mask='000'O
         7 004051   000074 200117 xsym               ADSC9   VW_OPTIONS#+60           cn=1,n=79
         7 004052   000015 000001 8                  ADSC9   13                       cn=0,n=1
         7 004053   203423 000100                    ARG     I,,AUTO

     1691    13461    2      OPTS.OUT.L = I + ASCBIN('/');

  13461  7 004054   203423 236100                    LDQ     I,,AUTO
         7 004055   000057 036007                    ADLQ    47,DL
         7 004056   000033 736000                    QLS     27
         7 004057   000074 552040 xsym               STBQ    VW_OPTIONS#+60,'40'O

     1692    13462
     1693    13463    2      RETURN;

  13463  7 004060   202430 221300                    LDX1  ! INTRASHIP+2,,AUTO
         7 004061   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:194  
     1694    13464
     1695    13465    2   END FIDDLE_FIT;
     1696    13466        %EJECT;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:195  
     1697    13467        /*I**
     1698    13468        *
     1699    13469        *   NAME:  FORMAT
     1700    13470        *
     1701    13471        *   PURPOSE:
     1702    13472        *       To format a buffer into JEBUF and write it when JEBUF is full.
     1703    13473        *
     1704    13474        *   CALL:
     1705    13475        *       CALL FORMAT(bfr,siz,mxs,cont,binm) ALTRET...
     1706    13476        *
     1707    13477        *   PARAMETERS:
     1708    13478        *       bfr - is the input buffer to be reformatted.  siz - is the size of
     1709    13479        *       bfr.  mxs - is the maximum size of the record, which may exceed siz
     1710    13480        *       and is used only when records are larger than 32K bytes.  cont - is
     1711    13481        *       a bit variable; if FALSE, length bytes are written, otherwise not.
     1712    13482        *       binm - is a bit variable; if TRUE, data are written in 3-for-2 or
     1713    13483        *       "encoded" format.
     1714    13484        *
     1715    13485        *   DATA:
     1716    13486        *       FORMAT uses the global variable JEIDX which points to the last-used
     1717    13487        *       byte in JEBUF.
     1718    13488        *
     1719    13489        *   DESCRIPTION:
     1720    13490        *       FORMAT reformats BFR of length SIZ into JEBUF; maximum record
     1721    13491        *       size is MXS (which may exceed SIZ).  If CONT is false, write
     1722    13492        *       the length control byte(s) and DVBYTE; otherwise, just write
     1723    13493        *       data.  If BINM is true, write the data in 3-for-2 format; else
     1724    13494        *       write it "clear".  ALTRET if an I/O error occurs in STUFF.
     1725    13495        *
     1726    13496        ****/
     1727    13497
     1728    13498    1   FORMAT: PROC(BFR,SIZ,MXS,CONT,BINM) ALTRET;

  13498  7 004062   202430 741300       FORMAT       STX1  ! INTRASHIP+2,,AUTO

     1729    13499
     1730    13500    2   DCL BFR                            UNAL CHAR(SIZ);
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:196  
     1731    13501    2   DCL SIZ                            ALIGNED SBIN;
     1732    13502    2   DCL MXS                            ALIGNED SBIN;
     1733    13503    2   DCL CONT                           UNAL BIT(1);
     1734    13504    2   DCL BINM                           UNAL BIT(1);
     1735    13505
     1736    13506    2   DCL EBIT                           SBIN;
     1737    13507    2   DCL I                              SBIN;
     1738    13508    2   DCL J                              SBIN;
     1739    13509
     1740    13510        /****
     1741    13511        *
     1742    13512        *   If not continuing a record, supply the record header.  Note that
     1743    13513        *   this routine does keys as well as data.
     1744    13514        *
     1745    13515        ****/
     1746    13516
     1747    13517    3      IF NOT CONT THEN DO;

  13517  7 004063   202434 470500                    LDP0    @CONT,,AUTO
         7 004064   000000 066500                    CMPB    filb='0'B
         7 004065   000000 000001                    BDSC    0,,PR0                   by=0,bit=0,n=1
         7 004066   000007 000022 8                  BDSC    7                        by=0,bit=0,n=18
         7 004067   004430 601000 7                  TNZ     s:13626

     1748    13518    3         IF BINM THEN

  13518  7 004070   202435 471500                    LDP1    @BINM,,AUTO
         7 004071   000000 066500                    CMPB    filb='0'B
         7 004072   100000 000001                    BDSC    0,,PR1                   by=0,bit=0,n=1
         7 004073   000007 000022 8                  BDSC    7                        by=0,bit=0,n=18
         7 004074   004100 600000 7                  TZE     s:13521

     1749    13519    3            EBIT=32;

  13519  7 004075   000040 235007                    LDA     32,DL
         7 004076   202436 755100                    STA     EBIT,,AUTO
         7 004077   004101 710000 7                  TRA     s:13529
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:197  

     1750    13520    3           ELSE
     1751    13521    3            EBIT=0;

  13521  7 004100   202436 450100                    STZ     EBIT,,AUTO

     1752    13522
     1753    13523        /****
     1754    13524        *
     1755    13525        *   If the records are bigger than 16384 bytes, we need 4 length bytes.
     1756    13526        *
     1757    13527        ****/
     1758    13528
     1759    13529    4         IF MXS>16384 THEN DO;

  13529  7 004101   202433 473500                    LDP3    @MXS,,AUTO
         7 004102   300000 235100                    LDA     0,,PR3
         7 004103   040000 115007                    CMPA    16384,DL
         7 004104   004224 604400 7                  TMOZ    s:13557

     1760    13530    4            JEIDX=JEIDX+1;

  13530  7 004105   200020 054100                    AOS     JEIDX,,AUTO

     1761    13531    4            IF JEIDX>79 THEN

  13531  7 004106   200020 236100                    LDQ     JEIDX,,AUTO
         7 004107   000117 116007                    CMPQ    79,DL
         7 004110   004113 604400 7                  TMOZ    s:13533

     1762    13532    4               CALL STUFF ALTRET(FORMAT_ABORT);

  13532  7 004111   004754 701000 7                  TSX1    STUFF
         7 004112   004752 702000 7                  TSX2    FORMAT_ABORT

     1763    13533    4            CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+28+EBIT+

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:198  
  13533  7 004113   202433 470500                    LDP0    @MXS,,AUTO
         7 004114   000000 236100                    LDQ     0,,PR0
         7 004115   000001 136007                    SBLQ    1,DL
         7 004116   000001 506003                    DIV     1,DU
         7 004117   202436 036100                    ADLQ    EBIT,,AUTO
         7 004120   000074 036007                    ADLQ    60,DL
         7 004121   000033 736000                    QLS     27
         7 004122   000057 276000 8                  ORQ     47
         7 004123   203426 756100                    STQ     OFFSET+2,,AUTO
         7 004124   200020 235100                    LDA     JEIDX,,AUTO
         7 004125   040105 100500                    MLR     fill='040'O
         7 004126   203426 000004                    ADSC9   OFFSET+2,,AUTO           cn=0,n=4
         7 004127   202162 000001                    ADSC9   JEBUF,A,AUTO             cn=0,n=1

     1764    13534    4              (MXS-1)/262144));
     1765    13535    4            JEIDX=JEIDX+1;

  13535  7 004130   200020 054100                    AOS     JEIDX,,AUTO

     1766    13536    4            IF JEIDX>79 THEN

  13536  7 004131   200020 235100                    LDA     JEIDX,,AUTO
         7 004132   000117 115007                    CMPA    79,DL
         7 004133   004136 604400 7                  TMOZ    s:13538

     1767    13537    4               CALL STUFF ALTRET(FORMAT_ABORT);

  13537  7 004134   004754 701000 7                  TSX1    STUFF
         7 004135   004752 702000 7                  TSX2    FORMAT_ABORT

     1768    13538    4            CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+MOD((MXS-1)/4096,

  13538  7 004136   202433 470500                    LDP0    @MXS,,AUTO
         7 004137   000000 236100                    LDQ     0,,PR0
         7 004140   000001 136007                    SBLQ    1,DL
         7 004141   010000 506007                    DIV     4096,DL
         7 004142   000100 506007                    DIV     64,DL
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:199  
         7 004143   000044 733000                    LRS     36
         7 004144   000040 036007                    ADLQ    32,DL
         7 004145   000033 736000                    QLS     27
         7 004146   000057 276000 8                  ORQ     47
         7 004147   203426 756100                    STQ     OFFSET+2,,AUTO
         7 004150   200020 235100                    LDA     JEIDX,,AUTO
         7 004151   040105 100500                    MLR     fill='040'O
         7 004152   203426 000004                    ADSC9   OFFSET+2,,AUTO           cn=0,n=4
         7 004153   202162 000001                    ADSC9   JEBUF,A,AUTO             cn=0,n=1

     1769    13539    4              64)));
     1770    13540    4            JEIDX=JEIDX+1;

  13540  7 004154   200020 054100                    AOS     JEIDX,,AUTO

     1771    13541    4            IF JEIDX>79 THEN

  13541  7 004155   200020 235100                    LDA     JEIDX,,AUTO
         7 004156   000117 115007                    CMPA    79,DL
         7 004157   004162 604400 7                  TMOZ    s:13543

     1772    13542    4               CALL STUFF ALTRET(FORMAT_ABORT);

  13542  7 004160   004754 701000 7                  TSX1    STUFF
         7 004161   004752 702000 7                  TSX2    FORMAT_ABORT

     1773    13543    4            CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+MOD((MXS-1)/64,

  13543  7 004162   202433 470500                    LDP0    @MXS,,AUTO
         7 004163   000000 236100                    LDQ     0,,PR0
         7 004164   000001 136007                    SBLQ    1,DL
         7 004165   000100 506007                    DIV     64,DL
         7 004166   000100 506007                    DIV     64,DL
         7 004167   000044 733000                    LRS     36
         7 004170   000040 036007                    ADLQ    32,DL
         7 004171   000033 736000                    QLS     27
         7 004172   000057 276000 8                  ORQ     47
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:200  
         7 004173   203426 756100                    STQ     OFFSET+2,,AUTO
         7 004174   200020 235100                    LDA     JEIDX,,AUTO
         7 004175   040105 100500                    MLR     fill='040'O
         7 004176   203426 000004                    ADSC9   OFFSET+2,,AUTO           cn=0,n=4
         7 004177   202162 000001                    ADSC9   JEBUF,A,AUTO             cn=0,n=1

     1774    13544    4              64)));
     1775    13545    4            JEIDX=JEIDX+1;

  13545  7 004200   200020 054100                    AOS     JEIDX,,AUTO

     1776    13546    4            IF JEIDX>79 THEN

  13546  7 004201   200020 235100                    LDA     JEIDX,,AUTO
         7 004202   000117 115007                    CMPA    79,DL
         7 004203   004206 604400 7                  TMOZ    s:13548

     1777    13547    4               CALL STUFF ALTRET(FORMAT_ABORT);

  13547  7 004204   004754 701000 7                  TSX1    STUFF
         7 004205   004752 702000 7                  TSX2    FORMAT_ABORT

     1778    13548    4            CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+MOD(MXS-1,64)));

  13548  7 004206   202433 470500                    LDP0    @MXS,,AUTO
         7 004207   000000 236100                    LDQ     0,,PR0
         7 004210   000001 136007                    SBLQ    1,DL
         7 004211   000100 506007                    DIV     64,DL
         7 004212   000044 733000                    LRS     36
         7 004213   000040 036007                    ADLQ    32,DL
         7 004214   000033 736000                    QLS     27
         7 004215   000057 276000 8                  ORQ     47
         7 004216   203426 756100                    STQ     OFFSET+2,,AUTO
         7 004217   200020 235100                    LDA     JEIDX,,AUTO
         7 004220   040105 100500                    MLR     fill='040'O
         7 004221   203426 000004                    ADSC9   OFFSET+2,,AUTO           cn=0,n=4
         7 004222   202162 000001                    ADSC9   JEBUF,A,AUTO             cn=0,n=1
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:201  

     1779    13549    4            END;

  13549  7 004223   004430 710000 7                  TRA     s:13626

     1780    13550
     1781    13551        /****
     1782    13552        *
     1783    13553        *   If the records are 513-16384 bytes, we need three length bytes.
     1784    13554        *
     1785    13555        ****/
     1786    13556
     1787    13557    4           ELSE IF MXS>512 THEN DO;

  13557  7 004224   001000 115007                    CMPA    512,DL
         7 004225   004321 604400 7                  TMOZ    s:13580

     1788    13558    4               JEIDX=JEIDX+1;

  13558  7 004226   200020 054100                    AOS     JEIDX,,AUTO

     1789    13559    4               IF JEIDX>79 THEN

  13559  7 004227   200020 236100                    LDQ     JEIDX,,AUTO
         7 004230   000117 116007                    CMPQ    79,DL
         7 004231   004234 604400 7                  TMOZ    s:13561

     1790    13560    4                  CALL STUFF ALTRET(FORMAT_ABORT);

  13560  7 004232   004754 701000 7                  TSX1    STUFF
         7 004233   004752 702000 7                  TSX2    FORMAT_ABORT

     1791    13561    4               CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+24+EBIT+

  13561  7 004234   202433 470500                    LDP0    @MXS,,AUTO
         7 004235   000000 236100                    LDQ     0,,PR0
         7 004236   000001 136007                    SBLQ    1,DL
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:202  
         7 004237   010000 506007                    DIV     4096,DL
         7 004240   202436 036100                    ADLQ    EBIT,,AUTO
         7 004241   000070 036007                    ADLQ    56,DL
         7 004242   000033 736000                    QLS     27
         7 004243   000057 276000 8                  ORQ     47
         7 004244   203426 756100                    STQ     OFFSET+2,,AUTO
         7 004245   200020 235100                    LDA     JEIDX,,AUTO
         7 004246   040105 100500                    MLR     fill='040'O
         7 004247   203426 000004                    ADSC9   OFFSET+2,,AUTO           cn=0,n=4
         7 004250   202162 000001                    ADSC9   JEBUF,A,AUTO             cn=0,n=1

     1792    13562    4                 (MXS-1)/4096));
     1793    13563    4               JEIDX=JEIDX+1;

  13563  7 004251   200020 054100                    AOS     JEIDX,,AUTO

     1794    13564    4               IF JEIDX>79 THEN

  13564  7 004252   200020 235100                    LDA     JEIDX,,AUTO
         7 004253   000117 115007                    CMPA    79,DL
         7 004254   004257 604400 7                  TMOZ    s:13566

     1795    13565    4                  CALL STUFF ALTRET(FORMAT_ABORT);

  13565  7 004255   004754 701000 7                  TSX1    STUFF
         7 004256   004752 702000 7                  TSX2    FORMAT_ABORT

     1796    13566    4               CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+MOD((MXS-1)/64,

  13566  7 004257   202433 470500                    LDP0    @MXS,,AUTO
         7 004260   000000 236100                    LDQ     0,,PR0
         7 004261   000001 136007                    SBLQ    1,DL
         7 004262   000100 506007                    DIV     64,DL
         7 004263   000100 506007                    DIV     64,DL
         7 004264   000044 733000                    LRS     36
         7 004265   000040 036007                    ADLQ    32,DL
         7 004266   000033 736000                    QLS     27
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:203  
         7 004267   000057 276000 8                  ORQ     47
         7 004270   203426 756100                    STQ     OFFSET+2,,AUTO
         7 004271   200020 235100                    LDA     JEIDX,,AUTO
         7 004272   040105 100500                    MLR     fill='040'O
         7 004273   203426 000004                    ADSC9   OFFSET+2,,AUTO           cn=0,n=4
         7 004274   202162 000001                    ADSC9   JEBUF,A,AUTO             cn=0,n=1

     1797    13567    4                 64)));
     1798    13568    4               JEIDX=JEIDX+1;

  13568  7 004275   200020 054100                    AOS     JEIDX,,AUTO

     1799    13569    4               IF JEIDX>79 THEN

  13569  7 004276   200020 235100                    LDA     JEIDX,,AUTO
         7 004277   000117 115007                    CMPA    79,DL
         7 004300   004303 604400 7                  TMOZ    s:13571

     1800    13570    4                  CALL STUFF ALTRET(FORMAT_ABORT);

  13570  7 004301   004754 701000 7                  TSX1    STUFF
         7 004302   004752 702000 7                  TSX2    FORMAT_ABORT

     1801    13571    4               CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+MOD(MXS-1,64)));

  13571  7 004303   202433 470500                    LDP0    @MXS,,AUTO
         7 004304   000000 236100                    LDQ     0,,PR0
         7 004305   000001 136007                    SBLQ    1,DL
         7 004306   000100 506007                    DIV     64,DL
         7 004307   000044 733000                    LRS     36
         7 004310   000040 036007                    ADLQ    32,DL
         7 004311   000033 736000                    QLS     27
         7 004312   000057 276000 8                  ORQ     47
         7 004313   203426 756100                    STQ     OFFSET+2,,AUTO
         7 004314   200020 235100                    LDA     JEIDX,,AUTO
         7 004315   040105 100500                    MLR     fill='040'O
         7 004316   203426 000004                    ADSC9   OFFSET+2,,AUTO           cn=0,n=4
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:204  
         7 004317   202162 000001                    ADSC9   JEBUF,A,AUTO             cn=0,n=1

     1802    13572    4               END;

  13572  7 004320   004430 710000 7                  TRA     s:13626

     1803    13573
     1804    13574        /****
     1805    13575        *
     1806    13576        *   If the records are 17-512 bytes, we need two length bytes.
     1807    13577        *
     1808    13578        ****/
     1809    13579
     1810    13580    4              ELSE IF MXS>16 THEN DO;

  13580  7 004321   000020 115007                    CMPA    16,DL
         7 004322   004372 604400 7                  TMOZ    s:13598

     1811    13581    4                  JEIDX=JEIDX+1;

  13581  7 004323   200020 054100                    AOS     JEIDX,,AUTO

     1812    13582    4                  IF JEIDX>79 THEN

  13582  7 004324   200020 236100                    LDQ     JEIDX,,AUTO
         7 004325   000117 116007                    CMPQ    79,DL
         7 004326   004331 604400 7                  TMOZ    s:13584

     1813    13583    4                     CALL STUFF ALTRET(FORMAT_ABORT);

  13583  7 004327   004754 701000 7                  TSX1    STUFF
         7 004330   004752 702000 7                  TSX2    FORMAT_ABORT

     1814    13584    4                  CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+16+EBIT+

  13584  7 004331   202433 470500                    LDP0    @MXS,,AUTO
         7 004332   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:205  
         7 004333   000001 136007                    SBLQ    1,DL
         7 004334   000100 506007                    DIV     64,DL
         7 004335   202436 036100                    ADLQ    EBIT,,AUTO
         7 004336   000060 036007                    ADLQ    48,DL
         7 004337   000033 736000                    QLS     27
         7 004340   000057 276000 8                  ORQ     47
         7 004341   203426 756100                    STQ     OFFSET+2,,AUTO
         7 004342   200020 235100                    LDA     JEIDX,,AUTO
         7 004343   040105 100500                    MLR     fill='040'O
         7 004344   203426 000004                    ADSC9   OFFSET+2,,AUTO           cn=0,n=4
         7 004345   202162 000001                    ADSC9   JEBUF,A,AUTO             cn=0,n=1

     1815    13585    4                    (MXS-1)/64));
     1816    13586    4                  JEIDX=JEIDX+1;

  13586  7 004346   200020 054100                    AOS     JEIDX,,AUTO

     1817    13587    4                  IF JEIDX>79 THEN

  13587  7 004347   200020 235100                    LDA     JEIDX,,AUTO
         7 004350   000117 115007                    CMPA    79,DL
         7 004351   004354 604400 7                  TMOZ    s:13589

     1818    13588    4                     CALL STUFF ALTRET(FORMAT_ABORT);

  13588  7 004352   004754 701000 7                  TSX1    STUFF
         7 004353   004752 702000 7                  TSX2    FORMAT_ABORT

     1819    13589    4                  CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+MOD(MXS-1,64)));

  13589  7 004354   202433 470500                    LDP0    @MXS,,AUTO
         7 004355   000000 236100                    LDQ     0,,PR0
         7 004356   000001 136007                    SBLQ    1,DL
         7 004357   000100 506007                    DIV     64,DL
         7 004360   000044 733000                    LRS     36
         7 004361   000040 036007                    ADLQ    32,DL
         7 004362   000033 736000                    QLS     27
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:206  
         7 004363   000057 276000 8                  ORQ     47
         7 004364   203426 756100                    STQ     OFFSET+2,,AUTO
         7 004365   200020 235100                    LDA     JEIDX,,AUTO
         7 004366   040105 100500                    MLR     fill='040'O
         7 004367   203426 000004                    ADSC9   OFFSET+2,,AUTO           cn=0,n=4
         7 004370   202162 000001                    ADSC9   JEBUF,A,AUTO             cn=0,n=1

     1820    13590    4                  END;

  13590  7 004371   004430 710000 7                  TRA     s:13626

     1821    13591
     1822    13592        /****
     1823    13593        *
     1824    13594        *   If the records are 1-16 bytes, we need one length byte.
     1825    13595        *
     1826    13596        ****/
     1827    13597
     1828    13598    4                 ELSE IF MXS>0 THEN DO;

  13598  7 004372   000000 115003                    CMPA    0,DU
         7 004373   004416 604400 7                  TMOZ    s:13612

     1829    13599    4                     JEIDX=JEIDX+1;

  13599  7 004374   200020 054100                    AOS     JEIDX,,AUTO

     1830    13600    4                     IF JEIDX>79 THEN

  13600  7 004375   200020 236100                    LDQ     JEIDX,,AUTO
         7 004376   000117 116007                    CMPQ    79,DL
         7 004377   004402 604400 7                  TMOZ    s:13602

     1831    13601    4                        CALL STUFF ALTRET(FORMAT_ABORT);

  13601  7 004400   004754 701000 7                  TSX1    STUFF
         7 004401   004752 702000 7                  TSX2    FORMAT_ABORT
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:207  

     1832    13602    4                     CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+EBIT+MXS-1));

  13602  7 004402   202433 470500                    LDP0    @MXS,,AUTO
         7 004403   202436 236100                    LDQ     EBIT,,AUTO
         7 004404   000000 036100                    ADLQ    0,,PR0
         7 004405   000037 036007                    ADLQ    31,DL
         7 004406   000033 736000                    QLS     27
         7 004407   000057 276000 8                  ORQ     47
         7 004410   203426 756100                    STQ     OFFSET+2,,AUTO
         7 004411   200020 235100                    LDA     JEIDX,,AUTO
         7 004412   040105 100500                    MLR     fill='040'O
         7 004413   203426 000004                    ADSC9   OFFSET+2,,AUTO           cn=0,n=4
         7 004414   202162 000001                    ADSC9   JEBUF,A,AUTO             cn=0,n=1

     1833    13603    4                     END;

  13603  7 004415   004430 710000 7                  TRA     s:13626

     1834    13604
     1835    13605        /****
     1836    13606        *
     1837    13607        *   Special case for 0-length records.
     1838    13608        *
     1839    13609        ****/
     1840    13610
     1841    13611    4                    ELSE DO;

     1842    13612    4                     JEIDX=JEIDX+1;

  13612  7 004416   200020 054100                    AOS     JEIDX,,AUTO

     1843    13613    4                     IF JEIDX>79 THEN

  13613  7 004417   200020 236100                    LDQ     JEIDX,,AUTO
         7 004420   000117 116007                    CMPQ    79,DL
         7 004421   004424 604400 7                  TMOZ    s:13615
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:208  

     1844    13614    4                        CALL STUFF ALTRET(FORMAT_ABORT);

  13614  7 004422   004754 701000 7                  TSX1    STUFF
         7 004423   004752 702000 7                  TSX2    FORMAT_ABORT

     1845    13615    4                     CALL INSERT(JEBUF,JEIDX,1,'`');

  13615  7 004424   200020 235100                    LDA     JEIDX,,AUTO
         7 004425   040105 100400                    MLR     fill='040'O
         7 004426   000132 000001 8                  ADSC9   90                       cn=0,n=1
         7 004427   202162 000001                    ADSC9   JEBUF,A,AUTO             cn=0,n=1

     1846    13616    4                     END;

     1847    13617    3         END;

     1848    13618
     1849    13619        /****
     1850    13620        *
     1851    13621        *   If the data are in binary (i.e., not in ASC95), convert the entire
     1852    13622        *   record (segment) to 3-for-2 format.
     1853    13623        *
     1854    13624        ****/
     1855    13625
     1856    13626    3      IF BINM THEN DO;

  13626  7 004430   202435 470500                    LDP0    @BINM,,AUTO
         7 004431   000000 066500                    CMPB    filb='0'B
         7 004432   000000 000001                    BDSC    0,,PR0                   by=0,bit=0,n=1
         7 004433   000007 000022 8                  BDSC    7                        by=0,bit=0,n=18
         7 004434   004701 600000 7                  TZE     s:13679

     1857    13627    4         DO I=0 TO SIZ-2 BY 2;

  13627  7 004435   202437 450100                    STZ     I,,AUTO
         7 004436   004571 710000 7                  TRA     s:13644+2
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:209  

     1858    13628    4            JEIDX=JEIDX+1;

  13628  7 004437   200020 054100                    AOS     JEIDX,,AUTO

     1859    13629    4            IF JEIDX>79 THEN

  13629  7 004440   200020 235100                    LDA     JEIDX,,AUTO
         7 004441   000117 115007                    CMPA    79,DL
         7 004442   004445 604400 7                  TMOZ    s:13631

     1860    13630    4               CALL STUFF ALTRET(FORMAT_ABORT);

  13630  7 004443   004754 701000 7                  TSX1    STUFF
         7 004444   004752 702000 7                  TSX2    FORMAT_ABORT

     1861    13631    4            CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+ASCBIN(SUBSTR

  13631  7 004445   202432 470500                    LDP0    @SIZ,,AUTO
         7 004446   000000 720100                    LXL0    0,,PR0
         7 004447   202431 471500                    LDP1    @BFR,,AUTO
         7 004450   202437 235100                    LDA     I,,AUTO
         7 004451   000100 101505                    MRL     fill='000'O
         7 004452   100000 000001                    ADSC9   0,A,PR1                  cn=0,n=1
         7 004453   203426 000004                    ADSC9   OFFSET+2,,AUTO           cn=0,n=4
         7 004454   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 004455   000003 772000                    QRL     3
         7 004456   000040 036007                    ADLQ    32,DL
         7 004457   000033 736000                    QLS     27
         7 004460   000057 276000 8                  ORQ     47
         7 004461   203427 756100                    STQ     OFFSET+3,,AUTO
         7 004462   200020 235100                    LDA     JEIDX,,AUTO
         7 004463   040105 100500                    MLR     fill='040'O
         7 004464   203427 000004                    ADSC9   OFFSET+3,,AUTO           cn=0,n=4
         7 004465   202162 000001                    ADSC9   JEBUF,A,AUTO             cn=0,n=1

     1862    13632    4              (BFR,I,1))/8));
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:210  
     1863    13633    4            JEIDX=JEIDX+1;

  13633  7 004466   200020 054100                    AOS     JEIDX,,AUTO

     1864    13634    4            IF JEIDX>79 THEN

  13634  7 004467   200020 235100                    LDA     JEIDX,,AUTO
         7 004470   000117 115007                    CMPA    79,DL
         7 004471   004474 604400 7                  TMOZ    s:13636

     1865    13635    4               CALL STUFF ALTRET(FORMAT_ABORT);

  13635  7 004472   004754 701000 7                  TSX1    STUFF
         7 004473   004752 702000 7                  TSX2    FORMAT_ABORT

     1866    13636    4            CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+8*BITBIN

  13636  7 004474   202432 470500                    LDP0    @SIZ,,AUTO
         7 004475   000000 720100                    LXL0    0,,PR0
         7 004476   202431 471500                    LDP1    @BFR,,AUTO
         7 004477   202437 235100                    LDA     I,,AUTO
         7 004500   000100 100505                    MLR     fill='000'O
         7 004501   100000 000001                    ADSC9   0,A,PR1                  cn=0,n=1
         7 004502   203426 000004                    ADSC9   OFFSET+2,,AUTO           cn=0,n=4
         7 004503   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 004504   000022 772000                    QRL     18
         7 004505   000000 620006                    EAX0    0,QL
         7 004506   007000 360003                    ANX0    3584,DU
         7 004507   000000 636010                    EAQ     0,X0
         7 004510   000033 772000                    QRL     27
         7 004511   000000 720100                    LXL0    0,,PR0
         7 004512   000100 101505                    MRL     fill='000'O
         7 004513   100000 200001                    ADSC9   0,A,PR1                  cn=1,n=1
         7 004514   203427 000004                    ADSC9   OFFSET+3,,AUTO           cn=0,n=4
         7 004515   203430 756100                    STQ     OFFSET+4,,AUTO
         7 004516   203427 236100                    LDQ     OFFSET+3,,AUTO
         7 004517   000006 772000                    QRL     6
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:211  
         7 004520   203431 756100                    STQ     OFFSET+5,,AUTO
         7 004521   203430 236100                    LDQ     OFFSET+4,,AUTO
         7 004522   000003 736000                    QLS     3
         7 004523   203431 036100                    ADLQ    OFFSET+5,,AUTO
         7 004524   000040 036007                    ADLQ    32,DL
         7 004525   000033 736000                    QLS     27
         7 004526   000057 276000 8                  ORQ     47
         7 004527   203432 756100                    STQ     OFFSET+6,,AUTO
         7 004530   200020 235100                    LDA     JEIDX,,AUTO
         7 004531   040105 100500                    MLR     fill='040'O
         7 004532   203432 000004                    ADSC9   OFFSET+6,,AUTO           cn=0,n=4
         7 004533   202162 000001                    ADSC9   JEBUF,A,AUTO             cn=0,n=1

     1867    13637    4              (ASCBIT(SUBSTR(BFR,I,1))&'007'O)+ASCBIN(SUBSTR(BFR,
     1868    13638    4              I+1,1))/64));
     1869    13639    4            JEIDX=JEIDX+1;

  13639  7 004534   200020 054100                    AOS     JEIDX,,AUTO

     1870    13640    4            IF JEIDX>79 THEN

  13640  7 004535   200020 235100                    LDA     JEIDX,,AUTO
         7 004536   000117 115007                    CMPA    79,DL
         7 004537   004542 604400 7                  TMOZ    s:13642

     1871    13641    4               CALL STUFF ALTRET(FORMAT_ABORT);

  13641  7 004540   004754 701000 7                  TSX1    STUFF
         7 004541   004752 702000 7                  TSX2    FORMAT_ABORT

     1872    13642    4            CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+BITBIN(ASCBIT

  13642  7 004542   202432 470500                    LDP0    @SIZ,,AUTO
         7 004543   000000 720100                    LXL0    0,,PR0
         7 004544   202431 471500                    LDP1    @BFR,,AUTO
         7 004545   202437 235100                    LDA     I,,AUTO
         7 004546   000100 100505                    MLR     fill='000'O
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:212  
         7 004547   100000 200001                    ADSC9   0,A,PR1                  cn=1,n=1
         7 004550   203426 000004                    ADSC9   OFFSET+2,,AUTO           cn=0,n=4
         7 004551   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 004552   000022 772000                    QRL     18
         7 004553   000000 620006                    EAX0    0,QL
         7 004554   077000 360003                    ANX0    32256,DU
         7 004555   000000 636010                    EAQ     0,X0
         7 004556   000033 772000                    QRL     27
         7 004557   000040 036007                    ADLQ    32,DL
         7 004560   000033 736000                    QLS     27
         7 004561   000057 276000 8                  ORQ     47
         7 004562   203427 756100                    STQ     OFFSET+3,,AUTO
         7 004563   200020 235100                    LDA     JEIDX,,AUTO
         7 004564   040105 100500                    MLR     fill='040'O
         7 004565   203427 000004                    ADSC9   OFFSET+3,,AUTO           cn=0,n=4
         7 004566   202162 000001                    ADSC9   JEBUF,A,AUTO             cn=0,n=1

     1873    13643    4              (SUBSTR(BFR,I+1,1))&'077'O)));
     1874    13644    4            END;

  13644  7 004567   000002 236007                    LDQ     2,DL
         7 004570   202437 056100                    ASQ     I,,AUTO
         7 004571   202432 470500                    LDP0    @SIZ,,AUTO
         7 004572   000000 236100                    LDQ     0,,PR0
         7 004573   000002 136007                    SBLQ    2,DL
         7 004574   202437 116100                    CMPQ    I,,AUTO
         7 004575   004437 605000 7                  TPL     s:13628

     1875    13645
     1876    13646        /****
     1877    13647        *
     1878    13648        *   We must send an extra 0-byte if there are an odd number of binary
     1879    13649        *   digits.  The length, however, reflects the true record length.
     1880    13650        *
     1881    13651        ****/
     1882    13652
     1883    13653    4         IF MOD(SIZ,2)=1 THEN DO;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:213  

  13653  7 004576   000000 236100                    LDQ     0,,PR0
         7 004577   000002 506007                    DIV     2,DL
         7 004600   000044 733000                    LRS     36
         7 004601   000001 116007                    CMPQ    1,DL
         7 004602   004750 601000 7                  TNZ     s:13693

     1884    13654    4            JEIDX=JEIDX+1;

  13654  7 004603   200020 054100                    AOS     JEIDX,,AUTO

     1885    13655    4            IF JEIDX>79 THEN

  13655  7 004604   200020 235100                    LDA     JEIDX,,AUTO
         7 004605   000117 115007                    CMPA    79,DL
         7 004606   004611 604400 7                  TMOZ    s:13657

     1886    13656    4               CALL STUFF ALTRET(FORMAT_ABORT);

  13656  7 004607   004754 701000 7                  TSX1    STUFF
         7 004610   004752 702000 7                  TSX2    FORMAT_ABORT

     1887    13657    4            CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+ASCBIN(SUBSTR

  13657  7 004611   202432 470500                    LDP0    @SIZ,,AUTO
         7 004612   000000 720100                    LXL0    0,,PR0
         7 004613   000000 235100                    LDA     0,,PR0
         7 004614   202431 471500                    LDP1    @BFR,,AUTO
         7 004615   000100 101505                    MRL     fill='000'O
         7 004616   177777 600001                    ADSC9   -1,A,PR1                 cn=3,n=1
         7 004617   203426 000004                    ADSC9   OFFSET+2,,AUTO           cn=0,n=4
         7 004620   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 004621   000003 772000                    QRL     3
         7 004622   000040 036007                    ADLQ    32,DL
         7 004623   000033 736000                    QLS     27
         7 004624   000057 276000 8                  ORQ     47
         7 004625   203427 756100                    STQ     OFFSET+3,,AUTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:214  
         7 004626   200020 235100                    LDA     JEIDX,,AUTO
         7 004627   040105 100500                    MLR     fill='040'O
         7 004630   203427 000004                    ADSC9   OFFSET+3,,AUTO           cn=0,n=4
         7 004631   202162 000001                    ADSC9   JEBUF,A,AUTO             cn=0,n=1

     1888    13658    4              (BFR,SIZ-1,1))/8));
     1889    13659    4            JEIDX=JEIDX+1;

  13659  7 004632   200020 054100                    AOS     JEIDX,,AUTO

     1890    13660    4            IF JEIDX>79 THEN

  13660  7 004633   200020 235100                    LDA     JEIDX,,AUTO
         7 004634   000117 115007                    CMPA    79,DL
         7 004635   004640 604400 7                  TMOZ    s:13662

     1891    13661    4               CALL STUFF ALTRET(FORMAT_ABORT);

  13661  7 004636   004754 701000 7                  TSX1    STUFF
         7 004637   004752 702000 7                  TSX2    FORMAT_ABORT

     1892    13662    4            CALL INSERT(JEBUF,JEIDX,1,BINASC(ASCBIN(' ')+8*BITBIN

  13662  7 004640   202432 470500                    LDP0    @SIZ,,AUTO
         7 004641   000000 720100                    LXL0    0,,PR0
         7 004642   000000 235100                    LDA     0,,PR0
         7 004643   202431 471500                    LDP1    @BFR,,AUTO
         7 004644   000100 100505                    MLR     fill='000'O
         7 004645   177777 600001                    ADSC9   -1,A,PR1                 cn=3,n=1
         7 004646   203426 000004                    ADSC9   OFFSET+2,,AUTO           cn=0,n=4
         7 004647   203426 236100                    LDQ     OFFSET+2,,AUTO
         7 004650   000022 772000                    QRL     18
         7 004651   000000 620006                    EAX0    0,QL
         7 004652   007000 360003                    ANX0    3584,DU
         7 004653   000000 636010                    EAQ     0,X0
         7 004654   000033 772000                    QRL     27
         7 004655   000003 736000                    QLS     3
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:215  
         7 004656   000040 036007                    ADLQ    32,DL
         7 004657   000033 736000                    QLS     27
         7 004660   000057 276000 8                  ORQ     47
         7 004661   203427 756100                    STQ     OFFSET+3,,AUTO
         7 004662   200020 235100                    LDA     JEIDX,,AUTO
         7 004663   040105 100500                    MLR     fill='040'O
         7 004664   203427 000004                    ADSC9   OFFSET+3,,AUTO           cn=0,n=4
         7 004665   202162 000001                    ADSC9   JEBUF,A,AUTO             cn=0,n=1

     1893    13663    4              (ASCBIT(SUBSTR(BFR,SIZ-1,1))&'007'O)));
     1894    13664    4            JEIDX=JEIDX+1;

  13664  7 004666   200020 054100                    AOS     JEIDX,,AUTO

     1895    13665    4            IF JEIDX>79 THEN

  13665  7 004667   200020 235100                    LDA     JEIDX,,AUTO
         7 004670   000117 115007                    CMPA    79,DL
         7 004671   004674 604400 7                  TMOZ    s:13667

     1896    13666    4               CALL STUFF ALTRET(FORMAT_ABORT);

  13666  7 004672   004754 701000 7                  TSX1    STUFF
         7 004673   004752 702000 7                  TSX2    FORMAT_ABORT

     1897    13667    4            CALL INSERT(JEBUF,JEIDX,1,' ');

  13667  7 004674   200020 235100                    LDA     JEIDX,,AUTO
         7 004675   040105 100400                    MLR     fill='040'O
         7 004676   000015 000001 8                  ADSC9   13                       cn=0,n=1
         7 004677   202162 000001                    ADSC9   JEBUF,A,AUTO             cn=0,n=1

     1898    13668    4            END;

     1899    13669    3         END;

  13669  7 004700   004750 710000 7                  TRA     s:13693
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:216  

     1900    13670
     1901    13671        /****
     1902    13672        *
     1903    13673        *   Send data "in the clear" by copying it in segments to the output
     1904    13674        *   buffer and writing it.
     1905    13675        *
     1906    13676        ****/
     1907    13677
     1908    13678    3        ELSE DO;

     1909    13679    3         I=0;

  13679  7 004701   202437 450100                    STZ     I,,AUTO

     1910    13680    4         DO WHILE(I<SIZ);

  13680  7 004702   202432 471500                    LDP1    @SIZ,,AUTO
         7 004703   202437 236100                    LDQ     I,,AUTO
         7 004704   100000 116100                    CMPQ    0,,PR1
         7 004705   004750 605000 7                  TPL     s:13693

     1911    13681    4            JEIDX=JEIDX+1;

  13681  7 004706   200020 054100                    AOS     JEIDX,,AUTO

     1912    13682    4            IF JEIDX>79 THEN

  13682  7 004707   200020 235100                    LDA     JEIDX,,AUTO
         7 004710   000117 115007                    CMPA    79,DL
         7 004711   004714 604400 7                  TMOZ    s:13684

     1913    13683    4               CALL STUFF ALTRET(FORMAT_ABORT);

  13683  7 004712   004754 701000 7                  TSX1    STUFF
         7 004713   004752 702000 7                  TSX2    FORMAT_ABORT

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:217  
     1914    13684    4            J=80-JEIDX;

  13684  7 004714   000120 235007                    LDA     80,DL
         7 004715   200020 135100                    SBLA    JEIDX,,AUTO
         7 004716   202440 755100                    STA     J,,AUTO

     1915    13685    4            IF J>SIZ-I THEN

  13685  7 004717   202432 470500                    LDP0    @SIZ,,AUTO
         7 004720   000000 236100                    LDQ     0,,PR0
         7 004721   202437 136100                    SBLQ    I,,AUTO
         7 004722   202440 116100                    CMPQ    J,,AUTO
         7 004723   004727 605000 7                  TPL     s:13687

     1916    13686    4               J=SIZ-I;

  13686  7 004724   000000 236100                    LDQ     0,,PR0
         7 004725   202437 136100                    SBLQ    I,,AUTO
         7 004726   202440 756100                    STQ     J,,AUTO

     1917    13687    4            CALL INSERT(JEBUF,JEIDX,J,SUBSTR(BFR,I,J));

  13687  7 004727   000000 720100                    LXL0    0,,PR0
         7 004730   202431 471500                    LDP1    @BFR,,AUTO
         7 004731   202440 721100                    LXL1    J,,AUTO
         7 004732   202437 236100                    LDQ     I,,AUTO
         7 004733   200020 235100                    LDA     JEIDX,,AUTO
         7 004734   040145 100546                    MLR     fill='040'O
         7 004735   100000 000011                    ADSC9   0,Q,PR1                  cn=0,n=*X1
         7 004736   202162 000011                    ADSC9   JEBUF,A,AUTO             cn=0,n=*X1

     1918    13688    4            I=I+J;

  13688  7 004737   202440 036100                    ADLQ    J,,AUTO
         7 004740   202437 756100                    STQ     I,,AUTO

     1919    13689    4            JEIDX=JEIDX+J-1;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:218  

  13689  7 004741   200020 236100                    LDQ     JEIDX,,AUTO
         7 004742   202440 036100                    ADLQ    J,,AUTO
         7 004743   000001 136007                    SBLQ    1,DL
         7 004744   200020 756100                    STQ     JEIDX,,AUTO

     1920    13690    4            END;

  13690  7 004745   202437 236100                    LDQ     I,,AUTO
         7 004746   000000 116100                    CMPQ    0,,PR0
         7 004747   004706 604000 7                  TMI     s:13681

     1921    13691    3         END;

     1922    13692
     1923    13693    2      RETURN;

  13693  7 004750   202430 221300                    LDX1  ! INTRASHIP+2,,AUTO
         7 004751   000001 702211                    TSX2  ! 1,X1

     1924    13694
     1925    13695        /****
     1926    13696        *
     1927    13697        *   Somebody ALTRETed on us.  Do the same.
     1928    13698        *
     1929    13699        ****/
     1930    13700
     1931    13701    2   FORMAT_ABORT:
     1932    13702    2      ALTRETURN;

  13702  7 004752   202430 221300       FORMAT_ABORT LDX1  ! INTRASHIP+2,,AUTO
         7 004753   000000 702211                    TSX2  ! 0,X1

     1933    13703
     1934    13704    2   END;
     1935    13705
     1936    13706        %EJECT;
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:219  
     1937    13707        /*I**
     1938    13708        *
     1939    13709        *   NAME:  STUFF
     1940    13710        *
     1941    13711        *   PURPOSE:
     1942    13712        *       STUFF computes the length byte and writes JEBUF to JE.
     1943    13713        *
     1944    13714        *   CALL:
     1945    13715        *       CALL STUFF ALTRET...
     1946    13716        *
     1947    13717        *   PARAMETERS:
     1948    13718        *       None.
     1949    13719        *
     1950    13720        *   DATA:
     1951    13721        *       STUFF computes the length byte based on the global cell JEIDX and
     1952    13722        *       places it in the first byte of JEBUF.  JEIDX is reset to 1 and
     1953    13723        *       JEBUF is blanked.
     1954    13724        *
     1955    13725        *   DESCRIPTION:
     1956    13726        *       Write JEBUF after computing the length byte and placing it in
     1957    13727        *       column 1.  If length>0, add 1 to VW_OUTCNT#.  ALTRET if an I/O
     1958    13728        *       error occurs; otherwise, clear JEBUF and reset JEIDX to 1.
     1959    13729        *
     1960    13730        ****/
     1961    13731
     1962    13732    1   STUFF: PROC ALTRET;

  13732  7 004754   202442 741300       STUFF        STX1  ! J+2,,AUTO

     1963    13733
     1964    13734        /****
     1965    13735        *
     1966    13736        *   Compute the length byte, which is '/' plus the number of
     1967    13737        *   bytes in the record (1-79).  This keeps it out of the range of
     1968    13738        *   most system's command character (!, $, /, etc.).  Note that
     1969    13739        *   JEIDX is one more than it should be.
     1970    13740        *
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:220  
     1971    13741        ****/
     1972    13742
     1973    13743    2      CALL INSERT(JEBUF,0,1,BINASC(ASCBIN('.')+JEIDX));

  13743  7 004755   200020 236100                    LDQ     JEIDX,,AUTO
         7 004756   000056 036007                    ADLQ    46,DL
         7 004757   000033 736000                    QLS     27
         7 004760   000057 276000 8                  ORQ     47
         7 004761   202162 552140                    STBQ    JEBUF,'40'O,AUTO

     1974    13744
     1975    13745        /****
     1976    13746        *
     1977    13747        *   Scramble the record (if required) and write it, but only if
     1978    13748        *   there's data in the record.
     1979    13749        *
     1980    13750        ****/
     1981    13751
     1982    13752    3      IF JEIDX>1 THEN DO;

  13752  7 004762   200020 235100                    LDA     JEIDX,,AUTO
         7 004763   000001 115007                    CMPA    1,DL
         7 004764   005002 604400 7                  TMOZ    s:13765

     1983    13753    3         IF VW_SCRAMBLE# THEN

  13753  7 004765   000000 234000 xsym               SZN     VW_SCRAMBLE#
         7 004766   004775 605000 7                  TPL     s:13755

     1984    13754    3            CALL VWO$TRANSO(JEBUF);

  13754  7 004767   202162 630500                    EPPR0   JEBUF,,AUTO
         7 004770   203426 450500                    STP0    OFFSET+2,,AUTO
         7 004771   203426 630500                    EPPR0   OFFSET+2,,AUTO
         7 004772   000024 631400 8                  EPPR1   20
         7 004773   000000 701000 xent               TSX1    VWO$TRANSO
         7 004774   000000 011000                    NOP     0
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:221  

     1985    13755    3         CALL M$WRITE(WRITE_JE) ALTRET(STUFF_BAD_WRJ);

  13755  7 004775   001114 630400 1                  EPPR0   WRITE_JE
         7 004776   440001 713400                    CLIMB   alt,write
         7 004777   401400 401760                    pmme    nvectors=4
         7 005000   005011 702000 7                  TSX2    STUFF_BAD_WRJ

     1986    13756    3         VW_OUTCNT#=VW_OUTCNT#+1;

  13756  7 005001   000000 054000 xsym               AOS     VW_OUTCNT#

     1987    13757    3         END;

     1988    13758
     1989    13759        /****
     1990    13760        *
     1991    13761        *   Reset the buffer and the pointer for the caller.
     1992    13762        *
     1993    13763        ****/
     1994    13764
     1995    13765    2      JEIDX=1;

  13765  7 005002   000001 235007                    LDA     1,DL
         7 005003   200020 755100                    STA     JEIDX,,AUTO

     1996    13766    2      JEBUF=' ';

  13766  7 005004   040100 100400                    MLR     fill='040'O
         7 005005   000015 000001 8                  ADSC9   13                       cn=0,n=1
         7 005006   202162 000120                    ADSC9   JEBUF,,AUTO              cn=0,n=80

     1997    13767
     1998    13768    2      RETURN;

  13768  7 005007   202442 221300                    LDX1  ! J+2,,AUTO
         7 005010   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:222  

     1999    13769
     2000    13770        /****
     2001    13771        *
     2002    13772        *   Hmmm, must've gotten an error on the write.
     2003    13773        *
     2004    13774        ****/
     2005    13775
     2006    13776    2   STUFF_BAD_WRJ:
     2007    13777    2      ALTRETURN;

  13777  7 005011   202442 221300       STUFF_BAD_W* LDX1  ! J+2,,AUTO
         7 005012   000000 702211                    TSX2  ! 0,X1

OPEN_NODE
 Sect OctLoc
   1     000   000025 777640   000044 006000   000000 177640   000000 006014    .....$..........
   1     004   000000 177640   000000 006014   000001 577640   000072 006000    .............:..
   1     010   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     024*  000001 777640   000000 006000   000000 177640   000000 006014    ................
   1     030   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     044*  000000 000042   000000 002001   252525 002002   000040 252520    ..."......... ..
   1     050   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   1     054   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     060   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1     064   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1     070   000000 000000   ****** ******                                    ........

NAME_NODE
 Sect OctLoc
   1     072   006072 116117   104105 123***                                    .:NODES.

READ_NODE
 Sect OctLoc
   1     074   000005 777640   000104 006000   000002 177640   000150 006000    .....D.......h..
   1     100   000005 377640   000153 006000   000000 177640   000000 006014    .....k..........
   1     104   000000 600000   000000 000000   000000 000000   000000 000000    ................
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:223  
   1     110   000000 000000   000000 000000                                    ........

CLOSE_NODE
 Sect OctLoc
   1     112   000003 777640   000144 006000   000000 177640   000000 006014    .....d..........
   1     116   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     142*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   1     146   000220 000000   000000 000000                                    ........

NODEKEY
 Sect OctLoc
   1     150   010*** ******   ****** ******   ****** ******                    ............

NODEOVR
 Sect OctLoc
   1     153   ****** ******   ****** ******   ****** ******   ****** ******    ................

OPEN_INP
 Sect OctLoc
   1     162   000025 777640   000226 006000   000011 777640   000270 006000    ................
   1     166   000000 177640   000000 006014   000007 777640   000254 006000    ................
   1     172   000001 777640   000266 006000   000000 177640   000000 006014    ................
   1     176   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     206*  000001 777640   000264 006000   000000 177640   000000 006014    ................
   1     212   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     226*  000000 400072   000000 002000   252525 000000   000040 252520    ...:......... ..
   1     232   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   1     236   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     242   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1     246   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1     252   000000 000000   ****** ******                                    ........

NAME_INP
 Sect OctLoc
   1     254   001040 040040   040040 040040   040040 040040   040040 040040    .
   1     260   040040 040040   040040 040040   040040 040040   040040 040040

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:224  
ACCT_INP
 Sect OctLoc
   1     264   040040 040040   040040 040040

PASS_INP
 Sect OctLoc
   1     266   040040 040040   040040 040040

SN_INP
 Sect OctLoc
   1     270   000000 000006   040040 040040   040040 040040   040040 040040    ....
   1     274   040040 040040   040040 040040   040040 040040   040040 040040
   1     300   040040 040040   040040 040040

FID_INP
 Sect OctLoc
   1     302   000003 777640   000326 006000   000000 177640   000000 006014    ................
   1     306   000007 777640   000254 006000   000001 777640   000264 006000    ................
   1     312   000001 777640   000266 006000   000011 777640   000270 006000    ................
   1     316   000000 177640   000000 006014   000000 177640   000227 606000    ................
   1     322   000000 777640   000232 006000   000011 777640   000332 006000    ................
   1     326   777000 000000   000000 000000   000000 000000   ****** ******    ................

VLR_INP
 Sect OctLoc
   1     332   ****** ******   ****** ******   ****** ******   ****** ******    ................

UNFID_INP
 Sect OctLoc
   1     344   000001 777640   000370 006000   000000 177640   000000 006014    ................
   1     350   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     370*  000000 000000   0***** ******                                    ........

OPEN_OUT
 Sect OctLoc
   1     372   000025 777640   000436 006000   000011 777640   000500 006000    ................
   1     376   000000 177640   000000 006014   000007 777640   000464 006000    ................
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:225  
   1     402   000001 777640   000476 006000   000000 177640   000000 006014    ................
   1     406   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     416*  000001 777640   000474 006000   000000 177640   000000 006014    ................
   1     422   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     436*  000000 400072   000000 002000   252525 000000   000040 252520    ...:......... ..
   1     442   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   1     446   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     452   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1     456   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1     462   000000 000000   ****** ******                                    ........

NAME_OUT
 Sect OctLoc
   1     464   001040 040040   040040 040040   040040 040040   040040 040040    .
   1     470   040040 040040   040040 040040   040040 040040   040040 040040

ACCT_OUT
 Sect OctLoc
   1     474   040040 040040   040040 040040

PASS_OUT
 Sect OctLoc
   1     476   040040 040040   040040 040040

SN_OUT
 Sect OctLoc
   1     500   000000 000006   040040 040040   040040 040040   040040 040040    ....
   1     504   040040 040040   040040 040040   040040 040040   040040 040040
   1     510   040040 040040   040040 040040

FID_OUT
 Sect OctLoc
   1     512   000003 777640   000536 006000   000000 177640   000000 006014    ................
   1     516   000007 777640   000464 006000   000001 777640   000474 006000    ................
   1     522   000001 777640   000476 006000   000011 777640   000500 006000    ................
   1     526   000000 177640   000000 006014   000000 177640   000437 606000    ................
   1     532   000000 777640   000442 006000   000011 777640   000542 006000    ................
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:226  
   1     536   777000 000000   000000 000000   000000 000000   ****** ******    ................

VLR_OUT
 Sect OctLoc
   1     542   ****** ******   ****** ******   ****** ******   ****** ******    ................

UNFID_OUT
 Sect OctLoc
   1     554   000001 777640   000600 006000   000000 177640   000000 006014    ................
   1     560   000007 777640   000464 006000   000001 777640   000474 006000    ................
   1     564   000001 777640   000476 006000   000011 777640   000500 006000    ................
   1     570   000000 177640   000000 006014   000000 177640   000437 606000    ................
   1     574   000000 777640   000442 006000   000000 177640   000000 006014    ................
   1     600   000000 000000   0***** ******                                    ........

UNFID_MSG
 Sect OctLoc
   1     602   000001 777640   000626 006000   000000 177640   000000 006014    ................
   1     606   000007 777640   000464 006000   000001 777640   000474 006000    ................
   1     612   000000 177640   000000 006014   000011 777640   000500 006000    ................
   1     616   000000 177640   000000 006014   000000 177640   000437 606000    ................
   1     622   000000 777640   000442 006000   000000 177640   000000 006014    ................
   1     626   000000 000000   0***** ******                                    ........

READ_INP
 Sect OctLoc
   1     630   000005 777640   000640 006000   000000 177640   000000 006014    ................
   1     634   017777 777640   001365 006000   000000 177640   000000 006014    ................
   1     640   000000 400000   000000 000000   000000 000000   000000 000000    ................
   1     644   000000 000000   000000 000000                                    ........

PRECORD_INP
 Sect OctLoc
   1     646   000003 777640   000654 006000   000000 177640   000000 006014    ................
   1     652   000000 177640   000000 006014   000000 000000   777777 777777    ................
   1     656   000000 000000   0***** ******                                    ........

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:227  
CLOSE_INP
 Sect OctLoc
   1     660   000003 777640   000712 006000   000000 177640   000000 006014    ................
   1     664   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     710*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   1     714   000220 000000   000000 000000                                    ........

OPEN_JE
 Sect OctLoc
   1     716   000025 777640   000762 006000   000000 177640   000000 006014    ................
   1     722   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     746*  000000 177640   000000 006014   000001 777640   001112 006000    .............J..
   1     752   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     762*  000000 400242   000000 003003   252525 000000   000040 252520    ............. ..
   1     766   112105 040040   000000 000000   000000 777777   000000 000000    JE  ............
   1     772   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     776   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1    1002   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1    1006   000000 000000   ****** ******                                    ........

OPEN_JE_INTRASHIP
 Sect OctLoc
   1    1010   000025 777640   001054 006000   000000 177640   000000 006014    .....,..........
   1    1014   000000 177640   000000 006014   000007 777640   001102 006000    .............B..
   1    1020   000001 777640   000041 006000   000000 177640   000000 006014    .....!..........
   1    1024   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    1034*  000001 777640   000000 006000   000000 177640   000000 006014    ................
   1    1040   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    1054*  000000 400242   000000 003001   252525 001000   000040 252520    ............. ..
   1    1060   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   1    1064   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1    1070   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1    1074   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1    1100   000000 000000   ****** ******                                    ........

INTRASHIP_NAME
 Sect OctLoc
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:228  
   1    1102   037040 040040   040040 040040   040040 040040   040040 040040    .
   1    1106   040040 040040   040040 040040   040040 040040   040040 040040

WSN_JE
 Sect OctLoc
   1    1112   040040 040040   040040 040040

WRITE_JE
 Sect OctLoc
   1    1114   000003 777640   001124 006000   000000 177640   000000 006014    .....T..........
   1    1120   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    1124   000000 400400   000000 000000   000000 000000   000000 000000    ................

CLOSE_JE
 Sect OctLoc
   1    1130   000003 777640   001162 006000   000000 177640   000000 006014    .....r..........
   1    1134   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    1160*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   1    1164   000220 000000   000000 000000                                    ........

FPT_JOBSTATS
 Sect OctLoc
   1    1166   000013 777640   001216 006000   000000 177640   000000 006014    ................
   1    1172   000013 777640   001256 006000   000023 777640   001232 006000    ................
   1    1176   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    1216*  000000 000007   000000 000000   000000 000000   000000 000000    ................
   1    1222   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1    1226   000000 000000   000000 000000   000000 000000   000000 000000    ................

VLP_CRITERIA
 Sect OctLoc
   1    1232   040040 040040   040040 040040   040040 040040   040040 040040
   1    1236   040040 040040   040040 040040   000000 000000   000000 000000            ........
   1    1242   000000 000000   000000 000377   000000 000377   040040 ******    ............  ..
   1    1246   000000 000000   040040 040040   040040 000000   000000 000000    ....      ......
   1    1252   000000 000000   000000 000000   000000 000000   000000 ******    ................

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:229  
VLR_JOBSTATS_CHECK
 Sect OctLoc
   1    1256   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1    1262   000000 000000   000000 000000   000000 000000   040040 040040    ............
   1    1266   000000 000000   040040 040040   040040 040040                    ....

CLOCK_TO_TODAY
 Sect OctLoc
   1    1272   000001 777640   001304 006000   000001 377640   021365 006000    ................
   1    1276   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    1302   000000 177640   000000 006014   000002 000000   ****** ******    ................

TODAY_TO_UTS
 Sect OctLoc
   1    1306   000001 777640   001320 006000   000001 377640   021365 006000    ................
   1    1312   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    1316   000000 777640   001364 006000   002004 000000   ****** ******    ................

FPT_WAIT
 Sect OctLoc
   1    1322   000001 777640   001326 006000   000000 177640   000000 006014    ................
   1    1326   000000 000001   000000 000001                                    ........

NAME_WILD
 Sect OctLoc
   1    1330   037040 040040   040040 040040   040040 040040   040040 040040    .
   1    1334   040040 040040   040040 040040   040040 040040   040040 040040

NAME_DEST
 Sect OctLoc
   1    1340   037040 040040   040040 040040   040040 040040   040040 040040    .
   1    1344   040040 040040   040040 040040   040040 040040   040040 040040

XUW_WILDCARD
 Sect OctLoc
   1    1350   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1    1360*  000000 000000   077000 000000   000000 000000   000000 000000    ....?...........
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:230  

INPBUF
 Sect OctLoc
   1    1365   ****** ******   ****** ******   ****** ******   ****** ******    ................

(unnamed)
 Sect OctLoc
   1    3204   ****** ******   ****** ******   ****** ******   ****** ******    ................

ACCT_NODE
 Sect OctLoc
   2     000   072123 131123   040040 040040                                    :SYS

MODE
 Sect OctLoc
   3     000   006144 151141   154165 160040   040040 040040   010150 141162    .dialup     .har
   3     004   144167 151162   145040 040040                                    dwire

TYPE
 Sect OctLoc
   3     006   006103 120066   103060 060040   040006 103120   066102 060063    .CP6C00  .CP6B03
   3     012   040040 006103   120066 102060   062040 040003   103120 066040      .CP6B02  .CP6
   3     016   040040 040040   004103 120055   066040 040040   040003 103120        .CP-6    .CP
   3     022   126040 040040   040040 004103   120055 126040   040040 040005    V     .CP-V    .
   3     026   107103 117123   063040 040040   005107 103117   123070 040040    GCOS3   .GCOS8
   3     032   040007 107103   117123 066120   106040 005107   103117 123066     .GCOS6PF .GCOS6
   3     036   040040 040010   105130 124105   122116 101114                       .EXTERNAL

INTRASHIP_PASS
 Sect OctLoc
   3     041   115157 156164   147155 162171                                    Montgmry

CLOCK_TO_UTS
 Sect OctLoc
   3     044   000001 777640   000056 006000   000000 177640   000000 006014    ................
   3     050   000000 177640   000000 006014   000000 177640   000000 006014    ................
   3     054   000000 777640   001364 006000   000004 000000   ****** ******    ................
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:231  

FMSEC
 Sect OctLoc
   3     060   000001 777640   000062 006000   100000 000000   000000 000000    .....2..@.......

INF_CON
 Sect OctLoc
   3     064   777777 777777                                                    ....

BADCHARS
 Sect OctLoc
   3     065   111111 111111   111111 111111   111111 111111   111111 111111    IIIIIIIIIIIIIIII
   3     075*  000000 000000   000000 000000   000000 000000   000000 000000    ................
   3     121*  000000 000000   000000 000000   000000 000000   000000 000111    ...............I
   3     125   111111 111111   111111 111111   111111 111111   111111 111111    IIIIIIIIIIIIIIII
   3     261*  111111 111111   111111 111111   111111 111111   111111 111111    IIIIIIIIIIIIIIII

VO_INTERSYS_ACCT
 Sect OctLoc
   3     265   072115 101111   114040 040040                                    :MAIL

VO_INTERSYS_NAME
 Sect OctLoc
   3     267   065060 060101   124117 102040   040040 040040                    500ATOB

VO_INTERSYS_PASSWORD
 Sect OctLoc
   3     272   115101 111114   120101 123123                                    MAILPASS

(unnamed)
 Sect OctLoc
   3     274   104101 124105   122105 103123   124117 104101   131040 040040    DATERECSTODAY
   3     300   131105 123124   105122 104101   131040 040040   114105 040040    YESTERDAY   LE
   3     304   114124 040040   116105 040040   107105 040040   107124 040040    LT  NE  GE  GT
   3     310   105121 040040   117120 124123   000000 000040   115117 126105    EQ  OPTS... MOVE
   3     314   170170 170170   170170 170170   103110 101122   041162 151172    xxxxxxxxCHAR!riz
   3     320   141127 173144   156141 162107   175145 150164   133162 157146    aW{dnarG}eht[rof
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:232  
   3     324   135144 156145   123174 140176   045136 047040   040150 157165    ]dneS|`~%^'  hou
   3     330   162163 056040   040155 151156   165164 145163   056040 040040    rs.  minutes.
   3     334   040163 145143   157156 144163   056040 040040   102125 123131     seconds.   BUSY

(unnamed)
 Sect OctLoc
   8     000   000000 006003   001777 777640   000023 600000   002224 200000    ................
   8     004   000023 577640   000074 206000   002250 200000   000000 000000    .....<..........
   8     010   000024 206000   000310 006000   103040 040040   000040 753000    ........C   . ..
   8     014   055040 040040   040040 040040   077040 040040   001340 206000    -       ?   ....
   8     020   001330 206000   777777 740777   000254 206000   000464 206000    ................
   8     024   000001 000000   001350 006000   777777 757777   777777 773777    ................
   8     030   000023 777640   000004 000000   262715 000030   000032 006000    ................
   8     034   000777 777777   017777 777777   777774 001777   000003 000000    ................
   8     040   400000 000000   777777 677777   000007 006000   000040 006000    ............. ..
   8     044   017777 600000   777777 767777   000077 777640   001776 600000    .........?......
   8     050   777777 600000   001777 600000   776777 777777   000056 200000    ................
   8     054   000007 006000   000007 006000   000000 000004   000040 040040    .............
   8     060   000056 006000   000056 006000   000643 106000   001365 006000    ..........F.....
   8     064   000000 006014   262715 000710   000065 006000   060040 040040    .........5..0
   8     070   777777 777667   777777 777670   777777 777777   056040 040040    .............
   8     074   777777 777671   777777 777672   262715 000510   000076 006000    .............>..
   8     100   262715 000520   000100 006000   262715 000530   000102 006000    .....@.......B..
   8     104   262715 000040   000104 006000   262715 000050   262715 000010    ... .D.....(....
   8     110   262715 000060   262715 000020   262715 000120   262715 000360    ...0.......P....
   8     114   262715 000240   777777 777770   262715 000100   000116 006000    ...........@.N..
   8     120   000005 000000   262715 000130   000121 006000   000002 000000    .......X.Q......
   8     124   262715 000140   000124 006000   000003 776000   770003 777777    ...`.T..........
   8     130   262715 000670   021372 006000   140040 040040                    ........`
     2008    13778
     2009    13779    2   END;
     2010    13780
     2011    13781    1   END;

PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:233  
--  Include file information  --

   VW_FPTS_M.:VMB6TOU  cannot be made into a system file and is referenced.
   VW_NODEATER_E.:VMB6TOU  is referenced.
   VW_OPTS_M.:VMB6TOU  is referenced.
   VWM_ERRS_E.:VMB6TOU  is referenced.
   VW_MOVE_E.:VMB6TOU  is referenced.
   XU_PERR_C.:LIB_E05  is referenced.
   XUW_MACRO_C.:LIB_E05  is referenced.
   B_ERRORS_C.:LIB_E05  is referenced.
   FM$FIT.:LIB_E05  is referenced.
   B$JIT_C.:LIB_E05  is referenced.
   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VWB$BEAM.
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:234  

 **** Variables and constants ****

  ****  Section 001  Data  VWB$BEAM

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   264-0-0/c STRC(72)    r     1 ACCT_INP                 474-0-0/c STRC(72)    r     1 ACCT_OUT
 21372-0-0/c UBIN(6)     r     1 BIT6(0:11)             21367-0-0/c UBIN(9)     r     1 BIT9(0:11)
  1272-0-0/d STRC(432)   r     1 CLOCK_TO_TODAY           660-0-0/d STRC(1080)  r     1 CLOSE_INP
  1130-0-0/d STRC(1080)  r     1 CLOSE_JE                 112-0-0/d STRC(1080)  r     1 CLOSE_NODE
 21367-0-0/c CHAR(12)    r     1 EPASS                    302-0-0/d STRC(864)   r     1 FID_INP
   512-0-0/d STRC(864)   r     1 FID_OUT                 1166-0-0/d STRC(1296)  r     1 FPT_JOBSTATS
  1322-0-0/d STRC(216)   r     1 FPT_WAIT                1365-0-0/c STRC(32768) r     1 INPBUF
  1102-0-0/c STRC(288)   r     1 INTRASHIP_NAME          1340-0-0/c STRC(288)   r     1 NAME_DEST
   254-0-0/c STRC(288)   r     1 NAME_INP                  72-0-0/c STRC(63)    r     1 NAME_NODE
   464-0-0/c STRC(288)   r     1 NAME_OUT                1330-0-0/c STRC(288)   r     1 NAME_WILD
   150-0-0/c STRC(81)    r     1 NODEKEY                  153-0-0/c STRC(198)   r     1 NODEOVR
   153-0-0/c CHAR(22)    r     1 NODEREC                  162-0-0/d STRC(2088)  r     1 OPEN_INP
   716-0-0/d STRC(2088)  r     1 OPEN_JE                 1010-0-0/d STRC(2088)  r     1 OPEN_JE_INTRASHIP
     0-0-0/d STRC(2088)  r     1 OPEN_NODE                372-0-0/d STRC(2088)  r     1 OPEN_OUT
 21372-0-0/c CHAR(8)     r     1 PASSWORD                 266-0-0/c STRC(72)    r     1 PASS_INP
   476-0-0/c STRC(72)    r     1 PASS_OUT                 646-0-0/d STRC(360)   r     1 PRECORD_INP
   630-0-0/d STRC(504)   r     1 READ_INP                  74-0-0/d STRC(504)   r     1 READ_NODE
   270-0-0/d STRC(360)   r     1 SN_INP                   500-0-0/d STRC(360)   r     1 SN_OUT
  1364-0-0/w UBIN        r     1 TODAY                   1306-0-0/d STRC(432)   r     1 TODAY_TO_UTS
   344-0-0/d STRC(792)   r     1 UNFID_INP                602-0-0/d STRC(792)   r     1 UNFID_MSG
   554-0-0/d STRC(792)   r     1 UNFID_OUT               1232-0-0/d STRC(702)   r     1 VLP_CRITERIA
   332-0-0/d STRC(324)   r     1 VLR_INP                 1256-0-0/d STRC(396)   r     1 VLR_JOBSTATS_CHECK
   542-0-0/d STRC(324)   r     1 VLR_OUT                 1114-0-0/d STRC(432)   r     1 WRITE_JE
  1112-0-0/c STRC(72)    r     1 WSN_JE                  1350-0-0/d STRC(432)   r     1 XUW_WILDCARD
 21365-0-0/c CHAR(6)     r     1 YYMMDD

  ****  Section 002 RtLmCm ACCT_NODE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:235  

     0-0-0/c STRC(72)    r     1 ACCT_NODE

  ****  Section 003 RoData VWB$BEAM

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    65-0-0/w STRC(4608)  r     1 BADCHARS                  44-0-0/d STRC(432)   r     1 CLOCK_TO_UTS
    60-0-0/d STRC(144)   r     1 FMSEC                     64-0-0/w UBIN        r     1 INFINITY
    64-0-0/w SBIN        r     1 INF_CON                   41-0-0/c STRC(72)    r     1 INTRASHIP_PASS
     0-0-0/c STRC(108)         1 MODE(0:1)                  6-0-0/c STRC(81)          1 TYPE(0:11)
   265-0-0/c CHAR(8)     r     1 VO_INTERSYS_ACCT         267-0-0/c CHAR(12)    r     1 VO_INTERSYS_NAME
   272-0-0/c CHAR(8)     r     1 VO_INTERSYS_PASSWORD

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

  2431-0-0/w PTR         r     1 @BFR                    2435-0-0/w PTR         r     1 @BINM
     3-0-0/w PTR         r     1 @CHECKCG                2434-0-0/w PTR         r     1 @CONT
  2433-0-0/w PTR         r     1 @MXS                    2432-0-0/w PTR         r     1 @SIZ
    22-0-0/w SBIN        r     1 ARS                     2214-0-0/c CHAR(31)    r     1 BAD_FILE_NAME
    *0-0-0/c ACHR        r     1 BFR                       *0-0-0/b BIT         r     1 BINM
    *0-0-0/w EPTR        r     1 CHECKCG                 3417-0-0/w SBIN        r     1 CODE
  3416-0-0/w SBIN        r     1 CODES                     *0-0-0/b BIT         r     1 CONT
    12-0-0/w SBIN              1 D                         25-0-0/w UBIN        r     1 DATE_HI
    24-0-0/w UBIN        r     1 DATE_LO                 2424-0-0/b BIT         r     1 DATE_REL
  2422-0-0/b BIT         r     1 DATE_SELECT             2423-0-0/b BIT         r     1 DATE_SELECT_WHICH
  2211-0-0/c CHAR(8)     r     1 DWORK                   2436-0-0/w SBIN        r     1 EBIT
    52-0-0/w STRC        r     1 ERRBITS                   52-0-0/w SBIN        r     1 ERRCODE
    23-0-0/w SBIN        r     1 ERRDCB                   156-0-0/c STRC(144)   r     1 EXTERNAL
    15-0-0/w SBIN        r     1 FILECOUNT                 17-0-0/w SBIN        r     1 FILEORG
   162-0-0/w UBIN        r     1 FITBUF(0:1023)          2431-0-0/c CHAR(80)    r     1 FITCARD(0:24)
  2431-0-0/w UBIN        r     1 FITWORD(0:499)          3422-0-0/w SBIN        r     1 FREE
  3421-0-0/w SBIN              1 HIGH                       4-0-0/w SBIN        r     1 I
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:236  
  3423-0-0/w SBIN        r     1 I                       2437-0-0/w SBIN        r     1 I
    21-0-0/w SBIN        r     1 INPLIM                    53-0-0/w PTR         r     1 INPPTR
  2425-0-0/b BIT         r     1 INTERNET                2426-0-0/b BIT         r     1 INTRASHIP
  2417-0-0/b BIT         r     1 ITSBIN                     5-0-0/w SBIN        r     1 J
  2440-0-0/w SBIN        r     1 J                       2162-0-0/c CHAR(80)    r     1 JEBUF
    20-0-0/w SBIN        r     1 JEIDX                     54-0-0/w PTR         r     1 JEPTR
     6-0-0/w SBIN        r     1 K                         56-0-0/c STRC(2304)  r     1 KEYBUF
  3420-0-0/w SBIN        r     1 LOW                     2420-0-0/b BIT         r     1 MULTIPLE
    *0-0-0/w SBIN        r     1 MXS                       10-0-0/w SBIN              1 N
  2415-0-0/b BIT         r     1 NFA                     2414-0-0/b BIT         r     1 NLN
  2416-0-0/b BIT         r     1 NSC                       11-0-0/w SBIN              1 O
  3424-0-0/w SBIN        r     1 OFFSET                    55-0-0/w PTR         r     1 OPT$
    13-0-0/w SBIN        r     1 OPTX                    2213-0-0/c CHAR(4)     r     1 RANREL
    26-0-0/w STRC(72)    r     1 RECS(0:9)                 16-0-0/w SBIN        r     1 RECSCOUNT
    14-0-0/w SBIN        r     1 RECX                      *0-0-0/w SBIN        r     1 SIZ
  3415-0-0/w UBIN        r     1 SIZE_NEEDED             2421-0-0/b BIT         r     1 SOMETHING
  2206-0-0/c CHAR(12)    r     1 TWORK                   2224-0-0/c STRC(720)   r     1 U1
  2250-0-0/c STRC(720)   r     1 U2                      2274-0-0/c STRC(720)   r     1 U3
  2320-0-0/c STRC(720)   r     1 U4                      2344-0-0/c STRC(720)   r     1 U5
  2370-0-0/c STRC(720)   r     1 U6                         7-0-0/w SBIN              1 W

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(72)    r     1 ACCT_MOVE                  0-0-0/w PTR         r     1 B$JIT$
     0-0-0/w PTR         r     1 B$TCB$                     0-0-0/c CHAR(80)    r     1 CARD(0:24)
     0-0-0/c STRC(18000) r     1 OPTS                       0-0-0/w SBIN        r     1 VW_BROKEN#
     0-0-0/c CHAR(8)     r     1 VW_IAM#                    0-0-0/w SBIN        r     1 VW_INPCNT#
     0-0-0/c CHAR(2000)  r     1 VW_OPTIONS#                0-0-0/w SBIN        r     1 VW_OUTCNT#
     0-0-0/b BIT         r     1 VW_SCRAMBLE#               0-0-0/w SBIN        r     1 VW_TOTBYTES#

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:237  

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w STRC(144)   r     1 B$TCB                      0-0-0/w STRC(324)   r     1 CODE03
     0-0-0/w STRC(396)   r     1 CODE04                     0-0-0/d ASTR(3528)  r     1 DUMMY
     0-0-0/w STRC(1116)  r     1 FM$FIT                     0-0-0N  NULL        r     1 M$INP
     0-0-0N  NULL        r     1 M$JE                       0-0-0N  NULL        r     1 M$NODE
     0-0-0N  NULL        r     1 M$UC                       0-0-0/c STRC(720)   r     1 OPTSCHAR
     0-0-0/c STRC(720)   r     1 OPTSDATE                   0-0-0/c STRC(720)   r     1 OPTSRECS


   Procedure VWB$BEAM requires 2571 words for executable code.
   Procedure VWB$BEAM requires 1836 words of local(AUTO) storage.

    No errors detected in file VWB$BEAM.:VMB6TSI    .
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:238  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:239  
          MINI XREF LISTING

ACCT_INP
     10761**DCL     10679--DCLINIT 10813--DCLINIT
ACCT_MOVE
     11545**DCL     11464--DCLINIT
ACCT_NODE
     10337**DCL     10254--DCLINIT
ACCT_OUT
     11024**DCL     10942--DCLINIT 11076--DCLINIT 11126--DCLINIT 11150--DCLINIT
ARS
     12097**DCL     12829<<ASSIGN  12830>>ASSIGN  12831>>CALLBLT 12905<<ASSIGN  12906>>ASSIGN  12907>>CALLBLT
     12919>>IF      12933<<ASSIGN  12934<>CALL    12940<<ASSIGN  12941<>CALL
ASZ$SCRAMBLE
     12071**DCL-ENT 13446--CALL
B$ALT.CODE
     11992**DCL     11992--REDEF   11993--REDEF   11993--REDEF
B$ALT.ERR
     11993**DCL     13223>>ASSIGN  13249>>ASSIGN
B$ALT.ERR.CODE
     11994**DCL     12818>>IF      12818>>IF      12818>>IF      12822>>IF      12827>>IF      12931>>IF
B$ALT.ERR.ERR#
     11994**DCL     11994--REDEF   12375>>IF      12375>>IF      12501>>IF
B$ALT.EVID
     11993**DCL     11993--REDEF   11993--REDEF
B$JIT.CPFLAGS1.SLEAZE
      6600**DCL      6600--REDEF
B$JIT.ERR.MID
      6507**DCL      6507--REDEF
B$JIT.JRESPEAK
      6668**DCL      6669--REDEF
B$JIT.MODE
      6501**DCL     13101>>IF
B$JIT.ORIGINATOR_PORT.FROM_CR
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:240  
      6777**DCL      6777--REDEF    6778--REDEF
B$JIT.PNR
      6681**DCL      6681--REDEF
B$JIT.PRIV.ACTIVE
      6507**DCL     12423>>IF
B$JIT.PRIV.ACTIVE.FMSEC
      6508**DCL     12501>>IF
B$JIT.REMCPO
      6779**DCL     12424<<ASSIGN
B$JIT.TSLINE
      6775**DCL      6776--REDEF
B$JIT$
     12118**DCL      6501--IMP-PTR 12423>>IF      12424>>ASSIGN  12501>>IF      13101>>IF
B$TCB.ALT$
     11987**DCL     12375>>IF      12375>>IF      12501>>IF      12818>>IF      12818>>IF      12818>>IF
     12822>>IF      12827>>IF      12931>>IF      13223>>ASSIGN  13249>>ASSIGN
B$TCB$
     12119**DCL     12375>>IF      12375>>IF      12501>>IF      12818>>IF      12818>>IF      12818>>IF
     12822>>IF      12827>>IF      12931>>IF      13223>>ASSIGN  13249>>ASSIGN
BADCHARS
     12147**DCL     12831>>CALLBLT 12877>>CALLBLT 12907>>CALLBLT
BAD_FILE_NAME
     12145**DCL     12362<<ASSIGN  12375>>IF      12380<<ASSIGN
BEAM_ABORT
     13262**LABEL   12953--CALLALT 13230--GOTO    13240--GOTO    13252--GOTO
BEAM_BAD_DST
     13172**LABEL   12477--CALLALT 12483--CALLALT 12520--CALLALT
BEAM_BAD_FM1
     12818**LABEL   12835--CALLALT
BEAM_BAD_FM2
     12931**LABEL   12937--CALLALT
BEAM_BAD_FMF
     13222**LABEL   12435--CALLALT
BEAM_BAD_INE
     13202**LABEL   12828--GOTO    12932--GOTO    12994--CALLALT
BEAM_BAD_INP
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:241  
     13132**LABEL   12253--CALLALT
BEAM_BAD_ITL
     13122**LABEL   12251--GOTO
BEAM_BAD_NODE
     13192**LABEL   12504--GOTO    12511--GOTO    12522--CALLALT 12529--CALLALT
BEAM_BAD_ORG
     13162**LABEL   12794--GOTO
BEAM_BAD_OTL
     13142**LABEL   12237--GOTO
BEAM_BAD_OUT
     13152**LABEL   12239--CALLALT
BEAM_BAD_WLD
     13182**LABEL   12346--GOTO    12411--GOTO
BEAM_BAD_WRJ
     13212**LABEL   12643--CALLALT 12655--CALLALT 12659--CALLALT 12672--CALLALT 12676--CALLALT 12684--CALLALT
     12688--CALLALT 12704--CALLALT 12714--CALLALT 12879--CALLALT 12881--CALLALT 12884--CALLALT 12887--CALLALT
     12934--CALLALT 12941--CALLALT 12982--CALLALT 12992--CALLALT
BEAM_IGNORE
     12805**LABEL   12825--GOTO
BEAM_INP_EOF
     12981**LABEL   12821--GOTO
BEAM_JUST_ONCE
     12433**LABEL   12343--CALLALT
BEAM_MULT_FILE
     12421**LABEL   12392--GOTO
BEAM_NEXT_FILE
     12371**LABEL   12382--GOTO    12405--GOTO    12408--GOTO    12456--GOTO    13112--GOTO    13268--GOTO
BEAM_SKIP
     12951**LABEL   12848--GOTO    12865--GOTO
BEAM_SYSERR
     13249**LABEL   13193--GOTO    13203--GOTO    13213--GOTO    13227--GOTO
BEAM_USRERR
     13239**LABEL   12632--CALLALT 13123--GOTO    13133--GOTO    13143--GOTO    13153--GOTO    13163--GOTO
     13173--GOTO    13183--GOTO
BEAM_WILD_DONE
     13278**LABEL   12379--GOTO    12407--GOTO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:242  
BEAM_WILD_ERROR
     12402**LABEL   12389--CALLALT
BFR IN PROCEDURE FORMAT
     13500**DCL     13498--PROC    13631>>CALLBLT 13636>>CALLBLT 13636>>CALLBLT 13642>>CALLBLT 13657>>CALLBLT
     13662>>CALLBLT 13687>>CALLBLT
BINM IN PROCEDURE FORMAT
     13504**DCL     13498--PROC    13518>>IF      13626>>IF
BIT6 IN PROCEDURE FIDDLE_FIT
     13326**DCL     13448>>ASSIGN
BIT9 IN PROCEDURE FIDDLE_FIT
     13324**DCL     13448<<ASSIGN
CARD
      9967**DCL     12652>>ASSIGN  12656>>ASSIGN  12669>>ASSIGN  12673>>ASSIGN  12681>>ASSIGN  12685>>ASSIGN
     13330--DOINDEX 13330--DOINDEX 13331>>IF      13333>>ASSIGN
CHECKCG
     12065**DCL        72--PROC    12962--IF      12963>>CALL    13015--IF
CLOCK_TO_TODAY
     11743**DCL     12222<>CALL
CLOCK_TO_TODAY.V
     11747**DCL     11743--DCLINIT
CLOCK_TO_UTS
     11791**DCL     12494<>CALL    13455<>CALL
CLOCK_TO_UTS.V
     11795**DCL     11791--DCLINIT
CLOSE_INP
     11248**DCL     12454<>CALL    12983<>CALL    13263<>CALL
CLOSE_INP.SN_
     11248**DCL     11248--REDEF
CLOSE_INP.UTL_
     11249**DCL     11249--REDEF
CLOSE_INP.V
     11253**DCL     11248--DCLINIT
CLOSE_INP.V.EXPIRE#
     11263**DCL     11263--REDEF
CLOSE_INP.V.TYPE#
     11261**DCL     11261--REDEF
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:243  
CLOSE_INP.V.XTNSIZE#
     11258**DCL     11258--REDEF   11260--REDEF
CLOSE_JE
     11637**DCL     12994<>CALL    13266<>CALL
CLOSE_JE.SN_
     11637**DCL     11637--REDEF
CLOSE_JE.UTL_
     11638**DCL     11638--REDEF
CLOSE_JE.V
     11642**DCL     11637--DCLINIT
CLOSE_JE.V.DISP#
     11646**DCL     12993<<ASSIGN  13264<<ASSIGN
CLOSE_JE.V.EXPIRE#
     11652**DCL     11652--REDEF
CLOSE_JE.V.TYPE#
     11650**DCL     11650--REDEF
CLOSE_JE.V.XTNSIZE#
     11647**DCL     11647--REDEF   11649--REDEF
CLOSE_NODE.SN_
     10409**DCL     10409--REDEF
CLOSE_NODE.UTL_
     10410**DCL     10410--REDEF
CLOSE_NODE.V
     10414**DCL     10409--DCLINIT
CLOSE_NODE.V.EXPIRE#
     10424**DCL     10424--REDEF
CLOSE_NODE.V.TYPE#
     10422**DCL     10422--REDEF
CLOSE_NODE.V.XTNSIZE#
     10419**DCL     10419--REDEF   10421--REDEF
CODE IN PROCEDURE FIDDLE_FIT
     13317**DCL     13345<<DOINDEX 13347>>ASSIGN  13349>>DOCASE  13353>>ASSIGN  13355>>IF      13358>>ASSIGN
CODE03.COMP
     10586**DCL     12581>>IF
CODE03.EXPIRE
     10587**DCL     12614<<ASSIGN
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:244  
CODE03.ORG
     10584**DCL     12600<<ASSIGN
CODE03.UGRANS
     10584**DCL     12580>>ASSIGN
CODE04.CREATION.TIME
     10596**DCL     12451>>ASSIGN
CODE04.MODIFY.TIME
     10596**DCL     12449>>ASSIGN
CODES IN PROCEDURE FIDDLE_FIT
     13316**DCL     13341<<ASSIGN  13345>>DOINDEX 13370>>IF      13380>>DOINDEX 13392<<ASSIGN  13392>>ASSIGN
     13393>>ASSIGN  13394>>ASSIGN
CONT IN PROCEDURE FORMAT
     13503**DCL     13498--PROC    13517>>IF
DATE_HI
     12105**DCL     12298<<ASSIGN  12301<<ASSIGN  12304<<ASSIGN  12307<<ASSIGN  12310<<ASSIGN  12313<<ASSIGN
     12452>>IF      12452>>IF
DATE_LO
     12104**DCL     12297<<ASSIGN  12300<<ASSIGN  12303<<ASSIGN  12306<<ASSIGN  12309<<ASSIGN  12312<<ASSIGN
     12452>>IF      12452>>IF
DATE_REL
     12193**DCL     12294<<ASSIGN  12314<<ASSIGN  12452>>IF      12452>>IF
DATE_SELECT
     12191**DCL     12221<<ASSIGN  12316<<ASSIGN  12443>>IF
DATE_SELECT_WHICH
     12192**DCL     12276<<ASSIGN  12278<<ASSIGN  12448>>IF
DUMMY.ACTPOS
     12032**DCL     12032--REDEF
DUMMY.ARS#
     12006**DCL     12006--REDEF   12478>>IF      12829>>ASSIGN  12905>>ASSIGN  12933>>ASSIGN  12940>>ASSIGN
DUMMY.ATTR
     12025**DCL     12026--REDEF
DUMMY.BORROW
     12040**DCL     12040--REDEF   12040--REDEF   12040--REDEF
DUMMY.DCBNAME.L
     12054**DCL     12054--IMP-SIZ
DUMMY.DVBYTE
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:245  
     12009**DCL     12895>>CALLBLT
DUMMY.EOMCHAR#
     12010**DCL     12010--REDEF
DUMMY.FCD#
     12019**DCL     13262>>IF      13265>>IF
DUMMY.FLDID
     12035**DCL     12035--REDEF
DUMMY.FORM$
     12029**DCL     12029--REDEF
DUMMY.FSECT
     12045**DCL     12045--REDEF
DUMMY.FSN#
     12022**DCL     12022--REDEF   12022--REDEF   12023--REDEF
DUMMY.HEADER$
     12028**DCL     12028--REDEF
DUMMY.IXTNSIZE#
     12026**DCL     12026--REDEF
DUMMY.LASTSTA$
     12015**DCL     12015--REDEF
DUMMY.LVL
     12041**DCL     12041--REDEF
DUMMY.NAME#
     12016**DCL     12381>>ASSIGN  12384>>ASSIGN
DUMMY.NAME#.C
     12016**DCL     12016--REDEF   12375>>IF      12380>>ASSIGN  13016>>ASSIGN  13034>>CALLBLT 13036>>CALLBLT
DUMMY.NOEOF
     12038**DCL     12038--REDEF
DUMMY.NRECS#
     12027**DCL     12027--REDEF
DUMMY.NRECX
     12046**DCL     12046--REDEF
DUMMY.OHDR
     12038**DCL     12038--REDEF
DUMMY.ORG#
     12021**DCL     12021--REDEF   12575>>ASSIGN
DUMMY.PRECNO
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:246  
     12044**DCL     12044--REDEF
DUMMY.RCSZ
     12050**DCL     12050--REDEF
DUMMY.RECL#
     12022**DCL     12770>>ASSIGN
DUMMY.RES#
     12017**DCL     12017--REDEF
DUMMY.SETX
     12029**DCL     12029--REDEF
DUMMY.TAB$
     12029**DCL     12029--REDEF
DUMMY.TDA
     12043**DCL     12044--REDEF
DUMMY.WSN#
     12017**DCL     12017--REDEF
DWORK
     12141**DCL     13059<<CALLBLT 13061>>DOWHILE 13064>>CALLBLT 13064>>CALLBLT 13075<<CALLBLT 13077>>DOWHILE
     13080>>ASSIGN  13284<<CALLBLT 13286>>DOWHILE 13289>>ASSIGN
EBIT IN PROCEDURE FORMAT
     13506**DCL     13519<<ASSIGN  13521<<ASSIGN  13533>>CALLBLT 13561>>CALLBLT 13584>>CALLBLT 13602>>CALLBLT
EPASS IN PROCEDURE FIDDLE_FIT
     13323**DCL     13324--REDEF   13450>>ASSIGN
ERRBITS
     12112**DCL     13223<<ASSIGN  13249<<ASSIGN
ERRBITS.CODE
     12115**DCL     13225>>IF      13225>>IF      13225>>IF      13225>>IF
ERRBITS.SEV
     12116**DCL     13224<<ASSIGN  13250<<ASSIGN
ERRCODE
     12111**DCL     12112--REDEF   13122<<ASSIGN  13132<<ASSIGN  13142<<ASSIGN  13152<<ASSIGN  13162<<ASSIGN
     13172<<ASSIGN  13182<<ASSIGN  13239<>CALL    13251<>CALL    13414<<ASSIGN
ERRDCB
     12098**DCL     13192<<ASSIGN  13202<<ASSIGN  13212<<ASSIGN  13222<<ASSIGN  13251<>CALL
EXTERNAL.ACCT
     12136**DCL     12489<<ASSIGN  13459>>CALLBLT
EXTERNAL.SITENAME
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:247  
     12135**DCL     12488<<ASSIGN  12490>>IF      12519>>ASSIGN  13451>>ASSIGN
FIDDLE_FIT
     13296**PROC    12632--CALL
FID_INP
     10812**DCL     12253<>CALL
FID_INP.TEXTFID_
     10812**DCL     12252<<ASSIGN
FID_INP.V
     10816**DCL     10812--DCLINIT
FID_OUT
     11075**DCL     12239<>CALL
FID_OUT.TEXTFID_
     11075**DCL     12238<<ASSIGN
FID_OUT.V
     11079**DCL     11075--DCLINIT
FILECOUNT
     12088**DCL     12220<<ASSIGN  13110<<ASSIGN  13110>>ASSIGN  13278>>DOCASE  13284>>CALLBLT
FILEORG
     12094**DCL     12575<<ASSIGN  12595<<ASSIGN  12723>>DOCASE  12822>>IF      12822>>IF      12845>>IF
     12874>>IF      12883>>IF      12883>>IF      12883>>IF
FITBUF
     12138**DCL     12209--ASSIGN  12444--ASSIGN  12446--IF      12447--ASSIGN  12449--ASSIGN  12451--ASSIGN
     12576--ASSIGN  12578--IF      12579--ASSIGN  12580--ASSIGN  12581--IF      12596--ASSIGN  12598--IF
     12599--ASSIGN  12600--ASSIGN  12602--IF      12603--ASSIGN  12604--IF      12604--IF      12606--ASSIGN
     12610--ASSIGN  12612--IF      12613--ASSIGN  12614--ASSIGN  12616--IF      12616--IF      12618--ASSIGN
     12713--ASSIGN  12714<>CALL    13341--ASSIGN  13342--ASSIGN  13347--ASSIGN  13349--DOCASE  13353--ASSIGN
     13355--IF      13355--IF      13377--DOINDEX 13378<<ASSIGN  13378>>ASSIGN  13381--ASSIGN  13381--ASSIGN
     13384--ASSIGN  13384--ASSIGN  13394--ASSIGN  13395--ASSIGN  13404--IF      13412--IF      13412--IF
     13420--ASSIGN  13421--ASSIGN  13421--ASSIGN  13423--ASSIGN  13423--ASSIGN  13429--ASSIGN  13430--ASSIGN
     13434--ASSIGN  13436<<ASSIGN
FITCARD IN PROCEDURE FIDDLE_FIT
     13313**DCL     13314--REDEF   13333<<ASSIGN  13339--ASSIGN
FITWORD IN PROCEDURE FIDDLE_FIT
     13314**DCL     13436>>ASSIGN
FM$FIT.CODES.CODE
     10580**DCL     12444>>ASSIGN  12446>>IF      12576>>ASSIGN  12578>>IF      12596>>ASSIGN  12598>>IF
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:248  
     12602>>IF      12603<<ASSIGN  12604>>IF      12604>>IF      12606<<ASSIGN  12610>>ASSIGN  12612>>IF
     12616>>IF      12616>>IF      13341>>ASSIGN  13349>>DOCASE  13353<<ASSIGN  13394<<ASSIGN  13429<<ASSIGN
FM$FIT.CODES.ITEMX
     10580**DCL     12447>>ASSIGN  12579>>ASSIGN  12599>>ASSIGN  12613>>ASSIGN  13347>>ASSIGN  13381<<ASSIGN
     13381>>ASSIGN  13421<<ASSIGN  13434>>ASSIGN
FM$FIT.CODES.NAW
     10580**DCL     13355>>IF      13355>>IF      13395<<ASSIGN  13404>>IF      13420<<ASSIGN
FM$FIT.CODES.NDW
     10580**DCL     12618<<ASSIGN  12713>>ASSIGN  13342>>ASSIGN  13377>>DOINDEX 13384<<ASSIGN  13384>>ASSIGN
     13412>>IF      13421>>ASSIGN  13423<<ASSIGN  13423>>ASSIGN  13430<<ASSIGN
FMSEC
     11813**DCL     12506<>CALL    12509<>CALL    12513<>CALL
FMSEC.V
     11813**DCL     11813--DCLINIT
FORMAT
     13498**PROC    12714--CALL    12879--CALL    12881--CALL    12884--CALL    12934--CALL    12941--CALL
FORMAT_ABORT IN PROCEDURE FORMAT
     13702**LABEL   13532--CALLALT 13537--CALLALT 13542--CALLALT 13547--CALLALT 13560--CALLALT 13565--CALLALT
     13570--CALLALT 13583--CALLALT 13588--CALLALT 13601--CALLALT 13614--CALLALT 13630--CALLALT 13635--CALLALT
     13641--CALLALT 13656--CALLALT 13661--CALLALT 13666--CALLALT 13683--CALLALT
FPT_JOBSTATS
     11670**DCL     13040<>CALL
FPT_JOBSTATS.V
     11674**DCL     11670--DCLINIT
FPT_JOBSTATS.V.NUM#
     11676**DCL     13037<<ASSIGN
FPT_JOBSTATS.V.SYSID#
     11674**DCL     13035<<ASSIGN
FPT_WAIT
     11829**DCL     13038<>CALL
FPT_WAIT.V
     11830**DCL     11829--DCLINIT
FREE IN PROCEDURE FIDDLE_FIT
     13320**DCL     13343<<ASSIGN  13355>>IF      13355>>IF      13358<<ASSIGN  13365>>IF      13393<<ASSIGN
     13395>>ASSIGN  13404>>IF      13420>>ASSIGN  13421>>ASSIGN  13429>>ASSIGN  13430>>ASSIGN  13434>>ASSIGN
I
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:249  
     12079**DCL     12213--ASSIGN  12215--ASSIGN  12217--ASSIGN  12235<<ASSIGN  12236>>IF      12236>>IF
     12238>>ASSIGN  12249<<ASSIGN  12250>>IF      12250>>IF      12252>>ASSIGN  12285<<CALLBLT 12286>>CALLBLT
     12359<<CALLBLT 12360>>ASSIGN  12403<<CALLBLT 12404>>IF      12406>>IF      12406>>IF      12422>>ASSIGN
     12445<<DOINDEX 12446>>IF      12447>>ASSIGN  12497<<CALLBLT 12498>>ASSIGN  12539>>ASSIGN  12542<<ASSIGN
     12546>>ASSIGN  12548<<CALLBLT 12549>>ASSIGN  12577<<DOINDEX 12578>>IF      12579>>ASSIGN  12597<<DOINDEX
     12598>>IF      12599>>ASSIGN  12602>>IF      12603>>ASSIGN  12604>>IF      12604>>IF      12606>>ASSIGN
     12611<<DOINDEX 12612>>IF      12613>>ASSIGN  12616>>IF      12616>>IF      12618>>ASSIGN  12642<<ASSIGN
     12643<>CALL    12831<<CALLBLT 12858<<ASSIGN  12859>>DOWHILE 12860>>IF      12860>>IF      12861<<ASSIGN
     12862<<ASSIGN  12862>>ASSIGN  12864>>IF      12877<<CALLBLT 12907<<CALLBLT 12991<<ASSIGN  12992<>CALL
     13017<<ASSIGN  13018>>DOWHILE 13019<<ASSIGN  13019>>ASSIGN  13025>>CALLBLT 13025>>CALLBLT 13026>>ASSIGN
     13034<<CALLBLT 13035>>ASSIGN  13036<<CALLBLT 13037>>ASSIGN  13048<<ASSIGN  13049>>IF      13051<<ASSIGN
     13051>>ASSIGN  13053>>IF      13055<<ASSIGN  13055>>ASSIGN  13059>>CALLBLT 13060<<ASSIGN  13061>>DOWHILE
     13061>>DOWHILE 13062<<ASSIGN  13062>>ASSIGN  13064>>CALLBLT 13064>>CALLBLT 13065>>ASSIGN  13285<<ASSIGN
     13286>>DOWHILE 13287<<ASSIGN  13287>>ASSIGN  13289>>ASSIGN  13289>>ASSIGN  13290>>ASSIGN
I IN PROCEDURE FIDDLE_FIT
     13321**DCL     13330<<DOINDEX 13331>>IF      13333>>ASSIGN  13377<<DOINDEX 13378>>ASSIGN  13378>>ASSIGN
     13380<<DOINDEX 13381>>ASSIGN  13381>>ASSIGN  13435<<DOINDEX 13436>>ASSIGN  13436>>ASSIGN  13447<<DOINDEX
     13448>>ASSIGN  13448>>ASSIGN  13458<<CALLBLT 13459>>CALLBLT 13460<<CALLBLT 13461>>ASSIGN
I IN PROCEDURE FORMAT
     13507**DCL     13627<<DOINDEX 13631>>CALLBLT 13636>>CALLBLT 13636>>CALLBLT 13642>>CALLBLT 13679<<ASSIGN
     13680>>DOWHILE 13685>>IF      13686>>ASSIGN  13687>>CALLBLT 13688<<ASSIGN  13688>>ASSIGN
INFINITY
     12101**DCL     12298>>ASSIGN  12304>>ASSIGN
INF_CON
     12100**DCL     12101--REDEF
INPBUF
     12124**DCL     11178--DCLINIT 11179--DCLINIT 12934<>CALL    12941<>CALL
INPBUF.C
     12125**DCL     12831>>CALLBLT 12907>>CALLBLT
INPLIM
     12096**DCL     12713<<ASSIGN  12714<>CALL    12714<>CALL    12807<<ASSIGN  12830<<ASSIGN  12830>>ASSIGN
     12906<<ASSIGN  12906>>ASSIGN  12919>>IF      12934<>CALL    12941<>CALL    12951>>ASSIGN
INPPTR
     12120**DCL     12207<<ASSIGN  12375>>IF      12380>>ASSIGN  12381>>ASSIGN  12384>>ASSIGN  12575>>ASSIGN
     12770>>ASSIGN  12829>>ASSIGN  12895>>CALLBLT 12905>>ASSIGN  12933>>ASSIGN  12940>>ASSIGN  13262>>IF
INTERNET
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:250  
     12194**DCL     12487<<ASSIGN  12526<<ASSIGN  12630>>IF
INTRASHIP
     12195**DCL     12493<<ASSIGN  12518<<ASSIGN  12527<<ASSIGN  12640>>IF      13003>>IF
INTRASHIP_BEAMING
     12493**LABEL   12475--GOTO    12481--GOTO
INTRASHIP_NAME
     11530**DCL     11460--DCLINIT
INTRASHIP_NAME.L#
     11530**DCL     12498<<ASSIGN
INTRASHIP_NAME.NAME#
     11530**DCL     12495<<CALLBLT 12496<<CALLBLT 12497>>CALLBLT
INTRASHIP_PASS
     11561**DCL     11461--DCLINIT
ITSBIN
     12187**DCL     12808<<ASSIGN  12833<<ASSIGN  12909<<ASSIGN  12934<>CALL    12941<>CALL
J
     12080**DCL     12286<<CALLBLT 12287>>ASSIGN  12343<<CALLBLT 12444<<ASSIGN  12445>>DOINDEX 12576<<ASSIGN
     12577>>DOINDEX 12596<<ASSIGN  12597>>DOINDEX 12610<<ASSIGN  12611>>DOINDEX 12831<<CALLBLT 12832>>IF
     12877<<CALLBLT 12878>>IF      12907<<CALLBLT 12908>>IF      13021<<ASSIGN  13022>>DOWHILE 13022>>DOWHILE
     13023<<ASSIGN  13023>>ASSIGN  13025>>CALLBLT 13025>>CALLBLT 13026>>ASSIGN
J IN PROCEDURE FORMAT
     13508**DCL     13684<<ASSIGN  13685>>IF      13686<<ASSIGN  13687>>CALLBLT 13687>>CALLBLT 13688>>ASSIGN
     13689>>ASSIGN
JEBUF
     12139**DCL     12210--ASSIGN  12569<<ASSIGN  12643<>CALL    12652<<ASSIGN  12654<>CALL    12656<<ASSIGN
     12658<>CALL    12669<<ASSIGN  12671<>CALL    12673<<ASSIGN  12675<>CALL    12681<<ASSIGN  12683<>CALL
     12685<<ASSIGN  12687<>CALL    12698<<ASSIGN  12699--ASSIGN  12700--ASSIGN  12701--ASSIGN  12703<>CALL
     12895<<CALLBLT 12992<>CALL    13533<<CALLBLT 13538<<CALLBLT 13543<<CALLBLT 13548<<CALLBLT 13561<<CALLBLT
     13566<<CALLBLT 13571<<CALLBLT 13584<<CALLBLT 13589<<CALLBLT 13602<<CALLBLT 13615<<CALLBLT 13631<<CALLBLT
     13636<<CALLBLT 13642<<CALLBLT 13657<<CALLBLT 13662<<CALLBLT 13667<<CALLBLT 13687<<CALLBLT 13743<<CALLBLT
     13754<>CALL    13766<<ASSIGN
JEIDX
     12095**DCL     12571<<ASSIGN  12885<<ASSIGN  12885>>ASSIGN  12886>>IF      12895>>CALLBLT 12981<<ASSIGN
     12981>>ASSIGN  13530<<ASSIGN  13530>>ASSIGN  13531>>IF      13533>>CALLBLT 13535<<ASSIGN  13535>>ASSIGN
     13536>>IF      13538>>CALLBLT 13540<<ASSIGN  13540>>ASSIGN  13541>>IF      13543>>CALLBLT 13545<<ASSIGN
     13545>>ASSIGN  13546>>IF      13548>>CALLBLT 13558<<ASSIGN  13558>>ASSIGN  13559>>IF      13561>>CALLBLT
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:251  
     13563<<ASSIGN  13563>>ASSIGN  13564>>IF      13566>>CALLBLT 13568<<ASSIGN  13568>>ASSIGN  13569>>IF
     13571>>CALLBLT 13581<<ASSIGN  13581>>ASSIGN  13582>>IF      13584>>CALLBLT 13586<<ASSIGN  13586>>ASSIGN
     13587>>IF      13589>>CALLBLT 13599<<ASSIGN  13599>>ASSIGN  13600>>IF      13602>>CALLBLT 13612<<ASSIGN
     13612>>ASSIGN  13613>>IF      13615>>CALLBLT 13628<<ASSIGN  13628>>ASSIGN  13629>>IF      13631>>CALLBLT
     13633<<ASSIGN  13633>>ASSIGN  13634>>IF      13636>>CALLBLT 13639<<ASSIGN  13639>>ASSIGN  13640>>IF
     13642>>CALLBLT 13654<<ASSIGN  13654>>ASSIGN  13655>>IF      13657>>CALLBLT 13659<<ASSIGN  13659>>ASSIGN
     13660>>IF      13662>>CALLBLT 13664<<ASSIGN  13664>>ASSIGN  13665>>IF      13667>>CALLBLT 13681<<ASSIGN
     13681>>ASSIGN  13682>>IF      13684>>ASSIGN  13687>>CALLBLT 13689<<ASSIGN  13689>>ASSIGN  13743>>CALLBLT
     13752>>IF      13765<<ASSIGN
JEPTR
     12121**DCL     12208<<ASSIGN  13016>>ASSIGN  13034>>CALLBLT 13036>>CALLBLT 13265>>IF
K
     12081**DCL     12447<<ASSIGN  12449>>ASSIGN  12451>>ASSIGN  12579<<ASSIGN  12580>>ASSIGN  12581>>IF
     12599<<ASSIGN  12600>>ASSIGN  12613<<ASSIGN  12614>>ASSIGN  12875<<ASSIGN  12876>>ASSIGN  12877>>CALLBLT
     12879<>CALL    12879<>CALL    12881<>CALL    12881<>CALL    13076<<ASSIGN  13077>>DOWHILE 13077>>DOWHILE
     13078<<ASSIGN  13078>>ASSIGN  13080>>ASSIGN  13080>>ASSIGN  13081>>ASSIGN
KEYBUF
     12130**DCL     12745--ASSIGN
KEYBUF.C
     12132**DCL     12845>>IF      12845>>IF      12845>>IF      12877>>CALLBLT 12879<>CALL    12881<>CALL
KEYBUF.L
     12131**DCL     12845>>IF      12875>>ASSIGN
LOW IN PROCEDURE FIDDLE_FIT
     13318**DCL     13342<<ASSIGN  13347<<ASSIGN  13347>>ASSIGN  13370>>IF      13377>>DOINDEX 13386<<ASSIGN
     13386>>ASSIGN
M$CLOSE
      5567**DCL-ENT 12454--CALL    12983--CALL    12994--CALL    13263--CALL    13266--CALL
M$FID
      5630**DCL-ENT 12239--CALL    12253--CALL
M$INP
     12067**DCL     12207--ASSIGN  13202>>ASSIGN  13222>>ASSIGN
M$JE
     12068**DCL     12208--ASSIGN  12643<>CALL    12992<>CALL    13192>>ASSIGN  13212>>ASSIGN
M$JOBSTATS
      5632**DCL-ENT 13040--CALL
M$NODE
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:252  
     12069**DCL     12478--IF
M$OPEN
      5567**DCL-ENT 12373--CALL    12435--CALL    12499--CALL    12507--CALL    12522--CALL    12529--CALL
M$PRECORD
      5571**DCL-ENT 12920--CALL
M$READ
      5568**DCL-ENT 12477--CALL    12483--CALL    12520--CALL    12809--CALL    12835--CALL    12922--CALL
     12937--CALL
M$RENV
      5623**DCL-ENT 12510--CALL    12514--CALL
M$RPRIV
      5626**DCL-ENT 12509--CALL    12513--CALL
M$SENV
      5623**DCL-ENT 12505--CALL
M$SPRIV
      5626**DCL-ENT 12506--CALL
M$TIME
      5634**DCL-ENT 12222--CALL    12223--CALL    12291--CALL    12494--CALL    13455--CALL
M$UNFID
      5630**DCL-ENT 12421--CALL    12538--CALL    12545--CALL
M$WAIT
      5625**DCL-ENT 13038--CALL
M$WRITE
      5568**DCL-ENT 12655--CALL    12659--CALL    12672--CALL    12676--CALL    12684--CALL    12688--CALL
     12704--CALL    13755--CALL
MULTIPLE
     12188**DCL     12219<<ASSIGN  12361<<ASSIGN  12455>>IF      13111>>IF      13267>>IF
MXS IN PROCEDURE FORMAT
     13502**DCL     13498--PROC    13529>>IF      13533>>CALLBLT 13538>>CALLBLT 13543>>CALLBLT 13548>>CALLBLT
     13557>>IF      13561>>CALLBLT 13566>>CALLBLT 13571>>CALLBLT 13580>>IF      13584>>CALLBLT 13589>>CALLBLT
     13598>>IF      13602>>CALLBLT
NAME_DEST
     11886**DCL     12354<<ASSIGN
NAME_DEST.L#
     11886**DCL     12356>>ASSIGN
NAME_DEST.NAME#
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:253  
     11886**DCL     12356--ASSIGN
NAME_INP
     10746**DCL     10675--DCLINIT 10813--DCLINIT 12355>>ASSIGN  12381<<ASSIGN  12384<<ASSIGN
NAME_INP.L#
     10746**DCL     12343>>CALLBLT 12360<<ASSIGN  12387>>ASSIGN
NAME_INP.NAME#
     10746**DCL     12343>>CALLBLT 12359>>CALLBLT 12387--ASSIGN  12406>>IF
NAME_NODE
     10321**DCL     10250--DCLINIT
NAME_OUT
     11009**DCL     10938--DCLINIT 11076--DCLINIT 11126--DCLINIT 11150--DCLINIT 12354>>ASSIGN
NAME_OUT.L#
     11009**DCL     12386<<ASSIGN  12388>>ASSIGN  12390<<ASSIGN  12391>>IF
NAME_OUT.NAME#
     11009**DCL     12388--ASSIGN
NAME_WILD
     11858**DCL     12355<<ASSIGN
NAME_WILD.L#
     11858**DCL     12357>>ASSIGN  12403>>CALLBLT
NAME_WILD.NAME#
     11858**DCL     12357--ASSIGN  12403>>CALLBLT 12406>>IF
NFA
     12185**DCL     12560<<ASSIGN  12609>>IF
NLN
     12184**DCL     12558<<ASSIGN  12594>>IF
NODEKEY
     10465**DCL     10361--DCLINIT 10362--DCLINIT
NODEKEY.C
     10467**DCL     12476<<ASSIGN  12482<<ASSIGN  12519<<ASSIGN
NODEKEY.L
     10466**DCL     12218<<ASSIGN
NODEOVR
     10476**DCL     10571--REDEF
NODEOVR.ACCT
     10496**DCL     12489>>ASSIGN
NODEOVR.NODE_NAME
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:254  
     10505**DCL     12488>>ASSIGN
NODEOVR.PATH_NAME
     10485**DCL     10496--REDEF   12479>>IF      12482>>ASSIGN  12521>>ASSIGN  12528>>ASSIGN
NODEOVR.TIME
     10563**DCL     13048>>ASSIGN
NODEOVR.TYPE_DEST
     10515**DCL     12485>>IF
NODEOVR.TYPE_PATH
     10534**DCL     12642>>ASSIGN  12991>>ASSIGN
NODEREC
     10571**DCL     10363--DCLINIT 10364--DCLINIT
NOGOOD
     12509**LABEL   12506--CALLALT
NSC
     12186**DCL     12559<<ASSIGN  12845>>IF
OFFSET IN PROCEDURE FIDDLE_FIT
     13322**DCL     13434<<ASSIGN  13436>>ASSIGN
OPEN_INP
     10674**DCL     12373<>CALL    12435<>CALL
OPEN_INP.ACSVEH_
     10676**DCL     10677--REDEF
OPEN_INP.ALTKEYS_
     10682**DCL     10683--REDEF   10683--REDEF
OPEN_INP.FPARAM_
     10679**DCL     12209<<ASSIGN
OPEN_INP.HDR_
     10681**DCL     10682--REDEF
OPEN_INP.TAB_
     10680**DCL     10681--REDEF
OPEN_INP.UHL_
     10674**DCL     10675--REDEF   10675--REDEF
OPEN_INP.V
     10683**DCL     10674--DCLINIT
OPEN_INP.V.ASN#
     10693**DCL     10815--DCLINIT
OPEN_INP.V.FSN#
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:255  
     10714**DCL     10714--REDEF   10714--REDEF
OPEN_INP.V.OPER
     10685**DCL     12385<<ASSIGN
OPEN_INP.V.OPER.NXTF#
     10686**DCL     12371<<ASSIGN  12434<<ASSIGN
OPEN_INP.V.OPER.TEST#
     10685**DCL     12372<<ASSIGN  12433<<ASSIGN
OPEN_INP.V.OPER.THISF#
     10686**DCL     12358<<ASSIGN
OPEN_INP.V.RES#
     10698**DCL     10815--DCLINIT
OPEN_INP.WSN_
     10680**DCL     10680--REDEF
OPEN_JE
     11340**DCL     12522<>CALL    12529<>CALL
OPEN_JE.ACSVEH_
     11342**DCL     11343--REDEF
OPEN_JE.ALTKEYS_
     11348**DCL     11349--REDEF   11349--REDEF
OPEN_JE.HDR_
     11347**DCL     11348--REDEF
OPEN_JE.TAB_
     11346**DCL     11347--REDEF
OPEN_JE.UHL_
     11340**DCL     11341--REDEF   11341--REDEF
OPEN_JE.V
     11349**DCL     11340--DCLINIT
OPEN_JE.V.FSN#
     11380**DCL     11380--REDEF   11380--REDEF
OPEN_JE.WSN_
     11346**DCL     11346--REDEF
OPEN_JE_INTRASHIP
     11459**DCL     12499<>CALL    12507<>CALL
OPEN_JE_INTRASHIP.ACSVEH_
     11461**DCL     11462--REDEF
OPEN_JE_INTRASHIP.ALTKEYS_
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:256  
     11467**DCL     11468--REDEF   11468--REDEF
OPEN_JE_INTRASHIP.HDR_
     11466**DCL     11467--REDEF
OPEN_JE_INTRASHIP.TAB_
     11465**DCL     11466--REDEF
OPEN_JE_INTRASHIP.UHL_
     11459**DCL     11460--REDEF   11460--REDEF
OPEN_JE_INTRASHIP.V
     11468**DCL     11459--DCLINIT
OPEN_JE_INTRASHIP.V.FSN#
     11499**DCL     11499--REDEF   11499--REDEF
OPEN_JE_INTRASHIP.WSN_
     11465**DCL     11465--REDEF
OPEN_NODE.ACSVEH_
     10251**DCL     10252--REDEF
OPEN_NODE.ALTKEYS_
     10257**DCL     10258--REDEF   10258--REDEF
OPEN_NODE.HDR_
     10256**DCL     10257--REDEF
OPEN_NODE.TAB_
     10255**DCL     10256--REDEF
OPEN_NODE.UHL_
     10249**DCL     10250--REDEF   10250--REDEF
OPEN_NODE.V
     10258**DCL     10249--DCLINIT
OPEN_NODE.V.FSN#
     10289**DCL     10289--REDEF   10289--REDEF
OPEN_NODE.WSN_
     10255**DCL     10255--REDEF
OPEN_OUT.ACSVEH_
     10939**DCL     10940--REDEF
OPEN_OUT.ALTKEYS_
     10945**DCL     10946--REDEF   10946--REDEF
OPEN_OUT.HDR_
     10944**DCL     10945--REDEF
OPEN_OUT.TAB_
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:257  
     10943**DCL     10944--REDEF
OPEN_OUT.UHL_
     10937**DCL     10938--REDEF   10938--REDEF
OPEN_OUT.V
     10946**DCL     10937--DCLINIT
OPEN_OUT.V.ASN#
     10956**DCL     11078--DCLINIT 11128--DCLINIT 11152--DCLINIT
OPEN_OUT.V.FSN#
     10977**DCL     10977--REDEF   10977--REDEF
OPEN_OUT.V.RES#
     10961**DCL     11078--DCLINIT 11128--DCLINIT 11152--DCLINIT
OPEN_OUT.WSN_
     10943**DCL     10943--REDEF
OPT$
     12122**DCL     12264<<ASSIGN  12275>>IF      12280>>IF      12282>>IF      12284>>IF      12285>>CALLBLT
     12286>>CALLBLT 12290>>ASSIGN  12295>>DOSELCT 12327>>CALLBLT 12328>>CALLBLT
OPTS.INP.FID
      9712**DCL     12252--ASSIGN
OPTS.INP.L
      9706**DCL     12249>>ASSIGN
OPTS.INP.MISC.NFA
      9683**DCL     12560>>ASSIGN
OPTS.INP.MISC.NLN
      9689**DCL     12558>>ASSIGN
OPTS.INP.MISC.NSC
      9677**DCL     12559>>ASSIGN
OPTS.INP.MISC.TRAN
      9671**DCL     12561>>ASSIGN
OPTS.MAILINIT.CMD
      9917**DCL     13229<<ASSIGN
OPTS.MAILINIT.WHO
      9926**DCL     12680>>IF      13454<<ASSIGN
OPTS.MAILRCVR.WHO
      9880**DCL     12668>>IF      13453<<ASSIGN
OPTS.MAILSNDR.WHO
      9837**DCL     13452<<ASSIGN
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:258  
OPTS.OPTSRECS
      9961**DCL     12262--DOWHILE 12262>>DOWHILE 12264--ASSIGN  12265>>DOSELCT
OPTS.OUT.ACCT
      9731**DCL     13443<<ASSIGN
OPTS.OUT.EPASS
      9744**DCL     13450<<ASSIGN
OPTS.OUT.FID
      9819**DCL     12212--ASSIGN  12234>>IF      12238--ASSIGN  12345>>IF      12540>>IF      12541>>ASSIGN
     13456<<CALLBLT 13457<<CALLBLT 13458>>CALLBLT 13459<<CALLBLT 13460>>CALLBLT
OPTS.OUT.L
      9813**DCL     12235>>ASSIGN  12422<<ASSIGN  12542>>ASSIGN  13461<<ASSIGN
OPTS.OUT.NAME
      9737**DCL     13444<<ASSIGN
OPTS.OUT.NODE
      9803**DCL     12473>>IF      12476>>ASSIGN  12547>>ASSIGN  12548>>CALLBLT 13039>>ASSIGN  13451<<ASSIGN
OPTSCHAR.CMD
     10065**DCL     12699<<ASSIGN
OPTSCHAR.PATTERN
     10079**DCL     12701<<ASSIGN
OPTSCHAR.SUB
     10071**DCL     12700<<ASSIGN
OPTSDATE.REL
      9998**DCL     12295>>DOSELCT
OPTSDATE.UTS
     10005**DCL     12280>>IF      12282>>IF      12284>>IF      12285>>CALLBLT 12286>>CALLBLT 12290>>ASSIGN
OPTSDATE.WHICH
      9992**DCL     12275>>IF
OPTSRECS.FRST
     10038**DCL     12327>>CALLBLT
OPTSRECS.LAST
     10045**DCL     12328>>CALLBLT
OPTX
     12086**DCL     12261<<ASSIGN  12262>>DOWHILE 12262>>DOWHILE 12264>>ASSIGN  12265>>DOSELCT 12333<<ASSIGN
     12333>>ASSIGN
PASSWORD IN PROCEDURE FIDDLE_FIT
     13325**DCL     13326--REDEF   13445<<ASSIGN  13446<>CALL
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:259  
PASS_INP
     10776**DCL     10676--DCLINIT 10814--DCLINIT
PASS_OUT
     11039**DCL     10939--DCLINIT 11077--DCLINIT 11127--DCLINIT
PRECORD_INP
     11212**DCL     12920<>CALL
PRECORD_INP.V
     11214**DCL     11212--DCLINIT
RANREL
     12144**DCL     12757--ASSIGN  12769--ASSIGN  12783--ASSIGN  12884<>CALL
READ_INP
     11176**DCL     12809<>CALL    12835<>CALL    12922<>CALL    12937<>CALL
READ_INP.BUF_.BOUND
     11178**DCL     12734<<ASSIGN  12746<<ASSIGN  12758<<ASSIGN  12770<<ASSIGN  12771>>IF      12772<<ASSIGN
     12784<<ASSIGN
READ_INP.KEY_
     11176**DCL     12745<<ASSIGN  12757<<ASSIGN  12769<<ASSIGN  12783<<ASSIGN
READ_INP.STATION_
     11179**DCL     11180--REDEF
READ_INP.V
     11180**DCL     11176--DCLINIT
READ_INP.V.DVBYTE.CONT#
     11193**DCL     12806<<ASSIGN  12834<<ASSIGN  12921<<ASSIGN  12934<>CALL    12936<<ASSIGN  12941<>CALL
READ_INP.V.DVBYTE.REREAD#
     11191**DCL     11191--REDEF
READ_INP.V.FULL#
     11182**DCL     12735<<ASSIGN  12747<<ASSIGN  12759<<ASSIGN  12773<<ASSIGN  12785<<ASSIGN
READ_INP.V.INDX#
     11189**DCL     11189--REDEF
READ_INP.V.KEYR#
     11181**DCL     12733<<ASSIGN  12744<<ASSIGN  12756<<ASSIGN  12768<<ASSIGN  12782<<ASSIGN
READ_NODE
     10361**DCL     12477<>CALL    12483<>CALL    12520<>CALL
READ_NODE.STATION_
     10364**DCL     10365--REDEF
READ_NODE.V
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:260  
     10365**DCL     10361--DCLINIT
READ_NODE.V.DVBYTE.REREAD#
     10376**DCL     10376--REDEF
READ_NODE.V.INDX#
     10374**DCL     10374--REDEF
RECS
     12107**DCL     12225<<ASSIGN
RECS.HI
     12109**DCL     12328<<CALLBLT 12860>>IF
RECS.LO
     12108**DCL     12327<<CALLBLT 12860>>IF
RECSCOUNT
     12089**DCL     12574<<ASSIGN  12824<<ASSIGN  12824>>ASSIGN  12837<<ASSIGN  12837>>ASSIGN  12860>>IF
     12860>>IF
RECX
     12087**DCL     12224<<ASSIGN  12326>>IF      12327>>CALLBLT 12328>>CALLBLT 12329<<ASSIGN  12329>>ASSIGN
     12857>>IF      12859>>DOWHILE 12861>>ASSIGN  12864>>IF
REPORT_SENT
     13101**LABEL   13006--GOTO
SIZ IN PROCEDURE FORMAT
     13501**DCL     13498--PROC    13500--IMP-SIZ 13627>>DOINDEX 13631>>CALLBLT 13636>>CALLBLT 13636>>CALLBLT
     13642>>CALLBLT 13653>>IF      13657>>CALLBLT 13657>>CALLBLT 13662>>CALLBLT 13662>>CALLBLT 13680>>DOWHILE
     13685>>IF      13686>>ASSIGN  13687>>CALLBLT
SIZE_NEEDED IN PROCEDURE FIDDLE_FIT
     13315**DCL     13328<<ASSIGN  13333>>ASSIGN  13334<<ASSIGN  13334>>ASSIGN  13339<<ASSIGN  13339>>ASSIGN
     13404>>IF      13412>>IF      13420>>ASSIGN  13423>>ASSIGN  13430>>ASSIGN  13435>>DOINDEX
SN_INP
     10791**DCL     10674--DCLINIT 10814--DCLINIT
SN_OUT
     11054**DCL     10937--DCLINIT 11077--DCLINIT 11127--DCLINIT 11151--DCLINIT
SOMETHING
     12190**DCL     12573<<ASSIGN  12904<<ASSIGN
STUFF
     13732**PROC    12887--CALL    12982--CALL    13532--CALL    13537--CALL    13542--CALL    13547--CALL
     13560--CALL    13565--CALL    13570--CALL    13583--CALL    13588--CALL    13601--CALL    13614--CALL
     13630--CALL    13635--CALL    13641--CALL    13656--CALL    13661--CALL    13666--CALL    13683--CALL
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:261  
STUFF_BAD_WRJ IN PROCEDURE STUFF
     13777**LABEL   13755--CALLALT
TODAY
     12103**DCL     11771--DCLINIT 11795--DCLINIT 12283<<ASSIGN  12283>>ASSIGN  12287<<ASSIGN  12287>>ASSIGN
     12297>>ASSIGN  12300>>ASSIGN  12301>>ASSIGN  12303>>ASSIGN  12307>>ASSIGN  12310>>ASSIGN  12312>>ASSIGN
     12313>>ASSIGN  12449<<ASSIGN  12451<<ASSIGN  12452>>IF      12452>>IF      12452>>IF      12452>>IF
     12496>>CALLBLT 13457>>CALLBLT
TODAY_TO_UTS
     11767**DCL     12223<>CALL    12291<>CALL
TODAY_TO_UTS.V
     11771**DCL     11767--DCLINIT
TWORK
     12140**DCL     13016<<ASSIGN  13018>>DOWHILE 13022>>DOWHILE 13025>>CALLBLT 13025>>CALLBLT 13050<<ASSIGN
     13054<<ASSIGN  13058<<ASSIGN  13064>>CALLBLT
U1
     12165**DCL     12550--CALL    13102--CALL    13291--CALL
U1.C
     12167**DCL     12214--ASSIGN  13289<<ASSIGN
U1.L
     12166**DCL     12539<<ASSIGN  13290<<ASSIGN
U2
     12168**DCL     12550--CALL    13102--CALL
U2.C
     12170**DCL     12216--ASSIGN  12541<<ASSIGN
U2.L
     12169**DCL     12546<<ASSIGN
U3
     12171**DCL     12550--CALL    13102--CALL
U3.C
     12173**DCL     12547<<ASSIGN
U3.L
     12172**DCL     12549<<ASSIGN
U4
     12174**DCL     13082--CALL    13087--CALL    13090--CALL
U4.C
     12176**DCL     13025<<CALLBLT
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:262  
U4.L
     12175**DCL     13026<<ASSIGN
U5
     12177**DCL     13082--CALL    13087--CALL
U5.C
     12179**DCL     13080<<ASSIGN  13085<<ASSIGN
U5.L
     12178**DCL     13081<<ASSIGN  13086<<ASSIGN
U6
     12180**DCL     13082--CALL    13087--CALL    13090--CALL
U6.C
     12182**DCL     13064<<CALLBLT
U6.L
     12181**DCL     13065<<ASSIGN
UNFID_INP
     10857**DCL     12538<>CALL
UNFID_INP.LEN_
     10860**DCL     12215<<ASSIGN
UNFID_INP.TEXTFID_
     10857**DCL     12214<<ASSIGN
UNFID_INP.V
     10861**DCL     10857--DCLINIT
UNFID_MSG
     11149**DCL     12545<>CALL
UNFID_MSG.LEN_
     11152**DCL     12217<<ASSIGN
UNFID_MSG.TEXTFID_
     11149**DCL     12216<<ASSIGN
UNFID_MSG.V
     11153**DCL     11149--DCLINIT
UNFID_OUT
     11125**DCL     12421<>CALL
UNFID_OUT.LEN_
     11128**DCL     12213<<ASSIGN
UNFID_OUT.TEXTFID_
     11125**DCL     12212<<ASSIGN
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:263  
UNFID_OUT.V
     11129**DCL     11125--DCLINIT
VLP_CRITERIA
     11692**DCL     11671--DCLINIT
VLP_CRITERIA.WSN#
     11696**DCL     13039<<ASSIGN
VLR_INP
     10836**DCL     10816--DCLINIT
VLR_JOBSTATS_CHECK
     11720**DCL     11671--DCLINIT
VLR_JOBSTATS_CHECK.AHEAD
     11721**DCL     13075>>CALLBLT
VLR_JOBSTATS_CHECK.DEVNAME
     11724**DCL     13085>>ASSIGN
VLR_JOBSTATS_CHECK.FCODE
     11722**DCL     13074>>IF      13084>>IF
VLR_OUT
     11099**DCL     11079--DCLINIT
VO_INTERSYS_ACCT
     12196**DCL     13443>>ASSIGN
VO_INTERSYS_NAME
     12197**DCL     13444>>ASSIGN
VO_INTERSYS_PASSWORD
     12198**DCL     13445>>ASSIGN
VWF$FOOTER
     12075**DCL-ENT 12992--CALL
VWH$HEADER
     12074**DCL-ENT 12643--CALL
VWO$TRANSO
     12077**DCL-ENT 12654--CALL    12658--CALL    12671--CALL    12675--CALL    12683--CALL    12687--CALL
     12703--CALL    13754--CALL
VWR$BREAK
     12073**DCL-ENT 12953--CALL
VWX$MAIL
     12072**DCL-ENT 12550--CALL    13005--CALL    13082--CALL    13087--CALL    13090--CALL    13102--CALL
     13228--CALL    13239--CALL    13251--CALL    13280--CALL    13291--CALL
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:264  
VW_BROKEN#
     12093**DCL     12572<<ASSIGN  12952>>IF
VW_IAM#
     12143**DCL     12473>>IF      12479>>IF      12490>>IF      12495>>CALLBLT 13456>>CALLBLT
VW_INPCNT#
     12090**DCL     12570<<ASSIGN  12876<<ASSIGN  12876>>ASSIGN  12951<<ASSIGN  12951>>ASSIGN  12962>>IF
VW_OPTIONS#
      9598**DCL      9604--REDEF    9967--REDEF
VW_OUTCNT#
     12091**DCL     12660<<ASSIGN  12677<<ASSIGN  12677>>ASSIGN  12689<<ASSIGN  12689>>ASSIGN  12705<<ASSIGN
     12705>>ASSIGN  13048>>ASSIGN  13756<<ASSIGN  13756>>ASSIGN
VW_SCRAMBLE#
     12189**DCL     12561<<ASSIGN  12653>>IF      12657>>IF      12670>>IF      12674>>IF      12682>>IF
     12686>>IF      12702>>IF      13753>>IF
VW_TOTBYTES#
     12092**DCL     12580<<ASSIGN  12581>>IF      12584<<ASSIGN
WRITE_JE
     11597**DCL     12655<>CALL    12659<>CALL    12672<>CALL    12676<>CALL    12684<>CALL    12688<>CALL
     12704<>CALL    13755<>CALL
WRITE_JE.BUF_.BOUND
     11597**DCL     12211<<ASSIGN
WRITE_JE.BUF_.BUF$
     11599**DCL     12210<<ASSIGN
WRITE_JE.STATION_
     11599**DCL     11599--REDEF
WRITE_JE.V
     11600**DCL     11597--DCLINIT
WRITE_JE.V.DVBYTE.VFC#
     11606**DCL     11606--REDEF
WSN_JE
     11576**DCL     11346--DCLINIT
WSN_JE.WSN#
     11576**DCL     12521<<ASSIGN  12528<<ASSIGN
X$WILDFMT
     12076**DCL-ENT 12389--CALL
XUW_WILDCARD
PL6.E3A0      #001=VWB$BEAM File=VWB$BEAM.:VMB6TSI                               WED 08/20/97 15:37 Page:265  
     11951**DCL     12389<>CALL
XUW_WILDCARD.ERROR.ERR#
     11976**DCL     12402>>IF
XUW_WILDCARD.INPUT_
     11957**DCL     12387<<ASSIGN
XUW_WILDCARD.OUTPUT_
     11967**DCL     12388<<ASSIGN
XUW_WILDCARD.OUTPUT_LEN
     11982**DCL     12390>>ASSIGN
XUW_WILDCARD.PATTERN_
     11952**DCL     12357<<ASSIGN
XUW_WILDCARD.TEMPLATE_
     11962**DCL     12356<<ASSIGN
YYMMDD
     12142**DCL     11743--DCLINIT 11744--DCLINIT 11767--DCLINIT 11768--DCLINIT 12290<<ASSIGN
